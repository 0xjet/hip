{
    "id": "9f7b9448-fe93-4d24-815f-4c3d8d85df1f",
    "created_at": "2023-01-12T15:02:44.258448Z",
    "updated_at": "2025-03-27T02:16:14.03475Z",
    "deleted_at": null,
    "sha1_hash": "6817e4a7d63d81d0cf3949652e899d2e87b9a22d",
    "title": "2018-06-14 - Another Potential MuddyWater Campaign uses Powershell-based PRB-Backdoor",
    "authors": "",
    "file_creation_date": "2022-05-29T01:12:35Z",
    "file_modification_date": "2022-05-29T01:12:35Z",
    "file_size": 511661,
    "plain_text": "# Potential MuddyWater Campaign uses PRB-Backdoor\n\n**blog.trendmicro.com/trendlabs-security-intelligence/another-potential-muddywater-campaign-uses-powershell-based-**\nprb-backdoor/\n\nJune 14, 2018\n\nThe [MuddyWater campaign was first sighted in 2017 when it targeted the Saudi government](https://www.reuters.com/article/us-saudi-cyber/saudi-agency-says-country-targeted-in-cyber-spying-campaign-idUSKBN1DK27M)\nusing an attack involving PowerShell scripts deployed via Microsoft Office Word macro. In\n[March 2018, we provided a detailed analysis of another campaign that bore the hallmarks of](https://blog.trendmicro.com/en_us/research/18/c/campaign-possibly-connected-muddywater-surfaces-middle-east-central-asia.html)\nMuddyWater.\n\nIn May 2018, we found a new sample (Detected as W2KM_DLOADR.UHAOEEN) that may\nbe related to this campaign. Like the previous campaigns, these samples again involve a\nMicrosoft Word document embedded with a malicious macro that is capable of executing\nPowerShell (PS) scripts leading to a backdoor payload. One notable difference in the\nanalyzed samples is that they do not directly download the Visual Basic Script(VBS) and\nPowerShell component files, and instead encode all the scripts on the document itself. The\nscripts will then be decoded and dropped to execute the payload without needing to\ndownload the component files.\n\nAs mentioned earlier, our analysis of the sample revealed characteristics that likely connect it\nto the MuddyWater campaign, in particular:\n\nThe delivery method, which involves the use of a malicious document with an\nembedded macro as a lure for potential victims\n\n\n-----\n\nThe obfuscation method for the macro scripts, which will result in an intended backdoor\npayload. This method is commonly used in samples that were used in the MuddyWater\ncampaign\n\n**Infection chain**\n\nFigure 1. Comparison of the infection chains used in the previous and current campaigns\n\n**Technical details**\n\nThe sample we analyzed was a Word document used as a lure for unsuspecting victims.\nHowever, unlike the samples from the previous campaigns, the lure document deals with a\ndifferent subject matter. Instead of using government or telecommunications-related\ndocuments, the new lure document presents itself as a reward or promotion, which could\nindicate that the targets are no longer limited to specific industries or organizations.\n\nFigure 2. Sample lure document used in the new campaign\n\nThe document is designed to trick users into enabling the macro to view its full content.\nHowever, the macro's true purpose is to allow it to execute malicious routines without the\nuser’s knowledge.\n\nOnce the macro is enabled, it will use the Document_Open() event to automatically execute\nthe malicious routine if either a new document using the same template is opened or when\nthe template itself is opened as a document0.\n\n[Figure 3. Executing the malicious routine via Document_Open()](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2018/06/MuddyWater-New3.png)\n\nFigure 3. Executing the malicious routine via Document_Open()\n\nThe malicious macro's code snippet uses three main functions, specifically:\n\nThe function contained in the RED box is the Document_Open() event, where all the\nsub-functions will be executed/called.\nThe code inside the GREEN box manipulates the images shown in the document's\nbody.\nThe code inside the BLUE box constructs the main Powershell commands and scripts.\nThese will be executed to perform the main routine.\n\nFigure 4. A snippet of the malicious macro’s code, marked with colored boxes to show the\ndifferent functions\n\n\n-----\n\n**Decoding and deobfuscation**\n\nAnalysis of the code revealed a PowerShell script capable of decoding the contents of the\nmalicious document, which results in the execution of yet another encoded PowerShell\nscript.\n\n[Figure 5. The Powershell script contained in the sample's code](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2018/06/MuddyWater-New5.png)\n\nFigure 5. The Powershell script contained in the sample's code\n\nFigure 6. The second encoded PowerShell script, which is executed after the first script is\ndecoded\n\nFigure 6. The second encoded PowerShell script, which is executed after the first script is\ndecoded\n\nThis will then result in more readable PowerShell scripts capable of dropping various\ncomponents in the %Application Data%\\Microsoft\\CLR\\* directory. The main PowerShell file\n_invoker.ps1 uses these components to run the final payload, PRB-Backdoor, previously_\n[analyzed by other security researchers in May 2018.](https://sec0wn.blogspot.com/2018/05/prb-backdoor-fully-loaded-powershell.html)\n\nFigure 7: The components dropped in the %Application Data%\\Microsoft\\CLR\\* directory\n\nPRB-Backdoor is a backdoor that takes its name from the function used in the final\nPowerShell script payload, as seen in the figure below.\n\n[Figure 8. The PS function from which PRB-Backdoor takes its name](https://blog.trendmicro.com/content/dam/trendmicro/global/en/migrated/security-intelligence-migration-spreadsheet/trendlabs-security-intelligence/2018/06/MuddyWater-New8.png)\n\nFigure 8. The PS function from which PRB-Backdoor takes its name\n\nThe backdoor communicates with its Command-and-Control (C&C server),\nhxxp://outl00k[.]net, to send and receive the following commands:\n\n**Command** **Details**\n\nPRB-CREATEALIVE Initializes connection with the C&C Server\n\n\nPRBCREATEINTRODUCE\n\n\nRegisters/introduces the affected machine to the C&C server\n\n\nPRB-History Gather browsing histories from different browsers and send it to\nthe C&C server using the \"sendfile\" function\n\nPRB-PASSWORD Steals passwords listed or found in the browser histories\n\nPRB-READFILE Reads files\n\n\n-----\n\nPRB-WRITEFILE Writes files\n\nPRB-Shell Executes shell commands\n\nPRB-Logger Calls the \"Logger\" function, used to record keyboard strokes\n\nPRB-Shot Triggers the SNAP function, used to capture screenshots\n\nPRB-funcupdate Updates functions\n\nsysinfo Gathers system information\n\nStart_Dns Initializes DNS Session/Connection\n\nIf these samples are indeed related to MuddyWater, this means that the threat actors behind\nMuddyWater are continuously evolving their tools and techniques to make them more\neffective and persistent.\n\n**Countermeasures and Trend Micro Solutions**\n\nGiven the use of lure documents designed with social engineering in mind, it is likely that the\nattackers use phishing or spam to target users who are unaware of these documents'\nmalicious nature. Awareness can effectively mitigate or stop these kinds of attacks from\n[being successful. The first step is to be able to identify phishing attacks and](https://www.trendmicro.com/vinfo/tmr/?/us/security/news/cybercrime-and-digital-threats/best-practices-identifying-and-mitigating-phishing-attacks) distinguish\nlegitimate emails from malicious ones. Telltale signs of social engineering include “too-goodto-be-true” offers and messages that lack context. In general, users should always practice\ncaution when it comes to email. This includes avoiding clicking on links or downloading any\ndocuments unless certain that these are legitimate.\n\n[Trend Micro™ Deep Discovery™ provides detection, in-depth analysis, and proactive](https://blog.trendmicro.com/en_us/business/products/network/advanced-threat-protection.html)\nresponse to today’s stealthy malware, and targeted attacks in real time. It provides a\ncomprehensive defense tailored to protect organizations against targeted attacks and\n[advanced threats through specialized engines, custom sandboxing, and seamless](https://www.trendmicro.com/vinfo/tmr/?/us/security/news/security-technology/how-can-advanced-sandboxing-techniques-thwart-elusive-malware)\ncorrelation across the entire attack lifecycle, allowing it to detect threats even without any\nengine or pattern update.\n\n[Trend Micro™ Hosted Email Security is a no-maintenance cloud solution that delivers](https://blog.trendmicro.com/en_us/business/products/user-protection/sps/email-and-collaboration/email-security.html)\ncontinuously updated protection to stop spam, malware, spear phishing, ransomware, and\nadvanced targeted attacks before they reach the network.\n\n[Trend Micro™ Deep Discovery™ Email Inspector and](https://blog.trendmicro.com/en_us/business/products/network/advanced-threat-protection.html) [InterScan™ Web Security prevent](https://blog.trendmicro.com/en_us/business/products/user-protection/sps.html)\nmalware from ever reaching end users. At the endpoint level, Trend Micro™ Smart\nProtection Suites deliver several capabilities that minimize the impact of these attacks.\n\n\n-----\n\nThese solutions are powered by the Trend Micro [XGen™ security, which provides a cross-](https://blog.trendmicro.com/en_us/business/products/all-solutions.html)\ngenerational blend of threat defense techniques against a full range of threats for data\ncenters, [cloud environments,](https://blog.trendmicro.com/en_us/business/products/hybrid-cloud/cloud-migration-security.html) [networks, and](https://blog.trendmicro.com/en_us/business/products/network.html) [endpoints. It features high-fidelity machine](https://blog.trendmicro.com/en_us/business/products/user-protection.html)\n[learning to secure the gateway and](https://blog.trendmicro.com/en_us/business/products/user-protection/sps.html) [endpoint data and applications, and protects physical,](https://blog.trendmicro.com/en_us/business/products/user-protection/sps.html)\nvirtual, and cloud workloads.\n\n**Indicators of Compromise (IoCs)**\n\nDetected as W2KM_DLOADR.UHAOEEN\n\n- 240b7d2825183226af634d3801713b0e0f409eb3e1e48e1d36c96d2b03d8836b\n\nAPT & Targeted Attacks\n\nWe found a new sample that may be related to the MuddyWater campaign. The sample does\nnot directly download the Visual Basic Script and PowerShell component files, and instead\nencode all the scripts on the document itself.\n\nBy: Michael Villanueva, Martin Co June 14, 2018 Read time: ( words)\n\nContent added to Folio\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-06-14 - Another Potential MuddyWater Campaign uses Powershell-based PRB-Backdoor.pdf"
    ],
    "report_names": [
        "2018-06-14 - Another Potential MuddyWater Campaign uses Powershell-based PRB-Backdoor.pdf"
    ],
    "threat_actors": [
        {
            "id": "2ed8d590-defa-4873-b2de-b75c9b30931e",
            "created_at": "2023-01-06T13:46:38.730137Z",
            "updated_at": "2025-03-27T02:00:02.903261Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "Boggy Serpens",
                "Mango Sandstorm",
                "TEMP.Zagros",
                "Static Kitten",
                "G0069",
                "TA450",
                "Earth Vetala",
                "Seedworm",
                "COBALT ULSTER",
                "ATK51"
            ],
            "source_name": "MISPGALAXY:MuddyWater",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "31e69945-6c1e-40c3-ba8e-a77e81dd142a",
            "created_at": "2024-05-01T02:03:08.047377Z",
            "updated_at": "2025-03-27T02:05:17.326452Z",
            "deleted_at": null,
            "main_name": "COBALT ULSTER",
            "aliases": [
                "ENT-11 ",
                "ITG17 ",
                "MERCURY ",
                "Mango Sandstorm ",
                "MuddyWater ",
                "STAC 1171 ",
                "Seedworm ",
                "Static Kitten ",
                "TEMP.Zagros ",
                "UNC3313 ",
                "Yellow Nix ",
                "Earth Vetala "
            ],
            "source_name": "Secureworks:COBALT ULSTER",
            "tools": [
                " Canopy",
                " CrackMapExec",
                " CredNinja",
                " Empire",
                " FORELORD",
                " Koadic",
                " LaZagne",
                " Ligolo",
                " MKL64",
                " Metasploit",
                " Mimikatz",
                " MiniDump",
                " Mori",
                " MuddyC2Go",
                " MuddyC3",
                " PhonyC2",
                " Plink",
                " PowGoop",
                " PowerStats",
                " RemoteUtilities",
                " Revsocks",
                " ScreenConnect",
                " SimpleHelp",
                " Small Sieve",
                " Syncro",
                " Venom Proxy",
                " WMIExec",
                "AnyDesk"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "02e1c2df-8abd-49b1-91d1-61bc733cf96b",
            "created_at": "2022-10-25T15:50:23.308924Z",
            "updated_at": "2025-03-27T02:00:55.437268Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "MuddyWater",
                "Earth Vetala",
                "Static Kitten",
                "Seedworm",
                "TEMP.Zagros",
                "Mango Sandstorm",
                "TA450"
            ],
            "source_name": "MITRE:MuddyWater",
            "tools": [
                "STARWHALE",
                "POWERSTATS",
                "Out1",
                "PowerSploit",
                "Small Sieve",
                "Mori",
                "Mimikatz",
                "LaZagne",
                "PowGoop",
                "CrackMapExec",
                "ConnectWise",
                "SHARPSTATS",
                "RemoteUtilities",
                "Koadic"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3c430d71-ab2b-4588-820a-42dd6cfc39fb",
            "created_at": "2022-10-25T16:07:23.880522Z",
            "updated_at": "2025-03-27T02:02:10.010443Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "ATK 51",
                "Boggy Serpens",
                "Cobalt Ulster",
                "ITG17",
                "Mango Sandstorm",
                "MuddyWater",
                "Operation BlackWater",
                "Operation Earth Vetala",
                "Operation Quicksand",
                "Seedworm",
                "Static Kitten",
                "T-APT-14",
                "TA450",
                "TEMP.Zagros",
                "Yellow Nix"
            ],
            "source_name": "ETDA:MuddyWater",
            "tools": [
                "Agentemis",
                "BugSleep",
                "CLOUDSTATS",
                "ChromeCookiesView",
                "Cobalt Strike",
                "CobaltStrike",
                "CrackMapExec",
                "DELPHSTATS",
                "EmPyre",
                "EmpireProject",
                "FruityC2",
                "Koadic",
                "LOLBAS",
                "LOLBins",
                "LaZagne",
                "Living off the Land",
                "MZCookiesView",
                "Meterpreter",
                "Mimikatz",
                "MuddyC2Go",
                "MuddyRot",
                "Mudwater",
                "POWERSTATS",
                "PRB-Backdoor",
                "PhonyC2",
                "PowGoop",
                "PowerShell Empire",
                "PowerSploit",
                "Powermud",
                "QUADAGENT",
                "SHARPSTATS",
                "SSF",
                "Secure Socket Funneling",
                "Shootback",
                "Smbmap",
                "Valyria",
                "chrome-passwords",
                "cobeacon",
                "prb_backdoor"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535764,
    "ts_updated_at": 1743041774,
    "ts_creation_date": 1653786755,
    "ts_modification_date": 1653786755,
    "files": {
        "pdf": "https://archive.orkl.eu/6817e4a7d63d81d0cf3949652e899d2e87b9a22d.pdf",
        "text": "https://archive.orkl.eu/6817e4a7d63d81d0cf3949652e899d2e87b9a22d.txt",
        "img": "https://archive.orkl.eu/6817e4a7d63d81d0cf3949652e899d2e87b9a22d.jpg"
    }
}