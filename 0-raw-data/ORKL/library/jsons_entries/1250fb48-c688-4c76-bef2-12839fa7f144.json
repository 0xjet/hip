{
    "id": "1250fb48-c688-4c76-bef2-12839fa7f144",
    "created_at": "2023-01-12T15:09:50.130655Z",
    "updated_at": "2025-03-27T02:05:58.62671Z",
    "deleted_at": null,
    "sha1_hash": "a32b4f1cd5ece3d57db05471146d60b426c99e1f",
    "title": "2019-03-21 - How Lockergoga took down Hydro — ransomware used in targeted attacks aimed at big business",
    "authors": "",
    "file_creation_date": "2022-05-27T21:26:42Z",
    "file_modification_date": "2022-05-27T21:26:42Z",
    "file_size": 4485476,
    "plain_text": "# How Lockergoga took down Hydro — ransomware used in targeted attacks aimed at big business\n\n**doublepulsar.com/how-lockergoga-took-down-hydro-ransomware-used-in-targeted-attacks-aimed-at-big-business-**\nc666551f5880\n\nKevin Beaumont April 18, 2019\n\n[Kevin Beaumont](https://medium.com/@networksecurity?source=post_page-----c666551f5880--------------------------------)\n[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F7db6d2df42a6&operation=register&redirect=https%3A%2F%2Fdoublepulsar.com%2Fhow-lockergoga-took-down-hydro-ransomware-used-in-targeted-attacks-aimed-at-big-business-c666551f5880&user=Kevin+Beaumont&userId=7db6d2df42a6&source=post_page-7db6d2df42a6----c666551f5880---------------------follow_byline-----------)\nMar 21, 2019\n\n\n13 min read\n\nThis week Norsk Hydro, a large multinational manufacturer with 35,000 staff and over 100\nyears of history, had the nightmare scenario of a worldwide apparent ransom attempt — their\nsystems began to malfunction, and attackers had placed the following ransom note on their\nbusiness and some production systems across the world:\n\n\n-----\n\nThe ransom note.\nEach impacted system had four key elements:\n\nThey all ran Microsoft Windows.\nFiles, including some system files, had been encrypted.\nThe network interface on every system had been disabled.\nThe local user accounts on every system had their password changed.\n\nFrom what I can gather, they have an existing security team and controls, and one of the\nthings you haven’t seen this time is people online highlighting a ton of obvious security flaws\nwith their systems (see also, Equifax etc) — so what happened?\n\n“Essentially, there are cascading failures in the technology and security industry to\nprotect customers.”\n\n## The event\n\nThe timeline is known as so:\n\n.\n\n\n-----\n\nAround midnight (UTC) on Tuesday 19th March, security events were detected in\nAmericas locations of Hydro.\nIn the early hours of the morning, the attack began.\nBy 5am (UTC) Hydro had opted to disconnect their worldwide network (WAN).\nOver a month later, the company is still attempting to recover from the attack, and most\nof its 160 manufacturing locations are still operating in manual (non-IT driven)\noperations.\n\n## Why Norsk Hydro ASA as a target?\n\nI do not know, nor care to speculate. I can say for sure they were specifically targeted, as\neach LockerGoga payload contains a unique four digital reference number and information\nunique to the target.\n\nAs business began on Tuesday 19th March 2019, Hydro had no website, no network and no\nself managed IT. This is an incredibly difficult situation for a manufacturing company.\n\nThe CEO had started the job the day before.\n\nHydro posted notices at their 40 offices and manufacturing facilities across the world asking\nstaff to disconnect their devices from local networks, and the recovery effort began.\n\nThey informed stock markets they were moving to ‘manual production’, which means they\nwould operate factories without modern IT.\n\nEach local factory manager was tasked with maintaining customer orders — for example,\nsome operated from pre-printed list of orders.\n\nFor communication, Norsk Hydro ASA uses Office365, which was completely unimpacted —\nso staff could still communicate with each other, the press and customers using mobile\nphones and tables. Had Hydro not already moved communications to a managed cloud\nservice, the situation would have been more grave.\n\nFor communication with the outside world they used their Facebook account, and redirected\nhydro.com to an Azure temporary website:\n\n\n-----\n\nThis website has since been moved to behind Cloudflare, a managed DDoS protection\nprovider.\n\n## Incident representation\n\nHydro started the best incident representation response plan I’ve ever seen — they had a\ntemporary website up, they told the press, they told their staff, they apparently didn’t hide any\ndetails — they even had daily webcasts with the most senior staff talking through what was\nhappening, and answering questions. On the 2nd day they even took questions from\nwebcast watchers.\n\n\n-----\n\nIn contrast to some other incidents, their stock price actually went up — despite a difficult\ntrading period for past 2 years involving some major business setbacks, they have actually\ngained in value.\n\n## Incident response\n\nHydro’s website says they have flown in staff from Microsoft and unnamed companies to\nhelp them recover. They have also engaged with national cybercrime bodies, industry groups\nand police authorities. The incident is now a police investigation.\n\nTheir CFO says they have backups of data which they are attempting to restore, and they\nhave not paid a ransom.\n\n[They say it is unknown how long recovery will take, although in an interview with a](https://www.nrk.no/norge/it-sjefen-i-hydro-om-dataangrepet_-_-man-tror-krisen-blir-stor_-sa-blir-den-enda-verre-1.14515043)\nNorwegian news organisation the CIO says full recovery will take months.\n\nHydro have provided videos about their recovery efforts:\n\n\n-----\n\n-----\n\n## What went wrong?\n\n Security controls and industry\n\nSeveral weeks ago, I highlighted on Twitter that despite a high profile attack on Altran in\nJanuary (34,000 staff members) using LockerGoga, a vast majority of endpoint security antimalware products were failing to detect it. I highlighted this because @malwrhunterteam on\nTwitter sent me a message saying ‘look at this and the poor detection’:\n\n\n-----\n\nAs you can see above the detection rate was 0 out of 67 anti-virus engines. Now, before\nvendors get annoyed, I am well aware that VirusTotal results don’t tell the full story —\nhowever having zero detection from any engine is an extremely bad sign. I actually\ndetonated the ransomware myself on several real world endpoints (in isolated fashion — as\nyou’ll learn later it doesn’t self replicate too) and I couldn’t find an endpoint security tool\nwhich actually triggered a detection (although Cisco’s ThreatGrid sandbox technology did\nclassify it as Generic Ransomware).\n\nI used that Twitter thread to pressure several anti-malware producers into action, DMing staff\nI knew at said companies to get them to take a look.\n\nI found a few more samples in VirusTotal, clearly still in development — those, too, had little\nto no detection. I sent them on informally.\n\n\n-----\n\nAfter the Altran attack, which downed systems at a 34,000 employee company, only a\nhandful of dialogue happened in the industry — I can only find one news article which\nactually mentions LockerGoga, for example, and little to no technical detail.\n\nAs far as I’m aware there is not any centralised way to contact everybody in antivirus\nindustry on international interest, so I completely forgot about it a few people in, and went to\nwatch Captain Marvel instead.\n\nEssentially, Norsk Hydro’s anti-malware solution did not have detection for the threat\nbecause not all the industry players were paying attention to a cartoon porg on Twitter (me)\nand a random person who I think doesn’t work in the industry (MalwareHunterTeam).\n\nI’m not saying that’s how the industry should work, by the way, and I know it sounds self\naggrandising — but I’m trying to make the point that maybe, as an industry, we’re really good\nat hyping threats in the media which are not practical in the real world and not great at\nlooking at all the real world, actual attack data.\n\nWhile we may be sharing Indicators of Compromise — IoCs — a long list of meaningless\nhashes aren’t enough to protect people. The cyber security industry and partners missed a\ntrick here, as we knew a major company had been attacked in a meaningful way, but it\nwasn’t followed up.\n\nAdditionally, the digital certificate being used to sign the ransomware was used to sign other\nmalicious code — in fact it had only been used to sign malicious code — and had been\nissued to a company with £1 of assets which wasn’t even a trading company. Upon being\ninformed of this, the Certificate Authority failed to revoke the certificate in a timely manner —\na continuing issue with the same Certificate Authority, which is trusted by all Windows\n\n\n-----\n\ncertificate stores. To compound the issue even when revoked a vast majority of security tools\nfail to do anything, as they do not retrieve the CRL and check the serial number for\nrevocation. All security and technology should immediately block or flag code signed with\nspecifically distrusted certificates. Essentially, there are cascading failures in the technology\nand security industry to protect customers.\n\nAnother element — some LockerGoga deployments stop endpoint security products (and\nbackup products) before further deployment:\n\n## Lateral movement\n\nLockerGoga does not have any code to self spread, meaning it can not self replicate around\na network — unlike other destructive code such as WannaCry and NotPetya.\n\nThis may actually be intentional — because it doesn’t use C2 (‘Command and Control’)\nservers and DNS traffic it means it is less likely to picked up by network detection and\nendpoint classification tools, too.\n\nSo how did they plant LockerGoga? I speculated above it was probably using Active\nDirectory — something like scheduled tasks or services. The initial assessment from\nNorCERT appears to back this up, although the investigation is still ongoing:\n\nIn order to pull that off you need remote access — it is not known how the attackers got\naccess to Norsk Hydro’s network at this stage. I would actually call upon Hydro to do\nsomething very unusual (so far) in incident response and open source release some of the\ninformation in this area later, as I strongly believe it can help protect every company —\nincluding their customers.\n\nOnce inside their network, they must have had Domain Administrator rights to execute the\nattack. Usually in companies it is extremely easy to get this access, despite the industry hard\nselling a range of privileged access management tools, by simply:\n\nfishing logins out of memory using Mimikatz\n\n\n-----\n\ntaking passwords from Active Directory Group Policy Preferences — they re often right\nthere in the XML files. It’s the go to, bread and butter of ‘Red Teams’.\nPass The Hash attacks and surf around the entire network using the same local\nadministrator passwords because almost nobody deploys Microsoft .\n\nHowever it happened, they got to domain administrator. Like I say, normally this isn’t\nproblematic as almost all companies make the same simple Active Directory configuration\nerrors and fail to prioritise remediation.\n\n## Got root?\n\nOnce you’re an Active Directory administrator, if you are an attacker you can place the\nexecutable somewhere where every system in an organisation can reach — normally,\norganisations universally firewall accept Active Directory traffic internally.\n\nBingo, you have the keys to the kingdom — the only thing stopping you now is security\ncontrols around endpoint malware, and as we already established those won’t detect\nLockerGoga at the time of the attack.\n\nSo you can place it on a Domain Controller in the NETLOGON share under Sysvol, which is\nreplicated to every site with a Domain Controller. Then you can use Group Policy such as\nscheduled task creation or service creation to automatically start the LockerGoga\nexecutable.\n\nImmediately, every single laptop, desktop and server connected to Active Directory will\ntrigger the malicious software.\n\n\n-----\n\nAnother way to do it is, of course, psexec – psexec handily supports wildcards.\n\nMany people will talk about ‘air gapping’ Industrial Control Systems (ICS), however many\norganisations — almost every organisation I’ve met, in fact — ends up connecting some\nelements to Active Directory for benefits such as easy licensing, centralised account control\netc. This leads to a situation where production systems — I’m not talking the technologist\nuse of production, I mean the manufacturing industry term of systems which do something\ncritical on the coalface — are linked to a central system which can be misused.\n\nI should be clear here that I’m not saying ICS systems shouldn’t be joined to Active Directory\nbecause risk assessment wise unless you’re an extremely high profile target the benefits\nmay outweight the risks. I am saying they should probably be joined to an entirely separate\nActive Directory forest, and administrator access should be incredibly tightly controlled.\n\n## The impact\n\n Left adrift\n\nLockerGoga does a few things, some unique:\n\nIt ends up using every CPU core and thread during encryption and is very, very fast.\nThis is because it spawns hundreds of executables for encryption. On an average\nsystem within a few minutes, it is toast.\nAdditionally, some technical blogs on LockerGoga mention a list of file types that are\nencrypted which only includes things like Office files — I can say first hand that it also\nencrypts system files such as DLL files across the C: drive. Since it is deployed as\nadministrator level using Active Directory, it has full control of all files.\nIt depends on the version being run (on VirusTotal you can see different LockerGoga\nexecutables with different features) but newer versions use netsh.exe to disable all\nnetwork cards after encryption is done.\nIt then changes every local administrator account password.\nIt then logs you off, using logoff.exe.\n\n## Recovery\n\nOn laptops and desktops, what you’re left with with is the ability to log back in using domain\nuser accounts (it can’t impact Active Directory accounts) on a cached basis, but your users\nare off the network, as an administrator you cannot reach the PC remotely to fix it, and all the\nuser can do is read the ransom note. They cannot use email, they cannot read a broadcast\nfrom the company on their PC, they cannot work likely as their files are encrypted.\n\nYou cannot log in at the physical console to recover the system as you do not know the local\nadministrator details any more.\n\n\n-----\n\nOn servers you have service issues, as changing the local administrator passwords can\nimpact system services using local accounts (such as Microsoft SQL, Sophos etc).\n\n## Learning opportunities\n\nHere’s the top ten things I think we can take away from this:\n\n## Governments and industry\n\nThere is a serious lack of open information sharing after ransomware incidents which involve\nunusual code. Right now we’re super protected against, say, WannaCry — but after Altran, a\nlack of transparency and openness lead to the same issue elsewhere.\n\nThis will happen again with other threats. In my opinion it is in national and international\ninterests for governments to be informed of technical details of all major business incidents\naround malicious code causing outages (e.g. wipers, ransomware) and that information\nshould be shared with security vendors and other governments. I know many organisations\nwon’t want to provide this information so governments or regulators might need levers to pull\nto compel disclosure.\n\n## Companies\n\nOrganisations should look at how Hydro disclosed and dealt with the issue so far in the\npublic arena. It looks like it may be a textbook example of how incident response should be\ndone, with transparency and openness. Not only the public and media perception went well,\nbut the business end went well too — people didn’t sell off shares because they felt\ngenuinely informed and that Hydro had a dire situation under control.\n\n## Security industry\n\nI feel the industry could do a better job at advising what benefits and weak spots of their\nproducts have in terms of detection, so customers can make informed choices about where\nthey may need to introduce additional controls and investment.\n\nI know, I’m naive.\n\nThe cyber security industry is currently going through a hype cycle where some vendors are\nsimply overselling their products — including internally — so you can end up with customers\nlike Hydro which likely had a reasonable security stack, but got wiped out anyway. Hydro\naren’t alone here in their journey.\n\nI’ve seen vendors talking about Artificial Intelligence made malware — where AI creates the\nmalware itself — which isn’t even a real thing. The reality here is we had an in the wild,\nclassic ransomware attack around for months and there wasn’t anywhere approaching good\n\n\n-----\n\ndetection. Stop talking about blockchain and start detecting.\n\n## Detection inside organisations\n\nYour Security Incident Event Management (SIEM) tool should have alerts to detect\nexcessive addition of new scheduled tasks and/or services. This is not a default alert\nI’ve seen in any vendor, and I don’t think it’s a CIS control either. I might write this up\none day.\nIf you don’t have a SIEM tool, deploy Azure Sentinel. It’s currently free, no\ninfrastructure, Microsoft managed, and comes with a bucket load of free use cases (it\nships with over a thousand detections) out the box. You can onboard your entire\norganisation faster than you can set up a Splunk Heavy Forwarder.\nDetect things like Mimikatz and Pass The Hash attacks. Azure Sentinel does this out\nthe box, no config. If you get your alerts configured right and without false positives (it’s\npossible) then jump on them as soon as they go off. Priority -3493289. Make it\nmonitored 24/7 and on call.\nDetect excessive usage of netsh.exe and logoff.exe.\nDetect local administrator password changes, particularly on servers.\nDetect your endpoint security solutions being stopped and/or disabled.\nEnable ‘tamper protection’ in your security products — e.g. in Sophos Endpoint with\nSophos Enterprise Console you need to manually enable, otherwise attackers can\neasily just stop Sophos.\nMake sure endpoint security products are universally deployed (e.g. via enforced\nGroup Policy deployment), do not allow IT staff to disable them, and do not allow\npolicies to be weakened outside change management (e.g. too broad whitelists).\nBackup everything.\nHave read only backups, too, if you use disk-to-disk.\nHave a very heavily defended backup infrastructure. Only the people who access to a\nbackup server should have access. Take Domain Admins out the Local Administrator\ngroup; make it truly secure.\nKeep an eye on infections of Trickbot and Emotet via Office macros.\nKeep an eye on infections of Empire Powershell and Cobalt Strike on endpoints and\nservers.\nUse a service like to monitor your external IP ranges for open RDP servers and other\nmisconfigurations.\nDo not pay the ransom.\nDo not pay the ransom.\nDo not pay the ransom.\n\n~g\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-03-21 - How Lockergoga took down Hydro — ransomware used in targeted attacks aimed at big business.pdf"
    ],
    "report_names": [
        "2019-03-21 - How Lockergoga took down Hydro — ransomware used in targeted attacks aimed at big business.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536190,
    "ts_updated_at": 1743041158,
    "ts_creation_date": 1653686802,
    "ts_modification_date": 1653686802,
    "files": {
        "pdf": "https://archive.orkl.eu/a32b4f1cd5ece3d57db05471146d60b426c99e1f.pdf",
        "text": "https://archive.orkl.eu/a32b4f1cd5ece3d57db05471146d60b426c99e1f.txt",
        "img": "https://archive.orkl.eu/a32b4f1cd5ece3d57db05471146d60b426c99e1f.jpg"
    }
}