{
    "id": "c3e9e5d8-fbab-462b-8aae-b01232e34577",
    "created_at": "2022-10-25T16:48:10.361104Z",
    "updated_at": "2025-03-27T02:09:18.297765Z",
    "deleted_at": null,
    "sha1_hash": "d164d5bea0819c3f3354926187edaca7806a850f",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-11-30T20:04:58Z",
    "file_modification_date": "2020-11-30T20:04:58Z",
    "file_size": 5627731,
    "plain_text": "## It's not FINished\n\n###### Mitchell Clarke and Tom Hall\n\n\n-----\n\n#### § Principal Consultant § London, UK\n\n § 2.5 years at Mandiant\n\n##### snozberries_au\n\n\n-----\n\n#### § Principal Consultant § London, UK\n\n § Five years at Mandiant\n\n##### – thall_sec\n\n\n-----\n\n### Ransomware Operation Trends\n\nSelf Manual\nPropagating Detonation\n\nSpray and Targeted\nPray Deployment\n\nPartnership Self\nModels Managed\n\n\n-----\n\n### APT\n\n#### § An attacker has domain admin access to my\n\n##### environment\n#### § There are multiple persistence mechanisms § They likely stole business sensitive data\n\n\n-----\n\n### APT Ransomware\n\n#### § An attacker has domain admin access to my\n\n##### environment\n#### § There are multiple persistence mechanisms § They likely stole business sensitive data § All of my IT infrastructure is down § I can’t function as a business\n\n\n-----\n\n# REvil/Sodinokibi\n\n\n-----\n\n### REvil Ransomware as a Service\n\n#### § First seen May 2019 § Operated by UNKN § Affiliate model:\n\n###### – Multiple threat actors use the REvil RaaS\n\n – Affiliates are vetted and buy in\n\n – Affiliates receive 60% - 75% of payouts depending on\n performance\n\n\n-----\n\n### REvil Ransomware as a Service\n\n#### § Each affiliate gains access to the RaaS platform:\n\n###### – Malware generation\n\n – Ransom demands and payment service\n\n – Victim communications\n\n – Coin laundering\n\n\n-----\n\n### Sodinokibi Ransomware\n\n#### § On the most part, ransomed systems remain\n\n##### functional\n\n###### – System-related file extensions and directories are\n untouched\n#### § To date, no issues found in crypto § Each infected system has a unique private key:\n\n###### – Encrypted and stored in registry\n\n – Decrypted with attacker key\n\n\n-----\n\n### Time to Ransomware Deployment\n\n#### § It depends on the affiliate § For comprehensive domain-wide ransomware\n\n##### deployment:\n\n###### – Up to three to four months\n\n – Some affiliates appear to have a backlog of victims\n\n\n-----\n\n# REvil/Sodinokibi\n\n\n-----\n\n### Initial Compromise\n\n**Establish Foothold**\n\n#### § Mass exploitation of high-profile vulnerabilities for Escalate Privileges\n\n##### internet-facing infrastructure:\n\n**Reconnaissance**\n\n###### – VPN\n\n – SharePoint\n\n**Lateral Movement**\n\n###### – RDP\n – Remote Access Applications Maintain Presence\n#### § Lateral movement via third parties\n\n**Data Theft**\n\n#### § Credential stuffing of internet infrastructure § Phishing Ransomware\n\n**Deployment**\n\n\n-----\n\n### Establish Foothold\n\n**Establish Foothold**\n\n##### Depends on the affiliate: Escalate Privileges\n#### § Cobalt Strike § VPN abuse Reconnaissance § Web shells Lateral Movement\n\n<%@ Page Language=\"C#\" Debug=\"true\" Trace=\"false\" %>\n<%@ Import Namespace=\"System.Diagnostics\" %>\n\n**Maintain Presence**\n\n<%@ Import Namespace=\"System.IO\" %>\n<html>\n<script Language=\"c#\" runat=\"server\">\n\n**Data Theft**\n\nprivate const string AUTHKEY = \"VictimOrg\";\nprivate const string HEADER = \"<html>\\n<head>\\n<title>command</title>\\n<style\ntype=\\\"text/css\\\"><!--\\nbody,table,p,pre,form input,form select {\\n font-family: **Ransomware**\n\\\"Lucida Console\\\", monospace;\\n font-size: 88%;\\n}\\n-- **Deployment**\n>\\n</style></head>\\n<body>\\n\";\n\nprivate const string FOOTER = \"</body>\\n</html>\\n\";\n\n\n-----\n\n### Escalate Privileges\n\n**Establish Foothold**\n\n#### § Mimikatz Escalate Privileges § ProcDump § Passwords within Group Policy Preferences Reconnaissance § Credentials stored in domain shares Lateral Movement § Credentials stored in user profiles:\n\n**Maintain Presence**\n\n###### – Documents, text files, etc.\n\n**Data Theft**\n\n**Ransomware**\n\n**Deployment**\n\n\n-----\n\n### Reconnaissance\n\n**Establish Foothold**\n\n#### § Similar tools to what we see in APT/FIN intrusions as Escalate Privileges\n\n##### well as Red Team engagements:\n\n**Reconnaissance**\n\n###### – Advanced IP Scanner\n\n – SoftPerfect Network Scanner\n\n**Lateral Movement**\n\n###### – Bloodhound\n – Built-in Windows commands Maintain Presence\n\n**Data Theft**\n\n**Ransomware**\n\n**Deployment**\n\n\n-----\n\n### Lateral Movement\n\n**Establish Foothold**\n\n#### § WMIExec Escalate Privileges § SMBExec § CrackMapExec Reconnaissance § PsExec Lateral Movement § RDP\n\n**Maintain Presence**\n\n**Data Theft**\n\n**Ransomware**\n\n**Deployment**\n\n\n-----\n\n### Maintain Presence\n\n**Establish Foothold**\n\n#### § Cloud remote desktop software Escalate Privileges § Cobalt Strike Beacon § Web shells Reconnaissance § VPN abuse Lateral Movement § On-premise virtual desktop appliances\n\n**Maintain Presence**\n\n**Data Theft**\n\n**Ransomware**\n\n**Deployment**\n\n\n-----\n\n### Data Theft\n\n**Establish Foothold**\n\n#### § Data compression tools Escalate Privileges § Cloud data synchronisation platforms\n\n**Reconnaissance**\n\n**Lateral Movement**\n\n**Maintain Presence**\n\n**Data Theft**\n\n**Ransomware**\n\n**Deployment**\n\n\n-----\n\n### Deploy Ransomware\n\n**Establish Foothold**\n\n#### § Disable antivirus across entire estate Escalate Privileges\n\n**Reconnaissance**\n\n**Lateral Movement**\n\n**Maintain Presence**\n\n**Data Theft**\n\n**Ransomware**\n\n**Deployment**\n\n\n-----\n\n### Deploy Ransomware\n\n**Establish Foothold**\n\n#### § Disable antivirus across targeted systems Escalate Privileges\n\n@echo off\nREM By Robbie Ferguson // baldnerd.com **Reconnaissance**\nREM Removes ESET Management Agent (previously named ESET Remote Administrator\nAgent) from Windows machines\nREM Intended for use as GPO, but could have other applications **Lateral Movement**\nREM PLEASE BE MINDFUL - This will remove your connection to your ESMC/ERA server.\nDepending on your policies, this could be a very bad thing.\nREM This program must be run as administrator\n\n**Maintain Presence**\n\nREM Version 1.01\n\nREM Tested successfully with:\n\n**Data Theft**\n\nREM - ESET Management Agent 7.0.553.0 EEE9596D-3139-4B63-B08B-3F17F0E345F0\n\necho \"Uninstalling ESET Management Agent...\" **Ransomware**\necho \"Trying version 6 and under...\" **Deployment**\nwmic product where name=\"ESET Remote Administrator Agent\" call uninstall /nointeractive\necho \"Trying version 7 and up...\"\n\n\n-----\n\n### Deploy Ransomware\n\n**Establish Foothold**\n\n#### § Deletion of: Escalate Privileges\n\n###### – File Backups\n\n**Reconnaissance**\n\n###### – Archives\n\n**Lateral Movement**\n\n###### – Virtual Machine snapshots\n\n**Maintain Presence**\n\n**Data Theft**\n\n**Ransomware**\n\n**Deployment**\n\n\n-----\n\n### Deploy Ransomware\n\n**Establish Foothold**\n\n#### § Creation of open SMB file shares hosting SODINOKIBI Escalate Privileges\n\n##### ransomware\n\n**Reconnaissance**\n\n#### § Deployment of Group Policy Objects to create\n\n##### scheduled tasks to download and execute the\n\n**Lateral Movement**\n\n##### SODINOKIBI ransomware\n#### § PsExec for mop-up\n\n**Maintain Presence**\n\n**Data Theft**\n\n**Ransomware**\n\n**Deployment**\n\n\n-----\n\n[+] Whats Happen? [+]\n\nYour files are encrypted, and currently unavailable. You can check it: all files\non your system has extension <8 unique chars>.\n\nBy the way, everything is possible to recover (restore), but you need to follow\nour instructions. Otherwise, you cant return your data (NEVER).\n\n[+] What guarantees? [+]\n\nIts just a business. We absolutely do not care about you and your deals, except\ngetting benefits. If we do not do our work and liabilities - nobody will not\ncooperate with us. Its not in our interests.\n\nTo check the ability of returning files, You should go to our website. There you\ncan decrypt one file for free. That is our guarantee.\n\nIf you will not cooperate with our service - for us, its does not matter. But you\nwill lose your time and data, cause just we have the private key. In practice -\ntime is much more valuable than money.\n\n\n-----\n\n-----\n\n##### Overview\n\nMaintain Presence Move Laterally\n\nAccess to\n\nRemote desktop\n\nadditional\n\nsoftware, VPN\n\nnetworks and\n\nabuse\n\ndomains\n\n**Complete the mission**\n\nIdentify Targets Initial Compromise Establish Foothold Escalate Privileges Internal Reconnaissance Data Theft Ransom Event\n\nPhishing, credential reuse,\n\nIdentify Exploitable Cobalt Strike, VPN abuse, Mimikatz, credentials in Network scanning, Installation of cloud-sync Scheduled task GPO deployment,\n\ncompromise of external\n\nVulnerabilities web shells domain shares Bloodhound software PsExec\n\ninfrastructure\n\n\n-----\n\n## QAKBOT and DOPPELPAYMER\n\n\n-----\n\n### Partnership Model\n\n#### § QAKBOT initially deployed as a banking trojan\n\n § In 2020, the partnership model is seen\n\n###### – Ransomware developers are provided access to\n a compromised environment with QAKBOT\n\n – Negotiations for payment are handled by the\n ransomware developers themselves\n\n\n-----\n\n**Partner** **Ransomware**\n**Organisation** **Developer**\n\nMaintain Presence Move Laterally\n\nQAKBOT, Cobalt PsExec, Remote\nStrike Desktop\n\nIdentify Targets Initial Compromise Establish Foothold Escalate Privileges Internal Reconnaissance Data Theft Ransom Event\n\nIdentify target Phishing QAKBOT, Cobalt Strike Mimikatz, Procdump Identify domains and networks QAKBOT email module DOPPELPAYMER\norganisations of interest\n\n\n-----\n\n### Initial Compromise\n\n#### § QAKBOT campaigns in early 2020 were seen\n\n##### utilising unsophisticated phishing campaigns\n\n###### <a href=\"https://<redacted>[.]<redacted>/direct/4345091.zip\"> ATTACHMENT DOCUMENT</a>\n\n\n-----\n\n### QAKBOT\n\n#### § QAKBOT is a modular backdoor which allows Email Staging\n\n##### an attacker to select the capabilities required and upload through the default configuration Cobalt Strike\n\nWeb Injects\n\n\n-----\n\n### Email Staging Module\n\n##### § The email module is a standalone binary, Email Staging\n\n###### independent from other QAKBOT modules\n\n##### § The module creates a directory for email staging,\n\n###### and utilises MAPI connections to a local outlook Cobalt Strike instance\n\n – %USERPROFILE%\\EmailStorage_<computer_name>-\n <username>_<timestamp>\n\nWeb Injects\n\n##### § Collected data is sent to a hard coded C2 with the\n\n###### data ZLIB compressed and base64 encoded\n\n\n-----\n\n### Cobalt Strike Module\n\n#### § QAKBOT can load Cobalt Strike in two ways Email Staging\n\n###### – Arbitrary Downloads\n\nCobalt Strike\n\n###### § The attackers can push the Cobalt Strike loader as\n a file and execute locally\n\n – Custom module\n\nWeb Injects\n\n###### § The Cobalt Strike module can be configured to\n load a pre-configured DLL which downloads and executes the Cobalt Strike payload\n\n\n-----\n\n### Web Inject Module\n\n##### § The module works by injecting the contents of the Email Staging\n\n###### below file into explorer.exe\n\n – <install_path>\\webinjects.cb\n##### § The module iterates through a list of pre-configured Cobalt Strike\n\n###### sites and injects JavaScript elements\n\n##### § Targeting appears related to Northern American\n\n###### organisations, as exampled below Web Injects\n\n\n-----\n\n### DOPPELPAYMER Four stage process\n\n##### from delivery of ransomware binary to\n § In early 2020, the following delivery mechanisms encryption of files\n\n###### were seen\n\n – Group Policies\n\n § Binaries placed in SYSVOL locations and deployed\n across the domain using scripts\n\n – PsExec\n\n – BITS Jobs\n\n – Scheduled Tasks\n\n\n-----\n\nusers and changes\n### Stage 1\npassword\n\n###### § The DOPPELPAYMER variant enumerates all users for the local\n system and changes the password\n\n § The password is generated with a pre-configured string and\n an MD5 hash of the computer name\n\n – Preconfigured string: TtXtE9n3\n\n – Computer name hash: 384DFCCEE8DB9F89ED2859E3F32F6AF5\n\n – Full password: TtXtE9n3&384DFCCEE8DB9F89ED2859E3F32F6AF5\n\n\n-----\n\nusers and changes\n### Stage 2\npassword\n\n###### § The ransomware copies a legitimate service and replaces\n the original with a copy of itself\n\n2. Registers the\nransomware as a\n\n###### – File: <random>.exe\n\nservice\n\n§ Path: %APPDATA%\\<random>.exe\n\n§ Note: Copy of DOPPELPAYMER binary\n\n###### – Service: <random_service>\n\n§ Path: %WINDIR%\\system32\\<random_service>.exe\n\n§ Note: Ransomware Service\n\n###### – Service: <random_service>-1\n\n§ Path: %WINDIR%\\system32\\<random_service>.exe-1\n\n§ Note: Backup of Service\n\n\n-----\n\nusers and changes\n### Stage 3\npassword\n\n###### § The Boot Configuration database is altered\n\n – recoveryenabled: no\n\n2. Registers the\nransomware as a\n\n§ Startup repair is disabled\n\nservice\n\n###### – safeboot: minimal\n\n§ Ransomware service is started in safeboot\n\n###### – Group policy configured to display a ransom message prior to login\n\n3. Changes Boot\nConfiguration\nDatabase\n\n\n-----\n\nusers and changes\n### Stage 4\npassword\n\n###### § After rebooting, the DOPPELPAYMER variant will begin\n encrypting files on the system.\n\n2. Registers the\n\n###### – <filename>.doppeled ransomware as a\n\nservice\n\n###### – <filename>.how2decrypt.txt\n\n3. Changes Boot\nConfiguration\nDatabase\n\n4. Reboots the\nsystem and\nencrypts files\n\n\n-----\n\n### Takeaway\n\n#### § Highly effective\n\n###### – QAKBOT has been around for a long time\n#### § High impact\n\n###### – DOPPELPAYMER removes access to systems\n#### § Highly active\n\n###### – As many as an organisation a day in periods of\n 2020\n\n\n-----\n\n# Conclusion\n\n\n-----\n\n### A Continuing Problem\n\n#### § Everything is increasing:\n\n###### – Payouts\n\n – Number of victims\n\n – Damage to organisations\n\n – Extortion for stolen data\n#### § With so much profit, so many victims, the only trend is\n\n##### upwards\n#### § Ransomware is now a boardroom risk\n\n\n-----\n\n### Improvements to Tradecraft\n\n#### § More stealth, less noise\n\n###### – Ransomware engagements are fast, but they’re loud\n#### § Tooling improvements\n\n###### – Less reliance on standard penetration testing tools\n\n – More bespoke malware\n#### § Faster to domain admin § Improved ransomware deployment methods § Increased effectiveness to delete backups\n\n\n-----\n\n### What’s Next?\n\n#### § Continued focus on mass exploitation of edge-\n\n##### devices\n#### § Limiting factors for the attackers:\n\n###### – Too many victims\n\n – Not enough operators\n#### § No downwards pressure until law enforcement\n\n##### intervention\n\n###### – The best organisations can do is to:\n\n § improve security\n\n § improve resilience\n\n\n-----\n\n# Thank you\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://i.blackhat.com/eu-20/Wednesday/eu-20-Clarke-Its-Not-FINished-The-Evolving-Maturity-In-Ransomware-Operations.pdf"
    ],
    "report_names": [
        "eu-20-Clarke-Its-Not-FINished-The-Evolving-Maturity-In-Ransomware-Operations.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716490,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1606766698,
    "ts_modification_date": 1606766698,
    "files": {
        "pdf": "https://archive.orkl.eu/d164d5bea0819c3f3354926187edaca7806a850f.pdf",
        "text": "https://archive.orkl.eu/d164d5bea0819c3f3354926187edaca7806a850f.txt",
        "img": "https://archive.orkl.eu/d164d5bea0819c3f3354926187edaca7806a850f.jpg"
    }
}