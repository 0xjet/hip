{
    "id": "57de0f5b-42d5-42db-aad4-b1cb0d75e2fb",
    "created_at": "2023-04-05T02:08:26.262757Z",
    "updated_at": "2025-03-27T02:16:01.16955Z",
    "deleted_at": null,
    "sha1_hash": "5e5d56a00e4af1cf99539fb4ceb36cbc963b48ff",
    "title": "2015-04-21 - Bedep’s DGA- Trading Foreign Exchange for Malware Domains",
    "authors": "",
    "file_creation_date": "2023-04-03T08:50:21Z",
    "file_modification_date": "2023-04-03T08:50:21Z",
    "file_size": 387858,
    "plain_text": "# Bedep’s DGA: Trading Foreign Exchange for Malware Domains\n\n**web.archive.org/web/20150524032716/http://asert.arbornetworks.com/bedeps-dga-trading-foreign-exchange-for-**\nmalware-domains/\n\nDennis Schwarz April 21, 2015\n\nAs initially researched by Trend Micro [[1]](https://web.archive.org/web/20150524032716/http://sjc1-te-ftp.trendmicro.com/assets/wp/technical-brief-bedep.pdf) [[2], Zscaler](https://web.archive.org/web/20150524032716/http://blog.trendmicro.com/trendlabs-security-intelligence/bedep-malware-tied-to-adobe-zero-days/) [[1]](https://web.archive.org/web/20150524032716/http://research.zscaler.com/2015/01/malvertising-leading-to-flash-zero-day.html) [[2],](https://web.archive.org/web/20150524032716/http://research.zscaler.com/2015/02/ongoing-angler-exploit-kit-and-bedep.html) [Cyphort, and](https://web.archive.org/web/20150524032716/http://www.cyphort.com/affyield-com-serving-zero-day-flash/) Malware don’t\nneed Coffee, the Bedep malware family focuses on ad / click fraud and the downloading of\nadditional malware. ASERT’s first sample dates from September 22, 2014, which is in line\nwith when Trend Micro started seeing it in their telemetry. In early 2015, the family got some\nmore attention when it was being observed as the malware payload for some instances of\nthe Angler exploit kit, leveraging the Adobe Flash Player exploit (CVE-2015-0311) which at\nthe time was a 0day. It was also observed that this newer version was using a\ndomain generation algorithm (DGA) to generate its command and control (C2) domain\nnames.\n\nThis post provides some additional notes on the DGA including a proof of concept Python\nimplementation, a look at the two most recent sets of DGA generated domains, and\nconcludes with some sinkhole data.\n\n**Samples**\n\nThe following Bedep samples were used for this research:\n\nMD5 e5e72baff4fab6ea6a1fcac467dc4351\nMD5 1b84a502034f7422e40944b1a3d71f29\n\n[The former was originally sourced from KernelMode.](https://web.archive.org/web/20150524032716/http://www.kernelmode.info/forum/viewtopic.php?f=16&t=3510&p=24795&hilit=bedep#p24795)\n\n**Algorithm**\n\nI’ve posted a proof of concept (read: works for me) Python implementation of the DGA to\n[ASERT’s Github.](https://web.archive.org/web/20150524032716/https://github.com/arbor/bedep_dga)\n\nAt the time of writing, I’m aware of two DGA configs. Each config contains three constants\nand a table of magical dwords used throughout the algorithm. The screenshot below\nhighlights the table from the first sample:\n\n\n-----\n\nBedep’s DGA starts by downloading an XML file from:\n\nhttp://www.earthtools.org/timezone/0/0\n\nThis legitimate web service provides the time zone and local time at latitude zero and\nlongitude zero. The <utctime> timestamp is parsed out and converted to milliseconds since\nyear zero (0000-00-00). Then, 1-3 days are subtracted from it (depending on tick count\ntiming–this feels like an anti-analysis technique) and it is converted to days since year zero.\nThis value will be used in the next step.\n\nNext, Bedep downloads an XML file from:\n\nhttp://www.ecb.europa.eu/stats/eurofxref/eurofxref-hist-90d.xml\n\nThis legitimate file from the European Central Bank (ECB) contains the last 90 days of “Euro\nforeign exchange reference rates” and is updated daily. Each date is extracted from the\n<Cube time=”…”> tags then the days since year zero is calculated for “date minus one”. If\nthe days since value is less than or equal to the value calculated in the first step AND if it\nfalls on a Monday, then the foreign exchange reference rates for “date” are extracted and\nused. Here’s a visual showing this process:\n\n\n-----\n\nAfter testing, my analysis reveals that Bedep updates using “last Tuesday’s” foreign\nexchange reference rates—where “last Tuesday” refers to “the preceding week’s Tuesday”\nuntil “this week’s Thursday”. After this, it means “this week’s Tuesday.”\n\nFrom here, the algorithm becomes a bit opaque. Various values such as “days since,” the\nfirst parsed currency’s abbreviation, the low dword of the first parsed currency’s rate, the\nmagical dword values from the extracted table (noted above), and various other constant and\ncalculated values are transformed a number of times. I wasn’t able to deduce the “big\npicture” of these transforms, so I’m treating them as a blackbox where the output is the\nnumber of domains to generate and three values that that will be used to calculate a modular\nexponent starting seed. If anyone has more details on this blackbox, please reach out!\n\nThe number of domains to generate is 22 for the first config and 28 for the second for a total\nof 50 domains per set. To generate each domain, the starting seed and foreign exchange\nreference rates are transformed a number of times to calculate the domain length and the\ndomain characters themselves:\n\n\n-----\n\nThe minimum domain length is 12 and the maximum is 18. I’ve only seen “.com” TLDs so far.\n\n**Campaign**\n\nAt the time of writing and using the foreign exchange rates from 2015-04-07, here are the\neight registered domains from this set:\n\nagabovyxdgcbibu.com\nrbnfimetzgg9v.com\nwpqkvmpezecumbvl7.com\nvtvykahskh9m.com\nrpmrkmqyxplqitnyd.com\nakgsuqlnipxhwf.com\npdbfeobggolhbgbn.com\nnimyusfhqwizzgb.com\n\nThe first two were registered on 2015-04-13, the next two on 2015-04-11, then 2015-04-10,\nand the last two on 2015-04-08. All of them used the following registrant info:\n\n\n-----\n\nThis info is inline with what Zscaler observed.\n\nUsing the foreign exchange rates from 2015-04-14, here are the domains registered out of\nthe set, so far:\n\nprlvlpdeiopx.com (5.196.181.244)\ntqadnvxgppn1.com (5.196.181.244)\ngllmrtvteldx.com\nuydsqobdcmcxpdxng.com\nowwiloxvthttt1.com\ngcrnbgjlsgchu.com\n\nThe first two were registered on 2015-04-19, then 2015-04-17, and the last two on 2015-0415. All six used the same registrant noted above.\n\n**Sinkhole**\n\nTo get a better idea of how active and widespread the above campaign is, we setup a\nsinkhole. The sinkhole was vmznlwrgtcnasmfhz.com and from 2015-04-13 13:47 UTC to\n2015-04-16 17:06 UTC (about 3 days) it received phone homes from about 82,127 unique\nsource IPs. The top 10 TLDs of the resolved source IPs were:\n\n1. net (31578)\n2. com (11952)\n3. de (3193)\n4. mx (2611)\n5. tr (2104)\n6. it (1521)\n7. pl (1500)\n8. fr (1440)\n9. br (1360)\n10. au (1247)\n\n11. ca (1107)\n12. jp (1054)\n13. es (769)\n\nAnd, except for Russia, infections were all over the map:\n\n\n-----\n\n**Conclusion**\n\nThis post has taken a closer look at Bedep’s DGA and the recent campaign around it.\nCompared to some of the other date based DGAs we’ve looked at in the past, this algorithm\nis quite a bit more complicated and involved—effectively relying on the foreign exchange\nmarkets to generate its C2 domains. Based on the domain registration and sinkhole activity,\nBedep is a current and active threat and will likely remain so for the foreseeable future.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-04-21 - Bedep’s DGA- Trading Foreign Exchange for Malware Domains.pdf"
    ],
    "report_names": [
        "2015-04-21 - Bedep’s DGA- Trading Foreign Exchange for Malware Domains.pdf"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1680660506,
    "ts_updated_at": 1743041761,
    "ts_creation_date": 1680511821,
    "ts_modification_date": 1680511821,
    "files": {
        "pdf": "https://archive.orkl.eu/5e5d56a00e4af1cf99539fb4ceb36cbc963b48ff.pdf",
        "text": "https://archive.orkl.eu/5e5d56a00e4af1cf99539fb4ceb36cbc963b48ff.txt",
        "img": "https://archive.orkl.eu/5e5d56a00e4af1cf99539fb4ceb36cbc963b48ff.jpg"
    }
}