{
    "id": "a253b8f2-35e7-45fc-a456-8cf63d18af0a",
    "created_at": "2023-01-12T15:08:08.6053Z",
    "updated_at": "2025-03-27T02:15:35.598632Z",
    "deleted_at": null,
    "sha1_hash": "0e867debe6c40230f9d59e35a7b0736f3077ed25",
    "title": "2013-08-27 - Linux Trojan “Hand of Thief” ungloved",
    "authors": "",
    "file_creation_date": "2022-05-28T04:00:00Z",
    "file_modification_date": "2022-05-28T04:00:00Z",
    "file_size": 214056,
    "plain_text": "# Linux Trojan “Hand of Thief” ungloved\n\n**[blog.avast.com/2013/08/27/linux-trojan-hand-of-thief-ungloved/](https://blog.avast.com/2013/08/27/linux-trojan-hand-of-thief-ungloved/)**\n\n[Threat Intelligence Team 27 Aug 2013](https://blog.avast.com/author/threat-intelligence-team)\n\nLinux Trojan “Hand of Thief” ungloved\n\n[A new threat for the Linux platform was first mentioned on August 7th by RSA researchers,](http://blogs.rsa.com/thieves-reaching-for-linux-hand-of-thief-trojan-targets-linux-inth3wild/)\nwhere it was dubbed Hand of Thief. The two main capabilities of this Trojan are formgrabbing of Linux-specific browsers and entering a victim's computer by a back-door.\nMoreover, it is empowered with features like anti-virtualization and anti-monitoring. With the\nlevel of overall sophistication Hand of Thief displays, it can be compared to infamous nonWindows threats such as the FlashBack Trojan for MacOsX platform discovered last year or\n[Trojan Obad for Android from recent times.](https://blog.avast.com/2013/06/17/androidobad-malware-gets-smarter-so-does-avast)\n\nA detailed analysis uncovers the following structure of the initial file with all parts after the\ndropper being encrypted (hexadecimal number displays starting offset of a block):\n\nRunning the program on a native Linux system with parameter \"-v\" displays the version info\n\"0.1.0.7\".\n\n**Dropper and Self-Protection**\n\nThe dropper is obfuscated with the UPX packer so the executable is not available for a static\n[analysis. We make it so by applying the original UPX program with parameter -d on a sole](http://upx.sourceforge.net/)\ndropper part of the initial binary. The readability of almost all character strings is hardened by\na XOR encryption with a varying 8-bit key. This is a very common property shared both\namong Windows and non-Windows Trojans\n\n\n-----\n\nImmediately after start, the Trojan checks if it does not run in a virtualized environment.\nRealization of this aim depends on virtualization software: To search for a substring \"VBOX\"\nand \"VMware\" in the listed SCSI devices (to suppress this check it is enough to unset read\nprivileges on the file /proc/scsi/scsi ); to look for a substring \"UML\",\"PowerVM Lx86\",\n\"QEMU\" or \"IBM/S390\" in /proc/cpuinfo file; to check an access to /proc/vz or /proc/bc which\nexist if OpenVZ kernel is running:\n\nThe presence of any of these signs leads to an early end of execution. The Trojan also exits\nif the root directory is [chrooted by comparing particular lines in /proc/1/mountinfo and /proc/\\](http://en.wikipedia.org/wiki/Chroot)\n_<getpid()>/mountinfo. Chrooting is basically a security feature where a running process does_\nnot have access to the root directory but to another branch of a file system tree that acts as\none.\n\nThen it decrypts the config file appended at the end of the binary (starting on the offset\n0x24244 with the length of 0x1E0) and it initializes its global variables with entries from the\nconfig file (values are resolved using regcomp, regexec and regfree command). We analyzed\na sample with the following one (a private IP serving for C&C whispers that this bot is in\ndebug process and not in the wild):\n\n\n-----\n\nTo achieve persistence after reboot, the Trojan is suspected to create a configuration file\ncalled system-firewall.desktop within the path ~/.config/autostart containing the following\nsetting (%s is appropriately changed):\n\n[Desktop Entry]\nEncoding=UTF-8\nType=Application\nExec=%s\nTerminal=false\nName=System Firewall\nStartupNotify=false\n\nThe step that follows is the installation of modules containing the main functionality into the\n_/tmp/ directory and changing access permissions with a command chroot with parameter -x._\nThe procedure consists of mapping the binary into the memory and copying a relevant part\n[to a buffer that is decrypted by AES with a 256bit key. For the executable of a length 24848 it](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard)\nis performed like this (the marked values denote the target file name, the starting offset in the\nbinary and the access permission):\n\n\n-----\n\nThe shared object is injected in every process whose name does not contain substring\n_gnome-session, dbus or pulseaudio. The injection is performed with a method similar to the_\n[one described on Blackhat 2001 by Shaun Clowes. The reimplementation is available on](http://www.blackhat.com/html/bh-europe-01/bh-europe-01-speakers.html#Shaun)\ngithub.\n\n**Core Functionality**\n\nThe shared object starts two threads. The first one is called aaa, and it listens to a command\nfrom C&C to execute an action: bc command triggers BackConnect daemon called p0stfix\nserves as a reverse shell with a victim connecting to a particular socket; bind command\nstarts BindPort daemon called unix-daemon acting as a bind shell with an attacker receiving\nthe content of an output of a shell (after the correct authentication); socks executes a proxy\nvia custom implementation of SOCKS5 protocol. All these features are realized through\nembedded perl scripts. Another commands with names d_exec and update, and they would\ntry an execution of newly downloaded files from a C&C server.\n\nThe second thread is denoted bbb. It performs the injection of the shared object starting on\nthe offset 0x19CF4 into running browsers mapping space by the same method mentioned\nabove. This serves as an initialization of the form-grabbing feature. Supported browsers are\nChromium, Chrome and Firefox. The intervention of data submits of the Firefox browser is\nrealized as the redirection of program flow of original libnspr40.so!PR_Write function to a\ncustom implementation hPR_Write_ptr of Trojan:\n\n\n-----\n\nIntercepted data, statistics of bots execution, and command from C&C are all interpreted via\na custom communication protocol based on AES encryption with 256bits keys combined with\nBase64 encoding:\n\nMoreover, we observed an anti-monitoring check (no communication if wireshark or tcpdump\nis running):\n\n\n-----\n\nFinally, the exported function drow_image displays an about info in a form of nice ASCII art\nthat confirms the creativity of the author (an owl sitting on a tree can be recognized):\n\n**Conclusion**\n\nThe Linux operating system is designed to have high level of security. However, this year a\nfew attempts to attack Web servers by backdoors redirecting traffic or malicious apache\nmodules have been discovered. The aim of this Trojan is to compromise user desktop\nsystems. With features designed to abuse sensitive browser information, it could advance\nLinux users a step forward in this specific environment. The same threatening environment in\nwhich Windows users have existed for years. The statement that the Linux platform is\nabsolutely secure now seems even more illusive.\n\n**Sources**\n\nSHA256 hashes of some selected samples:\n\n\n-----\n\nHand of Thief\nInitial Binary\n\nHand of Thief\nShared Object\n\nHand of Thief\nBackdoor\nExecutable\n\nHand of Thief\nFormgrabber\n\nHand of Thief\nBackConnect\nScript\n\n**Acknowledgements**\n\n\nBD92CE74844B1DDFDD1B61EAC86ABE7140D38E\nEDF9C1B06FB7FBF446F6830391\n\n2ACF2BC72A2095A29BB4C02E3CD95D12E3B4F5\n9D2E7391D9BCBBA9F3142B40AE\n\n753DC7CD036BDBAC772A90FB3478B3CCF22BEC\n70EE4BD2F55DEC2041E9482017\n\nB794CE9E7291FE822B0E1F1804BD5A9A2EFC30\n4A1E2870699C60EF5083C7BAC2\n\n4B0CC15B24E38EC14E6D044583992626DD8C72\nA4255B9614BE46B1B4EEFA41D7\n\n\nELF:HanthieB [Trj]\n\nELF:HanthieA [Trj]\n\nELF:HanthieC [Trj]\n\nELF:HanthieD [Trj]\n\nPerl:HanthieA [Trj]\n\n\nThanks goes to my colleague, Pavel Šrámek, for discussions about the Linux platform.\n\n[Add your comments here, or read what others have to say on the AVAST Facebook page.](http://www.facebook.com/avast)\n\n[Post by](http://www.facebook.com/avast/posts/10151628914517426:0) [avast! antivirus.](http://www.facebook.com/avast)\n_Thank you for using avast! Antivirus and recommending us to your friends and family. For all_\n_[the latest news, fun, and contest information, please follow us on Facebook,](http://www.facebook.com/avast)_ _[Twitter,](http://twitter.com/avast_antivirus)_ _[Google+](http://plus.google.com/+avast/posts)_\n_[and Instagram.](http://instagram.com/avast_antivirus)_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2013/2013-08-27 - Linux Trojan “Hand of Thief” ungloved.pdf"
    ],
    "report_names": [
        "2013-08-27 - Linux Trojan “Hand of Thief” ungloved.pdf"
    ],
    "threat_actors": [
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46b3c0fc-fa0c-4d63-a38a-b33a524561fb",
            "created_at": "2023-01-06T13:46:38.393409Z",
            "updated_at": "2025-03-27T02:00:02.822155Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "The Dukes",
                "Minidionis",
                "Grizzly Steppe",
                "G0016",
                "Blue Kitsune",
                "BlueBravo",
                "SeaDuke",
                "Cloaked Ursa",
                "YTTRIUM",
                "ATK7",
                "Nobelium",
                "UAC-0029",
                "Group 100",
                "COZY BEAR",
                "IRON HEMLOCK",
                "TA421",
                "ITG11"
            ],
            "source_name": "MISPGALAXY:APT29",
            "tools": [
                "QUARTERRIG",
                "SNOWYAMBER",
                "HALFRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536088,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1653710400,
    "ts_modification_date": 1653710400,
    "files": {
        "pdf": "https://archive.orkl.eu/0e867debe6c40230f9d59e35a7b0736f3077ed25.pdf",
        "text": "https://archive.orkl.eu/0e867debe6c40230f9d59e35a7b0736f3077ed25.txt",
        "img": "https://archive.orkl.eu/0e867debe6c40230f9d59e35a7b0736f3077ed25.jpg"
    }
}