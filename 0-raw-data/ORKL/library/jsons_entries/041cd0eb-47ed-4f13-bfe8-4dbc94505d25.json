{
    "id": "041cd0eb-47ed-4f13-bfe8-4dbc94505d25",
    "created_at": "2023-01-12T15:00:29.480038Z",
    "updated_at": "2025-03-27T02:16:37.119537Z",
    "deleted_at": null,
    "sha1_hash": "3ff01e26c10fcbb6bb260efed847a8882068b42f",
    "title": "2018-01-24 - New Hide ‘N Seek IoT Botnet using custom-built Peer-to-Peer communication spotted in the wild",
    "authors": "",
    "file_creation_date": "2022-05-27T21:47:53Z",
    "file_modification_date": "2022-05-27T21:47:53Z",
    "file_size": 183784,
    "plain_text": "# New Hide 'N Seek IoT Botnet using custom-built Peer-to- Peer communication spotted in the wild\n\n**labs.bitdefender.com/2018/01/new-hide-n-seek-iot-botnet-using-custom-built-peer-to-peer-communication-spotted-in-**\nthe-wild/\n\n[Anti-Malware Research](http://10.10.0.46/blog/labs/tag/antimalware-research/)\n\n6 min read\n\n[Bogdan BOTEZATU](http://10.10.0.46/blog/labs/author/bbotezatu/)\nJanuary 24, 2018\n\nOne product to protect all your devices, without slowing them down.\n\n[Free 90-day trial](http://10.10.0.46/media/html/consumer/new/get-your-90-day-trial-opt/index.html)\n\n\n-----\n\nBitdefender researchers have uncovered an emerging botnet that uses advanced\ncommunication techniques to exploit victims and build its infrastructure. The bot, dubbed\nHNS, was intercepted by our IoT honeypot system following a credentials dictionary attack\non the Telnet service.\n\nThe bot was first spotted on Jan. 10 then faded away in the following days, only to reemerge on Jan. 20 in a significantly improved form.\n\n**Update 26/01/2018 – 14.06 GMT+3**\n\nThe botnet now controls 32,312 IoT devices. Also, the botnet seems to undergo massive\ndevelopment as new samples compiled for a variety of architectures have been added as\npayloads:\n\n_0c90ea12275cadd96a67f8ee07e2fa04af91e51e: ELF 32-bit LSB executable, Intel 80386,_\nversion 1 (SYSV), statically linked, stripped\n\n_19f54473a721105982281b7b87503e3d60585042: ELF 32-bit MSB executable, MIPS,_\nMIPS-I version 1 (SYSV), statically linked, stripped\n_2b36305f7dcb63b4f55bffab0f0dbbaaabf83b28: ELF 32-bit MSB executable, Motorola_\n68020 – invalid byte order, version 1 (SYSV), statically linked, stripped\n\n_4dcca2094b55b6576c1b27597e4b10db9b6bfa53: ELF 32-bit MSB executable, SPARC_\nversion 1 (SYSV), statically linked, stripped\n\n_6e5a74d0e39f7e17effb54270c41910b99f7e873: ELF 32-bit LSB executable, MIPS, MIPS-I_\nversion 1 (SYSV), statically linked, stripped\n\n\n-----\n\n_788f52df7aeae720c90fe21eeb946409dcd2fed7: ELF 32-bit LSB executable, ARM, version_\n1, statically linked, stripped\n_a82c3cd904315131845d56101b7af8cc2b1eee7b: ELF 32-bit LSB executable, ARM,_\nversion 1, statically linked, stripped\n_b7ccfbbcb3a29de4ae507415ddca93029d90923d: ELF 32-bit MSB executable, PowerPC or_\ncisco 4500, version 1 (SYSV), statically linked, stripped\n_ed24e8f5eb277e8b58fb39c15ece3d60af418459: ELF 32-bit LSB executable, Renesas SH,_\nversion 1 (SYSV), statically linked, stripped\n_f7631f2bc30bb5a570bafa966c2f0d5fb7960e94: ELF 64-bit LSB executable, x86-64, version_\n1 (SYSV), statically linked, stripped\n\n**Update 01/25/2018 – 11.50 GMT+3**\n\nHide ‘N Seek currently counts more than 24,000 bots.\n\n**Update 01/24/2018 – 20.00 GMT+3**\n\nThe botnet now counts more than 20,000 IoT devices geographically distributed as per the\ngraphic below.\n\n**Update 01/24/2018 – 17.30 GMT+3**\n\n18,000 compromised devices and counting.\n\n**Update 01/24/2018 – 14.00 GMT+3**\n\nThe botnet now counts more than 14K devices geographically distributed as per the\nheatmap below. What initially started as a 12-device network has become a phenomenon\nthat spreads from Asia to the United States.\n\n**Impact**\n\nThe HNS botnet communicates in a complex and decentralized manner and uses multiple\nanti-tampering techniques to prevent a third party from hijacking/poisoning it. The bot can\nperform web exploitation against a series of devices via the same exploit as Reaper (CVE2016-10401 and other vulnerabilities against networking equipment).\n\nThe bot embeds a plurality of commands such as data exfiltration, code execution and\ninterference with a device’s operation.\n\n**Operation**\n\nThe bot features a worm-like spreading mechanism that randomly generates a list of IP\naddresses to get potential targets. It then initiates a raw socket SYN connection to each\nhost in the list and continues communication with those that answer the request on specific\ndestination ports (23 2323, 80, 8080). Once the connection has been established, the bot\n\n\n-----\n\nlooks for a specific banner ( buildroot login: ) presented by the victim. If it gets this login\nbanner, it attempts to log in with a set of predefined credentials. If that fails, the botnet\nattempts a dictionary attack using a hardcoded list.\n\nOnce a session is established with a new victim, the sample will run through a “state\nmachine” to properly identify the target device and select the most suitable compromise\nmethod. For example, if the victim has the same LAN as the bot, the bot sets up TFTP\nserver to allow the victim to download the sample from the bot. If the victim is located on the\ninternet, the bot will attempt a specific remote payload delivery method to get the victim to\ndownload and run the malware sample. These exploitation techniques are preconfigured\nand are located in a memory location that is digitally signed to prevent tampering. This list\ncan be updated remotely and propagated among infected hosts.\n\nThe samples identified in our honeypots on Jan. 10 revolved around IP cameras\nmanufactured by a Korean company. These devices seemed to play a major role in the\nbotnet as, out of the 12 IP addresses hardcoded in the sample, 10 used to belong to Focus\nH&S devices. The new version, observed on Jan. 20, dropped the hardcoded IPs.\n\nLike other IoT bots, the newly discovered HNS bot cannot achieve persistence, and a\nreboot would bring the compromised device back to its clean state. It is the second known\nIoT botnet to date, after the notorious Hajime botnet, that has a decentralized, peer-to-peer\narchitecture. However, if in the case of Hajime, the p2p functionality was based on the\nBitTorrent protocol, here we have a custom-built p2p communication mechanism.\n\n**UDP communication mechanism**\n\nThe bot opens a random port on the victim, and adds firewall rules to allow inbound traffic\nfor the port. It then listens for connections on the open port and only accepts the specific\ncommands described below. Our initial look at the sample revealed an elliptic curve key\ninside the file that is used to authenticate the command which updates the memory zone\nwhere configuration settings are stored, to prevent infiltration or poisoning attempts against\nthe botnet.\nThe botnet binary can have the following arguments at runtime:\n\n**‘k’ + [some_port_number] – Kills all processes running on the specified port at startup.**\n\n**‘l’ + [some_port_number] – Listens on the specified port number after startup**\n\n**‘s’ + path – Reads files starting from the path and loads them into memory. Then, the**\ncontent can be retrieved by other peers via the ‘m’, ‘y’ and ‘Y’ commands. There’s also a\nsha256-checksums for each file that gets created. As a side effect, this will keep the\nmalicious binary on the system.\n\n**‘a’ + [IP:PORT] – Adds IP:PORT to the list of internally stored IP:PORT**\n\n\n-----\n\n**e + IP:PORT – Adds a new target to the otherwise randomly generated target list.**\n\n**Supported commands**\n\nTo understand the capabilities of the bot, we looked into the messages received from other\npeers. Below is a list of the supported commands, along with a description of the expected\nresults:\n\n**‘i’ + u32(config_size) – If the config_size received is larger than the size of the current**\nconfiguration, an acknowledgement message is sent back to the peer. The peer is\neventually set as a communication endpoint to get the larger config. If the dht_size is\nsmaller, an ‘I’ message is sent back to the peer advertising the larger config.\n\n**‘I’ + u32(config_size) – The config_size received should be larger than the size of the**\ncurrent config (following an ‘i’ message query). An acknowledgement message is sent back\nand eventually the peer is set as a communication endpoint to get the larger config.\n\n**‘m’ + u8[32](hash) + u32(ip) + u16(port) + u16(seq) + u8(hops) + u8(unk) – This**\nmessage attempts to find data based on the hash given. It first checks locally if the hash is\nknown and data is available. If data is available, it starts sending it to ip:port via a ‘Y’\nmessage. If data is not locally available, the bot broadcasts the current ‘m’ message (with\nhops decremented, but not more than 5 hops) to all its known peers.\n\n**‘^’ + u8(flags) + u16(port) + u32(ip) – Signals a new peer at ip:port. The new peer gets**\nadded to the list of known peers (it can also replace a peer if too many are present).\n\n**‘~’ – Requests a new peer. Upon receiving this, a random peer is selected from the list of**\nknown peers and sent via a ‘^’ message\n\n**‘Y’ + u16(chunk_index) + u16(seq) + u8[](data) – This is the data received message. The**\ndata is copied in chunks of at most 0x100 bytes (i.e. the current offset is chunk_index *\n0x100). The chunk_index is the current offset being read from and it should correspond to\nthe current size of a communicated buffer.\n\nThere are multiple possible outcomes once the file is downloaded:\n\nIf the data is a new config, it gets verified (via ECDSA – the elliptic curve key\nmentioned above) and, if OK, it will replace the current config”\nThe file can get dropped and executed (i.e. an update mechanism)\n\n**‘y’ + u8[32](hash) + u16(chunk_index) + u16(seq) – This command attempts to read from**\nchunk_index the data corresponding to the cache via a ‘Y’ message. If, for whatever\nreason, the data is not available locally, an ‘m’ message gets broadcast.\n\n**‘O’ + u8(checksum) – This is an acknowledgement message. The checksum is done on**\nthe received message.\n\n\n-----\n\n**i, I (first version) h, H (second version) – Commands for configuration updates**\n\n**‘m’,’Y’,’y’ Data exfiltration mechanism (“m” communicates a hash, while “Y” and “y” move**\ndata around)\n\n**“z” scanning component (sends to a peer valid credentials that have been found via**\ndictionary attack)\n\n**“O” ack on “z” credentials received OK (however, the same ack can be sent in several**\nother occasions)\n\n**“^” add a new peer to the list of known peers**\n\n**“~” send a peer IP as a response (when queried for a peer IP)**\n\n**Conclusions**\n\nWhile IoT botnets have been around for years, mainly used for DDoS attacks, the\ndiscoveries made during the investigation of the Hide and Seek bot reveal greater levels of\ncomplexity and novel capabilities such as information theft – potentially suitable for\nespionage or extortion.\n\nIt is also worth noting that the botnet is undergoing constant redesign and rapid expansion.\n\n**Known hashes**\n\n_efcd7a5fe59ca8223cd282bfe501a2f92b18312c_\n_05674f779ebf9dc6b0176d40ff198e94f0b21ff9_\n\n**TAGS**\n\n[anti-malware research](http://10.10.0.46/blog/labs/tag/antimalware-research/)\n\n**AUTHOR**\n\n## Bogdan BOTEZATU\n\nInformation security professional. Living my second childhood at @Bitdefender as director\nof threat research\n\n\n-----\n\n[View all posts](http://10.10.0.46/blog/labs/author/bbotezatu/)\n\n\n[View all posts](http://10.10.0.46/blog/labs/author/bbotezatu/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-01-24 - New Hide ‘N Seek IoT Botnet using custom-built Peer-to-Peer communication spotted in the wild.pdf"
    ],
    "report_names": [
        "2018-01-24 - New Hide ‘N Seek IoT Botnet using custom-built Peer-to-Peer communication spotted in the wild.pdf"
    ],
    "threat_actors": [
        {
            "id": "f0bccc3d-ad77-49c4-8dfd-8a8a8d6fba26",
            "created_at": "2024-05-01T02:03:08.134022Z",
            "updated_at": "2025-03-27T02:05:17.415028Z",
            "deleted_at": null,
            "main_name": "NICKEL FOXCROFT",
            "aliases": [
                "Group 123 ",
                "Moldy Pisces ",
                "RICOCHET CHOLLIMA ",
                "Reaper ",
                "ScarCruft ",
                "APT37 "
            ],
            "source_name": "Secureworks:NICKEL FOXCROFT",
            "tools": [
                "ROKRAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "9b02c527-5077-489e-9a80-5d88947fddab",
            "created_at": "2022-10-25T16:07:24.103499Z",
            "updated_at": "2025-03-27T02:02:10.108504Z",
            "deleted_at": null,
            "main_name": "Reaper",
            "aliases": [
                "APT 37",
                "ATK 4",
                "Cerium",
                "Crooked Pisces",
                "Geumseong121",
                "Group 123",
                "ITG10",
                "InkySquid",
                "Moldy Pisces",
                "Opal Sleet",
                "Operation Are You Happy?",
                "Operation Battle Cruiser",
                "Operation Black Banner",
                "Operation Daybreak",
                "Operation Dragon messenger",
                "Operation Erebus",
                "Operation Evil New Year",
                "Operation Evil New Year 2018",
                "Operation Fractured Block",
                "Operation Fractured Statue",
                "Operation FreeMilk",
                "Operation Golden Bird",
                "Operation Golden Time",
                "Operation High Expert",
                "Operation Holiday Wiper",
                "Operation Korean Sword",
                "Operation North Korean Human Right",
                "Operation Onezero",
                "Operation Rocket Man",
                "Operation SHROUDED#SLEEP",
                "Operation STARK#MULE",
                "Operation STIFF#BIZON",
                "Operation Spy Cloud",
                "Operation Star Cruiser",
                "Osmium",
                "Red Eyes",
                "Ricochet Chollima",
                "Ruby Sleet",
                "ScarCruft",
                "TA-RedAnt",
                "TEMP.Reaper",
                "Venus 121"
            ],
            "source_name": "ETDA:Reaper",
            "tools": [
                "Agentemis",
                "BLUELIGHT",
                "Backdoor.APT.POORAIM",
                "CARROTBALL",
                "CARROTBAT",
                "CORALDECK",
                "Cobalt Strike",
                "CobaltStrike",
                "DOGCALL",
                "Erebus",
                "Exploit.APT.RICECURRY",
                "Final1stSpy",
                "Freenki Loader",
                "GELCAPSULE",
                "GOLDBACKDOOR",
                "GreezeBackdoor",
                "HAPPYWORK",
                "JinhoSpy",
                "KARAE",
                "KevDroid",
                "Konni",
                "MILKDROP",
                "N1stAgent",
                "NavRAT",
                "Nokki",
                "Oceansalt",
                "POORAIM",
                "PoohMilk",
                "PoohMilk Loader",
                "RICECURRY",
                "RUHAPPY",
                "RokRAT",
                "SHUTTERSPEED",
                "SLOWDRIFT",
                "SOUNDWAVE",
                "SYSCON",
                "Sanny",
                "ScarCruft",
                "StarCruft",
                "Syscon",
                "VeilShell",
                "WINERACK",
                "ZUMKONG",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535629,
    "ts_updated_at": 1743041797,
    "ts_creation_date": 1653688073,
    "ts_modification_date": 1653688073,
    "files": {
        "pdf": "https://archive.orkl.eu/3ff01e26c10fcbb6bb260efed847a8882068b42f.pdf",
        "text": "https://archive.orkl.eu/3ff01e26c10fcbb6bb260efed847a8882068b42f.txt",
        "img": "https://archive.orkl.eu/3ff01e26c10fcbb6bb260efed847a8882068b42f.jpg"
    }
}