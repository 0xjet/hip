{
    "id": "01b8d70a-f4c1-45f7-a74a-78d01dcecd0d",
    "created_at": "2023-01-12T14:59:02.852131Z",
    "updated_at": "2025-03-27T02:05:39.260618Z",
    "deleted_at": null,
    "sha1_hash": "15326bcfa9bfba170fc7903ecbb0f2667482958b",
    "title": "2021-06-08 - UAL Thank Us Later- Leveraging User Access Logging for Forensic Investigations",
    "authors": "",
    "file_creation_date": "2022-05-27T21:29:02Z",
    "file_modification_date": "2022-05-27T21:29:02Z",
    "file_size": 1286433,
    "plain_text": "# How to Leverage User Access Logging for Forensic Investigations\n\n**crowdstrike.com/blog/user-access-logging-ual-overview/**\n\nPatrick Bennett June 8, 2021\n\nCrowdStrike analysts recently began researching and leveraging User Access Logging (UAL), a newer forensic artifact on\nWindows Server operating system that offers a wealth of data to support forensic investigations. UAL has proven\nbeneficial to help correlate an account and the source IP address with actions performed remotely on systems.\n\nTo help your investigations, this blog post provides an overview of UAL databases and offers examples of interpreting the\ntreasure trove of data that they contain.\n\n## What Is User Access Logging?\n\nUAL is a feature included by default in Server editions of Microsoft Windows, starting with Server 2012. As defined by\n[Microsoft, UAL is a feature that “logs unique client access requests, in the form of IP addresses and user names, of](https://docs.microsoft.com/en-us/windows-server/security/windows-services/security-guidelines-for-disabling-system-services-in-windows-server)\ninstalled products and roles on the local server.”\n\nThis means that UAL records user access to various services running on a Windows Server. The access is logged to\ndatabases on disk that contain information on the type of service accessed, the user account that performed the access\nand the source IP address from which the access occurred. One key element of UAL is that each record is based on the\ncombination of username, source IP and service accessed — so it’s naturally suited for identifying anomalous or rare\naccess to a system.\n\nWith default settings, this information is retained for up to three years. Naturally, this data can be extremely valuable in\nforensic investigations. Unfortunately, there’s a marked lack of awareness of this type of artifact in the digital forensic\ncommunity. Many forensic solutions do not parse these databases, and therefore threat analysts could potentially miss\ndata relevant to an investigation.\n\n\n-----\n\n## Where to Find UAL Data\n\nUAL database files are stored under the directory C:\\Windows\\System32\\LogFiles\\Sum. Inside this directory, you’ll find up\nto five Extensible Storage Engine (ESE) database files with .mdb extensions. The screenshot in Figure 1 provides an\nexample of what the contents might look like.\n\nFigure 1. C:\\Windows\\System32\\LogFiles\\Sum sample contents\n\nThe files shown above include:\n\nCurrent.mdb (UAL database — current year; active copy)\n<GUID>.mdb (UAL database — current year)\n<GUID>.mdb (UAL database — previous year)\n<GUID>.mdb (UAL database — two years prior)\nSystemidentity.mdb (database containing information about the server, including a map of RoleGuid values to Role\nnames – more on this below)\n\nThe Current.mdb file contains UAL data for the current year, while the two previous years are stored in .mdb files with\nGUID-style filenames. Per Microsoft:\n\n_“UAL makes a copy of the active database file, current.mdb, to a file named GUID.mdb every 24 hours. On the first day of_\n_the year, UAL will create a new GUID.mdb. The old GUID.mdb is retained as an archive. After two years, the original_\n_GUID.mdb will be overwritten.”_\n\nThis means there can be up to three years of historical data stored on the UAL (i.e., data from the previous year, two\nyears prior and the current year up to the present).\n\nFollowing the above, Current.mdb and the GUID-style files contain the same set of tables. These files will include the\nCLIENTS table, where some of the juiciest forensic data is stored — this is where you’ll find the historical records of users\naccessing various services.\n\nTable 1 shows a sample record from the CLIENTS table. Please note that some of the fields are omitted for visibility (see\nAppendix for a full listing of all tables and fields in the UAL databases).\n\n**RoleGuid** **TotalAccesses** **InsertDate** **LastAccess** **Address** **AuthenticatedUserName**\n\n\n10a9226f-50ee-49d8a393-9a501d47ce04\n\n\n1 2019-0312T18:06:56Z\n\n\n2019-0312T18:06:56Z\n\n\n0a0a0cc8 DOMAIN\\User1\n\n\n_Table 1. Sample UAL CLIENTS table record_\n\nIn the above example, the UAL record indicates that the user DOMAIN\\User1 accessed the system via SMB on 2019-0312 at 18:06:56 UTC, coming from the source IP address 10.10.12.200.\n\nThe source IP address is stored in the Address field in hexadecimal (0a 0a 0c c8 = 10 10 12 200). The InsertDate field\ncontains the UTC timestamp of the first access for the year for the combination of user, RoleGuid and source IP.\n**LastAccess is similar but represents the most recent access for the year.**\n\n\n-----\n\nThe TotalAccesses value of 1 indicates that this was the only access for the year (again, based on the combination of\nuser, source IP and RoleGuid). If access occurred on additional days between the InsertDate and LastAccess, the total\ncount would be included in this field. In addition, a daily count of the number of accesses per day would be included in\nadditional fields named Day1 up to Day366, which represent the day of the year the access occurred (see Appendix for\nmore details). Unfortunately, a full timestamp is only included for InsertDate and LastAccess — nothing in between. But\nas will be shown, this is plenty.\n\nThe RoleGuid field represents the type of service that was accessed. In this case, it was 10a9226f-50ee-49d8-a3939a501d47ce04, which corresponds with what is known as the File Server Role. This typically represents SMB access,\nthough it’s possible other protocols may be logged here as well.\n\nRoleGuid values are mapped to human-readable Role Names in the SystemIdentity.mdb database, under the ROLE_IDS\ntable. Table 2 shows a sample ROLE_IDS table.\n\n**RoleGuid** **ProductName** **RoleName**\n\n\nc50fcc83-bc8d-4df5-8a3d89d7f80f074b\n\nb4cdd739-089c-417e-878d855f90081be7\n\n48eed6b2-9cdc-4358-b5a58dea3b2f3f6a\n\n7cc4b071-292c-4732-97a1cf9a7301195d\n\n10a9226f-50ee-49d8-a3939a501d47ce04\n\nbbd85b29-9dcc-4fd9-865d3846dcba75c7\n\n7fb09bd3-7fe6-435e-83487d8aefb6cea3\n\nd6256cf7-98fb-4eb4-aa18303f1da1f770\n\n4116a14d-3840-4f42-a67ff2f9ff46eb4c\n\nd8dc1c8e-ea13-49ce-9a68c9dca8db8b33\n\nc23f1c6a-30a8-41b6-bbf7f266563dfcd6\n\n910cbaf9-b612-4782-a21ff7c75105434a\n\n952285d9-edb7-4b6b-9d850c09e3da0bbd\n\n_Table 2. Sample ROLE_IDS table_\n\n### A Note on Roles\n\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n0997dbd9-4db4-49aa-8ec58f5c6ae1c870\n\n\nActive Directory Certificate Services\n\nActive Directory Rights Management\nService\n\nDHCP Server\n\nFAX Server\n\nFile Server\n\nNetwork Policy and Access Services\n\nPrint and Document Services\n\nWeb Server\n\nWindows Deployment Services\n\nWindows Server Update Services\n\nFTP Server\n\nBranchCache\n\nRemote Access\n\n\nThe Roles referenced by UAL data are tied directly to Server Roles installed on Windows Server systems. This is done via\nthe Server Manager application, by clicking on Manage → Add Roles and Features.\n\n\n-----\n\nFigure 2. Server Manager Roles and Features menu\n\nThis will bring up a menu that lists available Roles that can be installed, which will look similar to what’s shown in Figure 3.\n\nFigure 3. Server Manager Server Roles menu\n\nCertain Roles are included in the ROLE_IDS table by default, regardless of whether or not they are enabled. Other Roles\nmay get added to the bottom of the ROLE_IDS table when they are installed via the Server Manager. For example, when\nmaking a server into a Domain Controller, one would install the Active Directory Domain Services Role, at which point\nthis server would be added to the bottom of the ROLE_IDS table, and access under this Role would start being logged in\nthe CLIENTS table. However, not every installed Role will necessarily end up being tracked by UAL.\n\n### File Server Role\n\nFrom a forensic perspective, one of the most fruitful Roles in UAL analysis is the File Server Role. It can be found as a\nsubitem under File and Storage Services in the Server Manager menu.\n\n\n-----\n\nFigure 4. File and Storage Services\n\nAs shown in Figure 4, Microsoft notes that the File Server Role “manages shared folders and enables users to access\nfiles on [a] computer from the network.” The consequence is that SMB access is logged in UAL databases under the File\n**Server RoleGuid. This means UAL databases potentially contain up to three years of historical SMB access. This data**\ncan be extremely valuable during investigations, as we’ll demonstrate in the next section.\n\nIt’s important to note that this SMB logging includes when, for example, a user maps a file share and performs actions that\nuse SMB under the hood, including SMB named pipes. For example, remotely interacting with a service using sc.exe will\nresult in File Server UAL entries on the target system, because an SMB named pipe (\\\\.\\PIPE\\svcctl) is used. Similarly, a\nUAL File Server entry for a user doesn’t necessarily mean that the user purposefully used SMB.\n\nAs a side note, even if the File Server Role is not explicitly enabled, SMB access will still be logged by UAL (as long as\nthe firewall rules to allow SMB access are enabled). When the File Server Role is installed, these firewall rules are\nautomatically enabled.\n\n## Interpreting UAL Data\n\nLet’s step through some quick examples to demonstrate just how powerful UAL analysis can be. Please note that the\nfollowing data is simulated, but this information is very similar to what you’d see in real-world scenarios when analyzing\nUAL data.\n\nIn this first example, we’re analyzing a system called WEBSRV01. We already know that PsExec was used to execute the\nmalicious file C:\\Windows\\malware.exe on 2020-11-04 at 19:53:08 UTC through analysis of host artifacts. However, all\nevent logs have rolled and were not forwarded elsewhere. We’re trying to understand which user account executed\nPsExec targeting WEBSRV01 and from which system the activity originated. After parsing the UAL CLIENTS table (from\nthe 2020 database file), the following results are returned.\n\n**RoleGuid** **TotalAccesses** **InsertDate** **LastAccess** **Address** **AuthenticatedUserName**\n\n\n10a9226f-50ee-49d8a393-9a501d47ce04\n\n\n686 2020-0101T05:16:43Z\n\n\n2020-1231T23:30:33Z\n\n\n::1 WEBSRV01\\Administrator\n\n\n-----\n\n10a9226f-50ee-49d8a393-9a501d47ce04\n\n10a9226f-50ee-49d8a393-9a501d47ce04\n\n10a9226f-50ee-49d8a393-9a501d47ce04\n\n10a9226f-50ee-49d8a393-9a501d47ce04\n\n10a9226f-50ee-49d8a393-9a501d47ce04\n\n10a9226f-50ee-49d8a393-9a501d47ce04\n\n10a9226f-50ee-49d8a393-9a501d47ce04\n\n10a9226f-50ee-49d8a393-9a501d47ce04\n\n\n942 2020-0112T13:11:46Z\n\n14 2020-0323T07:50:48Z\n\n35 2020-0323T08:30:01Z\n\n1 2020-0812T23:42:08Z\n\n3 2020-1104T19:53:07Z\n\n33 2020-1112T02:01:42Z\n\n1 2020-1113T13:03:13Z\n\n273 2020-1201T18:46:12Z\n\n\n2020-1231T23:41:31Z\n\n2020-1208T12:22:43Z\n\n2020-1212T03:48:12Z\n\n2020-0812T23:42:08Z\n\n2020-1104T19:53:08Z\n\n2020-1230T15:28:07Z\n\n2020-1113T13:03:13Z\n\n2020-1225T04:00:00Z\n\n\n10.20.49.101 CORP\\WEBSVC\n\n10.15.100.249 CORP\\lstevens\n\n10.20.100.100 CORP\\lstevens-adm\n\n10.15.100.103 CORP\\rsmith\n\n10.20.49.201 CORP\\banderson\n\n10.20.115.32 CORP\\CORPSVC\n\n10.20.100.142 WERSRV01\\Administrator\n\n10.1.73.48 CORP\\hconway\n\n\n_Table 3. Sample CLIENTS table_\n\nThe first thing that immediately jumps out is the row related to the account CORP\\banderson that has a LastAccess value\nmatching precisely the time of PsExec usage identified via other artifacts. This record’s address value is 10.20.49.201,\nmeaning the activity originated from a device with this IP. We also note that the TotalAccesses value is 3. This means\nthat for all of 2020, the CORP\\banderson account only accessed WEBSRV01 via SMB from this IP address three times —\nand what’s more, all three occurred around the time of the PsExec activity (because all of the accesses would have\noccured between the InsertDate and LastAccess times).\n\nAnother anomaly in the above is we have the local Administrator account for WEBSRV01 accessing it from the IP address\nof another system. Based on the TotalAccesses value, this is a rare activity, having only occurred once in 2020, with all\nof the other local Administrator access coming from localhost.\n\nSimplify forensic data collection and analysis with the CrowdStrike Falcon Forensics™ solution. Incident responders\ncan respond faster to investigations and conduct compromise assessments, threat hunting and monitoring all in one\nlocation with Falcon Forensics. Responders can gather comprehensive data and analyze it quickly via pre-built\n[dashboards and easy search capabilities for both live and historical artifacts. Learn more about how Falcon Forensics](https://www.crowdstrike.com/products/endpoint-security/falcon-forensics/)\nworks.\n\n### UAL at Scale\n\nThings get even more exciting when you start pulling UAL at scale from many systems at once. Even simply sorting the\noutput by InsertDate can quickly identify suspicious activity. When aggregating CLIENTS table data from multiple\nsystems, it’s not uncommon to observe scenarios similar to the example in Table 4.\n\n\n**System**\n**Name**\n\n\n**RoleGuid** **TotalAccesses** **InsertDate** **LastAccess** **Address** **AuthenticatedUserName**\n\n\nAPPSRV01 10a9226f50ee-49d8a3939a501d47ce04\n\nAPPSRV02 10a9226f50ee-49d8a3939a501d47ce04\n\n\n1 2020-1130T14:26:17Z\n\n1 2020-1130T14:26:17Z\n\n\n2020-1130T14:26:17Z\n\n2020-1130T14:26:17Z\n\n\n10.20.52.40 CORP\\abcsvc\n\n10.20.52.40 CORP\\abcsvc\n\n\n-----\n\nDC01 10a9226f50ee-49d8a3939a501d47ce04\n\nFILESRV01 10a9226f50ee-49d8a3939a501d47ce04\n\nFILESRV02 10a9226f50ee-49d8a3939a501d47ce04\n\nWEBSRV01 10a9226f50ee-49d8a3939a501d47ce04\n\nWEBSRV02 10a9226f50ee-49d8a3939a501d47ce04\n\n\n1 2020-1130T14:26:17Z\n\n1 2020-1130T14:26:18Z\n\n1 2020-1130T14:26:18Z\n\n1 2020-1130T14:26:19Z\n\n1 2020-1130T14:26:19Z\n\n\n2020-1130T14:26:17Z\n\n2020-1130T14:26:18Z\n\n2020-1130T14:26:18Z\n\n2020-1130T14:26:19Z\n\n2020-1130T14:26:19Z\n\n\n10.20.52.40 CORP\\abcsvc\n\n10.20.52.40 CORP\\abcsvc\n\n10.20.52.40 CORP\\abcsvc\n\n10.20.52.40 CORP\\abcsvc\n\n10.20.52.40 CORP\\abcsvc\n\n\n_Table 4. Sample UAL data from multiple systems_\n\nIn this example, the account CORP\\abcsvc accessed eight systems in rapid succession via SMB, coming from the IP\naddress 10.20.52.40. Further, in each case the TotalAccesses value is 1, meaning this was the only time for the year that\nthis account accessed each system via SMB from the source IP address.\n\nWhen combined with other indicators to pivot from, UAL analysis at scale can help drive the direction of the investigation.\nFor example, if there is a known compromised user account, UAL analysis can quickly identify other (Server 2012+)\nsystems that the account accessed, by searching for records where the AuthenticatedUserName value matches the\ncompromised user name.\n\nSimilarly, if there is a system that’s known to be compromised, analyzing UAL at scale can provide rapid insights into\nthreat actor lateral movement activities. This can be accomplished by finding UAL entries where the Address field\nmatches the IP address of the compromised system. This can quickly provide an overview of which accounts a threat\nactor was using from the compromised server, as well as systems targeted for lateral movement. (Did we mention this\ndata is retained for up to 3 years by default?)\n\nArmed with pivot points like these as a starting point, one can quickly glean critical insights from UAL data. Even without\nany other indicators to go on, it’s possible to spot anomalous activity by looking out for rare combinations of user, source\nIP address and RoleGuid via the TotalAccesses field.\n\n### Correlating UAL Data\n\nCorrelating UAL data with other artifacts can also help fill in the blanks when event log data is unavailable. An\ninvestigation timeline populated via host artifact analysis may yield something like that shown in Table 5.\n\n**System Name** **Timestamp** **Event** **Details**\n\nAPPSRV01 2020-12-01T04:10:50Z File created C:\\Windows\\malware.exe\n\nAPPSRV02 2020-12-01T04:10:50Z File created C:\\Windows\\malware.exe\n\nDC01 2020-12-01T04:10:50Z File created C:\\Windows\\malware.exe\n\nFILESRV01 2020-12-01T04:10:51Z File created C:\\Windows\\malware.exe\n\nFILESRV02 2020-12-01T04:10:51Z File created C:\\Windows\\malware.exe\n\n\n-----\n\nWEBSRV01 2020-12-01T04:10:52Z File created C:\\Windows\\malware.exe\n\nWEBSRV02 2020-12-01T04:10:52Z File created C:\\Windows\\malware.exe\n\n_Table 5. Sample timeline before UAL enrichment_\n\nBy adding UAL data to the timeline and sorting by timestamp, everything falls into place, as shown in Table 6.\n\n\n**System**\n**Name**\n\n\n**Timestamp** **Event** **Details**\n\n\nAPPSRV01 2020-1201T04:10:50Z\n\nAPPSRV01 2020-1201T04:10:50Z\n\nAPPSRV02 2020-1201T04:10:50Z\n\nAPPSRV02 2020-1201T04:10:50Z\n\nDC01 2020-1201T04:10:50Z\n\nDC01 2020-1201T04:10:50Z\n\nFILESRV01 2020-1201T04:10:51Z\n\nFILESRV01 2020-1201T04:10:51Z\n\nFILESRV02 2020-1201T04:10:51Z\n\nFILESRV02 2020-1201T04:10:51Z\n\nWEBSRV01 2020-1201T04:10:52Z\n\nWEBSRV01 2020-1201T04:10:52Z\n\nWEBSRV02 2020-1201T04:10:52Z\n\nWEBSRV02 2020-1201T04:10:52Z\n\n\nUAL\nentry\n\nFile\ncreated\n\nUAL\nentry\n\nFile\ncreated\n\nUAL\nentry\n\nFile\ncreated\n\nUAL\nentry\n\nFile\ncreated\n\nUAL\nentry\n\nFile\ncreated\n\nUAL\nentry\n\nFile\ncreated\n\nUAL\nentry\n\nFile\ncreated\n\n\nRoleGuid: File Server | AuthenticatedUserName: CORP\\rsmith-adm |\nAddress: 10.100.2.201 | TotalAccesses: 1\n\nC:\\Windows\\malware.exe\n\nRoleGuid: File Server | AuthenticatedUserName: CORP\\rsmith-adm |\nAddress: 10.100.2.201 | TotalAccesses: 1\n\nC:\\Windows\\malware.exe\n\nRoleGuid: File Server | AuthenticatedUserName: CORP\\rsmith-adm |\nAddress: 10.100.2.201 | TotalAccesses: 1\n\nC:\\Windows\\malware.exe\n\nRoleGuid: File Server | AuthenticatedUserName: CORP\\rsmith-adm |\nAddress: 10.100.2.201 | TotalAccesses: 1\n\nC:\\Windows\\malware.exe\n\nRoleGuid: File Server | AuthenticatedUserName: CORP\\rsmith-adm |\nAddress: 10.100.2.201 | TotalAccesses: 1\n\nC:\\Windows\\malware.exe\n\nRoleGuid: File Server | AuthenticatedUserName: CORP\\rsmith-adm |\nAddress: 10.100.2.201 | TotalAccesses: 1\n\nC:\\Windows\\malware.exe\n\nRoleGuid: File Server | AuthenticatedUserName: CORP\\rsmith-adm |\nAddress: 10.100.2.201 | TotalAccesses: 1\n\nC:\\Windows\\malware.exe\n\n\n_Table 6. Sample timeline after UAL enrichment_\n\nAfter adding UAL data, we can now clearly see that malware.exe was copied to all of these systems by CORP\\rsmithadm; and that this activity originated from the IP address 10.100.2.201. Aside from subsequently focusing analysis efforts\non that system, you can also identify additional systems of interest by searching the aggregated UAL data for entries with\nmatching Address or AuthenticatedUserName values from around the same timeframe.\n\n### UAL Analysis Tools\n\n\n-----\n\n[On live systems, analysts can access UAL data via PowerShell cmdlets or](https://docs.microsoft.com/en-us/powershell/module/useraccesslogging/?view=windowsserver2019-ps) [WMI. In image analysis, UAL databases can](https://docs.microsoft.com/en-us/windows-server/administration/user-access-logging/get-started-with-user-access-logging)\nbe parsed with any tool that supports parsing ESE databases, such as esedbexport, which is part of Joachim Metz’s\n[libesedb project.](https://github.com/libyal/libesedb)\n\nAt least two recently developed solutions are used for parsing UAL data from a forensic perspective: Eric Zimmerman’s\n[SumECmd and Brian Moran’s](https://ericzimmerman.github.io/) [KStrike. These tools add value by automatically converting RoleGuids to Role Names and](https://github.com/brimorlabs/KStrike)\nautomatically parsing the Address field to a human-readable IP address.\n\n## More to Come\n\nThese examples are only a tiny glimpse into the many powerful applications of UAL data in forensic investigations. The\nforensic analysis of UAL databases can provide exceptional insights to the forensic analyst. Currently, it’s an understudied\nartifact that’s also under-represented by forensic tools. We hope that this information is helpful for your analyses;\nadditional research and testing are needed to learn more about this artifact and the valuable insights it can provide.\n\n## Appendix: UAL Databases and Tables\n\nHere is a description of all tables included with the UAL database files.\n\nCurrent.mdb (and <GUID>.mdb files)\n\n**CLIENTS**\n\nAs mentioned, this table stores the heart of the UAL data. It includes the information on user accounts accessing services\non the server. Each row is based on the combination of user + source IP + RoleGuid. (In other words, if a user accesses a\nsystem via SMB from two different source IP addresses, each will get their own row). The CLIENTS table includes nine\nfields.\n\n**Field Name** **Description**\n\nAuthenticatedUserName Domain\\User account performing the access. Can include local accounts and domain\naccounts, including computer accounts.\n\nAddress Source IP address from which access occurred. Can include IPv4 or IPv6, as well as\nlocalhost values.\n\nRoleGuid The type of service accessed. RoleGuids are mapped to Role names in SystemIdentity.mdb.\n\nInsertDate UTC timestamp of the first access for the year\n\nLastAccess UTC timestamp of the most recent access for the year\n\nTotalAccesses Count of accesses for the year (based on RoleGuid + AuthenticatedUserName + Address)\n\nDay1 … Day366 Count of accesses per day for each day of the year\n\nTenantId Have seen this populated in relation to the Active Directory Domain Services RoleGuid, but\ninterpretation is unclear. Microsoft defines it as “a unique GUID for a tenant client of an\ninstalled role or product that accompanies the UAL data, if applicable.”\n\nClientName Unknown, have not seen it populated in the wild\n\n_Table 7. CLIENTS table fields_\n\n**DNS**\n\nThe DNS table contains historical IP to hostname mappings. It appears this table is only populated if the server being\nanalyzed has the DNS Server Role installed. The hostnames and IPs are likely related to clients of the DNS server, but\nmore research is needed to determine what specifically causes this table to be populated. This table can aid in\ndetermining previous IP addresses associated with systems in instances where DHCP logs are not available. The DNS\ntable includes three fields.\n\n\n-----\n\n**Field Name** **Description**\n\nLastSeen UTC timestamp\n\nAddress IP address\n\nHostName Hostname associated with the IP address\n\n_Table 8. DNS table fields_\n\n**ROLE_ACCESS**\n\nThe ROLE_ACCESS table contains a high-level view of the types of Roles that have been accessed on the system, and\nwhen the first and last accesses occurred. It contains three fields.\n\n**Field Name** **Description**\n\nRoleGuid RoleGuid value (associated with human-readable Role Name in SystemIdentity.mdb)\n\nFirstSeen UTC timestamp of the earliest access to the Role type for the year\n\nLastSeen UTC timestamp of the most recent access to the Role type for the year\n\n_Table 9. ROLE_ACCESS table fields_\n\n**VIRTUALMACHINES**\n\nThe VIRTUALMACHINES table contains information on HyperV virtual machines running on the system. As of this writing,\nwe have not come across it populated in the wild. It contains the following fields:\n\n**Field Name**\n\nVmGuid\n\nBIOSGuid\n\nCreationTime\n\nLastSeenActive\n\nSerialNumber\n\n_Table 10. VIRTUALMACHINES table fields_\n\nSystemIdentity.mdb\n\n**ROLE_IDS**\n\nAs mentioned, the ROLE_IDS table contains a mapping of RoleGuid values to human-readable Role Names. It includes\nthree fields.\n\n**Field Name** **Description**\n\nRoleGuid RoleGuid (GUID value)\n\nProductName Typically related to the OS edition, it can be GUID value or human-readable. Microsoft defines as “The\n_name of the software parent product, such as Windows, that is providing UAL data.”_\n\nRoleName Human-readable Role Name for the RoleGuid\n\n_Table 11. ROLE_IDS table fields_\n\n**CHAINED DATABASES**\n\n\n-----\n\nThis table provides a mapping associated with the year for storing the <GUID>.mdb files. Each row contains two fields.\n\n**Field Name** **Description**\n\nYear Year associated with database filename (e.g., 2021)\n\nFilename Database filename associated with the year\n\n_Table 12. CHAINED_DATABASES table fields_\n\n**SYSTEM_IDENTITY**\n\nThis table contains information related to the operating system and hardware of the system. It contains the following fields,\nmost of which are self-explanatory.\n\n**Field Name** **Field Name**\n\nCreationTime OSSuiteMask\n\nPhysicalProcessorCount OSProductType\n\nCoresPerPhysicalProcessor SystemManufacturer\n\nLogicalProcessorsPerPhysicalProcessor SystemProductName\n\nMaximumMemory SystemSerialNumber\n\nOSMajor SystemDNSHostName\n\nOSMinor SystemDomainName\n\nOSBuildNumber OSSerialNumber\n\nOSPlatformId OSCountryCode\n\nServicePackMajor OSLastBootUpTime\n\n_Table 13. SYSTEM_IDENTITY table fields_\n\nOne interesting aspect of the SYSTEM_IDENTITY table is that it appears to have a new entry created each time one of\nthe fields changes. For example, when changing a system’s hostname or domain, a new row will be created showing the\nnew SystemDNSHostName and SystemDomainName, while the old data will still be available in previous rows. The\nLastBootUpTime field will then only continue to be updated for the latest row. Table 14 provides an example of this.\n\n**CreationTime** **SystemDNSHostName** **SystemDomainName** **LastBootUpTime**\n\n2020-02-12T15:06:23.632Z DESKTOP-A3F2BCF9 WORKGROUP 20210315092316.243752+000\n\n2020-03-15T10:06:12.742Z WEBSRV01 CORP 20211207021136.195304+000\n\n_Table 14. Sample SYSTEM_IDENTITY table data_\n\n## Links\n\n_Microsoft TechNet page on UAL: https://docs.microsoft.com/en-us/windows-server/administration/user-access-_\n_logging/get-started-with-user-access-logging_\n_Microsoft TechNet page on Server Roles: https://docs.microsoft.com/en-us/windows-server/administration/server-_\n_core/server-core-roles-and-services_\n_UAL PowerShell cmdlets: https://docs.microsoft.com/en-us/powershell/module/useraccesslogging/?_\n_view=windowsserver2019-ps_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-08 - UAL Thank Us Later- Leveraging User Access Logging for Forensic Investigations.pdf"
    ],
    "report_names": [
        "2021-06-08 - UAL Thank Us Later- Leveraging User Access Logging for Forensic Investigations.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535542,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1653686942,
    "ts_modification_date": 1653686942,
    "files": {
        "pdf": "https://archive.orkl.eu/15326bcfa9bfba170fc7903ecbb0f2667482958b.pdf",
        "text": "https://archive.orkl.eu/15326bcfa9bfba170fc7903ecbb0f2667482958b.txt",
        "img": "https://archive.orkl.eu/15326bcfa9bfba170fc7903ecbb0f2667482958b.jpg"
    }
}