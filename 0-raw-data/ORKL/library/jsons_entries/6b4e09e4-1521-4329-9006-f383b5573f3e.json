{
    "id": "6b4e09e4-1521-4329-9006-f383b5573f3e",
    "created_at": "2023-01-12T15:03:02.476972Z",
    "updated_at": "2025-03-27T02:12:44.25373Z",
    "deleted_at": null,
    "sha1_hash": "4bde1a84d10abc192a8c15fa8f23751b5b3f5ee7",
    "title": "2017-05-03 - KONNI- A Malware Under The Radar For Years",
    "authors": "",
    "file_creation_date": "2022-05-28T17:55:19Z",
    "file_modification_date": "2022-05-28T17:55:19Z",
    "file_size": 2624540,
    "plain_text": "# KONNI: A Malware Under The Radar For Years\n\n**[blog.talosintelligence.com/2017/05/konni-malware-under-radar-for-years.html](http://blog.talosintelligence.com/2017/05/konni-malware-under-radar-for-years.html)**\n\n[This blog was authored by Paul Rascagneres](https://www.blogger.com/profile/10073079939160046441)\n\n## Executive Summary\n\nTalos has discovered an unknown Remote Administration Tool that we believe has been in\nuse for over 3 years. During this time it has managed to avoid scrutiny by the security\ncommunity. The current version of the malware allows the operator to steal files, keystrokes,\nperform screenshots, and execute arbitrary code on the infected host. Talos has named this\nmalware KONNI.\n\nThroughout the multiple campaigns observed over the last 3 years, the actor has used an\nemail attachment as the initial infection vector. They then use additional social engineering to\nprompt the target to open a .scr file, display a decoy document to the users, and finally\nexecute the malware on the victim's machine. The malware infrastructure of the analysed\nsamples was hosted by a free web hosting provider: 000webhost. The malware has evolved\nover time. In this article, we will analyse this evolution:\n\nat the beginning the malware was only an information stealer without remote\nadministration\n\n\n-----\n\nit moved from a single file malware to a dual file malware (an executable and a\ndynamic library)\nthe malware has supported more and more features over the time\nthe decoy documents have become more and more advanced\nThe different versions contain copy/pasted code from previous versions. Moreover the\nnew version searches for files generated by previous versions. (This implies that the\nmalware has been used several times against the same targets)\n\nThis evolution is illustrated across 4 campaigns: one in 2014, one in 2016 and finally two in\n2017. The decoy document of the 2 last campaigns suggests that the targets are public\norganisations. Both documents contained email addresses, phone numbers and contacts of\nmembers of official organizations such as United Nations, UNICEF, and Embassies linked to\nNorth Korea.\n\n## 3 Years Of Campaigns\n\n**2014 Campaign: Fatal Beauty**\n\nIn this campaign, the dropper filename was beauty.scr. Based on the compilation date of the\ntwo binaries, this campaign took place in September 2014. Once executed, two files were\ndropped on the targeted system: a decoy document (a picture) and a fake svchost.exe\nbinary. Both files were stored in \"C:\\Windows\". The picture is a Myanmar temple:\n\nThe fake svchost binary is the KONNI malware. The first task of the malware is to generate\nan ID to identify the infected system. This ID is generated based on the installation date of\n\n\n-----\n\nthe system, as found in the registry (HKLM\\Software\\Microsoft\\Windows\nNT\\CurrentVersion\\InstallDate). The second task of malware is to ping the CC and get\norders. The malware includes 2 domains:\n\nphpschboy[.]prohosts[.]org\njams481[.]site[.]bz\n\nThe developer used the Microsoft Winsocks API to handle the network connection.\nSurprisingly, this isn't the easiest or the most efficient technical choice for HTTP connection.\nThe malware samples we analysed connected to only one URI: <c2-domain>/login.php.\n\nThis version of KONNI is not designed to execute code on the infected system. The purpose\nis to be executed only once and steal data on the infected system, here are the main\nfeatures:\n\nKeyloggers\nClipboard stealer\nFirefox profiles and cookies stealer\nChrome profiles and cookies stealer\nOpera profiles and cookies stealer\n\n\n-----\n\nThe malware internally uses several temporary files:\n\nspadmgr.ocx\nscreentmp.tmp (log file of the keylogger)\nsolhelp.ocx\nsultry.ocx\n\n**2016 Campaign: \"How can North Korean hydrogen bomb wipe out Manhattan.scr\"**\n\nThe name of the .scr file was directly linked to tension between North Korea and USA in\nMarch 2016: [more information. Based on the compilation dates of the binaries, the campaign](https://www.washingtonpost.com/world/asia_pacific/north-korea-claims-it-could-wipe-out-manhattan-with-a-hydrogen-bomb/2016/03/13/3834cd54-e919-11e5-b0fd-073d5930a7b7_story.html)\ntook place in the same period. An interesting fact: the dropped library was compiled in 2014\nand appears in our telemetry in August 2015. Indicating that this library was probably used in\nanother campaign.\n\nThe .scr file contains 2 Office documents. The first document was in English and a second in\nRussian. In the sample only the English version can be displayed to the user (that is\nhardcoded in the sample):\n\n\n-----\n\nThe Russian document is not used by the sample, we assume that the author of the malware\nforgot to remove the resource containing the Russia decoy document:\n\n\n-----\n\nThe malware author changed the malware architecture, this version is divided in two\nbinaries:\n\nconhote.dll\nwinnit.exe\n\nAnother difference is the directory where the files are dropped, it's no longer C:\\Windows but\nrather the local setting of the current user (%USERPROFILE%\\Local\nSettings\\winnit\\winnit.exe). Thanks to this modification, the malware can be executed with a\nnon-administrator account. The .dll file is executed by the .exe file. In this version, a shortcut\nis created in order to launch winnit.exe in the following path %USERPROFILE%\\Start\nMenu\\Programs\\Startup\\Anti virus service.lnk. As you can see the attacker has went to great\nlengths to disguise his service as a legitimate Antivirus Service by using the name 'Anti virus\nservice.lnk'. This is of course simple but often it can be enough for a user to miss something\nmalicious by name.\n\nAs in the previous version, the ID of the infected system is generated with exactly the same\nmethod. The C2 is different and the analysed version this time only contains a single domain:\n\n\n-----\n\ndowhelsitjs[.]netau[.]net\n\nIn this version, the developer used a different API, the Wininet API which make more sense\nfor Web requests. Moreover the C2 infrastructure evolved too, more .php files are available\nthrough the web hosting:\n\n<c2-domain>/login.php (for infected machine registration)\n<c2-domain>/upload.php (for uploading files on the C2)\n<c2-domain>/download.php (for downloading file from the C2)\n\nThis version includes the stealer features mentioned in the previous version and additionally\nRemote Administration Tool features such as file uploading/download and arbitrary command\nexecution. The library is only used to perform keylogging and clipboard stealing. Indeed, the\nmalware author moved this part of the code from the core of the malware to a library. An\ninteresting element is that the malware looks for filenames created with the previous version\nof KONNI. This implies that the malware targeted the same people as the previous version\nand they are designed to work together.\n\nThe malware internally uses the following files:\n\nsolhelp.ocx\nsultry.ocx\nhelpsol.ocx\npsltre.ocx\nscreentmp.tmp (log file of the keylogger)\nspadmgr.ocx\napsmgrd.ocx\nwpg.db\n\n**2017 Campaigns**\n\nPyongyang Directory Group email April 2017 RC_Office_Coordination_Associate.scr\n\nIn this campaign, the malware author uses the following name: Pyongyang Directory Group\nemail April 2017 RC_Office_Coordination_Associate.scr. The decoy document shown after\ninfection is an Office document containing email addresses, phone numbers and contacts of\nmembers of official organizations such as the United Nations, UNICEF, Embassies linked to\nNorth Korea.\n\n\n-----\n\nThe .scr files drops two files: an executable and a library. As in the previous version, the\npersistence is achieved by a Windows shortcut (in this case adobe distillist.lnk). Contrary to\nthe previous version, the developers moved the core of malware to the library. The\nexecutable performs the following tasks:\n\nIf the system is a 64-bit version of Windows, it downloads and executes a specific 64bit version of the malware thanks to a powershell script:\n\nLoading the dropped library\n\n\n-----\n\nThe library contains the same features as the previous version as well as new ones. This\nversion of KONNI is the most advanced with better coding. The malware configuration\ncontains one Command and Control:\n\npactchfilepacks[.]net23[.]net\n\nA new URI is available:\n\n<c2-domain>/uploadtm.php\n\nThis URI is used with a new feature implemented in this version: the malware is able to\nperform screenshot (thanks to the GDI API) and uploads it thank to this URL. The malware\nchecks if a file used on a previous version of KONNI is available on the system. Here is the\ncomplete list of files internally used by the RAT:\n\nerror.tmp (the log file of the keylogger)\ntedsul.ocx\nhelpsol.ocx\ntrepsl.ocx\npsltred.ocx\nsolhelp.ocx\nsulted.ocx\n\nThe handling of instructions has improved too. Here are the 7 actions that the infected\nmachine can be instructed to perform:\n\nDelete a specific file;\nUpload a specific file based on a filename;\nUpload a specific file based on the full path name;\nCreate a screenshot and uploads it on the C2;\nGet system information;\nDownload a file from the Internet;\nExecute a command;\n\n\n-----\n\nThis graph shows the decision tree:\n\nWhen the attacker wants to gather information on the infected system (action 5), it retrieves\nthe following information:\n\nHostname\nIP address\nComputer name\nUsername name\nConnected drive\nOS version\nArchitecture\nStart menu programs\nInstalled software\n\n\n-----\n\nInter Agency List and Phonebook - April 2017 RC_Office_Coordination_Associate.scr\n\nThe last identified campaign where KONNI was used was named Inter Agency List and\nPhonebook - April 2017 RC_Office_Coordination_Associate.scr. This file drops exactly the\nsame files than the previous campaign but the decoy document is different:\n\n\n-----\n\nThis document contains the name, phone number and email address of members of\nagencies, embassies and organizations linked to North Korea.\n\n## Conclusion\n\nThe analysis shows us the evolution of KONNI over the last 3 years. The last campaign was\nstarted a few days ago and is still active. The infrastructure remains up and running at the\ntime of this post. The RAT has remained under the radar for multiple years. An explanation\ncould be the fact that the campaign was very limited nature, which does not arouse\nsuspicion.\n\nThis investigation shows that the author has evolved technically (by implementing new\nfeatures) and in the quality of the decoy documents. The campaign of April 2017 used\npertinent documents containing potentially sensitive data. Moreover the metadata of the\nOffice document contains the names of people who seems to work for a public organization.\nWe don't know if the document is a legitimate compromised document or a fake that the\nattacker has created in an effort to be credible.\n\nClearly the author has a real interest in North Korea, with 3 of the 4 campaigns are linked to\nNorth Korea.\n\n\n-----\n\nThe following graph show the evolution of KONNI over the last 3 years:\n\n## Coverage\n\nAdditional ways our customers can detect and block this threat are listed below.\n\n[Advanced Malware Protection (AMP) is ideally suited to prevent the execution of the](https://www.cisco.com/c/en/us/support/security/amp-firepower-software-license/tsd-products-support-series-home.html)\nmalware used by these threat actors.\n\n\n-----\n\n[CWS orWSA web scanning prevents access to malicious websites and detects malware](https://www.cisco.com/c/en/us/products/security/cloud-web-security/index.html)\nused in these attacks.\n\n[Email Security can block malicious emails sent by threat actors as part of their campaign.](https://www.cisco.com/c/en/us/products/security/email-security-appliance/index.html)\n\n[The Network Security protection ofIPS andNGFW have up-to-date signatures to detect](https://www.cisco.com/c/en/us/products/security/intrusion-prevention-system-ips/index.html)\nmalicious network activity by threat actors.\n\n[AMP Threat Grid helps identify malicious binaries and build protection into all Cisco Security](https://www.cisco.com/c/en/us/solutions/enterprise-networks/amp-threat-grid/index.html)\nproducts.\n\n[Umbrella, our secure internet gateway (SIG), blocks users from connecting to malicious](https://umbrella.cisco.com/)\ndomains, IPs, and URLs, whether users are on or off the corporate network\n\n## IOCs\n\n**2014 Campaign: Fatal Beauty**\n\nDropper\n\nSHA256: 413772d81e4532fec5119e9dce5e2bf90b7538be33066cf9a6ff796254a5225f\n\nFilename: beauty.scr\n\nDropped files\n\n#1\n\nSHA256: eb90e40fc4d91dec68e8509056c52e9c8ed4e392c4ac979518f8d87c31e2b435\n\nFilename: C:\\Windows\\beauty.jpg\n\nFile type: JPEG image data, JFIF standard 1.02\n\n#2\n\nSHA256: 44150350727e2a42f66d50015e98de462d362af8a9ae33d1f5124f1703179ab9\n\nHilename: C:\\Windows\\svchost.exe\n\nFile type: PE32 executable (GUI) Intel 80386, for MS Windows\n\nCC\n\nphpschboy[.]prohosts[.]org\n\njams481[.]site[.]bz\n\n**2016 Campaign: How can North Korean hydrogen bomb wipe out Manhattan**\n\nDropper\n\nSHA256: 94113c9968db13e3412c1b9c1c882592481c559c0613dbccfed2fcfc80e77dc5\n\nFilename: How can North Korean hydrogen bomb wipe out Manhattan.scr\n\nDropped\n\n#1\n\nSHA256: 56f159cde3a55ae6e9270d95791ef2f6859aa119ad516c9471010302e1fb5634\n\nFilename: conhote.dll\n\n\n-----\n\n#2\nSHA256: 553a475f72819b295927e469c7bf9aef774783f3ae8c34c794f35702023317cc\nFilename: winnit.exe\n\n#3\nSHA256: 92600679bb183c1897e7e1e6446082111491a42aa65a3a48bd0fceae0db7244f\nFilename: Anti virus service.lnk\n\nCC\n\ndowhelsitjs[.]netau[.]net\n\n**2017 Campaign A:**\n\nDropper\n\nSHA256: 69a9d7aa0cb964c091ca128735b6e60fa7ce028a2ba41d99023dd57c06600fe0\n\nFilename: Pyongyang Directory Group email April 2017\nRC_Office_Coordination_Associate.scr\n\nDropped\n\n#1\n\nSHA256: 3de491de3f39c599954bdbf08bba3bab9e4a1d2c64141b03a866c08ef867c9d1\n\nFilename: adobe distillist.lnk\n\n#2\n\nSHA256: 39bc918f0080603ac80fe1ec2edfd3099a88dc04322106735bc08188838b2635\n\nFilename: winload.exe\n\n#3\n\nSHA256: dd730cc8fcbb979eb366915397b8535ce3b6cfdb01be2235797d9783661fc84d\n\nFilename: winload.dll\n\nCC\n\nPactchfilepacks[.]net23[.]net\n\ncheckmail[.]phpnet[.]us\n\n**2017 Campaign B:**\n\nDropper\n\nSHA256: 640477943ad77fb2a74752f4650707ea616c3c022359d7b2e264a63495abe45e\n\nFilename: Inter Agency List and Phonebook - April 2017\nRC_Office_Coordination_Associate.scr\n\nDropped\n\n#1\n\nSHA256: 4585584fe7e14838858b24c18a792b105d18f87d2711c060f09e62d89fc3085b\n\n\n-----\n\nFilename: adobe distillist.lnk\n\n#2\nSHA256: 39bc918f0080603ac80fe1ec2edfd3099a88dc04322106735bc08188838b2635\nFilename: winload.exe\n\n#3\nSHA256: dd730cc8fcbb979eb366915397b8535ce3b6cfdb01be2235797d9783661fc84d\nFilename: winload.dll\n\nCC\n\nPactchfilepacks[.]net23[.]net\ncheckmail[.]phpnet[.]us\n\n**Related samples**\n\n413772d81e4532fec5119e9dce5e2bf90b7538be33066cf9a6ff796254a5225f\n\n44150350727e2a42f66d50015e98de462d362af8a9ae33d1f5124f1703179ab9\n\n553a475f72819b295927e469c7bf9aef774783f3ae8c34c794f35702023317cc\n\n56f159cde3a55ae6e9270d95791ef2f6859aa119ad516c9471010302e1fb5634\n\n94113c9968db13e3412c1b9c1c882592481c559c0613dbccfed2fcfc80e77dc5\n\nf091d210fd214c6f19f45d880cde77781b03c5dc86aa2d62417939e7dce047ff\n\n0f327d67b601a87e575e726dc67a10c341720267de58f3bd2df3ce705055e757\n\n234f9d50aadb605d920458cc30a16b90c0ae1443bc7ef3bf452566ce111cece8\n\n39bc918f0080603ac80fe1ec2edfd3099a88dc04322106735bc08188838b2635\n\n581e820637decf37bfd315c6eb71176976a0f2d59708f2836ff969873b86c7db\n\n640477943ad77fb2a74752f4650707ea616c3c022359d7b2e264a63495abe45e\n\n69a9d7aa0cb964c091ca128735b6e60fa7ce028a2ba41d99023dd57c06600fe0\n\n97b1039612eb684eaec5d21f0ac0a2b06b933cc3c078deabea2706cb69045355\n\ndae9d8f9f7f745385286775f6e99d3dcc55bbbe47268a3ea20deffe5c8fd0f0e\n\ndd730cc8fcbb979eb366915397b8535ce3b6cfdb01be2235797d9783661fc84d\n\ne6a9d9791f763123f9fe1f69e69069340e02248b9b16a88334b6a5a611944ef9\n\nead47df090a4de54220a8be27ec6737304c1c3fe9d0946451b2a60b8f11212d1\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-05-03 - KONNI- A Malware Under The Radar For Years.pdf"
    ],
    "report_names": [
        "2017-05-03 - KONNI- A Malware Under The Radar For Years.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43c8747-c898-448a-88a9-76bff88e91b5",
            "created_at": "2024-02-02T02:00:04.058535Z",
            "updated_at": "2025-03-27T02:00:03.302832Z",
            "deleted_at": null,
            "main_name": "Opal Sleet",
            "aliases": [
                "OSMIUM",
                "Konni",
                "Vedalia"
            ],
            "source_name": "MISPGALAXY:Opal Sleet",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b9458777-d970-4e89-b2d2-e532140a390f",
            "created_at": "2024-05-01T02:03:08.140328Z",
            "updated_at": "2025-03-27T02:05:17.41728Z",
            "deleted_at": null,
            "main_name": "NICKEL JUNIPER",
            "aliases": [
                "OSMIUM ",
                "Opal Sleet ",
                "Konni"
            ],
            "source_name": "Secureworks:NICKEL JUNIPER",
            "tools": [
                "KONNI"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535782,
    "ts_updated_at": 1743041564,
    "ts_creation_date": 1653760519,
    "ts_modification_date": 1653760519,
    "files": {
        "pdf": "https://archive.orkl.eu/4bde1a84d10abc192a8c15fa8f23751b5b3f5ee7.pdf",
        "text": "https://archive.orkl.eu/4bde1a84d10abc192a8c15fa8f23751b5b3f5ee7.txt",
        "img": "https://archive.orkl.eu/4bde1a84d10abc192a8c15fa8f23751b5b3f5ee7.jpg"
    }
}