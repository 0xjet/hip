{
    "id": "7a3bb244-c7eb-4409-811e-5466b7095365",
    "created_at": "2022-10-25T16:48:18.443738Z",
    "updated_at": "2025-03-27T02:05:40.280909Z",
    "deleted_at": null,
    "sha1_hash": "caaf84ec5a1f8b12a1d849660e25bf304baec135",
    "title": "“Red October” Diplomatic Cyber Attacks Investigation",
    "authors": "",
    "file_creation_date": "2018-12-21T03:28:51Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 1141279,
    "plain_text": "# “Red October” Diplomatic Cyber Attacks Investigation\n\n**[securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/](https://securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/)**\n\nBy GReAT\n\n## Contents\n\n[Executive Summary](https://securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/#1)\n[Anatomy of the attack](https://securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/#2)\n\n[General description](https://securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/#3)\n[Step-by-step description (1st stage)](https://securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/#4)\n[Step-by-step description (2nd stage)](https://securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/#5)\n[Timeline](https://securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/#6)\n[Targets](https://securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/#7)\n\n[KSN statistics](https://securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/#8)\n[Sinkhole statistics](https://securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/#9)\n[KSN + sinkhole data](https://securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/#10)\n[С&C information](https://securelist.com/red-october-diplomatic-cyber-attacks-investigation/36740/#11)\n\n## Executive Summary\n\nIn October 2012, Kaspersky Lab’s Global Research & Analysis Team initiated a new threat\nresearch after a series of attacks against computer networks of various international\ndiplomatic service agencies. A large scale cyber-espionage network was revealed and\nanalyzed during the investigation, which we called “Red October” (after famous novel “The\nHunt For The Red October”).\n\nThis report is based on detailed technical analysis of a series of targeted attacks against\ndiplomatic, governmental and scientific research organizations in different countries,\nmostly related to the region of Eastern Europe, former USSR members and countries in\nCentral Asia.\n\nThe main objective of the attackers was to gather intelligence from the compromised\norganizations, which included computer systems, personal mobile devices and network\nequipment.\n\nThe earliest evidence indicates that the cyber-espionage campaign was active since 2007\nand is still active at the time of writing (January 2013).\nBesides that, registration data used for the purchase of several Command & Control (C&C)\nservers and unique malware filenames related to the current attackers hints at even earlier\ntime of activity dating back to May 2007.\n\n## Main Findings\n\n**Advanced Cyber-espionage Network: The attackers have been active for at least several**\nyears, focusing on diplomatic and governmental agencies of various countries across the\nworld.\n\n\n-----\n\nstolen credentials were compiled in a list and used when the attackers needed to guess\nsecret phrase in other locations. To control the network of infected machines, the attackers\ncreated more than 60 domain names and several server hosting locations in different\ncountries (mainly Germany and Russia). The C&C infrastructure is actually a chain of\nservers working as proxies and hiding the location of the ‘mothership’ control server.\n\n**Unique architecture: The attackers created a multi-functional kit which has a capability of**\nquick extension of the features that gather intelligence. The system is resistant to C&C\nserver takeover and allows the attack to recover access to infected machines using\nalternative communication channels.\n\n**Broad variety of targets: Beside traditional attack targets (workstations), the system is**\ncapable of stealing data from mobile devices, such as smartphones (iPhone, Nokia,\nWindows Mobile), enterprise network equipment (Cisco), removable disk drives (including\nalready deleted files via a custom file recovery procedure).\n\n**Importation of exploits: The samples we managed to find were using exploit code for**\nvulnerabilities in Microsoft Word and Microsoft Excel that were created by other attackers\nand employed during different cyber attacks. The attackers left the imported exploit code\nuntouched, perhaps to harden the identification process.\n\n**Attacker identification: Basing on registration data of C&C servers and numerous artifacts**\nleft in executables of the malware, we strongly believe that the attackers have Russianspeaking origins. Current attackers and executables developed by them have been\nunknown until recently, they have never related to any other targeted cyberattacks.\n\n## Anatomy of the attack\n\n### General description\n\nThese attacks comprised of the classical scenario of specific targeted attacks, consisting\nof two major stages:\n\n1. Initial infection\n2. Additional modules deployed for intelligence gathering\n\nThe malicious code was delivered via e-mail as attachments (Microsoft Excel, Word and,\nprobably PDF documents) which were rigged with exploit code for known security\nvulnerabilities in the mentioned applications. In addition to Office documents (CVE-20093129, CVE-2010-3333, CVE-2012-0158), it appears that the attackers also infiltrated victim\nnetwork(s) via Java exploitation (known as the ‘Rhino’ exploit (CVE-2011-3544).\n\nRight after the victim opened the malicious document or visit malicious URL on a\nvulnerable system, the embedded malicious code initiated the setup of the main\ncomponent which in turn handled further communication with the C&C servers.\n\nNext, the system receives a number of additional spy modules from the C&C server,\nincluding modules to handle infection of smartphones\n\n\n-----\n\ndifferent cryptographic systems, such as “Acid Cryptofiler”, (see\n[https://fr.wikipedia.org/wiki/Acid_Cryptofiler) which is known to be used in organizations](https://fr.wikipedia.org/wiki/Acid_Cryptofiler)\nof European Union/European Parliament/European Commission since the summer of 2011.\nAll gathered information is packed, encrypted and only then transferred to the C&C server.\n\n### Step-by-step description (1st stage)\n\nDuring our investigation we couldn’t find any e-mails used in the attacks, only top level\ndropper documents. Nevertheless, based on indirect evidence, we know that the e-mails\ncan be sent using one of the following methods:\n\nUsing an anonymous mailbox from a free public email service provider\nUsing mailboxes from already infected organizations\n\nE-mail subject lines as well as the text in e-mail bodies varied depending on the target\n(recipient). The attached file contained the exploit code which activated a Trojan dropper in\nthe system.\n\nWe have observed the use of at least three different exploits for previously known\nvulnerabilities: CVE-2009-3129 (MS Excel), CVE-2010-3333 (MS Word) and CVE-2012-0158\n(MS Word). The first attacks that used the exploit for MS Excel started in 2010, while\nattacks targeting the MS Word vulnerabilities appeared in the summer of 2012.\n\nAs a notable fact, the attackers used exploit code that was made public and originally\ncame from a previously known targeted attack campaign with Chinese origins. The only\nthing that was changed is the executable which was embedded in the document; the\nattackers replaced it with their own code.\n\nThe embedded executable is a file-dropper, which extracts and runs three additional files.\n\n%TEMP%MSC.BAT\n%ProgramFiles%WINDOWS NTLHAFD.GCP (<- This file name varies)\n\n%ProgramFiles%WINDOWS NTSVCHOST.EXE\n\nMSC.BAT file has the following contents:\n\nchcp 1251\n:Repeat\nattrib -a -s -h -r “%DROPPER_FILE%”\ndel “%DROPPER_FILE%”\nif exist “%DROPPER_FILE%” goto Repeat\n\ndel “%TEMP%msc.bat”\n\nAnother noteworthy fact is in the first line of this file, which is a command to switch the\ncodepage of an infected system to 1251. This is required to address files and directories\nthat contain Cyrillic characters in their names.\n\n\n-----\n\nThe “LHAFD.GCP” file is encrypted with RC4 and compressed with the “Zlib” library. This\nfile is essentially a backdoor, which is decoded by the loader module (svchost.exe). The\ndecrypted file is injected into system memory and is responsible for communication with\nthe C&C server.\n\n\n-----\n\nThe main component is started only after its loader (“svchost.exe”) checks if the internet\nconnection is available. It does so by connecting to three Microsoft hosts:\n\nupdate.microsoft.com\nwww.microsoft.com\nsupport.microsoft.com\n\nFigure – Hosts used to validate internet connection\n\nAfter the Internet connection is validated, the loader executes the main backdoor\ncomponent that connects to its C&C servers:\n\nCapture of malware’s communication with the C2\n\nThe connections with the C&C are encrypted – different encryption algorithms are used to\nsend and receive data.\n\n\n-----\n\nEncrypted communication with the C2\n\nDuring our investigation, we found more than 60 different command-and-control domains.\nEach malware sample contains three such domains, which are hardcoded inside the main\nbackdoor component:\n\nHardcoded C2 domains inside backdoor\n\n### Step-by-step description (2nd stage)\n\nAfter a connection with the C&C server is established, the backdoor starts the\ncommunication process, which leads to the loading of additional modules. These modules\n\n\n-----\n\n“Offline”: exists as files on local disk, capable of creating its own system registry\nkeys, local disk log files, and may communicate with C&C servers on their own.\n“Online”: exists only in system memory and is never saved to local disk, do not create\nregistry keys, all logs are also kept in memory instead of local disk and sends the\nresult of work to the C&C server using own code.\n\nThere is a notable module among all others, which is essentially created to be embedded\ninto Adobe Reader and Microsoft Office applications. The main purpose of its code is to\ncreate a foolproof way to regain access to the target system. The module expects a\nspecially crafted document with attached executable code and special tags. The document\nmay be sent to the victim via e-mail. It will not have an exploit code and will safely pass all\nsecurity checks. However, like with exploit case, the document will be instantly processed\nby the module and the module will start a malicious application attached to the document.\n\nThis trick can be used to regain access to the infected machines in case of unexpected\nC&C servers shutdown/takeover.\n\n## Timeline\n\nWe have identified over 1000 different malicious files related to over 30 modules of this\nTrojan kit. Most of them were created between May 2010 and October 2012.\n\nThere were 115 file-creation dates identified which are related to these campaigns via\nemails during the last two and a half years. Concentration of file creation dates around a\nparticular day may indicate date of the massive attacks (which was also confirmed by\nsome of our side observations):\n\n**Year 2010**\n\n19.05.2010\n21.07.2010\n\n\n-----\n\n05.01.2011\n14.03.2011\n05.04.2011\n23.06.2011\n06.09.2011\n21.09.2011\n\n**Year 2012**\n\n12.01.2012\n\nBelow is a list of sample attachment filenames that were sent to some of the victims:\n\n**File name:**\n\nKatyn_-_opinia_Rosjan.xls\n\nFIEO contacts update.xls\n\nspisok sotrudnikov.xls\n\nList of shahids.xls\n\nSpravochnik.xls\n\nTelephone.xls\n\nBMAC Attache List – At 11 Oct_v1[1].XLS\n\nMERCOSUR_Imports.xls\n\nCópia de guia de telefonos (2).xls\n\nProgramme de fetes 2011.xls\n\n12 05 2011 updated.xls\n\ntelefonebi.xls\n\n## Targets\n\nWe used two approaches to identify targets for these attacks. First, we used the Kaspersky\nSecurity Network (KSN) and then we set up our own sinkhole server. The data received\nusing two independent ways was correlating and this confirmed objective findings.\n\n### KSN statistics\n\nThe attackers used already detected exploit codes and because of this, in the beginning of\nthe research we already had some statistics of detections with our anti-malware software.\nWe searched for similar detections for the period of 2011-2012.\n\nThat is how we discovered more than 300 unique systems, which had detected at least one\nmodule of this Trojan kit.\n\n\n-----\n\nAZERBAIJAN 15\n\nBELGIUM 15\n\nINDIA 15\n\nAFGHANISTAN 10\n\nARMENIA 10\n\nIRAN 7\n\nTURKMENISTAN 7\n\nUKRAINE 6\n\nUNITED STATES 6\n\nVIET NAM 6\n\nBELARUS 5\n\nGREECE 5\n\nITALY 5\n\nMOROCCO 5\n\nPAKISTAN 5\n\nSWITZERLAND 5\n\nUGANDA 5\n\nUNITED ARAB EMIRATES 5\n\nBRAZIL 4\n\nFRANCE 4\n\nGEORGIA 4\n\nGERMANY 4\n\nJORDAN 4\n\nMOLDOVA 4\n\nSOUTH AFRICA 4\n\nTAJIKISTAN 4\n\nTURKEY 4\n\nUZBEKISTAN 4\n\nAUSTRIA 3\n\nCYPRUS 3\n\nKYRGYZSTAN 3\n\nLEBANON 3\n\n\n-----\n\nSAUDI ARABIA 3\n\nCONGO 2\n\nINDONESIA 2\n\nKENYA 2\n\nLITHUANIA 2\n\nOMAN 2\n\nTANZANIA 2\n\nCountries with more than one infections\n\nOnce again, this is based on data from Kaspersky AV products. Apparently, real number\nand list of victim names is much larger than mentioned above.\n\n## Sinkhole statistics\n\nDuring our analysis, we uncovered more than 60 different domains used by different\nvariants of the malware.\n\nOut of the list of domains, several were expired so we registered them to evaluate the\nnumber of victims connecting to them.\n\nThe following domains have been registered and sinkholed by Kaspersky Lab:\n\n**Domain** **Date sinkholed**\n\nshellupdate.com 5-Dec-2012\n\nmsgenuine.net 19-Nov-2012\n\nmicrosoft-msdn.com 5-Nov-2012\n\n\nwindowsonlineupdate.com\ndll-host-update.com\nwindows-genuine.com\n\n\n2-Nov-2012\n\n\nAll the sinkholed domains currently point to “95.211.172.143”, which is Kasperskys’\nsinkhole server.\n\nDuring the monitoring period (2- Nov 2012 – 10 Jan 2013), we registered over 55,000\nconnections to the sinkhole. The most popular domain is “dll-host-update.com”, which is\nreceiving most of the traffic.\n\n\n-----\n\nFrom the point of view of country distribution of connections to the sinkhole, we have\nobserved victims in 39 countries, with most of IPs being from Switzerland. Kazakhstan and\nGreece follow next.\n\n\n-----\n\nwhich allows us to separate the multiple IPs per victims.\n\nBased on the traffic received to our sinkhole, we created the following list of unique victim\nIDs, countries and possible profiles:\n\n**Victim ID** **Country** **Victim profile**\n\n0706010C1BC0B9E5B702 Kazakhstan Gov research institute\n\n0F746C2F283E2FACE581 Kazakhstan ?\n\n150BD7E7449C42C66ED1 Kazakhstan ?\n\n15B7400DBC4975BFAEF6 Austria ?\n\n24157B5D2CD0CA8AA602 UAE ?\n\n3619E36303A2A56DC880 Russia Foreign Embassy\n\n4624C55DEF872FBF2A93 Spain ?\n\n4B5181583F843A904568 Spain ?\n\n4BB2783B8AEC0B439CE8 Switzerland ?\n\n5392032B24AAEE8F3333 Kazakhstan ?\n\n569530675E86118895C4 Pakistan ?\n\n57FE04BA107DD56D2820 Iran Foreign Embassy\n\n5D4102CD1D87417FF93B Russia Gov research institute\n\n5E65486EF8CC4EE4DB5B Japan Foreign Trade\nCommission\n\n6127D685ED1E72E09201 Kazakhstan ?\n\n6B9AFF89A02958C79C17 Ireland Foreign Embassy\n\n6D97B24C08DD64EEDE03 Czech Republic ?\n\n7B14DE85C80368337E87 Turkey ?\n\n89BF96469244534DC092 Belarus Gov research institute\n\n8AA071A22BEDD8D8EC13 Moldova Government\n\n8C58407030570D3A3F52 Albania ?\n\n947827A169348FB01E2F Bosnia and Herzegovina ?\n\nB34C94D561B348EAC75D Switzerland ?\n\n\n-----\n\nB6E4946A47FC3963ABC1 Kazakhstan Energy research group\n\nC978C25326D96C995038 Russia ?\n\nD48A783D288DC72A702B Kazakhstan Aerospace\n\nDAE795D285E0A01ADED5 Russia Trading company\n\nDD767EEEF83A62388241 Russia Gov research institute\n\nIn some cases, it is possible to create a profile of the victim based on the IP address; in\nmost of the cases, however, the identity of the victim remains unknown.\n\n## KSN + sinkhole data\n\nSome of the victim organizations were identified using IP addresses and public WHOIS\ninformation or remote system names.\n\nMost “interesting” out of those are:\n\nAlgeria – Embassy\n\nAfghanistan – Gov, Military, Embassy,\n\nArmenia – Gov, Embassy\n\nAustria – Embassy\n\nAzerbaijan – Oil/Energy, Embassy, Research,\n\nBelarus – Research, Oil/Energy, Gov, Embassy\n\nBelgium – Embassy\n\nBosnia and Herzegovina – Embassy\n\nBotswana – Embassy\n\nBrunei Darussalam – Gov\n\nCongo – Embassy\n\nCyprus – Embassy, Gov\n\nFrance – Embassy, Military\n\nGeorgia – Embassy\n\nGermany – Embassy\n\nGreece – Embassy\n\nHungary -Embassy\n\nIndia – Embassy\n\nIndonesia – Embassy\n\nIran – Embassy\n\n\n-----\n\nIsrael – Embassy\n\nItaly -Embassy\n\nJapan – Trade, Embassy\n\nJordan – Embassy\n\nKazakhstan – Gov, Research, Aerospace, Nuclear/Energy,\nMilitary\n\nKenya – Embassy\n\nKuwait – Embassy\n\nLatvia – Embassy\n\nLebanon – Embassy\n\nLithuania – Embassy\n\nLuxembourg – Gov\n\nMauritania – Embassy\n\nMoldova – Gov, Military, Embassy\n\nMorocco – Embassy\n\nMozambique – Embassy\n\nOman – Embassy\n\nPakistan – Embassy\n\nPortugal – Embassy\n\nQatar – Embassy\n\nRussia – Embassy, Research, Military, Nuclear/Energy\n\nSaudi Arabia – Embassy\n\nSouth Africa – Embassy\n\nSpain – Gov, Embassy\n\nSwitzerland – Embassy\n\nTanzania – Embassy\n\nTurkey – Embassy\n\nTurkmenistan – Gov, Oil/Energy\n\nUganda – Embassy\n\nUkraine – Military\n\nUnited Arab Emirates – Oil/Energy, Embassy, Gov\n\nUnited States – Embassy\n\nUzbekistan – Embassy\n\n\n-----\n\nA list of the most popular domains used for command and control can be found below:\n\n\n-----\n\nconfigurations, it had not been registered by the attackers. The domain has since been\nregistered by Kaspersky Lab on Nov 2nd, 2012 to monitor the attacker’s activities.\n\nAnother interesting example is “dll-host-udate.com” – the “udate” part appears to be a\ntypo.\n\nAll the domains used by attackers appear to have been registered between 2007-2012. The\noldest known domain was registered in Nov 2007; the newest on May 2012.\n\nMost of the domains have been registered using the service “reg.ru”, but other services\nsuch as “webdrive.ru”, “webnames.ru” or “timeweb.ru” have been used as well.\n\nDuring our monitoring, we observed the domains pointing to several malicious webservers.\nA list of servers with confirmed malicious behavior can be found below.\n\nIn total, we have identified 10 different servers which exhibited confirmed malicious\nbehavior. Most of these severs are located in Germany, at Hetzner Online Ag.\n\nDuring our analysis, we were able to obtain an image of one of the command-and-control\nservers. The server itself proved to be a proxy, which was forwarding the request to another\nserver on port 40080. The script responsible for redirections was found in /root/scp.pl and\nrelies on the “socat” tool for stream redirection.\n\nBy scanning the Internet for computers with port 40080 open, we were able to identify\nthree such servers in total, which we call “mini-motherships”:\n\nConnecting to these hosts on port 40080 and fetching the index page, we get the following\nstandard content which is identical in all C&Cs:\n\n\n-----\n\ncurl -I –referer “http://www.google.com/” –user-agent “Mozilla/4.0 (compatible; MSIE 6.0; Windows\n[NT 5.1)” http://31.41.45.139:40080](http://31.41.45.139:40080/)\n\nHTTP/1.1 200 OK\nDate: Mon, 12 Nov 2012 09:58:37 GMT\nServer: Apache\nLast-Modified: Tue, 21 Feb 2012 09:00:41 GMT\nETag: “8c0bf6-ba-4b975a53906e4”\nAccept-Ranges: bytes\nContent-Length: 186\nContent-Type: text/html\n\ncurl -I –referer “http://www.google.com/” –user-agent “Mozilla/4.0 (compatible; MSIE 6.0; Windows\n[NT 5.1)” http://178.63.208.63:40080](http://178.63.208.63:40080/)\n\nHTTP/1.1 200 OK\nDate: Mon, 12 Nov 2012 09:59:09 GMT\nServer: Apache\nLast-Modified: Tue, 21 Feb 2012 09:00:41 GMT\nETag: “8c0bf6-ba-4b975a53906e4”\nAccept-Ranges: bytes\nContent-Length: 186\nContent-Type: text/html\n\nIt should be noted that the “last modified” field of the pages points to the same date: Tue,\n21 Feb 2012 09:00:41 GMT. This is important and probably indicates that the three known\nmini-motherships are probably just proxies themselves, pointing to the same top level\n“mothership” server.\n\nThis allows us to draw the following diagram of the C&C infrastructure as of November\n2012:\n\n\n-----\n\nFor the Command and Control servers, the various generations of the backdoor connect to\ndifferent scripts:\n\n**Domain** **Script location**\n\n**nt-windows-update.com, nt-windows-check.com, nt-windows-online.com** /cgi-bin/nt/th\n/cgi-bin/nt/sk\n\n**dll-host-update.com** /cgi-bin/dllhost/ac\n\n**microsoft-msdn.com** /cgi-bin/ms/check\n/cgi-bin/ms/flush\n\n**windows-genuine.com** /cgi-bin/win/wcx\n/cgi-bin/win/cab\n\n**windowsonlineupdate.com** /cgi-bin/win/cab\n\nFor instance, the script “/cgi-bin/nt/th” is being used to receive commands from the\ncommand-and-control server, usually in the form of new plugins to run on the victim’s\ncomputer. The “/cgi-bin/nt/sk” script is called by the running plugins to upload stolen data\nand information about the victim.\n\nWhen connecting to the C&C, the backdoor identifies itself with a specific string which\nincludes a hexadecimal value that appears to be the victim’s unique ID. Different variants\nof the backdoor contain different victim IDs. Presumably, this allows the attackers to\ndistinguish between the multitudes of connections and perform specific operations for\neach victim individually.\n\n\n-----\n\n“Katyn_-_opinia_Rosjan.xls” contains the hardcoded victim ID “F50D0B17F870EB38026F”.\nA similar XLS named “tactlist_05-05-2011_.8634.xls / EEAS New contact list (05-052011).xls” possibly used in Moldova contains a victim ID “FCF5E48A0AE558F4B859”.\n\n**Part 2 of this paper will cover malware modules and provide more technical details about**\n**their operation.**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2013/2013.01.14.Red_October_Campaign/securelist.com-Red%20October%20Diplomatic%20Cyber%20Attacks%20Investigation.pdf"
    ],
    "report_names": [
        "securelist.com-Red October Diplomatic Cyber Attacks Investigation"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716498,
    "ts_updated_at": 1743041140,
    "ts_creation_date": 1545362931,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/caaf84ec5a1f8b12a1d849660e25bf304baec135.pdf",
        "text": "https://archive.orkl.eu/caaf84ec5a1f8b12a1d849660e25bf304baec135.txt",
        "img": "https://archive.orkl.eu/caaf84ec5a1f8b12a1d849660e25bf304baec135.jpg"
    }
}