{
    "id": "187f40d9-b24a-40eb-8770-98dd9ea0d117",
    "created_at": "2023-01-12T15:07:37.669759Z",
    "updated_at": "2025-03-27T02:17:11.204491Z",
    "deleted_at": null,
    "sha1_hash": "0eba60ea2731aff349916c586548c29b5a4e60ca",
    "title": "2017-01-03 - Technical details on the Fancy Bear Android malware (poprd30.apk)",
    "authors": "",
    "file_creation_date": "2022-05-27T21:28:34Z",
    "file_modification_date": "2022-05-27T21:28:34Z",
    "file_size": 963570,
    "plain_text": "# Technical details on the Fancy Bear Android malware (poprd30.apk)\n\n**[blog.crysys.hu/2017/01/technical-details-on-the-fancy-bear-android-malware-poprd30-apk/](http://blog.crysys.hu/2017/01/technical-details-on-the-fancy-bear-android-malware-poprd30-apk/)**\n\nBy Boldizsar Bencsath January 3, 2017\n\n**Background**\n\nRecently, Crowdstrike has published details about a malicious Android APK file, named\npoprd30.apk or Попр-Д30.apk. It seems that the malware was created by the Fancy Bear\ngroup for tracking Ukrainian field artillery units (more info on this can be found here:\n[https://www.crowdstrike.com/wp-content/brochures/FancyBearTracksUkrainianArtillery.pdf).](https://www.crowdstrike.com/wp-content/brochures/FancyBearTracksUkrainianArtillery.pdf)\nThe corresponding APK is identified by the MD5 hash 6f7523d3019fa190499f327211e01fcb\non a related blog site https://www.crowdstrike.com/blog/danger-close-fancy-bear-trackingukrainian-field-artillery-units/. However, not much technical details have been given by\nCrowdStrike on the attack. During discussions on the topic, Jeffrey Carr initiated discussions\nwith us and has sent some questions on if the case is real and how exactly the attack works,\nin particular, how the malware could have been used in military conflicts.\n\nWe carried out only a short investigation on the topic. Our goal was to uncover more\ntechnical details about the attack and to confirm the existence of the backdoor in the\nparticular APK file.\n\n**Highlights**\n\nWe can confirm that the APK file known by the MD5\nhash 6f7523d3019fa190499f327211e01fcb contains a backdoor that tries to\ncommunicate with a remote server.\nThe server IP in the sample is http://69.90.132[.]215/\nThe malicious APK does not use GPS to get exact location of the infected phone, it\ndoes not even ask for GPS-level position information.\nWe note, however, that some location information can be collected by the malicious\nAPK, mainly related to the actual base station used by the phone and the WiFi status.\nThe implant in the malicious APK has similarities to the X-Agent implants of the Fancy\nBear / APT28 / Sofacy group described in former reports, but this is not necessarily an\nevidence on the relationship as such similarities can be faked.\nWe uncovered two interesting items: the malware authors put the German word “nichts”\nas a string in the code, as well, they made a typo “phone standart.”\n\n**Details**\n\n\n-----\n\nIn February 2015, Trend Micro posted details about an iOS espionage app possibly related\nto the Pawn Storm / Sofacy / APT28 / Fancy Bear group. The technical details can be found\nat http://blog.trendmicro.com/trendlabs-security-intelligence/pawn-storm-update-iosespionage-app-found/. Figure 5 of the Trend Micro document shows possible URL GET\nparameters used by the malicious code:\n\nIn the poprd30.apk code very similar items can be found related to the malicious\ncommunications:\n\nBy looking into BuildConfig it seems that one recompiled this APK modified Androdi Debug\nKey.\n\nAs one can see, strings in the APK file are very similar to those in the X-Agent implant, and\nhave the same common goal: make the HTTP request similar to normal HTTP GET requests\nwith common parameters. However, this similarity alone is not enough to state that the\nauthors are the same, because it is very easy to copy this scheme.\n\nAlso, observe the initial value for the SERVER_ANSWER variable. It is “nichts,” which\nmeans “nothing” in German. We don’t know why a german word was used here. Note that\nthis value is not used in the code, it stands only as a default value. That means, if no value is\nreceived from the server, then the corresponding function will return this value instead of the\ninformation received from the server. In the RegG.java file, which has the similar\n\n\n-----\n\nSERVER_ANSWER value it is set to { no_jobs, or, error }; for default value. Setting a\ndefault value generally helps developers to find out if the data transmission was successful in\nthe parts of the code not close to the transmission itself. One can simply check if the answer\nis still the default value, and if it is, it can be sure that the transmission was not successfull\nwithout complicated routines. However, in this APK we found no reference for checking if the\nSERVER_ANSWER has not been changed, and we don’t have clear idea why these two\ndefault values were used in the code.\n\n**Commands**\n\nCommunication routines are spread across multiple classes: DataConstructor, DataExtractor,\nReg, RegG, RegP, RegPBin. The main handling of the commands is in MainService. It is not\nentirely clear why there are multiple copies of some data and routines.\n\nThe malware sends basic info about the phone to the attacker as shown below:\n\nbyte[] arrayOfByte = Base64.encode((“<pre><font size=4 color=green><br>CMD 101\nsuccess</font>” + “<font size=4 color=blue><br>GoogleAccounts: ” + str1 + “<br>Device ID:\n” + str2 + “<br>Model: ” + Build.MODEL + “<br>Manufacturer: ” + Build.MANUFACTURER +\n“<br>Phone standart: ” + str4 + “<br>Country: ” + str5 + “<br>MCC & MNC: ” + str6 +\n“<br>Base station: ” + str3 + “<br>Android version: ” + str7 + “<br>Android SDK: ” + m +\n“</font></pre>”).getBytes(), 0);\n\nThe malware can receive the following commands:\n\nCommands 103 105 108: stop itself\nCommand 100 : Send SMS History /commands are self-explanatory/\nCommand 101: Collect “all” information about the phone and send\n\n\n-----\n\nCommand 102: GetCallDetails (Call history)\nCommand 104: FetchContacts\nCommand 106: GetAppList\nCommand 107: GetWifiStatus (is any WiFi network available, what identifier, what MAC\naddress, speed, etc.)\nCommand 109: Browser history and bookmarks\nCommand 110: Mobile data usage\nCommand 111: Folders and files from sdcard directory\nCommand 112: File download (SDcard) for command\nCommand 101 – Gets GSM network LAC, CID info or base station info (coordinates) if\nCDMA, andorid version, google accounts, device id, etc.\n\nCommand 101 has a typo “phone standart” which should be “standard” both in English and\nGerman.\n\nFor command 101, it is important to note that it can provide location related information. In\ncase of GSM, the base station related information can provide some (not so accurate)\nlocation information. Similarly, in case of CDMA, base station information is related to\nlocation, but it is not accurate either. In addition to the base station, WiFi information can also\nhelp an adversary to find out the approximate location of the phone, but it is nowhere close\nto accurate detection of the real location of the phone.\n\nWe have not seen any GPS related commands in the code, not even the original “D30\nguidance” functionality. Most likely, the APK does not use GPS data. To be even more\nprecise, the application Manifest information does not contain any requests related to GPS\nlevel locality permissions; it asks for ACCESS_COARSE_LOCATION only, which relates to\nthe base station/WiFi based location information.\n\n**Encryption – RC4**\n\n\n-----\n\nThe malware uses communications encrypted by RC4, encoded by Base64 (or very similar –\nwe did not check it carefully), and CRC for error checking. These are very common, but the\nmost important thing is the RC4 implementation and the key in use, which can be proved to\nbe similar to the older X-Agent implants.\n\nThe corresponding RC4 key is also visible in the java byte code format:\n\n\n-----\n\nIn hex, the encryption key is 3B C6 73 0F 8B 07 85 c0 74 02 FF CC DE C7 04 FE 72 F1 5F\n5E C3 56 B8 D8 78 75 50 E8 B1 D1 FA 59 5D 55 EC 83 10 A1 33 35\n\nNote: Rc4 keys can be arbitrary length, and implementation is very easy, hence it is used\nmany times.On the other hand, RC4 is not secure enough for real crypto operations.\n\n**Conclusions**\n\nIn our investigations, we tried to check if the APK indicated in the CrowdStrike report had\nbackdooor connectivity. We can confirm, that this APK file has malicious functionality and\ncan be used to collect intelligence from the users of the applet. Some additional technical\ndetails were discusssed. We (and probably CrowdStrike, too) had no access to the original,\nunmodified APK file.\n\nUPDATE1\n\nSome linux X-Agent versions used exactly the same RC4 key, see this screenshot:\n\nRC4 key\n\nin linux xagent\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-01-03 - Technical details on the Fancy Bear Android malware (poprd30.apk).pdf"
    ],
    "report_names": [
        "2017-01-03 - Technical details on the Fancy Bear Android malware (poprd30.apk).pdf"
    ],
    "threat_actors": [
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536057,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1653686914,
    "ts_modification_date": 1653686914,
    "files": {
        "pdf": "https://archive.orkl.eu/0eba60ea2731aff349916c586548c29b5a4e60ca.pdf",
        "text": "https://archive.orkl.eu/0eba60ea2731aff349916c586548c29b5a4e60ca.txt",
        "img": "https://archive.orkl.eu/0eba60ea2731aff349916c586548c29b5a4e60ca.jpg"
    }
}