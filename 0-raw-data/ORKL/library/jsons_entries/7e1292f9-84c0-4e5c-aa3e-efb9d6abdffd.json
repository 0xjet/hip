{
    "id": "7e1292f9-84c0-4e5c-aa3e-efb9d6abdffd",
    "created_at": "2023-01-12T15:04:54.002754Z",
    "updated_at": "2025-03-27T02:05:39.654357Z",
    "deleted_at": null,
    "sha1_hash": "1849dc31cfaddae23ba6b15d3dccac2e36c1bb44",
    "title": "2021-01-21 - MrbMiner- Cryptojacking to bypass international sanctions",
    "authors": "",
    "file_creation_date": "2022-05-28T21:41:51Z",
    "file_modification_date": "2022-05-28T21:41:51Z",
    "file_size": 2146944,
    "plain_text": "# MrbMiner: Cryptojacking to bypass international sanctions\n\n**[news.sophos.com/en-us/2021/01/21/mrbminer-cryptojacking-to-bypass-international-sanctions/](https://news.sophos.com/en-us/2021/01/21/mrbminer-cryptojacking-to-bypass-international-sanctions/)**\n\nJanuary 21, 2021\n\nWhile searching through our telemetry, we found a handful of logs where a database server\nprocess (sqlservr.exe) launched a downloader executable that seemed to spontaneously\n[appear on the server. The downloader retrieved a cryptominer called MrbMiner. Based on](https://www.zdnet.com/article/new-mrbminer-malware-has-infected-thousands-of-mssql-databases/)\nopen-source intelligence, the miner appears to have been created, hosted, and controlled by\na small software development company based in Iran.\n\nMrbMiner was downloaded by an executable run from the Microsoft SQL server directory\nWhile our records don’t reveal exactly how the malware gained a foothold on the database\n[servers, it stands to reason the attackers may have used similar techniques as the MyKings,](https://news.sophos.com/en-us/2020/07/02/mykings-jumps-on-the-corona-train/)\n[Lemon_Duck, or](https://news.sophos.com/en-us/2019/10/01/lemon_duck-powershell-malware-cryptojacks-enterprise-networks/) [Kingminer miners, whose attack methods we have documented in previous](https://news.sophos.com/en-us/2020/06/09/kingminer-report/)\narticles.\n\nWhen IT admins want to host a database, they have certain performance requirements: The\nability to process lots of data reads and writes, and enough RAM and processor overhead to\nrespond promptly to queries. As a result, servers hosting databases fall on the beefier side of\nthe performance scale, which is why they’re an excellent target for attackers whose goals\n\n\n-----\n\ninclude the distribution of cryptocurrency miners. People who live in countries that are under\nstrict international financial sanctions, like Iran, can leverage cryptocurrency to bypass the\ntraditional banking system.\n\nThe Mrbminer investigation begins with the Microsoft SQL Server (sqlservr.exe) process\nlaunching a file called assm.exe, a downloader Trojan. The assm.exe program downloads\nthe cryptominer payload from a web server, then connects to its command-and-control server\nto report the successful download and execution of the miner.\n\nIn most cases, the payload was a file named sys.dll, which (despite its file suffix) was not a\nWindows DLL but a zip archive containing a cryptominer binary, configuration file, and\nrelated files.\n\n\n-----\n\nWe also found a copy of this same sys.dll payload available from a Github user account that\nhas been subsequently shut down. Several of the servers also hosted a Linux build of the\ncryptominer payload, but its configuration file used a different cryptocurrency wallet address\nthan the Windows version did.\n\nThe MrbMiner cryptojacking payload included a kernel-level device driver\n(WinRing0x64.sys), and a miner executable named Windows Update Service.exe to\nobfuscate its purpose. The executable was a modified version of the XMRig miner.\n\n[The WinRing0x64.sys file is a kernel driver (publicly available on its creator’s Github page)](https://github.com/QCute/WinRing0)\nthat allows userland applications to access ring0-level resources. It gives the attacker access\nto features like the CPU’s model-specific register, and can read from or write to memory,\ndirectly. In particular, cryptominers use this driver to modify the MSR registers in order to\ndisable CPU prefetchers, which results in a 6-7% performance improvement. This driver is a\n[standard functionality that had been added to XMRig miners beginning around December,](https://github.com/xmrig/xmrig/blob/master/bin/WinRing0/WinRing0x64.sys)\n2019.\n\n## Suspicious file naming convention shared across source domains\n\nThe MrbMiner samples we initially found came in a zip named sys.dll. Under further scrutiny,\nwe found a large network of related files and URLs hosting them.\n\n\n-----\n\nWe began by digging into the domain hardcoded into the miner’s configuration file,\n**vihansoft.ir.**\n\nThis domain connected to lots of other zip files containing copies of the miner, including ones\nnamed agentx.dll and hostx.dll. These deliberately-misnamed zip archives variously\ncontained payloads named Windows Security Service.exe, Windows Host\n**Management.exe, Install Windows Host.exe, Installer Service.exe, Microsoft Media**\n**Service.exe, and (Linux) ELF executables named linuxservice and netvhost.**\n\nMany of the identical files had been downloaded from other domains, including mrbfile.xyz\nand mrbftp.xyz. Several other malicious files had also been hosted on these sites, with zips\nnamed sys.dll and syslib.dll, and payloads inside the archives named Windows Security\n**Service.exe, SecurityService.exe, and PowerShellInstaller.exe.**\n\n\n-----\n\n## Making an attribution\n\nIn many ways, the attack seemed typical of most cryptominer attacks we’ve seen targeting\ninternet-facing servers. Where it was distinctly different was that the attacker themselves\nappears to have thrown caution to the wind about concealing their identity; A lot of the\nrecords relating to the miner’s configuration, its domains and IP addresses, point to a single\npoint of origin: a small software company based in Iran.\n\nA\n\nlist of URLs that have hosted MrbMiner downloads or related files\nOne reason cryptocurrency mining attacks are so frustrating is that it is hard to leverage law\nenforcement to address the problem. The source of the miners are, usually, anonymous, as\nis the destination of the harvested cryptocurrency value. But the MrbMiner creator may be\neasier to determine.\n\nThe payload location and the C2 server addresses are both hardcoded into the downloader.\n\nOne domain, used as both a C2 and a payload server, was vihansoft.ir, registered to a\nsoftware development company based in Iran. Payloads were also downloaded directly from\nthe same IP address used to host vihansoft.ir (and from a few other domains which\ncontained the string “mrb,” such as mrbfile.xyz).\n\n\n-----\n\nWhen we see web domains that belong to a legitimate business implicated in an attack, it s\nmuch more common that the attackers simply took advantage of a website to (temporarily, in\nmost cases) use its web hosting capabilities to create a “dead drop” where they can host the\nmalware payload. But in this case, the domain’s owner is implicated in spreading the\nmalware.\n\nWe found a reference to the business behind vihansoft.ir in the Persian-language mapping\nwebsite neshan.org. Similar to Google Maps or Waze, Neshan includes business information\nas part of its mapping services, and the entry for a company that lists vihansoft.ir as its\nwebsite, and names its managing director.\n\nA machine-translated version of the Neshan website identifies the owners of the vihansoft\ndomain\nWe found the miner downloads in the web root of the vihansoft domain, in a repository under\na now-shuttered Github user account, and on the mrbfile.xyz and mrbftp.xyz domains, as\nwell as on a small number of IP addresses.\n\nThe compiled cryptominer binaries were compressed into zip files that contained .PDB\ndebug info. These strings are artifacts of the compiler used on the machine where the\nexecutable was built. The PDB debug strings included a build path with the line ”\nC:\\Users\\_____\\” in it (with the name redacted here), indicating the user account under which\nthe binary was compiled. This string matches the name associated with the Github account.\n\n\n-----\n\nCryptocurrency data was sent to wallets on the poolmrb.xyz and mrbpool.xyz domains as\nwell as to the pool.supportxmr.com domain. Miner malware downloaded from the vihansoft.ir,\nmrbfile, and mrbftp domains communicated with the poolmrb/mrbpool domains.\n\nNeither the “mrb” domains nor vihansoft had any usable WHOIS information, but they did\nhave one other thing in common: They all used the same WHOIS privacy service,\nWhoisGuard, based in Panama, to conceal the domain ownership information.\n\n## Detection and IoCs\n\nCryptominer samples of MrbMiner are detected in Sophos Endpoint Protection under the\ndefinition Troj/Miner-ZD.\n\n[Additional indicators of compromise have been published to the SophosLabs Github.](https://github.com/sophoslabs/IoCs/blob/master/Miner-Mrbminer.csv)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-21 - MrbMiner- Cryptojacking to bypass international sanctions.pdf"
    ],
    "report_names": [
        "2021-01-21 - MrbMiner- Cryptojacking to bypass international sanctions.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535894,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1653774111,
    "ts_modification_date": 1653774111,
    "files": {
        "pdf": "https://archive.orkl.eu/1849dc31cfaddae23ba6b15d3dccac2e36c1bb44.pdf",
        "text": "https://archive.orkl.eu/1849dc31cfaddae23ba6b15d3dccac2e36c1bb44.txt",
        "img": "https://archive.orkl.eu/1849dc31cfaddae23ba6b15d3dccac2e36c1bb44.jpg"
    }
}