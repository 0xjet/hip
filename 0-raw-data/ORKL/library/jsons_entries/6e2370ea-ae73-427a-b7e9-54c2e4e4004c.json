{
    "id": "6e2370ea-ae73-427a-b7e9-54c2e4e4004c",
    "created_at": "2023-01-12T14:58:57.544573Z",
    "updated_at": "2025-03-27T02:16:25.531526Z",
    "deleted_at": null,
    "sha1_hash": "4a218181c8e688631cbb1cf0f0e127d3eb78ff98",
    "title": "2022-08-04 - Brata - a tale of three families",
    "authors": "",
    "file_creation_date": "2022-10-02T12:03:24Z",
    "file_modification_date": "2022-10-02T12:03:24Z",
    "file_size": 2241198,
    "plain_text": "# Brata - a tale of three families\n\n**threatfabric.com/blogs/brata-a-tale-of-three-families.html**\n\n04 August 2022\n\n## Intro\n\n\n-----\n\nThe infosec community has a very long and undeniably bad record when it comes to naming malware families. May it be\nthe tendency of calling anything new that appears in the wild a variation of the dreaded <Some-string-i-found-in-the**malware>Bot, or the necessity to note down all the different aliases used by different vendors to refer to the same malware**\nfamily.\n\nThis problem is known, and often joked about among researchers: in 2022 this issue has been evident with many malware\nfamilies, like Anatsa, beign known also as TeaBot or Toddler, and Cabassous, known also as Flubot.\n\nIt is not as common for the opposite problem to arise: it is infact quite rare for different malware families to share the same\nname. However, ThreatFabric believes this is exactly the case for what has been referred to as Brata.\n\nWe believe that what has been up to now categorized as Brata, is instead a conglomerate of 3 different families: Brata,\nAmexTroll, and Copybara.\n\nIn addition, for the for the first time we observed AmexTroll expanding its focus, from targeting only a few institutions in Italy,\nto featuring almost 50 different targets, among British and Australian institutions.\n\n## The Brata saga\n\nThe first appearance of this name dates back to middle of 2019, while this malware family was reported to abuse a CVE in\nthe popular instant messaging application WhatsApp to target victims in Brazil.\n\nThis malware family was also capable of keylogging data from victim’s devices thanks to Accessibility Service abuse, like\nmost modern malware families are able to do nowadays.\n\nThis campaign lasted about 6 months, and no new samples of this family were observed after the end 2019.\n\nAfter these events, there was no mention of this malware family until the end of 2021, where reports of a new strain of\nBrata targeting Italy started circulating. These reports were mentioning two new variants of Brata, this time active in\nEurope, more specifically in Italy, with many new features and Modus Operandi.\n\nAccording to the research published, the two variants were supposed subsequent iterations of the same malware family.\nHowever, ThreatFabric observed these two families being distributed simultaneuously, and through different channels,\nthroughout the first half of 2022.\nWe also believe these two families to be different in implementation and scope, and\n\n\n-----\n\n**quite possibly operated by different actors. This is the reason why we do not refer to these families by the name Brata,**\nbut with two separate, different, names:\n\n**AmexTroll and Copybara.**\n\nThe incredible confusion within the Infosec community and financial institutions about AmexTroll and Copybara, and their\nalleged connections with Brata, pushed us to create this blog.\n\nThese two families share a few similarities, which led to this mistake in categorization. In addition, some leaked messages\nfrom the author of AmexTroll allegedly connect him to the development of the original Brata.\n\nHowever, the differences are evident and substantiate the need to differentiate between the two, despite the possibility of\nhaving the same threat actor behind them.\n\n## Similarities\n\n### Basic 4 Android (B4A)\n\nThe two malware families do indeed share a few similarities in their overall design and development. Apart from being both\nAndroid Bankers, the most obvious commonality is the tools used for their development. Android natively supports two\nlanguages, Java and Kotlin. In addition, by using the JNI (Java Native Interface), developers can also interact with code\nwritten in C/C++, via a system of shared libraries.\n\nThe large majority of Android malware is developed using a combination of these two approaches. However, for both of\nAmexTroll and Copybara, the tool of choice is Basic 4 Android (from here onwards referred to as B4A).\n\n**NOTE : ThreatFabric would like to note that B4A and the B4X suite are completely legitimate programs, and that**\n**the developers that created this project have no control over the misuse of their software.**\n\n\n-----\n\nB4A belongs to the B4X suite, developed by “Anywhere Software”. Its name comes from its similarity to BASIC, despite it\nbeing an independent and proprietary language in its own. The framework relies on a combination of simple UI based\ndesigner tools and its BASIC-like language. The framework will then interpret the designs and code in the project and will\ncreate a corresponding, valid APK.\n\nAmexTroll and Copybara are not the only malware families built using this software, despite being arguably the most\nadvanced ones, and the appearance of such families roughly coincides with B4A becoming a free product.\n\nIn addition, this framework does not provide a built-in way to easily interact with the Accessibility services, but any average\ndeveloper should be able to implement a simple bridge class to interface the framework with. In both our cases, actors\nseem to be using modified versions of libraries published online by other B4A users on developer forums.\n\n### Capabilities\n\nIn terms of capabilities, the two families do share a few common features. Most notably, they both are Android malware\nfamilies targeting mostly Italy. In addition they also operate similarly in the way they perform screenstreaming:\n\nboth generate a series of screenshots every few milliseconds, which then send to the C2 to mimic a real-time video stream.\nIn this way, operators on the other side can interact with the device remotely, allowing criminals to perform actions directly\non the infected device. This feature is the key to perform On-Device Fraud (ODF) once PIIs are exfiltrated, and is\nimplmented in both cases using libraries publicly available on the B4A forum.\n\n\n-----\n\nBoth families also sport a relatively unique feauture, which allows to remotely initiate a factory reset on the device,\npotentially to disrupt investigations or clean the device from possible traces of infection. This feature is also not new, and\nwas observed mostly in CIS malware a few years ago. However, due to its disruptiveness and debatable usefulness, it has\nbeen mostly abandoned. The feature is implemented with the same exact code in the two families. The code is the\nfollowing:\n```\nif(accservice._manager.getEnabled()) {\n\n Reflection reflection0 = new Reflection();\n\n reflection0.Target = accservice._manager;\n\n reflection0.Target = reflection0.GetField(\"dm\");\n\n reflection0.RunMethod2(\"wipeData\", \"0\", \"java.lang.int\");\n\n return \"\";\n\n}\n\n\n```\nHowever, it is worth noting that this code, as well as the code responsible for the screenshot stream, is also available online\non the B4A forum, published on public threads. Considering that both families also use other code, developed and\npublished by other users on the same forum, it is not a sufficient motive to connect the two families.\n\n## Differences\n\nWhat follows is not an extensive description of the features of the two malware families, as that has been already done by\nother researchers. It is a study on the differences that motivate the need for a separate categorization.\n\n### AmexTroll\n\n\n-----\n\nThe AmexTroll family has been active since the second half of 2021, with a few initial test samples being distributed,\ntargeting Italian institutions. The first campaign was quite limited in size, and was followed a few months after, between the\nend of 2021 and the beginning of 2022, by more refined campaigns, still targeting Italy, posing as an array of security\nrelated applications.\n\nRecently, new developments brought this family on the spotlight again. The main reason behind this was the public\nannouncement done by the actor behind its development, very likely of Brazilian origin, who put it on the market for a beta\n**test of a rental scheme for his/her product. This was a notable event for this family, as up to this point it was privately ran.**\n\nThe beta was able to find enough backers to proceed, as can be seen by the telegram account used to sell access to the\nbot:\n\n\n-----\n\nAfter this announcement, the number of samples for this family started to increase, and so did the amount of different\napplications it poses as: mostly brazilian institutions as well as more generic security applications.\n\nOne feature that is specific to AmexTroll with respect to other malware families (but which incidentally exists also in the\noriginal Brata), is the “black overlay” feature. As the name implies, it simply consists of being able to generate a\ncompletely black overlay to display on the foreground of the device’s UI. This feature, despite being very simple, is also\nvery dangerous for infected victims.\n\nHere is the code responsible for this feature. As you can see, it sets up the overlay to have RGB values [0,0,0], which\ncorresponds to black, and opacity value equal to 1. After, it calls the method responsible for overlaying the screen on the\nforeground of the UI.\n```\npublic static String _open_black_overlay(String opacity) throws Exception{\n\n  PanelWrapper panelWrapper0 = new PanelWrapper();\n\n  panelWrapper0.Initialize(websock_service.processBA, \"\");\n\n  panelWrapper0.setColor(Colors.ARGB(((int)Double.parseDouble(opacity)), 0, 0, 0)); //\n\n  int v = vnc_var._get_resolution(websock_service.processBA, true);\n\n  int v1 = vnc_var._get_resolution(websock_service.processBA, false);\n\n  JavaObject javaObject0 = new JavaObject();\n\n  javaObject0.InitializeContext(websock_service.processBA);\n\n  javaObject0.RunMethod(\"criar_overlay_acess_simple\", new Object[]{panelWrapper0.getObject(), ((int)0),\n((int)0), v, v1});\n\n  overlay_var._setstate_locked(websock_service.processBA, false);\n\n  websock_service._reset_overlay(false);\n\n  websock_service._sender_sucessmessage(\"TRAVADO\");\n\n  return \"\";\n\n}\n\n\n```\nThe main MO of AmexTroll, which also differentiates it from Copybara, is the same overlay mechanism that is very common\namong other banking trojan families. Whenever the overlay is triggered, the bot automatically opens a WebView with the\ncorresponding phishing overlay to steal the wanted PII. The implementation slightly differs from the standard used in other\nfamilies due to its development cycle, but the logical steps are the same.\n\n\n-----\n\nInitially the targets returned were limited, and mostly focusing on the italian market. However, recently, a campaign that was\ndistributed through a dropper on the Google Play store, was observed targeting institutions from Australia and Great\n**Britain. The intelligence of this dropper confirm that the campaign was live for only a few days, with thousands of**\ndownloads in the aforementioned geolocations:\n\n### Copybara\n\nThe Copybara family has also been active from the second half of 2021. The reason behind this might be found in the fact\nthat the B4A framework became a free product in February 2020. Its campaigns came into full scope in 2022, and differ\nfrom AmexTroll for the reason that they are very focused not only on the Italian market but also very specifically on singular\n\n\n-----\n\ninstitutions.\n\nThe malware itself, similarly to AmexTroll, is able to create a remote connection with the C2 and allow criminals to\nperform On-Device Fraud on the infected device. However, Copybara greatly differs in the way that it obtains PIIs.\n\nSimilarly to AmexTroll, it features an overlay mechanism, but in this case it is specific to the application it is posing as (in a\nway that is very similar to what malware use to do before the use of accessibility services became prevalent). ThreatFabric\nhas found samples posing as a variety of italian institutions; however, the overlay is consistently the same within this set of\napplications.\n\nNewer variants of this family also introduced additional modules and APKs, which add functionalities to the malware\nitself. The main Copybara application is able to download an external module, capable of perfoming Accessibility event\nlogging, a feature that is extremely important when implementing On-Device Fraud, as it allows criminal to have a full\nvisibility and actionability on all the UI elements on the victim’s devices, as well as allowing to implement a very inclusive\nkeylogging mechanism.\n```\nif(acs.GetIsStringTypeText().toString().length() > 0 && accessibilityNodeInfo0 != null &&\n(var1.getClassName().equals(\"android.widget.EditText\"))) {\n\n if(accessibilityNodeInfo0.getActionList().contains(AccessibilityNodeInfo.AccessibilityAction.ACTION_SET_TEXT))\n{\n\n  Bundle var4 = new Bundle();\n\n  var4.putCharSequence(\"ACTION_ARGUMENT_SET_TEXT_CHARSEQUENCE\", acs.GetIsStringTypeText().toString());\n\n  accessibilityNodeInfo0.performAction(0x200000, var4);\n\n }\n\n else if(TextUtils.isEmpty(accessibilityNodeInfo0.getText())) {\n  accessibilityNodeInfo0.performAction(0x8000);\n\n }\n\n else if(!accessibilityNodeInfo0.getText().toString().toString().contains(acs.GetIsStringTypeText().toString()))\n{\n\n  accessibilityNodeInfo0.performAction(0x8000);\n\n }\n\n acs.IsStringTypeText(\"\");\n\n}\n\n```\n\n-----\n\nCombined with the additional modules, copybara utilizes some companion apps that deal with SMS monitoring and refer to\nthe same C2 as the main malware. These apps are used to retrieve possible 2FA tokens from banks, as well as monitoring\neven further the device. These are also distributed through the same web phishing channels as Copybara.\n\nHowever, the real strength of Copybara lies within the criminal group behind it. The lack of flexibility in this malware family\nis greatly balanced by the care and precision of its social engineering approach.\n\nCopybara, by virtue of being privately run, is able to heavily rely on TOAD (Telephone-oriented attack delivery), which\ninvolves operators calling the victim to convince them to install and grant all the necessary permissions to function. This is\nthe main difference between this family and AmexTroll, and one of the main reasons why ThreatFabric feels very confident\nin differentiating these two families.\n\nUsers may be very skeptical about applications downloaded from the Web (problem that AmexTroll tackles by using\ndroppers on Google Play Store to gain trust from users).\n\nCopybara is distributed via SMiShing. Victims receive a SMS from their bank with a link, followed by a call by the\n**operator to guide them through the process. The additional step of being called by an operator adds credibility to the**\noperation, encouraging users to install the malware with the promise of being safer and more protected.\n\nThis approach is very effective, and justifies the nature of the malware itself. The group behind Copybara works with much\nmore limited numbers of infections, due to the necessity of an operator interaction with the victim. However, this step also\nensures a much higher success rate.\nThis also may be the reason why this family is heavily focused on the italian market.\nThis approach requires to heavily tailor the process to the banking institution targeted, so it makes sense for criminals to\nfocus on one language at a time.\n\n## Conclusions\n\nThe mobile malware landscape is continuously evolving and mobile users are continuously facing new and different threats.\nIn 2022, ThreatFabric has observed a strong shift towards On-Device Fraud. AmexTroll and Copybara confirm this trend,\nwhile adding their own flair to the standard Android Banking Malware features, one being technical addition to make\ninfection stealthier and more effective, the other relying on the human aspect of phishing, to literally coach victims into\ncorrectly infecting their own devices.\n\nThreatFabric expects to see more from both of these families, which are alive and active at the time of writing this blog.\n\n\n-----\n\n## MTI & CSD\n\nOur Mobile Threat Intelligence (MTI) service provides financial institutions with a better visibility on the increasing threat of\nmobile banking malware. Banks who are using MTI understand which malware campaigns are targeting their mobile\nchannel and how their mobile banking users are impacted.\n\nWith our Client Side Detection (CSD) service we are helping financial institutions to gain visibility on (potential) fraud by\nmobile banking malware, and to prevent it. If you would like to know more about how we use our mobile threat intelligence\n[to detect mobile banking malware on mobile devices, feel free to reach out to sales@threatfabric.com.](mailto://sales@threatfabric.com)\n\n## Appendix\n\n### Brata Samples\n\n**App name** **Package name** **SHA-256**\n\n\nAtualização\nWhatsApp\n\n\ncom.da9d84d1 22a841da43ced0f2bb829780a4aa6a2ffaeb56d2a5e98d2f1bd62e1b8d70b967\n\n\ncom.helper.android com.helper.android 91ab6e70655abdef8e79eaeb0d83c02246037e2fc168eec956192fac4fcecea6\n\nVivo Internet Gratis com.vivointernetgratis 4c57c5eae5a1bae1a50beed28affdff722c89416886e5eda8088a06771cc29c8\n\n\nAtualização WA\n2.5\n\n\ncom.waatt25 fa816c631249922539eeeb3e8f73d3ef4ea997ab729751adebcea3d0de32a63b\n\n\n### AmexTroll Samples\n\n**App name** **Package name** **SHA-256**\n\nA Shield Auth horse.house.homer f530c66fb1f7ac5e2e9a89c1f410e498dc59eecbec8bae29a9f69ab3dc7ce86c\n\n\n1. Itau Modulo\nSegurança\n\n1. TEST APP\nKOALA (Test\n**app)**\n\n1.\nSICUREZZA\nANTISPAM\n\n\nkoala.viber.vip 02aa9061b47762ce1627d38195097c0e791864004e509598269ffa8fb2e25103\n\nmalware.malware.virus 1032b42c859c747bcc159b75366c3325869d3722f5673d13a7b06633245ebf32\n\nkoala.kerox.vip 38952ffe92afea051cea6de48b765274f5344ae2add07820995340faf546e220\n\n\n### Copybara Samples\n\n**App name** **Package name** **SHA-256**\n\nBanca Sicura com.com.app.isp 4074d2c885462ffb52d5ffb7d024ad1e7c50aa794bea3a0c9f2292fcebc7018f\n\nToken ISP com.apk.isp.intesa 1698e5a1425903d576d4eeb8e25b0ec4f1091971cea3a61bfb83c2a5b514e306\n\n\nUniCredit\nSicura\n\n\ncom.app.app.unicredit 7386eac4c4093b2ab433131edef48a2846ed11ce7d58e7069fe5531ae549f29c\n\n\nBanca Sicura com.banca.sicura.app 94f1a33d4f3bd94f65f8969f288fe01a198952c17e52c9e86e4047222d45f0ce\n\n### AmexTroll targets\n\n**PackageName** **AppName**\n\nau.com.bankwest.mobile Bankwest\n\n\n-----\n\n**PackageName** **AppName**\n\nau.com.commbank.commbiz.prod CommBiz\n\nau.com.cua.mb CUA Mobile Banking\n\nau.com.hsbc.hsbcaustralia HSBC Australia\n\nau.com.macquarie.banking Macquarie Mobile Banking\n\nau.com.mebank.banking ME Bank\n\nau.com.nab.mobile NAB Mobile Banking\n\nau.com.newcastlepermanent NPBS Mobile Banking\n\nau.com.rams.RAMS myRAMS\n\nau.com.suncorp.rsa.suncorpsecured Suncorp Secured\n\nau.com.suncorp.SuncorpBank Suncorp Bank\n\nau.com.ubank.internetbanking UBank Mobile Banking\n\nco.zip Zip - Shop Now, Pay Later\n\ncom.anz.android.gomoney ANZ Australia\n\ncom.anz.transactive.global ANZ Transactive - Global\n\ncom.bankofqueensland.boq BOQ Mobile\n\ncom.bendigobank.mobile Bendigo Bank\n\ncom.commbank.netbank CommBank\n\ncom.fusion.banking Bank Australia app\n\ncom.fusion.beyondbank Beyond Bank Australia\n\ncom.greater.Greater Greater Bank\n\ncom.hsbc.hsbcnet HSBCnet Mobile\n\ncom.virginmoney.cards Virgin Money Credit Card\n\norg.banking.bom.businessconnect Bank of Melbourne Business App\n\norg.banking.bsa.businessconnect BankSA Business App\n\norg.banking.stg.businessconnect St.George Business App\n\norg.banksa.bank BankSA Mobile Banking\n\norg.bom.bank Bank of Melbourne Mobile Banking\n\norg.stgeorge.bank St.George Mobile Banking\n\norg.westpac.bank Westpac Mobile Banking\n\norg.westpac.col Westpac Corporate Mobile\n\nco.uk.Nationwide.Mobile Nationwide Banking App\n\ncom.barclaycardus Barclays US\n\ncom.cooperativebank.bank The Co-operative Bank\n\ncom.grppl.android.shell.CMBlloydsTSB73 Lloyds Bank Mobile Banking: by your side\n\n\n-----\n\n**PackageName** **AppName**\n\ncom.grppl.android.shell.halifax Halifax: the banking app that gives you extra\n\ncom.ie.capitalone.uk Capital One UK\n\ncom.nearform.ptsb permanent tsb\n\ncom.rbs.mobile.android.natwest NatWest Mobile Banking\n\ncom.revolut.revolut Revolut - Get more from your money\n\ntsb.mobilebanking TSB Bank Mobile Banking\n\nuk.co.hsbc.hsbcukmobilebanking HSBC UK Mobile Banking\n\nuk.co.metrobankonline.mobile.android.production Metro Bank\n\nuk.co.santander.santanderUK Santander Mobile Banking\n\nuk.co.tsb.newmobilebank TSB Mobile Banking\n\nit.carige Carige Mobile\n\n### Copybara targets\n\n**Bank**\n\nUnicredit Banca\n\nBanca Intesa\n\nBNP\n\nBPER Banca\n\nPoste Italiane\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-04 - Brata - a tale of three families.pdf"
    ],
    "report_names": [
        "2022-08-04 - Brata - a tale of three families.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535537,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1664712204,
    "ts_modification_date": 1664712204,
    "files": {
        "pdf": "https://archive.orkl.eu/4a218181c8e688631cbb1cf0f0e127d3eb78ff98.pdf",
        "text": "https://archive.orkl.eu/4a218181c8e688631cbb1cf0f0e127d3eb78ff98.txt",
        "img": "https://archive.orkl.eu/4a218181c8e688631cbb1cf0f0e127d3eb78ff98.jpg"
    }
}