{
    "id": "64bed9d0-c43f-4eec-afba-b27933e828e3",
    "created_at": "2022-10-25T16:48:19.36919Z",
    "updated_at": "2025-03-27T02:17:15.061085Z",
    "deleted_at": null,
    "sha1_hash": "caf252729256e6060cdd1a1b79c1601bbb9e57f5",
    "title": "Operation Earth Kitsune: Tracking SLUB’s Current Operations",
    "authors": "",
    "file_creation_date": "2020-10-19T21:32:54Z",
    "file_modification_date": "2020-10-19T21:33:10Z",
    "file_size": 4086749,
    "plain_text": "-----\n\n**TREND MICRO LEGAL DISCLAIMER**\n\nThe information provided herein is for general information\n\nand educational purposes only. It is not intended and\n\nshould not be construed to constitute legal advice. The\n\ninformation contained herein may not be applicable to all\n\nsituations and may not reflect the most current situation.\n\nNothing contained herein should be relied on or acted\n\nupon without the benefit of legal advice based on the\n\nparticular facts and circumstances presented and nothing\n\nherein should be construed otherwise. Trend Micro\n\nreserves the right to modify the contents of this document\n\nat any time without prior notice.\n\nTranslations of any material into other languages are\n\nintended solely as a convenience. Translation accuracy\n\nis not guaranteed nor implied. If any questions arise\n\nrelated to the accuracy of a translation, please refer to\n\nthe original language official version of the document. Any\n\ndiscrepancies or differences created in the translation are\n\nnot binding and have no legal effect for compliance or\n\nenforcement purposes.\n\nAlthough Trend Micro uses reasonable efforts to include\n\naccurate and up-to-date information herein, Trend Micro\n\nmakes no warranties or representations of any kind as\n\nto its accuracy, currency, or completeness. You agree\n\nthat access to and use of and reliance on this document\n\nand the content thereof is at your own risk. Trend Micro\n\ndisclaims all warranties of any kind, express or implied.\n\nNeither Trend Micro nor any party involved in creating,\n\nproducing, or delivering this document shall be liable\n\nfor any consequence, loss, or damage, including direct,\n\nindirect, special, consequential, loss of business profits,\n\nor special damages, whatsoever arising out of access to,\n\nuse of, or inability to use, or in connection with the use of\n\nthis document, or any errors or omissions in the content\n\nthereof. Use of this information constitutes acceptance for\n\nuse in an “as is” condition.\n\nPublished by\n**Trend Micro Research**\n\nWritten by\n**Nelson William Gamazo Sanchez,**\n**Aliakbar Zahravi, John Zhang, Eliot Cao,**\n**Cedric Pernet, Daniel Lunghi,**\n**Jaromir Horejsi, and Joseph C. Chen**\n\nStock image used under license from\n\nShutterstock.com\n\n_For Raimund Genes (1963-2017)_\n\n\n### Contents\n\n#### 3\n###### Introduction\n\n#### 6\n\n###### Overview of Operation Earth Kitsune\n\n#### 9\n###### The Chrome Exploit Vector\n\n#### 17\n###### SLUB’s Mattermost Evolution\n\n#### 26\n###### Conclusions\n\n\n-----\n\nWe previously wrote[1, 2] about the SLUB malware in 2019, noting that it abused (among\n\nothers) Slack and GitHub as part of its routine. Its previous campaigns used watering hole\n\ntactics as an infection vector, using websites that discussed topics related to North Korea.\n\nOur continuous monitoring of this threat campaign shows that the threat actor behind SLUB\n\ndidn’t stop their attacks even during the pandemic. In 2020, we found multiple instances of\n\ntheir attacks in March, May, and September, delivering a new variant of the malware — this\n\ntime incorporating new techniques and capabilities.\n\nIn addition, we found two unknown malware variants delivered along with SLUB during the\n\nlatest attack at the end of September. Besides the CVEs already mentioned in the previous\n\nSLUB blog, we also found new exploits for the vulnerabilities CVE-2016-0189¸ CVE-2019-\n\n1458, CVE-2020-0674, and CVE-2019-5782, chained with another Chrome bug that does\n\nnot have an associated CVE.\n\nThe campaign is very diversified, deploying numerous samples to the victim machines and\n\nusing multiple command-and-control (C&C) servers during this operation. In total, we found\n\nthe campaign using five C&C servers, seven samples, and exploits for four N-day bugs. The\n\nscale of the attack and the samples’ custom design suggest that there is a group behind\n\nthis operation. We dubbed the campaign as Operation Earth Kitsune.\n\n**Victim accesses**\n\n**Exploit runs,**\n\n1 **watering hole** 2 **malware loader run**\n\n**website**\n\n**Slub** **Slub C2 Server**\n\n**Mattermost**\n\n**Watering hole** **Powershell**\n**website injected with** **Loader**\n**CVE-2020-0674**\n\n**Victim** **dneSpy** **C2 Server**\n\n**Watering hole** **Shellcode**\n**website injected with** **Loader**\n**CVE-2019-5782**\n\n**agfSpy** **C2 Server**\n\nFigure 1. Infection chain for Operation Earth Kitsune\n\n\n-----\n\nOne distinguishinged characteristic of the operation is the type of websites it targets for\n\ncompromise to deploy the spying samples. During the our analysis, we was found that the\n\noperation used international associations on the compromised websites associated with\n\nNorth Korea to deploy the N-day and work as a server for hosting malware that it deploys\n\nusing multiple attack vectors.\n\nInterestingly enough,access to these websites is blocked for users with South Korean IP\n\naddresses, so this watering hole campaign likely targets the worldwide Korean diaspora\n\nthat is interested in Korean issues.\n\nFigure 2. Accessing the pro-North Korean website from a South Korean IP address\n\nFigure 3. Translation of the warning message using Google Translate\n\n\n-----\n\nAll the analyzed websites are linked, with some of them even linked from their front pages.\n\nFurthermore, we found that all the compromised servers are using GNUBOARD,[3] a South\n\nKorea Content Management System (CMS). We couldn’t identify if the compromised\n\nwebsites were attacked using an N-day or 0-day attack; the only data we have only\n\nindicated that some of them were running GNUBOARD v4 and GNUBOARD v5. However,\n\nboth versions had reported RCE vulnerabilities, which led us to think that the websites were\n\ncompromised using one of the existing N-days.\n\nOne of this publication’s intentions, apart from uncovering the campaign, is to increase\n\nawareness of the risks in using GNUBOARD. We did a quick scan and found almost a\n\nhundred websites using GNUBOARD, with some hosted using the older version 4. Note\n\nthat our scan was limited to websites that we were interested in doing research on and\n\nrelated to this publication, so in that sense, we assume that the use of GNUBOARD is much\n\nmore expansive.\n\nDuring our investigation of the samples, we found one that was very similar to SLUB, but\n\ninstead of using Slack, it used Mattermost,[4] an open-source version replacement for Slack\n\n(we have reached out to Mattermost regarding this issue, and they have since released a\n\nstatement that can be read in the conclusion). We considered this sample a new variant of\n\nSLUB.\n\nWe discovered that the first installation date of the malicious Mattermost server was March\n\n10, 2020, which indicated when the “mm” (SLUB) samples started to become active. After\n\nfurther analysis we tracked back the Mattermost activity to February, 2020 as will be\n\ndiscussed later.\n\nThe six binaries we discovered in the samples were three different malware variants,\n\nincluding SLUB. Besides the SLUB variant, we found two other malware we named dneSpy\n\nand agfSpy, following the same naming convention of the attacker for the first three\n\ncharacters. Our analysis revealed that the samples did not contain any functionality related\n\nto financial interests — instead, we found features intended to exfiltrate information and\n\ncontrol infected systems.\n\nAnother notable characteristic of this operation is that, in both vectors, the attacker skipped\n\nthe samples’ deployment to the target machine if certain security products were installed\n\non it. Further sections will show the list of excluded security products. This implies that the\n\nattacker targets unprotected systems and is concerned with remaining stealthy — at least\n\nin the current stage of the operation.\n\nWhile examining dneSpy, we found that the sample C&C server is configured to target\n\ncertain types of victims, with location as a criteria. Once the victim’s system is infected,\n\nthe malware creates an account in the server, which exempts the victim from future\n\ninfections. The attacker might have made some errors during this part of the process, as\n\nwe encountered some situations where the samples crashed if it was already registered.\n\nWe think that the group behind these attacks is the same one operating the SLUB malware.\n\nThe following section will provide a general view of the campaign and the relation between\n\nthe different samples, after which we will describe each sample separately.\n\n\n-----\n\n## Overview of Operation Earth Kitsune\n\nDuring our day-to-day process of triaging indicators of compromise (IOCs), we noticed a suspicious\n\ntrigger coming from the Korean American National Coordinating Council (KANCC) website redirecting the\n\nvictim machine to the Hanseattle website. The redirection landed on a weaponized version of a proof of\n\nconcept exploit for CVE-2019-5782 published in the Google Chromium tracking system as issue 1755[5]\n\n(Figure 4 shows the actual redirection). Both of these websites are North Korea international organizations,\n\nand hosted on the GNUBOARD CMS.\n\nFigure 4. Redirection to CVE-2019-5782\n\nFurther investigation revealed that the attack was more complex than just a weaponized version of the\n\nmentioned Chrome exploit. The exploit was infecting the victim machine with three separate malware\n\nsamples, as shown on the right side of Figure 5.\n\n\n-----\n\n|Compromised websites|Col2|\n|---|---|\n|||\n|||\n\n\n**IE Exploit** **Chrome exploit**\n(CVE-2020-0674) (CVE-2019-5782)\n\n**Powershell vector** **Shellcode**\n\n**Dropper.dll connects**\n**to the same server**\n**as “dne”**\n**Identified C&C servers**\n**hosting different samples**\n\n**Dropper.dll**\n\n**mm** **mm**\n\nSamples dropped Samples dropped\n\n**C&C server**\n\n**20200209122021_edfelqat.jpg** **1.jpg**\n\n**dne** **dne**\n\n**C&C server**\n\n**C&C server**\n\n**20200209122021_qifxyren.jpg** **2.jpg**\n\n**agf** **agf**\n\n**C&C server**\n\n\n**20200209122021_abjeuitk.jpg**\n\n\n**3.jpg**\n\n\n**C&C server**\n\n\nNotes:\n“mm,” “dne,” and “agf” are the names the\nattacker used for the captured samples\n\nmm == Mattermost\n\n\nFigure 5. The attack vectors used in the campaign\n\nWe also found another exploit abusing CVE-2020-0674, an Internet Explorer vulnerability injected\n\ninto compromised websites. In particular, it runs a PowerShell loader that will infect victims with three\n\ndifferent binaries. Comparing the PowerShell script samples with the ones deployed through the Chrome\n\nexploit show that, while they are separate binaries, they are actually the same malware variant. The\n\nPowerShell script is responsible for dropping SLUB, dneSpy, and agfSpy when the attack vector is IE;\n\n\n-----\n\nwhen the Chrome exploit is used as the attack vector, the exploit shellcode is responsible for dropping\n\nthe mentioned malware, as showed in Figure 5. This PowerShell script has a “jpg” extension and its logic\n\nis encoded in base64, as shown in Figure 6.\n\nFigure 6. The PowerShell script responsible for delivering samples\n\nFigure 5 shows a three-letter name associated with the samples “mm,” “dne,” and “agf,” which are\n\nacronyms that the attacker gave to the different samples. The “mm” sample is a new version of SLUB that\n\nuses MatterMost instead of Slack. We were able to assign those acronyms to all the samples by following\n\nthe PowerShell code logic and correlating the samples delivered by the Chrome exploit. The only acronym\n\nwe can guess the meaning of is the “mm,” which we assume comes from Mattermost (which is used as a\n\nC&C server). Note that the samples delivered by the PowerShell script and those delivered by the Chrome\n\nexploit communicate with the same C&C server.\n\nThe following sections will describe the attack vectors shown in Figure 5.\n\n\n-----\n\n## The Chrome Exploit Vector\n\nThe Chrome exploit involves chaining two vulnerabilities that have already been patched, with one\n\nassigned as CVE-2019-5782, while the other does not have an associated CVE identifier. The attacker\n\nreused the POC code to implement a weaponized version of it. Two customizations were included: the\n\nfirst change separates the shellcode to load it in from the JavaScript-encoded version, as shown in Figure\n\n7 (data.js contains the definition of the encoded shellcode). The second change includes new devices to\n\nsupport other OS versions.\n\nFigure 7. File structure\n\nThe details of the bug are not going to be discussed here as public analysis of it are already available.[6]\n\nInstead, we will focus on the details of the shellcode and malware delivered by this operation. The next\n\nsection will tackle the shellcode, the dropper.dll, and the SLUB sample using Mattermost.\n\n##### The Shellcode\n\nThe shellcode is a custom code made by the attacker. Figure 8 illustrates its general logic.\n\n\n**Deobfuscate** **Initialize C&C** **Send request to C&C**\n**names** **connection** **server for the name:**\n**dropper.dll**\n\nFigure 8. The shellcode logic\n\n\n**Creates a dll file:** **Load the dll**\n**_.dll**\n\n\n-----\n\nUpon execution, the shellcode first de-obfuscates “ws2_32.dll” and “_.dll,” and then resolves the API\n\nmodules based on their hashes using a known technique.[7] The malware uses ROT 12h to decipher the\n\nstrings — for example, the “ws2_32,dll” string seen in Figure 9.\n\nFigure 9. Deobfuscation of the ROT strings\n\nThe shellcode then initializes the network connection, deobfuscates the file to be download, and sends\n\na request to the C&C server. It constructs two network requests, the first is the length and the second is\n\nan obfuscated version of the string “dropper.dll”. It then creates a second request by applying the NOT\n\noperation to the “dropper.dll” string as displayed in the shellcode code section in Figure 10.\n\nFigure 10. Dropper.dll C&C request\n\nThe shellcode then attempts to receive the response (payload) from the C&C server, deobfuscate it using\n\nthe NOT operation, and store it into a file called “_.dll” in the current user’s temp directory before finally\n\nusing “kernel32.LoadLibraryA” to load the downloaded DLL payload into the address space of the running\n\nprocess.\n\n\n-----\n\nFigure 11. Loading the shellcode “_.dll”\n\nThe shellcode has some degree of sophistication using hashed APIs, string encodings, and custom C&C\n\ncommunication. At the same time, the C&C communication happens to be with TCP at DNS standard\n\nport (53) to avoid being blocked by a firewall. This shows that the attacker had to have a certain degree\n\nof dedication to implement the attack.\n\n##### The Dropper DLL\n\nAfter the shellcode execution, a “dropper.dll” file is downloaded from the C&C server. The dropper has\n\ntwo objectives: to check if the system is protected, and to download three more samples and execute\n\nthem. The following image shows the main dropper logic.\n\n\n-----\n\nFigure 12. The main dropper logic\n\nThe dropper uses dynamic loading system libraries to resolve the API entry points and call those APIs\n\ndynamically. The first step is to initialize the API entry points. The following code section shows the\n\ndynamic initialization logic.\n\nFigure 13. System API initialization\n\nNote that all the strings are obfuscated with library names like “kernel32.dll” and “w2s_32.dll.”\n\nOnce all the APIs are initialized, the dropper DLL checks for a list of known security software by comparing\n\nthe current processes to a predefined list. Figure 14 shows the predefined list of security software.\n\n\n-----\n\nFigure 14. The list of predefined security software\n\nThe list includes some of the most ubiquitous security products in the market, suggesting that the attacker\n\nis trying to infect unprotected users and avoid detection if possible. If the dropper detects any of the listed\n\nprocesses, it will abort execution\n\nIf it doesn’t detect any of the processes, the dropper will start downloading three more samples using\n\nthe same C&C communication format as the shellcode and connect to the same C&C server. The\n\nfollowing images show a partial view of the request and responses with the C&C communication channel.\n\nConnection with the C&C server happens on port 53 over TCP, intending to be confused with DNS traffic.\n\nFigure 15. The dropper’s C&C communication\n\nThe victim will send two sequences of bytes in separate packets. The first request is the size of the\n\nsecond request, while the second request is the file name to be retrieved. The original string name in the\n\nsecond request is NOTed before being sent (figure 15 shows an example of the real traffic). The server will\n\nthen send the file back to the victim’s machine.\n\nThe dropper will download three samples: “1.jpg,” “2.jpg,” and “3.jpg.” Each sample is executed as being\n\ndownloaded without any additional conditions. This attack generates a lot of red flags, but since the\n\nattacker has already vetted the machine for security software — therefore minimizing the chance of user\n\nprotection — the attacker can do a mass deployment of multiple components.\n\n\n-----\n\nThe following code section shows the download samples being executed inside the\n\n_DownloadAndExecuteSamples() function._\n\nFigure 16. Downloaded Samples Execution\n\n##### The Internet Explorer Vector and PowerShell\n\n Loader.\n\nAnother infection vector we found uses the Internet Explorer vulnerability CVE-2020-0674, which affects\n\nvarious versions of Internet Explorer, to infect victims. This vulnerability was discovered this year and is\n\nknown for being used in targeted attacks.[8] The exploit runs a shellcode, which then runs a few stages of\n\na PowerShell loader.\n\nFigure 17. The CVE-2020-0674 script used to deliver SLUB malware\n\n\n-----\n\nSimilar to the shellcode used in the Chrome exploit chain, the PowerShell version will check if the victim’s\n\nmachine is protected by certain security software. The PowerShell list is quite similar to the one used by\n\nthe shellcode with some process name variations, as shown in Figure 18.\n\nFigure 18. PowerShell vector security product list\n\nBased on this list, it downloads and executes up to three different backdoors. If instructed in the LPE\n\n(Local Privilege Escalation) column, the PowerShell loader may instruct downloading and executing\n\nan LPE binary exploiting CVE-2019-1458. This binary may download and execute the backdoors with\n\nsystem privileges.\n\nFigure 19 . List of malware payload locations\n\nAnother of the Powershell loader’s functions is recording the infections, likely for statistical tallying\n\npurposes. For this task, it uses the same server that hosts the malicious samples.\n\n\n-----\n\nFigure 20 . PowerShell code section infection report\n\nThe PowerShell loader will first send a request to the website using the URL referenced in the “$ip_web”\n\nobject to execute one PHP script that will capture the victim’s external IP to report the infection. After that,\n\nit will send another request that contains the external IP and the security software detected in the victim’s\n\nmachine. The security product is encoded according to the last column shown in Figure 21; for example,\n\n360 will be encoded as 5.\n\nWe were able to capture the report file in the server, and noticed that that most of the infections did not\n\nhave the listed security products nor any product at all (value 0) as shown in the figure below, which is a\n\npartial list of all infections.\n\nFigure 21 . Infections report showing a partial list of all infections\n\nThe next sections will describe the behavior of the mm/SLUB sample downloaded by the dropper.dll or\n\nPowerShell loader or LPE exploit.\n\n\n-----\n\n## SLUB’s Mattermost Evolution\n\nThis new variant is an evolution of the SLUB malware we documented in two blogs[9, 10] but with\n\ncommunication now based on the Mattermost service. The main advantage of using cloud services like\n\nSlack or Github was not having to deal with maintaining the infrastructure. As a drawback, the Github\n\ncontent can be taken down, and the Slack API tokens can be invalidated if reported, for example, by\n\nresearchers to the involved legitimate organizations.\n\nMattermost is an open-source replacement for Slack, and one of the most important advantages for\n\nthe attacker is that can it can easily be deployed on-premise. This way, the threat actor regains the\n\nadvantage of not having their API tokens invalidated by operating their own Mattermost server. In addition\n\nto Mattermost, REST API is feature-rich and easy to use. We think the threat actor migrated to Mattermost\n\nbecause of these advantages. The following section will describe the general behavior of the Mattermost\n\nversion of SLUB.\n\n##### SLUB’s behavior\n\nThe new SLUB variant interacts with the Mattermost server to keep track of the deployment across\n\nmultiple infected machines. It creates an individual channel for each machine to keep track of them.\n\nFigure 23 shows the general integration flow of the SLUB sample with Mattermost using the REST API.\n\nAll communication uses HTTP on port 443.\n\nFigure 22. Unsecure (HTTP) Mattermost server operating on port 443\n\n\n-----\n\nIn the case of the samples deployed using the Chrome exploit, the channel used is labeled “ZM.” The\n\nname channel “A” is generated uniquely for each infected machine. In addition to the main communicating\n\nchannel inside the selected Team, the SLUB samples also used the “notification” channel for real-time\n\nindication of new infections.\n\n###### Victim’s Mattermost machine server\n\n**Connect to Team: ZM**\n\n**ZM Team details, including ID**\n\n**Connect to the notification channel for ZM Team**\n\n**Create a new channel “A” in ZM Team**\n\n**Send information to channel \"A\"**\n\n**Send information to channel \"A\"**\n\nFigure 23. The Mattermost communication flow\n\nOnce the channel setup is finished, the SLUB sample starts collecting information about the machine\n\nand exfiltrates it back to the Mattermost server. First, it runs a sequence of commands and sends the\n\ninformation back to the channel. The following list shows all executed commands:\n\nFigure 24. The commands for exfiltrating system information\n\nAfter exfiltrating all the information from the previous command, SLUB captures a screenshot of the\n\nmachine and sends it to the malware channel.\n\nWe did a full simulation of the sample interacting with Mattermost in our lab environment. This gave\n\nus excellent inside information on how it would work in a real scenario. The following image shows the\n\nMattermost interface after the malware infects a machine. A set of text posts with the output of the\n\naforementioned commands are also included in the screenshot.\n\n\n-----\n\nFigure 25. Mattermost interface for exfiltrating system information\n\nThe objective of the SLUB samples was to exfiltrate a considerable amount of system information. We\n\nalso noticed that two other deployed samples allowed for additional control over the victim machine’s\n\nbehavior.\n\n##### The Mattermost Attacker’s Server\n\nWhile analyzing the new SLUB variant, we noticed that the communication with Mattermost needed an\n\nauthentication token with certain levels of permissions to, for example, create channels and send posts\n\nto those channels. The authentication token or bearer is sent as part of the HTTP header.\n\n\n-----\n\nFigure 26. The Mattermost authentication token\n\nAs mentioned earlier, during the communication with the C&C Mattermost server, two important parameters\n\nare fixed in the SLUB samples:\n\n- The bearer\n\n- Team name: ZM\n\nThat means the attacker may release sample variants using different Team names and bearers, depending\n\non the campaigns. Knowing this information will allow us to take a closer look at the activities of the\n\ncampaign.\n\nTo learn more about the attacker’s infrastructure, we reviewed the Mattermost API to understand how\n\nmuch information about the attacker we can get if we use the same Mattermost bearer that the SLUB\n\nsample used to connect to the server.\n\nBecause we did not know ahead of time that all the permissions the bearer has on the server is required,\n\nwe tried to perform API by API calls until we had a rough idea of what was needed. After a few tries, we\n\nwere able to extract the following data from the Mattermost server:\n\n- The list of channels.\n\n- The dump of all posts in each channel\n\n- The dump of all screenshots in each channel\n\n- The list of all users associated with the channels\n\n\n-----\n\nThis is a lot of information to talk about, so we are going to mention only the important parts.\n\nAs mentioned earlier, the campaign data indicates that two vectors are being used; one was using the\n\nPowerShell script while the other used the Chrome exploit shellcode to deploy the samples. In the\n\nPowershell vector, we discovered another Team name: MIN\n\nFigure 27. The Team name: MIN\n\nWe were able to extract all the listed artifacts from both channels.\n\nHere are the descriptions of some of the captured artifacts.\n\n###### Mattermost Teams\n\nThe Mattermost API is a user-friendly REST API that is simple to use. For example, to retrieve information\n\nabout a channel, the following command can be executed:\n\n\ncurl -i -H ‘Authorization: Bearer authen_code’ http://server_ip/api/v4/teams/name/CHANNEL_NAME\n\n\nThe following image shows the channel properties for both discovered channels as sending the request\n\nfrom each channel.\n\n\n-----\n\nFigure 28. Details of the MIM and ZM channels\n\nThe creation dates indicate when both campaigns started, showing that the campaign using the Chrome\n\nexploits started long before the one using the PowerShell vector.\n\n###### Mattermost Server Users\n\nUsing the REST APIs, we were able to retrieve the list of users created in the Mattermost server. At the\n\ntime of the conducted research, we found a total of 15 effective users. Three kinds of users were identified:\n\n**User type** **Count**\n\nBot user 1\n\nRegular user 13\n\nAdmin User 1\n\nTable 1. Type and number of users created in the Mattermost server\n\nThe following image shows the actual user list:\n\nFigure 29. Mattermost server users account\n\n|User type|Count|\n|---|---|\n|Bot user Regular user Admin User|1 13 1|\n\n\n-----\n\nThe list of users gives us an idea of the campaign’s activities over time because the dumped data has the\n\ncreation dates of the accounts. There is a “system_admin” (highlighted line in Figure 29) account, which\n\nwas created when the Mattermost server was installed. This indicates that the attacker started to set up\n\nthis server on March 10, 2020.\n\nAll the other accounts are regular user accounts but with two extra permissions: “system_user_access_\n\ntoken” and “system_post_all_public.” These two permissions allow the user to assign a token or bearer\n\nto write posts. As we mentioned earlier, the token is associated to SLUB samples at compilation time,\n\nsuggesting that several updated SLUB samples were already released at the time of our analysis.\n\nThe table shows five different months (March, April, July, August, and September). Although it is difficult\n\nto determine the exact objective of each user, the evidence shows that the attacker is using some sort\n\nof organizational arrangement to operate the samples. Based on the captured samples, two of the user\n\naccounts are associated with different Teams corresponding to two different attack vectors.\n\n|Team Name: ZM|Col2|\n|---|---|\n|||\n\n|Team Name: MIN|Col2|\n|---|---|\n|||\n\n|User id: 41tqbxsec7rnzf9xo6n34koney|Col2|\n|---|---|\n|||\n\n|User id: a9romaora3yp8cx6s6kagxcuby|Col2|\n|---|---|\n|||\n\n|Token: A|Col2|\n|---|---|\n|||\n\n|Token: B|Col2|\n|---|---|\n|||\n\n\n**Chrome Exploit samples**\n\n\n**Powershell Vector samples**\n\n\nFigure 30. The relation of the samples to Teams and users\n\n###### Mattermost SLUB Samples Info Leak\n\nWhile analyzing the “mm”/SLUB samples, we discovered a debug symbol leak referencing an external\n\nlibrary being used to develop the samples. While the external library is widely used, the exact path is very\n\nspecific to the attacker’s developer environment.\n\n\n-----\n\nFigure 31. Debug symbols leak\n\nUsing that information, we hunted for more samples and found an additional three older samples using\n\nMattermost that dated back to February 28, 2020. At that time, the attacker was using a different\n\nMattermost server. The following image shows the request from these old samples.\n\nFigure 32 The old Mattermost server\n\nWe can see that the Mattermost channel, in this case, is named “Minjok,” referring to one of the\n\ncompromised websites used to attack the victims.\n\nThe following section goes into more detail about the actual posts and screenshots extracted from the\n\nMattermost server.\n\n###### Mattermost Posts and Screenshots\n\nBy following the Mattermost REST API and by reusing the bearer from both SLUB samples, we extracted\n\nhundreds of posts and several screenshots from all the channels associated with both ZM and MIN\n\nTeams. All these posts and screenshots were posted by the victim machines infected by the mm/SLUB\n\nbackdoor.\n\nWhile we can’t reveal information about the posts (as these might contain accessed data from the real\n\nvictims), we found that a number of infections were associated with machines working as sandboxes\n\nto run the SLUB samples intentionally to extract its behavior. These sandboxes can easily be identified\n\nby the content of the screenshot or by the machine BIOS type. The following screenshots show two\n\nexamples of these sandboxes.\n\n\n-----\n\nFigure 33. Screenshot example from the Mattermost malicious server\n\nThe posts have plenty of information extracted by the attackers related to the infected system’s machines\n\nas a result of executing the commands mentioned in Figure 24. The extracted information, including the\n\nmachine IPs and hardware, cannot be discussed or included here for security reasons.\n\n\n-----\n\n## Conclusions\n\nThe Operation Earth Kitsune campaign remains very active and still relatively unknown due to the\n\nimplementation of various techniques, such as security software checks during malware deployment,\n\nthat are designed to hide the threat actors orchestrating the campaign.\n\nWe believe that a very capable group is behind the campaign, given the samples’ design and the number\n\nof deployed vectors. All compromised websites follow a common pattern in terms of the web tools used\n\nand the contextual content they contain. This relation is further backed by the commonalities in the\n\norganization types and the maintenance of the initial vectors that are deployed from the same related\n\nwebsites.\n\nWe reached out to Mattermost to notify them about the abuse of their software, and they sent us this\n\nstatement:\n\n\nMattermost’s open-source, self-managed collaboration platform is broadly used and co-created by\n\ndevelopers and ethical security researchers. As a community, we denounce illicit and unethical use,\n\nwhich is explicitly against Mattermost’s Conditions of Use[11] policy. We are grateful to our friends at\n\nTrend Micro for their contributions on this issue.\n\nFor more information on how to help, see: How do I report illicit use of Mattermost software?\n\n\n##### Indicators of Compromise (IoCs)\n\n|Filename|Indicator|Type|\n|---|---|---|\n|set_logo.html skin.html|C276E7749FBC8F484728E83AC0F732DD55CC213D4C357DA5F293A11545257A4C 0F2A61ADCF47869AC2EB9BFCA6A8C340523B9AB05042BA3C3EF4E0F4239D1896|CVE- 2020-0674 Exploit Script CVE- 2020-0674 Exploit Script|\n\n\n-----\n\n|Filename|Indicator|Type|\n|---|---|---|\n|_1.exe new_logo.jpg 20200209122017_ adfrxraq.jpg 20200209122017_ adfrxraq.jpg 20200209122021_ jdivhcgw.jpg 20200209122021_ dmacxfdf.jpg smile6.jpg 20200209122019_ vmqxcatf_x64.jpg smile3.jpg 20200209122021_ edfelqat_x86.jpg unknown|417B60D0A9D0C00AD2D1172836E9A2EF3680D2BA21C4EB65CFECCA4D06A546E4 1CF8F6B638549407A8C30EB39FF31D3A0597725DBA6C35FAB5AC9778597FFF99 CDEA861636324742246A8AFA5B1B71FF4B272E2A7BBB51871DC8AA802050B434 E9B997F0CF41CDDC6121888546F49405E50FA9118ED27E413DCC6C01AE9DD183 7F68FAD49C172AC5926322893E8AF9D695B2F9E956ECB77943B416CEC3FF871A C62BE18D52FE1EC8A26F34BC9722A4E63A192D23E14D96D5CDF1608B8DF3ABCD 93BB93D87CEDB0A99976C18A37D65F816DC904942A0FB39CC177D49372ED54E5 59E4510B7B15011D67EB2F80484589F7211E67756906A87CE466A7BB68F2095B 2E57F324280B50AA55899097BCC86DA480F6C42FF12E8517EA1C032EE890C1D8 8059C7D05691D2D6A00624AF1959DCCD0F2B2D3BB62905271CD90208B0716310 833070159999aa255420441ba2f2f188ab949b170d766b840a5be0885f745457|Shellcode loader PowerShell Loader PowerShell Loader PowerShell Loader CVE-2019- 1458 32bit CVE-2019- 1458 64bit SLUB backdoor 64 bit SLUB backdoor 64 bit SLUB backdoor 32bit SLUB backdoor 32bit SLUB backdoor 32bit|\n\n\n-----\n\n##### References\n\n1 Cedric Pernet et al. (March 7, 2019). Trend Micro. “New SLUB Backdoor Uses GitHub, Communicates via Slack.” Accessed on\n16 October 2020 at https://www.trendmicro.com/en_us/research/19/c/new-SLUB-backdoor-uses-github-communicates-viaslack.html.\n\n2 Cedric Pernet et al. (July 16, 2019). Trend Micro Security Intelligence Blog. “SLUB Gets Rid of GitHub, Intensifies Slack Use.”\nAccessed on 16 October 2020 at https://blog.trendmicro.com/trendlabs-security-intelligence/SLUB-gets-rid-of-githubintensifies-slack-use/.\n\n3 kagla. (May 11, 2012). GitHub. “gnuboard.” Accessed on 16 October 2020 at https://github.com/gnuboard.\n\n4 Mattermost. (n.d.). Mattermost. “Mattermost.” Accessed on 16 October 2020 at https://mattermost.com/.\n\n5 Mark Brand. (January 17, 2019). Chromium.org. “Issue 1755: Chrome: UAF in FileWriterImpl.” Last accessed on 16 October\n2020 at https://bugs.chromium.org/p/project-zero/issues/detail?id=1755.\n\n6 Adam Jordan. (August 31, 2020). Medium. “My Take on Chrome Sandbox Escape Exploit Chain.” Accessed on 16 October\n2020 at https://medium.com/swlh/my-take-on-chrome-sandbox-escape-exploit-chain-dbf5a616eec5.\n\n7 hidd3ncod3s. (August 22, 2014). Hiddencodes.wordpress.com. “Source Code Auditing, Reversing, Web Security.” Accessed\non 16 October 2020 at https://hiddencodes.wordpress.com/2014/08/22/windows-api-hash-list-1/.\n\n8 Trend Micro. 43850. Trend Micro. “Microsoft Releases Advisory on Zero-Day Vulnerability CVE-2020-0674, Workaround\nProvided. ”Accessed on 16 October 2020 at https://www.trendmicro.com/vinfo/de/security/news/cybercrime-and-digitalthreats/microsoft-releases-advisory-on-zero-day-vulnerability-cve-2020-0674-workaround-provided.\n\n9 Cedric Pernet et al. (March 7, 2019). Trend Micro. “New SLUB Backdoor Uses GitHub, Communicates via Slack.” Accessed on\n16 October 2020 at https://www.trendmicro.com/en_us/research/19/c/new-SLUB-backdoor-uses-github-communicates-viaslack.html.\n\n10 Cedric Pernet et al. (July 16, 2019). Trend Micro Security Intelligence Blog. “SLUB Gets Rid of GitHub, Intensifies Slack Use.”\nAccessed on 16 October 2020 at https://blog.trendmicro.com/trendlabs-security-intelligence/SLUB-gets-rid-of-githubintensifies-slack-use/.\n\n11 Mattermost. (n.d.). Mattermost. “Terms of Service.” Accessed on 19 October 2020 at https://about.mattermost.com/defaultterms/.\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        },
        {
            "id": "99593a68-7f6e-400e-9a9f-a707f66d2e72",
            "created_at": "2022-11-23T11:07:14.353321Z",
            "updated_at": "2022-11-23T11:07:14.353321Z",
            "deleted_at": null,
            "name": "AGRO",
            "url": "https://apt.threattracking.com",
            "description": "APT Groups and Operations Spreadsheet",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.10.19_-_Operation_Earth_Kitsune_-_Tracking_SLUBs_current_operations/2020.10.19_-_Operation_Earth_Kitsune_-_Tracking_SLUBs_current_operations.pdf",
        "https://documents.trendmicro.com/assets/white_papers/wp-operation-earth-kitsune.pdf"
    ],
    "report_names": [
        "2020.10.19_-_Operation_Earth_Kitsune_-_Tracking_SLUBs_current_operations",
        "wp-operation-earth-kitsune.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "6158a31d-091c-4a5a-a82b-938e3d0b0e87",
            "created_at": "2023-11-17T02:00:07.61151Z",
            "updated_at": "2025-03-27T02:00:03.235865Z",
            "deleted_at": null,
            "main_name": "Earth Kitsune",
            "aliases": [],
            "source_name": "MISPGALAXY:Earth Kitsune",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3f6650a3-9f50-47c4-bd7a-008b63bde191",
            "created_at": "2022-10-25T16:07:23.949232Z",
            "updated_at": "2025-03-27T02:02:10.044899Z",
            "deleted_at": null,
            "main_name": "Operation Earth Kitsune",
            "aliases": [],
            "source_name": "ETDA:Operation Earth Kitsune",
            "tools": [
                "SLUB",
                "WhiskerSpy",
                "agfSpy",
                "dneSpy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041835,
    "ts_creation_date": 1603143174,
    "ts_modification_date": 1603143190,
    "files": {
        "pdf": "https://archive.orkl.eu/caf252729256e6060cdd1a1b79c1601bbb9e57f5.pdf",
        "text": "https://archive.orkl.eu/caf252729256e6060cdd1a1b79c1601bbb9e57f5.txt",
        "img": "https://archive.orkl.eu/caf252729256e6060cdd1a1b79c1601bbb9e57f5.jpg"
    }
}