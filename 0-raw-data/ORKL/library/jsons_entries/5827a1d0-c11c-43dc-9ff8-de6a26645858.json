{
    "id": "5827a1d0-c11c-43dc-9ff8-de6a26645858",
    "created_at": "2023-01-12T15:02:04.365988Z",
    "updated_at": "2025-03-27T02:05:27.86533Z",
    "deleted_at": null,
    "sha1_hash": "574cecef77d568cef0e1ad377192abfdc7f6015e",
    "title": "2022-03-11 - Is this SID taken- Varonis Threat Labs Discovers Synthetic SID Injection Attack",
    "authors": "",
    "file_creation_date": "2022-05-28T19:06:30Z",
    "file_modification_date": "2022-05-28T19:06:30Z",
    "file_size": 6808188,
    "plain_text": "# Is this SID taken? Varonis Threat Labs Discovers Synthetic SID Injection Attack\n\n**varonis.com/blog/synthetic-sid**\n\nVaronis Threat Labs researchers have discovered a technique where threat actors with\nexisting high privileges can inject synthetic SIDs into an Active Directory Access Control List\n(ACL). This creates a scenario where backdoors and hidden permission grants can occur\nwhen a new account is created with a matching legitimate SID.\n\nThis attack is made possible as:\n\nSIDs are easily guessable as they're predominantly consecutively assigned\nActive Directory does not verify if a SID applied to an ACL is valid\n\nWe're terming the SIDs which conform to the formatting rules of legitimate SIDs but don't\nactually yet reference an object to be \"synthetic\".\n\n## Background\n\nActive Directory’s permission system is composed of three parts:\n\n1. Trustees: objects which have permissions applied. This most commonly includes user\n\naccounts, groups, and computer accounts.\n2. Security Identifier (SID): Within Active Directory, security principals are identified by a\n\nsecurity identifier (SID). The SID is a unique identifier used to represent any entity that\ncan be authenticated by the operating system. It can be loosely compared to a social\nsecurity number or a citizen ID but for a domain object. The SID is issued by a Domain\nController and is assigned to an object at the time of its creation. It cannot be reused or\nused to identify another entity.\n3. Access Control List (ACL): the mapping between an object (SID) and permissions\n\nwithin Active Directory.\n\n\n-----\n\n## No SID Verification\n\nWhen an ACL is created the trustees' SID is not verified to exist on the domain. Because no\nvalidity check is done for the SID, with sufficient permissions, it's possible to add a nonexistent \"synthetic\" SID to an ACL.\n\nThese non-existing (Synthetic) SIDs with ACL permissions persist innocuously on the ACLs\nuntil a new user or computer account is created that is assigned the previously synthetic SID.\nThese new accounts instantly inherit the previously granted ACL permissions.\n\n## How to examine an ACL\n\nWe can see the ACL of an object by going to its security tab:\n\n\n-----\n\nWindows resolves the entry's SID and presents the username for readability. However,\nbehind the scenes, the ACL identifies the user via their SID as defined by the SDDL (more\non SDDLs here https://docs.microsoft.com/en-us/windows/win32/secauthz/securitydescriptor-string-format).\n\n### Injecting a synthetic SID into an ACL\n\n\n-----\n\nAs Windows doesn t verify that the SIDs exist on the domain when an ACL is created it s\npossible to insert our Synthetic SID into any object's ACL we have privileges over:\n\nNote: the domain section of the SID is changeable, but the \"S-1-5-21\" is not.\nThe Synthetic SID in the screenshot both:\n\nCannot be resolved (“Account Unknown”) because it is not assigned\nValid for the ACL entry\n\nGetting control over an existing SID is not easily achieved as SIDs can’t be taken from other\nusers or reused. However, by mapping what SIDs currently exist in the domain we can\n\n\n-----\n\npredict what SIDs new users will be created with allowing us to create a scenario where a\nnewly created account inherits our injected permissions.\nWe can map the currently existing SIDs with PowerShell:\n```\n(([adsisearcher]\"(objectSid=*)\").FindAll()).Properties.objectsid | ForEachObject {(New-Object\nSystem.Security.Principal.SecurityIdentifier($_,0)).Value}\n\n```\nThe SID in the following image has no account related to it and is the next available SID in\nthe domain. It was granted Full Control on the “Remote Management Users” object:\n\nWe created an account called “ThisIsMySid” and it took over the SID:\n\n\n-----\n\nThe user “ThisIsMySID” now has full control over the group object.\n\nIt’s worth noting that this trick also works for assigning Windows Privileges and rights such as\n[SeDebugPrivilege, SeRemoteInteractiveLogonRight, or other Privilege Constants.](https://docs.microsoft.com/en-us/windows/win32/secauthz/privilege-constants)\n\n## Exploitation\n\n\n-----\n\nThe main exploitation vector here is persistence. Threat actors with domain control can add\npermissions and privileges to future SIDs and regain a foothold by creating a user or\ncomputer account.\n\nCreating an account is not much of an issue assuming you have control over a regular user\naccount. Authenticated users can create up to 10 computer accounts by default, and\ncomputer accounts get SIDs assigned to them just like regular users which allows for this\nexploitation.\n\n### DCSync Exploitation Scenario\n\nBy adding a SID to the domain object and granting it synchronization privileges (which are\nrequired for the DCSync attack), the threat actor planted the backdoor. And of course, more\nthan one SID can be added to make sure that it's not overwritten by regular activity\n\n\n-----\n\nTo regain a foothold, the threat actor would have to gain control over a standard user\naccount (possibly by phishing) and use that account to create a computer account:\n\nThe newly created account will replace one of the available SIDs and have DCSync\npermissions.\n\n## Remediation and Monitoring\n\nMicrosoft does not consider this a security issue, however, monitoring is still recommended\nas the assignment of synthetic SIDs is anomalous behavior.\n\nMonitoring of the following is recommended to mitigate the risk of this technique.\n\nAlerts on abnormal privilege changes, rights assignments, and permission grants in\nActive Directory environments whether they are done automatically via scripts or\nmalware, or manually by an active threat.\nBehavior-based modeling (as done by Varonis) on sensitive objects for ACL changes.\n\n\n-----\n\n[Changes on directory service objects in your organization (Windows event 5136)](https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5136)\n\n\n-----\n\nBehavior-based modeling (like that provided by Varonis) to alert when a user is granted\npermissions over a sensitive object or to monitor a trustee that’s added to the object\nand alert if it doesn’t exist.\n\n\n-----\n\n[Direct privilege assignments (Windows event 4704) may indicate synthetic SID](https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4704)\ninjection.\n\n### Removing Orphaned SIDs\n\nHaving a process to monitor and remove orphaned SIDs will prevent the attacker from\ngaining control over the synthetic SIDs as well.\n\n[Consider using PowerShell, ICACLS, or dedicated tools to find orphaned SIDs and remove](https://www.varonis.com/blog/how-to-get-started-with-powershell-and-active-directory-scripting?hsLang=en)\nthem.\n\n\n-----\n\n### Sources\n\nEric Saraga\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-11 - Is this SID taken- Varonis Threat Labs Discovers Synthetic SID Injection Attack.pdf"
    ],
    "report_names": [
        "2022-03-11 - Is this SID taken- Varonis Threat Labs Discovers Synthetic SID Injection Attack.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535724,
    "ts_updated_at": 1743041127,
    "ts_creation_date": 1653764790,
    "ts_modification_date": 1653764790,
    "files": {
        "pdf": "https://archive.orkl.eu/574cecef77d568cef0e1ad377192abfdc7f6015e.pdf",
        "text": "https://archive.orkl.eu/574cecef77d568cef0e1ad377192abfdc7f6015e.txt",
        "img": "https://archive.orkl.eu/574cecef77d568cef0e1ad377192abfdc7f6015e.jpg"
    }
}