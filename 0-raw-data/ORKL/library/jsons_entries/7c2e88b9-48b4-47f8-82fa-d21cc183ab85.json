{
    "id": "7c2e88b9-48b4-47f8-82fa-d21cc183ab85",
    "created_at": "2023-01-12T15:10:05.521826Z",
    "updated_at": "2025-03-27T02:15:38.086236Z",
    "deleted_at": null,
    "sha1_hash": "3a980dbcf092cac9fba5973314d1131741be6efc",
    "title": "2020-01-08 - Threat Spotlight- Amadey Bot Targets Non-Russian Users",
    "authors": "",
    "file_creation_date": "2022-05-28T03:45:37Z",
    "file_modification_date": "2022-05-28T03:45:37Z",
    "file_size": 1165338,
    "plain_text": "# Threat Spotlight: Amadey Bot Targets Non-Russian Users\n\n**[blogs.blackberry.com/en/2020/01/threat-spotlight-amadey-bot](https://blogs.blackberry.com/en/2020/01/threat-spotlight-amadey-bot)**\n\nMasaki Kasuya\n\n[RESEARCH & INTELLIGENCE / 01.08.20 /](https://blogs.blackberry.com/en/category/research-and-intelligence) [Masaki Kasuya](https://blogs.blackberry.com/en/author/masaki-kasuya)\n\nAmadey is a simple Trojan bot [first discovered in October of 2018[1]. It is primarily used for](https://pastebin.com/U415KmF3)\ncollecting information on a victim's environment, though it can also deliver other malware.\n\n\n[A major infection vector for Amadey are exploit kits such as RigEK and Fallout EK[2]. During our](https://www.malware-traffic-analysis.net/2019/02/28/index.html)\n[monitoring, we also observed this Trojan being delivered via AZORult Infostealer[3] on February](https://threatvector.cylance.com/en_us/home/threat-spotlight-analyzing-azorult-infostealer-malware.html)\n23rd to March 1, and April 18th to June 5th. The sample hash values were not changedst\nfrequently. Recently, [TA505 used Amadey for their campaign in April 2019[4].](https://medium.com/@1ZRR4H/ta505-intensifica-ciberataques-a-chile-y-latinoam%C3%A9rica-con-flawedammy-9fb92c2f0552)\n\nThis technical blog reveals the detailed behavior of Amadey and examines its AZORult campaign.\nIt focuses on the latest sample\n(DE8A40568834EAF2F84A352D91D4EA1BB3081407867B12F33358ABD262DC7182) which\nwas actively spread for about a month.\n\n## Technical Analysis\n\n### Obfuscation\n\nAmadey possesses decode logic as seen in Figure 1. It obfuscates strings like domain name, dll\nfile names, API names, antivirus (AV) vendor names, and so on. For example, “94 D6 CD CF 99\nDA AD 92 CF CD 98 D7 96 AA A1 D6 AA A1 D6 94 C6 A6 CF” (embedded in this malware file)\ndecodes to the command and control (C2) domain name: ashleywalkerfuns[.]com.\n\n\n-----\n\n_Figure 1: Amadey’s_\n\n_decode routine_\n\n### Installation\n\nWhen run, Amadey looks for antivirus products installed on the victim machine (see Table 1).\nNext, it copies itself to “C:\\ProgramData\\44b36f0e13\\” as “vnren.exe” and then executes that file\nbefore terminating the original process. The “ProgramData” subfolder name is hardcoded in the\nbinary and it can vary from sample to sample:\n\n**AV Product** **Code**\n\nAVAST Software 0x1\n\nAvira 0x2\n\nKaspersky Lab 0x3\n\nESET 0x4\n\nPanda Security 0x5\n\nDoctor Web 0x6\n\nAVG 0x7\n\n360TotalSecurity 0x8\n\nBitDefender 0x9\n\nNorton 0xA\n\nSophos 0xB\n\nComodo 0xC\n\n_Table 1: AV product names and codes_\n\n\n-----\n\nIf Amadey finds Norton (0xA) or Sophos (0xB) AV software installed on the victim machine, it does\nnot drop itself under the %PROGRAMDATA% directory (see Figure 2):\n\n_Figure 2: Amadey does not drop itself_\n\n_if it finds Norton or Sophos_\n\n### Persistence\n\nFor persistence, Amadey changes the Startup folder to the one containing “vnren.exe”. It\noverwrites the registry keys to change the Startup folder, as shown in Figure 3:\n\n_Figure 3: Amadey overwrites the Startup folder for its persistence_\n\nIt also checks for installed antivirus products. If it finds 360TotalSecurity, as shown in Figure 4, it\ndoes not overwrite the registry key:\n\n\n-----\n\nFigure 4: Amadey does not establish its persistence when it finds 360 Total Security\n\n## C2 Communication\n\nTable 2 shows the parameters and their values which Amadey uses for its POST requests:\n\n**Key** **Value**\n\nid Identification. Computed based on Volume Serial Number.\n\nvs Amadey version (1.09 for these samples)\n\nar If victim user has administrative privilege, the value is 1. Otherwise, it is 0.\n\nbi “1” for 64 bit. “0” for 32 bit.\n\nlv Install additional malware if the value is 0.\n\nos OS version. (e.g., Windows 7 is 9).\n\nav If there is no antivirus product, it is 0. Otherwise, it is assigned to a number in Table 1.\n\npc Computer name from GetComputerNameA\n\nun User name from GetUserNameA\n\n\n-----\n\n_Table 2: POST parameters of Amadey_\n\nAmadey sends the parameters in plaintext to the C2 servers every 60 seconds (see Figure 5):\n\n_Figure 5: Request example_\n\nThe C2 server returns a list of URLs to remote malware files. Amadey downloads and runs the\nremote files to further infect the host machine with additional malware (see Figure 6):\n\n_Figure 6: Response example_\n\nDuring our investigation, we found the following login page shown by the C2 server (see Figure 7):\n\n_Figure 7: A live Amadey C2 login page_\n\n## Amadey C2 Tool\n\n[The source code for Amadey’s administrator tool is on Github[5]. We set the tool up in our test](https://github.com/prsecurity/amadey)\nenvironment to investigate its functionality and found:\n\nStatistical information of victim machines (Figure 8)\nA list of infected machines (Figure 9)\n\n\n-----\n\nTask management of additional malware installation (Figure 10)\n**◦ The C2 tool will not run any tasks or install any additional malware if the victim machine**\nis in Russia (Figure 11):\n\n_Figure 8: Statistics information_\n\n_Figure 9: All victim information_\n\n_Figure 10: Task creation_\n\n\n-----\n\n_Figure 11: The C2 tool will not run any tasks against victims in Russia_\n\n_(NOTE: Some lines of code are removed)_\n\n## Amadey Campaign via AZORult\n\nIn 2019, BlackBerry Cylance discovered two Amadey campaigns involving AZORult Infostealer.\nThe first ran between February 23rd to March 1st (Table 3), the second from April 18th and June\n5th (Table 4). We suspect these campaigns were led by the same attacker based on following\nprofile:\n\nAll of them used the same version (v1.09)\nRemote files names start with “ama”\nAll of them included Amadey dropping itself as “vnren.exe”\n\n**SHA256** **URL** **Date**\n\n\nb23c8e970c3d7ecd762e15f084f0675c\n\nb011fc2afe38e7763db25810d6997adf\n\n\nhXXp://www[.]llambrich[.]com/ama[.]exe Feb. 23\n2019 - Feb.\n24 2019\n\n\n-----\n\ne1efb7e182cb91f2061fd02bffebb5e4\n\nb9a011d176a6f46e26fc5b881a09044f\n\n\nhXXp://motorgalicia[.]es/amad[.]exe Feb. 25\n2019 - Mar.\n1 2019\n\n\n_Table 3: Amadey campaign from otsosukadzima[.]com (an AZORult C2 server)_\n\n**SHA256 (Amadey)** **URL** **Dates**\n\n\n5f581635e962eae615827376b609d34a\n\ncd6b01d0572e51f2fe7b858d82119509\n\n3df371b9daed1a30dd89dabd88608f64\n\nb000b6dddff3a958bf0edbd756640600\n\nde8a40568834eaf2f84a352d91d4ea1b\n\nb3081407867b12f33358abd262dc7182\n\n\nhXXp://2[.]59[.]42[.]63/amad_orj_pr[.]exe Apr.\n18\n2019\n\nhXXp://2[.]59[.]42[.]63/amad_yo[.]exe Apr.\n18\n2019\n\n                            - Apr.\n20\n2019\n\nhXXp://ashleywalkerfuns[.]com/ama_orj_pr[.]exe Apr.\n25\n2019\n\n                         - May.\n21\n2019,\nMay.\n28\n2019\n– Jun.\n5\n2019\n\n\n_Table 4: Amadey campaign from kadzimagenius[.]com (an AZORult C2 server)_\n\n## Conclusion\n\nAmadey is a new bot family spread by AZORult infostealer. The source code analysis of its C2\ntool revealed that it does not download additional malware if victims are in Russia.\n\nBlackBerry Cylance uses artificial intelligence-based agents trained for threat detection on millions\nof both safe and unsafe files. Our automated security agents block Amadey based on countless\nfile attributes and malicious behaviors instead of relying on a specific file signature. BlackBerry\nCylance, which offers a [predictive advantage over zero-day threats, is trained on and effective](https://threatvector.cylance.com/en_us/home/cylance-vs-future-threats-the-predictive-advantage.html)\nagainst both new and legacy cyberattacks.\n\nIf you are a BlackBerry Cylance customer using CylancePROTECT®, you are protected from\nAmadey by our machine learning models.\n\n\n-----\n\nFor more information visit [https://www.cylance.com.](https://www.cylance.com/)\n\n## Citations:\n\n_[1]_ _[https://pastebin.com/U415KmF3](https://pastebin.com/U415KmF3)_\n\n_[2]_ _[https://www.malware-traffic-analysis.net/2019/02/28/index.html](https://www.malware-traffic-analysis.net/2019/02/28/index.html)_\n\n_[3]_ _https://threatvector.cylance.com/en_us/home/threat-spotlight-analyzing-azorult-infostealer-_\n_malware.html_\n\n_[4]_ _https://medium.com/@1ZRR4H/ta505-intensifica-ciberataques-a-chile-y-latinoam%C3%A9rica-_\n_con-flawedammy-9fb92c2f0552_\n\n_[5]_ _[https://github.com/prsecurity/amadey](https://github.com/prsecurity/amadey)_\n\n## About Masaki Kasuya\n\nSenior Threat Researcher at BlackBerry Cylance, Japan\n\n[Masaki Kasaki started his professional career as Security Engineer at a large e-commerce](https://www.linkedin.com/in/masaki-kasuya-ph-d-016084a6/)\ncompany and earned practical experience in malware analysis, penetration testing, incident\nresponse, and corporate IT security. His Ph.D. dissertation sought how to stimulate stealthy\nmalware’s behavior. While he was Ph.D. student, he received student paper award and student\npresentation award. He holds SANS GREM, GCFA, GCIH, GCIA and GMOB.\n\nBack\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-08 - Threat Spotlight- Amadey Bot Targets Non-Russian Users.pdf"
    ],
    "report_names": [
        "2020-01-08 - Threat Spotlight- Amadey Bot Targets Non-Russian Users.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536205,
    "ts_updated_at": 1743041738,
    "ts_creation_date": 1653709537,
    "ts_modification_date": 1653709537,
    "files": {
        "pdf": "https://archive.orkl.eu/3a980dbcf092cac9fba5973314d1131741be6efc.pdf",
        "text": "https://archive.orkl.eu/3a980dbcf092cac9fba5973314d1131741be6efc.txt",
        "img": "https://archive.orkl.eu/3a980dbcf092cac9fba5973314d1131741be6efc.jpg"
    }
}