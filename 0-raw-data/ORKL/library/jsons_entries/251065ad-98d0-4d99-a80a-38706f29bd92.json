{
    "id": "251065ad-98d0-4d99-a80a-38706f29bd92",
    "created_at": "2023-01-12T15:03:58.116515Z",
    "updated_at": "2025-03-27T02:08:23.175272Z",
    "deleted_at": null,
    "sha1_hash": "7ad591f1fb4bf65bfb5fe01c0583d8a9f5ec29f6",
    "title": "2022-05-25 - ChromeLoader- a pushy malvertiser",
    "authors": "",
    "file_creation_date": "2022-06-01T12:23:41Z",
    "file_modification_date": "2022-06-01T12:23:41Z",
    "file_size": 1776806,
    "plain_text": "# See what it's like to have a partner in the fight.\n\n**redcanary.com/blog/chromeloader/**\n\n_Editor’s note: We’ve been researching this threat since early February. In recent days,_\n_we’ve observed what appears to be a resurgence in ChromeLoader activity. As a result, this_\n_research is based on analysis of threats spanning almost five months. That said, the_\n_detection guidance in this report provides defense-in-depth against ChromeLoader and a_\n_wide array of other threats._\n\nChromeLoader is a pervasive and persistent browser hijacker that modifies its victims’\nbrowser settings and redirects user traffic to advertisement websites. This malware is\nintroduced via an ISO file that baits users into executing it by posing as a cracked video\ngame or pirated movie or TV show. It eventually manifests as a browser extension.\n\nLike most suspicious browser extensions, ChromeLoader is a relatively benign threat that\nhijacks user search queries and redirects traffic to an advertising site. However,\n[ChromeLoader uses PowerShell to inject itself into the browser and add a malicious](https://redcanary.com/threat-detection-report/techniques/powershell/)\nextension to it, a technique we don’t see very often (and one that often goes undetected by\nother security tools). If applied to a higher-impact threat—such as a credential harvester or\nspyware—this PowerShell behavior could help malware gain an initial foothold and go\nundetected before performing more overtly malicious activity, like exfiltrating data from a\nuser’s browser sessions.\n\n\n-----\n\nWe first encountered this threat after detecting encoded PowerShell commands referencing\na scheduled task called “ChromeLoader”—and only later learned that we were catching\nChromeLoader in the middle stage of its deployment.\n\n## A note on existing research\n\nIn the process of writing this blog, we found two related articles that warrant a mention—\nand that are definitely worth reading:\n\n**Choziosi Loader: The folks at G-Data wrote a** [great article on a threat they call “Choziosi](https://www.gdatasoftware.com/blog/2022/01/37236-qr-codes-on-twitter-deliver-malicious-chrome-extension)\nLoader” that validates a lot of our own ChromeLoader findings.\n\n**The macOS variant: Once we knew about G-Data’s Choziosi naming convention, we**\n[discovered another excellent write-up by](https://www.th3protocol.com/2022/Choziosi-Loader) [Colin Cowie analyzing a macOS variant of](https://twitter.com/th3_protoCOL)\nChromeLoader.\n\nIn this article, we share important elements of the ChromeLoader infection chain and\nsecurity guidance that you can apply to detect and hunt for ChromeLoader activity in your\nenvironment. While some of the information in this blog overlaps with existing research\npublished by G-Data and Colin Cowie, we’re sharing new insights and guidance that\nsecurity teams can use to develop behavioral analytics to detect ChromeLoader.\n\n## Initial access\n\nChromeLoader is delivered by an ISO file, typically masquerading as a torrent or cracked\nvideo game. It appears to spread through pay-per-install sites and social media platforms\nsuch as Twitter.\n\n\n-----\n\n_Figure 1: Redacted screenshot of a Twitter post with scannable QR code leading to_\n_ChromeLoader’s initial download site_\n\nOnce downloaded and executed, the .ISO file is extracted and mounted as a drive on the\nvictim’s machine. Within this ISO is an executable used to install ChromeLoader, along with\nwhat appears to be a NET wrapper for the Windows Task Scheduler This is how\n\n\n-----\n\nChromeLoader maintains its persistence on the victim s machine later in the intrusion chain.\n\n_Figure 2:_ _[VirusTotal analysis on files dropped by malicious ISO](https://www.virustotal.com/gui/file/fa52844b5b7fcc0192d0822d0099ea52ed1497134a45a2f06670751ef5b33cd3/content)_\n\n## Execution and persistence\n\nExecuting `CS_Installer.exe creates persistence through a scheduled task using the`\nService Host Process ( svchost.exe ). Notably, ChromeLoader does not call the Windows\nTask Scheduler ( schtasks.exe ) to add this scheduled task, as one might expect. Instead,\nwe saw the installer executable load the Task Scheduler COM API, along with a crossprocess injection into `svchost.exe (which is used to launch ChromeLoader’s scheduled`\ntask).\n\n_Figure 3: Carbon Black console crossprocs and modloads of_ `CS_Installer.exe`\n\n\n-----\n\nFigure 3 depicts the cross-process injection into `svchost.exe . Cross-process injection is`\nfrequently used by legitimate applications but may be suspicious if the originating process is\nlocated on a virtual drive (like those that you’d expect an ISO file to mount on). It’s a good\nidea to keep an eye out for processes executing from file paths that don’t reference the\ndefault `C:\\drive and that initiate a cross-process handle into a process that is on the`\nC:\\drive. This will not only offer visibility into ChromeLoader activity, but also into the many\nworms that originate from removable drives and inject into `C:\\drive processes, like`\n```\nexplorer.exe, to propagate on a victim’s machine.\n\n```\nAfter the cross-process injection is complete, ChromeLoader’s scheduled task will execute\n[through svchost, calling the Command Interpreter ( cmd.exe ), which executes a Base64-](https://redcanary.com/threat-detection-report/techniques/command-scripting-interpreter/)\nencoded PowerShell command containing multiple declared variables. ChromeLoader uses\nthe shortened `-encodedcommand flag to encode its PowerShell command:`\n\n_Figure 4: Encoded PowerShell content spawned by ChromeLoader’s scheduled task_\n\nOnce decoded and beautified, the command looks like this:\n\n\n-----\n\n_[Figure 5: PowerShell CLI decoded and beautified by reddit user “Russianh4ck3r”](https://www.reddit.com/r/antivirus/comments/rvvc0d/comment/hrfpekt/?utm_source=share&utm_medium=web2x&context=3)_\n\n\n-----\n\nIn this command, PowerShell checks if the ChromeLoader extension is installed. If the\nspecific file path is not found, it will pull down an archive file from a remote location using\n```\nwget and load the contents as a Chrome extension. Once the extension is found, this\n\n```\nPowerShell command will silently remove the ChromeLoader scheduled task using the\n```\nUnregister-ScheduledTask function.\n\n```\nChromeLoader then loads its extension into Chrome by using PowerShell to spawn Chrome\nwith the `--load-extension flag and references the file path of the downloaded`\nextension.\n\n_Figure 6: PowerShell spawning Chrome_\n\nOnce loaded in Chrome, the malicious extension can execute its true objective: redirecting\nvictim search results through malvertising domains and redirecting away from the Chrome\nextensions page if the user attempts to remove the extension.\n\n## macOS Variation\n\n[In late April, Colin Cowie published an analysis of the macOS version of ChromeLoader,](https://www.th3protocol.com/2022/Choziosi-Loader)\nwhich is capable of loading malicious extensions into both the Chrome and Safari web\nbrowsers. After reading Colin’s blog, we retroactively analyzed some Red Canary threat\ndetections that seemed to constitute partial execution of this variation from a published\ndetection in late February. As illustrated below, ChromeLoader redirects an encoded\ncommand from a Bourne shell ( sh ) into a Bourne-again SHell ( bash ). The command\nitself searches for `Google Chrome process using grep, then loads the malicious extension`\nfrom `/private/var/tmp/ if the process is found.`\n\n\n-----\n\n_Figure 7: Decoded Bash command loading malicious extension into Chrome_\n\nThe macOS variation has the same initial access technique as the Windows variant, namely\nthat it uses baited social media posts with QR codes or links that direct users to malicious\npay-per-install download sites. Instead of originating as an ISO, the macOS variation\noriginates in an Apple Disk Image ( DMG ) file format. And unlike the Windows variation, the\nDMG file contains an installer script that drops payloads for either Chrome or Safari, not a\nportable executable file. When executed by the end user, the installer script then initiates\ncURL to retrieve a ZIP file containing the malicious browser extension and unzips it within\nthe `private/var/tmp directory, finally executing Chrome with command-line options to`\nload the malicious extension.\n\n\n-----\n\n_Figure 8: Bash script downloading and decompressing the ChromeLoader browser_\n_extension. Image courtesy of Colin Cowie._\n\nTo maintain persistence, the macOS variation of ChromeLoader will append a preference\n( plist ) file to the `/Library/LaunchAgents directory. This ensures that every time a`\nuser logs into a graphical session, ChromeLoader’s Bash script can continually run. Once\ninstalled, ChromeLoader performs the same activity as it does on Windows machines:\nredirecting web traffic through advertising sites.\n\n## Detection\n\n### Detection opportunity 1: PowerShell containing a shortened version of the\n```\nencodedCommand flag in its command line\n\n```\nThis pseudo detection logic looks for the execution of encoded PowerShell commands. Not\nall encoded PowerShell is malicious, but encoded commands are worth keeping an eye on.\n\nprocess_name == powershell.exe\n\n&&\ncommand_line_includes (-e, -en, -enc, [going on sequentially until the full flag, `-`\n```\nencodedcommand ])\n\n```\n\n-----\n\n_Note: Many applications will legitimately encode PowerShell and make use of these_\n_shortened flags. Some tuning may be required, depending on your environment. To refine_\n_this detection analytic, consider looking for multiple variables in the decoded PowerShell_\n_block paired with the use of a shortened_ `encodedCommand flag stated above. Variables are`\n_declared in PowerShell using_ `$ .`\n\ndecoded_command_line_includes == $\n\n### Detection opportunity 2: PowerShell spawning chrome.exe containing\n```\nload-extension and AppData\\Local within the command line\n\n```\nThe detection analytic looks for instances of the Chrome browser executable spawning from\nPowerShell with a corresponding command line that includes `appdata\\local as a`\nparameter.\n\nparent_process_name == powershell.exe\n\n&&\nprocess_name == chrome.exe\n\n&&\ncommand_line_includes ( AppData\\Local, load-extension )\n\n### Detection opportunity 3: Shell process spawning process loading a Chrome extension within the command line\n\nThis analytic looks for `sh or` `bash scripts running in macOS environments with command`\nlines associated with the macOS variant of ChromeLoader.\n\nparent_process_equals_any (sh || bash)\n\n&&\nprocess_name_is_osx?\n\n&&\ncommand_line_includes ( /tmp/ || `load-extension ||` `chrome )`\n\n### Detection opportunity 4: Redirected Base64 encoded commands into a shell process\n\nLike the encoded PowerShell detection analytics idea above, this detector looks for the\nexecution of encoded `sh,` `bash, or` `zsh commands on macOS endpoints.`\n\ncommand_line_includes ( echo, base64 )\n\n&&\nchildproc_equals_any (sh,bash,zsh)\n\n_Note: As is the case with PowerShell, there are many legitimate uses for encoding shell_\n_commands. Some tuning may be required, depending on your environment._\n\n\n-----\n\n## Conclusion\n\nWe hope this blog helps you improve your defense-in-depth against ChromeLoader\nspecifically—but also for any variety of other threats that leverage suspicious ISO/DMG files\nand PowerShell/Bash execution. As always, each environment is different and certain\nadministrative or user workflows may trigger your new detection analytics. Please be sure\nto tune accordingly. Happy hunting!\n\nRelated Articles\n\nDetection and response\n\n### Detecting suspicious email forwarding rules in Office 365\n\nDetection and response\n\n### Intelligence Insights: May 2022\n\nDetection and response\n\n### The Goot cause: Detecting Gootloader and its follow-on activity\n\nDetection and response\n\n### Marshmallows & Kerberoasting\n\n**Subscribe to our blog**\n\nOur website uses cookies to provide you with a better browsing experience. More\n[information can be found in our Privacy Policy.](https://redcanary.com/privacy-policy)\n\nX\n\n**Privacy Overview**\n\nThis website uses cookies to improve your experience while you navigate through the\nwebsite. Out of these cookies, the cookies that are categorized as necessary are stored on\nyour browser as they are essential for the working of basic functionalities of the website. We\nalso use third-party cookies that help us analyze and understand how you use this website.\n\n\n-----\n\nThese cookies will be stored in your browser only with your consent. You also have the\noption to opt-out of these cookies. But opting out of some of these cookies may have an\neffect on your browsing experience.\n\nNecessary cookies are absolutely essential for the website to function properly. This category\nonly includes cookies that ensures basic functionalities and security features of the website.\nThese cookies do not store any personal information.\n\nAny cookies that may not be particularly necessary for the website to function and is used\nspecifically to collect user personal data via analytics, ads, other embedded contents are\ntermed as non-necessary cookies. It is mandatory to procure user consent prior to running\nthese cookies on your website.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-05-25 - ChromeLoader- a pushy malvertiser.pdf"
    ],
    "report_names": [
        "2022-05-25 - ChromeLoader- a pushy malvertiser.pdf"
    ],
    "threat_actors": [
        {
            "id": "81dde5cc-c29f-430d-8c6e-e5e92d5015e7",
            "created_at": "2022-10-25T16:07:23.704358Z",
            "updated_at": "2025-03-27T02:02:09.932453Z",
            "deleted_at": null,
            "main_name": "Harvester",
            "aliases": [],
            "source_name": "ETDA:Harvester",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "Graphon",
                "Metasploit",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535838,
    "ts_updated_at": 1743041303,
    "ts_creation_date": 1654086221,
    "ts_modification_date": 1654086221,
    "files": {
        "pdf": "https://archive.orkl.eu/7ad591f1fb4bf65bfb5fe01c0583d8a9f5ec29f6.pdf",
        "text": "https://archive.orkl.eu/7ad591f1fb4bf65bfb5fe01c0583d8a9f5ec29f6.txt",
        "img": "https://archive.orkl.eu/7ad591f1fb4bf65bfb5fe01c0583d8a9f5ec29f6.jpg"
    }
}