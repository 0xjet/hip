{
    "id": "80c0a214-967b-4757-b1e8-5703dc5e0c00",
    "created_at": "2023-01-12T15:08:42.95601Z",
    "updated_at": "2025-03-27T02:05:38.093892Z",
    "deleted_at": null,
    "sha1_hash": "014731e690fb2c4ea8b6ae65a8fc8368af26f136",
    "title": "2020-08-31 - Trickbot rdpscanDll – Transforming Candidate Credentials for Brute-Forcing RDP Servers",
    "authors": "",
    "file_creation_date": "2022-05-28T00:24:58Z",
    "file_modification_date": "2022-05-28T00:24:58Z",
    "file_size": 515499,
    "plain_text": "# Trickbot rdpscanDll – Transforming Candidate Credentials for Brute-Forcing RDP Servers\n\n**[cyber.wtf/2020/08/31/trickbot-rdpscandll-password-transof/](https://cyber.wtf/2020/08/31/trickbot-rdpscandll-password-transof/)**\n\nAugust 31, 2020\n\nAfter some weeks of not seeing the RDP scanner module of Trickbot, I recently observed\nthat the module was again distributed among the bots in our tracking lab. Since Bitdefender\n[already published a report on the module in March 2020, I focused on checking whether or](https://labs.bitdefender.com/2020/03/new-trickbot-module-bruteforces-rdp-connections-targets-select-telecommunication-services-in-us-and-hong-kong/)\nnot the command-and-control (C2) communication of the module remained more or less the\nsame or if there was anything groundbreakingly new. Short answer: there wasn’t. There may\nbe some under-the-hood fixes or improvements but I (as of yet) did not stumble upon\nanything significant that wasn’t already found by Bitdefender: the module still receives its\nmode of action, target servers, usernames, and password candidates from the C2 server and\nthen does what the mode tells it to do. But while I was checking that, I also had a look at the\nactual data that we received from the C2 server.\n\n## Password List\n\nMy intuition on the password list was that it is just a dictionary of words to try. This is also\nsuggested by the URL which is used to retrieve the password list:\n```\nhxxps://%c2%/%gtag%/%bot_id%/rdp/dict . Thus I did not have a closer look at the\n\n```\npassword list at that time, because everything looked the way Bitdefender described it and I\nhad no reason to look at it in detail. But one or two days later, I re-requested the list of\npasswords to see whether the list changed in the meantime – and it did indeed. Because of\nthat I had a quick look at what changed and then I noticed that I overlooked something right\nfrom the start (literally, duh!). On the left side of the picture you see what I had a quick look at\nafter retrieving the password list from the C2 server with curl (and thus seeing only the last\nlines of the output). On the right side there is the very same password list, just seen from the\nstart.\n\n\n-----\n\nTo the keen eye it seems that they may be using some kind of templating mechanism to\nadjust the list of passwords and use more specific credential candidates. With that thought in\nmind I spun up my analysis environment and started digging into the module to see what the\nTrickbot gang is actually doing there (spoiler: yes, they do some kind of templating – but not\njust the find-and-replace kind).\n\n## Transforming them P@ssw0rds\n\nAs mentioned before, this is not a simple find-and-replace but instead they can change the\ncredential candidates to better fit the attacked host. In that sense, I decided to call those\nthings transforms instead of templates because they are not just templates that are filled out\nbut a little bit more dynamic. Example:\n\n\n-----\n\n```\n   %username%123 → myuser123 (lowercase)\n   %Username%123 → Myuser123 (lowercase but first char uppercase)\n   %UsErNaMe%123 → MyUsEr123 (alternating case, starting with uppercase char)\n   %EMANRESU%123 → RESUYM123 (uppercase and reversed)\n\n```\nAnd that is essentially how the markers in the password list work. I was able to extract all 91\ntransformations that are currently available to the rdpscanDll (as of 2020-08-14). Please find\nthe list with all transforms with an example and a description for each of them at the end of\nthis blog post.\n\nSome of the transforms can even be parameterized to a certain degree:\n%OriginalUsername%, %OriginalDomain%, and %domain% can be prepended or appended\nwith an (N) to indicate whether the first N or last N characters of the element should be used\n(or everything if no parameters are present).\n\n## Reconnaissance\n\nAfter finding the list of transforms, I decided to ask my favorite internet search engine\nwhether these names for the transforms are known related to RDP. And I indeed found a\nRDP brute force tool by a certain z668 which seemingly makes use of some of the\ntransforms that are used in the rdpscanDll. Although this tool seems to be a standalone\napplication, the names of the transforms and the context of their use could suggest a\nconnection between z668 and the Trickbot gang – at least to a certain degree. Sure, the\nconnection may not be really strong because the Trickbot module is written in C++ and the\nRDP tool seems to be written in C#. But given the fact that C# can load and use native DLLs\nand considering that z668 forked the FreeRDP project on Github, the actual scanner may\nindeed be written in C/C++ (and probably using FreeRDP). Thus it is possible that the\nTrickbot gang may have obtained the source code from z668 to integrate the RDP scanner\ninto their module framework and to use their C2 communication protocol. But: this is just\nguessing based on some more or less loose facts – I could easily be completely wrong with\nthat.\n\n\n-----\n\n## Transform List\n\n**Transform Identifier** **Example** **Description**\n\nEmptyPass tries an empty\npassword\n\n\n-----\n\n**Transform Identifier** **Example** **Description**\n\nGetHost fills in the\nhostname of the\ncurrently\nattacked IP (ex:\nmyhost)\n\nIP the currently\nattacked IP\naddress (ex:\n234.234.234.234)\n\nPort fills in the\ncurrently\nattacked port (ex:\n3389)\n\n\nIpReplaceDot 234.234.234.234 →\n234234234234\n\n\nremove the dots\nof the IP address\n\n\nRemoveNumerics us3rn4me → usrnme removes all\nnumber from the\nusername\n\nRemoveLetters us3rn4m3 → 343 removes all\nletters from the\nusername\n\nRemoveOtherSymbols usern@m3 → usernm3 removes all nonalphanumeric\ncharacters from\nthe username\n\n\nOriginalUsernameLettersBeginInverse 123admin456 →\n123654nimda\n\nOriginalUsernameLettersBeginSwap 123admin456 →\nadmin456123\n\n\nkeeps all nonletters (i.e. digits,\nspecial chars) at\nthe beginning of\nthe username\nand reverses the\nrest (“invert [from\nwhere] letters\nbegin\n\nswaps all nonletters (i.e. digits,\nspecial chars) at\nthe beginning of\nthe username\nwith the rest\n(“swap [where]\nletters begin”)\n\n\n-----\n\n**Transform Identifier** **Example** **Description**\n\n\nOriginalUsernameLettersEndInverse admin123root →\nadmintoor321\n\nOriginalUsernameLettersEndSwap admin123root →\n123rootadmin\n\nOriginalUsernameNumsBeginInverse admin123root →\nadmintoor321\n\nOriginalUsernameNumsBeginSwap admin123root →\nadmintoor321\n\n\nkeeps all letters\nat the beginning\nof the username\nand reverses the\nrest (“invert\n\n[where] letters\nend”)\n\nswaps all letters\nat the beginning\nof the username\nwith the rest\n(“swap [where]\nletters end”)\n\nkeeps all nondigits at the\nbeginning of the\nusername and\nreverses the rest\n(“invert [from\nwhere] nums\nbegin\n\nswaps all nondigits at the\nbeginning of the\nusername with\nthe rest (“swap\n\n[where] nums\nbegin”)\n\n\nOriginalUsernameNumsEndInverse 123admin → 123nimda keeps all digits at\nthe beginning of\nthe username\nand reverses the\nrest (“invert\n\n[where] nums\nend”)\n\n\nOriginalUsernameNumsEndSwap 123admin456 →\nadmin456123\n\n\nswaps all digits at\nthe beginning of\nthe username\nwith the rest\n(“swap [where]\nnums end”)\n\n\n-----\n\n**Transform Identifier** **Example** **Description**\n\n\nOriginalUsernameInsert %OriginalUsernameInsert%\n(N)SOMESTRING →\nSOMEusernameSTRING (ex:\nN = 4)\n\n\ninsert username\nafter Nth\ncharacter of\nSOMESTRING\n\n\nOriginalUsername use the\nusername as\npassword\n\n\nOnlyName Firstname Lastname →\nFirstname\n\nOnlySurname Firstname Lastname →\nLastname\n\n\nuses only the first\nname (everything\nleft of the first\nspace) of the\nusername as\npassword\n\nuses only the last\nname (everything\nright of the first\nspace) of the\nusername as\npassword\n\n\nusername Admin → admin username in\nlowercase\n\nUsername AdMin → Admin username\nlowercase but\nfirst char upper\n\nUsErNaMe Admin → AdMiN username in\nalternating case,\nstarting with\nuppercase\n\nuSeRnAmE Admin → aDmIn username in\nalternating case,\nstarting with\nlowercase\n\nUSERNAME Admin → ADMIN username in\nuppercase\n\nEMANRESU Admin → NIMDA username in\nuppercase and\nreversed\n\n\n-----\n\n**Transform Identifier** **Example** **Description**\n\nEmanresuLowercase AdMin → Nimda username\nreversed and\nlowercase, first\nchar uppercase\n\nEmanresu AdMin → NiMdA username\nreversed, first\nchar upper\n\nemanresuLowercase AdMin → nimda username\nreversed and\nlowercase\n\nemanresuUppercase AdMin → NIMDA username\nreversed and\nuppercase\n\nemanresu Admin → nimda username\nreversed and\nlowercase\n\n\nReplaceFirst_X-x administrator →\n@dministrator (ex:\n%ReplaceFirst_a-@%)\n\nReplaceFirstI_X-x Administrator →\n@dministrator (ex:\n%ReplaceFirstI_a-@%)\n\nReplaceLast_X-x administrator →\n@dministrator (ex:\n%ReplaceLast_a-@%)\n\n\nreplaces the first\noccurrence of X\nwith x in the\nusername\n(needle and\nreplacement can\nbe more than 1\nchar)\n\ncase insensitively\nreplaces the first\noccurrence of X\nwith x in the\nusername\n(needle and\nreplacement can\nbe more than 1\nchar)\n\nreplaces the last\noccurrence of X\nwith x in the\nusername\n(needle and\nreplacement can\nbe more than 1\nchar)\n\n\n-----\n\n**Transform Identifier** **Example** **Description**\n\n\nReplaceLastI_X-x Administrator →\n@dministrator (ex:\n%ReplaceLastI_a-@%)\n\nReplaceAll_X-x administrator →\n@dministrator (ex:\n%ReplaceAll_a-@%)\n\nReplaceAllI_X-x Administrator →\n@dministrator (ex:\n%ReplaceAllI_a-@%)\n\n\ncase insensitively\nreplaces the last\noccurrence of X\nwith x in the\nusername\n(needle and\nreplacement can\nbe more than 1\nchar)\n\nreplaces all\noccurrences of X\nwith x in the\nusername\n(needle and\nreplacement can\nbe more than 1\nchar)\n\ncase insensitively\nreplaces all\noccurrences of X\nwith x in the\nusername\n(needle and\nreplacement can\nbe more than 1\nchar)\n\n\nDomainRemoveNumerics test-123.com → test-.com removes all digits\nfrom the domain\n\nDomainRemoveLetters test-123.com → -123. removes all\nletters from the\ndomain\n\nDomainRemoveOtherSymbols test-123.com → test123com removes all nonalphanum chars\nfrom the domain\n\n\nOriginaldomainInsert %OriginaldomainInsert%\n(N)SOMESTRING →\nSOMEdomainSTRING (ex: N\n= 4)\n\n\ninsert domain\nafter Nth\ncharacter of\nSOMESTRING\n\n\n-----\n\n**Transform Identifier** **Example** **Description**\n\n\nOriginaldomainPart test-123.com → 123com (ex:\n%OriginaldomainPart%(6))\n\n\ntakes the last N\nchars of the\ndomain name\n(ignoring any\ndots)\n\n\nOriginaldomainNumsBeginInverse test-123.com → test-moc.321 keeps all nondigits at the\nbeginning of the\ndomain and\nreverses the rest\n(“invert [from\nwhere] nums\nbegin\n\nOriginaldomainNumsBeginSwap test-123.com → 123.comtest- swaps all nondigits at the\nbeginning of the\ndomain with the\nrest (“swap\n\n[where] nums\nbegin”)\n\nOriginaldomainNumsEndInverse 123-test.com → 123moc.tset- keeps all digits at\nthe beginning of\nthe domain and\nreverses the rest\n(“invert [where]\nnums end”)\n\nOriginaldomainNumsEndSwap 123-test.com → -test.com123 swaps all digits at\nthe beginning of\nthe domain with\nthe rest (“swap\n\n[where] nums\nend”)\n\nOriginaldomainLettersBeginInverse test-123.com → test-moc.321 keeps all nonletters (i.e. digits,\nspecial chars) at\nthe beginning of\nthe domain and\nreverses the rest\n(“invert [from\nwhere] letters\nbegin\n\n\n-----\n\n**Transform Identifier** **Example** **Description**\n\nOriginaldomainLettersBeginSwap 123-test.com → test.com123- swaps all nonletters (i.e. digits,\nspecial chars) at\nthe beginning of\nthe domain with\nthe rest (“swap\n\n[where] letters\nbegin”)\n\nOriginaldomainLettersEndInverse test-123.com → testmoc.321- keeps all letters\nat the beginning\nof the domain\nand reverses the\nrest (“invert\n\n[where] letters\nend”)\n\nOriginaldomainLettersEndSwap test-123.com → -123.comtest swaps all letters\nat the beginning\nof the domain\nwith the rest\n(“swap [where]\nletters end”)\n\nOriginaldomainleft test-123.com → test-123 takes the left part\nof the domain\n(everything left of\nthe first dot) and\nlowercases the\nfirst character\n\nOriginalDomainleft test-123.com → Test-123 takes the left part\nof the domain\n(everything left of\nthe first dot) and\ncapitalizes the\nfirst character\n\nOriginaldomainright test-123.com → test-123 takes the right\npart of the\ndomain\n(everything right\nof the first dot)\nand lowercases\nthe first character\n\n\n-----\n\n**Transform Identifier** **Example** **Description**\n\nOriginalDomainright test-123.com → Test-123 takes the right\npart of the\ndomain\n(everything right\nof the first dot)\nand capitalizes\nthe first character\n\nOriginaldomain uses the plain\ndomain name\n\nOriginalDomain test-123.com → Test-123.com uses the domain\nname and\ncapitalizes the\nfirst character\n\nNiamodLowercase abc%NiamodLowercase%123 abc123\n\nniamodLowercase test-123.com → Moc.321-tset reverses and\nlowercases the\ndomain name,\nfirst character\ncapitalized\n\n\nniamodUppercase test-123.com → mOC.312TSET\n\n\nreverses and\ncapitalizes the\ndomain name,\nfirst char\nlowercase\n\n\ndomainleftHyphen test-123.com → test takes everything\nleft of the first\nhyphen\n\nDOMAINLEFTHYPHEN test-123.com → TEST takes everything\nleft of the first\nhyphen,\ncapitalized\n\nDomainleftHyphen test-123.com → Test takes everything\nleft of the first\nhyphen, first char\ncapitalized\n\ndomainrightHyphen test-123.com → 123.com takes everything\nright of the first\nhyphen\n\n\n-----\n\n**Transform Identifier** **Example** **Description**\n\nDOMAINRIGHTHYPHEN test-123.com → 123.COM takes everything\nright of the first\nhyphen,\ncapitalized\n\nDomainrightHyphen test-abc.com → Abc.com takes everything\nright of the first\nhyphen, first char\ncapitalized\n\ndomainleftUnderscore test_123.com → test takes everything\nleft of the first\nunderscore\n\nDOMAINLEFTUNDERSCORE test_123.com → TEST takes everything\nleft of the first\nunderscore,\ncapitalized\n\nDomainleftUnderscore test_123.com → Test takes everything\nleft of the first\nunderscore, first\nchar capitalized\n\ndomainrightUnderscore test_abc.com → abc.com takes everything\nright of the first\nunderscore\n\nDOMAINRIGHTUNDERSCORE test_123.com → 123.COM takes everything\nright of the first\nunderscore,\ncapitalized\n\nDomainrightUnderscore test_abc.com → Abc.com takes everything\nright of the first\nunderscore, first\nchar capitalized\n\n\nDomainReplaceFirst_X-x EXAMPLE-attack.com →\nEXAMPLE-@ttack.com (ex:\n%DomainReplaceFirst_a@%)\n\n\nreplaces the first\noccurrence of X\nwith x in the\ndomain (needle\nand replacement\ncan be more than\n1 char)\n\n\n-----\n\n**Transform Identifier** **Example** **Description**\n\n\nDomainReplaceFirstI_X-x EXAMPLE-attack.com →\nEX@MPLE-attack.com (ex:\n%DomainReplaceFirstI_a@%)\n\nDomainReplaceLast_X-x EXAMPLE-attack.com →\nEXAMPLE-att@ck.com (ex:\n%DomainReplaceLast_a@%)\n\nDomainReplaceLastI_X-x EXAMPLE-attack.com →\nEXAMPLE-att@ck.com (ex:\n%DomainReplaceLastI_a@%)\n\nDomainReplaceAll_X-x EXAMPLE-attack.com →\nEXAMPLE-@tt@ck.com (ex:\n%DomainReplaceAll_a-@%)\n\nDomainReplaceAllI_X-x EXAMPLE-attack.com →\nEX@MPLE-@tt@ck.com (ex:\n%DomainReplaceAllI_a-@%)\n\n\ncase insensitively\nreplaces the first\noccurrence of X\nwith x in the\ndomain (needle\nand replacement\ncan be more than\n1 char)\n\nreplaces the last\noccurrence of X\nwith x in the\ndomain (needle\nand replacement\ncan be more than\n1 char)\n\ncase insensitively\nreplaces the last\noccurrence of X\nwith x in the\ndomain (needle\nand replacement\ncan be more than\n1 char)\n\nreplaces all\noccurrences of X\nwith x in the\ndomain (needle\nand replacement\ncan be more than\n1 char)\n\ncase insensitively\nreplaces all\noccurrences of X\nwith x in the\ndomain (needle\nand replacement\ncan be more than\n1 char)\n\n\nniamod test-123.com → moc.321-tset reverses the\ndomain name\n\n\n-----\n\n**Transform Identifier** **Example** **Description**\n\nNiamod test-123.com → Moc.321-tset reverses the\ndomain name,\nfirst char\ncapitalized\n\ndomainleft TEST-123.com → test-123 everything left of\nthe first dot,\nlowercased\n\nDOMAINLEFT Test-123.com → TEST-123 everything left of\nthe first dor,\ncapitalized\n\nDomainleft test-123.com → Test-123 everything left of\nthe first dot,\nlowercased but\nfirst char\ncapitalized\n\ndomainright TEST-123.com → com everything right\nof the first dot,\nlowercased\n\nDOMAINRIGHT Test-123.com → COM everything right\nof the first dor,\ncapitalized\n\nDomainright test-123.com → Com everything right\nof the first dot,\nlowercased but\nfirst char\ncapitalized\n\n\ndomain TEST-123.com → test123.com\n\n\ndomain name,\nlowercase\n\n\nDomain TEST-123.com domain name\nlowercased, first\nchar capitalized\n\n\nDoMaIn test-123.com → TeSt123.cOm\n\ndOmAiN test-123.com → tEsT123.CoM\n\n\ndomain name in\nalternating case,\nstarting with\nuppercase\n\ndomain name in\nalternating case,\nstarting with\nlowercase\n\n\n-----\n\n**Transform Identifier** **Example** **Description**\n\n\nDOMAIN test-123.com → TEST123.COM\n\nNIAMOD test-123.com → MOC.321TSET\n\n\ndomain name\ncapitalized\n\ndomain name\nreversed and\ncapitalized\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-31 - Trickbot rdpscanDll – Transforming Candidate Credentials for Brute-Forcing RDP Servers.pdf"
    ],
    "report_names": [
        "2020-08-31 - Trickbot rdpscanDll – Transforming Candidate Credentials for Brute-Forcing RDP Servers.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536122,
    "ts_updated_at": 1743041138,
    "ts_creation_date": 1653697498,
    "ts_modification_date": 1653697498,
    "files": {
        "pdf": "https://archive.orkl.eu/014731e690fb2c4ea8b6ae65a8fc8368af26f136.pdf",
        "text": "https://archive.orkl.eu/014731e690fb2c4ea8b6ae65a8fc8368af26f136.txt",
        "img": "https://archive.orkl.eu/014731e690fb2c4ea8b6ae65a8fc8368af26f136.jpg"
    }
}