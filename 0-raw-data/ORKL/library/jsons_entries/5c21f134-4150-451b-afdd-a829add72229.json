{
    "id": "5c21f134-4150-451b-afdd-a829add72229",
    "created_at": "2023-01-12T15:06:54.35517Z",
    "updated_at": "2025-03-27T02:09:18.78124Z",
    "deleted_at": null,
    "sha1_hash": "cce48cb4fb62a841c2122f1c1fd1af469eb2ca0d",
    "title": "2020-09-29 - Spear Phishing Campaign Delivers Buer and Bazar Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T19:00:57Z",
    "file_modification_date": "2022-05-28T19:00:57Z",
    "file_size": 1889290,
    "plain_text": "# Spear Phishing Campaign Delivers Buer and Bazar Malware\n\n**[zscaler.com/blogs/research/spear-phishing-campaign-delivers-buer-and-bazar-malware](https://www.zscaler.com/blogs/research/spear-phishing-campaign-delivers-buer-and-bazar-malware)**\n\nZscaler ThreatLabZ became aware of a prevalent phishing campaign targeting employees of various\norganizations. During the past couple of weeks, many enterprise users have been getting spear phishing\nemails indicating that their employment with the company has been terminated.\n\nThese emails contain a Google document link that leads to the Bazar backdoor (from the TrickBot gang).\nWhat's interesting is that this campaign also used the Buer loader, which is the first time we have seen these\ntwo malware strains used together.\n\nUse of the Buer loader by the TrickBot gang comes as no surprise as this group is known to work with\ndifferent malware groups. In the past, the TrickBot gang has also worked with other botnets, such\nas Emotet.\n\n### Campaign\n\nIn this email campaign, instead of relying on attachments, the attackers included links to what appeared to\nbe a legitimate Google Docs document, which itself contained links to malicious files hosted on Google Drive\nor, in some cases, hosted elsewhere. In some previous phishing email campaigns, attackers leveraged\nSendGrid to distribute the initial emails to hide the Google Drive links in the documents behind a SendGrid\nURL as a way to bypass traditional defences.\n\nSamples of emails that we have seen are shown in Figure 1 and Figure 2.\n\n\n-----\n\n_Figure 1: One of the spear phishing email templates targeting an employee._\n\n_Figure 2: Another spear phishing email template_\n\nThe link in both emails is a Google Docs link claiming to host a PDF file with a list of employees that have\nbeen terminated, as shown in Figure 3.\n\n\n-----\n\n_Figure 3: The link to the fake Google Doc containing the download link._\n\nThe link in the Google Doc redirects to the URL unitedyfl[.]com/print_preview.exe to download the malware\npayload.\n\nAlthough, the use of target names with actuating themes is not new to this group, there has been a\nsignificant uptick in the number of emails received and this campaign has been persistently active for the\npast few weeks.\n\n### Packer\n\nIn most cases, the payload that is downloaded is the Bazar malware but, in some cases, it is the Buer\nloader. The packer used in both malware payloads is identical. Most notably, the packed binaries are exe\nfiles with a randomly named export function. The export function is responsible for payload decryption and\ninjection.\n\nFirst, a shellcode is decrypted, which further decrypts a headerless PE loader that has the final payload in its\noverlay. The headersless loader allocates memory, maps the payload into memory with proper permissions,\nand finally transfers control to it. In this campaign, no process self-injection is used to load the payload.\n\n\n-----\n\n_Figure 4: The decrypted header less PE loader._\n\n_Figure 5: The payload embedded at the end of the loader._\n\n### Bazar loader and Bazar backdoor\n\nThe Bazar backdoor is a new stealthy malware, part of the TrickBot group’s toolkit arsenal and leveraged for\nhigh-value targets. The Bazar loader is used to download and execute the Bazar backdoor on the target\nsystem. The goal of this backdoor is to execute binaries, scripts, modules, kill processes, and then remove\nitself from the compromised machine. The samples used in this campaign heavily rely on control flow\n[obfuscation. The detailed analysis report about this backdoor can be found here.](https://www.vkremez.com/2020/04/lets-learn-trickbot-bazarbackdoor.html)\n\nThe Bazar loader downloads the Bazar backdoor from the C&C using the following URI format:\n\n{C&C}/api/v\\d{3}\n\nThe downloaded payload is XOR-encrypted and can be decrypted using the script provided in the appendix.\n\n\n-----\n\nThe downloaded malware was successfully captured by the Zscaler Cloud Sandbox:\n\n_Figure 6: The Zscaler Cloud Sandbox report._\n\nThe C&C TLS communications of the Bazar backdoor have been using certificates created in the same\nmanner that TrickBot certificates have been created. The C&C server TLS certificate is shown in Figure 7.\n\n_Figure 7: The Bazar/TrickBot TLS certificate._\n\nResearchers also observed that the backdoor downloads and executes the Cobalt Strike pentesting and\npost-exploitation toolkit on the victim's machine within some period of time after the infection. By deploying\nCobalt Strike, it is clear that this stealthy backdoor is being used to gain a foothold in corporate networks so\nthat ransomware can be deployed, data can be stolen, or network access could be sold to other threat\nactors.\n\n### Buer loader\n\n\n-----\n\nThe Buer loader was first discovered around the end of 2019. It is a very capable malware written in C and\nprimarily sold on Russian underground forums for around US$400. Notably, this malware does not function\nin the CIS. It has most of the important strings encrypted and APIs are loaded by hash, just like most of the\nsophisticated malware these days. We are not going to go into technical details because detailed analysis of\n[this has already published.](https://krabsonsecurity.com/2019/12/05/buer-loader-new-russian-loader-on-the-market-with-interesting-persistence/)\n\nThe Buer loader was captured by the Zscaler Cloud Sandbox.\n\n_Figure 8: The Zscaler Cloud Sandbox report for the Buer loader._\n\nIn addition to sandbox detections, Zscaler’s multilayered cloud security platform detects indicators at various\nlevels:\n\n[Win32.Trojan.Buerloader](https://threatlibrary.zscaler.com/?keyword=Win32.Trojan.Buerloader)\n\n[Win32.Backdoor.Bazar](https://threatlibrary.zscaler.com/?keyword=Win32.Backdoor.Bazar)\n\n## Conclusion\n\nThe TrickBot group has been running similarly themed campaigns for some time. The targeted nature of the\ncampaign with subject lines having the organization’s name makes these campaign’s highly effective\ncompared to generic spray-and-pray attacks. But even these specially crafted attacks are not immune from a\npair of vigilant eyes and the right set of tools. We at Zscaler ThreatLabZ are always on the lookout for bad\nstuff—be it for our company or for our customers—to provide protection against it.\n\n\n-----\n\nLast but not the least, always be attentive while opening any email links or attachments. Even if there is a\ntiny bit of suspicion, verify the email or get it reviewed thoroughly by your security team before proceeding\nfurther.\n\n## IOCs\n\n**MD5**\n\nFa0322fb70610d6e67585588184eda39 (Buer loader)\n\n06f42898d5b2303c0b455d3152ced044 (Bazar loader)\n\n04a20c9f33023439b612935b6901917f (Bazar loader)\n\n951acc18e4f14471f49235327e0c1ccc (Bazar loader)\n\n4bb9a709958a1790a6bc257a9b5cb48e (Bazar loader)\n\n03e699324d06bd3d597994f5df893048 (Bazar backdoor group: t1)\n\n**Distribution and document URLs**\n\nhttp://unitedyfl[.]com/print_preview.exe\n\nhttps://docs.google[.]com/document/u/1/d/e/2PACX1vTwnIt9tXcgRxaOME9G3yErRp50dGxW1EKoTeIAYZwkMEg4j8fOpU9kP7xMJ6pufKfzsoETJwX5ZMM5/pub\n\nhttps://docs.google[.]com/document/u/1/d/e/2PACX1vSE2BfEV4tOmHOpMzeBhWbyajWwjxajBvm1YpJSRWyDL-qXbnSsuOHhyuT2Y4mbZ72uPT9uToZWvo2/pub\n\nhttps://docs.google[.]com/document/u/1/d/e/2PACX1vTCf1OgjnHoaohnZ0BMwCFRU62HyC85BfeiX7NGPiwvrqr8P-_-Y_5Mab9wAJjCIcldWv8wvKVXFuiK/pub\n\nhttps://docs.google[.]com/document/d/e/2PACX1vQ4MCpbsYfwekk44caru7p05aOKswFPvyQNsyow1Qfg1exHrGZHaqOmWcnSeAxmDK2V1i3ml9DP8kYT/pub\n\nhttps://docs.google[.]com/document/d/e/2PACX-1vRl0GvrO4JO8Rs4v1BTtXmsMThv1M413Z14onQlTkrsXZEOOr1zF8gKu3GDOwFBN0kaw5g7oC7lbIE/pub\n\nhttps://docs.google[.]com/document/d/e/2PACX1vR0NwqguWEFX4ZilvsxKSaJQbUfXpfK5fvWxbxUBJfPzbmvGuxHS7bltp9cjpJ0RvrvdlAxeKpSjDKQ/pub\n\n**C&C**\n\n**Buer loader**\n\n104.248.83[.]13\n\n**Bazar loader**\n\n164.68.107[.]165\n\n91.235.129[.]64\n\n37.220.6[.]126\n\n\n-----\n\n195.123.241[.]194\n82.146.37[.]128\n85.143.221[.]85\n164.132.76[.]76\n54.37.237[.]253\n\n### Some of the URIs seen in this campaign include\n\n/api/v190 - Download Updated Bazar loader(64 - bit)\n/api/v192 - Download Bazar backdoor(64 - bit)\n/api/v202 - (Server did not respond with payload at the time of analysis)\n/api/v207 - (Server did not respond with payload at the time of analysis)\n\n**PDB string**\n\nc:\\Users\\Mr.Anderson\\Documents\\Visual Studio 2008\\Projects\\Anderson\\x64\\Release\\Anderson.pdb\n\n**Some of the subject lines observed**\n\nRe: {Target Company Name} termination list\n\nRe: {Target Company Name} avoiding\n\nFW: Urgent: {Target Company Name}: A Customer Complaint Request – Prompt Action Required\n\nRE: FYI: {Target Company Name} Employees Termination List – Confirmation Required\n\nRe: complaint request\n\nRe: my call, {Target Company Name}.\n\nRe: {Target Company Name} - my visit\n\nRe: can't call you\n\n## MITRE ATT&CK\n\n**ID** **Technique**\n\nT1566.002 Phishing: Spearphishing Link\n\nT1566.003 Phishing: Spearphishing via Service\n\nT1204.001 User Execution: Malicious Link\n\n\n-----\n\nT1204.002 User Execution: Malicious File\n\nT1547.001 Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder\n\nT1055.013 Process Injection: Process Doppelgänging\n\nT1055.012 Process Injection: Process Hollowing\n\nT1027.002 Obfuscated Files or Information: Software Packing\n\nT1140 Deobfuscate/Decode Files or Information\n\nT1036.005 Masquerading: Match Legitimate Name or Location\n\nT1087 Account Discovery\n\nT1010 Application Window Discovery\n\nT1083 File and Directory Discovery\n\nT1057 Process Discovery\n\nT1012 Query Registry\n\nT1018 Remote System Discovery\n\nT1082 System Information Discovery\n\nT1033 System Owner/User Discovery\n\nT1124 System Time Discovery\n\nT1119 Automated Collection\n\nT1005 Data from Local System\n\nT1053.002 Scheduled Task/Job: At (Windows)\n\nT1547.004 Boot or Logon Autostart Execution: Winlogon Helper DLL\n\nT1071.001 Application Layer Protocol: Web Protocols\n\n\n-----\n\nT1568.002 Dynamic Resolution: Domain Generation Algorithms\n\nT1020 Automated Exfiltration\n\nT1041 Exfiltration Over C2 Channel\n\nT1568.002 Dynamic Resolution: Domain Generation Algorithms\n\n## Appendix\n\n**Script to decrypt downloaded Bazar backdoor**\n```\nkey = \"20200915\"\ndata = open(\"v190\", 'rb').read()\nout = \"\"\nfor i in range(len(data)):\n  out += chr(ord(data[i]) ^ ord(key[i%len(key)]))\nof = open('dec1', 'wb')\nof.write(out)\nof.close()\n#Note: Key can vary between downloader samples\n\n```\n**Buer strings**\n\n\n-----\n\n```\n    q p j\npowershell.exe -Command \"& {Add-MpPreference -ExclusionPath\nupdate\nKdc23icmQoc21f\nopen\n.dll\nrundll32\nregsvr32\npowershell.exe \"-Command\" \"if((Get-ExecutionPolicy ) -ne 'AllSigned') { Set-ExecutionPolicy -Scope\nProcess Bypass }; & '\n%02x\nPOST\nContent-Type: application/x-www-form-urlencoded\nrunas\n%s, \"%s\"\nSoftware\\Microsoft\\Windows\\CurrentVersion\\RunOnce\n{%s-%d-%d}\nntdll.dll\nmyyux?44659379=3=83684\nmyyux?44659379=3=83684\nmyyux?44659379=3=83684\nmyyux?44659379=3=83684\nmyyux?44659379=3=83684\nUndefinedTypeError>>1I5480%C9#5=O=B8\nhd0OkaN3/Iqc7_Kdh\nsecinit.exe\nfalse\ntrue\nnull\nhttps://104.248.83.13/\napi/update/\nhttps://104.248.83.13/\napi/update/\nX4OIvcO7uWS\nupdate\nstatusCode\nAccessToken\nmethod\nx64\nexelocal\nmemload\nmemloadex\napi/download/\napi/downloadmodule/\ndownload_and_exec\ndownload_and_exec\nregsrv32\nrundll\nrundllex\nparameters\nautorun\nexplorer.exe\napi/module/\nmodules\nloaddllmem\nAdmin\nUser\nWindows 10\nWindows Server 2019/Server 2016\nWindows 8.1\nWindows Server 2012 R2\nWindows 8\nWindows Server 2012\nWindows 7\n\n```\n\n-----\n\n```\nWindows XP\nSQCP]ICW\nX4OIvcO7uWS\nUnknown\nx32\nx64\nLdrLoadDll\nRtlCreateUserThread\nLdrGetProcedureAddress\nRtlFreeUnicodeString\nRtlAnsiStringToUnicodeString\nRtlInitAnsiString\nMozilla/5.0 (Apple-iPhone7C2/1202.466; U; CPU like Mac OS X; en) AppleWebKit/420+ (KHTML, like\nGecko) Version/3.0 Mobile/1A543 Safari/419.3\nX4OIvcO7uWS\ndllhost.exe\ndllhost.exe\nSoftware\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\nShell\nopen\nakb,cvc\n%ALLUSERSPROFILE%\nOstersin\n\\AutoReg.exe\n\" ensgJJ\nensgJJ\nexplorer.exe\nsecinit.exe\nshell32.dll\nWinhttp.dll\nadvapi32.dll\nuser32.dll\nnetapi32.dll\nNtWriteVirtualMemory\nLr?jjma_rcTgprs_jKckmpw\nJbpEcrNpmacbspc?bbpcqq\nLrOscpwTgprs_jKckmpw\nLrDpccTgprs_jKckmpw\nLrNpmrcarTgprs_jKckmpw\nLrPc_bTgprs_jKckmpw\nLrEcrAmlrcvrRfpc_b\nLrQcrAmlrcvrRfpc_b \n\n```\n**Buer loader API hashes and corresponding API names**\n\n\n-----\n\n```\n           p _\n0xe79d18d6 -> kernel32_OpenProcessToken\n0x47979a8f -> advapi32_GetCurrentHwProfileW\n0x19e1e0c2 -> kernel32_RegCreateKeyExW\n0xd45f73b5 -> kernel32_RegCloseKey\n0xcb5998e2 -> kernel32_RegSetValueExW\n0xce636ff5 -> advapi32_GetSidSubAuthority\n0xaf7f658e -> winhttp_WinHttpOpen\n0x20b4c051 -> winhttp_WinHttpSetTimeouts\n0x8ef04f02 -> winhttp_WinHttpCrackUrl\n0x9f47a05e -> winhttp_WinHttpConnect\n0x1dd1d38d -> winhttp_WinHttpOpenRequest\n0x26d17a4e -> winhttp_WinHttpSendRequest\n0xb20e6a35 -> winhttp_WinHttpGetIEProxyConfigForCurrentUser\n0x1ef97964 -> winhttp_WinHttpGetProxyForUrl\n0x8678c3f6 -> winhttp_WinHttpSetOption\n0xea74138b -> winhttp_WinHttpWriteData\n0x80cc5bd7 -> winhttp_WinHttpReadData\n0x6c3f3920 -> winhttp_WinHttpReceiveResponse\n0xde67ac3c -> winhttp_WinHttpQueryHeaders\n0x710832cd -> winhttp_WinHttpQueryDataAvailable\n0x9964b3dc -> winhttp_WinHttpCloseHandle\n0x302ebe1c -> kernel32_VirtualAlloc\n0x4247bc72 -> kernel32_VirtualQuery\n0x1803b7e3 -> kernel32_VirtualProtect\n0x1a4b89aa -> kernel32_GetCurrentProcess\n0x8a8b4676 -> kernel32_LoadLibraryA\n0x1acaee7a -> kernel32_GetProcAddress\n0x61eebd02 -> kernel32_GetModuleHandleW\n0x8a8b468c -> kernel32_LoadLibraryW\n0xab489125 -> kernel32_GetNativeSystemInfo\n0x34590d2e -> kernel32_GetLastError\n0x5b3716c6 -> kernel32_GlobalFree\n0xe183277b -> kernel32_VirtualFree\n0x62f1df50 -> kernel32_VirtualFreeEx\n0xdd78764 -> kernel32_VirtualAllocEx\n0xf3cf5f6f -> kernel32_GetModuleFileNameW\n0xae7a8bda -> kernel32_CloseHandle\n0x29e91ba6 -> kernel32_HeapSize\n0xe3802c0b -> kernel32_HeapAlloc\n0x864bde7e -> kernel32_GetProcessHeap\n0x12dfcc4e -> kernel32_ExitProcess\n0x7722b4b -> kernel32_TerminateProcess\n0xb4f0f46f -> kernel32_CreateProcessW\n0xff5ec2ce -> kernel32_ExitThread\n0x4b3e6161 -> kernel32_TerminateThread\n0xed619452 -> kernel32_CreateMutexW\n0x7bffe25e -> kernel32_OpenMutexW\n0xf785ce6 -> kernel32_ReadFile\n0xe6886cef -> kernel32_WriteFile\n0x1a7f0bab -> kernel32_CreateFileW\n0xbdfa937d -> kernel32_GetFileSize\n0x617ea42b -> kernel32_DeleteFileW\n0x6659de75 -> kernel32_WriteProcessMemory\n0xc56e656d -> kernel32_GetCommandLineW\n0x78c1ba50 -> kernel32_ExpandEnvironmentStringsW\n0x2e0ccb63 -> kernel32_CreateDirectoryW\n0x5c62ca81 -> kernel32_WaitForSingleObject\n0x8edf8b90 -> kernel32_OpenProcess\n0x8a62152f -> kernel32_CreateToolhelp32Snapshot\n0xc9112e01 -> kernel32_Process32NextW\n0x63f6889c -> kernel32_Process32FirstW\n0x4b9358fc -> kernel32_DuplicateHandle\n0x24e2968d -> kernel32_GetComputerNameW\n\n```\n\n-----\n\n```\n             _\n0xf7643b99 -> kernel32_GetThreadContext\n0x3cc73360 -> kernel32_ResumeThread\n0x77643b9b -> kernel32_SetThreadContext\n0x1c2c653b -> ntdll_memset\n0x1c846140 -> ntdll_memcpy\n0x932d8a1a -> ntdll_NtDelayExecution\n0x9716d04e -> ntdll_NtReleaseMutant\n0x6f7f7a64 -> ntdll_RtlGetVersion\n0x996cc394 -> ntdll_ZwUnmapViewOfSection\n0xabf93436 -> ntdll_strtoul\n0x2bd04fd1 -> ntdll_iswctype\n0x26a5553c -> ntdll_strstr\n0x4117fd0e -> ntdll_NtQueryDefaultLocale\n0xd24c9118 -> ntdll_RtlCreateUserThread\n0xd52ff865 -> ntdll_NtQueryVirtualMemory\n0x339c09fb -> ntdll_NtQueryInformationProcess\n0x6a13016e -> ntdll_NtSetInformationThread\n0x6debaaa9 -> ntdll_NtFilterToken\n0xd584ba6c -> shell32_SHGetFolderPathW\n0x375eadf4 -> shell32_CommandLineToArgvW\n0xba1eb35b -> shell32_ShellExecuteW\n0xf674afe0 -> user32_wsprintfW\n\n## References\n\n```\nhttps://www.bleepingcomputer.com/news/security/bazarbackdoor-trickbot-gang-s-new-stealthy-networkhacking-malware/\n\n[https://www.vkremez.com/2020/04/lets-learn-trickbot-bazarbackdoor.html](https://www.vkremez.com/2020/04/lets-learn-trickbot-bazarbackdoor.html)\n\nhttps://krabsonsecurity.com/2019/12/05/buer-loader-new-russian-loader-on-the-market-with-interestingpersistence/\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-09-29 - Spear Phishing Campaign Delivers Buer and Bazar Malware.pdf"
    ],
    "report_names": [
        "2020-09-29 - Spear Phishing Campaign Delivers Buer and Bazar Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536014,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653764457,
    "ts_modification_date": 1653764457,
    "files": {
        "pdf": "https://archive.orkl.eu/cce48cb4fb62a841c2122f1c1fd1af469eb2ca0d.pdf",
        "text": "https://archive.orkl.eu/cce48cb4fb62a841c2122f1c1fd1af469eb2ca0d.txt",
        "img": "https://archive.orkl.eu/cce48cb4fb62a841c2122f1c1fd1af469eb2ca0d.jpg"
    }
}