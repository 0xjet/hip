{
    "id": "efdde850-f8ce-456a-8a5b-8d395ef08f7b",
    "created_at": "2023-01-12T15:03:51.901635Z",
    "updated_at": "2025-03-27T02:16:20.934034Z",
    "deleted_at": null,
    "sha1_hash": "dbad3b6cc693ce114265fda76ccf0f2ad1ede181",
    "title": "2019-05-07 - Turla LightNeuron- An email too far",
    "authors": "",
    "file_creation_date": "2022-05-28T00:36:53Z",
    "file_modification_date": "2022-05-28T00:36:53Z",
    "file_size": 942669,
    "plain_text": "# Turla LightNeuron: An email too far\n\n**[welivesecurity.com/2019/05/07/turla-lightneuron-email-too-far/](https://www.welivesecurity.com/2019/05/07/turla-lightneuron-email-too-far/)**\n\nESET research uncovers Microsoft Exchange malware remotely controlled via\nsteganographic PDF and JPG email attachments\n\n[Matthieu Faou](https://www.welivesecurity.com/author/mfaou/)\n7 May 2019 - 02:00PM\n\nESET research uncovers Microsoft Exchange malware remotely controlled via\nsteganographic PDF and JPG email attachments\n\n\nMay 7, 2019\n\n\n-----\n\nDue to security improvements in operating systems, rootkit usage has been in constant\ndecline for several years. As such, malware developers – especially those working in\nespionage groups – have been busy developing new stealthy userland malware.\n\nRecently, ESET researchers have investigated a sophisticated backdoor used by the\ninfamous espionage group Turla, also known as Snake. This backdoor, dubbed\n[LightNeuron, has been specifically targeting Microsoft Exchange mail servers since at least](https://securelist.com/apt-trends-report-q2-2018/86487/)\n2014. Although no samples were available for analysis, code artefacts in the Windows\nversion lead us to believe that a Linux variant exists.\n\n[Turla LightNeuron: One email away from remote code execution](https://www.welivesecurity.com/wp-content/uploads/2019/05/ESET-LightNeuron.pdf)\n\n[Download Research Paper](https://www.welivesecurity.com/wp-content/uploads/2019/05/ESET-LightNeuron.pdf)\n\n## Victimology\n\nDuring the course of our investigation, we were able to identify at least three different victim\norganizations, as shown in Figure 1.\n\nFigure 1 – Map of known LightNeuron victims\n\n\n-----\n\nTwo of the victims – a ministry of foreign affairs and a regional diplomatic organization – are\n[in line with recent Turla campaigns we have analyzed.](https://www.welivesecurity.com/2018/08/22/turla-unique-outlook-backdoor/)\n\nAs we noticed the victim in Brazil thanks to a sample uploaded to the popular multi-scanner\n_VirusTotal, we were not able to determine the nature of the victim organization._\n\n## Attribution to Turla\n\nWe believe with high confidence that Turla operates LightNeuron. The following artefacts,\ncollected during our investigation, back this:\n\nOn one compromised Exchange server:\n\na PowerShell script containing malware previously attributed to Turla was\ndropped 44 minutes before a PowerShell script used to install LightNeuron, and\nboth scripts were located in C:\\windows\\system32.\nThe script used to install LightNeuron has a filename – msinp.ps1 – that looks like\ntypical filenames used by Turla.\nOn another compromised server, IntelliAdmin – a remote administration tool, packed\nwith a packer used only by Turla – was dropped by LightNeuron.\nFor each LightNeuron attack, there were several other instances of Turla malware on\nthe same network.\nThe email address used by the attackers was registered at GMX and was\nimpersonating an employee of the targeted organization. The same provider was used\nfor the [Outlook backdoor and for an undocumented PowerShell backdoor we named](https://www.welivesecurity.com/wp-content/uploads/2018/08/Eset-Turla-Outlook-Backdoor.pdf)\nPowerStallion.\n\n[Further, in an earlier APT trends report, Kaspersky Labs researchers attributed LightNeuron](https://securelist.com/apt-trends-report-q2-2018/86487/)\nwith medium confidence to Turla.\n\n## Operator activity\n\nWhile analyzing a compromised asset, we were able to retrace part of the attackers’\nactivities. In particular, we were able to map the working hours of the operators, using the\ntime at which the compromised Exchange server received emails containing commands for\nthe backdoor.\n\nOur first observation is that the activity aligns well with a typical 9-to-5 workday in the\nUTC+3 time zone, as shown in Figure 2.\n\n\n-----\n\nFigure 2 – LightNeuron operators’ working hours\n\nOur second observation is that no activity was observed between December 28, 2018 and\nJanuary 14, 2019, while previously and afterwards, the attackers sent several emails per\nweek. This break in activities corresponds to holidays around the Eastern Orthodox\nChristmas.\n\nEven if it is not sufficient for a strong attribution, you can correlate these two observations\nwith other elements you might have at your disposal.\n\n## Main characteristics\n\nLightNeuron is, to our knowledge, the first malware specifically targeting Microsoft\nExchange email servers. It uses a persistence technique never before seen: a Transport\nAgent. In the mail server architecture, it operates at the same level of trust as security\nproducts such as spam filters. Figure 3 summarizes how LightNeuron operates.\n\n\n-----\n\nFigure 3 – LightNeuron Transport Agent\n\nBy leveraging the Transport Agent accesses, LightNeuron is able to:\n\nRead and modify any email going through the mail server.\nCompose and send new emails.\nBlock any email. The original recipient will not receive the email.\n\nA flexible set of XML rules drives these functions, as shown in Figure 4.\n\nJavaScript\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n\n<class name=\"zip\" metric=\"30\" id=\"1\" dllName=\"ZipMe\" type=\"dll\" include=\"1\">\n\n<rule metric=\"10\" id=\"1\" include=\"1\">\n\n<and>\n\n<or>\n\n<To condition=\"cnt\" value=\"email1@[redacted]\" />\n\n<From condition=\"cnt\" value=\"email1@[redacted]\" />\n\n<To condition=\"cnt\" value=\"email2@[redacted]\" />\n\n<From condition=\"cnt\" value=\"email2@[redacted]\" />\n\n[...]\n\n</or>\n\n\n-----\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n\n30\n\n31\n\n32\n\n33\n\n\n<and>\n\n<To condition=\"!cnt\" value=\"email3@[redacted]\" />\n\n<From condition=\"!cnt\" value=\"email3@[redacted]\" />\n\n[...]\n\n</and>\n\n</and>\n\n</rule>\n\n</class>\n\n<class name=\"command\" metric=\"40\" id=\"1\" dllName=\"ZipMe\" type=\"dll\"\ninclude=\"1\">\n\n<rule metric=\"10\" id=\"1\" include=\"1\">\n\n<attachment_Content-Type condition=\"cnt\" value=\"image/jpeg\" />\n\n</rule>\n\n</class>\n\nlog:logHandler\n\nzip:zipHandler\n\nchangeSubject:changeSubjectHandler\n\nchangeBody:changeBodyHandler\n\ncreate:createHandler\n\ncommand:commandHandler\n\nblock:blockHandler\n\nreplace:replaceHandler\n\nstat:statHandler\n\n\n_Figure 4 – Redacted example of a rule file_\n\nThe email addresses used in these rules are customized for each victim in order to target\nthe most interesting people.\n\n\n-----\n\nAt the end of the rules, there is the list of the handlers implemented by LightNeuron. These\nfunctions are used in the rules to process the emails. Table 1 describes the eleven different\nhandlers.\n\n**Handler name** **Description**\n\n**block** Block the email\n\n**changeBody** Change the body of the email\n\n**changeTo** Change the recipient of the email\n\n**changeSubject** Change the subject of the email\n\n**command** Parse the jpg/pdf attachment, decrypt and execute the commands.\n\n**create** Create a new email\n\n**log** Log email attachment in LOG_OUTPUT\n\n**replace** Replace the attachment\n\n**spam** Re-create and re-send the email from the exchange server to bypass\nthe spam filter\n\n**stat** Log the From, Date, To, and Subject headers in CSV format in\nSTAT_PATH\n\n**zip** Encrypt the email with RSA and store it in the path specified by\nZIP_FILE_NAME.\n\n_Table 1 – Description of the handlers implemented in the DLL_\n\n## Backdoor\n\nThe command handler is different from the others that perform modifications on the emails.\nIt is actually a backdoor controlled by emails. The commands are hidden in PDF or JPG\nattachments using steganography.\n\nThe attackers just have to send an email containing a specially crafted PDF document or\nJPG image to any email address of the compromised organization. It allows full control over\nthe Exchange server by using the commands shown in Table 2.\n\n**Instruction**\n**Code** **Description** **Argument 1** **Argument 2** **Argument 3**\n\n\n**0x01** Write an executable. Execute\nit if it is an executable.\n\n\nExe path N/A File data\n\n\n-----\n\n**Instruction**\n**Code** **Description** **Argument 1** **Argument 2** **Argument 3**\n\n**0x02** Delete a file File path N/A N/A\n\n\n**0x03** Exfiltrate a file File path Set to “1” to\ndelete the file\n\n\nN/A\n\n\n**0x04** Execute a process\n(CreateProcess)\n\n**0x05** Execute a command line\n(cmd.exe /c)\n\n\nCommand\nline\n\nCommand\nline\n\n\nN/A N/A\n\nN/A N/A\n\n\n**0x06** Return 0 N/A N/A N/A\n\n\n**0x07** Disable backdoor for x\nminutes.\n\n\nMinutes N/A N/A\n\n\n**0x09** Exfiltrate a file File path Set to “1” to\ndelete the file\n\n\nN/A\n\n\n**0x65** Return 0 N/A N/A N/A\n\n_Table 2 – List of instruction codes_\n\nOnce an email is recognized as a command email, the command is executed and the email\nis blocked directly on the Exchange server. Thus, it is very stealthy and the original recipient\nwill not be able to view it.\n\n## Steganography\n\nLightNeuron uses steganography to hide its commands inside a PDF document or a JPG\nimage. Thus, even if the email is intercepted, it might look legitimate, as it contains a valid\nattachment.\n\nIn the case of a PDF, the command data can be anywhere in the document. LightNeuron\noperators just add a header at the beginning of the PDF to specify the offset at which the\ndata is located, as shown in Figure 5.\n\nFigure 5 – Representation in hexadecimal of a PDF containing a LightNeuron command container\n\n\n-----\n\nOnce this blob of data has been decrypted with AES-256, it reveals a custom structure\nshown in Figure 6.\n\nFigure 6 – Hexadecimal dump of a decrypted command container\n\nThe most interesting fields are:\n\nOffset 0x08, the email address to which the result of the command is sent.\nOffset 0x1D, the instruction code. It corresponds to one of the function described\nabove.\nOffset 0x25, the first argument. It will be passed to the function represented by the\ninstruction code.\n\nIf an email containing such a command container, embedded in a JPG or in a PDF, is sent\nto a server compromised by LightNeuron, a calculator will be executed on the Microsoft\nExchange server.\n\n## Cleaning\n\nThe cleaning of LightNeuron is not an easy task. Simply removing the two malicious\n**files will break Microsoft Exchange, preventing everybody in the organization from**\nsending and receiving emails. Before actually removing the files, the malicious Transport\n[Agent should be disabled. We encourage you to read the full white paper before](https://www.welivesecurity.com/wp-content/uploads/2019/05/ESET-LightNeuron.pdf)\nimplementing a cleaning mechanism.\n\n## In conclusion\n\nOver the past years, we have published numerous blogposts and white papers detailing the\n[activities of the Turla group, including man-in-the-middle attacks against adobe.com or](https://www.welivesecurity.com/wp-content/uploads/2018/01/ESET_Turla_Mosquito.pdf)\n[sophisticated userland malware. However, for now it seems that LightNeuron has taken up](https://www.welivesecurity.com/wp-content/uploads/2018/08/Eset-Turla-Outlook-Backdoor.pdf)\nthe mantle of the most advanced known malware in Turla’s arsenal.\n\nBy leveraging a previously unseen persistence mechanism, a Microsoft Exchange\nTransport Agent, LightNeuron allows its operators to stay under the radar for months or\nyears. It allows them to exfiltrate sensitive documents and control other local machines via\na C&C mechanism that is very hard to detect and block.\n\nWe will continue to track Turla activities closely to help defenders protect their networks.\n\nA full and comprehensive list of Indicators of Compromise (IoCs) and samples can be found\n[in the full white paper and on GitHub.](https://www.welivesecurity.com/wp-content/uploads/2019/05/ESET-LightNeuron.pdf)\n\n\n-----\n\nFor a detailed analysis of the backdoor, refer to our white paper Turla LightNeuron: One\n_email away from remote code execution. For any inquiries, or to make sample submissions_\n_related to the subject, contact us at threatintel@eset.com._\n\n7 May 2019 - 02:00PM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-07 - Turla LightNeuron- An email too far.pdf"
    ],
    "report_names": [
        "2019-05-07 - Turla LightNeuron- An email too far.pdf"
    ],
    "threat_actors": [
        {
            "id": "e568e9d7-ae94-4ce5-9039-4fd17c731c1d",
            "created_at": "2022-10-25T15:50:23.491763Z",
            "updated_at": "2025-03-27T02:00:55.483586Z",
            "deleted_at": null,
            "main_name": "Blue Mockingbird",
            "aliases": [
                "Blue Mockingbird"
            ],
            "source_name": "MITRE:Blue Mockingbird",
            "tools": [
                "FRP",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a97cf06d-c2e2-4771-99a2-c9dee0d6a0ac",
            "created_at": "2022-10-25T16:07:24.349252Z",
            "updated_at": "2025-03-27T02:02:10.184406Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "ATK 13",
                "Belugasturgeon",
                "Blue Python",
                "CTG-8875",
                "Group 88",
                "ITG12",
                "Iron Hunter",
                "Krypton",
                "Makersmark",
                "Operation Epic Turla",
                "Operation Moonlight Maze",
                "Operation Penguin Turla",
                "Operation Satellite Turla",
                "Operation Skipper Turla",
                "Operation Turla Mosquito",
                "Operation WITCHCOVEN",
                "Pacifier APT",
                "Pensive Ursa",
                "Popeye",
                "SIG15",
                "SIG2",
                "SIG23",
                "Secret Blizzard",
                "TAG-0530",
                "Turla",
                "UNC4210",
                "Venomous Bear",
                "Waterbug"
            ],
            "source_name": "ETDA:Turla",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "ATI-Agent",
                "AdobeARM",
                "Agent.BTZ",
                "Agent.DNE",
                "BigBoss",
                "COMpfun",
                "Chinch",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobra Carbon System",
                "ComRAT",
                "DoublePulsar",
                "EmPyre",
                "EmpireProject",
                "Epic Turla",
                "EternalBlue",
                "EternalRomance",
                "GoldenSky",
                "Group Policy Results Tool",
                "HTML5 Encoding",
                "HyperStack",
                "IcedCoffee",
                "IronNetInjector",
                "KSL0T",
                "Kapushka",
                "Kazuar",
                "KopiLuwak",
                "Kotel",
                "LOLBAS",
                "LOLBins",
                "LightNeuron",
                "Living off the Land",
                "Maintools.js",
                "Metasploit",
                "Meterpreter",
                "MiamiBeach",
                "Mimikatz",
                "MiniDionis",
                "Minit",
                "NBTscan",
                "NETTRANS",
                "NETVulture",
                "Neptun",
                "NetFlash",
                "NewPass",
                "Outlook Backdoor",
                "Penquin Turla",
                "Pfinet",
                "PowerShell Empire",
                "PowerShellRunner",
                "PowerShellRunner-based RPC backdoor",
                "PowerStallion",
                "PsExec",
                "PyFlash",
                "QUIETCANARY",
                "Reductor RAT",
                "RocketMan",
                "SMBTouch",
                "SScan",
                "Satellite Turla",
                "SilentMoon",
                "Sun rootkit",
                "TTNG",
                "TadjMakhal",
                "Tavdig",
                "TinyTurla",
                "TinyTurla Next Generation",
                "TinyTurla-NG",
                "Topinambour",
                "Tunnus",
                "Turla",
                "Turla SilentMoon",
                "TurlaChopper",
                "Uroburos",
                "Urouros",
                "WCE",
                "WITCHCOVEN",
                "WhiteAtlas",
                "WhiteBear",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Wipbot",
                "WorldCupSec",
                "XTRANS",
                "certutil",
                "certutil.exe",
                "gpresult",
                "nbtscan",
                "nbtstat",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8aaa5515-92dd-448d-bb20-3a253f4f8854",
            "created_at": "2024-06-19T02:03:08.147099Z",
            "updated_at": "2025-03-27T02:05:17.408118Z",
            "deleted_at": null,
            "main_name": "IRON HUNTER",
            "aliases": [
                "Belugasturgeon ",
                "Blue Python ",
                "CTG-8875 ",
                "ITG12 ",
                "KRYPTON ",
                "MAKERSMARK ",
                "Pensive Ursa ",
                "Secret Blizzard ",
                "Turla",
                "UAC-0003 ",
                "UAC-0024 ",
                "UNC4210 ",
                "Venomous Bear ",
                "Waterbug ",
                "ATK13 "
            ],
            "source_name": "Secureworks:IRON HUNTER",
            "tools": [
                " ComRAT",
                " Kazuar",
                " KopiLuwak",
                " LightNeuron",
                " Mosquito",
                " Nautilus",
                " Neuron",
                " Penquin",
                " PoisonFrog",
                " PyFlash",
                " Skipper",
                " Snake",
                " Tavdig",
                " TinyTurla",
                " Tunnus",
                "Carbon-DLL"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a97fee0d-af4b-4661-ae17-858925438fc4",
            "created_at": "2023-01-06T13:46:38.396415Z",
            "updated_at": "2025-03-27T02:00:02.823045Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Uroburos",
                "Hippo Team",
                "Pacifier APT",
                "MAKERSMARK",
                "ATK13",
                "UAC-0003",
                "IRON HUNTER",
                "Waterbug",
                "TAG_0530",
                "KRYPTON",
                "Popeye",
                "SIG23",
                "UAC-0144",
                "G0010",
                "Blue Python",
                "VENOMOUS Bear",
                "Group 88",
                "Pfinet",
                "ITG12",
                "UNC4210",
                "Secret Blizzard",
                "UAC-0024"
            ],
            "source_name": "MISPGALAXY:Turla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535831,
    "ts_updated_at": 1743041780,
    "ts_creation_date": 1653698213,
    "ts_modification_date": 1653698213,
    "files": {
        "pdf": "https://archive.orkl.eu/dbad3b6cc693ce114265fda76ccf0f2ad1ede181.pdf",
        "text": "https://archive.orkl.eu/dbad3b6cc693ce114265fda76ccf0f2ad1ede181.txt",
        "img": "https://archive.orkl.eu/dbad3b6cc693ce114265fda76ccf0f2ad1ede181.jpg"
    }
}