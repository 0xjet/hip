{
    "id": "8e3e6733-5eb6-4e9a-9e7a-a6bd8ef40d5d",
    "created_at": "2023-01-12T15:08:12.614798Z",
    "updated_at": "2025-03-27T02:05:54.328948Z",
    "deleted_at": null,
    "sha1_hash": "4a4ca78b1b6706fa981875914c971a9d90a99a7e",
    "title": "2020-12-13 - Decrypting strings with a JEB script",
    "authors": "",
    "file_creation_date": "2022-05-27T19:11:03Z",
    "file_modification_date": "2022-05-27T19:11:03Z",
    "file_size": 568610,
    "plain_text": "# Decrypting strings with a JEB script\n\n**[cryptax.medium.com/decrypting-strings-with-a-jeb-script-1af522fa4979](https://cryptax.medium.com/decrypting-strings-with-a-jeb-script-1af522fa4979)**\n\n@cryptax December 17, 2020\n\n[@cryptax](https://cryptax.medium.com/?source=post_page-----1af522fa4979--------------------------------)\n\nDec 17, 2020\n\n\n4 min read\n\n[In this article, we unpacked a malicious version of the â€œTous Anti Covidâ€ application. We](https://cryptax.medium.com/unpacking-an-android-malware-with-dexcalibur-and-jeb-59bdd905d4a7)\nknow the main entry point of the payload DEX is `dad.calm.invest.qusalkrlkyy .`\n\nthe main entry point is located in the payload DEX (decrypted and dynamically loaded by the\nmalware)\n\n## Encrypted strings\n\n[Using the decrypted payload DEX we unpacked in the previous article, we quickly notice in](https://cryptax.medium.com/unpacking-an-android-malware-with-dexcalibur-and-jeb-59bdd905d4a7)\nthat class there are several encrypted strings. In this article, weâ€™ll see how to create a JEB\n**script to decrypt the strings.**\n\nThe strings are Base64 encoded + encryption by a()\n\n\n-----\n\n```\na() is a method which first decodes Base64 and then decrypts data using a custom\n\n```\nalgorithm. This algorithm is initialized with a hard coded key. Below, I show a â€œde-obfuscatedâ€\nversion of `a() :`\n```\nprivate String decrypt(String encrypted_string) { try {  return new String(new\nDecryptionAlgo(this.c.key.getBytes())             \n.decrypt(e.createByteArray(              new String(          \nBase64.decode(encrypted_string, 0),                 â€œUTF-8â€)))); }...\n\n## Implementing the decryption algo in Python\n\n```\nI want to decrypt encrypted strings, ok? To do so, I need to understand the decryption\nalgorithm, and automate that in a JEB script. JEB scripts are written in Python, so Iâ€™ll have to\n**port Java code to Python.**\n\nThe first thing `a() does is Base64 decoding. This is easily done in Python with the`\n```\nbase64 package and b64decode() .\n\n```\nThen, the code converts the base64 string to a byte array and decrypts the byte array using\n```\nb() .\n\n```\nthis is the (obfuscated) decryption algo\nThis decryption algorithm can quite easily be ported to Python:\n\n1. No need for explicit memory allocations in Python such as `new byte . We simply`\n\nneed to say `v0 is an array` `[] .`\n2. The for loop is transformed to `for i in range(â€¦) .`\n3. In Python, you cannot â€œassign a value to an arrayâ€ with `v0[v1]=... . Rather, we can`\n\nâ€œappendâ€ a value to an array.\n4. The algorithm calls another method `a() . If you look at its code, it simply swaps the`\n\nvalues of indices `v4 and` `this.c in array` `v3 . Thatâ€™s easy to implement in Python`\ntoo.\n\n\n-----\n\nThe same algorithm, ported to Python. Here, decrypt is part of a Python class.\nThe other part we need to take care of is the algorithmâ€™s key. We see the code instantiates a\ndecryption object with a hard-coded key (its value is `â€œdcpmeyucapxyâ€ ). The object`\nconstructor prepares the key with a custom algorithm (see below).\n\nThis method is called by the decryption object constructor (dad.calm.invest.c.c). It needs to\nbe ported to Python.\nThe port of the method is not a problem, as modulo operator exist both in Java and Python.\n\n## Wrapping the algorithm into a JEB script\n\nOnce all elements of the decryption algorithm are implemented (we can test it in a\nstandalone script), we need to wrap this up in a JEB script. JEB experts could do wonders,\nautomatically recognize the strings, decrypt them and replace by the decrypted value (see\nscripts such as this one). However, I am not an expert, and I canâ€™t spend hours on writing a\nscript either. So, weâ€™ll do something simpler: the JEB user is expected to select the string to\ndecrypt, the script will automatically decrypt the string and add a comment next to it with the\ndecrypted version. My script will not handle error cases, feel free to enhance ðŸ˜„.\n\n\n-----\n\nCreating a JEB script. The main class must derive from IScript (defined in package\ncom.pnfsoftware.jeb.client.api that we must import), and the class must implement a method\nnamed run()\nThe JEB script (1) gets the selected string ( getSelectedText or\n```\ngetActiveItemAsText ), (2) then we send that string to the decryption algorithm we\n\n```\nimplemented. The result is the decrypted string. Finally, (3) we add that string as a comment\n[( setComment ). I largely inspired my code from this one to do that.](https://github.com/pnfsoftware/jeb2-samplecode/blob/master/scripts/TranslateString.py)\n\n[Source code script to decrypt strings (GitHub).](https://github.com/cryptax/misc-code/blob/master/tous_decrypt.py)\n\n## Running the script\n\nFinally, put the Python script somewhere JEB can access it. Then, select a string to decrypt.\nThen, File > Scripts > Run Script. Select the script. And it should work :) The print commands\ngo to JEBâ€™s logger console, the decrypted string is added as comment. For next times, you\ncan simply use F2 to run the same script.\n\nVery handy! Have a look at the video to see it in action.\n\nI use F2 key to run the JEB script\nâ€” cryptax\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-13 - Decrypting strings with a JEB script.pdf"
    ],
    "report_names": [
        "2020-12-13 - Decrypting strings with a JEB script.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536092,
    "ts_updated_at": 1743041154,
    "ts_creation_date": 1653678663,
    "ts_modification_date": 1653678663,
    "files": {
        "pdf": "https://archive.orkl.eu/4a4ca78b1b6706fa981875914c971a9d90a99a7e.pdf",
        "text": "https://archive.orkl.eu/4a4ca78b1b6706fa981875914c971a9d90a99a7e.txt",
        "img": "https://archive.orkl.eu/4a4ca78b1b6706fa981875914c971a9d90a99a7e.jpg"
    }
}