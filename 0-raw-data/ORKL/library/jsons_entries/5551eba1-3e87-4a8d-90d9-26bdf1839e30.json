{
    "id": "5551eba1-3e87-4a8d-90d9-26bdf1839e30",
    "created_at": "2023-01-12T15:00:12.580307Z",
    "updated_at": "2025-03-27T02:16:20.917598Z",
    "deleted_at": null,
    "sha1_hash": "82a64770343087560f833fe24dd495c0579eb410",
    "title": "2020-01-20 - Dustman APT- Art of Copy-Paste",
    "authors": "",
    "file_creation_date": "2022-05-28T02:37:29Z",
    "file_modification_date": "2022-05-28T02:37:29Z",
    "file_size": 386706,
    "plain_text": "# Dustman APT: Art of Copy-Paste\n\n**[swapcontext.blogspot.com/2020/01/dustman-apt-art-of-copy-paste.html](https://swapcontext.blogspot.com/2020/01/dustman-apt-art-of-copy-paste.html)**\n\nDustman is a piece of data wiping malware with origin believed to be from Iran or if you like quote from [zdnet.com \"Iranian state-sponsored hackers\".](https://www.zdnet.com/article/new-iranian-data-wiper-malware-hits-bapco-bahrains-national-oil-company/)\n\nThere is a full technical overview of this malware ->\n[https://www.scribd.com/document/442225568/Saudi-Arabia-CNA-report, I wouldn't waste](https://www.scribd.com/document/442225568/Saudi-Arabia-CNA-report)\ntime fully repeating it, as it gives a brief and enough description of this malware key\nparameters and capabilities.\n\nUsually I pay zero attention to typical APT hysterics and low quality malware pushed by\nmass media/various fakeAv's as \"incredible sophisticated\" spyware/whatever. With exception\nif there is anything related to my work, for example copy/pasted from it. Just like in this case.\n\nThis is believed shared code with another data wiper called \"ZeroCleare\" - and IBM did\nanalysis with 28 page PDF where they managed to copy-paste from my github repository\nwithout even giving a single credit or link to original. Well, ok, fuck you too IBM IRIS rippers\nðŸ’©\n\nWhy this thing called Dustman? Well authors of this malware were lazy and left full pdb string\ninside main dropper C:\\Users\\Admin\\Desktop\\Dustman\\x64\\Release\\Dustman.pdb. This\ndoesn't look like fake and left because Visual Studio (and this one created in it) always sets\ndebug information to Release builds by default (Project settings->Linker->Debugging). It is\nsomething from series of small tips just like if you are wondering why some of rootkits pdb\npaths always at Z: drive - easy to use hotkey while debugging on VMware.\n\n\n-----\n\nDustman main executable is a muldrop (SHA-1\ne3ae32ebe8465c7df1225a51234f13e8a44969cc).\n\nIt contain three more files stored inside executable resource section. They are encrypted with\nsimple xor.\n\nfor (ULONG i = 0; i < (ResourceSize / sizeof(ULONG_PTR)); i++)\nBuffer[i] ^= 0x7070707070707070;\n\nResource with id 1 (decrypted SHA-1 7c1b25518dee1e30b5a6eaa1ea8e4a3780c24d0c) is a\nVirtualBox driver. It is ripped by me from WinNT/Turla (another APT, this time \"believed\" to\nbe from GRU GS AF RF, that one by the way also had some references/inspirations of\nmy/our previous work). Dustman author(s) got it from my github repository called TDL - Turla\n[Driver Loader (https://github.com/hfiref0x/TDL), well not only that driver, half of their work](https://github.com/hfiref0x/TDL)\nactually blatant copy-paste of this repository.\n\nResource with id 103 (decrypted SHA-1 a7133c316c534d1331c801bbcd3f4c62141013a1) is\nEldos RawDisk modified driver (version 3.0.31.121). It is modified by Dustman authors by\nremoving digital certificate from it. Currently I have no answer why they did this, except Eldos\nRawDisk certificate is widely blacklisted or detected by intrusion prevention systems/AV as\npossible sign of threat as it was used before multiple times in different malwares\n[(https://attack.mitre.org/software/S0364/)](https://attack.mitre.org/software/S0364/)\n\nResource with id 106 (decrypted SHA-1 20d61c337653392ea472352931820dc60c37b2bc)\nis malware agent application that is intended to work with Eldos RawDisk to perform data\nwipe. It contain pdb string\n**C:\\Users\\Admin\\Desktop\\Dustman\\Furutaka\\drv\\agent.plain.pdb which is giving you**\ninsides on VS solution structure. Furutaka is an internal name that I gave to TDL project\nexecutable.\n\nInitial dropper is a modified version of original TDL (Furutaka) version 1.1.5, so it is relatively\nnew, as this is final version in that repository before it was archived at April 2019. Just to\nshow you how much Dustman authors copy-pasted, here is a screenshot of functions which I\nwas able to identify in this malware (while rest of them are various trash from MS runtime).\n\n\n-----\n\nPic 1. Dustman dropper functions.\n\nIt seems Dustman author(s) simple took TDL solution and then modified it by removing\nconsole/debug output in code and adapting it for their specific tasks - decrypt, drop\nresources to the disk, load RawDisk driver and start agent application at final stage. Lets\ntake a look on modifications made by Dustman author(s).\n\nAt main (which is a heavily modified TDLMain from original TDL) right at the beginning\nDustman attempts to block multiple copies from installing VirtualBox/mapping Eldos driver by\nsetting mutex with a very specific name \"Down With Bin Salman\". I do not want to dig into\npolitics and other bullshit but I would like to suggest in case if this is false flag operation\n(surprise, but we will never know this) use something more creative - like for example\n\"Coded by Soleimani\" or \"(c) 2019 IRGC\", \"covfefe\" is fine too. If I would doing APT of such\nkind I would at first refrain from creating such wrong and stupid mutexes or build their unique\nnames based on current environment without using any idiotic constants. Another fun\n\n\n-----\n\nmessage hidden inside agent executable (dropper resource 106 as mentioned above) Down\nWith Saudi Kingdom Down With Bin Salman\" - very creative (not). Eldos license key is\nhardcoded in agent executable as\n\"b4b615c28ccd059cf8ed1abf1c71fe03c0354522990af63adf3c911e2287a4b906d47d\".\n\nBack to initial dropper, supQueryResourceData\n[(https://github.com/hfiref0x/TDL/blob/master/Source/Furutaka/sup.c#L99) is modified by](https://github.com/hfiref0x/TDL/blob/master/Source/Furutaka/sup.c#L99)\nadding xor decryption loop mentioned above. Below is screenshot of\nTDLStartVulnerableDriver routine slightly modified by removing console output, code\nresponsible for backup and new file name for dropped file.\n\n\n-----\n\nPic 2. TDLStartVulnerableDriver copy-paste.\n\n[Original routine https://github.com/hfiref0x/TDL/blob/master/Source/Furutaka/main.c#L498](https://github.com/hfiref0x/TDL/blob/master/Source/Furutaka/main.c#L498)\n\nAssistant.sys here is VirtualBox driver which is loaded as shown on picture above. Have no\nidea why Dustman authors left VirtualBox USB/Network drivers unload code intact. In original\nTDL this is required to load driver on machine with VirtualBox installed and this is\n\n\n-----\n\n[requirement because VBoxHardenedLoader is depends on this. However this is not required](https://github.com/hfiref0x/VBoxHardenedLoader)\nin APT and can be removed, but it seems Dustman author(s) had mediocre understanding of\nwhat they are doing. It is a little doubtful that target machines has VirtualBox running which\ncan produce incompatibilities with TDL.\n\nOur next stop is [TDLMapDriver routine. In original TDL proof-of-concept it setups shellcode](https://github.com/hfiref0x/TDL/blob/master/Source/Furutaka/main.c#L320)\nthat next will be executed in kernel by VBoxDrv, maps input file, processes it imports and\nmerges it with shellcode. Next VBoxDrv memory mapping executed and finally exploit called.\nIn shellcode original TDL allocates memory for driver mapping using\n**ExAllocatePoolWithTag routine with tag 'SldT' (Tdl Shellcode), processes image relocs,**\ncreates system thread (PsCreateSystemThread) with parameter set to driver entry. TDL\nmapped drivers must be specially designed as DriverEntry parameters in such way of\nloading will be invalid. Finally thread handle closed with ZwClose. Function pointers passed\nto shellcode through registers by small bootstrap code which is constructed in user mode.\nDustman author(s) modified this loading scheme in the following way:\n\n1) Encryption for module/function names, funny note that the following string used to decrypt\nstrings in runtime \"I'm 22 and looking for fulltime job!\". Because this is copy-paste from open\nsource and original TDL is very well detected by various fakeAVs\n(https://www.virustotal.com/gui/file/37805cc7ae226647753aca1a32d7106d804556a98e1a21\nac324e5b880b9a04da/detection) this maybe an attempt to remove some of these detections.\n2) They remember ExAllocatePoolWithTag, PsCreateSystemThread and IoCreateDriver\nhowever they never use PsCreateSystemThread despite checking it resolving success and\ninstead in their shellcode simple call IoCreateDriver with pointer to driver entry point as\n_InitializationFunction param._\n\nSince IoCreateDriver expects DriverName as pointer to UNICODE_STRING modified\nshellcode also contain \"\\Driver\\elRawDsk\" string stored as local array of bytes.\n**IoCreateDriver will create driver object with specified name and pass it to the**\nInitializationRoutine as parameter, exactly what Eldos RawDisk need at it driver entry. Thus\noriginal TDL limitation bypassed and mapping code can work with usual drivers. As result of\nsuccessful exploitation Eldos RawDisk will be mapped to the kernel and it DriverEntry\nexecuted.\n\n\n-----\n\nPic 3. Eldos driver object as seen by WinObjEx64.\n\nBecause driver was mapped without involving Windows loader it doesn't have corresponding\nentry in PsLoadedModulesList therefore WinObjEx64 shows it driver object major functions\nas belonging to unknown memory area which is always automatically suspicious and usually\nmean kernel mode malware activity. While Eldos RawDisk DriverEntry execution it creates a\nsymbolic link to provide access for the applications. It also can be seen with WinObjEx64.\n\n\n-----\n\nPic 4. ElRawDisk symbolic link.\n\nHere is a mystery or at least question. Why do they use TDL at all? If you look at Eldos\nRawDisk previous versions, for example\nhttps://www.virustotal.com/gui/file/c5c821f5808544a1807dc36527ef6f0248d6768ef9ac5ebab\nae302d17dd960e4/details you will notice it is digitally signed. As I said at the beginning of\nthis post there can be IPS/AV blocking Eldos driver by it certificate. However why use Eldos\nRawDisk if you can write your own driver which will be much simpler/smaller (because it will\nmiss useless license check) and use it with TDL? It seems author(s) of Dustman prefer\nsimplest ways and incapable of writing anything beyond simple copy-pasting with small\nadditions. State sponsored hackers, rofl? It of course depends on effectiveness of such\nmethods but I think someone need a bigger budget. However if you take this entire Dustman\nas false flag operation it looks pretty much ok, because Dustman thing can be built in 4-5\nhours and cost almost nothing, while doing severe impact as informational warfare.\n\nA little about agent application, a little because as fact there is nothing interesting inside. It is\nbuilt as typical C++ MS runtime based application full of ineffective code unrelated to main\npurpose - wipe data on disk. To do this agent calls Eldos RawDisk with mentioned above\n\n\n-----\n\nlicense. As data to fill it uses Down With Saudi Kingdom Down With Bin Salman string. If\nagent launched without elevation it will crash with error due to its code quality, state\nsponsored hackers do you remember?\n\nPic 5. Wipe in progress.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-20 - Dustman APT- Art of Copy-Paste.pdf"
    ],
    "report_names": [
        "2020-01-20 - Dustman APT- Art of Copy-Paste.pdf"
    ],
    "threat_actors": [
        {
            "id": "08c8f238-1df5-4e75-b4d8-276ebead502d",
            "created_at": "2023-01-06T13:46:39.344081Z",
            "updated_at": "2025-03-27T02:00:03.056208Z",
            "deleted_at": null,
            "main_name": "Copy-Paste",
            "aliases": [],
            "source_name": "MISPGALAXY:Copy-Paste",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a97cf06d-c2e2-4771-99a2-c9dee0d6a0ac",
            "created_at": "2022-10-25T16:07:24.349252Z",
            "updated_at": "2025-03-27T02:02:10.184406Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "ATK 13",
                "Belugasturgeon",
                "Blue Python",
                "CTG-8875",
                "Group 88",
                "ITG12",
                "Iron Hunter",
                "Krypton",
                "Makersmark",
                "Operation Epic Turla",
                "Operation Moonlight Maze",
                "Operation Penguin Turla",
                "Operation Satellite Turla",
                "Operation Skipper Turla",
                "Operation Turla Mosquito",
                "Operation WITCHCOVEN",
                "Pacifier APT",
                "Pensive Ursa",
                "Popeye",
                "SIG15",
                "SIG2",
                "SIG23",
                "Secret Blizzard",
                "TAG-0530",
                "Turla",
                "UNC4210",
                "Venomous Bear",
                "Waterbug"
            ],
            "source_name": "ETDA:Turla",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "ATI-Agent",
                "AdobeARM",
                "Agent.BTZ",
                "Agent.DNE",
                "BigBoss",
                "COMpfun",
                "Chinch",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobra Carbon System",
                "ComRAT",
                "DoublePulsar",
                "EmPyre",
                "EmpireProject",
                "Epic Turla",
                "EternalBlue",
                "EternalRomance",
                "GoldenSky",
                "Group Policy Results Tool",
                "HTML5 Encoding",
                "HyperStack",
                "IcedCoffee",
                "IronNetInjector",
                "KSL0T",
                "Kapushka",
                "Kazuar",
                "KopiLuwak",
                "Kotel",
                "LOLBAS",
                "LOLBins",
                "LightNeuron",
                "Living off the Land",
                "Maintools.js",
                "Metasploit",
                "Meterpreter",
                "MiamiBeach",
                "Mimikatz",
                "MiniDionis",
                "Minit",
                "NBTscan",
                "NETTRANS",
                "NETVulture",
                "Neptun",
                "NetFlash",
                "NewPass",
                "Outlook Backdoor",
                "Penquin Turla",
                "Pfinet",
                "PowerShell Empire",
                "PowerShellRunner",
                "PowerShellRunner-based RPC backdoor",
                "PowerStallion",
                "PsExec",
                "PyFlash",
                "QUIETCANARY",
                "Reductor RAT",
                "RocketMan",
                "SMBTouch",
                "SScan",
                "Satellite Turla",
                "SilentMoon",
                "Sun rootkit",
                "TTNG",
                "TadjMakhal",
                "Tavdig",
                "TinyTurla",
                "TinyTurla Next Generation",
                "TinyTurla-NG",
                "Topinambour",
                "Tunnus",
                "Turla",
                "Turla SilentMoon",
                "TurlaChopper",
                "Uroburos",
                "Urouros",
                "WCE",
                "WITCHCOVEN",
                "WhiteAtlas",
                "WhiteBear",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Wipbot",
                "WorldCupSec",
                "XTRANS",
                "certutil",
                "certutil.exe",
                "gpresult",
                "nbtscan",
                "nbtstat",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8aaa5515-92dd-448d-bb20-3a253f4f8854",
            "created_at": "2024-06-19T02:03:08.147099Z",
            "updated_at": "2025-03-27T02:05:17.408118Z",
            "deleted_at": null,
            "main_name": "IRON HUNTER",
            "aliases": [
                "Belugasturgeon ",
                "Blue Python ",
                "CTG-8875 ",
                "ITG12 ",
                "KRYPTON ",
                "MAKERSMARK ",
                "Pensive Ursa ",
                "Secret Blizzard ",
                "Turla",
                "UAC-0003 ",
                "UAC-0024 ",
                "UNC4210 ",
                "Venomous Bear ",
                "Waterbug ",
                "ATK13 "
            ],
            "source_name": "Secureworks:IRON HUNTER",
            "tools": [
                " ComRAT",
                " Kazuar",
                " KopiLuwak",
                " LightNeuron",
                " Mosquito",
                " Nautilus",
                " Neuron",
                " Penquin",
                " PoisonFrog",
                " PyFlash",
                " Skipper",
                " Snake",
                " Tavdig",
                " TinyTurla",
                " Tunnus",
                "Carbon-DLL"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a97fee0d-af4b-4661-ae17-858925438fc4",
            "created_at": "2023-01-06T13:46:38.396415Z",
            "updated_at": "2025-03-27T02:00:02.823045Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Uroburos",
                "Hippo Team",
                "Pacifier APT",
                "MAKERSMARK",
                "ATK13",
                "UAC-0003",
                "IRON HUNTER",
                "Waterbug",
                "TAG_0530",
                "KRYPTON",
                "Popeye",
                "SIG23",
                "UAC-0144",
                "G0010",
                "Blue Python",
                "VENOMOUS Bear",
                "Group 88",
                "Pfinet",
                "ITG12",
                "UNC4210",
                "Secret Blizzard",
                "UAC-0024"
            ],
            "source_name": "MISPGALAXY:Turla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535612,
    "ts_updated_at": 1743041780,
    "ts_creation_date": 1653705449,
    "ts_modification_date": 1653705449,
    "files": {
        "pdf": "https://archive.orkl.eu/82a64770343087560f833fe24dd495c0579eb410.pdf",
        "text": "https://archive.orkl.eu/82a64770343087560f833fe24dd495c0579eb410.txt",
        "img": "https://archive.orkl.eu/82a64770343087560f833fe24dd495c0579eb410.jpg"
    }
}