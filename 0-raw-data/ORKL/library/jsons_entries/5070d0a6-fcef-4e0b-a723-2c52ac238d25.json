{
    "id": "5070d0a6-fcef-4e0b-a723-2c52ac238d25",
    "created_at": "2023-01-12T15:02:03.644843Z",
    "updated_at": "2025-03-27T02:05:55.218814Z",
    "deleted_at": null,
    "sha1_hash": "89c207c631a85c678b73767f27c26ce8ac2395b0",
    "title": "2017-09-20 - Is Hajime botnet dead-",
    "authors": "",
    "file_creation_date": "2022-05-28T18:27:44Z",
    "file_modification_date": "2022-05-28T18:27:44Z",
    "file_size": 428215,
    "plain_text": "# Is Hajime botnet dead?\n\n**blog.netlab.360.com/hajime-status-report-en/**\n\nRootKiter September 20, 2017\n\n20 September 2017 / [IoT Botnet](http://blog.netlab.360.com/tag/iot-botnet/)\n\n## Overview\n\nThe mysterious Hajime botnet was first discovered by Rapiditynetworks in Oct 2016, and it\nwas all over the news earlier this year, but it seems that nobody talks about it any more now,\nis this botnet gone?\n\nThe answer is no, our team has been tracking this botnet for quite some time, and we have\nrecently noticed the number of infections has been going up, and a very interesting feature,\nan x64 config has been added in the code(is the botnet author eying PC platform as the next\ntarget? Or key leaked?).\n\nUnlike the traditional Hajime-runs-in-sandbox solution, which really has no control over the\nbot besides merely observing it(a good example, researcher cannot ask the bot in sandbox\nto go over all the peering nodes and pull all the files).\n\nOur team was able to figure out the key exchange scheme of this botnet so we are able to\nparticipate in the Hajime network with full control of the bot behaviors, with that, we have\nbeen able to gain more insights. The visibility of this botnet is fairly poor in security research\nfield, with the two observations above, we decide to talk about this botnet a little bit and also\n[start a public accessible Hajime tracking project here](http://data.netlab.360.com/hajime/)\n\n## How Hajime works\n\nFor some basic concepts of Hajime botnet, we suggest readers to take a good look at the\n[Rapiditynetworks paper here so we don’t need to repeat known facts here.](https://security.rapiditynetworks.com/publications/2016-10-16/hajime.pdf)\n\n## Overall framework\n\nHajime’s implementation follows the modular programming paradigm. There are two\ncommon executable modules: \"execution module” (also known as stage2 or .i module) and\n“propagation module\" (also known as atk module).\n\n\n-----\n\nIn the propagation module (.i module), the Hajime nodes will establish a P2P network based\non the DHT protocol. On top of this P2P network, Hajime nodes can perform inter-node\nnegotiation, control command transmission and file synchronization. Any node can obtain the\ncontrol instructions from the administrator without direct communication to the administrator.\nThis not only provides protection for the administrator, but also maintains the stability of the\nbotnet itself. Once the network is set up, it is extremely difficult to take it down.\n\n\n-----\n\nIn the DHT network, Hajime encodes the config file as a special infohash value. This is a 160\nbit binary number, changed daily. By indexing the infohash value, Hajime can get the latest\nconfig file.\n\n\n-----\n\nThe above figure shows a config file in August 12, 2017. You can see it is a text file. The\nmodules field contains the module file name for different CPU architectures. The peers field\nspecifies the entry domain name for the DHT network. The two domain names are both valid\nand publicly accessible. The configuration file will direct Hajime to synchronize to the latest\n\"propagation module (atk module)\" or “execution module (.i module)\".\n\n## File synchronization\n\nIn a DHT network, each Hajime node can correspond to a peer. By searching in the DHT\nnetwork, the Hajime node can easily get the address information of other Hajime nodes.\nDuring file synchronization, it will traverse other nodes sequentially and perform\nsynchronization on each node. The inter-node communication relies on the uTP protocol.\nThis protocol implements mechanisms such as three-way handshake, session\nretransmission and session interruption based on UDP to ensure trusted communication\nbetween Hajime nodes.\n\n## Key exchange\n\nOn the channel provided by uTP, Hajime made the RC4 communication encryption for each\nsession to ensure that others could not restore the content by packet capture. Besides,\nHajime uses a key negotiation algorithm to ensure that the RC4 key is not stealable.\n\nHajime uses ECDH as the key exchange protocol and selects a key exchange algorithm\nbased on Curve25519 elliptic curve. Although there are many open ECDH implementations\non the Internet, the author of Hajime did not use the existing code directly. He has\nimplemented a more efficient key exchange process. This implementation features on\nprojecting points from the original elliptical space to the new one-dimensional series.\nBesides, in the \"double point\" calculation process, it only calculates the X coordinates,\nwithout considering the Y coordinates. Therefore he can improve the computational\nefficiency.\n\n\n-----\n\n_[Reference for Curve25519 can be found at: https://cr.yp.to/ecdh.html](https://cr.yp.to/ecdh.html)_\n_The fundamentals for the new key exchange algorithm can be found at_\n_[https://cr.yp.to/ecdh/curvezero-20060726.pdf](https://cr.yp.to/ecdh/curvezero-20060726.pdf)_\n\n## Document Signature\n\nIn P2P networks, nodes are untrustworthy, and anyone can fake a Hajime node at a very low\ncost. To ensure that the Hajime network is completely controllable and not stolen by others,\nHajime nodes need to verify the signature of each synchronized file before acceptance and\nexecution. Hajime adopts a public digital signature algorithm called ED25519 and uses\n```\nA55CEED41FECB3AC66B6515AB5D383791B00FEC166A590D7626A04C2466B3F54 as public\n\n```\nkey, which is integrated into each Hajime's execution module. Thus every Hajime nodes can\nverify the integrity of an new synchronized file.\n\n## Current status\n\nThe following diagram shows daily active hijime nodes since the beginning of July.\n\n## Daily active nodes\n\nBelow shows the number of daily active IPs:\n\nIt is not difficult to spot that in the second half of July, Hajime infection went down.\nCorrespondently there were no botnet file update during that period(did the author go for\nvacation?) Starting from August, the author started to update the Hajime files, and the bot\nnumbers started to going up, noticeably on 2017-08-06 and 2017-08-12, with the author\npushing update, the botnet climbed up really quickly. Subsequently, Hajime completed\nseveral updates on 2017-08-18, 2017-08-19, 2017-08-22 and 2017-09-04. This opened the\nnew normality of frequent updates.\n\n## Geographical distribution\n\nThe following figure shows the geographical activity of Hajime in the past two months:\n\n\n-----\n\nThe deeper the color, the more serious the affected area.\n\n## Update frequency\n\nHajime was not updated frequently in July, and there was a two-week break. However, after\nAugust 5, Hajime began to regain activity:\n\n\n-----\n\nIn fact, all updates in the past month are patches on the existing code. There’s no dramatic\nchange.\n\n## Update on bot propagation\n\nOriginally,Hajime propagated mainly thought TR_069 vulnerability and weak telnet account,\nas time goes by, more vulnerabilities have been added, and the following is the newest\nvulnerability breakdown.\n\n\n-----\n\n```\ninsecurity.html\n\n```\n\n## CPU Architecture Distribution of Hajime Node\n\nThe propagation of Hajime is limited among a small number of different CPUs. Our analysis\non 18433 Hajime nodes shows that the Mipseb CPU is affected the most.\n\n## More Observations on Hajime\n\n\n-----\n\n## Support for x64 platform?\n\nOur tracking system captured a special config file `b8a5082689606ea20a557883dbff7d10`\non 2017-08-29.\n\nThis config file can be verified successfully and contained settings for X64 CPU, which\nindicated that Hajime author is planning to support PC platforms.\n\nThe config file is shown as followed:\n\nHowever there are some doubts in this config file:\n\nWe can only get two modules (atk.mipseb/.i.mipseb) listed in the config file while other\nCPU architecture's modules are unavailable in Hajime network.\nThe \"info\" field, which contains the author's whitehat declaration, is missing in this\nconfig file. This is quite abnormal according to author's previous habit.\n\nSo we have two possibilities here:\n\nThe author has intention to support x64 platform. As mentioned before, all Hajime files\nare signed by the private key and need to be verified before any Hajime node takes the\nupdate.\n\n\n-----\n\nThe private key has been leaked, someone else is trying to poison the Hajime network.\n\nWe prefer the first scenario at this point, and it will be big change for Hajime itself if it is\nmoving to the pc battleground. We will keep a close eye on what will unfold in the future.\n\n1: [https://x86.re/blog/hajime-a-follow-up/](https://x86.re/blog/hajime-a-follow-up/)\n2: [https://github.com/Psychotropos/hajime_hashes](https://github.com/Psychotropos/hajime_hashes)\n3: [https://security.rapiditynetworks.com/publications/2016-10-16/hajime.pdf](https://security.rapiditynetworks.com/publications/2016-10-16/hajime.pdf)\n4: [https://securelist.com/hajime-the-mysterious-evolving-botnet/78160/](https://securelist.com/hajime-the-mysterious-evolving-botnet/78160/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-09-20 - Is Hajime botnet dead-.pdf"
    ],
    "report_names": [
        "2017-09-20 - Is Hajime botnet dead-.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535723,
    "ts_updated_at": 1743041155,
    "ts_creation_date": 1653762464,
    "ts_modification_date": 1653762464,
    "files": {
        "pdf": "https://archive.orkl.eu/89c207c631a85c678b73767f27c26ce8ac2395b0.pdf",
        "text": "https://archive.orkl.eu/89c207c631a85c678b73767f27c26ce8ac2395b0.txt",
        "img": "https://archive.orkl.eu/89c207c631a85c678b73767f27c26ce8ac2395b0.jpg"
    }
}