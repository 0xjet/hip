{
    "id": "65910e92-4878-489d-afb3-1f28b3395078",
    "created_at": "2023-01-12T15:05:33.553508Z",
    "updated_at": "2025-03-27T02:05:36.327352Z",
    "deleted_at": null,
    "sha1_hash": "890b8a3262c3f034da3df288d6075d8c202ee5a5",
    "title": "2016-07-26 - Attack Delivers ‘9002’ Trojan Through Google Drive",
    "authors": "",
    "file_creation_date": "2022-05-28T00:33:42Z",
    "file_modification_date": "2022-05-28T00:33:42Z",
    "file_size": 491640,
    "plain_text": "# Attack Delivers ‘9002’ Trojan Through Google Drive\n\n**[researchcenter.paloaltonetworks.com/2016/07/unit-42-attack-delivers-9002-trojan-through-google-drive/](http://researchcenter.paloaltonetworks.com/2016/07/unit-42-attack-delivers-9002-trojan-through-google-drive/)**\n\nRobert Falcone, Jen Miller-Osborn July 26, 2016\n\nBy [Robert Falcone and](https://unit42.paloaltonetworks.com/author/robertfalcone/) [Jen Miller-Osborn](https://unit42.paloaltonetworks.com/author/jen-miller-osborn/)\n\nJuly 26, 2016 at 5:00 PM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [9002 Trojan,](https://unit42.paloaltonetworks.com/tag/9002-trojan/) [AutoFocus,](https://unit42.paloaltonetworks.com/tag/autofocus/) [Google Drive,](https://unit42.paloaltonetworks.com/tag/google-drive/) [HTTP,](https://unit42.paloaltonetworks.com/tag/http/) [Poison Ivy,](https://unit42.paloaltonetworks.com/tag/poison-ivy/) [TinyURL,](https://unit42.paloaltonetworks.com/tag/tinyurl/) [Trojan,](https://unit42.paloaltonetworks.com/tag/trojan/) [WildFire](https://unit42.paloaltonetworks.com/tag/wildfire/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/unit-42-attack-delivers-9002-trojan-through-google-drive/)\n\nUnit 42 recently observed a 9002 Trojan delivered using a combination of shortened links and a\nshared file hosted on Google Drive. The delivery method also uses an actor-controlled server\nhosting a custom redirection script to track successful clicks by targeted email addresses. The\ninfrastructure associated with this 9002 Trojan sample was also found to have previous ties to\nattacks on Myanmar and other Asian countries that used Poison Ivy as the payload, including a\nrecent, and possibly ongoing campaign against Taiwan.\n\n## Short but sweet…\n\nWhile we do not have specific telemetry on the attack at this time, we believe the attack relies on a\nshortened link (in this case using the URL shortening service TinyURL) to deliver the 9002\npayload. The shortened URL is as follows:\n\nhxxp://tinyurl[.]com/zmu4dry\n\nThis shortened link redirects to an actor-controlled server that we refer to as a redirection server,\nas it hosts a script responsible for redirecting the browser to another location. The shortened link\nabove points to:\n\nhxxp://222.239.91[.]152?\n<redacted>QGdtYWlsLmNvbWh0dHA6Ly90aW55dXJsLmNvbS9qZmo5b3V2\n\nThe URL above contains base64 encoded data, which we believe will then be decoded by the\nserver. The base64 encoded parameter in the URL redirect decodes to:\n\n<redacted>@gmail.comhttp://tinyurl[.]com/jfj9ouv\n\nThe Gmail address in the decoded data is the legitimate address of a well-known politician and\nhuman rights activist in Myanmar. The shortened URL within the decoded data, specifically\n‘hxxp://tinyurl[.]com/jfj9ouv’ again redirects to:\n\n\n-----\n\nhxxps://drive.google[.]com/uc?\nid=0B0eVt8dSXzFuN2ltVlVkVl8zNVU&authuser=0&export=download\n\n## Actor’s Redirection Server\n\nThe server with an IP address of ‘222.239.91[.]152’ appears to run a script that parses parameters\nfrom inbound HTTP requests. To better determine the script’s functionality, we issued a series of\nHTTP requests to the redirection server to figure out the purpose of the base64 encoded data\nwithin the URL and to determine the strings that the script uses to redirect the browser.\n\nOur initial HTTP request, as seen in Figure 1, involved the URL pointed to by the initial shortened\nlink associated with this attack. As seen from the HTTP response, the script issued an HTTP 302\nMoved Temporarily response to relocate the browser to the URL in the “Location” field, which is\nthe same URL from the decoded base64 data sent in the HTTP request.\n\n\n1\n2\n3\n4\n5\n6\n\n\n$ curl -i -A \"Mozzarella/4.0\" 222.239.91[.]152?\n<redacted>QGdtYWlsLmNvbWh0dHA6Ly90aW55dXJsLmNvbS9qZmo5b3V2\nHTTP/1.1 302 Moved Temporarily\nConnection: close\nContent-Length: 0\nDate: Mon, 18 Jul 2016 16:25:28 GMT\nLocation: http://tinyurl[.]com/jfj9ouv\n\n\nFigure 1 Response to HTTP request to initial delivery URL\n\nThe second test HTTP request we issued used the base64 encoded data for the string\n“fake@gmail.comhttp://yahoo.com”, which as seen in Figure 2 would redirect the browser to\n“http://yahoo.com” via an HTTP 302 response. This suggests that the email string is not used for\nany sort of authentication for the inbound request, and instead is possibly used by the threat\nactors to track successful clicks by a targeted email.\n\n\n1\n2\n3\n4\n5\n6\n\n\n$ curl -i -A \"Mozzarella/4.0\" http://222.239.91[.]152/?\nZmFrZUBnbWFpbC5jb21odHRwOi8veWFob28uY29t\nHTTP/1.1 302 Moved Temporarily\nConnection: close\nContent-Length: 0\nDate: Mon, 18 Jul 2016 17:10:33 GMT\nLocation: http://yahoo.com\n\n\nFigure 2 Test request confirming that the redirection server uses the base64 decoded data for\nredirection\n\nWe issued an HTTP request using the base64 encoded data for the string\n“fake@gmail.comyahoo.com”. Figure 3 shows that the server responded with an HTTP 200 OK\nresponse that attempts to resemble an HTTP 403 Forbidden response, by writing “403 Forbidden”\nto the browser window. This error suggests that the redirection script on the server parses the\nbase64 decoded data for the string “http” to determine the redirection location.\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n$ curl -i -A \"Mozzarella/4.0\" http://222.239.91[.]152/?\nZmFrZUBnbWFpbC5jb215YWhvby5jb20\nHTTP/1.1 200 OK\nConnection: close\nContent-Type: text/html; charset=ISO-8859-1\nContent-Length: 89\nDate: Mon, 18 Jul 2016 17:11:10 GMT\n\n<html><head><title>403 Forbidden</title></head><body><h1>403 Forbidden</h1></body>\n</html>\n\n\nFigure 3 Test request showing the redirection server requires \"http\" within the base64 decoded\ndata\n\nWe ran subsequent test requests to find additional strings that the script would check for within the\nbase64 decoded data, which it uses to determine the location it should redirect the browser. We\nfound that the script also supports redirection to URLs that begin with “https”. Also, the script is\ncase sensitive, as requests for URLs with “HTTP” and “HTTPS” resulted in the same 403\nForbidden response seen in Figure 3. Lastly, we determined that the script does not require the\n“://” characters after “http” and “https”.\n\n## Trojan from the Cloud\n\nIn the delivery of this attack, the shortened link that the redirection server redirects to points to a\nZip file hosted on Google Drive. The Zip file has a filename of “2nd Myanmar Industrial Human\nResource Development Symposium.zip” (SHA256:\nc11b963e2df167766e32b14fb05fd71409092092db93b310a953e1d0e9ec9bc3) and contains one\nexecutable that was added on July 13, 2016.\n\nThe executable within this Zip archive has a filename “2nd Myanmar Industrial Human Resource\nDevelopment Symposium.exe” (SHA256:\n49ac6a6c5449396b98a89709b0ad21d078af783ec8f1cd32c1c8b5ae71bec129). It is a dropper\nTrojan that saves a decoy and a payload to the system then opens both. The executable uses the\nPowerPoint icon, as seen in Figure 4 to trick the victim into launching the executable by making\nthe user think the file is a PowerPoint presentation.\n\nFigure 4 Payload has a PowerPoint icon to trick the victim into double clicking the executable\n\nThe decoy, seen in Figure 5, is a PowerPoint presentation that contains details of a conference in\nMyanmar held on July 30, 2016, titled “Role of JMVTI Aung San and Building of Clean and Safe\nAutomobile Society”. The Japan Myanmar Vocational Training Institute (JMVTI) Aung San is a\nforthcoming vocational training center established by the Asia Environmental Technology\nPromotion Institute under Myanmar's Ministry of Science and Technology.\n\n\n-----\n\nFigure 5 Decoy document opened during the installation of the 9002 Trojan\n\nIn regards to the payload, the dropper creates a randomly named folder within the current user’s\nfolder (%USERPROFILE%), which it uses to store the following files:\n\nRealNetwork.exe (SHA256:\n10d40c51d85ea9ced6050b8951802aaebe81f7db13f42fe5a5589172af481a7e)\nmain.dll (SHA256:\n53671fe98a0c8c85f6f8eabfa851e27b437f6c392b46e42ddea3f0a656591b12)\nmpaplugins\\MPAMedia.dll (SHA256:\nf76f639f2a7b8f39abf83737c6d3e533be66398c85ec95526e4b13561e15fbae)\n\nThe 'RealNetwork.exe' file is a legitimate executable signed to 'RealNetworks, Inc.' that loads\n'mpaplugins\\MPAMedia.dll' to call a function named 'BuildDeviceDatabase'. The threat actors\n[however, leverage the legitimate executable to sideload a DLL they created by saving the](https://attack.mitre.org/wiki/DLL_side-loading)\n'mpaplugins\\MPAMedia.dll' to the randomly named folder created by the dropper.\n\nThe sideloaded 'MPAMedia.dll' DLL first checks to make sure the system time is greater than May\n20, 2016 as a likely attempt for sandbox evasion. It will then load the 'main.dll' file initially saved to\nthe randomly named folder created by the dropper. The overall loading process of this Trojan can\nbe seen in Figure 6.\n\n\n-----\n\nFigure 6 Overview of DLL sideloading process\n\nThe ‘MPAMedia.dll” DLL calls exported functions named \"stdInstall\" and \"CreateFunc\" from within\n‘main.dll’. The 'stdInstall' function is responsible for creating the following autorun registry key for\npersistence purposes:\n\nSoftware\\Microsoft\\Windows\\CurrentVersion\\Run\\RealNetwork\n\nThe 'CreateFunc' exported function returns the offset within the 'main.dll' file to shellcode that\ncontains 9002 Trojan's actual functional code, which 'MPAMedia.dll' DLL will then create a thread\nto execute the Trojan. The 9002 Trojan creates two mutexes during its execution: F16ME and\nwidfasdf. It also creates the following registry key that it uses to store the path to the user's folder\n(%USERPROFILE%):\n\nHKCU\\Software\\Microsoft\\F6\\uid\n\nThe Trojan uses the path stored in this registry key to locate its configuration, which it decrypts\nusing a multiple-byte XOR algorithm and a key of “1pKFmjw”. Figure 7 shows a hexdump of the\ndecrypted configuration for this sample of 9002.\n\n\n-----\n\nFigure 7 9002 Trojan's configuration\n\nUsing the configuration file above, the 9002 Trojan communicates with the following domain that\nacts as its command and control (C2) server:\n\nlogitechwkgame[.]com\n\nThe Trojan sends network beacons to its C2 server using two different methods. The first method,\nseen in Figure 8 uses a custom protocol on TCP port 80 that begins with the string ‘9002’, which is\nthe basis of the tool’s name. If the C2 server responds, the Trojan will send system specific\ninformation along with the strings “jackhex” and “2016” from the configuration file. \"jackhex\" has\nalso been seen in a C2 for what is likely related Poison Ivy activity, discussed briefly later in this\nblog.\n\nFigure 8 Network beacon using custom 9002 protocol\n\n\n-----\n\nThe second beacon method also uses TCP port 80, but this method uses HTTP requests to\ncommunicate with its C2 server. Figure 9 shows a sample HTTP request issued by this Trojan,\nwhich has a user-agent of “lynx” and POST data of “AA” that are both hardcoded into the payload.\n\nFigure 9 Network beacon from 9002 using HTTP request\n\n[The two beacons seen generated by this payload are very similar to those generated by the ‘3102’](https://blog.paloaltonetworks.com/2015/09/chinese-actors-use-3102-malware-in-attacks-on-us-government-and-eu-media/)\nvariant of 9002 that we previously analyzed. The capabilities within this 9002 sample are very\nsimilar to the 3102 variant discussed, as its main functionality is to load plugins provided by the C2\nserver and call an exported function named “CreatePluginObj”.\n\n## Infrastructure and Poison Ivy Ties\n\nThe C2 server ‘logitechwkgame[.]com’ resolves to the IP address '222.239.91[.]30', which also\nresolved to 'admin.nslookupdns[.]com' at the same time as 'logitechwkgame[.]com', suggesting\nthat these two domains are associated with the same threat actors. 'admin.nslookupdns[.]com'\nwas found to also be a C2 for Poison Ivy samples associated with attacks on Myanmar and other\n[Asian countries as discussed in a blog published by Arbor Networks. An additional tie between the](https://www.arbornetworks.com/blog/asert/recent-poison-iv/)\nactivity is the Poison Ivy C2 'jackhex.md5c[.]net', as \"jackhex\" is not a common word or phrase\nand is also seen in the beacon activity with the previously discussed 9002 sample.\n\nIn addition to those noted in the blog by Arbor Networks, we found several other Poison Ivy\nsamples using the same mutex, created by the same parent processes, and using most of the\nsame C2 infrastructure. However, the samples we collected lack campaign IDs and all use\n\"version2013\" as the password to encrypt its communications. The additional Poison Ivy samples\nalso provided us three new C2 domains:\n\nouthmail[.]com\nmxdnsv6[.]com\nmicrosoftserve[.]com\n\n\n-----\n\nAlso, some of the C2 domains associated with these Poison Ivy samples were registered with\nemails that were used to register the following possibly related domains:\n\ngooledriveservice[.]com\nqueryurl[.]com\nappupdatemoremagic[.]com\n\nWhile we do not have complete targeting information associated with these samples, several of\nthe decoy files were in Chinese and appear to be part of a recent and possibly ongoing campaign\ntargeting organizations in Taiwan. The decoy themes centered primarily around cross-strait\nrelations and the Taiwanese Mainland Affairs Council (MAC), which is a cabinet-level organization\ntasked with creating, implementing, and overseeing policies between Taiwan and the People's\nRepublic of China (PRC).\n\n## Conclusion\n\nThe use of Google Drive to host malicious files is not a new tactic in attacks. However, using a\nwell-known hosting platform may allow the downloading of a payload to blend into other legitimate\ntraffic from the hosting provider. The actors still use spear phishing as their primary attack method,\nbut because that technique has been so well publicized, intended victims are perhaps more\ncautious about opening suspicious email attachments or links. As spear phishing becomes less\nsuccessful, threat actors need to continue to adapt and find new methods to successfully deliver\nmalware. The use of a URL shortening service and a redirection server further aids the chances of\na successful attack, as it becomes more challenging to determine the validity of the link within an\nemail due to the way link shorteners obfuscate link content.\n\nThe files used in these attacks are properly classified as malware by WildFire. AutoFocus\n[customers can find out more about both 9002 and](https://autofocus.paloaltonetworks.com/#/tag/Unit42.9002) [Poison Ivy via the respective malware family](https://autofocus.paloaltonetworks.com/#/tag/Unit42.PoisonIvy)\ntags.\n\n## IOCs\n\n**9002 samples**\n\nC11b963e2df167766e32b14fb05fd71409092092db93b310a953e1d0e9ec9bc3\n\n49ac6a6c5449396b98a89709b0ad21d078af783ec8f1cd32c1c8b5ae71bec129\n\n**Poison Ivy samples**\n\n193ae4da14874aa29902052d08064395afa5e4763f949e7369157d893fa08653\n\nac8fc264c7ec3cf70836e1bb21f9a20174b04ad49731b8797d7d8bb95cb353e2\n\n12759f7fd01ffdea97954be5404d7e43a3941a7388129e7b6ace85f56b500cd8\n\n0940602e7d47941f36c975afa9d2c6b1b0d2bd15bbea6ad4baf0f828420d72bf\n\n6bdd45cb6c021512c203cf01a051dce28449e364627e1366412c0051094f60a0\n\nf0ab826ea65b4a9eb66528ad74c4d3e747c1ecebfca6bdafd2504e0f794195d9\n\ne2fb4a53e54774f1645c940f905e76beb5fc729e9e968b736b8377312cb2454a\n\n0af768b4ba8fe7aac7a7da7fd5f21e7496d5617dccdf2321f526fd1091d64a6d\n\n\n-----\n\nfd21cd1846f25d42b1997ec1fd5ae6e14ea9b5bb0161ab7edf0ce184174e6da6\n12759f7fd01ffdea97954be5404d7e43a3941a7388129e7b6ace85f56b500cd8\n08dee1f5ced372716ad5c6e3f2041bcdeb25e905efc19d3749fe637d0a589ccc\n269c03e205c403ab8fa1033caa1c8e3a86a1495cc33a7f3a3a3c9b8a9ea77490\n3a9ab623c8a0a9f6c65e108e83c90da7620d2d6b22192c857556117587d0d038\n\n**C2 Domains**\n\nlogitechwkgame[.]com\njackhex.md5c[.]net\nwebserver.servehttp[.]com\nadmin.nslookupdns[.]com\nouthmail[.]com\nmxdnsv6[.]com\nmicrosoftdefence[.]com\nmicrosoftserve[.]com\ngooledriveservice[.]com\nqueryurl[.]com\nappupdatemoremagic[.]com\n\n**Get updates from**\n**Palo Alto**\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-07-26 - Attack Delivers ‘9002’ Trojan Through Google Drive.pdf"
    ],
    "report_names": [
        "2016-07-26 - Attack Delivers ‘9002’ Trojan Through Google Drive.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535933,
    "ts_updated_at": 1743041136,
    "ts_creation_date": 1653698022,
    "ts_modification_date": 1653698022,
    "files": {
        "pdf": "https://archive.orkl.eu/890b8a3262c3f034da3df288d6075d8c202ee5a5.pdf",
        "text": "https://archive.orkl.eu/890b8a3262c3f034da3df288d6075d8c202ee5a5.txt",
        "img": "https://archive.orkl.eu/890b8a3262c3f034da3df288d6075d8c202ee5a5.jpg"
    }
}