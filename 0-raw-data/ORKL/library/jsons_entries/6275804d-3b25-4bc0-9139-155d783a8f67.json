{
    "id": "6275804d-3b25-4bc0-9139-155d783a8f67",
    "created_at": "2023-01-12T15:06:49.535722Z",
    "updated_at": "2025-03-27T02:06:13.748326Z",
    "deleted_at": null,
    "sha1_hash": "b14795df07f41775e76aa5063f0f1c6507a7f6aa",
    "title": "2022-03-25 - XLSB Files- Because Binary is Stealthier Than XML",
    "authors": "",
    "file_creation_date": "2022-05-28T15:58:17Z",
    "file_modification_date": "2022-05-28T15:58:17Z",
    "file_size": 364515,
    "plain_text": "# SANS ISC: XLSB Files: Because Binary is Stealthier Than XML - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training SANS ISC InfoSec Forums\n\n**[isc.sans.edu/forums/diary/XLSB+Files+Because+Binary+is+Stealthier+Than+XML/28476/](https://isc.sans.edu/forums/diary/XLSB+Files+Because+Binary+is+Stealthier+Than+XML/28476/)**\n\n## XLSB Files: Because Binary is Stealthier Than XML\n\n\n## In one of his last diaries[1], Brad mentioned an Excel sheet named with a .xlsb extension. Now, it was my turn to find one... What's the magic behind this file extension? \"XLS\" means that we are facing an Excel sheet and \"B\" means that we have a binary workbook file. Within the current Microsoft office files format, data are stored in XML. In this case, they are stored in binary. For Microsoft Office, to open a normal or binary file is the same... but for an attacker, the plus-value is the increased level of obfuscation! Indeed, it's more difficult to extract interesting information like... strings!\n\n When you open the file, you see a classic message asking you to enable macros:\n\n Let's have a look at the document:\n```\nremnux@remnux:/MalwareZoo/20220324$ oledump.py luamccsbuaraeos.xlsb\nWarning: no OLE file was found inside this ZIP container (OPC)\n\n No VBA macro found! Let's check the content of the file and look for a potential Excel 4 macro:\n\n```\n\n## Xme\n\n 687 Posts\n ISC Handler Mar 25th 2022\n\n\n-----\n\n```\n    @ g p p py\nIndex Filename                 Encrypted Timestamp      \n  1 [Content_Types].xml               0 1980-01-01 00:00:00 \n  2 _rels/.rels                   0 1980-01-01 00:00:00 \n  3 xl/_rels/workbook.bin.rels            0 1980-01-01 00:00:00 \n  4 xl/workbook.bin                 0 1980-01-01 00:00:00 \n  5 xl/worksheets/sheet1.bin             0 1980-01-01 00:00:00 \n  6 xl/worksheets/sheet2.bin             0 1980-01-01 00:00:00 \n  7 xl/worksheets/sheet3.bin             0 1980-01-01 00:00:00 \n  8 xl/worksheets/sheet4.bin             0 1980-01-01 00:00:00 \n  9 xl/macrosheets/intlsheet1.bin          0 1980-01-01 00:00:00 \n  10 xl/macrosheets/sheet1.bin            0 1980-01-01 00:00:00 \n  11 xl/macrosheets/sheet2.bin            0 1980-01-01 00:00:00 \n  12 xl/theme/theme1.xml               0 1980-01-01 00:00:00 \n  13 xl/media/image1.png               0 1980-01-01 00:00:00 \n  14 xl/styles.bin                  0 1980-01-01 00:00:00 \n  15 xl/drawings/drawing1.xml             0 1980-01-01 00:00:00 \n  16 xl/worksheets/_rels/sheet1.bin.rels       0 1980-01-01 00:00:00 \n  17 xl/worksheets/_rels/sheet2.bin.rels       0 1980-01-01 00:00:00 \n  18 xl/worksheets/_rels/sheet3.bin.rels       0 1980-01-01 00:00:00 \n  19 xl/worksheets/_rels/sheet4.bin.rels       0 1980-01-01 00:00:00 \n  20 xl/macrosheets/_rels/intlsheet1.bin.rels     0 1980-01-01 00:00:00 \n  21 xl/macrosheets/_rels/sheet1.bin.rels       0 1980-01-01 00:00:00 \n  22 xl/macrosheets/_rels/sheet2.bin.rels       0 1980-01-01 00:00:00 \n  23 xl/drawings/_rels/drawing1.xml.rels       0 1980-01-01 00:00:00 \n  24 xl/sharedStrings.bin               0 1980-01-01 00:00:00 \n  25 xl/worksheets/binaryIndex1.bin          0 1980-01-01 00:00:00 \n  26 xl/worksheets/binaryIndex2.bin          0 1980-01-01 00:00:00 \n  27 xl/worksheets/binaryIndex3.bin          0 1980-01-01 00:00:00 \n  28 xl/worksheets/binaryIndex4.bin          0 1980-01-01 00:00:00 \n  29 xl/macrosheets/binaryIndex1.bin         0 1980-01-01 00:00:00 \n  30 xl/macrosheets/binaryIndex2.bin         0 1980-01-01 00:00:00 \n  31 xl/macrosheets/binaryIndex3.bin         0 1980-01-01 00:00:00 \n  32 xl/printerSettings/printerSettings1.bin     0 1980-01-01 00:00:00 \n  33 xl/printerSettings/printerSettings2.bin     0 1980-01-01 00:00:00 \n  34 xl/calcChain.bin                 0 1980-01-01 00:00:00 \n  35 docProps/core.xml                0 1980-01-01 00:00:00 \n  36 docProps/app.xml                 0 1980-01-01 00:00:00 \n\n## As you can see, no XML files but \".bin\" files but some streams disclose the presence of macros:\nxl/macrosheets/sheet1.bin \nxl/macrosheets/_rels/intlsheet1.bin.rels\nxl/sharedStrings.bin   \n\n sharedStrings.bin is a very good indicator! Let's dump it:\n\n```\n\n-----\n\n```\n    @ p p py |\n00000000: 9F 01 08 17 00 00 00 17 00 00 00 13 07 00 01 00 ................\n00000010: 00 00 58 00 13 07 00 01 00 00 00 64 00 13 07 00 ..X........d....\n00000020: 01 00 00 00 22 00 13 07 00 01 00 00 00 3A 00 13 ....\"........:..\n00000030: 07 00 01 00 00 00 3D 00 13 07 00 01 00 00 00 2C ......=........,\n00000040: 00 13 07 00 01 00 00 00 5C 00 13 07 00 01 00 00 ........\\.......\n00000050: 00 43 00 13 07 00 01 00 00 00 41 00 13 07 00 01 .C........A.....\n00000060: 00 00 00 2E 00 13 07 00 01 00 00 00 4C 00 13 07 ............L...\n00000070: 00 01 00 00 00 26 00 13 07 00 01 00 00 00 28 00 .....&........(.\n00000080: 13 07 00 01 00 00 00 55 00 13 07 00 01 00 00 00 .......U........\n00000090: 2D 00 13 07 00 01 00 00 00 29 00 13 07 00 01 00 -........)......\n000000A0: 00 00 54 00 13 07 00 01 00 00 00 52 00 13 07 00 ..T........R....\n000000B0: 01 00 00 00 45 00 13 07 00 01 00 00 00 4E 00 13 ....E........N..\n000000C0: D9 01 00 6A 00 00 00 22 00 68 00 22 00 26 00 22 ...j...\".h.\".&.\"\n000000D0: 00 74 00 74 00 70 00 22 00 26 00 22 00 73 00 3A .t.t.p.\".&.\".s.:\n000000E0: 00 2F 00 2F 00 6D 00 61 00 22 00 26 00 22 00 6E ././.m.a.\".&.\".n\n000000F0: 00 61 00 22 00 26 00 22 00 72 00 65 00 22 00 26 .a.\".&.\".r.e.\".&\n00000100: 00 22 00 73 00 74 00 61 00 22 00 26 00 22 00 75 .\".s.t.a.\".&.\".u\n00000110: 00 72 00 61 00 22 00 26 00 22 00 6E 00 74 00 22 .r.a.\".&.\".n.t.\"\n00000120: 00 26 00 22 00 65 00 2E 00 63 00 22 00 26 00 22 .&.\".e...c.\".&.\"\n00000130: 00 6F 00 6D 00 2F 00 44 00 6E 00 22 00 26 00 22 .o.m./.D.n.\".&.\"\n00000140: 00 69 00 35 00 22 00 26 00 22 00 4C 00 36 00 46 .i.5.\".&.\".L.6.F\n00000150: 00 22 00 26 00 22 00 4D 00 4C 00 22 00 26 00 22 .\".&.\".M.L.\".&.\"\n00000160: 00 65 00 56 00 22 00 26 00 22 00 32 00 2F 00 4E .e.V.\".&.\".2./.N\n00000170: 00 68 00 22 00 26 00 22 00 66 00 6E 00 76 00 22 .h.\".&.\".f.n.v.\"\n00000180: 00 26 00 22 00 68 00 2E 00 70 00 6E 00 22 00 26 .&.\".h...p.n.\".&\n00000190: 00 22 00 67 00 22 00 2C 00 22 00 13 DF 01 00 6D .\".g.\".,.\".....m\n000001A0: 00 00 00 22 00 68 00 22 00 26 00 22 00 74 00 22 ...\".h.\".&.\".t.\"\n000001B0: 00 26 00 22 00 74 00 70 00 22 00 26 00 22 00 73 .&.\".t.p.\".&.\".s\n\n## We have URLs:\nhxxps://manarestaurante[.]com/Dni5L6FMLeV2/Nhfnvh.png\nhxxps://hondadominicana[.]com/vAXoUmZFeV2B/Nhfnvh.png\nhxxps://shlokahujafilms[.]com/Xz6RyJCaHMP/Nhfnvh.png\n\n Probably, the macro will loop across the three URLs and try to fetch the next stage. The payload is a DLL file. Like in Brad's diary, it's a Qakbot[2] sample!\n\n If you would like to have a look at the macro, the easiest way is to open the XLSB file in Excel and save it as an XLSM file. You don't need to activate macros to perform this operation but do this always in a sandbox.\n\n Now, you'll be able to address the file as usual:\n\n```\n\n-----\n\n```\n    @ p p py | p py\npretty\n<?xml version=\"1.0\" ?>\n<workbook xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"\nxmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\">\n  <fileVersion appName=\"xl\" lastEdited=\"4\" lowestEdited=\"6\" rupBuild=\"4505\"/>\n  <workbookPr/>\n  <bookViews>\n    <workbookView windowHeight=\"11160\" windowWidth=\"20730\" xWindow=\"-120\"\nyWindow=\"-120\"/>\n  </bookViews>\n  <sheets>\n    <sheet name=\"Sheet\" r:id=\"rId1\" sheetId=\"1\"/>\n    <sheet name=\"Rgvrb\" r:id=\"rId2\" sheetId=\"2\" state=\"hidden\"/>\n    <sheet name=\"Evsrg\" r:id=\"rId3\" sheetId=\"3\" state=\"hidden\"/>\n    <sheet name=\"Lgle\" r:id=\"rId4\" sheetId=\"4\" state=\"hidden\"/>\n    <sheet name=\"NUEVD\" r:id=\"rId5\" sheetId=\"5\" state=\"hidden\"/>\n    <sheet name=\"Rc\" r:id=\"rId6\" sheetId=\"6\" state=\"hidden\"/>\n    <sheet name=\"Rcc\" r:id=\"rId7\" sheetId=\"7\" state=\"hidden\"/>\n  </sheets>\n  <definedNames>\n    <definedName function=\"1\" hidden=\"1\" name=\"_xlfn.ARABIC\" xlm=\"1\">#NAME?\n</definedName>\n    <definedName name=\"_xlnm.Auto_Open\">NUEVD!$F$1</definedName>\n  </definedNames>\n  <calcPr calcId=\"124519\"/>\n  <fileRecoveryPr repairLoad=\"1\"/>\n</workbook>\n\n## In conclusion, we have now a new file extension to keep an eye on! These XLSB files have interesting features[3]...\n\n [1] https://isc.sans.edu/forums/diary/Qakbot+infection+with+Cobalt+Strike+and+VNC+activity/28448\n [2] https://malpedia.caad.fkie.fraunhofer.de/details/win.qakbot\n [3] https://analystcave.com/excel-working-with-large-excel-files-the-xlsb-format/\n\n Xavier Mertens (@xme) Xameco Senior ISC Handler - Freelance Cyber Security Consultant PGP Key\n\n I will be teaching next: Reverse-Engineering Malware: Malware Analysis Tools and Techniques - SANS London June 2022\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-25 - XLSB Files- Because Binary is Stealthier Than XML.pdf"
    ],
    "report_names": [
        "2022-03-25 - XLSB Files- Because Binary is Stealthier Than XML.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536009,
    "ts_updated_at": 1743041173,
    "ts_creation_date": 1653753497,
    "ts_modification_date": 1653753497,
    "files": {
        "pdf": "https://archive.orkl.eu/b14795df07f41775e76aa5063f0f1c6507a7f6aa.pdf",
        "text": "https://archive.orkl.eu/b14795df07f41775e76aa5063f0f1c6507a7f6aa.txt",
        "img": "https://archive.orkl.eu/b14795df07f41775e76aa5063f0f1c6507a7f6aa.jpg"
    }
}