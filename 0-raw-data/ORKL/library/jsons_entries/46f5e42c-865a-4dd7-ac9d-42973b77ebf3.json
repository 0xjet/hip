{
    "id": "46f5e42c-865a-4dd7-ac9d-42973b77ebf3",
    "created_at": "2023-05-06T02:08:37.945718Z",
    "updated_at": "2025-03-27T02:10:04.922814Z",
    "deleted_at": null,
    "sha1_hash": "2ec0d1a1b208abf990aeaf3aa0b6331145976e4b",
    "title": "2023-03-31 - Moqhao masters new tricks",
    "authors": "",
    "file_creation_date": "2023-05-05T01:45:15Z",
    "file_modification_date": "2023-05-05T01:45:15Z",
    "file_size": 560439,
    "plain_text": "# Moqhao masters new tricks\n\n**telekom.com/en/blog/group/article/moqhao-masters-new-tricks-1031484**\n\nBlog.Telekom\n\n03‑31‑2023\n[TR4xx@DTSecurity](https://www.telekom.com/en/blog/1030926-1030926)\n\n0 Comments\n\nShare Share\nTwo clicks for more data privacy: click here to activate the button and send your recommendation. Data will be transfered as soon as the\nactivation occurs.\n\nPrint\nRead out\n\nEver received a text message alerting you to problems with the delivery of a package - even though you weren't waiting for one? Then you've\n[already met Moqhao in person, also known as Shaoye or XLoader. Moqhao is something like the bestseller from the Roaming Mantis malware](https://www.telekom.com/en/glossary#glossar381640)\n[family, ready to build a backdoor into your smartphone's Android operating system.](https://www.telekom.com/en/glossary#glossar381474)\n\nThis group of Android malware is a proprietary brand of the Yanbian Gang. A Chinese threat actor also known for its DNS hijacking\ncampaigns, where they \"redirect\" visitors from websites. Deutsche Telekom Security has been tracking the Yanbian Gang and consequently\nMoqhao infections since 2021. As result from our tracking, we discovered a new major feature introduced to Moqhao in order bypass\nCAPTCHA security access mechanisms in wireless routers. Right, the one with the combination of letters and numbers used as images.\n\nThis technique has not been attributed to the Yanbian Gang before. Instead, the security community has only speculated on how vulnerable\nrouters were previously compromised by the actor. Now, we have found new evidence on how they are able to hijack wireless routers via\nMoqhao. In this blog post, we describe how these attacks are executed by Moqhao and what measures can be taken to prevent them.\n\n## Moqhao a key malware player of the Yanbian Gang\n\nThe Yanbian Gang is a threat actor that has been active since 2013 with operation from the Yanbian Prefecture in Jilin, China. Over the years,\nthe Yanbian Gang expanded their criminal operation to target countries all over the world with a collection of Android malware known as the\nRoaming Mantis. This collection includes fake apps that impersonate banking services, engage in cryptomining, multilingual phishing, and\nother fraudulent activities.\n\nAs part of the Roaming Mantis, [Moqhao was first discovered in 2015. Deutsche Telekom Security started monitoring this malware in February](https://documents.trendmicro.com/assets/pdf/wp-evolution-of-xloader-and-fakespy-two-interconnected-android-malware-families.pdf)\n2021 after multiple customers reported fake SMS messages. These messages indicated that a parcel has been sent and urged users for\nverification. An example of Moqhao’s SMS Smishing (SMiShing) messages is shown in figure 1.\n\n\n-----\n\ngu e e a p e o oq ao s a e S S essages d cat g t at a pa ce as bee se t a d u g g use s o e cat o\n\nMessages sent as part of Moqhao’s campaign appear harmless and authentic at first, but they contain links from where the Moqhao malware\n[is downloaded onto the victim’s device. The downloaded file containing Moqhao, poses as an update of a legitimate App such as Facebook or](https://www.telekom.com/en/glossary#glossar381492)\nChrome. Once installed, it can be used to steal sensitive information, install additional apps, hijack the infected device to send SMiShing\n[messages and recently for DNS hijacking in wireless routers. Once Moqhao obtains full control over the infected device, the device is used to](https://securelist.com/roaming-mantis-dns-changer-in-malicious-mobile-app/108464/)\nengage in SMiShing campaigns to infect further victims.\n\n## Moqhao infects wireless routers to perform DNS hijacking attacks\n\nSince the beginning of our tracking, efforts have been focused on monitoring Moqhao’s activity in order to prevent infections and/or notify our\n[customers in the event of an infection. During July 2022, we published an alert about new SMiShing waves spreading an updated version of](https://twitter.com/DTCERT/status/1552571300937334785?s=20)\nMoqhao in Germany. The campaign exhibited geofencing and operating system checks which proves that the Yanbian Gang tailors their\nattacks to their victims (e.g., for German speaking users) and avoid detection while trying to keep a low profile.\n\nAs part of our monitoring, we periodically conduct analysis of Moqhao samples obtained during these SmiShing campaigns. As result of such\nanalyses, we discovered a previously unknown feature in Moqhao to bypass text-based CAPTCHAs. This feature is used in combination with\nbrute-force attacks on wireless router’s web interfaces to compromise routers and perform DNS hijacking attacks.\n\nDNS hijacking is a technique used to redirect network traffic to for instance malicious websites by altering the DNS resolution. In other words,\nMoqhao’s intention is to seize the translation process of human-readable domain names (such as www.telekom.com) into [IP addresses. This](https://www.telekom.com/en/glossary#glossar381622)\nallows Moqhao to redirect the victims web traffic to malicious websites that mimic legitimate sites to steal sensitive information or deliver copies\nof Moqhao.\n\nWireless routers are critical in DNS hijacking because they contain information needed to perform this resolution process. This means that\neven if victims type in a legitimate website, their traffic is redirected to a fake one owned by an attacker.\n\n## What are CAPTCHAs and why are they important to Moqhao?\n\nIn terms of home network security, one of the most important devices we should try to protect is our router. They allow devices within a local\nnetwork to reach resources on the Internet by relaying traffic between local network devices and remote servers. If routers are infected, threat\nactors may be able to capture or manipulate network traffic that the router relays. Threat actors like the Yanbian Gang have identified the\ncriticality of routers and began targeting them for malicious purposes.\n\nRouter’s settings and network configurations can often be accessed using a web-based login page that devices from the local network can\naccess. By gaining access to the router’s web page, all kinds of sensitive information such as login credentials, network configurations, and\nother personal data can be accessed and/or manipulated.\n\nTo prevent unauthorized access through brute-force attacks on the router’s login panel, many manufacturers use CAPTCHAs to prevent\nautomated authentication attempts. CAPTCHAs are verification challenges used to confirm that a user is a human opposed to a computer\nprogram. They consist of one or more morphed pictures that contain random objects, numbers and/or characters. To pass the verification step,\nthe system asks the user to enter the content of the image into an input box or to perform an action based on such content. By requiring a\nhuman to complete the challenge, the system can verify that the user is legitimate and prevent automated attacks. Therefore, users need to\nconfirm that they are human when logging in.\n\nThis procedure relies on the fact that automated attacks should not be able to complete the task of solving the challenges on the image.\nUnfortunately, not all CAPTCHAs are secure against machine learning mechanisms. Poorly designed CAPTCHAs that rely on fixed patterns of\nletters are vulnerable to Optical Character Recognition (OCR) engines. This is especially true for the CAPTCHA mechanism targeted by\nMoqhao’s latest version.\n\nIn short, Optical Character Recognition is a mechanism designed to recognize and extract text from images. OCR engines work by analyzing a\nCAPTCHA image using pattern recognition algorithms to identify the characters on the image. Analogously, Moqhao can therefore profit from\nOCR to trick a system and bypass CAPTCHA challenges that rely on text-based verification.\n\nFigure 2: Example of a CAPTCHA challenge from ipTIME routers.\n\n## Moqhao’s new ability to PWNtcha your wireless router\n\nOver the years, the Yanbian Gang has invested a lot of resources to maintain and improve Moqhao’s features. A recent example of the\nYanbian Gang’s dedication to Moqhao’s development is the adoption of OCR techniques. This represents a key addition in order to take over\nrouters to perform DNS Hijacking.\n\nWhen trying to “PWNtcha” (defeat via CAPTCHA challenge) a vulnerable router, Moqhao first determines the IP address of the router to\nrequest its web-based administration pages. By accessing this default pages, Moqhao can determine the router’s model. Next, Moqhao\ncompares the router model against a hardcoded list of vulnerable routers to decide whether it proceeds with the attack.\n\n\n-----\n\ne oq ao de t es a u e ab e ode, t c a s t e oute s eb ad pages sea c g o spec c patte s ese patte s a e based\non hardcoded strings embedded in Moqhao’s configuration to extract login forms and images from the CAPTCHA challenges. If such\npredefined patterns are matched, Moqhao uses a list of default usernames and passwords such as “admin:admin”. Although, the amount of\nhardcoded credentials in Moqhao is limited, default login combinations can be easily extended by the actor. For example, dictionary-based\npasswords or stolen credentials could be added to Moqhao’s configuration to target further router models or tailor attacks to other devices in\nthe future.\n\nAs described before, the malware needs to circumvent the router’s CAPTCHA challenges to gain access to the router’s settings. To achieve\nthis, Moqhao forwards CAPTCHA images to an API-based OCR translation service that converts CAPTCHA images to text. If the OCR service\nsuccessfully returns the correct text, the malware can brute force the login credentials to successfully take over the router.\n\n## Moqhao’s OCR Translation Service\n\nAs part of its configuration, Moqhao depends on a list of profile account IDs hosted on different [social media platforms. These profiles are](https://www.telekom.com/en/glossary#glossar381638)\ncreated using false information such as name, location, age and gender to deceive others into believing that the profile belongs to a real\nperson. The main purpose of these fake profiles is to publish information regarding the malware’s infrastructure while avoiding detection. This\ninformation includes for example, the location of the C&C server, a rogue DNS service used for DNS Hijacking and its new OCR translation\nservice. During Moqhao’s execution, these profile accounts are accessed to dynamically retrieve network configuration updates made\nperiodically by the threat actor.\n\nDeutsche Telekom Security conducted analysis of the malware in order to extract the malicious profile IDs directly from malware. By extracting\nthese IDs, it is possible to track where Moqhao’s endpoints are published and obtain the malware configuration as soon as it gets updated.\n\n[Our collected data regarding profile accounts overlaps with Kaspersky’s latest report on Moqhao's latest campaign. However, in addition to the](https://securelist.com/roaming-mantis-dns-changer-in-malicious-mobile-app/108464/#iocs)\n[DNS changer accounts reported by Kaspersky, we were able to obtain the OCR accounts and verify the use of this translation service. For](https://securelist.com/roaming-mantis-dns-changer-in-malicious-mobile-app/108464/#dns-changer-via-malicious-mobile-app)\nexample, samples that we analyzed connected to a social media profile hosted on vk.com which ID is id729071494. vk.com is a Russian\nsocial network analogous to Facebook. From this profile, Moqhao was able to retrieve the URL of a file called gif.txt hosted\nat 107.148.162[.]237:28810/gif.txt.\n\nFigure 3: OCR service information posted on hxxps://m[.]vk[.]com/id729071494?act=info.\n\nWhen Moqhao requests the content of the gif.txt file shown in figure 2, i.e., 107.148.162.237:28810/gif.txt, it obtains another IP, port and path\nwhich belongs to the OCR service, i.e., 27.124.38[.]58:10052/ocr.html. Although, it is unknown what type of OCR backend system the threat\n[actor uses or whether they rely on a proprietary solution, there are numerous services that can solve CAPTCHAs automatically.](https://cloud.google.com/vision/docs/ocr)\n\nMoqhao’s OCR service is currently exposed to anyone on the Internet and is not protected by any form of authentication. As of February 2023,\nthis service could be further employed by other criminals as a free CAPTCHA-bypass mechanism. At the time of our analysis, access to one of\nthe vulnerable router models was not available. To overcome this limitation, we tested Moqhao’s OCR service by emulating Moqhao’s network\ncommunication.\n\nTo verify if Moqhao’s OCR service is able to defeat the CAPTCHA challenges, we used the public CAPTCHA generator from one of the\n[vulnerable router brands, i.e., ipTIME, which available here. These challenges are examples of the CAPTCHAs presented to the users during](http://pds.iptime.org/sess-bin/captcha.cgi)\nlogin and targeted by Moqhao.\n\nWe sent multiple requests to Moqhao's OCR service with these CAPTCHAs, i.e, the gif image files. For all of our test images using ipTIME’s\ngenerator, we were able to successfully retrieve the correct codes as text. However, when using CAPTCHAS of other router brands and\nmodels, its success rate dropped. Therefore, we conclude that the threat actor’s OCR translation service was designed to target Moqhao’s list\nof router models specifically.\n\n\"ipTIME N3-i\\nipTIME N604plus-i\\nEFM Networks ipTIME N604plus-i\"\n\n\"EFM Networks - ipTIME Q104\\nEFM Networks ipTIME Q104\"\n\n\"EFM Networks - ipTIME Q204\\nEFM Networks ipTIME Q204\\nEFM Networks ipTIME V108\"\n\n\"EFM Networks ipTIME Q604\\nEFM Networks ipTIME Q604 PINKMOD\\nEFM Networks ipTIME N104R\\nEFM Networks ipTIME N604R\\nEFM\nNetworks ipTIME Q504\\nEFM Networks ipTIME N5\\nEFM Networks ipTIME N604V\"\n\n\"EFM Networks ipTIME N104T”\n\n\"EFM Networks - ipTIME G301\"\n\n\"title.n704bcm\\ntitle.a8004t\\ntitle.a2004sr\\ntitle.n804r\"\n\n\"title.n104e\\ntitle.n104pk\\ntitle.a1004ns\\ntitle.a604m\\ntitle.n104pi\\ntitle.a2008\\ntitle.ax2004b\\ntitle.n104q\\ntitle.n604e\\ntitle.n704e\\ntitle.n704v3\\ntit\n\"title.v504\\ntitle.n1p\\ntitle.n704bcm\\ntitle.ew302\\ntitle.n104qi\\ntitle.n104r\\ntitle.n2p\\ntitle.n608\\ntitle.q604\\ntitle.n104rsk\\ntitle.n2e\\ntitle.n604s\\ntitle.\n\"title.a604v\\ntitle.n6004r\\ntitle.n604p\\ntitle.t3004\\ntitle.n5\\ntitle.n904\\ntitle.a5004ns\\ntitle.n8004r\\ntitle.n604vlg\"\n\n**Strings of wireless router models hardcoded in Moqhao’s configuration.**\n\nOnce Moqhao has gained access to the router’s web admin, it continues to hijack the router’s DNS settings as described here. Moqhao’s final\ngoal is to deliver copies of the malware on devices connecting to the compromised network via DNS hijacking.\n\n## Victims\n\n\n-----\n\nBased on our telemetry, infections with Moqhao continue to happen via SMiShing campaigns in Germany. However, we have no indicators of\nvictims of Moqhao’s PWNtcha attacks at the time of writing.\n\nBy extracting the list of router models from the malware, we conclude that the current campaign targets users of wireless routers located in\nAsia, [mainly in South Korea as reported by Kaspersky.](https://www.kaspersky.com/about/press-releases/2023_roaming-mantis-uses-dns-changers-to-target-users-via-compromised-public-routers)\n\nDeutsche Telekom Security is constantly monitoring Roaming Mantis related infrastructure and implementing protection mechanisms. As part\nof Moqhao’s infrastructure, we have identified well-known Roaming Mantis IPs and monitor the registration of domain names on these IPs that\nare potentially used as landing pages. These landing pages serve as the destination to where the victims are lured during the Yanbian Gang’s\nphishing scams. In other cases, these are used as well to host Moqhao payloads.\n\nOur focus remain primarily on preventing customers from contacting the aforementioned Moqhao’s malicious end-points. Our efforts also\ninclude detecting new Moqhao infections in order to notify customers and provide assistance during the cleanup process.\n\n## Conclusion\n\nAs more and more people rely on wireless routers to connect to the Internet, the risk of similar attacks to the one implemented by Moqhao is\nlikely to increase. CAPTCHA attacks on routers can be challenging to detect and can compromise the security of an entire network. Once a\nrouter is compromised, attackers can use it as a launching pad for further attacks.\n\nNeglected routers with poor CAPTCHA implementations and the use of weak passwords can additionally contribute and make such attacks\neffortless in order to gain unauthorized access or even take control of an entire network. In this regard, Moqhao and its OCR translation\nservice are a successful duet for a chain of exploits that it starts with gaining unauthorized access to the router’s web-admin and ends with\nhijacking the DNS settings of the compromised routers. During this scenario the potential for havoc from Moqhao is not only limited to\nspreading itself. Instead, it is rather limited only by the threat actor’s interest.\n\nDespite the Yanbian Gang actively using this attack only in South Korea as of March 2023, Deutsche Telekom Security believes in the\npossibility of this group extending the scope of these attacks to target victims in other countries. Although, router models targeted by Moqhao\nare currently not used in Germany, Moqhao’s PWNtcha serves as a successful proof of concept to mimic and further extend. For instance,\nattackers can easily modify the list of default passwords and router models to include more popular brands such as FRITZ!Box, TP-Link, DLink, etc. As a result, it is important for users to take steps to protect from these attacks.\n\n## Recommendations\n\nIn order to protect from Moqhao's router PWNtcha attacks, it is recommending the following practices:\n\nChange the default user+password combination for the web admin interface of your router and use a strong password when applying this\nchange.\nThere are several CAPTCHA systems available, each with varying levels of security. Choose a router model with strong CAPTCHA\nsystem.\nIf your router model allows it, implement two-factor authentication to provide an extra layer of security. This can help prevent\nunauthorized access even if the CAPTCHA is bypassed.\nMake sure your router’s firmware is up to date and that security patches have been applied. This can help prevent vulnerabilities from\nbeing exploited.\nNever install firmware from third-party/unknown sources.\n\nOverall, a combination of these measures can help protect against CAPTCHA attacks and maintain the security of your wireless router.\n\n## IoCs\n\n**Hashes**\n\n83ba2b1c0352ea9988edeb608abf2c037b1f30482bbc05c3ae79265bab7a44c9\n\n6e28c76b07d64fd1d0479d328207082b8d29f4560433d7f075328aa236a4f1ab\n\n6b9fa3df72fc684f307cd6bac06788c2cd83ceb44ab9e5e04671b8ed1c107aad\n\n89e593dc246cb0b4ef8decf59c3260697677e703d609a24807cb6ea58c0deda4\n\n6257da70cb01826a6ce575e23cd2e42a0dbdc742f9b529f06fa9a13224701823\n\n780992147fd4b8fd5c780f4fe1a5237a1729c61ec99dda010fe9313bb5ef5bac\n\n**C&C server accounts**\n\nhttps://imgur.com/user/shaoye99/about\n\nhttps://imgur.com/user/shaoye88/about\n\nhttps://imgur.com/user/shaoye77/about\n\nhttps://m.vk.com/id674309800?act=info\nhttps://m.vk.com/id674310752?act=info\n\nhttps://m.vk.com/id674311261?act=info\n\n\n-----\n\nttps // co / d 30 8 59 act o\nhttps://m.vk.com/id730149630?act=info\n\nhttps://m.vk.com/id761343811?act=info\n\nhttps://m.vk.com/id761345428?act=info\n\nhttps://m.vk.com/id761346006?act=info\n\n**OCR Translation Service**\n\nhxxps://m[.]vk[.]com/id729071494?act=info\n\n107.148.162[.]237:28810/gif.txt\n\nConfiguration included in gif.txt:\n\n27.124.38[.]58:10052/ocr.html\n\n**Rogue DNS**\n\nhxxps://m[.]vk[.]com/id728588947?act=info\n\n107.148.162[.]237:26333/sever.ini\n\nConfiguration included in sever.ini:\n\n[Severkt]----sever=193.239.154.16----sever1=193.239.154.17---\n[Seversk]----sever=193.239.154.16----sever1=193.239.154.17---\n[Severother]----sever=193.239.154.16----sever1=193.239.154.\n\n© Bildnachweis: Deutsche Telekom/ GettyImages/AmnajKhetsamtip; Montage: Evelyn Ebert Meneses\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-03-31 - Moqhao masters new tricks.pdf"
    ],
    "report_names": [
        "2023-03-31 - Moqhao masters new tricks.pdf"
    ],
    "threat_actors": [
        {
            "id": "f9bc28d0-ce98-4991-84ae-5036e5f9d4e3",
            "created_at": "2022-10-25T16:07:24.546437Z",
            "updated_at": "2025-03-27T02:02:10.277573Z",
            "deleted_at": null,
            "main_name": "Roaming Mantis",
            "aliases": [
                "Roaming Mantis Group",
                "Shaoye"
            ],
            "source_name": "ETDA:Roaming Mantis",
            "tools": [
                "MoqHao",
                "Roaming Mantis",
                "SmsSpy",
                "Wroba",
                "XLoader"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8f350ed9-134e-4160-b63d-701f562ba64a",
            "created_at": "2022-10-25T16:07:24.589322Z",
            "updated_at": "2025-03-27T02:02:10.292236Z",
            "deleted_at": null,
            "main_name": "Yanbian Gang",
            "aliases": [],
            "source_name": "ETDA:Yanbian Gang",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4c5a35bf-f483-463e-aea0-89a795698cff",
            "created_at": "2023-01-06T13:46:39.198624Z",
            "updated_at": "2025-03-27T02:00:03.019375Z",
            "deleted_at": null,
            "main_name": "Yanbian Gang",
            "aliases": [],
            "source_name": "MISPGALAXY:Yanbian Gang",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c94cb0e9-6fa9-47e9-a286-c9c9c9b23f4a",
            "created_at": "2023-01-06T13:46:38.823793Z",
            "updated_at": "2025-03-27T02:00:02.928254Z",
            "deleted_at": null,
            "main_name": "Roaming Mantis",
            "aliases": [
                "Roaming Mantis Group"
            ],
            "source_name": "MISPGALAXY:Roaming Mantis",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1683338917,
    "ts_updated_at": 1743041404,
    "ts_creation_date": 1683251115,
    "ts_modification_date": 1683251115,
    "files": {
        "pdf": "https://archive.orkl.eu/2ec0d1a1b208abf990aeaf3aa0b6331145976e4b.pdf",
        "text": "https://archive.orkl.eu/2ec0d1a1b208abf990aeaf3aa0b6331145976e4b.txt",
        "img": "https://archive.orkl.eu/2ec0d1a1b208abf990aeaf3aa0b6331145976e4b.jpg"
    }
}