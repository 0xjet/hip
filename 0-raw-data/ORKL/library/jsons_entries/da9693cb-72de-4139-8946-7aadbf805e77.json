{
    "id": "da9693cb-72de-4139-8946-7aadbf805e77",
    "created_at": "2022-10-25T16:48:24.867096Z",
    "updated_at": "2025-03-27T02:05:21.671838Z",
    "deleted_at": null,
    "sha1_hash": "e3fc342ccb48ec97aeec128210e04da127d5a94f",
    "title": "Russian Army Exhibition Decoy Leads to New BISKVIT Malware",
    "authors": "Fortinet",
    "file_creation_date": "2019-09-18T03:50:03Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 1596757,
    "plain_text": "# Russian Army Exhibition Decoy Leads to New BISKVIT Malware\n\n**[fortinet.com/blog/threat-research/russian-army-exhibition-decoy-leads-to-new-biskvit-malware.html](https://www.fortinet.com/blog/threat-research/russian-army-exhibition-decoy-leads-to-new-biskvit-malware.html)**\n\nAugust 20,\n\n2018\n\nThreat Research\n\n[By Jasper Manuel and Rommel Joven | August 20, 2018](https://www.fortinet.com/blog/search.html?author=Jasper+Manuel+and+Rommel+Joven)\nA few days ago, the FortiGuard Labs team found a malicious PPSX file exploiting CVE-20170199 that had been crafted for Russian speakers. The filename “Выставка” when translated\nmeans “Exhibition”. On further examination, the PPSX file seems to have been targeted at an\nexhibition being held annually in Russia called Army 2018 International Military and Technical\n_Forum. This is one of the largest exhibitions of military weapons and special equipment, not_\nonly in Russia, but also one of the outstanding events among similar exhibitions in the\nworld. The discovery of this malicious document is very timely since the event is scheduled\nto be held August 21-26, 2018.\n\nFigure 01. Decoy file\nAnother interesting element of this malware is the included paragraph, shown below.\n\n\n-----\n\nFigure 02. Invitation in Russian\nThis roughly translates to:\n\n**_Closed dynamic show of modern and prospective samples of military armament and_**\n**_special equipment for the “reconnaissance and raid action of combined-arms units”_**\n\n[While the event is open to anyone, organizers from last year have set up specialized](http://www.rusarmyexpo.com/)\n[expositions that include “demonstrations behind closed doors.” This caters to selected](https://www.ainonline.com/aviation-news/defense/2017-08-25/russias-army-show-may-eclipse-better-known-maks-event)\nguests, where pieces of classified equipment are being displayed, including large aerial\nvehicles and missiles. That being said, we believe that this malicious document is being\ntargeted to those selected guests who want to be, or are already included in these closed\n[door invitations. This year’s event has already 66 official foreign delegations confirming their](http://tass.com/defense/1014966)\nparticipation. We will take a look on how a PPSX file could compromise an unpatched\nsystem.\n\n**Analysis**\n\n[We begin with the malicious PPSX file that exploits CVE-2017-0199 and opens a bait file. CVE-](https://www.fortinet.com/blog/threat-research/an-inside-look-at-cve-2017-0199-hta-and-scriptlet-file-handler-vulnerability.html)\n2017-0199 is an HTA (HTML application) vulnerability that allows a malicious actor to\ndownload and execute a script containing PowerShell commands when a user opens a\ndocument containing an embedded exploit This is not the first time we have encountered an\n[APT abusing this vulnerability. In fact, previous attacks have targeted people from UN](https://www.fortinet.com/blog/threat-research/powerpoint-file-armed-with-cve-2017-0199-and-uac-bypass.html)\nagencies, Foreign Ministries, and people and organizations who interact with international\ngovernments.\n\n\n-----\n\nFigure 03. Overview of attack\nOnce the PPSX file is opened, it triggers a script in ppt/slides/_rels/slides1.xml.rels. The exploit\nthen downloads additional code from the remote server, as shown in figure 04, and\nexecutes it using the PowerPoint Show animations feature.\n\nFigure 04. PPSX file exploiting CVE-2017-0199\nShown below is the code from the remote server after the PowerShell exploit embedded in\nthe XML file is successfully executed and downloads an executable payload into %Temp%.\n\n\n-----\n\nFigure 05. defender XML\nWhen executed, Defender.exe drops the following files:\n\nFigure 06. TMPEC4E directory\n\n-   SynTPEnh – a directory with the BISKVIT malware package\n\n-   Csrtd.db – an encrypted configuration file used by DevicePairing.exe for autorun\ninstallation\n\nFigure 07. Decrypted configuration\n\n-   DevicePairing.exe – also identified in the code as \"AutorunRegistrator\", its function is to\ncopy the SynTPEnh directory to %appdata% and add it to the autorun registry entry\n\n\n-----\n\n-   DevicePairing.exe.config – a runtime configuration file\n\n-   Kernel32.dll – a common library of BISKVIT malware\n\n-   Newtonsoft.Json.dll – a popular JSON serializer for .NET\n\n**BISKVIT**\n\nThe BISKVIT Trojan is a multi-component malware written in C#. We dubbed this malware\nBISKVIT based on the namespaces used in the code, which contain the word “biscuit”.\nUnfortunately, there is already an existing unrelated malware called BISCUIT, so BISKVIT is\nused instead, which is the Russian translation of biscuit.\n\nFigure 08. Biscuit modules\nDue to the modular nature of BISKVIT, it’s difficult to exactly determine all of its\nfunctionalities since components are only downloaded and loaded on the fly at the direction\nof the attacker. As of this writing, we have only been able to download one component. So\nfar, based on the code of the components that we were able to acquire, this malware is\ncapable of, but not limited to the following:\n\n-   Downloading files and components\n\n-   Hidden/stealthy execution of downloaded and local files\n\n-   Downloading of dynamic configuration files\n\n-   Updating itself\n\n- Deleting itself\n\n\n-----\n\nThe BISKVIT malware is copied to the %appdata%\\ SynTPEnh from the %temp% folder, as\nmentioned above. These are the contents of the %appdata%\\SynTPEnh folder:\n\n-   SynTPEnh.exe – the main BISKVIT malware file\n\n-   Csrtd.db – an encrypted configuration file\n\n-   SynTPEnh.exe.config – a runtime configuration file\n\n-   Kernel32.dll – a common library of BISKVIT malware\n\n-   Newtonsoft.Json.dll – a popular JSON serializer for .NET\n\nThe main BISKVIT file disguises itself as the legitimate Synaptics Pointing Device Driver file to\navoid suspicion by the user.\n\nFigure 09. Information disguised as Synaptics\nWhen executed, it initializes its base configuration, which contains the following\ninformation:\n\n\n-----\n\nFigure 10. Base configuration\nIt then loads and decrypts its configuration file, named csrtd.db. This configuration file is\nencrypted with AES using the following keys:\n\nFigure 11. Default AES and IV key\nOnce decrypted, this configuration file contains the command and control server, the time\ninterval used by the malware to check for jobs from the command and control server, an\nAPI key, and RSA key information. We didn’t find code references to the RSA encryption\nmethod, so we think that’s being used by other components that we haven’t acquired as of\nthis writing.\n\n\n-----\n\nFigure 12. Decrypted configuration\n**Command and Control Communications**\n\nThis malware communicates with the command and control server through REST APIs using\nthe JSON format. The malware first gets an access token by sending an API key. If not\nspecified in the configuration, the API key is generated from the CPU, disk drive, and MAC\naddress information of the infected machine. This API key is a unique ID, which is also used\nto identify the machine.\n\nFigure 13. Unique Id composition\nThe API key is sent to the command and control server via an HTTP POST request to the API\n_/api/auth/token._\n\nFigure 14. POST ApiKey\nThe server replies with access token information that will be used for the entire session.\n\n\n-----\n\nFigure 15. Access token\nThis malware then receives and executes commands from the attacker through a jobs API. It\nsends an HTTP GET request to the API /api/job to get a job after a certain time has lapsed, as\nindicated by the interval set in the configuration.\n\nFigure 16. GET api/job\nThe response would be a job with four main keys: id, resultUri, tasks, and executionOptions.\n\nFigure 17. Job\n\n-   id - is the job ID\n\n- _resultUri - is where the malware will HTTP POST the result of the job_\n\n\n-----\n\n-   executionOptions - tells the malware if it will execute the package at certain time interval,\nand if it will be started at startup.\n\n-   tasks – this key contains information about packages (components/other files) that the\nattacker wants downloaded to and executed on the infected machine.\n\nThe executeMode in the key tasks tells the malware how to execute the package.\n\nFigure 18. Execute modes\nIf the mode is 0, the package is treated as a component/library and is executed with the\nparameter indicated in the parameters key.\n\nIf the mode is 1, the package is treated as a file and is executed by using either the\nShellExecuteEx() or CreateProcess() Windows API, with WindowStyle set to Hidden and\nCreateNoWindow set to true.\n\nFigure 19. ExecuteHide\nIf the mode is 2 the package is treated as file and is executed using the\n\n\n-----\n\nCreateProcessAsUser() Windows API.\n\nFigure 20. StartAsUser\nAnother interesting feature of this malware is that it saves jobs locally in a folder named\n_534faf1cb8c04dc881a3fbd69d4bc762._\n\nFigure 21. Jobs Directory\nJobs are encrypted using the same AES encryption as that of the configuration file, and are\nnamed with its job id with a .db extension. This means that it can continue executing the\njobs on the next execution of the malware even when its current process is interrupted or\nterminated. After completing the job, this malware deletes the locally saved job.\n\nDuring our analysis, the malware received a job to download a package with executeMode\nset to 0. This means the package is a component/library that can be downloaded from\n_/api/package/5b61b91da99a25000198dfcc._\n\nFigure 22. Job with packageId and executeMode\n\n\n-----\n\nThe package from the downloadUri specified in the job resulted to a zip file with a PK\nheader.\n\nFigure 23. Get Package\nPackages are stored in the folder 083c57797944468895820bf711e3624f.\n\nFigure 24. Packages Directory\nAfter checking what component had been downloaded, we discovered that it was a\ncomponent called FileExecutor, which just executes the files indicated in the parameters key.\n\nFigure 25. Job and Task’s parameters\nThis FileExecutor component has the same functionality as the executeMode set to 1, which\njust executes a file using either the ShellExecuteEx() or CreateProcess() with WindowStyle set\nto Hidden and CreateNoWindow set to true In the above job it tells the malware to use the\n\n\n-----\n\n_FileExecutor component to execute systeminfo with timeout set at 30 seconds, as indicated_\nby the Waittime key.\n\nThe command systeminfo displays detailed configuration information about a computer and\nits operating system, including its operating system configuration, security information,\nproduct ID, and hardware properties (such as RAM, disk space, and network cards).\n\nFigure 26. Systeminfo data POST to CC\nFor the C&C to know the status of the jobs running, it also includes the key _State that has_\nthe values shown below. The data that was sent during our analysis included the State being\nequal to 2, meaning it is complete.\n\n\n-----\n\nFigure 27. Job States\nAfter the systeminfo job, it seemed that the attacker noticed that the machine he/she sent\nthe job to was an analysis machine, so the C&C stopped sending any jobs. This could only\nmean that the attacker behind this attack is being very careful to not infect computers that\nare not targets and to avoid alerts.\n\nWhile it is not new for C&C servers used in targeted attacks to suddenly stop responding\nafter collecting the basic information of the victim’s computer, the C&C used here is not\ncompletely blocking its communication. Instead, it just stopped sending jobs. This enables\nresearchers and analysts to still monitor the C&C.\n\n**Low AV Detection**\n\nInterestingly, even if the malware files are not packed or obfuscated, only a few AV vendors,\nincluding Fortinet, were able to detect the files.\n\n**Conclusion**\n\nThe use of current and upcoming events as bait to target high profile targets is becoming\nmore and more popular among attackers.\n\nBased on our findings, we believe that this is a well-planned attack, especially considering\nthe timely distribution of the malicious decoy file and the use of a never-before-seen\nmalware. These two ingredients provide the best chance for comprising their targets.\n\n**Solution**\nFortinet detects all Biskvit malware components as W32/BiskvitLoader.A!tr,\nMSIL/BiskvitAutoRun.A!tr, MSIL/BiskvitLib.A!tr, MSIL/Biskvit.A!tr,\nMSOffice/Exploit.CVE20178570!tr.\n\n\n-----\n\nMalicious URLs related to this malware are also blocked through the FortiGuard Web\nFiltering Service.\n\n[We recommend that all users apply the patch released by Microsoft for CVE-2017-0199.](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-0199?ranMID=24542&ranEAID=je6NUbpObpQ&ranSiteID=je6NUbpObpQ-fM38F._e5Au85Ux1yEL84g&epi=je6NUbpObpQ-fM38F._e5Au85Ux1yEL84g&irgwc=1&OCID=AID681541_aff_7593_1243925&tduid=(ir_yDRz7:SXzRcdQETzRRXKnWbwUkg02FRhfQo-SM0)(7593)(1243925)(je6NUbpObpQ-fM38F._e5Au85Ux1yEL84g)()&irclickid=yDRz7:SXzRcdQETzRRXKnWbwUkg02FRhfQo-SM0)\n\n_Special thanks to Evgeny Ananin for translating the content of the exploit document from Russian_\n_to English._\n\n**IOC**\n\nbe7459722bd25c5b4d57af0769cc708ebf3910648debc52be3929406609997cf\n\na87daccbb260c5c68aaac3fcd6528f9ba16d4f284f94bc1b6307bbb3c6a2e379\n\nb4a1f0603f49db9eea6bc98de24b6fc0034f3b374a00a815b5c906041028ddf3\n\n934542905f018ecb495027906af13cc96e3f55e11751799f39ef4a3dceff562b\n23a286d14de1f51c5073caf0fd40a7636c287f578f32ae5e05ed331741fde572\n\n**CC**\n\nhxxp://bigboss.x24hr.com\n\nhxxp://secured-links.org/\n\n_[Download our latest Global Threat Landscape Report.](https://secure.fortinet.com/LP=5223?utm_source=social&utm_medium=blog&utm_campaign=GEN-WP-Q2-2018-Threat-Landscape-Report&elq_src=Social&elq_cid=70134000001T67JAAS&elq_staid=10&elq_eid=11694&elq_sid=13232)_\n\n[russia, APT Campaign](https://www.fortinet.com/blog/tags-search.html?tag=russia)\n\nCopyright © 2019 Fortinet, Inc. All Rights Reserved\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/9y7hpv3evobjjpw8c3mnq1sgrqrxpt4d"
    ],
    "report_names": [
        "Fortinet_Russian-Decoy-Leads-BISKVIT(08-20-2018)"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041121,
    "ts_creation_date": 1568778603,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/e3fc342ccb48ec97aeec128210e04da127d5a94f.pdf",
        "text": "https://archive.orkl.eu/e3fc342ccb48ec97aeec128210e04da127d5a94f.txt",
        "img": "https://archive.orkl.eu/e3fc342ccb48ec97aeec128210e04da127d5a94f.jpg"
    }
}