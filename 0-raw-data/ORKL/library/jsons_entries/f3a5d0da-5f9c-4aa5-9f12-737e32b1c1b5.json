{
    "id": "f3a5d0da-5f9c-4aa5-9f12-737e32b1c1b5",
    "created_at": "2023-01-12T15:07:54.980542Z",
    "updated_at": "2025-03-27T02:16:25.550519Z",
    "deleted_at": null,
    "sha1_hash": "43ef765400962f01caab9d468e6c3ec48fd8fb11",
    "title": "2011-09-13 - Mebromi- the first BIOS rootkit in the wild",
    "authors": "",
    "file_creation_date": "2022-05-28T01:32:50Z",
    "file_modification_date": "2022-05-28T01:32:50Z",
    "file_size": 229689,
    "plain_text": "# Mebromi: the first BIOS rootkit in the wild\n\n**[webroot.com//blog/2011/09/13/mebromi-the-first-bios-rootkit-in-the-wild/](https://www.webroot.com//blog/2011/09/13/mebromi-the-first-bios-rootkit-in-the-wild/)**\n\nBlog Staff September 13, 2011\n\n**By Marco Giuliani**\n\nIn the past few weeks a Chinese security company called Qihoo\n**360 blogged about a new BIOS rootkit hitting Chinese computers.**\nThis turned to be a very interesting discovery as it appears to be the\nfirst real malware targeting system BIOS since a well-known proof of\nconcept called IceLord in 2007. The malware is called Mebromi and contains a bit of\neverything: a BIOS rootkit specifically targeting Award BIOS, a MBR rootkit, a kernel mode\nrootkit, a PE file infector and a Trojan downloader. At this time, Mebromi is not designed to\ninfect 64-bit operating system and it is not able to infect the system if run with limited\nprivileges.\n\nThe infection starts with a small encrypted dropper that contains five crypted resource files:\n_hook.rom, flash.dll, cbrom.exe, my.sys, bios.sys. The goal of these files will be presented_\nlater in this analysis.\n\nThe infection is clearly focused on Chinese users, because the dropper is carefully checking\nif the system it’s going to infect is protected by Chinese security software Rising Antivirus\nand Jiangmin KV Antivirus. To gain access to the BIOS, the infection first needs to get\nloaded in kernel mode so that it can handle with physical memory instead of virtual memory.\n\nMany of you may recall the old CIH/Chernobyl infection, the infamous virus discovered in\n1998 that was able to flash the motherboard BIOS, erasing it. Even CIH needed to gain\nkernel mode access to reach the BIOS, though at the time the virus was exploiting a privilege\nescalation bug in Windows 9x operating system which allowed it to overwrite the Interrupt\nDescriptor Table with its own payload from user mode, then triggering the overwritten\ninterrupt handler and its malicious code is executed in kernel mode. Mebromi does not use\nsuch kind of privilege escalation trick anymore, it just needs to load its own kernel mode\ndriver which will handle the BIOS infection. To do so, it uses two methods: it could either\nextract and load the flash.dll library which will load the bios.sys driver, or it stops the\nbeep.sys service key, overwriting the beep.sys driver with its own bios.sys code, restart the\nservice key and restore the original beep.sys code.\n\nThe bios.sys driver is the code which handle the BIOS infection. To read the BIOS code, it\nneeds to map the physical memory located at physical memory address 0xF0000, this is\nwhere the BIOS ROM usually resides. Once read, the driver verifies if the BIOS ROM is\nAward BIOS, by checking the presence of the string: $@AWDFLA. If found, the driver tries to\nlocate the SMI port that will be used by the rootkit to flash the BIOS ROM.\n\n\n-----\n\nIf the BIOS ROM matches the string, the rootkit saves a copy of the BIOS to the file\nC:bios.bin and pass the next step to the user mode component of the infection. The dropper\nextracts two files: cbrom.exe and hook.rom. Cbrom.exe is a legitimate tool developed by\nPhoenix Technologies, used to modify the Award/Phoenix BIOS ROM binaries. Hook.rom is\nthe rootkit ISA BIOS ROM that is added to the BIOS binary, containing the rootkit infection.\nThe dropper executes cbrom.exe with the /isa switch parameter, passing the hook.rom file.\nBefore actually injecting the malicious ISA ROM, the dropper checks the BIOS ROM code\nlooking for the “hook rom” string, used as a marker of the infection. If found, it means that the\nBIOS is already infected and it doesn’t need to be infected again.\n\nAfter that the bios.bin file has been modified, the bios.sys driver send to the BIOS SMI port\nthe command 0x29, used to erase the BIOS flash, and then the command 0x2F used to write\nthe new BIOS ROM code to the BIOS ROM.\n\nThe BIOS is now infected, and the dropper goes to its next step: infecting the Master Boot\n**Record. The infection is 14 sectors long and the original MBR is stored to the sector 7. To**\navoid potential startup issues, the infected MBR stores a copy of the original MBR’s partition\ntable. Finally the dropper extracts the my.sys driver on the root of the C: drive. My.sys is a\nkernel mode rootkit that hijacks disk.sys’s IRP major functions, by redirecting the\n_IRP_MJ_READ/WRITE and IRP_MJ_DEVICE_CONTROL native functions. It is used to hide_\nthe infection on the disk. Even if the BIOS infection doesn’t succeed, the rootkit does infect\nthe MBR.\n\nAt the next system startup, after the BIOS POST phase, the malicious code injected inside it\nprepares the full MBR infection (all the first 14 sectors are stored inside the malicious BIOS\nrom, 7168 bytes in total) and checks the MBR code of the hard drive looking if the infection is\nalready present. To do it, the BIOS malicious code checks for the presence of the string “int1”\nat the offset 0x92. If the string is not found, the BIOS malicious rom will overwrite all the first\n14 sectors of the hard drive, thus restoring the MBR infection.\n\n\n-----\n\nThe system startup procedure continues and the control now passes to the malicious master\nboot record. Here the malicious payload analyzes the original MBR partition table and looks\nfor the active partition, checking if it’s using a NTFS or FAT32 file system. The malicious\nMBR code contains indeed NTFS/FAT32 parser routines, used to get inside the file\nsystem to look for winlogon.exe or wininit.exe file. When found, the malicious code contains\na file infection payload, able to inject malicious code inside the specified file and hijack the\nentry point of it. Before infecting the file, the MBR malicious code checks if it is already\ninfected, by looking for the string “cnns” at the offset 0x50 from the beginning of the PE file.\nThis is the infection marker. If the string is not found, the infection stores a crypted payload –\nabout 600 bytes of code – inside winlogon.exe or wininit.exe and hijacks the PE entry point\nto the beginning of it, saving the original entry point at the offset 0x60.\n\nThe job of the MBR infection ends here, waiting for the Windows startup which will load the\npatched executable. When loaded, the payload self-decrypt its malicious code and loads in\nmemory the my.sys driver. Then it tries to download an additional infection from the (now\nunavailable) URL address: http://dh.3515.info:806/test/91/calc[removed].\n\nThe concept behind Mebromi is not new. In fact we must recall the IceLord BIOS rootkit\n**published in 2007, a public proof of concept able to target Award BIOS rom, using an**\napproach very similar to the Mebromi one – or should we say that Mebromi is more than just\ninspired by the IceLord rootkit?\n\nStoring the malicious code inside the BIOS ROM could actually become more than just a\nproblem for security software, giving the fact that even if an antivirus detect and clean the\nMBR infection, it will be restored at the next system startup when the malicious BIOS\npayload would overwrite the MBR code again. Developing an antivirus utility able to clean\nthe BIOS code is a challenge, because it needs to be totally error-proof, to avoid rendering\nthe system unbootable at all. The job of handling with such specific system codes should be\nleft to the developers of the specific motherboard model, who release BIOS updates along\nwith specific tool to update the BIOS code.\n\n\n-----\n\nOn the other hand, although this kind of infection is potentially one of the most persistent\ninfections known out there in the wild, it will hardly become a major threat because of the\nlevel of complexity needed to achieve the goal. While a kernel mode infection or a MBR\ninfection could still work in a generic way among all the PC out there – and they still have a\nhuge available free space to play with, a BIOS-based rootkit needs to be fully compatible\nwith all major BIOS rom out there, it should be able to infect all the different releases of\nAward, Phoenix, AMI BIOS’s out there; a level of complexity that is simply unasked for\n**writing a good persistent infection (e.g. TDL rootkit, various Rustock releases,**\nZeroAccess rootkit among all). In fact, why is Mebromi only targetting Award BIOS rom?\nPerhaps because there was already a known proof of concept that is 5 years old targeting\nAward BIOS ROM available online.\n\nAre BIOS rootkits a real threat? Yes, we can consider Mebromi the first real BIOS rootkit\nincident discovered in the wild – let’s consider IceLord BIOS rootkit more a proof of concept.\nShould we be concerned about BIOS rootkits? Well, while we try to discover whether our PC\nis infected by an unknown and super-stealth BIOS rootkit, let’s try and look if there is a more\n“humble” kernel mode rootkit which is already infecting our PC, allowing a remote attacker to\nsilently own our system.\n\n## About the Author\n\n**[Blog Staff](https://www.webroot.com/blog/author/webroot-blog-staff/)**\n\nThe Webroot blog offers expert insights and analysis into the latest cybersecurity trends.\nWhether you’re a home or business user, we’re dedicated to giving you the awareness and\nknowledge needed to stay ahead of today’s cyber threats.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2011/2011-09-13 - Mebromi- the first BIOS rootkit in the wild.pdf"
    ],
    "report_names": [
        "2011-09-13 - Mebromi- the first BIOS rootkit in the wild.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536074,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653701570,
    "ts_modification_date": 1653701570,
    "files": {
        "pdf": "https://archive.orkl.eu/43ef765400962f01caab9d468e6c3ec48fd8fb11.pdf",
        "text": "https://archive.orkl.eu/43ef765400962f01caab9d468e6c3ec48fd8fb11.txt",
        "img": "https://archive.orkl.eu/43ef765400962f01caab9d468e6c3ec48fd8fb11.jpg"
    }
}