{
    "id": "521e7f71-12fd-4ced-b788-81070ad1b1ff",
    "created_at": "2023-01-12T15:02:45.889733Z",
    "updated_at": "2025-03-27T02:05:33.960294Z",
    "deleted_at": null,
    "sha1_hash": "bd8599d9833733bfc1577b0481773e2487acd232",
    "title": "2020-03-06 - Emotet Wi-Fi Spreader Upgraded",
    "authors": "",
    "file_creation_date": "2022-05-28T17:48:16Z",
    "file_modification_date": "2022-05-28T17:48:16Z",
    "file_size": 1201064,
    "plain_text": "# Emotet Wi-Fi Spreader Upgraded\n\n**binarydefense.com/emotet-wi-fi-spreader-upgraded/**\n\n[This an update to an early article regarding the emerging cyberthreat of Emotet Wifi Spreader.](https://binarydefense.com/emotet-evolves-with-new-wi-fi-spreader/)\n\n## Executive Summary\n\n\nMarch 6, 2020\n\n\n[Binary Defense analysts previously discovered a stand-alone program for spreading Emotet infections over Wi-Fi networks. Although the](https://binarydefense.com/emotet-evolves-with-new-wi-fi-spreader/)\nspreader had been recently delivered by Emotet command and control (C2) servers, the program itself had not been changed for at least two\nyears. In the last week, an updated version of the Wi-Fi spreader was observed being delivered to multiple bots. The new version changed the\nspreader from a stand-alone program into a full-fledged module of Emotet with some other functionality improvements. Instead of bundling the\nEmotet loader with the spreader, it now downloads the loader from a server.\n\n## Protocol Changes\n\nWhile the changes to the Wi-Fi spreader do not affect the key functionality of the malware, the changes are still notable as they increase the\nlogging capability of the spreader, allowing Emotet’s authors to get step-by-step debugging logs from infected machines through the use of a\nnew communication protocol.\n\nThis communication protocol uses two PHP POST arguments to provide Emotet’s authors with crucial debugging outputs. The first argument,\n“id”, is set to the victim’s MachineGUID, while the second argument, “data” is set to any debug strings that the malware generates during\nruntime, encoded with base64.\n\nSome of the debug strings include:\n\nWe succ connected to ipc share\nWNetEnumResource failed with error %d\nfile downloaded ok\nworm started\n\n\n-----\n\n_Figure 1 – Example request_\nThese requests are sent to a single gate.php file with the path hardcoded in the spreader.\n\n## Spreader Changes\n\nAs stated above, the overall spreader functionality has not changed much. Instead, the authors have added in more verbose debugging, while\nalso making the spreader more versatile in the payloads that it downloads. Additionally, the service name has changed in the newly updated\nspreader.\n\nThe only notable change to the spreader functionality is that if the spreader fails to brute-force the C$ share, the spreader will then attempt to\nbrute-force the ADMIN$ share.\n\n_Figure 2 – Spreader bruteforcing code_\nAdditionally, before the spreader attempts to brute-force C$/ADMIN$, it attempts to download, from a hardcoded IP, the service binary that it\ninstalls remotely. If this download fails, it sends the debug string “error downloading file” before quitting.\n\n## Service.exe Changes\n\nPulled down from a hardcoded URL, Service.exe is the executable used to install Emotet onto infected machines[CC1] . This binary, like the\nold Service.exe, will only detonate if first launched as a service. Unlike the old Service.exe however, the updated Service.exe downloads an\nEmotet binary from the C2 instead of containing a binary packaged inside of it.\n\nUpon startup of Service.exe, the malware connects out to the same gate.php used by the spreader and sends the debug string “remote service\n_runned Downloading payload…”. Next, it attempts to connect to a hardcoded C2 where it pulls down the Emotet binary, saving the downloaded_\nfile as “firefox.exe.”\n\nAfter updating the C2 with the download status, if Emotet was successfully downloaded, Service.exe sends “payload downloaded ok” to the C2\nbefore executing the dropped file.\n\n\n-----\n\n_Figure 3 – Download and execute code_\nBy downloading the Emotet loader directly from the C2, Service.exe can ensure that it has the most recent loader, without needing to package\nit inside itself. Additionally, this method helps to avoid detections that may flag off of the Emotet loader, but not the service executable.\n\n## Notable Artifacts\n\nWhile analyzing the spreader/Service.exe combo, Binary Defense analysts uncovered some interesting and notable artifacts that lend some\ninsight into the development process for the spreader. While looking at strings for the spreader executable, Binary Defense noticed that the\nhardcoded URL used by Service.exe to pull down the Emotet loader was also present in the spreader executable. Additionally, the drop name\nfor the Emotet loader (firefox.exe) was also present. However, both were unused. This hints that it is possible that the spreader and service\ncombo were once a single file.\n\n_Figure 4 – Strings_\n\n## IOCs\n\nHash IP/URI(s) File\n\n\nefbfc8500b4af8b39d940668c0dd39452c529ce8d3ead77da3057f1fc7499aef 69[.]43[.]168[.]245\n/UUUU030G182K9N73VR35HW/service.exe\n/UUUU030G182K9N73VR35HW/gate.php\n\n8a4239737f41b7f1730e6b6fdd2ecc3f1a4862bb6ab17f8a3d5eeba59423a8a0 69[.]43[.]168[.]245\n/UUUU030G182K9N73VR35HW/service.exe\n/UUUU030G182K9N73VR35HW/gate.php\n\n3c72f2fe57a0a6f1566bcc809b1039fafb483d5cb15efe8a03c3d68d5db2589f 69[.]43[.]168[.]245\n/OWP3940LD8UWMAZ26XCSQWV182K9/service.exe\n/OWP3940LD8UWMAZ26XCSQWV182K9/gate.php\n\n**YARA rule**\n\n\n[C:\\Asus.](https://www.binarydefense.com/C:/Asus.exe)\n%TEMP\n\n[C:\\Asus.](https://www.binarydefense.com/C:/Asus.exe)\n%TEMP\n\n[C:\\my.ex](https://www.binarydefense.com/C:/my.exe)\n%TEMP\n\n\n-----\n\n_u e_ _otet__ __Sp eade {_\n_meta:_\n_title = “Emotet Wi-Fi Spreader identification”_\n_author = “<james.quinn@binarydefense.com>”_\n_strings:_\n_// 00401174 83 c4 0c  ADD  ESP,0xc_\n_//00401177 89 5d e4  MOV  dword ptr [EBP + local_20],EBX_\n_//0040117a 8d 85 e0  LEA  EAX=>local_824,[EBP + 0xfffff7e0]_\n_//   f7 ff ff_\n_//00401180 89 5d f0  MOV  dword ptr [EBP + local_14],EBX_\n_//00401183 89 45 f4  MOV  dword ptr [EBP + local_10],EAX_\n_//00401186 8d 45 e0  LEA  EAX=>local_24,[EBP + -0x20]_\n_//00401189 6a 01   PUSH  0x1_\n_//0040118b ff 75 08  PUSH  dword ptr [EBP + param_3]_\n_//0040118e ff 75 0c  PUSH  dword ptr [EBP + param_4]_\n_//00401191 50    PUSH  EAX_\n_//00401192 ff 15 64  CALL  dword ptr [_\n_>MPR.DLL::WNetAddConnection2W]_\n_//   01 41 00_\n_//00401198 83 f8 35  CMP  EAX,0x35_\n_//0040119b 75 0e   JNZ  LAB_004011ab_\n\n_$WNetAddConnection2W = { 83 c4 0c 89 5d e4 8d 85 e0 f7 ff ff 89 5d f0 89 45_\n_f4 8d 45 e0 6a 01 ff 75 08 ff 75 0c 50 ff 15 ?? ?? ?? ?? 83 f8 35 75 }_\n_$s1 = “We succ connected to ipc share”_\n_condition:_\n_all of them_\n_}_\n\n**SURICATA rule:**\n_alert tcp $HOME_NET any -> $EXTERNAL_NET [80,443,8080,7080,21,50000,995](msg:”BDS MALICIOUS Emotet Worming Traffic_\n_Likely”;content:”d29ybSBzdGFydGVk”;content:”POST”;http_method;classtype:spreader;sid:7;rev:1)_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-03-06 - Emotet Wi-Fi Spreader Upgraded.pdf"
    ],
    "report_names": [
        "2020-03-06 - Emotet Wi-Fi Spreader Upgraded.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535765,
    "ts_updated_at": 1743041133,
    "ts_creation_date": 1653760096,
    "ts_modification_date": 1653760096,
    "files": {
        "pdf": "https://archive.orkl.eu/bd8599d9833733bfc1577b0481773e2487acd232.pdf",
        "text": "https://archive.orkl.eu/bd8599d9833733bfc1577b0481773e2487acd232.txt",
        "img": "https://archive.orkl.eu/bd8599d9833733bfc1577b0481773e2487acd232.jpg"
    }
}