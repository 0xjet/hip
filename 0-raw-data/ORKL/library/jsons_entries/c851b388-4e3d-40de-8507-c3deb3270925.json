{
    "id": "c851b388-4e3d-40de-8507-c3deb3270925",
    "created_at": "2023-01-12T15:08:19.4263Z",
    "updated_at": "2025-03-27T02:17:11.502397Z",
    "deleted_at": null,
    "sha1_hash": "a8086f2f7fba158f2445b0dea6966b844dc1cd4f",
    "title": "2022-09-27 - A Deep Dive Into the APT28’s stealer called CredoMap",
    "authors": "",
    "file_creation_date": "2022-10-02T12:24:31Z",
    "file_modification_date": "2022-10-02T12:24:31Z",
    "file_size": 7210812,
    "plain_text": "# A Deep Dive Into the APT28’s stealer called…\n\n**[securityscorecard.com/research/apt28s-stealer-called-credomap](https://securityscorecard.com/research/apt28s-stealer-called-credomap)**\n\nSkip to main content\n\n[Support](https://support.securityscorecard.com/hc/en-us)\n[Login](https://platform.securityscorecard.io/#/start)\n[Contact](https://securityscorecard.com/company/contact-us)\n[Blog](https://securityscorecard.com/blog)\n[Languages](https://securityscorecard.com/research/apt28s-stealer-called-credomap)\n\n[English](https://securityscorecard.com/)\n[Français](https://securityscorecard.com/fr)\n[日本語](https://securityscorecard.com/jp)\n[Request a Demo](https://securityscorecard.com/request-a-demo)\n\nInterested in reading the report later? Download it.\n\n[Download Now](https://securityscorecard.pathfactory.com/all/credo-map)\n\n## A Deep Dive Into the APT28’s stealer called CredoMap\n\n**Prepared by: Vlad Pasca, Senior Malware & Threat Analyst**\n\n## Executive summary\n\n\n-----\n\nCredoMap is a stealer developed by the Russian APT28/Sofacy/Fancy Bear that was used\nto target users in Ukraine in the context of the ongoing war between Russia and Ukraine.\n[The malware was initially discovered by Google and](https://blog.google/threat-analysis-group/update-on-cyber-activity-in-eastern-europe/) [CERT-UA. The threat actor weaponized](https://cert.gov.ua/article/341128)\na document to exploit the Follina (CVE-2022-30190) vulnerability that would result in\ndownloading the .NET stealer. The malware aims to steal the credentials and cookies from\nGoogle Chrome, Mozilla Firefox, and Microsoft Edge. The data exfiltration is done by\nsending information to a possibly compromised C2 server via the IMAP email protocol.\n\n## Analysis and findings\n\nSHA256: 2318ae5d7c23bf186b88abecf892e23ce199381b22c8eb216ad1616ee8877933\n\nThe process retrieves the path of the current executable and then connects to a hard-coded\nC2 server (162.241.216.236) on port 143 (IMAP) using hard-coded credentials:\n\nFigure 1\n\nFigure 2\n\nThe malware creates a TcpClient object, obtains a client stream for reading and writing, and\nthen reads the response from the server:\n\n\n-----\n\nFigure 3\n\nThe binary performs the login operation and reads the response using the Read method:\n\nFigure 4\n\nIt selects the INBOX folder using the SELECT command and performs multiple function calls\nthat steal the browsers’ credentials and cookies:\n\nFigure 5\n\nFigure 6\n\nThe sample verifies if the file “\\Google\\Chrome\\User Data\\Default\\Network\\Cookies” exists in\nthe Local AppData folder by calling the File.Exists function:\n\n\n-----\n\nFigure 7\n\nThe File.Copy method is used to copy the above file to a new file called “cc”:\n\nFigure 8\n\nThe malicious binary opens a connection to the Cookies database and executes an SQL\nquery that extracts some fields:\n\nFigure 9\n\nThe process opens and reads the file called “Local/Google/Chrome/User Data/Local State”\nusing File.ReadAllText. It extracts the Base64-encoded random key that is encrypted with\nDPAPI from JSON([“os_crypt”][“encrypted_key”]). The key is Base64-decoded and decrypted\nvia a function call to ProtectedData.Unprotect:\n\nFigure 10\n\nThe binary creates an AESEngine object, an AEADParameters object containing the\ndecrypted AES-128 key and the nonce (12 bytes), and calls the GcmBlockCipher.Init function\nwith a “False” parameter (decryption operation):\n\nFigure 11\n\nThe “encrypted_value” extracted from the Cookies database is decrypted using the\nProcessBytes and DoFinal methods:\n\nFigure 12\n\nThe resulting values are stored in a dictionary that has the keys as \"host_key\" with values\n\"name=<Decrypted encrypted_value>;”, as highlighted in the figure below.\n\n\n-----\n\nFigure 13\n\nFinally, the process serializes the dictionary to a JSON string using\nJsonConvert.SerializeObject:\n\nFigure 14\n\nThe data exfiltration occurs by issuing a valid IMAP APPEND command. The “From” field is\nset to the username obtained from the Environment.UserName property, the “Subject” field is\nset to the current date and time on the computer obtained from the DateTime.UtcNow\nproperty, and the JSON string is also included in the command (see figure 15).\n\nFigure 15\n\nThe malware verifies if the file “\\Google\\Chrome\\User Data\\Default\\Login Data” exists in the\nLocal AppData folder using File.Exists:\n\nFigure 16\n\nThe File.Copy function is utilized to copy the above file to a new file called “cp”:\n\n\n-----\n\nFigure 17\n\nThe binary opens a connection to the Login Data database and executes an SQL query that\nextracts the “action_url”, “username_value”, and “password_value” fields:\n\nFigure 18\n\nThe malicious process reads the file “Local/Google/Chrome/User Data/Local State” found in\nthe AppData directory and deserializes it using the JsonConvert.DeserializeObject method:\n\nFigure 19\n\nFigure 20\n\nThe sample extracts the Base64-encoded random key that is encrypted with DPAPI from\n\n[“os_crypt”][“encrypted_key”]. The key is Base64-decoded and decrypted via a function call\nto ProtectedData.Unprotect:\n\nFigure 21\n\nThe encrypted “password_value” field is decrypted using a function that will be explained\nbelow:\n\n\n-----\n\nFigure 22\n\nThe first 12 bytes after skipping 3 bytes (version tag) from “password_value” represent the\nAES nonce, and the rest of the information is the ciphertext, as displayed in the figure below.\n\nFigure 23\n\nAs in the first case, the “password_value” field is decrypted by calling the ProcessBytes and\nDoFinal functions:\n\nFigure 24\n\nHowever, not all the passwords might be encrypted using AES-GCM. In the case of older\nversions of Chrome, the threat actor tries to decrypt the passwords using the\nProtectedData.Unprotect API:\n\nFigure 25\n\nAs we can see in figure 26, the process computes a string containing \"action_url\",\n\"username_value\", and the decrypted “password_value” field that was obtained using the 1st\nmethod of decryption or the 2nd method of decryption, respectively:\n\n\n-----\n\nFigure 26\n\nThe credentials exfiltration occurs, in the same way, using an IMAP command to the C2\nserver.\n\nThe binary checks if the directory “Mozilla\\Firefox\\Profiles\\” can be located in the AppData\nfolder (see figure 27).\n\nFigure 27\n\nThe malware is looking for a file called “cookies.sqlite” in the profile folders. The\n“cookies.sqlite” database is copied to a file called “fc”:\n\nFigure 28\n\nThe sample runs the \"SELECT * FROM moz_cookies\" SQL query to retrieve the Firefox\ncookies:\n\n\n-----\n\nFigure 29\n\nA new dictionary is created having the keys as “host” with values “name=value;”, as shown in\nthe figure below.\n\nFigure 30\n\nThe dictionary is serialized to JSON and will be exfiltrated via IMAP.\n\nThe executable verifies if the following files can be identified in the profile folders:\n\nlogins.json\n\nkey4.db\n\ncert9.db\n\nsignons.sqlite\n\nkey3.db\n\ncert8.db\n\nFigure 31\n\n\n-----\n\nIf any of the above files exist, it is copied to the current directory, and its content is encoded\nusing Base64. The file location and the Base64-encoded content are exfiltrated using the\nIMAP protocol. Finally, the newly created files are deleted using File.Delete:\n\nFigure 32\n\nThe File.Exists function is used to check if the file “\\Microsoft\\Edge\\User Data\\Default\\Login\nData” exists in the Local AppData directory:\n\nFigure 33\n\nThe above file is copied to a new file called “ep”, as highlighted in figure 34.\n\nFigure 34\n\nThe sample executes the following SQL query that extracts usernames and encrypted\npasswords from the “logins” table:\n\nFigure 35\n\nThe “password_value” field is decrypted by calling the decrypt function that was also used to\ndecrypt the Chrome credentials:\n\n\n-----\n\nFigure 36\n\nIn the case of older versions of Microsoft Edge, the process tries to decrypt the passwords\nusing the ProtectedData.Unprotect function:\n\nFigure 37\n\nThe malware creates a string containing \"action_url\", \"username_value\", and the decrypted\n“password_value” field that was obtained using one of the two decryption methods:\n\nFigure 38\n\nThe executable verifies if the file “\\Microsoft\\Edge\\User Data\\Default\\Network\\Cookies” can\nbe found in the Local AppData folder (see figure 39).\n\nFigure 39\n\nFile.Copy is used to copy the above file to a file called “ec”:\n\nFigure 40\n\n\n-----\n\nThe following SQL query is run by the malware, which extracts some fields from the\n“cookies” table:\n\nFigure 41\n\nThe binary extracts the Base64-encoded key that was encrypted with DPAPI from\n“%LocalApplicationData%\\Microsoft\\Edge\\User Data\\Local State”. The key is decrypted via a\nfunction call to ProtectedData.Unprotect:\n\nFigure 42\n\nThe “encrypted_value” field is decrypted using the AES key extracted above by calling the\nProcessBytes and DoFinal methods:\n\nFigure 43\n\nThe function result is a dictionary containing the relevant information that is serialized using\nJsonConvert.SerializeObject:\n\nFigure 44\n\nAll the files that were copied to the current directory are deleted using the File.Delete\nfunction:\n\n\n-----\n\nFigure 45\n\nThe malicious process sets Normal attributes for a file called “SQLite.Interop.dll,” which\nMalwarebytes found that it’s downloaded from the C2 server along with the initial executable.\nThe DLL file is deleted using File.Delete and another deletion function implemented by the\nmalware:\n\nFigure 46\n\nThe implementation of the deletion function consists of creating a cmd.exe process that\ndeletes the DLL file shown above:\n\nFigure 47\n\nThe process deletes the initial executable and then exits:\n\n\n-----\n\nFigure 48\n\n## Indicators of Compromise\n\n**C2 server**\n\n162.241.216.236\n\n**SHA256**\n\n2318ae5d7c23bf186b88abecf892e23ce199381b22c8eb216ad1616ee8877933\n\n**Processes spawned**\n\ncmd.exe “/C Del <Files>”\n\n## YARA rule to detect the threat\n\nrule CredoMap_APT28\n\n{\n\nmeta:\n\nauthor = \"Vlad Pasca - SecurityScorecard\"\n\nDate = \"2022-09-16\"\n\nstrings:\n\n$s1 = \"\\\\cookies.sqlite\" fullword wide\n\n$s2 = \"SQLite.Interop.dll\" fullword wide\n\n$s3 = \"Subject:\" fullword wide\n\n$s4 = \"$ LOGIN\" fullword wide\n\n$s5 = \"/C Del\" fullword wide\n\ncondition:\n\n\n-----\n\n(uint16(0) == 0x5A4D) and (4 of ($s ))\n\n}\n\nJoin us in making the world a safer place.\n\n[Free Account Sign Up](https://securityscorecard.com/free-account)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-09-27 - A Deep Dive Into the APT28’s stealer called CredoMap.pdf"
    ],
    "report_names": [
        "2022-09-27 - A Deep Dive Into the APT28’s stealer called CredoMap.pdf"
    ],
    "threat_actors": [
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536099,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1664713471,
    "ts_modification_date": 1664713471,
    "files": {
        "pdf": "https://archive.orkl.eu/a8086f2f7fba158f2445b0dea6966b844dc1cd4f.pdf",
        "text": "https://archive.orkl.eu/a8086f2f7fba158f2445b0dea6966b844dc1cd4f.txt",
        "img": "https://archive.orkl.eu/a8086f2f7fba158f2445b0dea6966b844dc1cd4f.jpg"
    }
}