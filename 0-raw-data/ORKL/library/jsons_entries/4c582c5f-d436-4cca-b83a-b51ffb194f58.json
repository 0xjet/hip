{
    "id": "4c582c5f-d436-4cca-b83a-b51ffb194f58",
    "created_at": "2023-01-12T15:00:29.408796Z",
    "updated_at": "2025-03-27T02:16:57.868186Z",
    "deleted_at": null,
    "sha1_hash": "5d86351074f6bc77202d94cbbee4939a227ad79f",
    "title": "2022-08-29 - Tor 101- How Tor Works and its Risks to the Enterprise",
    "authors": "",
    "file_creation_date": "2022-10-02T12:19:19Z",
    "file_modification_date": "2022-10-02T12:19:19Z",
    "file_size": 971426,
    "plain_text": "# Tor 101: How Tor Works and its Risks to the Enterprise\n\n**[unit42.paloaltonetworks.com/tor-traffic-enterprise-networks/](https://unit42.paloaltonetworks.com/tor-traffic-enterprise-networks/)**\n\nJanos Szurdi August 29, 2022\n\nBy [Janos Szurdi](https://unit42.paloaltonetworks.com/author/janos-szurdi/)\n\nAugust 29, 2022 at 6:00 AM\n\n[Category: Tutorial](https://unit42.paloaltonetworks.com/category/tutorial/)\n\nTags: [anonymity,](https://unit42.paloaltonetworks.com/tag/anonymity/) [onion routing,](https://unit42.paloaltonetworks.com/tag/onion-routing/) [privacy,](https://unit42.paloaltonetworks.com/tag/privacy/) [Tor,](https://unit42.paloaltonetworks.com/tag/tor/) [traffic classification](https://unit42.paloaltonetworks.com/tag/traffic-classification/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/tor-traffic-enterprise-networks/)\n\n## Executive Summary\n\nThe Tor project provides one of the most well-known tools that users can leverage to stay\nanonymous on the internet. People use Tor for many different reasons, both benign and\nmalicious. However, allowing Tor traffic on enterprise networks opens the door to a variety of\npotential abuses and security risks.\n\nPolitical activists use Tor to express their views while staying out of sight of their\ngovernments. Cybercriminals use Tor to evade defenses and hide their identity from law\nenforcement. Tor is famous for enabling the operation of dark web marketplaces, such as\n[Silk Road, where customers could procure a wide range of illicit goods, including drugs,](https://arxiv.org/pdf/1207.7139.pdf)\n\n\n-----\n\nweapons and fake identification documents. Malware authors regularly use Tor for denial-ofservice (DoS) attacks, hidden reconnaissance, exploitation, command and control\ncommunication and data exfiltration.\n\nFor enterprises concerned about the risks of Tor traffic, the use of Tor for malware, command\nand control, exfiltration, and hidden reconnaissance are some of the most important security\nrisks. Also, employees can use Tor to bypass content blocking policies (e.g., blocking of adult\n[or gambling sites) such as those provided by the Palo Alto Networks DNS Security and](https://www.paloaltonetworks.com/products/threat-detection-and-prevention/dns-security)\n[Advanced URL Filtering services. Users can also elude geographic restrictions of services or](https://www.paloaltonetworks.com/network-security/advanced-url-filtering)\nbuy illicit goods unchecked using Tor. To avoid these risks, we advise the blocking of Tor in\nenterprise networks.\n\nEmphasizing the importance of monitoring or blocking Tor traffic in the enterprise, we\nobserved 6,617,473 sessions to or from 691 devices within 204 customer networks in one\nmonth.\n\n[Palo Alto Networks provides two solutions as part of Threat Prevention that are best used](https://www.paloaltonetworks.com/network-security/threat-prevention)\n[together to filter Tor traffic. We maintain a verified and built-in Tor Exit IP External Dynamic](https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClRtCAK)\nList that our customers can use to block connections from Tor Exit nodes. Customers can\n[also leverage the Palo Alto Networks traffic classification system App-ID to block incoming](https://docs.paloaltonetworks.com/pan-os/8-1/pan-os-admin/app-id/app-id-overview.html)\n[and outgoing Tor traffic. Additionally, customers can utilize Cortex XDR to alert on and](https://www.paloaltonetworks.com/cortex/cortex-xdr)\nrespond to Tor-related threats on endpoints, in the network or in the cloud.\n\n**Related Unit 42 Topics** **[VPNs](https://unit42.paloaltonetworks.com/tag/vpn/)**\n\n## Table of Contents\n\nWhat Is Tor?\n\nHow Tor Works on a High Level\n\nMalicious and Benign Use Cases for Tor\n\nHow Do Criminals Using Tor Get Caught?\n\nMethods to Block Tor Traffic\n\nConclusion\n\nAcknowledgments\n\nAppendix\n\n## What Is Tor?\n\n[The goal of the Tor network is to provide a tool to internet users for anonymous](https://en.wikipedia.org/wiki/Tor_(network))\ncommunication. Tor stands for The Onion Router, which is the software that enables Tor\n[nodes to participate in onion routing. Onion routing is a technique allowing anonymous](https://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=668972)\ncommunication. Anonymity on the internet means that no one can connect a user's actions\n\n\n-----\n\nand identity. For example, anonymous communication would mean that when a user\nconnects to a server hosting a forum and makes a public post with a made-up username,\nneither a global observer, the forum operators nor other users should be able to tell the\nuser's true identity based on these actions.\n\nTo better understand how hard it is to stay anonymous, let us introduce the imaginary\ncountry of lemons ruled by the tyrant Lemonheads, where it is frowned upon to like or\ndiscuss oranges. Emilia, our heroine, is part of a small rebellious group that loves oranges.\nTo discuss her passion with others, she would like to visit a site called peel-the-orange[.]com.\n\nOne of Emilia's friends, Bob, always used to connect to peel-the-orange[.]com without using\nany anonymity-enhancing technology. Bob told Emilia that his traffic is encrypted since he\nconnects using HTTPS, so no one can read what he is doing. Unfortunately for Bob, HTTPS\ndoes not encrypt the DNS name, peel-the-orange[.]com, so the lemon secret police could\neasily tell that he was visiting a site for orange enthusiasts. Therefore, he ended up on the\nbad lemons list.\n\nAfter that, everyone in their group became more cautious. Emilia's other friends started using\na foreign VPN provider to funnel their traffic through the VPN server and hide their identities.\nThis effort truly made it hard for the lemon police to find out who is connecting to forbidden\nsites.\n\nJess, another friend of Emilia, was high on the Lemonheads’ list of suspected orange\nsympathizers. Observing Jess’s traffic, it became clear to the secret lemon police that she is\nfrequently connecting to a known VPN provider. While the VPN provider helped Jess protect\nher identity, it proved to be a single point of failure. A VPN provider can be bribed, threatened\nor hacked, which are the favorite methods of the Lemonheads. More advanced adversaries\n[(such as the lemon secret police) could employ correlation attacks based on statistical](https://apps.dtic.mil/sti/pdfs/ADA602282.pdf)\nmethods to match incoming and outgoing traffic to and from the VPN servers.\n\nThe lemon secret police initiated “Operation Super Sour” by compromising several servers of\nthe VPN provider and stealing the complete list of all lemon citizens visiting peel-theorange[.]com. As a result, many of Emilia's friends, including Jess, ended up on the bad\nlemons list. Furthermore, the lemon government started censoring connections to known\nforeign VPN server IP addresses to stop the dissidents’ decadent love for oranges.\n\nEmilia became very careful after that last incident. She looked for a solution that would keep\nher safe, even if the lemon secret police could compromise the proxy/VPN servers she used.\nAdditionally, she wanted to ensure that even peel-the-orange[.]com would not know her\nidentity if someone infiltrated their server.\n\nShe soon found Tor, which seemed like it could help her stay anonymous. However, Emilia\nsoon discovered that even this wasn’t foolproof. She told a few acquaintances about Tor, but\nthe lemon secret police were able to identify one of them, Gordon, because he shared his\n\n\n-----\n\nnickname Orange Cake across different sites. Luckily, Emilia only used her pseudonym\nOrange Girl on peel-the-orange[.]com.\n\n## How Tor Works on a High Level\n\nFigure 1 helps us explain how, using Tor, Emilia can stay anonymous even if the\nLemonheads would have full global visibility of network traffic or could compromise a couple\nof Tor nodes.\n\nAt first, we assume that Emilia already has a Tor circuit built, meaning that her computer\nalready selected three Tor nodes (servers running Tor software) to relay messages and\nobtained a shared key with each of them.\n\nFigure 1. High-level overview of how connecting to a website looks using an already built Tor\ncircuit.\nEmilia’s computer first encrypts the private data in three layers (step 1 in Figure 1), hence the\nname onion routing. Her computer encrypts the data in reverse order: first with the key of the\nlast exit node (Kn3), then with the middle relay node’s key (Kn2) and finally with the guard\nnode’s key (Kn1). The guard node receives the data, removes the outermost layer of\nencryption using Kn1 and sends the decrypted message to the relay node. The middle node\nremoves the next layer using Kn2 and relays it to the exit node. Finally, the exit node\ndecrypts the message with Kn3 and sends the original data to the web server (in this\nexample, peel-the-orange[.]com). The layered encryption enables secrecy and limits\nknowledge about who is involved in the communication as only the nodes that know the keys\ncan decrypt the messages.\n\n\n-----\n\nTable 1. This shows which nodes in the column headers know which nodes in the row\nheaders.\nTable 1 summarizes which nodes know about which other nodes. The guard node knows\nwho Emilia is and the next node that receives Emilia’s message, the middle relay node.\nHowever, the guard node does not know about the last exit node and Emilia’s final\ndestination, because decrypting with only Kn1, the message is still garbled for the entry\nnode. The relay node knows the least. It does not know who is the original sender or the final\ndestination and only knows the entry and exit nodes. The exit node knows about the middle\nrelay node and the destination server, while the destination server only knows about the exit\nnode.\n\nMessages on the way back to Emilia are passed back in a similar fashion, each node adding\na layer of encryption using the key shared with Emilia.\n\nFigure 2. The global Tor Network and a global observer.\n\n\n-----\n\nFigure 2 depicts Lemonheads as a global observer. When Emilia uses Tor, the Lemonheads\ncan only observe her connection to the entry node. Even if they have complete global\nvisibility of the messages passed, it becomes hard for them to track Emilia’s messages as\nthey get mixed in with all Tor users’ traffic, and the layer of encryption changes every time the\nmessage is passed to another node. As discussed earlier, if Emilia were to use a single VPN\nprovider, it would know what sites Emilia visits. Additionally, the Lemonheads could observe\nincoming and outgoing messages from the VPN server and possibly determine which sites\nEmilia is visiting.\n\nA curious question is: How can Emilia share keys with Tor nodes without revealing her\nidentity? Solving this problem is a two-part puzzle.\n\nFirst, how can two nodes cooperate to create a key only known to them on a public network\n[where anyone can read all communication? The answer is the Diffie-Hellman key Exchange](https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange)\n(DHE) protocol. The idea is that first, both parties need to individually generate their own\nprivate secrets that they combine into a shared secret (Kn1) that only the two of them can\n[compute. In practice, authenticated ECDHE based on elliptic cryptography is used to solve](https://en.wikipedia.org/wiki/Elliptic-curve_Diffie%E2%80%93Hellman)\nissues with vanilla DHE.\n\nAt this point, Emilia could go to each Tor node and establish a key with them individually, but\nthat would reveal her identity to each of them. The second piece of the puzzle is establishing\nthe keys using DHE. Instead of communicating directly with all three nodes, after\nestablishing a key with the entry node, Emilia’s computer encrypts all messages with Kn1\nand sends the message to the relay node through the entry node. This means that the relay\nnode only knows the entry node and not Emilia. Similarly, Emilia’s computer encrypts DHE\nmessages with Kn2 and Kn1 and sends them through the guard and relay nodes to the exit\nnode.\n\nUnfortunately, barely after Emilia learned about Tor and started using it, the Lemonheads\nstarted censoring connections to publicly advertised Tor node IPs. To counter such efforts,\nvolunteers started running secret Tor bridges (private replacement of publicly advertised\nentry nodes) and made them available in small batches to only a few users at a time.\n\n[Making the matter worse for Emilia and her fellow orange-lovers, researchers found that they](https://zmap.io/paper.pdf)\ncan discover Tor bridges by scanning the entire IPv4 space. We do not cover all challenges\n[using Tor and additional issues are discussed in the DefCon 2022 Tor Presentation.](https://media.defcon.org/DEF%20CON%2030/DEF%20CON%2030%20presentations/Roger%20Dingledine%20-%20How%20Russia%20is%20trying%20to%20block%20Tor.pdf)\n\nIn conclusion, it turns out to be a continuous cat and mouse game for someone like Emilia to\nmaintain anonymity online.\n\n## Malicious and Benign Use Cases for Tor\n\n\n-----\n\nInternet users utilize Tor for many malicious and benign purposes. Political activists, similar\nto Emilia in the examples, want to make sure that their identity remains secret and they\ncannot be tied back to activities condemned by their government. Other users might want to\nprotect their privacy and keep the sites they visit secret, even if the activity is not illicit where\nthey live.\n\nPeople might use Tor to reach geographically restricted content or to circumvent censorship\nby their government or content blocking by their institution. For example, if Tor traffic is not\nblocked, customers of Advanced URL Filtering could not stop employees using Tor from\ncircumventing category-based filtering.\n\nTor is also famous for its onion services. For example, Tor helps to hide multiple\nwhistleblower websites where users can report illicit and immoral activities in their\norganizations without having to worry about retaliation. An onion service keeps its IP address\nsecret by allowing users to connect only using Tor. The idea is that both the user and the\nonion service connect through Tor, and they meet in the middle at a rendezvous point (a Tor\nnode). While the goal of these onion services is not necessarily to enable illicit activities, past\n[studies have found that Tor users established a large fraction or the](https://ietresearch.onlinelibrary.wiley.com/doi/pdfdirect/10.1049/iet-ifs.2015.0121) [majority of Tor hidden](https://www.tandfonline.com/doi/full/10.1080/00396338.2016.1142085)\nservices for illegal purposes. However, only [6.7% of all Tor users connect to hidden services.](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7749358/)\nThe vast majority of users visit clear websites that are less likely to be illicit than onion\n[services. For example, more than a million people use Tor to view](https://www.inverse.com/article/14672-facebook-s-dark-web-onion-site-reaches-1-million-monthly-tor-users) [Facebook’s hidden service](https://m.facebook.com/nt/screen/?params=%7B%22note_id%22%3A2655797467977351%7D&path=%2Fnotes%2Fnote%2F&refsrc=deprecated&_rdr)\nallowing access from areas where governments censor it.\n\nAttackers can leverage Tor for their activities too. Attacks usually start with reconnaissance,\nwhere the attacker explores the target’s infrastructure and searches for potential\nvulnerabilities, for example, by scanning for open ports and running services. Using Tor,\nattackers can hide their location and distribute their activity to multiple exit nodes.\n\nSimilarly, malicious actors can use Tor for later steps of an attack, such as exploiting\nvulnerabilities found during reconnaissance, updating malicious code on the target’s\nmachine, command and control communication, and data exfiltration. Other malicious uses\nof Tor include DoS attacks, fake account creation, spamming and phishing.\n\nMiscreants have utilized Tor for ransomware attacks in a variety of ways. In the case of [Ryuk](https://unit42.paloaltonetworks.com/ryuk-ransomware/)\n[and Egregor ransomware, the initial Remote Access Trojan (RAT) called SystemBC used a](https://unit42.paloaltonetworks.com/egregor-ransomware-courses-of-action/)\nTor hidden service as a backdoor for command and control communications. Using Tor\nhidden services for command and control is useful when building bots as this makes the\ncommand and control hard to take down and maintains its accessibility unless connections to\n[Tor are blocked, for example, by using various Palo Alto Network products.](https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClRtCAK) The Gold\n[Waterfall threat group also used Tor for backdoor communication when installing DarkSide](https://unit42.paloaltonetworks.com/darkside-ransomware/)\nransomware. Tor hidden service-based leak sites also have been utilized to host stolen data\nrelated to DarkSide and [Ranzy locker. Additionally,](https://www.bleepingcomputer.com/news/security/list-of-ransomware-that-leaks-victims-stolen-files-if-not-paid/) [DoppelPaymer](https://unit42.paloaltonetworks.com/ransomware-threat-assessments/4/) [used Tor payment sites to](https://www.bleepingcomputer.com/news/security/list-of-ransomware-that-leaks-victims-stolen-files-if-not-paid/)\n[collect ransoms. Unit 42 recently published research on Cuba Ransomware, which uses a](https://unit42.paloaltonetworks.com/cuba-ransomware-tropical-scorpius/)\n\n\n-----\n\n[Tor hidden service-based leak site, and BlueSky ransomware, which sends a ransom note](https://unit42.paloaltonetworks.com/bluesky-ransomware/)\ninstructing targets to download the Tor browser as part of the process of regaining access to\ntheir files.\n\nTor usage is not specific to malware targeting servers and personal computers. A type of\n[Android malware also uses a Tor hidden service as a command and control server to make](https://www.computerworld.com/article/2488030/android-malware-using-tor-anonymity-network-makes-a-debut.html)\ntakedowns hard.\n\nAdditionally, [researchers found that Tor is used to send various malicious spam messages,](https://appriver.com/resources/blog/august-2020/anonymous-email-attacks-tor-rise)\noften in the form of comments and dating spam. The authors also found that emails sent\nthrough Tor can contain severe threats, including the distribution of AgentTesla RAT, Adobethemed phishing emails and Covid-19 loan scams.\n\n## How Do Criminals Using Tor Get Caught?\n\nWhile Tor provides better anonymity than many other solutions, it is not perfect.\n\nIn 2013, a Harvard student tried to avoid taking one of his final exams by sending a bomb\nthreat. He connected through Tor to an anonymous email provider to keep his identity secret.\nThen he used this email provider to send the bomb threat. While he used Tor properly, the\nstudent made a big mistake when he connected to Tor from Harvard’s wifi network. The\nstudent’s mistake was that Tor hides what you do, but not the fact that you use Tor.\nAuthorities found out from the email’s headers that someone used Tor to send the email.\nFrom there, they checked the network logs to see if any student connected to Tor around the\ntime the university received the email. Connecting the dots, they found the culprit, who faced\ncriminal charges.\n\nRoss Ulbricht, the creator of the infamous onion service Silk Road, also used Tor correctly\n[but made a different operational mistake that led to his arrest. Silk Road was the most well-](https://www.cnn.com/2013/10/04/world/americas/silk-road-ross-ulbricht/index.html)\nknown dark web market at its time, where sellers offered goods like drugs, counterfeit cash,\nforged ID documents and firearms. The FBI found that early on, someone using the\n[pseudonym “Altoid” was astroturfing to promote the Silk Road marketplace. Eight months](https://en.wikipedia.org/wiki/Astroturfing)\nlater, Ulbricht posted a job advertisement using this pseudonym and the contact\nrossulbricht@gmail[.]com to hire an IT expert who can help with “a venture backed Bitcoin\nstartup company.” The FBI was reportedly then able to access both the logs of a VPN server\nUlbricht used and Google’s log of access to his Gmail address. Both records pointed to an\ninternet cafe in San Francisco and led to his arrest. (Ulbricht’s mistake is similar to the\nmistake made by Gordon in our initial example, where he was caught because of his use of\nthe nickname Orange Cake across multiple services.)\n\n[Attackers can deanonymize Tor users via other methods, for example, by using JavaScript or](https://restoreprivacy.com/webrtc-leaks/)\nby [setting up rogue Tor nodes (which might be happening in the real world now). The](https://arstechnica.com/tech-policy/2015/01/did-feds-mount-a-sustained-attack-on-tor-to-decloak-crime-suspects/)\ntakeaway is that while Tor does offer a level of anonymity, users can leak their identity via\n\n\n-----\n\noperational mistakes, or they can be identified if the observer is determined and has the\nresources.\n\n## Methods to Block Tor Traffic\n\nTable 2. How different methods can be used to stop malicious actors from leveraging Tor.\nThe cells labeled Part 1* and 2* mean that the two solutions together need to be used to\nprotect the enterprise.\nTo stop traffic to and from the Tor network, we can either block publicly advertised Tor IPs or\nidentify and block Tor application traffic. Table 2 summarizes the use cases for each type of\nblocking mechanism. First, we can use the list of known exit node IPs to block attacks from\nTor such as reconnaissance, exploitation, command and control communication, data\nexfiltration and DoS attacks. Using the list of known guard node IPs, we can stop our users\nand their machines from sending traffic to Tor and prevent data exfiltration, command and\ncontrol communication, evasion of geo-restrictions and content blocking, and visits to .onion\nsites.\n\nAs the list of Tor bridge nodes is unknown, guard node IP-based blocking is only a partial\n[solution. Instead, we can directly detect and block Tor traffic using App-ID, the Palo Alto](https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClRtCAK)\nNetworks traffic classification system. Next to using available guard and bridge node IPs,\nApp-ID looks at characteristics of connections – such as the cipher suite used or the size of\ndata packets – to identify Tor traffic.\n\nFurthermore, an attacker can initiate data exfiltration and command and control\ncommunication from the Tor network or the compromised machine. Therefore, to halt these\nattacks, it is best to use both exit IP-based and traffic analysis-based blocking.\n\n\n-----\n\nPalo Alto Networks collects all publicly advertised Tor exit IPs and builds a circuit using each\nof them to test whether they work. The known and working Tor exits list constitutes our\n[predefined Tor Exit IP External Dynamic List.](https://docs.paloaltonetworks.com/pan-os/9-0/pan-os-admin/policy/use-an-external-dynamic-list-in-policy/built-in-edls.html)\n\nUsing the Tor Exit IP External Dynamic List and App-ID, we observe that Tor usage is\ncommon in the enterprise, as we identified 6,617,473 sessions on 691 devices within 204\ncustomer networks during one month.\n\nAlong with blocking Tor traffic, an enterprise can leverage endpoint protections such as\n[Cortex XDR to provide coverage for Tor-based threats. Cortex XDR builds on user and entity](https://www.paloaltonetworks.com/cortex/cortex-xdr)\n[behavior analytics (UEBA), endpoint detection and response (EDR), network detection and](https://www.paloaltonetworks.com/cyberpedia/what-is-ueba)\n[response (NDR) and cloud audit logs to detect the following activities:](https://www.paloaltonetworks.com/cyberpedia/what-is-network-detection-and-response)\n\n## Conclusion\n\nTor provides anonymity to its users, which they leverage for both benign and malicious uses.\nOn the one hand, Tor can help political activists in oppressive regimes, improve privacy and\nprotect whistleblower websites. On the other hand, Tor is useful for various malicious\nactivities, including anonymous reconnaissance, data exfiltration, evasion of geo-restrictions,\nevasion of content blocking, and the running of illicit marketplaces on the dark web.\n\nAs cybercriminals often use Tor for malicious purposes, blocking Tor traffic in an enterprise\nsetting is advisable. We find that attempts to use Tor are common, and we identified\n6,617,473 sessions to or from 691 devices on 204 customer networks in one month. Palo\nAlto Networks provides two solutions for blocking Tor traffic as part of [Threat Prevention that](https://www.paloaltonetworks.com/network-security/threat-prevention)\nare best used [together. We provide a verified and built-in Tor Exit IP External Dynamic List to](https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000ClRtCAK)\nour customers that they can use to block connections to Tor Exit nodes. Additionally, Tor\ntraffic in the enterprise network can be blocked using the Palo Alto Networks traffic\n[classification system App-ID. Furthermore, customers can leverage Cortex XDR to alert on](https://docs.paloaltonetworks.com/pan-os/8-1/pan-os-admin/app-id/app-id-overview.html)\nand respond to Tor-related activities on endpoint devices, in the network or in the cloud.\n\n## Acknowledgments\n\nWe want to thank Michael Giuntoli, Yue Guan, Russell Holloway, Erez Levy, Daiping Liu,\nErica Naone, Jason Reverri, Siddhart Shibiraj, Zachary Weinberg, Zhibin Zhang and Jimmy\nChen for their invaluable input on this blog post.\n\n## Appendix: More Details on the DHE Key Exchange\n\n\n-----\n\nFigure 3. How the basic DHE protocol for key exchange would look between Emilia’s\ncomputer and the Tor guard node. Note that in practice ECDHE (DHE with elliptic curve\ncrypto) is used with node authentication.\nWe explain the DHE protocol in Figure 3. The idea is that first, both parties need to\nindividually generate their own secret (a and b randomly selected) that they combine into a\nshared secret (Kn1) that only the two of them know. They achieve this by selecting large\npublic prime numbers g and p and calculating A (= g mod p) and B (= g mod p), the publica b\ncounterparts of their secrets (a and b). The trick is that only Emilia can calculate Kn1 (= Ba\nmod p) from public B, and only the entry guard can calculate Kn1 (= A mod p) from public Ab\n(leveraging that (g ) = (g ) ).a b b a\n\nThere are two drawbacks to DHE. First, it is computationally expensive. Therefore, a more\n[advanced version building on elliptic cryptography is used in practice called ECDHE.](https://en.wikipedia.org/wiki/Elliptic-curve_Diffie%E2%80%93Hellman)\nSecond, Meddler-in-the-Middle (MitM) attacks are possible against plain DHE protocols as all\nmessages are public. For example, the Lemonheads could act like they are the entry node to\nEmilia, generate keys with her, and at the same time pretend that they are Emilia to the entry\nnode and share a different key with it. To counter MitM attacks, Tor uses an authenticated\nversion of DHE. In the case of Tor networks, users authenticate Tor nodes by contacting\nseveral known directory authorities to retrieve node identities and certificates.\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n\n-----\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-29 - Tor 101- How Tor Works and its Risks to the Enterprise.pdf"
    ],
    "report_names": [
        "2022-08-29 - Tor 101- How Tor Works and its Risks to the Enterprise.pdf"
    ],
    "threat_actors": [
        {
            "id": "334d00aa-7607-4072-9f5b-00d60bae89a7",
            "created_at": "2023-01-06T13:46:39.280703Z",
            "updated_at": "2025-03-27T02:00:03.039315Z",
            "deleted_at": null,
            "main_name": "GOLD WATERFALL",
            "aliases": [],
            "source_name": "MISPGALAXY:GOLD WATERFALL",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d58052ba-978b-4775-985a-26ed8e64f98c",
            "created_at": "2023-09-07T02:02:48.069895Z",
            "updated_at": "2025-03-27T02:02:10.181465Z",
            "deleted_at": null,
            "main_name": "Tropical Scorpius",
            "aliases": [
                "DEV-0978",
                "RomCom",
                "Storm-0978",
                "Tropical Scorpius",
                "UNC2596",
                "Void Rabisu"
            ],
            "source_name": "ETDA:Tropical Scorpius",
            "tools": [
                "COLDDRAW",
                "Cuba",
                "Industrial Spy",
                "PEAPOD",
                "ROMCOM",
                "ROMCOM RAT",
                "SingleCamper",
                "SnipBot"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "fecc0d5a-3654-425d-9290-b6d0b4105463",
            "created_at": "2023-10-17T02:00:08.330061Z",
            "updated_at": "2025-03-27T02:00:03.141943Z",
            "deleted_at": null,
            "main_name": "Void Rabisu",
            "aliases": [
                "Tropical Scorpius"
            ],
            "source_name": "MISPGALAXY:Void Rabisu",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "4f56bb34-098d-43f6-a0e8-99616116c3ea",
            "created_at": "2024-06-19T02:03:08.048835Z",
            "updated_at": "2025-03-27T02:05:17.365266Z",
            "deleted_at": null,
            "main_name": "GOLD FLAMINGO",
            "aliases": [
                "Tropical Scorpius ",
                "UAC-0132 ",
                "UAC-0132 ",
                "UNC2596 ",
                "Void Rabisu ",
                "REF9019 "
            ],
            "source_name": "Secureworks:GOLD FLAMINGO",
            "tools": [
                " Cobalt Strike",
                " Cuba",
                " Meterpreter",
                " Mimikatz",
                " ROMCOM RAT",
                "Chanitor"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "f7f78592-30a7-45bc-bf71-e283b3c73ee1",
            "created_at": "2024-06-19T02:03:08.137994Z",
            "updated_at": "2025-03-27T02:05:17.404295Z",
            "deleted_at": null,
            "main_name": "GOLD WATERFALL",
            "aliases": [
                ""
            ],
            "source_name": "Secureworks:GOLD WATERFALL",
            "tools": [
                " CANVAS",
                " Cobalt Strike",
                " Darkside",
                "BlackMatter"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "ed3810b7-141a-4ed0-8a01-6a972b80458d",
            "created_at": "2022-10-25T16:07:23.443259Z",
            "updated_at": "2025-03-27T02:02:09.801771Z",
            "deleted_at": null,
            "main_name": "Carbanak",
            "aliases": [
                "Anunak",
                "Carbanak",
                "Carbon Spider",
                "ELBRUS",
                "Gold Waterfall",
                "Sangria Tempest"
            ],
            "source_name": "ETDA:Carbanak",
            "tools": [
                "AVE_MARIA",
                "Agentemis",
                "AmmyyRAT",
                "Antak",
                "Anunak",
                "Ave Maria",
                "AveMariaRAT",
                "BABYMETAL",
                "BIRDDOG",
                "Backdoor Batel",
                "Batel",
                "Bateleur",
                "BlackMatter",
                "Boostwrite",
                "Cain & Abel",
                "Carbanak",
                "Cl0p",
                "Cobalt Strike",
                "CobaltStrike",
                "DNSMessenger",
                "DNSRat",
                "DNSbot",
                "DRIFTPIN",
                "DarkSide",
                "FOXGRABBER",
                "FlawedAmmyy",
                "HALFBAKED",
                "JS Flash",
                "KLRD",
                "MBR Eraser",
                "Mimikatz",
                "Nadrac",
                "Odinaff",
                "POWERPIPE",
                "POWERSOURCE",
                "PsExec",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "SocksBot",
                "SoftPerfect Network Scanner",
                "Spy.Agent.ORM",
                "TEXTMATE",
                "TeamViewer",
                "TiniMet",
                "TinyMet",
                "Toshliph",
                "VB Flash",
                "WARPRISM",
                "avemaria",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535629,
    "ts_updated_at": 1743041817,
    "ts_creation_date": 1664713159,
    "ts_modification_date": 1664713159,
    "files": {
        "pdf": "https://archive.orkl.eu/5d86351074f6bc77202d94cbbee4939a227ad79f.pdf",
        "text": "https://archive.orkl.eu/5d86351074f6bc77202d94cbbee4939a227ad79f.txt",
        "img": "https://archive.orkl.eu/5d86351074f6bc77202d94cbbee4939a227ad79f.jpg"
    }
}