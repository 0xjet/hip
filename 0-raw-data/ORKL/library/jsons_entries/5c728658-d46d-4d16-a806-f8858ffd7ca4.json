{
    "id": "5c728658-d46d-4d16-a806-f8858ffd7ca4",
    "created_at": "2023-01-12T15:04:07.267621Z",
    "updated_at": "2025-03-27T02:05:32.748315Z",
    "deleted_at": null,
    "sha1_hash": "b2b8b5f8544b01c3117dbc697f93f9818673046a",
    "title": "2021-10-22 - Threat Advisory- Hackers Are Exploiting a Vulnerability in Popular Billing Software to Deploy Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T19:55:07Z",
    "file_modification_date": "2022-05-28T19:55:07Z",
    "file_size": 2777421,
    "plain_text": "# Threat Advisory: Hackers Are Exploiting a Vulnerability in Popular Billing Software to Deploy Ransomware\n\n**huntress.com/blog/threat-advisory-hackers-are-exploiting-a-vulnerability-in-popular-billing-software-to-deploy-**\nransomware\n\nHackers are constantly looking for low-hanging fruit and vulnerabilities that can be exploited\n‚Äîand they‚Äôre not always poking around in ‚Äúbig‚Äù mainstream applications like Office.\n\nSometimes, a productivity tool or even an add-on can be the door that hackers step through\nto gain access to an environment and carry out their next move. Huntress recently\ndiscovered one such vulnerability in a time and billing system called BillQuick.\n\n## What Did We Find?\n\nThe Huntress ThreatOps team discovered a critical vulnerability in multiple versions of\nBillQuick Web Suite, a time and billing system from BQE Software. Hackers were able to\n[successfully exploit CVE-2021-42258‚Äîusing it to gain initial access to a US engineering](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42258)\ncompany‚Äîand deploy ransomware across the victim‚Äôs network. Considering BQE‚Äôs selfproclaimed user base of 400,000 users worldwide, a malicious campaign targeting their\ncustomer base is concerning.\n\n\n-----\n\nOur team was able to successfully recreate this SQL injection-based attack and can confirm\nthat hackers can use this to access customers‚Äô BillQuick data and run malicious commands\non their on-premises Windows servers. We have been in close contact with the BQE team to\nnotify them of this vulnerability, assess the code changes implemented in WebSuite 2021\nversion 22.0.9.1 and work to address multiple security concerns we raised over their\nBillQuick and Core offerings (more to come on these when patches are available).\n\n[CVE-2021-42344](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42344)\n[CVE-2021-42345](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42345)\n[CVE-2021-42346](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42456)\n[CVE-2021-42571](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42571)\n[CVE-2021-42572](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42572)\n[CVE-2021-42573](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42573)\n[CVE-2021-42741](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42741)\n[CVE-2021-42742](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42742)\n\n## The Red Flag üö©\n\nOur spidey senses were first set off after a number of our Ransomware Canary files were\ntripped within an engineering company‚Äôs environment that was managed by one of our\npartners. While investigating the incident, we discovered Microsoft Defender antivirus alerts\nindicating malicious activity as the `MSSQLSERVER$ service account. This indicated the`\npossibility of a web application being exploited in order to gain initial access. The server in\nquestion hosted BillQuick Web Suite 2020 (WS2020), and the connection logs indicated a\nforeign IP repeatedly sending POST requests to the web server logon endpoint leading up to\nthe initial compromise.\n\nFrom this context, we suspected that a bad actor was attempting to exploit BillQuick‚Äîso\nnaturally, we began reverse-engineering the web application to trace the attacker‚Äôs steps.\n\n## Vulnerability Analysis\n\nAfter downloading a free copy of WS2020 from the BQE website, we installed it locally and\nbegan to investigate. During static analysis of the server-side code, the Huntress team\nidentified concatenated SQL queries. Essentially, this function allows a user to control the\nquery that‚Äôs sent to the MSSQL database‚Äîwhich in this case, enables blind SQL injection\nvia the application‚Äôs main login form.\n\n\n-----\n\nWith help from our partner, we were able to recreate the victim s environment and validate\nsimple security tools like sqlmap easily obtained sensitive data from the BillQuick server\nwithout authentication. Because these versions of BillQuick used the `sa (System`\nAdministrator) MSSQL user for database authentication, this SQL injection also allowed the\nuse of the `xp_cmdshell procedure to remotely execute code on the underlying Windows`\noperating system.\n\n### Showcasing the SQL injection in the login page\n\nLet‚Äôs walk through how we were able to recreate the SQL injection vulnerability in BillQuick.\nThe below video showcases how easy it is to trigger this vulnerability by submitting a login\nrequest with invalid characters in the username field.\n\nSimply navigating to the login page and entering a single quote (`'`) can trigger this bug.\nFurther, the error handlers for this page display a full traceback, which could contain\nsensitive information about the server-side code.\n\n### Scanning the application endpoint\n\n[Sqlmap, an open source cybersecurity testing tool, can be used to test for and exploit these](https://sqlmap.org/)\ntypes of vulnerabilities. The tool is able to automatically detect SQL injection vulnerabilities,\ngenerate queries to leak sensitive data from the backend database, and in certain cases,\ngain remote code execution.\n\nHere, we showcase an initial scan of the login endpoint. The file `login-request.txt`\ncontains a raw HTTP request which performs an attempted login. There is nothing inherently\nmalicious about this request, but `sqlmap is capable of mutating this request to identify`\npotential injection vulnerabilities.\n\nIn this case, the argument `-p txtID tells` `sqlmap that we would like to test the` `txtID`\nargument (this corresponds to the username input). `--time-sec increases timeouts while`\nsending requests (our BillQuick server was particularly slow to respond). The `--risk and`\n```\n--level arguments adjust how aggressive sqlmap scanning will be. Because this is local\n\n```\ntesting, we specified higher risk and level values to better tap the full potential of `sqlmap .`\n\n### Multiple SQL injection points identified\n\nAt this point, `sqlmap knows how to exploit the vulnerability. It is common to ask` `sqlmap to`\ntest multiple parameters, so it politely asks if we would like to continue testing others‚Äîin this\ncase we only asked it to test one parameter\n\n\n-----\n\nAfter scanning is complete, `sqlmap will use the injection to fetch the details of the backend`\nSQL database server. In this example, `sqlmap correctly identified Microsoft IIS, Microsoft`\nSQL Server 2019 and Windows 2019.\n\nNext, we tell `sqlmap to enumerate all databases on the SQL server;` `sqlmap remembers`\nthe previously identified vulnerabilities and will automatically use the most appropriate one. It\nquickly identifies the standard databases as well as `BQ2020 and` `BQ2020ARK .`\n\n### Dumping SQL database tables\n\nNow that we know the database name, we can begin dumping database data. In this case,\nwe already know the name of a sensitive database table ( SecurityTable ) used by\nBillQuick Web Suite. This is easily identified by installing a local copy and inspecting the\ndatabase. This table stores permission data and encoded passwords for all employees in the\nBillQuick database.\n\nJust to reiterate: We have not authenticated, but we are still able to remotely leak highly\nsensitive employee information. As a billing management server, there is likely a lot more\nsensitive information living in the production database.\n\n### Gaining remote code execution\n\nLeaking sensitive information is bad enough, but malicious actors are also gaining remote\ncode execution with this vulnerability.\n\nIt is worth noting that if your database server is configured to block use of the `xp_cmdshell`\nextended stored procedure and BillQuick Web Suite was configured to use a least-privilege\nSQL user, remote code execution in this way would not be possible. However, BillQuick Web\nSuite setup information references the built-in `sa account when discussing setup and`\ninstallation multiple times. Any user with read/write access to the BillQuick database could be\nused, but it is common for system administrators to follow documentation verbatim.\n\nIn practice, Huntress has observed partners using BillQuick Web Suite with the built-in `sa`\naccount, which allows full access to the back-end database server, including `xp_cmdshell,`\nregardless of configuration restrictions.\n\n\n-----\n\nIn this case, we use specially-crafted stacked SQL queries to execute the necessary\ncommands for re-enabling the `xp_cmdshell extended stored procedure and then execute`\ncode through `powershell.exe . In the above video, we showcase writing to a file on the`\nserver host and spawning `calc.exe as the` `MSSQLSERVER$ service account.`\n\n### Observing the sqlmap scanning in the logs\n\nBillQuick Web Suite will typically write logs for exceptional conditions to\n```\nC:\\BillQuickData\\AppLog . These logs are full tracebacks from the application when\n\n```\nsomething goes wrong. While testing with `sqlmap, many of these errors occurred and were`\nlogged here. This is a very useful place to check for past exploitation attempts or to debug\nyour own testing.\n\nIt's worth noting, though, that this is not a sure-fire detection tool. Successful SQL injection\nqueries will cause no errors to be logged. Further, some code paths within BillQuick Web\nSuite do not log exceptions to this file. However, the presence of shady or unusual failed\nSQL statements in your log file strongly suggests that someone has been poking where they\nshouldn't be.\n\n- ‚Ä¢ ‚Ä¢\n\n## Parting Thoughts\n\nWe really appreciate the BQE team‚Äôs timely responses to these vulnerability notifications. In\n2021, it‚Äôs still extremely common for vendors to sweep cybersecurity issues under the rug;\nwe have the impression that BQE is taking our feedback seriously.\n\nWith that said, this incident highlights a repeating pattern plaguing SMB software: wellestablished vendors are doing very little to proactively secure their applications and subject\ntheir unwitting customers to significant liability when sensitive data is inevitably leaked and/or\nransomed.\n\nRather than stand idly by, Huntress is spearheading multiple SMB efforts to:\n\nDrive awareness of the code quality epidemic before hackers deliver a ‚Äúgreat\nreckoning‚Äù\nCelebrate and destigmatize vendors who transparently disclose their corrected issues\nIncentivize security researchers to find and responsibly report vulnerabilities\nHold vendors accountable for lagging security practices and unwelcoming behavior\n\nAs a community, we‚Äôre going to be the security tide that raises all boats. It‚Äôs time to rise up.\n\n\n-----\n\n**Caleb Stewart**\n\nSecurity Researcher at Huntress.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-22 - Threat Advisory- Hackers Are Exploiting a Vulnerability in Popular Billing Software to Deploy Ransomware.pdf"
    ],
    "report_names": [
        "2021-10-22 - Threat Advisory- Hackers Are Exploiting a Vulnerability in Popular Billing Software to Deploy Ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535847,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1653767707,
    "ts_modification_date": 1653767707,
    "files": {
        "pdf": "https://archive.orkl.eu/b2b8b5f8544b01c3117dbc697f93f9818673046a.pdf",
        "text": "https://archive.orkl.eu/b2b8b5f8544b01c3117dbc697f93f9818673046a.txt",
        "img": "https://archive.orkl.eu/b2b8b5f8544b01c3117dbc697f93f9818673046a.jpg"
    }
}