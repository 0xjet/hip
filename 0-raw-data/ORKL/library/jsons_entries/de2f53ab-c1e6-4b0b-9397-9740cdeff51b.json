{
    "id": "de2f53ab-c1e6-4b0b-9397-9740cdeff51b",
    "created_at": "2022-10-25T16:48:12.39291Z",
    "updated_at": "2025-03-27T02:08:41.036643Z",
    "deleted_at": null,
    "sha1_hash": "c6e80e76bca03538a2dfd2aac2e4120fdab6f4fc",
    "title": "Trojan.Apt.Seinup Hitting Asean",
    "authors": "FireEye",
    "file_creation_date": "2014-08-05T02:36:03Z",
    "file_modification_date": "2014-08-05T02:36:03Z",
    "file_size": 564297,
    "plain_text": "**1. Executive Summary**\n\nThe FireEye research team has recently identified a number of spear phishing activities targeting Asia and ASEAN. Of these, one of the spear phishing documents was\n\nsuspected to have used a potentially stolen document as a decoy. The rich and contextual details (body and metadata) which are not available online lead us to believe this\n\nwas stolen. This decoy document mentioned countries such as Brunei, Cambodia, Indonesia, Laos, Malaysia, Myanmar, Philippines, Singapore, Thailand, and Vietnam,\n\nwhich leads us to suspect that these countries are targeted. As the content of this decoy document is suspected to be a stolen sensitive document, the details will not be\n\npublished.\n\nThis malware was found to have used a number of advance techniques which makes it interesting:\n\n1. The malware leverages Google Docs to perform redirection to evade callback detection. This technique was also found in the malware dubbed “Backdoor.Makadocs”\n\nreported by Takashi Katsuki (Katsuki, 2012).\n\n2. It is heavily equipped with a variety of cryptographic functions to perform some of its functions securely.\n\n3. The malicious DLL is manually loaded into memory which hides from DLL listing.\n\nAs depicted in the diagram below, the spear phishing document (which exploits CVE-2012-0158) creates a decoy document and a malware dropper named exp1ore.exe.\n\nThis dropper will then drop wab.exe (Address Book Application) and wab32res.dll (malicious DLL) inside the temp folder. By running wab.exe, the malicious DLL named\n\nwab32res.dll (located within the same folder) will be loaded using DLL side-loading technique. This will in turn install a copy of wab32res.dll as msnetrsvw.exe inside the\n\nwindows directory to be registered as Windows service. By registering as a Windows service, it allows the malware to survive every reboot and persist on the network.\n\nFigure 1 Infection Flow\n\nThis malware is named “Trojan.APT.Seinup” because one of its export functions is named “seinup”. This malware was analysed to be a backdoor that allows the attacker to\n\nremote control the infected system.\n\n\n-----\n\nFigure 2 Exported Functions\n\n**2. Related APT Domain and MD5**\n\nBased on our threat intelligence and reverse-engineering effort, below are some related domain and MD5 sums. Please note that some of the domain/IP association may\n\nchange.\n\n**2.1. Related Domain**\n\n**Domain/URL** **IP** **Country** **Comments**\nelizabearden.com 124.172.243.211 CN Registrar: XIN NET TECHNOLOGY CORPORATIONEmail: liangcheng04@sina.com\n\n50.117.115.83\n\n50.117.115.84\n\ndnsserviceonline.com CN Registrar: XIN NET TECHNOLOGY CORPORATIONEmail: liangcheng04@sina.com\n\n50.117.120.235\n69.46.84.51\nsymteconline.com 175.100.206.183 CN Registrar: XIN NET TECHNOLOGY CORPORATIONEmail: Smartwise9851@yahoo.com\n\nRegistrar: SHANGHAI MEICHENG TECHNOLOGY INFORMATION DEVELOPMENT CO.,\nwinshell.net 58.64.190.34 HK\nLTD.Email: richardmatind@yahoo.com\nphilnewsonline.com 50.93.198.128 US Registrar: GODADDY.COM, LLCEmail: woooyeahh11@yahoo.com\nwww.info-week.com 173.254.197.213 US Registrar: GODADDY.COM, LLCEmail: woooyeahh11@yahoo.com\ngo-twitter.com 50.93.198.113 US Registrar: GODADDY.COM, LLCEmail: woooyeahh11@yahoo.com\n\n**2.2. Associated Files**\n\n**Name** **MD5** **Comments**\nSpear-phishing document and decoy\nCONFIDENTIAL CONFIDENTIAL\ndocument\n\niexp1ore.exe 137F3D11559E9D986D510AF34CB61FBC Dropper\nwab.exe CE67AAA163A4915BA408B2C1D5CCC7CC Benign Address Book Application\nwab32res.dll FB2FA42F052D0A86CBDCE03F5C46DD4D Malware to be side loaded when wab.exe is launched.\n\nmsnetrsvw.exe FB2FA42F052D0A86CBDCE03F5C46DD4D [Malware to be installed as a service.]\n\nNote: This is the same as wab32res.dll.\nbaf227a9f0b21e710c65d01f2ab01244 Calls to www.elizabearden.com:80\n0845f03d669e24144df785ee54f6ad74 Calls to www.dnsserviceonline.com:80\nd64a22ea3accc712aebaa047ab818b07 Calls to www.elizabearden.com:80\n56e6c27f9952e79d57d0b32d16c26811 Calls to www.elizabearden.com:80\ncdd969121a2e755ef3dc1a7bf7f18b24 Calls to www.elizabearden.com:80\n709c71c128a876b73d034cde5e3ec1d3 Calls to www.dnsserviceonline.com:80\n\n**3. Interesting Technical Observations**\n\n**3.1. Redirection Using Google Docs**\n\nBy connecting the malicious server via Google Docs, the malicious communication is protected by the legitimate SSL provided by Google Docs (see Figure below). One\n\npossible way to examine the SSL traffic is to make use of a hardware SSL decrypter within an organisation. Alternatively, you may want to examine the usage pattern of the\n\nusers. Suppose a particular user accesses Google Docs multiple times a day, the organization’s Incident Response team may want to dig deeper to find out if the traffic is\n\ntriggered by a human or by malware.\n\n|Domain/URL|IP|Country|Comments|\n|---|---|---|---|\n|elizabearden.com|124.172.243.211|CN|Registrar: XIN NET TECHNOLOGY CORPORATIONEmail: liangcheng04@sina.com|\n|dnsserviceonline.com|50.117.115.83|CN|Registrar: XIN NET TECHNOLOGY CORPORATIONEmail: liangcheng04@sina.com|\n||50.117.115.84|||\n||50.117.120.235|||\n||69.46.84.51|||\n|symteconline.com|175.100.206.183|CN|Registrar: XIN NET TECHNOLOGY CORPORATIONEmail: Smartwise9851@yahoo.com|\n|winshell.net|58.64.190.34|HK|Registrar: SHANGHAI MEICHENG TECHNOLOGY INFORMATION DEVELOPMENT CO., LTD.Email: richardmatind@yahoo.com|\n|philnewsonline.com|50.93.198.128|US|Registrar: GODADDY.COM, LLCEmail: woooyeahh11@yahoo.com|\n|www.info-week.com|173.254.197.213|US|Registrar: GODADDY.COM, LLCEmail: woooyeahh11@yahoo.com|\n|go-twitter.com|50.93.198.113|US|Registrar: GODADDY.COM, LLCEmail: woooyeahh11@yahoo.com|\n\n|Name|MD5|Comments|\n|---|---|---|\n|Spear-phishing document and decoy document|CONFIDENTIAL|CONFIDENTIAL|\n|iexp1ore.exe|137F3D11559E9D986D510AF34CB61FBC|Dropper|\n|wab.exe|CE67AAA163A4915BA408B2C1D5CCC7CC|Benign Address Book Application|\n|wab32res.dll|FB2FA42F052D0A86CBDCE03F5C46DD4D|Malware to be side loaded when wab.exe is launched.|\n|msnetrsvw.exe|FB2FA42F052D0A86CBDCE03F5C46DD4D|Malware to be installed as a service. Note: This is the same as wab32res.dll.|\n||baf227a9f0b21e710c65d01f2ab01244|Calls to www.elizabearden.com:80|\n||0845f03d669e24144df785ee54f6ad74|Calls to www.dnsserviceonline.com:80|\n||d64a22ea3accc712aebaa047ab818b07|Calls to www.elizabearden.com:80|\n||56e6c27f9952e79d57d0b32d16c26811|Calls to www.elizabearden.com:80|\n||cdd969121a2e755ef3dc1a7bf7f18b24|Calls to www.elizabearden.com:80|\n||709c71c128a876b73d034cde5e3ec1d3|Calls to www.dnsserviceonline.com:80|\n\n\n-----\n\nFigure 3 Retrieve Command via Google Docs\n\nBelow is the code that is used to construct a URL that retrieves command via Google Docs. First, the malicious URL is constructed and then encoded. Next, the malware\n\nsimply leverages the Google Docs viewer to retrieve the command from the malicious server (see Figure below).\n\nFigure 4 View Command via GoogleDocs\n\n**3.2. Zero-Skipping XOR Encryption**\n\nThe shellcode encryption technique is fairly standard. The shellcode has a decryption stub which decrypts its body using the XOR key 0x9E, and this shellcode is used to\n\nextract exp1ore.exe(malware) and Wor.doc (benign document).\n\nThe exp1ore.exe and Wor.doc were found within the spear phishing document encrypted using the same key (0xFC) and technique. The XOR key decrypts only a non-zero\n\nbyte (see Figure 5). This prevents statistical methods of recovering the XOR key. The encrypted executable file and benign document were identified to be located inside the\n\nspear phishing document at offsets 0×2509 and 0×43509 respectively.\n\nFigure 5 Zero Skipping XOR Encryption\n\nEven though statistical methods may not be useful in identifying the XOR key as the zero bytes are not encrypted, we could use some of the “known” strings below to hunt\n\nfor the XOR key in this situation. By sliding the known string across the array of bytes to perform a windowed XOR, the key would be revealed when the encoded data is\n\nXORed with the known string.\n\n\n-----\n\nLoadLibraryA\n\n**3.3. Deployment of Various Cryptographic Functions**\n\n**3.3.1. Secure Callback**\n\nThe malware performs the callback in a secure manner. It uses a custom Base64 map to encode its data, and creates a salted digital thumbprint to allow validation of data.\n\nBelow describes the steps to validate a callback using an example of the following URL:\n\nhxxp://www.elizabearden.com/waterphp/BYyH.php?\n\ndEIXozUlFzx=5P&wDq=6QeZky42OCQOLQuZ6dC2LQ7F56iAv6GpH6S+w8npH5oAZk==&k4fJdSp7=cc3237bc79192a096440faca0fdae10&GvQF2lotIr5bT2\n\nThe URL could be generalised as follows:\n\nDomain/<PHP>?<rand 11-13 char>=<A’>&<rand 3-5 char>=<B’>&<rand 7-9 char>=<C’>&<rand 14-16 chars>=<D’>\n\nThe definition of A’, B’, C’ and D’ are as follows:\n\n_Let H be the function which encodes binary into hexadecimal characters prepend with “%”, if it is not alphanumeric, dash, underscore or dot._\n\n_Let B64 be the base 64 encoder using the following custom map, “URPBnCF1GuJwH2vbkLN6OQ/5S9TVxXKZaMc8defgiWjmo7pqrAstyz0D+El3I4hY”._\n\n_Let PT be the plain text which is in the form of “<HostName>[<RunType>]:<IPAddress>{1}”, where HostName and IPAddress are string, and RunType is a character._\n\n_Let A be the random of 3 to 7 characters, and A’ = H(A)_\n\n_Let B be B64 (PT), and B’ = H(B)_\n\n_Let C be 32 char deliminator, and C’ = H(C)_\n\n_Let D be H( MD5 ( salt + MD5 ( B64(PT) + A + C ) )  ), salt = “%^^*HFH)*$FJK)234sd2N@C(JGl2z94cg23″, and D’ = H(D)_\n\nHence, in this case, the specific malicious URL could be applied as follows:\n\n_Domain/<PHP> = http://www.elizabearden.com/waterphp/BYyH.php_\n\n_A’ = “5Pb”_\n\n_B’ = “6QeZky42OCQOLQuZ6dC2LQ7F56iAv6GpH6S%2Bw8npH5oAZk==”_\n\n_C’ = “cc3237bc79192a096440faca0fdae107”_\n\n_D’ = “349118df672db38f9e65659874b60b27” (This is the digital signature)_\n\nThe hash could be verified as follow:\n\n_B64(PT) + A + C = “6QeZky42OCQOLQuZ6dC2LQ7F56iAv6GpH6S+w8npH5oAZk==” + “5Pb” + “cc3237bc79192a096440faca0fdae107”_\n\n_MD5 (B64(PT) + A + C) = “766cf9e96c1a508c59f7ade1c50ecd28”_\n\n_MD5 (salt + MD5(B64(PT) + A + C))  = MD5 ( “%^^*HFH)*$FJK)234sd2N@C(JGl2z94cg23” + “766cf9e96c1a508c59f7ade1c50ecd28”)_\n\n**_= 349118df672db38f9e65659874b60b27 (This equals to D’, which means verified)_**\n\nThe encoded plain text (B) could be recovered:\n\n_B64(PT) = “6QeZky42OCQOLQuZ6dC2LQ7F56iAv6GpH6S+w8npH5oAZk==”;_\n\n_PT = “MY_COMPUTER_NAME[F]:192.168.1.1{1}”, where “MY_COMPUTER_NAME” is the hostname, ‘F’ is the run type, “192.168.1.1” is the IP address._\n\n_Note: This example is mocked up using a dummy computer name and IP address._\n\nThe python code below could be used to decode the custom encoded string (see Figure below).\n\n\n-----\n\nFigure 6 Python to Decode a Custom Base 64\n\n**3.3.2. Random Generator Using Mersenne Twister Algorithm**\n\nThe malware was found to perform a callback at random intervals so as to evade network investigation when looking for network connections that are performed in a\n\nregular interval. Additionally, even the name of the parameters in the get string have a random length and name, which makes it hard to create a fix signature to detect such\n\ncallbacks (see 3.3.1 to understand how a callback is created).\n\nFigure 7 Mersenne Twister Algorithm Seeding function\n\n**3.4. In-Memory Only Malicious Code**\n\nOn the disk, the malicious code is either encrypted or compressed to evade scanning using signature rules. Only upon being loaded into memory, does the malicious code\n\n(that appears to be in the form of a DLL) get manually loaded without the use of Windows 32 API. In this way, when an investigation is performed, the malicious DLL is not\n\nrevealed. Additionally, it makes it much harder for analysis to be performed.\n\nFigure 8 Segments in the memory which contains the malicious code\n\nTaking a deeper look at the decrypted malicious code, this malware was found to contain at least the following functions:\n\nDownload file\n\nDownload and execute or load library\n\nChange sleep duration\n\nOpen and close interactive sessions\n\n**4. Conclusion**\n\nMalware is increasingly becoming more contextually advanced. It attempts to appear as much as possible like legitimate software or documents. In this example, we would\n\nconclude the following.\n\n1. A potentially stolen document was used as a decoy document to increase its credibility. It is also a sign that the compromised organisations could be used as a soft\n\ntarget to compromise their business partners and allies.\n\n2. It is important to put a stop to the malware infection at the very beginning, which is the exploitation phase. Once a network is compromised, it is increasingly harder\n\nto detect such threats.\n\n3. Anti-incident response/forensic techniques are increasingly used to evade detection. It would require a keen eye on details and a wealth of experience to identify all\n\n\n-----\n\nCarnegie Mellon University. (n.d.). Retrieved from http://www.cs.cmu.edu/~fp/courses/15122-f10/misc/rand/mersenne.c0\n\nKatsuki, T. (19 Nov, 2012). Malware Targeting Windows 8 Uses Google Docs. Retrieved from http://www.symantec.com/connect/blogs/malware-targeting-windows-8\nuses-google-docs-0\n\nI would like to thank several colleagues for their significant contributions on this post: Darien Kindlund, Ned Moran, Nart Villeneuve, and Thoufique Haq.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/iap35ypb6u03wrzpmemy2z2ntf4k8wm0",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2013/2013.06.18.APT_Seinup/Trojan.APT.Seinup.pdf"
    ],
    "report_names": [
        "Trojan.APT.Seinup"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716492,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1407206163,
    "ts_modification_date": 1407206163,
    "files": {
        "pdf": "https://archive.orkl.eu/c6e80e76bca03538a2dfd2aac2e4120fdab6f4fc.pdf",
        "text": "https://archive.orkl.eu/c6e80e76bca03538a2dfd2aac2e4120fdab6f4fc.txt",
        "img": "https://archive.orkl.eu/c6e80e76bca03538a2dfd2aac2e4120fdab6f4fc.jpg"
    }
}