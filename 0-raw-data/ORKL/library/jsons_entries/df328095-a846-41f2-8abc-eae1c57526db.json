{
    "id": "df328095-a846-41f2-8abc-eae1c57526db",
    "created_at": "2023-01-12T15:09:41.147592Z",
    "updated_at": "2025-03-27T02:09:52.302175Z",
    "deleted_at": null,
    "sha1_hash": "8294a82957409b31705eb5deedb763ecc721357f",
    "title": "2017-10-16 - BlackOasis APT and new targeted attacks leveraging zero-day exploit",
    "authors": "",
    "file_creation_date": "2022-05-28T02:02:44Z",
    "file_modification_date": "2022-05-28T02:02:44Z",
    "file_size": 975468,
    "plain_text": "# BlackOasis APT and new targeted attacks leveraging zero-day exploit\n\n**[securelist.com/blackoasis-apt-and-new-targeted-attacks-leveraging-zero-day-exploit/82732/](https://securelist.com/blackoasis-apt-and-new-targeted-attacks-leveraging-zero-day-exploit/82732/)**\n\nAuthors\n\nGReAT\n\nMore information about BlackOasis APT is available to customers of Kaspersky Intelligence\n[Reporting Service. Contact: intelreports@kaspersky.com](http://10.10.0.46/mailto:intelreports@kaspersky.com)\n\n## Introduction\n\nKaspersky Lab has always worked closely with vendors to protect users. As soon as we find\nnew vulnerabilities we immediately inform the vendor in a responsible manner and provide all\nthe details required for a fix.\n\n\n-----\n\nOn October 10, 2017, Kaspersky Lab s advanced exploit prevention systems identified a new\nAdobe Flash zero day exploit used in the wild against our customers. The exploit was\ndelivered through a Microsoft Office document and the final payload was the latest version of\nFinSpy malware. We have reported the bug to Adobe who assigned it CVE-2017-11292 and\nreleased a patch earlier today:\n\nSo far only one attack has been observed in our customer base, leading us to believe the\nnumber of attacks are minimal and highly targeted.\n\nAnalysis of the payload allowed us to confidently link this attack to an actor we track as\n“BlackOasis”. We are also highly confident that BlackOasis was also responsible for another\n[zero day exploit (CVE-2017-8759) discovered by FireEye in September 2017. The FinSpy](https://www.fireeye.com/blog/threat-research/2017/09/zero-day-used-to-distribute-finspy.html)\npayload used in the current attacks (CVE-2017-11292) shares the same command and\ncontrol (C2) server as the payload used with CVE-2017-8759 uncovered by FireEye.\n\n## BlackOasis Background\n\nWe first became aware of BlackOasis’ activities in May 2016, while investigating another\nAdobe Flash zero day. On May 10, 2016, Adobe [warned of a vulnerability (CVE-2016-4117)](https://helpx.adobe.com/security/products/flash-player/apsa16-02.html)\naffecting Flash Player 21.0.0.226 and earlier versions for Windows, Macintosh, Linux, and\nChrome OS. The vulnerability was actively being exploited in the wild.\n\nKaspersky Lab was able to identify a sample exploiting this vulnerability that was uploaded to\na multi scanner system on May 8, 2016. The sample, in the form of an RTF document,\nexploited CVE-2016-4117 to download and install a program from a remote C&C server.\nAlthough the exact payload of the attack was no longer in the C&C, the same server was\nhosting multiple FinSpy installation packages.\n\nLeveraging data from Kaspersky Security Network, we identified two other similar exploit\nchains used by BlackOasis in June 2015 which were zero days at the time. Those include\nCVE-2015-5119 and CVE-2016-0984, which were patched in July 2015 and February 2016\n\n\n-----\n\nrespectively. These exploit chains also delivered FinSpy installation packages.\n\nSince the discovery of BlackOasis’ exploitation network, we’ve been tracking this threat actor\nwith the purpose of better understanding their operations and targeting and have seen a\ncouple dozen new attacks. Some lure documents used in these attacks are shown below:\n\n\n-----\n\nDecoy documents used in BlackOasis attacks\n\nTo summarize, we have seen BlackOasis utilizing at least five zero days since June 2015:\n\nCVE-2015-5119 – June 2015\nCVE-2016-0984 – June 2015\nCVE-2016-4117 – May 2016\nCVE-2017-8759 – Sept 2017\nCVE-2017-11292 – Oct 2017\n\n## Attacks Leveraging CVE-2017-11292\n\nThe attack begins with the delivery of an Office document, presumably in this instance via email. Embedded within the document is an ActiveX object which contains the Flash exploit.\n\n\n-----\n\n**Flash object in the .docx file, stored in uncompressed format**\n\nThe Flash object contains an ActionScript which is responsible for extracting the exploit\nusing a custom packer seen in other FinSpy exploits.\n\n\n-----\n\n**Unpacking routine for SWF exploit**\n\nThe exploit is a memory corruption vulnerability that exists in the\n“com.adobe.tvsdk.mediacore.BufferControlParameters” class. If the exploit is\nsuccessful, it will gain arbitrary read / write operations within memory, thus allowing it to\nexecute a second stage shellcode.\n\nThe first stage shellcode contains an interesting NOP sled with alternative instructions, which\nwas most likely designed in such a way to avoid detection by antivirus products looking for\nlarge NOP blocks inside flash files:\n\nNOP sled composed of 0x90 and 0x91 opcodes\n\n\n-----\n\nThe main purpose of the initial shellcode is to download second stage shellcode from\nhxxp://89.45.67[.]107/rss/5uzosoff0u.iaf.\n\n**Second stage shellcode**\n\nThe second stage shellcode will then perform the following actions:\n\n1. Download the final payload (FinSpy) from hxxp://89.45.67[.]107/rss/mo.exe\n2. Download a lure document to display to the victim from the same IP\n3. Execute the payload and display the lure document\n\n### Payload – mo.exe\n\n\n-----\n\nAs mentioned earlier, the mo.exe payload (MD5: 4a49135d2ecc07085a8b7c5925a36c0a)\nis the newest version of FinSpy malware, typically sold to nation states and other law\nenforcement agencies to use in lawful surveillance operations. This newer variant has made\nit especially difficult for researchers to analyze the malware due to many added anti-analysis\ntechniques, to include a custom packer and virtual machine to execute code.\n\nThe PCODE of the virtual machine is packed with the aplib packer.\n\n**Part of packed VM PCODE**\n\nAfter unpacking, the PCODE it will look like the following:\n\n\n-----\n\n**Unpacked PCODE**\n\nAfter unpacking the virtual machine PCODE is then decrypted:\n\n**Decrypted VM PCODE**\n\nThe custom virtual machine supports a total of 34 instructions:\n\n\n-----\n\n**Example of parsed PCODE**\n\nIn this example, the “1b” instruction is responsible for executing native code that is specified\nin parameter field.\n\nOnce the payload is successfully executed, it will proceed to copy files to the following\nlocations:\n\nC:\\ProgramData\\ManagerApp\\AdapterTroubleshooter.exe\nC:\\ProgramData\\ManagerApp\\15b937.cab\nC:\\ProgramData\\ManagerApp\\install.cab\nC:\\ProgramData\\ManagerApp\\msvcr90.dll\nC:\\ProgramData\\ManagerApp\\d3d9.dll\n\nThe “AdapterTroubleshooter.exe” file is a legitimate binary which is leveraged to use the\nfamous DLL search order hijacking technique. The “d3d9.dll” file is malicious and is loaded\ninto memory by the legit binary upon execution. Once loaded, the DLL will then inject FinSpy\ninto the Winlogon process.\n\n**Part of injected code in winlogon process**\n\nThe payload calls out to three C2 servers for further control and exfiltration of data. We have\nobserved two of them used in the past with other FinSpy payloads. Most recently one of\nthese C2 servers was used together with CVE-2017-8759 in the attacks reported by FireEye\nin September 2017. These IPs and other previous samples tie closely to the BlackOasis APT\ncluster of FinSpy activity.\n\n\n-----\n\n## Targeting and Victims\n\nBlackOasis’ interests span a wide gamut of figures involved in Middle Eastern politics and\nverticals disproportionately relevant to the region. This includes prominent figures in the\nUnited Nations, opposition bloggers and activists, and regional news correspondents. During\n2016, we observed a heavy interest in Angola, exemplified by lure documents indicating\ntargets with suspected ties to oil, money laundering, and other illicit activities. There is also\nan interest in international activists and think tanks.\n\nVictims of BlackOasis have been observed in the following countries: Russia, Iraq,\nAfghanistan, Nigeria, Libya, Jordan, Tunisia, Saudi Arabia, Iran, Netherlands, Bahrain,\nUnited Kingdom and Angola.\n\n## Conclusions\n\nWe estimate that the attack on HackingTeam in mid-2015 left a gap on the market for\nsurveillance tools, which is now being filled by other companies. One of these is FinFisher\nwith their suite of tools.\n\nWe believe the number of attacks relying on FinFisher software, supported by zero day\nexploits such as the ones described here will continue to grow.\n\nWhat does it mean for everyone and how to defend against such attacks, including zero-day\nexploits?\n\n[For CVE-2017-11292 and other similar vulnerabilities, one can use the killbit for Flash within](https://answers.microsoft.com/en-us/windows/forum/windows_8-update/flashplayer-updates/cd258a3f-cd87-4ea9-bdb6-074d06ad491e?auth=1)\ntheir organizations to disable it in any applications that respect it. Unfortunately, doing this\nsystem-wide is not easily done, as Flash objects can be loaded in applications that\npotentially do not follow the killbit. Additionally, this may break any other necessary resources\nthat rely on Flash and of course, it will not protect against exploits for other third party\nsoftware.\n\nDeploying a multi-layered approach including access policies, anti-virus, network monitoring\nand allowlisting can help ensure customers are protected against threats such as this. Users\nof Kaspersky products are protected as well against this threat by one of the following\ndetections:\n\nPDM:Exploit.Win32.Generic\nHEUR:Exploit.SWF.Generic\nHEUR:Exploit.MSOffice.Generic\n\nMore information about BlackOasis APT is available to customers of Kaspersky Intelligence\n[Reporting Service. Contact: intelreports@kaspersky.com](http://10.10.0.46/mailto:intelreports@kaspersky.com)\n\n## Acknowledgements\n\n\n-----\n\nWe would like to thank the Adobe Product Security Incident Response Team (PSIRT) for\nworking with us to identify and patch this vulnerability.\n\n## References\n\n[1. Adobe Bulletin https://helpx.adobe.com/security/products/flash-player/apsb17-32.html](https://helpx.adobe.com/security/products/flash-player/apsb17-32.html)\n\n## Indicators of compromise\n\n4a49135d2ecc07085a8b7c5925a36c0a\n89.45.67[.]107\n\n[Adobe](https://securelist.com/tag/adobe/)\n[APT](https://securelist.com/tag/apt/)\n[DLL hijacking](https://securelist.com/tag/dll-hijacking/)\n[Microsoft Word](https://securelist.com/tag/microsoft-word/)\n[Vulnerabilities and exploits](https://securelist.com/tag/vulnerabilities-and-exploits/)\n[Zero-day vulnerabilities](https://securelist.com/tag/zero-day-vulnerabilities/)\n\nAuthors\n\nGReAT\n\nBlackOasis APT and new targeted attacks leveraging zero-day exploit\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-10-16 - BlackOasis APT and new targeted attacks leveraging zero-day exploit.pdf"
    ],
    "report_names": [
        "2017-10-16 - BlackOasis APT and new targeted attacks leveraging zero-day exploit.pdf"
    ],
    "threat_actors": [
        {
            "id": "10ad5c1d-5030-4300-be4e-6d24b40a6330",
            "created_at": "2022-10-25T16:07:23.400966Z",
            "updated_at": "2025-03-27T02:02:09.780076Z",
            "deleted_at": null,
            "main_name": "BlackOasis",
            "aliases": [],
            "source_name": "ETDA:BlackOasis",
            "tools": [
                "FinFisher",
                "FinFisher RAT",
                "FinSpy",
                "Wingbird"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a3687241-9876-477b-aa13-a7c368ffda58",
            "created_at": "2022-10-25T16:07:24.496902Z",
            "updated_at": "2025-03-27T02:02:10.256629Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "ETDA:Hacking Team",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "5200f27d-0d0a-49e9-a9de-9612971126c2",
            "created_at": "2023-01-06T13:46:38.959648Z",
            "updated_at": "2025-03-27T02:00:02.96312Z",
            "deleted_at": null,
            "main_name": "BlackOasis",
            "aliases": [
                "G0063"
            ],
            "source_name": "MISPGALAXY:BlackOasis",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1ba9c064-34d2-48b5-a08c-04d241b00ebe",
            "created_at": "2022-10-25T15:50:23.734241Z",
            "updated_at": "2025-03-27T02:00:55.535726Z",
            "deleted_at": null,
            "main_name": "BlackOasis",
            "aliases": [
                "BlackOasis"
            ],
            "source_name": "MITRE:BlackOasis",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e90c06e4-e3e0-4f46-a3b5-17b84b31da62",
            "created_at": "2023-01-06T13:46:39.018236Z",
            "updated_at": "2025-03-27T02:00:02.978356Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "MISPGALAXY:Hacking Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536181,
    "ts_updated_at": 1743041392,
    "ts_creation_date": 1653703364,
    "ts_modification_date": 1653703364,
    "files": {
        "pdf": "https://archive.orkl.eu/8294a82957409b31705eb5deedb763ecc721357f.pdf",
        "text": "https://archive.orkl.eu/8294a82957409b31705eb5deedb763ecc721357f.txt",
        "img": "https://archive.orkl.eu/8294a82957409b31705eb5deedb763ecc721357f.jpg"
    }
}