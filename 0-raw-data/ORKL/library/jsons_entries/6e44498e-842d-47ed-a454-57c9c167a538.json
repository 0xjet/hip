{
    "id": "6e44498e-842d-47ed-a454-57c9c167a538",
    "created_at": "2023-01-12T15:05:36.09671Z",
    "updated_at": "2025-03-27T02:13:16.66503Z",
    "deleted_at": null,
    "sha1_hash": "31651a4842b0ffec7f6aed7b866a5f18ed3d233d",
    "title": "2022-02-28 - Remcos RAT malware disseminated by pretending to be tax invoices",
    "authors": "",
    "file_creation_date": "2022-05-27T20:55:59Z",
    "file_modification_date": "2022-05-27T20:55:59Z",
    "file_size": 2615137,
    "plain_text": "# 세금계산서로 가장하여 유포되는 Remcos RAT 악성코드\n\n**asec.ahnlab.com/ko/32101/**\n\n2022년 2월 28일\n\nASEC 분석팀은 세금계산서로 가장한 Remcos RAT 악성코드가 유포되는 정황을 확인하였다.\n피싱메일의 내용과 유형은 기존에 본 블로그를 통해 지속적으로 공유했던 형태와 크게 다르지\n않다. 메일 본문에는 어색한 문법으로 쓰여진 짧은 메세지가 포함되어있다. 다만 관련업무를\n하고있을경우 메일 내용에는 크게 개의치않고 무심코 첨부파일을 실행할 가능성이 있으므로\n주의가 필요하다.\n\n\n-----\n\n림 1) 세금계산서로 위장한 악성코드가 첨부된 피싱메일\n\n\n그\n\n그\n\n\n림 2) 첨부파일\n첨부파일인 ‘Tax.gz’ 파일을 압축해제하면 ‘Tax.com’ 이라는 실행파일이 존재하며, 디버깅하여\n파일 내부를 확인해보면 아래와 같은 코드를 확인할 수 있다. 만약 실행환경이 64비트 환경이\n라면 ‘hxxp://zhost.polycomusa[.]com/Chrimaz.exe’ 에서 해당 환경에 적합한 악성파일\n\n\n-----\n\n(1df2bf9313decafd0249d6a4556010bc)을 내려받아 실행하며, 그렇지 않을 경우\n‘3xp1r3Exp.ps1’ 이라는 파워쉘 파일을 다운로드하여 추가 악성행위를 수행한다.\n\n그림 3) 파일 디버깅 시 확인되는 코드\n해당 파워쉘 스크립트는 아래 그림 4)와 같이 UAC Bypass 목적으로 추가 파일(version.dll)을\n다운로드하는 내용으로 구성되어 있다. UAC Bypass는 여러가지 트릭을 이용하여 UAC 프롬\n프트의 팝업 없이 악성코드를 관리자 권한으로 실행시키는 권한 상승 기법이다. UAC Bypass\n에 대한 상세분석 내용은 자사에서 작년 7월에 발행한 TI보고서를 통해 확인할 수 있으며, 일\n부 내용을 인용하면 아래와 같다.\n\n**ATIP – UAC Bypass를** 이용한 권한상승기법 분석보고서 ‘개요’ 부분발췌\n\n악성코드의행위들가운데관리자권한이필요없는기능들도존재하지만관리자권한이\n존재한다면더많은악성행위를수행할수있다. 단적으로랜섬웨어는권한에따라암\n호화대상경로즉, 암호화시킬수있는파일들자체가차이가난다. 이러한점때문에악\n성코드들은관리자권한으로실행되고자하지만관리자권한으로실행되게설정할경우\n_UAC 프롬프트가팝업되어사용자가이를인지할위험이존재한다._\n_UAC가만들어진이후공격자들은이를우회하는다양한기법들을만들어냈으며이를_\n_UAC Bypass라고한다._\n\n**ATIP – UAC Bypass를** 이용한 권한상승기법 분석보고서 ‘기본개념’ 부분발췌\n\n예를들면 sysprep.exe, cliconfg.exe 등의프로세스들이이러한 autoElevate 프로그램들\n이며, 해당속성을갖는프로그램들은실행시 UAC 프롬프트없이자동으로관리자권\n한으로실행된다. 대부분의 UAC Bypass 기법은이러한 autoElevate 프로그램들을악용\n한다. 해당프로그램이사용하는레지스트리와같은설정을변경하여자식프로세스로\n실행시킨다거나, DLL Hijacking 기법을이용하여해당프로그램이악성 DLL을로드하게\n하는방식등이있다.\n\n\n-----\n\n그림 4) 외부 URL에서 내려받아지는 파워쉘 스크립트\n다양한 UAC Bypass 기법 중에서 해당 파워쉘 스크립트는 트릭 폴더(Mock Directory)를 생성\n하여 DLL Hijacking의 방식을 사용한다. 이러한 방식에 대해 조금 더 상세하게 설명하기 위해\n그림 4) 파워쉘 스크립트의 Line 15를 보면 아래와 같이 특정 경로를 생성하는 파워쉘 커맨드\n를 확인할 수 있다.\n```\nNew-Item \"\\\\?\\C:\\Windows \\System32\" -ItemType Directory\n\n```\n트릭폴더를 지칭하는 ‘Mock(가짜의) Directory’ 가 의미하는 바는 다음과 같다. 해당 커맨드는\nC드라이브 Windows 하위 폴더에 System32 폴더를 생성하는 커맨드처럼 보이지만, 자세히\n보면 ‘Windows’ 폴더가 아니라 뒤에 공백(Space)이 하나 존재하는 ‘Windows ‘ 폴더인 것을 알\n수 있다. Windows UI 탐색기를 통해서 파일명 끝에 공백이 존재하는 해당 폴더를 만드는 것은\n당연히 불가능하며, 커맨드를 통해서 ‘C:\\Windows ‘ 를 생성하는 것 또한 불가능하다. 하지만\n커맨드를 통해서 서브디렉토리가 존재하는 ‘C:\\Windows \\System32’ 를 생성하는 것은 가능하\n다는 점을 이용한 것이다.\n\n\n-----\n\n그림 5) 파워쉘커맨드를 통한 트릭폴더 생성 테스트 (Windows 10)\n파일이 실행될 때 권한상승이 필요한지 판단하는 조건 중 하나는 신뢰할 수 있는 폴더(ex.\nC:\\Windows\\System32)에서 실행되었는지 확인하는 것이다. 이는 자동권한상승(autoElevate)\n조건을 판단하는 경로검증로직에서 “\\System32” 부터 검사하는 점을 악용한 것인데,\nAIS(Application Information Service : AppInfo.dll)의 GetLongPathNameW API를 통해 처리되\n는 과정에서 폴더명 끝에 공백이 있으면 공백을 자동으로 제거하게 된다. 반대로 생각해보면\n공격자가 해당 조건을 우회할 수 있다면 사용자에게 권한상승 여부를 묻지않고도 권한을 상승\n하여 파일실행이 가능하게 한다는 의미이다.\n\n이러한 내용과 관련된 WastedLocker 랜섬웨어의 동작방식에 대해서는 아래의 포스팅에서 상\n세하게 소개한 바 있다. [ 2. 관리자권한으로 실행되지 않은 경우, UAC Bypass 수행(*권한 상\n승 메커니즘) ]\n\n\n-----\n\n[주의] 특정 기업을 타깃으로 유포되는 WastedLocker 랜섬웨어 – ASEC BLOG\n지난 7월 23일에 스마트 워치 및 웨어러블 제조업체인 ‘Garmin’이 WastedLocker 이름의 랜섬\n웨어 공격을 받아 서비스 및 생산라인이 중단되는 이슈가 발생했었다. 해당 랜섬웨어의 제작\n자는 ‘Evil Corp’라는 러시안 사이버 범죄 그룹으로 알려져 있으며 이들은 특정 기업을 대상으\n로 APT 공격을 수행한 뒤, 침투 테스킹 도구인 Cobalt Striker를 이용하여 WastedLocker 랜섬\n웨어를 배포한 것으로 추정된다. WastedLocker는 시스템 내의 파일을 암호화 시켜 복호화해\n주는 대가로 금전을 요구하는 전형…\n\n이어서 파워쉘 스크립트의 Line 17부터 확인해보면 정상 System32 폴더 내부에 있는\nwinsat.exe를 가짜 System32 폴더로 복사한 후, 복사된 경로에서 숨김창 속성으로 winsat.exe\n파일을 실행하는 내용이 존재한다. 윈도우 시스템 평가도구인 winsat.exe 는 AIS Whitelist 파\n일 중 하나이기때문에 실행 시 UAC 프롬프트가 팝업되지 않는데, 이로 인해 UAC Bypass 기\n법들에서 주로 사용되는 이유가 된다.\n\n결과적으로는 해당 경로(C:\\Windows \\System32)의 Windows 폴더명 끝에 공백이 제거됨으로\n써 신뢰할 수 있는 위치(Trusted Directory)로 간주된다. 이렇게 트릭폴더가 신뢰할 수 있는 경\n로로 바뀌면서 정상 프로그램이 악성 DLL(version.dll)을 로드하게 만드는 방식인 DLL 하이재\n킹기법 사용이 가능해진다.\n\n현재는 경유지의 연결이 유효하지 않아 추가악성행위가 확인되지 않지만, 연결이 유효했을 시\n점에 최종적으로 version.dll 이 로드되어 실행되면 아래와 같이\n‘C:\\ProgramData\\Chrimaz\\Chrimaz.exe’ 를 의미하는 경로의 ‘Chrimaz.exe파일실행 커맨드’가\n확인되는데, 내/외부 인프라를 통해 연관파일 분석 시 이 파일은 Remcos RAT 악성코드로 확\n인되었다.\n\n\n-----\n\n```\npowershell.exe windowstyle hidden NoProfile ExecutionPolicy bypass Command $mydir\n= [System.Environment]::GetFolderPath('CommonApplicationData');\n$bitdir = '\\Chrimaz';\n$fulldir = $mydir+$bitdir; Add-MpPreference -ExclusionPath $fulldir;\n\n```\n또한, 자사 인프라를 통해 연관성있는 파일을 확인해보니 2월 24일 쯤에도 유사 파워쉘 스크\n립트 및 version.dll 과 유사한 파일들이 다양한 외부 URL을 통해 유포된 것을 알 수 있었다.\nUAC Bypass 목적을 갖는 여러 단계를 거쳐서 최종적인 악성코드를 유포하는 방식이 다양해\n진다는 것이 주목할만한 점이다.\n\nUAC Bypass는 권한상승의 대표적인 방식이며, 악성코드는 다양한 목적으로 권한상승을 시도\n한다. 사용자들은 윈도우 운영체제를 최신 버전으로 패치하여 UAC Bypass 공격을 방지해야\n한다. 기본적으로는 출처가 불분명한 메일의 첨부파일 열람은 자제해야 하며, 사용하고 있는\n백신을 최신버전으로 업데이트하여 악성코드의 감염을 사전에 차단할 수 있도록 신경써야 한\n다.\n\n안랩 제품에서는 해당 악성코드들을 다음과 같이 진단하고 있다.\n\n[파일 진단]\nTrojan/Win.MSIL.R472890\nTrojan/Win.BitMin.C4970105\nDownloader/PowerShell.Generic\nTrojan/Win.UACByPass.C4970059\nTrojan/Win.RemcosRAT.R475423\n\n**[IOC]**\n98cf9ab79e33c04a4934628f6aa3161d\n1df2bf9313decafd0249d6a4556010bc\n9cdcaa1c51bfa4ce6d6abb9376ba26a8\na0f177bfd53ee82d20233bd362fdf024\n150744df32e4a57bb169f91cba45697c\n824a79fc5bebeb7b508247619eca82cd\nhxxp://zhost.polycomusa[.]com\nhxxp://giraffebear.polycomusa[.]com\n\n연관 IOC 및 관련 상세 분석 정보는 안랩의 차세대 위협 인텔리전스 플랫폼 ‘AhnLab TIP’ 구\n독 서비스를 통해 확인 가능하다.\n\n\n-----\n\n[Categories:악성코드](https://asec.ahnlab.com/ko/category/malware/) 정보\n\n[Tagged as:DLLHijacking,](https://asec.ahnlab.com/tag/dllhijacking/) [DLL하이재킹,](https://asec.ahnlab.com/tag/dll%ed%95%98%ec%9d%b4%ec%9e%ac%ed%82%b9/) [취약점,](https://asec.ahnlab.com/ko/tag/%ec%b7%a8%ec%95%bd%ec%a0%90/) [피싱메일,](https://asec.ahnlab.com/ko/tag/%ed%94%bc%ec%8b%b1%eb%a9%94%ec%9d%bc/) [악성코드,](https://asec.ahnlab.com/ko/tag/%ec%95%85%ec%84%b1%ec%bd%94%eb%93%9c/) [파워쉘,](https://asec.ahnlab.com/ko/tag/%ed%8c%8c%ec%9b%8c%ec%89%98/) [malware,](https://asec.ahnlab.com/ko/tag/malware/)\n[phishing,](https://asec.ahnlab.com/ko/tag/phishing/) [PowerShell,](https://asec.ahnlab.com/ko/tag/powershell/) [UAC Bypass](https://asec.ahnlab.com/tag/uac-bypass/)\n\n\n-----",
    "language": "KO",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-28 - Remcos RAT malware disseminated by pretending to be tax invoices.pdf"
    ],
    "report_names": [
        "2022-02-28 - Remcos RAT malware disseminated by pretending to be tax invoices.pdf"
    ],
    "threat_actors": [
        {
            "id": "6c4f98b3-fe14-42d6-beaa-866395455e52",
            "created_at": "2023-01-06T13:46:39.169554Z",
            "updated_at": "2025-03-27T02:00:03.011739Z",
            "deleted_at": null,
            "main_name": "Evil Corp",
            "aliases": [
                "GOLD DRAKE"
            ],
            "source_name": "MISPGALAXY:Evil Corp",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "50068c14-343c-4491-b568-df41dd59551c",
            "created_at": "2022-10-25T15:50:23.253218Z",
            "updated_at": "2025-03-27T02:00:55.408128Z",
            "deleted_at": null,
            "main_name": "Indrik Spider",
            "aliases": [
                "Indrik Spider",
                "Evil Corp",
                "Manatee Tempest",
                "DEV-0243",
                "UNC2165"
            ],
            "source_name": "MITRE:Indrik Spider",
            "tools": [
                "Mimikatz",
                "PsExec",
                "Dridex",
                "WastedLocker",
                "BitPaymer",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "9806f226-935f-48eb-b138-6616c9bb9d69",
            "created_at": "2022-10-25T16:07:23.73153Z",
            "updated_at": "2025-03-27T02:02:09.950784Z",
            "deleted_at": null,
            "main_name": "Indrik Spider",
            "aliases": [
                "Blue Lelantos",
                "DEV-0243",
                "Evil Corp",
                "Gold Drake",
                "Gold Winter",
                "Manatee Tempest",
                "UNC2165"
            ],
            "source_name": "ETDA:Indrik Spider",
            "tools": [
                "Advanced Port Scanner",
                "Agentemis",
                "Babuk",
                "Babuk Locker",
                "Babyk",
                "BitPaymer",
                "Bugat",
                "Bugat v5",
                "Cobalt Strike",
                "CobaltStrike",
                "Cridex",
                "Dridex",
                "EmPyre",
                "EmpireProject",
                "FAKEUPDATES",
                "FakeUpdate",
                "Feodo",
                "FriedEx",
                "Hades",
                "IEncrypt",
                "LINK_MSIEXEC",
                "MEGAsync",
                "Macaw Locker",
                "Metasploit",
                "Mimikatz",
                "PayloadBIN",
                "Phoenix Locker",
                "PowerShell Empire",
                "PowerSploit",
                "PsExec",
                "QNAP-Worm",
                "Raspberry Robin",
                "RaspberryRobin",
                "SocGholish",
                "Vasa Locker",
                "WastedLoader",
                "WastedLocker",
                "cobeacon",
                "wp_encrypt"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b296f34c-c424-41da-98bf-90312a5df8ef",
            "created_at": "2024-06-19T02:03:08.027585Z",
            "updated_at": "2025-03-27T02:05:17.350153Z",
            "deleted_at": null,
            "main_name": "GOLD DRAKE",
            "aliases": [
                "Indrik Spider ",
                "Evil Corp"
            ],
            "source_name": "Secureworks:GOLD DRAKE",
            "tools": [
                " Cobalt Strike",
                " Covenant",
                " Donut",
                " Dridex",
                " Hades",
                " Koadic",
                " LockBit",
                " Macaw Locker",
                " Mimikatz",
                " Payload.Bin",
                " Phoenix CryptoLocker",
                " PowerSploit",
                " Powershell Empire",
                " SocGholish",
                " WastedLocker",
                "BitPaymer"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535936,
    "ts_updated_at": 1743041596,
    "ts_creation_date": 1653684959,
    "ts_modification_date": 1653684959,
    "files": {
        "pdf": "https://archive.orkl.eu/31651a4842b0ffec7f6aed7b866a5f18ed3d233d.pdf",
        "text": "https://archive.orkl.eu/31651a4842b0ffec7f6aed7b866a5f18ed3d233d.txt",
        "img": "https://archive.orkl.eu/31651a4842b0ffec7f6aed7b866a5f18ed3d233d.jpg"
    }
}