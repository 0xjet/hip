{
    "id": "c8c858cd-40ec-4cc9-ba00-0c42a00d3ef1",
    "created_at": "2023-01-12T15:01:19.535959Z",
    "updated_at": "2025-03-27T02:16:34.795246Z",
    "deleted_at": null,
    "sha1_hash": "9692f542465323c7b3e5cac2f26f4a4acc983ad7",
    "title": "2021-06-01 - Detecting Initial Access- HTML Smuggling and ISO Images — Part 1",
    "authors": "",
    "file_creation_date": "2022-05-28T00:27:53Z",
    "file_modification_date": "2022-05-28T00:27:53Z",
    "file_size": 93480,
    "plain_text": "# Detecting Initial Access: HTML Smuggling and ISO Images — Part 1\n\n**[mergene.medium.com/detecting-initial-access-html-smuggling-and-iso-images-part-1-c4f953edd13f](https://mergene.medium.com/detecting-initial-access-html-smuggling-and-iso-images-part-1-c4f953edd13f)**\n\nMehmet Ergene June 1, 2021\n\nMe\nhmet\n\n\nThis blog is part one of a two-part series focusing on TTP extraction, Attack Emulation(Purple\nTeaming), Log Analysis, Threat Hunting, and Threat Detection using the latest NOBELIUM\nemail-based attack.\n\n\n-----\n\nPhoto by on\nInitial access is the most important part of an attack. However, it can be easily ignored by many\norganizations or defenders because of the “Assume Breach” mindset. In this two-part series, I’ll\nexplain how an attack can be detected during its initial access stage and hopefully change the\n“Assume Breach” mindset for some of you. The series can be considered as a crash course on\nthe below topics:\n\nExtracting behavioral TTPs from threat intel reports\nAttack emulation(Atomic Adversary Emulation)\nAnalyzing logs and generating/validating hypotheses\nDeveloping detection rules/queries\n\n\n-----\n\nLet s get started!\n\n## Extracting Behaviors and TTPs\n\nIf you haven’t already, please read the report from Microsoft Threat Intelligence Center (MSTIC)\nbelow and try to create hypotheses for threat hunting and detection.\n\n## Breaking down NOBELIUM's latest early-stage toolset - Microsoft Security\n\n### In this blog, we highlight four tools representing a unique infection chain utilized by NOBELIUM: EnvyScout, BoomBox…\n\nwww.microsoft.com\n\nFor a blue teamer, the report can be summarized as follows:\n\n1. An ISO image containing a malicious binary and a shortcut(LNK) file that executes the\n\nbinary indirectly upon double-clicking(this could have been a direct execution as well).\n2. An HTML attachment that uses HTML smuggling to deliver the ISO image.\n3. The ISO image must be mounted by the victim manually, and the shortcut file must be\n\nopened.\n4. Upon mounting the ISO image and double-clicking the shortcut file, the malicious payload\n\nruns and connects to the C2 server.\n\nWhen I read the report, below were my initial thoughts:\n\nISO image creation on a computer is normal but can be considered highly suspicious if\nobserved on a non-IT employee workstation or a server.\nProcess execution under a mounted image should be highly anomalous.\nNetwork connection from a process that is executed under a mounted image should be\nhighly anomalous.\nIf I can detect image mounts, I can detect this behavior and see if it’s a high fidelity\nanomalous behavior for triggering an alert.\n\nWithout the context provided in the report, it isn’t easy to extract behavioral TTPs, and for me,\ncontext is the key. That’s why I personally prefer analyzing threat actors, how they chain the\ntechniques, and which techniques have a relation with other techniques(e.g., brute-force ->\nvalid accounts -> lateral movement). I use this information to generate detection strategies.\n\nI didn’t extract any MITRE ATT&CK techniques from the report because I’m interested in the\nbehavior that is harder to change. Techniques can be replaced with alternatives easily, but\nbehaviors not.\n\n## Atomic Adversary Emulation\n\n\n-----\n\nI don t particularly appreciate performing atomic tests because it sometimes lacks contextual\ninformation, doesn’t tell the exact story, and can be quite misleading. Adversary emulation, on\nthe other hand, takes too much time. That’s why I’ve made up a new term Atomic Adversary\nEmulation. Atomic adversary emulation is simply emulating a specific phase of an attack.\n\nI used this approach because it’s enough to detect an attack at any phase, not at all phases.\nAlso, focusing on techniques individually takes all the context away. In this example, delivering\nthe HTML attachment to getting the successful Command and Control connection is considered\nas an attack phase.\n\nThe emulation plan for the attack phase as follows:\n\n## Preparation(Resource Development)\n\nSetup Covenant and generate C2 payload (make the payload hidden)\nCreate a shortcut file (LNK) that executes C2 payload via rundll32\nBurn an iso image that contains the shortcut file and the payload\nEncode the iso image\nCreate an HTML file that uses HTML smuggling\n\n## Emulation\n\nOpen the HTML file and save the ISO file it isn’t saved automatically\nOpen downloaded ISO image. The ISO image will be mounted automatically\nDouble click the shortcut file\nCheck the Covenant Console to verify the C2 connection\n\n## Preparation(Resource Development)\n\n Setting up Covenant and generating a C2 payload\n\nCovenant is quite easy to install and configure. I had never installed a C2 tool before, and it\ntook me ~30 minutes on a Windows machine, including reading the relevant parts of the\ndocumentation.\n\n**Note: During the preparation and emulation, disable your AV.**\n\n## Install Git and Docker\n\nNo special configuration is needed. Just perform the default installation.\n\n## Install Covenant\n\nOpen a PowerShell window and enter the commands below:\n\n\n-----\n\n```\nPS> git clone recurse submodules PS> cd Covenant\\Covenant\\PS> docker build t covenant\n.PS> docker run -it -p 7443:7443 -p 80:80 -p 443:443 --name covenant -v\nC:\\Users\\adhd\\Downloads\\Covenant\\Covenant\\Data:/app/Data covenant\n\n```\nThe output of the commands should be like below:\n\n## Create a Listener and Generate a C2 payload (Grunt)\n\nOpen a browser and go to `https://localhost:7443`\nRegister a user(create a user)\nCreate a listener\n\n\n-----\n\n## Generate a Launcher(Grunt)\n\nJust generate the Grunt and download it. No need for hosting the payload.\n\n\n-----\n\nRename the Grunt(payload) to “BOOM.exe”\nOpen the properties of BOOM.exe and select “Hidden” to make the file hidden (optional).\n\n## Create a Shortcut File\n\nCopy an existing shortcut and rename it to “NV”. Then right-click and select properties, remove\nthe “Start in” parameters. Replace the “Target” parameter with\n```\n\"C:\\Windows\\System32\\rundll32.exe advpack.dll,RegisterOCX BOOM.exe . You can\n\n```\nchange the icon if you want (optional).\n\n\n-----\n\nChrome shortcut is copied and modified.\n\n## Create an ISO Image\n\nUse any image burner (I used AnyBurn and chose “Create image file from files/folder”), and\nburn the two files (BOOM.exe and NV.lnk).\n\n## Base64 Encode the ISO Image\n\nBelow PowerShell command converts the ISO image to base64 encoded string and saves it to\nthe NV.txt.\n```\n[convert]::ToBase64String(([IO.File]::ReadAllBytes('<PathToISOFile>'))) > NV.txt\n\n```\nOpen a text editor and paste the below contents\nPaste the base64 encoded string in the NV.txt without removing the quotes in the code:\n\nWe are ready for the emulation!\n\n## Emulation\n\n1. Copy the HTML file to a target machine(you can use the same machine you use for\n\ncovenant if you like)\n2. Open the HTML file. The ISO file will be downloaded automatically. If not, save the file\n\nmanually.\n3. Open the ISO file (will be mounted automatically when you open it)\n4. Double click the “NV” shortcut\n\n\n-----\n\nBOOM.exe is hidden, but the “show hidden files” setting is enabled.\n**Check the Covenant Console**\n\n\n-----\n\nCovenant console displaying the active and lost beacons\nSuccess! We received the C2 connection.\n\nNext, we will analyze the logs, generate/validate hypotheses and develop detections. Follow\nthe link below.\n\n## Detecting Initial Access: HTML Smuggling and ISO Images — Part 2\n\n### In this part, we’ll analyze the logs, validate/modify/generate hypotheses, generate detection strategies, and develop…\n\nmergene.medium.com\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-01 - Detecting Initial Access- HTML Smuggling and ISO Images — Part 1.pdf"
    ],
    "report_names": [
        "2021-06-01 - Detecting Initial Access- HTML Smuggling and ISO Images — Part 1.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "70872c3a-e788-4b55-a7d6-b2df52001ad0",
            "created_at": "2023-01-06T13:46:39.18401Z",
            "updated_at": "2025-03-27T02:00:03.01553Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "DarkHalo",
                "StellarParticle",
                "NOBELIUM",
                "Solar Phoenix",
                "Midnight Blizzard"
            ],
            "source_name": "MISPGALAXY:UNC2452",
            "tools": [
                "SNOWYAMBER",
                "HALFRIG",
                "QUARTERRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1d3f9dec-b033-48a5-8b1e-f67a29429e89",
            "created_at": "2022-10-25T15:50:23.739197Z",
            "updated_at": "2025-03-27T02:00:55.536417Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "UNC2452",
                "NOBELIUM",
                "StellarParticle",
                "Dark Halo"
            ],
            "source_name": "MITRE:UNC2452",
            "tools": [
                "Sibot",
                "Mimikatz",
                "Cobalt Strike",
                "AdFind",
                "GoldMax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "ec14074c-8517-40e1-b4d7-3897f1254487",
            "created_at": "2023-01-06T13:46:38.300905Z",
            "updated_at": "2025-03-27T02:00:02.799108Z",
            "deleted_at": null,
            "main_name": "APT10",
            "aliases": [
                "TA429",
                "STONE PANDA",
                "POTASSIUM",
                "Red Apollo",
                "HOGFISH",
                "Cloud Hopper",
                "BRONZE RIVERSIDE",
                "ATK41",
                "G0045",
                "Menupass Team",
                "happyyongzi",
                "CVNX",
                "Granite Taurus"
            ],
            "source_name": "MISPGALAXY:APT10",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a241a1ca-2bc9-450b-a07b-aae747ee2710",
            "created_at": "2024-06-19T02:03:08.150052Z",
            "updated_at": "2025-03-27T02:05:17.409596Z",
            "deleted_at": null,
            "main_name": "IRON RITUAL",
            "aliases": [
                "Blue Dev 5 ",
                "BlueBravo ",
                "Cloaked Ursa ",
                "CozyLarch ",
                "Dark Halo ",
                "Midnight Blizzard ",
                "NOBELIUM ",
                "StellarParticle ",
                "UNC2452 ",
                "APT29"
            ],
            "source_name": "Secureworks:IRON RITUAL",
            "tools": [
                " Cobalt Strike",
                " EnvyScout",
                " GoldFinder",
                " GoldMax",
                " NativeZone",
                " RAINDROP",
                " SUNBURST",
                " Sibot",
                " TEARDROP",
                " VaporRage",
                "Brute Ratel C4"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46b3c0fc-fa0c-4d63-a38a-b33a524561fb",
            "created_at": "2023-01-06T13:46:38.393409Z",
            "updated_at": "2025-03-27T02:00:02.822155Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "The Dukes",
                "Minidionis",
                "Grizzly Steppe",
                "G0016",
                "Blue Kitsune",
                "BlueBravo",
                "SeaDuke",
                "Cloaked Ursa",
                "YTTRIUM",
                "ATK7",
                "Nobelium",
                "UAC-0029",
                "Group 100",
                "COZY BEAR",
                "IRON HEMLOCK",
                "TA421",
                "ITG11"
            ],
            "source_name": "MISPGALAXY:APT29",
            "tools": [
                "QUARTERRIG",
                "SNOWYAMBER",
                "HALFRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535679,
    "ts_updated_at": 1743041794,
    "ts_creation_date": 1653697673,
    "ts_modification_date": 1653697673,
    "files": {
        "pdf": "https://archive.orkl.eu/9692f542465323c7b3e5cac2f26f4a4acc983ad7.pdf",
        "text": "https://archive.orkl.eu/9692f542465323c7b3e5cac2f26f4a4acc983ad7.txt",
        "img": "https://archive.orkl.eu/9692f542465323c7b3e5cac2f26f4a4acc983ad7.jpg"
    }
}