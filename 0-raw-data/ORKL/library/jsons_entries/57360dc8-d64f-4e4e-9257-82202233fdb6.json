{
    "id": "57360dc8-d64f-4e4e-9257-82202233fdb6",
    "created_at": "2023-01-12T15:00:03.022492Z",
    "updated_at": "2025-03-27T02:06:01.284558Z",
    "deleted_at": null,
    "sha1_hash": "8496fd9cf2a65107de1e5504685e2055d45d8bb7",
    "title": "2022-04-21 - Warez users fell for Certishell",
    "authors": "",
    "file_creation_date": "2022-05-27T21:28:44Z",
    "file_modification_date": "2022-05-27T21:28:44Z",
    "file_size": 1880175,
    "plain_text": "# Warez users fell for Certishell\n\n**[decoded.avast.io/danielbenes/warez-users-fell-for-certishell/](https://decoded.avast.io/danielbenes/warez-users-fell-for-certishell/)**\n\nby [Daniel BenešApril 21, 202214 min read](https://decoded.avast.io/author/danielbenes/)\n\n\nApril 21, 2022\n\n\nResearch of this malware family began when I found a malicious task starting powershell\ncode directly from a registry key within our user base. I wasn’t expecting the surprise I’d\narrived at when I began tracking its origins. Living in a smaller country, Czech Republic, it is\na rare sight to see someone exclusively targeting the local `Czech/Slovak audience. The`\nthreat actor seems to have been creating malware `since 2015 and appears to be from`\nSlovakia. The bad actor’s repertoire contains a few `RATs, some packers for`\n```\ncryptominers and, almost obligatorily, ransomware, and I have named the malware\n\n```\nfamily `Certishell . This person’s malware is spread with illegal copies of songs and`\nmovies and with alleged cracks and keygens of games and common tools ( GTA SA,\n```\nMafia, Avast, Microsoft Office ) that were hosted on one of the most popular\n\n```\nCzech and Slovak file-sharing services `uloz.to .`\n\nThe Ceritshell family can be split into three different parts.\n\n1. RAT with a C&C server `sivpici.php5[.]sk (Czech/Slovak slang for “you are`\n\nfucked up”), which has AutoIT, C++ and Go versions.\n2. Miner downloaded from hacked websites and started with the script `que.vbs from`\n\nthe task.\n3. Miner or ransomware downloaded from hacked websites and launched from a\n\npowershell command hidden in registry keys. The command from the registry key is\nstarted with the task from the picture above.\n\n\n-----\n\n_The map above shows the risk ratio of users around who were at risk of encountering one_\n_of the malware families_\n\n## Sivpici.php5.sk (2015-2018)\n\nThe oldest part of the family is a simple RAT with `sivpici.php5[.]sk as the C&C server.`\nIt places all the needed files in the folder `.win inside of the user folder.`\n\nThe malware installer comes disguised as one of the following:\n\n\n-----\n\nCracked software, such as `FixmyPC,`\nFraud apps, like `SteamCDKeys that share Steam keys,`\nMusic CD unpackers with names like `Extractor.exe or` `Heslo.exe (Heslo means`\n_password in Czech/Slovak) that come with a password protected archive with music_\nfiles.\n\nThe malicious executable downloads an executable named UnRAR.exe and a malicious\narchive that contains a simple RAT written in C++, AutoIT or Go.\n\n### Installer\n\nEvery executable installing this malware family contains a script similar to the one in the\nfollowing picture optionally with `curl.exe . This script usually shows the password to`\narchive or start another application. The malicious part downloads a legitimate RAR\nextractor `UnRAR.exe and a malicious archive that can be password protected and`\nunpacks it into the `%UserProfile%\\.win\\ folder. In the end it registers one of the`\nunpacked files as a service, starts it and allows one of the binaries in the firewall.\n\nI found six different methods used to pack the script into executable binary:\n\n\n-----\n\n1. Bat2exe\n2. Quick Batch File Compiler\n3. Compiled AutoIT version\n\n4. Compiled AutoIT version with obfuscated script\n\n5. Compiled AutoIT version with obfuscated script and packed with PELock\n6. Compiled AutoIT version with obfuscated script packed with VMProtect\n\n### RAT\n\nThere are three main variants of this RAT. All of them use the same C&C\n```\nsivpici.php5[.]sk and similar communication protocol. The most advanced is a\n\n```\ncompiled AutoIT script. This script comes in 10 different main versions. The second one is\nwritten in C++ and we found only one main version and the last one is written in Go also\nwith one main version.\n\nThe first time it is run, it generates a random alphanumeric string that works as an\nidentificator for the C&C. This identificator is saved into file gen.gen for next start. The\ncommunication uses the HTTP protocol. Infected machines send the following back the\nC&C:\n\n`pc` = ComputerName,\n\n`os` = content of `SOFTWARE\\\\Microsoft\\\\Windows`\n```\n   NT\\\\CurrentVersion\\\\ProductName,\n   uniq = generated identifier, saved in \\.win\\gen.gen\n\n```\n\n-----\n\nwith the `GET method to` `start.php .`\n\nAfter a random period of time, the malware starts asking for commands using the `GET`\nmethod with the parameter `uniq . The response is a number that has fixed meanings`\nthroughout all the versions. Commands “1” – “7” are implemented as follows:\n\n1. The RAT downloads a URL from `/urlg.php using` `uniq, from this URL it`\n\ndownloads a file, `packed.rar, then the RAT starts` `run.bat from the installation`\nphase to UnRaR the package to the `\\.win\\Lambda folder and restart the RAT. This`\nallows the RAT to update itself and also download any other file necessary.\n2. Create a screenshot and send it with the `POST method to the` `up.php .`\n3. Send all file names from all drives to `up.php .`\n4. DDoS attack to a chosen IP through `UDP / HTTP / PING .`\n5. Get a list of all installed apps from\n```\n   HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\n\n```\nsaves it to `/.win/installed.txt and send them to` `up.php .`\n6. Get a list of all running processes, save it to `/.win/processes.txt and send them`\n\nto `up.php .`\n7. Collect log from keylogger, save it to `\\.win\\log.txt and send it to` `up.php .`\n\nThe RAT in the form of compiled AutoIT script has the name `Winhost.exe .`\n\n\n-----\n\n-----\n\nThere is a comparison of different versions (versioning by the author of the RAT) in the\nfollowing table.\n\nVersion Commands Notes\n\ndebugging 1 Command 2 opens a message box with text 222222\n\n4 1 – 3 Registration of PC happens only once on `reg.php and on`\nconnection it sends only the `uniq and the version of the RAT`\nto `updaver.php`\n\n6 1 – 4 Opens `/ad.php in a hidden Internet Explorer window once`\nwhen the user is not interacting with the PC for at least 5\nseconds and closes it after 30 seconds.\n\n7 1 – 5\n\n8 1 – 7 Keylogger starts with the start of the RAT.\n\n9 1 – 7 Keylogger has colored output.\n\n10 1 – 7 Keylogger is separate executable ( `~\\.win\\1.exe )`\n\nComparission of different version of AutoIT RAT\nThe keylogger in versions eight and nine is copied from the official AutoIT documentation\n(with a few small changes)\n[https://www.autoitscript.com/autoit3/docs/libfunctions/_WinAPI_SetWindowsHookEx.htm](https://www.autoitscript.com/autoit3/docs/libfunctions/_WinAPI_SetWindowsHookEx.htm)\n\nVersion 9 adds coloring of keys, mouse movements and clipboard in the keylogger.\nThe C++ RAT is named `dwms.exe . It uses LibCURL to communicate with the C&C. The`\ncommunication protocol is the same. The `uniq` identifier is saved in the `fr.fr file`\ninstead of `gen.gen for the AutoIT version, it also starts communication by accessing`\n```\nconnect.php instead of start.php .\n\n```\nI’ve managed to find a debugging version that only has the first command implemented and\nreturns only “Command 2” and “Command 3” to the standard output for the second and\nthird command. After every command it answers the C&C by sending `uniq and` `verzia`\n(“version” in English) with GET method to `online.php .`\n\nThe “production” version is labeled as version A. The code is divided into two functions:\n```\n   LLLoad downloads the URL address of the C&C server from the pastebin and tests\n\n```\nit by downloading `/exists.txt .`\n\n\n-----\n\n```\n   RRRun that contains the first two commands as described above. It also uses\n   /connect/ path for register.php, load.php, online.php and\n   verzia.php .\n\n```\nTo download newer versions it uses curl called from the command line.\n\nAnother difference is that screenshots taken are sent via FTP to a different domain:\n```\nfreetips.php5[.]sk/public_html/SHOT.bmp\n\n```\nwith the username `sivpici and password` `A1B2C3D4 .`\n\nThe RAT written in Go only has the first command implemented, but it downloads\n```\n/cnct/ad.txt and it opens URLs contained on victims computer, thus we speculate it\n\n```\ncould also work as adware.\n\n## IECache, bitly, pastebin (2016-2018)\n\nThe installation of this coinminer is similar to the RAT in the previous section. Installations\nuse the same folder and the scripts have the same name. It usually comes as an unpacker\nof illegal copies of music and movies downloaded from `uloz.to . It uses powershell to`\ndownload and execute scripts from a bit.ly shortened address. The final stage is coinminer\n```\nIECache.exe, which is usually XMRig.\n\n### Heslo.txt.exe, Crack.exe…\n\n```\n\n-----\n\nThere is a huge variety of programs that download bit.ly-shortened Czech and Slovak sites\nand execute them. These programs include: GTA SA crack, Mafia, Microsoft Office, Sims,\nLego Star Wars, and unpackers for music and movies. These programs usually print a\nmessage to the victim and run a malicious script in a hidden window.\n\nThe unpackers use UnRAR to unpack the archive and show the victim the password of that\narchive.\n\nUnpacker of a music album written in Python and packed with Pyinstaller. It tries to use\nUnRAR.exe to unpack the music, if unsuccessful, it shows password “1234”.\nThe cracks on the other hand just show an error message.\n\nResult of Patcher for Counter-Strike Global Offensive. After downloading and installing the\nmalware from Sourceforge it shows an error from the picture above.\nAll the installation files execute the following command with some bitly shortened site:\n\nThere are VBA scripts calling it, basic programs possibly written in C, .Net, AutoIT scripts,\n**Golang programs, Rust programs, Redlang programs, different packers of python and**\n**batches, some of them use UPX, MPRESS, VMprotect and PELock.**\n\nRed\n\nlanguage\n\n\n-----\n\nAutoIT\n\nPyinstaller\n\n\n-----\n\nBat obfuscator\n\nRust\n\n### Downloaded script\n\nThere are at least two new scripts created by the script from the site hidden behind the\n```\nbit.ly shortened URL, que.vbs and run.bat .\n\n```\nThe script also creates one of two services named `Winmgr and` `Winservice that start`\n```\nque.vbs . Que.vbs only starts run.bat which downloads whats.txt contains a script\n\n```\ndownloading and starting coinminer `IECache.exe .`\n\n\n-----\n\n**que.vbs hash:**\n```\n6f2efc19263a3f4b4f8ea8d9fd643260dce5bef599940dae02b4689862bbb362\n\n```\n**run.bat hash:**\n\n```\n1ad309c8ee17718fb5aacf2587bd51bddb393c0240ee63faf7f890b7093db222\n\n```\n\nContent of `run.bat`\nIn this case the pastebin contains two lines (the second line is splitted for better readability)\n\ncontent of pastebin\n\n### The miner\n\nThe miner is saved as `IECache.exe or` `ctfmon.exe .`\n\nThe first miner (from June, 2018) is just XMRig that includes all command line options\ninside the binary.\n\n\n-----\n\nMost of the miners of this type I found are packed with `VMProtect` or\n```\nThemida/Winlicense .\n\n```\nThe more interesting one (from Jun-Jul 2018) is a compiled AutoIT script packed with\n```\nVMProtect . Here again, we see that author speaks Slovak:\n\n```\n\n-----\n\nThis script contains the XMRig as (in some cases LZMA compressed) Base64 encoded\nstring inside a variable. The miner is decoded and started in memory.\n```\nODBASUJ64A is “decode base64” and ODLZMUJA is “LZMA decompress”.\n\n```\nIn some versions, the script checks user activity and it starts different miners with different\noptions to maximize profit with lower risk of being caught.\n\n\n-----\n\n_PUSTITAM is executes an binary in memory\n[Newer samples (Since August, 2018) use sRDI or XOR encryption in memory and injection](https://github.com/monoxgas/sRDI)\nto a suspended process to hide from antivirus software.\n\n### Interesting files\n\n**Sourceforge and Github**\n\nSome of the samples used Sourceforge and Github to download malicious content, instead\nof small, possibly hacked websites.\n\nIt downloaded content from a repository WEB of user W33v3ly on Github and from user\nDieworld on Sourceforge. On Github, the attacker once made a mistake and pushed\n```\nSystemcall.exe and TestDLL.bin to the wrong repository.\n\n```\n\n-----\n\n**Systemcall.exe hash:**\n```\ne9d96c6de650ada54b3788187132f525094ff7266b87c98d3dd1398c2d5c41a\n\n```\n**TestDLL.bin hash:**\n\n```\n1d2eda5525725f919cb4ef4412272f059abf4b6f25de5dc3b0fca4ce6ef5dd8e\n\n```\n\nThe `Systemcall.exe is a PE file without “MZ” in the beginning and` `Test.dll contains`\nsome random bytes before the PE file. The dll contains XMRig encrypted with TEA and the\n```\nSystemcall.exe uses sRDI to load and run the Test.dll.\n\n```\n\n-----\n\n**Steam Giver**\n\nThis small application written in .Net shows some hacked Steam accounts.\n\n\n-----\n\nThe malicious part downloads and installs the following scripts and downloads UnRAR and\n\n```\nbegin.rar\n\n```\n\n-----\n\n```\nInstall.vbs creates a task named WinD2 that starts inv.vbs upon every PC startup.\nInv.vbs starts runner.bat, which starts %temp%/Microsoft/NisSrve.exe that is\n\n```\nunpacked from `begin.rar with` `UnRAR.exe .`\n\n**Free bet tips**\n\nBetters are also targeted. We found a malicious file with the following readme file:\n\n\n-----\n\nThe binary included only starts a cmd with the script as an argument.\n\n## All from registry keys since 2018\n\nAfter 2018, I observed an updated version of the malware family. There is no need for any\nscript file if you can have a command as a scheduled task and save enough data into\nregistry keys.\n\nThe infection vector is the same as in the previous case. The victim downloads and runs an\nexecutable that downloads a powershell script from a hacked website whose URL is\nshortened with bit.ly. This time the script is different, it creates the following task:\n\nThis task reads the value of the registry key `Shell placed in` `HKLM\\Software\\a and`\nexecutes its content. The script also creates the Registry key.\n\nLet’s focus on the value of the registry key `Shell . In the following picture you will find the`\nvalue I found on an infected machine.\n\n\n-----\n\nAfter decoding and decompression we get an obfuscated script:\n\n\n-----\n\nUnder two layers of string formatting and replacing we get another compressed base64\nencoded script:\n\n\n-----\n\nInside the base64 string is malicious code that tests the connection and executes code\ndirectly from the internet.\n\n\n-----\n\nIn total, I found about 40 different values of the `Shell key in the wild that contain similar`\ncode with different URLs and they are obfuscated in the same way or less.\n\n\n-----\n\nSome of the pastebins were alive. For example, one of them contains the following scripts\nthat sends information about graphic cards to the C&C server, which can decide what to\ninstall on an infected computer. I have not found any C&C server alive.\n\n## Ransomware\n\nAnother final stage that runs from the registry keys is ransomware Athos.exe. At first it\nchecks some tactics from [https://blog.sevagas.com/IMG/pdf/BypassAVDynamics.pdf to](https://blog.sevagas.com/IMG/pdf/BypassAVDynamics.pdf)\ncheck if it runs in the sandbox. On the sixth start it injects ransomware into another process\nthat gets the id and encryption key from the web page `googleprovider[.]ru . Then it`\nencrypts all the files with AES-CFB and shows the following message saved on imgur\n( https://i.imgur[.]com/cKkSBSI.jpg ).\n\nTranslation: Your files are encrypted. If you want them back, you need your ID that you can\n\n\n-----\n\nfind in Athos_ID.txt on the desktop. Keep your ID secure, if you lose it, your files can t be\nrecovered!!! You can recover your files with the help of the website www.g…\nWe also found AutoIT ransomware King Ouroboros translated to Slovak. The malware was\nedited to use Windows users’ GUID as encryption key and to download additional content\nfrom a different server than the original King Ouroboros.\n\n**ransomware hash:**\n\n```\n90d99c4fe7f81533fb02cf0f1ff296cc1b2d88ea5c4c8567142bb455f435ee5b\n\n```\n\n## Conclusion\n\nMost of the methods described in this article are not new, in some cases I was able to find\ntheir source. The most interesting method is hiding the powershell script to the registry\nkeys.\n\nAs I found out, the author is a Slovak speaker, this corresponds with the fact that the\ninfected files were published only on Uloz.to, therefore the victims are only from the Czech\nRepublic and Slovakia.\n\nThe variation of the final payload is huge. I found three different RATs, a few different\npackers of coinminers and ransomware that were created by the author and many more\nthat were “available” on the internet. The initial installer, which function was to call only one\ncommand, was also created with a huge variety of tools, some of them quite obscure.\n\nTo protect against this type of threat, it is enough to download software only from\n[trustworthy sources and use security software, like Avast Antivirus, which will act as a](https://www.avast.com/index)\nsafety net in case you should come across a threat.\n\n## Indicators of Compromise (IoC)\n\nRepository: [https://github.com/avast/ioc/tree/master/Certishell](https://github.com/avast/ioc/tree/master/Certishell)\nList of SHA-256: [https://github.com/avast/ioc/blob/master/Certishell/samples.sha256](https://github.com/avast/ioc/blob/master/Certishell/samples.sha256)\nURI: [https://github.com/avast/ioc/blob/master/Certishell/network.txt](https://github.com/avast/ioc/blob/master/Certishell/network.txt)\n\n[Tagged asanalysis,](https://decoded.avast.io/tag/analysis/) [cryptomining,](https://decoded.avast.io/tag/cryptomining/) [malware](https://decoded.avast.io/tag/malware/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-21 - Warez users fell for Certishell.pdf"
    ],
    "report_names": [
        "2022-04-21 - Warez users fell for Certishell.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535603,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1653686924,
    "ts_modification_date": 1653686924,
    "files": {
        "pdf": "https://archive.orkl.eu/8496fd9cf2a65107de1e5504685e2055d45d8bb7.pdf",
        "text": "https://archive.orkl.eu/8496fd9cf2a65107de1e5504685e2055d45d8bb7.txt",
        "img": "https://archive.orkl.eu/8496fd9cf2a65107de1e5504685e2055d45d8bb7.jpg"
    }
}