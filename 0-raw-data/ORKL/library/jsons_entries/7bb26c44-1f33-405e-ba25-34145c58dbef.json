{
    "id": "7bb26c44-1f33-405e-ba25-34145c58dbef",
    "created_at": "2023-01-12T15:05:18.279817Z",
    "updated_at": "2025-03-27T02:16:28.751228Z",
    "deleted_at": null,
    "sha1_hash": "df5858175b8f1334e212053ae293363b720f7f0e",
    "title": "2017-12-08 - Interesting disguise employed by new Mac malware HiddenLotus",
    "authors": "",
    "file_creation_date": "2022-05-28T17:59:33Z",
    "file_modification_date": "2022-05-28T17:59:33Z",
    "file_size": 582022,
    "plain_text": "# Interesting disguise employed by new Mac malware HiddenLotus\n\n**[blog.malwarebytes.com/threat-analysis/2017/12/interesting-disguise-employed-by-new-mac-malware/](https://blog.malwarebytes.com/threat-analysis/2017/12/interesting-disguise-employed-by-new-mac-malware/)**\n\nThomas Reed December 8, 2017\n\nOn November 30, Apple silently added a signature to the macOS XProtect anti-malware\nsystem for something called OSX.HiddenLotus.A. It was a mystery what HiddenLotus was\nuntil, later that same day, Arnaud Abbati found the sample and shared it with other security\nresearchers on Twitter.\n\n\n-----\n\nThe HiddenLotus dropper is an application named Lê Thu Hà (HAEDC).pdf, using an old\ntrick of disguising itself as a document—in this case, an Adobe Acrobat file.\n\nThis is the same scheme that inspired the file quarantine feature in Mac OS X. Introduced in\nLeopard (Mac OS X 10.5), this feature tagged files downloaded from the Internet with a\nspecial piece of metadata to indicate that the file had been “quarantined.” Later, when the\nuser tried to open the file, if it was an executable file of any kind, such as an application, the\nsystem would display a warning to the user.\n\nThe intent behind this feature was to ensure that the user knew that the file they were\nopening was an application, rather than a document. Even back in 2009, malicious apps\nwere masquerading as documents. File quarantine was meant to combat this problem.\n\nMalware authors have been using this trick ever since, despite file quarantine. Even earlier\nthis year, repeated outbreaks of the Dok malware were distributed in the form of applications\ndisguised as Microsoft Word documents.\n\nSo HiddenLotus didn’t seem all that interesting at first, other than as a new variant of the\nOceanLotus backdoor first seen being used to attack numerous facets of Chinese\ninfrastructure. OceanLotus was last seen earlier this summer, disguised as a Microsoft Word\ndocument and targeting victims in Vietnam.\n\nBut there was something strange about HiddenLotus. Unlike past malware, this one didn’t\nhave a hidden .app extension to indicate that it was an application. Instead, it actually had a\n.pdf extension. Yet the Finder somehow identified it as an application anyway.\n\n\n-----\n\nThis was quite puzzling. Further investigation did not turn up a hidden extension. There was\nalso no sign of a trick like the one used by Janicab in 2013.\n\nJanicab used the old fake document technique, being distributed as a file named\n(apparently) “RecentNews.ppa.pdf.” However, the use of an RLO (right-to-left override)\ncharacter caused characters following it to be displayed as if they were part of a language\nmeant to be read right-to-left, instead of left-to-right as in English.\n\nIn other words, Janicab’s real filename was actually “RecentNews.fdp.app,” but the presence\nof the RLO character after the first period in the name caused everything following to be\ndisplayed in reverse in the Finder.\n\nHowever, this deception was not used in HiddenLotus. Instead, it turned out that the ‘d’ in the\n.pdf extension was not actually a ‘d.’ Instead, it was the Roman numeral ‘D’ in lowercase,\nrepresenting the number 500.\n\n\n-----\n\nIt was at this point that Abbati’s tweet referring to “its very nice small Roman Unicode” began\nto make sense. However, it was still unclear exactly what was going on, and how this special\ncharacter allowed the malware to be treated as an application.\n\nAfter further consultation with Abbati, it turned out that there’s something rather surprising\nabout macOS: An application does not need to have a .app extension to be treated like an\napplication.\n\nAn application on macOS is actually a folder with a special internal structure called a bundle.\nA folder with the right structure is still only a folder, but if you give it an .app extension, it\ninstantly becomes an application. The Finder treats it as if it were a single file instead of a\nfolder, and a double-click launches the application rather than opening the folder.\n\nWhen double-clicking a file (or folder), LaunchServices will consider the extension first. If the\nextension is known, the item will be opened according to that extension. Thus, a file with a\n.txt extension will, by default, be opened with TextEdit. Some folders may be treated as\ndocuments, as in the case of the .aplibrary extension used for an Aperture library “file.” A\nfolder with the .app extension will, assuming it has the right internal structure, be launched as\nan application.\n\nA file with an unfamiliar extension is handled by asking the user what they want to do.\nOptions are given to choose an application to open the file or to search the Mac App Store.\n\nHowever, something strange happens when double-clicking a folder with an unknown\nextension. In this case, LaunchServices falls back on looking at the folder’s bundle structure\n(if any).\n\n\n-----\n\nSo what does this mean? The HiddenLotus dropper is a folder with the proper internal\nbundle structure to be an application, and it uses an extension of .pdf, where the ‘d’ is a\nRoman numeral, not a letter. Although this extension looks exactly the same as the one used\nfor Adobe Acrobat files, it’s completely different, and there are no applications registered to\nhandle that extension. Thus, the system will fall back on the bundle structure, treating the\nfolder as an application, even though it does not have a telltale .app extension.\n\nThere is nothing particularly special about this .pdf extension (using a Roman numeral ‘d’)\nexcept that it is not already in use. Any other extension that is not in use will work just as\nwell:\n\nOf course, the example shown above wouldn’t fool anyone, it’s merely illustrative of the\nissue.\n\nThis means that there is an enormously large list of possible extensions, especially when\nUnicode characters are included. It is easily possible to construct extensions from Unicode\ncharacters that look exactly like other, normal extensions, yet are not the same. This means\nthe same trick could be used to mimic a Word document (.doc), an Excel file (.xls), a Pages\ndocument (.pages), a Numbers document (.numbers), and so on.\n\n\n-----\n\nThis is a neat trick, but it s still not going to get past file quarantine. The system will alert you\nthat what you’re trying to open is an application. Unless, of course, what you are opening\nwas downloaded via an application that does not use the APIs that properly set the\nquarantine flag on the file, as is the case for some torrent apps.\n\nUltimately, it’s very unlikely that this trick is going to have any kind of significant impact on the\nMac threat landscape. It’s probable that we will see it used again in the future, but the risk to\nthe average user is not significantly higher than in the case of any other fake document\nmalware.\n\nMore than anything else, this trick opens our eyes to an interesting aspect of how macOS\nidentifies and launches applications.\n\n[If you think you may have encountered this malware, Malwarebytes for Mac will protect](https://malwarebytes.com/mac)\nagainst it, and will scan for and remove it, if present, for free.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-12-08 - Interesting disguise employed by new Mac malware HiddenLotus.pdf"
    ],
    "report_names": [
        "2017-12-08 - Interesting disguise employed by new Mac malware HiddenLotus.pdf"
    ],
    "threat_actors": [
        {
            "id": "870f6f62-84f5-48ca-a18e-cf2902cd6924",
            "created_at": "2022-10-25T15:50:23.303818Z",
            "updated_at": "2025-03-27T02:00:55.435309Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "APT32",
                "SeaLotus",
                "OceanLotus",
                "APT-C-00",
                "Canvas Cyclone"
            ],
            "source_name": "MITRE:APT32",
            "tools": [
                "Mimikatz",
                "ipconfig",
                "Kerrdown",
                "Cobalt Strike",
                "SOUNDBITE",
                "OSX_OCEANLOTUS.D",
                "KOMPROGO",
                "netsh",
                "RotaJakiro",
                "PHOREAL",
                "Arp",
                "Denis",
                "Goopy"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "af509bbb-8d18-4903-a9bd-9e94099c6b30",
            "created_at": "2023-01-06T13:46:38.585525Z",
            "updated_at": "2025-03-27T02:00:02.866727Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "TIN WOODLAWN",
                "OceanLotus Group",
                "OceanLotus",
                "Sea Lotus",
                "G0050",
                "Cobalt Kitty",
                "SeaLotus",
                "ATK17",
                "Ocean Lotus",
                "Ocean Buffalo",
                "POND LOACH",
                "Canvas Cyclone",
                "APT-C-00",
                "APT-32",
                "APT 32"
            ],
            "source_name": "MISPGALAXY:APT32",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f1518ac1-4710-4dd1-a422-e3801e4806cb",
            "created_at": "2024-05-01T02:03:08.147856Z",
            "updated_at": "2025-03-27T02:05:17.421275Z",
            "deleted_at": null,
            "main_name": "TIN WOODLAWN",
            "aliases": [
                "Cobalt Kitty",
                "OceanLotus",
                "WOODLAWN ",
                "APT32 "
            ],
            "source_name": "Secureworks:TIN WOODLAWN",
            "tools": [
                " Denis",
                " Goopy",
                " JEShell",
                " KerrDown",
                " Mimikatz",
                " Ratsnif",
                " Remy",
                " Rizzo",
                " RolandRAT",
                "Cobalt Strike"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2439ad53-39cc-4fff-8fdf-4028d65803c0",
            "created_at": "2022-10-25T16:07:23.353204Z",
            "updated_at": "2025-03-27T02:02:09.749502Z",
            "deleted_at": null,
            "main_name": "APT 32",
            "aliases": [
                "APT 32",
                "APT-C-00",
                "APT-LY-100",
                "ATK 17",
                "Lotus Bane",
                "Ocean Buffalo",
                "OceanLotus",
                "Operation Cobalt Kitty",
                "Operation PhantomLance",
                "Pond Loach",
                "SeaLotus",
                "SectorF01",
                "Tin Woodlawn"
            ],
            "source_name": "ETDA:APT 32",
            "tools": [
                "Agentemis",
                "Android.Backdoor.736.origin",
                "AtNow",
                "Backdoor.MacOS.OCEANLOTUS.F",
                "BadCake",
                "CACTUSTORCH",
                "CamCapture Plugin",
                "CinaRAT",
                "Cobalt Strike",
                "CobaltStrike",
                "Cuegoe",
                "DKMC",
                "Denis",
                "Goopy",
                "HiddenLotus",
                "KOMPROGO",
                "KerrDown",
                "METALJACK",
                "MSFvenom",
                "Mimikatz",
                "Nishang",
                "OSX_OCEANLOTUS.D",
                "OceanLotus",
                "PHOREAL",
                "PWNDROID1",
                "PhantomLance",
                "PowerSploit",
                "Quasar RAT",
                "QuasarRAT",
                "RatSnif",
                "Remy",
                "Remy RAT",
                "Rizzo",
                "Roland",
                "Roland RAT",
                "SOUNDBITE",
                "Salgorea",
                "Splinter RAT",
                "Terracotta VPN",
                "Yggdrasil",
                "cobeacon",
                "denesRAT",
                "fingerprintjs2"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535918,
    "ts_updated_at": 1743041788,
    "ts_creation_date": 1653760773,
    "ts_modification_date": 1653760773,
    "files": {
        "pdf": "https://archive.orkl.eu/df5858175b8f1334e212053ae293363b720f7f0e.pdf",
        "text": "https://archive.orkl.eu/df5858175b8f1334e212053ae293363b720f7f0e.txt",
        "img": "https://archive.orkl.eu/df5858175b8f1334e212053ae293363b720f7f0e.jpg"
    }
}