{
    "id": "b009a399-1911-45e4-b954-8574f0643c03",
    "created_at": "2023-01-12T15:01:43.21672Z",
    "updated_at": "2025-03-27T02:05:37.881676Z",
    "deleted_at": null,
    "sha1_hash": "9ef254e0c8267aa19169c4715b4e6adb7acdf302",
    "title": "2019-05-13 - A Look At Hworm - Houdini aka Njrat",
    "authors": "",
    "file_creation_date": "2022-05-28T17:09:18Z",
    "file_modification_date": "2022-05-28T17:09:18Z",
    "file_size": 1456656,
    "plain_text": "# A look at Hworm / Houdini AKA njRAT\n\n**blog.morphisec.com/hworm-houdini-aka-njrat**\n\n[Tweet](https://twitter.com/share)\n\nHworm/njRAT is a Remote Access Tool (RAT) that first appeared in 2013 in targeted attacks against the international energy\nindustry, primarily in the Middle East. It was soon commoditized and is now part of a constantly evolving family of RATs that\n[pop-up in various new formats. Today we see this attack employed on a regular basis as part of widespread spam phishing](https://unit42.paloaltonetworks.com/unit42-houdinis-magic-reappearance/)\ncampaigns - if successful, Hworm gives the attacker complete control of the victim’s system. Morphisec Labs recently\nobserved a new version with a minor modification to its obfuscation technique.\n\n## Technical Description:\n\nThe attack uses the kind of fileless VBScript injector, leveraging DynamicWrapperX, that has been seen used in the wild by\nRATs such as HWorm, DarkComet, KilerRAT and others. We observed a new obfuscation level, as the distribution of this\nRAT is still changing and running. We will describe the injector stage and how it used to load Hworm/Houdini RAT.\n\n### Stage 1\n\nThe payload is a VBS file, which, in some cases, comes obfuscated or encoded with couple of layers.\n\n\n-----\n\n**_Figure 1: Obfuscated VBScript_**\n\nThe next stage VBS file contains 3 chunks of base64 streams:\n\n**_[DCOM_DATA: Holds a PE file, which is DynamicWrapperX. It allows to call functions exported by DLL libraries, in particular](http://www.script-coding.com/dynwrapx_eng.html)_**\nWindows API functions, from JScript and VBScript.\n\n**_LOADER_DATA: Holds RunPE shellcode._**\n\n**_FILE_DATA: Holds the shellcode that is injected to the host process. This will be discussed later._**\n\nAs the script executes, it drops a copy of itself into %appdata%\\Microsoft and gains persistence by editing the registry key:\n‘HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run’.\n\nThe script checks whether the current environment is 64bit or not. If it is, it will execute the script with a 32-bit version\nof wscript.exe (from SysWOW64).\n\n\n-----\n\n**_Figure 2 : Execute with 32-bit version of wsscript.exe_**\n\nIt determines the path for the host process that FILE_DATA will be injected into. There are two options – ‘wscript.exe’\nor ‘msbuild.exe’. In our samples, the flag that decided which path to use was hardcoded (set to True), thus, always\nchose msbuild.exe.\n\n\n-----\n\n**_hworm 3_**\n\n\n**_Figure 3 choose host process_**\n\n**_DCOM_DATA is decoded and dropped to %temp% directory under the name “HOUDINI.BIN” and registered with_**\nregsvr32.exe. It creates an object instance named “DynamicWrapperX” and registers two DLL functions:\n“CallWindowProcW” from “User32.dll” and “VirtualAlloc” from “Kernel32.dll”. It uses VirtualAlloc to allocate memory for\nthe RunPE shellcode and FILE_DATA shellcode, then, invokes it using CallWindowProcW.\n\n\n-----\n\n**_Figure 4 invoke injection procedure_**\n\n### Stage 2\n\nThe second stage is basically FILE_DATA which is injected to ‘msbuild.exe’ using LOADER_DATA (RunPE). FILE_DATA is\nbase64 encoded – trying to decode and look at it does not yield information, as there is another layer of encoding.\n\n**_Figure 5 FILE_DATA base64 decoded_**\n\n**_LOADER_DATA (RunPE shellcode) is responsible for the second decoding routine._**\n\n**_Figure 6 After LOADER_DATA decoding_**\n\n\n-----\n\nEventually, we see FILE_DATA is a portable executable, written in Dot Net. Looking at the decompiled source code we can\nsee Hworm (njRAT) configuration.\n\n**_Figure 7_**\n\n“svchost.exe” - Trojan exe.\n“AppData” - Installation path.\n“183d24d29354086f9c19c24368929a8c” - Mutex name.\n“chroms.linkpc.net” - C2 address.\n“11” - Port.\n“boolLove” - Socket key.\n\n## Conclusion\n\nMorphisec protects against Hworm and similar attacks. By applying Moving target defense technology, we deterministically\nprevent this attack without relation to signatures / patterns or obfuscation techniques.\n\n## Artifacts\n\n### Domain C2s:\n\nchroms[.]linkpc.net\nsalh[.]linkpc.net\nfinix5[.]hopto.org\nfinixalg11[.]ddns.net\n\n### VBScripts:\n\nb936e702d77f9ca588f37e5683fdfdf54b4460f9\n329bb19737387d050663cce2361799f2885960b2\na5e1c1c72a47f400b3eb69c24c5d2c06cc2e4e0f\n27cf0b9748936212390c685c88fa4cf1233ca521\nd5f352cba7be33b0993d5a59ff296fbd4b594a6e\n82eb7aeedc670405de56ea1fef984fe8294efcfd\n\n\n-----\n\nd91f060037aaa59a0ad4622c9f3bc5e86e4eb4cd\n\n[Contact SalesInquire via Azure](http://10.10.0.46/mailto:sales@morphisec.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-13 - A Look At Hworm - Houdini aka Njrat.pdf"
    ],
    "report_names": [
        "2019-05-13 - A Look At Hworm - Houdini aka Njrat.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535703,
    "ts_updated_at": 1743041137,
    "ts_creation_date": 1653757758,
    "ts_modification_date": 1653757758,
    "files": {
        "pdf": "https://archive.orkl.eu/9ef254e0c8267aa19169c4715b4e6adb7acdf302.pdf",
        "text": "https://archive.orkl.eu/9ef254e0c8267aa19169c4715b4e6adb7acdf302.txt",
        "img": "https://archive.orkl.eu/9ef254e0c8267aa19169c4715b4e6adb7acdf302.jpg"
    }
}