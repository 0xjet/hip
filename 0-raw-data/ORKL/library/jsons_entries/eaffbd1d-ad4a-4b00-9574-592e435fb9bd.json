{
    "id": "eaffbd1d-ad4a-4b00-9574-592e435fb9bd",
    "created_at": "2023-01-12T15:00:42.186044Z",
    "updated_at": "2025-03-27T02:09:18.208126Z",
    "deleted_at": null,
    "sha1_hash": "b5fa37bf21ce99c49a99c2011590b6a8c224d617",
    "title": "2022-03-25 - Mining data from Cobalt Strike beacons",
    "authors": "",
    "file_creation_date": "2022-05-28T02:47:24Z",
    "file_modification_date": "2022-05-28T02:47:24Z",
    "file_size": 1210754,
    "plain_text": "# Mining data from Cobalt Strike beacons\n\n**[research.nccgroup.com/2022/03/25/mining-data-from-cobalt-strike-beacons/](https://research.nccgroup.com/2022/03/25/mining-data-from-cobalt-strike-beacons/)**\n\nMarch 25, 2022\n\n[Since we published about identifying Cobalt Strike Team Servers in the wild just over three](http://blog.fox-it.com/2019/02/26/identifying-cobalt-strike-team-servers-in-the-wild/)\nyears ago, we‚Äôve collected over 128,000 beacons from over 24,000 active Team Servers.\nToday, RIFT is making this extensive beacon dataset publicly available in combination with\nthe open-source release of `dissect.cobaltstrike, our Python library for studying and`\nparsing Cobalt Strike related data.\n\nThe published dataset contains historical beacon metadata ranging from 2018 to 2022. This\nblog will highlight some interesting findings you can extract and query from this extensive\ndataset. We encourage other researchers also to explore the dataset and share exciting\nresults with the community.\n\n**Cobalt Strike Beacon dataset**\n\nThe dataset `beacons.jsonl.gz is a GZIP compressed file containing 128,340 rows of`\nbeacon metadata as JSON-lines. You can download it from the following repository and\nmake sure to also check out the accompanying Jupyter notebook:\n\n[https://github.com/fox-it/cobaltstrike-beacon-data](https://github.com/fox-it/cobaltstrike-beacon-data)\n\nThe dataset spans almost four years of historical Cobalt Strike beacon metadata from July\n2018 until February 2022. Unfortunately, we lost five months‚Äô worth of data in 2019 due to\narchiving issues. In addition, the dataset mainly focuses on x86 beacons collected from\n\n\n-----\n\nactive Team Servers on HTTP port 80, 443 and DNS; therefore, it does not contain any\nbeacons from other sources, such as VirusTotal.\n\nThe beacon payloads themselves are not in the dataset due to the size. Instead, the different\nbeacon configuration settings are stored, including other metadata such as:\n\nDate the beacon was collected and from which IP address and port\nGeoIP + ASN metadata\nTLS certificate in DER format\nPE information (timestamps, magic_mz, magic_pe, stage_prepend, stage_append)\nIf the payload was XOR encoded, and which XOR key was used for config obfuscation\nThe raw beacon configuration bytes; handy if you want to parse the beacon config\nmanually. (e.g. using `dissect.cobaltstrike or another parser of choice)`\n\nWhile there are some trivial methods to identify cracked/pirated Cobalt Strike Team Servers\nfrom the beacon payload, it‚Äôs difficult to tell for the non-trivial ones. Therefore the dataset is\nunfiltered, full disclosure and contains all beacons we have collected.\n\nCobalt Strike Team Servers that are properly hidden or have payload staging disabled are, of\ncourse, not included. That means Red Teams (and sadly threat actors) with good OPSEC\nhave nothing to worry about being present in this dataset. üôÇ\n\n**Beacons, and where to find them**\n\nThe Cobalt Strike beacons were acquired by first identifying Team Servers on the Internet\nand then downloading the beacon using a `checksum8 HTTP request. This method is`\nsimilar to how the company behind Cobalt Strike did their own Cobalt Strike Team Server\nPopulation Study back in 2019.\n\n[Although the anomalous space fingerprint we used for identification was since fixed, we](https://gist.github.com/fox-srt/6761b07f6fe7b8648de2debe5491c044#file-cobaltstrike-extraspace-rules)\nfound other reliable methods for identifying Team Servers. In addition, we are sure that the\noriginal author of Cobalt Strike intentionally left some indicators in there to help blue teams.\nFor that, we are grateful and hope this doesn‚Äôt change in the future.\n\nVia our honeypots, we can tell that RIFT is not alone in mining beacons. Everyone is doing it\nnow. The increased blog posts and example scripts on how to find Cobalt Strike probably\nattribute to this, next to the increased popularity of Cobalt Strike itself, of course.\n\nThe development of increased scanning for Cobalt Strike is fascinating to witness, including\nthe different techniques and shotgun approaches for identifying Team Servers and retrieving\nbeacons. Some even skip the identification part and go directly for the beacon request! As\nyou can imagine, this can be noisy, which surely doesn‚Äôt go unnoticed for some threat actors.\n\n\n-----\n\nIf you run a public-facing web server, you can easily verify this increased scanning by\nchecking the HTTP access logs for common `checksum8 like requests, for example, by`\nusing the following grep command:\n```\n$ zgrep -hE \"GET /[a-zA-Z0-9]{4} HTTP\" /var/log/nginx/*.gz\n172.x.x.x - - [23/Feb/2021:18:xx:08 +0100] \"GET /0bef HTTP/1.0‚Äù 404 162 \"-\" \"-\"\n172.x.x.x - - [24/Feb/2021:09:xx:40 +0100] \"GET /0bef HTTP/1.0‚Äù 404 162 \"-\" \"-\"\n139.x.x.x - - [25/Feb/2021:05:xx:39 +0100] \"GET /bag2 HTTP/1.1‚Äù 404 193 \"-\" \"-\"\n134.x.x.x - - [25/Feb/2021:15:xx:12 +0100] \"GET /ab2g HTTP/1.1‚Äù 400 166 \"-\" \"-\"\n134.x.x.x - - [25/Feb/2021:15:xx:22 +0100] \"GET /ab2h HTTP/1.1‚Äù 400 166 \"-\" \"-\"\n\n```\nThe requests shown above are `checksum8 requests (for x86 and x64 beacons), hitting a`\nnormal webserver hosting a real website in February 2021.\n\nYou can also use our `checksum8-accesslogs.py script, which does all these things in one`\nscript and more accurately by verifying the `checksum8 value. It can also output statistics.`\nHere is an example of outputting the x86 and x64 beacon HTTP requests hitting one of our\nhoneypots and generating the statistics:\n\nchecksum8-accesslog.py script finds possible Beacon stager requests in access logs\nIn the output, you can also see the different beacon scanning techniques being used, which\nwe will leave as an exercise for the reader to figure out.\n\nWe can see an apparent increase in beacon scanning on one of our honeypots by plotting\nthe statistics:\n\nSo if you ever wondered why people are requesting these weird four-character URLs (or\nother strange-looking URLs) on your web server, check the `checksum8 value of the`\nrequest, and you might have your answer.\n\n\n-----\n\nWe try to be a bit stealthier and won t disclose our fingerprinting techniques, as we also know\nthreat actors are vigilant and, in the long run, will make it harder for everyone dealing with\nThreat Intelligence.\n\n**Cobalt Strike version usage over time**\n\nBecause we have beacon metadata over multiple years, we can paint a pretty good picture\nof active Cobalt Strike servers on the Internet and which versions they were using at that\ntime.\n\nTo extract the Cobalt Strike version data, we used the following two methods:\n\nUsing the Beacon Setting constants\n\nWhen a new Cobalt Strike beacon configuration setting is introduced, the Setting\nconstant is increased and then assigned. It‚Äôs possible to deduce the version\nbased on the highest available constant in the extracted beacon configuration.\nUsing the PE export timestamp\n\nThis is also documented by BlackBerry in their Finding Beacons In the Dark: A\nGuide to Cyber Threat Intelligence book and is a more accurate way of\ndetermining the exact version.\n\nOur Python library `dissect.cobaltstrike supports both methods for deducing version`\nnumbers and favours the PE export timestamp when available.\n\nThe dataset already contains the `beacon_version field for your convenience and is based`\non the PE export timestamp. Using this field, we can generate the following graph showing\nthe different Cobalt Strike versions used on the Internet over time:\n\nWe can see that in April 2021, there was quite a prominent peak of online Cobalt Strike\nservers and unique beacons, but we are not sure what caused this except that there was a\n3% increase of modified (likely malicious) beacons that month.\n\nThe following percentage-wise graph shows a clearer picture of the adoption and popularity\nbetween the different versions over time:\n\nWe can see that Cobalt Strike 4.0 (released in December 2019) remained quite popular from\nJanuary 2020 to January 2021.\n\n**Beacon watermark statistics**\n\nSince Cobalt Strike 3.10 (released December 2017), the beacons contain a setting called\n```\nSETTING_WATERMARK . This watermark value should be unique per Cobalt Strike installation,\n\n```\nas the license server issues this.\n\n\n-----\n\nHowever, cracked/pirated versions usually patch this to a fixed value, making it easy to\nidentify which beacons are more likely to be malicious (i.e. not a penetration tester). This\nlikelihood aligns with our incident response engagements so far, where beacons related to\nthe compromise used known-bad watermarks.\n\nNote that requesting a trial or buying a legitimate copy of Cobalt Strike is difficult for\n[malicious actors as every user is vetted and screened. Because of these measures, there is](https://www.cobaltstrike.com/blog/that-time-a-printer-tried-to-get-cobalt-strike/)\na high asking price for a Cobalt Strike copy on the dark web. For example, Conti invested\n$60.000 to acquire a valid copy of Cobalt Strike.\n\nIf you find a beacon with a watermark in this top 50, then it‚Äôs most likely malicious!\n\n**Customized Beacons**\n\nWhile parsing collected beacons, we found that some were modified, for example, with a\ncustom shellcode stub, non-default XOR keys or reassigned Beacon settings.\n\nTherefore, the beacons with heavy customizations could not be dumped properly and are not\nincluded in the dataset.\n\nThe configuration block in the beacon payload is usually obfuscated using a single byte XOR\nkey. Depending on the Cobalt Strike version, the default keys are 0x2e or 0x69.\n\nThe use of non-default XOR keys requires the user to modify the beacon and or Team\nServer, as it‚Äôs not configurable by default. Here is an overview of seen XOR keys over the\nunique beacon dataset:\n\nUsing a custom XOR key makes you an outlier though, but it does protect you against some\nexisting Cobalt Strike config dumpers. Our Python library `dissect.cobaltstrike supports`\ntrying all XOR keys when the default XOR keys don‚Äôt work. For example, you can pass the\ncommand line flag `--all-xor-keys to the` `beacon-dump command.`\n\n**Portable Executable artifacts**\n\nWhile most existing Cobalt Strike dumpers focus on the beacon settings, some settings from\nthe Malleable C2 profiles will not end up in the embedded beacon config of the payload. For\nexample, some Portable Executable (PE) settings in the Malleable C2 profile are applied\ndirectly to the beacon payload. Our Python library `dissect.cobaltstrike supports`\nextracting this information, and our dataset includes the following extracted PE header\nmetadata:\n\nmagic_mz ‚Äî MZ header\nmagic_pe ‚Äî PE header\npe_compile_stamp ‚Äî PE compilation stamp\npe_export_stamp ‚Äî timestamp of the export section\n\n\n-----\n\nstage_prepend ‚Äì (shellcode) bytes prepended to the start of the beacon payload\nstage_append ‚Äî bytes appended to the end of the beacon payload\n\nWe created an overview of the most common `stage_prepend bytes that are all ASCII`\nbytes. These bytes are prepended in front of the MZ header, and has to be valid assembly\ncode but resulting in a no-operation as it‚Äôs executed as shellcode. Some are quite creative:\n\nIf we disassemble the example stage_prepend shellcode `JFIFJFIF we can see that it`\nincreases the ESI and decreases the EDX registers and leaves it modified as a result; so it‚Äôs\nnot fully a no-operation shellcode but it most likely doesn‚Äôt affect the staging process either.\n```\n$ echo -n JFIFJFIF | ndisasm -b 32 /dev/stdin\n00000000 4A        dec edx\n00000001 46        inc esi\n00000002 49        dec ecx\n00000003 46        inc esi\n00000004 4A        dec edx\n00000005 46        inc esi\n00000006 49        dec ecx\n00000007 46        inc esi\n\n```\n[You can check our Jupyter notebook for an overview on the rest of the PE artifacts, such as](https://github.com/fox-it/cobaltstrike-beacon-data/blob/master/notebook.ipynb)\n```\nmagic_mz and magic_pe .\n\n```\n**Watermarked releasenotes.txt using whitespace**\n\nThe author of Cobalt Strike must really like spaces, after the erroneous space in the HTTP\nserver header, there is now also a (repurposed) beacon setting called `SETTING_SPAWNTO`\nthat is now populated with the MD5 hash of the file `releasenotes.txt (or accidentally`\nanother file in the same directory if that matches the same `checksum8 value of 152 and`\nfilename length!).\n\nThe `releasenotes.txt is automatically downloaded from the license server when you`\nactivate or update your Cobalt Strike server. To our surprise, we discovered that this file is\nmost likely watermarked using whitespace characters thus making this file and MD5 hash\nunique per installation. The license server probably keeps track of all these uniquely\ngenerated files to help combat piracy and leaks of Cobalt Strike.\n\nWhile this is pretty clever, we found that in some pirated beacons this field is all zeroes, or\nnot available. Meaning they knew about this file and decided not to ship it in the pirated\nversion or the field value was patched out. Nevertheless, this field is still useful for hunting or\ncorrelating beacons when it is available.\n\n\n-----\n\nNote the subtle whitespace changes at the end of the lines between the two releasenotes.txt\nfiles.\n**Analyze Beacon payloads with dissect.cobaltstrike**\n\nWe are also proud to open-source our Python library for dissecting Cobalt Strike, aptly\nnamed `dissect.cobaltstrike . The library is available on PyPI and requires Python 3.6`\nor higher. You can use pip to install it:\n```\n$ pip install dissect.cobaltstrike\n\n```\nThe project‚Äôs GitHub repository: [https://github.com/fox-it/dissect.cobaltstrike](https://github.com/fox-it/dissect.cobaltstrike)\n\nIt currently installs three command line tools for your convenience:\n```\n   beacon-dump ‚Äì used for dumping configuration from beacon payloads (also works on\n\n```\nmemory dumps)\n```\n   beacon-xordecode ‚Äì a standalone tool for decoding xorencoded payloads\n   c2profile-dump ‚Äì use this to read and parse Malleable C2 profiles.\n\n```\nA neat feature of `beacon-dump is to dump the beacon configuration back as it‚Äôs Malleable`\nC2 profile compatible equivalent:\n\n\n-----\n\nDumping beacons settings as a Malleable C2 Profile\nWhile these command line tools provide most of the boilerplate for working with Beacon\npayloads, you can also import the library in a script or notebook for more advanced use\n[cases. See our notebook and](https://github.com/fox-it/cobaltstrike-beacon-data/blob/master/notebook.ipynb) [documentation for some examples.](https://dissect-cobaltstrike.readthedocs.io/)\n\n**Closing thoughts**\n\nThe beacon dataset has proved very useful to us, especially the historical aspect of the\ndataset is insightful during incident response engagements. We use the dataset daily,\nranging from C2 infrastructure mapping, actor tracking, threat hunting, high-quality indicators,\ndetection engineering and many more.\n\nWe hope this dataset and Python library will be helpful to the community as it is for us and\nare eager to see what kind of exciting things people will come up with or find using the data\nand tooling. What we have shown in this blog is only the tip of the iceberg of what you can\nuncover from beacon data.\n\nSome ideas for the readers:\n\nCluster beacon and C2 profile features using a clustering algorithm such as DBSCAN.\nImprove the classification of malicious beacons. You can find the current classification\n[method in our notebook.](https://github.com/fox-it/cobaltstrike-beacon-data/blob/master/notebook.ipynb)\nUse the GeoIP ASN data to determine where the most malicious beacons are hosted.\nAnalysis on the x509 certificate data, such as self-signed or not.\nDetermine if a beacon uses domain fronting and which CDN.\n\nAll the statistics shown in this blog post can also be found in our accompanying Jupyter\nnotebook including some more statistics and overviews not shown in this blog.\n\n\n-----\n\n[We also want to thank Rapid7 for the Open Data sets, without this data the beacon dataset](https://opendata.rapid7.com/)\nwould be far less complete!\n\nFinal links for convenience:\n\n[Beacon dataset and notebook ‚Äì https://github.com/fox-it/cobaltstrike-beacon-data](https://github.com/fox-it/cobaltstrike-beacon-data)\n\n`dissect.cobaltstrike Python library ‚Äì` [https://github.com/fox-it/dissect.cobaltstrike](https://github.com/fox-it/dissect.cobaltstrike)\n```\n   dissect.cobaltstrike Documentation ‚Äì https://dissect-cobaltstrike.readthedocs.io\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-25 - Mining data from Cobalt Strike beacons.pdf"
    ],
    "report_names": [
        "2022-03-25 - Mining data from Cobalt Strike beacons.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535642,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653706044,
    "ts_modification_date": 1653706044,
    "files": {
        "pdf": "https://archive.orkl.eu/b5fa37bf21ce99c49a99c2011590b6a8c224d617.pdf",
        "text": "https://archive.orkl.eu/b5fa37bf21ce99c49a99c2011590b6a8c224d617.txt",
        "img": "https://archive.orkl.eu/b5fa37bf21ce99c49a99c2011590b6a8c224d617.jpg"
    }
}