{
    "id": "06ff37b7-d2b9-4d55-a03a-8304d54e3b3b",
    "created_at": "2023-01-12T15:10:17.346636Z",
    "updated_at": "2025-03-27T02:05:22.779613Z",
    "deleted_at": null,
    "sha1_hash": "c2fbe57698ae0971e803191118da09451479f945",
    "title": "2020-12-13 - Customer Guidance on Recent Nation-State Cyber Attacks",
    "authors": "",
    "file_creation_date": "2022-05-27T22:22:58Z",
    "file_modification_date": "2022-05-27T22:22:58Z",
    "file_size": 138263,
    "plain_text": "# Customer Guidance on Recent Nation-State Cyber Attacks\n\n**[msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/](https://msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/)**\n\n_Note: we are updating as the investigation continues. Revision history listed at the bottom._\n\nThis post contains technical details about the methods of the actor we believe was involved in Recent NationState Cyber Attacks, with the goal to enable the broader security community to hunt for activity in their networks\nand contribute to a shared defense against this sophisticated threat actor. Please see the\n**Microsoft Product Protections and Resources section for additional investigative updates, guidance,**\n**and released protections.**\n\nAs we wrote in that blog, while these elements aren’t present in every attack, this is a summary of techniques\nthat are part of the toolkit of this actor.\n\nAn intrusion through malicious code in the SolarWinds Orion product. This results in the attacker gaining a\nfoothold in the network, which the attacker can use to gain elevated credentials. Microsoft Defender now\n[has detections for these files. Also, see SolarWinds Security Advisory.](https://www.solarwinds.com/securityadvisory)\nOnce in the network, the intruder then uses the administrative permissions acquired through the onpremises compromise to gain access to the organization’s global administrator account and/or\ntrusted SAML token signing certificate. This enables the actor to forge SAML tokens that impersonate any\nof the organization’s existing users and accounts, including highly privileged accounts.\nAnomalous logins using the SAML tokens created by the compromised token signing certificate can then\nbe made against any on-premises resources (regardless of identity system or vendor) as well\nas to any cloud environment (regardless of vendor) because they have been configured to trust the\ncertificate. Because the SAML tokens are signed with their own trusted certificate, the anomalies might be\nmissed by the organization.\nUsing the global administrator account and/or the trusted certificate to impersonate highly privileged\naccounts, the actor may add their own credentials to existing applications or service principals, enabling\nthem to call APIs with the permission assigned to that application.\n\nDue to the critical nature of this activity, Microsoft is sharing the following information to help detect, protect, and\nrespond to this threat.\n\n## Activity Description\n\n### Initial Access\n\nAlthough we do not know how the backdoor code made it into the library, from the recent campaigns, research\nindicates that the attackers might have compromised internal build or distribution systems of SolarWinds,\nembedding backdoor code into a legitimate SolarWinds library with the file name\n```\nSolarWinds.Orion.Core.BusinessLayer.dll . This backdoor can be distributed via automatic update\n\n```\nplatforms or systems in target networks. Microsoft security researchers currently have limited information about\nhow the attackers compromised these platforms.\n\n### Execution\n\nWhile updating the SolarWinds application, the embedded backdoor code loads before the legitimate code\nexecutes. Organizations are misled into believing that no malicious activity has occurred and that the program or\napplication dependent on the libraries is behaving as expected.\n\n\n-----\n\nThe attackers have compromised signed libraries that used the target companies own digital certificates,\nattempting to evade application control technologies. Microsoft already removed these certificates from its\ntrusted list. The certificate details with the signer hash are shown below:\n\nThe DLL then loads from the installation folder of the SolarWinds application. Afterwards, the main implant\ninstalls as a Windows service and as a DLL file in the following path using afolder with different names:\n\nSolarWinds Orion installation folder, for example,\n```\n   %PROGRAMFILES%\\SolarWinds\\Orion\\SolarWinds.Orion.Core.BusinessLayer.dll\n\n```\nThe .NET Assembly cache folder (when compiled)\n```\n   %WINDIR%\\System32\\config\\systemprofile\\AppData\\Local\\assembly\\tmp\\\n   <VARIES>\\SolarWinds.Orion.Core.BusinessLayer.dll\n\n```\nMicrosoft security researchers observed malicious code from the attacker activated only when running under\n```\nSolarWinds.BusinessLayerHost.exe process context for the DLL samples currently analyzed.\n\n### Command-and-control (C2)\n\n```\nThe malicious DLL calls out to a remote network infrastructure using the domains avsvmcloud.com. to prepare\npossible second-stage payloads, move laterally in the organization, and compromise or exfiltrate data.\n\nMicrosoft detects the main implant and its other components as Solorigate.\n\n### Actions on Objectives\n\nIn actions observed at the Microsoft cloud, attackers have either gained administrative access using\ncompromised privileged account credentials (e.g. stolen passwords) or by forging SAML tokens using\ncompromised SAML token signing certificates.\n\nIn cases where we see SAML token signing certificate compromise, there are cases where the specific\nmechanism by which the actor gains access to the certificate has not been determined. In the cases we have\ndetermined that the SAML token signing certificate was compromised, common tools were used to access the\ndatabase that supports the SAML federation server using administrative access and remote execution\ncapabilities.\n\nIn other cases, service account credentials had been granted administrative privileges; and in others,\nadministrative accounts may have been compromised by unrelated mechanisms. Typically, the certificate is\nstored on the server that provides the SAML federation capabilities; this makes it accessible to anyone with\nadministrative rights on that server, either from storage or by reading memory.\n\nOnce the certificate has been acquired, the actor can forge SAML tokens with whatever claims and lifetime they\nchoose, then sign it with the certificate that has been acquired. By doing this, they can access any resources\nconfigured to trust tokens signed with that SAML token signing certificate. This includes forging a token which\nclaims to represent a highly privileged account in Azure AD.\n\nAs with on premises accounts, the actor may also gain administrative Azure AD privileges with compromised\ncredentials. This is particularly likely if the account in question is not protected by multi-factor authentication.\n\nRegardless of whether the actor minted SAML tokens or gained access to Azure AD through other means,\nspecific malicious activities have been observed using these administrative privileges to include long term\naccess and data access as described below.\n\n### Long Term Access\n\n\n-----\n\nHaving gained a significant foothold in the on premises environment, the actor has made modifications to Azure\nActive Directory settings to facilitate long term access.\n\n1. Federation Trusts\n\n[Microsoft has observed the actor adding new federation trusts to an existing tenant or modifying the](https://docs.microsoft.com/office365/troubleshoot/active-directory/update-federated-domain-office-365)\nproperties of an existing federation trust to accept tokens signed with actor-owned certificates.\n2. OAuth Application & Service Principal Credentials\n\nThe actor has been observed adding credentials (x509 keys or password credentials) to one or more\nlegitimate OAuth Applications or Service Principals, usually with existing Mail.Read or\n_Mail.ReadWrite permissions, which grants the ability to read mail content from Exchange Online via_\nMicrosoft Graph or Outlook REST. Examples include mail archiving applications. Permissions are\nusually, but not always, AppOnly.\nThe actor may use their administrator privileges to grant additional permissions to the target\nApplication or Service Principal (e.g. Mail.Read, Mail.ReadWrite).\n\n### Data Access\n\nData access has relied on leveraging minted SAML tokens to access user files/email or impersonating the\nApplications or Service Principals by authenticating and obtaining Access Tokens using credentials that were\nadded in 2a. Above. The actor periodically connects from a server at a VPS provider to access specific users’\nemails using the permissions granted to the impersonated Application or Service Principal. In many cases, the\ntargeted users are key IT and security personnel. By impersonating existing applications that use permissions\nlike Mail.Read to call the same APIs leveraged by the actor, the access is hidden amongst normal traffic. For this\nreason, if you suspect you are impacted you should assume your communications are accessible to the actor.\n\n## Recommended Defenses\n\nIf your organization has not been attacked or compromised by this actor, Microsoft recommends you consider\nthe following actions to protect against the techniques described above as part of your overall response. This is\nnot an exhaustive list, and Microsoft may choose to update this list as new mitigations are determined:\n\n1. Run up to date antivirus or EDR products that detect compromised SolarWinds libraries and potentially\n\nanomalous process behaviour by these binaries. Consider disabling SolarWinds in your environment\nentirely until you are confident that you have a trustworthy build free of injected code. For more details\n[consult SolarWinds’ Security Advisory.](https://www.solarwinds.com/securityadvisory)\n2. Block known C2 endpoints listed below in IOCs using your network infrastructure.\n3. Follow the best practices of your identity federation technology provider in securing your SAML token\n\nsigning keys. Consider hardware security for your SAML token signing certificates if your identity\nfederation technology provider supports it. Consult your identity federation technology provider for\nspecifics. For Active Directory Federation Services, review Microsoft’s recommendations here: Best\nPractices for Securing ADFS\n4. Ensure that user accounts with administrative rights follow best practices, including use of privileged\n\naccess workstations, JIT/JEA, and strong authentication. Reduce the number of users that are members of\nhighly privileged Directory Roles, like Global Administrator, Application Administrator, and Cloud\nApplication Administrator.\n5. Ensure that service accounts and service principals with administrative rights use high entropy secrets, like\n\ncertificates, stored securely. Monitor for changes to secrets used for service accounts and service\nprincipals as part of your security monitoring program. Monitor for anomalous use of service accounts.\n[Monitor your sign ins . Microsoft Azure AD indicates session anomalies, as does Microsoft Cloud App](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-all-sign-ins)\nSecurity if in use.\n\n\n-----\n\n6. Reduce surface area by removing/disabling unused or unnecessary applications and service principals.\n\nReduce permissions on active applications and service principals, especially application (AppOnly)\npermissions.\n7. See [Secure your Azure AD identity infrastructure for more recommendations.](https://docs.microsoft.com/azure/security/fundamentals/steps-secure-identity)\n\n### Microsoft Product Protections and Resources\n\nIf you believe your organization has been compromised, we recommend that you comprehensively audit your on\npremises and cloud infrastructure to include configuration, per-user and per-app settings, forwarding rules, and\nother changes the actor may have made to persist their access. In addition, we recommend comprehensively\nremoving user and app access, reviewing configurations for each, and re-issuing new, strong credentials in\naccordance with documented industry best practices.\n\n## Indicators of Compromise (IOCs)\n\nThe below list provides IOCs observed during this activity. We encourage our customers to implement detections\nand protections to identify possible prior campaigns or prevent future campaigns against their systems. This list\nis not exhaustive and may expand as investigations continue. We also recommend you review the IOCs\nprovided by FireEye at Highly Evasive Attacker Leverages SolarWinds Supply Chain to Compromise Multiple\nGlobal Victims With SUNBURST Backdoor | FireEye Inc.\n\n**Command and Control**\n\navsvmcloud[.]com Command and Control (C2)\n\n**Observed malicious instances of SolarWinds.Orion.Core.BusinessLayer.dll**\n\nSHA256 File Version Date first\nseen\n\ne0b9eda35f01c1540134aba9195e7e6393286dde3e001fce36fb661cc346b91d 2020.2.100.11713 February\n2020\n\na58d02465e26bdd3a839fd90e4b317eece431d28cab203bbdde569e11247d9e2 2020.2.100.11784 March\n2020\n\n32519b85c0b422e4656de6e6c41878e95fd95026267daab4215ee59c107d6c77 2019.4.5200.9083 March\n2020\n\ndab758bf98d9b36fa057a66cd0284737abf89857b73ca89280267ee7caf62f3b 2020.2.100.12219 March\n2020\n\neb6fab5a2964c5817fb239a7a5079cabca0a00464fb3e07155f28b0a57a2c0ed 2020.2.100.11831 March\n2020\n\nc09040d35630d75dfef0f804f320f8b3d16a481071076918e9b236a321c1ea77 Not available March\n2020\n\nffdbdd460420972fd2926a7f460c198523480bc6279dd6cca177230db18748e8 2019.4.5200.9065 March\n2020\n\nb8a05cc492f70ffa4adcd446b693d5aa2b71dc4fa2bf5022bf60d7b13884f666 2019.4.5200.9068 March\n2020\n\n20e35055113dac104d2bb02d4e7e33413fae0e5a426e0eea0dfd2c1dce692fd9 2019.4.5200.9078 March\n2020\n\n\n-----\n\n0f5d7e6dfdd62c83eb096ba193b5ae394001bac036745495674156ead6557589 2019.4.5200.9078 March\n2020\n\ncc082d21b9e880ceb6c96db1c48a0375aaf06a5f444cb0144b70e01dc69048e6 2019.4.5200.9083 March\n2020\n\nac1b2b89e60707a20e9eb1ca480bc3410ead40643b386d624c5d21b47c02917c 2020.4.100.478 April\n2020\n\n019085a76ba7126fff22770d71bd901c325fc68ac55aa743327984e89f4b0134 2020.2.5200.12394 April\n2020\n\nce77d116a074dab7a22a0fd4f2c1ab475f16eec42e1ded3c0b0aa8211fe858d6 2020.2.5300.12432 May\n2020\n\n2b3445e42d64c85a5475bdbc88a50ba8c013febb53ea97119a11604b7595e53d 2019.4.5200.9078 May\n2020\n\n92bd1c3d2a11fc4aba2735d9547bd0261560fb20f36a0e7ca2f2d451f1b62690 2020.4.100.751 May\n2020\n\na3efbc07068606ba1c19a7ef21f4de15d15b41ef680832d7bcba485143668f2d Not available Not\navailable\n\na25cadd48d70f6ea0c4a241d99c5241269e6faccb4054e62d16784640f8e53bc 2019.4.5200.8890 October\n2019\n\nd3c6785e18fba3749fb785bc313cf8346182f532c59172b69adfb31b96a5d0af 2019.4.5200.8890 October\n2019\n\n**_Analyst’s comment: These indicators should not be considered exhaustive for this observed activity. Moreover,_**\naside from the malicious DLLs, Microsoft researchers have observed two files in October 2019 with code\nanomalies when a class was added to the SolarWinds DLL. Note however that these two do not have active\nmalicious code or methods.\n\n## Revision history\n\n2020-12-21: Added link to the Solorigate Resource Center\n2020-12-21: Added link to DART blog\n2020-12-18: Updated links to include Microsoft product protections and resources\n2020-12-17: Added link to Azure Sentinel blog post, added more observed malicious instances\n2020-12-16: Updated links to Azure Sentinel detections\n2020-12-13: Published\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-13 - Customer Guidance on Recent Nation-State Cyber Attacks.pdf"
    ],
    "report_names": [
        "2020-12-13 - Customer Guidance on Recent Nation-State Cyber Attacks.pdf"
    ],
    "threat_actors": [
        {
            "id": "cf1c7efe-4464-4347-95d3-c86fb4d7db51",
            "created_at": "2022-10-25T16:07:24.35977Z",
            "updated_at": "2025-03-27T02:02:10.189727Z",
            "deleted_at": null,
            "main_name": "UNC2447",
            "aliases": [],
            "source_name": "ETDA:UNC2447",
            "tools": [
                "7-Zip",
                "AdFind",
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "DEATHRANSOM",
                "DeathRansom",
                "FIVEHANDS",
                "FOXGRABBER",
                "HELLOKITTY",
                "HelloKitty",
                "KittyCrypt",
                "Mimikatz",
                "PCHUNTER",
                "RCLONE",
                "ROUTERSCAN",
                "Ragnar Locker",
                "RagnarLocker",
                "Rclone",
                "S3BROWSER",
                "SombRAT",
                "Thieflock",
                "WARPRISM",
                "cobeacon",
                "deathransom",
                "wacatac"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536217,
    "ts_updated_at": 1743041122,
    "ts_creation_date": 1653690178,
    "ts_modification_date": 1653690178,
    "files": {
        "pdf": "https://archive.orkl.eu/c2fbe57698ae0971e803191118da09451479f945.pdf",
        "text": "https://archive.orkl.eu/c2fbe57698ae0971e803191118da09451479f945.txt",
        "img": "https://archive.orkl.eu/c2fbe57698ae0971e803191118da09451479f945.jpg"
    }
}