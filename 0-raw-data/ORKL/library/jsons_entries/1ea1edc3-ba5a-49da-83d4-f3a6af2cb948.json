{
    "id": "1ea1edc3-ba5a-49da-83d4-f3a6af2cb948",
    "created_at": "2023-01-12T15:06:48.991253Z",
    "updated_at": "2025-03-27T02:05:23.533355Z",
    "deleted_at": null,
    "sha1_hash": "ca900cbc082723258e3d413c5b0472483f8383fc",
    "title": "2013-05-20 - Lockscreen Win32-Lyposit displayed as a fake MacOs app",
    "authors": "",
    "file_creation_date": "2022-05-28T21:51:28Z",
    "file_modification_date": "2022-05-28T21:51:28Z",
    "file_size": 423231,
    "plain_text": "# Lockscreen Win32:Lyposit displayed as a fake MacOs app\n\n**[blog.avast.com/2013/05/20/lockscreen-win32lyposit-displayed-as-a-fake-macos-app/](https://blog.avast.com/2013/05/20/lockscreen-win32lyposit-displayed-as-a-fake-macos-app/)**\n\n[When the mastermind hackers of the notorious Carberp Banking Trojan were arrested, we](https://blog.avast.com/2013/04/08/carberp_epitaph/)\nthought the story had ended. But a sample that we received on May 7th, a month after the\narrests, looked very suspicious. It connected to a well known URL pattern and it really was\nthe Carberp Trojan. Moreover, the domain it connected to was registered on April 9th!\n\nTaking a closer look into the PE header, it was observed that the TimeDateStamp (02 / 27 /\n13 @ 12:19:29pm EST) displayed a bit earlier date than the date of the arrests of the\ncybercriminals, and the URL was a part of larger botnet where plenty of Russian bots are\ninvolved. So the case was closed as a lost sample within a distribution process.\n\n[After using our internal Malware Similarity Search to catch as many malware samples as](https://blog.avast.com/2012/12/03/new-toy-research-lab/)\npossible, a cluster appeared. It contained some well-known families like Zbot, Dofoil,\nGamarue, and some fresh families like Win32/64:Viknok and Win32:Lyposit. The latter is a\ndynamic link library and it caught our attention by a quite sophisticated loader and a final\npayload.\n\n**Loader Analysis**\n\nThe starting dropper is a Microsoft Visual Basic executable that unpacks and loads the first\nhidden layer - another x86 PE executable. This layer decrypts data in newly allocated\nmemory and the next step is performed there. Analysis is made more difficult by resolving\nWINAPI functions on the fly by a hash and using a multiple cooperating threads. The main\ndecryption is done by repeating calls of RC2 cipher algorithm provided by Microsoft Base\nCryptographic Provider v1.0. The next layer is a dynamic linked library and it drops the\nproper binary of the lockscreen.\n\n**Payload**\n\nLockscreen tries to communicate with its servers through Background Intelligent Transfer\nService (BITS) . It creates a single BITS Control Class with a background job that downloads\nfiles to the client (a parameter BG_JOB_TYPE_DOWNLOAD for the\nIBackgroundCopyManager:CreateJob method). It was reported that malware in the past\nused to bypass firewall rules in order to perform additional actions.\n\n\n-----\n\nURL names are encoded in the data section of a binary file and they appear non-standard on\nthe first sight:\n\nhxxp://n31mp7zeqm7bw35fciw.com/ads1/\nhxxp://ljlhkpnqi7n6ddp5yk8hxk.org/ads1/\nhxxp://omiuis3tmhjxz6fg2qi.org/ads1/\nhxxp://r4fy3cddf87nzgemobxnd.org/ads1/\nhxxp://s32xc6t07ar30mogs8ya.com/ads1/\nhxxp://lesgngfrexeigoxd.com/ads1/\n\nAn example of a query to a C&C server:\n\nGET /ads1/?l=P8ZWABgRAFJMQTUApAEAAL6KDni0wESS HTTP/1.1\nAccept: */*\nAccept-Encoding: identity\nRange: bytes=0-4697\nUser-Agent: Microsoft BITS/6.7\nHost: r4fy3cddf87nzgemobxnd.org\nConnection: Keep-Alive\n\nThe string before the equality sign is randomly generated for length between 1 and 5 and the\nsequence of numbers after the equality contains packed information about the victim's\nlocation and computer name. The following picture reveals what's behind the previous\nrequest after a decryption ( the first double word is a return of GetTickCount() call, followed\nby a constant byte 0x18 and an internal code of procedure that calls the request; then we\nsee a magic string \"RLA5\", a value of local identifier, a hash of the DigitalProductId xored\nwith the value of the InstallDate and finally a hash of Computer Name ).\n\nA reverse algorithm that reveals this buffer works like this:\n\n\n-----\n\nCommunication protocol is encrypted and the following decryption algorithm is used:\n\nApplying decryptBITS algorithm twice on a received buffer an archive with a complete HTML\npage finally displayed is obtained.\n\nDepending on the location setting of the victim's computer, particular content for a ransom\nmessage is chosen on a the server-side. If it is not Switzerland, Italy, Spain, Germany,\nRussia, Ukraine or possibly other non-US countries, it could look like this:\n\n\n-----\n\nObserve that the background picture (btw. it is called \"US.jpg\" in the archive) and the font\nstyle of commands output is definitely not a Microsoft Windows command line. Moreover, the\nhighlighted string \"MacOs vers\" whispers what the platform pretends to be. But we did not\nget tricked; this is not another threat for Mac OS systems. We can only speculate about the\nreasons why the malware authors chose this strange masking. One that comes to mind is\nthe fact that Mac OS X has a bigger market share in North America and users are more used\nto this style. Who knows...\n\n**Persistence**\nThe lockscreen secures its execution after every start-up using two methods. The first one is\nfairly regular and its idea is to silently register malicious library with the correct setting in the\nregistry:\n\nThe second method is more unconventional. The malware registers itself as an extension of\nthe command processor. It means that the malware would become a common component\nafter every run of cmd.exe:\n\n**Manual Removal of Win32:Lyposit**\n\n\n-----\n\n1. Boot your computer with a live CD\n\n2. Find upper mentioned registry keys that serve for the persistance of the lockscreen.\n\n3. Find and delete the referenced file in those keys.\n\n4. Restart your computer in Normal Mode.\n\n**Sources**\n\nFinally MD5 of some selected samples with the detections of avast! engine:\n\n\nLyposit (dropper - layer\n0)\n\nLyposit (dropper - layer\n1)\n\nLyposit (dropper - layer\n2)\n\n\n06e9ac14027ce9226a448625dbada9b1 Win32:Carberp-AQB\n\n[Cryp]\n\n37fb38abacf8ba8c96485898c7d76db2 Win32:Lyposit-A [Trj]\n\nb5c22c79cd9148be71232b954f1c4cec Win32:Lyposit-A [Trj]\n\n\nLyposit (Lockscreen) c40b751e51d85b0c103caa3d55974ce8 Win32:Lyposit-B [Trj]\n\n**Acknowledgment**\n\nSincere gratitude goes to my colleague Jaromír Hořejší for cooperation on this analysis.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2013/2013-05-20 - Lockscreen Win32-Lyposit displayed as a fake MacOs app.pdf"
    ],
    "report_names": [
        "2013-05-20 - Lockscreen Win32-Lyposit displayed as a fake MacOs app.pdf"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536008,
    "ts_updated_at": 1743041123,
    "ts_creation_date": 1653774688,
    "ts_modification_date": 1653774688,
    "files": {
        "pdf": "https://archive.orkl.eu/ca900cbc082723258e3d413c5b0472483f8383fc.pdf",
        "text": "https://archive.orkl.eu/ca900cbc082723258e3d413c5b0472483f8383fc.txt",
        "img": "https://archive.orkl.eu/ca900cbc082723258e3d413c5b0472483f8383fc.jpg"
    }
}