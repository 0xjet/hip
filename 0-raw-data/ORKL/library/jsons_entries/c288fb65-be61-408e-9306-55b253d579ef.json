{
    "id": "c288fb65-be61-408e-9306-55b253d579ef",
    "created_at": "2023-01-12T15:09:56.918827Z",
    "updated_at": "2025-03-27T02:14:05.670532Z",
    "deleted_at": null,
    "sha1_hash": "cf5e9c437eb04f7e1f75681edf922bb272862a3a",
    "title": "2021-07-21 - Detecting Trickbot with Splunk",
    "authors": "",
    "file_creation_date": "2022-05-28T23:13:50Z",
    "file_modification_date": "2022-05-28T23:13:50Z",
    "file_size": 281823,
    "plain_text": "# Detecting Trickbot with Splunk\n\n**splunk.com/en_us/blog/security/detecting-trickbots.html**\n\nJuly 21, 2021\n\nBy [Splunk Threat Research Team July 21, 2021](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)\n\nThe Splunk Threat Research Team\nhas assessed several samples of\n[Trickbot, a popular crimeware carrier](https://www.cisecurity.org/blog/trickbot-not-your-average-hat-trick-a-malware-with-multiple-hats/)\nthat allows malicious actors to deliver\nmultiple types of payloads. These\nsamples have been found in use\nduring recent campaigns, and the\nteam has identified the presence of\nspecific tools designed to inject\nmalicious code into victims’ browsers,\nknown as Web Injects, which work as\ncustom elements that allow attackers\nto perform operations on top of the\nvictim's web session while seeming legitimate. We also took a look at several modules,\n[including LDAP querying capabilities and Cobalt Strike delivery, which has been observed in](https://www.zdnet.com/article/solarwinds-hack-analysis-reveals-56-boost-in-command-server-footprint/)\nrecent campaigns.\n\n[Trickbot Trojan is said to be related to Zeus and Dyre crimeware and has been active since](https://www.cisecurity.org/blog/trickbot-not-your-average-hat-trick-a-malware-with-multiple-hats/)\nthe year 2016. Trickbot has been used in multiple campaigns targeting financial services and\nother verticals; due to its versatile nature, recently it has also been observed targeting single\n[users via traffic infringement phishing. Trickbot is attributed to the following actors, according](https://us-cert.cisa.gov/ncas/alerts/aa21-076a)\nto [CISA:](https://us-cert.cisa.gov/sites/default/files/publications/TrickBot_Fact_Sheet_508.pdf)\n\n\n-----\n\n[Wizard Spider (CrowdStrike)](https://www.crowdstrike.com/blog/wizard-spider-adversary-update/)\n[UNC1878 (Fireyee)](https://malpedia.caad.fkie.fraunhofer.de/actor/unc1878)\n[Gold Blackburn (SecureWorks)](https://www.secureworks.com/research/threat-profiles/gold-blackburn)\n\nThe web injects are post-exploitation code artifacts delivered and executed via trickbot. They\nare specifically designed for targeted sites (financial institutions, cryptocurrency exchanges,\ntelco service providers). The samples analyzed by the Splunk Threat Research Team include\nmajor U.S financial institutions, telecom organizations and cryptocurrency exchanges, among\nothers. Although web injects are not new, they are very difficult to detect, and they usually\ndefeat most available defenses — PINs, CAPTCHA and even two-factor authentication\napplications.\n\nThe web inject code is delivered post-compromise via trickbot. Trickbot crimeware is delivered\nby multiple methods from direct malicious links, infected documents, or even direct\nexploitation of internet-exposed hosts or lateral movement; Trickbot malware possesses\nseveral functions and features that allow usage of different exploitation methods and postexploitation payloads.\n\nThe following graphic is an example of an infected document:\n\n\n-----\n\nThis Excel document will download and load a malicious trickbot .dll using rundll32 windows\napplication, as seen in the next graphic. The macro is written in a hidden xls sheet in white\nfont, so as to be invisible to the user.\n\n\n-----\n\nOnce this document is executed in a vulnerable host, it proceeds to execute loader and\ncontact Command and Control servers. It will inject its code to the “wermgr.exe” process to do\nits malicious routine. Below is a snippet of procmon CSV logs during the trickbot execution.\nNotice that the wermgr.exe process was created by the same rundll32 process that loads the\ntrickbot malware (in this case 1.dll).\n\nBy decoding the big encoded string on the trickbot dll loader upon unpacking it in memory, we\ncan see a list of web services that trickbot uses to look for the IP address of the infected\nmachines.\n\nThroughout the infection process, Trickbot will also establish persistence. This is done via the\ncreation of a scheduled task. We also analyzed a trickbot module identified as wormDll64.dll.\nThis module allows trickbot to move laterally and collect LDAP information from compromised\nnetworks.\n\nThe function below enumerates all servers visible in the windows active directory domain\nnetwork; it also checks if the infected machine is part of the workgroup.\n\n\n-----\n\n[Trickbot also uses the eternal blue exploitation code. CVE-2017-0144 is a vulnerability that](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2017-0144)\nallows remote code execution on machines with vulnerable SMB versions.\n\nOther modules from the trickbot analyzed samples — such as systeminfo64.dll, sharedll64.dll,\npsinf64.dll, and networkdll64.dll — include full system enumeration, LDAP query, and share\nenumeration which allows trickbot to copy itself to other systems, shared folders, and\ndownload further payloads.\n\n## Web Injects\n\nAs stated previously in this blog, Web Injects are not new. However, they are a very powerful\ncrime tool and very difficult to detect. Web Injects can bypass most of the current defenses,\nincluding 2FA tools. Before Web Injects can be executed, there must be a process of\nexploitation which can be done via several methods, once the client has been infected with\ntrickbot and the Web Inject file is in place. This is a process that is triggered by the victim\nbrowsing specific websites which are specified within the Web Inject config file. Then the\ntrickbot proceeds to exfiltrate data and execute operations on top of the victim’s session to\nperform fraudulent operations such as transferring money from accounts to foreign\ninstitutions.\n\nIt is important to understand that in appearance these pages which the victim is visiting look\nexactly like any other standard normal banking session, but in the background the code\ninjected allows attackers to perform different types of operations. In some cases, the Web\nInjects code, for example, keeps an account balance at its initial amount to the user’s view,\neven though in the background, money has already been transferred to a different account,\nusually to a foreign financial institution in countries where cybersecurity laws are very lax or\nwhere there is even complicity from destination country’s regime.\n\n\n-----\n\n## Injdll64.dll Web Inject Payload\n\nThis module consists of web injects targeting several banking sites. It creates a namepipe\n\\.\\pipe\\pidplacesomepipe where “PID” will be changed to the actual target process ID at\nruntime, which is sometimes four characters (e.g., “\\.\\pipe\\1844lacesomepipe”). The\npayload32.dll (a .dll created during the infection process in this sample) is a payload that will\nbe decompressed and injected within the browser session through a reflective dll injection\ntechnique to do its main task as a banking trojan.\n\nThe following is a snippet snapshot of decrypted trickbot config samples.\n\nAs seen in the researched code, the Web Injects principally target login sites for several\nfinancial institutions, cryptocurrency exchanges and telco service providers. In some\ninstances, the targeted URI indicates the targeting of balances, transfers and account\nsettings. Such sections usually contain the elements necessary to make deposits, send\ntransfers or change account settings, such as authentication or private information from\naccount holders.\n\n## Detections\n\n[The Splunk Threat Research Team has developed a Trickbot analytic story to address this](https://docs.splunk.com/Documentation/ESSOC/3.23.0/stories/UseCase#Trickbot)\nthreat. This story is composed of the following searches:\n\n**Detection** **Techniques** **Tactic(s)** **Notes**\n\n\n-----\n\nDetection of Office\n[Application Spawn](https://github.com/splunk/security_content/blob/develop/detections/endpoint/office_application_spawn_rundll32_process.yml)\nrundll32 Process\n(new)\n\nDetect Wermgr\nProcess Connecting\nto Check IP\nServices (new)\n\nWermgr Process\n[Create Executable](https://github.com/splunk/security_content/blob/develop/detections/endpoint/wermgr_process_create_executable_file.yml)\nFile (new)\n\nWermgr Process\n[Spawned CMD Or](https://github.com/splunk/security_content/blob/develop/detections/endpoint/wermgr_process_spawned_cmd_or_powershell_process.yml)\nPowershell Process\n(new)\n\nSchedule Task With\n[Rundll32 Command](https://github.com/splunk/security_content/blob/develop/detections/endpoint/schedule_task_with_rundll32_command_trigger.yml)\nTrigger (new)\n\nPowershell Remote\n[Thread To Known](https://github.com/splunk/security_content/blob/develop/detections/endpoint/powershell_remote_thread_to_known_windows_process.yml)\nWindows Process\n(new)\n\nWrite Executable in\nSMB Share (new)\n\nTrickbot Named\nPipe (new)\n\nPlain HTTP POST\nExfiltrated Data\n(new)\n\n\n[T1566.001](https://attack.mitre.org/techniques/T1566/001/) Initial Access Detects Run Dynamic Link Library\n32 child process via Microsoft\nOffice App\n\n[T1590.005](https://attack.mitre.org/techniques/T1590/005/) Reconnaissance Detects the use of Windows Error\nManager executable to elicit a\nconnection to an external service\nto determine the victim’s external\nIP address\n\n\n[T1027](https://attack.mitre.org/techniques/T1027/) Defense\nEvasion\n\n\nDetects the use of Windows Error\nManager that creates executable\nfiles\n\n\n[T1059](https://attack.mitre.org/techniques/T1059/) Execution Detects the use of Windows Error\nManager to spawn a terminal\nsession or Powershell Process\n\n\n[T1053](https://attack.mitre.org/techniques/T1053/) Execution,\nPersistence,\nPrivilege\nEscalation\n\n[T1055](https://attack.mitre.org/techniques/T1055/) Defense\nEvasion,\nPrivilege\nEscalation\n\n[T1021.002](https://attack.mitre.org/techniques/T1021/002/) Lateral\nMovement\n\n[T1055](https://attack.mitre.org/techniques/T1055/) Defense\nEvasion,\nPrivilege\nEscalation\n\n\nDetects the creation of a\nscheduled task where rundll32.exe\nis used to execute or spawn\nanother process\n\nDetects PowerShell process\ninjection in some known windows\nprocesses\n\nDetects the creation of an\nexecutable targeting SMB Share\n\nDetects the creation of a Named\nPipe or inter-process\ncommunication associated with the\nexecution of Trickbot\n\n\n[T1048.003](https://attack.mitre.org/techniques/T1048/003/) Exfiltration Detects the use of the HTTP POST\nmethod to exfiltrate data\n\n\n-----\n\nAccount Discovery\nWith Net App (new)\n\nSuspicious Rundll32\nStartw (Existing)\n\nOffice Document\n[Executing Macro](https://github.com/splunk/security_content/blob/develop/detections/endpoint/office_document_executing_macro_code.yml)\nCode (Existing)\n\nCobalt Strike\nNamed Pipes\n(Existing)\n\nSuspicious Rundll32\nDllregisterserver\n(Existing)\n\nAttempt to Stop\nSecurity Service\n(Existing)\n\n## Hashes\n\n\n[T1087.002](https://attack.mitre.org/techniques/T1087/002/) Discovery Detects the use of a series of net\ncommands for account discovery\non the infected machine\n\n\n[T1218.011](https://attack.mitre.org/techniques/T1218/011/) Defense\nEvasion\n\n\nDetects Rundll32 with \"StartW\"\nparameter\n\n\n[T1566.001](https://attack.mitre.org/techniques/T1566/001/) Initial Access Detects MS Office that execute\nmacro code\n\n\n[T1055](https://attack.mitre.org/techniques/T1055/) Defense\nEvasion,\nPrivilege\nEscalation\n\n[T1218.011](https://attack.mitre.org/techniques/T1218/011/) Defense\nEvasion\n\n[T1562.001](https://attack.mitre.org/techniques/T1562/001/) Defense\nEvasion\n\n\nDetects Common Cobalt Strike\nnamed pipes\n\nDetects Rundll32 with\n\"dllregisterserver\" parameter\n\nDetects Security Service\nterminations\n\n\n**File name** **Sha256**\n\nInjdll64.dll [5c9f626665a5f6e91599df85f3a1ae07258b9c3b8fc72eff56082ce9cb2c4394](https://www.virustotal.com/gui/file/5c9f626665a5f6e91599df85f3a1ae07258b9c3b8fc72eff56082ce9cb2c4394/detection)\n\nwormDll64.dll [74e9d233177ca996df3eeda88af9ff2d7f87bace0726b0516ecf3be7dcb59f71](https://www.virustotal.com/gui/file/74e9d233177ca996df3eeda88af9ff2d7f87bace0726b0516ecf3be7dcb59f71/detection)\n\n\nTrickbot\nloader\n\n\n[01b6ab63f7078d952ed1a18850ac202bc201aa6210592c108a2e0a4d16f06fc5](https://www.virustotal.com/gui/file/01b6ab63f7078d952ed1a18850ac202bc201aa6210592c108a2e0a4d16f06fc5/detection)\n\n\nXLSM Macro [ed03ded8aabe6685d536c26d55e9685a05e6e148c4c5b56b73faa5d81c9c083a](https://www.virustotal.com/gui/file/ed03ded8aabe6685d536c26d55e9685a05e6e148c4c5b56b73faa5d81c9c083a/details)\n\n\n-----\n\nThe aforementioned current and new detections should help address this threat, with Trickbot\nbeing one of the main Ransomware carriers. Ongoing campaigns are not only a threat to\n[companies operations; recent incidents reveal that ransomware has endangered human life,](https://www.nytimes.com/2020/11/26/us/hospital-cyber-attack.html)\n[affected many governments and school organizations and even military bases.](https://www.bbc.com/news/technology-50972890)\n\nRansomware is now the top priority in cybersecurity. The Splunk Threat Research team will\ncontinue addressing ransomware variants and sharing their detection with the community.\n[Please download our latest content at Splunkbase, or check out](https://splunkbase.splunk.com/app/3449/) [our Github repository.](https://github.com/splunk/security_content)\n\nPosted by\n\n**[Splunk Threat Research Team](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)**\n\nThe Splunk Threat Research Team is an active part of a customer’s overall defense strategy\nby enhancing Splunk security offerings with verified research and security content such as use\ncases, detection searches, and playbooks. We help security teams around the globe\nstrengthen operations by providing tactical guidance and insights to detect, investigate and\nrespond against the latest threats. The Splunk Threat Research Team focuses on\nunderstanding how threats, actors, and vulnerabilities work, and the team replicates attacks\n[which are stored as datasets in the Attack Data repository.](https://github.com/splunk/attack_data/)\n\nOur goal is to provide security teams with research they can leverage in their day to day\noperations and to become the industry standard for SIEM detections. We are a team of\nindustry-recognized experts who are encouraged to improve the security industry by sharing\nour work with the community via conference talks, open-sourcing projects, and writing white\npapers or blogs. You will also find us presenting our research at conferences such as Defcon,\nBlackhat, RSA, and many more.\n\n\n-----\n\n[Read more Splunk Security Content.](https://github.com/splunk/security_content)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-21 - Detecting Trickbot with Splunk.pdf"
    ],
    "report_names": [
        "2021-07-21 - Detecting Trickbot with Splunk.pdf"
    ],
    "threat_actors": [
        {
            "id": "ab9d6b30-7c60-4d0b-8f49-e2e913c28508",
            "created_at": "2022-10-25T16:07:24.584775Z",
            "updated_at": "2025-03-27T02:02:10.289029Z",
            "deleted_at": null,
            "main_name": "UNC1878",
            "aliases": [],
            "source_name": "ETDA:UNC1878",
            "tools": [
                "Agentemis",
                "BEERBOT",
                "BazarBackdoor",
                "BazarCall",
                "BazarLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "KEGTAP",
                "Ryuk",
                "Team9Backdoor",
                "bazaloader",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "63061658-5810-4f01-9620-7eada7e9ae2e",
            "created_at": "2022-10-25T15:50:23.752974Z",
            "updated_at": "2025-03-27T02:00:55.538582Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "Wizard Spider",
                "UNC1878",
                "TEMP.MixMaster",
                "Grim Spider",
                "FIN12",
                "GOLD BLACKBURN",
                "ITG23",
                "Periwinkle Tempest",
                "DEV-0193"
            ],
            "source_name": "MITRE:Wizard Spider",
            "tools": [
                "TrickBot",
                "AdFind",
                "BITSAdmin",
                "Bazar",
                "LaZagne",
                "Nltest",
                "GrimAgent",
                "Dyre",
                "Ryuk",
                "Conti",
                "Emotet",
                "Rubeus",
                "Mimikatz",
                "Diavol",
                "PsExec",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "0a4f4edc-ea8c-4a30-8ded-35394e29de01",
            "created_at": "2023-01-06T13:46:39.178183Z",
            "updated_at": "2025-03-27T02:00:03.014032Z",
            "deleted_at": null,
            "main_name": "UNC1878",
            "aliases": [],
            "source_name": "MISPGALAXY:UNC1878",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f6f91e1c-9202-4497-bf22-9cd5ef477600",
            "created_at": "2023-01-06T13:46:38.86765Z",
            "updated_at": "2025-03-27T02:00:02.938998Z",
            "deleted_at": null,
            "main_name": "WIZARD SPIDER",
            "aliases": [
                "FIN12",
                "UNC2053",
                "Pistachio Tempest",
                "TEMP.MixMaster",
                "GOLD BLACKBURN",
                "Periwinkle Tempest",
                "DEV-0193",
                "Storm-0193",
                "Trickbot LLC",
                "DEV-0237"
            ],
            "source_name": "MISPGALAXY:WIZARD SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e6a21528-2999-4e2e-aaf4-8b6af14e17f3",
            "created_at": "2022-10-25T16:07:24.422115Z",
            "updated_at": "2025-03-27T02:02:10.216817Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "DEV-0193",
                "Gold Blackburn",
                "Gold Ulrick",
                "Grim Spider",
                "ITG23",
                "Operation BazaFlix",
                "Periwinkle Tempest",
                "TEMP.MixMaster",
                "Wizard Spider"
            ],
            "source_name": "ETDA:Wizard Spider",
            "tools": [
                "AdFind",
                "Agentemis",
                "Anchor_DNS",
                "BEERBOT",
                "BazarBackdoor",
                "BazarCall",
                "BazarLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "Conti",
                "Diavol",
                "Dyranges",
                "Dyre",
                "Dyreza",
                "Dyzap",
                "Gophe",
                "Invoke-SMBAutoBrute",
                "KEGTAP",
                "LaZagne",
                "LightBot",
                "PowerSploit",
                "PowerTrick",
                "PsExec",
                "Ryuk",
                "SessionGopher",
                "TSPY_TRICKLOAD",
                "Team9Backdoor",
                "The Trick",
                "TheTrick",
                "Totbrick",
                "TrickBot",
                "TrickLoader",
                "TrickMo",
                "Upatre",
                "bazaloader",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bc119938-a79c-4e5f-9d4d-dc96835dfe2e",
            "created_at": "2024-06-04T02:03:07.799286Z",
            "updated_at": "2025-03-27T02:05:17.337094Z",
            "deleted_at": null,
            "main_name": "GOLD BLACKBURN",
            "aliases": [
                "Periwinkle Tempest ",
                "Wizard Spider ",
                "ITG23 "
            ],
            "source_name": "Secureworks:GOLD BLACKBURN",
            "tools": [
                " Buer Loader",
                " Dyre",
                " Team9",
                " TrickBot",
                "BazarLoader"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "53f39e5d-6d69-4402-b03c-ec2dbe045788",
            "created_at": "2024-06-19T02:03:08.132007Z",
            "updated_at": "2025-03-27T02:05:17.401832Z",
            "deleted_at": null,
            "main_name": "GOLD ULRICK",
            "aliases": [
                "UNC1878 ",
                "Grim Spider "
            ],
            "source_name": "Secureworks:GOLD ULRICK",
            "tools": [
                " Buer Loader",
                " Cobalt Strike",
                " Conti",
                " Diavol",
                " Powershell Empire",
                " Ryuk",
                " SystemBC",
                " Team9 (aka BazarLoader)",
                " TrickBot",
                "Bloodhound"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536196,
    "ts_updated_at": 1743041645,
    "ts_creation_date": 1653779630,
    "ts_modification_date": 1653779630,
    "files": {
        "pdf": "https://archive.orkl.eu/cf5e9c437eb04f7e1f75681edf922bb272862a3a.pdf",
        "text": "https://archive.orkl.eu/cf5e9c437eb04f7e1f75681edf922bb272862a3a.txt",
        "img": "https://archive.orkl.eu/cf5e9c437eb04f7e1f75681edf922bb272862a3a.jpg"
    }
}