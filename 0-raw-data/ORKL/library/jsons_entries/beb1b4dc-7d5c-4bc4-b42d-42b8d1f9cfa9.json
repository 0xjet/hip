{
    "id": "beb1b4dc-7d5c-4bc4-b42d-42b8d1f9cfa9",
    "created_at": "2023-01-12T15:10:47.616159Z",
    "updated_at": "2025-03-27T02:16:08.467047Z",
    "deleted_at": null,
    "sha1_hash": "b12f846b41092452ca6481665527155a653888d6",
    "title": "2017-11-20 - Cobalt Strikes Again- Spam Runs Use Macros and CVE-2017-8759 Exploit Against Russian Banks",
    "authors": "",
    "file_creation_date": "2022-05-28T01:31:07Z",
    "file_modification_date": "2022-05-28T01:31:07Z",
    "file_size": 180850,
    "plain_text": "# Cobalt Strikes Again, Spam Runs Target Russian Banks\n\n**[blog.trendmicro.com/trendlabs-security-intelligence/cobalt-spam-runs-use-macros-cve-2017-8759-exploit/](https://blog.trendmicro.com/trendlabs-security-intelligence/cobalt-spam-runs-use-macros-cve-2017-8759-exploit/)**\n\nNovember 20, 2017\n\nSpam\n\nBackdoor-laden spam mail we saw targeting Russian-speaking businesses were apparently\npart of bigger campaigns. The culprit appears to be the Cobalt group. In recent campaigns,\nCobalt used social engineering hooks designed to target bank employees.\n\nBy: Ronnie Giagone, Lenart Bermejo, Fyodor Yarochkin November 20, 2017 Read time: (\nwords)\n\n[The waves of backdoor-laden spam emails we observed during June and July that targeted](http://blog.trendmicro.com/trendlabs-security-intelligence/backdoor-carrying-emails-set-sights-on-russian-speaking-businesses/)\nRussian-speaking businesses were part of bigger campaigns. The culprit appears to be the\nCobalt hacking group, based on the techniques used. In their recent campaigns, Cobalt used\ntwo different infection chains, with social engineering hooks that were designed to invoke a\nsense of urgency in its recipients—the bank’s employees.\n\nCobalt was named after Cobalt Strike, a multifunctional penetration testing tool similar to\n[Metasploit. The hacking group misused Cobalt Strike, for instance, to perpetrate](https://www.helpnetsecurity.com/2016/11/22/cobalt-hackers-synchronized-atm-heists/) ATM cyber\nheists and target financial institutions across Europe, and interestingly, Russia. Unlike other\ngroups that avoid Russia (or Russian-speaking countries) to elude law enforcement, Cobalt’s\nattack patterns suggest that the group uses Russia as a testing ground where they try their\n\n\n-----\n\nlatest malware and techniques on Russian banks. If successful, they go on to attack financial\ninstitutions outside the country. This resembles the tactics of another cybercriminal group,\n[Lurk.](http://blog.trendmicro.com/trendlabs-security-intelligence/lurk-retracing-five-year-campaign/)\n\nOf note were Cobalt’s other targets. The hacking group's first spam run also targeted a\nSlovenian bank, while the second run targeted financial organizations in Azerbaijan, Belarus,\nand Spain.\n\n**_Changing Tacks_**\n\n[Apart from using a different vulnerability (CVE-2017-8759), what’s unique in their latest spear](http://blog.trendmicro.com/trendlabs-security-intelligence/microsoft-office-zero-day-vulnerability-addressed-september-patch-tuesday/)\nphishing campaigns, compared to their previous spam runs and even other related\n[cybercriminal campaigns, is an apparent role change. The modus commonly seen in attack](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/online-banking-trojan-brief-history-of-notable-online-banking-trojans)\nchains that target end users (i.e., bank customers) is now leveled against the banks\nthemselves. While they previously posed as sales and billing departments of legitimate\ncompanies, they’re now masquerading as the customers of their targets (banks), a state\narbitration court, and ironically, an anti-fraud and online security company notifying the\nwould-be victim that his “internet resource” has been blocked.\n\nThey also diversified tacks. The first spam run on August 31 used a Rich Text Format (RTF)\ndocument laden with malicious macros. The second, which ran from September 20 to 21,\n[used an exploit for CVE-2017-8759 (patched last September), a](http://blog.trendmicro.com/trendlabs-security-intelligence/microsoft-office-zero-day-vulnerability-addressed-september-patch-tuesday/) [code injection/remote code](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/infosec-guide-web-injections)\nexecution vulnerability in Microsoft’s .NET Framework. The vulnerability was used to retrieve\nand execute Cobalt Strike from a remote server they controlled. We also saw other threat\n[actors using the same security flaw of late, like the cyberespionage group ChessMaster.](http://blog.trendmicro.com/trendlabs-security-intelligence/chessmasters-new-strategy-evolving-tools-tactics/)\n\nBelow are snapshots of some of the spam emails they sent to their targets:\n\n_Figure 1. Spam emails containing RTF documents embedded with malicious macros_\n\n**_Infection Chain via Macros_**\n\nHere’s a visualization of this infection chain:\n\n_Figure 2. Infection chain of Cobalt’s latest spear phishing campaign using malicious macro_\n\nThe RTF file contains macro codes that will execute a PowerShell command to retrieve a\ndynamic-link library (DLL) file before executing it using odbcconf.exe, a command-line utility\n[related to Microsoft Data Access Components. The DLL will drop and execute a malicious](http://msdn2.microsoft.com/en-us/data/aa937729.aspx)\nJScript using regsvr32.exe, another command-line utility, to download another JScript and\nexecute it using the same regsvr32.exe. This JScript will then connect to a remote server\nand wait for backdoor commands. During analysis, we received a PowerShell command that\ndownloads Cobalt Strike from hxxps://5[.]135[.]237[.]216[/]RLxF. It will ultimately try to\nconnect to their command and control (C&C) server, 5[.]135[.]237[.]216[:]443, which we\nfound located in France.\n\n\n-----\n\n_Figure 3. The malicious RTF file asking would-be victims to Enable Content (left) and_\n_what happens after clicking it, when the macro codes are run (right)_\n\nTo further illustrate this infection chain: after clicking “Enable Content”, it will run the macro\ncodes that will check if the machine is 64-bit, decrypt and execute a PowerShell command,\nremove the picture in the document, and write “Call me” in it. The PowerShell command is\nfor downloading a DLL file from hxxp://visa[-]fraud[-]monitoring[.]com[/]t[.]dll, saving it in the\naffected machine, then executing it via the command, odbcconf.exe /S /A {REGSVR\n_\"\"C:\\Users\\Public\\file.dll\"\"}. The DLL file will drop a Windows Script Component (SCT) file_\nembedded with JScript in the %AppData% folder using a random name and append it with a\n.TXT extension.\n\n_Figure 4. The macro codes (above) and the DLL file executing the SCT file via_\n_regsvr32.exe (below)_\n\nThe SCT file will check if the system has an internet connection; if it's connected, it will\nproceed to download and execute a backdoor from the remote server.\n\n_Figure 5. The file downloaded from the remote server, which is actually a backdoor_\n\nSome of the backdoor’s commands are:\n\nd&exec — download and execute PE file\nmore_eggs — download additional scripts\ngtfo — delete files/startup entries and terminate\nmore_onion — run additional script\nmore_power — run command shell commands\n\n**_Infection Chain via CVE-2017-8759_**\n\nThe RTF attachment used in their second spam run contained an exploit for CVE-20178759. It entails downloading a specified Simple Object Access Protocol (SOAP) Web\nServices Description Language (WSDL) definition from a remote server, which is injected\ninto memory. The codes include downloading and retrieving Cobalt Strike, which will connect\nto the C&C server 86[.]106[.]131[.]207 and wait for commands.\n\n_Figure 6. Infection chain using CVE-2017-8759_\n\n_Figure 7. Spam emails whose attachments contain an exploit for CVE-2017-8759_\n\n[The same exploit technique has been employed to deliver the cyberespionage malware](https://arstechnica.com/information-technology/2017/09/for-2nd-time-this-year-windows-0day-exploited-to-install-finspy-creepware/)\nFinSpy. In Cobalt’s case, a SOAP moniker is embedded in the RTF file, which facilitates the\nexploit for CVE-2017-8759 by retrieving the malicious SOAP WSDL definition via\n\n\n-----\n\nhxxp://servicecentrum[.]info[/]test[.]xml. Contents of this Extensible Markup Language (XML)\nfile will be parsed, which will generate a Source Code (CS) file. It will then be compiled by\nthe .NET Framework, which Microsoft Office will load as a library.\n\nDepending on the infected machine’s architecture, the library will inject codes that will\ndownload and execute the final payload. It’s named “ZxT6” in 32-bit systems and “MZBt” in\n64-bit machines. The endgame is to connect to the C&C server, 86[.]106[.]131[.]207, which\nwe found located in Germany. The final payload is a DLL that is a component of Cobalt\nStrike. It will connect to 86[.]106[.]131[.]207[:]443 to wait for further commands.\n\nThis is what the attacker’s panel looks like when trying to interact with the targeted victims:\n\n_Figure 8. Dashboard of Cobalt Strike, which is also abused by various attackers_\n\n**_Mitigations_**\n\nMany security technologies and security researchers may be utilizing newer detection\nmechanisms, but [cybercriminals are also keeping up, adjusting their tactics to evade them. In](https://www.trendmicro.com/vinfo/us/security/research-and-analysis/predictions/2017)\nCobalt’s case, for instance, they’ve looked into instances of valid Windows programs or\nutilities as conduits that allow their malicious code to bypass whitelisting.\n\nIndeed, Cobalt hacking group's attacks exemplify the importance of defense in depth. Here\nare some best practices to defend against these types of threats:\n\n[Blacklist, disable, and secure the use of built-in interpreters or command-line](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/best-practices-securing-sysadmin-tools)\n[applications, such as PowerShell, odbcconf.exe, and regsvr.exe](https://www.trendmicro.com/vinfo/us/security/news/security-technology/security-101-the-rise-of-fileless-threats-that-abuse-powershell)\n[Regularly patch and keep the system and its applications updated to prevent attackers](https://www.trendmicro.com/vinfo/us/security/news/vulnerabilities-and-exploits/patching-problems-and-how-to-solve-them)\n[from exploiting possible vulnerabilities; consider virtual patching for legacy/end-of-life](https://www.trendmicro.com/vinfo/us/security/news/virtualization-and-cloud/virtual-patching-in-mixed-environments-how-it-protects-you/)\nsystems\n[Secure the email gateway, given how Cobalt still relies on email as entry point](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/infosec-guide-email-threats)\n[Implement network segmentation and](https://www.trendmicro.com/vinfo/us/security/news/cyber-attacks/protecting-data-through-network-segmentation) [data categorization to thwart lateral movement](https://www.trendmicro.com/vinfo/us/security/news/cyber-attacks/keeping-digital-assets-safe-need-for-data-classification)\nProactively monitor the network and endpoint for anomalous activities; deploy\nfirewalls and [sandbox as well as intrusion detection and prevention systems to reduce](https://www.trendmicro.com/vinfo/us/security/news/security-technology/how-can-advanced-sandboxing-techniques-thwart-elusive-malware)\nattack surface\n\n**_Trend Micro Solutions_**\n\n[Trend Micro XGen™ security provides a cross-generational blend of threat defense](https://blog.trendmicro.com/en_us/business/products/all-solutions.html)\n[techniques against a full range of threats for data centers,](https://blog.trendmicro.com/en_us/business/products/hybrid-cloud/security-data-center-virtualization.html) [cloud environments,](https://blog.trendmicro.com/en_us/business/products/hybrid-cloud/cloud-migration-security.html) [networks,](https://blog.trendmicro.com/en_us/business/products/network.html)\n[and endpoints. It features high-fidelity machine learning to secure the gateway and](https://blog.trendmicro.com/en_us/business/products/user-protection.html) [endpoint](https://blog.trendmicro.com/en_us/business/products/user-protection/sps.html)\ndata and applications, and protects physical, virtual, and cloud workloads. With capabilities\nlike web/URL filtering, behavioral analysis, and custom sandboxing, XGen™ protects against\ntoday’s purpose-built threats that bypass traditional controls, exploit known, unknown, or\n[undisclosed vulnerabilities. Smart, optimized, and connected, XGen™ powers Trend Micro’s](https://blog.trendmicro.com/en_us/business/products/user-protection/sps.html)\nsuite of security solutions: Hybrid Cloud Security User Protection and Network Defense\n\n\n-----\n\n**_Indicators of Compromise (IoCs):_**\n\n_Hashes related to the spear phishing campaign using malicious macro codes (SHA256):_\nEmail attachments/RTF files detected as W2KM_CALLEM.ZGEI-A:\n\nccb1fa5cdbc402b912b01a1838c1f13e95e9392b3ab6cc5f28277c012b0759f9\ndcad7f5135ffa5e98067b46feec2563be8c67934eb3b14ef1aad8ff7fe0892c5\n\nMalicious DLL file detected as TROJ_DROPFCKJS.ZHEI-A\n\ndab05e284a9cbc89d263798bae40c9633ff501e19568c2ca21ada58e90d66891\n\nMalicious JScript file (35CE74A54720.txt) detected as JS_NAKJS.ZGEI-A:\n\n2b4760b5bbe982a7e26af4ee618f8f2dcc67dfe0211f852bf549db457acd262c\n\nMalicious TXT file (README.TXT) detected as JS_GETFO.ZIEI-A:\n\ne9ab3195f3a974861aa1135862f6c24df1d7f5820e8c2ac6e61a1a5096457fc3\n\nBackdoor (RLxF) detected as BKDR_COBALT.ZHEJ-A:\n\n0dedb345d90dbba7e83b2d618c93d701ed9e9037aa3b7c7c58b62e53dab7d2ce\n\n_Hashes related to the spear phishing campaign exploiting CVE-2017-8759: Email_\nattachments/RTF files detected as TROJ_MDROP.ZHEI-A:\n\neb4325ef1cbfba85b35eec3204e7f79e4703bb706d5431a914b13288dcf1d598\na0292cc74ef005b2e5e0889d1fc1711f07688b93b16ebc3174895d7752a16a23\n94155a2940a1d49a92a602a5232f156eeb1d35018847edb9c6002cefe4c49f94\n69e55d2e3207e29d9efc806ff36f13cd49fb92f7c12f0145f867674b559734a3\n\nMalicious XML file (test.xml) detected as TROJ_CVE20178759.ZIEI-A:\n\n0f5c5d07ed0508875330a0cb89ba3f88c58f92d5b1536d20190df1e00ebd3d91\n\nBackdoor (ZxT6) detected as BKDR_COBALT.ZIEI-A:\n\n9d9d1c246ba83a646dd9537d665344d6a611e7a279dcfe288a377840c31fe89c\n\n_Backdoor (MZBt) detected as BKDR64_COBALT.ZIEI-A:_\n\n**e78e800bc259a46d51a866581dcdc7ad2d05da1fa38841a5ba534a43a8393ce9**\n\n_Related malicious URLs:_\n\nhxxp://visa-fraud-monitoring[.]com/t[.]dll\n\n\n-----\n\nhxxps://webmail[.]microsoft[.]org[.]kz/portal/readme[.]txt\nhxxps://webmail[.]microsoft[.]org[.]kz/portal/ajax[.]php\nhxxp://servicecentrum[.]info/test[.]xml\nhxxps://5[.]135[.]237[.]216[/]RLxF\nhxxps://86[.]106[.]131[.]207[/]ZxT6\nhxxps://86[.]106[.]131[.]207[/]MZB\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-11-20 - Cobalt Strikes Again- Spam Runs Use Macros and CVE-2017-8759 Exploit Against Russian Banks.pdf"
    ],
    "report_names": [
        "2017-11-20 - Cobalt Strikes Again- Spam Runs Use Macros and CVE-2017-8759 Exploit Against Russian Banks.pdf"
    ],
    "threat_actors": [
        {
            "id": "dcba8e2b-93e0-4d6e-a15f-5c44faebc3b1",
            "created_at": "2022-10-25T16:07:23.816991Z",
            "updated_at": "2025-03-27T02:02:09.991944Z",
            "deleted_at": null,
            "main_name": "Lurk",
            "aliases": [],
            "source_name": "ETDA:Lurk",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2dfaa730-7079-494c-b2f0-3ff8f3598a51",
            "created_at": "2022-10-25T16:07:23.474746Z",
            "updated_at": "2025-03-27T02:02:09.822683Z",
            "deleted_at": null,
            "main_name": "Cobalt Group",
            "aliases": [
                "ATK 67",
                "Cobalt Gang",
                "Cobalt Spider",
                "Gold Kingswood",
                "Mule Libra",
                "TAG-CR3"
            ],
            "source_name": "ETDA:Cobalt Group",
            "tools": [
                "ATMRipper",
                "ATMSpitter",
                "Agentemis",
                "AmmyyRAT",
                "AtNow",
                "COOLPANTS",
                "CobInt",
                "Cobalt Strike",
                "CobaltStrike",
                "Cyst Downloader",
                "Fareit",
                "FlawedAmmyy",
                "Formbook",
                "Little Pig",
                "Metasploit Stager",
                "Mimikatz",
                "More_eggs",
                "NSIS",
                "Nullsoft Scriptable Install System",
                "Pony Loader",
                "Ripper ATM",
                "SDelete",
                "Siplog",
                "SoftPerfect Network Scanner",
                "SpicyOmelette",
                "Taurus Builder",
                "Taurus Builder Kit",
                "Taurus Loader",
                "Terra Loader",
                "ThreatKit",
                "VenomKit",
                "cobeacon",
                "win.xloader"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c11abba0-f5e8-4017-a4ee-acb1a7c8c242",
            "created_at": "2022-10-25T15:50:23.744036Z",
            "updated_at": "2025-03-27T02:00:55.537114Z",
            "deleted_at": null,
            "main_name": "Cobalt Group",
            "aliases": [
                "Cobalt Group",
                "GOLD KINGSWOOD",
                "Cobalt Gang",
                "Cobalt Spider"
            ],
            "source_name": "MITRE:Cobalt Group",
            "tools": [
                "Mimikatz",
                "More_eggs",
                "SpicyOmelette",
                "SDelete",
                "Cobalt Strike",
                "PsExec"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536247,
    "ts_updated_at": 1743041768,
    "ts_creation_date": 1653701467,
    "ts_modification_date": 1653701467,
    "files": {
        "pdf": "https://archive.orkl.eu/b12f846b41092452ca6481665527155a653888d6.pdf",
        "text": "https://archive.orkl.eu/b12f846b41092452ca6481665527155a653888d6.txt",
        "img": "https://archive.orkl.eu/b12f846b41092452ca6481665527155a653888d6.jpg"
    }
}