{
    "id": "f2f7272c-494e-4b55-a9b2-3b272e18841e",
    "created_at": "2023-01-12T15:05:36.536309Z",
    "updated_at": "2025-03-27T02:16:26.103633Z",
    "deleted_at": null,
    "sha1_hash": "66c1cf79108d3370653dbee9519ec1b963f8482b",
    "title": "2022-03-08 - Live reverse engineering of a trojanized medical app ‚Äî Android-Joker",
    "authors": "",
    "file_creation_date": "2022-08-18T04:01:09Z",
    "file_modification_date": "2022-08-18T04:01:09Z",
    "file_size": 1201739,
    "plain_text": "# Live reverse engineering of a trojanized medical app ‚Äî Android/Joker\n\n**[cryptax.medium.com/live-reverse-engineering-of-a-trojanized-medical-app-android-joker-632d114073c1](https://cryptax.medium.com/live-reverse-engineering-of-a-trojanized-medical-app-android-joker-632d114073c1)**\n\n@cryptax March 8, 2022\n\n[@cryptax](https://cryptax.medium.com/?source=post_page-----632d114073c1--------------------------------)\n\nMar 8\n\n\n5 min read\n\nA few days ago, a [tweet reporting an Android malware caught my attention, because it was](https://twitter.com/ReBensk/status/1500700786614931458)\napparently found inside a health-related application named ‚ÄúHealth Index Monitor‚Äù.\n\n\n-----\n\n## A tour inside Cordova‚Ä¶\n\nThe name of the package is `com.monotonous.healthydiat, and the main activity is`\n```\ncom.monotonous.healthydiat.MainActivity . Its code is extremely simple, and we\n\n```\nquickly recognize the use of Cordova:\n```\npublic class MainActivity extends CordovaActivity {   //\norg.apache.cordova.CordovaActivity, android.app.Activity  public void\nonCreate(Bundle savedInstanceState) {    super.onCreate(savedInstanceState);   \nloadUrl(this.launchUrl);  }}\n\n```\n\n-----\n\n_Cordova is a (not malicious) framework for creating cross-platform mobile apps using web_\ntechnologies, meaning that the app‚Äôs code is not to be found in the DEX, but within assets\nweb pages:\n\nThe app‚Äôs main entry point is in the assets: www/index.html\nHalf grumbling because I don‚Äôt like to read web files, I started poking into them, and found\nthey were reaching out to a health website. At the time of my analysis, this website was\ndown and could have hosted malicious code, but it just didn‚Äôt sound like what I‚Äôd expect from\na malware.\n\n## A dynamically loaded DEX!\n\nI continued inspecting the APK and noticed DroidLysis said the app was using\n```\nDexClassLoader, a well-know class for dynamically loading Dalvik Executables, and often\n\n```\nused by malware to hide and run malicious payload.\n\nDex class loading apparently occurred in class `b/a/b$a, for sure an obfuscated name, but`\nI wondered how we got there, the `MainActivity being so small.`\n\nActually, the call occurs before the main activity, from the `App class which extends`\n```\nApplication (this is a known ‚Äútrick‚Äù used by packers). And there I saw the call new\nb(...)\n\n```\n\n-----\n\n```\nimport a.b.a.c;\nimport android.app.Application;\nimport b.a.b;\n App Application {  @Override    onCreate() {    .onCreate();     b(\nc().getContext()).setGravity(100);  }}\n\n## Frida hook\n\n```\nTo get the payload DEX, we need to retrieve the DEX which is provided to the\n```\nDexClassLoader constructor. As usual, I created a Frida hook and ran the malware.\n\n```\nThe payload DEX is /data/user/0/com.monotonous.healthydiat/app_/v1\nThe `v1 file is the payload DEX üòÉ.`\n\nOnce the DEX is loaded, the packer loads a class named `yin.Chao, and inside that class,`\ncalls a method named `yin .`\n\nUse of reflexion to load method yin() from the dynamically loaded class yin.Chao.\n\n## Reversing v1, the dynamically loaded DEX\n\nThere are two places to inspect:\n\n\n-----\n\n1. Method `yin from class` `yin.Chao`\n2. A service named `NerService, inside` `com.monotonous.healthydiat, and`\n\nmentioned by the app‚Äôs manifest. This service is implemented in the dynamically\nloaded DEX.\n\nMethod `yin asks for the end-user to grant permissions for` `READ_PHONE_STATE and`\n```\nREAD_CONTACTS, and add the app as a notification listener (this enables the app to read\n\n```\nand interact with any notification). Note that this should sound suspicious to an average endusers: why would a health app need those?!\n\nOnce this is done, `yin` **loads a remote JAR from a remote HTTPS website and calls a**\nmethod named `canbye from` `com.canbye .`\n\nDynamically loading a remote JAR. The JAR should be present inside the app‚Äôs directory,\ninside ./files/logs. If that file does not exist, it is downloaded from the remote HTTPs website\nand stored in logs.\nBefore we reverse the remote JAR, let‚Äôs finish with `NerService . It is a notification listener,`\nand will catch any SMS notification, read the notification‚Äôs text message and send it to via\na custom intent.\n\n\n-----\n\nNotice that onNotificationPosted() is only interested in notifications from SMS. The class\nimplements a post() method which grabs the notification text, broadcasts it and cancels all\nother notifications.\nThis is an interesting way to steal SMS: the malware is not reading the SMS (thus no\nneed for READ_SMS permissions) but reading the!\n\n## Reversing the remote JAR canbye\n\nThis JAR only has a few classes, but they are dense üòâ. Method `canbye initializes a`\nshared preferences file (named `bshwai ) and sets a few entries such as an identifier based`\non the phone‚Äôs Android ID or MAC address.\n\nThen, the malware registers a SMS receiver. It will process all broadcast messages sent by\n```\nv1 (previous layer), store the messages and later sent them in JSON object to a remote\n\n```\nserver. For an uncertain reason, the malware also directly intercepts incoming SMS\nmessages and particularly forwards those beginning with keyword `rch to`\n```\nhxxp://www.canbye.com/op/pair?remote=<int>&device_id=<id> . This is perhaps to\n\n```\nensure the notification for this SMS is not shown to the victim, thus completely hiding the\nSMS.\n\nReport SMS with keyword rch to remote server.\nWe also notice other functionalities such as retrieving the list of accounts on the victim‚Äôs\nphone and sending SMS messages: this depends on what the remote server instruct.\n\nThe `canbye JAR implements a (malicious) Facebook component DEX which can be`\ndownloaded from `hxxps://canbye.oss-accelerate.aliyuncs.com/fbhx<INT> . This is a`\n**fourth stage DEX!!! I haven‚Äôt reversed this one yet.**\n\n\n-----\n\nFour stages for this malware!\nWe notice the first 3 stages with a Frida hook on `java.net.URL and` `DexClassLoader :`\n\nThe cutt.ly URL actually resolves to xni.oss-eu-central-1.aliyuncs.com. The file is\ndownloaded and stored as v1 and loaded. Then, the stage 3 is downloaded from\ncanbye.oss-accelerate.aliyuncs.com, and stored locally as a file named logs. Stage 4\ndownload is not shown here.\nThis malware belongs to the Android/Joker family. The initial APK is detected as\n**[Android/Joker.D!tr.dldr. For more references on the Joker family, please read here,](https://www.zscaler.com/blogs/security-research/joker-playing-hide-and-seek-google-play)** [here](https://www.anquanke.com/post/id/211978)\n[and here.](https://medium.com/csis-techblog/analysis-of-joker-a-spy-premium-subscription-bot-on-googleplay-9ad24f044451)\n\n‚Äî the Crypto Girl\n\n## Malicious URLs\n\n IOC\n\n\n-----\n\n```\n5613c51caf6bece9356f238f2906c54eaff08f9ce57979b48e8a113096064a46 (this is\n\n```\nthe APK)\n\n`0058f2bfc383c164f4263bf0ed6e9252b20c795ace57ca7b686b6133d183bb42` (this\nis the payload DEX, named `v1 )`\n```\n2da5ad942435714f52204d6955f7ae941d959dc275df75acd6aa15bfe81e653b (this is\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-08 - Live reverse engineering of a trojanized medical app ‚Äî Android-Joker.pdf"
    ],
    "report_names": [
        "2022-03-08 - Live reverse engineering of a trojanized medical app ‚Äî Android-Joker.pdf"
    ],
    "threat_actors": [
        {
            "id": "760f2827-1718-4eed-8234-4027c1346145",
            "created_at": "2023-01-06T13:46:38.670947Z",
            "updated_at": "2025-03-27T02:00:02.888195Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Thallium",
                "G0086",
                "APT43",
                "Springtail",
                "Sparkling Pisces",
                "Velvet Chollima",
                "Black Banshee",
                "Operation Stolen Pencil",
                "Emerald Sleet",
                "THALLIUM"
            ],
            "source_name": "MISPGALAXY:Kimsuky",
            "tools": [
                "RevClient",
                "xrat",
                "QUASARRAT",
                "RDP Wrapper",
                "TightVNC",
                "BabyShark"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "191d7f9a-8c3c-442a-9f13-debe259d4cc2",
            "created_at": "2022-10-25T15:50:23.280374Z",
            "updated_at": "2025-03-27T02:00:55.423485Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Kimsuky",
                "Black Banshee",
                "Velvet Chollima",
                "Emerald Sleet",
                "THALLIUM",
                "APT43",
                "TA427"
            ],
            "source_name": "MITRE:Kimsuky",
            "tools": [
                "schtasks",
                "Amadey",
                "Brave Prince",
                "CSPY Downloader",
                "gh0st RAT",
                "AppleSeed",
                "NOKKI",
                "QuasarRAT",
                "Gold Dragon",
                "PsExec",
                "KGH_SPY",
                "Mimikatz",
                "BabyShark"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "71a1e16c-3ba6-4193-be62-be53527817bc",
            "created_at": "2022-10-25T16:07:23.753455Z",
            "updated_at": "2025-03-27T02:02:09.963016Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "APT 43",
                "Black Banshee",
                "Emerald Sleet",
                "ITG16",
                "KTA082",
                "Kimsuky",
                "Larva-24005",
                "Operation Baby Coin",
                "Operation Covert Stalker",
                "Operation DEEP#DRIVE",
                "Operation DEEP#GOSU",
                "Operation Kabar Cobra",
                "Operation Mystery Baby",
                "Operation Red Salt",
                "Operation Smoke Screen",
                "Operation Stealth Power",
                "Operation Stolen Pencil",
                "SharpTongue",
                "Sparkling Pisces",
                "Springtail",
                "TA406",
                "TA427",
                "Thallium",
                "UAT-5394",
                "Velvet Chollima"
            ],
            "source_name": "ETDA:Kimsuky",
            "tools": [
                "AngryRebel",
                "AppleSeed",
                "BITTERSWEET",
                "BabyShark",
                "BoBoStealer",
                "CSPY Downloader",
                "Farfli",
                "FlowerPower",
                "Gh0st RAT",
                "Ghost RAT",
                "Gold Dragon",
                "GoldDragon",
                "GoldStamp",
                "JamBog",
                "KGH Spyware Suite",
                "KGH_SPY",
                "KPortScan",
                "KimJongRAT",
                "Kimsuky",
                "LATEOP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Lovexxx",
                "MailPassView",
                "Mechanical",
                "Mimikatz",
                "MoonPeak",
                "Moudour",
                "MyDogs",
                "Mydoor",
                "Network Password Recovery",
                "PCRat",
                "ProcDump",
                "PsExec",
                "ReconShark",
                "Remote Desktop PassView",
                "SHARPEXT",
                "SWEETDROP",
                "SmallTiger",
                "SniffPass",
                "TODDLERSHARK",
                "TRANSLATEXT",
                "Troll Stealer",
                "TrollAgent",
                "VENOMBITE",
                "WebBrowserPassView",
                "xRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535936,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1660795269,
    "ts_modification_date": 1660795269,
    "files": {
        "pdf": "https://archive.orkl.eu/66c1cf79108d3370653dbee9519ec1b963f8482b.pdf",
        "text": "https://archive.orkl.eu/66c1cf79108d3370653dbee9519ec1b963f8482b.txt",
        "img": "https://archive.orkl.eu/66c1cf79108d3370653dbee9519ec1b963f8482b.jpg"
    }
}