{
    "id": "efa2bc39-4029-4750-8f31-51d01ddb7ff7",
    "created_at": "2023-02-16T02:07:03.942042Z",
    "updated_at": "2025-03-27T02:05:53.641818Z",
    "deleted_at": null,
    "sha1_hash": "8ee26c294cb4b70f0a16fd3fe4e72680aad8bbed",
    "title": "2020-05-20 - Code injection in running process using ptrace",
    "authors": "",
    "file_creation_date": "2023-02-14T06:23:38Z",
    "file_modification_date": "2023-02-14T06:23:38Z",
    "file_size": 273585,
    "plain_text": "# Code injection in running process using ptrace\n\n**[medium.com/@jain.sm/code-injection-in-running-process-using-ptrace-d3ea7191a4be](https://medium.com/@jain.sm/code-injection-in-running-process-using-ptrace-d3ea7191a4be)**\n\nshashank Jain\n\nJul 25, 2018\n\n\n2 min read\n\n\n\nMay 20, 2020\n\n\nExtending the story of shell code injection (https://medium.com/@jain.sm/shell-codeexploit-with-buffer-overflow-8d78cc11f89b), we showcase a simple example of using ptrace\nto exploit a running process. Shell code is binary code injected into a running process using\nptrace system calls.\n\nPtrace is a system call which can be used to debug/modify another process. We need specific\nprivileges to run ptrace though.\n\nThe exploit is explained as below\n\n1. We create a program which takes as input a pid of the running process and uses\nPTRACE_ATTACH to attach to a running process. The callee is stopped and caller now is in\ncontrol.\n\n2. After attaching we get the registers of the running process using PTRACE_GETREGS. This\nwill also return the instruction pointer, so we know where the callee is in terms of instruction\nexecution.\n\n3. We inject the shell code at the point the RIP (instruction pointer) is. So if we see the\ninject_code method above, we see usage of PTRACE_POKETEXT call which takes as input\npid of the callee, target location (will be RIP of callee process), source (shell code)\n\nIn this example we are not giving control back to the callee.\n\nCode of the caller is shown below\n\n\n-----\n\nDynamic code injection is an activity which can be used for debugging or also for malware\ninjections, as long as we have privileges to run ptrace.\n\n\n-----\n\nThe target process\n\nExecuting the caller to do attach to target and inject code\n\nNow see the callee\n\nYou can see the shell .\n\nThanks to [https://0x00sec.org/t/linux-infecting-running-processes/1097 for presenting this](https://0x00sec.org/t/linux-infecting-running-processes/1097)\nexcellent article on using ptrace for shell code injection.\n\n_Disclaimer : The views expressed above are personal and not of the company I work for._\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Linux/Process Injection/2020-05-20 - Code injection in running process using ptrace.pdf"
    ],
    "report_names": [
        "2020-05-20 - Code injection in running process using ptrace.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1676513223,
    "ts_updated_at": 1743041153,
    "ts_creation_date": 1676355818,
    "ts_modification_date": 1676355818,
    "files": {
        "pdf": "https://archive.orkl.eu/8ee26c294cb4b70f0a16fd3fe4e72680aad8bbed.pdf",
        "text": "https://archive.orkl.eu/8ee26c294cb4b70f0a16fd3fe4e72680aad8bbed.txt",
        "img": "https://archive.orkl.eu/8ee26c294cb4b70f0a16fd3fe4e72680aad8bbed.jpg"
    }
}