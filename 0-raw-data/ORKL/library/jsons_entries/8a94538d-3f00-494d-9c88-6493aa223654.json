{
    "id": "8a94538d-3f00-494d-9c88-6493aa223654",
    "created_at": "2023-01-12T15:00:50.22984Z",
    "updated_at": "2025-03-27T02:09:18.012052Z",
    "deleted_at": null,
    "sha1_hash": "2449590719678485a523f86fe65aaf1741bdb51a",
    "title": "2021-11-16 - Attackers use domain fronting technique to target Myanmar with Cobalt Strike",
    "authors": "",
    "file_creation_date": "2022-05-26T02:39:36Z",
    "file_modification_date": "2022-05-26T02:39:36Z",
    "file_size": 1463086,
    "plain_text": "# Attackers use domain fronting technique to target Myanmar with Cobalt Strike\n\n**[blog.talosintelligence.com/2021/11/attackers-use-domain-fronting-technique.html](https://blog.talosintelligence.com/2021/11/attackers-use-domain-fronting-technique.html)**\n\nBy [Chetan Raghuprasad,](https://twitter.com/cRaghuprasad) [Vanja Svajcer and](https://twitter.com/vanjasvajcer) [Asheer Malhotra.](https://twitter.com/asheermalhotra)\n\n## News Summary\n\nCisco Talos discovered a new malicious campaign using a leaked version of Cobalt\nStrike in September 2021.\nThis shows that Cobalt Strike, although it was originally created as a legitimate tool,\ncontinues to be something defenders need to monitor, as attackers are using it to\nset up attacks.\nThe threat actor in this case uses domain fronting with the Cloudflare Content\nDelivery Network, redirecting a Myanmar government owned-domain to an attackercontrolled server.\nThe threat actor employed the tactic of re-registering reputed domains in their attack\nchains to evade detections.\nThis threat demonstrates several techniques of the MITRE ATT&CK framework,\n[most notably T1202 - Indirect Command Execution, T1027 - Obfuscated Files or](https://attack.mitre.org/techniques/T1202/)\nInformation, [T1105 - Ingress Tool Transfer,](https://attack.mitre.org/techniques/T1105/) [T1071.001 - Application Layer](https://attack.mitre.org/techniques/T1071/001/)\nProtocols:Web Protocols.\n\n## What's New?\n\nCisco Talos discovered a malicious campaign using an obfuscated Meterpreter stager to\ndeploy Cobalt Strike beacons in September 2021. The actor used a domain owned and\n[operated by the Myanmar government, the Myanmar Digital News network, as a](https://www.mdn.gov.mm/en/home) domain\nfront for their beacons.\n\n\n-----\n\nThe evolution of this threat indicates that the attackers have been active since at least\nAugust 2021 using a combination of Meterpreter stagers and Cobalt Strike beacons to\nestablish presence on victim's endpoints.\n\n## How did it work?\n\nThe malware is typically a loader that runs on a victim machine, decodes and executes\nthe Cobalt Strike beacon DLL via reflective injection. It loads several libraries during the\nruntime and generates the beacon traffic according to the embedded configuration file.\nThe configuration file contains the information related to the command and control (C2)\nserver which instructs the victim's machine to send the initial DNS request attempting to\nconnect to the host of the Myanmar government-owned domain www[.]mdn[.]gov[.]mm.\nThe site is hosted behind the Cloudflare content delivery network and the actual C2 traffic\nis redirected to an attacker controlled server test[.]softlemon[.]net based on the HTTP\nhost header information specified in the beacon's configuration data.\n\n## So what?\n\nCobalt Strike has been used by many actors in the past and is a de-facto standard tool for\npost-exploitation activities and pivoting. Attackers use it to deploy a wide range of\npayloads, from commodity malware, to sophisticated state-sponsored activities.\n\nCobalt Strike allows actors to shape the traffic of beacons to mimic legitimate traffic\npatterns. One of the techniques to conceal the traffic from DNS-based filtering is Domain\nFronting. Domain fronting uses legitimate or high-reputation domains to remain\nundetected by defenders. The attacker's choice of Myanmar-specific domains for domain\nfronting may indicate an interest in the geopolitics of this area of the world.\n\nIn this campaign, the actor used staged payloads using the Meterpreter stager, which\ngives an indication that the beacon will be used for further attacks. The defenders should\nbe constantly vigilant and monitor network traffic to [detect Cobalt Strike activities, since it](https://blog.talosintelligence.com/2020/09/coverage-strikes-back-cobalt-strike-paper.html)\nis one of the most commonly used offensive tools by crimeware and APT operators.\n\n## Evolution of the campaign\n\nA study of the evolution of the campaign shows the actor experimenting with different\ncombinations of hosts with the intent of perfecting the domain fronting technique.\n\nThe earliest beacon discovered around the middle of August 2021 contains the C2 URI\nset to test[.]softlemon[.]net while the HTTP Get and Post requests headers are pointing to\ndark-forest-002[.]president[.]workers[.]dev which is a Cloudflare serverless workers\ndomain. The default host header configuration for request contains the host name\ntest[.]softlemon[.]net, which is also used by more recent samples.\n\nAnother sample discovered in late August 2021 consisted of the C2 host URI\nxxx[.]xxxx[.]tk and the host header setting configured to point to test[.]softlemon[.]net.\n\n\n-----\n\nBeginning September 2021, the attackers started using the Myanmar Digital News\ndomain for fronting their beacons. While the default C2 domain was specified as\nwww[.]mdn[.]gov[.]mm, the beacon's traffic was redirected to the de-facto C2\ntest[.]softlemon[.]net via HTTP Get and POST metadata specified in the beacon's\nconfiguration.\n\nThe actor likely changed the configuration to test their infrastructure and the domain\nfronting functionality before launching the attack. Based on the beacon configuration\ntemplate and the real C2 host test[.]softlemon[.]net, we assess with moderate confidence\nthat the samples are created by a single actor.\n\n_Timeline of malware samples first seen in the wild._\n\n## Cobalt Strike beacon configurations\n\nWe extracted the beacon config from the payload that showed us the actor has used\ndifferent values for the User Agent, C2-Server and Host-header in different malwares of\nthis campaign.\n\nThe beacon configuration of samples usually has a User Agent, which is Mozilla\ncompatible and of Windows 7.\n\n## Watermark\n\n\n-----\n\nThe Cobalt Strike watermark is a number generated from the license file and is unique to\na Cobalt Strike license. The watermark on the beacons used in this campaign was\n305419896 (hex: 0x12345678).\n\nThis particular watermark has previously been attributed to a leaked Cobalt Strike version\n[and is unsurprisingly used by other malicious actors, such as Maze ransomware and](https://www.sentinelone.com/labs/enter-the-maze-demystifying-an-affiliate-involved-in-maze-snow/)\n[Trickbot groups, making attribution based on the watermark number impossible. It is](https://www.zscaler.com/blogs/security-research/targeted-attack-leverages-india-china-border-dispute-lure-victims)\ndifficult to assess if the usage of the previously registered expired domain for C2 server\nand the leaked Cobalt Strike point to an increased operational security awareness of the\nactor or to limited resources available to them.\n\n## Domain fronting\n\nThe actor in this campaign has used domain fronting, which is a technique which can use\nhigh reputation domains to conceal the Cobalt Strike command and control traffic. A\ngovernment domain of Myanmar www[.]mdn[.]gov[.]mm was used in this particular\ninstance.\n\nThe fronted domain mdn[.]gov[.]mm is a legitimate domain of Myanmar Digital News, a\nstate-owned digital newspaper. This website has previously been compromised in\nFebruary by the Brotherhood of Myanmar group, a collection of militia groups. Although\nthere are no indications that the previous defacement of the domain by the Brotherhood\nof Myanmar and the campaign described in this post are related, the domain itself is\nclearly of interest to various actors.\n\nDomain fronting can be achieved with a redirect between the malicious server and the\ntarget. Malicious actors may misuse various content delivery networks (CDNs) to set up\nredirects of serving content to the content served by attacker-controlled C2 hosts.\nCloudflare is one of the CDN services that provides its users with a globally distributed\ncache for files hosted on their servers. Cloudflare identifies distributions by the FQDN\nused to request resources. Cloudflare users have the option to use their own subdomain\nand create a DNS record that points to Cloudflare. This subdomain tells Cloudflare to\nassociate that DNS record with a specific distribution.\n\nThe beacon calls home www[.]mdn[.]gov[.]mm,/api/3 and has set the Host header to the\nactual C2 server test[.]softlemon[.]net. The beacon traffic resolves to a Cloudflare IP\naddress. The DNS request that led them there will be lost and relies on other parts of the\nHTTP request, including the Host header and the actual C2 test[.]softlemon[.]net.\n\n\n-----\n\n_Summary of domain fronting of Myanmar government's domain._\n\n## Cobalt Strike payload\n\nThe beacons are of particular interest due to the domain fronting technique using a\ngovernment host as the initial DNS lure. The MITRE ATT&CK framework techniques used\nby this malware are:\n\n[T1202 - Indirect Command Execution](https://attack.mitre.org/techniques/T1202/)\n[T1027 - Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027/)\n[T1105 - Ingress Tool Transfer](https://attack.mitre.org/techniques/T1105/)\n[T1071.001 - Application Layer Protocols:Web Protocols](https://attack.mitre.org/techniques/T1071/001/)\n\nWe also analysed the loader binary to find specifics of its memory loading and\nfunctionality.\n\nWe spotted a suspicious section .kxrt with the packed and encoded malicious code. The\nmalware links several functions at runtime and has the Meterpreter staging code\n\n\n-----\n\nWhen the malware runs, the .tls section runs first, loads the libraries and starts the\nexecution of the malicious code at the entry point in the .kxrt section. The entry point code\ncalls a function to allocate virtual memory in its own process space.\n\n_Function at address 00401550 shows the allocation of virtual memory._\nThe loader next calls the VirtualProtect function to set the virtual memory page\npermissions to Read-Write-Execute and writes the image base of the Cobalt Strike\nbeacon which will be executed in a new thread.\n\n\n-----\n\n_Function sets the virtual memory page permission to Read-Write-Execute._\nWe spotted two libraries linking during runtime. Aside from this, there are several other\nstandard libraries the malware links during the runtime.\n\n_Function that loads library during the runtime._\nAfter allocating the virtual memory and setting the page permissions to Read-WriteExecute, a decryption routine is executed that decrypts the remaining malicious code in\nthe .kxrt section and writes it to the virtual memory.\n\n\n-----\n\n_Decoder routine to decrypt the beacon DLL._\nThe decrypted malicious code is the actual Cobalt Strike beacon. Once decoded, the\nloader's execution jumps to the beginning of the DLL resulting in a reflective-load of the\nbeacon into the loader process memory. This beacon is now responsible for decoding the\nconfiguration.\n\n_Stack view of info loaded from the beacon config._\nThe beacon resolves the proxy by calling WinHTTPGetProxyForUrlEx and\nWinHTTPCreateProxyResolver to bypass the proxy for the URL.\n\n_Function that resolves the victim's system proxy for the URL._\n\n\n-----\n\nSoon after that, the beacon initiates the Cobalt Strike beacon traffic to the C2 server. The\nDNS request for the initial host resolves to a Cloudflare-owned IP address that allows the\nattacker to employ domain fronting and send the traffic to the actual C2 host\ntest[.]softlemon[.]net, also proxied by Cloudflare.\n\nAt the time of analysis, the sample C2 host infrastructure was not online and we received\na 404 error.\n\n_Cobalt Strike beacon traffic._\nThe beacon contains techniques to detect debuggers using GetTickCount,\nIsDebuggerPresent and the NtDelayExecution call to delay the execution of the malware\nfor evading sandbox-based dynamic analysis systems. The beacon can also manage the\nsystem power policies registry keys to set the minimum and maximum sleep times and\nthe lid open and close action policy.\n\n\n-----\n\n_The beacon modifies the victim s system power and lid open/close policies in the registry._\n\n## Command and control\n\nThe C2 server - test[.]softlemon[.]net is the subdomain of softlemon[.]net. The domain\nsoftlemon[.]net was registered under Google domains until August 2019 and likely\nexpired since then. The malicious actor re-registered this domain on Aug. 5, 2021. The\nSSL certificate for the domain softlemon[.]net with the serial number\n4aa6af6d719bfdd1c6dff3d7b640aed7ee3was issued by Let's Encrypt, a free SSL\ncertificate provider.\n\n[The Talos reputation engine has classified it as an untrusted domain and Cisco Umbrella](https://umbrella.cisco.com/)\nshows a spike in the DNS queries in September 2021. This activity is consistent with the\nevolution of the Cobalt Strike beacons illustrated earlier the attackers started\ninstrumenting beacons fronted with the Digital News domain at the beginning of\nSeptember.\n\n_DNS spike for test[.]softlemon[.]net queries vs dates._\nOur research uncovered that the C2 test[.]softlemon[.]net is a Windows server running\nInternet Information Services (IIS).\n\n\n-----\n\n_IIS service response rendered from the host test[.]softlemon[.]net._\nAccording to Shodan, the IP address 193[.]135[.]134[.]124 hosted by a Russian provider\nmay be the real C2 IP address protected by the Cloudflare infrastructure as the SSL\ncertificate served on port 8443 belongs to Cloudflare and lists the X509v3 Subject\nAlternative Name as DNS:*.softlemon.net.\n\n## Conclusion\n\nDomain fronting is a technique used by attackers to circumvent protection based on DNS\nfiltering. In this campaign, a malicious Cobalt Strike beacon is configured to take\nadvantage of a mechanism used by Cloudflare and other content distribution networks to\ninstruct the proxy about the host to be used for serving the content.\n\nWhen the beacon is launched, it will submit a DNS request for a legitimate highreputation domain hosted behind Cloudflare infrastructure and modify the subsequent\nHTTPs requests header to instruct the CDN to direct the traffic to an attacker-controlled\nhost.\n\nDefenders should monitor their network traffic even to high reputation domains in order to\nidentify the potential domain fronting attacks with Cobalt Strike and other offensive tools.\nXDR tools should be deployed to endpoints in order to detect behavior of Cobalt Strike\nloaders and Meterpreter stagers as they are frequently used by a wide range of actors.\n\n## Coverage\n\nWays our customers can detect and block this threat are listed below.\n\n\n-----\n\n[Cisco Secure Endpoint (formerly AMP for Endpoints) is ideally suited to prevent the](https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/index.html)\n[execution of the malware detailed in this post. Try Secure Endpoint for free here.](https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/free-trial.html?utm_medium%3Dweb-referral?utm_source%3Dcisco%26utm_campaign%3Damp-free-trial%26utm_term%3Dpgm-talos-trial%26utm_content%3Damp-free-trial)\n[Cisco Secure Firewall (formerly Next-Generation Firewall and Firepower NGFW)](https://www.cisco.com/c/en/us/products/security/firewalls/index.html)\n[appliances such asThreat Defense Virtual,Adaptive Security Appliance andMeraki MX](https://www.cisco.com/c/en/us/products/collateral/security/firepower-ngfw-virtual/datasheet-c78-742858.html)\ncan detect malicious activity associated with this threat.\n[Cisco Secure Malware Analytics (formerly Threat Grid) identifies malicious binaries and](https://www.cisco.com/c/en/us/products/security/threat-grid/index.html)\nbuilds protection into all Cisco Secure products.\n[Umbrella, Cisco's secure internet gateway (SIG), blocks users from connecting to](https://umbrella.cisco.com/)\nmalicious domains, IPs and URLs, whether users are on or off the corporate network.\n[Sign up for a free trial of Umbrella here.](https://signup.umbrella.com/?utm_medium%3Dweb-referral?utm_source%3Dcisco%26utm_campaign%3Dumbrella-free-trial%26utm_term%3Dpgm-talos-trial%26utm_content%3Dautomated-free-trial)\n\nThe following ClamAV signatures have been released to detect this threat:\nWin.Backdoor.CobaltStrike-9909816-0\n\nOpen Source Snort Subscriber Rule Set customers can stay up to date by downloading\n[the latest rule pack available for purchase onSnort.org.](http://snort.org/)\n\n## IOCs\n\n Hashes\n\n658d550322cefa6efc51fbfd1a3e02839d1e519a20f8f17f01c534c0eaf36f27\n\ne806e55713b9e46dc7896521ffb9a8b3abaa597147ea387ff2e93a2469546ba9\n\na0aec3e9cb3572a71c59144e9088d190b4978056c5c72d07cb458480213f2964\n\n## Network IOCs\n\n Hosts\n\ntest[.]softlemon[.]net\n\ndark-forest-002.president[.]workers[.]dev\n\n## IP addresses\n\n193[.]135[.]134[.]124\n\n## URLs\n\nhxxp://test[.]softlemon[.]net:8081/api/3\n\nhxxp://test[.]softlemon[.]net/\n\ntcp://test[.]softlemon[.]net:8080/\n\nhxxps://193[.]135[.]134[.]124:8443\n\nhxxp://193[.]135[.]134[.]124:8080\n\nhxxp://193[.]135[.]134[.]124:8081\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-16 - Attackers use domain fronting technique to target Myanmar with Cobalt Strike.pdf"
    ],
    "report_names": [
        "2021-11-16 - Attackers use domain fronting technique to target Myanmar with Cobalt Strike.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535650,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653532776,
    "ts_modification_date": 1653532776,
    "files": {
        "pdf": "https://archive.orkl.eu/2449590719678485a523f86fe65aaf1741bdb51a.pdf",
        "text": "https://archive.orkl.eu/2449590719678485a523f86fe65aaf1741bdb51a.txt",
        "img": "https://archive.orkl.eu/2449590719678485a523f86fe65aaf1741bdb51a.jpg"
    }
}