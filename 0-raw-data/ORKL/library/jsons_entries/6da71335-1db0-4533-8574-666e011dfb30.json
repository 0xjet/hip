{
    "id": "6da71335-1db0-4533-8574-666e011dfb30",
    "created_at": "2023-01-12T15:01:01.319567Z",
    "updated_at": "2025-03-27T02:05:52.132428Z",
    "deleted_at": null,
    "sha1_hash": "e1d7fdc767142b536c203686c6882852f86d08dc",
    "title": "2020-12-17 - Reassembling Victim Domain Fragments from SUNBURST DNS",
    "authors": "",
    "file_creation_date": "2022-05-28T02:39:03Z",
    "file_modification_date": "2022-05-28T02:39:03Z",
    "file_size": 139686,
    "plain_text": "# Reassembling Victim Domain Fragments from SUNBURST DNS\n\n**netresec.com/**\n\nErik Hjelmvik\n\n,\n\nThursday, 17 December 2020 22:30:00 (UTC/GMT)\n\n\nDecember 17, 2020\n\n\nWe are releasing a free tool called SunburstDomainDecoder today, which is created in order\nto help CERT organizations identify victims of the trojanized SolarWinds software update,\nknown as SUNBURST or Solorigate.\n\nSunburstDomainDecoder can be fed with DNS queries to avsvmcloud.com in order to reveal\nthe full internal domain names of infected companies and organizations.\n\n**UPDATE December 18, 2020 (v1.1)**\n\nSunburstDomainDecoder has now been updated to automatically reassemble fragmented\ndomain name segments in order to show the full domain in the output.\n\n**UPDATE December 19, 2020 (v1.2)**\n\nDomain names that have been base32 encoded, such as domain names with uppercase\nletters, can now be extracted with SunburstDomainDecoder. The queried SUNBURST\nsubdomains are now also included in the output.\n\n**UPDATE December 21, 2020 (v1.6)**\n\n\n-----\n\nImproved parsing of base32 encoded domain names. SUNBURST victim domains like\n\"LKDataCenter.com\", \"Sunkistgrowers.com\" and \"BrokenArrow.Local\" can now be extracted.\n\n**UPDATE December 27, 2020 (v1.7)**\n\nImproved reassembly of long domain names, like \"CIMBMY.CIMBDomain.com\" and\n\"BE.AJINOMOTO-OMNICHEM.AD\", that get segmented into multiple parts. Extraction of\n[time stamps and security applications, including \"Windows Defender\", \"Carbon Black\",](https://netresec.com/?b=20C1c3b)\n\"CrowdStrike\", \"FireEye\", \"ESET\" and \"F-Secure\". See Sergei Shevchenko's blog post\n[Sunburst Backdoor, Part III: DGA & Security Software for more details.](https://blog.prevasio.com/2020/12/sunburst-backdoor-part-iii-dga-security.html)\n\n**UPDATE January 4, 2021 (v1.8)**\n\nSecurity products (WinDefend, ESET etc.) are now included in the summary output at the\nend. SUNBURST stage2 victims, which accept C2 domains in CNAME responses, are\n[indicated with a \"STAGE2\" tag. The previous release marked stage2 queries with a](https://netresec.com/?b=2113a6a)\n\"DNSSEC\" tag. Improved extraction of truncated base32 domains, such as \"*TED.com\".\n\n**UPDATE January 12, 2021 (v1.9)**\n\nDNS queries with encoded timestamps are tagged with either \"AVProducts\" or \"Ping\",\ndepending on if they include an update of the installed/running security products and\nservices or not. The summary data at the end has been modified to also show partial domain\nnames, such as \"paloaltonetworks*\".\n\n**UPDATE February 16, 2021 (v2.0)**\n\nSlightly faster and even more accurate than previous versions.\n\n[Download SunburstDomainDecoder.zip](https://www.netresec.com/files/SunburstDomainDecoder.zip)\n\n**SUNBURST DNS Traffic**\n\nSUNBURST victims, who have installed one of the trojanized SolarWinds Orion software\nupdates, will query for domain names formatted like this:\n\n<SUBDOMAIN>.appsync-api.eu-west-1.avsvmcloud.com\n<SUBDOMAIN>.appsync-api.us-west-2.avsvmcloud.com\n<SUBDOMAIN>.appsync-api.us-east-1.avsvmcloud.com\n<SUBDOMAIN>.appsync-api.us-east-2.avsvmcloud.com\n\nThe \"SUBDOMAIN\" string has different values for each victim and the second half of this\nstring actually contains an encoded domain name (encrypted with a simple substitution\ncipher).\n\n**RedDrip's decode.py**\n\n\n-----\n\n[The RedDrip Team published a SUNBURST DGA decoding script yesterday, which can be](https://twitter.com/RedDrip7/status/1339168187619790848)\nused to identify SUNBURST victim organizations like CISCO and Belkin by decoding the\ndomain names encoded in the outgoing DNS queries for subdomains of avsvmcloud.com.\n\n[This is what it looks like when RedDrip's decode.py script is fed with domain names from](https://github.com/RedDrip7/SunBurst_DGA_Decode)\n[John Bambenek's uniq-hostnames.txt file.](https://github.com/bambenek/research/blob/main/sunburst/uniq-hostnames.txt)\n\ncat uniq-hostnames.txt | python decode.py\n02m6hcopd17p6h450gt3.appsync-api.us-west-2.avsvmcloud.com .gh\n039n5tnndkhrfn5cun0y0sz02hij0b12.appsync-api.us-west-2.avsvmcloud.com ad001.mtk.lo\n04spiistorug1jq5o6o0.appsync-api.us-west-2.avsvmcloud.com isi\n060mpkprgdk087ebcr1jov0te2h.appsync-api.us-east-1.avsvmcloud.com belkin.com\n06o0865eliou4t0btvef0b12eu1.appsync-api.us-east-1.avsvmcloud.com gncu.local\n07605jn8l36uranbtvef0b12eu1.appsync-api.us-east-1.avsvmcloud.com gncu.local\n07q2aghbohp4bncce6vi0odsovertr2s.appsync-api.us-east-1.avsvmcloud.com\ncsnt.princegeor\n07ttndaugjrj4pcbtvef0b12eu1.appsync-api.us-east-1.avsvmcloud.com gncu.local\n08amtsejd02kobtb6h07ts2fd0b12eu1.appsync-api.eu-west-1.avsvmcloud.com smgroup.local\n0b0fbhp20mdsv4scwo11r0oirssrc2vv.appsync-api.us-east-2.avsvmcloud.com ville.terrebonn\n\n[...]\n\nThe beauty of this approach is that passive DNS data can be used in order to reliably identify\nthe victims. This is great news for national CERTs, because they typically have readily\naccess to passive DNS data and can use the decoded domain names in order to identify and\nreach out to victims in their country.\n\nAfter using the python script provided by ReadDrip Team I noticed two things:\n\n1. The leaked domain names were internal domain names used on the victim\n\norganizations' corporate networks. Many of the domains were using the \".local\" suffix.\n2. Most of the extracted domains were truncated to around 15 bytes, which make it\n\ndifficult to identify the victim organization.\n\n**Truncated Domains** **Fragmented Domains**\n\nI later learned that what seemed to be truncated domains were actually fragmented domains,\nwhere long domain names would be split into multiple queries. This revelation turns the\noutput from RedDrip's python tool into an interesting domain name puzzle. At this point I\ndecided to take a closer look at the malicious SolarWinds update I had downloaded from\nSolarWind's website a few days ago -- yes, that's right the malicious software update\n\"SolarWinds-Core-v2019.4.5220-Hotfix5.msp\" (MD5:\n[02af7cec58b9a5da1c542b5a32151ba1) was actually available for download from](https://www.virustotal.com/gui/file/d0d626deb3f9484e649294a8dfa814c5568f846d5aa02d4cdad5d041a29d5600/detection)\nSolarWinds' website long after they had been notified about their software being backdoored!\n\n\n-----\n\nAs an example, lets take a closer look at this DNS query from John Bambenek s passive\nDNS data:\nr1qshoj05ji05ac6eoip02jovt6i2v0c.appsync-api.us-west-2.avsvmcloud.com\n\nThis query can be broken down into three parts:\n\n1. r1qshoj05ji05ac6 : What is encoded here???\n2. eoip02jovt6i2v0c : Base32 encoded string \"city.kingston.\"\n3. .appsync-api.us-west-2.avsvmcloud.com : DNS trailer without encoded data\n\nSo, which \"City of Kingston\", or \"Kingston City\", should we contact to let them know that they\nhave installed a trojanized SolarWinds update? Is it [Kingston Jamaica,](https://www.visitjamaica.com/plan-your-trip/explore-the-island/kingston/) City of Kingston NY\nUSA, [City of Kingston Ontario Canada,](https://www.cityofkingston.ca/) [Kingston City Tennessee USA or](https://kingstontn.gov/) City of Kingston\nAustralia?\n\nAfter analyzing the \"SolarWinds.Orion.Core.BusinessLayer.dll\" file (MD5:\n[b91ce2fa41029f6955bff20079468448) from the \"SolarWinds-Core-v2019.4.5220-](https://www.virustotal.com/gui/file/32519b85c0b422e4656de6e6c41878e95fd95026267daab4215ee59c107d6c77/detection)\nHotfix5.msp\" I learned that the initial \"r1qshoj05ji05ac6\" string is representing a unique\n\"GUID\" value for the infected machine. This GUID is generated by calculating an MD5 hash\nof the MAC address of the first active non-Loopback network interface, the domain name and\nthe \"MachineGuid\" registry key value in\n\"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\".\n\nThis MD5 hash is then squeezed into a tiny 8 byte array by XOR'ing overlapping bytes. The\n\"CreateSecureString\" function in the trojanized SolarWinds update then \"encrypts\" this hash\nusing XOR with a random key, which is prepended to the data. The XOR key and the\nXOR'ed data is then finally base32 encoded into what makes up the first part of the\nsubdomain to query for. Don't let the SUNBURST source code below fool you, it is actually\nusing base32 encoding with a custom alphabet even though the function is called\n\"Base64Encode\";\n\n\n-----\n\n_Image: SUNBURST source code generates a random value between 1 and 127 as XOR key_\n\nEach DNS lookup from an infected machine will query for a unique subdomain because a\nnew XOR key will be generated for each request. Luckily for us, this XOR key is provided in\neach request, so we can use it in order to \"decrypt\" the subdomain and get the original 8\nbytes derived from the MAC+domain+MachineGuid MD5 hash.\n\nThe output from my \"SunburstDomainDecoder.exe\" tool will print the \"decrypted\" 8 byte\nGUID in the first column, the decoded victim domain segment or timestamp in the second\ncolumn and the queried SUNBURST subdomain in the last column. Each DNS query line\nread from standard input will generate a \"GUID DecodedHostname SunburstSubdomain\" line\non standard output.\n\nSunburstDomainDecoder.exe < uniq-hostnames.txt\nF18613981DEC4D1A 2020-10-02T21:00:00.0000000Z 02m6hcopd17p6h450gt3\nBD6DEFBBE9FEA3A9 ad001.mtk.lo 039n5tnndkhrfn5cun0y0sz02hij0b12\n2BF8DE15406EA780 2020-08-25T03:00:00.0000000Z 043o9vacvthf0v95t81l\n573DEB889FC54130 2020-08-13T21:00:00.0000000Z,\nWindowsDefender_RUNNING,CrowdStrike_RUNNING 04jrge684mgk4eq8m8adfg7\n518092C8FD571806 2020-06-09T22:30:00.0000000Z 04r0rndp6aom5fq5g6p1\nF18613981DEC4D1A 2020-07-06T08:30:00.0000000Z 04spiistorug1jq5o6o0\nBC1CB013239B4B92 2020-04-25T10:00:00.0000000Z 05q2sp0v4b5ramdf71l7\n3ED2E979D53B2523 belkin.com 060mpkprgdk087ebcr1jov0te2h\n4225A5C345C1FC8E gncu.local 06o0865eliou4t0btvef0b12eu1\n\n[...]\n\nThe tool then finishes off by outputting the domains that are complete or at least have the\nlast part of their domain intact. Some of these domains are complete because they were\nshort enough to fit in one single SUNBURST DNS query, while others have been pieced\n\n\n-----\n\ntogether by SunburstDomainDecoder from domain fragments arriving in separate\nSUNBURST DNS queries.\n\n[...]\nF59BBAACBA3493C0 dufferincounty.on.ca\nF5D6AA262381B084 glu.com\nF9024D5B1E9717C6 gyldendal.local\nF90BDDB47E495629 central.pima.gov\nF956B5EF56BCF666 coxnet.cox.com\nF9A9387F7D252842 city.kingston.on.ca\nFB0B50553BC00DED gloucesterva.net\nFBB6164BC2B0DFAD ARYZTA.COM\nFD04AC52C95A1B0A bmrn.com\nFDFCAB8E4C0AB3EE ansc.gob.pe\nFE7FF8C9104A0508 thoughtspot.int\nFF6760F36DB3D7DC smes.org\n\nWe can now see that it was \"city.kingston.on.ca\", (City of Kingston, Ontario, Canada) who\nhad installed a trojanized SolarWinds update.\n\n**Download SunburstDomainDecoder**\n\nThe C# source code and a compiled Windows binary for SunburstDomainDecoder is\navailable here:\n[https://www.netresec.com/files/SunburstDomainDecoder.zip](https://www.netresec.com/files/SunburstDomainDecoder.zip)\n\n[The source code and Windows binary is shared under a Creative Commons CC-BY license,](https://creativecommons.org/licenses/by/2.0/)\nwhich means that you are free to:\n\nShare : copy and redistribute the material in any medium or format\nAdapt : remix, transform, and build upon the material for any purpose, even\ncommercially.\n\nProvided that you give appropriate credit, provide a link to the license, and indicate if\nchanges were made.\n**Running SunburstDomainDecoder on Linux/MacOS**\n\n\n-----\n\nWanna run SunburstDomainDecoder.exe but not in Windows? No problems, the tool runs\nperfectly fine in [Mono. Another option is to build SunburstDomainDecoder.cs as a](https://www.mono-project.com/) .NET core\nproject in Linux.\n\n**.NET Reversing**\n\nWould you like to verify my findings or learn more about .NET reverse engineering? Cool,\n[then I'd recommend that you download dnSpy in order to reverse engineer the SUNBURST](https://github.com/dnSpy/dnSpy)\n.NET DLL (which can be extracted from the msp installer with 7zip). Or you can have a look\n[at the already extracted OrionImprovementBusinessLayer.cs on GitHub.](https://github.com/cadosecurity/MalwareAnalysis/blob/3daecfaa9c8f3257a9da2ab13006b1ebb3a82329/OrionImprovementBusinessLayer.cs)\n\nPosted by Erik Hjelmvik on Thursday, 17 December 2020 22:30:00 (UTC/GMT)\n\n[Tags: #SunburstDomainDecoder #SUNBURST #SolarWinds #Solorigate #domain #DNS](https://www.netresec.com/?page=Blog&tag=SunburstDomainDecoder)\n[#pDNS #Windows Defender #Carbon Black #FireEye #ESET #F-Secure #Trojan](https://www.netresec.com/?page=Blog&tag=pDNS)\n[#avsvmcloud](https://www.netresec.com/?page=Blog&tag=avsvmcloud)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-17 - Reassembling Victim Domain Fragments from SUNBURST DNS.pdf"
    ],
    "report_names": [
        "2020-12-17 - Reassembling Victim Domain Fragments from SUNBURST DNS.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535661,
    "ts_updated_at": 1743041152,
    "ts_creation_date": 1653705543,
    "ts_modification_date": 1653705543,
    "files": {
        "pdf": "https://archive.orkl.eu/e1d7fdc767142b536c203686c6882852f86d08dc.pdf",
        "text": "https://archive.orkl.eu/e1d7fdc767142b536c203686c6882852f86d08dc.txt",
        "img": "https://archive.orkl.eu/e1d7fdc767142b536c203686c6882852f86d08dc.jpg"
    }
}