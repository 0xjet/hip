{
    "id": "c9acfc88-6f0e-4ded-94f3-8e6985871d86",
    "created_at": "2023-01-12T15:06:56.939365Z",
    "updated_at": "2025-03-27T02:05:42.673647Z",
    "deleted_at": null,
    "sha1_hash": "272087da1b654696f79078fa6ecdf545da1833c2",
    "title": "2021-11-02 - Underminer Exploit Kit- The More You Check The More Evasive You Become",
    "authors": "",
    "file_creation_date": "2022-05-29T10:38:01Z",
    "file_modification_date": "2022-05-29T10:38:01Z",
    "file_size": 2491864,
    "plain_text": "# Underminer Exploit Kit: The More You Check The More Evasive You Become\n\n**[blog.minerva-labs.com/underminer-exploit-kit-the-more-you-check-the-more-evasive-you-become](https://blog.minerva-labs.com/underminer-exploit-kit-the-more-you-check-the-more-evasive-you-become)**\n\n[Tweet](https://twitter.com/share)\n\n\n-----\n\nThe Underminer exploit kit has surfaced numerous times since 2019, but here it is back\n[again delivering the Amadey malware, as the Malwarebytes Threat Intelligence team found](https://twitter.com/MBThreatIntel/status/1451614044176076801)\nlast week.\n\n## Exploit Kit\n\nAn exploit kit (EK), or an exploit pack, is a type of toolkit cybercriminals use to attack\nvulnerabilities in systems, for them to be able to distribute malware or perform other\nmalicious activities. Exploit kits are packaged with exploits that can target commonly installed\nsoftware, such as Adobe Flash®, Java®, Microsoft Silverlight®.\n\nA typical exploit kit usually provides a management console, a bunch of vulnerabilities\ntargeted to different applications, and several add-on functions that make it easier for a\ncybercriminal to launch an attack. Exploit kits typically integrate vulnerabilities of popular\napplications, which many users leave poorly patched.\n\nIt can also be used by someone who does not have any experience writing software code for\ncreating, customizing, and distributing malware.\n\n## Underminer Exploit Kit\n\nUnderminer EK was first seen in the wild in 2017, targeting Asian countries by first deploying\nbootkits. This is a malware loaded during the boot process, which controlled the operating\nsystem start up, modifying the system before security components are loaded, for OS\npersistency and then a coinminer at a later stage. Back then, this EK spread by malvertising\nand exploiting browser vulnerabilities. One of the coinminers distributed by this EK was\n[“Hidden Bee” - a covertly running Chinese miner.](https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/)\n\nWhen we dig into the Underminer EK, the authors seem to have a good grasp of antidebugging techniques, as they applied plenty of them. We will discuss some interesting ones\nbelow.\n\nThe first check this EK performs is the use of assembly rdtsc instruction – this instruction is\nused to determine how many CPU ticks have taken place since the processor was reset.\nThis can also be used as an anti-debugging technique. The most common way is to use this\ninstruction to get the current timestamp, save it in a register, then get another timestamp and\ncheck if the delta between the two is below the exact number of ticks that were pre-decided\nby the author. In our sample, the second timestamp and the comparison were carried out\nlong after the first timestamp was saved in the memory:\n\n\n-----\n\n_Figure 1 First Timestamp check_\n\nNext, in case the Avast library is loaded into the running process, the EK detaches the\nDLL_LOAD signal from aswhook.dll (Avast Hook Library) so that Avast AV will not capture\n\nthe later DLL loading event.\n\n_Figure 2 DLL_LOAD Detach_\n\nThe Underminer remaps ntdll.dll and several others, a technique that might be used to\n[bypass User-Mode Hooks.](https://www.first.org/resources/papers/telaviv2019/Ensilo-Omri-Misgav-Udi-Yavo-Analyzing-Malware-Evasion-Trend-Bypassing-User-Mode-Hooks.pdf)\n\nThe kit also checks if one of the following security products are installed under C:\\Program\nData by checking for the existence of the following products’ directories:\n\nAvast Software\nAvira\nKaspersky Lab\nPanda Security\nDoctor Web\nAVG\n360TotalSecurity\nBitDefender\nNorton\nSophos\nComodo\n\n\n-----\n\nIn addition, Underminer EK uses several more popular techniques to check whether the\nprocess is being actively debugged. This EK didn’t perform any anti-vm or anti-emulation\ntechniques.\n\nRequest a demo to learn more about how Minerva Labs preemptively prevents malware\nattacks.\n\nLater, the malware creates a “3e5d740863” folder under\nC:\\Users\\Username\\AppData\\local\\Temp (user’s temporary directory)and copies itself into it.\nThe malware will add a registry key\n‘HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders’ and pass\nthe newly created folder path as a key value, which is a persistency technique in which the\n[folder’s content will be executed at user login, known as MITRE T1547.001.](https://attack.mitre.org/techniques/T1547/001/)\n\nAfter the file copy, the malware will execute the newly copied file and terminate the current\nprocess.\n\nTo become even more persistent in the system, Underminer creates a scheduled task that\nwill execute malicious file every day at 01:00 AM. The scheduled task name is the\nexecutable's name, and it is run with the user's credentials.\n\nOur sample connects two command and control servers, and passes the information of the\ninfected station to them:\n\nThe information being passed is:\n\nVictim ID\nA version of the malware\nPC name\nUsername\nWe assume, the number of binaries installed\n\nThe next stage is to download and execute additional malware. We checked the malware\n[twice and got two different executables; one of them was an Oski Stealer and another new,](https://medium.com/shallvhack/oski-stealer-a-credential-theft-malware-b9bba5164601)\nwell packed .Net stealer.\n\nOski Stealer is a malicious information stealer, which was first introduced in November 2019.\nThe Oski stealer steals personal and sensitive credentials from its target, eventually being\nmisused to clean out the user’s liquid assets.\n\n\n-----\n\nThe second stealer, (with the original name of Licensing.exe ) seems to have some code\n[borrowed from RedLine Stealer. It steals browser credentials, crypto wallets, file share](https://blog.minerva-labs.com/redline-stealer-masquerades-as-telegram-installer?hsLang=en-us)\ncredentials etc. It connects to the command-and-control server via the 16713 TCP port.\n\nAs a side note, info stealers might be co-opted into the cycle of various kinds of attacks, and\nransomware campaigns in particular. While serving a reliable method for criminals to obtain\ncredentials tied to financial accounts, they have also started using ‘information stealers’ to\nobtain corporate remote network login credentials, like virtual private networks (VPNs) or\nremote desktop software. corporate remote network login credentials, like virtual private\nnetworks (VPNs) or remote desktop software.\n\nWithout being dependent on the drop file, Underminer exploit kit creates a new registry key\nto gain persistence over the dropped malware. The key will be added under\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run.\n\nAt the time this blog was published, the command-and-control server was still operating and\ncontinues to distribute different types of malware.\n\n[Minerva Labs Hostile Environment Simulation and Critical Asset Protection modules prevent](https://minerva-labs.com/hostile-environment-simulation)\nthe remap of DLLs required for Underminer exploit kit to carry out its attack, thus preventing\nadditional malware drops.\n\nTo learn more about about malware prevention:\n\n## IOC’s:\n\nHashes:\n\n7a7a128a51a5e153c55481518bdffe67093e94d99845531918ff50875a13e5fe –\ndllhost.exe – Underminer EK\n\n\n-----\n\n0fa23ba39a85ad3a28d71e1d50edc2c39046d2ffe36fb257e8953acee7726924 – vt.zip –\nOski Stealer\neb0c56870fb482ff798dab0048ff1b8a7010f6ce6b769e9ffffc569070898624 – ic.exe\n(Licencing.exe)\n\nDomains:\n\nweb.jsonpost[.]xyz – C&C server\nweb.xmlpost[.]xyz – C&C server\n\nURL’s:\n\nweb.jsonpost[.]xyz/sj2vMs/index.php?scr=1 – C&C server\nweb.xmlpost[.]xyz/sj2vMs/index.php?scr=1 – C&C server\nhttp://169.197.142[.]162/vt.zip - Oski Stealer\n\nIP’s:\n\n169.197.142[.]162 - Underminer C&C\n\n194.124.213[.]221 – Licensing C&C\n\n## References:\n\nhttps://www.bleepingcomputer.com/news/security/new-underminer-exploit-kit-discoveredpushing-bootkits-and-coinminers/\n\n[https://socprime.com/news/underminer-exploit-kit-delivers-hidden-mellifera-malware/](https://socprime.com/news/underminer-exploit-kit-delivers-hidden-mellifera-malware/)\n\n[https://www.aldeid.com/wiki/X86-assembly/Instructions/rdtsc](https://www.aldeid.com/wiki/X86-assembly/Instructions/rdtsc)\n\n[https://www.trendmicro.com/vinfo/us/security/definition/exploit-kit](https://www.trendmicro.com/vinfo/us/security/definition/exploit-kit)\n\n[https://intel471.com/blog/information-stealer-ransomware-account-takeover](https://intel471.com/blog/information-stealer-ransomware-account-takeover)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-02 - Underminer Exploit Kit- The More You Check The More Evasive You Become.pdf"
    ],
    "report_names": [
        "2021-11-02 - Underminer Exploit Kit- The More You Check The More Evasive You Become.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536016,
    "ts_updated_at": 1743041142,
    "ts_creation_date": 1653820681,
    "ts_modification_date": 1653820681,
    "files": {
        "pdf": "https://archive.orkl.eu/272087da1b654696f79078fa6ecdf545da1833c2.pdf",
        "text": "https://archive.orkl.eu/272087da1b654696f79078fa6ecdf545da1833c2.txt",
        "img": "https://archive.orkl.eu/272087da1b654696f79078fa6ecdf545da1833c2.jpg"
    }
}