{
    "id": "b01a7ed8-2937-4d53-b3de-6ca8ca02d6ac",
    "created_at": "2022-10-25T16:48:17.327084Z",
    "updated_at": "2025-03-27T02:16:42.994204Z",
    "deleted_at": null,
    "sha1_hash": "7bd2229f4908ae1cd6b4e19c21d709948c3616ed",
    "title": "",
    "authors": "",
    "file_creation_date": "2016-05-02T03:51:53Z",
    "file_modification_date": "2016-05-02T03:51:53Z",
    "file_size": 2385780,
    "plain_text": "### Mo’ Shells Mo’ Problems – Web Server Log Analysis\n\nMarch 19, 2014 [Chad Tilbury](http://www.crowdstrike.com/blog/author/chadt/) [Research & Threat Intel](http://www.crowdstrike.com/blog/category/threat-intel-research/)\n\nDisclaimer: CrowdStrike derived this information from\n\ninvestigations in unclassified environments. Since we value our\n\nclients’ privacy and interests, some data has been redacted or\n\nsanitized.\n\nWeb shells epitomize the hacking tenant of hiding in plain sight.\n\nIn a previous post, we showed how a web shell could hide as a\n\nsingle file among thousands present on a web server and as a\n\nsingle line of code in an otherwise legitimate page on a site. The\n\nbest web shells are not detected by anti-virus and can defeat\n\nvulnerability scanning applications using novel techniques like\n\ncookie and HTTP header authentication. Identifying the presence\n\nof a web shell can be difficult, but there are effective and\n\nrepeatable ways to find them in your network. Today we will cover\n\nlog review, concentrating on the following techniques:\n\n-   SQL injection identification\n\ni i\n\n\n-----\n\nGet to Know Your Web Logs\n\nGood logging is a requirement for successfully detecting and\n\nmitigating network intrusions. Luckily, web servers have far\n\nbetter logging available by default than other servers in the\n\nenterprise. It is common to find web server logs dating back a\n\nyear or more, but web logs are typically stored in text format and\n\nare particularly at risk for deletion and modification by\n\nattackers. Given their intrinsic value, organizations should aim\n\nfor daily aggregation and centralized archiving of web logs. Their\n\nlocation can be highly dependent on the operating system and\n\nserver version, but the following locations are a good place to\n\nstart:\n\n-   C:inetpublogsLogFiles  (IIS)\n\n-   C:WindowsSystem32LogFiles (IIS)\n\n-   /var/log/httpd/  (Apache)\n\n-   /var/log/apache/ (Apache)\n\nThere are three popular standards for web logging. The\n\ntechniques discussed here will work for any format, but some\n\nformats provide significantly less data to analyze. Apache\n\nservers often employ the NCSA, or Common Log Format. This\n\nformat tends to record less information than others do. The W3C\n\nextended log file format, commonly used by Microsoft IIS,\n\nprovides the most data and is the best-case scenario from a log\n\nanalysis perspective. W3C extended logs can provide additional\n\nhelpful information such as the client query, time duration of the\n\nrequest, and user agent. You may also see the proprietary IIS log\n\nformat, which provides more information than NCSA, but less\n\nthan W3C extended logs.\n\nSQL Injection Identification\n\n[As discussed in earlier posts in this series, Deep Panda is a](http://www.crowdstrike.com/blog/mo-shells-mo-problems-deep-panda-web-shells/index.html)\n\nsophisticated China based threat group CrowdStrike has\n\nobserved targeting companies in the defense, legal,\n\ntelecommunication and financial industries. Deep Panda often\n\n\n-----\n\npoorly patched web servers or web servers running legacy or\n\ncustom applications. Detecting successful SQL injection is an\n\neffective way to identify attacks early in the kill chain. Finding\n\nSQL injection attempts also provides a good starting point for\n\ndiscovering additional malicious activity. Here are a few things\n\nto look for to help narrow the search:\n\n-   Investigate server logs that are significantly larger\n\ncompared to others. SQL injection is very noisy and requires\n\nnumerous connection attempts to a web server to be successful.\n\nAutomated SQL injection tools are particularly noisy. This\n\nactivity can create many large entries, causing the daily logs to\n\nexceed the average size.\n\n-   SQL commands should be a very rare occurrence in\n\nstandard web logs. Search for commands often passed during\n\nSQL injection such as ‘, %27, –, SELECT, INSERT, UNION, CREATE,\n\nDECLARE, CAST, EXEC, and DELETE (this is only a subset and\n\nshould be tailored to your environment). Regular expression\n\nsearching with grep or PowerShell can lead to quick wins.\n\n-   Identify HTTP 500, 404, 403 and 400 status codes that\n\noccur in long successions within your logs. This will help identify\n\nenumeration and patterns typical of SQL injection attacks.\n\n-   On IIS servers, look for references to “cmd.exe” and\n\n“xp_cmdshell” to identify possible privilege escalation due to\n\nsuccessful SQL injection exploitation. Execution of these\n\ncommands is often the ultimate goal of an attacker. If you find\n\nsuccessful entries (HTTP status code 200) containing these\n\ncommands, you likely have a confirmed intrusion.\n\n\n-----\n\nDirectory Enumeration\n\nEnumerating the web server file system is a common way for an\n\nadversary to identify the type of scripting language a web server\n\nis running and what scripts can be used to further escalate\n\nprivileges. Directory enumeration is a noisy technique, and one\n\nof the easiest to spot. In the example below, the IP address\n\n60.166.3.22 enumerated an IIS web server. Shortly after these\n\nrequests, we discovered a successful SQL injection attack\n\nrecorded in the logs.\n\n\n-----\n\nStatistical Web Log Analysis\n\nThere is more to web log analysis than just looking for SQL\n\ninjection patterns and enumeration attacks. Web logs can\n\nstretch back for years and contain hundreds of millions of\n\nentries. To make review feasible, we often use statistical analysis\n\nto analyze web log entries in different ways. Similar to our\n\n[previous post on file system stacking, the goal of statistical](http://www.crowdstrike.com/blog/mo-shells-mo-problems-file-list-stacking/index.html)\n\nanalysis is to identify outliers for further analysis. If you do not\n\nhave an enterprise tool that can do this, Microsoft Log Parser and\n\nLog Parser Lizard (shown below) are fantastic free options. Log\n\nParser takes nearly any log format as input and allows analysis\n\nvia SQL queries.\n\nIn Figure 4 below, we executed a query to collect all successful\n\n(status code 200) .asp and .aspx page requests within the log,\n\ncount them, and then sort by the total number of entries. Web\n\nshells in IIS servers often take the form of .asp pages and we\n\nwere looking for outliers, either in the path or in the number of\n\nhits. As you can see, system_web.aspx is immediately\n\nrecognizable as an outlier based upon its path. In fact, out of ~1.5\n\nmillion log entries on this server, it was the only .aspx page\n\nsuccessfully requested outside of the /owa/ folder. Similar\n\nqueries are useful for other requests such as those referencing\n\n.php, .exe, or .dll files.\n\n\n-----\n\nA second analysis example takes advantage of the W3C extended\n\nlog option to track the amount of time taken by the web server to\n\nprocess a request. Administrators often use this field to optimize\n\nthe server or find problematic and broken pages. We use it to\n\nfind problematic pages of a different type. Because web shells\n\nand other malicious code often contain complicated queries and\n\nrequests, they can take longer to process than an average page\n\nand tend to hang on some requests. Both scenarios cause those\n\npages to bubble up to the top of a list like this, and here we see\n\nour Deep Panda web shell showing up in fourth place on this\n\ncompromised system.\n\n\n-----\n\nSimilar to other analysis techniques, there is no easy button\n\nhere. You may encounter hundreds of false positives before you\n\n##  BLOG\n\nidentify malicious activity or find your first web shell. Where\n\n\npossible, find an administrator or subject matter expert to assist\n\nyou in determining what is normal on your servers. Web logs are\n\na rich data source and possible queries are only limited by your\n\nimagination. As you discover novel queries that help identify evil\n\nin your environment, automate them to create daily reports for\n\nreview.\n\nAdditional Logs\n\nWeb server logs are undoubtedly valuable, but do not\n\nunderestimate the other log sources available on your server.\n\nSystem logs such as Windows event logs or Apache error logs\n\ncan provide deeper insight and help pinpoint when malicious\n\nactivity has occurred. As an example, the Application event log\n\non a compromised IIS server held the event seen in Figure 6. The\n\nevent was logged when a SQL injection attack successfully\n\nexecuted the xp_cmdshell stored procedure. Correlating the\n\ntime and date of this event with the web server logs for that day\n\nallowed reconstruction of the entire attack in a short amount of\n\ntime.\n\n\n-----\n\nServer logs are an invaluable resource for detecting intrusions.\n\nWhile the examples in this post have focused on web shell\n\ndetection, it is important to note that these techniques are\n\nuseful for finding just about any malicious activity on your web\n\nservers. Building a log collection and review process is one of the\n\nmost important things you can do to ensure the health of your\n\nservers.\n\nComing next: In our final post of the four-part series, we will\n\ntransition to network-based detection methods. Registration is\n\nnow open for our April 1, 2014 CrowdCast, Going Beyond the\n\n[Indicator.](https://attendee.gotowebinar.com/register/8497096584722200321)\n\n######  Tweet  Share\n\n\n##### \n\n\n#### Chad Tilbury\n\nChad Tilbury has over 15 years experience investigating\n\ncomputer crimes, specializing in intrusion incident\n\nresponse, digital forensic examinations, and corporate\n\nespionage. His extensive law enforcement and\n\ninternational experience stems from working with a\n\nbroad cross-section of Fortune 500 corporations and\n\ngovernment agencies around the world. As faculty with\n\nthe SANS Institute in digital forensics, Chad is\n\nresponsible for educating thousands of students each\n\nyear in advanced forensics and incident response\n\ntechniques. As Technical Director for CrowdStrike, Chad\n\nprovides leadership for the services team, driving\n\ninnovation to support customers in a variety of\n\n\n-----\n\nAcademy and holds a M.S. and B.S. in Computer Science\n\nand GCFA, GREM, GCIH, ENCE, and CISSP certifications.\n\n\n##### Related Content\n\n\n###### Registry Analysis with CrowdResponse\n\nThe third release\n\nof the\n\n\n###### Peering Around the Corner\n\nAfter the better\n\npart of a decade\n\n\n###### Cyber Kung-Fu: The Great Firewall Art of DNS Poisoning\n\nWing Chun (咏春\n\n拳), the first\n\nChinese martial\n\nart learned by the\n\nlegendary Bruce\n\nLee, is often…\n\n\nfree CrowdResponse incidentchasing\n\n\nresponse\n\ncollection tool is\n\nnow available!\n\nThis time around\n\nwe…\n\n\nadversaries\n\naround the\n\nInternet, there\n\nare a few…\n\n\n[](https://twitter.com/CrowdStrike) [](https://www.linkedin.com/company/crowdstrike) [](https://www.facebook.com/CrowdStrike/) [](http://www.youtube.com/user/CrowdStrike)\n# \n\nCopyright © 2016 CrowdStrike | [Privacy](http://www.crowdstrike.com/privacy-notice/) | [Request Info](http://www.crowdstrike.com/request-information/) | [Blog](http://www.crowdstrike.com/blog) | [Contact Us](http://www.crowdstrike.com/contact-us/) | 1.888.512.8906\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.02.20.deep-panda-webshells/Mo%27%20Shells%20Mo%27%20Problems%20-%20Web%20Server%20Log%20Analysis%20%C2%BB.pdf"
    ],
    "report_names": [
        "Mo' Shells Mo' Problems - Web Server Log Analysis »"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7a9a7873-8e41-40ae-9d06-b27c92bb54e4",
            "created_at": "2022-10-25T16:47:55.568362Z",
            "updated_at": "2025-03-27T02:05:17.264615Z",
            "deleted_at": null,
            "main_name": "BRONZE FIRESTONE",
            "aliases": [
                "C0d0s0",
                "Deep Panda ",
                "Pupa ",
                "TG-3551 ",
                "APT19 "
            ],
            "source_name": "Secureworks:BRONZE FIRESTONE",
            "tools": [
                " Alice's Rabbit Hole",
                " Briba",
                " Cobalt Strike",
                " Derusbi",
                " PlugX",
                " PoisonIvy",
                " Powershell Empire",
                " Zuguo",
                "9002"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2f07a03f-eb1f-47c8-a8e9-a1a00f2ec253",
            "created_at": "2022-10-25T16:07:24.277669Z",
            "updated_at": "2025-03-27T02:02:10.157972Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Operation LagTime IT",
                "Operation StealthyTrident",
                "ThunderCats"
            ],
            "source_name": "ETDA:TA428",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Agent.dhwf",
                "Albaniiutas",
                "BlueTraveller",
                "Chymine",
                "Cotx RAT",
                "CoughingDown",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "LuckyBack",
                "PhantomNet",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "RoyalRoad",
                "SManager",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TManger",
                "TVT",
                "Thoper",
                "Xamtrav",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "64ca1755-3883-4173-8e0a-6e5cf92faafd",
            "created_at": "2022-10-25T15:50:23.636456Z",
            "updated_at": "2025-03-27T02:00:55.51077Z",
            "deleted_at": null,
            "main_name": "Deep Panda",
            "aliases": [
                "Deep Panda",
                "Shell Crew",
                "KungFu Kittens",
                "PinkPanther",
                "Black Vine"
            ],
            "source_name": "MITRE:Deep Panda",
            "tools": [
                "Mivast",
                "StreamEx",
                "Sakula",
                "Tasklist",
                "Derusbi"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46a151bd-e4c2-46f9-aee9-ee6942b01098",
            "created_at": "2023-01-06T13:46:38.288168Z",
            "updated_at": "2025-03-27T02:00:02.794118Z",
            "deleted_at": null,
            "main_name": "APT19",
            "aliases": [
                "Black Vine",
                "TEMP.Avengers",
                "PinkPanther",
                "G0073",
                "KungFu Kittens",
                "Group 13",
                "Shell Crew",
                "BRONZE FIRESTONE",
                "G0009",
                "Sunshop Group",
                "DEEP PANDA",
                "Codoso"
            ],
            "source_name": "MISPGALAXY:APT19",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "0639667a-fb3f-43d9-a38c-6c123fd19c7f",
            "created_at": "2022-10-25T16:07:23.335869Z",
            "updated_at": "2025-03-27T02:02:09.743237Z",
            "deleted_at": null,
            "main_name": "APT 19",
            "aliases": [
                "APT 19",
                "Bronze Firestone",
                "C0d0so0",
                "Codoso",
                "Deep Panda",
                "Operation Kingslayer",
                "Red Pegasus",
                "Sunshop Group",
                "TG-3551"
            ],
            "source_name": "ETDA:APT 19",
            "tools": [
                "Agentemis",
                "C0d0so0",
                "Cobalt Strike",
                "CobaltStrike",
                "Derusbi",
                "EmPyre",
                "EmpireProject",
                "Fire Chili",
                "PowerShell Empire",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716497,
    "ts_updated_at": 1743041802,
    "ts_creation_date": 1462161113,
    "ts_modification_date": 1462161113,
    "files": {
        "pdf": "https://archive.orkl.eu/7bd2229f4908ae1cd6b4e19c21d709948c3616ed.pdf",
        "text": "https://archive.orkl.eu/7bd2229f4908ae1cd6b4e19c21d709948c3616ed.txt",
        "img": "https://archive.orkl.eu/7bd2229f4908ae1cd6b4e19c21d709948c3616ed.jpg"
    }
}