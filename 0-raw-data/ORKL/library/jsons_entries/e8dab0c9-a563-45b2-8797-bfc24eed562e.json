{
    "id": "e8dab0c9-a563-45b2-8797-bfc24eed562e",
    "created_at": "2023-01-12T15:06:45.679278Z",
    "updated_at": "2025-03-27T02:05:26.254803Z",
    "deleted_at": null,
    "sha1_hash": "4abf036a367e855a7b27c19bdbe86959319a305d",
    "title": "2022-04-12 - Attackers linger on government agency computers before deploying Lockbit ransomware",
    "authors": "",
    "file_creation_date": "2022-05-27T21:54:38Z",
    "file_modification_date": "2022-05-27T21:54:38Z",
    "file_size": 718119,
    "plain_text": "# Attackers linger on government agency computers before deploying Lockbit ransomware\n\n**[news.sophos.com/en-us/2022/04/12/attackers-linger-on-government-agency-computers-before-deploying-lockbit-ransomware/](https://news.sophos.com/en-us/2022/04/12/attackers-linger-on-government-agency-computers-before-deploying-lockbit-ransomware/)**\n\nApril 12, 2022\n\nIn an attack where unknown threat actor groups spent at least five months poking around inside the network of a\nregional US government agency, behavioral log data suggests that two or more such groups were active before the\nfinal group deployed a Lockbit ransomware payload earlier this year.\n\nThroughout the period attackers were active on the target’s network, they installed, then used Chrome browser to\nsearch for (and download) hacking tools on the “patient zero” computer, a server, where they made their initial\naccess. Though the attackers deleted many Event Logs from machines they controlled, they didn’t remove them all.\n\n\n-----\n\nReconstructed from logs, analysts\n\nfound evidence the threat actors searched for (then downloaded) tools using a Chrome browser they installed on the\ncompromised server\nSophos was able to piece together the narrative of the attack from those unmolested logs, which provide an intimate\nlook into the actions of a not particularly sophisticated, but still successful, attacker.\n\nFor instance, the logs recorded that the attackers installed various commercial remote-access tools on accessible\nservers and desktops. They appeared to prefer the IT management tool ScreenConnect, but later switched to\nAnyDesk in an attempt to evade our countermeasures. We also found download logs of various RDP scanning,\nexploit, and brute-force password tools, and records of successful uses of those tools, so Windows remote desktop\nwas on the menu, too.\n\nIn addition to various custom scripts and configuration files used by hacking tools the attackers installed, we found a\nwide variety of other malicious software, from password brute-forcers, to cryptominers, to pirated versions of\ncommercial VPN client software. There was also evidence the attackers used freeware tools like PsExec, FileZilla,\nProcess Explorer, or GMER to execute commands, move data from one machine to another, and kill or subvert the\nprocesses that impeded their efforts.\n\nEvidence left behind show\n\nthe attackers using tools like GMER, IObit Unlocker, and Process Hacker to try to disable endpoint protection\nCritically, technicians managing the target network left a protective feature disabled after they completed\nmaintenance. As a result, some systems were left vulnerable to sabotage by attackers, who disabled endpoint\nprotection on the servers and some desktops. With no protection in place, the attackers installed ScreenConnect to\ngive themselves a backup method of remote access, then moved quickly to exfiltrate files from file servers on the\nnetwork to cloud storage provider Mega.\n\n\n-----\n\nThe Lockbit attacker used multiple\n\ninternal RDP connections and the Windows SSH client PuTTY, and installed ScreenConnect, in short order\nOver time, we found that the attackers’ tactics changed, in some cases so drastically it seemed as though an attacker\nwith very different skills had joined the fray. The nature of the activity recovered from logs and browser history files on\nthe compromised server gave us the impression that the threat actors who first broke in to the network weren’t\nexperts, but novices, and that they may later have transferred control of their remote access to one or more different,\nmore sophisticated groups who, eventually, delivered the ransomware payload.\n\n## Reconstructing the attack from logs\n\nAttackers will often delete log data to obfuscate their tracks, and this incident was no exception – the attackers\nmanually deleted nearly all log data about a month prior to investigator discovery. However, a deeper forensic dig\nindicates that the initial compromise occurred nearly half a year before investigators opened their case. The method\nof ingress was nothing spectacular – open RDP ports on a firewall that was configured to provide public access to a\nserver.\n\nFor a while, it was a relatively quiet invasion. The attackers got a lucky break when the account they used to break in\nover RDP was not only a local admin on the server, but also had Domain Administrator permissions, which gave it the\nability to create admin-level accounts on other servers and desktops.\n\nReconstructed through searches of browser and application history logs that remained untouched, Sophos analysts\nwere able to build a picture of a network ill-equipped to resist this type of attack, and attackers who seemed to have\ndone little preparation for what to do beyond gaining initial access.\n\nIn the course of performing the post-attack analysis, Sophos analysts determined that the attackers used the servers\nthey controlled inside the target’s network to perform Google searches for a variety of hacking tools.\n\n\n-----\n\nReconstructed browsing logs show the\n\nthreat actor tried to get RDP Multi Tool from a shady download site, but was beset by aggressive popup ads\nIn some cases, following the search results for these tools led the attackers into a variety of shady download sites.\nThe advertising networks whose banner ads appear on these sites appear to have generated popup ads that\ndelivered a potentially unwanted app download as the attackers clumsily pulled together a selection of attack tools,\nfurther muddying the picture and leaving the server infected with adware, and the browser history cluttered with\nredirects.\n\nAn example of the bogus\n\n“download pages” that delivered a potentially unwanted app to the machine the attacker controlled while they tried to\ndownload hacking tools\nThe forensic traces left behind seem to paint a picture of a novice attacker doing a bit of on-the-job training –\nattempting tool installation (after Googling the tools), opening random text files, and running a surprising number of\nspeed tests, but not moving toward a particular goal or operating with great urgency.\n\n\n-----\n\nSurviving log data indicates the attacker would leave the server unbothered for days at a time, unexpectedly (and\ncounterintuitively) during American holiday periods. When they were on the system, the attacker seemed to rely on a\nlot of the shady variety of public file-sharing services, whose advertisements mimic file download links or buttons in\nan attempt to entice visitors to click their ad instead of the real download button on the page – an ad that typically\nredirects the visitor into a rotating pool of sites pushing junkware.\n\nSome of the evidence shows the attacker either inadvertently clicked one of these fake-download-button ads, or\nsuffered from popup or popunder advertisements that pushed unwanted downloads at the attacker, who then\ninstalled the adware, perhaps thinking it was the real pirated copy of a hack tool they thought they were downloading.\nThese unintentional self-infections created additional noise in the logs.\n\nUnlike many threat actors who pre-configure attack scripts that, for instance, scan networks to determine a target list\nand then run those scripts to deliver payloads to internal machines, the attackers for months seemed content merely\nto poke around and occasionally create a new account on the initial, or another, machine. Some of the attacks\noriginated from the Desktop folder of the user account the attackers initially compromised, but others involved adminlevel accounts the attackers created with names like ASP.NET or SQL.NET.\n\n## Pivot to a more serious attack\n\nIn the fifth month of the infiltration, however, the attacker behavior dramatically changed. After a three-week hiatus,\nlogs indicate that an attacker remotely connected and installed the password-sniffing tool Mimikatz. Sophos\nprotections saw it happen, and cleaned a first attempt at infection. Unfortunately, the IT department didn’t heed the\nwarning, and the attacker’s later attempt to run Mimikatz via a compromised account was successful. (The attackers\nalso attempted to gather credentials using a different tool called LaZagne.)\n\nEvidence shows the attackers ran\n\nMimikatz on the “Patient Zero” machine’s Administrator account desktop\nThe credential-dumping application did its work, and within a couple of days, the attackers had a password.txt file\nsitting on the desktop of the admin-level accounts they’d created on the compromised server. This marks a turning\npoint of sorts in the investigation; at this point, one must assume that any account that had logged into the troubled\n\n\n-----\n\nserver was indeed compromised, credentials exposed.\n\nAnd something else happened: On the same day the passwords.txt file appeared, someone decided to do a bit of\ntidying up. The initial threat actor, or a newer threat actor, visited websites looking for instructions to uninstall a\nmalicious coinminer that, earlier, had been installed on the beleaguered server.\n\nScouring log data is a conventional move for an attacker, even one with less dwell time than the attacker in this case.\nWiping logs eliminates useful forensic information about the intrusion. The attacker used a compromised account to\nclear the WitnessClientAdmin, Windows PowerShell, and System logs. By the end of the attack, no event logs prior to\nabout five weeks before the end would be available on the system.\n\nThe attacker also spotted the Sophos endpoint installation and tried (unsuccessfully) to remove those as well, using a\nvariety of tools like GMER and IOBit Uninstaller. Via yet another compromised account, the attacker(s) installed an\nassortment of popular brute-force and proxy tools including NLBrute.\n\nA partial list of maliciously used tools discovered on the compromised system includes the following. It should be\nnoted that not all of these are inherently malicious tools, nor are they all surprising to find on healthy, uninfected\nmachine.\n\nAdvanced Port Scanner Scans to find network devices\n\nAnyDesk Remote desktop application\n\nLaZagne Allows users to view and save authentication credentials\n\nMimikatz Allows users to view and save authentication credentials\n\nProcess Hacker Multipurpose tool for monitoring system resources\n\nPutty Terminal emulator, serial console, network file transfers\n\nRemote Desktop Passview Reveals passwords stored in an .rdp file by Microsoft’s RDP utility\n\nScreenConnect Remote desktop application\n\nSniffPass Password monitoring tool; listens on the network adapter\n\nWinSCP SFTP/FTP client for copying files between local and remote machines\n\nSuddenly – over four months after the initial compromise — not only are the behaviors of the attackers suddenly\ncrisper, more focused, but the locations of the malicious visitor(s) have expanded, with IP-address traces indicating\nconnections from both Estonia and Iran. Ultimately the compromised network would host malicious visitors from IP\naddresses that geolocate to Iran, Russia, Bulgaria, Poland, Estonia, and… Canada. But these IP addresses may\nhave been Tor exit nodes.\n\nIronically, right around this time, the target’s IT department noticed that the systems were “acting strange” –\nrepeatedly rebooting, possibly by the threat actor’s direct command shortly after destroying the event logs. The IT\ndepartment began its own investigation and would ultimately take five dozen servers offline while they built network\nsegmentation designed to protect known-good devices from the others. However, to cut down on distractions, the IT\ndepartment disabled Sophos Tamper Protection.\n\nThings got frenetic after that. The last ten days of the infection were full of moves and countermoves made by the\nattackers and the IT department. On the eighth day, Sophos’ team entered the fray. Through the end of the last\ncalendar month of the attack, a steady stream of table-setting activities took place as the attackers dumped account\ncredentials, ran network enumeration tools, checked their RDP abilities, and created new user accounts, presumably\nto give themselves options in case they were interrupted in subsequent attacks. The logs were wiped multiple times\nand machines restarted during this period.\n\n\n-----\n\nOne of two ransom notes,\n\nfound on systems where the files had been renamed with a new file suffix, but not encrypted. Reverting to the original\nsuffix restored access to the files.\nOn the first day of the sixth month of the attack, the attacker made their big move, running Advanced IP Scanner and\nalmost immediately beginning lateral movement to multiple sensitive servers. Sophos protections knocked down\nseveral new attempts at malicious file installation, but compromised credentials allowed the attacker to outflank those\nprotections.\n\nWithin minutes, the attacker(s) had access to a slew of sensitive personnel and purchasing files, and attackers were\nhard at work doing another credential dump.\n\nThe second ransom note,\n\nfound on machines successfully encrypted with LockBit\nThe next day, the target engaged with Sophos. Labs analysts identified the 91.191.209.198:4444 as a phone-home\naddress with related shellcode, now detected as ATK/Tlaboc-A and ATK/Shellcode-A. Over the course of several\ndays, the IT team and Sophos analysts collected evidence then quickly shut down servers that provided the attackers\nwith remote access, and worked to remove the malware from the machines that had not been encrypted.\n\n\n-----\n\nFortunately for the target, on at least a few machines, the attackers didn t complete their mission, as we found files\nthat had been renamed with a ransomware-related file suffix, but that had not been encrypted. Cleanup in those\ncases just involved renaming the files to restore their previous file suffixes.\n\n## Guidance and detection\n\nIn the course of the investigation, one factor seemed to stand out: The target’s IT team made a series of strategic\nchoices that enabled the attackers to move freely and to access internal resources without impediment. Deployment\nof MFA would have hindered the access by the threat actors, as would a firewall rule blocking remote access to RDP\nports in the absence of a VPN connection.\n\nResponding to alerts, or even warnings about reduced performance, promptly would have prevented a number of\nattack stages from bearing fruit. Disabling features like tamper protection on endpoint security software seemed to be\nthe critical lever the attackers needed to completely remove protection and complete their jobs without hindrance.\n\nThe ransomware threat actors added a help wanted ad into their ransom note. Our recommendation is that insiders\nwith access to sensitive information refrain from committing crimes by helping ransomware threat actors.\n\nThe ransomware binaries deployed in this attack are detected using CryptoGuard and the various dual-purpose\nattack tools used in the attack are detected as follows. Not all files are routinely detected as many of these utilities\nhave a legitimate IT administrative purpose.\n\nUtility SHA-256 hash(es) Sophos\ndefinition\n\nAdvanced Port\nScanner\n6684e1df360db67719f65bcd39467cc88bbd7bb910636d03071245b622e7cfa3\n\n87bfb05057f215659cc801750118900145f8a22fa93ac4c6e1bfd81aa98b0a55\n\nAnyDesk 4a9dde3979c2343c024c6eeeddff7639be301826dd637c006074e04a1e4e9fe7\n\n\n-----\n\nMimikatz\n\n\ndb385ea6858db4b4cb49897df9ec6d5cc4675aaf675e692466b3b50218e0eeca\n\n3d0e06086768500a2bf680ffbed0409d24b355887169b821d55233529ad2c62a\n\n0d31a6d35d6b320f815c6ba327ccb8946d4d7f771e0dcdbf5aa8af775576f2d1\n\n\nATK/MimikatzAE\nATK/MimikatzBE\n\n\nNLBrute 83d7f6eaf7fe075503ea6a0bc726633c34595a6eae7edd7deab95ab4d4a66fd5 Mal/Generic-R +\nMal/VMProtBadA\n\n\nProcess\nHacker\n\nScreenConnect\n\n\n46367bfcf4b150da573a74d91aa2f7caf7a0789741bc65878a028e91ffbf5e42\n\n89904c4d3b1ebbdfd294b1a87940400a2db2ead01b3d6e3e2e151481faae95bd\n\nffbb5241ed488b98725013185c80f40156d32884a87d6898d53e2aef28f1c3f8\n\n\nAll other shareable IOCs relating to this attack are shown above. Sophos only shares indicators and samples which\ncannot be tied to a specific target to protect the target’s privacy.\n\n**Acknowledgments**\n\nSophosLabs would like to acknowledge the contributions of analysts Melissa Kelly, Peter Mackenzie, Ferenc László\nNagy, Mauricio Valdivieso, Sergio Bestulic, Johnathan Fern, Linda Smith, and Matthew Everts for their work\nreconstructing the attack.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-12 - Attackers linger on government agency computers before deploying Lockbit ransomware.pdf"
    ],
    "report_names": [
        "2022-04-12 - Attackers linger on government agency computers before deploying Lockbit ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536005,
    "ts_updated_at": 1743041126,
    "ts_creation_date": 1653688478,
    "ts_modification_date": 1653688478,
    "files": {
        "pdf": "https://archive.orkl.eu/4abf036a367e855a7b27c19bdbe86959319a305d.pdf",
        "text": "https://archive.orkl.eu/4abf036a367e855a7b27c19bdbe86959319a305d.txt",
        "img": "https://archive.orkl.eu/4abf036a367e855a7b27c19bdbe86959319a305d.jpg"
    }
}