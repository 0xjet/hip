{
    "id": "b9926bb7-01f3-46b3-8e38-f2b184e4fe4c",
    "created_at": "2023-01-12T15:10:04.339815Z",
    "updated_at": "2025-03-27T02:15:47.878801Z",
    "deleted_at": null,
    "sha1_hash": "e337fd0e5bdc214fff8c79510ec3370c133259a9",
    "title": "2020-02-28 - Trickbot Delivery Method Gets a New Upgrade Focusing on Windows 10",
    "authors": "",
    "file_creation_date": "2022-05-28T01:57:43Z",
    "file_modification_date": "2022-05-28T01:57:43Z",
    "file_size": 1295989,
    "plain_text": "# Trickbot Delivery Method Gets a New Upgrade Focusing on Windows 10\n\n**[blog.morphisec.com/trickbot-delivery-method-gets-a-new-upgrade-focusing-on-windows](https://blog.morphisec.com/trickbot-delivery-method-gets-a-new-upgrade-focusing-on-windows)**\n\n[Tweet](https://twitter.com/share)\n\n\n-----\n\n_EDITOR S NOTE: The previous version of this blog post mis-identified the source of this_\n_attack as the FIN7 group; GRIFFON and OSTAP are both very long javascripts that have_\n_many similarities. This caused the confusion in identifying the attack as coming from FIN7._\n_This is still an important find though, as Trickbot is one of the most advanced malware_\n_frameworks._\n\nOver the past few weeks, Morphisec Labs researchers identified a couple dozen documents\nthat execute the OSTAP javascript downloader.\n\nThis time we have identified the use of the latest version of the remote desktop activeX\ncontrol class that was introduced for Windows 10. The attackers utilize the activeX control for\nautomatic execution of the malicious Macro following an enable of the Document content.\n\nAs newer features are introduced to a constantly updating OS, so too the detection\nvendors need to update their techniques to protect the system. This may become very\nexhausting and time--consuming work, which can lead to the opposite effect of pushing\ndefenders even farther behind the attacker. Trickbot distributors have yet again taken\nadvantage of the opportunity this change presents.\n\nWhile tracing this group abusing the remote activeX control we also identified other groups\nmisusing the same and earlier controls although with a slightly different technique.\n\n## Technical details\n\n**_Document_**\n\nMost of the targeted documents were following the naming convention \"i<7-9 random\n_digits>.doc\", as each document usually contained an image to convince targets to enable the_\ncontent. This leads to the execution of the malicious macro, only this time the image also hid\nan ActiveX control slightly below it. The malicious OSTAP JavaScript downloader is then\nhidden in white colored letters in between the content, so it’s not visible to people but can be\nseen by machines.\n\n\n-----\n\nExamining the activeX control revealed the use of the MsRdpClient10NotSafeForScripting\nclass (which is used for remote control). The Server field is empty in the script, which will\nlater cause an error that the attackers will actually abuse to properly execute their own code.\n\n**_Macro_**\n\n\n-----\n\nInspection of the macro revealed an interesting trigger method -- _<name>_OnDisconnected_\n-- which will be the main function that is first executed. This method didn’t execute\nimmediately as it takes time for it to try and resolve DNS to an empty string and then return\nan error. The OSTAP will not execute unless the error number matches exactly to\n_\"disconnectReasonDNSLookupFailed\" (260); the OSTAP wscript command is concatenated_\nwith a combination of characters that are dependent on the error number calculation.\n\nGoing over the documentation for the msrdpclient10 reveals that it will not work on\nworkstations that are not updated to windows 10.\n\n\n-----\n\nAs soon as OSTAP is created in the form of a BAT file, this file is executed, and the word\ndocument form is closed.\n\n**_GRIFFON_**\n\nThe BAT will execute wscript back with its own content -- an old trick using comments that\nthe BAT will disregard during the execution of wscript (non-recognized command) while\nskipped together with its content when executed by wscript (or any other interpreter that\nadheres to the comments syntax).\n\n\n-----\n\nAs soon as the JavaScript is beautified, we get back to the same old GRIFFON obfuscation\npattern.\n\n## Conclusions\n\nUpdating your operating system is necessary for better security, even though it doesn’t\nalways serve that purpose. This example with OSTAP makes it clear that this doesn’t always\nwork. Even with an updated OS, there remains a need for preventive measures such as\nattack surface reduction, moving target defense, and hardening.\n\nThere are hundreds more objects that have been introduced in the latest Windows 10 and\neven dozens more methods in the described object that sophisticated attackers can abuse.\nThere might also be opportunities for vulnerability exploitation with every new feature but this\nis not in the scope of this blog post.\n\n**_Appendix_**\n\nHashes\n\n74422ee3e1274bad11f5ac44712b1d10fce3a1e7fd9acc0a82fe88d9e9b7b78e\n\n891c716d059459d97a726a9bb262bc20f369b6c810097ff312fd710a4d4da577\n\n3d0c3f3d464a8229480b6d4a024d2982c72d67942d8ee245dd91da1a26ddd22a\n\n\n-----\n\nff7334237ad5a76d682c32267ffbada9ef091eb87f3683981b71e1d84c3990a9\n\n414744acddc03bb095a31708c66f33ae456af58ae85ab2887e9781b528034064\n\n8b975bcdc73d28d299b60b7c1ab81c0a5b3a30153725dc41e836659a4ea78831\n\n005a1e42bb3e5092124dfa40b9a765339c7ab9ea00c276ba2f2af32ce2ed81ce\n\n200a0cc130113fedd2e3baa0e5988ca18102a652909b2530785242fd800dd4f5\n\nc1374ddd0b06eb942a7d5224ebf3c6a10802902dd8eee03fe9603292714f8bf1\n\nbb7a43ea1a305228e6ff36abef475e046e549e309fddf334d97707bfbc47aef4\n\n683a9df3e291669e6a1ee35aa08222e228bd553f76ba049c4b8873f6d9eb8880\n\n6226065b170ad402b35ff8307eab843f46b54cc7a93a3717af0fa9cf2eb433df\n\n0d25947452fbd14301f660f357845760693eabf61e99bd55c7ab47a44a88ccd5\n\n…\n\nDomains:\n\ninsiderppe.cloudapp[.]net\n\n[Contact SalesInquire via Azure](http://10.10.0.46/mailto:sales@morphisec.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-02-28 - Trickbot Delivery Method Gets a New Upgrade Focusing on Windows 10.pdf"
    ],
    "report_names": [
        "2020-02-28 - Trickbot Delivery Method Gets a New Upgrade Focusing on Windows 10.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bfded1cf-be73-44f9-a391-0751c9996f9a",
            "created_at": "2022-10-25T15:50:23.337107Z",
            "updated_at": "2025-03-27T02:00:55.445946Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "FIN7",
                "GOLD NIAGARA",
                "ITG14",
                "Carbon Spider",
                "ELBRUS",
                "Sangria Tempest"
            ],
            "source_name": "MITRE:FIN7",
            "tools": [
                "Mimikatz",
                "AdFind",
                "JSS Loader",
                "HALFBAKED",
                "REvil",
                "PowerSploit",
                "CrackMapExec",
                "Carbanak",
                "Pillowmint",
                "Cobalt Strike",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRat",
                "Lizar",
                "TEXTMATE",
                "BOOSTWRITE"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "bb8702c5-52ac-4359-8409-998a7cc3eeaf",
            "created_at": "2023-01-06T13:46:38.405479Z",
            "updated_at": "2025-03-27T02:00:02.82533Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "JokerStash",
                "ATK32",
                "G0046",
                "Coreid",
                "Carbanak",
                "Sangria Tempest",
                "CARBON SPIDER",
                "GOLD NIAGARA",
                "G0008",
                "ELBRUS",
                "Carbon Spider"
            ],
            "source_name": "MISPGALAXY:FIN7",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d85adfe3-e1c3-40b0-b8bb-d1bacadc4d82",
            "created_at": "2022-10-25T16:07:23.619566Z",
            "updated_at": "2025-03-27T02:02:09.890982Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "APT-C-11",
                "ATK 32",
                "Gold Niagara",
                "ITG14",
                "TAG-CR1"
            ],
            "source_name": "ETDA:FIN7",
            "tools": [
                "7Logger",
                "Agentemis",
                "Anunak",
                "Astra",
                "BIOLOAD",
                "BIRDWATCH",
                "Bateleur",
                "Boostwrite",
                "CROWVIEW",
                "Carbanak",
                "Cobalt Strike",
                "CobaltStrike",
                "DICELOADER",
                "DNSMessenger",
                "FOWLGAZE",
                "HALFBAKED",
                "JSSLoader",
                "KillACK",
                "LOADOUT",
                "Lizar",
                "Meterpreter",
                "Mimikatz",
                "POWERPLANT",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "TEXTMATE",
                "Tirion",
                "VB Flash",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536204,
    "ts_updated_at": 1743041747,
    "ts_creation_date": 1653703063,
    "ts_modification_date": 1653703063,
    "files": {
        "pdf": "https://archive.orkl.eu/e337fd0e5bdc214fff8c79510ec3370c133259a9.pdf",
        "text": "https://archive.orkl.eu/e337fd0e5bdc214fff8c79510ec3370c133259a9.txt",
        "img": "https://archive.orkl.eu/e337fd0e5bdc214fff8c79510ec3370c133259a9.jpg"
    }
}