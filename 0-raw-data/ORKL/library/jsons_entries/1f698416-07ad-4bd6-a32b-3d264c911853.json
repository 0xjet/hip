{
    "id": "1f698416-07ad-4bd6-a32b-3d264c911853",
    "created_at": "2023-01-12T15:04:19.276827Z",
    "updated_at": "2025-03-27T02:05:28.916674Z",
    "deleted_at": null,
    "sha1_hash": "df506c7c9ea1bea66652c511bd92f089830391d7",
    "title": "2019-08-28 - RAT Ratatouille- Backdooring PCs with leaked RATs",
    "authors": "",
    "file_creation_date": "2022-05-27T21:58:24Z",
    "file_modification_date": "2022-05-27T21:58:24Z",
    "file_size": 4433950,
    "plain_text": "# RAT Ratatouille: Backdooring PCs with leaked RATs\n\n**[blog.talosintelligence.com/2019/08/rat-ratatouille-revrat-orcus.html](https://blog.talosintelligence.com/2019/08/rat-ratatouille-revrat-orcus.html)**\n\n_By_ _[Edmund Brumaghin and](https://www.blogger.com/profile/10442669663667294759)_ _[Holger Unterbrink.](https://blogs.cisco.com/author/holgerunterbrink)_\n\n## Executive summary\n\n[Orcus RAT and](https://malpedia.caad.fkie.fraunhofer.de/details/win.orcus_rat) [RevengeRAT are two of the most popular remote access trojans (RATs) in](https://www.bleepingcomputer.com/news/security/revengerat-distributed-via-bitly-blogspot-and-pastebin-c2-infrastructure/)\nuse across the threat landscape. Since its emergence in 2016, various adversaries used\n\n\n-----\n\nRevengeRAT to attack organizations and individuals around the world. The source code\nassociated with RevengeRAT was previously released to the public, allowing attackers to\nleverage it for their own malicious purposes. There are typically numerous, unrelated\nattackers attempting to leverage this RAT to compromise corporate networks for the\npurposes of establishing an initial point of network access, the performance of lateral\nmovement, as well as to exfiltrate sensitive information that can be monetized. Orcus RAT\n[was in the news earlier this year due to Canadian law enforcement activity related to the](https://krebsonsecurity.com/2019/04/canadian-police-raid-orcus-rat-author/)\nindividual believed to have authored the malware.\n\nCisco Talos recently discovered a threat actor that has been leveraging RevengeRAT and\nOrcus RAT in various malware distribution campaigns targeting organizations including\ngovernment entities, financial services organizations, information technology service\nproviders and consultancies. We discovered several unique tactics, techniques, and\nprocedures (TTPs) associated with these campaigns including the use of persistence\ntechniques most commonly associated with \"fileless\" malware, obfuscation techniques\ndesigned to mask C2 infrastructure, as well as evasion designed to circumvent analysis by\nautomated analysis platforms such as malware sandboxes.\n\nThe characteristics associated with these campaigns evolved over time, showing the\nattacker is constantly changing their tactics in an attempt to maximize their ability to infect\ncorporate systems and work toward the achievement of their longer-term objectives.\n\n### Malicious email campaigns\n\nThere have been several variations of the infection process associated with these malware\ndistribution campaigns over time. In general, the emails in every case claim to be associated\nwith complaints against the organization being targeted. They purport to be from various\n[authorities such as the Better Business Bureau (BBB). Below is an example of one of these](https://www.bbb.org/)\nemails:\n\n\n-----\n\nPhishing email\n\nIn addition to Better Business Bureau, Talos has also observed emails purporting to be\nassociated with other entities such as Australian Competition & Consumer Commission\n[(ACCC), Ministry of Business Innovation & Employment (MBIE) and other regional agencies.](https://www.accc.gov.au/)\n\nEarlier malware campaigns contained a hyperlink that directed potential victims to the\nmalicious content responsible for initiating the malware infection. The attacker made use of\nthe [SendGrid email delivery service to redirect victims to an attacker-controlled malware](https://sendgrid.com/)\ndistribution server.\n\nThe link in one example email was pointed to the following SendGrid URL:\n```\nhttps://u12047697[.]ct[.]sendgrid[.]net/wf/click?upn=X2vR62FdIf8y2XI902U8Tc8qh9KOPBogeTLss4h7AKXe0xRjCQw1VcMTssPPPTU28KY7PwUPERvVvIa8n4VQD-2Fw3D-3D_tIiqtngjMfK6xwiZyGxyMuaZ5weLruJKBoFJsVrKYBziY2h51ElcQ2ocLru0oJCxt2FOlkcr6RH8ktqTc-2B-2BQjmMscOQaeiy2zw8OOUb6nD0f1srQnQG-2B2BIXtpubqjWMnnIHxJg3TvgFRq0itu75WQHjsdUv1O1g-2FrQzQAyJkGQN6vC9fH5R4R4FyLG9ahUnvbnHt2FEmdUJQuft0jfw2c5uPBA2M5Yspgi-2Fodr8cEU2b8-3D\n\n```\n\n-----\n\nThis URL is responsible for redirecting the client to a URL hosted on an attacker-controlled\nserver that hosts a ZIP archive containing the malicious PE32 used to infect the system.\nBelow, you can see the HTTP GET request that is responsible for retrieving this and\ncontinuing the infection process.\n\nZIP File download\n\nA PE32 executable is inside of the ZIP archive. It needs to be executed by the victim to infect\nthe system with Orcus RAT. The PE32 filename features the use of double extensions\n(478768766.pdf.exe) which, by default on the Windows operating system, will only display\nthe first extension (.PDF.) The PE32 icon has been set to make the file appear as if it is\nassociated with Adobe Acrobat.\n\nDouble extensions trick\n\nThis loader (478768766.pdf.exe) is protected by the SmartAssembly .NET protector (see\n[below), but can easily be deobfuscated via d4dot. It is responsible for extracting and](https://github.com/0xd4d/de4dot)\ndecrypting the Orcus RAT. It extracts the Orcus executable from its Resource \"人豆认关尔八\n七\" as shown in the screenshots below.\n\n\n-----\n\nOrcus loader resources\n\nThe Class5.smethod_1 method, shown in the screenshot below, decodes the content from\nthe resource section and restores the original Orcus RAT PE file.\n\nResource section payload decoding\n\nThe smethod_3 shown below finally starts another instance of the loader\n(478768766 pdf exe) and injects the Orcus PE file into this loader process Then it resumes\n\n\n-----\n\nthe process, which executes the Orcus RAT PE file in memory in the 478768766.pdf.exe\nprocess context. This means the original Orcus RAT PE file is never written to disk in clear\ntext. This makes it more difficult for anti virus systems to detect it.\n\nProcess injection method\n\nThe loader achieves persistence by creating a shortcut that points to its executable and\nstoring the shortcut in the following Startup directory:\n```\nC:\\Users\\<Username>\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\n\n```\nThe dropper also copies itself over to %APPDATA%\\Roaming\\trfgtf\\rfgrf.exe and creates and\nstarts the rfgrf.exe.bat file, which you can see below. The bat file executes the copy of the\nloader every 60 seconds.\n\nrfgrf.exe.bat\n\n\n-----\n\nIn later campaigns, the adversary modified the infection process and emails no longer\nleveraged the SendGrid URLs. Later emails featured the same themes and verbiage but\nwere modified to contain ZIP archive attachments.\n\nPhishing email\n\nThe attached ZIP archives contain malicious batch files responsible for retrieving the\nmalicious PE32 file and executing it, thus infecting the system. Early versions of the batch\nfile retrieved additional malicious content from the same server previously used to host the\nZIP archives.\n\n\n-----\n\nMalicious .bat downloader\n\nOne interesting thing to note about the batch files was the use of an obfuscation technique\nthat is not commonly seen. In early campaigns, the attacker prepended the bytes \"FF FE 26\n63 6C 73 0D 0A\" into the file, causing various file parsers to interpret the file contents as\n[UTF-16 LE, resulting in the parsers failing to properly display the contents of the batch file.](https://en.wikipedia.org/wiki/UTF-16)\n\nUnicode obfuscation standard editor\n\nThe hex view of the same file shows these prepended bytes which are responsible for this\nparsing issue.\n\nUnicode obfuscation hex view\n\n[This is a well-known technique as can be observed in the forum thread here.](https://www.dostips.com/forum/viewtopic.php?t=7990)\n\n\n-----\n\nLater versions of the .bat downloader featured the use of obfuscation in an attempt to make\nanalysis more difficult. They are using a simple obfuscation method and are just replacing all\ncharacters by variables that are resolved at runtime.\n\nObfuscated RevengeRat .bat downloader\n\nThe decoded version of the .bat file looks like this. Like in the non-obfuscated versions of the\n.bat file, the adversaries are downloading the .js file to a local directory (C:\\windows\\r2.js)\nand executing it.\n\nDecoded obfuscated .bat file\n\nThis r2.js file is another obfuscated script. It is filled with a bunch of rubbish and one long line\nof code.\n\n\n-----\n\nDownloaded r2.js file\n\nThis scripts writes the 'TVqQ…' string into the registry.\n\nr2.js payload\n\nStored encoded malware in registry key\n\nIt loads this string at the end of the infection process, decodes it and executes it.\n\nr2.js payload decoding routine\n\nDecompiling this payload in dnSpy shows an old friend: RevengeRAT.\n\n\n-----\n\nRevengeRAT decompiled binary\n\n## Command and control (C2) obfuscation\n\nAs is the case with many popular RATs, the C2 infrastructure was observed leveraging\nDynamic Domain Name System (DDNS) in an attempt to obfuscate the attacker's\ninfrastructure. In the case of these malware campaigns, the attacker took an additional step.\n[They pointed the DDNS over to the Portmap service to provide an additional layer of](https://portmap.io/)\ninfrastructure obfuscation.\n\nPortmap is a service designed to facilitate external connectivity to systems that are behind\nfirewalls or otherwise not directly exposed to the internet.\n\n\n-----\n\nPort forwarding service\n\nThese systems initiate an OpenVPN connection to the Portmap service, which is responsible\nfor handling requests to those systems via port mapping. We have recently observed an\nincrease in the volume of malicious attackers abusing this service to facilitate the C2 process\nacross various malware families.\n\n\n-----\n\nHTTPS certificate\n\nAs demonstrated above, the DNS configuration for the DDNS hostname used by the\nmalware for C2 has actually been pointed to the Portmap service. Let's Encrypt issued the\nSSL certificate associated with this host.\n\n## Payload analysis\n\nThe adversaries used at least two different RATs in the campaigns which we have closely\nanalyzed: Orcus RAT and RevengeRAT. For both RATs, the source code was leaked in the\nunderground and several adversaries have used it to build their own versions. You can see\nthe comparison of the leaked version of RevengeRAT and the one we analyzed below\n\n\n-----\n\nCompairson leaked malware and modified one\n\nThe adversaries changed the source code slightly. They moved the original code into\nseparate functions and changed the execution order a bit plus added other minor changes\nlike additional variables, but overall the code is still very similar to the leaked code. On the\nother hand, it is modified so that the resulting binary looks different for AVs.\n\nIt is interesting to see that both (Client) IDs are pointing to the same name: CORREOS. In\nthe Nuclear_Explosion file, aka RevengeRAT, it is only base64 encode \"Q09SUkVPUw==\".\n\n\n-----\n\nRevengeRAT Atomic class config\n\nOrcus decoded XML config\n\n## Conclusion\n\nThese malware distribution campaigns are ongoing and will likely continue to be observed\ntargeting various organizations around the world. RevengeRAT and Orcus RAT are two of\nthe most popular RATs in use across the threat landscape and will likely continue to be\nheavily favored for use during the initial stages of attacks.\n\nOrganizations should leverage comprehensive defense-in-depth security controls to ensure\nthat they are not adversely impacted by attacks featuring these malware families. At any\ngiven point in time, there are several unrelated attackers distributing these RATs in different\nways. Given that the source code of both of these malware families is readily available, we\nwill likely continue to see new variants of each of these RATs for the foreseeable future.\n\n## Coverage\n\nAdditional ways our customers can detect and block this threat are listed below.\n\n\n-----\n\n[Advanced Malware Protection (AMP) is ideally suited to prevent the execution of the](https://www.cisco.com/c/en/us/products/security/advanced-malware-protection)\nmalware used by these threat actors.\n\n[Cisco Cloud Web Security (CWS) or](https://www.cisco.com/c/en/us/products/security/cloud-web-security/index.html) [Web Security Appliance (WSA) web scanning prevents](https://www.cisco.com/c/en/us/products/security/web-security-appliance/index.html)\naccess to malicious websites and detects malware used in these attacks.\n\n[Email Security can block malicious emails sent by threat actors as part of their campaign.](https://www.cisco.com/c/en/us/products/security/email-security-appliance/index.html)\n\n[Network Security appliances such as Next-Generation Firewall (NGFW), Next-Generation](https://www.cisco.com/c/en/us/products/security/firewalls/index.html)\n[Intrusion Prevention System (NGIPS), and Meraki MX can detect malicious activity](https://meraki.cisco.com/products/appliances)\nassociated with this threat.\n\n[AMP Threat Grid helps identify malicious binaries and build protection into all Cisco Security](https://www.cisco.com/c/en/us/solutions/enterprise-networks/amp-threat-grid/index.html)\nproducts.\n\n[Umbrella, our secure internet gateway (SIG), blocks users from connecting to malicious](https://umbrella.cisco.com/)\ndomains, IPs, and URLs, whether users are on or off the corporate network.\n\nOpen Source Snort Subscriber Rule Set customers can stay up to date by downloading the\n[latest rule pack available for purchase on Snort.org.](https://www.snort.org/products)\n\n## Indicators of Compromise (IOCs)\n\nThe following indicators of compromise (IOCs) have been observed to be associated with\nmalware campaigns.\n\n### ZIP Hashes (SHA256):\n\nc66c96c8c7f44d0fd0873ea5dbaaa00ae3c13953847f0ca308d1f56fd28f230c\n\nd6c5a75292ac3a6ea089b59c11b3bf2ad418998bee5ee3df808b1ec8955dcf2a\n\n\n-----\n\n### BAT Hashes (SHA256):\n\n20702a8c4c5d74952fe0dc050025b9189bf055fcf6508987c975a96b7e5ad7f5\n\n946372419d28a9687f1d4371f22424c9df945e8a529149ef5e740189359f4c8d\n\n### PE32 Hashes (SHA256):\n\nff3e6d59845b65ad1c26730abd03a38079305363b25224209fe7f7362366c65e\n\n5e4db38933c0e3922f403821a07161623cd3521964e6424e272631c4492b8ade\n\n### JS Hashes (SHA256):\n\n4c7d2efc19cde9dc7a1fcf2ac4b30a0e3cdc99d9879c6f5af70ae1b3a846b64b\n\n### Domains:\n\nThe following domains have been observed to be associated with malware campaigns:\n\nskymast231-001-site1[.]htempurl[.]com\n\nqstorm[.]chickenkiller[.]com\n\n### IP Addresses:\n\nThe following IP addresses have been observed to be associated with malware campaigns:\n\n193[.]161[.]193[.]99\n\n205[.]144[.]171[.]185\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-08-28 - RAT Ratatouille- Backdooring PCs with leaked RATs.pdf"
    ],
    "report_names": [
        "2019-08-28 - RAT Ratatouille- Backdooring PCs with leaked RATs.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535859,
    "ts_updated_at": 1743041128,
    "ts_creation_date": 1653688704,
    "ts_modification_date": 1653688704,
    "files": {
        "pdf": "https://archive.orkl.eu/df506c7c9ea1bea66652c511bd92f089830391d7.pdf",
        "text": "https://archive.orkl.eu/df506c7c9ea1bea66652c511bd92f089830391d7.txt",
        "img": "https://archive.orkl.eu/df506c7c9ea1bea66652c511bd92f089830391d7.jpg"
    }
}