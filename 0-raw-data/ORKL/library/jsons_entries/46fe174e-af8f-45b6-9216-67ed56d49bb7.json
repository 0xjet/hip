{
    "id": "46fe174e-af8f-45b6-9216-67ed56d49bb7",
    "created_at": "2023-01-12T15:01:36.943819Z",
    "updated_at": "2025-03-27T02:06:13.944653Z",
    "deleted_at": null,
    "sha1_hash": "184aac56fce6d28fda1fa76f754b09f602306a02",
    "title": "2021-04-28 - RotaJakiro- A long live secret backdoor with 0 VT detection",
    "authors": "",
    "file_creation_date": "2022-05-29T00:56:28Z",
    "file_modification_date": "2022-05-29T00:56:28Z",
    "file_size": 996391,
    "plain_text": "# RotaJakiro: A long live secret backdoor with 0 VT detection\n\n**blog.netlab.360.com/stealth_rotajakiro_backdoor_en/**\n\nAlex.Turing April 28, 2021\n\n28 April 2021 / [Botnet](https://blog.netlab.360.com/tag/botnet/)\n\n## Overview\n\nOn March 25, 2021, 360 NETLAB's BotMon system flagged a suspiciousELF file\n(MD5=64f6cfe44ba08b0babdd3904233c4857) with 0 VT detection, the sample\ncommunicates with 4 domains on TCP 443 (HTTPS), but the traffic is not of TLS/SSL. A\nclose look at the sample revealed it to be a backdoor targeting Linux X64 systems, a family\nthat has been around for at least 3 years.\n\nWe named it RotaJakiro based on the fact that the family uses rotate encryption and\nbehaves differently for `root/non-root accounts when executing.`\n```\nRotaJakiro pays quite some attention to hide its trails, using multiple of encryption\n\n```\nalgorithms, including: the use of AES algorithm to encrypt the resource information within the\nsample; C2 communication using a combination of `AES, XOR, ROTATE encryption and`\n```\nZLIB compression .\nRotaJakiro supports a total of 12 functions, three of which are related to the execution of\n\n```\nspecific Plugins. Unfortunately, we have no visibilityto the plugins, and therefore do not know\nits true purpose. From a broad backdoor perspective, the functions can be grouped into the\nfollowing four categories.\n\nReporting device information\nStealing sensitive information\nFile/Plugin management (query, download, delete)\nExecution of specific Plugin\n\n## Any more out there?\n\nWith the sample we have, we discovered the following 4 samples, all of which have 0\ndetections on VT, and the earliest First Seen time on VT is in 2018.\n\n**FileName** **MD5** **Detection** **First Seen in VT**\n\n\nsystemddaemon\n\n\n1d45cd2c1283f927940c099b8fab593b 0/61 2018-05-16\n04:22:59\n\n\n-----\n\n**FileName** **MD5** **Detection** **First Seen in VT**\n\n\nsystemddaemon\n\nsystemddaemon\n\n\n11ad1e9b74b144d564825d65d7fb37d6 0/58 2018-12-25\n08:02:05\n\n5c0f375e92f551e8f2321b141c15c48f 0/56 2020-05-08\n05:50:06\n\n\ngvfsd-helper 64f6cfe44ba08b0babdd3904233c4857 0/61 2021-01-18\n13:13:19\n\nThese samples all have the following 4 C2s embedded. These 4 C2 domains have very\nclose `Crteated,Updated and Expired time, readers will notice that the crated data was`\nin Dec 2015, 6 years ago.\n\n**Domain** **Detection** **Created** **Last Updated** **Expired**\n\n\nnews.thaprior.net 0/83 2015-12-09\n06:24:13\n\nblog.eduelects.com 0/83 2015-12-10\n13:12:52\n\ncdn.mirror-codes.net 0/83 2015-12-09\n06:24:19\n\nstatus.sublineover.net 0/83 2015-12-09\n06:24:24\n\n## Reverse Analysis\n\n\n2020-12-03\n07:24:33\n\n2020-12-03\n07:24:33\n\n2020-12-03\n07:24:32\n\n2020-12-03\n07:24:32\n\n\n2021-12-09\n06:24:13\n\n2021-12-10\n13:12:52\n\n2021-12-09\n06:24:19\n\n2021-12-09\n06:24:24\n\n\nThe 4 RotaJakiro samples, with time distribution from 2018 to 2021, are very close to their\nfunctions, and the 2021 sample is selected for analysis in this blog, which has the following\nbasic information:\n```\nMD5:64f6cfe44ba08b0babdd3904233c4857\nELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared\nlibs), for GNU/Linux 2.6.32, stripped\nPacker:No\nAt the coding level, RotaJakiro uses techniques such as dynamic AES, double-layer\n\n```\nencrypted communication protocols to counteract the binary & network traffic analysis.\n```\nAt the functional level, RotaJakiro first determines whether the user is root or non\n```\nroot at run time, with different execution policies for different accounts, then decrypts the\nrelevant sensitive resources using AES& ROTATE for subsequent `persistence,` `process`\n```\nguarding and single instance use, and finally establishes communication with C2 and\n\n```\nwaits for the execution of commands issued by C2.\n\n\n-----\n\nThe following will analyze the specific implementation of RotaJakiro from the above\nperspective.\n\n## 0x00: Tricks used by the sample\n\nDynamically generate a table of constants required by the AES encryption algorithm to\nprevent the algorithm from being directly identified\n\nUse stack strings obfuscation technique to store encrypted sensitive resource\ninformation\n\nNetwork communication using double layer encryption\n\n## 0x01: Encryption algorithm\n\n\n-----\n\nAll sensitive resources in RotaJakiro are encrypted, and in IDA we can see that the\ndecryption method dec_proc is called 60 times, which is composed of AES and Rotate.\n\nThe AES decryption entry is as follows:\n\nWhere `aes_dec is AES-256, CBC mode, key&iv are hardcoded.`\n\nKEY\n```\n 14 BA EE 23 8F 72 1A A6 00 00 00 00 00 00 00 00 \n 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n\n```\nIV\n```\n 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n\n```\n\n-----\n\nThe Rotate decryption entry is shown below:\n\nThe so-called Rotate is a cyclic shift, we can see that the number of shifts is determined by\nthe value of `plain_len(length of plaintext) &7 .`\n\nTake the following C2 cipher text as an example.\n```\nff ba a2 3b cd 5b 7b 24 8c 5f e3 4b fc 56 5b 99 \nac 91 cf e3 9a 27 d4 c9 6b 39 34 ce 69 ce 18 60\n\n```\nThe various parameters related to decryption are shown below, the length of the ciphertext is\n32 bytes and the length of the plaintext is 26 bytes.\n\n**First, decrypting with AES, we get the following \"sub-ciphertext\".**\n\n**Then, the valid ciphertext is extracted from the sub-ciphertext, where the valid ciphertext**\nstarts from the 8th byte, and the length is the plaintext length minus 8, which is 26-8=18\nbytes here.\n```\n98 1B DB D9 8B 59 19 5D 59 1B 59 D8 1D DC 8B D8 \nDB 5B\n\n```\n**Finally, we can calculate 26(the length of plaintext is 26)&7=2, and get the number of shifts,**\nand shift the above valid ciphertext byte by byte by 2 bits to get C2 plaintext.\n```\nblog.eduelects.com\n\n## 0x02: Persistence\n\n```\n\n-----\n\nRotaJakiro makes a distinction between `root/non-root users when implementing`\npersistence features, and different techniques are used for different accounts.\n\n### root account\n\nDepending on the Linux distribution, create the corresponding self-starting script\n```\n   /etc/init/systemd-agent.conf or /lib/systemd/system/sys-temd   agent.service .\n   Content of systemd-agent.conf\n   ----------------------------   #system-daemon - configure for system daemon\n   #This service causes system have an associated\n   #kernel object to be started on boot.\n   description \"system daemon\"\n   start on filesystem or runlevel [2345]\n   exec /bin/systemd/systemd-daemon\n   respawn \n   Content of systemd-agent.service\n   ----------------------------   [Unit]\n   Description=System Daemon\n   Wants=network-online.target\n   After=network-online.target\n   [Service]\n   ExecStart=/usr/lib/systemd/systemd-daemon\n   Restart=always\n   [Install]\n\n```\nThe file name used for the disguise is one of the following twos.\n```\n   /bin/systemd/systemd-daemon\n   /usr/lib/systemd/systemd-daemon\n\n### non-root account\n\n```\nCreate autostart script $HOME/.config/au-tostart/gnomehelper.desktop for\n**desktop environment**\n```\n   [Desktop Entry]\n   Type=Application\n   Exec=$HOME/.gvfsd/.profile/gvfsd-helper\n\n```\nModify the `.bashrc file to create the autostart script for the shell environment`\n```\n   # Add GNOME's helper designed to work with the I/O abstraction of GIO\n   # this environment variable is set, gvfsd will not start the fuse filesystem\n   if [ -d ${HOME} ]; then\n       ${HOME}/.gvfsd/.profile/gvfsd-helper\n   fi\n\n```\n\n-----\n\nThe file name used for the disguise, both of which exist at the same time\n```\n   $HOME/.dbus/sessions/session-dbus\n   $HOME/.gvfsd/.profile/gvfsd-helper\n\n## 0x03:Process guarding\n\n```\nRotaJakiro implements process guarding to protect its own operation, and like persistence,\nthere are different implementations for `root/non-root users.`\n\n### root account\n\nWhen running under the root account, depending on the Linux distribution, a new process is\nautomatically created when the service process is terminated by writing `Restart=always`\n```\nor respawn to the service's configuration file.\n\n```\nThe actual result is shown in the figure below, where you can see that a new process is\ncreated immediately after the systemd-daemon process is terminated.\n\n### non-root account\n\nWhen running under a non-root account, RotaJakiro generates two processes, `session-`\n```\ndbus and gvfsd-helper, which monitor each other's survival and restore them when one\n\n```\nof them is terminated, which is very typical of dual-process protection.\n\nHow is RotaJakiro's dual-process protection implemented?\n\n\n-----\n\n**First, it creates a piece of shared memory with the** `shmget API, and session-dbus and`\ngvfsd-helper communicate with each other through this shared memory, telling each other\ntheir PIDs.\n**Then, dynamically fetching the process survival through the** `/proc/[PID] directory. When`\nthe other process is found dead, the process is created by execvp API to help the dead\nprocess \"resurrect\", as shown in the following diagram.\n\nThe actual effect is shown in the figure below, you can see that after session-dbus and\ngvfsd-helper are ended by kill -9, new processes are created right away.\n\n## 0x04: Single instance\n\n\n-----\n\nRotaJakiro implements a single instance by file locking, as shown below.\n\nThe lockfile used in this differs under the root/non-root account.\n\nThe lockfile under root, one will be created.\n```\n   /usr/lib32/.X11/X0-lock\n   /bin/lib32/.X11/X0-lock\n\n```\nThe lockfile under non-root, both will be created.\n```\n   $HOME/.X11/X0-lock\n   $HOME/.X11/.X11-lock\n\n```\n\n-----\n\nIn the actual non-root account, for example, the processes and file locks can be matched by\n```\n/proc/locks, and then the corresponding RotaJakiro sample is executed.\n\n## 0x05: Network communication\n\n```\n\n-----\n\nRotaJakiro establishes communication with C2 through the following code snippet, pending\nthe execution of subsequent commands.\n\nThis process can be divided into 2 stages\n\nStage 1, initialization phase\n\nDecrypt the C2 list, establish a connection with C2, send the online information, receive\nand decrypt the information returned by C2.\nStage 2, wait for C2 calls\n\nVerify the information returned by C2, if it passes the verification, execute the\nsubsequent instructions sent by C2.\n\n### Stage 1: Initialization\n\nThe C2 list is decrypted by the decryption algorithm described in the previous section, and\nthe following four C2s are built into the sample at present.\n\n\n-----\n\n```\nnews.thaprior.net\nblog.eduelects.com\ncdn.mirror-codes.net\nstatus.sublineover.net\n\n```\nRotaJakiro will first try to establish a connection with them, and then construct the golive\nmessage by the following code snippet.\n\nThen it encrypts the golive information and sends it to the C2s\n\n\n-----\n\nFinally, it receives the packet back from the C2, decrypts it and checks its legitimacy, and if it\npasses the check, it goes to Stage 2.\n\n### Stage 2: Specific operations\n\nReceive and execute the command from C2 through the following codesnippet.\n\nAt present, RotaJakiro supports a total of 12 instructions, and the correspondence between\nthe instruction code and the function is shown in the following table.\n\n**CmdId** **Function**\n\n0x138E3E6 Exit\n\n0x208307A Test\n\n0x5CCA727 Heartbeat\n\n0x17B1CC4 Set C2 timeout time\n\n0x25360EA Steal Senstive Info\n\n0x18320e0 Upload Device Info\n\n\n-----\n\n**CmdId** **Function**\n\n0x2E25992 Deliver File/Plugin\n\n0x2CD9070 Query File/Plugin Status\n\n0x12B3629 Delete File/Plugin Or Dir\n\n0x1B25503 Run Plugin_0x39C93E\n\n0x1532E65 Run Plugin_0x75A7A2\n\n0x25D5082 Run Plugin_0x536D01\n\nThe Run Plugin function reuses the same code and implements the function call through the\nfollowing logic.\n\nWe are currently not capturing such payloads, so we use the `Plugin_\"parameter\" form to`\nrepresent different tasks.\n\n## 0x06 Packet analysis\n\nThe network communication packet of RotaJakiro consists of three parts: `Head, Key,`\n```\nPayload .\nHead is mandatory and 82 bytes long, and the Key & Payload parts are optional.\nHead & Key are encrypted with XOR & Rotate, and Payload is encrypted with AES &\n\n```\nZLIB Compression.\n\nIn the following, we will illustrate the composition of network traffic `head&key&payload and`\nthe decryption process through a round of interaction between Bot and C2.\n\n\n-----\n\n### C2 -> Bot\n\nThe first 0x52 bytes are the content of the Head. How to decrypt the head? Very simple,\n```\nshift 3 bits left byte by byte, and then XOR with 0x1b . After decryption, we\n\n```\ncan get the following content.\n```\n00000000 16 11 10 b9 03 b1 0c fb 04 20 00 00 00 08 00 e0 |...¹.±.û. .....à|\n00000010 20 83 01 c2 20 64 20 01 e2 00 00 00 00 c2 0c 00 | ..Â d .â....Â..|\n00000020 00 00 32 42 36 39 33 33 34 46 38 34 31 44 30 44 |..2B69334F841D0D|\n00000030 39 46 41 30 36 35 38 45 43 33 45 32 39 46 41 44 |9FA0658EC3E29FAD|\n00000040 34 39 c8 53 e6 9c 48 c4 8b 77 24 2e 02 1c 96 d9 |49ÈSæ.HÄ.w$....Ù|\n00000050 81 28\n------------filed parse-----------------offset 0x09, 4 bytes--->payload length\noffset 0x0d, 2 bytes--->body length\noffset ox0f, 4 bytes--->cmdid\n\n```\nThrough the field parsing, we can know that the length of key is 0x8 bytes, the length of\npayload is 0x20 bytes, and the instruction code to be executed is 0x18320e0, that is, the\n```\nreport device information .Reading 8 bytes from offset 0x52 gives the Key ea 9a 1a\n18 18 44 26 a0, and using the same decryption method as head, we get 4c cf cb dbdb\n39 2a 1e, which is used as the AES key to decrypt the Payload.\n\n```\nReading 32 bytes from offset 0x5a gives us the following Payload.\n```\n54 c1 c3 69 00 18 31 e4 a2 5b 10 7f 67 ab d1 4b \nb2 7b 3d 3f b3 bc 66 6a 26 f6 f6 b3 f7 2e 66 6d\n\n```\nUsing the decrypted key as the AES-256 key, decrypt the above data in CBC mode to get\nthe following content.\n```\n3b c7 f8 9b 73 2b d1 04 78 9c e3 60 60 60 d8 df d9 c1 71 56 f7 6f 00 00 13 80 04 28\n\n```\nThe 8th byte onwards is ZLIB compressed data, decompressed to get the following content.\n```\n08 00 00 00 bf 89 88 08 cd 2d fd 50\n------------filed parse-----------------offset 0, 4 bytes--->length\n\n```\nWhat is the use of the decompressed Payload( bf 89 88 08 cd 2d fd 50 )? It is used as\n**a new AES key to decrypt some sensitive resource information.**\n\n\n-----\n\nFor example, when Bot collects device information, one of the information is the current OS\ndistribution, which is implemented by the `cat /etc/*release | uniq command.`\n```\nroot@debian:~# cat /etc/*release | uniq\nPRETTY_NAME=\"Debian GNU/Linux 9 (stretch)\"\nNAME=\"Debian GNU/Linux\"\nVERSION_ID=\"9\"\nVERSION=\"9 (stretch)\"\nID=debian\nHOME_URL=\"https://www.debian.org/\"\nSUPPORT_URL=\"https://www.debian.org/support\"\nBUG_REPORT_URL=\"https://bugs.debian.org/\"\n\n```\nThe cat /etc/*release | uniq command is the result of the following cipher text\n```\n\"cat /etc/*release | uniq\" cmd_ciphertxt\n--------------------------74 00 dd 79 e6 1e aa bb 99 81 7e ca d9 21 6b 81 \n6b d9 9d 14 45 73 6a 1c 61 cc 28 a3 0f 2b 41 5a \n6b 33 8c 37 25 89 47 05 44 7e f0 6b 17 70 d8 ca\n\n```\ndecrypted with the `new AES key and the parameters in the following figure.`\n\n### Bot -> C2\n\n\n-----\n\nWhen BOT receives C2 s report device information command, it will send the following data\nto C2, and you can see that the value of the key part is still `ea 9a 1a 18 18 44 26 a0 .`\n\nThe decrypted key value is `4c cf cb db db 39 2a 1e . After decrypting and`\ndecompressing the payload sent by Bot to C2, we get the following data, which is the various\ninformation of the device, including the information obtained by `cat /etc/*release |`\n```\nuniq mentioned before, which verifies that our analysis is correct.\n\n## Relationship with the Torii Botnet\n\n```\n\n-----\n\nThe [Torii botnet was exposed by Avast on September 20, 2018, and we noticed that there](https://blog.avast.com/new-torii-botnet-threat-research)\nare some the similarities between the twos,for example:\n\n**1: String similarity**\n\nAfter decrypting the sensitive resources of RotaJakiro & Torii, we found that they reuse a lot\nof the same commands.\n```\n1：semanage fcontext -a -t bin_t '%s' && restorecon '%s'\n2：which semanage\n3：cat /etc/*release \n4：cat /etc/issue\n5：systemctl enable\n6：initctl start\n...\n\n```\n**2: Traffic similarity**\n\nIn the process of constructing the flow, a large number of constants are used and the\nconstruction methods are very close.\n\n**3: Functional similarity**\n\nFrom the perspective of reverse engineering, RotaJakiro & Torii share similar styles: the use\nof encryption algorithms to hide sensitive resources, the implementation of a rather oldschool style of persistence,structured network traffic, etc.\n\n\n-----\n\nWe don t exactly know the answer, but it seems that RotaJakiro and Torii have some\nconnections.\n\n## The tip of the iceberg\n\nWhile this concludes our analysis of RotaJakiro, the real work is far from over, and many\nquestions remain unanswered: \"How did RotaJakiro spread, and what was its purpose?\",\n\"Does RotaJakiro have a specific target?”, We would love to know if the community has\nrelevant leads.\n\n## Contact us\n\n[Readers are always welcomed to reach us on twitter, or email to netlabat[at]360.cn.](https://twitter.com/360Netlab)\n\n## IOC\n\nSample MD5\n```\n1d45cd2c1283f927940c099b8fab593b\n11ad1e9b74b144d564825d65d7fb37d6\n5c0f375e92f551e8f2321b141c15c48f\n64f6cfe44ba08b0babdd3904233c4857\n\n```\nC2\n```\nnews.thaprior.net:443\nblog.eduelects.com:443\ncdn.mirror-codes.net:443\nstatus.sublineover.net:443\n\n```\nIP\n```\n176.107.176.16 Ukraine|Kiev|Unknown 42331|PE_Freehost\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-28 - RotaJakiro- A long live secret backdoor with 0 VT detection.pdf"
    ],
    "report_names": [
        "2021-04-28 - RotaJakiro- A long live secret backdoor with 0 VT detection.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535696,
    "ts_updated_at": 1743041173,
    "ts_creation_date": 1653785788,
    "ts_modification_date": 1653785788,
    "files": {
        "pdf": "https://archive.orkl.eu/184aac56fce6d28fda1fa76f754b09f602306a02.pdf",
        "text": "https://archive.orkl.eu/184aac56fce6d28fda1fa76f754b09f602306a02.txt",
        "img": "https://archive.orkl.eu/184aac56fce6d28fda1fa76f754b09f602306a02.jpg"
    }
}