{
    "id": "08ab9304-a429-4547-b742-d7fbfa149733",
    "created_at": "2023-01-12T15:08:16.466813Z",
    "updated_at": "2025-03-27T02:16:26.010899Z",
    "deleted_at": null,
    "sha1_hash": "631ea354ed3a59a8828ae14de3e699f57e329cff",
    "title": "2020-08-08 - Phirautee - DEFCON28 - Writing Ransomware using Living off the Land (LotL) Tactics",
    "authors": "",
    "file_creation_date": "2022-05-28T15:38:21Z",
    "file_modification_date": "2022-05-28T15:38:21Z",
    "file_size": 291010,
    "plain_text": "# Phirautee - DEFCON28 - Writing Ransomware using Living off the Land (LotL) Tactics\n\n**[speakerdeck.com/viralmaniar/phirautee-defcon28-writing-ransomware-using-living-off-the-land-lotl-tactics](https://speakerdeck.com/viralmaniar/phirautee-defcon28-writing-ransomware-using-living-off-the-land-lotl-tactics)**\n\n**ViralManiar**\n\nAugust 08, 2020\n\n**[Technology](https://speakerdeck.com/c/technology)**\n\n**[0](https://speakerdeck.com/signin?return_to=%2Fviralmaniar%2Fphirautee-defcon28-writing-ransomware-using-living-off-the-land-lotl-tactics)**\n\n**1.1k**\n\nOver the past few years, ransomware has gone wild and organisations around the world are\ngetting targeted leading to the damage and disruption. As we all know that the threat\nlandscape is changing rapidly and we hear the fuss about ransomware infection at the\noffices or read about it in the news. Have you ever wondered how threat actors are writing\n\n\n-----\n\nransomwares? What level of sophistication and understanding is required to target an\norganisation? In this demo, we will utilise the native Windows commands to build\nransomware and target a host via phishing. Introducing Phirautee, a proof of concept crypto\nvirus to spread user awareness about attacks and implications of ransomwares. Phirautee is\nwritten purely using PowerShell and does not require any third-party libraries. This tool steals\nthe information, holds an organisation's data to hostage for payments or permanently\nencrypts/deletes the organisation data. The tool uses public-key cryptography to encrypt the\ndata on the disk. Before encrypting, it exfiltrates the files from the network to the attacker.\nOnce the files are encrypted and exfiltrated, the original files are permanently deleted from\nthe host and then tool demands a ransom. The ransom is asked using the cryptocurrency for\npayments, so transactions are more difficult for law enforcement to trace. During the\ndemonstration of Phirautee, you will see a complete attack chain i.e. from receiving\nransomware attack via a phishing email and how the files get encrypted on the compromised\nsystems. A detailed walkthrough of the source code would be provided to understand how\nhackers utilise simple methods to create something dangerous. I will end the demo with\nseveral defence mechanisms by performing forensics analysis on Phirautee using publicly\navailable tools.\n\n## More Decks by ViralManiar\n\n[See All by ViralManiar](https://speakerdeck.com/viralmaniar)\n\n## Other Decks in Technology\n\n[See All in Technology](https://speakerdeck.com/c/technology)\n\nsrenext2022-skaru\n\nmixi_engineers\n\n\nPRO\n\n\n1\n\n1.1k\n\n\n-----\n\nGraph API について\n\nmiyakemito\n\n0\n\n330\n\nNestJS + Prisma2 で歩む RLS の世界\n\nynaka81\n\n1\n\n100\n\nMicrosoft Build 2022 - Azure のデータ & 分析サービス 最新アップデート / Microsoft …\n\nnakazax\n\n\n-----\n\n1\n\n220\n\nプロダクトの理想と現実はなぜ乖離しがち？プロダクト作りに潜む問題を考える\n\nsuzukentaro\n\n0\n\n270\n\n1年間のポストモーテム運用とそこから生まれたツール sre-advisor / SRE NEXT 2022\n\nfujiwara3\n\n6\n\n3.8k\n\n\n-----\n\nニフティでSRE推進活動を始めて取り組んできたこと\n\nniftycorp\n\n2\n\n850\n\n長年運用されてきたモノリシックアプリケーションをコンテナ化しようとするとどん…\n\nnulabinc\n\n\nPRO\n\n\n15\n\n8.1k\n\n數據的多重宇宙 @ LINE Taiwan\n\nline_developers_tw\n\n\n-----\n\nPRO\n\n\n0\n\n1k\n\nPuny to Powerful PostgreSQL Rails Apps\n\nandyatkinson\n\n\nPRO\n\n\n0\n\n410\n\n[SRE NEXT 2022]KaaS桶狭間の戦い 〜Yahoo! JAPANのSLI/SLOを用いた統合監視〜\n\nsrenext\n\n0\n\n\n-----\n\n690\n\nプルリク作ったらデプロイされる仕組み on ECS / SRE NEXT 2022\n\ncarta_engineering\n\n1\n\n670\n\n## Featured\n\n[See All Featured](https://speakerdeck.com/p/featured)\n\nA Philosophy of Restraint\n\ncolly\n\n192\n\n14k\n\n\n-----\n\nWriting Fast Ruby\n\nsferik\n\n612\n\n57k\n\nLearning to Love Humans: Emotional Interface Design\n\naarron\n\n261\n\n37k\n\nDesigning with Data\n\nzakiwarfel\n\n91\n\n\n-----\n\n3.9k\n\nWebSockets: Embracing the real-time Web\n\nrobhawkes\n\n57\n\n5k\n\nHow GitHub Uses GitHub to Build GitHub\n\nholman\n\n465\n\n280k\n\nBuild The Right Thing And Hit Your Dates\n\n\n-----\n\nmaggiecrowley\n\n19\n\n1.2k\n\nFontdeck: Realign not Redesign\n\npaulrobertlloyd\n\n73\n\n4.1k\n\nProducing Creativity\n\norderedlist\n\n\nPRO\n\n\n333\n\n\n-----\n\n37k\n\nHow GitHub (no longer) Works\n\nholman\n\n296\n\n140k\n\nFantastic passwords and where to find them - at NoRuKo\n\nphilnash\n\n25\n\n1.5k\n\nBuilding Better People: How to give real-time feedback that sticks.\n\n\n-----\n\nwjessup\n\n343\n\n17k\n\n## Transcript\n\n1. Phirautee - DEF CON 28 Presentation \n### https://github.com/Viralmaniar/Phirautee\n\n[2. LEGAL DISCLAIMER 2 • Performing any hack attempts or tests](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_1.jpg)\n\nwithout written permission from the owner of the computer system is illegal. • If you\nrecently suffered a breach or targeted by a ransomware and found techniques or tools\nillustrated in this presentation similar, this neither incriminates my involvement in any\nway, nor implies any connection between myself and the attackers. • The tools and\ntechniques remain universal and penetration testers and security consultants often\nuses them during engagements. • Phirautee project must not be used for illegal\npurposes. It is strictly for educational and research purposes and for people to\nexperiment with.\n\n[3. WHOAMI 3 • Over 8 years of experience in the](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_2.jpg)\n\nfield of information security and management • Passionate about offensive and\ndefensive security • Runs a boutique consultancy firm – Preemptive Cybersecurity Pty\nLtd • Technical Manager at RiskIQ for the APAC region • In my free time I develop\nsecurity tools • Presented at BlackHat USA, RootCon and (ISC)2 local chapter •\nOutside of Infosec land – I like photography https://github.com/Viralmaniar\nhttps://twitter.com/maniarviral https://www.linkedin.com/in/viral maniar/\nhttps://viralmaniar.github.io/\n\n\n-----\n\n[4. AGENDA Your Logo Here 4 • History of threat actors](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_3.jpg)\n\n  - Recent news on ransomware attacks • Introduction to ransomware • Statistics of the\nransomware attacks • Understand the Ransomware as a Service (RaaS) chain •\nIntroduction to Phirautee tool and setup guide • Demo - Phirautee • Mitigation\nstrategies • Final words on some of the community projects\n\n[5. STEALING – OLDEST CRIME Your Logo Here 5](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_4.jpg)\n\n[6. RECENT RANSOMWARE ATTACKS 6](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_5.jpg)\n\n[7. INTRODUCTION TO RANSOMWARE 7 • Ransomware is a class of](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_6.jpg)\n\nmalware that uses cryptography algorithms to encrypt files on the infected machine and\nlater extorts the victim to pay via crypto currency, gift cards, bank transfers or mobile\npayments. • Upon payment user may or may not receive a decryption key to retrieve\nencrypted files. • Most ransomware attacks are financially motivated. • Most common\nway of asking ransom is through cryptocurrency such as Bitcoin (BTC), Ethereum\n(ETH) or Monero (XMR). • Recent trends shows ransomware authors are moving to\nprivacy coins such as Monero (XMR). New version of Sodinokibi aka REvil have\ndecided to abandon Bitcoin and switched to Monero Cryptocurrency.\n\n[8. HOW DO I KNOW IF I AM INFECTED? 8 •](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_7.jpg)\n\nRansomware is usually considered as one of the nosiest attacks. Infection signs are\nshown to users through various channels such as desktop wallpaper, notes and\nthrough infection notice. • An alarming window is opened and you cannot close it. •\nBelow are some examples of ransomware screens:\n\n[9. WANNACRY HACKED EVERYTHING 9](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_8.jpg)\n\n[10. 32 58 638 184 204.24 187.9 0 100 200 300](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_9.jpg)\n\n400 500 600 700 12/31/2015 12/31/2016 12/31/2017 12/31/2018 12/31/2019\n07/30/2020 Ransom Attacks Remote Services 51% Phishing Emails and Social\nEngineering 38% Software vulns 8% Torrent, Cracked Software or USB attacks 3%\n“Most of the ransomware attacks are opportunistic“ Ransomware attacks: 2015- 2020\n(Q1) ATTACK STATISTICS AND INFECTION METHODS 10\n\n\n-----\n\n11. RANSOMWARE AS A SERVICE 11 Malicious attackers or criminals\n\n### hacks\n\ninto a server or hosts. Make them part of a huge botnet. Puts this machine up for a sale\nin the market for others to play around. Ransomware authors buys access to these\ncompromised hosts and installs backdoors on the system for persistence mechanism.\nMalicious attackers then use it for a malware distribution, DDoS attacks, phishing\ncampaigns, social engineering, fraud, Crypto mining or for a ransom.\n\n[12. XDEDIC 12 • xDedic is a great example of one](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_11.jpg)\n\nsuch marketplace. The service was offering 70k hosts across 173 countries. • Portal\nhad 416 unique sellers at the time of takedown.\nhttps://media.kasperskycontenthub.com/wpcontent/uploads/sites/43/2018/03/07191218/xDedic_marketplace_ENG.pdf\n\n13. LOGS/RDP/SSH/PP/CC/SMB MARKETPLACE 13 • There are number of\n\n### market places\n\nout there to buy access to compromised hosts • Selling price for access to government\nnetworks, corporations or universities is as low as low 6$ per host.\n\n[14. 31865 12089 15761 377027 779856 1339878 157445 71063 327931 0](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_13.jpg)\n\n500000 1000000 1500000 Q3 2019 – Q4 2019 - Q1 2020 Sodinokibi Ryuk Phobos The\naverage ransom amount paid by a ransomware victim to their attacker - in exchange\nfor the promise of a decryption tool - increased throughout last year. But from the third\nto fourth quarter of 2019, ransom payment amounts skyrocketed, from $41,198 to\n$84,116. The median Q4 payment was $41,179. \"The doubling of the average reflects\nthe diversity of the threat actors that are actively attacking companies,\" – Coveware\nReport. Attackers using Ryuk and Sodinokibi - aka REvil - are increasingly focusing\ntheir attacks on large companies where they can attempt to extort the organization for a\nseven-figure payout. Note that the average Ryuk ransom payment last quarter was\n$780,000 Average Ransom Payments: Top 3 Types\n\n[15. TARGETED INDUSTRIES 15 60% 56% 55% 54% 50% 49% 49%](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_14.jpg)\n\n48% 46% 45% Industries victim of ransomware attacks Media & Entertainment IT &\nTelecom Energy, oil/gas & utilities Other Business & professional services Construction\n& property Retail, distribution and transport Financial services Manufacturing and\nproduction Public Sector E-Sports Entertainment, Travelex, NHS, Honda Toll Group,\nDeutsche Bahn, Maersk, FedEx Garmin, IN SPORT, Lion, E-Sports Entertainment In\nthe last year, has your organisation been hit by ransomware? Base: 5,000\nrespondents. (THE STATE OF RANSOMWARE 2020 ) – Sophos white paper\nBlackbaud Argentine Telcom UCSF Cognizant\n\n\n-----\n\n16. Upcoming Deposits Market Place Over 150 countries got infected\n\n### ATTACK\n\nSUMMARY 16 300,000+ Latest Ransom: $10 Million $ 84,116 Organisations sustained\nattacks: 205, 280 › 1,150% increment in 2019 › Victim paid avg $20,000 Victims around\nthe world Crypto (70-80%) Other (7%) Infrastructure (10%) Gift Card (13%) Ransom\namount gets cashed out using cryptocurrency exchanges. Buy online gift cards Buy\nnew attack infra Drugs, games etc 0 20 40 RDP SSH Persistence with RAT SSH - RDP\n$1,500 $6 - $350 Ransomware attacks are considered as a number one threats to the\nnetworks in the year of 2020. Attacks are increasingly causing extended periods of\ncostly downtime. Multiple methods available for cashing out the ransom money.\n\n[17. INTRODUCING PHIRAUTEE 17 • Phirautee is a proof of concept](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_16.jpg)\n\nransomware tool written purely using PowerShell. • It uses Living off the Land (LotL)\ncommands to work against the operating system to encrypt files on the machine. • This\ntool can be used during internal infrastructure penetration testing or during the red\nteam exercise to validate Blue Team/SOC response to ransom attacks. • It uses public\nkey cryptography to encrypt user content and exfiltrates large files via Google Drive. •\nUpon successful attack the ransomware asks for a payment of 0.10 BTC (~1k USD). •\nDetection: • File extension of the encrypted files are changed to “.phirautee” • Desktop\nwallpaper of the compromised host is changed with Phirautee background • Desktop\nwill have Phirautee.txt file\n\n[18. PHIRAUTEE ATTACK SETUP 18 • Phishing server and domain to](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_17.jpg)\n\ntarget an organisation. • Email server to send malicious documents as an attachment to\nthe targeted user. • Macro embedded file as an attachment to user which pulls the\nransomware from the remote server to targeted machine and runs it in a memory. •\nModify couple of parameters in the ransomware file to utilise it for your use case. • For\ndata exfiltration: • Throwaway Gmail account • Gmail API access to a throwaway\nGoogle Drive • Setup web application on the Google • Detailed steps for the Google\nDrive setup can be viewed at:\nhttps://github.com/Viralmaniar/Phirautee/blob/master/Exfil%20Setup.md\n\n[19. USE OF CRYPTOGRAPHY IN PHIRAUTEE 19 • Uses 2048 bits](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_18.jpg)\n\nRSA key to encrypt files on the infected machine. • Private key of the certificate gets\nsent to attacker using a pre-shared secret aka symmetric keys. Symmetric Key\nCryptography Asymmetric Key Cryptography\n\n\n-----\n\n[20. SYMMETRIC KEYS & ANON SMTP 20 • Phirautee uses two](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_19.jpg)\n\nunique symmetric keys • One for the private key of the certificate that’s being\ngenerated on the user machine. • The other one for uploading exfiltrated data on\nGoogle Drive • The private keys are sent to Pokemail as a zip encrypted files. •\nPhirautee uses Pokemail services to distribute the attack infrastructure by creating a\nrandom location based email address.\n\n[21. THINK INNOVATIVE 21 • Can you do your entire attack](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_20.jpg)\n\nin memory? • Can you be more intrusive and silent at the same time? • Can you\ncompromise a host on the UAC settings of “Always notify”? • Can you delete logs and\nclear traces? • Can you perform the entire malicious operation without user interaction?\n\n  - Is your code detected by an AV/EDR vendor?\n\n[22. TRY UNTIL YOU CAN BYPASS 22](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_21.jpg)\n\n[23. DEMO TIME! 23](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_22.jpg)\n\n[24. IOCS FOR PHIRAUTEE 24 File paths: • C:\\temp\\cert.cer • c:\\temp\\sys.txt](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_23.jpg)\n\n  - c:\\temp\\backup.zip • c:\\temp\\sys1.txt • c:\\temp\\steal.zip •\nC:\\users\\$env:USERNAME\\PhirauteeBackground-3.jpg MD5s: •\n77EA9D33D144072F7B35C10691124D16 •\n4E123FF3A7833F0C8AC6F749D337444D Domains used for exfil: •\nhttps://smtp.pokemail.net • https://www.googleapis.com • https://accounts.google.com •\nhttps://raw.githubusercontent.com Registry files: • HKCU:\\Control Panel\\Desktop\n\n25. HOW CRIMINALS CONVERT RANSOM TO CASH? 25\n\n### https://bitshills.com/best-non-kyc-crypto-exchanges/\n\n26. RANSOMWARE WRITERS ARE NOT PERFECT 26 • Ransomware writers\n\n### are\n\nhumans too. They make mistakes. • Before paying your ransom make sure your\nincident response team performs investigation on the malware behavior. • Some of the\nransomware writers drop encryption/decryption keys on the infected machine itself.\nMake your incident response team to analyse the code. • Put a proxy in between and\nmodify the amount or address. Sometimes you’ll see parameters with value true and\nfalse. Changing them decrypts your files. • Take snapshot of the system before and\nafter the infection if you have samples. Take note of changes on the system.\n\n\n-----\n\n27. RANSOMWARE PROTECTION IN WINDOWS 27 • Ransomware\n\n### Protection is disabled\n\nby default • Controlled folder access helps you protect valuable data from malicious\napps and threats. • Controlled folder access feature is included with Windows 10 and\nWindows Server 2019. • Directories containing sensitive data should be added to\ncontrolled folder. • In case the malicious application tries to modify or change the\ndocuments in the controlled folder a notification is generated through Microsoft\nDefender.\n\n28. MITIGATION STRATEGIES 28 • Network segmentation and detection of\n\n### lateral\n\nmovement. Follow principle of least privilege access or restrict access to sensitive\nservers. Make use of MFA on all important portals. • Disable PowerShell for standard\ndomain users and perform application whitelisting. • Frequent network wide backups (if\npossible offline). • Apply patches and have a vulnerability management program. •\nHave a dedicated incident response team and develop a plan for ransomware events. •\nInvest in a good IDS/IPS/EDR/AV/CASB product. • Validate the effectiveness of your\ndefense tools and technologies through pre-approved offensive exercise. • Organise\nphishing and user education training sessions for your employees. • Have cyber\ninsurance to help cover costs in case you need to pay the ransom. Furthermore, get\nyour insurance policies reviewed to make sure there are no holes. • Take help from\nlocal feds for the decryption keys. https://id-ransomware.malwarehunterteam.com/\nhttps://www.nomoreransom.org/\n\n[29. WWW.NOMORERANSOM.ORG 29](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_28.jpg)\n\n[30. ID-RANSOMWARE.MALWAREHUNTERTEAM.COM 30](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_29.jpg)\n\n31. 31 Image from: https://www.metacompliance.com/wp\n### content/uploads/2020/03/Ransomware_Guidelines_Point_8_png_BuYG A-N6.png\n\n[32. THANK YOU](https://files.speakerdeck.com/presentations/dd3ba7a5e10c493b8613ec36638f0fc6/slide_31.jpg)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-08 - Phirautee - DEFCON28 - Writing Ransomware using Living off the Land (LotL) Tactics.pdf"
    ],
    "report_names": [
        "2020-08-08 - Phirautee - DEFCON28 - Writing Ransomware using Living off the Land (LotL) Tactics.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536096,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653752301,
    "ts_modification_date": 1653752301,
    "files": {
        "pdf": "https://archive.orkl.eu/631ea354ed3a59a8828ae14de3e699f57e329cff.pdf",
        "text": "https://archive.orkl.eu/631ea354ed3a59a8828ae14de3e699f57e329cff.txt",
        "img": "https://archive.orkl.eu/631ea354ed3a59a8828ae14de3e699f57e329cff.jpg"
    }
}