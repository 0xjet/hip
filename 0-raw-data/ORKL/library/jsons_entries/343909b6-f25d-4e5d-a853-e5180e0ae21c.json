{
    "id": "343909b6-f25d-4e5d-a853-e5180e0ae21c",
    "created_at": "2023-01-12T15:09:48.455041Z",
    "updated_at": "2025-03-27T02:09:47.983727Z",
    "deleted_at": null,
    "sha1_hash": "59e5bc6bfe4f231ccda5a426c090c7bddb2bd30f",
    "title": "2017-06-19 - Delphi Used To Score Against Palestine",
    "authors": "",
    "file_creation_date": "2022-05-28T17:55:25Z",
    "file_modification_date": "2022-05-28T17:55:25Z",
    "file_size": 1565021,
    "plain_text": "# Delphi Used To Score Against Palestine\n\n**[blog.talosintelligence.com/2017/06/palestine-delphi.html](http://blog.talosintelligence.com/2017/06/palestine-delphi.html)**\n\n[This blog was authored by Paul Rascagneres and](https://www.blogger.com/profile/10073079939160046441) [Warren Mercer with contributions from](https://blogs.cisco.com/author/warrenmercer)\n[Emmanuel Tacheau,](https://blogs.cisco.com/author/emmanueltacheau) [Vanja Svajcer and](https://www.blogger.com/profile/18152595187998952871) [Martin Lee.](https://www.blogger.com/profile/17941683095374027310)\n\n## Executive Summary\n\nTalos continuously monitors malicious emails campaigns. We identified one specific spear\nphishing campaign launched against targets within Palestine, and specifically against\nPalestinian law enforcement agencies. This campaign started in April 2017, using a spear\nphishing campaign to deliver the MICROPSIA payload in order to remotely control infected\nsystems. Although this technique is not new, it remains an effective technique for attackers.\n\nThe malware itself was developed in Delphi; in this article, we describe the features and the\nnetwork communication to the command and control server used by the attackers. The threat\nactor has chosen to reference TV show characters and include German language words\nwithin the attack. Most significantly, the attacker has appeared to have used genuine\ndocuments stolen from Palestinian sources as well as a controversial music video as part of\nthe attack.\n\n## Spear Phishing Campaign\n\n\n-----\n\nWe identified a spear phishing campaign that appeared to be targeting members of the\nPalestinian law enforcement services as well as other Palestinian targets in the public sector.\nThe email purports to be sent from an individual named \"Yasser Saad\" but includes a\n[mismatch between the apparent name and the email address 'yassersaaid01@gmail.com'](http://10.10.0.46/mailto:yassersaaid01@gmail.com)\nsuggesting \"Yasser Saaid\".\n\nThe subject of the email translates to \"Brothers security officers and directors\", with the text\ncontent \"Kindly to view and circulate under the responsibility:\nThe Council of Ministers' Decision on the Use of the Internet in Government Institutions\"\n\nAttached to the email is a .r10 file, which suggests that the file is a tenth part of a split RAR\narchive. However, this isn't the case. The attachment is a simple RAR file. Despite the\nunusual file name extension, this file can be opened by many RAR archive handlers without\nmodification.\n\nThe RAR archive contains a single executable file named:\nInternetPolicy_65573247239876023_3247648974234_32487234235667_pdf.exe\n\nThe .r10 file extension may have been chosen in order to confuse automated file parsing\nsystems that check for malicious contents of archives with known file name extensions.\nSimilarly, the long name of the file within the archive, along with the ending '_pdf.exe' may\nhave been used to convince victims into thinking that the file is a real PDF file. It is worth\nkeeping in mind that by default Windows will not show the .exe extension to the user. The\nicon of executable file itself is that commonly used for PDF files, enhancing the idea that the\ncontents of the archive is a PDF.\n\nWhen the executable is launched it extracts the decoy document embedded as the PE\nresource named Resource_1 and opens it.\n\n### Decoy Document\n\nThe decoy document displayed, InternetPolicy.pdf, is a scanned document by the Ministry Of\nInterior of the State Of Palestine, signed by Dr Alaa Mousa, Minister of Communications &\nTechnologies:\n\n\n-----\n\nThe decoy document contains 7 pages describing new internet usage policies. The first page\n(shown above) informs governmental departments of the policy, and instructs them to follow\nit. A handwritten note stated to be from the Director of the IT Department adds his 'seal of\napproval' to the document.\n\nIn the background, the malware MICROPSIA is executed on the infected system. This\nmalware is a Remote Administration Tool (RAT), it will be described later.\n\n## Associated Campaigns\n\nWe have also identified drive-by download campaigns which are distributing variants of the\nsame malware, but with different decoy documents.\n\n\n-----\n\nURLs used in this campaign include:\n\nhttp://sheldon-cooper[.]info/Fuqha_NewDetails_docx.r10\nhttp://feteh-asefa[.]com/pc/public/Fuqha_NewDetails_docx.r10\nhttp://feteh-asefa[.]com/pc/public/Altarnatevs.r10\nhttps://sheldon-cooper[.]info/attachment.r10\n\nAs with the spear phish, the archives also have the same .r10 extension. The first two\narchives contain the file:\nFuqha_NewDetails_874918321795_39778423423094_1988734200039_docx.exe which\nalthough the file name suggests a .docx file, the icon is that of a PDF document.\n\nThe second two archives contain the file:\nAltarnatives_Palestine_89840923498679852_9879483278432732489_pdf.exe Again being\nan executable file with a PDF style icon.\n\n### Decoy Documents\n\n**Altarnatives_Palestine Document**\n\nThe .pdf decoy document is study from the Palestinian Center for Policy Research and\nStrategic Studies (MASARAT):\n\n\n-----\n\nThis 22 pages long research document addresses the current level of threat & security\nissues within the West Bank for 2016 & 2017. It contains chapters relating to human rights,\ndata from Arab World for Research and Development center, violence center report etc.\n\n**Fuqha_NewDetails Document**\n\nThis 8 page long document appears to be an intelligence report based on interviews,\ndocuments and public information. The document mentions an assassination report of one of\nthe highest ranked officers of the Al Qassam group's (Millitary Wing of HAMAS, aka Armed\nMilitia). The document contains a single image, an illustration of the leadership of Hamas,\nhierarchical security & subgroups:\n\n\n-----\n\n## Further Campaigns\n\nWe also identified additional, related malicious documents which conform to the same\nnaming pattern and which share indicators with the original malware we discovered.\n\n**Plan_Palestine Document**\n\nPlan_Palestine_898409266595123498679852_9879483278432732489_pdf.exe\n\nThe decoy document of this sample is a word document. It presents the strategic objectives,\npolicies and interventions concerning security units (aka Police), including how to face the\nchallenges, how to train police, new weapons etc.\n\n\n-----\n\n**Diwan2017_Palestine Document**\n\nDiwan2017_Palestine_89840923498679852_9879483278432732489_pdf.exe\n\nThis decoy document is a PDF file. The document itself appears to be scanned from the\nCouncil of Ministers of Palestine and relates to an announcement concerning employee\nregulation.\n\n\n-----\n\n**Goal2017 Document**\n\nGoal2017_487886_10152599711675287_250999354_n_354343741352mp4.exe\n\nInstead of a decoy document, this sample is a decoy video of a music clip \"Goal\" by the\nLebanese singers Myriam Klink and Jad Khalife. This video is particularly controversial as\n[the overt nature of the video led it to be banned by the Lebanese Justice ministry. The](http://gulfnews.com/news/mena/lebanon/lebanese-pop-singer-s-song-goal-banned-1.1989080)\nsharing or airing of it is subject to a fine of 50 000 000 Lebanese Liras (approximately 33k\nUSD).\n\n\n-----\n\n## MICROPSIA Analysis\n\nFor all of these decoy documents, the malware is identical, the only differences are the\nsections containing the decoy documents themselves. The malware is a remote access\ntrojan (RAT) written in Delphi named MICROPSIA.\n\n### Features\n\nFirstly, the malware copies itself in C:\\ProgramData\\MediaPlayer\\ExecuteLibrary.exe. The\nmalware contains several resources, one of which is the decoy document, another is a\nlegitimate binary developed by OptimumX named shortcut.exe. As expected the purpose of\nthis tool is to create a shortcut. It is through creating a shortcut that the malware ensures its\npersistence:\n\nShortcut.exe /f:\"C:\\Users\\Administrator\\AppData\\Roaming\\Microsoft\\Windows\\Start\nMenu\\Programs\\Startup\\D_Windows_v1.lnk\" /a:c\n/t:\"C:\\ProgramData\\MediaPlayer\\ExecuteLibrary.exe\"\n\n\n-----\n\nThe malware is a Remote Administration Tool (RAT) which downloads and executes an\nexecutable obtained from the Command & Control infrastructure. This executable is\ndownloaded in string format and then modified to become a binary file with the Hex2Bin\nDelphi API.\n\nAn interesting element is the obfuscation algorithm used to hide the configuration of the RAT.\nThe variables are stored in a custom base64:\n\nOnce decoded with base64 and with 2 XOR Keys we can obtain the configuration of the\nmalware:\n\n[{000214A0-0000-0000-C000-000000000046}]\nProp3=19,2\n\n[InternetShortcut]\nIDList=\nURL=file://\nMozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\nhttp://camilleoconnell.website/api/white_walkers/\ndaenerys\nbetriebssystem\nanwendung\nmikasa\nackerman\nginny\nAV\n\nWe will see later, that this configuration contains the User-Agent, the CC URL and the json\nkeys used for the network communication.\n\nAdditionally the malware is interested by Anti-Virus installed on the system. It uses WMI\nqueries to get this information:\n\nSELECT * FROM AntiVirusProduct\nSELECT * FROM AntiSpywareProduct\nSELECT * FROM FirewallProduct\n\nIf an security product is installed this information is sent to the attacker.\n\n\n-----\n\n### Network Communication\n\nAll the network parameters are stored in the sample and can be easily updated by the\nauthor. The CnC is a web server: http://camilleoconnell[.]website\n\nThe network communication is performed in HTTP. The malware uses an hardcoded UserAgent: Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\n\nTo register a new infected system the malware perform a POST request to\n/api/white_walkers/new with data on the compromised system consisting of:\n\nthe filename of the executed malware and the version;\nthe version of the infected Operating System;\nthe hostname and username encoded in base64.\n\nThe CC will reply in json format. The json object contains an ID (incremented each time that\nan infected system is registered) and 3 other boolean values: load_varys, lma and ausfart.\nHere is an output of a registration:\n\n\n-----\n\nAs part of our investigation we believe currently more than 500 systems are already\nregistered on the CC. This number may be a mix of genuinely infected systems and security\nresearcher sandbox systems.\n\nAfter a registration, the malware periodically performs HTTP requests to the CC with the\nfollowing pattern: GET /api/white_walkers/[base64_data_previously_sent]/requests\n\nThe server will reply with a json object. We assume that the server can issue orders to the\ninfected system. Here is an example:\n\n\n-----\n\n### Reference to TV Show Characters\n\nIn the analysed variant, we identify several reference to TV Show characters in the network\ncommunication and the URLs used by this actor:\n\nsheldon-cooper[.]info: this URL is a reference to one of the main characters of \"The Big\nBang Theory\" named Sheldon Cooper;\nCamilleoconnell[.]website: this URL is a reference to Camille O'Connell, the main\nactress of \"The Vampire Diaries\" and \"The Originals\";\nMikasa Ackerman is a json key returned by the CC. And this name is a character in\n\"Attack on Titan\";\n/White_Walker/ in the URL is a species in the TV Show \"Game of Thrones\";\nDeanerys is a variable used during Web request. This is the name of a character in\n\"Game of Thrones\";\nLord_varys is another json key returned by the CC. This is the name of a \"Game of\nThrones\" character.\n\nThe malware author appears to have a real interest for TV shows.\n\n### Goethe's Style\n\nWe identified the use of german language words in the network communication with the\nCommand and Control server.\n\n\"Betriebssystem\" which means Operating System. This variable is used to send the OS\nversion (for example \"Windows 7 Service Pack 1 (Version 6.1, Build 7601, 32-bit\nEdition)\")\n\n\n-----\n\nAnwendung which means Application. This variable is used to send the filename and\nthe version of the malware.\n\"Ausfahrt\" which means Exit. This is a json key used by the CC during network\ncommunication. The key contains a boolean (false/true)\n\nObviously, the use of german words does not necessarily means that the author is German.\nThe author could simply be adding german word in order to cover their tracks.\n\n## Conclusion\n\nThis spear phishing campaign was directed against Palestinian authorities and possibly\nagainst other entities. At least 500 machines have been registered by the CC infrastructure,\nwhich is still operating, indicating that this is a successful campaign.\n\nAt Talos, we have in-depth experience of many APT campaigns, in this case one of the most\nsurprising elements is the overt naming convention: the author deliberately uses references\nto several US TV show and intentionally uses German words for malware communication.\nWe have no indication if these inclusions are to confuse attribution, to mock analysts, or a\nlapse of trade craft. This is in contrast to the highly convincing decoy documents which\nappear to be copies of genuine documents relating to the current situation in Palestine which\nsuggests a high degree of professionalism.\n\n## IOCs\n\n### File hashes\n\nInternetPolicy.r10: 9b162f43bcbfaef4e7e7bdffcf82b7512fac0fe81b7f2c172e1972e5fe4c9327\n\nInternetPolicy_65573247239876023_3247648974234_32487234235667_pdf.exe:\n9cb5ef0b17eea1a43d5d323277e08645574c53ab1f65b0031a6fc323f52b0079\n\nAttachment.r10:\nc7081b00ad8db62519c7af2cb5f493f56ecc487b087ae52d01f43953d2aa6952\n\nAltarnatives_Palestine_89840923498679852_9879483278432732489_pdf.exe:\n0180e2b601ae643e7adf1784c313dd2d10d114bd2b5692eb6e9c031a6e448ed1\n\nFuqha_NewDetails_docx.r10:\n94902877b2cb523548a272d4e4fe0789192e1cb35b531297368b16a2865b33af\n\n\n-----\n\nFuqha_NewDetails_874918321795_39778423423094_1988734200039_docx.exe:\n77adba034d13b570c6aab79282326a1eb2efdfc14fbd7cd0651906e3fa31f9fe\n\nPlan_Palestine_898409266595123498679852_9879483278432732489_pdf.exe:\n6c5884cf45d943f51566ea98113fecf851d49f59b70c8039aa21a14e09e21e5c\n\nDiwan2017_Palestine_89840923498679852_9879483278432732489_pdf.exe:\n7c87f992674b962269d7fb2ffbad6d21f606c90d151a6fb67ac54387b6883aae\n\nGoal2017_487886_10152599711675287_250999354_n_354343741352mp4.exe:\n\n5f5af4762c073234fef6bfeaa3b9f6a04982e82a25e540116aa1f9e38223ae2b\n\n### Domains\n\nfeteh-asefa[.]com\n\nsheldon-cooper[.]info\n\ncamilleoconnell[.]website\n\n### URLs\n\nhttp://sheldon-cooper[.]info/Fuqha_NewDetails_docx.r10\n\nhttp://feteh-asefa[.]com/pc/public/Fuqha_NewDetails_docx.r10\n\nhttp://feteh-asefa[.]com/pc/public/Altarnatevs.r10\n\nhttps://sheldon-cooper[.]info/attachment.r10\n\nhttp://camilleoconnell[.]website/api/white_walkers/new\n\nhttp://camilleoconnell[.]website/api/white_walkers/[base64]/requests\n\n## Coverage\n\nOpen Source Snort Subscriber Rule Set customers can stay up to date by downloading the\nlatest rule pack available for purchase on Snort.org.\n\nAdditional ways our customers can detect and block this threat are listed below.\n\n\n-----\n\nAdvanced Malware Protection (AMP) is ideally suited to prevent the execution of the\nmalware used by these threat actors.\n\nCWS or WSA web scanning prevents access to malicious websites and detects malware\nused in these attacks.\n\nNetwork Security appliances such as NGFW, NGIPS, and Meraki MX with Advanced\nSecurity can detect malicious activity associated with this threat AMP Threat Grid helps\nidentify malicious binaries and build protection into all Cisco Security products.\n\nUmbrella prevents DNS resolution of the domains associated with malicious activity.\n\nStealthwatch detects network scanning activity, network propagation, and connections to\nCnC infrastructures, correlating this activity to alert administrators.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-06-19 - Delphi Used To Score Against Palestine.pdf"
    ],
    "report_names": [
        "2017-06-19 - Delphi Used To Score Against Palestine.pdf"
    ],
    "threat_actors": [
        {
            "id": "f7d9b02d-d294-422b-adf7-4b3adfac9d9a",
            "created_at": "2022-10-25T16:07:23.392241Z",
            "updated_at": "2025-03-27T02:02:09.775925Z",
            "deleted_at": null,
            "main_name": "The Big Bang",
            "aliases": [],
            "source_name": "ETDA:The Big Bang",
            "tools": [
                "Micropsia"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9198aefa-3da6-4605-bb52-923df20a7fce",
            "created_at": "2023-01-06T13:46:38.766848Z",
            "updated_at": "2025-03-27T02:00:02.913269Z",
            "deleted_at": null,
            "main_name": "The Big Bang",
            "aliases": [],
            "source_name": "MISPGALAXY:The Big Bang",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536188,
    "ts_updated_at": 1743041387,
    "ts_creation_date": 1653760525,
    "ts_modification_date": 1653760525,
    "files": {
        "pdf": "https://archive.orkl.eu/59e5bc6bfe4f231ccda5a426c090c7bddb2bd30f.pdf",
        "text": "https://archive.orkl.eu/59e5bc6bfe4f231ccda5a426c090c7bddb2bd30f.txt",
        "img": "https://archive.orkl.eu/59e5bc6bfe4f231ccda5a426c090c7bddb2bd30f.jpg"
    }
}