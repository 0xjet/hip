{
    "id": "2620a522-c61c-45cc-9be8-0b6489c2a971",
    "created_at": "2023-01-12T15:10:39.737637Z",
    "updated_at": "2025-03-27T02:05:57.814831Z",
    "deleted_at": null,
    "sha1_hash": "7196af2db5f8d33699d1990bc592d9c8b589646f",
    "title": "2022-01-27 - Malware Analysis Emotet Infection",
    "authors": "",
    "file_creation_date": "2022-05-28T03:12:08Z",
    "file_modification_date": "2022-05-28T03:12:08Z",
    "file_size": 5656532,
    "plain_text": "# Malware Analysis Emotet Infection\n\n**blog.threatlab.info/malware-analysis-emotet-infection/**\n\nJanuary 27, 2022\n\nBaru-baru ini threatlab mendapatkan kabar adanya aktivitas serangan malware emotet di\nindonesia dan kami tidak bisa menyebutkan perusahaan yang terdampak serangan ini.\nDalam hal ini kami mendapatkan sample file macro dari email spamming atau spear phising.\nEmotet sendiri adalah malware yang tidak mudah dikenali oleh antivirus karena emotet\n[termasuk dalam polymorphic virus, dimana polymorphic virus dapat merubah setiap byte](https://en.wikipedia.org/wiki/Polymorphic_code)\ndirinya sendiri yang dapat menyulitkan antivirus umumnya untuk mengidentifikasi.\n\n## Apa Bahaya Malware Emotet?\n\nMalware emotet menginfeksi umumya akan mencari celah seperti port-port yang terbuka\n[baik itu SMB, Telnet, Ftp, Printer, dan bahkan beberapa IOC (Indicator of compromise). Kami](https://en.wikipedia.org/wiki/Indicator_of_compromise)\nmenemukan adanya IOC (Indicator of compromise) dari log4j yang dapat mereka gunakan\nuntuk melakukan infeksi pada perangkat lain. Emotet dapat melakukan remote access, drop\nmalware lainya seperti ransomeware, mengumpulkan kontak email pada perangkat dan\nemail gateway untuk proses spear phising dan spamming pada perangkat lain, pencurian\ninformasi, dan lain lain.\n\nBaca juga: [Njrat malware analysis](https://blog.threatlab.info/njrat-windows-malware-analyst/#.YfIx7-pBzcc)\n\n_Baca juga:_ _[Network Analysis Command And Control](https://blog.threatlab.info/network-analysis-command-and-control/#.YfIyFOpBzcc)_\n\n## Bagaimana infeksi Malware emotet?\n\n\n-----\n\nSaat melakukan analisa kami menemukan beberapa cara bagaimana malware emotet\nmelakukan infection setelah file macro dibuka oleh korban. Pada file yang kami analisa kami\nmendapatkan 2 format seperti xlsm dan pdf, pada file xlsm ketika dibuka akan memberikan\ninformasi untuk mengaktifkan enable editing atau enable content.\n\nAnalysis Malware emotet malware excel file\nSetelah tombol enable editing atau enable content ditekan file akan loading dan proses\nkinerja CPU yang akan tinggi karena akan ada serivce yang berjalan dibackground. Malware\nemotet sendiri sama dengan malware pada umumnya ketika file malware dijalankan akan\nada request DNS ke IOC (Indicator of compromise) sebagai langkah pertama dalam proses\ninfeksinya.\n\n\n-----\n\nAnalysis Malware emotet DNS Request\nPada kasus diatas saya menggunakan fakenet dimana malware tidak akan mendapatkan\nrespon 200 ketika mengakses domain-domain IOC (Indicator of compromise) tersebut.\nMalware emotet jika melakukan request DNS dan gagal maka malware emotet akan\nmelakukan request dengan domain lainya yang sudah terdapat pada list program malware\nemotet tersebut seperti pada gambar diatas. Dimana malware akan melakukan request terus\nmenerus dengan domain berbeda.\n\nAnalysis Malware emotet Domain IOC\n\n\n-----\n\nKonsep diatas sama akan diterapkan pada file-file lainya yang ber extension berbeda contoh\nsalah satunya yang kami temukan pada file pdf yang terdapat url untuk mendownload file\nmalware lainya.\n\nAnalysis Malware emotet url donwload\nSetelah melakukan DNS Request dan mendapatkan domain yang dapat terhubung pada\nperangkat, malware emotet akan melakukan drop file dwa.ocx, dimana file tersebut adalah\nfile **[activeX yang digunakan untuk mendownload Embed Url yang ada difile macro tersebut.](https://en.wikipedia.org/wiki/ActiveX)**\n\n\n-----\n\nAnalysis Malware emotet dorp ActiveX\nTerlihat pada gambar malware emotet memanfaatkan API dari `rundll32.exe untuk`\nmenjalankan acticeX tersebut dan mendaftarkanya pada registry windows.\n\nAnalysis Malware emotet running activeX\nKami memeriksa pada alur jaringan yang keluar melalui wireshark dan mendapatkan koneksi\nuntuk mendowload file `GEXSG6zSW.dll pada domain` `mammy-`\n```\nchiro[.]com/case/ZTkBzbz/ dengan menggunakan fungsi dari Dynamic-link library(dll)\nurlmon.dll pada Internet Explorer\n\n```\n\n-----\n\nDrop dll Analysis Malware emotet\n\nDownload file malware emotet\nKomunikasi diatas diawali dengan DNS Request untuk melihat apakah domain memiliki\nresponse 200, ketika respons didapatkan malware emotet akan melanjutkan dengan\n[melakukan Threeâ€“way handshake dan mendrop dll malware menggunakan fungsi activeX](https://id.wikipedia.org/wiki/Protokol_Kendali_Transmisi#:~:text=Proses%20pembuatan%20koneksi%20TCP%20disebut,saling%20bertukar%20ukuran%20TCP%20Window.)\nyang sebelumnya pada file dwa.ocx. File dll ini akan di move kefolder:\n\n```\nC:\\Users\\IEUser\\AppData\\Local\\Microsoft\\Windows\\INetCache\n\n```\n\n-----\n\nAnalysis Malware emotet drop dll file\nMalware emotet juga akan melakukan drop file pada folder\n```\nC:\\Users\\IEUser\\AppData\\Local\\{uniqe folder}\\{uniqe file} yang akan\n\n```\ndijalankan oleh `rundll.exe . Ketika proses berjalan malware akan melakukan injection`\npada memory.\n\nAnalysis Malware emotet running uniqe file\nDynamic injection pada memory dijalankan setelah proses running file uniqe dari backgound\nberlangsung dan beberapa Dynamic-link library(dll) yang digunakan adalah `ntdll.dll,`\n```\nwow64.dll, wow64cpu.dll, KERNELBASE.dll .\n\n```\n\n-----\n\nAnalysis Malware Emotet Dynamic-link Library injection\nSedangkan ketika kami melakukan analisa pada file Dynamic-link library(dll) milik malware\n```\nGEXSG6zSW.dll, ditemukan malware menggunakan beberapa fungsi API OLEAUT32.dll,\nSHELL32.dll, USER32.dll, ole32.dll, pdh.dll . Setelah malware emotet melakukan\n\n```\nproses injection, malware emotet akan mendaftarkan format extension baru pada registry\nsesuai dengan format file yang di drop dan file baru yang akan didrop nantinya.\n\n\n-----\n\nAnalysis Malware Emotet Add new extension\n\n\n-----\n\nAdd another new extension Analysis Malware emotet\nMalware emotet akan membuat otomatis menjalankan program malware setiap kali\nkumputer/laptop baru saja aktif, dengan cara mendaftarkan registry file malware pada\n\\ Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ .\n\nRegistry Analysis Malware Emotet autorun\nProses lainya yang sering akan membuat sistem menjadi berat saat running service adalah\nadanya prosess yang melakukan pencarian indexing dan lainya menggunakan fungsi\n**SEARCHFILTERHOST.EXE dan SEARCHPROTOCOLHOST.EXE, ketika malware aktif.**\n\n\n-----\n\nAnalysis Malware Emotet Search host and protocol\nKetika proses infeksinya sudah selesai malware emotet akan mencoba melakukan\nconnection to outbound dengan mengakses IP C&C malware dan kami sudah menangkap\nbeberapa IP C&C malware yang mencoba diakses.\n\n\n-----\n\nAnalysis Malware Emotet connection to C&C\nBeberapa IP C&C yang kami temukan terdapat related dengan IP C&C yang sering dipakai\nsebagai penyerangan yang memanfaatkan log4j.\n\nMalware analysis emotet log4j\n\n## Bagaimana Cara Mitigasi Malware emotet?\n\nPastikan melakukan block pada domain dan IP IOC berserta C&C.\nMemastikan memiliki EDR sebagai pencegahan.\n\n\n-----\n\nPastikan jika menggunakan log4j sudah mendapatkan versi terbaru.\nMemastikan server mail gateway melakukan filter spam/phising pada sender mail yang\ntidak memiliki dmarc.\nMelakukan cleaning pada file dan folder:\n```\n   C:\\Users\\IEUser\\dwa.ocx(atau file activeX uniqe lainya)\n   C:\\Users\\IEUser\\AppData\\Local\\{uniqe folder}\\{uniqe file}\n   C:\\Windows\\Prefetch\\{bershikan isi artifact}\n   C:\\Users\\IEUser\\AppData\\Local\\Microsoft\\Windows\\INetCache {bershikan\n   isi file}\n   HKEY_USERS\\S-1-5-21-321011808-3761883066-353627080   1000\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ {hapus file aneh}\n   HKEY_USERS\\S-1-5-21-321011808-3761883066-353627080   1000\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\.blf\n   {.ndy, .tnn, .ovo, .blf} note: format emotet masih banyak ini hanya\n   sebagaian yang saya temukan ketika analisa silahkan hapus.\n   C:\\Users\\IEUser\\AppData\\Roaming\\Microsoft\\Office\\Recent {hapus recent\n   file yang dibuka sebagai malware}\n\n```\nMelakukan scanning antivirus.\nBlock domain sender.\n\n## Emotet IOC (Indicator of compromise)\n\nbluetoothheadsetreview[.]xyz\ntopline36[.]xyz\n\nmammy-chiro[.]com\n\nunifiedpharma[.]com\n\nkauffmancreates[.]com\n\necs[.]office[.]com\n\nuci[.]cdn[.]office[.]net\n\nsanagrafix[.]com\n\n112[.]78[.]125[.]227\n\nSHA256 :\nCB5D0451582313831775C542C874C2FAE664CF090646987895E5645E33F1B317\n\nSHA256 : d5e424520fc86ef4c91caacdf609bc584cb73faaf0a6131db19f6b2d0eee57ad\n\nMD5 : BE4813C9B6C410BC1E0A8416BA2EE153\n\n## Emotet C&C (Command and Control)\n\n185[.]148[.]168[.]220:8080\n54[.]38[.]242[.]185\n54[.]37[.]228[.]122\n62[.]171[.]178[.]147:8080\n85[.]214[.]67[.]203:8080\n\n\n-----\n\n190[.]90[.]233[.]66\n37[.]44[.]244[.]177:8080\n210[.]57[.]209[.]142:8080\n116[.]124[.]128[.]206:8080\n128[.]199[.]192[.]135:8080\n195[.]154[.]146[.]35\n185[.]148[.]168[.]15:8080\n195[.]77[.]239[.]39:8080\n207[.]148[.]81[.]119:8080\n78[.]47[.]204[.]80\n62[.]171[.]178[.]147:8080\n37[.]59[.]209[.]141:8080\n\n## Sender Spam dan Phising Emotet\n\n*@rubioguzman[.]com\n\n*@alianzagb[.]com\n\n*@allinautos[.]com\n\n*@nanaki[.]co[.]jp\n\n*@daiwaconst[.]co[.]jp\n\n*@cangroup[.]com[.]sg\n\n*@berlina[.]com[.]uy\n\n*@denyuusya[.]co[.]jp\n\n*@kare[.]com\n\n*@expresoeltero[.]com\n\n*@ptsif[.]com\n\n*@amarishotel[.]com\n\n*@alobhainfotech[.]com\n\n*@maidoha[.]com\n\n*@pecconsultltd[.]com.gh\n\n*@galaxycorp-vn[.]com\n\n*@gunungabadi[.]com\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-27 - Malware Analysis Emotet Infection.pdf"
    ],
    "report_names": [
        "2022-01-27 - Malware Analysis Emotet Infection.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536239,
    "ts_updated_at": 1743041157,
    "ts_creation_date": 1653707528,
    "ts_modification_date": 1653707528,
    "files": {
        "pdf": "https://archive.orkl.eu/7196af2db5f8d33699d1990bc592d9c8b589646f.pdf",
        "text": "https://archive.orkl.eu/7196af2db5f8d33699d1990bc592d9c8b589646f.txt",
        "img": "https://archive.orkl.eu/7196af2db5f8d33699d1990bc592d9c8b589646f.jpg"
    }
}