{
    "id": "92c3bb4c-b28d-43e9-b900-39f5bc3ca1ed",
    "created_at": "2023-01-12T15:01:18.95586Z",
    "updated_at": "2025-03-27T02:08:40.216077Z",
    "deleted_at": null,
    "sha1_hash": "23050a07485ead6d2a1e7b1b2f0fa94f3a84b0c6",
    "title": "2021-12-17 - noPac- A Tale of Two Vulnerabilities That Could End in Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T18:17:12Z",
    "file_modification_date": "2022-05-28T18:17:12Z",
    "file_size": 338777,
    "plain_text": "# noPac: A Tale of Two Vulnerabilities That Could End in Ransomware\n\n**[secureworks.com/blog/nopac-a-tale-of-two-vulnerabilities-that-could-end-in-ransomware](https://www.secureworks.com/blog/nopac-a-tale-of-two-vulnerabilities-that-could-end-in-ransomware)**\n\nCounter Threat Unit Research Team and Incident Response Team\n\n_Numerous public proof-of-concept exploits reveal that the noPac vulnerabilities (CVE-2021-_\n_42278 and CVE-2021-42287) are trivial to exploit and lead to privilege escalation. Friday,_\nDecember 17, 2021 By: Counter Threat Unit Research Team and Incident Response Team\n\n\n-----\n\nWhile the focus in mid-December 2021 has been on Log4j vulnerabilities, two weaponized\nWindows privilege escalation vulnerabilities (CVE-2021-42278 and CVE-2021-42287) also\npose a serious risk to organizations. These vulnerabilities, which are collectively referred to\nas noPac, enable a threat actor to gain control over a domain controller in matter of minutes.\n\nCVE-2021-42287 is a privilege escalation vulnerability associated with the Kerberos Privilege\nAttribute Certificate (PAC) in Active Directory Domain Services (AD DS). CVE-2021-42278 is\na Security Account Manager (SAM) spoofing security bypass vulnerability. Threat actors\ncould leverage these flaws to escalate to domain administrator privileges from a standard\nuser account.\n\n## Gaining domain administrator access\n\n[NoPac relies on changing the SamAccountName of a computer account to the name of a](https://docs.microsoft.com/en-us/windows/win32/adschema/a-samaccountname)\ndomain controller. By default, every authenticated user can add up to ten computers to the\ndomain. The exploitation process includes the following steps:\n\n1. Create a new computer account in Active Directory (AD) with a random name, and then\n\nrename it to one of the domain controllers without the trailing $ (see Figure 1).\n\n_Figure 1. Renaming a user account to spoof a domain controller. (Source:_\n_Secureworks)_\n\n2. Request a [Kerberos ticket-granting ticket (TGT) for the created computer account from](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/b4af186e-b2ff-43f9-b18e-eedb366abf13)\n\nstep one. Once the ticket is granted, change the name of the computer account back to\nits original value (see Figure 2).\n\n\n-----\n\n_Figure 2. Successful ticket request for spoofed domain controller. (Source:_\n_Secureworks)_\n3. Request a Kerberos ticket granting service (TGS) for the Lightweight Directory Access\n\nProtocol (LDAP) service using the TGT from step two with the name of the spoofed\ndomain controller from step one. Because there is no longer an account with that\nname, TGS chooses the closest match and appends an $. Access to the service is\ngranted, and domain administrator access is acquired (see Figure 3).\n\n_Figure 3. Successful service request for spoofed domain controller. (Source:_\n_Secureworks)_\n\n## Timing is everything\n\nSecureworks® researchers confirmed that exploitation of the noPac vulnerability can be\naccomplished in as little as 16 seconds. The following video demonstrates real-time domain\nadministrator access.\n\n\n-----\n\n## Potential precursor to ransomware infections\n\nAfter gaining domain access, a threat actor’s ability to deploy additional malware, including\nransomware, is virtually unlimited. AD abuse is involved in most ransomware incidents\nSecureworks researchers investigate. Threat actors typically leverage misconfigurations to\nescalate privileges within AD. In this case, AD design flaws create the escalation path.\n\n## Conclusion\n\nOrganizations should immediately apply the applicable Microsoft patches to all domain\ncontrollers in their environments. These patches include the November 9, 2021 releases for\n[CVE-2021-42278 and](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2021-42278) [CVE-2021-42287, as well as the November 14 out-of-band update. If](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2021-42287)\none domain controller is overlooked, the domain remains vulnerable. Organizations should\n[also follow Microsoft guidance to phase updates for CVE-2021-42287 and restrict users’](https://support.microsoft.com/en-us/topic/kb5008380-authentication-updates-cve-2021-42287-9dafac11-e0d0-4cb8-959a-143bd0201041)\nability to join workstations to a domain. As of December 17, Secureworks researchers have\nnot observed noPac exploitation in the wild but recommend that organizations remain\nvigilant.\n\nIf you need urgent assistance with an incident, contact the Secureworks Incident Response\n[team. For other questions on how we can help, use our general contact form.](https://www.secureworks.com/contact/talk-with-an-expert)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-17 - noPac- A Tale of Two Vulnerabilities That Could End in Ransomware.pdf"
    ],
    "report_names": [
        "2021-12-17 - noPac- A Tale of Two Vulnerabilities That Could End in Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535678,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1653761832,
    "ts_modification_date": 1653761832,
    "files": {
        "pdf": "https://archive.orkl.eu/23050a07485ead6d2a1e7b1b2f0fa94f3a84b0c6.pdf",
        "text": "https://archive.orkl.eu/23050a07485ead6d2a1e7b1b2f0fa94f3a84b0c6.txt",
        "img": "https://archive.orkl.eu/23050a07485ead6d2a1e7b1b2f0fa94f3a84b0c6.jpg"
    }
}