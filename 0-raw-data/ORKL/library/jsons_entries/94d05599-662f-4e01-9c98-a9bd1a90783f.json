{
    "id": "94d05599-662f-4e01-9c98-a9bd1a90783f",
    "created_at": "2023-01-12T15:09:00.529846Z",
    "updated_at": "2025-03-27T02:05:40.516759Z",
    "deleted_at": null,
    "sha1_hash": "c84ac9721f95b6b24fedf0e516ab7647a7199344",
    "title": "2021-06-01 - Evadere Classifications",
    "authors": "",
    "file_creation_date": "2022-05-28T03:37:19Z",
    "file_modification_date": "2022-05-28T03:37:19Z",
    "file_size": 605558,
    "plain_text": "# Evadere Classifications\n\n**[posts.specterops.io/evadere-classifications-8851a429c94b](https://posts.specterops.io/evadere-classifications-8851a429c94b)**\n\nJonathan Johnson June 1, 2021\n\n[Jonathan Johnson](https://jsecurity101.medium.com/?source=post_page-----8851a429c94b--------------------------------)\n[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F78d2ff57ed70&operation=register&redirect=https%3A%2F%2Fposts.specterops.io%2Fevadere-classifications-8851a429c94b&user=Jonathan+Johnson&userId=78d2ff57ed70&source=post_page-78d2ff57ed70----8851a429c94b---------------------follow_byline-----------)\nJun 1, 2021\n\n\n10 min read\n\n## Introduction\n\nThe term evasion is derived from the Latin word “evadere” which means — “To escape, to\nget away.” The defines evasion as — “The process whereby isolated personnel avoid\ncapture with the goal of successfully returning to areas under friendly control.”\n\nFairly often I come across a post on Twitter or a new blog that talks about a new or\ntechnique. Whether explicitly stated or not. I’ve seen posts that discuss UAC Bypass, new\nmethods of process injection, or LSASS dumping that will bypass certain sensors or even\nprecise detections that are released (at first this doesn’t sound like it fits into an evasion\ntechnique, but this will be explained later within the blog).\n\nThis made me think — what does or truly mean? Are there different categories that these\nevasion techniques fit into? Lastly, if these techniques are to fit into categories — how can\ndetection engineers leverage these for engagements?\n\nCapturing the type of evasion that was executed would help identify the gaps within the\nenvironment, which in turn would help engineers understand if that gap is something they\ncan fix or if it is something that is out of their control. Once these gaps are identified,\nprioritization can be created.\n\nFor example: say a red-team engagement is performed and the red-teamer the sensor, there\nare 3 scenarios that could be in effect:\n\n1. The sensor doesn’t collect the correct data to correlate with the event\n2. The sensor has a built-in detection that the red-teamer evaded (engineers don’t have\n\ninsight into what the detection logic is)\n3. The sensor collects the correct telemetry to provide visibility into the activity, but the\n\nengineer now has to create a custom detection\n\n\n-----\n\nI discuss this in the next section, but a priority could be set once the correct scenario above\nis identified.\n\nFor scenarios 2 & 3, if the data is there then setting a priority for creating the detection\nshould be high.\n\nFor scenario 1, if the sensor doesn’t collect data to correlate with the event then addressing\nthis issue should be a priority.\n\nThroughout this blog post, I will use the term to reference both and terms because their\ndefinitions are interchangeable.\n\n## Types of Evasions\n\n**Note: Throughout this write-up, I will be referring to terminology that is applied to the, a**\nmapping created by Jared Atkinson. I would highly suggest reading his piece on that\nmethodology before moving forward, as well as his talk at SO-CON — which goes into how\nto classify False Positives/False Negatives by leveraging base conditions.\n\nInitially, when diving into this methodology I wanted to make sure I was applying these\nopportunities to a mapping that was already created to help with comprehension. To\naccomplish this I chose to tie each evasion opportunity to a piece of the Funnel of Fidelity.\nThis allowed me to categorize these methods more easily while helping with how to prioritize\neach method. For example, if an environment is more focused on their detection processes,\nthey would want to focus on the evasion opportunities that pertain to that piece of the funnel.\nHowever; regardless of which piece of the funnel an organization wants to focus on I would\nsuggest focusing on the opportunities that pertain to the data collection piece first, as this\nflows through the whole funnel. This is where I chose to start my focus when it comes to this\nmethodology.\n\nWhen setting my focus on the data collection portion of the funnel I decided to spend a lot of\ntime on data/ sensor tools. Often times I have seen someone state “this method of this attack\nbypasses sensor x”, my question then becomes “does it bypass the sensor’s logging\ncapabilities, the sensor’s/EDR’s (Endpoint Detection and Response tool) default detections,\nor the custom detections you have set into place?” While breaking those things out, 2\ndifferent evasion techniques are identified along with 2 sub-techniques:\n\nis broken up into two different sub-techniques: and . There is value in separating these two\nsub-techniques even though they fall under the same evasion category. One method is\ncontrolled by the customer/analyst: . The data is there for you to collect, enabling just needs\nto take place. The other method: is something the customer/analyst has zero control over.\nNeither one can control the sensor is capable of collecting, this falls on the developers of that\ntool. The breakdown is as follows:\n\n\n-----\n\n## End-User vs Product:\n\nEnd-User: Telemetry available but not being collected ()\n\n**Scenario: sensor has data that provides visibility into behavior, but the current logging**\nconfiguration is preventing coverage\n\nProduct: sensor doesn’t have the visibility to see activity ()\n\n**Scenario: An action leverages a low-level syscall to perform a behavior but the sensor**\nis hooking on Win32 APIs for logging capability\n\nAfter identifying the initial evasion methods, I asked myself — “What if a sensor’s built-in\ndetection logic or a detection engineer’s custom detection logic is evaded?” This topic is\ninteresting because many times analysts don’t have insight into an EDR vendor’s built-in\ndetection logic. Without having insight into this, how do engineers know what is covered\nwithin the environment? Since the engineer has little to no insight into this strategy, that is\nsomething they can’t control. However; that doesn’t mean that those strategies don’t provide\nvalue to the organization, but when applied a gap is created. Identifying those gaps to the\nbest of our ability is beneficial when creating custom detections. Custom detections are\nsomething the engineers can control. These detections are built upon a certain strategy or\nmethodology. Is the detection precise where it is looking at command line parameters,\ncertain binaries? Is it broader where it is looking for specific APIs that an attacker can\nleverage? There are a lot of strategies, but it is important to note — no detection is\nbulletproof. They all have gaps. These gaps are evasion opportunities for the attacker. This\nevasion opportunity will be classified as and is broken out below:\n\n## Logical Evasion:\n\n\n-----\n\nAttacker evades the analytical logic implemented by a detection\n\n**Scenario: Intentional — adversary finds/exploits the logic set in place**\n\n**Scenario: Unintentional — the detection engineer implemented a detection with gaps**\nthat were not covered, allowing for this evasion effort by the attacker\n\nThe past couple of evasion techniques have fallen under either data collection or detection\nengineering, but are there evasion opportunities within other parts of the detection and\nresponse pipeline? Say — Triage.\n\nBefore diving into the evasion opportunities that can be applied to Triage, let’s first define\nwhat I mean by this. Within the detection and response pipeline, triage is meant to add\ncontext to the datasets that were captured by the base condition within detection. These\ncontextual pieces get applied to the dataset, given the different attributes that were applied a\npriority is assigned per dataset, then this is passed to the investigation so that the analyst\nhas a pre-applied knowledge base attached to the alert they are given. This allows the\nanalyst to respond to an alert quicker. However; there is an evasion technique that could be\napplied to this Triage piece. This technique applies when context can’t be applied to the\ndataset or when it’s difficult to distinguish this dataset is different from “normal” behavior. This\nevasion technique is called: and is broken down below:\n\n## Classification Evasion:\n\nInability to gather the relevant information to classify an alert\n\n**Scenario: Wanting to see if a service was created remotely, but no network data is**\nbeing collected\n\nBlending in to look like normal behavior to pass as a False Negative\n\n\n-----\n\nThis is an organization-specific example\n\nOnce classification is complete, imagine a scenario where a high number of alerts are\ntriggered and the analyst experiences alert fatigue? Is there an opportunity where the\nadversary can either clean up their malicious activity or have enough time to perform another\nbehavior allowing them to migrate further into the environment? This is something the Funnel\nof Fidelity tries to identify, how to take 1000000 events and funnel them down to 10s of\nleads. Except that isn’t always going to apply. An alert’s logic might be really broad causing a\nhigh volume of alerts to trigger, which after past through triage the analyst has a lot of data to\nlook through, and not only can alert fatigue happen but data analysis paralysis can. When\nperformed properly, the investigation process takes time. The analyst has to ingest the base\ndataset, the added contextual pieces applied by triage, and then if all the data they need isn’t\nthere to make a decision they have to go and grab that data to make the decision to escalate\nthis alert or to close the alert. The evasion technique that applies to this scenario is: and is\nbroken down below:\n\n## Temporal Evasion :\n\nThe attacker has time to clean up their activity and move on due to the high volume of\nalerts\nThe attackers’ ability to complete a task is faster than the defenders’ ability to\nremediate the task\n\n**Scenario: The defender detected the attack, but couldn’t act quick enough to stop the**\nattacker from being successful\n\nNext let’s talk about a situation where an alert fires, context is added to the dataset, and the\nanalyst successfully receives this incident. What happens if the analyst doesn’t have the\ntechnical skills to effectively comprehend the alert which in turn affects their ability to respond\nproperly? This isn’t to mean these skills can’t be learned, but this is something that must be\ntaken into consideration when identifying possible evasion opportunities The lack of\n\n\n-----\n\ntechnical comprehension could come from the absence of knowledge within the detection\ndocument or the current status of the analyst’s technical depth. This evasion opportunity can\nbe applied to both the Investigation and the Response. This opportunity can be defined as\nand is broken down below:\n\n## Technical Evasion:\n\nAnalyst lacks the knowledge or skill set to respond to an alert correctly\n\n**Scenario: Suspicious binary drops on a host, but the analyst doesn’t have the proper**\nskillset to reverse the binary to determine if it’s malware\n\nI quickly realized after moving through this methodology that there are other opportunities for\nan attacker to evade the current defenses, whether that be data collection, alert logic, triage,\ninvestigation, or response. Simply by one of these processes being broken, a control is\nmisconfigured, a machine is offline, tampering with a sensor, or the organization is simply not\nperforming one of these procedures in a robust manner. All of these possibilities lead to the\nfailure of identifying a threat. This will apply to the whole funnel and can be classified as,\nwhich is broken down below:\n\n## Procedural Evasion:\n\nA control, procedure, process, or machine that fails to identify a threat\n\n**Scenario 1: Sensor is turned off, preventing data to be collected**\n\n**Scenario 2: SACL was misconfigured for when a specific registry key is queried, the**\nkey is queried, but no insight is collected (MSHTA)\n\n**Scenario 3: Unrecognized detection gaps, leading to a false sense of security related**\nto technique coverage\n\n\n-----\n\nOnce we combine all of these different evasion opportunities the correlation to the funnel can\nbe visualized as:\n\n\n-----\n\n## Conclusion\n\nI think as time progresses, certain terms start to lose their meaning due to redefinition or\nmisuse. We see this with a lot of terminologies, even outside of InfoSec. Evasion and bypass\nhave seemed to fall under that category. Maybe it’s not that they have lost their meaning, but\nmore specific classification has to be applied when talking about the subject. This is what\npiqued my interest when it comes to this topic. Not only — how do we classify these evasion\nmethods so that detection engineers can leverage them better, but also setting a common\nterminology that can be leveraged by the SOC and all sub-teams (threat research, red-team,\ndetection engineers, etc).\n\nIt’s important to remember that regardless if someone is part of a red-team, detection\nengineer, threat hunting team, etc the goal should always be to output something to the\nSOC. If terminology is misconstrued and everyone has their disparate definitions of a word,\nthen the expectation of the output potentially gets lost.\n\nI’m sure as time moves forward there will be more to add to this, but that is the exciting part\nof this. Everything evolves and is meant to.\n\n## Acknowledgments\n\nA thank you to [Jared Atkinson for helping with these classification naming conventions, as](https://medium.com/u/b206c297df42?source=post_page-----8851a429c94b--------------------------------)\nwell as discussing this methodology with me.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-01 - Evadere Classifications.pdf"
    ],
    "report_names": [
        "2021-06-01 - Evadere Classifications.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536140,
    "ts_updated_at": 1743041140,
    "ts_creation_date": 1653709039,
    "ts_modification_date": 1653709039,
    "files": {
        "pdf": "https://archive.orkl.eu/c84ac9721f95b6b24fedf0e516ab7647a7199344.pdf",
        "text": "https://archive.orkl.eu/c84ac9721f95b6b24fedf0e516ab7647a7199344.txt",
        "img": "https://archive.orkl.eu/c84ac9721f95b6b24fedf0e516ab7647a7199344.jpg"
    }
}