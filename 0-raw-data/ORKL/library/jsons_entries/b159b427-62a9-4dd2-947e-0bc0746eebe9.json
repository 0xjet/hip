{
    "id": "b159b427-62a9-4dd2-947e-0bc0746eebe9",
    "created_at": "2023-01-12T15:07:19.983045Z",
    "updated_at": "2025-03-27T02:16:34.558932Z",
    "deleted_at": null,
    "sha1_hash": "c9b313c5a257763e4cea52672bf8303fe00cccfb",
    "title": "2020-12-17 - SUPERNOVA SolarWinds .NET Webshell Analysis",
    "authors": "",
    "file_creation_date": "2022-08-18T03:30:21Z",
    "file_modification_date": "2022-08-18T03:30:21Z",
    "file_size": 1440179,
    "plain_text": "# SUPERNOVA: A Novel .NET Webshell\n\n**unit42.paloaltonetworks.com/solarstorm-supernova**\n\nMatthew Tennis December 17, 2020\n\nBy [Matthew Tennis](https://unit42.paloaltonetworks.com/author/matthew-tennis/)\n\nDecember 17, 2020 at 3:37 PM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit-42/)\n\nTags: [FireEye breach,](https://unit42.paloaltonetworks.com/tag/fireeye-breach/) [SUPERNOVA](https://unit42.paloaltonetworks.com/tag/supernova/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/solarstorm-supernova/)\n\n## Executive Summary\n\nThe actors behind the supply chain attack on SolarWinds’ Orion software have demonstrated\na high degree of technical sophistication and attention to operational security, as well as a\nnovel combination of techniques in the potential compromise of approximately 18,000\n[SolarWinds customers. As published in the original disclosure, the attackers were observed](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html)\nremoving their initial backdoor once a more legitimate method of persistence was obtained.\n\nIn the analysis of the trojanized Orion artifacts, the .NET .dll\napp_web_logoimagehandler.ashx.b6031896.dll was dubbed SUPERNOVA, but little detail of\nits operation has been publicly explored. NOTE: The SUPERNOVA webshell’s association\nwith the SolarStorm actors is now questionable due to the aforementioned dll not being\n\n\n-----\n\ndigitally signed, unlike the SUNBURST .dll. This may indicate that the webshell was not\nimplanted early in SolarWinds’ software development pipeline as was SUNBURST, and was\ninstead dropped by a third party. Additionally, Guidepoint Security conducted their own\nresearch into SUPERNOVA, with similar conclusions.\n\nIn this blog, we will share an overview of its operation and function, tactics and techniques\nthat support the hypothesis of an advanced persistent threat (APT), and what protections\nthat Palo Alto Networks provides against trojanized SolarWinds instances:\n\nAttackers created a sophisticated, in-memory webshell baked into Orion’s code, which\nacted as an interactive .NET runtime API.\nWebshell payload was compiled on the fly and executed dynamically, further\ncomplicating endpoint and digital forensics and incident response (DFIR) analysis.\nAnti-Spyware signature 83225 has been added to prevent SUPERNOVA traffic.\n\n## Technical Overview\n\nIn conventional webshell attacks, these server script pages are often some sort of interactive\nfrontend document that can be manipulated to process backend side effects, which is most\noften some form of remote code execution (RCE). A webshell may be uploaded, downloaded\nor deployed by either targeting a misconfiguration or vulnerability in the underlying server, or\ndropped during post-exploitation as a means of secondary persistence. A webshell itself is\ntypically malware logic embedded in a script page and is most often implemented in an\ninterpreted programming language or context (most commonly PHP, Java JSP, VBScript and\nJScript ASP, and C# ASP.NET). The webshell will receive commands from a remote server\nand will execute in the context of the web server’s underlying runtime environment.\n\nThe SUPERNOVA webshell is also seemingly designed for persistence, but its novelty goes\nfar beyond the conventional webshell malware that Unit 42 researchers routinely encounter.\n\nAlthough .NET webshells are fairly common, most publicly researched samples ingest\ncommand and control (C2) parameters, and perform some relatively surface-level\nexploitation. Some examples would be an attacker commanding the implant to dump\ndirectory structures or operating system information, or to perform a network call to load\nmore exploitation tools.\n\nSUPERNOVA differs dramatically in that it takes a valid .NET program as a parameter. The\n.NET class, method, arguments and code data are compiled and executed in-memory. There\nare no additional forensic artifacts written to disk, unlike low-level webshell stagers, and\nthere is no need for additional network callbacks other than the initial C2 request.\n\nIn other words, the attackers have constructed a stealthy and full-fledged .NET API\nembedded in an Orion binary, whose user is typically highly privileged and positioned with a\nhigh degree of visibility within an organization’s network The attackers can then arbitrarily\n\n\n-----\n\nconfigure SolarWinds (and any local operating system feature on Windows exposed by the\n.NET SDK) with malicious C# code. The code is compiled on the fly during benign\nSolarWinds operation and is executed dynamically.\n\nThis is significant because it allows the attacker to deploy full-featured – and presumably\nsophisticated – .NET programs in reconnaissance, lateral movement and other attack\nphases.\n\n## Implant Phase\n\nThe implant itself is a trojanized copy of app_web_logoimagehandler.ashx.b6031896.dll,\nwhich is a proprietary SolarWinds .NET library that exposes an HTTP API. The endpoint\nserves to respond to queries for a specific .gif image from other components of the Orion\nsoftware stack. The relatively high quality code that was added to the .dll is innocuous and\neasily missed by defender automation, and even potentially by manual review.\n\nThe attackers have leveraged the benign file by adding four new parameters to the API and\na malicious method that executes the parameters in the context of the .NET runtime on the\nOrion host. Figure 1 below demonstrates the normal or benign content of the Orion\ncomponent.\n\nFigure 1. Benign SolarWinds code for handling the HTTP request and its response.\nLine 42 defines the collection of the parameters supplied to the HTTP endpoint, in which only\nid is valid and processed. However, the additional C2 parameters are added before this\nsnippet in the same method, ProcessRequest(), and the execution method is appended in\nthis same file. Figure 2 shows part of the malicious code (lines 27-41).\n\n\n-----\n\nFigure 2. Four C2 parameters are processed and then passed to the malicious method\nDynamicRun().\nThe four parameters depicted above – codes, clazz, method and args – passed via GET\nquery string to the trojanized logo handler component. These parameters are then executed\nin a custom method, which differs from typical webshell behavior that simply invokes\nunderlying operating system or programming language functions.\n\n\n**C2**\n**Parameter**\n\n\n**Purpose**\n\n\nclazz C# Class object name to instantiate\n\nmethod Method of class clazz to invoke\n\nargs Arguments are newline-split and passed as positional parameters to\nmethod\n\ncodes .NET assemblies and namespaces for compilation\n\nTable 1. Command and control parameters\n\n_Note for defenders:_\n\n_Any ingress traffic to logoimagehandler.ashx with a combination of these four parameters in_\n_any order of the query string are strong indicators of compromise (IOCs). If a detection fires_\n_on this combination in any order, please isolate and image your Orion instance immediately._\n_If the request came internal to the network, then it is highly probable that the user that_\n_initiated the request has also been compromised._\n\n## Execution\n\n\n-----\n\nThe attacker may send a request to the embedded webshell over the internet or through an\ninternally compromised system. The code is crafted to accept the parameters as\ncomponents of a valid .NET program, which is then compiled in-memory. No executable is\ndropped (and thus the webshell’s execution evades most defender endpoint detections), and\nthe compiled assembly immediately invokes the specified class method.\n\nThe try/catch block beginning on line 27 that encompases the execution on line 37 has been\nadded to presumably prevent operator error from causing an unhandled exception in Orion,\nwhich could trigger unwanted scrutiny. This is one small example of the attention paid by the\nactors to technical and operational security.\n\nFigure 3. DynamicRun() compiles the C2 parameters into a .NET assembly in-memory.\nOn lines 106 and 107, we can observe the innocuous compiler API flags that are subverted\nto impede defenders. Line 115 instantiates the class object specified by the attacker, and on\nline 116 the attacker code is executed.\n\nThis design pattern is known as dynamic code execution. In software engineering contexts,\nthis allows for the program to be flexible and extensible. In the context of a cyberattack, the\nsame is true for the attacker’s code and tools.\n\n## Tactics, Techniques and Procedures\n\nIn many ways, this webshell exhibits attributes common to other types of webshells. The\nmalware is secretly implanted onto a server, it receives C2 signals remotely and executes\nthem in the context of the server user.\n\nHowever, SUPERNOVA is novel and potent due to its in-memory execution, sophistication in\nits parameters and execution and flexibility by implementing a full programmatic API to the\n.NET runtime.\n\nIn-memory execution of a malicious binary is not a new technique with regard to malware\nbehavior. That technique typically indicates an adversary’s attempt at foiling endpoint and\nDFIR detections.\n\n\n-----\n\nHowever, this is rarely encountered in webshell behavior, as typical webshells execute their\npayloads either in the context of the runtime environment or by calling a subshell or process\n(cmd.exe, PowerShell.exe or /bin/bash).\n\nSUPERNOVA compiles the parameters on the fly and executes the resulting assembly inmemory. Aside from evading detections, this indicates that the SolarStorm actors were adept\nenough to purposely hide their traffic and behavior in plain sight and to avoid leaving trace\nevidence behind.\n\n## Protections\n\nAside from the [numerous protections offered across the Palo Alto Networks product suite,](https://unit42.paloaltonetworks.com/fireeye-solarstorm-sunburst/)\nAnti-Spyware signature 83225 has been created to detect any residual C2 infrastructure still\npresent in impacted networks.\n\n## Conclusion\n\nThe strategy of implanting webshells in vulnerable servers is not a new tactic for malicious\nactors. However, the relative sophistication of the code compared to routine webshell\nmalware is surprising. Furthermore, the furor of the attacks against SolarWinds further\namplifies interest in novel techniques such as those used in SUPERNOVA.\n\nThe only way to catch advanced intrusions is a defense-in-depth strategy. Only by\norchestrating multiple security appliances and applications in a single pane can defenders\ndetect these attacks.\n\nPalo Alto Networks customers are protected by the following:\n\n[Endpoint protection through Cortex XDR.](https://www.paloaltonetworks.com/cortex/cortex-xdr)\n[Malware sandbox detection through WildFire (Next-Generation Firewall security](https://www.paloaltonetworks.com/products/secure-the-network/wildfire)\nsubscription).\n[An array of defenses including IPS and AppID in Threat Prevention (Next-Generation](https://www.paloaltonetworks.com/products/secure-the-network/subscriptions/threat-prevention)\nFirewall security subscription).\n[Threat intelligence with Cortex Data Lake.](https://www.paloaltonetworks.com/cortex/cortex-data-lake)\n[Network defense orchestration with Cortex XSOAR.](https://www.paloaltonetworks.com/cortex/xsoar)\n\n## Acknowledgements\n\nThe author would like to thank the following team members for their tireless efforts and\ninvaluable contributions to this research:\n\nDurgesh Sangvikar, Chris Navarrete, Hui Gao, Rongbo Shao, Kyle Wilhoit, Derrick Chang,\nAlex Krepelka, Byron Alvarez and KMAP Pena.\n\n\n-----\n\n## Indicators of Compromise\n\n**SolarWinds Orion app_web_logoimagehandler.ashx.b6031896.dll**\n\nc15abaf51e78ca56c0376522d699c978217bf041a3bd3c71d09193efa5717c71\n\n**URI**\n\nlogoimagehandler[.]ashx\n\n**HTTP Query String Params**\n\nclazz\n\nmethod\n\nargs\n\ncodes\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-17 - SUPERNOVA SolarWinds .NET Webshell Analysis.pdf"
    ],
    "report_names": [
        "2020-12-17 - SUPERNOVA SolarWinds .NET Webshell Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536039,
    "ts_updated_at": 1743041794,
    "ts_creation_date": 1660793421,
    "ts_modification_date": 1660793421,
    "files": {
        "pdf": "https://archive.orkl.eu/c9b313c5a257763e4cea52672bf8303fe00cccfb.pdf",
        "text": "https://archive.orkl.eu/c9b313c5a257763e4cea52672bf8303fe00cccfb.txt",
        "img": "https://archive.orkl.eu/c9b313c5a257763e4cea52672bf8303fe00cccfb.jpg"
    }
}