{
    "id": "864961a5-e718-423e-9fda-e00974a39770",
    "created_at": "2023-01-12T14:59:58.77234Z",
    "updated_at": "2025-03-27T02:17:27.656946Z",
    "deleted_at": null,
    "sha1_hash": "aa01916a2905b0b8b3ba15fa9fe8b3b898eafbbc",
    "title": "2022-09-27 - More Than Meets the Eye- Exposing a Polyglot File That Delivers IcedID",
    "authors": "",
    "file_creation_date": "2022-10-02T12:26:03Z",
    "file_modification_date": "2022-10-02T12:26:03Z",
    "file_size": 373690,
    "plain_text": "# More Than Meets the Eye: Exposing a Polyglot File That Delivers IcedID\n\n**[unit42.paloaltonetworks.com/polyglot-file-icedid-payload/](https://unit42.paloaltonetworks.com/polyglot-file-icedid-payload/)**\n\nMark Lim September 27, 2022\n\nBy [Mark Lim](https://unit42.paloaltonetworks.com/author/mark-lim/)\n\nSeptember 27, 2022 at 6:00 AM\n\n[Category: Malware](https://unit42.paloaltonetworks.com/category/malware-2/)\n\nTags: [Analysis,](https://unit42.paloaltonetworks.com/tag/analysis/) [Cloud-Deliversed Security Services,](https://unit42.paloaltonetworks.com/tag/cloud-deliversed-security-services/) [Cortex,](https://unit42.paloaltonetworks.com/tag/cortex/) [Cortex XDR,](https://unit42.paloaltonetworks.com/tag/cortex-xdr/) [DNS security,](https://unit42.paloaltonetworks.com/tag/dns-security/)\n[Evasion,](https://unit42.paloaltonetworks.com/tag/evasion/) [IcedID,](https://unit42.paloaltonetworks.com/tag/icedid/) [next-generation firewall,](https://unit42.paloaltonetworks.com/tag/next-generation-firewall/) [threat prevention,](https://unit42.paloaltonetworks.com/tag/threat-prevention/) [URL filtering,](https://unit42.paloaltonetworks.com/tag/url-filtering/) [WildFire](https://unit42.paloaltonetworks.com/tag/wildfire/)\n\n## Executive Summary\n\nUnit 42 recently observed a polyglot Microsoft Compiled HTML Help (CHM) file being\nemployed in the infection process used by the information stealer IcedID. We will show how\nto analyze the polyglot CHM file and the final payload so you can understand how the\nsample evades detection.\n\n[Multiple attack groups such as Starchy Taurus (aka APT41) and Evasive Serpens (formerly](https://unit42.paloaltonetworks.com/apt41-using-new-speculoos-backdoor-to-target-organizations-globally/)\ntracked as [OilRig, also known as Europium) have abused CHM files to conceal payloads](https://unit42.paloaltonetworks.com/the-oilrig-campaign-attacks-on-saudi-arabian-organizations-deliver-helminth-backdoor/)\nwritten using PowerShell or JavaScript. Here, we describe an interesting attack that allows\n\n\n-----\n\nattackers to avoid the need for long lines of code, which can make it easier for malicious files\n[to evade detection by security products. Polyglot files can be abused by attackers to hide](https://en.wikipedia.org/wiki/Polyglot_(computing))\nfrom anti-malware systems that rely on file format identification. The technique involves\nexecuting the same CHM file twice in the infection process. The first execution exhibits\nbenign activities, while the second execution stealthily carries out malicious behaviors.\n\nThis [particular attack chain was discovered in early August 2022 and delivered IcedID, also](https://twitter.com/Unit42_Intel/status/1557009330762809348)\nknown as Bokbot, as the final payload. This information stealer, [IcedID, is well-known](https://malpedia.caad.fkie.fraunhofer.de/details/win.icedid)\n[malware that has been attacking users since 2019.](https://unit42.paloaltonetworks.com/atoms/monsterlibra/)\n\nPalo Alto Networks customers receive protections from malware families using similar anti[analysis techniques with Cortex XDR or the](https://www.paloaltonetworks.com/cortex/cortex-xdr) [Next-Generation Firewall with](https://www.paloaltonetworks.com/network-security/next-generation-firewall) cloud-delivered\n[security services including WildFire,](https://www.paloaltonetworks.com/network-security/wildfire) [Advanced Threat Prevention,](https://www.paloaltonetworks.com/network-security/advanced-threat-prevention) [Advanced URL Filtering](https://www.paloaltonetworks.com/network-security/advanced-url-filtering)\n[and DNS Security.](https://www.paloaltonetworks.com/network-security/dns-security)\n\nRelated Unit 42 Topics [Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [IcedID,](https://unit42.paloaltonetworks.com/tag/icedid/) [Evasion](https://unit42.paloaltonetworks.com/tag/evasion/)\n\n## Table of Contents\n\nMalicious Polyglot CHM File\n\nIcedID DLL’s Configuration Extraction\n\nConclusion\n\nIndicators of Compromise\n\n## Malicious Polyglot CHM File\n\nPolyglot files are binaries that have multiple different file format types. The file would have a\ndifferent behavior depending on the application that was used to execute it.\n\nThe [attack that was discovered in early August 2022 starts with a phishing email that](https://twitter.com/Unit42_Intel/status/1557009330762809348)\nincludes an attached zip file named erosstrucking-file-08.08.2022.zip. The zip file\ndecompresses into an ISO image file named order-130722.28554.iso. Inside the ISO file is a\nCHM file called pss10r.chm (SHA256:\n3d279aa8f56e468a014a916362540975958b9e9172d658eb57065a8a230632fa). The\npolyglot CHM file is used to display help documentation. When the user launches the CHM\nfile (pss10r.chm), a harmless help window is displayed.\n\n\n-----\n\nFigure 1. Decoy\n\nHTML help window.\nTo dump the contents of the CHM file, we used 7zip. The file of interest is\nPSSXMicrosoftSupportServices_HP05221271.htm.\n\n\n-----\n\nFigure 2. Contents of\n\nthe decoy HTML help window.\nMost of the code in the HTML file is used for generating the decoy window. However,\nconcealed within the HTML code is a single-line command to execute the same CHM file\nagain. The command calls Mshta.exe to execute itself (pss10r.chm) a second time.\nMshta.exe is a utility that executes Microsoft HTML Application (HTA) files. HTAs are fullfledged applications created using HTML.\n\nFigure\n\n3. A line of HTML code in PSSXMicrosoftSupportServices_HP05221271.htm that calls\nMshta.exe to execute the CHM file a second time.\nThe code of the HTA is buried within the binary of the CHM file and configured to be invisible\nto the victim during execution. The HTA is used to execute the binary app.dll.\n\n\n-----\n\nFigure 4. HTA code buried in pss10r.chm.\nThe binary app.dll is actually hidden within the ISO image. The hidden binary can be\nrevealed using the attrib command.\n\nFigure 5. Revealing\n\nthe hidden binary.\nThe app.dll binary is a 64-bit IcedID DLL. (SHA256:\nd240bd25a0516bf1a6f6b3f080b8d649ed2b116c145dd919f65c05d20fc73131)\n\n## IcedID DLL’s Configuration Extraction\n\nTo retrieve the indicators of compromise (IoCs) from the IcedID DLL, we looked at its\nconfiguration. The IcedID DLL’s configuration is encoded and stored in the data section of\nthe binary. The encoded configuration has the format shown in Figure 6.\n\n\n-----\n\nFigure 6. Structure of\n\nencoded configuration blob.\nThe following function would decode the IcedID DLL’s configuration at runtime. The address\nof the encoded configuration (enc_config) is in the function.\n\nFigure\n\n7. IcedID DLL’s configuration decoder function.\nThe decoded IcedID DLL’s configuration has the following format.\n\n\n-----\n\nFigure 8. Structure of\n\ndecoded IcedID configuration.\nFrom the decoded configuration, we can extract the following IoCs:\n\nCommand and Control URL abegelkunic[.]com\n\nCampaign ID 4157420015\n\n## Conclusion\n\nThreat actors continue to evolve their techniques to evade detection. The above analysis\ndemonstrates how attackers abused a polyglot Microsoft Compiled HTML file to deliver an\nIcedID payload. It is important for defenders not to trust binaries based on their file types\nsince polyglot files such as the one discussed here have more than one correct file type.\n\nPalo Alto Networks customers receive protections from malware families using similar anti[analysis techniques with Cortex XDR or the](https://www.paloaltonetworks.com/cortex/cortex-xdr) [Next-Generation Firewall with](https://www.paloaltonetworks.com/network-security/next-generation-firewall) cloud-delivered\n[security services including WildFire,](https://www.paloaltonetworks.com/network-security/wildfire) [Advanced Threat Prevention,](https://www.paloaltonetworks.com/network-security/advanced-threat-prevention) [Advanced URL Filtering](https://www.paloaltonetworks.com/network-security/advanced-url-filtering)\n[and DNS Security.](https://www.paloaltonetworks.com/network-security/dns-security)\n\n## Indicators of Compromise\n\nFile name: erosstrucking-file-08.08.2022.zip\n\nSHA256: fb6d23f69d14d474ce096da4dcfea27a84c93f42c96f6dd8295d33ef2845b6c7\n\nFile name: order-130722.28554.iso\n\nSHA256: d403df3fb181560d6ebf4885b538c5af86e718fecfabc73219b64924d74dd0eb\n\nFile name: pss10r.chm\n\nSHA256: 3d279aa8f56e468a014a916362540975958b9e9172d658eb57065a8a230632fa\n\nFile name: app.dll\n\nSHA256: d240bd25a0516bf1a6f6b3f080b8d649ed2b116c145dd919f65c05d20fc73131\n\nCommand and Control URL: abegelkunic[.]com\n\n## Additional Resources\n\n\n-----\n\n[Harmful Help: Analyzing a Malicious Compiled HTML Help File Delivering Agent Tesla](https://unit42.paloaltonetworks.com/malicious-compiled-html-help-file-agent-tesla/)\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-09-27 - More Than Meets the Eye- Exposing a Polyglot File That Delivers IcedID.pdf"
    ],
    "report_names": [
        "2022-09-27 - More Than Meets the Eye- Exposing a Polyglot File That Delivers IcedID.pdf"
    ],
    "threat_actors": [
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8f9c8a6e-f6b6-431b-bedd-94fdeea5474a",
            "created_at": "2024-05-01T02:03:08.022974Z",
            "updated_at": "2025-03-27T02:05:17.310877Z",
            "deleted_at": null,
            "main_name": "COBALT GYPSY",
            "aliases": [
                "CHRYSENE ",
                "Crambus ",
                "EUROPIUM ",
                "Hazel Sandstorm ",
                "Helix Kitten ",
                "ITG13 ",
                "OilRig ",
                "Yellow Maero ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT GYPSY",
            "tools": [
                " Helminth",
                " Jason",
                " MacDownloader",
                " PoisonFrog",
                " RGDoor",
                " ThreeDollars",
                " TinyZbot",
                " Toxocara",
                " Trichuris",
                " TwoFace",
                "Glimpse"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "4d5f939b-aea9-4a0e-8bff-003079a261ea",
            "created_at": "2023-01-06T13:46:39.04841Z",
            "updated_at": "2025-03-27T02:00:02.985296Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "G0096",
                "Grayfly",
                "BARIUM",
                "BRONZE ATLAS",
                "BRONZE EXPORT",
                "Red Kelpie",
                "HOODOO",
                "Brass Typhoon",
                "TA415",
                "WICKED SPIDER",
                "WICKED PANDA",
                "G0044",
                "Earth Baku"
            ],
            "source_name": "MISPGALAXY:APT41",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e698860d-57e8-4780-b7c3-41e5a8314ec0",
            "created_at": "2022-10-25T15:50:23.287929Z",
            "updated_at": "2025-03-27T02:00:55.43005Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "APT41",
                "Wicked Panda",
                "Brass Typhoon",
                "BARIUM"
            ],
            "source_name": "MITRE:APT41",
            "tools": [
                "ASPXSpy",
                "BITSAdmin",
                "PlugX",
                "Impacket",
                "gh0st RAT",
                "netstat",
                "PowerSploit",
                "ZxShell",
                "KEYPLUG",
                "ipconfig",
                "sqlmap",
                "China Chopper",
                "ShadowPad",
                "MESSAGETAP",
                "Mimikatz",
                "certutil",
                "njRAT",
                "Cobalt Strike",
                "pwdump",
                "BLACKCOFFEE",
                "ROCKBOOT",
                "dsquery",
                "Winnti for Linux",
                "DUSTTRAP",
                "Derusbi",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b6436f7b-6012-4969-aed1-d440e2e8b238",
            "created_at": "2022-10-25T16:07:23.91517Z",
            "updated_at": "2025-03-27T02:02:10.027531Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "APT 34",
                "ATK 40",
                "Chrysene",
                "Cobalt Gypsy",
                "Crambus",
                "DEV-0861",
                "EUROPIUM",
                "Earth Simnavaz",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "Helix Kitten",
                "IRN2",
                "ITG13",
                "Scarred Manticore",
                "Storm-0861",
                "TA452",
                "Twisted Kitten",
                "UNC1860",
                "Yellow Maero"
            ],
            "source_name": "ETDA:OilRig",
            "tools": [
                "AMATIAS",
                "Agent Drable",
                "Agent Injector",
                "AgentDrable",
                "Alma Communicator",
                "BONDUPDATER",
                "CACTUSPIPE",
                "Clayslide",
                "CypherRat",
                "DNSExfitrator",
                "DNSpionage",
                "DROPSHOT",
                "DistTrack",
                "DropperBackdoor",
                "Fox Panel",
                "GREYSTUFF",
                "GoogleDrive RAT",
                "HighShell",
                "HyperShell",
                "ISMAgent",
                "ISMDoor",
                "ISMInjector",
                "Jason",
                "Karkoff",
                "LIONTAIL",
                "LOLBAS",
                "LOLBins",
                "LONGWATCH",
                "LaZagne",
                "Living off the Land",
                "MailDropper",
                "Mimikatz",
                "MrPerfectInstaller",
                "OILYFACE",
                "OopsIE",
                "POWBAT",
                "POWRUNER",
                "Plink",
                "Poison Frog",
                "PowerExchange",
                "PsList",
                "PuTTY Link",
                "QUADAGENT",
                "RDAT",
                "RGDoor",
                "SEASHARPEE",
                "Saitama",
                "Saitama Backdoor",
                "Shamoon",
                "SideTwist",
                "SpyNote",
                "SpyNote RAT",
                "StoneDrill",
                "TONEDEAF",
                "TONEDEAF 2.0",
                "ThreeDollars",
                "TwoFace",
                "VALUEVAULT",
                "Webmask",
                "WinRAR",
                "ZEROCLEAR",
                "ZeroCleare",
                "certutil",
                "certutil.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535598,
    "ts_updated_at": 1743041847,
    "ts_creation_date": 1664713563,
    "ts_modification_date": 1664713563,
    "files": {
        "pdf": "https://archive.orkl.eu/aa01916a2905b0b8b3ba15fa9fe8b3b898eafbbc.pdf",
        "text": "https://archive.orkl.eu/aa01916a2905b0b8b3ba15fa9fe8b3b898eafbbc.txt",
        "img": "https://archive.orkl.eu/aa01916a2905b0b8b3ba15fa9fe8b3b898eafbbc.jpg"
    }
}