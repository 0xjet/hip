{
    "id": "3db8b168-6e56-4852-9318-84de5fa12161",
    "created_at": "2023-01-12T15:00:25.876317Z",
    "updated_at": "2025-03-27T02:05:31.749526Z",
    "deleted_at": null,
    "sha1_hash": "3605fde4223a642e57e8aef1e2c56711fa29e5ba",
    "title": "2017-04-03 - Introducing ROKRAT",
    "authors": "",
    "file_creation_date": "2022-05-28T15:55:01Z",
    "file_modification_date": "2022-05-28T15:55:01Z",
    "file_size": 1166324,
    "plain_text": "# Introducing ROKRAT\n\n**[blog.talosintelligence.com/2017/04/introducing-rokrat.html](http://blog.talosintelligence.com/2017/04/introducing-rokrat.html)**\n\n[This blog was authored by Warren Mercer and](https://blogs.cisco.com/author/warrenmercer) [Paul Rascagneres with contributions from](https://www.blogger.com/profile/10073079939160046441)\n[Matthew Molyett.](https://blogs.cisco.com/author/matthewmolyett)\n\n## Executive Summary\n\n[A few weeks ago, Talos published research on a Korean MalDoc. As we previously](http://blog.talosintelligence.com/2017/02/korean-maldoc.html)\ndiscussed this actor is quick to cover their tracks and very quickly cleaned up their\ncompromised hosts. We believe the compromised infrastructure was live for a mere matter of\nhours during any campaign. We identified a new campaign, again leveraging a malicious\nHangul Word Processor (HWP) document. After analyzing the final payload, we determined\nthe winner was… a Remote Administration Tool, which we have named ROKRAT.\n\nLike in the previous post, the campaign started with a spear phishing email containing a\nmalicious attachment, the HWP document. One of the identified emails was sent from the\nemail server of Yonsei, a private university in Seoul. The address used in the email was\n['kgf2016@yonsei.ac.kr' which is the contact email of the Korea Global Forum where the](http://www.kgforum.kr/)\nslogan in 2016 was \"Peace and Unification of the Korean Peninsula\". This fact gives more\ncredit and legitimacy to the email.\n\n\n-----\n\nThe HWP document contained an embedded Encapsulated PostScript (EPS) object. As with\nour previous publication this again is zlib compressed and trivial to obtain. The purpose of\nthe EPS is to exploit a well-known vulnerability (CVE-2013-0808) to download a binary\ndisguised as a .jpg file. This file is decoded and finally an executable is launched: ROKRAT.\nThis RAT has the added complexity that the command and control servers are legitimate\nwebsites. The malware uses Twitter and two cloud platforms, Yandex and Mediafire,\napparently for both C2 communications and exfiltration platforms. Unfortunately, these\nplatforms are difficult to block globally within organizations as their use can be viewed as\nlegitimate in most cases. Additionally, these 3 platforms all make use of HTTPS connectivity,\nmaking it much more difficult to identify specific patterns or the usage of specific tokens.\n\n## Spear Phishing Campaign\n\nBelow are examples of the emails used against victims in South Korea\n\nThe first email we discovered was the most interesting. In this first sample, we observed the\nattackers praising the user for accepting to join a panel relating to the \"Korean Reunification\n\n\n-----\n\nand North Korean Conference . The text in the email explains that the receiver should\ncomplete the document to provide necessary feedback. However, this appears to be a fake\nconference. The closest match we identified to any Unification conference was held in\n[January 2017, which was the NYDA Reunification conference. The sender is](https://nkleadershipwatch.wordpress.com/2017/01/19/nyda-reunification-joint-conference-held/)\n['kgf2016@yonsei.ac.kr' which is the contact email of the Korea Global Forum.](http://www.kgforum.kr/)\n\nWhen we analyzed the email headers we were able to determine the Sender IP was\n165.132.10.103. With a little magic from our friend 'nslookup' we quickly determined this to\nbe part of the Yonsei University network, the SMTP server in fact. We believe that the email\naddress was compromised and abused by the attackers to send the email used in this\ncampaign.\n\nThe sample filename translates as 'Unification North Korea Conference _ Examination\nDocuments' which reinforces the text in the email about the reunification conference. For an\nadded bonus the attacker even suggests in the email people who completed the document\nwould get paid a 'small fee'. Perhaps the gift of embedded malware is the payment.\n\nThe second email Talos analyzed had less effort applied. The email was from a free Korean\nmail service provided by Daum, Hanmail, showing there was no attempt at trying to appear\nto be from an official body or person compared with the previous email. The subject was\n\n\n-----\n\nmerely Request Help while the attachment filename was I m a munchon person in\nGangwon-do, North Korea'. We suspect the attacker is hoping the victim will feel empathetic\ntoward the sender as the Kangwon Province (where Munch'ŏn is located) was previously\npart of South Korea. The attachment contains a story about a person called 'Ewing Kim' who\nis looking for help.\n\nThe email's attachments are two different HWP documents both leveraging same\nvulnerability, CVE-2013-0808.\n\n## Malicious HWP Document\n\nAn HWP document is composed by OLE objects. In our case, it contains an EPS object\nnamed BIN0001.eps. As with all HWP documents the information is zlib compressed so you\nmust decompress the .eps to get the true shellcode.\n\nThe shellcode used to exploit the CVE-2013-0808 can be identified in the EPS object:\n\nAn interesting thing is that the shellcode does not start with a 'normal' NOP sled using 0x90\nbut with 0x0404 (add al, 0x4):\n\n\n-----\n\n```\nuser@lnx$ rasm2 d 0404040404040404040490909090909090909090E8000000005E\nadd al, 0x4\nadd al, 0x4\nadd al, 0x4\nadd al, 0x4\nadd al, 0x4\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nnop\nnop\ncall 0x19\npop esi\n\n```\nThe purpose of the shellcode embedded in the 2 HWP documents is to download and to\ndecode a payload available on the Internet. Once decoded, the file (a PE32) is executed.\nHere is the extracted URL which the document attempts to download the .jpg from:\n\nSHA256: 7d163e36f47ec56c9fe08d758a0770f1778fa30af68f39aac80441a3f037761e\n\nFilename: 통일북한학술대회_심사서류.hwp (\"North Korea Conference _ Examination\nDocuments\")\n\nURL: http://discgolfglow[.]com:/wp-content/plugins/maintenance/images/worker.jpg\n\n\n-----\n\nSHA256: 5441f45df22af63498c63a49aae82065086964f9067cfa75987951831017bd4f\n\nFilename: 저는요 북조선 강원도 문천 사람이에요.hwp (\"I'm a munchon person from\nGangwon Province in North Korea.\")\n\nURL: http://acddesigns[.]com[.]au/clients/ACPRCM/kingstone.jpg\n\n\n-----\n\n## ROKRAT Analysis\n\nThe RAT downloaded by the 2 HWP documents belong to the same family. The main\ndifference between the samples are the Command and Control capabilities. One of the\nsamples analyzed only uses Twitter to interact with the RAT, while the second one\nadditionally uses the cloud platforms: Yandex and Mediafire. The Twitter tokens we were\nable to extract are the same in both variants. There is obvious ongoing effort to add features\nto this RAT to allow for more sophisticated levels of attacks.\n\n## Analysis Frustrations!\n\nThe ROKRAT author implements several techniques typically seen to frustrate human\nanalysts and avoid sandbox execution.\n\nFirst, the malware does not run on Windows XP systems. It uses the GetVersion() API to get\nthe OS version. If the [MajorVersion is 5 (corresponding to Windows XP or Windows Server](https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms724833(v%3Dvs.85).aspx)\n2003), the malware executes an infinite loop of sleep:\n\n\n-----\n\nAdditionally, the malware checks the current running processes in order to identify tools\nusually used by malware analysts or within sandbox environments. The code used to\nperform this task:\n\n\n-----\n\nThe malware checks the process names in use on the victim machine. It compares if the\nexecuted process name matches a partial name hardcoded in the sample. Here is the\ncomplete list:\n\n\"mtool\" for VMWare Tools\n\"llyd\" for OllyDBG\n\"ython\" for Python (used by Cuckoo Sandbox for example)\n\"ilemo\" for File Monitor\n\"egmon\" for Registry Monitor\n\"peid\" for PEiD\n\"rocex\" for Process Explorer\n\"vbox\" for VirtualBox\n\"iddler\" for Fiddler\n\n\n-----\n\nortmo for Portmon\n\"iresha\" for Wireshark\n\"rocmo\" for Process Monitor\n\"utoru\" for Autoruns\n\"cpvie\" for TCPView\n\nIf any of these processes are discovered running on the system during this phase of\nexecution, the malware jumps to a fake function which generates dummy HTTP traffic.\nAdditionally we discovered that if the malware is being debugged or if it was not executed\nfrom the HWP document (i.e. double clicking the binary) or if the OpenProcess() function\nsucceed on the parent process, the fake function is also called.\n\nThe purpose of this appears to be to generate network traffic to provide some level of\nfeedback/discovery during any dynamic analysis research. This could generate a seemingly\n'good' indicator of compromise when in fact it is merely fake traffic generated. The fake\nfunction performs connections to the following URLs:\n\nhttps://www[.]amazon[.]com/Men-War-PC/dp/B001QZGVEC/EsoftTeam/watchcom.jpg\nhttp://www[.]hulu[.]com/watch/559035/episode3.mp4\n\nThe Amazon URL displays a WWII game called 'Men of War' whilst the Hulu URL attempts to\nstream a Japanese anime show called 'Golden Time'\n\n\n-----\n\nThese URLs are not malicious. The malware pretends to navigate these locations. The files\ndo not exist during the investigation and were downloaded only if a malware analyst tool is\nrunning on the system. We believe these URLs are used to attempt to trick any analysis.\n\n## C&C Infrastructure\n\nROKRAT uses a legitimate platform in order to communicate, receive orders and exfiltrate\ndocuments. In total, we identified 12 hardcoded tokens used to communicate to these\nlegitimate platforms, all via their public APIs.\n\n## CC #1: Twitter:\n\nThe first CC discovered is Twitter. We identified 7 different Twitter API tokens hardcoded in\nthe sample (Consumer Key + Consumer Secret + Token + Token Secret). The malware is\nable to get orders by checking the last message on the Twitter timeline. The order can be\neither execute commands, move a file, remove a file, kill a process, download and execute a\nfile. The RAT is able to tweet also. The sent data is randomly prefixed by one following 3\ncharacters hardcoded word:\n```\nSHA-TOM-BRN-JMS-ROC-JAN-PED-JHN-KIM-LEE\n```\nTo perform these tasks, the malware uses the official Twitter API:\n\n\n-----\n\n## CC #2: Yandex:\n\nThe second CC is Yandex and more specifically the Yandex cloud platform. This platform\nallows the creation of disks in the Yandex cloud. Concerning this CC, we identified 4 Yandex\ntokens hardcoded in the sample. The API is used to download and execute files or to upload\nstolen documents. The exfiltrated documents are uploaded to :\n\ndisk:/12ABCDEF/Document/Doc20170330120000.tfs\n\nWhere \"12ABCDEF\" is a random hexadecimal ID to identify the target and\nDoc20170330120000 contains the date.\n\n\n-----\n\n## CC #3: Mediafire:\n\nThe last cloud platform used by the Remote Administration Tool is Mediafire. This website is\nused in the same way as Yandex, the purpose is to use the file storage provided by Mediafire\nin order to download and execute files or to upload stolen information:\n\n\n-----\n\nIn this case, the malware author hardcoded one account in the sample (email / password /\napplication ID).\n\n**Additional Features: Screenshots Capture & Keylogger**\n\nAdditionally, one of the samples is able to capture screenshots of the infected system. To\nperform this task, the developer used the GDI API:\n\nA keylogger is also present in the analyzed sample. The SetWindowsHookEx() API is used\nto retrieve the stroked keys. The GetKeyNameText() API is used to retrieve a string that\nrepresents the name of a key. In addition to the key, the title of the foreground window is\nstored in order to known where the infected user is typing (by using the\nGetForegroundWindow() and GetWindowText() API).\n\n\n-----\n\n## Conclusion\n\nThis campaign shows us a motivated malware actor. The usage of HWP (an application\nmainly used in Korea) and the fact that emails and documents are perfectly written in Korean\nsuggests that the author is a native Korean speaker.\n\nThe RAT used during this campaign was innovative, using novel communication channels.\nROKRAT uses Twitter and two cloud platforms (Yandex and Mediafire) in order to give\norders, send files, and get files. This communication channel is extremely hard to contain\nbecause organizations often have legitimate uses of these platforms. The malware includes\nexotic features such as the fact that it performs requests to legitimate websites (Amazon and\nHulu) if the sample is executed in a sandbox or if a malware analyst tool is used. We assume\nthe goal is to generate incorrect reports and IOC.\n\nThis investigation shows us once again that South Korean interests sophisticated threat\nactors. In this specific case, the actor compromised a legitimate email address of a big forum\norganized by a university in Seoul in order to forge the spear phishing email which increased\nthe chance of success. And we know that it was a success, during the writing of the article\nwe identified infected systems communicating with the command & control previously\nmentioned.\n\n## Coverage\n\nAdditional ways our customers can detect and block this threat are listed below.\n\n\n-----\n\n[Advanced Malware Protection (AMP) is ideally suited to prevent the execution of the](https://www.cisco.com/c/en/us/support/security/amp-firepower-software-license/tsd-products-support-series-home.html)\nmalware used by these threat actors.\n\n[CWS orWSA web scanning prevents access to malicious websites and detects malware](https://www.cisco.com/c/en/us/products/security/cloud-web-security/index.html)\nused in these attacks.\n\n[Email Security can block malicious emails sent by threat actors as part of their campaign.](https://www.cisco.com/c/en/us/products/security/email-security-appliance/index.html)\n\n[The Network Security protection ofIPS andNGFW have up-to-date signatures to detect](https://www.cisco.com/c/en/us/products/security/intrusion-prevention-system-ips/index.html)\nmalicious network activity by threat actors.\n\n[AMP Threat Grid helps identify malicious binaries and build protection into all Cisco Security](https://www.cisco.com/c/en/us/solutions/enterprise-networks/amp-threat-grid/index.html)\nproducts.\n\n[Umbrella, our secure internet gateway (SIG), blocks users from connecting to malicious](https://umbrella.cisco.com/)\ndomains, IPs, and URLs, whether users are on or off the corporate network\n\n## IOCs\n\n**Files hashes**\n\nHWP Documents:\n\n7d163e36f47ec56c9fe08d758a0770f1778fa30af68f39aac80441a3f037761e\n5441f45df22af63498c63a49aae82065086964f9067cfa75987951831017bd4f\n\nROKRAT PE32:\n\ncd166565ce09ef410c5bba40bad0b49441af6cfb48772e7e4a9de3d646b4851c\n051463a14767c6477b6dacd639f30a8a5b9e126ff31532b58fc29c8364604d00\n\n**Networks**\n\nMalicious URLs:\n\nhttp://discgolfglow[.]com/wp-content/plugins/maintenance/images/worker.jpg\nhttp://acddesigns[.]com[.]au/clients/ACPRCM/kingstone.jpg\n\n\n-----\n\nNot malicious URLs but could be use to identify RAT execution:\n\nhttps://www[.]amazon[.]com/Men-War-PC/dp/B001QZGVEC/EsoftTeam/watchcom.jpg\nhttp://www[.]hulu[.]com/watch/559035/episode3.mp4\n\n**Tokens**\n\nMediafire\n\nAccount #1\n\nUsername: ksy182824@gmail.com\n\nApplication ID: 81342\n\nTwitter\n\nAccount #1\n\nConsumer key: sOPcUKjJteYrg8klXC4XUlk9l\n\nToken: 722226174008315904-u6P1FlI7IDg8VIYe720X0gqDYcAMQAR\n\nAccount #2\n\nConsumer key: sgpalyF1KukVKaPAePb3EGeMT\n\nToken: 759577633630593029-CQzXMfvsQ2RztFYawUPeVbAzcSnwllX\n\nAccount #3\n\nConsumer key: XVvauoXKfnAUm2qdR1nNEZqkN\n\nToken: 752302142474051585-r2TH1Dk8tU5TetUyfnw9c5OgA1popTj\n\nAccount #4\n\nConsumer key: U1AoCSLLHxfeDbtxRXVgj7y00\n\nToken: 779546496603561984-Qm8CknTvS4nKxWOB4tJvbtBUMBfNCKE\n\nAccount #5\n\nConsumer key: 9ndXAB6UcxhQVoBAkEKnwzt4C\n\nToken: 777852155245080576-H0kXYcQCpV6qiFER38h3wS1tBFdROcQ\n\nAccount #6\n\nConsumer key: QCDXTaOCPBQM4VZigrRj2CnJi\n\nToken: 775849572124307457-4ICTjYmOfAy5MX2FxUHVdUfqeNTYYqj\n\nAccount #7\n\nConsumer key: 2DQ8GqKhDWp55XIl77Es9oFRV\n\nToken: 778855419785154560-0YUVZtZjKblo2gTGWKiNF67ROwS9MMq\n\nYandex\n\nToken #1: AQAAAAAYm4qtAANss-XFfX3FjU8VmVR76k4aMA0\n\nToken #2: AQAAAAAA8uDKAANxExojbqps-UOIi8kc8EAhcq8\n\nToken #3: AQAAAAAY9j8KAANyULDuYU1240rjvpNXcRdF5Tw\n\nToken #4: AQAAAAAZDPB1AAN6l1Ht3ctALU1flix57TvuMa4\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-04-03 - Introducing ROKRAT.pdf"
    ],
    "report_names": [
        "2017-04-03 - Introducing ROKRAT.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535625,
    "ts_updated_at": 1743041131,
    "ts_creation_date": 1653753301,
    "ts_modification_date": 1653753301,
    "files": {
        "pdf": "https://archive.orkl.eu/3605fde4223a642e57e8aef1e2c56711fa29e5ba.pdf",
        "text": "https://archive.orkl.eu/3605fde4223a642e57e8aef1e2c56711fa29e5ba.txt",
        "img": "https://archive.orkl.eu/3605fde4223a642e57e8aef1e2c56711fa29e5ba.jpg"
    }
}