{
    "id": "b4338907-a377-480d-9682-8655441b158d",
    "created_at": "2022-10-25T16:48:15.155211Z",
    "updated_at": "2025-03-27T02:09:30.174306Z",
    "deleted_at": null,
    "sha1_hash": "6226f5e623d80ddcce349e617498a339d78927d0",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-11-27T02:55:49Z",
    "file_modification_date": "2019-11-27T02:55:49Z",
    "file_size": 966915,
    "plain_text": "# Insights from one year of tracking a polymorphic threat\n\n**[microsoft.com/security/blog/2019/11/26/insights-from-one-year-of-tracking-a-polymorphic-threat](https://www.microsoft.com/security/blog/2019/11/26/insights-from-one-year-of-tracking-a-polymorphic-threat/)**\n\nNovember 26, 2019\n\nA little over a year ago, in October 2018, our polymorphic outbreak monitoring system detected a\nlarge surge in reports, indicating that a large-scale campaign was unfolding. We observed as the\nnew threat attempted to deploy files that changed every 20-30 minutes on thousands of devices.\nWe gave the threat the name “Dexphot,” based on certain characteristics of the malware code.\n\nThe Dexphot attack used a variety of sophisticated methods to evade security solutions. Layers of\nobfuscation, encryption, and the use of randomized file names hid the installation process.\n[Dexphot then used fileless techniques to run malicious code directly in memory, leaving only a](https://docs.microsoft.com/en-us/windows/security/threat-protection/intelligence/fileless-threats)\nfew traces that can be used for forensics. It hijacked legitimate system processes to disguise\nmalicious activity. If not stopped, Dexphot ultimately ran a cryptocurrency miner on the device,\nwith monitoring services and scheduled tasks triggering re-infection when defenders attempt to\nremove the malware.\n\nIn the months that followed, we closely tracked the threat and witnessed the attackers upgrade\nthe malware, target new processes, and work around defensive measures:\n\n[While Microsoft Defender Advanced Threat Protection’s pre-execution detection engines blocked](https://www.microsoft.com/en-us/microsoft-365/windows/microsoft-defender-atp)\n[Dexphot in most cases, behavior-based machine learning models provided protection for cases](https://www.microsoft.com/security/blog/2019/10/08/in-hot-pursuit-of-elusive-threats-ai-driven-behavior-based-blocking-stops-attacks-in-their-tracks/)\nwhere the threat slipped through. Given the threat’s persistence mechanisms, polymorphism, and\nuse of fileless techniques, behavior-based detection was a critical component of the\ncomprehensive protection against this malware and other threats that exhibit similar malicious\nbehaviors.\n\nMicrosoft Defender ATP data shows the effectiveness of behavioral blocking and containment\ncapabilities in stopping the Dexphot campaign. Over time, Dexphot-related malicious behavior\nreports dropped to a low hum, as the threat lost steam.\n\n\n-----\n\nOur close monitoring of Dexphot helped us ensure that our customers were protected from the\nevolving threat. More importantly, one year’s worth of intelligence helped us gain insight not only\ninto the goals and motivations of Dexphot’s authors, but of cybercriminals in general.\n\n## Complex attack chain\n\nThe early stages of a Dexphot infection involves numerous files and processes. During the\nexecution stage, Dexphot writes five key files to disk:\n\n1. An installer with two URLs\n2. An MSI package file downloaded from one of the URLs\n3. A password-protected ZIP archive\n4. A loader DLL, which is extracted from the archive\n5. An encrypted data file that holds three additional executables that are loaded into system\n\n[processes via process hollowing](https://www.microsoft.com/security/blog/2017/07/12/detecting-stealthier-cross-process-injection-techniques-with-windows-defender-atp-process-hollowing-and-atom-bombing/)\n\nExcept for the installer, the other processes that run during execution are legitimate system\nprocesses. This can make detection and remediation more difficult. These legitimate system\nprocesses include msiexec.exe (for installing MSI packages), unzip.exe (for extracting files from\nthe password-protected ZIP archive), rundll32.exe (for loading the loader DLL), schtasks.exe (for\nscheduled tasks), powershell.exe (for forced updates). In later stages, Dexphot targets a few\nother system processes for process hollowing: svchost.exe, tracert.exe, and setup.exe.\n\n\n-----\n\n## Multiple layers of security evasion\n\n[Based on Microsoft Defender ATP signals, SoftwareBundler:Win32/ICLoader and its variants are](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=SoftwareBundler:Win32/ICLoader&threatId=222548)\nprimarily used to drop and run the Dexphot installer. The installer uses two URLs to download\nmalicious payloads. These are the same two URLs that Dexphot use later to establish\npersistence, update the malware, and re-infect the device.\n\nThe installer downloads an MSI package from one of the two URLs, and then launches\n_msiexec.exe to perform a silent install. This is the first of several instances of Dexphot employing_\n[living-off-the-land techniques, the use of legitimate system processes for nefarious purposes.](https://www.microsoft.com/security/blog/2019/09/26/bring-your-own-lolbin-multi-stage-fileless-nodersok-campaign-delivers-rare-node-js-based-malware/)\n\nDexphot’s package often contains an obfuscated batch script. If the package contains this file, the\nscript is the first thing that msiexec.exe runs when it begins the installation process. The said\nobfuscated script is designed to check for antivirus products. Dexphot halts the infection process\nimmediately if an antivirus product is found running.\n\nWhen we first began our research, the batch script only checked for antivirus products from Avast\nand AVG. Later, Windows Defender Antivirus was added to the checklist.\n\n\n-----\n\nIf the process is not halted, Dexphot decompresses the password-protected ZIP archive from the\nMSI package. The password to this archive is within the MSI package. Along with the password,\nthe malware’s authors also include a clean version of unzip.exe so that they don’t have to rely on\nthe target system having a ZIP utility. The unzip.exe file in the package is usually named various\nthings, such as z.exe or ex.exe, to avoid scrutiny.\n\nThe ZIP archive usually contains three files: the loader DLL, an encrypted data file (usually\nnamed bin.dat), and, often, one clean unrelated DLL, which is likely included to mislead detection.\n\nDexphot usually extracts the decompressed files to the target system’s Favorites folder. The files\nare given new, random names, which are generated by concatenating words and numbers based\non the time of execution (for example, C:\\Users\\<user>\\Favorites\\\\Res.Center.ponse\\<numbers>).\nThe commands to generate the new names are also obfuscated, for example:\n\n_Msiexec.exe next calls rundll32.exe, specifying loader DLL (urlmon.7z in the example above) in_\norder to decrypt the data file. The decryption process involves ADD and XOR operations, using a\nkey hardcoded in the binary.\n\nThe decrypted data contains three executables. Unlike the files described earlier, these\nexecutables are never written to the filesystem. Instead, they exist only in memory, and Dexphot\nruns them by loading them into other system processes via process hollowing.\n\n## Stealthy execution through fileless techniques\n\n[Process hollowing is a technique that can hide malware within a legitimate system process. It](https://www.microsoft.com/security/blog/2017/07/12/detecting-stealthier-cross-process-injection-techniques-with-windows-defender-atp-process-hollowing-and-atom-bombing/)\nreplaces the contents of the legitimate process with malicious code. Detecting malicious code\nhidden using this method is not trivial, so process hollowing has become a prevalent technique\nused by malware today.\n\n\n-----\n\nThis method has the additional benefit of being fileless: the code can be run without actually\nbeing saved on the file system. Not only is it harder to detect the malicious code while it’s running,\nit’s harder to find useful forensics after the process has stopped.\n\nTo initiate process hollowing, the loader DLL targets two legitimate system processes, for\nexample svchost.exe or nslookup.exe, and spawns them in a suspended state. The loader DLL\nreplaces the contents of these processes with the first and second decrypted executables. These\nexecutables are monitoring services for maintaining Dexphot’s components. The now-malicious\nprocesses are released from suspension and run.\n\nNext, the loader DLL targets the setup.exe file in SysWoW64. It removes setup.exe’s contents\nand replaces them with the third decrypted executable, a cryptocurrency miner. Although Dexphot\nalways uses a cryptocurrency miner of some kind, it’s not always the same miner. It used different\nprograms like XMRig and JCE Miner over the course of our research.\n\n## Persistence through regularly scheduled malware updates\n\nThe two monitoring services simultaneously check the status of all three malicious processes.\nHaving dual monitoring services provides redundancy in case one of the monitoring processes is\nhalted. If any of the processes are terminated, the monitors immediately identify the situation,\nterminate all remaining malicious processes, and re-infect the device. This forced update/reinfection process is started by a PowerShell command similar to the one below:\n\nThe monitoring components also detect freshly launched cmd.exe processes and terminate them\npromptly. As a final fail-safe, Dexphot uses schtasks.exe to create scheduled tasks, with the\ncommand below.\n\nThis persistence technique is interesting, because it employs two distinct MITRE ATT&CK\n[techniques: Scheduled Task and Signed Binary Proxy Execution.](https://attack.mitre.org/techniques/T1053/)\n\nThe scheduled tasks call msiexec.exe as a proxy to run the malicious code, much like how\n_msiexec.exe was used during installation. Using msiexec.exe, a legitimate system process, can_\nmake it harder to trace the source of malicious activity.\n\n\n-----\n\nFurthermore, the tasks allow Dexphot to conveniently update the payload from the web every\ntime the tasks run. They automatically update all of Dexphot’s components, both upon system\nreboot as well as every 90 or 110 minutes while the system is running.\n\nDexphot also generates the names for the tasks at runtime, which means a simple block list of\nhardcoded task names will not be effective in preventing them from running. The names are\nusually in a GUID format, although after we released our first round of Dexphot-blocking\nprotections, the threat authors began to use random strings.\n\nThe threat authors have one more evasion technique for these scheduled tasks: some Dexphot\nvariants copy msiexec.exe to an arbitrary location and give it a random name, such as\n_%AppData%\\<random>.exe. This makes the system process running malicious code a literal_\nmoving target.\n\n## Polymorphism\n\nDexphot exhibits multiple layers of polymorphism across the binaries it distributes. For example,\nthe MSI package used in the campaign contains different files, as shown in the table below. The\nMSI packages generally include a clean version of unzip.exe, a password-protected ZIP file, and\na batch file that checks for currently installed antivirus products. However, the batch file is not\nalways present, and the names of the ZIP files and Loader DLLs, as well as the password for\nextracting the ZIP file, all change from one package to the next.\n\nIn addition, the contents of each Loader DLL differs from package to package, as does the\nencrypted data included in the ZIP file. This leads to the generation of a different ZIP archive and,\nin turn, a unique MSI package, each time the attacker bundles the files together. Because of\nthese carefully designed layers of polymorphism, a traditional file-based detection approach\nwouldn’t be effective against Dexphot.\n\n|MSI pack‐ age ID|MSI package contents|Col3|Col4|Password for ZIP file|Contents of encrypted ZIP|Col7|\n|---|---|---|---|---|---|---|\n||Un‐ zip.exe name|ZIP file name|Batch file name||Loader DLL file name|Encrypt‐ ed data name|\n|MSI-1|ex.exe|webUI.r0_|f.bat|kjfhwehjkf|IECache.dll|bin.dat|\n|MSI-2|ex.exe|analog.tv|f.bat|ZvDagW|kernel32.bin|bin.dat|\n|MSI-3|z.exe|yandex.zip|f.bat|jeremy|SetupUi.dll|bin.dat|\n|MSI-4|un‐ zip.exe|ERD‐ NT.LOC.zip||iso100|ERDNT.LOC|data.bin|\n|MSI-5|pck.exe|mse.zip||kika|_steam.dll|bin.dat|\n|MSI-6|z.exe|msi.zip||arima|ic64.dll|bin.dat|\n|MSI-7|z.exe|mse.zip|f.bat|kika|_steam.dll|bin.dat|\n\n\n-----\n\n|MSI-8|z.exe|mse.zip|Col4|kika|_steam.dll|bin.dat|\n|---|---|---|---|---|---|---|\n|MSI-9|z.exe|yandex.zip|f.bat|jeremy|SetupUi.dll|bin.dat|\n|MSI-10|hf.exe|update.dat|f.bat|namr|x32Frame.dll|data.bin|\n|MSI-11|z.exe|yandex.zip|f.bat|jeremy|SetupUi.dll|bin.dat|\n|MSI-12|un‐ zip.exe|PkgM‐ gr.iso.zip||pack|PkgMgr.iso|data.bin|\n|MSI-13|ex.exe|analog.tv|f.bat|kjfhwe‐ fkjwehjkf|urlmon.7z|bin.dat|\n|MSI-14|ex.exe|icon.ico|f.bat|ZDADW|default.ocx|bin.dat|\n|MSI-15|hf.exe|update.dat||namr|AvastFile‐ Rep.dll|data.bin|\n|MSI-16|pck.exe|mse.zip|f.bat|kika|_steam.dll|bin.dat|\n|MSI-17|z.exe|mse.zip|f.bat|joft|win2k.wim|bin.dat|\n|MSI-18|ex.exe|plugin.cx|f.bat|ZDW|_setup.ini|bin.dat|\n|MSI-19|hf.exe|update.dat||namr|AvastFile‐ Rep.dll|data.bin|\n|MSI-20|ex.exe|installers.m‐ su|f.bat|000cehjkf|MSE.En‐ gine.dll|bin.dat|\n|MSI-21|z.exe|msi.zip|f.bat|arima|ic64.dll|bin.dat|\n|MSI-22|z.exe|archive00.x|f.bat|00Jmsje‐ h20|chrome_wat cher.dll|bin.dat|\n\n\n## A multitude of payload hosts\n\nBesides tracking the files and processes that Dexphot uses to execute an attack, we have also\nbeen monitoring the domains used to host malicious payloads. The URLs used for hosting all\nfollow a similar pattern. The domain address usually ends in a .info or .net TLD, while the file\nname for the actual payload consists of random characters, similar to the randomness previously\nseen being used to generate file names and scheduled tasks. Some examples from our research\nare shown in the table below.\n\n|Scheduled task name|Download URL|\n|---|---|\n|hboavboja|https://supe********709.info/xoslqzu.pdi|\n|{C0B15B19-AB02-0A10-259B- 1789B8BD78D6}|https://fa*****r.com/jz5jmdouv4js.uoe|\n\n\n-----\n\n|ytiazuceqeif|https://supe********709.info/spkfuvjwadou.b‐ bo|\n|---|---|\n|beoxlwayou|https://rb*****.info/xgvylniu.feo|\n|{F1B4C720-5A8B-8E97-8949- 696A113E8BA5}|https://emp*******winc.com/f85kr64p1s5k.naj|\n|gxcxhbvlkie|https://gu*****me.net/ssitocdfsiu.pef|\n|{BE7FFC87-6635-429F-9F2D- CD3FD0E6DA51}|https://sy*****.info/pasuuy/xqeilinooyese‐ jou.oew|\n|{0575F553-1277-FB0F-AF67- EB649EE04B39}|https://sumb*******on.info/gbzycb.kiz|\n|gposiiobhkwz|https://gu*****me.net/uyuvmueie.hui|\n|{EAABDEAC-2258-1340-6375- 5D5C1B7CEA7F}|https://refr*******r711.info/3WIfUntot.1Mb|\n|zsayuuec|https://gu*****me.net/dexaeuioiexpyva.dil|\n|njibqhcq|https://supe********709.info/aodoweuvmna‐ mugu.fux|\n|{22D36F35-F5C2-29D3-1CF1- C51AC19564A4}|https://pr*****.info/ppaorpbafeualuwfx/hix.ayk|\n|qeubpmnu|https://gu*****me.net/ddssaizauuaxvt.cup|\n|adeuuelv|https://supe********709.info/tp‐ neevqlqziee.okn|\n|{0B44027E-7514-5EC6-CE79- 26EB87434AEF}|https://sy*****.info/huauroxaxhlvyyhp/xho.eqx|\n|{5A29AFD9-63FD-9F5E-F249- 5EC1F2238023}|https://refr*******r711rb.info/s28ZXoDH4.78y|\n|{C5C1D86D-44BB-8EAA-5CDC- 26B37F92E411}|https://fa*****r.com/rbvelfbflyvf.rws|\n\n\nMany of the URLs listed were in use for an extended period. However, the MSI packages hosted\nat each URL are frequently changed or updated. In addition, every few days more domains are\ngenerated to host more payloads. After a few months of monitoring, we were able to identify\naround 200 unique Dexphot domains.\n\n## Conclusion: Dynamic, comprehensive protection against increasingly complex everyday threats\n\n\n-----\n\nDexphot is not the type of attack that generates mainstream media attention; it’s one of the\ncountless malware campaigns that are active at any given time. Its goal is a very common one in\ncybercriminal circles — to install a coin miner that silently steals computer resources and\ngenerates revenue for the attackers — yet Dexphot exemplifies the level of complexity and rate of\nevolution of even everyday threats, intent on evading protections and motivated to fly under the\nradar for the prospect of profit.\n\n[To combat threats, several next-generation protection engines in Microsoft Defender Advanced](https://www.microsoft.com/security/blog/2019/06/24/inside-out-get-to-know-the-advanced-technologies-at-the-core-of-microsoft-defender-atp-next-generation-protection/)\nThreat Protection’s antivirus component detect and stop malicious techniques at multiple points\nalong the attack chain. For Dexphot, machine learning-based detections in the cloud recognize\nand block the DLLs loaded by rundll32.exe, stopping the attack chain in its early stages. Memory\nscans detect and terminate the loading of malicious code hidden by process hollowing —\nincluding the monitoring processes that attempt to update the malware code and re-infect the\nmachine via PowerShell commands.\n\n[Behavioral blocking and containment capabilities are especially effective in defeating Dexphot’s](https://www.microsoft.com/security/blog/2019/10/08/in-hot-pursuit-of-elusive-threats-ai-driven-behavior-based-blocking-stops-attacks-in-their-tracks/)\nfileless techniques, detection evasion, and persistence mechanisms, including the periodic and\nboot-time attempts to update the malware via scheduled tasks. As mentioned, given the\n[complexity of the attack chain and of Dexphot’s persistence methods, we released a remediation](https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/configure-remediation-windows-defender-antivirus)\nsolution that prevents re-infection by removing artifacts.\n\nThe detection, blocking, and remediation of Dexphot on endpoints are exposed in Microsoft\n[Defender Security Center, where Microsoft Defender ATP’s rich capabilities like endpoint](https://www.microsoft.com/en-us/microsoft-365/windows/microsoft-defender-atp)\ndetection and response, automated investigation and remediation, and others enable security\noperations teams to investigate and remediate attacks in enterprise environments. With these\ncapabilities, Microsoft Defender ATP provides comprehensive protection against Dexphot and the\ncountless other complex and evolving threats that we face every day.\n\n## Sample indicators of compromise (IoCs)\n\n\n-----\n\nInstaller (SHA-256):\n72acaf9ff8a43c68416884a3fff3b23e749b4bb8fb39e16f9976643360ed391f\n\nMSI files (SHA-256):\n22beffb61cbdc2e0c3eefaf068b498b63a193b239500dab25d03790c467379e3\n65eac7f9b67ff69cefed288f563b4d77917c94c410c6c6c4e4390db66305ca2a\nba9467e0d63ba65bf10650a3c8d36cd292b3f846983032a44a835e5966bc7e88\n\nLoader DLLs (SHA-256):\n537d7fe3b426827e40bbdd1d127ddb59effe1e9b3c160804df8922f92e0b366e\n504cc403e0b83233f8d20c0c86b0611facc040b868964b4afbda3214a2c8e1c5\naa5c56fe01af091f07c56ac7cbd240948ea6482b6146e0d3848d450977dff152\n\n**_Hazel Kim_**\n\n_Microsoft Defender ATP Research Team_\n\n## Talk to us\n\nQuestions, concerns, or insights on this story? Join discussions at the Microsoft Defender ATP\ncommunity.\n\n[Read all Microsoft security intelligence blog posts.](https://www.microsoft.com/security/blog/microsoft-security-intelligence/)\n\n[Follow us on Twitter @MsftSecIntel.](https://twitter.com/MsftSecIntel)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.11.26.Dexphot/Insights%20from%20one%20year%20of%20tracking%20a%20polymorphic%20threat.pdf"
    ],
    "report_names": [
        "Insights from one year of tracking a polymorphic threat"
    ],
    "threat_actors": [
        {
            "id": "dfee8b2e-d6b9-4143-a0d9-ca39396dd3bf",
            "created_at": "2022-10-25T16:07:24.467088Z",
            "updated_at": "2025-03-27T02:02:10.241387Z",
            "deleted_at": null,
            "main_name": "Circles",
            "aliases": [],
            "source_name": "ETDA:Circles",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716495,
    "ts_updated_at": 1743041370,
    "ts_creation_date": 1574823349,
    "ts_modification_date": 1574823349,
    "files": {
        "pdf": "https://archive.orkl.eu/6226f5e623d80ddcce349e617498a339d78927d0.pdf",
        "text": "https://archive.orkl.eu/6226f5e623d80ddcce349e617498a339d78927d0.txt",
        "img": "https://archive.orkl.eu/6226f5e623d80ddcce349e617498a339d78927d0.jpg"
    }
}