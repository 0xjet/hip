{
    "id": "1ca85969-e043-4a39-a026-f8f3553b2911",
    "created_at": "2023-01-12T15:03:44.899742Z",
    "updated_at": "2025-03-27T02:12:54.542827Z",
    "deleted_at": null,
    "sha1_hash": "742fee4766161c371e935b0038f87dea9a2d24db",
    "title": "2022-01-24 - Cobalt Strike, a Defender’s Guide – Part 2",
    "authors": "",
    "file_creation_date": "2022-05-28T18:04:43Z",
    "file_modification_date": "2022-05-28T18:04:43Z",
    "file_size": 6104010,
    "plain_text": "# Cobalt Strike, a Defender’s Guide – Part 2\n\n**[thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/](https://thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/)**\n\nJanuary 24, 2022\n\nOur [previous report on Cobalt Strike focused on the most frequently used capabilities that we](https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/)\nhad observed. In this report, we will focus on the network traffic it produced, and provide\nsome easy wins defenders can be on the look out for to detect beaconing activity. We cover\ntopics such as domain fronting, SOCKS proxy, C2 traffic, Sigma rules, JARM, JA3/S, RITA &\nmore.\n\nAs with our previous article, we will highlight the common ways we see threat actors using\nCobalt Strike.\n\n\n-----\n\n[Big shout-out to @Kostastsale for helping put this Part 2 together! Also thanks to @svch0st,](https://twitter.com/Kostastsale/)\n[@pigerlin, and](https://twitter.com/pigerlin) [@0xtornado for reviewing this report.](https://twitter.com/0xtornado)\n\nEven though network monitoring and detection capabilities do not come easy for many\norganizations, they can generally offer a high return on investment if implemented correctly.\nMalware has to contact its C2 server if it is to receive further instructions. This article will\ndemonstrate how to detect this communication before threat actors accomplish their\nobjectives. There are a couple of factors that we can utilize to fingerprint any suspicious\ntraffic and subsequent infrastructure. Before we get into that part, we should first discuss\nwhat makes Cobalt Strike so versatile.\n\nCobalt Strike’s versatility comes from the ability to change the indicators with each payload.\nThis is made possible thanks to Malleable C2 profiles. Our other post touched on Malleable\nC2 profiles and how threat actors use them; however, that was just some of their many\napplications. Below you can find information related to some of the most important fields that\ncould throw off an analyst while investigating a Cobalt Strike network communication:\n\n_The reference profile below is taken from Raphael Mudge’s GitHub repository._\n\n\n-----\n\n```\n###Global Options###\nset sample_name \"whatever.profile\";\nset sleeptime \"0\"; <================ # Decimal number to indicate the time the beacon\nwill sleep for between communications in milliseconds\nset jitter  \"25\"; <================ # A number that indicates the percentage of a\nrandom sleep time that beacon will introduce to its C2 comm\nset useragent \"<string>\"; <================ # Custom user agent of your choice\nset data_jitter \"35\"; <================ # Represents the value bytes variable that\nwould instruct Cobalt Strike to send a random string on http-get/post to match the\nbytes value.\nset headers_remove \"<header to remove>\"; <================ # Specifying headers to be\nremoved in a comma separated manner.\n####### Not much explanation is needed here, you can change the certificate\ninformation to your heart's content.#######\nhttps-certificate {\n  set C \"US\";\n  set CN \"whatever.com\";\n  set L \"California\";\n  set O \"whatever LLC.\";\n  set OU \"local.org\";\n  set ST \"CA\";\n  set validity \"365\";\n}\n###HTTP-Config Block###\nhttp-config {\n  set headers \"<headers to include>\"; <================ # Specifying the headers\nthat you want to include.\n  header \"<name of the header(s)>\"; <================ # Specifying the name of the\nheader that will store the data that are transmitted to the C2 server\n  set trust_x_forwarded_for \"<true OR false>\"; <================ # If the C2\nserver is behind a redirector, this option would allow to forward the traffic to the\ncorrect destination \n  set block_useragents \"<user agents>\"; <================ # User agents that C2\nserver will block and show a 404 response\n  set allow_useragents \"<user agents>\" <================ # Opposite of the above\n}\n###HTTP-GET Block. This function and all of its fields could also exist and be\ncustomized for the HTTP-POST Block (Server communication)###\nhttp-get {\n  set uri \"/<URI string>\"; <================ # Specifying the URI to reference in\nbidirectional communication from client and server\n  set verb \"POST\"; <================ # Setting the verb when requesting available\ntasks from the C2 server.\n  client {\n    header \"Host\" \"whatever.com\"; <================ # Setting the header\nspecific to client communication with the C2. \n    header \"Connection\" \"close\";\n### Metadata corresponds to the information that the beacon is sending to the C2\nserver about itself. The operators may choose to enable additional fields that will\ninclude data on the C2 communication. You can mix and match fields below:\n  metadata {\n    #base64; <================ # Base64 encoded string\n    base64url; <================ # URL safe Base64 encoded string\n    #mask; <================ # Encrypting and encoding the data with XOR mask\n\n```\n\n-----\n\n```\nand random key\n    #netbios; <================ # Encoding data as netbios in lower case\n    #netbiosu; <================ # Another variation of netbios encoding \n    #prepend \"TEST123\"; <================ # Choosing a string to prepend to the\ntransmitted data\n    append \".php\"; <================ # Choosing a string to append\n   ### Termination statements: This statement tells Beacon and its server wherein\nthe transaction to store the transformed data. You may choose one of these\ntermination statement methods.\n    parameter \"file\"; <================ # Adding a parameter to the URI.\n    #header \"Cookie\"; <================ # Adding a specific string within a\nspecific header.\n    #uri-append; <================ # Adding a specific string in the URI. \n    #print;\n  }\n  parameter \"test1\" \"t\n\n```\nWe added comments to the profile above to explain the numerous fields operators can\nchange to customize the profile to their needs. All these different fields provide control and\nflexibility over the indicators of the C2 channel. Many free, open-source randomizer scripts\n[exist to create a unique profile such as Random C2 Profile Generator by](https://github.com/threatexpress/random_c2_profile) [@joevest,](https://twitter.com/joevest)\n[Malleable-C2-Randomizer by](https://github.com/bluscreenofjeff/Malleable-C2-Randomizer) [@bluscreenofjeff, and](https://twitter.com/bluscreenofjeff) [C2concealer by](https://github.com/FortyNorthSecurity/C2concealer) [@FortyNorthSec.](https://twitter.com/FortyNorthSec)\n\nBelow are some of the Cobalt Strike C2 servers that we observed during intrusions. On the\nright column, we show the URLs that the Cobalt Strike payloads were configured to query. A\ntrained eye could spot some of the Malleable profiles that exist on freely available resources\n[such as Raphael Mudge’s list on his GitHub page. Another example is the “jquery-](https://github.com/rsmudge/Malleable-C2-Profiles)\n_[3.3.1.min.js” which is associated with this malleable C2 profile as we observed in four](https://github.com/threatexpress/malleable-c2/blob/master/jquery-c2.3.11.profile)_\nintrusions.\n```\n+----------------------+-----------------------+\n| C2 Server      | URI queried     |\n+----------------------+-----------------------+\n| gawocag.com     | /nd          |\n| 190.114.254.116   | /push         |\n| 190.114.254.116   | /__utm.gif      |\n| kaslose.com     | /jquery-3.3.1.min.js |\n| yawero.com      | /skin.js       |\n| sazoya.com      | /skin.js       |\n| 192.198.86.130    | /skin.js       |\n| 162.244.83.216    | /jquery-3.3.1.min.js |\n| sammitng.com     | /jquery-3.3.1.min.js |\n| 23.19.227.147    | /styles.html     |\n| securityupdateav.com | /tab_shop_active.html |\n| 108.62.118.247    | /as          |\n| windowsupdatesc.com | /as          |\n| 212.114.52.180    | /copyright.css    |\n| defenderupdateav.com | /default.css     |\n| onlineworkercz[.]com | /kj          |\n| checkauj.com     | /jquery-3.3.1.min.js |\n+----------------------+-----------------------+\n\n```\n\n-----\n\n[A deep dive into all available fields can be found on this post from](https://blog.zsec.uk/cobalt-strike-profiles/) [@ZephrFish. He also](https://twitter.com/ZephrFish)\nincludes other fields related to post-exploitation beacon configuration along with network\n[communication-related fields. Another great resource is this article released by SpecterOps.](https://posts.specterops.io/a-deep-dive-into-cobalt-strike-malleable-c2-6660e33b0e0b)\n\n## Domain Fronting\n\nDomain fronting is another method for concealing communication between the endpoint and\nthe command and control servers. The main purpose of domain fronting is to connect to a\nrestricted host while pretending to communicate with an allowed host. It essentially masks\nyour traffic to a certain website by masquerading it as a different domain.\n\nThis technique is possible thanks to Content Delivery Networks (CDNs). Domain fronting\nwas mostly used by web services to bypass censorship in several countries that restricted\ntraffic (e.g., China). In recent years, attackers have started using this technique to hide their\nmalicious infrastructure behind legitimate domains. Because domain fronting is a\ncomplicated topic to grasp, below we have included an image from the official Cobalt Strike\n[page that discusses this technique.](https://www.cobaltstrike.com/blog/high-reputation-redirectors-and-domain-fronting/)\n\nCobalt Strike made domain fronting possible by allowing the operators to configure related\nsettings via the malleable C2 profiles. The following prerequisites must be met in order for\ndomain fronting to be possible:\n\n1. Own a domain. (e.g., infosecppl.store)\n2. Pick one of the many web services that provide CDN capabilities. (e.g., cloudfront.net).\n\n\n-----\n\n3. Setup the CDN service to create a new CDN endpoint and redirect traffic to your\n\ndomain. (e.g., l33th4x0r.cloudfront.net).\n4. Setup a profile to facilitate domain fronting.\n5. Identify a domain that uses the same CDN to ensure that the traffic will be forwarded to\n\nthe correct resource.\n\nStep five is where things get interesting. Attackers can use legitimate domains that are\nregistered under the same CDN provider. As demonstrated in the screenshot above, all they\nhave to do is include their CDN endpoint domain (created in step three) in the host header of\nthe request. In that way, the legitimate website will forward the traffic through the CDN to the\noriginal destination according to the host header.\n\nIn the screenshots below, you can see how the malleable C2 profiles are configured to allow\ndomain fronting using the Fastly and AzureEdge CDNs:\n\n\n-----\n\nThis research [paper released by academics from the University of California, Berkeley, is a](https://www.bamsoftware.com/papers/fronting/)\ngreat introduction to domain fronting. This paper inspired many researchers to expand the\npossibilities of this unique way of hiding the final destination server on web traffic. One of\n[those researchers is Vincent who wrote a great](https://twitter.com/vysecurity) [article on domain fronting. He explains in](https://www.vincentyiu.com/red-team/domain-fronting/domain-fronting-who-am-i)\n[simple terms how it works. He also published a Python script to identify possible domains](https://github.com/vysecurity/FindFrontableDomains)\nthat can be leveraged for domain fronting.\nLooking into our reporting, we don’t see many instances of domain fronting. This is most\nlikely due to the complex process of setting up the necessary infrastructure. Although, based\non the data we have collected regarding malicious infrastructure, domain fronting appears to\nbe used by threat actors. According to our data from early 2021 up to now, Amazon\nCloudfront takes the lead on preferable CDN used by threat actors, by a large margin.\n\nThe data above is available via our services. More information on this service and others can\nbe found [here.](https://thedfirreport.com/services/)\n\n## Reverse Proxy using Cobalt Strike Beacon\n\nA technique that we come across often is a reverse proxy. We see instances where threat\nactors use their beacon sessions to establish RDP access through a reverse proxy. Cobalt\nStrike has the ability to run a SOCKS proxy server on the team server. This enables the\noperators to setup a listening port and leverage it to relay traffic to and from the open beacon\nsession. The screenshot below demonstrates this implementation.\n\n\n-----\n\nImage credit: [cobaltstrike.com](https://www.cobaltstrike.com/blog/reverse-port-forward-through-a-socks-proxy/)\n\nSome of the cases we have observed threat actors using reverse proxy are:\n\nIn most, of the above cases, the aim of the attackers was to establish a Remote Desktop\nsession. There are numerous advantages to establishing a RDP session, including the ability\nto navigate using a graphical environment and easily move laterally once the necessary\naccess has been granted.\n\n[Below, we demonstrate how attackers take advantage of this technique using proxychains](https://github.com/haad/proxychains)\nfrom the attackers’ kali Linux host. In the first image, the attackers open a socks listening\nport, in this case port 8888, on the Cobalt Strike team server.\n\n\n-----\n\n_Creating the listening port (TCP port 8888)_\nIn this second image, we employ proxychains from the attacker’s Kali Linux host to RDP into\nour target’s environment via the SOCKS server. We essentially add the team server’s IP\naddress into the proxychains configuration and connect with xfreerdp.\n\n_RDP into the target host using reverse proxy_\n\n\n-----\n\nLooking into the generated artifacts, we can see that a 4624 type 3 event is created on the\ntarget host. One interesting aspect that we have also mentioned in similar cases from our\nreporting is that the victim’s hostname is captured in this logon event as well as the source\naddress being 127.0.0.1.\n\n_Security Event ID 4624 Type 3 shows the attacker’s hostname_\nOnce again, the running Cobalt Strike beacon acts as the intermediary to facilitate the\nRemote Desktop session via reverse proxy.\n\n## Inside Cobalt Strike’s C2 Traffic\n\nThis section will attempt to illustrate how the different malleable C2 profiles can affect\nnetwork communication.\n\n\n-----\n\nIn some of the examples below, we simulated the malicious C2 channel to show how\ndifferent malleable profile configurations can change the observed traffic. After that, we’ll\nexamine network data associated with lateral movement and the various methods employed\nby Cobalt Strike operators based on our observations.\n\n### HTTP/HTTPS C2 traffic\n\n[We will use a slightly modified version of the jquery profile to illustrate how the configuration](https://raw.githubusercontent.com/threatexpress/malleable-c2/master/jquery-c2.3.11.profile)\ndefines the various fields that make up the C2 connection. Our previous article presented\nthis jquery profile as one of the most commonly used profiles by threat actors in the\nintrusions we reported.\n\nAs shown above, malleable C2 profiles can generate unique network traffic based on the\nprovided configuration. A portion of the malleable C2 profile configuration is shown at the\nbottom half of the screenshot. At the top half of the screenshot, we show the HTTP\ncommunication between the Beacon and the Cobalt Strike server.\n\nThe malleable profile determines the content of all parameters used in GET and POST\nrequests. Because of how simple it is to change these parameters, creating network\nsignatures for proactive defense can be difficult. Defenders can create signatures for publicly\navailable profiles (see Sigma section below) or profiles extracted and made available thru\nopen-source reporting. One could search for traffic that matches known patterns (such as\njquery or amazon) but the target IP/domain does not match the expected infrastructure.\n\n\n-----\n\n### DNS C2 traffic\n\nCobalt Strike is capable of using DNS as the C2 method. Operators can choose to configure\ntheir server to respond to beacon requests in A, AAAA or TXT records. This strategy is\nuseful for more covert operations, as the destination host could be a benign DNS server.\nDefenders will have to inspect the traffic data and look for suspicious DNS records.\n\n[The screenshot below is from the official Cobalt Strike documentation page and shows how](https://hstechdocs.helpsystems.com/manuals/cobaltstrike/current/userguide/content/topics/listener-infrastructue_beacon-dns.htm#_Toc65482739)\nDNS communication works between the compromised host and the C2 server.\n\nIn the below example, we emulated this technique and configured the Beacon to\ncommunicate over DNS and request new tasks using A records. In the same way, we can\nconfigure the Beacon to use TXT or AAAA records for requesting tasks or sending\ninformation to the server. It is worth noting that the default method is the DNS TXT record\ndata channel. Below is the infrastructure that we used for demonstration purposes:\n\nTarget Host: 192.168.88.179\nInternal DNS server: 192.168.88.2\n[Cobalt Strike C2 domain: infosecppl.store](http://infosecppl.store/)\n\nWe instructed the Beacon to execute the command systeminfo on the compromised host. As\nyou can see from the screenshot below, it took 148 packets containing DNS requests and\nresponses to finish the task and send back the data to the Cobalt Strike Server. The activity\ntook 5 seconds to complete.\n\n\n-----\n\nAs with HTTP/HTTPS traffic, DNS traffic can be randomized using malleable C2 profiles.\nSome of the options that are available to threat actors are as follows:\n\n_[The above table was taken from Cobalt Strike’s official documentation](https://www.cobaltstrike.com/help-malleable-c2#dns-beacon-bm)_\n\n### SMB Beacons\n\nAnother option for threat actors is to employ SMB beacons, once they have gained access to\nthe network. SMB beacons open a local port on the target host and listen for incoming\ncommunication from a parent beacon. The communication between the two beacons is\npossible thanks to named pipes.\n\nThe operators can configure the pipename on the client; however, the default pipename\nstarts with “msagent_#” for SMB beacons. For a list of default pipe names for other services\nincluding some custom profiles check out @svch0st’s post [here.](https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575)\n\n\n-----\n\nSMB beacons are mostly used to make network detection harder and to get access to\nisolated systems where communication to the internet is prohibited. Additionally, due to SMB\nprotocol being accessible in most internal networks, it makes for a reliable C2 method.\nOperators can also chain beacons and move laterally inside the network.\n\nAccording to our records, SMB beacons are not frequently used. However, they’re still a\npowerful weapon in the hands of skilled operators. As we do not see SMB beacons used\noften in our intrusion cases, we took an example case from our lab to demonstrate the\neffectiveness of this method.\n\nWe ran a PowerShell loader on the target host, which loaded a stageless SMB beacon in\nmemory. In our case, the SMB Beacon is communicating over the network with a parent\nBeacon using named pipes. For this example, we chose the named pipe “my_pipes”.\n\n\n-----\n\nAs you can see from the screenshots below, windows event 4688 contains the execution of\nthe PowerShell command.\n\n[As explained in our previous Cobalt Strike article, Sysmon events 17 and 18 can log named](https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/)\npipes. However, Sysmon should be explicitly configured to log named pipes. A good public\n[Sysmon config that includes named pipes and much more is Olaf‘s Sysmon Moduler.](https://twitter.com/olafhartong)\n\nBelow, you can see the named pipe created that we specified on the Cobalt Strike interface\nwhen we created the SMB listener.\n\n\n-----\n\nFurthermore, the SMB Beacon will communicate over port 445 to the main beacon as we\ndescribed above, which will then send the results to the C2 server. This is known as chaining\nbeacons. The below screenshot illustrates the SMB communication between the beacon on\nthe beachhead host and the chained beacon(s). Another way to describe the communication\nis a parent/child relationship.\n\n\n-----\n\nThe network traffic shows the target host communicating over SMB with the other\ncompromised host running the parent HTTP Beacon. Named Pipes are used to facilitate the\ntransition of data.\n\n_192.168.38.102 = SMB Beacon_\n\n_192.168.38.104 = HTTP Parent Beacon_\n\n## Detecting and Analyzing C2 Traffic\n\nThanks to free, open-source tooling, investigating network traffic has become more\naccessible. There are specific tools that we use to analyze suspicious network traffic in our\nintrusion cases. We believe that no single tool can provide complete detection coverage, but\nwe can get close by combining them. In the following section, we will look at these tools that\ncould accelerate analysis for defenders.\n\n### Sigma\n\nWe’ll go through a few Sigma rules that can help us detect Cobalt Strike’s network activity.\n\n[Cobalt Strike DNS Beaconing is a rule created by](https://github.com/SigmaHQ/sigma/blob/master/rules/network/net_mal_dns_cobaltstrike.yml) [Florian Roth which looks at DNS logs to](https://twitter.com/cyb3rops)\ndetect the default DNS C2 behavior based on the dns_stager_subhost, put_output and\ndns_stager_subhost as seen above.\n\n\n-----\n\n[Below is a more generic rule created by](https://bradleyjkemp.dev/sigmadoc/rules/network/net_dns_c2_detection.yml/) [@bareiss_patrick which is a good example of](https://twitter.com/bareiss_patrick)\ndetecting suspicious DNS traffic based on a high amount of queries for a single domain.\n\n\n-----\n\n[Another more generic rule created by](https://github.com/SigmaHQ/sigma/blob/eb382c4a59b6d87e186ee269805fe2db2acf250e/rules/network/net_high_txt_records_requests_rate.yml) [Daniil Yugoslavskiy uses dns logs to look for 50 or](https://twitter.com/yugoslavskiy)\nmore TXT records from a single source in one minute:\n\n[Default Cobalt Strike Certificate is a rule written by Bhabesh Raj that uses Zeek logs to](https://github.com/SigmaHQ/sigma/blob/eb382c4a59b6d87e186ee269805fe2db2acf250e/rules/network/zeek/zeek_default_cobalt_strike_certificate.yml)\ndetect the default Cobalt Strike certificate\n\n\n-----\n\n[RDP over Reverse SSH Tunnel WFP by](https://github.com/SigmaHQ/sigma/blob/eb382c4a59b6d87e186ee269805fe2db2acf250e/rules/windows/builtin/security/win_rdp_reverse_tunnel.yml) [Samir Bousseaden is a rule that can look for](https://thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/blank)\nsuspicious RDP activity using reverse tunneling.\n\n\n-----\n\n[CobaltStrike Malleable Amazon Browsing Traffic Profile by](https://github.com/SigmaHQ/sigma/blob/master/rules/proxy/proxy_cobalt_amazon.yml) [Markus Neis which looks at proxy](https://twitter.com/markus_neis)\nlogs for the Amazon Malleable profile.\n\n\n-----\n\n[Other malleable profile rules include CobaltStrike Malformed UAs in Malleable Profiles,](https://github.com/SigmaHQ/sigma/blob/master/rules/proxy/proxy_cobalt_malformed_uas.yml)\n[CobaltStrike Malleable (OCSP) Profile, and](https://github.com/SigmaHQ/sigma/blob/master/rules/proxy/proxy_cobalt_ocsp.yml) CobaltStrike Malleable OneDrive Browsing\nTraffic Profile.\n\n[All Sigma rules here are documented towards the bottom of Part 1.](https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/)\n\n### Rita\n\nRita stands for Real Intelligence Threat Analytics (RITA), developed by Active\nCountermeasures. Rita is a framework for detecting command and control communication. It\ntakes Zeek logs data and can, in our experience, accurately detect beaconing activity.\n\nOne of the great features of Rita is its ease of use and detailed output information in various\nforms, including CSV and HTML. One simply can point Rita to the Zeek logs and wait for the\nresults. The more available data, the more precise the results will be. Zeek logs can be\ngenerated from the PCAP(s).\n\nThe screenshot samples below show the results created by Rita based on the traffic we used\nin the previous sections to demonstrate the jquery malleable C2 profile.\n\n\n-----\n\nWe left the Beacon running for an hour to simulate an actual infection while several other\nnetwork-unrelated processes ran in the background. During this hour, we tasked the Beacon\nwith carrying out several commands. Rita determined that one hour of network data was\nadequate for identifying the beacon link and assigning it the highest score. Although, the\nmore data you have, the more accurate the results will be.\n\nBelow, we can see the results from one of our recent cases, BazarLoader and the Conti\nLeaks. The first three IP addresses relate to the CS servers with which the Beacon\ncommunicated.\n\nRita accurately identified beaconing activity related to Cobalt Strike C2 communication.\nUsing Rita, we can identify malicious C2 traffic based on multiple variables, including\ncommunication frequency, average bytes sent/received, number of connections etc. As a\nresult, we can detect Cobalt Strike beaconing regardless of the malleable C2 profile utilized\nor any additional jitter present.\n\n### JA3/JA3S\n\n[JA3 is an open-source project created by John Althouse,](https://www.linkedin.com/in/johnalthouse/) [Jeff Atkinson and](https://www.linkedin.com/in/annh/) [Josh Atkins.](https://www.linkedin.com/in/joshratkins/)\nJA3/JA3S can create SSL fingerprints for communication between clients and servers. The\nunique signatures can represent several values collected from fields in the Client Hello\npacket:\n```\n- SSL Version\n- Accepted Ciphers\n- List of Extensions\n- Elliptic Curves\n- Elliptic Curve Formats\n\n```\nFor more information on how JA3 works, you can visit the official GitHub repository here:\n[https://github.com/salesforce/ja3.](https://github.com/salesforce/ja3)\n\nThe JA3 tool is used to generate a signature for the client-side beacon connection with the\nserver. JA3S, on the other hand, is able to generate a server fingerprint. The combination of\nthe two can produce the most accurate result. JA3S can capture the full cryptographic\ncommunication and combine the JA3 findings to generate the signature.\n\n\n-----\n\nThe downside of this method is that it can produce inaccurate results if the Cobalt Strike is\nbehind redirectors.\n\nWe can find many [reports that contain the JA3 value that corresponds to the Cobalt Strike](https://thedfirreport.com/?s=72a589da586844d7f0818ce684948eea)\nfingerprint. When it comes to Cobalt Strike infrastructure, the known JA3 and JA3s\nsignatures that we are looking for are:\n\n**JA3**\n\n72a589da586844d7f0818ce684948eea\na0e9f5d64349fb13191bc781f81f42e1\n\n**JA3s**\n\nb742b407517bac9536a77a7b0fee28e9\nae4edc6faf64d08308082ad26be60767\n\nBy using JA3/S signatures, we can discover various malware C2 servers and not just Cobalt\nStrike. Salesforce provides a thorough collection of signatures that belong to many different\n[applications here. Some other example signatures with well known JA3 fingerprints are:](https://github.com/salesforce/ja3/tree/master/lists)\n\nTrickbot: 6734f37431670b3ab4292b8f60f29984\nAsyncRat: fc54e0d16d9764783542f0146a98b300\nDridex: 51c64c77e60f3980eea90869b68c58a8\nJA3 of Python usually hosting Empire or PoshC2:\ndb42e3017c8b6d160751ef3a04f695e7\nTOR client: e7d705a3286e19ea42f587b344ee6865\n\n[Another very good website to test the JA3 signature against a large database is ja3er.](https://ja3er.com/)\n\n### JARM\n\nSimilar to JA3/JA3S, JARM has the ability to fingerprint the TLS values of the remote server.\nIt does this by interacting with the target server sending 10 TLS Client Hello packets and\nrecording the specific attributes from the replies. It will then hash the result values and create\nthe final JARM fingerprint.\n\nUnlike JA3/S, JARM is an active way of fingerprinting remote server applications. John\n[Althouse has created a medium post that accurately conveys the differences between JA3/S](https://medium.com/@jalthouse/great-question-11aa555f6b28)\nand JARM:\n\n_“JARM actively scans the server and builds a fingerprint of the server application. Whereas_\n_JA3/S is passive, just listening, not reaching out, JARM is active, actively probing the target._\n_And is able to build a fingerprint of the server application where JA3S could not.”_\n\n\n-----\n\nAccording to research and further changes on the JAVA TLS version as mentioned below,\nthe JARM fingerprint that corresponds to a default configuration of the Cobalt Strike is:\n\n_07d14d16d21d21d00042d41d00041de5fb3038104f457d92ba02e9311512c2_\n\nCobalt Strike is dependent on Java to run both the client graphical user interface (GUI) and\nthe team server. When we scan a Cobalt Strike server using JARM, the results we get back\nare dependent on the Java version that is used. According to Cobalt Strike’s [documentation,](https://www.cobaltstrike.com/help-java-dependency)\nOpenJDK 11 is the preferred version that needs to be installed by the operators. This makes\nit easier to identify a potential Cobalt Strike server, however, defenders should be aware that\nthis outcome alone is prone to false positives. This is because many other legitimate servers\non the internet use this version of Java to operate their web applications.\n\nOn April 20th, 2021 Java Disabled TLS 1.0 and TLS 1.1 in favor of TLS 1.2 or above.\nFollowing this change, the JARM fingerprint for Cobalt Strike servers changed:\n\nFrom: 07d14d16d21d21d07c42d41d00041d24a458a375eef0c576d23a7bab9a9fb1\n\nTo: 07d14d16d21d21d00042d41d00041de5fb3038104f457d92ba02e9311512c2\n\n[This change was highlighted by @bodziurity and](https://twitter.com/bodziurity) [@WLesicki in a collaborative effort:](https://twitter.com/WLesicki)\n\n\n-----\n\n[Cobalt Strike has a post dedicated to JARM that goes into detail on how JARM works and](https://blog.cobaltstrike.com/2020/12/08/a-red-teamer-plays-with-jarm/)\nhow the specific hash value is created based on the Java version.\n\n[Looking into our reporting for this hash value will return four of our cases. All these cases](https://thedfirreport.com/?s=07d14d16d21d21d07c42d41d00041d24a458a375eef0c576d23a7bab9a9fb1)\ninvolve Cobalt Strike as the post-exploitation method.\n\nTo generate a JARM fingerprint against a server, you can run the [JARM python tool:](https://github.com/salesforce/jarm)\n```\npython3 jarm.py [target] -p [port]\n\n```\n\n-----\n\nWhile JARM s offer another tool to help reveal adversary infrastructure they are not an\nindicator that can be used in isolation. JARM signatures can be masked, Dagmawi Mulugeta\npresented at [HiTB Amsterdam in 2021 a tool that enables red teams or adversaries to mask](https://conference.hitb.org/hitbsecconf2021ams/materials/D2%20COMMSEC%20-%20JARM%20Randomizer%20Evading%20JARM%20Fingerprinting%20-%20Dagmawi%20Mulugeta.pdf)\n[the JARM signatures of their infrastructure. Called JARM Randomizer the tool can be](https://github.com/netskopeoss/jarm_randomizer)\nconfigured as a proxy in front of the Cobalt Strike server to serve up false data to potential\ninternet scanners.\n\nOther JARMs can be found at: [https://github.com/cedowens/C2-JARM.](https://github.com/cedowens/C2-JARM)\n\n### Arkime (Moloch) and JA3/S\n\n[We included Arkime as it integrates with JA3/JA3S and other plugins to enhance network](https://arkime.com/index#home)\nanalysis. Arkime is a tool that we use a lot to investigate network activity and gather\nindicators. It can index network traffic and make events easily searchable.\n\nArkime is simple to set up and excellent for reviewing traffic. Arkime makes use of additional\nanalysis tools by including them as plugins. More on this and other tools in the next report.\n\n\n-----\n\n## All for now\n\nThat wraps up Cobalt Strike, a Defender’s Guide Part 2. Would you like to see something\nspecific in Part 3? Contact us here or on Twitter with suggestions. Thanks for reading and\nhope this helps!\n\n[Please see the bottom of our first report for more detections & rules.](https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-24 - Cobalt Strike, a Defender’s Guide – Part 2.pdf"
    ],
    "report_names": [
        "2022-01-24 - Cobalt Strike, a Defender’s Guide – Part 2.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9e767b38-12ae-4ef7-9878-5ce1701066d7",
            "created_at": "2024-05-01T02:03:08.131819Z",
            "updated_at": "2025-03-27T02:05:17.413497Z",
            "deleted_at": null,
            "main_name": "NICKEL ACADEMY",
            "aliases": [
                "COVELLITE ",
                "CTG-2460 ",
                "Diamond Sleet ",
                "Guardians of Peace",
                "HIDDEN COBRA ",
                "High Anonymous",
                "Labyrinth Chollima ",
                "NNPT Group",
                "New Romanic Cyber Army Team",
                "Temp.Hermit ",
                "The Lazarus Group ",
                "UNC577 ",
                "Who Am I?",
                "Whois Team",
                "ZINC ",
                "Black Artemis "
            ],
            "source_name": "Secureworks:NICKEL ACADEMY",
            "tools": [
                " DarkMessenger",
                " Destover",
                " Duuzer",
                " HOPLIGHT",
                " Joanap",
                " KorHigh",
                " LiveJinx",
                " Volgmer",
                "Brambul"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535824,
    "ts_updated_at": 1743041574,
    "ts_creation_date": 1653761083,
    "ts_modification_date": 1653761083,
    "files": {
        "pdf": "https://archive.orkl.eu/742fee4766161c371e935b0038f87dea9a2d24db.pdf",
        "text": "https://archive.orkl.eu/742fee4766161c371e935b0038f87dea9a2d24db.txt",
        "img": "https://archive.orkl.eu/742fee4766161c371e935b0038f87dea9a2d24db.jpg"
    }
}