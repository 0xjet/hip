{
    "id": "d7e2ec61-f7b9-4fb8-bd1d-d6965afc58c9",
    "created_at": "2023-01-12T15:04:09.371577Z",
    "updated_at": "2025-03-27T02:16:25.837454Z",
    "deleted_at": null,
    "sha1_hash": "268911dacaa7ed6f4e598b231c1fbdc8da3d1d34",
    "title": "2018-01-11 - Ay MaMi",
    "authors": "",
    "file_creation_date": "2022-05-29T01:22:33Z",
    "file_modification_date": "2022-05-29T01:22:33Z",
    "file_size": 2622362,
    "plain_text": "# Objective-See\n\n**objective-see.com/blog/blog_0x26.html**\n\n## Ay MaMi\n\n › Analyzing a New macOS DNS Hijacker: OSX/MaMi\n\n 01/11/2018\n\n love these blog posts? support my tools & writing on patreon! Mahalo :)\n\n 2018 is barely two weeks old, and already it looks like we've got new piece of macOS malware! Hooray :)\n\n Want to play along? I've shared both the malware's binary executable ('MaMi'), which can be downloaded here (password: infect3d).\n\n Please don't infect yourself!\n\n Background\n Earlier today (01/11), someone on MalwareBytes' forum created a post titled \"DNS Hijacked\":\n\n\n-----\n\n## As I hadn't seen an answer to MikeOfMaine', and as far as I'm aware there haven't been any recent macOS malware that hijacks DNS settings - so I was intrigued! So without further adieu, let's dive in to analyzing (what I'm calling) OSX/MaMi!\n\n Analysis\n Though currently I am unaware of the malware's infection vector, it is hosted on various sites such as http://regardens.info:\n```\ncurl -L http://regardens.info/ > MaMi\n% Total  % Received % Xferd Average Speed  Time  Time   Time Current\n                 Dload Upload  Total  Spent  Left Speed\n100  178  0  178  0   0  381   0 --:--:-- --:--:-- --:--:--  381\n100 552k 100 552k  0   0  314k   0 0:00:01 0:00:01 --:--:-- 581k\nMacBookPro:Downloads patrickw$ file MaMi\nMaMi: Mach-O 64-bit executable x86_64\n\n As shown by WhatsYourSign, nothing too special about the file; it's an unsigned Mach-O 64- bit executable:\n\n```\n\n-----\n\n## As is often the case with new malware, it's currently marked as 'clean' by all 59 engines on VirusTotal (this will hopefully change shortly as AV products start adding detections):\n\n And speaking of 'new' if we load the malware's binary in a disassembler, we find an app version of 1.1.0, which (due to such low version number), may seem to indicate the malware likely hasn't been around for too long.\n```\n000000010003818f db \"AppVersion: %@\\nAppBuild: %@\", 0 \n00000001000381ab db \"1.1.0\", 0            \n00000001000381b1 db \"0\", 0              \n\n Before we dig further into the disassembly, let's dump the Objective-C class names and methods, as often this can allow us to quickly gain insight the malware's (likely) capabilities or at least guide our analysis.\n\n I use J. Levin's invaluable jtool utility to dump such info:\n\n```\n\n-----\n\n```\n$ ./jtool d objc v MaMi\n@interface AppDelegate \n...\n/* 2 - 0x100001e0b */ - setupCert;\n...\n/* 7 - 0x1000027bc */ - setupDNS;\n...\n/* 9 - 0x100002a97 */ - takeScreenshotAt:;\n...\n/* 22 - 0x1000049d8 */ - mouseClick:;\n...\n/* 24 - 0x100004ac5 */ - runAppleScript:;\n@interface SBMaMiSettings :\n...\n/* 2 - 0x10000518b */ - initMaMiSettings;\n...\n/* 9 - 0x100005385 */ - programArguments;\n...\n/* 11 - 0x1000053a7 */ - runAtLoad;\n...\n/* 25 - 0x10000548f */ - launchOnlyOnce;\n@interface SBNetwork :\n...\n/* 0 - 0x10000d2e5 */ + downloadFile:atPath:;\n/* 1 - 0x10000d4a8 */ + sendAsyncRequestWithUrls:andMethod:andBody:;\n@interface SBFileSystem : ?\n/* 0 - 0x10002407e */ + writeString:toPath:;\n...\n/* 8 - 0x1000247fb */ + runCmd:andPipeToCmd:withParams:andParams2:; \n/* 9 - 0x100024b07 */ + runCmd:withParams:;\n/* 10 - 0x100024b23 */ + runCmd:withParams:andUser:;\n@interface SBCryptoSystem : ?\n/* 0 - 0x100026731 */ + isAdmin; // Protocol 129824ad7\n/* 1 - 0x100026745 */ + elevatePrivilegesWithParams:; // Protocol 1298247ca\n/* 2 - 0x1000267aa */ + relaunchWithPrivilegesAndParams:;\n\n## Some very interesting methods! Of course we'll continue our analysis to confirm, but seems this malware is indeed a 'dns hijacker' (method: setupDNS), with a host of other abilities such as:\n taking screenshots\n generating simulated mouse events\n\n```\n\n-----\n\n## perhaps persists as a launch item (programArguments, runAtLoad)\n downloading & uploading files\n executing commands\n ...and more!\n\n Jumping back to the disassemlby, within the application's main entrypoint (-[AppDelegate applicationDidFinishLaunching:]), we see a massive encrypted string that is passes to a setDefaultConfiguration: method:\n```\n [SBConfigManager\nsetDefaultConfiguration:@\"uZmgulcipekSbayTO9ByamTUu_zVtsflazc2Nsuqgq0dXko\n OzKMJMNTULoLpd-QV9qQy6VRluzRXqWOGscgheRvikLkPRzs1pJbey2QdaUSXUZCXUNERrosul22NsW2vYpS7HQO4\nVG5l8qic3rSH_fAhxsBXpEe557eHIr245LUYcEIpemnvSPTZ_lNp2XwyOJjzcJWirKbKwtc3Q61pDwTzKvE0..\n\n Applying some classified decryption methods I learned as an intern working in NSA's Cryptanalysis and Exploitation Services (CES) group - it was trivial to decrypt this configuration data. I'm totally kidding - not about the internship - but about how to decrypt. Just step over that method in a debugger (lldb) and the data is sitting decrypted in memory:\n\n```\n\n-----\n\n```\n# lldb MaMi\n(lldb) target create \"MaMi\"\nCurrent executable set to 'MaMi' (x86_64).\n...\n(lldb) po $rax\n{\n  defaults =   {\n    affiliate = \"\";\n    build = 0;\n    \"compilation_id\" = 0;\n    \"confirmation_end_time\" = 0;\n    \"confirmation_start_time\" = 0;\n    \"download_complete_time\" = 0;\n    \"download_location\" = \"\";\n    \"download_retry_count\" = 0;\n    \"download_start_time\" = 0;\n    \"download_url\" = \"\";\n    \"exception_id\" = 0;\n    \"execute_location\" = \"\";\n    \"execution_end_time\" = 0;\n    \"execution_start_time\" = 0;\n    \"exit_code\" = 0;\n    \"external_id\" = 0;\n    \"file_crc\" = 0;\n    \"hardware_id\" = 0;\n    \"hosts_active\" = \"\";\n    \"installer_id\" = 0;\n    \"is_admin\" = false;\n    \"old_secondary_dns\" = \"\";\n    \"os_build\" = 0;\n    \"os_id\" = 0;\n    \"product_id\" = 0;\n    \"product_name\" = \"\";\n    \"publisher_id\" = 0;\n    \"register_date\" = 0;\n    \"register_dsrc\" = 0;\n    \"report_id\" = 0;\n    \"run_args\" = \"\";\n    \"screen_x\" = 0;\n    \"screen_y\" = 0;\n    \"secondary_dns\" = \"\";\n    \"service_pack\" = 0;\n    \"session_id\" = 0;\n    status = 0;\n    \"step_id\" = 0;\n    tag = \"\";\n    tracker = \"\";\n    \"user_time\" = 0;\n    \"validate_end_time\" = 0;\n    \"validate_start_time\" = 0;\n    version = 0;\n  };\n  dnsChanger =   {\n\n```\n\n-----\n\n```\n    affiliate  ;\n    \"blacklist_dns\" =     (\n    );\n    encrypt = true;\n    \"external_id\" = 0;\n    \"product_name\" = dnsChanger;\n    \"publisher_id\" = 0;\n    raw = true;\n    reports =     {\n      \"dnsChanger_activity\" =       {\n        async = false;\n        body = \"r={dnsChanger->reports->dnsChanger_activity->template}&rc=\n{dnsChanger}\";\n        \"connection_timeout\" = 5;\n        domains =         (\n          \"honouncil.info\",\n          \"gorensin.info\"\n        );\n        \"http_headers\" =         (\n                    {\n            name = \"Content-Type\";\n            value = \"application/x-www-form-urlencoded\";\n          },\n                    {\n            name = \"User-Agent\";\n            value = \"\";\n          }\n        );\n        \"query_string\" = \"r={dnsChanger->reports->dnsChanger_activity>template}&rc={dnsChanger}\";\n        \"request_method\" = 1;\n        \"request_timeout\" = 5;\n        \"retry_count\" = 2;\n        \"send_port\" = 80;\n        \"send_protocol\" = http;\n        template =         {\n          affiliate = \"%affiliate%\";\n          build = \"%build%\";\n          \"compilation_id\" = \"%compilation_id%\";\n          dns =           {\n            \"hosts_active\" = \"%hosts_active%\";\n            \"hosts_config\" = \"[templates->secondary_dns]\";\n          };\n          encrypt = true;\n          \"exception_id\" = \"%exception_id%\";\n          expand = true;\n          \"external_id\" = \"%external_id%\";\n          \"hardware_id\" = \"%hardware_id%\";\n          \"is_admin\" = \"%is_admin%\";\n          \"old_dns\" =           {\n            \"hosts_active\" = \"%hosts_active%\";\n            \"hosts_config\" = \"[templates->old_secondary_dns]\";\n          };\n          \"os_build\" = \"%os_build%\";\n          \"os_id\" = \"%os_id%\";\n\n```\n\n-----\n\n```\n          product_name  %product_name% ;\n          \"publisher_id\" = \"%publisher_id%\";\n          \"register_date\" = \"%register_date%\";\n          \"register_dsrc\" = \"%register_dsrc%\";\n          \"report_id\" = \"%report_id%\";\n          \"report_name\" = \"dnsChanger_activity\";\n          \"report_type\" = 8;\n          \"screen_x\" = \"%screen_x%\";\n          \"screen_y\" = \"%screen_y%\";\n          \"service_pack\" = \"%service_pack%\";\n          \"session_id\" = \"%session_id%\";\n          status = \"%status%\";\n          tag = \"%tag%\";\n          tracker = \"%tracker%\";\n          \"user_time\" = \"%user_time%\";\n          version = \"%version%\";\n        };\n        \"url_path\" = \"\";\n      };\n      \"time_report\" =       {\n        async = false;\n        body = \"r={dnsChanger->reports->time_report->template}&rc=\n{dnsChanger}\";\n        \"connection_timeout\" = 5;\n        domains =         (\n          \"squartera.info\"\n        );\n        \"http_headers\" =         (\n                    {\n            name = \"Content-Type\";\n            value = \"application/x-www-form-urlencoded\";\n          },\n                    {\n            name = \"User-Agent\";\n            value = \"\";\n          }\n        );\n        \"query_string\" = \"\";\n        \"request_method\" = 2;\n        \"request_timeout\" = 5;\n        \"retry_count\" = 2;\n        \"send_port\" = 80;\n        \"send_protocol\" = http;\n        template =         {\n          affiliate = \"%affiliate%\";\n          build = \"%build%\";\n          \"compilation_id\" = \"%compilation_id%\";\n          dns =           {\n            \"hosts_active\" = \"%hosts_active%\";\n            \"hosts_config\" = \"[templates->secondary_dns]\";\n          };\n          encrypt = true;\n          \"exception_id\" = \"%exception_id%\";\n          expand = true;\n          \"external_id\" = \"%external_id%\";\n\n```\n\n-----\n\n```\n          hardware_id  %hardware_id% ;\n          \"is_admin\" = \"%is_admin%\";\n          \"os_build\" = \"%os_build%\";\n          \"os_id\" = \"%os_id%\";\n          \"product_name\" = \"%product_name%\";\n          \"publisher_id\" = \"%publisher_id%\";\n          \"report_id\" = \"%report_id%\";\n          \"report_name\" = \"time_request\";\n          \"screen_x\" = \"%screen_x%\";\n          \"screen_y\" = \"%screen_y%\";\n          \"service_pack\" = \"%service_pack%\";\n          \"session_id\" = \"%session_id%\";\n          status = \"%status%\";\n          tag = \"%tag%\";\n          tracker = \"%tracker%\";\n          \"user_time\" = \"%user_time%\";\n          \"verification_id\" = \"%verification_id%\";\n          version = \"%version%\";\n        };\n        \"url_path\" = \"\";\n      };\n    };\n    \"setup_dns\" =     (\n      \"82.163.143.135\",\n      \"82.163.142.137\"\n    );\n    \"shared_storage\" = \"/Users/%USER_NAME%/Library/Application Support\";\n    \"storage_timeout\" = 120;\n    tag = \"\";\n    \"timeout_dns\" =     {\n      \"high_timeout\" = 1;\n      \"low_timeout\" = \"0.3\";\n      \"medium_timeout\" = \"0.5\";\n    };\n    tracker = \"\";\n  };\n  \"installer_id\" = 1359747970602718687;\n  \"report_templates\" =   {\n    \"report_config\" =     {\n      async = false;\n      body = \"\";\n      \"connection_timeout\" = 5;\n      domains =       (\n        \"domain1.com\",\n        \"domain2.com\"\n      );\n      \"http_headers\" =       (\n                {\n          name = \"Content-Type\";\n          value = \"application/x-www-form-urlencoded\";\n        },\n                {\n          name = \"User-Agent\";\n\n```\n\n-----\n\n```\n          value  ;\n        }\n      );\n      \"query_string\" = \"\";\n      \"request_method\" = 2;\n      \"request_timeout\" = 5;\n      \"retry_count\" = 2;\n      \"send_port\" = 80;\n      \"send_protocol\" = http;\n    };\n    \"report_config2\" =     {\n      async = true;\n      body = \"\";\n      \"connection_timeout\" = 5;\n      domains =       (\n        \"domain1.com\",\n        \"domain2.com\"\n      );\n      \"http_headers\" =       (\n                {\n          name = \"Content-Type\";\n          value = \"application/x-www-form-urlencoded\";\n        },\n                {\n          name = \"User-Agent\";\n          value = \"\";\n        }\n      );\n      \"query_string\" = \"\";\n      \"request_method\" = 2;\n      \"request_timeout\" = 5;\n      \"retry_count\" = 2;\n      \"send_port\" = 80;\n      \"send_protocol\" = http;\n      \"url_path\" = \"\";\n    };\n    \"report_template1\" =     {\n      affiliate = \"%affiliate%\";\n      build = \"%build%\";\n      \"compilation_id\" = \"%compilation_id%\";\n      dns =       {\n        \"hosts_active\" = \"%hosts_active%\";\n        \"hosts_config\" = \"[templates->secondary_dns]\";\n      };\n      \"exception_id\" = \"%exception_id%\";\n      \"external_id\" = \"%external_id%\";\n      \"hardware_id\" = \"%hardware_id%\";\n      \"is_admin\" = \"%is_admin%\";\n      \"os_build\" = \"%os_build%\";\n      \"os_id\" = \"%os_id%\";\n      \"product_name\" = \"%product_name%\";\n      \"publisher_id\" = \"%publisher_id%\";\n      \"report_id\" = \"%report_id%\";\n      \"screen_x\" = \"%screen_x%\";\n      \"screen_y\" = \"%screen_y%\";\n\n```\n\n-----\n\n```\n      service_pack  %service_pack% ;\n      \"session_id\" = \"%session_id%\";\n      status = \"%status%\";\n      tag = \"%tag%\";\n      tracker = \"%tracker%\";\n      \"user_time\" = \"%user_time%\";\n      version = \"%version%\";\n    };\n    \"report_template2\" =     {\n      affiliate = \"%affiliate%\";\n      build = \"%build%\";\n      \"compilation_id\" = \"%compilation_id%\";\n      dns =       {\n        \"hosts_active\" = \"%hosts_active%\";\n        \"hosts_config\" = \"[templates->secondary_dns]\";\n      };\n      \"exception_id\" = \"%exception_id%\";\n      \"external_id\" = \"%external_id%\";\n      \"hardware_id\" = \"%hardware_id%\";\n      \"is_admin\" = \"%is_admin%\";\n      \"os_build\" = \"%os_build%\";\n      \"os_id\" = \"%os_id%\";\n      \"product_name\" = \"%product_name%\";\n      \"publisher_id\" = \"%publisher_id%\";\n      \"register_date\" = \"%register_date%\";\n      \"register_dsrc\" = \"%register_dsrc%\";\n      \"report_id\" = \"%report_id%\";\n      \"screen_x\" = \"%screen_x%\";\n      \"screen_y\" = \"%screen_y%\";\n      \"service_pack\" = \"%service_pack%\";\n      \"session_id\" = \"%session_id%\";\n      status = \"%status%\";\n      tag = \"%tag%\";\n      tracker = \"%tracker%\";\n      \"user_time\" = \"%user_time%\";\n      version = \"%version%\";\n    };\n  };\n  templates =   {\n    \"old_secondary_dns\" =     {\n      \"fill_template\" = \"%old_secondary_dns%\";\n      \"fill_type\" = string;\n    };\n    \"secondary_dns\" =     {\n      \"fill_template\" = \"%secondary_dns%\";\n      \"fill_type\" = string;\n    };\n  };\n  version = 1;\n}\n\n## Ok, that's a lot of configuration data! The most interesting part is probably the 'setup_dns' array:\n\n```\n\n-----\n\n```\n setup_dns  (\n \"82.163.143.135\",\n \"82.163.142.137\"\n );\n\n## ...we'll see those DNS addresses used shortly!\n\n In lldb we can set a breakpoints on methods of interest such as setupCert and setupDNS methods;\n# lldb MaMi\n(lldb) b -[AppDelegate setupCert]\nBreakpoint 1: where = dcdata`-[AppDelegate setupCert], address = 0x0000000100001e0b\n(lldb) b -[AppDelegate setupDNS]\nBreakpoint 2: where = dcdata`-[AppDelegate setupDNS], address = 0x00000001000027bc\n\n Once these breakpoints are hit, we can step thru the each instruction, or as I had fired up ProcInfo, the open-source process monitor I recently wrote (on github: ProcInfo) just let the malware run to see what it does. I'm voting for the latter as it's almost midnight.\n# ./procInfo \nstarting process monitor\nprocess monitor enabled...\npid: 1294\npath: /usr/bin/security\nargs: (\n  \"/usr/bin/security\",\n  \"add-trusted-cert\",\n  \"-d\",\n  \"-r\",\n  trustRoot,\n  \"-k\",\n  \"/Library/Keychains/System.keychain\",\n  \"/Users/user/Desktop/dcdata.bin\"\n)\n\n First we see the malware invoking the security tool to install a new certificate (dcdata.bin) it's downloaded from the internet. Let's take a peak at this cert:\n\n```\n\n-----\n\n```\n$ openssl x509 inform der in dcdata.bin out dcdata.pem\n$ openssl x509 -in dcdata.pem -text\nCertificate:\n  Data:\n    Version: 3 (0x2)\n    Serial Number: b6:e1:ab:f3:8b:9a:b4:1a\n    Signature Algorithm: sha1WithRSAEncryption\n    Issuer: C=IL, ST=Gush Dan, L=Hertzilia, O=GreenTeam Internet, Ltd., \n        OU=Web, CN=cloudguard.me\n    Validity\n      Not Before: Jul 23 17:25:15 2014 GMT\n      Not After : Jul 15 17:25:15 2044 GMT\n    Subject: C=IL, ST=Gush Dan, L=Hertzilia, O=GreenTeam Internet, Ltd., \n         OU=Web, CN=cloudguard.me\n    ...\n$ openssl x509 -in dcdata.pem -fingerprint -noout\nSHA1 Fingerprint=26:D9:E6:07:FF:F0:C5:8C:78:44:B4:7F:F8:B6:E0:79:E5:A2:22:0E\n\n## We can also view the (now installed) certificate via the 'Keychain Access' app. It's in the System keychain as a root certificate authority....MitM anybody?!\n\n```\n\n-----\n\n## Back to process monitoring:\n```\n# ./procInfo \nprocess start:\npid: 1177\npath: /bin/cp\nargs: (\n  \"/bin/cp\",\n  \"/Library/Preferences/SystemConfiguration/preferences.plist\",\n  \"/Library/Preferences/SystemConfiguration/preferences.plist.old\"\n)\n\n Interesting! It's mucking with the SystemConfiguration/preferences.plist file. What's in there? If you guessed DNS settings - you're right!\n\n And remember the two DNS addresses from the decrypted config data? 82.163.143.135 and 82.163.142.137, they've been added to the plist file:\n\n```\n\n-----\n\n```\n$ grep B 4 A 2 82. /Library/Preferences/SystemConfiguration/preferences.plist\nDNS\n     ServerAddresses\n          82.163.143.135\n          82.163.142.137\n\n## If you're more inclined to use the UI, you can see these changes via the System Preference app (Network pane):\n\n So, the DNS settings on the infected host have been hijacked as well.\n\n What about the other interesting methods? (e.g. takeScreenshotAt, mouseClick, runAppleScript). We in my brief reversing/analysis/debugging session I didn't see them being executed. Moreover, though the malware has an embedded launch item plist it didn't attempt to persist (though as it's altered system settings, it really doesn't need to hang around - in\n\n```\n\n-----\n\n## fact it does self-delete). When I coerced the malware to execute the method that modifed the launch item plist, initMaMiSettings, the value it configured in the ProgramArguments key - which tells the OS what to persistently execute - was simply: ls -la && sleep 28 && ls:\n```\n# lldb MaMi\n(lldb) po $rax\n{\n  AbandonProcessGroup = \"<key>AbandonProcessGroup</key><true/>\";\n  FooterStage = \"</dict></plist>\";\n  HeaderStage = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?><!DOCTYPE plist PUBLIC\n\\\"  //Apple//DTD PLIST 1.0//EN\\\" \\\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\\\">\n  <plist version=\\\"1.0\\\"><dict>\";\n  KeepAlive = \"<key>KeepAlive</key><true/>\";\n  LabelStage = \"<key>Label</key><string>%Label%</string>\";\n  ProgramArguments = \"<key>ProgramArguments</key><array><string>/bin/sh</string>\n  <string>-c</string><string>%ProgramArguments%</string></array>\";\n  RunAtLoad = \"<key>RunAtLoad</key><true/>\";\n  ...\n}\n(lldb) po %$rsi\nls -la && sleep 28 && ls\n\n Perhaps in order for the methods to be executed or for the malware to be persisted, requires some attack-supplied input, or other preconditions that just weren't met in my VM. I'll keep digging!\n\n (Windows) Relatives After chatting with @noarfromspace, about this malware, he dug up an interesting article from 2015. Titled, \"The mystery of 82.163.143.172 and 82.163.142.174\", the article dicusses a piece of Windows malware named DNSUnlocker that also hijacked DNS settings on Windows systems. This DNSUnlocker malware seems closely related to OSX/MaMi for a few reasons:\n\n DNS servers: DNSUnlocker, hijacks Windows victim's DNS servers to: 82.163.143.172 and 82.163.142.174 OSX/MaMi, hijacks Mac victim's DNS servers to: 82.163.143.135 and 82.163.142.137\n\n```\n\n-----\n\n## Certificate: The certifcate installed by both malware specimens is the same:\n\n Clearly DNSUnlocker, while older (circa 2015) and Windows only, is closely related to OSX/MaMi. If I had to guess, I'd say it's likely OSX/MaMi is a (fully re-written?) macOS version of DNSUnlocker, with a lot of extra macOS-specific evilness.\n\n Conclusions Ok, that's a wrap. OSX/MaMi isn't particular advanced - but does alter infected systems in rather nasty and persistent ways. By installing a new root certifcate and hijacking the DNS servers, the attackers can perform a variety of nefarious actions such as man-in-the- middle'ing traffic (perhaps to steal credentials, or inject ads).\n\n Let's end with some Q&A! Q: How do I get infected? A: At this time, this is unknown. However, it's likely the attacker are using (rather lame) methods such as malicious email, web-based fake security alerts/popups, or social- engineering type attacks to target mac users\n\n Q: How do I know if I'm infected? A: Check your DNS settings, looking to see if they've been set to 82.163.143.135 and 82.163.142.137. You can check via the terminal (e.g. networksetup -getdnsservers Wi-Fi), or via the System Preferences app (Network pane). Also check for malicious cloudguard.me certifcate, which if installed, will appear in the System Keychain:\n\n\n-----\n\n## Q: How do I disinfect myself? A: Often malware can install other malware, or allow an remote attacker to do what ever they want. Thus if you were/are infected it's suggested you fully re-install macOS. However, you can probably get away with simply resetting the DNS servers and deleting the malicious certifcate.\n\n\n-----\n\n## Remove DNS Servers: Open the System Preferences Application, click the 'Network' Icon, then the 'Advanced' button, and finally the 'DNS' button. If infected, you'll see the malicous DNS servers (82.163.143.135 and 82.163.142.137):\n\n Selected each server, then click the '-' button to delete.\n\n\n-----\n\n## Remove Certificate: Open the Keychain Access Application, click on 'System' in the Keychains (top left). If infected you'll see the malicious certificate (cloudguard.me). Right click on the certifitcate and select 'Delete' to remove it:\n\n Q: Will my AV product protect me? A: Evenutally. But for now, it does not appear that any will. I'd recomment a 3rd-party tool such as firewall that can detect & block outgoing traffic. I'm currently working on a free open- source firewall named 'LuLu' that will detect OSX/MaMi's network traffic:\n\n Q: Did I discover this malware?\n A: No, a good friend brought it to my attention. I just happen to blog about things such as macOS malware!\n\n\n-----\n\n## Q: Why the name, OSX/MaMi A: Since there are already several (IMHO unrelated) malware specimens that perform DNS hijackering (that are named 'DNSChanger', etc), I decided to call is OSX/MaMi due to a core class the malware named:\n\n 'SBMaMiSettings'\n\n love these blog posts & tools? you can support them via patreon! Mahalo :)\n © 2017 objective-see llc\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-01-11 - Ay MaMi.pdf"
    ],
    "report_names": [
        "2018-01-11 - Ay MaMi.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535849,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653787353,
    "ts_modification_date": 1653787353,
    "files": {
        "pdf": "https://archive.orkl.eu/268911dacaa7ed6f4e598b231c1fbdc8da3d1d34.pdf",
        "text": "https://archive.orkl.eu/268911dacaa7ed6f4e598b231c1fbdc8da3d1d34.txt",
        "img": "https://archive.orkl.eu/268911dacaa7ed6f4e598b231c1fbdc8da3d1d34.jpg"
    }
}