{
    "id": "6e2e3d47-02f8-4247-a98d-079ea11662ac",
    "created_at": "2023-01-12T15:04:45.449628Z",
    "updated_at": "2025-03-27T02:09:08.045994Z",
    "deleted_at": null,
    "sha1_hash": "4a42fb467dd34fb5a003a52ed0ba7414354c797a",
    "title": "2022-04-07 - Parrot TDS takes over web servers and threatens millions",
    "authors": "",
    "file_creation_date": "2022-05-28T17:01:35Z",
    "file_modification_date": "2022-05-28T17:01:35Z",
    "file_size": 966212,
    "plain_text": "# Parrot TDS takes over web servers and threatens millions\n\n**[decoded.avast.io/janrubin/parrot-tds-takes-over-web-servers-and-threatens-millions/](https://decoded.avast.io/janrubin/parrot-tds-takes-over-web-servers-and-threatens-millions/)**\n\nby [Pavel Novák and Jan RubínApril 7, 202211 min read](https://decoded.avast.io/janrubin/parrot-tds-takes-over-web-servers-and-threatens-millions/)\n\n## Campaign overview\n\n\nApril 7, 2022\n\n\nA new Traffic Direction System (TDS) we are calling Parrot TDS, using tens of thousands of compromised websites, has\nemerged in recent months and is reaching users from around the world. The TDS has infected various web servers hosting more\nthan 16,500 websites, ranging from adult content sites, personal websites, university sites, and local government sites.\n\nParrot TDS acts as a gateway for further malicious campaigns to reach potential victims. In this particular case, the infected\nsites’ appearances are altered by a campaign called FakeUpdate (also known as SocGholish), which uses JavaScript to display\nfake notices for users to update their browser, offering an update file for download. The file observed being delivered to victims is\na remote access tool.\n\n[The newly discovered TDS is, in some aspects, similar to the Prometheus TDS that appeared in the spring of 2021 [1]. However,](https://blog.group-ib.com/prometheus-tds)\nwhat makes Parrot TDS unique is its robustness and its huge reach, giving it the potential to infect millions of users. We\nidentified increased activity of the Parrot TDS in February 2022 by detecting suspicious JavaScript files on compromised web\nservers. We analysed its behaviour and identified several versions, as well as several types of campaigns using Parrot TDS.\nBased on the appearance of the first samples and the registration date of the Command and Control (C2) domains it uses,\nParrot TDS has been active since October 2021.\n\nOne of the main things that distinguishes Parrot TDS from other TDS is how widespread it is and how many potential victims it\nhas. The compromised websites we found appear to have nothing in common apart from servers hosting poorly secured CMS\nsites, like WordPress sites. From March 1, 2022 to March 29, 2022, we protected more than 600,000 unique users from around\nthe globe from visiting these infected sites. In this time frame, we protected the most users in Brazil, more than 73,000 unique\nusers, India, nearly 55,000 unique users, and more than 31,000 unique users from the US.\n\n\n-----\n\nMap illustrating the countries Parrot TDS has targeted (in March)\n\n## Compromised Websites\n\nIn February 2022, we identified a significant increase in the number of websites that contained malicious JavaScript code. This\ncode was appended to the end of almost all JavaScript on the compromised web servers we discovered. Over time, we identified\ntwo versions (proxied and direct) of what we are calling Parrot TDS.\n\nIn both cases, web servers with different content management systems (CMS) were compromised. Most often WordPress in\nvarious versions, including the latest one or Joomla, were affected. Since the compromised web servers have nothing in\ncommon, we assume the attackers took advantage of poorly secured servers, with weak login credentials, to gain admin access\nto the servers, but we do not have enough information to confirm this theory.\n\n## Proxied Version\n\nThe proxied version communicates with the TDS infrastructure via a malicious PHP script, usually located on the same web\nserver, and executes the response content. A deobfuscated code snippet of the proxied version is shown below.\n\n\n-----\n\nMalicious JavaScript Code\nThis code performs basic user filtering based on the User-Agent string, cookies and referrer. Briefly said, this code contacts the\nTDS only once for each user who visits the infected page. This type of filtering prevents multiple repeating requests and possible\nserver overload.\n\nThe aforementioned PHP script serves two purposes. The first is to extract client information like the IP address, referrer and\ncookies, forward the request from the victim to the Parrot TDS C2 server and send the response in the other direction.\n\nThe second functionality allows an attacker to perform arbitrary code execution on the web server by sending a specifically\ncrafted request, effectively creating a backdoor. The PHP script uses different names and is located in different locations, but\nusually, its name corresponds to the name of the folder it is in (hence the name of the TDS, since it parrots the names of folders).\n\nIn several cases, we also identified a traditional web shell on the infected web servers, which was located in various locations\nunder different names but still following the same “parroting” pattern. This web shell likely allowed the attacker more comfortable\naccess to the server, while the backdoor in the PHP script mentioned above was used as a backup option. An example of a web\nshell identified on one of the compromised web servers is shown below.\n\n\n-----\n\nTraditional web shell GUI\nSince we have seen several cases of reinfection, it is highly likely that the server automatically restores possibly deleted files\nusing, for example, a cron job. However, we do not have enough information to confirm this theory.\n\n## Direct Version\n\nThe direct version is almost identical to the previous one. This version utilises the same filtering technique. However, it sends the\nrequest directly to the TDS C2 server and, unlike the previous version, omits the malicious backdoor PHP script. It executes the\ncontent of the response the same way as the previous version. The whole communication sequence of both versions is depicted\nbelow. We experimentally verified that the TDS redirects from one IP address only once.\n\n\n-----\n\nInfection chain sequence diagram\n\n## Identified Campaigns\n\nThe Parrot TDS response is JavaScript code that is executed on the client. In general, this code can be arbitrary and exposes\nclients to further danger. However, in practice, we have seen only two types of responses. The first, shown below, is simply\nsetting the `__utma cookie on the client. This happens when the client should not be redirected to the landing page. Due to the`\ncookie-based user filtering mentioned above, this step effectively prevents repeated requests on Parrot TDS C2 servers in the\nfuture.\n\nBenign\n\nParrot TDS C2 Response\nThe next code snippet shows the second type, which is a campaign redirection targeting Windows machines.\n\n\n-----\n\nMalicious Parrot TDS C2 Response\n\n## FakeUpdate Campaign\n\nThe most prevalent “customer” of Parrot TDS we saw in the wild was the FakeUpdate campaign. The previous version of this\n[campaign was described by MalwareBytes Lab in 2018](https://blog.malwarebytes.com/threat-analysis/2018/04/fakeupdates-campaign-leverages-multiple-website-platforms/) [2]. Although the version we identified slightly differs from the 2018\nversion, the core remains the same. The user receives JavaScript that changes the appearance of the page and tries to force the\nuser to download malicious code. An example of what such a page looks like is shown below.\n\n\n-----\n\nFakeUpdate Campaign\nThis JavaScript also contains a Base64 encoded ZIP file with one malicious JavaScript file inside. Once the user downloads the\nZIP file and executes the JavaScript it contains, the code starts fingerprinting the client in several stages and then delivers the\nfinal payload.\n\n### User Filtering\n\nThe entire infection chain is set up so that it is complicated to replicate and, therefore, to investigate it. Parrot TDS provides the\nfirst layer of defence, which filters users based on IP address, User-Agent and referrer.\n\nThe FakeUpdate campaign provides the second layer of defence, using several mechanisms. The first is using unique URLs that\ndeliver malicious content to only one specific user.\n\nThe last defence mechanism is scanning the user’s PC. This scan is performed by several JavaScript codes sent by the\nFakeUpdate C2 server to the user. This scan harvests the following information.\n\nName of the PC\nUser name\nDomain name\nManufacturer\nModel\nBIOS version\nAntivirus and antispyware products\nMAC address\nList of processes\nOS version\n\nAn overview of the process is shown in the picture below. The first part represents the Parrot TDS filtering based on the IP\naddress, referrer and cookies, and after the user successfully passes these tests, the FakeUpdate page appears. The second\npart represents the FakeUpdate filtering based on a scan of the victim’s device.\n\n\n-----\n\nOverview of the filtering process\n\n### Final Payload\n\nThe final payload is then delivered in two phases. In the first phase, a PowerShell script is dropped and run by the malicious\nJavaScript code. This PowerShell script is downloaded to a temporary folder under a random eight character name (e.g.\n```\n%Temp%\\1c017f89.ps1 ). However, the name of this PowerShell is hardcoded in the JavaScript code. The content of this script\n\n```\nis usually a simple `whoami /all command. The result is sent back to the C2 server.`\n\nIn the second phase, the final payload is delivered. This payload is downloaded to the `AppData\\Roaming folder. Here, a folder`\n[with a random name containing several files is dropped. The payloads we have observed so far are part of the NetSupport Client](https://www.netsupportsoftware.com/)\nremote access tool and allow the attacker to gain easy access to the compromised machines [3].\n\nThe RAT is commonly named `ctfmon.exe (mimicking the name of a legitimate program). It is also automatically started when`\nthe computer is switched on by setting an `HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run registry key.`\n\nNetSupport mimicking the\n\nname of a legitimate Microsoft service\n\nNetSupport Client Installed on the compromised machine\n\nThe installed NetSupport Manager tool is configured so that the user has very little chance of noticing it and, at the same time,\ngives the attacker maximum opportunities. The tool basically gives the attacker full access to the victim’s machine. To run\nunnoticed chat functions are disabled and the silent option is set on the tool for example A gateway is also set up that allows\n\n\n-----\n\nthe attacker to connect to the client from anywhere in the world. So far, we ve seen Chinese domains in the tool s configuration\nfiles used as gateways. The following picture below shows the client settings.\n\nNetSupport Client Settings\n\n## Phishing\n\nWe identified several infected servers hosting phishing sites. These phishing sites, imitating, for example, a Microsoft office login\npage, were hosted on compromised servers in the form of PHP scripts. The figure below shows the aforementioned Microsoft\nphishing observed on an otherwise legitimate site. We don’t have enough information to assign this to Parrot TDS directly.\nHowever, a significant number of the compromised servers contained phishing as well.\n\nMicrosoft Phishing hosted on the compromised web server\n\n## Conclusion and Recommendation\n\nWe have identified an extensive infrastructure of compromised web servers that served as TDS and put a large number of users\nat risk. Given that the attacker had almost unlimited access to tens of thousands of web servers, the above list of campaigns is\nundoubtedly not exhaustive.\n\n\n-----\n\nThe Avast Threat Labs has several recommendations for developers to avoid their servers from being compromised.\n\nScan all files on the web server with Avast Antivirus.\nReplace all JavaScript and PHP files on the web server with original ones.\nUse the latest CMS version.\nUse the latest versions of installed plugins.\nCheck for automatically running tasks on the web server (for example, cron jobs).\nCheck and set up secure credentials. Make sure to always use unique credentials for every service.\nCheck the administrator accounts on the server. Make sure each of them belongs to you and have strong passwords.\nWhen applicable, set up 2FA for all the web server admin accounts.\n[Use some of the available security plugins (WordPress,](https://wordpress.org/plugins/tags/security/) [Joomla).](https://extensions.joomla.org/category/access-a-security/site-security/)\n\n## Indicators of Compromise (IoC)\n\nRepository: [https://github.com/avast/ioc/tree/master/ParrotTDS](https://github.com/avast/ioc/tree/master/ParrotTDS)\n\n## Parrot TDS\n\n**SHA256** **Description**\n\ne22e88c8ec0f439eebbb6387eeea0d332f57c137ae85cf1d8d1bb4c7ea8bd2f2 Proxied version JavaScript\n\ndaabdec3d5a43bb1c0340451be466d9f90eaa0cfac92fb6beaabc59452c473c3 Direct version JavaScript\n\nb63260c1f213c02fcbb5c1a069ab2f1d17031e598fd19673bb639aa7557a9bae web shell\n\nOn demand * PHP Backdoor\n```\n* In attempts to prevent further attacks onto the infected servers, we are providing this hash on demand. Please DM us on\n\n```\n[Twitter or reach us out at](https://twitter.com/AvastThreatLabs) [ti@avast.com.](http://10.10.0.46/mailto:ti@avast.com)\n\n**C&C Servers**\n\nclickstat360[.]com\n\nstatclick[.]net\n\nstaticvisit[.]net\n\nwebcachespace[.]net\n\nsyncadv[.]com\n\nwebcachestorage[.]com\n\n## FakeUpdate\n\n**SHA256** **Description**\n\n0046fad95da901f398f800ece8af479573a08ebf8db9529851172ead01648faa FakeUpdate JavaScript\n\n15afd9eb66450b440d154e98ed82971f1b968323ff11b839b046ae4bec60f855 FakeUpdate appearance JavaScript\n\n**C&C Servers**\n\nparmsplace[.]com ahrealestatepr[.]com expresswayautopr[.]com\n\nxomosagency[.]com codigodebarra[.]co craigconnors[.]com\n\nlawrencetravelco[.]com maxxcorp[.]net 2ctmedia[.]com\n\naccountablitypartner[.]com walmyrivera[.]com youbyashboutique[.]com\n\nweightlossihp[.]com codingbit[.]co[.]in fishslayerjigco[.]com\n\n\n-----\n\navanzatechnicalsolutions[.]com srkpc[.]com wholesalerandy[.]com\n\nmattingsolutions[.]co integrativehealthpartners[.]com wwpcrisis[.]com\n\nlilscrambler[.]com markbrey[.]com nuwealthmedia[.]com\n\npocketstay[.]com fioressence[.]com drpease[.]com\n\nrefinedwebs[.]com spillpalletonline[.]com altcoinfan[.]com\n\nwindsorbongvape[.]com hill-family[.]us 109.234.35[.]249\n\n141.136.35[.]157 91.219.236[.]192 * 91.219.236[.]202 *\n```\n* Delivering the final payload\n\n## NetSupport RAT\n\n```\n**SHA256** **Filename**\n\nb6b51f4273420c24ea7dc13ef4cc7615262ccbdf6f5e5a49dae604ec153055ad %AppData%/Roaming/ xxx /ctfmon.exe **\n\n8ad9c598c1fde52dd2bfced5f953ca0d013b0c65feb5ded73585cfc420c95a95 %AppData%/Roaming/ xxx /remcmdstub.exe\n\n4fffa055d56e48fa0c469a54e2ebd857f23eca73a9928805b6a29a9483dffc21 %AppData%/Roaming/ xxx /client32.ini **\n```\n**xxx stands for the random string name\n\n```\n**C&C**\n\n194.180.158[.]173\n\n87.120.8[.]141\n\n15.76.172[.]110\n\n45.76.172[.]113\n\n5.180.136[.]119\n\n94.158.247[.]84\n\n94.158.245[.]113\n\n94.158.247[.]100\n\n154.38.242[.]14\n\n199.247.3[.]55\n\n## Resources\n\n[1] Viktor Okorokov and Nikita Rostovcev. Prometheus TDS, Group IB, 5 Aug. 2021, [https://blog.group-ib.com/prometheus-tds.](https://blog.group-ib.com/prometheus-tds)\n\n[2] Jérôme Segura. FakeUpdates Campaign Leverages Multiple Website Platforms, MalwareBytes Labs, 10 Apr. 2018,\n[https://blog.malwarebytes.com/threat-analysis/2018/04/fakeupdates-campaign-leverages-multiple-website-platforms/.](https://blog.malwarebytes.com/threat-analysis/2018/04/fakeupdates-campaign-leverages-multiple-website-platforms/)\n\n[3] NetSupport Software. [https://www.netsupportsoftware.com/.](https://www.netsupportsoftware.com/)\n\n[Tagged asanalysis,](https://decoded.avast.io/tag/analysis/) [backdoor,](https://decoded.avast.io/tag/backdoor/) [malware,](https://decoded.avast.io/tag/malware/) [tds,](https://decoded.avast.io/tag/tds/) [webshell](https://decoded.avast.io/tag/webshell/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-07 - Parrot TDS takes over web servers and threatens millions.pdf"
    ],
    "report_names": [
        "2022-04-07 - Parrot TDS takes over web servers and threatens millions.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535885,
    "ts_updated_at": 1743041348,
    "ts_creation_date": 1653757295,
    "ts_modification_date": 1653757295,
    "files": {
        "pdf": "https://archive.orkl.eu/4a42fb467dd34fb5a003a52ed0ba7414354c797a.pdf",
        "text": "https://archive.orkl.eu/4a42fb467dd34fb5a003a52ed0ba7414354c797a.txt",
        "img": "https://archive.orkl.eu/4a42fb467dd34fb5a003a52ed0ba7414354c797a.jpg"
    }
}