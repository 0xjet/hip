{
    "id": "5ac6fec2-638f-4560-a269-a81b17a80e50",
    "created_at": "2023-01-12T15:03:40.929747Z",
    "updated_at": "2025-03-27T02:14:42.872679Z",
    "deleted_at": null,
    "sha1_hash": "b1a68175b4db5e24e8596260ed4777ed5b6beef8",
    "title": "2021-04-18 - Recover your files with StrongPity",
    "authors": "",
    "file_creation_date": "2022-05-28T18:23:33Z",
    "file_modification_date": "2022-05-28T18:23:33Z",
    "file_size": 1633928,
    "plain_text": "# Recover your files with StrongPity\n\n**[anchorednarratives.substack.com/p/recover-your-files-with-strongpity](https://anchorednarratives.substack.com/p/recover-your-files-with-strongpity)**\n\nRJM\n\n### A case study of a multi-year nation-state cyber surveillance campaign\n\n[RJM](https://substack.com/profile/23714532-rjm)\nApr 18, 2021\n\n**Disclaimer: The views, methods, and opinions expressed at Anchored Narratives are those**\nof the author and do not necessarily reflect the official policy or position of my employer.\n\nCover: StrongPity APT Actor hides the backdoor in legitimate “recovery” software.\n\n## Introduction\n\nFirst, a warm welcome to the new subscribers of the Anchored Narratives mailing list. For the\nones who are new to the list, I regularly pick an exciting tweet that matched my intelligence\nrequirements and generated anchored stories on geopolitical (cyber) threats, digital\nforensics, and crime from that. Usually, I pick a story that I have no real in-depth or prior\n\n\n-----\n\nknowledge about. The goal is to understand a particular topic better, improve my\ninvestigation or writing skills, and generate a reliable story anchored with evidence. This time\nthe story will start with a tweet that matched my intelligence requirements on 15 March 2021:\n```\n\"#apt #strongpity new sample hunted md5:95ff679f525c44e4abac8e61f8052ca5 c2：\ntransferprotocolpolicy.com\"\n\n```\nThe information in the tweet tells people with interest in this field that someone found a\nmalicious malware sample with a unique value “95ff679f525c44e4abac8e61f8052ca5”from\nan Advanced Persistent Threat actor group called StrongPity. APT is an industry name for\nreferring to states involved in cyber operations. The referred malware sample communicates\nto its command and control server “transferprotocolpolicy.com” (c2) for further instructions.\nThis tweet triggered some personal interest to start a deep dive into this nation-state actor\ngroup. They have been around for many years, deploy interesting tactics at scale, and are\nobserved in geopolitical disputes. This article will outline the background of this alleged\nTurkish nation-state actor or nation-state-sponsored group. Furthermore, the malicious\nbackdoor will be reversed briefly and based on that intelligence to hunt for additional\nindicators, and finally, the article will end with some observations and a conclusion. Let’s go.\n\n## Background StrongPity\n\nThe StrongPity actor group has been around since 2012 and employs the same tactics,\nnamely adding backdoors to legitimate software used by specific users. Some call this\ntechnique water holing. The group is also referred to as APT-C-41 and PROMETHIUM. In\n_2016 StrongPity was detected by_ [Kaspersky in a campaign that targeted specific users in](https://securelist.com/on-the-strongpity-waterhole-attacks-targeting-italian-and-belgian-encryption-users/76147/)\nBelgium and Italy who were interested in Truecrypt and Winrar software. The software\npackages are used by niche user groups interested in solid encryption. The actor group set\nup a domain name that mimicked the official WinRAR distribution site and placed links to the\ntrojanized WinRAR installer on a certified distributor website. In the same year, [Microsoft](https://www.microsoft.com/security/blog/2016/12/14/twin-zero-day-attacks-promethium-and-neodymium-target-individuals-in-europe/)\nobserved a campaign by the same group targeting specific users with a zero-day\nvulnerability in Adobe Flash. The zero-day exploit was tracked as CVE-2016-4117. In 2017\n[ESET published research where they detected StrongPity while tracking the FinFisher group](https://www.welivesecurity.com/2017/12/08/strongpity-like-spyware-replaces-finfisher/)\nand an Internet Service Provider's involvement. Their analysis revealed that users were\nredirected to trojanized software packages. Some of the targeted software were the following\nsoftware packages.\n\n```\nCCleaner v 5.34\n\n```\n```\nDriver Booster\n\n```\n```\nThe Opera Browser\n\n```\n```\nSkype\n\n```\n```\nThe VLC Media Player v2.2.6 (32bit)\n\n```\n\n-----\n\n```\nWinRAR 5.50\n\n```\n\nIn their research, ESET states that an exfiltration component in the StrongPity backdoor\ncollects files with the following extensions:\n\n.ppt,.pptx,.xls,.xlsx,.txt,.doc,.docx,.pdf,.rtf\n\nThe stolen files are sent to a central server operated by the StrongPity actor, and the\nbackdoor waits for further instructions.\n\nBy 2018 _[Citizenlab found several so-called deep packet inspection devices in Türk Telekom's](https://citizenlab.ca/2018/03/bad-traffic-sandvines-packetlogic-devices-deploy-government-spyware-turkey-syria/)_\n[network where users were redirected to download trojanized installers Avast Antivirus,](https://www.avast.com/)\n[CCleaner,](https://www.ccleaner.com/) [Opera, and](http://www.opera.com/) [7-Zip. The surveillance was set up so that users who searched for](http://www.7-zip.org/)\nofficial downloads on the authorized vendor websites were silently redirected to the\ntrojanized versions of Avast, CCleaner etcetera. Citizenlab referred to the malware as\nStrongPity, which was used after they stopped using FinFisher spyware. FinFisher was sold\nto governments as a lawful interception capability. Citizenlab also described that these\ninjection techniques were also observed by other nation-states, China (Great Cannon) and\nthe US (NSA’s QUANTUM).\n\nIn June 2020, _[Bitdefender published research where StrongPity employed similar tactics to](https://www.bitdefender.com/files/News/CaseStudies/study/353/Bitdefender-Whitepaper-StrongPity-APT.pdf)_\ninfect victims in Turkey and Syria selectively. According to Bitdefender, the group was\nspecifically interested in the Kurdish community giving it a geopolitical angle.\n\nFigure 1: Figure adopted from the BitDefender report. Victims were concentrated in the area\nof Turkey and Syria.\nIn their investigation, Bitdefender found trojanized versions of the following software:\n\n\n-----\n\n```\n7-ZIP\n\n```\n```\nWinRAR\n\n```\n```\nMcAfee Security Scan Plus\n\n```\n```\nFile recovery application - Recuva\n\n```\n```\nTeamViewer\n\n```\n```\nWhatsApp\n\n```\n```\nCCleaner\n\n```\n```\nCleverFiles Disk Drill\n\n```\n```\nDAEMON Tools Lite\n\n```\n\nThey also found a particular tag used as authentication and is influenced by the file's\ncompilation time. These tags could look like something like “v11_kt26“ for example. To me,\nthese tags resemble campaign identifiers used by actors to distinguish between different\ntargets. The researchers from Bitdefender added a tremendous amount of StrongPity\nsamples in their report indicating an extensive campaign.\n\n[Researchers from Cyble released a report in December 2020 that the StrongPity actors](https://cybleinc.com/2020/12/31/strongpity-apt-extends-global-reach-with-new-infrastructure/)\nexpanded their global reach and included mass phishing e-mail campaigns. According to\ntheir research, victims were now widespread across Europe, Nothern Africa, Canada, and\nAsia. Cyble discovered that the victim was targeted through a trojanized version of the\nPartition Find and Mount software utility. Their analysis refers to a screenshot (figure 6) that\nshould demonstrate the decryption routines and decrypted payloads in the process memory.\nEspecially those screenshots are blurred and not readable. After that, they report that the\nmalware creates a mutex1 with a particular name (figure 7) and then how the malware\nconnects to a specific domain in a debugger (figure 8). It remains unclear how the mutex's\nname is generated and where and how the command and control information is stored from\ntheir research. The claim of mass phishing attacks is not substantiated by e-mail samples in\ntheir report. Their released StrongPity indicators already contain the\n“transferprotocolpolicy[.]com” as a command and control server that matched the starting\ntweet, which matched my intelligence requirements in March 2021.\n\nIn 2021 _[LMNTRIX released research into what they call “the Turkish APT group APT-C-41](https://lmntrix.com/lab/promethium-strongpity-apt-c-41-an-element-no-match-for-lmntrix/)_\n_(aka StrongPity and Promethium)”. They claim that the group targets Financial organizations,_\nIndustrial plants, and Educational institutes after installing a backdoor on its victims. Their\nresearch provides some screenshots of a disassembly tool in which they state that the\nmalware has so-called anti-debugging functionality enabled (IsDebuggerPresent check).\n\n\n-----\n\nThey further state: _After bypassing these functions, we found the command and control_\n_domain embedded into the code. The snapshot shows the communication happens to the_\n_malicious domain, which we highlighted below [mailtransfersagents(dot)com]:”_\n\nThe malware samples referenced in their research are indeed StrongPity samples. Based on\nthe screenshots LMNTRIX provided, I could not observe the command and control domain\nembedded in the provided snapshots.\n\nBoth reports of Cyble and LMNTRIX triggered me to dive into some reversing of the\nbackdoor functionality to determine how the StrongPity backdoor stores its configuration, as\nthis was not clear to me from their analysis. Let’s start with the sample that triggered my\nintelligence requirements in the first place.\n\n## Reversing the StrongPity backdoor\n\nTable 1: Checksums of the StrongPity backdoor that will be investigated.\nThe StrongPity backdoor is installed via trojanized installations of legitimate and popular\nsoftware products. The extensive research of Citizenlab indicates that a Telecom provider in\nTurkey was involved in the redirection to the trojanized downloads to its victims.\n\nWhat is not clear to me is how the configuration data is stored in the malware. To understand\nhow that data is stored, I will follow the regular malware reversing process. You start with\nstatic analysis. What information can you get out of the malware sample without executing it?\nIf things are not evident by then, you can also execute the malware in a sandbox or run it in a\nso-called debugger. For readability, I will only focus on the main findings.\n\n## Static analysis\n\nUsually, you’ll start looking at which ‘strings’ (text) are present in the malware sample.\nAnalyzing strings in binary files is an essential aspect of malware analysis. This technique\nprovides valuable information about the program’s use and its functionality. Usually, string\n[output is used to develop Yara signatures. Yara is a tool to identify and classify malware](https://virustotal.github.io/yara/)\nfamilies. Unique strings, constants, or byte patterns are used in the so-called Yara signatures\nto find more samples. Usually, these signatures hold indicators of compromise, like filenames\nor specific user agents observed in the malware samples. Malware authors generally\nleverage obfuscation or encryption techniques to hide their secrets that they need to store in\nthe binary. They will also employ anti-debugging tricks to hinder automated analysis. To\nleverage the Windows operating system's functionalities, malware authors often rely on\nstandard Windows Application Programming Interfaces (API) for their backdoors to interact\nwith the system. Usually, these APIs are seen in the ‘strings’ output, but malware authors can\n\n\n-----\n\nalso hide this. In the StrongPity sample, many of these APIs were observed, like\n_CreateMutexW, CreateProcessW, WinHttpConnect, and IsDebuggerPresent. The regular_\n‘strings‘ command on Linux revealed no domain information, however.\n\nTo determine if the StrongPity malware authors employed an obfuscation technique called\n[stack strings, the ‘floss’ program was used. That revealed the following information:](https://www.fireeye.com/blog/threat-research/2016/06/automatically-extracting-obfuscated-strings.html)\n\nScreenshot 1: Floss\n\ndetected stack strings in the StrongPity backdoor\nThe extracted information reveals file names (winmsism.exe. sppser.exe), but also “ndaData“\nthe directory where the malware collects its information before sending it to the operators,\naccording to the reports. Other than those indicators, I have highlighted some suspicious\nstring patterns. By briefly assessing this output, it looks like this is the config information\nstored in the StrongPity backdoor. But we need to a bit more digging, and I will use a free\n[open source disassembly tool called Cutter for that. A decompiler is a program that analyzes](https://cutter.re/)\nexecutable programs and tries to create a high-level representation of the machine code\nfrom it. Cutter has a feature to decompile an executable program to reconstruct the source\ncode. This feature helps to understand the analyst's flow and how the malware program calls\n\n\n-----\n\ncertain functions or routines. By decompiling the main function of the StrongPity malware, it\nbecomes immediately apparent how the file names and the mutex observed in the floss\nstack strings output are being passed to the relevant functions.\n\nScreenshot 2: String put on the stack passed onto the CreateMutexW function\nSo the mutex created from the stack strings in the StrongPity backdoor can be seen in\nscreenshot 2.\n\nScreenshot 3: File names that were put on the stack that was detected by floss\nThe file names are also created from the stack-based strings values.\n\nIn screenshot 3 the function with the name fcn.0040106a(); is executed. That function leads\n[to two so-called byte encoding algorithms by leveraging a single-byte XOR operation with](https://en.wikipedia.org/wiki/XOR_gate)\n0x59 and 0x2b. Malware authors often use XOR as this algorithm obfuscates data easily.\nXOR is a bitwise operation If you XOR something twice with the same key this will result in\n\n\n-----\n\nthe original value. In the example below, the capital character A will be XOR ed with the\nXOR Key “B”. The output data of the XOR operation is a non-printable character (NP). If we\nthen XOR that value with the original XOR key “B” we have the original value back.\n```\nInput data = 'A' = 01000001\n XOR Key  = 'B' = 01000010\nOutput data (NP) = 00000011\n XOR Key  = 'B' = 01000010\nOutput data = 'A' = 01000001\n\n```\nAs shown in the example above, these operations can result in unreadable information as\nnon-printable characters are not printed or detected by the ‘strings’ or ‘floss’ utilities. Let’s\ncontinue with the analysis.\n\nScreenshot 4:\n\nStrings put on the stack are xor’ed with 0x59\nThe XOR operation with the 0x59 byte values will eventually decode the encoded stack\nstrings to the first domain and URL, namely\n_“hxxps://transferprotocolpolicy.com/parse_ini_file.php\" The XOR operation with the 0x2b byte_\nvalues finally results in the following domain and URL after decoding\n_“hxxps://transferprotocolpolicy.com/phpinfo.php\"_\n\n## Dynamic analysis\n\n[So after the static analysis, the StrongPity sample was executed in x64dbg on my isolated](https://x64dbg.com/)\nvirtual machine for some dynamic confirmation of the initial findings. By setting a breakpoint\non the CreateMutexW and GetTempPathW API functions, the StrongPity backdoor reveals\nthe creation of the same mutex and later on deobfuscation of the domains and URL used by\nthe StrongPity actors. I will briefly describe the findings with some screenshots below.\n\n\n-----\n\nScreenshot 5:CreateMutex creation based on the stack strings floss output\n\nScreenshot 6: Encoded stack strings stored in memory (dump) before first XOR (0x59)\nroutine\nScreenshot 6 displays the stack strings (partially) found by floss, encoding the domain name.\n\nScreenshot 7: Decoded stacked strings stored in memory (dump) after XOR (0x59) routine\n\n\n-----\n\nScreenshot 8: StrongPity backdoor immediately collects data found on the compromised\nsystem\nAfter installing the StrongPity backdoor on my virtual machine, the backdoor immediately\nstarts gathering files based on a certain extension and temporarily stores it in a compressed\nfile “config.bin” before it wants to send it to the command and control server. Some content is\ndisplayed in screenshot 8. Bonus question for reversers. Who recognizes the pdf file?\n\n### Malware analysis recap\n\nAfter assessing the StrongPity backdoor with floss, it immediately became clear that many\nbackdoor configuration items are stored in stack strings in the binary, like mutex, directory,\nfile names, and domain information. Potentially to evade normal detection. By leveraging the\npower of the decompilation feature of the Cutter reverse engineer platform, the single-byte\nxor obfuscation algorithms were quickly detected.\n\nStrongPity backdoors are good candidates for Yara rules as the backdoors contain many\nstrings, constants, and byte patterns that can be leveraged in Yara rules. Over time the actor\nbehind the StrongPity backdoor makes small updates to the backdoor.\n\n## Hunting for more StrongPity samples\n\nBased upon the intelligence gathered by other security companies and by leveraging the\npower of VirusTotal Intelligence (VTI), you can really start hunting on this adversary. VTI has\na great feature called the search for similar samples like these. With that search, the\nsamples below were found. One additional remark, this great publication platform does not\nsupport tables, hence the screenshots. If you’re interested in the malware samples, feel free\nto reach out.\n\n\n-----\n\nScreenshot 9: Similar malware samples found via VTI.\nBased on additional Twitter intelligence and using the same functionality, some newer\nsamples were discovered.\n\nScreenshot 10: Newer samples of the StrongPity backdoor were found.\nAs was discussed in the background of the StrongPity paragraph the alleged Turkish nationstate actor leverages popular software. The sample with the value\n_“dfd0f4b821438d8a9277728e42ab58bdc2667aa7173892ffd6ede75a5d5645f5” was installed_\nvia a trojanized version of Partition and Mount which was uploaded in Korea. That trojanized\nversion can be downloaded from VT as well with the following sha256 checksum:\n“0e4651625abda88df56952b7e97d7fb64a3e1ea97bfe01e931d47381c0952e98”\n\n\n-----\n\nScreenshot 11: The Trojanized version of Partition and Mount.\n\n## Conclusion\n\nBased on industry intelligence reports and my own brief malware analysis, it becomes clear\nthat the alleged Turkish nation-state actor StrongPity is likely running a massive and multiyear data collection program and is apparently successful. Citizenlabs and Bitdefender\nreported strong indications of Turkish nation-state involvement. The backdoor received small\nupdates periodically, and the collection infrastructure has been improved over time. The\nactor was initially focusing on the Middle Eastern region. The actor is now also focusing on\nEurope, Asia, and Canada. The claims of massive phishing campaigns by Cyble were not\nsubstantiated by evidence in their report. The same holds for LMNTR, who claimed that\nStrongPity targeted Financial organizations, Industrial plants, and Educational organizations\nafter compromising victims' computers. It could be that LMNTR found detections originating\nfrom those organizations after some employees downloaded this trojanized software. Still,\ntheir research does not explain how compromised victims attacked the referred companies. It\nwould be very interesting if the StrongPity actors are utilizing compromised victim machines\nin their attacks. Also, the malware research of both Cyble and LMNTR was not very detailed\nor sometimes blurred out to agree with that research.\n\nOverall, the StrongPity backdoor is well detected by the anti-virus industry. This assumes\nthat the actor is less successful in company networks and is more focused on citizens. This\ntriggered a thought. Do the victims of the StrongPity actor have a working anti-virus solution?\nI sometimes support friends and family with computer issues but rarely detect a working antivirus solution on their private computer. Based upon the minimal updates in the modus\noperandi and sophistication of this actor, I suspect not. The method that the actor employs is\n\n\n-----\n\na nice one. Who is not downloading these targeted tools sometimes? Under the above\nconditions, why would a victim know they are downloading a trojanized version of a certain\nutility. What worries me a bit is the massive amount of data collection and processing\ninfrastructure that the actor needs to maintain. Based on samples uploaded in VT, I assume\nthat large amounts of data are uploaded into their operated infrastructure. The data collected\nneeds to be processed as well to make it actionable. I wonder what kind of data lake the\nStrongPity actors have. For next time watch out when you want to recover some files and\ninstall StrongPity on your system.\n\n1\nA mutex is usally genererated by malware creators to avoid infection of a system by\ndifferent instances of the same malware. On Windows a mutex can be created by the\nWindow Application Programmer Interface (API) function CreateMutexW\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-18 - Recover your files with StrongPity.pdf"
    ],
    "report_names": [
        "2021-04-18 - Recover your files with StrongPity.pdf"
    ],
    "threat_actors": [
        {
            "id": "27485543-d2e7-4053-a660-157489732cbb",
            "created_at": "2022-10-25T16:07:23.895403Z",
            "updated_at": "2025-03-27T02:02:10.018168Z",
            "deleted_at": null,
            "main_name": "Neodymium",
            "aliases": [],
            "source_name": "ETDA:Neodymium",
            "tools": [
                "Wingbird"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "67fbc7d7-ba8e-4258-b53c-9a5d755e1960",
            "created_at": "2022-10-25T16:07:24.077859Z",
            "updated_at": "2025-03-27T02:02:10.101173Z",
            "deleted_at": null,
            "main_name": "Promethium",
            "aliases": [
                "APT-C-41",
                "Promethium",
                "StrongPity"
            ],
            "source_name": "ETDA:Promethium",
            "tools": [
                "StrongPity",
                "StrongPity2",
                "StrongPity3",
                "Truvasys"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "400a3efc-44a1-4d83-a724-cd16818328f9",
            "created_at": "2023-01-06T13:46:38.516115Z",
            "updated_at": "2025-03-27T02:00:02.853085Z",
            "deleted_at": null,
            "main_name": "NEODYMIUM",
            "aliases": [
                "G0055"
            ],
            "source_name": "MISPGALAXY:NEODYMIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "cbede712-4cc3-47c6-bf78-92fd9f1beac6",
            "created_at": "2022-10-25T15:50:23.777222Z",
            "updated_at": "2025-03-27T02:00:55.544919Z",
            "deleted_at": null,
            "main_name": "PROMETHIUM",
            "aliases": [
                "PROMETHIUM",
                "StrongPity"
            ],
            "source_name": "MITRE:PROMETHIUM",
            "tools": [
                "Truvasys",
                "StrongPity"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "c11cbeb5-461f-4bd8-a86b-f57e471a664d",
            "created_at": "2022-10-25T15:50:23.257383Z",
            "updated_at": "2025-03-27T02:00:55.409898Z",
            "deleted_at": null,
            "main_name": "NEODYMIUM",
            "aliases": [
                "NEODYMIUM"
            ],
            "source_name": "MITRE:NEODYMIUM",
            "tools": [
                "Wingbird"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4660477f-333f-4a18-b49b-0b4d7c66d482",
            "created_at": "2023-01-06T13:46:38.511962Z",
            "updated_at": "2025-03-27T02:00:02.852307Z",
            "deleted_at": null,
            "main_name": "PROMETHIUM",
            "aliases": [
                "StrongPity",
                "G0056"
            ],
            "source_name": "MISPGALAXY:PROMETHIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535820,
    "ts_updated_at": 1743041682,
    "ts_creation_date": 1653762213,
    "ts_modification_date": 1653762213,
    "files": {
        "pdf": "https://archive.orkl.eu/b1a68175b4db5e24e8596260ed4777ed5b6beef8.pdf",
        "text": "https://archive.orkl.eu/b1a68175b4db5e24e8596260ed4777ed5b6beef8.txt",
        "img": "https://archive.orkl.eu/b1a68175b4db5e24e8596260ed4777ed5b6beef8.jpg"
    }
}