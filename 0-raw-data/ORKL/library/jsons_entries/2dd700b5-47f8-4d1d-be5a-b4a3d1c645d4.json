{
    "id": "2dd700b5-47f8-4d1d-be5a-b4a3d1c645d4",
    "created_at": "2023-01-12T14:58:53.298689Z",
    "updated_at": "2025-03-27T02:05:56.057964Z",
    "deleted_at": null,
    "sha1_hash": "4833ea9f7390036ee8cfee7e0ca15f4038c00421",
    "title": "2020-04-14 - Deobfuscating and hunting for OSTAP, Trickbot’s dropper and best friend",
    "authors": "",
    "file_creation_date": "2022-05-27T21:32:20Z",
    "file_modification_date": "2022-05-27T21:32:20Z",
    "file_size": 604943,
    "plain_text": "# Deobfuscating and hunting for OSTAP, Trickbot’s dropper and best friend\n\n**intrinsec.com/deobfuscating-hunting-ostap/**\n\nEquipe CERT April 14, 2020\n\nDuring a recent investigation dealing with ransomware attack, CERT Intrinsec faced\nOSTAP loader. This loader is used to deliver other malwares (such as Trickbot) on an\ninfected system. It uses high obfuscation techniques to prevent the code from being read\nand to bypass detection processes.\n\nObfuscated loader\n\n_Figure 1 : Extract of the loader code (Javascript)_\n\nThe ostap loader (Figure 1) we analysed was about 10 000 lines long. We started the static\n**analysis by going through the code by hand to understand its structure. We identified a key**\npart of the code that helped us to deobfuscate the loader (Figure 2).\n\n\n-----\n\n_Figure 2 : Key part of the loader code_\n\nThe instructions, on Figure 2, aim at executing String.fromCharCode function ewnfBeth8\nparameter. There are lots of noise instructions in the program. For example,\n**ppfhair_3(ewnfBeth8) instruction in try statement will never be triggered because the**\nfunction does not exist. It is done on purpose to always enter the catch. Besides, etvulike2\nparameter is always equal to ‘f’. A large part of the program consists of a concatenation of\nfunctions such as the one shown on Figure 3.\n\n_Figure 3 : Repeated function model_\n\nThe action of the function above (Figure 3) is to apply String.fromCharCode to 69, i.e. « E ».\n**The program uses this method to set all its instructions. Knowing that, we decided to**\nwrite a script to extract each obfuscated character.\n\nDeobfuscation script\n\n\n-----\n\nThe main goal of the script is to get indicators of compromise from the loader. It has\nbeen developed using Node JS. It first goes through the obfuscated loader, retrieves the\ntargeted numbers and apply String.fromCharCode to decode them. Then, it collects the\nindicators of compromise in the decoded payload using regular expressions. Extracted IOCs\nare IPs, URLs and User-Agents. The figure below represents the output of the script using a\nsample hunted on VirusTotal. We can see, at the top of Figure 4, a list of file extensions that\nare targeted (their content will be replaced by the Ostap JS code).\n\n_Figure 4 : Script execution output_\n\n## Hunting\n\nAfter deobfuscating the loader as a part of our investigation, we decided to hunt recent\n**and similar files on VirusTotal, using searches on static code patterns (content:**\n_“‘String’)[‘slice’]”, for instance). We found lots of samples (Figure 5) and process them so as_\nto extract as many IOCs as possible.\n\n_Figure 5 : Ostap samples from VirusTotal_\n\n\n-----\n\nWe collected about 140 samples from VirusTotal using the script. We analysed them and\nextracted the indicators of compromise presented in the table below. We can say that at least\none of the IP addresses (185[.]234[.]73[.]125) is related to the Trickbot campaign\n**happening since the Coronavirus appeared such as in Italy, as reported by Sophos (1).**\n\n**IP** **URL** **User-Agent**\n\n\n141[.]98[.]214[.]14\n\n185[.]159[.]82[.]205\n\n185[.]216[.]35[.]10\n\n185[.]234[.]73[.]125\n\n194[.]87[.]96[.]100\n\n45[.]128[.]133[.]41\n\n91[.]196[.]70[.]126\n\nReferences\n\n\nhxxps[://]141[.]98[.]214[.]14/6BcsTO/AGVV5r[.]php\n\nhxxps[://]185[.]159[.]82[.]205/2/1[.]php\n\nhxxps[://]185[.]216[.]35[.]10/VYut68/L2KSUN[.]php\n\nhxxps[://]185[.]234[.]73[.]125/wMB03o/Wx9u79[.]php\n\nhxxps[://]194[.]87[.]96[.]100/2/1[.]php\n\nhxxp[://]45[.]128[.]133[.]41/jTlp8P/3OXkud[.]php\n\nhxxps[://]91[.]196[.]70[.]126/2/zsQX9M[.]php\n\n\nMozilla/5.0\n\n(Windows NT\n6.; Win64;\nx64;\nTrident/7.0;\nrv:11.0) like\nGecko\n\n\n1. https://news.sophos.com/en-us/2020/03/04/trickbot-campaign-targets-coronavirus\nfears-in-italy/\n[2. https://www.esentire.com/blog/oh-snap-new-ostap-variant-observed-in-the-wild](https://www.esentire.com/blog/oh-snap-new-ostap-variant-observed-in-the-wild)\n[3. https://www.bromium.com/deobfuscating-ostap-trickbots-javascript-downloader/](https://www.bromium.com/deobfuscating-ostap-trickbots-javascript-downloader/)\n4. https://blog.trendmicro.com/trendlabs-security-intelligence/latest-trickbot-campaign\ndelivered-via-highly-obfuscated-js-file/\n[5. https://github.com/cryptogramfan/Malware-Analysis-Scripts](https://github.com/cryptogramfan/Malware-Analysis-Scripts)\n[6. https://www.cert.pl/en/news/single/ostap-malware-analysis-backswap-dropper/](https://www.cert.pl/en/news/single/ostap-malware-analysis-backswap-dropper/)\n7. Link to the script on Intrinsec Github :\n\n[https://github.com/Intrinsec/CERT/tree/master/Scripts/ostap_deobfuscator](https://github.com/Intrinsec/CERT/tree/master/Scripts/ostap_deobfuscator)\n\n**Want to learn more about our Computer Emergency Response Team (CERT) ?**\n\n[Discover](https://intrinsec.com/cert-intrinsec)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-04-14 - Deobfuscating and hunting for OSTAP, Trickbot’s dropper and best friend.pdf"
    ],
    "report_names": [
        "2020-04-14 - Deobfuscating and hunting for OSTAP, Trickbot’s dropper and best friend.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535533,
    "ts_updated_at": 1743041156,
    "ts_creation_date": 1653687140,
    "ts_modification_date": 1653687140,
    "files": {
        "pdf": "https://archive.orkl.eu/4833ea9f7390036ee8cfee7e0ca15f4038c00421.pdf",
        "text": "https://archive.orkl.eu/4833ea9f7390036ee8cfee7e0ca15f4038c00421.txt",
        "img": "https://archive.orkl.eu/4833ea9f7390036ee8cfee7e0ca15f4038c00421.jpg"
    }
}