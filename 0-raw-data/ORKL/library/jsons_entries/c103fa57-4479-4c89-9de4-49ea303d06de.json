{
    "id": "c103fa57-4479-4c89-9de4-49ea303d06de",
    "created_at": "2023-01-12T15:01:49.102763Z",
    "updated_at": "2025-03-27T02:12:51.752371Z",
    "deleted_at": null,
    "sha1_hash": "c6d3550251b6c5e8a4094d0df5989f125a44a35d",
    "title": "2022-04-29 - Attack Graph Response to UNC1151 Continued Targeting of Ukraine",
    "authors": "",
    "file_creation_date": "2022-05-28T02:16:01Z",
    "file_modification_date": "2022-05-28T02:16:01Z",
    "file_size": 299945,
    "plain_text": "# Attack Graph Response to UNC1151 Continued Targeting of Ukraine\n\n**[attackiq.com/2022/04/29/attack-graph-response-to-unc1151-continued-targeting-of-ukraine/](https://attackiq.com/2022/04/29/attack-graph-response-to-unc1151-continued-targeting-of-ukraine/)**\n\nApril 29, 2022\n\nSince the beginning of the Russian invasion of Ukraine at the end of February 2022, there\nhas been a substantial increase in cyberattacks against Ukrainian targets by groups closely\n[aligned with Russian state interests. Uncover new](https://securityaffairs.co/wordpress/126800/apt/unc1151-apt-ukraine.html) [attacks from a threat actor likely](https://securityaffairs.co/wordpress/128397/apt/belarusian-unc1151-targets-ukraine.html)\n[operating out of Belarus known as UNC1151 or Ghostwriter. The threat actor was first](https://www.mandiant.com/resources/unc1151-linked-to-belarus-government)\n[identified in July 2020 by FireEye who identified attacks aligned to Russian security interests](https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/Ghostwriter-Influence-Campaign.pdf)\ninvolving Lithuania, Latvia, and Poland going back to July 2016.\n\nIn March 2020 the Ghostwriter campaign began targeting Ukraine with the actor primarily\nengaged in credential harvesting and malware campaigns delivering HALFSHELL. A recent\nreport from [Cluster25 identified a as they began to leverage the open-source tool](https://cluster25.io/2022/03/08/ghostwriter-unc1151-adopts-microbackdoor-variants-in-cyber-operations-against-targets-in-ukraine/)\n[MicroBackdoor for command and control operations prior to Russia’s invasion of Ukraine.](https://github.com/Cr4sh/MicroBackdoor)\n\nTo protect our customers from these threats, AttackIQ has released an attack graph\nemulating newly observed behaviors and an additional larger atomic assessment covering\nUNC1151’s historical tool, techniques, and procedures. Customers can use these templates\nto validate their security program performance against this adversary.\n\n\n-----\n\n[Click for larger view.](https://attackiq.com/wp-content/uploads/2022/04/unc1151-microbackdoor-attack-graph-scaled.jpeg)\n\n**UNC1151 – 2022-03 – MicroBackdoor Campaign – this attack graph linearly emulates a**\nrealistic attack, starting from the adversary’s initial persistence and leading towards the\nultimate goal of data exfiltration. Specifically, the attack graph takes the following steps:\n\n**Scenario 1: Registry Run Keys / Startup Folder** [(T1547.001): After the initial delivery of a](https://attack.mitre.org/techniques/T1547/001/)\nmalicious Microsoft Compressed HTML Help (CHM) file, a Visual Basic script creates a\nshortcut (LNK) file in the Startup folder for all users. Placing an executable or shortcut file in\nthat directory will cause the file to be launched when a user logs in to the system.\n\n**1a. Detection Process**\n\nUsing a SIEM or EDR Platform to see modifications to the Run and RunOnce keys will alert\nwhen unauthorized users or software makes modifications to\n\n```\n“HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\Run”\n\n```\n```\nProcess name: reg.exe\nCommand Line Contains (“ADD” AND “Microsoft\\Windows\\CurrentVersion\\Run” AND\n“/V”)\nOptionally you can include a search for users NOT IN to lower the chance of\nfalse positives.\n\n```\n**1b. Mitigation Policies**\n\nThis type of attack technique cannot be easily mitigated with preventive controls since it is\nbased on the abuse of system features. For best protection, ensure group policy is set to\nonly allow specific users with need to utilize reg.exe as well as have anti-virus enabled to\nstatically and dynamically scan files for possible malicious use of the registry\n\n**Scenario 2: Signed Binary Proxy Execution: Regsvcs / Regasm** [(T1218.009): The next](https://attack.mitre.org/techniques/T1218/009/)\nstep is loading a malicious Dynamic-Link Library (DLL) by abusing the Assembly Registration\nTool (Regasm) to proxy execution of code through a trusted Windows utility. This tool is\ndigitally signed by Microsoft and allows the actor to bypass code signing restrictions.\n\n**2a. Detection Process**\n\nAlthough this attack uses living off the land binaries, searching your EDR or SIEM for the\nfollowing suspicious process activity can give great visibility to possible malicious use of\nregasm.exe and regsvcs.exe:\n```\nParent Process Name == (cmd.exe OR powershell.exe)\nParent Process Command Line CONTAINS “.bat”\nProcess Name == (Regasm.exe OR Regsvcs.exe)\nProcess Command Line CONTAINS (“temp” OR “tmp”) AND “ dll”\n\n```\n\n-----\n\nThe above query will see if a command line interpreter of some sort is running a batch file to\nrun regasm.exe or regsvcs.exe with command line parameters indicating a .dll execution\nlocated in a writable temp folder. This is a specific detection and removing temp command\nline parameters as well as parent process and command line details will widen the window of\ndetection possibilities, yet produce larger amounts of false positives.\n\n**2b. Mitigation Policies**\nUtilizing Group Policy or Application Whitelisting Software, ensure that only authorized and\nexpected users are able to run command line interpreters such as cmd.exe and Powershell,\nas well as .dll services such as regasm.exe and regsvcs.exe.\n\n**Scenario 3: Deobfuscate / Decode Files or Information** [(T1140): The threat actor uses](https://attack.mitre.org/techniques/T1140/)\nvarious techniques to obfuscate their scripts and malware to make static analysis difficult.\nOne of the methods leveraged by UNC1151 is to use the Windows “certutil“ application’s\nbuilt-in functionality to decode base64 encoded files.\n\n**3a. Detection Process**\nAlthough this attack uses living off the land binaries, searching your EDR or SIEM for the\nfollowing suspicious process activity can give great visibility to possible malicious use of\ncertutil.exe:\n```\nProcess Name == Certutil.exe\nCommand Line CONTAINS “-decode” AND “.exe”\n\n```\n**3b. Mitigation Policies**\nUtilizing Group Policy or Application Whitelisting Software, ensure that only authorized and\nexpected users are able to run command line interpreters such as cmd.exe and Powershell,\nas well as certutil.exe which can not only be used for this decode technique, but file\ntransferring as well.\n\n**Scenario 4: Ingress Tool Transfer** [(T1105): The MicroBackdoor](https://attack.mitre.org/techniques/T1105/) [sample used in this attack](https://www.virustotal.com/gui/file/e97f1d6ec1aa3f7c7973d57074d1d623833f0e9b1c1e53f81af92c057a1fdd72)\nis downloaded and written to disk. This scenario is testing the effectiveness of the AV\ncontrols in your network and endpoint tools.\n\n**4a. Detection Process**\nMalicious Downloading of files is often done by living off the land binaries such as\nCertutil.exe and Powershell.exe. Below are some detections for each method of\ndownloading:\n\n**Powershell download:**\n```\nProcess Name == Powershell.exe\nCommand Line CONTAINS (“DownloadData” AND Hidden”)\n\n```\n\n-----\n\n**Certutil Download:**\n```\nProcess Name == Certutil.exe\nCommand Line CONTAINS (“-urlcache AND -f”)\n\n```\n**4b. Mitigation Policies**\nUtilizing Group Policy or Application Whitelisting Software, ensure that only authorized and\nexpected users are able to run command line interpreters such as cmd.exe and Powershell,\nas well as certutil.exe.\n\n**Scenario 5: Process Discovery** [(T1057): The attack graph then engages in discovery](https://attack.mitre.org/techniques/T1057/)\ntechniques using the native Windows commands “tasklist” to collect what processes are\nrunning. This data is then sent to the actor’s command-and-control server.\n\n**5a. Detection Process**\nUsing an EDR or SIEM product, use the following parameters for identifying possible\nenumeration of system processes:\n```\nProcess Name == (“cmd.exe” OR “powershell.exe”)\nCommand Line CONTAINS (“Tasklist” AND “/FO”)\nUser = [<list of expected administrators to be issuing these commands>]\n\n```\n**5b. Mitigation Policies**\nEnsure application whitelisting is in place to allow only permitted users/administrators the\nright to run utility binaries such as cmd.exe, powershell.exe, tasklist.exe, and WMIC.exe.\n\n**Scenario 6: System Information Discovery** [(T1082): In this step, the actor seeks to obtain](https://attack.mitre.org/techniques/T1082/)\nsystem information through execution of the “systeminfo” command, the results are collected\nfor later exfiltration.\n\n**6a. Detection Process**\nAlthough commands such as “systeminfo” are utilized as administrators frequently, there\nshould still be alerts in place when unexpected users are running these commands as they\ncould be a sign of possible user enumeration and system discovery.\n\nWith an EDR, if possible, look for the following details:\n```\nProcess Name == (cmd.exe OR powershell.exe)\nCommand Line CONTAINS (“systeminfo”)\nUser != [<list of expected administrators to be issuing these commands>]\n\n```\n**6b. Mitigation Policies**\nEnsure that Group Policy enforces only authorized users / administrators to be able to run\ncmd.exe or powershell.exe. These interpreters can be limited to lower privileged or\nunneeded users to prevent enumeration or abuse.\n\n\n-----\n\n**Scenario 7: Screen Capture** [(T1113): MicroBackdoor has the capability to take screen shots](https://attack.mitre.org/techniques/T1113/)\nof the active user’s desktop. This scenario emulates the behavior by executing a PowerShell\nscript that uses a native Windows library, “System.Drawing”, to make a copy of the screen.\n\n**7a. Detection Process**\n```\nProcess Name == Powershell.exe\nCommand Line CONTAINS (“Graphics.CopyFromScreen” OR “System.Drawing”)\n\n```\n**7b. Mitigation Policies**\nUtilizing Group Policy or Application Whitelisting Software, ensure that only authorized and\nexpected users are able to run command line interpreters such as cmd.exe and Powershell\n\n**Scenario 8: System Network Configuration Discovery** [(T1016): The threat actor uses](https://attack.mitre.org/techniques/T1016/)\nvarious Window’s utilities to identify information about the infected host’s network. The\nfollowing commands are executed and information collected:\n\nRouting information: `route print`\nIP information: `ipconfig /all`\nConnected Domain Controller: `nltest /DSGETDC:`\nNetwork Shares: `net use`\nARP information: `arp -a`\n\n**8a. Detection Process**\nUsing an EDR or SIEM tool, you can monitor usage of windows network discovery tools.\nKeep in mind, these are binaries used rather frequently. We strongly recommend querying\nthese commands with an “exclude user” option to limit false positives if that option is\navailable in your EDR/SIEM product.\n```\nProcess Name == (“cmd.exe” OR “powershell.exe”)\nCommand Line CONTAINS (“route print” OR “ipconfig /all” OR “nltest /DSGETDC”\nOR “net use” OR “arp -a”)\nUser NOT IN [<list of expected administrators to be issuing these commands>]\n\n```\n**8b. Mitigation Policies**\nEnsure application whitelisting is in place to allow only permitted users/administrators the\nright to run utility binaries such as cmd.exe, powershell.exe, route.exe, ipconfig.exe,\nnltest.exe, net.exe, and arp.exe. Although some of these may be used on a day-to-day basis,\nonly authorized users should have the right to run these executables to prevent misuse.\n\n**Scenario 9: Exfiltrate Files over C2 Channel** [(T1041): Finally, the last step is the](https://attack.mitre.org/techniques/T1041/)\nexfiltration of system files over HTTP.\n\n**8b. Mitigation Policies**\nEnsure any Data Loss Prevention (DLP) products, or network products that monitor\nexfiltration of data are set with policies to alert on sensitive/large file exfiltration. Rules in\n\n\n-----\n\nplace to look for anomalies for data size transfers and file types are smart ways for\nidentifying exfiltration.\n\n**UNC1151 – Intrusion Set – This atomic assessment template focuses on emulating all**\nTactics, Techniques, and Procedures (TTPs) used by the adversary since at least 2016. This\ntemplate is the result of combining multiple reports on the adversary and their respective\ncampaigns.\n\nThe template contains multiple scenarios organized into the following tactics:\n\n**Initial Access: The adversary specializes in carrying out phishing attacks by using**\nattachments, either Office documents with embedded VBA macros acting as\ndownloaders or compressed archive files.\n**Persistence: UNC1151 has been observed using both Registry Run keys and shortcut**\nfiles in the Startup directory order to establish persistence on the compromised system.\n**Defense Evasion: Various techniques have been observed in order to evade the**\nsystem’s defense, such as masquerading as legitimate software, information encoding,\nand abuse of Regasm utility to bypass security controls.\n**Discovery: The threat actor performs multiple reconnaissance techniques on the**\nvictim’s host and network to ensure the proper target has been infiltrated.\n**Collection: The malware utilized by adversary has been observed using additional**\nmodules to collect keystrokes and screenshots for the purpose of harvesting\ncredentials.\n**Command and Control: The adversary has typically leveraged the HTTP protocol to**\ncarry out communications between its infrastructure and the compromised systems.\nWithin this tactic are scenarios that download and save the MicroBackdoor,\nHALFSHELL, and SunSeed malware families.\n\nIn summary, the combination of this attack graph and atomic assessment will evaluate\nsecurity and incident response processes and support the improvement of your security\ncontrol posture against this threat actor and others who leverage similar techniques. With\ndata generated from continuous testing and use of this attack graph, you can focus your\nteams on achieving key security outcomes, adjust your security controls, and work to elevate\nyour total security program effectiveness against a known and dangerous threat. For further\ninformation about how to use attack graphs and the AttackIQ Security Optimization Platform\nto improve your security program performance, please see our recent CISO’s Guide to\n_Attack Graphs and MITRE ATT&CK._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-29 - Attack Graph Response to UNC1151 Continued Targeting of Ukraine.pdf"
    ],
    "report_names": [
        "2022-04-29 - Attack Graph Response to UNC1151 Continued Targeting of Ukraine.pdf"
    ],
    "threat_actors": [
        {
            "id": "8a33d3ac-14ba-441c-92c1-39975e9e1a73",
            "created_at": "2023-01-06T13:46:39.195689Z",
            "updated_at": "2025-03-27T02:00:03.01861Z",
            "deleted_at": null,
            "main_name": "Ghostwriter",
            "aliases": [
                "PUSHCHA",
                "Storm-0257",
                "DEV-0257",
                "UAC-0057",
                "UNC1151",
                "TA445"
            ],
            "source_name": "MISPGALAXY:Ghostwriter",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "119c8bea-816e-4799-942b-ff375026671e",
            "created_at": "2022-10-25T16:07:23.957309Z",
            "updated_at": "2025-03-27T02:02:10.048343Z",
            "deleted_at": null,
            "main_name": "Operation Ghostwriter",
            "aliases": [
                "DEV-0257",
                "Operation Asylum Ambuscade",
                "PUSHCHA",
                "Storm-0257",
                "TA445",
                "UAC-0051",
                "UAC-0057",
                "UNC1151"
            ],
            "source_name": "ETDA:Operation Ghostwriter",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "HALFSHELL",
                "Impacket",
                "RADIOSTAR",
                "VIDEOKILLER",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f53f4b13-b055-426f-876a-18cf9a0f4fa0",
            "created_at": "2024-05-01T02:03:08.129377Z",
            "updated_at": "2025-03-27T02:05:17.412789Z",
            "deleted_at": null,
            "main_name": "MOONSCAPE",
            "aliases": [
                "UAC-0051 ",
                "UNC1151 ",
                "TA445 "
            ],
            "source_name": "Secureworks:MOONSCAPE",
            "tools": [
                ""
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535709,
    "ts_updated_at": 1743041571,
    "ts_creation_date": 1653704161,
    "ts_modification_date": 1653704161,
    "files": {
        "pdf": "https://archive.orkl.eu/c6d3550251b6c5e8a4094d0df5989f125a44a35d.pdf",
        "text": "https://archive.orkl.eu/c6d3550251b6c5e8a4094d0df5989f125a44a35d.txt",
        "img": "https://archive.orkl.eu/c6d3550251b6c5e8a4094d0df5989f125a44a35d.jpg"
    }
}