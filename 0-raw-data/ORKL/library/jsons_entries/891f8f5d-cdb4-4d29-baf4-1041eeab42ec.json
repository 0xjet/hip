{
    "id": "891f8f5d-cdb4-4d29-baf4-1041eeab42ec",
    "created_at": "2023-01-12T15:09:38.670287Z",
    "updated_at": "2025-03-27T02:16:28.80907Z",
    "deleted_at": null,
    "sha1_hash": "bf7a1a755e315d95fe565e46a4572ce3970049cf",
    "title": "2022-05-09 - Hiding in Plain Sight- Obscuring C2s by Abusing CDN Services",
    "authors": "",
    "file_creation_date": "2022-05-28T23:27:08Z",
    "file_modification_date": "2022-05-28T23:27:08Z",
    "file_size": 2062047,
    "plain_text": "# Hiding in Plain Sight: Obscuring C2s by Abusing CDN Services\n\n**[teamt5.org/en/posts/hiding-in-plain-sight-obscuring-c2s-by-abusing-cdn-services](https://teamt5.org/en/posts/hiding-in-plain-sight-obscuring-c2s-by-abusing-cdn-services)**\n\nCyber Threat Intelligence\n\nThreat Intelligence\n\nRSS\n5.10.2022Cyber Threat Intelligence\n\nShare:\nCobalt Strike is a well-established red-teaming toolkit that was specifically designed to create\nfeature-rich backdoors in the matter of seconds. However, ever since its inception, the tool\nhas been heavily abused by threat actors all over the world (e.g., Polaris/MustangPanda,\nAPT32/OceanLotus, cybercriminals, etc.) The popularity of Cobalt Strike is primarily due to\nhow powerful its built-in payload generators are, its flexibility in deploying the Beacon to the\ntarget machine(s) - and most notably - its ability to disguise the payload traffic in the target\nnetwork.\n\n\n-----\n\nOver the last year or so, more and more beacons relying on third-party services as their\nproxy are being found in the wild. Since the use of these third-party CDNs can allow\nanonymized C2 and enhance its detection evasion, numerous APTs have also begun using\nthese services. In the following sections, we will go through some of the techniques used by\nthese threat actors to see how one could easily set up these misused configurations.\n\n## Serverless Functions\n\nOther techniques that threat groups have been employing also include the use of third-party\nservices such as Cloudflare Workers. With the use of serverless services, it is possible to\nsetup what is essentially a free reverse proxy to a Cobalt Strike endpoint. When set up\nproperly, these services can provide an additional layer of protection, as looking up the\ndomain will only yield the service’s IP instead of the origin server.\n\nSince these services are often set up with sub-domains that the threat actor could freely set\nup without purchasing a real domain, they could also be set to a somewhat convincing fake\ndomain. In this example, the C2 was set to `route.moffice365.workers.dev to make the`\ntraffic look somewhat related to Microsoft services.\n\n\n-----\n\nThe nature of these serverless functions makes it extremely difficult to attribute the origins of\nor identify the threat actors. Since the serverless code is only stored on Cloudflare, and its\nexecution is done on Cloudflare’s servers, there is not a feasible way to identify the C2\ninfrastructures.\n\n## Domain Fronting via CDN\n\n\n-----\n\nDomain fronting is a technique that attempts to disguise the traffic by smuggling data to a\nwell-known service or domain. In other words, similar to the previous technique, domain\nfronting cannot be feasibly blocked without disrupting services and or examining the inner\nrequest. HelpSystems, the company behind Cobalt Strike, had actually done a write-up of\nCobalt Strike domain fronting using CloudFront in 2017[1].\n\nEssentially, certain websites employ CDNs like CloudFront to deliver assets on their\nwebsites. Under normal circumstances, the `Host header determines where the request`\nshould go - and this header is assigned by the website. However, we can also abuse this\n“feature” and make our beacon visit a certain domain with a specified Host header that goes\nto our CDN instead of the standard CDN that the website uses. With HTTPS, this request\nwould be extremely difficult or impossible for the IT admin to block, as the request itself is\nencrypted, and on the surface, it would look like the user is simply visiting a reputable site.\n\n## Domain Fronting with a Non-existent Domain\n\nThe following technique, however, does something slightly different. Some time ago last\nyear, we detected a rather peculiar looking Cobalt Strike payload where its C2 address was\nset to `pypi.python.org . Obviously the actor couldn’t have possibly obtained the rights to`\nthe domain owned by the Python Foundation, and the chance of them pwning the service is\nalso little to none.\n\n\n-----\n\nSo what gives? It turns out the secret lies within the service that operates the sub-domain\nand the HTTP header specified in the beacon. The Python Foundation uses Fastly for most\nof its services. Fastly uses the `Host header specified within the request to decide which`\nservice to redirect the request to internally. For example, if I were to create a service on\nFastly named `dl-python.org, and the` `Host header is set to` `dl-python.org in the`\nbeacon, Fastly would then forward the request to the service named as such.\n\nNote the difference between this methodology against the previous domain fronting\ntechnique - the `Host header may give a false impression that the C2 is being pointed`\ntowards `dl-python.org . In reality, it is being resolved as` `dl-`\n```\npython.org.global.prod.fastly.net when going through Fastly’s services. The service\n\n```\nthen internally forwards the request to `my-c2domain.com as configured by the threat actor.`\nThis trick may lure threat investigators into investigating a completely different domain that\nmay or may not be relevant to the incident.\n\n## Conclusion\n\n\n-----\n\nIn this post, we have covered three ways that threat actors can abuse Cobalt Strike s\nflexibility in payload communication: misuse of serverless functions and various abuses of\nCDN domain fronting. The resilience of Cobalt Strike is something that is beloved (or\ndespised) by many because of this very reason. It is clear that the red-teaming toolkit is not\ngoing anywhere anytime soon as more and more creative strategies are discovered and\nemployed.\n\n## References\n\n[1] Mudge, R. (2017, February 6). High-reputation Redirectors and Domain Fronting—Cobalt\nStrike Research and Development. ➔ [link](https://www.cobaltstrike.com/blog/high-reputation-redirectors-and-domain-fronting/)\n[*Image courtesy of Pexels](https://www.pexels.com/)\nShare:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-05-09 - Hiding in Plain Sight- Obscuring C2s by Abusing CDN Services.pdf"
    ],
    "report_names": [
        "2022-05-09 - Hiding in Plain Sight- Obscuring C2s by Abusing CDN Services.pdf"
    ],
    "threat_actors": [
        {
            "id": "77b28afd-8187-4917-a453-1d5a279cb5e4",
            "created_at": "2022-10-25T15:50:23.768278Z",
            "updated_at": "2025-03-27T02:00:55.5423Z",
            "deleted_at": null,
            "main_name": "Inception",
            "aliases": [
                "Inception Framework",
                "Cloud Atlas"
            ],
            "source_name": "MITRE:Inception",
            "tools": [
                "PowerShower",
                "VBShower",
                "LaZagne"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "870f6f62-84f5-48ca-a18e-cf2902cd6924",
            "created_at": "2022-10-25T15:50:23.303818Z",
            "updated_at": "2025-03-27T02:00:55.435309Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "APT32",
                "SeaLotus",
                "OceanLotus",
                "APT-C-00",
                "Canvas Cyclone"
            ],
            "source_name": "MITRE:APT32",
            "tools": [
                "Mimikatz",
                "ipconfig",
                "Kerrdown",
                "Cobalt Strike",
                "SOUNDBITE",
                "OSX_OCEANLOTUS.D",
                "KOMPROGO",
                "netsh",
                "RotaJakiro",
                "PHOREAL",
                "Arp",
                "Denis",
                "Goopy"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "af509bbb-8d18-4903-a9bd-9e94099c6b30",
            "created_at": "2023-01-06T13:46:38.585525Z",
            "updated_at": "2025-03-27T02:00:02.866727Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "TIN WOODLAWN",
                "OceanLotus Group",
                "OceanLotus",
                "Sea Lotus",
                "G0050",
                "Cobalt Kitty",
                "SeaLotus",
                "ATK17",
                "Ocean Lotus",
                "Ocean Buffalo",
                "POND LOACH",
                "Canvas Cyclone",
                "APT-C-00",
                "APT-32",
                "APT 32"
            ],
            "source_name": "MISPGALAXY:APT32",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f1518ac1-4710-4dd1-a422-e3801e4806cb",
            "created_at": "2024-05-01T02:03:08.147856Z",
            "updated_at": "2025-03-27T02:05:17.421275Z",
            "deleted_at": null,
            "main_name": "TIN WOODLAWN",
            "aliases": [
                "Cobalt Kitty",
                "OceanLotus",
                "WOODLAWN ",
                "APT32 "
            ],
            "source_name": "Secureworks:TIN WOODLAWN",
            "tools": [
                " Denis",
                " Goopy",
                " JEShell",
                " KerrDown",
                " Mimikatz",
                " Ratsnif",
                " Remy",
                " Rizzo",
                " RolandRAT",
                "Cobalt Strike"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b69037ec-2605-4de4-bb32-a20d780a8406",
            "created_at": "2023-01-06T13:46:38.790766Z",
            "updated_at": "2025-03-27T02:00:02.919758Z",
            "deleted_at": null,
            "main_name": "MUSTANG PANDA",
            "aliases": [
                "TEMP.HEX",
                "TA416",
                "TANTALUM",
                "Twill Typhoon",
                "Earth Preta",
                "Stately Taurus",
                "LuminousMoth",
                "Polaris",
                "BRONZE PRESIDENT",
                "HoneyMyte",
                "Red Lich"
            ],
            "source_name": "MISPGALAXY:MUSTANG PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9baa7519-772a-4862-b412-6f0463691b89",
            "created_at": "2022-10-25T15:50:23.354429Z",
            "updated_at": "2025-03-27T02:00:55.45162Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Mustang Panda",
                "TA416",
                "RedDelta",
                "BRONZE PRESIDENT"
            ],
            "source_name": "MITRE:Mustang Panda",
            "tools": [
                "Cobalt Strike",
                "RCSession",
                "NBTscan",
                "PoisonIvy",
                "PlugX"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2439ad53-39cc-4fff-8fdf-4028d65803c0",
            "created_at": "2022-10-25T16:07:23.353204Z",
            "updated_at": "2025-03-27T02:02:09.749502Z",
            "deleted_at": null,
            "main_name": "APT 32",
            "aliases": [
                "APT 32",
                "APT-C-00",
                "APT-LY-100",
                "ATK 17",
                "Lotus Bane",
                "Ocean Buffalo",
                "OceanLotus",
                "Operation Cobalt Kitty",
                "Operation PhantomLance",
                "Pond Loach",
                "SeaLotus",
                "SectorF01",
                "Tin Woodlawn"
            ],
            "source_name": "ETDA:APT 32",
            "tools": [
                "Agentemis",
                "Android.Backdoor.736.origin",
                "AtNow",
                "Backdoor.MacOS.OCEANLOTUS.F",
                "BadCake",
                "CACTUSTORCH",
                "CamCapture Plugin",
                "CinaRAT",
                "Cobalt Strike",
                "CobaltStrike",
                "Cuegoe",
                "DKMC",
                "Denis",
                "Goopy",
                "HiddenLotus",
                "KOMPROGO",
                "KerrDown",
                "METALJACK",
                "MSFvenom",
                "Mimikatz",
                "Nishang",
                "OSX_OCEANLOTUS.D",
                "OceanLotus",
                "PHOREAL",
                "PWNDROID1",
                "PhantomLance",
                "PowerSploit",
                "Quasar RAT",
                "QuasarRAT",
                "RatSnif",
                "Remy",
                "Remy RAT",
                "Rizzo",
                "Roland",
                "Roland RAT",
                "SOUNDBITE",
                "Salgorea",
                "Splinter RAT",
                "Terracotta VPN",
                "Yggdrasil",
                "cobeacon",
                "denesRAT",
                "fingerprintjs2"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "2ee03999-5432-4a65-a850-c543b4fefc3d",
            "created_at": "2022-10-25T16:07:23.882813Z",
            "updated_at": "2025-03-27T02:02:10.0116Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Bronze President",
                "Camaro Dragon",
                "Earth Preta",
                "HoneyMyte",
                "Mustang Panda",
                "Operation SMUGX",
                "Operation SmugX",
                "PKPLUG",
                "Red Lich",
                "Stately Taurus",
                "TEMP.Hex"
            ],
            "source_name": "ETDA:Mustang Panda",
            "tools": [
                "9002 RAT",
                "AdFind",
                "Agent.dhwf",
                "Agentemis",
                "CHINACHOPPER",
                "China Chopper",
                "Chymine",
                "ClaimLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "DCSync",
                "DOPLUGS",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Farseer",
                "Gen:Trojan.Heur.PT",
                "HOMEUNIX",
                "Hdump",
                "HenBox",
                "HidraQ",
                "Hodur",
                "Homux",
                "HopperTick",
                "Hydraq",
                "Impacket",
                "Kaba",
                "Korplug",
                "LadonGo",
                "MQsTTang",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "NBTscan",
                "NetSess",
                "Netview",
                "Orat",
                "POISONPLUG.SHADOW",
                "PUBLOAD",
                "PVE Find AD Users",
                "PlugX",
                "Poison Ivy",
                "PowerView",
                "QMAGENT",
                "RCSession",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "ShadowPad Winnti",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TONEINS",
                "TONESHELL",
                "TVT",
                "TeamViewer",
                "Thoper",
                "TinyNote",
                "WispRider",
                "WmiExec",
                "XShellGhost",
                "Xamtrav",
                "Zupdax",
                "cobeacon",
                "nbtscan",
                "nmap",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536178,
    "ts_updated_at": 1743041788,
    "ts_creation_date": 1653780428,
    "ts_modification_date": 1653780428,
    "files": {
        "pdf": "https://archive.orkl.eu/bf7a1a755e315d95fe565e46a4572ce3970049cf.pdf",
        "text": "https://archive.orkl.eu/bf7a1a755e315d95fe565e46a4572ce3970049cf.txt",
        "img": "https://archive.orkl.eu/bf7a1a755e315d95fe565e46a4572ce3970049cf.jpg"
    }
}