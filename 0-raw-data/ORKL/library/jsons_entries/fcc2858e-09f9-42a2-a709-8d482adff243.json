{
    "id": "fcc2858e-09f9-42a2-a709-8d482adff243",
    "created_at": "2023-01-12T15:09:26.658024Z",
    "updated_at": "2025-03-27T02:17:24.693009Z",
    "deleted_at": null,
    "sha1_hash": "4e53ee205ddcb35b0fb084097499998fc726886e",
    "title": "2021-09-29 - Aria-Body Loader- Is that you-",
    "authors": "",
    "file_creation_date": "2022-05-27T21:39:24Z",
    "file_modification_date": "2022-05-27T21:39:24Z",
    "file_size": 1242575,
    "plain_text": "# Aria-Body Loader? Is that you?\n\n**[medium.com/insomniacs/aria-body-loader-is-that-you-53bdd630f8a1](https://medium.com/insomniacs/aria-body-loader-is-that-you-53bdd630f8a1)**\n\nBlueMonkey September 29, 2021\n\n[BlueMonkey](https://medium.com/@bluebluemonkey0?source=post_page-----53bdd630f8a1--------------------------------)\n\nSep 29, 2021\n\n\n9 min read\n\nHello! This is my first time writing a blog on a loader which I had gotten hold of. So, I am a\nnew analyst in the Malware Analysis field and I am trying to do a research into cobalt strike.\nRecently, I ran a modified public YARA rule for cobalt strike on Virus Total and from the scan,\nI found two samples which I find interesting.\n\n1e56c3f05bb53d2dfa60bc016e8509b12fd3beb5f567d274a184bb67af1eb19c\n\nc5696e660f3cfa9232756418e40ad18729cfe32fb284bba2314dd523ba527258\n\nThese two samples have a relative large size (17.05 MB) as compared to other files and their\nsize is exactly the same. Additionally, their upload timing is quite close to each other, around\n3 minutes apart. I started to analyze the files and from my finding, it doesn’t look anything\nlike a cobalt strike loader. Turning to my friend who have much more experience in malware\nanalysis, I told him my findings and he told me that from what I had described, it sounds a\nlittle bit like Aria-Body instead. So I did some read up on Aria-Body and here are what I had\nfound….\n\nIn 2020, Check Point Research release a write up\n(http://research[.]checkpoint[.]com/2020/nikon-apt-cyber-espionage-reloaded) describing\nhow Naikon APT group is using Aria-body. In the report, they summarized the loader to have\nthese capabilities:\n\n_1. Establish persistence via the Startup folder or the Run registry key [some variants]._\n\n_2. Inject itself to another process such as rundll32.exe and dllhost.exe [some variants]._\n\n_3. Decrypt two blobs: Import Table and the loader configuration._\n\n_4. Utilize a DGA algorithm if required_\n\n\n-----\n\n_5. Contact the embedded / calculated C&C address in order to retrieve the next stage_\n_payload._\n\n_6. Decrypt the received payload DLL (Aria-Body backdoor)._\n\n_7. Load and execute an exported function of the DLL — calculated using djb2 hashing_\n_algorithm._\n\nTake note on these points as I will be mentioning some of them in this post.\n\n## Analysis of the samples\n\nAs I had mentioned in the intro, the first thing that I noticed about the two sample is that both\nof them have exactly the same size. When I loaded them into PE studio, I noticed that they\nshare the same compiler, debugger and exports timestamp.\n\nSimilar Timestamp\nNow looking at the section’s metadata, we can see that all but two of them have the same\nhash. The two sections with the different hash is the .text and the .data section. Although\nthey have a different hash, we can see that the raw-size, virtual-size, raw-address and\nvirtual-address are the same.\n\n\n-----\n\nSimilar Section\nLooking into the import and export section, this two samples also have a same import and\nexport.\n\nSimilar Export\nLooking at the static properties analysis, these two files seems like twins. They could have\nthe same origins or they might be built using a builder. But this is just my speculation at this\npoint as there are not enough information to support the claim.\n\n## Looking for the “action”\n\nNow that I had done the analysis on the files properties and confirmed that it is a 64 bit DLL,\nit’s time to throw the sample\n1e56c3f05bb53d2dfa60bc016e8509b12fd3beb5f567d274a184bb67af1eb19c into IDA for\nanalysis. After IDA has finished loading, the first thing that it displayed is this:\n\n\n-----\n\nDllMain\nThat’s all ._. not helpful at all. Seems like I have to find the “action” through other means~~\n\nSince this is a DLL, we can try to look for the “action” by checking the export functions.\n\nExport Functions\nFrom this list of 30 export functions, two of them DllEntryPoint and ILCreateFromPath caught\nmy attention. After looking through the two functions, I had determined that the\n_ILCreateFromPath function contains the “actions” that we are interested in._\n\n## Obfuscation\n\n\n-----\n\nWhile scrolling through the ILCreateFromPath function, I noticed a pattern:\n\nEncoded String\nNoticed that the value “]prt-.p,^p,0tnpN.,wSlyowp,b” in the variable aPrtPP0tnpnWsly was lea\ninto rcx followed by calling the sub function sub_180001010 then followed by a call rax. From\nmy analysis, the function sub_18001010 consist of two parts.\n\n1 — Decode the string\n\nFirst it will decode a string that is passed in as argument which in this case is the value in the\nvariable aPrtPP0tnpnWsly.\n\nDecode Section\nThis function decodes the characters by applying the concept of Substitution cipher where it\ntakes the ASCII value of each character, add 28 follow by mod 81 and finally add 42. This is\nthe formula for the substitution cipher that I had just describe: plain_text = (cipher_text + 28)\n_% 81 + 42. Thus, the value of variable aPrtPP0tnpnWsly decodes into_\n_RegisterServiceCtrlHandlerW which is a Win32 API._\n\n\n-----\n\nUsing this formula, I wrote a simple python script to do the decryption and ran it on all the\nstrings found in the same data section as aPrtPP0tnpnWsly and here are the decrypted\nstrings:\n\nDecoded String\nLooking at the de-obfuscated strings, it seems like they are hiding function calls in strings\nand decode them during runtime so that we cannot most of its capabilities just from looking\nat imports table. From the list of the De-obfuscated strings, we can see that some of the\ncapabilities of this malware includes creating thread and writing into memory.\n\n2 — GetProcAddress\n\ngetProcAddress\n\n\n-----\n\nOnce the string is decoded, the function will then call LoadLibraryA and GetProcAddress\nbefore returning the address of the call.\n\nAlright, now that we know that this malware has the ability to hide its function calls what’s\nnext?\n\n## Threading and New Processes\n\nFollowing down the ILCreateFromPath, I saw that the malware creates a new thread to\nexecute the function called StartAddress.\n\nCreate New Thread\nSo the only thing to do is to follow and look at what does the StartAddress function do.\n\nLooking through the StartAddress function, the first thing that caught my eyes is a variable\ncontaining the string “%s\\\\dllhost.exe /Processid:{%s}” followed by CreateProcessW. It looks\nlike the malware is trying to create a dllhost process.\n\n\n-----\n\nCreate New Process\nAfter calling CreateProcessW, the malware then proceeds to call VirtualAllocEx followed by\n_WriteProcessMemory._\n\n\n-----\n\nAllocate And Write To Memory\nFrom the above code, we can see that the malware used the WriteProcessMemory function\nto write the function sub_181064570 into dllhost process created earlier. Although this seems\nto be a common process injection, it matches the checkpoint’s report, where it mentions that\nit injects itself to another process such as rundll32.exe and dllhost.exe.\n\n## Decoding Embedded Data\n\nFinally, we have reached the part where we can see what this malware actually wants to do!\nThis is how the first few lines of the function written into the process’s memory looks like:\n\n\n-----\n\nWrite to Memory\nIt looks like the malware copying two sets of data located at qword_181065CC0 into the\nmemory.\n\n\n-----\n\nEncoded Blob in Memory\nAfter copying the data into the memory, the malware calls a function which will decode the\ndata.\n\nFirst Decoded Blob\nThe first blob of data contains the URL of the C2 server “news.nyhedmgtxck.com” and a\nstring of characters which doesn’t seems to be used in any part of the execution.\n\n\n-----\n\nSecond Decoded Blob\nAnd the second blob of data contains the imports table which the malware will use in the next\nphase of its activity. Wait a minute… does the 2 blobs of data sounds familiar?\n\nFrom checkpoint’s report on aria-body loader, they mentioned that one of the functionality of\nthe loader is to decrypt two blobs of data into an Import Table and a loader configuration.\n\n## Download and execute payload\n\nBy using the decoded import tables, the malware attempts to connects to the C2 URL to\ndownload a file.\n\n\n-----\n\nDownload Payload\nTo this point, it actually matches the points mentioned in Check Point’s report where Ariabody contact the embedded / calculated C&C address in order to download retrieve the next\nstage payload.\n\nToo bad for us, the URL has already been sinkhole. Therefore, I am not be able download\nthe sample for analysis ):\n\nIt’s not the end yet! Although I am not able to analyze the next stage payload, I am still able\nto see what this loader does before passing control to the next stage payload :D\n\nOnce the payload is downloaded, the malware will first decode the payload with a XOR\nfunction. The decoded payload will then reside only in the memory. Which suggest that it\ncould be a file-less malware.\n\n\n-----\n\nDecode Payload and Copy to Memory\nNext, the malware then calls a function which checks if the payload contains the magic\nnumber “MZ” and “PE”.\n\nCheck for PE and Section Header\nOnce verified, the malware will finally get the entry point to the payload by calculating the\ndjb2 hash of the payload’s export and comparing it with 0x2E9AD5FB. Without the second\nstage payload, I am unable to determine what is the export name based on that hash.\n\nDJB2 Hash\nFinally, the malware then passes the execution control to the payload.\n\n\n-----\n\nThe way this malware get the entry point also matches what Check Point had described\nwhere the loader loads and execute an exported function of the DLL — calculated using djb2\nhashing algorithm.\n\n## Conclusion\n\nPhew… Finally! We’ve reached the conclusion~~ v^^v\n\nFrom the analysis, this malware looks like a loader which will download a payload from the\nC2 and execute the payload on the memory. The capabilities of this sample is very similar to\nthe Aria-body loader that is described by Check Point where 5 out of the 7 points matching\nthe analysis. I am unable to determine if this sample “establishes persistence via startup\nfolder or run registry” and the “utilization of the DGA algorithm”. Putting the capabilities aside,\nI had look through the sample with the hash “40c49ecbe1b7bdodbb935138661b6ca4”\nmentioned in Check Point’s report and code wise, it looks vastly different from this sample.\n\nNoticed that up to this point, I have only talked about the analysis of one of the samples.\nWell, I had done the analysis on both of the sample and in regards of the code executions,\nthey are the same. The only difference between the two sample in regards to what is\nrelevant to the execution and its function, is that the C2 string and the string of character in\nthe first blob of data is different. Instead of going to “news[.]nyhedmgtxck[.]com”, the C2 of\nthe other sample is “www[.]etnwtmrkh[.]com” both of which are sinkholed.\n\nTherefore, based on the capabilities, am I right to say that this could be a variant of AriaBody loader?\n\nHashes Analyzed:\n\n1e56c3f05bb53d2dfa60bc016e8509b12fd3beb5f567d274a184bb67af1eb19c\n\nc5696e660f3cfa9232756418e40ad18729cfe32fb284bba2314dd523ba527258\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-29 - Aria-Body Loader- Is that you-.pdf"
    ],
    "report_names": [
        "2021-09-29 - Aria-Body Loader- Is that you-.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "30ed778d-15b3-484e-a90b-e1e05b36a42f",
            "created_at": "2023-01-06T13:46:38.290626Z",
            "updated_at": "2025-03-27T02:00:02.795711Z",
            "deleted_at": null,
            "main_name": "APT30",
            "aliases": [
                "G0013"
            ],
            "source_name": "MISPGALAXY:APT30",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ad154227-6fcf-43c5-a540-0c09534e040f",
            "created_at": "2024-05-01T02:03:07.952927Z",
            "updated_at": "2025-03-27T02:05:17.267077Z",
            "deleted_at": null,
            "main_name": "BRONZE GENEVA",
            "aliases": [
                "BRONZE STERLING ",
                "CTG-5326 ",
                "Naikon ",
                "Override Panda ",
                "APT30 "
            ],
            "source_name": "Secureworks:BRONZE GENEVA",
            "tools": [
                " ShadowPad",
                "Lecna"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2912fc0-c34e-4e4b-82e9-665416c8fe32",
            "created_at": "2023-04-20T02:01:50.979595Z",
            "updated_at": "2025-03-27T02:00:02.79494Z",
            "deleted_at": null,
            "main_name": "Naikon",
            "aliases": [
                "BRONZE GENEVA",
                "G0019",
                "Naikon",
                "BRONZE STERLING",
                "G0013",
                "PLA Unit 78020",
                "OVERRIDE PANDA",
                "Camerashy"
            ],
            "source_name": "MISPGALAXY:Naikon",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9f1ce7e3-77cd-4af0-bedb-1643f55c9baf",
            "created_at": "2022-10-25T15:50:23.31611Z",
            "updated_at": "2025-03-27T02:00:55.439974Z",
            "deleted_at": null,
            "main_name": "Naikon",
            "aliases": [
                "Naikon"
            ],
            "source_name": "MITRE:Naikon",
            "tools": [
                "ftp",
                "netsh",
                "WinMM",
                "Systeminfo",
                "RainyDay",
                "RARSTONE",
                "HDoor",
                "Sys10",
                "SslMM",
                "PsExec",
                "Tasklist",
                "Aria-body"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b69484be-98d1-49e6-aed1-a28dbf65176a",
            "created_at": "2022-10-25T16:07:23.886782Z",
            "updated_at": "2025-03-27T02:02:10.014032Z",
            "deleted_at": null,
            "main_name": "Naikon",
            "aliases": [
                "Hellsing",
                "ITG06",
                "Lotus Panda",
                "Naikon",
                "Operation CameraShy"
            ],
            "source_name": "ETDA:Naikon",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "AR",
                "ARL",
                "Agent.dhwf",
                "Aria-body",
                "Aria-body loader",
                "Asset Reconnaissance Lighthouse",
                "BackBend",
                "Creamsicle",
                "Custom HDoor",
                "Destroy RAT",
                "DestroyRAT",
                "Flashflood",
                "FoundCore",
                "Gemcutter",
                "HDoor",
                "JadeRAT",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "LadonGo",
                "Lecna",
                "Living off the Land",
                "NBTscan",
                "Naikon",
                "NetEagle",
                "Neteagle_Scout",
                "NewCore RAT",
                "Orangeade",
                "PlugX",
                "Quarks PwDump",
                "RARSTONE",
                "RainyDay",
                "RedDelta",
                "RoyalRoad",
                "Sacto",
                "Sandboxie",
                "ScoutEagle",
                "Shipshape",
                "Sisfader",
                "Sisfader RAT",
                "Sogu",
                "SslMM",
                "Sys10",
                "TIGERPLUG",
                "TVT",
                "TeamViewer",
                "Thoper",
                "WinMM",
                "Xamtrav",
                "XsFunction",
                "ZRLnk",
                "nbtscan",
                "nokian",
                "norton",
                "xsControl",
                "xsPlus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536166,
    "ts_updated_at": 1743041844,
    "ts_creation_date": 1653687564,
    "ts_modification_date": 1653687564,
    "files": {
        "pdf": "https://archive.orkl.eu/4e53ee205ddcb35b0fb084097499998fc726886e.pdf",
        "text": "https://archive.orkl.eu/4e53ee205ddcb35b0fb084097499998fc726886e.txt",
        "img": "https://archive.orkl.eu/4e53ee205ddcb35b0fb084097499998fc726886e.jpg"
    }
}