{
    "id": "7aad42d6-1bb2-4cdc-badb-a1e5c41a3bc1",
    "created_at": "2023-01-12T14:58:58.44227Z",
    "updated_at": "2025-03-27T02:14:02.733296Z",
    "deleted_at": null,
    "sha1_hash": "8b0df8f67fe04d3a8b6f82f3ca50a302f52f9777",
    "title": "2018-03-05 - Suricata rules to detect Winnti communication",
    "authors": "",
    "file_creation_date": "2022-05-28T23:43:08Z",
    "file_modification_date": "2022-05-28T23:43:08Z",
    "file_size": 107409,
    "plain_text": "# Suricata rules to detect Winnti communication\n\n**github.com/TKCERT/winnti-suricata-lua**\n\nTKCERT\n\nThis ruleset enables Suricata to detect the handshake of certain Winnti variants as seen in\nthe wild in 2016/2017.\n\n## Winnti\n\nWinnti is a malware that is used by some APT groups.\n\nIt has been used since at least 2013 and has evolved over time. You can find some\ninformation here\n\nhttps://kasperskycontenthub.com/wp-content/uploads/sites/43/vlpdfs/winnti-more-thanjust-a-game-130410.pdf\n[https://www.novetta.com/wp-content/uploads/2015/04/novetta_winntianalysis.pdf](https://www.novetta.com/wp-content/uploads/2015/04/novetta_winntianalysis.pdf)\nhttps://hitcon.org/2016/pacific/0composition/pdf/1201/1201%20R2%201610%20winnti\n%20polymorphism.pdf\n\n## Handshake\n\nThe driver component of Winnti (aka \"NdisReroute\") is able to reroute network traffic from\nports that are already occupied by legit applications to the malware's userspace component.\n\n\n-----\n\nThe first packet of a TCP stream signals the driver that the stream shall be rerouted. I call\nsuch a packet a \"Winnti HELO\". It is exactly 16 bytes long and the bytes match the following\nrelation:\n```\nWinnti handshake Example:\n  dw0      dw1      dw2       dw3\n5B 44 B4 91  xx xx xx xx  31 18 30 59  [84 C8] {6A 5C}\n5B 44 B4 91    ==    31 18 30 59 ^ {6A 5C} [84 C8]\n\n```\n**dw0 calculated from dw2 and dw3**\n**dw1 random but not zero. Only seen timestamps in here but any value works.**\n**dw2 random but not zero**\n**dw3 random but not zero**\n\n## Installation\n\nCopy the rules and lua files to your suricata rules directory\n```\ncp winnti.lua  /etc/suricata/rules/\ncp winnti.rules /etc/suricata/rules/\n\n```\nactivate the rules by adding them to `suricata.yaml`\n```\n[...]\nrule-files:\n - winnti.rules\n[...]\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-03-05 - Suricata rules to detect Winnti communication.pdf"
    ],
    "report_names": [
        "2018-03-05 - Suricata rules to detect Winnti communication.pdf"
    ],
    "threat_actors": [
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535538,
    "ts_updated_at": 1743041642,
    "ts_creation_date": 1653781388,
    "ts_modification_date": 1653781388,
    "files": {
        "pdf": "https://archive.orkl.eu/8b0df8f67fe04d3a8b6f82f3ca50a302f52f9777.pdf",
        "text": "https://archive.orkl.eu/8b0df8f67fe04d3a8b6f82f3ca50a302f52f9777.txt",
        "img": "https://archive.orkl.eu/8b0df8f67fe04d3a8b6f82f3ca50a302f52f9777.jpg"
    }
}