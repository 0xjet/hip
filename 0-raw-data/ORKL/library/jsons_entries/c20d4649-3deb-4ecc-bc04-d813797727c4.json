{
    "id": "c20d4649-3deb-4ecc-bc04-d813797727c4",
    "created_at": "2023-01-12T15:04:44.932058Z",
    "updated_at": "2025-03-27T02:06:05.29389Z",
    "deleted_at": null,
    "sha1_hash": "0cf984675bbf37ff540f93b4a037a753e6df47b9",
    "title": "2021-02-04 - Connecting the dots inside the Italian APT Landscape",
    "authors": "",
    "file_creation_date": "2022-05-28T15:43:57Z",
    "file_modification_date": "2022-05-28T15:43:57Z",
    "file_size": 1076247,
    "plain_text": "# Connecting the dots inside the Italian APT Landscape\n\n**[yoroi.company/research/connecting-the-dots-inside-the-italian-apt-landscape/](https://yoroi.company/research/connecting-the-dots-inside-the-italian-apt-landscape/)**\n\nFebruary 4, 2021\n\n02/04/2021\n\n## Introduction\n\nThe news of the hack of one of the major strategic Italian companies circulated in the first\nhalf of December 2020 shocked a huge part of the national security community: Leonardo\nSpA (formerly Finmeccanica) runs critical services and projects directly related to the Italian\ndefense industry and military corps.\n\n[On 5th December 2020, the Italian police (CNAIPIC) published a press statement revealing](https://www.commissariatodips.it/notizie/articolo/attacco-hacker-a-leonardo-spa-due-arresti/index.html)\nthe Aerostructures and Aircraft division has been hacked for a long time. The malicious APT\npresence was dated back to 2015 and lasted for about two years inside the Leonardo\ndivision.\n\nOnly few details have been disclosed by the Italian police, but enough to enable the security\ncommunity to expand this case and unveil technical details about the tools used by the silent\n[intruders. For instance, recently Reaqta hunted for malware samples related to the intrusion](https://reaqta.com/2021/01/fujinama-analysis-leonardo-spa/)\nand identified a couple of samples closely matching the CNAIPIC press statement.\n\nWe have been looking at this case since December 2020 and tracked this new actor as TH261. But in the initial weeks of 2021 we noticed something unattended: a set of similarities on\nrecent ongoing attacks made us really suspicious about the nature and evolution of this\nthreat.\n\n\n-----\n\n## Technical Analysis\n\nThe starting point of our research was Italian police press statement. Here the only technical\ndetail provided by the policy was a singular network indicator: “www.fujinama.altervista[.org”.\n\nThird party analysis published on 8th of January 2021 pointed out a couple of samples\nrelated to the case, but no hash was provided. So we methodologically started to hunt for the\nsamples they were describing in the article, especially for the named “cftmon.exe”, that one\nspecifically dated back on 2015, the initial date of the intrusion reconstructed by the local law\nenforcement agency.\n\n## The “Fujinama” Samples Hunt\n\nThrough our threat intelligence investigations, we were able find a sample candidate using\nthe Yara Rule and available technical indicators. We ended up to this candidate:\n“3c4444c8339f2b4c04931a379daf9d041854b168e45f949515f90b124821d626”.\n\nFigure 1: VirusTotal statistics of the suspect sample\n\nThe sample of the above screen was named “cftmon”, the same name reported on both\nCNAIPIC and Reaqta articles. At this point, we investigate other static attributes to find out\nas many elements as possible to confirm we were looking at the specific sample related to\nthe Leonardo’s intrusion.\n\nFigure 2: Static information about the sample\n\nThe malware has been compiled the day 2015-07-14, the same timestamp reported in the\nReaqta report, so this thing could indicate two things:\n\nthe sample is actually compiled in that date, so the threat actor prepared the attack with\nhigh precision and detail\nthe sample has a fake compilation stamp and it has been compiled just before the\nintrusion\n\nAs reported in other technical reports, the malware code is quite particular and does not\nhave any type of code-protection systems. Also the network traffic to the C2 has no\nsophisticate encryption or random looking encoding.\n\nFigure 3: Tracing of some critical API Windows calls\n\nAs reported in the official bulletins, the malware massively uses the Windows API calls\n“InternetConnectA” and “HttpOpenRequestW” and there is the correspondence of the C2\nemerged: “fujinama.altervista[.org”, as reported by Italian Police.\n\nMoreover, we individuated the three basic functionalities: take screenshots, capture\nkeystrokes execute commands coming from the C2\n\n\n-----\n\nAnyway, considering the absence of any stomping and the whole technical, we are quite\nconfident we are looking at the malicious code written by this mysterious APT.\n\n### The Second Sample from the Past: “Igfxtray”\n\nDuring the monitoring of this threat, we focused also onto the research of related samples, in\norder to have the widest view of the topic.\n\nIn particular, we found another related sample of the “Fujinama” one. It has been reported\nalso inside the report of Reaqta, where they carry out the decision that the sample is\nallegedly the same, but it belongs to another campaign.\n\nFigure 4: Static information about the sample\n\nIn this case, the code is perfectly compatible with the Fujinama sample. We have exactly the\nsame pieces of code evidence for the keylogging routine:\n\nFigure 5: Evidence of the similarity between Fujinama sample (on the left) and igfxtray\nsample (on the right)\n\nHowever there are also some differences between the two samples:\n\nThe strings of the Igfxtray malware are English-speaking and other ones are base64\nencoded\nThe C2 is hosted on “webhostapp” ISP instead of “Altervista”\n\nHowever, we have also a set of similarities to be analyzed:\n\nFigure 6: Comparison of the strings between Fujinama sample (on the left) and igfxtray (on\nthe right)\n\nOn the left there is a piece of the extracted strings of the “Fujinama” and on the right\n“igfxtray”. We separated the relevant strings into two colors: the red indicates the\ncorrespondence between the italian configuration strings of “Fujinama” sample and the\nEnglish-Base64 encoded of “igfxtray” one; The blue color indicates the difference of the\nprovider of the C2.\n\nUltimately, the compatibility of the sample is no doubt confirmed.\n\n## Cashback 2021\n\n[A big surprise happened when we analyzed a malware reported by CERT-AGID, the CERT](https://cert-agid.gov.it/news/malware/falsa-comunicazione-cashback-di-stato-veicola-malware/)\nof the Italian Agency for Digitisation. This time, the malware was spread as malspam mail\nwith a current theme in Italy: “Cashback di Stato”, a recent governmental initiative to\nincentive digital payments leveraging cashback mechanisms.\n\n\n-----\n\nFigure 7: View of the malicious mail (CREDITS CERT AGID)\n\nThe downloaded file is not a PDF file, but it is actually an executable compiled in VB6.\n\nFigure 5: Static Information about the sample\n\nThe sample compilation stamp is 2021-01-05, just when the malware has spread in the wild\nand its main communication is FTP, all communication with the C2 in fact rely on this\nprotocol.\n\nThe “Cashback di Stato” sample adopts a multistage infection chain. As reported by the\nItalian CERT, the keylogger component is downloaded in a second moment from the FTP\nserver.\n\nFigure 8: Keylogging routine of the component of “Cashback di Stato” Sample\n\nThe “Cashback di Stato” version uses the “SetWindowsHookEx” API call to perform\nkeylogging, a technique a bit more evolved than the Fijinama’s “GetAsyncKeyState”.\n\nFigure 9: Keylogging routine of the component of “Cashback di Stato” Sample\n\nBesides these differences, we noticed some potential inner connections deeper with\nLeonardo's samples which made room for profound questions we will deepen in the following\nsections.\n\n## A Common Matrix?\n\nThe first aspect we notice wes in the code itself. The absence of any self-protection\nmechanism is very very uncommon nowadays: the usage of packers, protectors and\nencryptors are recurrent practice in almost all cyber criminal environments. Noticing no\nprotection layers is something characteristic of custom code samples, many times developed\nby groups or actors with software developing skill sets in the house, able to craft their\nweapons from scratch rather than leveraging off-the shelf tools.\n\nThe “Fujinama” samples show no trace of complex frameworks, all the code is\nstraightforward and seems hand made directly in VB6. The structure itself is really basic: the\nmalware application logic is coded and triggered within a hidden form and a few timers.\n\nThe same structure and the same consideration could be formulated even for the 2021’s\nCashback samples.\n\nFigure 10: Left. “Fujinama” sample 2015 - Right. “Cashback” sample 2021\n\nWe had a similar impression like the one we had dissecting these samples when looking at\nthe command and control infrastructure: the Italian web blogging platform services\n“Altervista” was also used in the 2015 sample and the 2021 one. Even in this case, the use\n\n\n-----\n\nof this platform is not so common in mainstream attack campaigns.\n\nAnother impression we had reviewing these samples regards the rate of changes of such\nsamples. In fact, despite some changes in the code and in the modularity suggest we are\nlooking at an evolving piece of code, but this evolution maintains some constants, for\ninstance in the building environment, in the naming schema and malware application\ndynamics itself.\n\nThe following table synthesize all the TTPs emerged and the similarities between all of the\nthree samples, trying to clarify the potential connection among them:\n\n\n**TTPs** **Sample “Fujinama”**\n**2015**\n\n\n**Sample“Igfxtray”**\n**2017**\n\nYES\n(MS Visual Basic\n5.0-6.0  EXE)\n\n\nVB6 Compiler\n\n[T1059.005]\n\nFile name\nMasquerading\n\n[T1036]\n\nLack of\nObfuscation\n\n[T1001]\n\nPE Information\n\n[T1036.003]\n\nPersistence\n\n[T1547.001]\n\n\nYES\n(MS Visual Basic 5.0-6.0\nEXE)\n\n\n**Sample“Cashback”**\n**2021**\n\nYES\n(MS Visual Basic 5.06.0  EXE)\n\n\ncftmon.exe sysC32cmd.exe Igfxtray.exe\n\nYES YES YES\n\nItalian Italian Italian\n\nNO YES NO\n\n\nC2 Altervista Altervista webhostapp\n\n\nModular\nInfection\n\nC2\nCommunication\nProtocol\n\n[T1071]\n\nKeylogger\n\n[T1056.001]\n\nTake\nscreenshot\n\n[T1113]\n\n\nNO YES NO\n\n\nHTTP\n\n[T1071.001]\n\n\nFTP\n\n[T1071.002]\n\n\nYES(GetAsyncKeyState) YES\n(SetWindowsHookEx)\n\n\nHTTP\n\n[T1071.001]\n\nYES\n(GetAsyncKeyState)\n\n\nYES YES YES\n\n\n-----\n\nDownload File\n\n[T1105]\n\nExecute\nCommand\n\n[T1059.003]\n\nUpload File\n\n[TA0010]\n\n\nNO YES NO\n\nYES YES YES\n\nYES YES YES\n\n\nTable 1: Synthetic table of the TTPs among the three samples\n\n## Conclusion\n\nConsidering we might look at an evolving codebase among 6 years, we think the TTPs of the\nactor behind it are somehow compatible with a moderate confidence.\n\nBut we need to make a distinction, at the moment we don’t have any clues about the reason\nfor these similarities and the hypothesis may be several and really different from each one:\nfor instance we may be looking to an evolving code base of a single actor, or to two different\nindependent codebases of people with - or without - any kind of connection, or also a code\nbase inherited and evolved by an additional actor.\n\nCurrent contextual elements are not enough to formulate a definitive statement, but as\nmalware analysts we are noticing a potential connection crossing the years from the\ntechnical and methodological point of view.\n\n## Indicators of Compromise\n\nDropurl:\n\nhttps://bit].ly/3naIYxK\nhttp://www].studiocpv].it/dealerfree/ModuloCitrixTelecomDaCompilare%5D.pdf.zip\nC2:\n\nfujinama[.altervista[.org\nfailaspesa[.altervista[.org\nffaadd332211.altervista[.org\nxhdyeggeeefeew[.000webhostapp[.com\nData Exfiltration:\n\nkeylogging\nscreenshots\nPersistence:\n\nHKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\n\n\n-----\n\nHash:\n\n3c4444c8339f2b4c04931a379daf9d041854b168e45f949515f90b124821d626\n00092c4212f31387983e7e4b03d4f8362e58a43861d8073e71d20e95addeb8a2\n646dbe5de074ba301f2e2eccd9ccbb9b58c86dafc69cbf00ecd7fe9365f8f1f2\n500631db833b2729f784e233225621ddff411d7da49bd82cfd51a49b9600438f\n\n_This blog post was authored by Luigi Martire and Luca Mella_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-02-04 - Connecting the dots inside the Italian APT Landscape.pdf"
    ],
    "report_names": [
        "2021-02-04 - Connecting the dots inside the Italian APT Landscape.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535884,
    "ts_updated_at": 1743041165,
    "ts_creation_date": 1653752637,
    "ts_modification_date": 1653752637,
    "files": {
        "pdf": "https://archive.orkl.eu/0cf984675bbf37ff540f93b4a037a753e6df47b9.pdf",
        "text": "https://archive.orkl.eu/0cf984675bbf37ff540f93b4a037a753e6df47b9.txt",
        "img": "https://archive.orkl.eu/0cf984675bbf37ff540f93b4a037a753e6df47b9.jpg"
    }
}