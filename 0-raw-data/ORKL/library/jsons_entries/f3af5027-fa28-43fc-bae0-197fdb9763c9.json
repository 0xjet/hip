{
    "id": "f3af5027-fa28-43fc-bae0-197fdb9763c9",
    "created_at": "2023-01-12T14:59:23.724739Z",
    "updated_at": "2025-03-27T02:17:05.768227Z",
    "deleted_at": null,
    "sha1_hash": "ca53ad2bb7459a76777668dc3dae7f453c2248f4",
    "title": "2016-06 - Form Grabber 2016 [Crome,FF,Opera,Thunderbird, Outlook IE Safari] Hack the world",
    "authors": "",
    "file_creation_date": "2022-05-06T09:02:03Z",
    "file_modification_date": "2022-05-06T09:02:03Z",
    "file_size": 1349757,
    "plain_text": "# Black Energy – Analysis\n\n**marcusedmondson.com/2019/01/18/black-energy-analysis**\n\nView all posts by Marcus Edmondson January 18, 2019\n\nSo today I wanted to do a blog post on Black Energy. The sample I will be working with was sourced from hybrid analysis\nhere: https://www.hybridanalysis.com/sample/39d04828ab0bba42a0e4cdd53fe1c04e4eef6d7b26d0008bd0d88b06cc316a81?environmentId=4.\nThis particular piece of malware was used to target the networks used to control power grids and has been associated to\nthe Sandworm Team, who used it to also target organizations in the Ukraine. According to Mitre the Sandworm Team is\na Russian cyber espionage group that has operated since approximately 2009. The group likely consists of Russian prohacktivists. Sandworm Team targets mainly Ukrainian entities associated with energy, industrial control systems,\nSCADA, government, and media. Sandworm Team has been linked to the Ukrainian energy sector attack in late 2015. So\nnow that we have a little background lets start our analysis.\n\nWhen you initially open up the document you are greeted with this.\n\nI don’t speak Russian but, I’m pretty sure this is telling the user to view this document you need to enable the content. So\nlets do it and see what we can get. I’m going to use my usual setup of RegShot/Procmon and Process Hacker with my\nWindows VM pointing to my Remnux VM where I will have fakedns, inestsim and Wireshark running. So here is what\nRegShot is showing me.\n\n\n-----\n\nAfter taking a quick look it looks like we have a .lnk file being dropped into the Startup folder which is a pretty common\npersistence technique used by malware. Inside the .lnk file the target is: %windir%\\System32\\rundll32.exe\n“C:\\Users\\IEUser\\AppData\\Local\\FONTCACHE.DAT”,#1. We also have multiple other processes being kicked off by the\nword document, one of which is vba_macro.exe that runs and deletes itself. Here is the process listing from Process\nHacker.\n\nAfter looking at Wireshark we also have a network connection going to\n5[.]149[.]254[.]114//Microsoft/Update/KC074913[.]php and sending back some base64 to the server.\n\nThe base64 wil decode to this:\n\nb_id=MSEDGEWIN10_320E10D4F923CEC8B1A11E4A1DB9950D&b_gen=301018stb&b_ver=2.3&os_v=17134&os_type=1\n\nWhich is the malware fingerprinting the host OS versions.\n\nI also want to cover a quick way for you to dump vba_macro.exe before it runs and deletes itself. So on the Word\ndocument click alt+F11 or on Mac option+F11, this will bring up the Visual Basic window showing the macros. At the very\nbeginning you see array after array of numbers, which appears to possibly be machine code.\n\n\n-----\n\nIf you scroll down to the bottom you will see the meat of what’s happening. It is looping over the arrays and writing it to a\nfile called vba_macro. So we will put a breakpoint right after the loop ends and then run the macros to dump the file,\nwhich we will then move to the desktop.\n\nSo as I started analyzing vba_macro I loaded it into IDA to get a look at the imports and strings, I noticed most of the\nimports had no xrefs which puzzled me for a while, I think a lot of the imports are in there to send the analyst down\nrabbit holes. So I loaded vba_macro up in x32dbg and set breakpoints on some Native API functions like NtWriteFile,\nNtOpenProcess, etc… I did this because I remember reading that malware will sometimes use these lower level API’s to\navoid detection. I then started running it to see what I could find.\n\nSo here is a call to NtWriteFile where it looks like it is creating the .lnk file.\n\nAnd here is a call to ShellExecuteW opening the .lnk file.\n\n\n-----\n\nSo to sum things up a quick down and dirty of my interpretation of what this malware is doing:\n\n1. Word document macros run which drop vba_macro to disk.\n2. vba_macro creates the .lnk and fontcache.dat and runs .lnk file which in turn runs fontcache.dat with rundll32\n\nwhich provides the network connectivity to the above address we talked about.\n3. vba_macro also kicks off a cmd.exe which is continually running PING.exe and attrib.exe.\n\nSo thank you for reading and hope this has helped someone to learn something new and until next time…\n\nHappy hunting,\n\nMarcus\n\nReferences:\n\n[https://attack.mitre.org/groups/G0034/](https://attack.mitre.org/groups/G0034/)\n\n[https://securelist.com/blackenergy-apt-attacks-in-ukraine-employ-spearphishing-with-word-documents/73440/](https://securelist.com/blackenergy-apt-attacks-in-ukraine-employ-spearphishing-with-word-documents/73440/)\n\n[https://threatconnect.com/blog/casting-a-light-on-blackenergy/](https://threatconnect.com/blog/casting-a-light-on-blackenergy/)\n\n\n-----\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/ICS SCADA/GreyEnergy and BlackEnergy/Black Energy – Analysis.pdf"
    ],
    "report_names": [
        "Black Energy – Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "4d9cdc7f-72d6-4e17-89d8-f6323bfcaebb",
            "created_at": "2023-01-06T13:46:38.82716Z",
            "updated_at": "2025-03-27T02:00:02.928984Z",
            "deleted_at": null,
            "main_name": "GreyEnergy",
            "aliases": [],
            "source_name": "MISPGALAXY:GreyEnergy",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "7bd810cb-d674-4763-86eb-2cc182d24ea0",
            "created_at": "2022-10-25T16:07:24.1537Z",
            "updated_at": "2025-03-27T02:02:10.126127Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "APT 44",
                "ATK 14",
                "BE2",
                "Blue Echidna",
                "CTG-7263",
                "FROZENBARENTS",
                "IRIDIUM",
                "Iron Viking",
                "Quedagh",
                "Sandworm",
                "Sandworm Team",
                "Seashell Blizzard",
                "TEMP.Noble",
                "UAC-0082",
                "UAC-0113",
                "UAC-0125",
                "UAC-0133",
                "Voodoo Bear"
            ],
            "source_name": "ETDA:Sandworm Team",
            "tools": [
                "AWFULSHRED",
                "ArguePatch",
                "BIASBOAT",
                "Black Energy",
                "BlackEnergy",
                "CaddyWiper",
                "Colibri Loader",
                "Cyclops Blink",
                "CyclopsBlink",
                "DCRat",
                "DarkCrystal RAT",
                "Fobushell",
                "GOSSIPFLOW",
                "Gcat",
                "IcyWell",
                "Industroyer2",
                "JaguarBlade",
                "JuicyPotato",
                "Kapeka",
                "KillDisk.NCX",
                "LOADGRIP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "ORCSHRED",
                "P.A.S.",
                "PassKillDisk",
                "Pitvotnacci",
                "PsList",
                "QUEUESEED",
                "RansomBoggs",
                "RottenPotato",
                "SOLOSHRED",
                "SwiftSlicer",
                "VPNFilter",
                "Warzone",
                "Warzone RAT",
                "Weevly"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535563,
    "ts_updated_at": 1743041825,
    "ts_creation_date": 1651827723,
    "ts_modification_date": 1651827723,
    "files": {
        "pdf": "https://archive.orkl.eu/ca53ad2bb7459a76777668dc3dae7f453c2248f4.pdf",
        "text": "https://archive.orkl.eu/ca53ad2bb7459a76777668dc3dae7f453c2248f4.txt",
        "img": "https://archive.orkl.eu/ca53ad2bb7459a76777668dc3dae7f453c2248f4.jpg"
    }
}