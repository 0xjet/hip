{
    "id": "7847aafe-6477-483e-be92-58b0586e6b92",
    "created_at": "2023-01-12T15:06:03.366519Z",
    "updated_at": "2025-03-27T02:05:39.91789Z",
    "deleted_at": null,
    "sha1_hash": "9ed0dd5317933674e66cf45af03b5d83ef1391d9",
    "title": "2020-12-23 - CrowdStrike Launches Free Tool to Identify and Help Mitigate Risks in Azure Active Directory",
    "authors": "",
    "file_creation_date": "2022-05-28T19:24:06Z",
    "file_modification_date": "2022-05-28T19:24:06Z",
    "file_size": 1223497,
    "plain_text": "# CrowdStrike Launches Free Tool to Identify & Mitigate Risks in Azure Active Directory\n\n**[crowdstrike.com/blog/crowdstrike-launches-free-tool-to-identify-and-help-mitigate-risks-in-azure-active-directory/](https://www.crowdstrike.com/blog/crowdstrike-launches-free-tool-to-identify-and-help-mitigate-risks-in-azure-active-directory/)**\n\nDecember 23, 2020\n\n## CrowdStrike Launches Free Tool to Identify and Help Mitigate Risks in Azure Active Directory\n\nDecember 23, 2020\n\n[Michael Sentonas](https://www.crowdstrike.com/blog/author/michael-sentonas/) [From The Front Lines](https://www.crowdstrike.com/blog/category/from-the-front-lines/)\n\n## Executive Summary\n\nCrowdStrike launches CrowdStrike Reporting Tool for Azure (CRT), a free community\ntool that will help organizations quickly and easily review excessive permissions in\ntheir Azure AD environments, help determine configuration weaknesses, and provide\nadvice to mitigate risk.\nCrowdStrike has observed the challenges that organizations face auditing Azure AD\npermissions, which is a time-consuming and complex process.\n\n\n-----\n\nCrowdStrike conducted an extensive review of our production and internal\nenvironments and found no impact.\nCrowdStrike does not have any attribution and does not know of any connection to\nSUNBURST at this time.\n\nCompanies and governments around the world are facing one of the most advanced and\nfar-reaching attacks in recent history. This is clearly a sophisticated operation carried out\nover a long period of time. The motivations and true extent of how far reaching this\ncampaign has been will be better understood by the security industry and authorities in\nweeks, maybe months to come. Customer security and transparency are CrowdStrike’s top\npriority. We have conducted an extensive review of our production and internal\nenvironments and found no impact.\n\nWhilst doing our review, CrowdStrike was contacted by the Microsoft Threat Intelligence\nCenter on December 15, 2020. Specifically, they identified a reseller’s Microsoft Azure\naccount used for managing CrowdStrike’s Microsoft Office licenses was observed making\nabnormal calls to Microsoft cloud APIs during a 17-hour period several months ago. There\nwas an attempt to read email, which failed as confirmed by Microsoft. As part of our secure\nIT architecture, CrowdStrike does not use Office 365 email.\n\nCrowdStrike conducted a thorough review into not only our Azure environment, but all of\nour infrastructure for the indicators shared by Microsoft. The information shared by\nMicrosoft reinforced our conclusion that CrowdStrike suffered no impact.\n\nThroughout our analysis, we experienced first hand the difficulties customers face in\nmanaging Azure’s administrative tools to know what relationships and permissions exist\nwithin Azure tenants, particularly with third-party partner/resellers, and how to quickly\nenumerate them. We found it particularly challenging that many of the steps required to\ninvestigate are not documented, there was an inability to audit via API, and there is the\nrequirement for global admin rights to view important information which we found to be\nexcessive. Key information should be easily accessible.\n\nIn our role supporting organizations impacted by the SUNBURST incident, the CrowdStrike\nServices team has created a community tool called CrowdStrike Reporting Tool for Azure\n(CRT) to quickly and easily pull up these excessive permissions and other important\ninformation about your Azure AD environment. This includes delegated permissions and\napplication permissions, Federation configurations, Federation trusts, mail forwarding rules,\nService Principals, objects with KeyCredentials, and more. Of note, due to the lack of\ndocumentation of Microsoft API capabilities, CRT does not pull critical information regarding\npartner tenant permissions, which includes delegated admin access. We have detailed\nsteps below enabling you to view this critical information manually in the Microsoft 365\nadmin center; this is also documented in the CRT readme.\n\n\n-----\n\nWe have made this tool available to the community in our CrowdStrike github\nrepository. We recommend that all Azure AD administrators review their Azure AD\nconfiguration to help determine if they have been impacted and take steps to prevent\nintrusions. We hope this tool will assist organizations around the world.\n\nWe would like to thank Microsoft for sharing this abnormal behavior and associated IOCs.\nWe strongly recommend all organizations leverage CRT to review their Azure tenants and\nunderstand if they need to take any configuration or mitigation steps, particularly as it\nrelates to third-parties that may be present in your Azure environment. Additionally, it is\ncritical to ensure you review your partner/reseller access, and you mandate multi-factor\nauthentication (MFA) for your partner tenant if you determine it has not been configured.\nOne of the reasons why these attack vectors are so difficult to mitigate is the inherent\ncomplexities that organizations face with federated SSO infrastructure and in managing\nAzure tenants. We hope the findings and recommendations from our experience help your\norganization.\n\n## Introducing the CrowdStrike Reporting Tool for Azure\n\n Prerequisites and Deployment\n\nCRT uses PowerShell and automatically installs the Exchange Online PowerShell V2,\nMSOnline, and AzureAD modules. While we recommend that this tool be run with an\naccount with Global Reader privileges, certain read-only functions nonetheless require\nauthentication as a user with Global Admin or similarly high-risk privileges. When Global\nAdmin privileges are not available, the tool will notify you about what information won’t be\navailable to you as a result.\n\n\n-----\n\nSample view of CRT while collecting application permissions\n\nCRT output with CSV and JSON format\n\n## Additional Recommendations\n\nBased on incident response engagements conducted by the CrowdStrike Services team, I\nwant to highlight some additional attack surface and mitigation recommendations.\n\n\n-----\n\n## Logging\n\nCrowdStrike recommends centralizing storage of logs in a secure location to prevent\ntampering, unauthorized access, and forensic preservation. Certain log sources must be\nenabled and diagnostic settings need to be added for sufficient detail to be available. If\nthese additional settings are not configured, the relevant events will not be captured.\n\nAt a minimum, the following logs should be captured in a Security Incident Event\nManagement (SIEM) system or log storage environment separate from Azure:\n\nUnified Audit Log\nAzure Activity Logs\nAzure Services Logs\nAzure NSG Flow Logs\nAzure AD Logs:\n\nAzure AD Audit Logs\nAzure AD Sign-In Logs\nAzure AD Managed Identity Sign-In Logs (Preview)\nAzure AD Non-Interactive User Sign-In Logs (Preview)\nAzure AD Service Principal Sign-In Logs (Preview)\nAzure AD Provisioning Logs\nAzure AD Risky Sign-In events\n\n## Configuration Review and Hardening Measures\n\nCrowdStrike recommends reviewing tenant configurations and applying the hardening\nmeasures below as applicable.\n\n### Tenant\n\nReview trust relationships with partners including IT consultants, vendors and\nresellers and limit privileges. Partner role information is available to Global Admin\n[accounts at this link https://admin.microsoft.com/AdminPortal/Home#/partners. This](https://admin.microsoft.com/AdminPortal/Home#/partners)\ninformation does not appear to be available through documented APIs.\nReview existing Federations. Identify unauthorized or unrecognized Federations and\nrevoke them.\nStore SAML token signing certificate key material in a Hardware Security Module\n(HSM) so that the signing key cannot be stolen. Alternatively, rotate SAML signing\ncertificates periodically.\nReview Azure AD allowed identity providers (SAML IDPs through direct federation or\nsocial logins) and identify and remove those that are not legitimate.\nReview Azure B2B external identities’ access to the Azure portal and identify and\nremove those that are no longer needed or not legitimate.\n\n\n-----\n\nEnsure only required on-premises AD Organizational Units (OUs) and objects are\nbeing synced to the cloud. Use extreme caution when establishing bi-directional trust\nand syncing privileged identities, service accounts, or OUs between on-premise and\ncloud.\nImplement Azure Policies to restrict specific actions in the tenant.\n\nRestrict Region Usage\nEnforce tagging for sensitive resources\nReview access controls to the Azure administrator portal, using least privilege access\nprinciples.\nReview environment for overly privileged service accounts that may have access to\non-prem environments as well as Azure and reduce privileges and access if possible.\n\n### Azure ADOAuth Applications\n\nReview existing applications with credentials recently added.\nReview non-Microsoft registered applications and permissions, and revoke\npermissions and credentials for any unrecognized application.\nReview and remove unused applications.\nLimit application consent policy to only approved administrators.\n\n### Entitlements Review\n\nEnsure that only dedicated cloud-only administrator accounts are used for cloud\nadministration.\nPractice the [principle of least privilege and remove unnecessary privileges where](https://www.crowdstrike.com/cybersecurity-101/principle-of-least-privilege-polp/)\nwarranted.\nReview users granted membership in administrative roles or groups:\n\nUsers with elevated permissions via the following roles should be given extra\nscrutiny:\n\nAuthentication Administrator\nBilling Administrator\nConditional Access Administrator\nE-Discovery Manager and Administrator\nExchange Administrator\nGlobal Administrator\nHelpdesk Administrator\nPassword Administrator\nSecurity Administrator\nSharePoint Administrator\nUser Access Administrator\nUser Administrator\n\nReview privileges and enforce multi-factor authentication requirements for Guest\nusers\n\n\n-----\n\nEnsure only the appropriate users have Azure CLI access to the tenant.\n\n### Authentication\n\nEnforce multi-factor authentication (MFA) for all users.\nCheck for new unknown MFA registrations and restrict service accounts from MFA\nregistration.\nSet the multi-factor authentication access policy to “Do not allow users to create app\npasswords to sign in to non-browser apps” to prevent bypassing MFA.\nReview and enforce Conditional Access Policies:\n\nUtilize geo-fencing and/or trusted locations.\nEnforce modern authentication and blocking of legacy authentication.\nBlock “risky sign-ins” with medium severity and above.\nMonitor authentication requests from unknown identity providers.\nMonitor for credentials being added to service principals.\nEnsure Self Service Password Reset (SSPR) requests are enabled to notify users\nwhen their passwords are changed.\n\n### Exchange\n\nReview mailbox forwarding rules and remove unauthorized rules, including:\n\nTenant-wide mail flow rules\nIndividual mailboxes\nReview mailbox delegations and remove unnecessary delegations.\nEnsure Exchange PowerShell usage is only permitted for Exchange Administrators.\n\n## Harden On-Premise and Self-Managed Systems\n\nIt is important to highlight the need to harden on-premise systems as well as cloud and\ndatacenter-hosted systems for which the organization is ultimately responsible. Based on\ncurrent intelligence, the ability of this adversary to be successful depends on the initial\ncompromise of hosts configured by or for the organization along with its partners, including\nhosts in public clouds. Privileged users, roles and organizational units should be synced\nbetween cloud and on-premises or self-managed directories with extreme caution. Cloud\nadmin roles must rely on cloud-only authentication and not authenticate with SAML SSO,\njust as admin roles for on-premises / self managed must not be authenticated through cloud\nservices.\n\n### Endpoint Detection and Response (EDR) Solution\n\n[Deploy Endpoint Detection and Response solution, such as Falcon Insight, to provide](https://www.crowdstrike.com/endpoint-security-products/falcon-insight-endpoint-detection-response/)\nvisibility and prevention across the enterprise endpoints and cloud workloads.\n\n### Cloud Security Posture Management (CSPM)\n\n\n-----\n\nMonitor Azure using a Cloud Security Posture Management solution such as Falcon\nHorizon.\n\n### Implement Risk Based Conditional Access Everywhere\n\nAchieve unified visibility and adaptive enforcement for both on-premises and in the cloud\nresources to secure access based on context and use enforcement to prevent identity\n[based threats in real time using a solution like Falcon Zero Trust. This includes protecting](https://www.crowdstrike.com/products/identity-protection/falcon-zero-trust/)\nlegacy systems, unmanaged devices, and all accounts types (privileged, employee, remote,\nand service).\n\n### Privileged Identity Management (PIM)\n\nImplement Privileged Identity Management solution to be utilized to limit exposure to\n[administrative permissions by providing just-in-time access. Falcon Zero Trust can also help](https://www.crowdstrike.com/products/identity-protection/falcon-zero-trust/)\nextend core PIM functionality to systems that require risk based conditional access when\nPIM is not feasible for all applications, workloads, and privileged users.\n\n### Enforce Mail Encryption and Signing\n\nEnforcing end-to-end email encryption and signing can help to prevent unauthorized access\nand verify the authenticity of the communication.\n\n### Security Email Gateway Solution\n\nHaving a secure email gateway solution will provide protection, visibility, and data\nprotection.\n\n### Mail DNS Controls\n\nImplementing SPF, DKIM, and DMARC records will ensure email authenticity, prevent\nspoofing, and provide visibility.\n\n### Conduct Organizational Phishing Campaign and Trainings\n\nRegular phishing exercises and awareness training can assist employees to recognize,\navoid, and report potential threats that could compromise the environment.\n\n_We encourage feedback on the CRT tool. Feel free to contact us at_\n_[CRT@CrowdStrike.com.](http://10.10.0.46/mailto:CRT@CrowdStrike.com)_\n\nNote: On December 24, 2020 the US Department of Homeland Security’s Cybersecurity &\nInfrastructure Security Agency (CISA) released a new tool, Sparrow.ps1, to help network\nadmins secure their Microsoft 365-based infrastructure following the recent reports that\nhackers have been exploiting Microsoft 365 to compromise commercial and sensitive\n\n\n-----\n\ngovernment networks. The CISA tool is designed to detect possible compromised accounts\nand applications in the Azure/m365 environment and can be found here –\n[https://github.com/cisagov/Sparrow](https://github.com/cisagov/Sparrow)\n\n**Additional Resources**\n\n[Access the new CrowdStrike Reporting Tool for Azure (CRT).](https://www.crowdstrike.com/resources/community-tools/crt-crowdstrike-reporting-tool-for-azure/)\nLearn about CrowdStrike’s comprehensive next-gen endpoint and cloud workload\n[security platform by visiting the Falcon products webpage.](https://www.crowdstrike.com/endpoint-security-products/)\nTest CrowdStrike next-gen AV for yourself: [Start your free trial of Falcon Prevent™.](https://go.crowdstrike.com/try-falcon-prevent.html)\n\nRelated Content\n\nCompromised Docker Honeypots Used for Pro-Ukrainian DoS Attack\n\n\n-----\n\nNavigating the Five Stages of Grief During a Breach\n\n\n-----\n\nLemonDuck Targets Docker for Cryptomining Operations\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-23 - CrowdStrike Launches Free Tool to Identify and Help Mitigate Risks in Azure Active Directory.pdf"
    ],
    "report_names": [
        "2020-12-23 - CrowdStrike Launches Free Tool to Identify and Help Mitigate Risks in Azure Active Directory.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535963,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1653765846,
    "ts_modification_date": 1653765846,
    "files": {
        "pdf": "https://archive.orkl.eu/9ed0dd5317933674e66cf45af03b5d83ef1391d9.pdf",
        "text": "https://archive.orkl.eu/9ed0dd5317933674e66cf45af03b5d83ef1391d9.txt",
        "img": "https://archive.orkl.eu/9ed0dd5317933674e66cf45af03b5d83ef1391d9.jpg"
    }
}