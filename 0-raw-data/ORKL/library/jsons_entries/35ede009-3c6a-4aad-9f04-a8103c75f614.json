{
    "id": "35ede009-3c6a-4aad-9f04-a8103c75f614",
    "created_at": "2022-10-25T16:48:13.170727Z",
    "updated_at": "2025-03-27T02:05:43.241178Z",
    "deleted_at": null,
    "sha1_hash": "a27e0a670db551b6c01781233bbe02431e1fcc7a",
    "title": "",
    "authors": "",
    "file_creation_date": "2012-06-21T17:05:39Z",
    "file_modification_date": "2012-06-21T17:15:05Z",
    "file_size": 2420742,
    "plain_text": "# ACAD/Medre.A\n\n### 10000‘s of AutoCAD Designs Leaked in Suspected Industrial Espionage\n\n\n-----\n\n## ACAD/Medre.A\n\n#### Summary\n\nRecently the worm, ACAD/Medre.A, showed a big spike in Peru on\nESET’s Live Grid® (a cloud-based malware collection system utilizing\ndata from ESET users worldwide). ESET’s research shows that the worm\nsteals AutoCAD drawings and sends them to email accounts located\nin China. ESET has worked with Chinese ISP Tencent, Chinese National\nComputer Virus Emergency Response Center and Autodesk, the creator of\nAutoCAD, to stop the transmission of these files. ESET confirms that tens\nof thousands of AutoCAD drawings, primarily from users in Peru, were\nleaking at the time of the discovery.\n\n“After some configuration, ACAD/Medre.A sends opened AutoCAD\ndrawings by e-mail to a recipient with an e-mail account at the Chinese\n163.com internet provider. It will try to do this using 22 other accounts at\n163.com and 21 accounts at qq.com, another Chinese internet provider.”\n\n“ACAD/Medre.A represents a serious case of possible industrial espionage.\nEvery new design is sent automatically to the operator of this malware.\nNeedless to say this can cost the legitimate owner of the intellectual\nproperty a lot of money as the cybercriminals have access to the designs\neven before they go into production. They may even have the guts to apply\nfor patents on the product before the inventor has registered it at the\npatent office.”\n\n\n-----\n\n## ACAD/Medre.A\n\n#### The Story\n\nThe malware news today is all about new targeted, high-tech, military\ngrade malicious code such as Stuxnet, Duqu and Flamer that have grabbed\nheadlines. So imagine our surprise when an AutoLISP virus, AutoLISP is the\nscripting language that AutoCAD uses, suddenly showed a big spike in one\ncountry on ESET’s Live Grid® two months ago, and this country is Peru.\n\nWe have seen other small number of infections of ACAD/Medre.A in\nother countries, but they are all in countries that are near Peru or have\na large Spanish speaking contingent. The odd one out in the infection\ntable would be the People’s Republic of China, but not quite so weird\nwhen we started to analyze the virus based on this sudden spike. More\nabout China will follow later.\n\nOf course it does not mean much that we see high detection numbers\nbecause they may not all be live infections. But watching ESET’s Live\nGrid®, where we can also see detections at specific URLs, which made\nit clear that a specific website supplied the AutoCAD template that\nappears to be the basis for this localized spike as this template was\nalso infected with ACAD/Medre.A. If it is assumed that companies\nwhich want to do business with the entity have to use this template,\nit seems logical that the malware mainly shows up in Peru and\nneighboring countries. The same is true for larger companies with\naffiliated offices outside this area that have been asked to assist or\nto verify the – by then – infected project and then infecting their own\nenvironment. Other information that is described later also points to\nlive infections\n\n\n-----\n\n## ACAD/Medre.A\n\n#### So what exactly is ACAD/Medre.A?\n\nACAD/Medre.A is a worm written in AutoLISP, a dialect of the LISP\nprogramming language used in AutoCAD.\n\nESET detects it as ACAD/Medre.A worm, however the malware also\nhas characteristics which are attributed to a virus or a trojan. It’s a\nworm, because it aids its spreading by copying its body into the folder\nof any opened AutoCAD drawing on the infected system (similarly to\nthe way worms create autorun.inf entries on removable media), so\nif the user would compress the AutoCAD project folder and send it to\nsomeone else, they would be sending the worm along with it.It’s a\ntrojan, as it mostly relies on the user to - inadvertently, but manually\n– download it onto his system. It sneaks in alongside legitimate\nAutoCAD drawings. Or, in a way, it’s also a virus, as it infects the\ninstalled AutoCAD environment (similarly to the way the Win32/\nInduc virus infected the Delphi environment). But it doesn’t infect\nexecutable files like a common parasitic virus.\n\nBut terminology aside, let’s take a look at what the Medre malware\ndoes.\n\n\n#### Technical Analysis\n\nIn short, the functions carried out by the worm are:\n\n1. Copying itself to various locations: This serves two main purposes: to\n\nensure its repeated execution (i.e. installation) and chance to spread\n(distribution).\n\n2. The malicious payload: Stealing AutoCAD drawings from the infected\n\nsystem.\n\nIn the following text, we’ll document how these tasks are accomplished.\nAlthough the malware is written in AutoLISP, its main functions are\ncarried out by Visual Basic Scripts, which are dropped and executed by the\nVBS interpreter (Wscript.exe) that is integrated in the operating system\nsince Windows 2000. This is shown in the following code snippet, where\nthe VBS script was previously stored to the MK-INFO-BIN variable.\n\n\n-----\n\n## ACAD/Medre.A\n\nACAD/Medre.A (its original filename is acad.fas – the hidden file that\nwas planted alongside a legitimate DWG) tries to copy itself to the\nfollowing locations:\n\n- %windir%\\System32\\Acad.fas\n\n- %windir%\\ Acad.fas\n\n- %current_working_directory_of_DWG%\\cad.fas\n\n- %current_ working_directory_of_DWG%\\acad.fas\n\n- %ACAD_support_directory%\\cad.fas\n\n- %ACAD_support_directory%\\acad.fas\n\nHere’s an example of a VBS script from the worm to perform these\ncopy operations:\n\n\nACAD/Medre.A also modifies the acad20??.lsp file inside the AutoCAD\nSupport directory. First, it checks which version of AutoCAD is\ninstalled, in order to determine the correct filename:\n\n\n-----\n\n## ACAD/Medre.A\n\nInterestingly, the malware authors provide compatibility for AutoCAD\nversions 2000 (14.0) through 2015 (19.2).\n\nOnce the correct filename is determined, the worm tries to locate the\nacad20??.lsp file and add one line of code („(if (findfile „cad.fas“)(load\n„cad.fas“))“) to it:\n\nIf the file is not present, it is created with the following\ncontent:Automating the deobfuscation of these 3 techniques makes it\nmuch easier to understand the behavior of the malware.\n\n\nThe abovementioned actions ensure that the malicious code is executed\nwhenever an AutoCAD drawing (.DWG) is opened on the infected system.\nMore information on automatic loading of AutoLISP routines can be found\nin the official AutoCAD documentation.\n\nIn addition to this, there’s a reason why the script (even when already\nrunning on an infected system) is copied to the directory of the currently\nopened DWG. If the user, would want to send his drawings to someone\nelse, it is likely that he will add the whole directory into an archive and\nsend the worm along with it.\n\n#### Payload\n\nAfter some configuration, ACAD/Medre.A will be sending the different\nAutoCAD drawings (and other information) that are opened by e-mail to a\nrecipient with an e-mail account at the Chinese 163.com internet provider.\nIt will try to do this using one of 22 other accounts at 163.com and one of 21\naccounts at qq.com, another Chinese internet provider. Remarkably, this\nis done by accessing smtp.163.com and smtp.qq.com with the different\naccount credentials. It is ill advised to have port 25 outgoing allowed other\nthan to your own ISP. Obviously the Internet Providers in Peru do allow\nthis. Also it is reasonable to assume that the companies that are a victim\nof this suspected industrial espionage malware do not have their firewalls\nconfigured to block port 25 either.\n\n\n-----\n\n## ACAD/Medre.A\n\n#### Stealing AutoCAD Drawings\n\nThe worm contains two arrays of email account names and\npasswords (22 accounts at 163.com and 21 accounts at qq.com) which\nare set in the From field of the outgoing email and used for SMTP\nauthentication. Here’s a code snippet showing the selection of which\nemail address to use (with the credentials themselves blurred):\n\nNotice the use of CPUTICKS for randomization (the NTH function\nselects the Nth value of an array).\n\n\nThe following figure shows the VBS script responsible for sending the\ndrawing files to the attacker:\n\n\n-----\n\n## ACAD/Medre.A\n\nNote that the variables PRINC-YFMC, PRINC-YJFWQ, PRINC-YFM and\nPRINC-YXMM are filled with values corresponding to the randomly\nselected email address, SMTP server, email username, email password,\nrespectively. VL-FILE-FNAM-H points to the currently opened DWG (it is\nincluded as an attachment and the file path in the email body) and VLINFO-C is a concatenation of the computer name and user name:\n\n#### Other Exfiltrated Data\n\nApart from emailing the stolen AutoCAD drawings, the worm also\ncontains code for stealing e-mail client files, as well as a copy of itself\nand auxiliary information.\n\nACAD/Medre.A can steal Outlook .PST files (Outlook Personal Folders),\nas referenced by the following Registry keys:\n\n- [HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\11.0\\Outlook\\Catalog]\n\n- [HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\12.0\\Outlook\\Catalog]\n\n- [HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\13.0\\Outlook\\Catalog]\n\nand files belonging to the Foxmail email client. The installation directory\nof Foxmail is queried from the Registry entry:\n\n- [HKEY_CURRENT_USER\\Software\\Aerofox\\Foxmail] \"Executable”\n\n\nand the following strings are appended to create paths to the files for\nexfiltration:\n\n- \"\\Address\\Address.INDX“\n\n- \"\\Address\\Address.BOX“\n\n- \"\\Address\\Send.INDX“\n\n- \"\\Address\\Send.BOX“\n\nNote that due to a programming error this part of code may not work.\nThe stealing / emailing mechanism is similar as described above.\n\nLastly, the worm prepares a RAR archive, also to be sent by email.\n\n\n-----\n\n## ACAD/Medre.A\n\nThe contents of the directory compressed in the encrypted RAR\narchive (password = “1”) are:\n\n- Acad.fas (worm body)\n\n- È¤Î¶»úÐµÖÆÍ¼.dxf\n\n(“È¤Î¶»úÐµÖÆÍ¼” is 趣味机械制图 in Chinese encoding).\n\nThe .DXF file (AutoCAD Drawing Exchange Format) is generated by\nACAD/Medre.A and contains metadata regarding the stolen AutoCAD\ndrawing:\n\n\n-----\n\n## ACAD/Medre.A\n\n#### Other Information\n\nACAD/Medre.A uses the following Registry entries to store its internal\ndata, such as timestamps:\n\n- [HKCU\\Software\\Microsoft\\Windows\\Windows Error Reporting]\n\n“FILE”\n“FILE-G”\n“FILE-H”\n“Time”\n\nNote that the [HKCU\\Software\\Microsoft\\Windows\\Windows\nError Reporting] Registry key is a legitimate one, only the 4\nabovementioned entries are used by the malware.\n\nMD5 of the analysed sample: 7b563740f41e495a68b70cbb22980b20\n\n#### The Stolen Data\n\nWhen our analysts looked into the e-mail accounts used by ACAD/\nMedre.A, they noticed that the Inbox for each of them was already\nfull (over 100,000 mails). All of the messages in the Inbox were errormessages as the Inbox of the final recipient is full. And there were still\nalmost 5,000 emails to be sent.\n\n\nAs the path and filename are sent with the attachment, we could\ndo some analysis just based on the location where the drawings\nare stored and their possible content. Our analysis also shows\nthat several people actually use an Administrator Account or store\ntheir projects on the Desktop. The pie-chart does not reflect all the\ndifferent possibilities, just the most frequently used ones.\n\n\n-----\n\n## ACAD/Medre.A\n\nFrom our analysis of all the used e-mail accounts we can derive the scale\nof the attack and conclude that tens of thousands of AutoCAD drawings\n(blueprints) leaked.\n\n\n#### A Call for Further Action…\n\nThis is a significant amount of data leakage and we felt it called for\nfurther action. Upon realisation of the magnitude of the problem ESET\nreached out to Tencent, owners of the qq.com domain. Due to swift\nquick action on the part of Tencent the accounts used for relaying\nthe e-mails with the drawings have been blocked and thus no further\nleakage will occur. We would like to express our appreciation to the\ndistinguished team at Tencent’s Desktop Security Business Division for\ntheir cooperation and their prompt action.\n\nESET has also reached out to CVERC, the Chinese National Computer\nVirus Emergency Response Center, and they also responded quickly by\nword of the First Deputy Director of CVERC, who also assisted in getting\nthe accounts removed.\n\nAfter the discovery of ACAD/Medre.A, ESET decided to make a free\nstand-alone cleaner available. The utility can be found here\n\n[http://download.eset.com/special/EACADMedreCleaner.exe].\nWe established contacts with Autodesk, producers of AutoCAD, who\nimmediately took the problem seriously and full assistance was given.\n\n\n-----\n\n## ACAD/Medre.A\n\n#### Conclusion\n\nACAD/Medre.A is a serious example of suspected industrial espionage.\nEvery new design created by a victim is sent automatically to the\nauthors of this malware. Needless to say this can cost the legitimate\nowner of the intellectual property a lot of money as the cybercriminals\nwill have designs before they even go into production by the original\ndesigner. The attacker may even go so far as to get patents on the\nproduct before the inventor has registered it at the patent office. The\ninventor may not know of the security breach until his patent claim is\ndenied due to prior art.\n\nIf there is one thing that becomes obvious from our experience with this\npiece of malware it is that reaching out to other parties to minimize\ndamage is not only the right thing to do, it really works. We could have\ntried to clean up the problem without the assistance of Autodesk,\nTencent and CVERC and solely focus on removal of the malware from\nthe infected machines. By working with Autodesk, Tencent and CVERC,\nwe were able to not only alert and inform users but also defeat the\ne-mail relay system used by the attackers and deny them access to the\ne-mail boxes, so the damage is now contained.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://www.welivesecurity.com/wp-content/uploads/200x/white-papers/ESET_ACAD_Medre_A_whitepaper.pdf"
    ],
    "report_names": [
        "ESET_ACAD_Medre_A_whitepaper.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716493,
    "ts_updated_at": 1743041143,
    "ts_creation_date": 1340298339,
    "ts_modification_date": 1340298905,
    "files": {
        "pdf": "https://archive.orkl.eu/a27e0a670db551b6c01781233bbe02431e1fcc7a.pdf",
        "text": "https://archive.orkl.eu/a27e0a670db551b6c01781233bbe02431e1fcc7a.txt",
        "img": "https://archive.orkl.eu/a27e0a670db551b6c01781233bbe02431e1fcc7a.jpg"
    }
}