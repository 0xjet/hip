{
    "id": "00985328-e96f-4865-b305-4484b4116ee8",
    "created_at": "2022-10-25T16:48:12.061685Z",
    "updated_at": "2025-03-27T02:17:11.524314Z",
    "deleted_at": null,
    "sha1_hash": "baeb67b65db49abaa6006edff1ab3c2027f6646a",
    "title": "",
    "authors": "",
    "file_creation_date": "2021-10-18T01:35:59Z",
    "file_modification_date": "2021-10-18T01:35:59Z",
    "file_size": 3234103,
    "plain_text": "# A step-by-step analysis of the new malware used by APT28/Sofacy called SkinnyBoy\n\n**cybergeeks.tech/skinnyboy-apt28**\n\nSummary\n\nThe malware extracts configuration information about the machine that it infects using\nthe systeminfo command, and then it retrieves the list of processes by spawning a tasklist\nprocess. The content of the following directories, along with the processes’ output, is\nbase64-encoded and exfiltrated to the C2 server updaterweb[.]com:\n\nDesktop folder\nC:\\Program Files\nC:\\Program Files (x86)\nC:\\Users\\<User>\\AppData\\Roaming\\Microsoft\\Windows\\Start\nMenu\\Programs\\Administrative Tools\nC:\\Users\\<User>\\AppData\\Roaming\nC:\\Users\\<User>\\AppData\\Roaming\\Microsoft\\Windows\\Templates\nC:\\WINDOWS\nC:\\Users\\<User>\\AppData\\Local\\Temp\n\nThe user agent used during the network communication is set to “Opera”, and the\nfollowing is the structure of the POST request: “id=<hostname>#Username#<Serial\nnumber in decimal>&current=1&total=1&data=<data to be exfiltrated>”. The “cmd=y”\ncommand is used to download a DLL file from the C2 server, which is loaded using the\nLoadLibraryW API, and the first ordinal function is executed.\n\nTechnical analysis\n\nSHA256: ae0bc3358fef0ca2a103e694aa556f55a3fed4e98ba57d16f5ae7ad4ad583698\n\nThe DLL has 2 exports (DllEntryPoint and RunMod). We have used rundll32.exe to run\nthe DLL by calling the RunMod function:\n\nFigure 1\n\nThe malware creates an unnamed event object by calling the CreateEventW API:\n\n\n-----\n\nFigure 2\n\nTwo new threads are created by the process using the CreateThread function:\n\nFigure 3\n\nFigure 4\n\nThe GetMessage routine is utilized to retrieve a message from the thread’s message\nqueue:\n\nFigure 5\n\nThe malicious process enumerates all the messages, and it breaks the loop if the message\nis equal to 0x16 (WM_ENDSESSION – inform the application whether the session is\nending):\n\n\n-----\n\nFigure 6\n\n**Thread activity – StartAddress function**\n\nThe malware creates an anonymous pipe using the CreatePipe API:\n\nFigure 7\n\nGetStartupInfoA is used to retrieve the content of the STARTUPINFO structure from\nwhen the calling process was created:\n\nFigure 8\n\n\n-----\n\nThe binary creates a new process that runs the systeminfo command, which displays\nconfiguration information about the computer and its OS:\n\nFigure 9\n\nThe pipe created earlier is used as an inter-process communication mechanism. The\noutput of the systeminfo command is read via a ReadFile function call:\n\nFigure 10\n\nFigure 11\n\nThe list of processes is retrieved by creating a new process that runs the tasklist\ncommand:\n\n\n-----\n\nFigure 12\n\nThe output of the tasklist command is transmitted to the main process using the ReadFile\nAPI:\n\nFigure 13\n\nFigure 14\n\nThe binary gets the path of the Desktop folder using the SHGetFolderPathW routine:\n\nFigure 15\n\nThe process enumerates the files/directories from the Desktop directory using the\nFindFirstFileW and FindNextFileW functions:\n\n\n-----\n\nFigure 16\n\nFigure 17\n\nThe binary adds 18 characters of “#” before and after the folder name, as following:\n\nFigure 18\n\nThe list of files and directories extracted before is concatenated with the above string, as\nshown in figure 19:\n\nFigure 19\n\nThe following directories are also targeted by the backdoor: “C:\\Program Files”,\n“C:\\Program Files (x86)”, “C:\\Users\\\n<User>\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Administrative\nTools”, “C:\\Users\\<User>\\AppData\\Roaming”, “C:\\Users\\\n<User>\\AppData\\Roaming\\Microsoft\\Windows\\Templates”, “C:\\WINDOWS” and\n“C:\\Users\\<User>\\AppData\\Local\\Temp”. The SHGetFolderPathW function is utilized\nto obtain some of these folder names (0x2a = CSIDL_PROGRAM_FILESX86, 0x30 =\n**CSIDL_ADMINTOOLS, 0x1a = CSIDL_APPDATA, 0x15 = CSIDL_TEMPLATES**\nand 0x24 = CSIDL_WINDOWS):\n\n\n-----\n\nFigure 20\n\nFigure 21\n\nFigure 22\n\nFigure 23\n\nFigure 24\n\nThe GetTempPathW API is utilized to retrieve the path of the %TEMP% directory:\n\nFigure 25\n\nThe file initializes the use of the WinINet functions using the InternetOpenW API (the\nuser agent is hard-coded as “Opera”):\n\n\n-----\n\nFigure 26\n\nThe send and receive timeouts are set to 600 seconds using the InternetSetOptionW\nroutine (0x6 = INTERNET_OPTION_CONTROL_RECEIVE_TIMEOUT and 0x5\n= INTERNET_OPTION_CONTROL_SEND_TIMEOUT):\n\nFigure 27\n\nFigure 28\n\nThe malicious process establishes a connection to the C2 server updaterweb[.]com on\nport 443:\n\nFigure 29\n\nThe NetBIOS name of the local computer is retrieved using the GetComputerNameA API:\n\nFigure 30\n\n\n-----\n\nGetUserNameA is utilized to extract the name of the user associated with the current\nthread:\n\nFigure 31\n\nThe malware extracts the volume serial number of the root of the current directory via a\nfunction call to GetVolumeInformationW:\n\nFigure 32\n\nThe process decrypts some important strings using the XOR algorithm, the keys being\n“CEJ&V%$84k839y92m” and “qpzoamxiendufbtbf3-#$*40fvnpwOPDwdkvn”. The\nstrings “id=%s#%s#%u&cmd=y” and “id=%s#%s#%u&current=%s&total=%s&data=”\nhave been computed:\n\nFigure 33\n\n\n-----\n\nFigure 34\n\nThe output of the systeminfo command + output of the tasklist command + the list of\ntargeted directories and their content are base-64 encoded using the\nCryptBinaryToStringA API (0x1 = CRYPT_STRING_BASE64):\n\nFigure 35\n\nFigure 36\n\nThe HttpOpenRequestW routine is utilized to create an HTTP POST request handle:\n\n\n-----\n\nFigure 37\n\nThe malware adds one HTTP request header (“application/x-www-form-urlencoded”) to\nthe HTTP request handle:\n\nFigure 38\n\nThe request is sent to the HTTP server using the HttpSendRequestExW API, as displayed\nin figure 39:\n\nFigure 39\n\nIn the case of failing to connect to the C2 server on port 443, the process tries to connect\non port 80:\n\nFigure 40\n\nThe information extracted before is exfiltrated to the C2 server (id=\n<hostname>#Username#<Serial number in decimal>&current=1&total=1&data=<base64 encoded data computed above>):\n\n\n-----\n\nFigure 41\n\nThe thread sets the event created earlier to the signaled state:\n\nFigure 42\n\n**Thread activity – sub_6BD71960** **function**\n\nThis thread sets the event created earlier now to the nonsignaled state using the\nResetEvent routine:\n\nFigure 43\n\nThere is a similar workflow starting with calling the InternetOpenW function up until\nconnecting to the C2 server on port 443 (or port 80 if the first one is unsuccessful). The\nPOST request is different this time because it contains the “cmd=y” command that is used\nto download a DLL file:\n\nFigure 44\n\nThe malware queries the server to determine the amount of data available using the\nInternetQueryDataAvailable routine:\n\nFigure 45\n\n\n-----\n\nThe potential DLL file is read from the handle using the InternetReadFile API (the first 4\nbytes would represent the data size and there will also be 32 bytes that represent the\nSHA256 hash value of the content, as we’ll describe in the upcoming paragraphs):\n\nFigure 46\n\nThe expected DLL is base64-encoded because the process tries to decode it using the\nCryptStringToBinaryA function (0x1 = CRYPT_STRING_BASE64):\n\nFigure 47\n\nFigure 48\n\nCryptAcquireContextA is utilized to acquire a handle to the Microsoft RSA and AES\nCryptographic Provider (0x18 = PROV_RSA_AES):\n\nFigure 49\n\nThe CryptCreateHash routine is used to create a handle to a CSP (cryptographic service\nprovider) hash object (0x800c = CALG_SHA_256):\n\n\n-----\n\nFigure 50\n\nAfter the base64-encoded DLL file is decoded, then the malware hashes the buffer that is\nsupposed to contain a DLL file using the SHA256 algorithm:\n\nFigure 51\n\nThe hash value is extracted by calling the CryptGetHashParam API, as shown in figure 52\n(0x2 = HP_HASHVAL):\n\nFigure 52\n\nFigure 53\n\nThe malicious process verifies if the hash value computed above coincides with a 32-byte\nbuffer that comes with the DLL file (of course that the response is emulated in our case,\nbut we can adjust it to pass the comparison):\n\nFigure 54\n\n\n-----\n\nFigure 55\n\nGetTempPathW is utilized to retrieve the path of the %TEMP% directory:\n\nFigure 56\n\nThe malicious process creates a file called fvjoik.dll in the %TEMP% directory, as shown\nbelow:\n\nFigure 57\n\nThe newly created file is populated with the potential DLL downloaded from the C2\nserver:\n\nFigure 58\n\nThe DLL file is loaded into the address space of the current process using the\nLoadLibraryW routine:\n\nFigure 59\n\n\n-----\n\nThe malware will execute the exported function with ordinal 1, as highlighted in the next\nfigure:\n\nFigure 60\n\nAfter the function finishes, there is a call to WinExec that deletes the DLL file created\nearlier:\n\nFigure 61\n\nThe process communicates again with the C2 server, and we believe that it transmits the\nresult of the DLL execution (we won’t go into too much details here because it’s pretty\nmuch the same activity described so far). The parameters of the request are again as\nfollows: “id=<hostname>#Username#<Serial number in\ndecimal>&current=1&total=1&data=<data to be transmitted>”.\n\n**Main thread activity**\n\nThe main thread sets the event created before to the signaled state:\n\nFigure 62\n\nThe malware retrieves the termination status of the 2 threads using the\nGetExitCodeThread API:\n\nFigure 63\n\n\n-----\n\nFigure 64\n\nReferences\n\n[MSDN: https://docs.microsoft.com/en-us/windows/win32/api/](https://docs.microsoft.com/en-us/windows/win32/api/)\n\nVirusTotal:\nhttps://www.virustotal.com/gui/file/ae0bc3358fef0ca2a103e694aa556f55a3fed4e98ba5\n7d16f5ae7ad4ad583698/detection\n\n[Fakenet: https://github.com/fireeye/flare-fakenet-ng](https://github.com/fireeye/flare-fakenet-ng)\n\n[Cluster25: https://cluster25.io/wp-content/uploads/2021/05/2021-05_FancyBear.pdf](https://cluster25.io/wp-content/uploads/2021/05/2021-05_FancyBear.pdf)\n\nINDICATORS OF COMPROMISE\n\nC2 server: updaterweb[.]com\n\nSHA256: ae0bc3358fef0ca2a103e694aa556f55a3fed4e98ba57d16f5ae7ad4ad583698\n\nUser-Agent: Opera\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2021/2021.08.03.SKINNYBOY/A%20step-by-step%20analysis%20of%20the%20new%20malware%20used%20by%20APT28_Sofacy%20called%20SkinnyBoy%20%E2%80%93%20CYBER%20GEEKS.pdf"
    ],
    "report_names": [
        "A step-by-step analysis of the new malware used by APT28_Sofacy called SkinnyBoy – CYBER GEEKS"
    ],
    "threat_actors": [
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716492,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1634520959,
    "ts_modification_date": 1634520959,
    "files": {
        "pdf": "https://archive.orkl.eu/baeb67b65db49abaa6006edff1ab3c2027f6646a.pdf",
        "text": "https://archive.orkl.eu/baeb67b65db49abaa6006edff1ab3c2027f6646a.txt",
        "img": "https://archive.orkl.eu/baeb67b65db49abaa6006edff1ab3c2027f6646a.jpg"
    }
}