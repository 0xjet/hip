{
    "id": "c891b81d-66fd-4adc-bd78-23cfce739ffc",
    "created_at": "2023-01-12T14:59:35.439247Z",
    "updated_at": "2025-03-27T02:17:01.069953Z",
    "deleted_at": null,
    "sha1_hash": "824cd9bcffbdcfe5dce4d7e3a7e2ca44100450fd",
    "title": "2021-01-13 - Gitlab RCE Stealth Shellbot",
    "authors": "",
    "file_creation_date": "2022-05-28T19:49:27Z",
    "file_modification_date": "2022-05-28T19:49:27Z",
    "file_size": 214987,
    "plain_text": "# Gitlab RCE Stealth Shellbot\n\n**brianstadnicki.github.io/posts/malware-gitlab-perlbot/**\n\nBrian Stadnicki January 13, 2022\n\n[Brian Stadnicki included in malware analysis](https://brianstadnicki.github.io/)\n2022-01-13 408 words  2 minutes\n\n[Last year, a major RCE was found in GitLab, CVE-2021-22205, where GitLab versions >=](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-22205)\n11.9 and <13.10.3 were affected due to improper image validation before passing it to a file\nparser.\n\n## Malicious image\n\nThe [DjVu image is considered a legacy format, so not much attention has been paid to it.](http://fileformats.archiveteam.org/wiki/DjVu)\nThe GitLab RCE depends on a vulnerability in ExifTool, [CVE-2021-22204, where improper](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-22204)\nparsing of annotations, including a dangerous `eval to add quotes to a string, caused an`\n[RCE. A patch was created on the 13th April 2021 in this commit.](https://github.com/exiftool/exiftool/commit/cf0f4e7dcd024ca99615bfd1102a841a25dde031#diff-fa0d652d10dbcd246e6b1df16c1e992931d3bb717a7e36157596b76bdadb3800L233)\n\n## Loader script\n\n### Temporary memory file system\n\nThe script clears the temporary memory file system and creates the folder\n```\n/dev/shm/kthzabor, which is an attempt to prevent the kthzabor mining malware from\n\n```\nworking.\n\n### Process killing\n\n**Hardcoded list**\n\nMany processes are attempted to be killed, such as databases, miners, various other\nmalware, task managers and both defensive and offensive security tools.\n\n\n-----\n\n**PBot**\n```\npbotbyjanhotzu is likely a competing malware, but it doesn’t appear to have been\n\n```\nreported on.\n\n**Network server killing**\n\nAny processes listening on ports associated with mining malware are also killed.\n\n**Mining malware killing**\n\n[Processes with names possibly linked to mining malware such as sysrv-hello are killed.](https://www.lacework.com/blog/sysrv-hello-expands-infrastructure/)\nMining processes are often very simply, where a regular script is executed with the pool ip\naddress as an argument, so these are also killed.\n\n**Payload execution**\n\nFinally a perl script is fetched and executed.\n\n## Payload\n\n\n-----\n\nThe payload itself appears to be called Stealth Shellbot, which appears to have been in use\n[since at least the 23rd Nov 2015. It appears to be adapted from “ShellBOT”, found on github.](https://github.com/Shadow-Network/perl-scripts/blob/master/Stealth%20ShellBot%20Verson%200.2.pl)\nThe authors may be Portuguese.\n\n### Connection\n\nThe bot connects to an IRC server and joins a channel.\n\n### Commands\n\n**Command** **Action**\n\nVERSION Sends back the bot version\n\nPING Sends back PONG\n\nportscan Scans ports 21, 22, 23, 25, 53, 80, 110, 143 on a host\n\ndownload Downloads a payload\n\nfullportscan Scans a port range on a host\n\nudp UDP flood\n\nudpfaixa UDP range flood\n\nconback Opens a reverse shell\n\noldpack Sends back a status message\n\n### Evasion\n\nThe main evasion technique used is changing the process name to\n“/usr/local/apache/bin/httpd -DSSL”\n\n\n-----\n\n## IOCs\n\nHash:\n\n0d00200acb2caf4e2bc52285795bb13cb916fc051550c8e9dd3a19897068a494\n9e52e0b8a9d3a3de2159c03974f0b778fe4c910fa09e7084435031f34cc0ff0e\n7b4ef0d14bec12844653b4dbaed7db96bcdd04bbc755d4b42970a065a9a3886d\n\nURL:\n\nhttp://82.165.155.100/san\nhttp://82.165.155.100/ba.sh\n\nProcesses killed:\n\nmysqldd\nmonero\nkinsing\nsshpass\nsshexec\nattack\ndovecat\nkthzabor\ndonate\n‘scan.log’\nxmr-stak\ncrond64\nstratum\n/tmp/java\npastebin\n/tmp/system\nexcludefile\nagettyd\n/var/tmp\n‘./python’\n‘./crun’\n‘./.’\n‘118/cf.sh’\n‘.6379’\n’load.sh'\n‘init.sh’\n\n\n-----\n\nsolr.sh\n‘.rsyslogds’\npnscan\nmasscan\nkthreaddi\nsysguard\nkthreaddk\nkdevtmpfsi\nnetworkservice\nsysupdate\nphpguard\nphpupdate\nnetworkmanager\nknthread\nmysqlserver\nwatchbog\nxmrig\n/dev/shm\npbotbyjanhotzu\nldr.sh\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-13 - Gitlab RCE Stealth Shellbot.pdf"
    ],
    "report_names": [
        "2021-01-13 - Gitlab RCE Stealth Shellbot.pdf"
    ],
    "threat_actors": [
        {
            "id": "c398d083-1e86-4cee-8937-eb057f0e6fdc",
            "created_at": "2022-10-25T16:07:24.172423Z",
            "updated_at": "2025-03-27T02:02:10.130733Z",
            "deleted_at": null,
            "main_name": "Shadow Network",
            "aliases": [],
            "source_name": "ETDA:Shadow Network",
            "tools": [
                "ShadowNet"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "32a223a8-3c79-4146-87c5-8557d38662ae",
            "created_at": "2022-10-25T15:50:23.703698Z",
            "updated_at": "2025-03-27T02:00:55.528031Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Lazarus Group",
                "Labyrinth Chollima",
                "HIDDEN COBRA",
                "Guardians of Peace",
                "NICKEL ACADEMY",
                "Diamond Sleet"
            ],
            "source_name": "MITRE:Lazarus Group",
            "tools": [
                "RawDisk",
                "Proxysvc",
                "BADCALL",
                "FALLCHILL",
                "WannaCry",
                "HOPLIGHT",
                "TYPEFRAME",
                "Dtrack",
                "HotCroissant",
                "HARDRAIN",
                "Dacls",
                "KEYMARBLE",
                "TAINTEDSCRIBE",
                "AuditCred",
                "netsh",
                "ECCENTRICBANDWAGON",
                "AppleJeus",
                "BLINDINGCAN",
                "ThreatNeedle",
                "Volgmer",
                "Cryptoistic",
                "RATANKBA",
                "Bankshot",
                "Torisma",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "172e5e21-e954-4322-9317-41f2cbaed7f1",
            "created_at": "2023-01-06T13:46:38.992713Z",
            "updated_at": "2025-03-27T02:00:02.971877Z",
            "deleted_at": null,
            "main_name": "Shadow Network",
            "aliases": [],
            "source_name": "MISPGALAXY:Shadow Network",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a6c351ea-01f1-4c9b-af75-cfbb3b269ed3",
            "created_at": "2023-01-06T13:46:39.390649Z",
            "updated_at": "2025-03-27T02:00:03.072899Z",
            "deleted_at": null,
            "main_name": "Kinsing",
            "aliases": [
                "Money Libra"
            ],
            "source_name": "MISPGALAXY:Kinsing",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535575,
    "ts_updated_at": 1743041821,
    "ts_creation_date": 1653767367,
    "ts_modification_date": 1653767367,
    "files": {
        "pdf": "https://archive.orkl.eu/824cd9bcffbdcfe5dce4d7e3a7e2ca44100450fd.pdf",
        "text": "https://archive.orkl.eu/824cd9bcffbdcfe5dce4d7e3a7e2ca44100450fd.txt",
        "img": "https://archive.orkl.eu/824cd9bcffbdcfe5dce4d7e3a7e2ca44100450fd.jpg"
    }
}