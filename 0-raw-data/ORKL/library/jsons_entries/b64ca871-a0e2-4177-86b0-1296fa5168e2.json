{
    "id": "b64ca871-a0e2-4177-86b0-1296fa5168e2",
    "created_at": "2022-10-25T16:48:24.77318Z",
    "updated_at": "2025-03-27T02:05:41.380946Z",
    "deleted_at": null,
    "sha1_hash": "bf791907d880bddae90894ed89b4b453d0c11498",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-10-02T14:34:36Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 781283,
    "plain_text": "# SUPPLY CHAIN ATTACKS\n\n### THREATS TARGETING SERVICE PROVIDERS AND DESIGN OFFICES\n\n###### Version 1.0 October 7th 2019\n\n\n-----\n\nSupply chain attacks\n## Table of contents\n\n**1** **Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .** **3**\n\n**2** **Attack chain . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .** **3**\n2.1 Initial access . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3\n2.2 Access and persistence . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3\n2.3 Privilege escalation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3\n2.4 Lateral movement . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3\n2.5 Objectives . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3\n2.6 Operational security . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4\n\n**3** **Tools and malwares . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .** **4**\n3.1 Custom malware . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4\n3.2 Legitimate tools . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4\n\n**4** **Detection methods for these attackers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .** **4**\n4.1 VPN connections . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4\n4.1.1 Source of connection . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4\n4.1.2 MAC address of the attackers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5\n4.1.3 Incoherent user accounts . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5\n4.2 System indicators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5\n4.2.1 Uncommon folders . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5\n\n**5** **Recommendations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .** **6**\n5.1 For service providers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6\n5.2 For clients . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6\n\n**6** **Appendix: PlugX . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .** **7**\n6.1 Description . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7\n6.2 SNORT rules . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7\n\nOctober 7th 2019 Page 2 of 8\n\n\n-----\n\nSupply chain attacks\n\n### 1 Introduction\n\nThis document aims at warning about a cyber threat targeting service providers and design offices. Attackers are\ncompromising these enterprise networks in order to access data and eventually the networks of their clients.\nInformation provided in this report is based on ANSSI’s investigations following incident response activities. At this\npoint, analysis suggests two waves of attacks separated in time and without technical evidence of a link between\nthem. The first wave uses mainly the PlugX malware. The second wave relies on legitimate tools and credentials\ntheft.\nThis document focuses on the second and most recent wave and the intrusion set[1] involved in it. Appendix only\nfocuses on the PlugX malware (chapter 6).\n\n### 2 Attack chain\n\n#### 2.1 Initial access\n\nTo gain initial foothold on targeted networks, the attackers exploit vulnerabilities on low-secured services exposed\non the Internet, discovered through scanning with tools like Acunetix. Other methods may also be used such as\nphishing emails or usage of leaked credentials.\n\n#### 2.2 Access and persistence\n\nTo access the targeted networks after initial compromise, the attackers use legitimate VPN credentials that have\nprobably been stolen on the victim’s network.\nThe attackers may use other methods such as installed RATs (Remote Access Tool) or other backdoors like webshells,\nas demonstrated during former intrusions using PlugX malwares.\n\n#### 2.3 Privilege escalation\n\nIn order to acquire higher privileges on victim’s machines, the attackers use legitimate tools such as ProcDump or\n**Certmig (see section 3.2). Administrator accounts with a naming pattern incoherent with the usual patterns used**\nby the victims have been observed on targeted networks (for instance an account named « aaaa »).\n\n#### 2.4 Lateral movement\n\nRDP connections with stolen credentials are mainly used by the attackers to move inside the compromised network,\nas well as Netscan commands and WMIExec scripts.\n\n#### 2.5 Objectives\n\nThe first objective of the attackers seem to be the understanding of the network configuration and its external\nauthenticated connections to clients.\nAfter such information is acquired, the attackers move to the client network in order to gather relevant information.\nThis information can be exfiltrated through the service provider or the client network.\n\n1Characteristic tools, tactics, techniques and procedures (TTPs) used by one or several malicious actors accross one or several attack campaigns.\nIt can be seen as an identity card of a threat which should not be confused with an attacker or group of attackers linked to a broader concept\ninvolving individuals and physical organisations.\n\nOctober 7th 2019 Page 3 of 8\n\n\n-----\n\nSupply chain attacks\n#### 2.6 Operational security\n\nEven if the sophistication of the tools used by the attackers is quite low, they are well organised in the deletion and\nthe deactivation of all activity logs on devices they visit.\nIncoming connections of the attackers are anonymized through IP addresses belonging to VPN providers or TOR\nnetwork.\n\n### 3 Tools and malwares\n\n#### 3.1 Custom malware\n\nIn addition to all legitimate tools described below, the attackers use a custom piece of malware they may have\ndevelopped.\nThis custom malware is designed to monitor the web browsers of a victim. This enables the gathering of credentials\nand session cookies. This malware communicates with a C2 server through HTTP or HTTPS.\n\n#### 3.2 Legitimate tools\n\nThe attackers have used the following legitimate tools:\n\n  - ProcDump: command-line tool used to monitor a running process and dump memory depending on custom\ncriteria. The attackers use this tool to dump the LSASS process to gather WINDOWS credentials hashes;\n\n  - CertMig: command-line tool used to import and export certificates on a machine. The attackers use this tool\nto gather credentials used for VPN authentication to the clients’ networks;\n\n  - WMIExec.vbs: tool used to remotely administrate a machine in VBScript with functionalities similar to Sys**Internals PsExec;**\n\n  - rar.exe: command-line version of the file compression utility WINRAR. The attackers use this tool to compress,\nprotect and split both exfiltrated data and imported toolset;\n\n  - MimiKatz: tool used for diverse actions on a WINDOWS system such as injection of libraries, process tampering\nand credential dumping;\n\n  - Netscan: tool used to scan IPv4/IPv6 networks and remotely execute PowerShell commands.\n\n### 4 Detection methods for these attackers\n\nIn observed incidents, attackers have mainly used legitimate credentials and tools. IOC-based detection is therefore\nunefficient in this case.\nThe following rules do not give a full certainty on the attackers presence on an information system but matching\ncircumstances should be investigated as a potential compromise.\n\n#### 4.1 VPN connections\n\n##### 4.1.1 Source of connection\n\nThe attackers mainly rely on commercial VPN services as well as the TOR network to anonymize their incoming\nconnections.\nIn most cases, IP addresses of VPN clients have Whois records linked to popular commercial VPN services used for\nweb navigation (HTTP/HTTPS) and emails (SMTP/SMTPS).\n\nOctober 7th 2019 Page 4 of 8\n\n\n-----\n\nSupply chain attacks\n\nHowever, users connecting to a company VPN through a commercial VPN exit node or a TOR node is an anomaly.\n\n**Detection rule: look for incoming connections in VPN or VDI logs with a source which is an exit node in the**\nfollowing table. This list is not comprehensive.\n\nIP addresses\n\n45.41.134.0/24 45.41.136.0/24 45.41.144.0/24 45.41.145.0/24 45.41.147.0/24\n\n45.41.180.0/24 45.56.136.0/24 45.56.140.0/24 45.56.141.0/24 45.56.142.0/24\n\n45.56.143.0/24 45.56.146.0/24 45.56.148.0/24 45.56.149.0/24 45.56.150.0/24\n\n45.56.151.0/24 45.56.152.0/24 45.56.153.0/24 45.56.154.0/24 45.56.155.0/24\n\n45.56.156.0/24 45.56.157.0/24 45.56.158.0/24 45.56.183.0/24 46.244.28.0/24\n\n64.64.108.0/24 64.64.123.0/24 85.203.23.0/24 104.143.84.0/24 104.143.92.0/24\n\n104.143.95.0/24 104.194.203.0/24 104.194.218.0/24 104.194.220.0/24 104.238.45.0/24\n\n104.238.51.0/24 104.238.58.0/24 104.238.59.0/24 104.238.62.0/24 104.37.30.0/24\n\n104.37.31.0/24 157.97.121.0/24 173.239.195.0/24 173.239.197.0/24 173.239.198.0/24\n\n173.239.199.0/24 173.239.207.0/24 173.244.55.0/24 185.198.240.0/24 191.101.252.0/24\n\n##### 4.1.2 MAC address of the attackers\n\nIn some cases, the MAC address of the source machine is recorded in VPN logs.\nIn most cases observed during these attack campaigns, the attackers have used VMWARE virtual machines to connect\nto their victims.\nIf this information is logged and depending on the usages of VMWARE inside a company, incoming connections\nwith VMWARE MAC addresses may be linked to an attack.\n\n**Detection rule: look for VPN connections with a client network interface MAC address starting with a VMWARE**\nattributed prefix.\n\nPrefix\n\n00:0c:29\n\n00:50:56\n\n00:1C:14\n\n00:05:69\n\n##### 4.1.3 Incoherent user accounts\n\nThe attackers are using legitimate credentials to connect to the victim’s VPN endpoint and computers. Interestingly, they are using different accounts for the VPN authentication and for the WINDOWS domain authentication.\nThis is an anomaly for most companies. Looking for users using a different account for the domain authentication\ncompared to the one used for the VPN authentication has uncovered most of the hostile connections.\n\n**Detection rule: among IP addresses assigned to the VPN which are authenticating on the WINDOWS domain, look**\nfor a different identity than the one used on the VPN.\n\n#### 4.2 System indicators\n\n##### 4.2.1 Uncommon folders\n\nThe attackers have mainly used two types of folders to save tools and archives.\nThe first category contains folders named as antivirus software installation folders such as:\n\n  - \\ProgramData\\ESETOEM\n\n  - \\ProgramData\\McAfeeOEM\n\nThe second category contains folders existing for most MICROSOFT WINDOWS installations but which should not\ncontain any executables or RAR archives such as:\n\nOctober 7th 2019 Page 5 of 8\n\n\n-----\n\nSupply chain attacks\n\n  - \\ProgramData\n\n  - c:\\windows\\AppPatch\n\n  - c:\\PerfLogs and subfolders.\n\nGenerally speaking, having these types of files in these folders is an anomaly and should be investigated.\n\n**Detection rule: look for executables or archives (Zip, RAR) created in folders**\n```\n\\ProgramData\\ESETOEM, \\ProgramData\\McAfeeOEM, \\ProgramData or c:\\PerfLogs.\n\n###### Setup of network port forwardings\n\n```\nThe attackers have used the WINDOWS firewall to set up port forwarding between their entry point and their final\nvictim.\nTo do so, the netsh command has been used as follows:\n\n```\nnetsh interface portproxy add v4tov4 listenport =443 connectaddress =XXX.XXX.XXX.XXX connectport =443\n\n```\n\nThis command will set up a forward on port TCP/443 from the compromised workstation to the target XXX.XXX.XXX.XXX\non port TCP/443.\nWhen this command is executed, it will create and set a registry key.\nInterestingly, when the configuration is later disabled, the key content is erased, but the key is not deleted.\nThis kind of configuration is rare in WINDOWS environments. Looking for machines where this key is positioned\nhas been a reliable indicator of compromise.\n\n**Detection rule: look for the registry key HKLM\\SYSTEM\\ControlSet{0,n}\\services\\PortProxy\\v4tov4 on WIN-**\nDOWS machines.\n\n### 5 Recommendations\n\n#### 5.1 For service providers\n\nIn order to prevent as much as possible these incidents, ANSSI recommends the following best practices to service\nproviders and design offices:\n\n[• Use secure administration methods on IT systems (ANSSI’s recommendations to secure administration of IT](https://www.ssi.gouv.fr/en/guide/secure-admin-is/)\n[systems);](https://www.ssi.gouv.fr/en/guide/secure-admin-is/)\n\n  - Set up a security monitoring capability;\n\n  - Make a list of connections with clients and monitor them;\n\n  - Segregate clients between them.\n\n#### 5.2 For clients\n\nIn order to prevent as much as possible these incidents, ANSSI recommends the following best practices to clients\nof service providers:\n\n[• Use secure administration methods on IT systems (ANSSI’s recommendations to secure administration of IT](https://www.ssi.gouv.fr/en/guide/secure-admin-is/)\n[systems);](https://www.ssi.gouv.fr/en/guide/secure-admin-is/)\n\n  - Set up a security monitoring capability;\n\n  - Make a list of connections with service providers and monitor them;\n\n  - Apply a least privilege model to accesses given to external entities (accounts, connections, trust relashionships).\n\nOctober 7th 2019 Page 6 of 8\n\n\n-----\n\nSupply chain attacks\n\n### 6 Appendix: PlugX\n\n**PlugX malware has only been observed during the first wave of attack. As a reminder, ANSSI is not able to link**\nthis phase with the second one for now.\n\n#### 6.1 Description\n\n**PlugX is a malware family also known as KorPlug, SOGU, Scontroller, etc. The main function of this malware is**\nto take control of a remote host. System artefacts observed show that the DLL sideloading method is used to load\nthe malware in the host memory.\n\n#### 6.2 SNORT rules\n\n[The following SNORT rules detect communications linked to PlugX version 2 (source : https://www.us-cert.](https://www.us-cert.gov/ncas/alerts/TA17-117A)\n```\ngov/ncas/alerts/TA17-117A):\n\n```\n```\nalert tcp any any -> any any (msg:\"Non-Std TCP Client Traffic contains 'HX1|3a|' 'HX2|3a|' 'HX3|3a|' 'HX4|3a|' (PLUGX\n\n```\n```\nVariant)\"; sid:XX; rev :1; flow:established,to_server; content:\"Accept|3a 20 2a 2f 2a|\"; nocase; content:\"HX1|3a|\"\n; distance :0; within :6; fast_pattern; content:\"HX2|3a|\"; nocase; distance :0; content:\"HX3|3a|\"; nocase; distance\n:0; content:\"HX4|3a|\"; nocase; distance :0; classtype:nonstd -tcp; priority:X;)\n\n```\n```\nalert tcp any any -> any any (msg:\"Non-Std TCP Client Traffic contains 'X-Session|3a|''X-Status|3a|''X-Size|3a|''X-Sn\n\n```\n```\n|3a|'(PLUGX)\"; sid:XX; rev :1; flow:established,to_server; content:\"X-Session|3a|\"; nocase; fast_pattern; content:\n\"X-Status|3a|\"; nocase; distance :0; content:\"X-Size|3a|\"; nocase; distance :0; content:\"X-Sn|3a|\"; nocase;\ndistance :0; classtype:nonstd -tcp; priority:X;)\n\n```\n```\nalert tcp any any -> any any (msg:\"Non-Std TCP Client Traffic contains 'MJ1X|3a|' 'MJ2X|3a|' 'MJ3X|3a|' 'MJ4X|3a|' (\n\n```\n```\nPLUGX Variant)\"; sid:XX; rev :1; flow:established,to_server; content:\"MJ1X|3a|\"; nocase; fast_pattern; content:\"\nMJ2X|3a|\"; nocase; distance :0; content:\"MJ3X|3a|\"; nocase; distance :0; content:\"MJ4X|3a|\"; nocase; distance :0;\nclasstype:nonstd -tcp; priority:X;)\n\n```\n```\nalert tcp any any -> any any (msg:\"Non-Std TCP Client Traffic contains 'Cookies|3a|' 'Sym1|2e|' '|2c|Sym2|2e|' '|2c|\n\n```\n```\n   Sym3|2e|' '|2c|Sym4|2e|' (Chches Variant)\"; sid:XX; rev :1; flow:established,to_server; content:\"Cookies|3a|\";\n   nocase; content:\"Sym1|2e|0|3a|\"; nocase; distance :0; fast_pattern; content:\"|2c|Sym2|2e|\"; nocase; distance :0;\n   content:\"|2c|Sym3|2e|\"; nocase; distance :0; content:\"|2c|Sym4|2e|\"; nocase; distance :0; classtype:nonstd -tcp;\n   priority:X;)\n\n```\nOctober 7th 2019 Page 7 of 8\n\n\n-----\n\nVersion 1.0 - October 7th 2019\nOpen License (Étalab - v2.0)\n\n**AGENCE NATIONALE DE LA SÉCURITÉ DES SYSTÈMES D’INFORMATION**\n\nANSSI - 51 boulevard de la Tour-Maubourg, 75700 PARIS 07 SP\nwww.cert.ssi.gouv.fr / cert-fr.cossi@ssi.gouv.fr\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "99593a68-7f6e-400e-9a9f-a707f66d2e72",
            "created_at": "2022-11-23T11:07:14.353321Z",
            "updated_at": "2022-11-23T11:07:14.353321Z",
            "deleted_at": null,
            "name": "AGRO",
            "url": "https://apt.threattracking.com",
            "description": "APT Groups and Operations Spreadsheet",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.10.07.Supply_Chain_Attacks/CERTFR-2019-CTI-005.pdf",
        "https://www.cert.ssi.gouv.fr/uploads/CERTFR-2019-CTI-005.pdf"
    ],
    "report_names": [
        "CERTFR-2019-CTI-005",
        "CERTFR-2019-CTI-005.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041141,
    "ts_creation_date": 1570026876,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/bf791907d880bddae90894ed89b4b453d0c11498.pdf",
        "text": "https://archive.orkl.eu/bf791907d880bddae90894ed89b4b453d0c11498.txt",
        "img": "https://archive.orkl.eu/bf791907d880bddae90894ed89b4b453d0c11498.jpg"
    }
}