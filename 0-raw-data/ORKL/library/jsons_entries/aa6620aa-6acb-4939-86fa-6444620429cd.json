{
    "id": "aa6620aa-6acb-4939-86fa-6444620429cd",
    "created_at": "2022-10-25T16:48:12.360179Z",
    "updated_at": "2025-03-27T02:17:11.659928Z",
    "deleted_at": null,
    "sha1_hash": "61c759fab05cb341d84f825452ad17cbcfb23c31",
    "title": "New Sofacy Attacks Against US Government Agency",
    "authors": "Palo Alto",
    "file_creation_date": "2016-06-17T12:28:36Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 188098,
    "plain_text": "**researchcenter.paloaltonetworks.com/2016/06/unit42-new-sofacy-attacks-against-us-government-agency/**\n\nThe Sofacy group, also known as APT28, is a well-known threat group that frequently conducts cyber espionage\ncampaigns. Recently, Unit 42 identified a spear phishing e-mail from the Sofacy group that targeted the United\nStates government. The e-mail was sent from a potentially compromised account belonging to the Ministry of\nForeign Affairs of another government entity and carried the Carberp variant of the Sofacy Trojan. The developer\nimplemented a clever persistence mechanism in the Trojan, one which had not been observed in previous attacks.\nThe focus of this blog will be on the attacks and the infrastructure associated with Sofacy using the new persistence\nmechanism as a correlation point.\n\n## The Delivery\n\nOn May 28, 2016, attackers sent a spear-phishing e-mail to a U.S. government entity using an email address\nbelonging to the Ministry of Foreign Affairs of another country. Analysis of the attack revealed a high likelihood that\nthe sender’s email address was not spoofed and is instead a result of a compromised host or account belonging to\nthat Ministry.\n\nThe targeted email had a subject of “FW: Exercise Noble Partner 2016”, which is a reference to a joint NATO\ntraining effort between the United States and Georgia. The email contained an RTF file as an attachment, with the\nfilename “Exercise_Noble_Partner_16.rtf,” reflecting the same training exercise. We have also seen related delivery\ndocuments with filenames that have a Russian military theme (Putin_Is_Being_Pushed_to_Prepare_for_War.rtf and\nRussian anti-Nato troops.rtf), purportedly targeting organizations in Poland according to a blog published by\n[Prevenity.](http://malware.prevenity.com/2016/05/analiza-ataku-z-maja-2016-na-instytucje.html)\n\nThe RTF file is a weaponized document that attempts to exploit CVE-2015-1641 to drop two files to the system,\nspecifically, “btecache.dll” and “svchost.dll”. The “btecache.dll” file is a Trojan that loads and executes “svchost.dll”,\nwhich is a Carberp variant the Sofacy Trojan. Surprisingly, unlike many other espionage actors who display decoy\ndocuments after successful exploitation, this RTF document does not drop or open a decoy document after\nexploiting the vulnerability.\n\nIn the installation process, we observed the delivery document creating a very interesting registry key that it uses for\npersistence to run the Trojan. The path to the “btecache.dll” file is added to the following registry key:\n\n_Software\\Microsoft\\Office test\\Special\\Perf\\: “C:\\Users\\[username]\\AppData\\Roaming\\btecache.dll”_\n\nThis registry key is interesting, because unlike traditional methods of maintaining persistence, it does not\nautomatically run the “btecache.dll” file at system start up. Instead, this registry key will cause the DLL to load only\nwhen the user opens any Microsoft Office application, such as Word or Excel. This is the first time Unit 42 has\n**seen the Sofacy group, or any other threat group for that matter, use this tactic for persistence purposes.**\nAn added benefit for the threat actor to using this specific tactic for persistence is that it requires user interaction to\nload and execute the malicious payload, which can cause challenges for detection in automated sandboxes.\n\n## The Carberp variant of Sofacy\n\nThe “btecache.dll” file is the loader Trojan that is responsible for loading the “svchost.dll” DLL and executing it. Both\nthe “btecache.dll” and “svchost.dll” files contain code from the leaked Carberp source code, specifically the API\nresolution functions, as well as the RC2 key. The Sofacy group has used the Carberp source code in the past,\n[specifically discussed in a blog by F-Secure, which is the reason we call this Trojan the Carberp variant.](https://labsblog.f-secure.com/2015/09/08/sofacy-recycles-carberp-and-metasploit-code/)\n\n\n-----\n\nand control (C2) serverallowing the threat actors to identify targets of interest. The threat actors can then respond to\nthese network beacons to download and execute additional secondary payloads on the system.\n\nThe Trojan delivered in this attack contains two network locations that it will send network beacons to, specifically\n“google.com” and “191.101.31.6”. These beacons are sent to the legitimate website google.com as an attempt to\nhide the true C2 beacons sent to the actual C2 server hosted at 191.101.31.6. The network beacons are sent using\nHTTP POST requests with URLs created largely with random characters. There are two exceptions where random\ncharacters are not used to construct the URL, specifically the file extension that is randomly chosen from .xml, .pdf,\n.htm or .zip and the base64 encoded value at the end of the URL. The base64 encoded data is a string\n(“J04aLsxVhHBkr19CYr0”) hardcoded within the Trojan that it will then encrypt using a custom algorithm. Figure 1\nshows an example beacon sent from the Trojan to the C2 server during analysis.\n\n_Figure 1 Network Beacon Sent from Carberp variant of Sofacy_\n\nThe POST data seen in the beacon in Figure 1 is base64 encoded and encrypted using the same custom algorithm\nused to encrypt the data in the beacon URL. We decrypted the data to determine its purpose and found the cleartext\nseen in Figure 2.\n\n_,^Bid=I,;<&w@[System Process]_\n_System_\n_smss.exe_\n_csrss.exe_\n_wininit.exe_\n_csrss.exe_\n_winlogon.exe_\n_services.exe_\n_lsass.exe_\n_lsm.exe_\n_svchost.exe_\n_svchost.exe_\n_svchost.exe_\n\n\n-----\n\n_svchost.exe_\n_svchost.exe_\n_spoolsv.exe_\n_svchost.exe_\n_taskhost.exe_\n_userinit.exe_\n_dwm.exe_\n_explorer.exe_\n_svchost.exe_\n_cmd.exe_\n_conhost.exe_\n_reader_sl.exe_\n_svchost.exe_\n_cmd.exe_\n_conhost.exe_\n_SearchIndexer.exe_\n_SearchProtocolHost.exe_\n_SearchFilterHost.exe_\n_SearchProtocolHost.exe_\n_explorer.exe_\n_svchost.exe_\n_svchost.exe_\n_disk=IDE\\DiskMAXTOR_HARDDISK_________________________2.2.1___\\5&2770a7af&0&0.0.0_\n_build=0x7caa0e19_\n\n_Figure 2 Decrypted HTTP POST Data Shows System Information_\n\nThe clear text of the data sent in the network beacons contains information regarding the compromised system, as\nwell as malware-specific information. The data is comprised of the following fields of data:\n\n**id = The serial number of the storage device**\n\n**w = This parameter (whose name ‘w’ could change to any character between samples) begins with a one byte value**\ndenoting the OS version followed by a one byte value for the CPU architecture. These values are immediately\nfollowed by a new line delimited list of running processes on the system.\n\n**disk = The name of the system’s hard drive, obtained from the registry key**\n“SYSTEM\\CurrentControlSet\\Services\\Disk\\Enum\\0”\n\n**build = The hardcoded build identifier for the Trojan version**\n\n**inject = (Optional, not displayed in Figure 2) If the Trojan injected its code into other processes to interact with the**\nC2 server\n\nThis callback data allows the threat actors to determine if the infected machine is a target of interest, as the beacon\ncontains a list of running processes and the name of the storage device that could be used to filter out analysis\nsystems or researchers. If the actors believe the system is of interest, they will respond to these network beacons to\ndownload and execute additional secondary payloads on the system. The Trojan parses the response to the\nbeacons for two actions “Execute” and “Delete” between the tags “[file]” and “[/file]”, as well as settings labeled\n“FileName”, “PathToSave”, “Rundll” and “IP” between the tags “[settings]” and “[/settings]”. This allows the threat\n\n\n-----\n\nThe initial analyzed sample in this attack only contained a single malicious command and control location,\n191.101.31.6. We have not observed this IP address used by the Sofacy group in any previous attack campaigns,\nand examining passive DNS data showed no other correlations to potentially related attacks. The sample also seen\nby Prevenity appeared to only have a single primary C2 domain, servicecdp[.]com. This domain also appears to be\nnewly created for this specific attack campaign, with no strong links to any previous attacks.\n\nPivoting off the unique registry key used for persistence revealed links to a previously observed Sofacy campaign,\nfrom mid-2015. Two additional payloads with recent compile dates of March 7, 2016, were discovered using the\nsame persistence mechanism, and analysis of those payloads revealed one primary C2 domain,\nmunimonoce[.]com, and three secondary C2 domains, www.wscapi[.]com, www.tabsync[.]net, and storsvc[.]org. The\n[secondary C2 domains may appear familiar, as they were widely publicized in a report from iSight Partners](https://www.isightpartners.com/2015/07/microsoft-office-zero-day-cve-2015-2424-leveraged-by-tsar-team/) in July\n2015 as C2 domains related to the Sofacy group aka Tsar Team.\n\nIn addition, the primary C2 domain munimonoce[.]com previously had resolved to the IP 66.172.11.207, which was\npreviously identified as a primary C2 IP for a Sofacy payload with a compile timestamp of June 11, 2015. This\nparticular sample also happened to use the exact same secondary C2 domains of www.wscapi[.]com,\nwww.tabsync[.]net, and storsvc[.]org, but lacked the newly discovered persistence mechanism.\n\nThe Sofacy group often re-uses infrastructure components across multiple attack campaigns, whether to speed the\nflow of attacks, for a lack of available resources committed, or out of sheer laziness. In this case, the newer attack\ncampaign appears to use newly created infrastructure, but still maintains some overlap with previous Sofacy-related\nC2s. We believe this overlap could possibly be due to an oversight when adapting a previous code base with the\nnew persistence method discussed in this blog for the new attack campaign.\n\nThe threat appears to be moving toward deployment of one-off infrastructure that can make analysis of attack\ncampaigns and correlation more challenging. This shift stresses the importance of analysts and researchers being\nable to pivot on all artifacts of a given attack, not simply relying on network indicators. In this case, we were able use\nAutoFocus to pivot on a common registry key unique to this attack campaign to quickly identify where it correlates\nwith characteristics of previous attacks.\n\n## Conclusion\n\nThe Sofacy group continues its attack campaigns on government organizations, specifically the U.S. government in\nthis latest spear-phishing example. The threat group added a new persistence mechanism that requires user\ninteraction by loading its payload into Microsoft Office applications when opened, which may help the actors to\n\n\n-----\n\nPalo Alto Networks customers are protected from the new Sofacy Carberp variant and can gather additional\ninformation using the following tools:\n\nWildFire detection of all known samples as malicious\n\nAll known C2s are classified as malicious in PAN-DB\n\n[AutoFocus tags have been created SofacyCarberp](https://autofocus.paloaltonetworks.com/#/tag/Unit42.SofacyCarberp)\n\n## Indicators\n\n Delivery Documents\n\n03cb76bdc619fac422d2b954adfa511e7ecabc106adce804b1834581b5913bca (Exercise_Noble_Partner_16.rtf)\n12572c2fc2b0298ffd4305ca532317dc8b97ddfd0a05671066fe594997ec38f5\n(Putin_Is_Being_Pushed_to_Prepare_for_War.rtf and Russian anti-Nato troops.rtf)\n\n## Loader Trojans\n\nc2551c4e6521ac72982cb952503a2e6f016356e02ee31dea36c713141d4f3785 (btecache.dll)\nbe1cfa10fcf2668ae01b98579b345ebe87dab77b6b1581c368d1aba9fd2f10a0 (bitsprex3.dll)\nfbd5c2cf1c1f17402cc313fe3266b097a46e08f48b971570ef4667fbfd6b7301 (amdcache.dll)\n\n## Payloads\n\n69940a20ab9abb31a03fcefe6de92a16ed474bbdff3288498851afc12a834261 (svchost.dll)\naeeab3272a2ed2157ebf67f74c00fafc787a2b9bbaa17a03be1e23d4cb273632 (clconfg.dll)\ndfa8a85e26c07a348a854130c652dcc6d29b203ee230ce0603c83d9f11bbcacc (iprpp.dll)\n57d230ddaf92e2d0504e5bb12abf52062114fb8980c5ecc413116b1d6ffedf1b (clconfg.dll)\n\n## Command and Control\n\n191.101.31.6\nmunimonoce[.]com\nwscapi[.]com\ntabsync[.]net\nstorsvc[.]org\nservicecdp[.]com\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/49rs6u4cyq43khamdah90y9zyacjzmbr"
    ],
    "report_names": [
        "PaloAlto_SofacyUSGov(06-14-2016)"
    ],
    "threat_actors": [
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716492,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1466166516,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/61c759fab05cb341d84f825452ad17cbcfb23c31.pdf",
        "text": "https://archive.orkl.eu/61c759fab05cb341d84f825452ad17cbcfb23c31.txt",
        "img": "https://archive.orkl.eu/61c759fab05cb341d84f825452ad17cbcfb23c31.jpg"
    }
}