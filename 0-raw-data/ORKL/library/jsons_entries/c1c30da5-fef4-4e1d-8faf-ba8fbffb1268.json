{
    "id": "c1c30da5-fef4-4e1d-8faf-ba8fbffb1268",
    "created_at": "2022-10-25T16:48:23.293821Z",
    "updated_at": "2025-03-27T02:15:41.630742Z",
    "deleted_at": null,
    "sha1_hash": "efee6cb22f537f81daeba1c34ca6a42030567d2e",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-05-14T01:11:08Z",
    "file_modification_date": "2020-05-14T01:11:08Z",
    "file_size": 1457891,
    "plain_text": "# Ramsay: A cyber‑espionage toolkit tailored for air‑gapped networks\n\n**[welivesecurity.com/2020/05/13/ramsay-cyberespionage-toolkit-airgapped-networks](https://www.welivesecurity.com/2020/05/13/ramsay-cyberespionage-toolkit-airgapped-networks/)**\n\nIgnacio Sanmillan May 13, 2020\n\nESET researchers have discovered a previously unreported cyber-espionage framework that we named\nRamsay and that is tailored for collection and exfiltration of sensitive documents and is capable of\noperating within air‑gapped networks.\n\nWe initially found an instance of Ramsay in VirusTotal. That sample was uploaded from Japan and led us\nto the discovery of further components and versions of the framework, along with substantial evidence to\nconclude that this framework is at a developmental stage, with its delivery vectors still undergoing finetuning.\n\nThe current visibility of targets is low; based on ESET’s telemetry, few victims have been discovered to\ndate. We believe this scarcity of victims reinforces the hypothesis that this framework is under an ongoing\ndevelopment process, although the low visibility of victims could also be due to the nature of targeted\nsystems being in air‑gapped networks.\n\n[Shared artifacts were found alongside the Retro backdoor. This malware has been associated with](https://blog.360totalsecurity.com/en/analysis-cve-2018-8174-vbscript-0day-apt-actor-related-office-targeted-attack/)\n[Darkhotel, a notorious APT group known to have conducted cyber-espionage operations since at least](https://attack.mitre.org/groups/G0012/)\n[2004, having targeted government entities in China and Japan in the past.](https://blogs.360.cn/post/apt-c-06_0day.html)\n\n## Attack vectors\n\nAlong with the discovery of the different instances of Ramsay, we found they were leveraged using a\nseries of attack vectors. These are:\n\n\n-----\n\n_Figure 1. Overview of discovered Ramsay versions_\n\n### Malicious documents dropping Ramsay version 1\n\n[This attack vector consists of malicious documents exploiting CVE-2017-0199 intended to drop an older](https://www.cvedetails.com/cve/CVE-2017-0199/)\nversion of Ramsay.\n\nThis document delivers an initial Visual Basic Script, shown in the screenshot below as\nOfficeTemporary.sct, that will extract within the document’s body the Ramsay agent, masquerading as a\nJPG image by having a base64-encoded PE under a JPG header.\n\n#### ID Index OLE Object\n\n 0 0x80c8 Format_id: 2 (Embedded) Class name: ‘Package’ Data size: 8994 OLE Package object: Filename: u‘OfficeTemporary.sct’ Source path: u‘C:\\\\Intel\\\\OfficeTemporary.sct’ Temp path = u:‘C\\\\Intel\\\\OfficeTemporary.sct’ MD5 = ‘cf133c06180f130c471c95b3a4ebd7a5’ EXECUTABLE FILE\n\n 1 0xc798 Format_id: 2 (Embedded) Class name: ‘OLE2Link’ Data size: 2560 MD5 = ‘daee337d42fba92badbea2a4e085f73f’ CLSID: 00000300-0000-0000-C000-000000000046 StdOleLink (embedded OLE object - known related to CVE-2017-0199, CVE- 2017-8570, CVE-2017-8759 or CVE-2018-8174. Possibly an exploit for the OLE2Link vulnerability (VU#921560, CVE-2017- 0199)\n\n_Table 1. OLE object layout contained within Ramsay version 1 RTF file as seen by oletools_\n\nWe noticed that the specific Ramsay instance dropped by these documents showed low complexity in its\nimplementation and lacked many of the more advanced features seen leveraged by later Ramsay\nversions.\n\nSeveral instances of these same malicious documents were found uploaded to public sandbox engines,\nlabeled as testing artifacts such as ‘access_test.docx’ or ‘Test.docx’ denoting an ongoing effort for trial of\nthis specific attack vector.\n\nBased on the low complexity of the Ramsay agent delivered, the threat actors may be embedding this\nspecific instance within these malicious documents for evaluation purposes.\n\n### Decoy installer dropping Ramsay version 2.a\n\nWe found one instance uploaded to VirusTotal of Ramsay masquerading as a 7zip installer.\n\nThe reason we named this malware Ramsay was due to some of the strings contained in this binary,\nsuch as the following:\n\n\n-----\n\n_Figure 2. Strings containing “Ramsay”_\n\nThis version of Ramsay shows a clear refinement of its evasion and persistence tactics along with the\nintroduction of new features such as a Spreader component and a rootkit; the Spreader component is\ndocumented more thoroughly in this part of the Capabilities section.\n\n### Malicious documents dropping Ramsay version 2.b\n\n[This attack vector consists of the delivery of a different malicious document abusing CVE-2017-11882.](https://www.cvedetails.com/cve/CVE-2017-11882/)\nThis document will drop a Ramsay Installer named lmsch.exe as shown in Table 1.\n\n#### ID Index OLE Object\n\n 0 0x80c8 Format_id: 2 (Embedded) Class name: ‘Package’ Data size: 644790 OLE Package object: Filename: u‘lmsch.exe’ Source path: u‘C:\\\\fakepath\\\\lmsch.exe’ Temp path = u:‘C:\\\\fakepath\\\\lmsch.exe’ MD5 = ‘27cd5b330a93d891bdcbd08050a5a6e1’\n\n 1 0xc798 Format_id: 2 (Embedded) Class name: ‘Equation.3’ Data size: 3584 MD5 = ‘5ae434c951b106d63d79c98b1a95e99d’ CLSID: 0002CE02-0000-0000-C000-000000000046 Microsoft Equation 3.0 (Known related to CVE-2017-11882 or CVE-2018-0802) Possibly an exploit for the Equation Editor vulnerability (VU#421280, CVE- 2017-11882)\n\n_Table 2. OLE object layout contained within Ramsay version 2.b RTF file as seen by oletools_\n\nThe Ramsay version leveraged by this document is a slightly modified version of Ramsay version 2.a,\nwith the main difference of not leveraging the spreader component. The functionality of the remaining\ncomponents is the same in regard to Ramsay version 2.a.\n\n### Client Execution of Infected Files\n\nAs previously mentioned, Ramsay Version 2.a delivers a Spreader component that will behave as a file\ninfector, changing the structure of benign PE executable files held within removable and network shared\ndrives in order to embed malicious Ramsay artifacts triggered on host file execution.\n\nThe Spreader is highly aggressive in its propagation mechanism and any PE executables residing in the\ntargeted drives would be candidates for infection.\n\nBased on compilation timestamps among the components of the various versions of Ramsay found, we\ncan estimate the following development timeline of this framework:\n\n\n-----\n\n_Figure 3. Estimation of Ramsay’s development timeline_\n\nThe analysis of the different compilation timestamps found across different components implies that this\nframework has been under development since late 2019, with the possibility of currently having two\nmaintained versions tailored based on the configuration of different targets.\n\n## Persistence mechanisms\n\nBased on its version, Ramsay implements various persistence mechanisms of different complexity. Some\nof these persistence mechanisms are the following:\n\n**AppInit DLL registry key**\n\nThe Windows operating system provides the functionality to allow custom DLLs to be loaded into the\naddress space of almost all application processes via AppInit DLL registry key. This technique is not\nparticularly complex; it is implemented in early Ramsay versions and is common in other malware\nfamilies.\n\n**Scheduled Task via COM API**\n\nScheduled tasks enable administrators to run tasks or “jobs” at designated times rather than every time\nthe system is booted or the user logs in. This feature can be implemented via the Windows COM API,\n[which the first versions of Ramsay have tailored. Based on the high ratio of similarity with Carberp’s](https://raw.githubusercontent.com/hzeroo/Carberp/master/source%20-%20absource/pro/all%20source/schtasks/schtasks.cpp)\nimplementation, it’s highly probable that Ramsay’s implementation was adapted from Carberp’s publicly\navailable source code.\n\n**Phantom DLL Hijacking**\n\nMore mature versions of Ramsay denote an increase in complexity of its persistence techniques, which\ninclude a technique sometimes referred to as “Phantom DLL Hijacking”.\n\nPhantom DLL Hijacking abuses the fact that many Windows applications use outdated dependencies not\nstrictly necessary for the functionality of the application itself, allowing the possibility of leveraging\nmalicious versions of these dependencies.\n\nTwo services will be targeted in order to enforce this technique. These are:\n\nWSearch (Windows Search) hijacking msfte.dll:\n\n\n-----\n\n_Figure 4. Hijacking of Microsoft Search Service msfte.dll_\n\nMSDTC (Microsoft Distributed Transaction Coordinator) service hijacking an oracle dependency\nseen below as oci.dll:\n\n_Figure 5. Hijacking of MSDTC service dependency oci.dll_\n\nThis persistence technique is highly versatile, enabling Ramsay agents delivered as DLLs to fragment\ntheir logic into separated sections, implementing different functionality tailored for the subject processes\nwhere the agent will be loaded. In addition, the use of this technique makes detection more difficult since\nthe loading of these DLLs into their respective processes/services won’t necessarily trigger an alert.\n\n## Capabilities\n\nRamsay’s architecture provides a series of capabilities monitored via a logging mechanism intended to\nassist operators by supplying a feed of actionable intelligence to conduct exfiltration, control, and lateral\nmovement actions, as well as providing overall behavioral and system statistics of each compromised\nsystem. The realization of these actions is possible due to the following capabilities:\n\n### File collection and covert storage\n\nThe primary goal of this framework is to collect all existing Microsoft Word documents within the target’s\nfilesystem. The overall collection stages are shown in Figure 6:\n\n\n-----\n\n_Figure 6. Mechanism of document collection_\n\nWord documents will first be collected and stored in a preliminary collection directory. The location of this\ndirectory may vary depending on the Ramsay version. Two of the directories we observed being used for\nthis purpose were %APPDATA%\\Microsoft\\UserSetting and\n%APPDATA%\\Microsoft\\UserSetting\\MediaCache.\n\nDepending on the Ramsay version, file collection won’t be restricted to the local system drive, but also\nwill search additional drives such as network or removable drives:\n\n\n-----\n\n_Figure 7. Hex-Rays output of procedure to scan removable drives for collection_\n\n_Figure 8. Hex-Rays output of procedure to scan network drives for collection_\n\nCollected documents are encrypted using the RC4 Stream Cipher Algorithm.\n\nThe RC4 key used to encrypt each file will be a computed MD5 hash of a randomly generated sequence\nof 16 bytes, salted with 16 bytes hardcoded in the malware sample. The first 16 bytes of the buffer where\nthe encrypted file will be held will correspond to the actual RC4 key used:\n\n\n-----\n\n_Figure 9. Hex-Rays output of RC4 key generation and storage_\n\n[Collected files under the preliminary collection directory will be compressed using a WinRAR instance](http://wintertechsolutions.weebly.com/blog/winrar)\nthat Ramsay Installer drops. This compressed archive will be saved within the preliminary collection\ndirectory and then generate a Ramsay container artifact:\n\n_Figure 10. Hex-Rays output of Ramsay container generation_\n\nAs shown in the previous screenshot, these Ramsay containers contain a magic value at the beginning of\nthe file, along with a Hardware Profile GUID denoting an identifier of the victim’s machine; an additional\nXOR-based encryption layer will be applied to the generated compressed archive. The following diagram\nshows the structure of these artifacts:\n\n_Figure 11. Ramsay Container Structure<{i>_\n\n\n-----\n\nRamsay implements a decentralized way of storing these artifacts among the victim’s file system by using\ninline hooks applied on two Windows API functions, WriteFile and CloseHandle.\n\nThe hooked WriteFile procedure’s main purpose is to save the file handle of the subject file to write and\ninstall another hook in the CloseHandle API function. The CloseHandle hooked procedure will then check\nwhether the subject file name has a .doc extension; if that’s the case, it will then append at the end of the\nsubject document the Ramsay container artifact followed by a stream of 1024 bytes denoting a Microsoft\nWord document footer.\n\nThis is done as an evasion measure in order to provide a means to hide the embedded artifact within the\nsubject document from the naked eye:\n\n_Figure 12. Hex-Rays output of code for appending Word document footer at the end of the target document_\n\nRamsay containers appended to Word documents will be marked in order to avoid redundant artifacts\nbeing appended to already affected documents and the preliminary storage directory will be cleared in\norder to generate a brand-new Ramsay artifact in intervals.\n\nEven though affected documents will be modified, it won’t impact their integrity; each affected Word\ndocument remains fully operational after artifact appending has taken place.\n\nExfiltration of these artifacts is done via an external component that we haven’t been able to retrieve.\nHowever, based on the decentralized methodology Ramsay implements for storage of collected artifacts,\nwe believe this component would scan the victim’s file system in search for the Ramsay container’s\nmagic values, in order to identify the location of artifacts to exfiltrate.\n\n### Command execution\n\nUnlike most conventional malware, Ramsay does not have a network-based C&C communication\nprotocol nor does any attempt to connect to a remote host for communication purposes. Ramsay’s\ncontrol protocol follows the same decentralized philosophy implemented for collected artifact storage.\n\nRamsay will scan all the network shares and removable drives (excluding A: and B: drives usually\nreserved for floppy disks) for potential control files. First, Ramsay looks for Word documents and also, in\nmore recent versions, for PDFs and ZIP archives:\n\n\n-----\n\n_Figure 13. Hex-Rays output of Ramsay Scan procedure for Control File retrieval_\n\nThese files are parsed for the presence of a magic marker specific to the control file format. More\nspecifically, Ramsay looks for any of two given encoded Hardware Profile GUIDs. One of these GUIDs is\nhardcoded as shown in Figure 14, while the other is dynamically generated based on the compromised\nvictim’s machine. If any of the subject identifiers are found, parsing for a command signature will be\nattempted.\n\n_Figure 14. Hex-Rays output of Ramsay Control File Parsing_\n\nThe search for these two GUID instances implies that Ramsay’s control documents can be deliberately\ncrafted to be “victim agnostic”, capable of deploying the same control document instance across a\nnumber of victims by leveraging a “global” GUID within control documents. On the other hand, control\n\n\n-----\n\ndocuments can be crafted by embedding a specific GUID intended to be delivered exclusively on a single\nvictim’s machine. This indicator of Ramsay’s control protocol implementation implies that its backend\ncounterpart may be somewhat automated.\n\nRamsay control protocol supports three different commands:\n\n#### Signature Command\n\n Rr*e#R79m3QNU3Sy File Execution\n\n CNDkS_&pgaU#7Yg9 DLL Load\n\n 2DWcdSqcv3?(XYqT Batch Execution\n\n_Table 3. Ramsay’s control commands_\n\nAfter a given command signature is retrieved, the contained artifact to execute will be extracted within the\ncontrol document’s body to then be restored, modifying the subject control document to its original form\nafter command execution.\n\n### Spreading\n\nAmong the different files dropped by the latest versions of Ramsay we find a Spreader component. This\nexecutable will attempt to scan for network shares and removable drives excluding A: and B: drives:\n\n_Figure 15. Hex-Rays output of spreader scanning routines_\n\n\n-----\n\nIt is important to notice that there is a correlation between the target drives Ramsay scans for\npropagation and control document retrieval. This assesses the relationship between Ramsay’s spreading\nand control capabilities showing how Ramsay’s operators leverage the framework for lateral movement,\ndenoting the likelihood that this framework has been designed to operate within air-gapped networks.\n\nThe propagation technique mainly consists of file infection much like a prepender file infector in order to\ngenerate executables similar in structure to Ramsay’s decoy installers for every accessible PE file within\nthe aforementioned targeted drives. The following diagram illustrates the changes applied to targeted\nexecutables after infection has taken place and how these components interact on execution:\n\n_Figure 16. File structure changes during an infection and execution_\n\nAll of the different artifacts involved in the infection stage are either within the context of the spreader or\ndropped previously by another Ramsay component. Some of the artifacts are parsed for the following\ntokens:\n\n_Figure 17. Hex-Rays output of tokens to search for different artifacts within the spreader context_\n\nAfter a given file has been infected, it will be marked by writing a specific token at the end of it in order to\nprovide the spreader an identifier to prevent redundant infection.\n\nIn addition, some components of Ramsay have implemented a network scanner intended for the\n[discovery of machines within the compromised host’s subnet that are susceptible to the EternalBlue](https://www.cvedetails.com/cve/CVE-2017-0143/)\nSMBv1 vulnerability. This information will be contained within all logged information Ramsay collects and\nmay be leveraged by operators in order to do further lateral movement over the network in a later stage\nvia a different channel.\n\n## Further remarks\n\nRamsay’s version 2.a Spreader component was found to have reused a series of tokens seen before in\n[Darkhotel’s Retro Backdoor. These tokens are the following:](https://s.tencent.com/research/report/741.html)\n\n\n-----\n\n_Figure 18. Hex-Rays output of Token Reuse with Retro_\n\n_Figure 19. Token Reuse on Retro URL Crafting_\n\nRamsay serializes victims using the GetCurrentHwProfile API to then retrieve a GUID for the specific\nvictim’s machine. This is also seen implemented in Retro. They both use the same default GUID in case\nthe API call fails:\n\n\n-----\n\n_Figure 20. Ramsay and Retro GUID generation_\n\nBoth Ramsay and Retro share the same encoding algorithm to encode the retrieved GUID.\n\n_Figure 21. Ramsay and Retro GUID encoding scheme_\n\nThe GUID retrieved by GetCurrentHwProfile is specific for the system’s hardware but not for the user or\nPC instance. Therefore, it is likely that by just leveraging this GUID operators may encounter duplicates\nintended to serialize different victims.\n\nThe purpose of this scheme is to generate a GUID which is less likely to be duplicate-prone by ‘salting’ it\nwith the machine’s ethernet adapter address. This implies that Retro and Ramsay share the same\nscheme to generate unique identifiers.\n\nWe also found similarities in the way Ramsay and Retro saved some of their log files, sharing a similar\nfilename convention:\n\n\n-----\n\n_Figure 22. Some of Ramsay and Retro filename convention_\n\nIs important to highlight that among Retro’s documented techniques, it leverages malicious instances of\n[msfte.dll, oci.dll and lame_enc.dll and via Phantom DLL Hijacking. As previously documented, Ramsay](https://blog.360totalsecurity.com/en/analysis-cve-2018-8174-vbscript-0day-apt-actor-related-office-targeted-attack/)\nalso uses this technique in some of its versions also using msfte.dll and oci.dll.\n\nIn addition, we also observed similarities among Ramsay and Retro in regards to the open-source tools\n[used among their toolsets, such as leveraging UACMe for privilege escalation and](https://github.com/hfiref0x/UACME)\n[ImprovedReflectiveDLLInjection for deploying some of their components.](https://github.com/dismantl/ImprovedReflectiveDLLInjection/)\n\nFinally, we noticed Korean language metadata within the malicious documents leveraged by Ramsay,\ndenoting the use of Korean-based templates.\n\n_Figure 23. Malicious document metadata showing the_\n\n_Korean word “title”_\n\n## Conclusion\n\n\n-----\n\nBased on the different instances of the framework found Ramsay has gone through various development\nstages, denoting an increasing progression in the number and complexity of its capabilities.\n\nDevelopers in charge of attack vectors seem to be trying various approaches such as old exploits for\nWord vulnerabilities from 2017 as well as deploying trojanized applications.\n\nWe interpret this as that developers have a prior understanding of the victims’ environment and are\ntailoring attack vectors that would successfully intrude into targeted systems without the need to waste\nunnecessary resources.\n\nSome stages of Ramsay’s framework are still under evaluation, which could explain the current low\nvisibility of victims, having in mind that Ramsay’s intended targets may be under air-gapped networks,\nwhich would also impact victim visibility.\n\nWe will continue monitoring new Ramsay activities and will publish relevant information on our blog. For\nany inquiries, contact us as threatintel@eset.com. Indicators of Compromise can also be found in our\n[GitHub repository.](https://github.com/eset/malware-ioc)\n\n## Indicators of Compromise (IoCs)\n\n\n#### SHA-1\n\n\n#### ESET detec‐ tion name Comments\n\n\n#### f79da0d8bb1267f9906fad1111bd929a41b18c03 Win32/Trojan‐ Dropper.Agen‐ t.SHN\n\n 62d2cc1f6eedba2f35a55beb96cd59a0a6c66880 Win32/Ram‐ say.A\n\n baa20ce99089fc35179802a0cc1149f929bdf0fa Win32/Hack‐ Tool.UACMe.T\n\n 5c482bb8623329d4764492ff78b4fbc673b2ef23 Win32/Hack‐ Tool.UACMe.T\n\n\n#### e7987627200d542b‐ b30d6f2386997f668b8a928c\n\n\n#### Win32/Trojan‐ Dropper.Agen‐ t.SHM\n\n\n#### Initial Installer\n\n Installer Launcher\n\n UAC Bypass Module\n\n UAC Bypass Module\n\n Spreader\n\n Malware Installer\n\n HideDriver Rootkit\n\n HideDriver Rootkit\n\n Darkhotel Retro Backdoor Loader\n\n Ramsay Initial Installer (version 2.b)\n\n\n#### 3bb205698e89955b4bd07a8a7de3fc75f1cb5cde Win32/Trojan‐ Dropper.Agen‐ t.SHN\n\n bd8d0143ec75ef4c369f341c2786facbd9f73256 Win32/Hide‐ Proc.M\n\n\n#### 7d85b163d19942bb8d047793ff78ea728‐ da19870\n\n\n#### Win32/Hide‐ Proc.M\n\n\n#### 3849e01bff610d155a3153c897bb662f5527c04c Win64/Hack‐ Tool.Inject.A\n\n 50eb291fc37fe05f9e55140b98b68d77bd61149e Win32/Ram‐ say.B\n\n\n-----\n\n#### SHA-1\n\n\n#### ESET detec‐ tion name Comments\n\n\n#### 87ef7bf00fe6aa928c111c472e2472d2cb047eae Win32/Ex‐ ploit.CVE- 2017-11882.H\n\n 5a5738e2ec8af9f5400952be923e55a5780a8c55 Win32/Ram‐ say.C\n\n 19bf019fc0bf44828378f008332430a080871274 Win32/Ram‐ say.C\n\n\n#### RTF file that drops 50e‐ b291fc37fe05f9e55140b98b68d77b‐ d61149e\n\n Ramsay Agent DLL (32bits)\n\n Ramsay Agent EXE (32bits)\n\n Ramsay Agent DLL (32bits)\n\n Ramsay Agent DLL (32bits)\n\n Ramsay Agent DLL (64bits)\n\n Ramsay Agent DLL (64bits)\n\n\n#### bd97b31998e9d673661ea5697fe436e‐ fe026cba1\n\n\n#### Win32/Ram‐ say.C\n\n\n#### eb69b45faf3be0135f44293bc95f06dad73bc562 Win32/Ram‐ say.C\n\n f74d86b6e9bd105ab65f2af10d60c4074b8044c9 Win64/Ram‐ say.C\n\n\n#### ae722a90098d1c95829480e056ef8fd4a98eed‐ d7\n\n## MITRE ATT&CK techniques\n\n#### Tactic ID Name Description\n\n\n#### Win64/Ram‐ say.C\n\n\n#### Initial Ac‐ cess\n\n Exe‐ cution\n\n\n#### T1091 Replication Through Removable Media\n\n T1106 Execution through API\n\n T1129 Execution through Module Load\n\n T1203 Exploitation for Client Execution\n\n T1035 Service Execution\n\n T1204 User Execution\n\n\n#### Ramsay’s spreading mecha‐ nism is done via removable drives.\n\n Ramsay’s embedded compo‐ nents are executed via Create‐ ProcessA and ShellExecute .\n\n Ramsay agent can be delivered as a DLL.\n\n Ramsay attack vectors exploit CVE-2017-1188 or CVE-2017- 0199.\n\n Ramsay components can be executed as service dependencies.\n\n Ramsay Spreader component infects files within the file system.\n\n\n-----\n\n#### Tactic ID Name Description\n\n\n#### Per‐ sis‐ tence\n\n Privi‐ lege Esca‐ lation\n\n De‐ fense Eva‐ sion\n\n Dis‐ cov‐ ery\n\n\n#### T1103 AppInit DLLs\n\n T1050 New Service\n\n T1053 Scheduled Task\n\n T1088 Bypass User Ac‐ count Control\n\n T1038 DLL Order Hijacking\n\n T1107 File Deletion\n\n T1055 Process Injection\n\n T1045 Software Packing\n\n T1083 File and Di‐ rectory Discovery\n\n T1057 Process Discovery\n\n\n#### Ramsay can use this registry key for persistence.\n\n Ramsay components can be executed as service dependencies.\n\n Ramsay sets a scheduled task to persist after reboot.\n\n Ramsay drops UACMe in‐ stances for privilege escalation.\n\n Ramsay agents will masquer‐ ade as service dependencies leveraging Phantom DLL Hijacking.\n\n Ramsay installer is deleted af‐ ter execution.\n\n Ramsay’s agent is injected into various processes.\n\n Ramsay installer may be packed with UPX.\n\n Ramsay agent scans for files and directories on the system drive.\n\n Ramsay will attempt to find if host is already compromised by checking the existence of spe‐ cific processes.\n\n\n#### Later‐ al Move‐ ment\n\n\n#### T1210 Exploitation of Remote Services\n\n\n#### Ramsay network scanner may scan the host’s subnet to find targets vulnerable to EternalBlue.\n\n\n#### T1105 Remote File Copy\n\n T1091 Replication Through Removable Media\n\n\n#### Ramsay attempts to infect files on network shares.\n\n Ramsay attempts to infect files on removable drives.\n\n Ramsay agent collects files in intervals.\n\n\n#### Col‐ lec‐ tion\n\n\n#### T1119 Automated Collection\n\n\n-----\n\n#### Tactic ID Name Description\n\n\n#### Ramsay agent scans files on system drive.\n\n Ramsay agent scans files on network shares.\n\n Ramsay agent scans files on removable drives.\n\n Ramsay agent may generate and collect screenshots.\n\n Ramsay agent scans for control files for its file-based communi‐ cation protocol on removable drives.\n\n Ramsay implements a custom, file-based C&C protocol.\n\n Ramsay agent compresses its collection directory.\n\n\n#### Com‐ mand and Con‐ trol\n\n Exfil‐ tration\n\n\n#### T1005 Data from Local System\n\n T1039 Data from Network Shared Drive\n\n T1025 Data from Removable Media\n\n T1113 Screen Capture\n\n T1092 Communi‐ cation Through Removable Media\n\n T1094 Custom Command and Control Protocol\n\n T1002 Data Com‐ pressed\n\n\n[Ignacio Sanmillan 13 May 2020 - 11:30AM](https://www.welivesecurity.com/author/isanmillan/)\n\n### Newsletter\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.05.13.Ramsay/Ramsay_%20A%20cyber%E2%80%91espionage%20toolkit%20tailored%20for%20air%E2%80%91gapped%20networks%20_%20WeLiveSecurity.pdf"
    ],
    "report_names": [
        "Ramsay_ A cyber‑espionage toolkit tailored for air‑gapped networks _ WeLiveSecurity"
    ],
    "threat_actors": [
        {
            "id": "1dadf04e-d725-426f-9f6c-08c5be7da159",
            "created_at": "2022-10-25T15:50:23.624538Z",
            "updated_at": "2025-03-27T02:00:55.508759Z",
            "deleted_at": null,
            "main_name": "Darkhotel",
            "aliases": [
                "Darkhotel",
                "DUBNIUM",
                "Zigzag Hail"
            ],
            "source_name": "MITRE:Darkhotel",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b13c19d6-247d-47ba-86ba-15a94accc179",
            "created_at": "2024-05-01T02:03:08.149923Z",
            "updated_at": "2025-03-27T02:05:17.422065Z",
            "deleted_at": null,
            "main_name": "TUNGSTEN BRIDGE",
            "aliases": [
                "DUBNIUM ",
                "DarkHotel ",
                "CTG-1948 "
            ],
            "source_name": "Secureworks:TUNGSTEN BRIDGE",
            "tools": [
                "Nemim"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2b4eec94-7672-4bee-acb2-b857d0d26d12",
            "created_at": "2023-01-06T13:46:38.272109Z",
            "updated_at": "2025-03-27T02:00:02.790029Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "DUBNIUM",
                "Fallout Team",
                "Luder",
                "Tapaoux",
                "Shadow Crane",
                "APT-C-06",
                "SIG25",
                "Karba",
                "Nemim",
                "Nemin",
                "G0012",
                "ATK52",
                "T-APT-02",
                "TUNGSTEN BRIDGE",
                "Zigzag Hail"
            ],
            "source_name": "MISPGALAXY:DarkHotel",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c0cedde3-5a9b-430f-9b77-e6568307205e",
            "created_at": "2022-10-25T16:07:23.528994Z",
            "updated_at": "2025-03-27T02:02:09.847683Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "APT-C-06",
                "ATK 52",
                "CTG-1948",
                "Dubnium",
                "Fallout Team",
                "Higaisa",
                "Luder",
                "Operation DarkHotel",
                "Operation Daybreak",
                "Operation Inexsmar",
                "Operation PowerFall",
                "Operation The Gh0st Remains the Same",
                "SIG25",
                "Shadow Crane",
                "T-APT-02",
                "Tungsten Bridge",
                "Zigzag Hail"
            ],
            "source_name": "ETDA:DarkHotel",
            "tools": [
                "Asruex",
                "DarkHotel",
                "DmaUp3.exe",
                "GreezeBackdoor",
                "Karba",
                "Nemain",
                "Nemim",
                "Ramsay",
                "Retro",
                "Tapaoux",
                "Trojan.Win32.Karba.e",
                "Virus.Win32.Pioneer.dx",
                "igfxext.exe",
                "msieckc.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716503,
    "ts_updated_at": 1743041741,
    "ts_creation_date": 1589418668,
    "ts_modification_date": 1589418668,
    "files": {
        "pdf": "https://archive.orkl.eu/efee6cb22f537f81daeba1c34ca6a42030567d2e.pdf",
        "text": "https://archive.orkl.eu/efee6cb22f537f81daeba1c34ca6a42030567d2e.txt",
        "img": "https://archive.orkl.eu/efee6cb22f537f81daeba1c34ca6a42030567d2e.jpg"
    }
}