{
    "id": "9863f4fc-0c28-452d-ad09-ad5c52920441",
    "created_at": "2022-10-25T16:48:22.00775Z",
    "updated_at": "2025-03-27T02:15:02.669148Z",
    "deleted_at": null,
    "sha1_hash": "67c0aca8dc28925db1ca5377ac1f072fb9522416",
    "title": "Malware static analysis part 1 of 2.",
    "authors": "",
    "file_creation_date": "2012-01-12T13:21:00Z",
    "file_modification_date": "2012-01-12T13:27:04Z",
    "file_size": 1348938,
    "plain_text": "analysis\n\n# Official Malware Report\n\n### Malware Reverse Engineering part1 of 2. Static analysis\n\n\n-----\n\nanalysis\n\n|Contact info|Col2|\n|---|---|\n|Report:|Malware reverse engineering part 1. Static analysis|\n|Author:|Rick Flores Security Engineer II|\n|Follow me on twitter:|https://twitter.com/#!/nanoquetz9l or simply @nanoquetz9l|\n|Website:|www.nanotechfibers.com|\n|Greetz to:|San Diego eXploit Team, eXploitSD, iqlusion, and isomorphix|\n\n|Revision Summary|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|Rev|Description of changes|Changes by:|Review / Approval by:|Date|\n|1.0|Malware reverse engineering part 1. Static analysis|Flores, Rick|N/A|01/06/2012|\n\n|Report Details|Col2|Col3|Col4|\n|---|---|---|---|\n|Infected user|Computer Name|Malware Analyst|Date|\n|Anonymous|Dumpbin-0425x8F.anonymous.local|Flores, Rick|01/06/2012|\n\n\n-----\n\nanalysis\n\n#### Table of Contents\n\n1. Scope.....................................................................................................................................................4\n\n2. Investigation goals ................................................................................................................................4\n\n3. Malware samples analyzed ...................................................................................................................4\n\n4 Malware analysis methodology, software, and secure lab setup ..........................................................4\n\n5. General function and functionality of the malware.............................................................................10\n\n6. Behavioral patterns of the malware and local system interaction.......................................................10\n\n7. Files and registry keys created, modified and accessed......................................................................10\n\n8. Network behavior (including hosts, domains and ip’s accessed)........................................................13\n\n9. Time and local system dependant features .........................................................................................21\n\n10. Method and means of communication................................................................................................22\n\n11. Original infection vector and propogation methodology....................................................................22\n\n12. Use of encryption for storage, delivery and or communication..........................................................22\n\n13. Use of self modifying/replicating or encrypted code..........................................................................23\n\n14. Any information concerning development of malware (compiler type, packer used, country of origin,\nauthor, names/handles, etc.)........................................................................................................................23\n\n15. Key questions and answers .................................................................................................................26\n\n16. Conclusions and recommendations to prevent incident from recurring .............................................26\n\n17. Followup actions and lessons learned.................................................................................................26\n\n18. REFS...................................................................................................................................................26\n\n\n-----\n\n#### 1. SCOPE\n\nThis malware report is part 1 of 2. Part 2 will focus heavily on dynamic analysis, determining\npackers/encryption used and finding original entry point (OEP) of the malware sample, and will\nutilize IDA Pro, and Immunity de-bugger extensively. We will also bypass anti-debugging, and\nanti-reversing tactics employed by attackers, and malware authors in part 2. Stay tuned!\n\nThis report is an effort to track, categorize, contain, understand root cause and infection vector\nof said user account/s, networked equipment or computer/s. This report pertains to all incidents\nreported by TIER II help desk, TIER III engineers, customer complaints or random IT Security\naudit/finding/pen test.\n\n#### 2. INVESTIGATION GOALS\n\nDetermine extent of infection, network risk, determine risk of data exposure, figure out\ninfection vector and propogation methods, etc.\n\n#### 3. MALWARE SAMPLES ANALYZED\n\n3.1 Win32 Kryptik.YJA trojan variant 40dbdf4b-7db5306a.exe\n\n**MD5** **: f0d0872763058e047922ead2474943ec**\n\n**SHA1** **: 5629f91e72401440024ec170430e60f50d4f4590**\n\n**SHA256 : b811b4089b36660ae089db8a7c61f2d9dc1ebfeb367ac51e55585ec8eaf1d77a**\n\n3.2    Location C:\\Documents and Settings\\anonymousvictim\\Local\nSettings\\Temp\\40dbdf4b-7db5306a.exe\n\n3.3 Moving forward, and for brevity I will be referring to “40dbdf4b-7db5306a.exe” simply\nas the malware sample. When you read `malware sample` in the remainder of this\nreport, safely assume I am referring to 40dbdf4b-7db5306a.exe which is the malicious\nsample used as the basis of this malware report.\n\n3.4 Malware Sample properties. Note the Internet Explorer Developer Tools information\nrecorded, and Original File Name : “iedvtool.dll”\n```\n       \"CompanyName\", \"Microsoft Corporation\"\n       \"FileDescription\", \"Internet Explorer Developer Tools\"\n       \"FileVersion\", \"8.00.6001.19044 (longhorn_ie8_gdr.110211-1700)\"\n       \"InternalName\", \"iedvtool.dll\"\n       \"LegalCopyright\", \"© Microsoft Corporation. All rights reserved.\"\n       \"OriginalFilename\", \"iedvtool.dll\"\n       \"ProductName\", \"Windows® Internet Explorer\"\n\n```\n\n-----\n\n```\n       \"ProductVersion\", \"8.00.6001.19044\"\n\n#### 4. MALWARE ANALYSIS METHODOLOGY, SOFTWARE, AND SECURE LAB SETUP\n\n```\nMalware Methodology\n\n4.1 This malware report focuses on malware static analysis but also lightly\nintroduces dynamic analysis to determine if the malware sample is packed,\narmored, encrypted, and or obfuscated. There is also a very brief introduction to\nIDA Pro, and Immunity de-bugger.\n\n4.2 Advanced modern malware applications are either protected, obfuscated,\nencrypted (armoring) and/or packed (the original code is compressed, encrypted\nor both). This technique is applied in an attempt to evade signature based\nmalware detection, and to hinder the efforts of static analysis by malware\nanalysts by employing anti-reversing, anti-debugging and self-modifying code\ntactics. This malware sample is no different. The unpacking or decrypting of the\n\n\n-----\n\nmalware layers remains the most complicated & sophisticated task in the overall\nprocess of malware analysis and finding the original entry point (OEP). True\nanalysis of packed malicious binary code can only be performed after the\npayload is unpacked. Dynamic analysis goes beyond the focus of this paper, and\nwill be the focus of part 2 of this malware report. Stay tuned!\n\nSoftware\n\n4.3 Software used for the analysis of the malware sample.\n\n1. Winalysis v3.1. Used to snapshot the OS and verify changes to the baseline after the\nmalware sample has been executed.\n\n2. Mandiant Red Curtain v1.0. Look for entropy, packing indication, original entry point\n(OEP), compiler & packing signatures, digital signatures, and it generates a threat\nscore.\n\n3. Mandiant Find Evil v0.1. Malware discovery tool which uses disassembly to detect\npacked executables.\n\n\n-----\n\n4. Resource Hacker v3.4.0.79. To view/modify Windows executable resources.\n\n5. Sysinternals Suite. All sorts of goodness!\n\nFile Monitor.\n\nProcess Explorer.\n\n\n-----\n\nTCP view.\n\n6. Wireshark. Used to capture all network packets, DNS requests, HTTP get requests…\netc generated by the malware sample.\n\n7. Malicious domain research & staying anonymous during investigation.\n\n\n-----\n\nI primarily use a mixture of the following. Tor/TorSOCKS, Privoxy, anonymous.org,\nhidemyass.com, and/or a VPN connection.\n\n8. Researching malicious Domains, and IP’s.\n\nQuery whois records. [www.networktools.nl/whois](http://www.networktools.nl/whois)\n\n[How many malicious domains are hosted on an IP? www.networktools.nl/reverseip](http://www.networktools.nl/reverseip)\n\nIs IP listed in SPAM blacklists? [www.networktools.nl/rblcheck](http://www.networktools.nl/rblcheck)\n\nGeoIP location search/trace. [www.ip-adress.com/ip_tracer/](http://www.ip-adress.com/ip_tracer/)\n\n9. IDA Pro v6.1\n\n10. Immunity De-bugger v1.83\n\nSecure Lab setup.\n\n4.4 VMware workstation v8.0.1 build-528992. Under the guest VM I like to disable\ndrag/drop, and copy/paste. I also set my host firewall to a default DROP/LOG\nALL stance for the duration of the malware analysis, and you can also run snort\non the host just for paranoia. I like to perform two different analysis. The same\nmalware sample on a physical machine, and one on a virtual machine. I then\ncompare the results and verify if the malware detected or changed its payload if\nunder a VM (red pill) or tried to escape the VM sandbox (which is very possible).\nThat is the reason you should have a dedicated malware machine for these\npurposes, and never be connected to the internet while analysis is underway.\nYour host machine can still be infected even if you run your guest machines\nunder NAT/Bridged or host only networking modes. Being paranoid is the only\nway to survive!\n\n\n-----\n\n#### 5. GENERAL FUNCTION AND FUNCTIONALITY OF THE MALWARE\n\n5.1 This malware sample installs fake antivirus software on the victim machine. It\nattempts to trick the user with several popups that resemble valid applications\nwarning that the user is infected and that he/she needs to buy the full version of\nthe software in order to be fully protected.\n\nThe malware sample’s main purpose is to steal credit card information from the victim. It\nhas very extensive networking capabilities which are detailed in the Network Behavior\nsection 7 of this report.\n\n#### 6. BEHAVIORAL PATTERNS OF THE MALWARE AND LOCAL SYSTEM INTERACTION\n\n6.1 As soon as I executed the malware sample it immediately deleted itself.\n\nMeaning that the malware sample disappeared right after I double clicked/executed it.\n\n#### 7. FILES AND REGISTRY KEYS CREATED, MODIFIED AND ACCESSED\n\n7.1 The malware sample installed/dropped the following new malicious files, and\nexecutables on the victim machine.\n\n\n-----\n\n7.2 The malware sample made 54 critical changes to the registry.\n\n7.3 It deleted the following registry keys from the registry.\n\n7.4 The malware sample created the following new registry keys, Subkeys, and\nvalues.\n\n\n-----\n\n7.5 The malware sample modified the following services on the victim machine.\n\nIt started the BITS service with two new control parameters, and deleted the automatic\nupdates service, and registry key values. This means that the malware sample has\neffectively disabled windows update, and prevented the download and installation of\ncritical Windows updates for the victim machine. This most likely means that it is\ncovering it tracks because it takes advantage of an existing unpatched Windows\nvulnerability, and updating the OS will likely kill/disable the\ninfection/communication/propogation vector of this malware variant.\n\n7.6 Running processes before, and after the malware sample was executed. Note\nthe “tyh.exe” that is now running.\n\n\n-----\n\n7.7 Process explorer output. Note that it is not able to verify that it is from Microsoft.\nAnd each time I execute the malware sample the name of the executable\nchanges. Before it was tyh.exe, and now it is ucm.exe as example.\n\n#### 8. NETWORK BEHAVIOR (INCLUDING HOSTS, DOMAINS AND IP’S ACCESSED)\n\n8.1 This malware sample makes a function call to the native Windows API\nC:\\WINDOWS\\System32\\winsock32.dll which is the Windows Sockets API used\n\n\n-----\n\nby most Internet and Network applications to handle network connections,\ndenoted below in highlighted blue.\n\n8.2 The malware sample also makes DNS requests in an attempt to resolve\nnumerous malicious sites including mimopywyn.com, dihojocitiz.com,\nqobirawif.com, QOBIRAWIF.com, gavywelugamoqe.com, sesusihyt.com, and\nxybobimaholos.com, etc. A total of 32 different DNS requests were made but not\nshown for brevity.\n\n8.3 Listening network sockets before and after execution of the malware sample on\nthe victim machine. It is clear from the below snapshot that it opened TCP:139\nNetBIOS Session, Windows File and Printer Sharing port. But also with any other\nsystem running Samba (SMB). The single most dangerous port on the internet.\n\n\n-----\n\n8.4 It did not take long before a fake A/V scanner showed me false scan results that\nmy machine was infected with a malware infection. Clearly this Trojan wanted to\nsteal my credit card information. The malicious software was titled “XP Internet\nSecurity 2012”. The malicious site that I was redirected to is intended to\nsteal/collect victims credit card information, and forward the results to the\nfollowing server http://bekukokymyje.com/support.html with IP of 199.168.189.25\non TCP:80. The malicious server is located in Orlando Florida U.S.A.\n\n\n-----\n\nThe above GUI/Application is running under process “hwi.exe” in the directory pictured\nbelow.\n\n\n-----\n\n8.5 The above popup redirected me to the following website. The actual form was\nnot even a website nor an actual .html file, it was a Windows Form/GUI. The GUI\ndid not contain any .html/JavaScript. But it made a good attempt to fool the\ncasual user with its Internet Explorer logo.\n\n\n-----\n\n-----\n\n8.6 Whois, and geolocation trace of the two malicious IP’s\nhttp://bekukokymyje.com/support.html that the victim made the connection to.\n\n\n-----\n\n-----\n\n#### 9. TIME AND LOCAL SYSTEM DEPENDANT FEATURES\n\n9.1 This malware sample requires a valid internet connection, and execution to\nactivate its payload. Once executed it makes numerous DNS requests to over 32\nmalicious sites to download the payload/instructions in a call home fashion.\n\n\n-----\n\n#### 10. METHOD AND MEANS OF COMMUNICATION\n\n10.1 It communications, and receives the payload/instructions from the malicious\nserver via port TCP 80.\n\n10.2 Server details are : http://bekukokymyje.com/support.html with IP of\n199.168.189.25 on TCP:80. The malicious server is located in Orlando Florida\nU.S.A.\n\n#### 11. ORIGINAL INFECTION VECTOR AND PROPOGATION METHODOLOGY\n\n11.1 The victim could have visited a normal looking site or may have been the victim\nof a brower exploit running an unpatched version of Internet Explorer. Typical\ndrive by download is another scenario.\n\n#### 12. USE OF ENCRYPTION FOR STORAGE, DELIVERY AND OR COMMUNICATION\n\n12.1 Nowadays advanced malware applications are either protected, obfuscated,\nencrypted (armoring) and/or packed (the original code is compressed, encrypted\nor both). This technique is applied in an attempt to evade signature based\nmalware detection, and to hinder the efforts of static analysis by malware\nanalysts by employing anti-reversing, anti-debugging and self-modifying code\ntactics. This malware sample is no different. The unpacking or decrypting of the\nmalware layers remains the most complicated & sophisticated task in the overall\nprocess of malware analysis and finding the original entry point (OEP). True\nanalysis of packed malicious binary code can only be performed after the\npayload is unpacked.\n\n12.2 Loading the malware sample in Immunity debugger I noticed the following loaded\n[module. C:\\WINDOWS\\system32\\CRYPT32.dll is the module that implements](http://msdn.microsoft.com/en-us/library/windows/desktop/aa379884(v=vs.85).aspx)\nmany of the Certificate and Cryptographic Messaging functions in the CryptoAPI,\nsuch as [CryptSignMessage. Crypt32.dll is a module that comes with the](http://msdn.microsoft.com/en-us/library/windows/desktop/aa380281(v=vs.85).aspx)\nWindows and Windows Server operating systems, but different versions of this\nDLL provide different capabilities. There is no API to determine the version of\nCryptoAPI that is in use, but I can determine the version of crypt32.dll that is in\n[use via the GetFileVersionInfo and](http://msdn.microsoft.com/en-us/library/windows/desktop/ms647003(v=vs.85).aspx) [VerQueryValue functions. The function is](http://msdn.microsoft.com/en-us/library/windows/desktop/ms647464(v=vs.85).aspx)\nhighlighted in blue below.\n\n\n-----\n\nExecutable modules, item 7\n\nBase=762C0000\n\nSize=0008B000 (569344.)\n\nEntry=762C15B5 CRYPT32.<ModuleEntryPoint>\n\nName=CRYPT32 (system)\n\nFile version=5.131.2600.1106 (xpsp1.020828-1\n\nPath=C:\\WINDOWS\\system32\\CRYPT32.dll\n\n#### 13. USE OF SELF MODIFYING/REPLICATING OR ENCRYPTED CODE\n\n13.1 I noticed each time I executed the malware sample that the names of the\ndropped malicious files “.exe’s” always changed to a random string/name.\nDifferent every single time. This might indicate the use of the rand function within\nthe code. Other than the random naming convention on the malicious\nexecutables, the network traffic seemed to be always the same. The malware\nsample stuck to the same 32 malicious domains in it’s C&C structure.\n\n#### 14. ANY INFORMATION CONCERNING DEVELOPMENT OF MALWARE (COMPILER TYPE, PACKER USED, COUNTRY OF ORIGIN, AUTHOR, NAMES/HANDLES, ETC.)\n\n14.1 Reverse engineering using static analysis on the malware sample allows me to\nunderstand its functionality. Loading the malware sample indicated it might be\npacked/compressed for several reasons. The memory visualization bar within the\n\n\n-----\n\nIDA GUI was not able to find any encoded/executable data. Usually normal unpacked executables have several blue sections with readable data. Below is a\ncomparison of a packed executable vs a non packed executable application.\n\n##  PACKED\n\n  UNPACKED\n\nNote the memory visualization bar within the unpacked nc.exe application, and the graph\noverview.\n\n14.2 Next is a high level overview of the malware sample which involves using the\nstart function and the “display graph of xref’s from current identifier” button. This\nmethod allows us to generate a visualization graph. The graph allows us to zoom\nin and inspect various portions of the program and see how much of it is actually\nsystem API calls versus custom implemented code. We can also use the graph\noverview to see all the function calls the application is making.\n\n\n-----\n\n14.3 I began by dumping the basic headers and imports/export entries in the malware\nsample using the dumpbin program. I extracted all data from all available\nsections of the malware sample. Sections that are available are .data, .idata,\n.rdata (hardcoded passwords/sometimes), .rsrc (resource), and .text (program\ncode) as pictured below.\n\n14.4 I ran the following commands and dumped the above sections into .txt files for\nfurther analysis.\n\n14.5 Next I performed a full binary disassembly with all libraries included.\n\n\n-----\n\n#### 15. KEY QUESTIONS AND ANSWERS\n\n  - How did the malware infection occur?\n\n[drive-by infection from site Yes]\n\n  - When did the malware infection occur?\n\n[On or before Jan. 04, 2012]\n\n  - What vulnerabilities allowed the infection to occur?\n\n\n\n[Unpatched Internet Explorer/ drive-by infection/banner Ad]\n\n- What is the risk of data loss?\n\n[High: Kryptik/Data Stealing Trojan on machine for several d\n\n\nays]\n\n\n#### 16. CONCLUSIONS AND RECOMMENDATIONS TO PREVENT INCIDENT FROM\n RECURRING\n\n\nOn Jan. 04, 2012, While browsing the internet, ANONYMOUS triggered a drive-by infection\nprobably coming from a banner ad. The drive-by infection triggered a series of exploit steps,\neventually resulting in installation of a trojan downloader and the Win-32 Kryptik.YJA trojan\nvariant. Because Kryptic is a data-stealing trojan, any sensitive information handled by the\nvictim between date of infection and the date of the investigation (January 09, 2012) should be\nconsidered potentially compromised.\n\n\nIT Security should implement a harden\n\n\ned browser standard operating procedure.\n\n\nThis SOP should include for example, disabling JavaScript, browser hardening standards\n\n(NSA), installing no-script, and removing admin access for affected users. Also take a look at\n\nofficial DoD, Sans papers on browser hardening or\n\nwww.us-cert.gov/reading_room/secure_browser/\n\n#### 17. FOLLOWUP ACTIONS AND LESSONS LEARNED\n\n17.1 Blacklist the entire offending IP block/s.\n\n17.2 Reset user password. Re-image victim machine. If the user used ANY personal\npasswords to login to ANY websites (banking, social media, news feeds,\n\neducational, work websites), he should reset said passwords, and notify\ncompanies he does business. Especially if he logged on to any banking website.\nUsers Active Directory account password should be reset, and be monitored for\nany unusual/unauthorized activity.\n\n\n-----\n\nREFS\n\n\nused in my .pdf report.\n\nGeneric Unpacking of Self-modifying, Aggre\n\nhttp://arxiv.org/abs/0905.4581\n\nPractical malware analysis\n\n\nssive, Packed Binary Programs\n\n\nwww.blackhat.com/.../bh-dc.../bh-dc-07-Kendall_McMillan-WP.pdf\n\nWhat to Include in a Malware Analysis Report\n\nhttp://zeltser.com/reverse-malware/malware-analysis-report.html\n\nMalware Analysis 101\n\nhttp://zeltser.com/reverse-malware/malware-analysis-webcast.html\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.exploit-db.com/docs/english/18387-malware-reverse-engineering-part-1---static-analysis.pdf"
    ],
    "report_names": [
        "18387-malware-reverse-engineering-part-1---static-analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "23dfc9f5-1862-4510-a6ae-53d8e51f17b1",
            "created_at": "2024-05-01T02:03:08.146025Z",
            "updated_at": "2025-03-27T02:05:17.420497Z",
            "deleted_at": null,
            "main_name": "PLATINUM TERMINAL",
            "aliases": [
                "Longhorn ",
                "The Lamberts ",
                "Vault7 ",
                "APT-C-39 "
            ],
            "source_name": "Secureworks:PLATINUM TERMINAL",
            "tools": [
                " Assassin",
                " Marble Framework",
                "AfterMidnight"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "e993faab-f941-4561-bd87-7c33d609a4fc",
            "created_at": "2022-10-25T16:07:23.460301Z",
            "updated_at": "2025-03-27T02:02:09.814816Z",
            "deleted_at": null,
            "main_name": "Longhorn",
            "aliases": [
                "APT-C-39",
                "Platinum Terminal",
                "The Lamberts"
            ],
            "source_name": "ETDA:Longhorn",
            "tools": [
                "Black Lambert",
                "Blue Lambert",
                "Corentry",
                "Cyan Lambert",
                "Fluxwire",
                "Gray Lambert",
                "Green Lambert",
                "Magenta Lambert",
                "Pink Lambert",
                "Plexor",
                "Purple Lambert",
                "Silver Lambert",
                "Violet Lambert",
                "White Lambert"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "08c8f238-1df5-4e75-b4d8-276ebead502d",
            "created_at": "2023-01-06T13:46:39.344081Z",
            "updated_at": "2025-03-27T02:00:03.056208Z",
            "deleted_at": null,
            "main_name": "Copy-Paste",
            "aliases": [],
            "source_name": "MISPGALAXY:Copy-Paste",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "70db80bd-31b7-4581-accb-914cd8252913",
            "created_at": "2023-01-06T13:46:38.57727Z",
            "updated_at": "2025-03-27T02:00:02.865012Z",
            "deleted_at": null,
            "main_name": "Longhorn",
            "aliases": [
                "the Lamberts",
                "APT-C-39",
                "PLATINUM TERMINAL"
            ],
            "source_name": "MISPGALAXY:Longhorn",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041702,
    "ts_creation_date": 1326374460,
    "ts_modification_date": 1326374824,
    "files": {
        "pdf": "https://archive.orkl.eu/67c0aca8dc28925db1ca5377ac1f072fb9522416.pdf",
        "text": "https://archive.orkl.eu/67c0aca8dc28925db1ca5377ac1f072fb9522416.txt",
        "img": "https://archive.orkl.eu/67c0aca8dc28925db1ca5377ac1f072fb9522416.jpg"
    }
}