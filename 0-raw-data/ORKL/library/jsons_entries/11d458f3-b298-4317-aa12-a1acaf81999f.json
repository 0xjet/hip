{
    "id": "11d458f3-b298-4317-aa12-a1acaf81999f",
    "created_at": "2023-01-12T15:04:16.738664Z",
    "updated_at": "2025-03-27T02:05:37.110014Z",
    "deleted_at": null,
    "sha1_hash": "c68888326674e47754e017e70a585209b46fa140",
    "title": "2016-01-29 - Malicious Office Files Dropping Kasidet And Dridex",
    "authors": "",
    "file_creation_date": "2022-05-28T19:33:40Z",
    "file_modification_date": "2022-05-28T19:33:40Z",
    "file_size": 584672,
    "plain_text": "# Malicious Office Files Dropping Kasidet And Dridex\n\n**[zscaler.com/blogs/research/malicious-office-files-dropping-kasidet-and-dridex](https://www.zscaler.com/blogs/research/malicious-office-files-dropping-kasidet-and-dridex)**\n\n### Introduction\n\n[We have covered Dridex Banking Trojan being delivered via various campaigns involving](https://www.zscaler.com/blogs/research/dridex-activity-continues)\nOffice documents with malicious VBA macros in the past. However, over the past two\nweeks we are seeing these malicious VBA macros leveraged to drop Kasidet backdoor in\naddition to Dridex on the infected systems. These malicious Office documents are being\n[spread as an attachment using spear phishing emails as described here. The malicious](http://blog.dynamoo.com/2016/01/malware-spam-scanned-document-color-mrh.html)\nmacro inside the Office document is obfuscated as shown in the code snapshot below \nMacro code\n\nThe macro downloads malware payload from the hardcoded URL. We have seen following\nURLs used in different document payloads that we captured for this campaign:\n\narmandosofsalem[.]com/l9k7hg4/b4387kfd[.]exe\ntrinity.ad-ventures[.]es/l9k7hg4/b4387kfd[.]exe\n\n\n-----\n\n188.226.152[.]172/l9k7hg4/b4387kfd[.]exe\n\nIn this blog, we will provide a detailed analysis for the Kasidet variant that we spotted in this\ncampaign.\n\n### Kasidet Analysis\n\n**Installation:**\n\nKasidet installs itself into %APPDATA% folder. It creates a new folder there with the name\n\"Y1FeZFVYXllb\", this string is hardcoded in the malware. The same string is used as mutex\nname and in creating a Registry key for ensuring persistence upon system reboot.\n\n**AntiVM Check:**\n\nKasidet tries to detect analysis systems during execution through following checks.\n\nChecking Dubugger through \"IsDebuggerPresent\" and \"CheckRemoteDebuggerPresent\"\nWindows APIs. It also checks for the following popular sandbox related strings:\nUser Name: \"MALTEST\", \"TEQUILABOOMBOOM\", \"SANDBOX\", \"VIRUS\", \"MALWARE\"\n\nFile Name: \"SAMPLE\", \"VIRUS\", \"SANDBOX\"\n\nIt tries to detect wine software by checking if kernel32.dll is exporting\n\"wine_get_unix_file_name\" function or not. It detects Vmware, VirtualBox, QEMU and\nBochs by checking for following registry entries:\n\n\nVmware\n\n\"HARDWARE\\DEVICEMAP\\Scsi\\Scsi\nPort\\Scsi Bus\\Target Id\\Logical Unit Id\",\n\"Identifier\", Vmware\"\n\n\"HARDWARE\\DEVICEMAP\\Scsi\\Scsi\nPort\\Scsi Bus\\Target Id\\Logical Unit Id\",\n\"Identifier\", \"VBOX\"\n\nVirtualBox\n\n\n\"SOFTWARE\\\\VMware, Inc.\\\\VMware\nTools\"\n\n\"HARDWARE\\\\Description\\\\System\",\n\"SystemBiosVersion\", \"VBOX\"\n\nSOFTWARE\\\\Oracle\\\\VirtualBox Guest\nAdditions\"\n\n\"HARDWARE\\\\Description\\\\System\",\n\"VideoBiosVersion\", \"VIRTUALBOX\"\n\n\n-----\n\nQEMU \"HARDWARE\\DEVICEMAP\\Scsi\\Scsi Port\n\\Scsi Bus \\Target Id \\Logical Unit Id \",\n\"Identifier\", \"QEMU\"\n\n\"HARDWARE\\\\Description\\\\System\",\n\"SystemBiosVersion\", \"QEMU\"\n\nBochs \"HARDWARE\\\\Description\\\\System\",\n\"SystemBiosVersion\", \"BOCHS”\n\n**Information Stealing capabilities:**\n\nKasidet uses following two methods for stealing information from the victim's machine:\n\n**1. Memory Scraping – This allows Kasidet to steal credit card data from the memory of**\n**Point-Of-Sale (POS) systems. It scans the memory of all the running processes except the**\noperating system processes listed below:\n\nSystem\nsmss.exe\n\ncsrss.exe\n\nwinlogon.exe\n\nlsass.exe\n\nspoolsv.exe\n\ndevenv.exe\n\nThe stolen information is relayed back to the attacker using following URI format –\nd=1&id=<MachineID>&name=<SystemName>&type=<Track1 or Track2 data>&data=\n<stolen data>&p=< Process elevation status >\n\n**2. Browser Hooking– This allows Kasidet to steal data from Web browsers. It can inject**\ncode into FireFox, Chrome, and Internet Explorer (IE). Browser names are not saved in\nplain text and instead this variant uses the same hash function as used by Carberp malware\nto encrypt the browser names. The following APIs are hooked in the web browser for\nstealing sensitive data:\n\n**Browser** **API**\n\nFireFox PR_Write\n\nChrome WSASend\n\n\n-----\n\nIE HttpSendRequestW, InternetWriteFile\n\nThe stolen information is relayed back to the attacker using following URI format –\n\nff=1&id=<MachineID>&name=<SystemName>&host=<Base64 encoded host name>&form=\n< Base64 encoded HTTP header data>&browser=<Browser name>\n\nThe information stealing feature of this Kasidet variant were deactivated if the system locale\nor GeoUserID corresponds to Russia.\n\n**Network communication:**\nKasidet contains a hardcoded list of Command & Control (C&C) server locations. It uses\nCryptStringToBinary API call to decrypt the embedded C&C URLs as seen below:\n\nKasidet C&C list\n\nUpon successful infection, Kasidet sends a HTTP POST request with data “enter=1”\n(without quotes). All HTTP header fields (User-Agent, Content-type and Cookie) are hard\ncoded in the payload itself.\n\n\n-----\n\nKasidet Hardcoded HTTP fields\n\nC&C Server will not return required data if HTTP header fields are different. The server\nsends a fake 404 response code and html data stating that page is not found but the C&C\ncommands will be hidden in the response HTML comment tag as seen below:\n\nKasidet - First communication with C&C\n\nKasidet will request for additional commands from the C&C server with the following POST\nrequest:\n\n\n-----\n\nKasidet request for additional commands\n\n**Variable** **Descriptions**\n\ncmd Command. It is hardcoded in the malware payload as '1'.\n\nid MachineGuid value fetched from Software\\Microsoft\\Cryptography registry\nkey\n\nname System Name\n\nos Operating system version\n\np Process elevation status\n\nav Antivirus installed on the infected system\n\nv Version of the bot. It is hardcoded in the malware. Current version that we\nanalysed is 4.4\n\nw Flag that indicates whether the system locale and UserGeoID is Russia\n\nLike browser names, all the command strings are also encrypted using a hash function.\nBelow are some of the important commands:\n\n**Command Hash** **Description**\n\n\n-----\n\n0x0E587A65 (rate\n<number>)\n\n\nIt is used in sleep function\n\n\n0x89127D3 DDOS using HTTP protocol\n\n0x0B37A84B6 Start keylogging and screen capture threads\n\n0x89068E8h Download and execute additional component. This file can be\nDLL, EXE or VBS.\n\n0x4A9981B7 Search for given process name in current running processes in\nthe system\n\n0x8D26744 Find given file in system and upload to the server\n\n0CAB1E64A Drop setting.bin file, change firewall settings to download and\nexecute plugin component\n\n0x10E6C4 Execute given command using windows cmd.exe\n\n### Conclusion\n\nMalicious Office document file is a popular vector for malware authors to deliver their\npayloads. Dridex authors have leveraged this technique for over a year and it was\ninteresting to see the same campaign and URLs being leveraged to deliver Kasidet\npayloads. While this does not establish any links between the two malware family authors, it\nreaffirms the fact that a lot of the underlying infrastructure and delivery mechanisms are\noften shared by these cyber criminals.\n\nThreatLabZ is actively monitoring this threat and ensuring signature coverage for Zscaler\ncustomers.\n\nAnalysis by - Abhay Yadav, Avinash Kumar and Nirmal Singh\n\n## Stay up to date with the latest digital transformation tips and news.\n\n[By submitting the form, you are agreeing to our privacy policy.](https://www.zscaler.com/privacy-compliance/privacy-policy)\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-01-29 - Malicious Office Files Dropping Kasidet And Dridex.pdf"
    ],
    "report_names": [
        "2016-01-29 - Malicious Office Files Dropping Kasidet And Dridex.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535856,
    "ts_updated_at": 1743041137,
    "ts_creation_date": 1653766420,
    "ts_modification_date": 1653766420,
    "files": {
        "pdf": "https://archive.orkl.eu/c68888326674e47754e017e70a585209b46fa140.pdf",
        "text": "https://archive.orkl.eu/c68888326674e47754e017e70a585209b46fa140.txt",
        "img": "https://archive.orkl.eu/c68888326674e47754e017e70a585209b46fa140.jpg"
    }
}