{
    "id": "564e68d6-f1f4-4fee-b783-35fcbf3487e6",
    "created_at": "2023-01-12T15:09:39.576349Z",
    "updated_at": "2025-03-27T02:05:59.349225Z",
    "deleted_at": null,
    "sha1_hash": "4b4b24b393f7648a03bca67d2c045a018074ad7f",
    "title": "2021-01-08 - Ransomware Delivered Using RDP Brute-Force Attack",
    "authors": "",
    "file_creation_date": "2022-05-28T19:01:00Z",
    "file_modification_date": "2022-05-28T19:01:00Z",
    "file_size": 1122496,
    "plain_text": "# Ransomware Delivered Using RDP Brute-Force Attack\n\n**[zscaler.com/blogs/security-research/ransomware-delivered-using-rdp-brute-force-attack](https://www.zscaler.com/blogs/security-research/ransomware-delivered-using-rdp-brute-force-attack)**\n\n[Zscaler ThreatLabZ recently published a report on the 2020 State of Public Cloud Security](https://www.zscaler.com/blogs/security-research/2020-state-cloud-insecurity)\nthat showed security misconfiguration to be the leading cause of cyberattacks against\npublic cloud infrastructure. In this blog, we will look at one of the commonly abused security\nmisconfigurations—the RDP service port left open to the internet—and how cybercriminals\nabuse it.\n\nBrute-forcing RDP (Remote Desktop Protocol) is the most common method used by threat\nactors attempting to gain access to Windows systems and execute malware. The reason is\nsimple: In our public cloud threat research, we have observed that 70 percent of systems\nkeep RDP ports open in the public cloud. Threat actors scan for these publicly open RDP\nports to conduct distributed brute-force attacks. Systems that use weak credentials are easy\ntargets, and, once compromised, attackers sell access to the hacked systems on the dark\nweb to other cybercriminals.\n\nRansomware groups such as SamSam and Dharma have been spreading almost\nexclusively via RDP for years. In this case study, we will look at Dharma ransomware\nattacks. Dharma, also known as Crysis, has been distributed under a ransomware-as-aservice (RaaS) model since 2016. Its source code was up for sale in March 2020, making it\navailable to a wider spectrum.\n\n## Infection chain\n\nAttackers use open-source port-scanning tools to scan for exposed RDP ports online and\nthen try to gain access to a system using brute-force tools or stolen credentials purchased\nfrom the dark web After attackers gain access to the target system they go on to make the\n\n\n-----\n\nsystem vulnerable by deleting backups, disabling antivirus software, and changing\nconfiguration settings. Once the security is disabled and the network vulnerable, attackers\ndeliver malware payloads. The process involves installing ransomware, using infected\nmachines to distribute spam, deploying keyloggers, or installing backdoors to be used for\nfuture attacks.\n\nThe below figure shows the infection cycle of Dharma ransomware delivered via RDP bruteforce attack.\n\n_Figure 1: Infection chain of RDP brute-force attack delivers Dharma ransomware_\n\nOnce the attacker gains access to the machine, the following files are uploaded:\n\n_%temp%\\ns.exe – Network enumeration/scanning tool_\n\n_%programfiles%\\process hacker\\ – Process hacker tool_\n\n[ns.exe is a network enumeration and scanning tool used by attackers to scan SMB shares,](https://www.softperfect.com/products/networkscanner/)\nopen ports, and services through which they can move within the network.\n\n[Process Hacker is a program used mostly by system administrators for monitoring,](https://github.com/processhacker/processhacker)\ndebugging, and troubleshooting, but in this case, it was used for malicious purposes such\nas disabling AV or services.\n\nFollowing the pre-execution process, the attacker uploads a ransomware file and executes\nit.\n\n## Technical details\n\nOnce executed, this variant of Dharma ransomware uses the below commands to quietly\ndelete all of the shadow volume copies on the machine.\n\n_mode con cp select=1251_\n\n_vssadmin delete shadows /all /quiet_\n\n\n-----\n\n_Exit_\n\nFor persistence, the ransomware executes the following commands:\n\n1. Copy the file to %windir%system32 or %appdata% and set\n\n_'LOCAL_MACHINE/LOCAL_USER Software\\Microsoft\\Windows\\CurrentVersion\\Run'_\n\n2. Copy file to 'Startup' folder\n\n3. Copy file to 'Common Startup’ folder\n\nThe ransomware encrypts files with the following extensions:\n\n_Figure 2: File extensions to encrypt_\n\nThe ransomware encrypts files using an AES 256 algorithm. The AES key is also encrypted\nwith an RSA 1024 algorithm. This encrypted AES key is stored at the end of the encrypted\nfile along with the filename.\n\nThe name of the encrypted files have the following pattern:\n\n_[Filename].id-{8 bytes ID}.[recovery_email].zimba_\n\n_Figure 3: Encrypted files_\n\nAfter encrypting the files, the ransomware pops up two different ransom notes on the\nvictim’s computer. One is the Info.hta file, which is launched via autorun when a user logs\ninto the computer.\n\n\n-----\n\n_Figure 4: info.hta_\n\nThe other note is called FILES ENCRYPTED.txt and can be found on the desktop.\n\n_Figure 5: FILES ENCRYPTED.txt_\n\n## Lateral movement\n\nDharma ransomware uses typical methods for obtaining credentials and propagating\nlaterally within a network. In most cases, it uses the Mimikatz tool, which allows it to dump\nthe network share credentials, and in other cases, it uses NirSoft CredentialsFileView,\nwhich allows for the recovery of passwords stored in encrypted credential files. The\nobtained credentials are used to attempt lateral movement inside the on-prem as well as\npublic cloud infrastructure.\n\nIn some cases, the ransomware tries to spread through the network by taking advantage of\nthe compromised Domain Controller and deploying a Default Domain Policy that will run the\nransomware payload on StartUp for each machine.\n\n## Conclusion\n\n\n-----\n\nSince Dharma ransomware is usually installed by gaining access to Remote Desktop\nServices, it is important to ensure that those services are properly locked. This includes\nensuring that computers running Remote Desktop Services do not connect directly to the\ninternet. Instead, organizations should use a zero trust architecture to allow remote users to\nsecurely access these servers without exposing them to the entire internet.\n\nWhile applying security patches is always important, most RDP-based attacks rely on\ncracking weak credentials, so passwords should be long, unique, and random. It’s important\nfor enterprises to establish password requirements and train employees to use strong\npasswords.\n\nAttackers typically identify potential targets by scanning the internet for systems listening on\nthe default RDP port (TCP 3389). Changing the listening port via Windows Registry can\nhelp organizations hide vulnerable connections.\n\n**[MITRE ATT&CK tactic and technique mapping](https://attack.mitre.org/)**\n\n**Tactic** **Technique**\n\nT1190 Exploit Public-Facing Application\n\nT1059 Command Line Interface\n\nT1061 Graphical User Interface\n\nT1547 Boot or Logon Autostart Execution\n\nT1037 Startup Items\n\nT1110 Brute Force\n\nT1003 Credential Dumping\n\nT1083 File and Directory Discovery\n\nT1135 Network Share Discovery\n\nT1018 Remote System Discovery\n\nT1063 Security Software Discovery\n\nT1076 Remote Desktop Protocol\n\nT1105 Remote File Copy\n\nT1486 Data Encrypted for Impact\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-08 - Ransomware Delivered Using RDP Brute-Force Attack.pdf"
    ],
    "report_names": [
        "2021-01-08 - Ransomware Delivered Using RDP Brute-Force Attack.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536179,
    "ts_updated_at": 1743041159,
    "ts_creation_date": 1653764460,
    "ts_modification_date": 1653764460,
    "files": {
        "pdf": "https://archive.orkl.eu/4b4b24b393f7648a03bca67d2c045a018074ad7f.pdf",
        "text": "https://archive.orkl.eu/4b4b24b393f7648a03bca67d2c045a018074ad7f.txt",
        "img": "https://archive.orkl.eu/4b4b24b393f7648a03bca67d2c045a018074ad7f.jpg"
    }
}