{
    "id": "2f3ff362-710b-4dce-83fd-7a9c7328b5e5",
    "created_at": "2022-10-25T16:48:13.852192Z",
    "updated_at": "2025-03-27T02:15:35.530366Z",
    "deleted_at": null,
    "sha1_hash": "f6e48ec049cf2557da17a22b1b721aea4a086273",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-04-01T09:42:32Z",
    "file_modification_date": "2020-04-01T09:42:34Z",
    "file_size": 3234898,
    "plain_text": "#### WHITE PAPER\n\n\n# ANALYZING THE RACCOON STEALER\n\n\n**[www.cyberark.com](http://www.cyberark.com)**\n\n\n-----\n\n## Table of Contents\n\n###### Introduction.....................................................................................................................................................................4\n\n How Raccoon Works......................................................................................................................................................4\n\n Commonwealth of Independent States (CIS) Countries...................................................................................5\n\n Raccoon’s Hidden C&C............................................................................................................................................ 6\n\n Stealer’s Config.........................................................................................................................................................7\n\n Working Folder & Downloading Files...................................................................................................................7\n\n Stealing Methods..........................................................................................................................................................10\n\n Chromium-based Browsers.................................................................................................................................10\n\n Data Extraction.................................................................................................................................................................................13\n\n Credentials – Login Data DB..........................................................................................................................................................13\n\n AutoFill Information – Login Data DB......................................................................................................................................... 15\n\n Credit Card information – Web Data DB ................................................................................................................................... 15\n\n Cookies – Cookies DB .....................................................................................................................................................................16\n\n History – History DB ......................................................................................................................................................................16\n\n Internet Explorer.................................................................................................................................................... 17\n\n Internet Explorer Autocomplete Password.................................................................................................................................17\n\n ieExfiltrateURL function................................................................................................................................................................. 18\n\n HTTP Basic Authentication ..........................................................................................................................................................19\n\n Mozilla-Based Applications..................................................................................................................................23\n\n Credentials - logins.json/signons.sqlite.......................................................................................................................................25\n\n logins.json..............................................................................................................................................................................25\n\n signons.sqlite........................................................................................................................................................................ 26\n\n Cookies - cookies.sqlite...................................................................................................................................................................27\n\n History- places.sqlite......................................................................................................................................................................27\n\n Outlook.....................................................................................................................................................................27\n\n lvl1_regEnum....................................................................................................................................................................................28\n\n lvl2_regEnum...................................................................................................................................................................................28\n\n getOutlookAccount function.........................................................................................................................................................28\n\n\n-----\n\n###### Foxmail.................................................................................................................................................................... 30\n\n Cryptocurrency Wallets........................................................................................................................................ 31\n\n Electrum.............................................................................................................................................................................................31\n\n Ethereum...........................................................................................................................................................................................32\n\n Exodus................................................................................................................................................................................................32\n\n Jaxx.....................................................................................................................................................................................................32\n\n Monero...............................................................................................................................................................................................32\n\n Bither.................................................................................................................................................................................................32\n\n Wallet Grabber.................................................................................................................................................................................33\n\n Gather information about the compromised machine..................................................................................33\n\n Final Steps......................................................................................................................................................................37\n\n Sending It All Back to C&C....................................................................................................................................37\n\n Deleting Its Traces................................................................................................................................................40\n\n Summary.......................................................................................................................................................................40\n\n IoCs...........................................................................................................................................................................40\n\n YARA Rule................................................................................................................................................................41\n\n\n-----\n\n### Introduction\n\n###### In this whitepaper, we describe a few select technical\n\n##### For a higher level version of this\n\n###### details regarding an infostealer named ‘Raccoon,’ including in-depth analysis of Raccoon’s methods and techniques. research, please take a look at this blog\n\n##### post: Raccoon; The Story of a Typical\n\nAn infostealer is a type of malware that is focused on\n\ngathering sensitive and conditional information from the [Infostealer.](https://www.cyberark.com/threat-research-blog/raccoon-the-story-of-a-typical-infostealer/)\n\ncompromised system. While this information is often related\n\nto the user’s credentials, they have also been known to seek\n\nout financial data and personal information.\n\nThe research performed by CyberArk Labs focused on the methods and techniques that a typical infostealer leverages for stealing\n\nsensitive user data and information. Additionally, we wanted to better understand what clients (a.k.a. cybercriminals) are able to\n\nretrieve with a low price infostealer such as Raccoon.\n\n### How Raccoon Works\n\nRaccoon stealer is not the most sophisticated malware that’s available to cyber attackers, but it proves to be quite effective. This\n\nreaffirms that attackers do not require anything overly advanced when these less-sophisticated techniques are still very much\n\neffective in carrying out an attack.\n\nThe first step in our analysis was investigating the malware strings to gain leads derived from these samples. We were able to\n\ndetermine the browser’s names, application paths, DLL name (which is used for Mozilla applications,) some unusual strings – like\n\nencryptedUsername and encryptedPassword – and more.\n\n_Figure 1: Part of Raccoon’s strings_\n\n\n-----\n\nBefore Raccoon moves forward in stealing sensitive data from a system, it first performs various checks on the compromised\n\nsystem. It starts by looking for the mutex: rc/%username% and, if it isn’t already present, it automatically proceeds to create it.\n\nSecondly, it looks to see if the computer is part of the Commonwealth of Independent States (CIS) countries.\n\n#### Commonwealth of Independent States (CIS) Countries\n\nRaccoon gets the locale of the machine by calling to GetUserDefaultLCID and GetLocaleInfoA and then compares the system\n\nlanguage to CIS languages (Russian, Ukrainian, Belarusian, Kazakh, Kyrgyz, Armenian, Tajik, Uzbek).\n\n_Figure 2: Check for CIS countries_\n\nThe strings of the CIS languages are encrypted, so the malware decrypts the strings and compares them to the system’s locale.\n\nSince part of Raccoon’s strings are encrypted, Raccoon creates a bytes array with the XOR key as the most significant byte and the\n\nrest of the array is XORed and NOTed with the byte-key, for example, 379ABDBBBBA1A9A6→ Russian.\n\nTo remain stealthy, most of the strings that Raccoon uses are encrypted, therefore it decrypts them in runtime.\n\nOnce those system checks are completed, Raccoon does the following:\n\n###### • [Gets its C&C (Command and Control) – by decrypting some hardcoded values and using Google Drive as a middle stage.]\n\n • [Gets its configuration – by querying the C&C server with its hardcoded configuration ID, Racoon receives a JSON that contains ]\n\nthe configuration for the sample.\n\n\n-----\n\n#### Raccoon’s Hidden C&C\n\nThe stealer binary contains 3 hardcoded values:\n\n###### • [A base64 string:\n]\n\nMypo7lAqDGp6xNdb/CUHGKD0x9cCPC4XYTUYxcMwDD/\n\ntWbPQlmUzGwH+R8cN9kncB7OZsuFsvcdiB1xtd7BAC0yoPZteuoB1hV5KWIQ0+cA=.\n\n###### • [A first ][encrypted][ key for the Google Drive URL decryption routine.]\n\n • [A second key ][26b948359b43d02743bd1fad775a15ca][ for the C&C server URL decryption routine.]\n\nThe process of getting the server address is as follows:\n\n**1.** Raccoon decrypts the first key, which will be the Google Drive decryption key 1@zFg08*@45.\n\nPart of Raccoon’s strings are encrypted like the first key. Raccoon creates a byte array with the XOR key as the most\n\nsignificant byte and the rest of the array is XORed and NOTed with the byte-key, for example: 34FA8BB18DACFBF3E18BFFFE→\n\n1@zFg08*@45.\n\n**2.** The stealer uses a decryption routine (some naive XOR cipher) in order to decrypt the first hardcoded base64; the\n\ndecryption function gets the first key and the decoded base64.\n\nThe decryption function will return a string for Google Drive URL (https://drive[.]google[.]com/\n\nuc?export=download&id=1QQXAXArU8BU4kJZ6IBsSCCyLtmLftiOV), which will be the middle stage for getting the C&C domain.\n\n**3.** It will then create a GET request to this Google Drive using HTTPS.\n\nThe response from Google Drive is seen in Figure 3.\n\n_Figure 3: Google Drive response_\n\n**4.** Raccoon filters the response in order to get the file name from the Content-Disposition response header.\n\n_“attachment (indicating it should be downloaded; most browsers presenting a ‘Save as’ dialog, prefilled with the value of the_\n\n_filename parameters if present), MDN.”_\n\nThe filter function gets the response as a string and two other strings (attachment;filename=”, .txt”;filename*=UTF-8 ) and\n\nreturns the string between the latter two strings → /nR09mYYxgcjyzYzfq24EGsrNabUWO3ZUN7At+/iX2rFDA== which is the\n\nencrypted C&C server URL.\n\n**5.** Finally, Raccoon decrypts the filtered base64 string using its naive decryption routine and passes the decoded base64\n\nfrom the response (from step four) and the second hardcoded private key. The decryption routine will return Raccoon’s\n\n**C&C** http://35[.]189[.]105[.]242/gate/log.php.\n\n\n-----\n\n#### Stealer’s Config\n\nLike most of the credential stealers, the client (i.e. the attacker) can customize its own configuration for the stealer functionality,\n\nwhich can be saved in the binary built by the malware or in the C&C server and sent back to the malware when executed.\n\nIn Raccoon, after the client chooses the configuration, the malware builder generates a configuration ID for the client’s\n\nconfiguration and writes this ID to the compiled malware.\n\nIn this case, the config ID is encrypted and Raccoon has another hardcoded base-64 encoded string in the binary. To decrypt\n\nthe config ID it uses the first key (1@zFg08*@45) and, after the decryption routine, gets the config ID (which, in this case, is:\n\n4ede41fe0ea963034a3d65f0dd442de4671c214f).\n\nTo get the full configuration (enabled capabilities) the stealer has to query the C&C.\n\n**1.** The malware generates an ID for the machine from MachineGuid, which is a common ID (query this registry key\n\nHKLM\\SOFTWARE\\Microsoft\\Cryptography for the value MachineGuid) and from the current username (calling to\n\nGetUserNameA).\n\n**2.** It creates the next machine profile bot_id=%machineGUID%_%username%&config_id=%configID%&data=null and encodes\n\nthe string as base64.\n\n**3.** The remaining piece is to send the machine profile to the C&C. It concatenates the encoded base64 string to params= and\n\nsends a POST request with params=%base64MachineProfile% as the content of the request.\n\n_Figure 4: POST request to C&C_\n\nThe C&C server returns JSON that contains the configuration the stealer needed for its functionality.\n\n_Figure 5: The stealer configuration JSON_\n\n#### Working Folder & Downloading Files\n\nThe malware working directory is the Temp folder. During runtime, it downloads all the files it needs (DLLs, zip file, and dropped\n\nmalware) to this folder and writes all the stolen data to text files in this directory. Raccoon uses getTempPath function many times.\n\n\n-----\n\n_Figure 6: getTempPath function_\n\nIn order to download files, the malware uses a function that we named downloadFile. The function gets a location to download\n\nthe file from and a download URL (the function gets the parameters using the registers - ecx/edx). To stay stealthy, the malware\n\ndynamically loads urlmon.dll, so we can’t find it within the import table of the PE.\n\n\n-----\n\n_Figure 7: DownloadFile function_\n\nAfter loading the DLL (urlmon.dll), it calls dynamically to URLDownloadToFileA by using GetProcAddress.\n\n_Figure 8: Calling to URLDownloadToFileA dynamically_\n\n\n-----\n\n### Stealing Methods\n\n#### Chromium-based Browsers\n\nThe first applications that Raccoon targets are chromium-based browsers. The sensitive data for these applications is saved within\n\nSQLite databases. In order to extract the data from the DB, Raccoon has to query it using the exported functions of sqlite3.dll.\n\nThe first step Raccoon takes is to download this DLL, therefore, it uses the downloadFile function and passes the attachemrnt_url\n\nvalue from the config JSON (the value contains a download URL for sqlite3.dll).\n\n_Figure 9: The stack frame for URLDownloadToFileA (downloadFile function)_\n\nAfter downloading the sqlite3.dll from the C&C server, it loads it to memory.\n\nThe malware has a plain text list for the chromium-based browsers containing:\n\n###### • [Application name]\n\n • [A path for the application folder that contains the sensitive DBs]\n\n • [DB names]\n\n_Figure 10: Part of the plain text list for Chromium-based browsers_\n\n\n-----\n\nIn the list, there are 29 applications with all the path names and relevant DB names (note: the DB names are the same for all the\n\nbrowsers, so it is useless to repeat this process further times). Raccoon loops over all 29 applications by using the same functions\n\nand techniques it used to steal the data from the DBs, the only difference is in the User Data folder location. This methodology\n\nmakes the malware authors’ work easier because they develop one functionality that can work for all the Chromium-based\n\nbrowsers, enabling them to cover more applications without developing more capabilities.\n\nThe location for application User data can be in different locations within AppData (CSIDL_APPDATA/CSIDL_LOCAL_APPDATA)\n\n_Figure 11: Getting the application directory_\n\nThe next step for Raccoon is to create the full path for the User Data directory, so it concatenates the app data path (Local/\n\nRoaming) with the plain text application path, for example, C:\\Users\\user\\AppData\\Local\\Google\\Chrome\\User Data.\n\nThe malware is focused on extracting sensitive data from:\n\n###### • [Login Data DB – usernames and passwords, autofill data]\n\n • [Web Data DB – credit card information]\n\n • [Cookies DB]\n\n • [History DB (if enabled by the configuration JSON)]\n\nThe stealer uses one generic function, which we named findDB_RunFunc, this function searches for the DB file inside the User\n\nData folder and calls to the relevant function to correctly extract the data from the DB (each DB has a specific function to handle it:\n\nextractCreds,extractCookie and etc.).\n\n\n-----\n\n_Figure 12: Getting the application directory and passing the relevant extraction function_\n\nfindDB_RunFunc function gets four parameters:\n\n###### • [by stack: the handle to Sqlit3.dll ]\n\n • [the pointer to browser name (string)]\n\n • [the pointer to the function that handles the DB]\n\n • [by registers: the path for the user data directory]\n\nThe function searches (recursively) by name in the user data folder for the DB file. When it finds the DB, the function calls to the\n\npassed function to handle it (i.e. extract the data.)\n\n\n-----\n\n_Figure 13: Call to relevant subroutine to handle the DB_\n\nNote: There is some non-traditional logic in the findDB_RunFunc function. The function keeps searching for the DB file in the\n\ndirectory even after it finds the file and calls to the relevant function to handle it.\n\nNow, that we’ve discussed how Raccoon gets the confidential DBs files, we will focus on how it extracts and decrypts the data.\n\n###### Data Extraction\n\nAll the extraction functions have the same scheme:\n\n**1.** The malware saves the addresses of the functions from sqlite3.dll (by using GetProcAddress):\n\n###### ˚ [sqlite3_open_v2]\n ˚ [ sqlite3_prepare_v2]\n ˚ [ sqlite3_step]\n ˚ [ sqlite3_column_bytes]\n ˚ [ sqlite3_column_blob]\n ˚ [ sqlite3_column_text]\n ˚ [ sqlite3_column_finalize]\n ˚ [ sqlite3_column_close]\n\n**2.** It generates a random string (length of 10 characters) and copies the DB file to a temp folder named like the random\n\nstring – all the extractions methods will be on the copied DB.\n\nIn order to extract the data from the DB, the malware has to create the SQL query and query the DB using sqlite3.dll functions.\n\n###### Credentials – Login Data DB\n\n**1.** The malware opens the DB by using sqlite3_open_v2 and passes the DB path.\n\n**2.** It decrypts the SQL query for the “Login Data” DB: SELECT origin_url, username_value, password_value FROM logins\n\n**3.** It calls to sqlite3_prepare_v2, the function gets a handle to DB and the SQL query and returns a statement handle.\n\n**4.** By using sqlite3_column_bytes/sqlite3_column_blob/sqlite3_column_text, the malware can get the results from the queries;\n\nthose functions get the statement (query) handle and index for the column.\n\n\n-----\n\nThe passwords in the DB are encrypted by DPAPI and, therefore, the malware uses the function CryptUnprotectData to decrypt the\n\nuser’s passwords.\n\n_Figure 14: Decryption of the user’s password_\n\nsqlite3_column_bytes will return the size of the encrypted password and sqlite3_column_blob the bytes for the encrypted\n\npassword. Using memmove, it copies the encrypted password to CRYPT_INTEGER_BLOB structure and the CryptUnprotectData\n\nfunction gets this structure\n\nThe malware puts the extracted data in a form and iterates all the passwords in DB. After getting all the passwords, it creates a\n\ntext file named passwords.txt and writes the extracted data to it.\n\n\n-----\n\n_Figure 15: Extracted information from chrome login data DB_\n\n###### AutoFill Information – Login Data DB\n\nThe same extraction logic, but different SQL queries.\n\nNote: Within every extraction function, Raccoon repeats getting the address for the sqlite3.dll functions. The malware gets the\n\npasswords dynamically and then overrides the variables with the same addresses, which doesn’t make any sense.\n\nThe query for the autofill information is SELECT name, value FROM autofill. The malware iterates all the values in the autofill table\n\nand writes them to a text file named chrome_autofill.txt.\n\n###### Credit Card information – Web Data DB\n\nThe same extraction logic, but different SQL DBs and queries.\n\nThe query for the credit card information is SELECT name_on_card, card_number_encrypted, expiration_month, expiration_year\n\nFROM credit_cards.\n\nThe malware iterates all the values in the credit_cards table and writes them to a text file named CC.txt.\n\nThe encrypted value card_number_encrypted is decrypted by using the CryptUnprotectData function.\n\n\n-----\n\n_Figure 16: The CC info from the Chrome Web data DB_\n\n###### Cookies – Cookies DB\n\nThe same extraction logic, but different SQL DBs and queries.\n\nThe query for the cookies information is SELECT host_key, path, is_secure, expires_utc, name, value, encrypted_value FROM cookies.\n\nThe malware iterates all the values in the cookies table and writes them to a text file named chrome_cookie.txt.\n\nThe encrypted value cookie is decrypted, just like before, by using the CryptUnprotectData function.\n\n###### History – History DB\n\nThis feature is enabled only by the configuration JSON; by default this feature is disabled.\n\nThe same extraction logic, but different SQL DBs and queries.\n\nThe query for the history information is SELECT url, visit_count, datetime(last_visit_time / 1000000 + (strftime(‘%s’, ‘1601-01-01’)),\n\n‘unixepoch’) FROM urls. The malware iterates all the values in the URLs table and writes them to a text file named chrome_urls.txt.\n\n\n-----\n\n#### Internet Explorer\n\n###### Internet Explorer Autocomplete Password\n\n##### “\u0007The IUrlHistory interfaces provide\n\nInternet Explorer Autocomplete passwords for websites are\n\nsaved under the registry key HKEY_CURRENT_USER\\Software\\ functionality to manage Windows\n\nMicrosoft\\Internet Explorer\\IntelliForms\\Storage2, but they are Internet Explorer history information”\n\nsaved in a stealthy way – every value represents a login for a\n\n[-Microsoft Docs](https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms774939(v=vs.85))\n\nwebsite (URL), but the value is a hash of the URL website and\n\nthe data for the value is the encrypted credentials. In order to\n\nmatch the password to the hash, the malware has to find the\n\nhash of the URL.\n\n[In this part of the analysis, we used this IDA python to analyze the COM objects: fboldewin/COM-Code-Helper.](https://github.com/fboldewin/COM-Code-Helper)\n\n_Figure 17: Received interface pointer to IUrlHistoryStg2_\n\nRaccoon calls to IUrlHistoryStg2Vtbl.EnumUrls, which returns an interface to an enumerator of visited links in the Windows Internet\n\nExplorer history.\n\nThe malware passes every URL in the Internet Explorer history to a function we named ieExfiltrateURL.\n\n\n-----\n\n###### ieExfiltrateURL function\n\nAt first, the function creates a hash of SHA1 for the given argument, which is the URL.\n\n_Figure 18: Raccoon creates SHA1 from the URL_\n\n\n-----\n\nAfter that, Raccoon passes the hash to a function that we named searchGetKeyRegValue. This function gets a registry key and value\n\nand returns the data for a matched value or null (if not found). By this method, Raccoon matches the hash of the URL to the URL.\n\nThe value for the hash is the encrypted password. Raccoon uses CryptUnprotectData to decrypt the value.\n\nThe stealer has few more methods to extract data from IE. It uses a function we named exfiltrateDecDPAPI, which handles the\n\ndecrypted data from the various extraction methods.\n\nThe exfiltrateDecDPAPI function gets, as an argument, a number (some flag) and uses it to determine how to handle the decrypted\n\ndata and writes it. The flag indicates which IE extraction method the data came from.\n\nIn this part of writing the decrypted data to ie_autofill.txt, we noticed that Raccoon doesn’t handle the decrypted data correctly;\n\ntherefore, the user passwords will never be written to the text file, only the usernames.\n\n_Figure 19: Null Terminator in the Decrypted Data_\n\n###### HTTP Basic Authentication\n\nThe HTTP basic authentication passwords are stored in the credentials store. The credentials are encrypted by using DPAPI after\n\nthey are salted with a fixed value generated from the next GUID abe2869f-9b47-4cd9-a358-c22904dba7f7.\n\nRaccoon enumerates the credentials of the user and adds the relevant filter Microsoft_WinInet_* to get only the HTTP basic\n\nauthentication credentials.\n\n\n-----\n\n_Figure 20: Calling to CredEnumrateW_\n\nIn order to get the plain text password, the malware uses CryptUnprotectData with the relevant OptinalEntropy.\n\n\n-----\n\n_Figure 21: Calling to CryptUnprotectData_\n\nAfter getting the decrypted credentials, the malware uses the exfiltrateDecDPAPI function again, but with another flag, so that it\n\nwill process the decrypted data in a different way.\n\nThe exfiltrateDecDPAPI function gets the decrypted data and the URL from the credentials store.\n\nThe user name and password are in this format: <user>:<pass> and the URL is in this format: Microsoft_WinInet_<url>.\n\nAt first, it cuts the Microsoft_WinInet_ from the string and gets only the URL part. Raccoon checks if the URL starts with the string\n\nftp://, filtering only the FTP servers from the HTTP basic authentication.\n\n\n-----\n\n_Figure 22: Selecting the FTP servers_\n\nAll the stolen FTP credentials are written to a text file named ie_ftp_data.txt.\n\n_Figure 23: FTP stolen credentials_\n\n\n-----\n\n#### Mozilla-Based Applications\n\nRaccoon gets the value of the libraries key from the configuration and downloads a ZIP file from the C&C server. The zip file\n\ncontains multiple different dlls in order to complete its malicious activity.\n\n_Figure 24: Downloads the Compressed Zip to Temp\\ADLibs\\ff-functions.zip_\n\nAfter downloading the file, it extracts all the files from the ff-funcs.zip to ADLibs, deletes the zip and adds ADLibs to PATH env\n\nvariables.\n\nTo extract and decrypt the user sensitive data from the Mozilla application, Raccoon must use nss3.dll, so it loads the nss3.dll from\n\nADLibs and all the relevant exported functions:\n\n###### • [NSS_Init]\n\n • [ NSS_Shutdown]\n\n • [ PK11_GetInternalKeySlot]\n\n • [ PK11_FreeSlot]\n\n • [ PK11_Authenticate]\n\n • [ PK11SDR_Decrypt]\n\n • [ sqlite3_open]\n\n • [ nss3.sqlite3_prepare_v2]\n\n • [ nss3.sqlite3_step]\n\n • [ nss3.sqlite3_column_text]\n\n • [ nss3.sqlite3_finalize]\n\nRaccoon relies again on the same technique to steal sensitive data from the Mozilla-based applications as the Chromium-based\n\nbrowsers. It has extraction functions that work for all the applications, because they have the same code base, which allows\n\nRaccoon to cover more applications easily.\n\n\n-----\n\n_Figure 25: Main Mozilla-based functionality_\n\nThis feature targets (120/24=5) Mozilla based applications, which includes popular browsers like Firefox and Email client like\n\nThunderbird.\n\nThe extraction and decryption functions get the application name and some directory path like Firefox,\\Mozilla\\Firefox\\.\n\nRaccoon creates a full path to the Profile folder of the application where all the sensitive files are located.\n\nIt does that by getting the RoamingAppData path, concats the hardcoded “Profiles” string to the application directory path (which\n\npassed to the func), for example, C:\\Users\\user\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles.\n\n\n-----\n\nThe Profiles folder contains the user profile for the application, it can be more than one folder, which may indicate multiple users;\n\ntherefore, it saves all those profiles paths.\n\nIn order to validate those profile directories within the “Profiles” folder, Raccon calls to NSS_Init (resolved function from nss3.dll)\n\nwith the Profile path, the function returns SECSuccess on success or SECFailure on failure. The profile folder is expected to contain\n\nthe certificate, key and module databases.\n\n###### Credentials - logins.json/signons.sqlite\n\nThe login credentials can be saved in two formats, in a JSON file or SQLite DB, depedning on the application version. It is more\n\ncommon for most of the stealers to extract data only from the logins.json file.\n\n###### logins.json\n\nThe malware decrypts the string logins.json and concats it to the profile path (C:\\Users\\user\\AppData\\Roaming\\Mozilla\\Firefox\\\n\nProfiles\\a11b22cc.default-release\\logins.json) and validates if the file exists and gets a handle to this file by calling to _fopen.\n\n_Figure 26: Logins.json content_\n\nEvery item in the logins list (second key in the JSON) is a saved login credential for a resource. Raccoon iterates this list and\n\nperforms the next actions for every login.\n\n**1.** Checks if there is value for the next keys:\n\nFor thunderbird application: hostname, encryptedUsername, encryptedPassword\n\nFor other applications: formSubmitURL, encryptedUsername, encryptedPassword\n\n**2.** Extracts the values from those keys. In order to decrypt the confidential values, the encrypted data is passed to a\n\nfunction that we named getDecryptedPK11.\n\n\n-----\n\ngetDecryptedPK11 function gets the encrypted data, which is encoded as base64, and retrieves the decrypted data. It uses\n\nCryptStringToBinaryA with the flag (CRYPT_STRING_BASE64) to convert the formatted string into bytes. The decryption routine\n\nuses the resolved crypto functions from nss3.dll.\n\n**1.** PK11_GetInternalKeySlot\n\n**2.** PK11_Authenticate\n\n**3.** PK11SDR_Decrypt\n\n**4.** PK11_FreeSlot\n\nThe function returns the decrypted data or “err” string for any error during the decryption process.\n\n**3.** After decrypting the data, the stealer calls to a function that we named buildBrowsersForm, which creates forms from all\n\nthe values in order to write them on the disk. The form looks like:\n\nHOST: %URL%\\n\n\nUSER: %username%\\n\n\nPASS: %password%\\n\\n\n\nThe buildBrowsersForm function returns the form as a string.\n\n**4.** Create a text file (or get a handle to an existing one) named passwords.txt/thinderbird.txt and write the form.\n\n###### signons.sqlite\n\nThis method is less common because it is supported only by older Mozilla based applications, like Firefox versions < 32. The\n\nprocess for extracting the data from SQLite DB is very similar to chrome based browsers:\n\n**1.** Decrypts the string “signons.sqlite” and create a full path to the DB and copies the DB to temp directory.\n\n**2.** Creates this SQL query SELECT encryptedUsername, encryptedPassword, formSubmitURL FROM moz_logins.\n\n**3.** Gets the extracted data and passes it to getDecryptedPK11 function and after that to buildBrowsersForm.\n\n_Figure 27: The stolen credentials_\n\n\n-----\n\n###### Cookies - cookies.sqlite\n\nThe Mozilla based applications store the cookies in an SQLite database named cookies.sqlite and it’s default location is under the\n\nuser’s profile folder (Profile\\%profile%).\n\nThis function starts similarly to the credentials extraction function since they both get the application name and path (it builds a\n\nfull path to the Profiles software directory) and saved all the profiles (directories) in the Profile folder.\n\nFor every directory in Profiles, which means every profile:\n\n**1.** The malware first decrypts the string \\cookies.sqlite, creating the full path for the DB (C:\\Users\\user\\AppData\\Roaming\\\n\nMozilla\\Firefox\\Profiles\\%profile%\\cookies.sqlite), and copies the DB to Temp directory.\n\n**2.** Handling the SQLite DB: The malware calls to NSS3sqlite3_open(pTempDB, hSqliteDB) in order to get a handle to this\n\nDB. Then, it decrypts the SQL query: SELECT host, path, isSecure, expiry, name, value FROM moz_cookies, prepares the\n\nstatement (query) by Nss3Sqlite3_prepare_v2 and passes it to Nss3sqlite3_step.\n\n**3.** Finally, it extracts the data from the DB by using Nss3sqlite3_column_text.\n\n**4.** The malware concats all the values from the DB together (the delimiter is between the values is TAB -> \\t and \\n for every\n\ncookie, so every line represents a cookie).\n\n**5.** It then creates a text file named firefox_cookie.txt and writes the stolen cookies.\n\n###### History- places.sqlite\n\nThe malware extracts user history from places.sqlite DB. The algorithm of this function is very similar to the previous function. The\n\nDB name and the SQL query is the only difference between those functions. The SQL query is SELECT url, visit_count, last_visit_\n\ndate FROM moz_places WHERE last_visit_date<> 0 AND visit_count <> 0. Using this query, Raccoon extracts the website URL, the\n\nduration of the visit and the last visit time. It writes the data to firefox_urls.txt.\n\n#### Outlook\n\nRaccoon also targets the popular email client Microsoft Outlook. It uses multiple techniques to extract the user data and also\n\nsupports older versions of Outlook software.\n\nThe stealer has a function that implements all the stealing techniques and returns the stolen data as a string. The returned data is\n\nwritten to a text file named outlook.txt.\n\nRaccoon extracts the email client information from a few registries key in different methods:\n\n###### • [HKCU\\Software\\Microsoft\\Internet Account Manager\\Accounts]\n\n • [ HKLM\\Software\\Microsoft\\Office\\Outlook\\OMI ]\n\n • [ HKCU\\Software\\Microsoft\\Office\\Outlook\\OMI Account Manage]\n\n • [ HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows Messaging Subsystem\\Profiles\\Microsoft Outlook Internet Settings]\n\n • [ HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows Messaging Subsystem\\Profiles\\Outlook]\n\n • [ HKCU\\Software\\Microsoft\\Office\\19.0\\Outlook\\Profiles\\Outlook]\n\nRaccoon tries to extract information from this registry seven times with different version numbers from 19.0 to 13.0.\n\n\n-----\n\nRaccoon uses two functions to enumerate all the values under a received registry path: lvl1_regEnum and lvl2_regEnum.\n\nMoreover, it has a “core” function that extracts the account information from a received registry key. This function is named\n\ngetOutlookAccount.\n\nlvl1_regEnum calls to Identities and lvl2_regEnum calls to getOutlookAccount, so it looks like this:\n\nlvl1_regEnum→ lvl2_regEnum→ getOutlookAccount\n\n###### lvl1_regEnum\n\nThe function gets two parameters – two strings for a registry key or one string for a registry key and null. The function builds a\n\nregistry key string and passes it to lvl2_regEnum.\n\n**1.** It opens the first registry key (the first argument) within HKEY_CURRENT_USER and enumerates all the subkeys under\n\nthis registry path.\n\n**2.** Creates a new string that represents a registry key that combines the first argument, the enumerated key and the second\n\nargument (if there is one). For example, Software\\Microsoft\\Internet Account Manager\\Accounts\\%enumrated_key%\\\n\nIdentities\n\n**3.** The malware calls to lvl2_regEnum and passes the newly built string.\n\n###### lvl2_regEnum\n\nThe function gets one parameter – a string that represents a registry key.\n\n**1.** Raccoon opens the registry key (the argument) within HKEY_CURRENT_USER and enumerates all the subkeys under this\n\nargument.\n\n**2.** It creates a new string that represents a registry key that combines the first argument and the enumerated key\n\n_(arg_0+EnumratedKey)._\n\n**3.** It calls to getOutlookAccount and passes the newly created registry key.\n\n###### getOutlookAccount function\n\nThe function gets the final enumerated registry key and checks all the values in the registry key in order to find AN outlook account\n\nvalues.\n\nThe values that Raccoon searches are:\n\nSMTP Email Address, SMTP Server, POP3 Server, POP3 User Name, SMTP User Name, NNTP Email Address, NNTP User Name, NNTP\n\nServer, IMAP Server, IMAP User Name, Email, HTTP User, HTTP Server URL, POP3 User, MAP User, HTTPMail User Name, HTTPMail\n\nServer, SMTP User, POP3 Password2, IMAP Password2, NNTP Password2, HTTPMail Password2, SMTP Password2, POP3 Password,\n\nIMAP Password, NNTP Password, HTTP Password, SMTP Password, POP3 Port, SMTP Port, IMAP Port\n\n\n-----\n\n_Figure 28: Raccoon targeting Outlook’s values_\n\nTo do so:\n\n**1.** Raccoon enumerates all the values within the registry path.\n\n**2.** It searches those targeted values.\n\n**3.** It saves the extracted data in the next form: %value%:%data%\\n.\n\n   - For encrypted values like passwords, it decrypts the password using CryptUnprotectData and then it saves the data.\n\nAfter extracting all those values for multiple accounts Raccoon writes it back to a file named outlook.txt.\n\n_Figure 29: Stolen data from Outlook_\n\n\n-----\n\nThe calling order to lvl1_regEnum and lvl2_regEnum is:\n\n**1.** Calling to lvl2_regEnum(&L”Software\\Microsoft\\Internet Account Manager\\Accounts”)\n\n**2.** Calling to lvl1_regEnum (&L”Identities”, &L”Software\\Microsoft\\Internet Account Manager\\Accounts”)\n\n**3.** Search and get the data for the Outlook value in this reg key: HKLM\\Software\\Microsoft\\Office\\Outlook\\OMI Account\n\nManager. The data is also a reg key. After that, it calls to lvl2_regEnum(%OutlookRegResult%).\n\n**4.** Calling to lvl2_regEnum(&L”\\Software\\Microsoft\\Office\\Outlook\\OMI Account Manager”).\n\n**5.** Calling to lvl1_regEnum (&L”Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows Messaging Subsystem\\Profiles\\\n\nMicrosoft Outlook Internet Settings”, 0)\n\n**6.** Calling to lvl1_regEnum (&L”Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows Messaging Subsystem\\Profiles\\\n\nOutlook”, 0)\n\n**7.** Calling to lvl1_regEnum 7 times with different version numbers (19.0 - 13.0). For example: lvl1_regEnum(&L”Software\\\n\nMicrosoft\\Office\\19.0\\Outlook\\Profiles\\Outlook”, 0)\n\nApplication Name Version Number\n\nOutlook 97 0\n\nOutlook 98 5\n\nOutlook 2000 0\n\nOutlook XP/2002 10.0\n\nOutlook 2003 11.0\n\nOutlook 2007 12.0\n\nOutlook 2010 14.0\n\nOutlook 2013 15.0\n\nOutlook 2016 16.0\n\nOutlook 2019 16.0\n\n#### Foxmail\n\nFoxmail is an Email client that is popular in China.\n\nRaccoon decrypts some strings for the application default location:\n\n###### • [D:\\Program Files\\Foxmail 7.2\\Storage]\n\n • [D:\\Program Files (x86)\\Foxmail 7.2\\Storage]\n\n • [D:\\Program Files (x86)\\Foxmail 7.2\\Storage]\n\n • [C:\\Program Files\\Foxmail 7.2\\Storage]\n\n • [C:\\Program Files (x86)\\Foxmail 7.2\\Storage]\n\n • [C:\\Foxmail 7.2\\Storage]\n\nFor every location, Raccoon tries to find the file that contains the confidential data.\n\nThe storage directory contains directories and each directory is a user account. The sensitive file is Account.rec0, which is within\n\nthe Accounts directory, for example, C:\\Foxmail 7.2\\Storage\\%user_account%\\Accounts\\Account.rec0.\n\n|Application Name|Version Number|\n|---|---|\n|Outlook 97|0|\n|Outlook 98|5|\n|Outlook 2000|0|\n|Outlook XP/2002|10.0|\n|Outlook 2003|11.0|\n|Outlook 2007|12.0|\n|Outlook 2010|14.0|\n|Outlook 2013|15.0|\n|Outlook 2016|16.0|\n|Outlook 2019|16.0|\n\n\n-----\n\nThe Account.rec0 doesn’t have a known format, but it contains some encoded UTF-8 strings.\n\nFirst, the malware creates a file with a random name and copies the Account.rec0 file from the account directory, encoding the new\n\nfile as UTF-8. It look for a string between the “password” string and the “!PeriodicCheckTime” string in the file. The result is the\n\nencrypted password by DPAPI, so it decrypts the string (hex characters).\n\nSecond, it copies the Account.rec0 file from the account directory again and creates a file with a random name. Again, it encodes\n\nthe copied file as UTF-8 and looks for the next strings “outgoingssl” “OutgoingServer” “InComingSSL” “IncomingServer” – the result\n\nfrom the first pair is the SMTP server name and the result from the second pair is the IMAP server name.\n\nIt writes the stolen data to a file named foxmail.temp.\n\n_Figure 30: Stolen Foxmail credentials_\n\n#### Cryptocurrency Wallets\n\nRaccoon is not solely focused on user credentials. It also has financial goals, so it grabs wallet files from the machine. Most, if not\n\nall the Cryptocurrency Wallets are encrypted by Master Password. Therefore, the attacker has to use brute force to decrypt those\n\nwallets and extract the sensitive data.\n\nRaccoon leverages the fact that most users installed the wallet applications at the default location.\n\n###### Electrum\n\n**1.** Raccoon decrypts the string \\Electrum, gets the AppData path by calling to _getenv and creates the path to Electrum\n\nfolder (C:\\Users\\%user%\\AppData\\Roaming\\Electrum\\).\n\n**2.** Scans the folder in order to find a file named “default_wallet” (the default wallet name for Electrom wallet).\n\n**3.** It creates a Wallets directory in temp (if there is no such directory), creates a subfolder named Electrum and copies the\n\nwallet to this folder.\n\n**4.** After scanning the Electrum folder, Raccoon tries to find wallets in this hardcoded path: C:\\Users\\%user%\\AppData\\\n\nRoaming\\Electrum\\wallets.\n\n\n-----\n\n###### Ethereum\n\n**1.** Raccoon decrypts the string \\Ethereum Wallet, gets the AppData path by calling to _getenv and creates the path to\n\nEthereum folder (C:\\Users\\%user%\\AppData\\Roaming\\Ethereum Wallet).\n\n**2.** It scans the folder in order to find a file whose name contains “UTC_”.\n\n**3.** It creates a Wallets directory in temp (if there is no such directory), creates a subfolder named Ethereum and copies the\n\nwallet to this folder.\n\n**4.** After scanning the Electrum folder, Raccoon tries to find wallets in this hardcoded path: C:\\Users\\%user%\\AppData\\\n\nRoaming\\Ethereum but only if the file name contains “UTC_”.\n\n###### Exodus\n\n**1.** Raccoon decrypts the string \\Exodus\\exodus.wallet.\n\n**2.** It creates Wallets in temp (if there is no such directory), creatse a subfolder named Exodus and creates the exodus.wallet\n\nfolder inside that folder.\n\n**3.** It copies all the files from exodus.wallet directory to the created folder (C:\\Users\\%user%\\AppData\\Local\\Temp\\Wallets\\\n\nExodus\\exodus.wallet).\n\n**4.** After it copies all the files, Raccoon tryes to find wallets in this hardcoded path: C:\\Users\\%user%\\AppData\\Roaming\\\n\nExodus, looking for JSON files and copied them to C:\\Users\\%user%\\AppData\\Local\\Temp\\Wallets\\Exodus.\n\n###### Jaxx\n\n**1.** Raccoon decrypts the string \\Jaxx\\Local Storage, gets the AppData path by calling to _getenv and creates the path to Jaxx\n\nfolder (C:\\Users\\%user%\\AppData\\Roaming\\Jaxx\\Local Storage).\n\n**2.** Creates Wallets in temp (if there is no such directory) and creates a subfolder named Jaxx.\n\n**3.** It copies all the files from this folder to C:\\Users\\%user%\\AppData\\Local\\Temp\\Wallets\\\n\n###### Monero\n\n**1.** Raccoon decrypts the string \\Documents\\Monero\\wallets.\n\n**2.** The Monero default installation directory is within the user directory; therefore, Raccon gets the user directory by calling\n\nto getenve and passing USERPROFILE. This user profile is concatenated with the decrypted string, so it looks like\n\nC:\\Users\\%user%\\Documents\\Monero\\wallets.\n\n**3.** It enumerates all the wallets in this folder (each folder is a wallet).\n\n**4.** It scans each folder for a file that contains .keys extension.\n\n**5.** It copies only the keys file to a Monero temp folder.\n\n###### Bither\n\nThe execution time for stealing a Bither wallet file is a little bit non-traditional. Raccoon’s normal behavior is to steal all of the data\n\nof a particular type before it goes on to steal data of another type (i.e. stealing from all the crypto wallets and then moving to\n\nstealing from another data type). However, when Raccoon steals data from crypto wallets, it doesn’t include the Bither wallet. The\n\nBither wallet is only included when the malware gathers all of the stolen data to zip file. It then adds the Bither wallet file directly to\n\nthe zip.\n\n**1.** Raccoon decrypts \\AppData\\Roaming\\Bither\\address.db.\n\n\n-----\n\n**2.** It gets the current user directory and creates this path C:\\Users\\%user%\\AppData\\Roaming\\Bither\\address.db.\n\n**3.** It adds the wallet file to the zip file.\n\n###### Wallet Grabber\n\nRaccoon scans all the files/folders in AppData (C:\\Users\\user\\AppData\\Roaming).\n\n**1.** It checks for a file named wallet.dat in AppData.\n\n**2.** For every wallet.dat, it creates a new name according to the parent directory name (which is probably the crypto wallet\n\napplication name).\n\n**3.** It copies the wallet.dat file to the wallets directory.\n\n_Figure 31: Grabbed wallet_\n\n#### Gather information about the compromised machine\n\nRaccoon gathers information about the system it has infiltrated and adds this information to the stolen data.\n\nAt first, Raccoon gets the public IP address of the machine from the configuration JSON that it retrieved from the C&C. There is a\n\nkey in the JSON named ip, which contains the IP address.\n\n**1.** After the hardcoded date – which for this sample is probably the build date (Fri Aug 23 14:42:12 2019) – it decrypts the\n\nstring Build compiled on.\n\n\n-----\n\n_Figure 32: The hardcoded value & the decryption routine_\n\n**2.** The malware decrypts Raccoon Version “[Raccoon Stealer] - v1.2 Kushage Release,” which we see is build version 1.2.\n\n**3.** It gets the current time (when the stealer lunched).\n\n**4.** It creates again the Machine ID - %machineGUID%_%username%, as described within the blog post.\n\n**5.** It gets the system default locale by calling to GetUserDefaultLCID,GetLocaleInfoA.\n\n**6.** It gets the OS version and name by calling to GetVersionExA and querying the next registry value, ProductName, within the\n\nnext key, SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion.\n\n**7.** It checks the system architecture by calling to a function that should retrieve a folder used by 64-bit architecture. This\n\ndirectory is not present on 32-bit Windows.\n\n\n-----\n\n_Figure 33: 64bit Function_\n\n**8.** [Raccoon gets information about the CPU by using CPUID instruction Processor brand string technique. The processor](http://insightforfuture.blogspot.com/2010/11/how-to-find-your-processor-brand-string.html)\n\nbrand string returns EAX, EBX, ECX, and EDX to the registers. Moreover, it calls to GetSystemInfo to get the number of\n\nprocessors.\n\n**9.** It calls to GlobalMemoryStatusEx in order to retrieve information about the current state of the physical memory.\n\n**10. It gathers information about the system’s screen resolution by calling to GetSystemMetrics two times, once with the SM_**\n\nCYSCREEN flag to get the height of the window and then with the SM_CXSCREEN flag to get the width of the screen. In\n\naddition, it gets the display name by calling EnumDisplayDevicesA.\n\n**11. Installed applications, Raccoon is using known methods to get this information.**\n\nIt opens this reg path HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\n\nand gets the DipslayName value for every key under this path. Raccoon filters the applications by checking every value to see\n\nif it contains the string Microsoft or Visual or Windows. After filtering the applications, it tries to get the DisplayVersion value.\n\n**Raccoon doesn’tt take into consideration when the DisplayVersion registry value doesn’t exist, so when it creates the form for\n\nthe installed applications section it doesn’t separate the application by \\n like it does when there is a DisplayVersion registry value.\n\nAll the data about the system is written to a text file named machineinfo.txt (when it adds this file to the zip, the file name changes\n\nto System Info.txt)\n\n\n-----\n\n_Figure 34: Stolen information from a machine_\n\nFurthermore, after gathering the information about the system, Raccoon can (based on the configuration build) take a screenshot\n\n[from the machine using GDI. You can read more about this method here: https://www.codeproject.com/Articles/5051/Various-](https://www.codeproject.com/Articles/5051/Various-methods-for-capturing-the-screen)\n\n**[methods-for-capturing-the-screen](https://www.codeproject.com/Articles/5051/Various-methods-for-capturing-the-screen)**\n\n_Figure 35: Capturing a Screenshot Using GDI_\n\n\n-----\n\n### Final Steps\n\nRaccoon creates a zip file named Log.zip, which contains all the stolen information from the machine, including text files, wallets\n\nfiles and PNG files. The data in the zip file is organized by category (browsers, mail, wallets, etc.)\n\n_Figure 36: Example of what the Log.zip can contain_\n\n#### Sending It All Back to C&C\n\nSo, Raccoon gathered all the stolen information to one zip file and now it just has to send that file to the C&C. Raccoon’s\n\nconfiguration contains the C&C handle to the stolen file.\n\nTo send the file back to C&C, it creates a POST request that contains the zip file.\n\n**1.** Like most of the strings in Raccoon’s binary, the strings for sending the file back to the C&C are encrypted. So, Raccoon\n\ndecrypts them (some HTTP headers).\n\n###### ˚ [Content-type: multipart/form-data, boundary=Jfbvjwj3489078yuyetu]\n\n\n-----\n\n###### ˚ [\\r\\n--Jfbvjwj3489078yuyetu\\r\\ncontent-disposition: form-data; name=”file”; filename=”data.zip”\\r\\nContent-Type: application/]\n\noctet-stream\\r\\n\\r\\n\n\n###### ˚ [\\r\\n--Jfbvjwj3489078yuyetu--]\n\n**2.** Raccoon gets a handle to Log.zip and the file size.\n\n**3.** It allocates a new block of memory in the heap as the size of the Log. zip file + 0x800 bytes.\n\n**4.** It copies the pointer from Log.zip to the newly allocated memory.\n\n**5.** It Copies the second decrypted string next to the file pointer.\n\n_Figure 37: Copy the values to the memory block_\n\n**6.** Copy the Log.zip data (binary) to the allocated memory next to the second decrypted string\n\n_Figure 38: Copy the log.zip Binary to the Memory Block_\n\n\n-----\n\n**7.** It copies the third decrypted string next to log.zip data. This string is used to identify the end of the file.\n\n_Figure 39: The allocated memory block_\n\nRaccoon uses functions from Winhttp.dll for the network session. When it uses WinHttpSendRequest, the optional data (lpOptional)\n\nreceives a pointer to the newly created memory block and the additional headers (=pszHeaders) receive the first decrypted string –\n\nContent-type: multipart/form-data, boundary=Jfbvjwj3489078yuyetu. In doing that, Raccoon creates a POST request to the C&C that\n\ncontains the Log.zip data. The string Jfbvjwj3489078yuyetu represents the boundary of the Log.zip data in the POST request.\n\n_Figure 40: The POST to the C&C_\n\n\n-----\n\n#### Deleting Its Traces\n\nIn order to delete its trace from the machine, Raccoon creates a cmd.exe process that creates a ping.exe process and runs a delete\n\ncommand for the stealer file.\n\nIt gets the stealer file path (current process) by using GetModuleFileNameA and decrypts the next strings: cmd.exe /C ping 1.1.1.1 -n 1\n\n-w 3000 > Nul & Del /f /q “%s”.\n\nThe cmd process runs the next command ping 1.1.1.1 -n 1 -w 3000 > Nul & Del /f /q “%stealer_path”.\n\n### Summary\n\nIn this research, we cover in great technical detail Raccoon’s techniques for communicating with the C&C server and stealing\n\nsensitive data from compromised systems. It is clear that Raccoon’s methods are not overly sophisticated, however this technique\n\nstill provides nefarious characters with success in carrying out their attacks. This Malware-as-a-Service is available at a very low\n\nprice and proves to be an effective and powerful stealer, making it extremely popular among cybercriminals.\n\nRaccoon steals data from a variety of applications, like browsers, email clients, cryptocurrency wallets, etc. As users of many of\n\nthese targets, we wish to mitigate the risk of an attack to those sensitive assets from threats like Raccoon and raise awareness\n\nto the danger of opening suspicious attachments or clicking unknown URLs. The CyberArk Endpoint Privilege Manager solution\n\ncan also aid in defending against credential-stealing malware. For more information on how to secure your organization from\n\n[cyberattacks, please visit www.cyberark.com.](http://www.cyberark.com)\n\n#### IoCs\n\n###### • [SHA256]\n\n ˚ [a57e1f3217b993476c594570095d28b6c287731a005325e5f64a332a86cb7878]\n\n • [Malicious Activity]\n\n ˚ [Mutex - rc/][%username%]\n ˚ [cmd.exe /C ping 1.1.1.1 -n 1 -w 3000 > Nul & Del /f /q ][%malware_path%]\n\n • [ Network Communication]\n\n ˚ [https://drive[.]google[.]com/uc?export=download&id=1QQXAXArU8BU4kJZ6IBsSCCyLtmLftiOV]\n ˚ [http://35[.]189[.]105[.]242/gate]\n ˚ [http://35[.]189[.]105[.]242/gate/sqlite3.dll]\n ˚ [http://35[.]189[.]105[.]242/gate/libs.zip]\n\n\n-----\n\n#### YARA Rule\n\nrule raccoon_stealer_rule\n{\nmeta:\nauthor = “Ben Cohen, CyberArk”\ndate = “16-01-2020”\nstrings:\n$stealer_typo = “g:\\stealer\\stealler\\json.hpp” wide\n$path1 = “\\Google\\Chrome SxS\\User Data” wide\n$path2 = “\\Chromium\\User Data” wide\n$path3 = “\\Xpom\\User Data” wide\n$path4 = “\\Comodo\\Dragon\\User Data” wide\n$path5 = “\\Amigo\\User Data” wide\n$path6 = “\\Orbitum\\User Data” wide\n$path7 = “\\Bromium\\User Data” wide\n$path8 = “\\Nichrome\\User Data” wide\n$path9 = “\\RockMeIt\\User Data” wide\n$path10 = “\\360Browser\\Browser\\User Data” wide\n$db1 = “Login Data” wide\n$db2 = “Cookies” wide\n$db3 = “Web Data” wide\ncondition:\n$stealer_typo or\n(4 of $path* and 2 of $db*)\n}\n\nThis whitepaper is based on research done by CyberArk Labs Researcher Ben Cohen.\n\n###### About CyberArk Labs\n\nCyberArk Labs is a team of cyber security experts who conduct research focused on targeted attacks against organizational networks\n– the methods, tools and techniques employed by targeted attackers, as well as methods and techniques to detect and mitigate such\nattacks.\n\n###### About CyberArk\n\nCyberArk is the global leader in privileged access management, a critical layer of IT security to protect data, infrastructure and assets\nacross the enterprise, in the cloud and throughout the DevOps pipeline. CyberArk delivers the industry’s most complete solution to reduce\nrisk created by privileged credentials and secrets. The company is trusted by the world’s leading organizations, including more than 50\npercent of the Fortune 100, to protect against external attackers and malicious insiders. A global company, CyberArk is headquartered in\nPetach Tikva, Israel, with U.S. headquarters located in Newton, Mass. The company also has offices throughout the Americas, EMEA, Asia\nPacific and Japan.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://lp.cyberark.com/rs/316-CZP-275/images/CyberArk-Labs-Racoon-Malware-wp.pdf"
    ],
    "report_names": [
        "CyberArk-Labs-Racoon-Malware-wp.pdf"
    ],
    "threat_actors": [
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716493,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1585734152,
    "ts_modification_date": 1585734154,
    "files": {
        "pdf": "https://archive.orkl.eu/f6e48ec049cf2557da17a22b1b721aea4a086273.pdf",
        "text": "https://archive.orkl.eu/f6e48ec049cf2557da17a22b1b721aea4a086273.txt",
        "img": "https://archive.orkl.eu/f6e48ec049cf2557da17a22b1b721aea4a086273.jpg"
    }
}