{
    "id": "2f683520-094f-4ee7-9dba-6b9555cd941e",
    "created_at": "2023-05-06T02:08:46.77494Z",
    "updated_at": "2025-03-27T02:05:39.402911Z",
    "deleted_at": null,
    "sha1_hash": "a35b4792c22ebaba3fc12a549e7d1114dd349019",
    "title": "2023-03-31 - A Comprehensive Analysis of the 3CX Attack",
    "authors": "",
    "file_creation_date": "2023-05-05T01:44:13Z",
    "file_modification_date": "2023-05-05T01:44:13Z",
    "file_size": 2627487,
    "plain_text": "# A Comprehensive Analysis of the 3CX Attack\n\n**[blog.cyble.com/2023/03/31/a-comprehensive-analysis-of-the-3cx-attack](https://blog.cyble.com/2023/03/31/a-comprehensive-analysis-of-the-3cx-attack)**\n\n## InfoStealer Deployed in a Massive Supply Chain Attack\n\n\nMarch 31, 2023\n\n\n[An ongoing supply chain attack has been reported, targeting customers of 3CX, a VoIP IPBX software](https://www.reddit.com/r/crowdstrike/comments/125r3uu/20230329_situational_awareness_crowdstrike/)\ndevelopment company. This attack has been attributed to North Korean Threat Actors (TAs). Currently,\nthe 3CX DesktopApp can be accessed on various platforms, including Windows, macOS, Linux, and\nmobile.\n\nHowever, reports have indicated that the ongoing activity related to the supply chain attack has been\ndetected on both Windows and macOS operating systems. The attack involves a Trojanized version of\nthe 3CX, a Voice Over Internet Protocol (VOIP) desktop client, which has been digitally signed. 3CX’s\nPhone System is utilized by over 600,000 companies globally and has over 12 million daily users.\n\nThe highlights of the incident are as follows:\n\nOn March 29, a significant number of EDR providers and antivirus solutions began to identify and\nsignal a warning for the legitimate 3CXDesktopApp.exe binary, which was signed.\nThis binary had initiated an update procedure that ultimately led to malicious activity and\ncommunication with Command-and-Control servers.\nThe 3CX download that was accessible on the official public website was infected with malware.\nSystems that had already been installed would undergo updates that would ultimately result in the\ndownload of this malware.\nThe attack involves a multi-stage process that starts with the 3CX desktop application.\nThe process of retrieving malicious payloads from GitHub involves a delay of 7 days before the\ndownload takes place. This delay could be an attempt to evade detection by security systems\nmonitoring suspicious activities\n\n\n-----\n\nAs per reports, the last stage of the attack involves stealing information. This malware can gather\nsystem data and take control of data and login credentials stored in user profiles on various web\nbrowsers, including Chrome, Edge, Brave, and Firefox.\nBoth the Windows and macOS installers for 3CX have been impacted.\nAs per researchers, the evidence from GitHub indicates that the infrastructure utilized by the\nWindows variant was activated on December 7, 2022.\nAdditionally, the domains and web infrastructure utilized in the attacks were registered as early as\nNovember 2022.\n\nThe 3CX Phone Management System can be implemented on-premises. Upon further investigation, we\nfound that over 240,000 publicly exposed instances of this application.\n\nThe figure below shows the Shodan search results.\n\nFigure 1 – Exposed Instances\nWe also came across a Reddit post where a user reported suspicious activity that occurred after updating\nthe 3CX desktop on March 24, 2023. According to the user, the 3cxdesktopapp.exe program accessed\nbrowser caches, as revealed by EDR file history data.\n\nFigure 2 – Reddit Post\n\n\n-----\n\nAccording to 3CX, the recent attack was a result of infected bundled libraries that were compiled into the\nWindows Electron App through GIT. The vendor has also stated, “Electron Windows App shipped in\nUpdate 7, version numbers 18.12.407 & 18.12.416, includes a security issue. Anti-Virus vendors have\nflagged the executable 3CXDesktopApp.exe and in many cases uninstalled it. Electron Mac App version\nnumbers 18.11.1213, 18.12.402, 18.12.407 & 18.12.416 are also affected.”\n\nThe .msi file, when executed, drops two malicious files – “ffmpeg.dll” and “d3dcompiler_47.dll” – in the\nlocation C:\\Users[user_name]\\AppData\\Local\\Programs\\3CXDesktopApp\\app.\n\nThe infection begins when the benign file “3CXDesktopApp.exe” loads “ffmpeg.dll”. Then, “ffmpeg.dll”\ndecrypts the encrypted code from “d3dcompiler_47.dll”, which seems to be a shellcode.\n\nThis shellcode loads another DLL file that tries to access the IconStorages GitHub page to find an .ico file\ncontaining the encrypted Command-and-Control (C&C) server. After locating the C&C server, the\nbackdoor establishes a connection to retrieve the potential final payload.\n\nThe figure below shows the infection flow.\n\nFigure 3 – Infection chain\n\n## Technical Analysis\n\nThe MSI package installer that has been compromised has a digital signature, and its appearance\nresembles that of a legitimate file, as shown below.\n\n\n-----\n\nFigure 4 – Digitally signed MSI\n\ninstaller\nUpon installation, the MSI package installer drops files such as “3CXDesktopApp.exe”, “ffmpeg.dll”, and\n“d3dcompiler_47.dll” in the %LocalAppData% directory of the system.\n\n_%LocalAppData%\\Programs\\3CXDesktopApp\\app\\_\n\nThese files are associated with malicious behavior and are accompanied by other supporting files.\n\nThe figure below displays the directory where the “3CXDesktopApp” application has been installed.\n\n\n-----\n\nFigure 5 – 3CXDesktop installation folder\nAfter installation, the “3CXDesktopApp.exe” file is executed, which is usually benign but can be utilized to\nload the malicious DLL, as shown below.\n\nFigure 6 – 3CXDesktop.exe loading ffmpeg.dll file\nThe figure below illustrates the process tree of the “3CXDesktopApp” application.\n\n\n-----\n\nFigure 7 – Process tree\nThe “3CXDesktopApp.exe” loads the “ffmpeg.dll” file, which is a malicious DLL that has been specifically\ndesigned to read, load, and execute harmful shellcode from the “d3dcompiler_47.dll” file.\n\nWhen executed, the “ffmpeg.dll” creates a new event, “AVMonitorRefreshEvent“, identifies the current file\npath, and searches for the next file in the sequence, which is “d3dcompiler_47.dll”. Once identified, the\n“ffmpeg.dll” loads the “d3dcompiler_47.dll” file into memory, as illustrated in the assembly code shown\nbelow.\n\nFigure 8 – ffmpeg.dll file is loading d3dcompiler_47.dll\nAlthough the loaded “d3dcompiler_47.dll” is signed by Microsoft, it has an encrypted payload embedded\nwithin it. The “ffmpeg.dll” file now identifies the encrypted payload indicated by a particular marker,\n‘0xCEFAEDFE’, as shown below.\n\n\n-----\n\nFigure 9 – Identifying encrypted payload in “d3dcompiler_47.dl”l\nOnce the encrypted payload has been identified, the “ffmpeg.dll” proceeds to decrypt the RC4 stream\nusing the key “3jB(2bsG#@c7“. This decryption process results in a shellcode which is then executed by\nthe DLL file.\n\nThe figure below shows the RC4 loop and decrypted shellcode function.\n\n\n-----\n\nFigure 10 – RC4 loop and decrypted shellcode\nAfter decryption, the “ffmpeg.dll” file employs the VirtualProtect() function to alter the memory access\npermissions of the shellcode. Once the permissions have been changed, the malware proceeds to\nexecute the payload.\n\nAn embedded DLL file is present within the decrypted shellcode, as shown in the below figure, which\nappears to be functioning as a loader for another PE file.\n\n\n-----\n\nFigure 11 – Embedded DLL file inside Shellcode\nAfter being loaded and executed, the embedded DLL file in the shellcode initiates a sleep state of 7 days\nbefore trying to establish communication with Command and Control (C&C) servers. Subsequently, the\nDLL will attempt to access a GitHub repository that contains an .ICO file.\n\nFigure 12 – Hardcoded GitHub link to download the .ICO file\nThis ICO file comprises the encrypted C&C strings, which are encoded using Base64 and encrypted with\nAES & GCM encryption. The Base64 contents are located at the end of the ICO image file, as shown\nbelow.\n\n\n-----\n\nFigure 13 – Base64-encoded string at the end of ICO file\nUpon execution, the DLL file decrypts the C&C URLs from the ICO files for downloading additional\npayloads from the remote server. To obtain distinct C&C URLs, the malware randomly selects an ICO file\nfrom a GitHub repository. Unfortunately, we were unable to verify the specific characteristics of these\npayloads as the corresponding GitHub repository was taken down prior to this analysis.\n\nResearchers discovered that the final stage of malware is a stealer, which can extract system information\nand steal sensitive information from popular web browsers, such as Chrome, Edge, Brave, and Firefox.\n\n## Conclusion\n\nThe potential damage caused by the 3CXDesktopApp supply chain attack is significant, including the\ntheft of sensitive user data. Organizations affected by this attack should immediately take steps to\nprevent it from causing widespread harm. The current investigation suggests that the threat actor behind\nthis attack is skilled and persistent.\n\nThe consequences of such an attack, such as financial loss, reputational impact, and the loss of\ncustomer trust, are severe. It is crucial that organizations remain vigilant and take proactive measures to\nsecure their supply chains to prevent similar attacks in the future.\n\n## Our Recommendations\n\nWe have listed some essential cybersecurity best practices that create the first line of control against\nattackers. We recommend that our readers follow the best practices given below:\n\nThoroughly investigate all systems to determine the scope and extent of the attack, including\nidentifying all affected systems and data.\nConduct regular security audits of your supply chain to ensure that all third-party software and\ncomponents are trustworthy and secure.\nMonitor your network regularly for any suspicious activity or behavior indicating a security breach,\nsuch as unauthorized access attempts or data exfiltration.\nStay up-to-date with the latest threat intelligence and security news to stay informed about\nemerging threats and vulnerabilities. This will help to mitigate risks proactively and respond quickly\nin the event of an attack.\n\n\n-----\n\nUsing a reputed antivirus and internet security software package is recommended on connected\ndevices, including PCs, laptops, and mobile devices.\nBlock URLs that could be leveraged to spread malware.\n\nMITRE ATT&CK® Techniques\n\n**Tactic** **Technique ID** **Technique Name**\n\n**Initial Access** [T1195](https://attack.mitre.org/techniques/T1195/) Supply Chain Compromise\n\n**Execution** [T1204.002](https://attack.mitre.org/techniques/T1204/002/) User Execution: Malicious File\n\n\n**Defense**\n**Evasion**\n\n**Credential**\n**Access**\n\n**Command and**\n**Control**\n\n\n[T1140](https://attack.mitre.org/techniques/T1140/)\n\n[T1027](https://attack.mitre.org/techniques/T1027/)\n\n[T1574.002](https://attack.mitre.org/techniques/T1574/002/)\n[T1497.003](https://attack.mitre.org/techniques/T1497/003/)\n\n[T1555](https://attack.mitre.org/techniques/T1555/)\n\n[T1539](https://attack.mitre.org/techniques/T1539/)\n\n\nDeobfuscate/Decode Files or Information\n\nObfuscated Files or Information\n\nHijack Execution Flow: DLL Side-Loading Virtualization/Sandbox\nEvasion: Time-Based Evasion\n\nCredentials from Password Stores\n\nSteal Web Session Cookie\n\n\n[T1071](https://attack.mitre.org/techniques/T1071/) Application Layer Protocol\n\n\n## Indicators of Compromise (IOCs)\n\n**Indicators** **Indicator**\n**Type**\n\n\n**Description**\n\n3CX\nWindows\nInstaller\n\n3CX\nWindows\nInstaller\n\n3CX macOS\nInstaller File\n\n3CX macOS\nInstaller File\n\nMalicious\nDLL\n\nMalicious\nDLL\n\n\nf3d4144860ca10ba60f7ef4d176cc736\n\nbea77d1e59cf18dce22ad9a2fad52948fd7a9efa\n\naa124a4b4df12b34e74ee7f6c683b2ebec4ce9a8edcf9be345823b4fdcf5d868\n\n0eeb1c0133eb4d571178b2d9d14ce3e9\n\nbfecb8ce89a312d2ef4afc64a63847ae11c6f69e\n59e1edf4d82fae4978e97512b0331b7eb21dd4b838b850ba46794d9c7a2c0983\n\n5729fb29e3a7a90d2528e3357bd15a4b\n\n19f4036f5cd91c5fc411afc4359e32f90caddaac\n\n5407cda7d3a75e7b1e030b1f33337a56f293578ffa8b3ae19c671051ed314290\n\nd5101c3b86d973a848ab7ed79cd11e5a\n\n3dc840d32ce86cebf657b17cef62814646ba8e98\n\ne6bbc33815b9f20b0cf832d7401dd893fbc467c800728b5891336706da0dbcec\n\n82187ad3f0c6c225e2fba0c867280cc9\n20d554a80d759c50d6537dd7097fed84dd258b3e\n\n11be1803e2e307b647a8a7e02d128335c448ff741bf06bf52b332e0bbf423b03\n\n74bc2d0b6680faa1a5a76b27e5479cbc\n\nbf939c9c261d27ee7bb92325cc588624fca75429\n\n7986bbaee8940da11ce089383521ab420c443ab7b15ed42aed91fd31ce833896\n\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\n\ncad1120d91b812acafef7175f949dd1b09c6c21a SHA1 Stealer\nPayload\n\n\n-----\n\nakamaicontainer[.]com\n\nakamaitechcloudservices[.]com\n\nazuredeploystore[.]com\n\nazureonlinecloud[.]com\n\nazureonlinestorage[.]com\n\ndunamistrd[.]com\n\nglcloudservice[.]com\n\njournalide[.]org\n\nmsedgepackageinfo[.]com\n\nmsstorageazure[.]com\n\nmsstorageboxes[.]com\n\nofficeaddons[.]com\n\nofficestoragebox[.]com\n\npbxcloudeservices[.]com\n\npbxphonenetwork[.]com\n\npbxsources[.]com\n\nqwepoi123098[.]com\n\nsbmsa[.]wiki\n\nsourceslabs[.]com\n\nvisualstudiofactory[.]com\n\nzacharryblogs[.]com\n\ngithub[.]com/IconStorages/images\n\nazureonlinestorage.com convieneonline[.]com\n\nSoyoungjun[.]com\n\n3bb80e9fbeac5383b313084775c80d11\n\n9c943baad621654cc0a0495262b6175276a0a9fb\n\n210c9882eba94198274ebc787fe8c88311af24932832a7fe1f1ca0261f815c3d\n\n644f63f869e2b0a9e5d1aa32823956cc\n\n96910a3dbc194a7bf9a452afe8a35eceb904b6e4\n\na541e5fc421c358e0a2b07bf4771e897fb5a617998aa4876e0e1baa5fbb8e25c\n\n8875568b90bb03ff54d63d3bd1187063\n\n0d890267ec8d6d2aaf43eaca727c1fbba6acd16e\n\nd459aa0a63140ccc647e9026bfd1fccd4c310c262a88896c57bbe3b6456bd090\n\n1640f48cc05c58f4cc077503a5361cea\n\nb1dee3ebcffad01a51ff31ff495fef1d40fdfaa0\n\nd51a790d187439ce030cf763237e992e9196e9aa41797a94956681b6279d1b9a\n\n71d5b9bfd6bf37ff5aa9752b2b6d5af1\n\n64ab912d0af35c01355430d85dd4181f25e88838\n\n4e08e4ffc699e0a1de4a5225a0b4920933fbb9cf123cde33e1674fde6d61444f\n\nda667174c2d145a4d9b3b39387fbd7dd\n\n8377fb40c76aa3ba3efae3d284fa51aa7748e010\n\n8c0b7d90f14c55d4f1d0f17e0242efd78fd4ed0c344ac6469611ec72defa6b2d\n\n69455ba3bfd2d8e3ade5081368934945\n\n11ae67704ea0b930b2cc966e6d07f8b898f1a7d2\n\nf47c883f59a4802514c57680de3f41f690871e26f250c6e890651ba71027e4d3\n\n848bc8e5917db1f735029fc51952002d\n\nffccc3a29d1582989430e9b6c6d2bff1e3a3bb14\n\n2c9957ea04d033d68b769f333a48e228c32bcf26bd98e51310efd48e80c1789f\n\n\nURL Malicious\nURL\n\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\nSHA1\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\n\nMalicious\nICO File\n\nMalicious\nICO File\n\nMalicious\nICO File\n\nMalicious\nICO File\n\nMalicious\nICO File\n\nMalicious\nICO File\n\nMalicious\nICO File\n\nMalicious\nICO File\n\n\n-----\n\naafa584176d9aec7912b4bc3476acc1a\n\n89827af650640c7042077be64dc643230d1f7482\n\n268d4e399dbbb42ee1cd64d0da72c57214ac987efbb509c46cc57ea6b214beca\n\n4d112603466ac9c57a669445374c1fb5\n\nb5de30a83084d6f27d902b96dd12e15c77d1f90b\n\nc62dce8a77d777774e059cf1720d77c47b97d97c3b0cf43ade5d96bf724639bd\n\nd232fa2eabc03123517a78936a18448b\n\n3992dbe9e0b23e0d4ca487faffeb004bcfe9ecc8\n\nc13d49ed325dec9551906bafb6de9ec947e5ff936e7e40877feb2ba4bb176396\n\naff5911f6c211cde147a0d6aa3a7a423\n\ncaa77bcd0a1a6629ba1f3ce8d1fc5451d83d0352\n\nf1bf4078141d7ccb4f82e3f4f1c3571ee6dd79b5335eb0e0464f877e6e6e3182\n\n4942dc3c0e9808544b068854cf1351e0\n\n57a9f3d5d1592a0769886493f566930d8f32a0fc\n\n2487b4e3c950d56fb15316245b3c51fbd70717838f6f82f32db2efcc4d9da6de\n\n3eb70db2f6bffbe29970f759747e07bd\n\nf533bea1c0558f73f6a3930343c16945fb75b20f\n\ne059c8c8b01d6f3af32257fc2b6fe188d5f4359c308b3684b1e0db2071c3425c\n\n14b79d2f81d1c0a9c3769f7bb83e443d\n\n31d775ab577f3cc88991d90e9ae58501dbe1f0da\n\nd0f1984b4fe896d0024533510ce22d71e05b20bad74d53fae158dc752a65782e\n\n## Yara Rules\n\n Reference:\n\n[https://www.3cx.com/blog/news/desktopapp-security-alert/](https://www.3cx.com/blog/news/desktopapp-security-alert/)\n\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\nMD5\n\nSHA1\n\nSHA256\n\n\nMalicious\nICO File\n\nMalicious\nICO File\n\nMalicious\nICO File\n\nMalicious\nICO File\n\nMalicious\nICO File\n\nMalicious\nICO File\n\nMalicious\nICO File\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-03-31 - A Comprehensive Analysis of the 3CX Attack.pdf"
    ],
    "report_names": [
        "2023-03-31 - A Comprehensive Analysis of the 3CX Attack.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1683338926,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1683251053,
    "ts_modification_date": 1683251053,
    "files": {
        "pdf": "https://archive.orkl.eu/a35b4792c22ebaba3fc12a549e7d1114dd349019.pdf",
        "text": "https://archive.orkl.eu/a35b4792c22ebaba3fc12a549e7d1114dd349019.txt",
        "img": "https://archive.orkl.eu/a35b4792c22ebaba3fc12a549e7d1114dd349019.jpg"
    }
}