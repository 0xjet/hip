{
    "id": "f5fb0b2f-354d-4499-ae63-35d574ebc11d",
    "created_at": "2023-01-12T15:02:27.308905Z",
    "updated_at": "2025-03-27T02:08:00.134977Z",
    "deleted_at": null,
    "sha1_hash": "af412a2dc41df4d620fac020642196932bc1cd51",
    "title": "2022-07-01 - Xloader Returns With New Infection Technique",
    "authors": "",
    "file_creation_date": "2022-07-02T23:19:42Z",
    "file_modification_date": "2022-07-02T23:19:42Z",
    "file_size": 5503089,
    "plain_text": "# Xloader Returns with New Infection Technique\n\n**[blog.cyble.com/2022/07/01/xloader-returns-with-new-infection-technique/](https://blog.cyble.com/2022/07/01/xloader-returns-with-new-infection-technique/)**\n\n## Multistage Delivery of Malware Using Steganography\n\n\nJuly 1, 2022\n\n\nDuring our routine threat-hunting exercise, Cyble Research Labs came across a [Twitter post wherein a](https://twitter.com/James_inthe_box/status/1539993170754146304)\nresearcher mentioned an interesting infection chain of Xloader malware.\n\nThe malware uses multiple file types such as PDF, XLSX, and RTF for its initial infection and execution.\nIt is also designed to drop three modules in memory and execute the final payload using the ProcessHollowing technique. Additionally, The malware uses steganography to hide its malicious content in a\nbitmap file.\n\nThe below figure shows the infection chain of Xloader malware.\n\n\n-----\n\nFigure 1 – Xloader Infection Chain\nXloader is a rebranded version of the Formbook stealer. It is designed as a malicious tool to steal\ncredentials from different web browsers, collect screenshots, monitor and log keystrokes from the\nvictim’s machine, and send them to Command and Control (C&C) server. Typically, Xloader spreads via\nspam emails that trick victims into downloading a malicious attachment file, such as MS Office\ndocuments, PDF documents, etc.\n\nThis blog showcases the deep-dive analysis of the malware infection, starting with a spam email\ncontaining a PDF attachment to deliver the final payload of Xloader malware. The PDF attachment is\nshown below.\n\n\n-----\n\nFigure 2\n\n– PDF Attachment from Spam Email\nUpon opening a PDF file, it drops the embedded XLSX file named “has been verified. However PDF,\n_JPG, Docx, .xlsx” into the “Temp” location. It then uses multiple extensions of different file formats to_\ntrick the user. The below figure shows the embedded file details of the PDF document.\n\n\n-----\n\nFigure 3 –\n\nEmbedded file in PDF Document\nUpon execution of the XLSX file, it downloads the RTF document file from the URL –\n**hxxps[:]//htmlpreview[.]github[.]io@oshi[.]at/Nmtw.**\n\nWhen the RTF document is opened, MS Word’s equation editor (EQNEDT32.exe) will automatically\nlaunch and download a .NET malware file from the URL – hxxp[:]//192.227.173[.]33/71/vbc[.]exe.\n\nThe below figure shows the opened RTF document.\n\n\n-----\n\nFigure 4 –\n\nRTF Document\nThe .NET executable file named “vbc.exe” isdownloaded from the RTF document via equation editor\n[vulnerability (CVE-2017-11882) and is an obfuscated binary file. The below figure shows the obfuscated](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11882)\nand de-obfuscated file details such as methods and functions.\n\nFigure 5 – Obfuscated and De-obfuscated details of the “vbc.exe” file\n\n## Technical analysis:\n\nWe have taken the sample hash (SHA256),\n**_d0c85ba5e6d88e1e0b5f068f125829b4e224b90be2488f2c21317447dc51fb9e for our analysis. It is a_**\n32-bit, .NET executable file named as “vbc.exe”.\n\nUpon execution of the vbc.exe file, the method Convert.FromBase64String() in the Main() function\ndecodes the base64 string content and returns a new PE file, as shown below.\n\n\n-----\n\nFigure 6 – Base64 String Conversion\nAfter decoding the base64 content, vbc.exe loads the converted PE module named “Bunifu.UI.dll” into\nmemory by using a dynamically invoked function with passing arguments of strings such as “Invoke”\nand “Bunifu_TextBox.” The below figure shows the concatenated strings used in the malware file.\n\nFigure 7 – String Concatenation\nThe module “Bunifu.UI.dll” is also an obfuscated .NET file. The below figure shows the de-obfuscated\ncontent of the new assembly file and runs the Bunifu_TextBox() function, which retrieves the embedded\nbitmap image “QQvruB” present in the resource\n(“Hospital_Document_Tracker_System.Resources.resources”‎) of the parent malware vbc.exe file. It\nthen calls the Sleep function to delay the execution before accessing the resource for the bitmap image.\n\n\n-----\n\nFigure 8 – De-obfuscated Content of New Module “Bunifu.UI.dll”\nThe malware uses the steganography technique to hide malicious content in the compressed bitmap\nimage embedded in the resource of the parent malware file vbc.exe, shown below.\n\nFigure 9 – Compressed Bitmap Embedded in Main File Resource\nThe successful decompression of the bitmap image retrieves another .NET file in memory, as shown in\nFigure 10. The “Bunifu.UI.dll” module loads the new binary using the Assembly.Load method by passing\nthe decompressed bitmap content as an argument.\n\n\n-----\n\nFigure 10 – Decompressed Bitmap Content of New Module from Resource\nThe main purpose of “Bunifu.UI.dll” is to decompress the bitmap image from a resource using the\n“GZipStream” class, as shown in the figure below.\n\nFigure 11 –\n\nDecompression Function\nThe new file decompressed from the resource is another obfuscated .NET binary titled\n_“MajorRevision.exe.” The figure below shows the newly loaded module in memory with the module_\nname in the Chinese script.\n\n\n-----\n\nFigure 12 – Loaded New Module “MajorRevision.exe”\nThe below figure shows the de-obfuscated “MajorRevision.exe” assembly file.\n\nFigure 13 – De-obfuscated MajorRevision.exe File\nUpon execution of the “MajorRevision.exe” module, it first creates a mutex named “fBEQVtAy” to ensure\nthat only one instance of malware runs on the victims’ system. The malware exits if the mutex is already\npresent.\n\n\n-----\n\nFigure 14 –\n\nMutex Creation\nNext, it converts the larger array of bytes present in the module into HEX values, as shown in Figure 15.\nIt contains multiple Anti-Analysis and Anti-Detection checks to prevent the execution of the malware in a\ncontrolled environment.\n\nFigure 15 – Anti-analysis Strings in Memory of MajorRevision.exe\nAfter that, it retrieves the final payload in memory by converting another larger array of bytes which is\nalso present in the “MajorRevision.exe.” Finally, it injects the payload by creating a new process with the\nparent file name (“vbc.exe”) using the process hollowing technique shown below.\n\n\n-----\n\nFigure 16 – Process Hollowing technique\nThe below figure shows the file information of the final malware payload, “Xloader.” Based on our static\nanalysis, we concluded that the malware payload is a 32-bit, MASM compiled binary with only the “.text”\nsection.\n\n\n-----\n\nFigure 17\n\n– Final Payload Details\nXloader malware uses the magic bytes “XLNG,” shown in the figure below.\n\nFigure 18 – XLNG Magic Bytes of Xloader\nUpon successful execution, Xloader drops an executable file in the following location and injects it into\nexplorer.exe.\n\n_“C:\\Program Files (x86)\\L9rql\\winmrhl7bm.exe”_\n\nTo establish persistence, the malware creates the below registry key for autorun to execute the dropped\nmalware file when the user logs in to the system every time.\n\n_HKEY_LOCAL_MACHINE_\n_\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\\J8TPYFN8OVE =_\n_“C:\\\\Program Files (x86)\\\\L9rql\\\\winmrhl7bm.exe”_\n\nFinally, after a successful connection to the Threat Actor’s C&C server, Xloader can be instructed to\ndownload and launch additional payloads, terminate and uninstall the malware, etc.\n\nAdditionally, Xloader steals user credentials or cookies from browsers, logs keystrokes, steals clipboard\ncontent, takes screenshots, and sends them to the TA’s C&C server.\n\n## Conclusion\n\nInformation stealers are evolving as increasingly sophisticated threats in the cybercrime ecosystem.\nThey can cause severe damage to individuals and organizations in the case of privacy violations,\nconfidential information leakage, etc.\n\n\n-----\n\nExploiting the human element is often easier for Threat Actors compared to exploiting complex\nvulnerabilities. Throughout our analysis, we have observed that Xloader looks like a prominent malware\nvariant that is constantly updated by improving its code which adds new features, more obfuscation, the\nuse of anti-analysis techniques, etc.\n\nCyble Research Labs will closely monitor Xloader malware and other information stealers and analyze\nthem to understand their TTPs better and update our readers accordingly.\n\n## Our Recommendations\n\nAvoid downloading pirated software from unverified sites.\nUse strong passwords and enforce multi-factor authentication wherever possible.\nKeep updating your passwords after certain intervals.\nUse a reputed anti-virus and internet security software package on your connected devices,\nincluding PC, laptop, and mobile.\nRefrain from opening untrusted links and email attachments without first verifying their authenticity.\nBlock URLs that could be used to spread the malware, e.g., Torrent/Warez.\nMonitor the beacon on the network level to block data exfiltration by malware or TAs.\nEnable Data Loss Prevention (DLP) Solutions on employees’ systems.\n\n## MITRE ATT&CK® Techniques\n\n**Tactic** **Technique ID** **Technique Name**\n\nInitial Access [T1566](https://attack.mitre.org/techniques/T1566/) Phishing\n\n\nExecution [T1204](https://attack.mitre.org/techniques/T1204/)\n\n[T1203](https://attack.mitre.org/techniques/T1203/)\n\n\nUser Execution\n\nExploitation for Client Execution\n\n\nPersistence [T1547](https://attack.mitre.org/techniques/T1547) Registry Run Keys / Startup Folder\n\nDefence Evasion [T1497](https://attack.mitre.org/techniques/T1497/) Virtualization/Sandbox Evasion\n\nCredential Access [T1552](https://attack.mitre.org/techniques/T1552) Credentials In Files\n\nLateral Movement [T1021](https://attack.mitre.org/techniques/T1021/) Remote Services\n\nCNC [T1071](https://attack.mitre.org/techniques/T1071/) Application Layer Protocol\n\n## Indicator Of Compromise (IOCs)\n\n**Indicators** **Indicator**\n\n**Type**\n\n\n**Description**\n\nSpam email\n\nPDF\n\n\nafa05a84f53f793fdad59d8af603b497\n\nbdbc99cb9698f3754dea53bb192e650b2f0c203c\n\n9d3c9168bc5d52c0372f31565bf2ec690a39cfd52bc76d0ef01083e419da805b\n\n96d95ee6d0c9da16d245579ad1ff2e9f\n\nf852ac58b11e6b314271e2afdd33da84fc3cb8d8\n\n6d45a03b32c4a9bab48c75bec8443b5af40ae43e055db77796a6328cb6e87ffe\n\n\nMD5\n\nSHA1\n\nSha256\n\nMD5\n\nSHA1\n\nSha256\n\n\n-----\n\n2fc6db5b63ba91752b946d76b803a4a9\n\n45982471aca75de846442d16c84c5b61caa6c045\n\n30d5632ef75e81aa6a48eae64f2155acc39e64f6367a5c6152e8ec74b44ac6de\n\ne5cde34f443cab2ebecf850518d0aeeb\n\n375ecc13e71755cc4ab260f518207892e87c55e3\n\nd106de4854f334b826f7ed6e97b02eff34e8ab8ea956d461d67c4225792185a1\n\n1f65d7826fbcc2d6c50f6c493c901588\n4290f6b300595e807e8cacd5ff172b0a0f37c845\n\nd0c85ba5e6d88e1e0b5f068f125829b4e224b90be2488f2c21317447dc51fb9e\n\na0dc449956fd7eefaeb204d66b668330\n\n76b958e128a7f2dd052634d5e7dfbf2f67f20ae9\n\n50204673d080635b23b8f219a70e276acd3dd3779543fbd4b82a217c06dc14fb\n\n39f524c1ab0eb76dfd79b2852e5e8c39\n\n428018e1701006744e34480b0029982a76d8a57d\n\n79823e47436e129def4fba8ee225347a05b7bb27477fb1cc8be6dc9e9ce75696\n\nbc31d889dd60360d38796521b452d775\n7e52c29418bd13c749da76506251ad3ad291d06c\n\n32abba85bb16f812822c789882e37cd37c62e15ea0aceade45eaad1d93ff012a\n\n73aac8ac5dc4ded42398f9fe2a191c19\n\n4f3ed7fa592f4ae4c4462928543dcbd4997f2549\n\n6672b26a03db7ec5d61e90ce7827c422cb6a8a942cc1c77f92f97e263a35d8e5\n\n0227a4419e2948a886a2e324180f23e6\n\n43c1ee78411b939e19688ff9ea9ebc433d9051a1\n\nc7b2597253067c1169aeef5e04948575bf7df65e1787098cc9afc2e10685acdf\n\n7d4539bd445cf9821fd2e05dc0b1107e\n\n964e56a5e1f32101f04fa3fc62ec17c66b3c174e\n\n3b65b859612be75eb528caf7b0cc66bc049fdfb062b6b6aa29ea9c356114a4fe\n\n\nMD5\n\nSHA1\n\nSha256\n\nMD5\n\nSHA1\n\nSha256\n\nMD5\n\nSHA1\n\nSha256\n\nMD5\n\nSHA1\n\nSha256\n\nMD5\n\nSHA1\n\nSha256\n\nMD5\n\nSHA1\n\nSha256\n\nMD5\n\nSHA1\n\nSha256\n\nMD5\n\nSHA1\n\nSha256\n\nMD5\n\nSHA1\n\nSha256\n\n\nXLSX\n\nRTF\n\nObfuscated\n.NET exe\nMain file\n\nDeobfuscated\n.NET exe\nMain file\n\nObfuscated\n.NET exe\nStage 1\n\nDeobfuscated\n.NET exe\nStage 1\n\nObfuscated\n.NET exe\nStage 2\n\nDeobfuscated\n.NET exe\nStage 2\n\nFinal\npayload\nMASM exe\n\n\nhxxps[:]//htmlpreview[.]github[.]io@oshi[.]at/Nmtw URL download\nRTF\n\nfile from\nC&C\n\nhxxp[:]//192[.]227[.]173[.]33/71/vbc[.]exe URL Download\nEXE\n\nfile from\nC&C\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-01 - Xloader Returns With New Infection Technique.pdf"
    ],
    "report_names": [
        "2022-07-01 - Xloader Returns With New Infection Technique.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535747,
    "ts_updated_at": 1743041280,
    "ts_creation_date": 1656803982,
    "ts_modification_date": 1656803982,
    "files": {
        "pdf": "https://archive.orkl.eu/af412a2dc41df4d620fac020642196932bc1cd51.pdf",
        "text": "https://archive.orkl.eu/af412a2dc41df4d620fac020642196932bc1cd51.txt",
        "img": "https://archive.orkl.eu/af412a2dc41df4d620fac020642196932bc1cd51.jpg"
    }
}