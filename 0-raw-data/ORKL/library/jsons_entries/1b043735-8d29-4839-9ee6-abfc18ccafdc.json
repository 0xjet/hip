{
    "id": "1b043735-8d29-4839-9ee6-abfc18ccafdc",
    "created_at": "2023-01-12T15:09:59.602205Z",
    "updated_at": "2025-03-27T02:12:54.771018Z",
    "deleted_at": null,
    "sha1_hash": "4cce01e3dcddd75fda705cf59906ff39dee2829f",
    "title": "2020-01-02 - -Nice decorating. Let me guess, Satan-- - Dot - MZP Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T01:28:27Z",
    "file_modification_date": "2022-05-28T01:28:27Z",
    "file_size": 786832,
    "plain_text": "# \"Nice decorating. Let me guess, Satan?\" - Dot / MZP Ransomware\n\n**[dissectingmalwa.re/nice-decorating-let-me-guess-satan-dot-mzp-ransomware.html](https://dissectingmalwa.re/nice-decorating-let-me-guess-satan-dot-mzp-ransomware.html)**\n\nThu 02 January 2020 in [Ransomware](https://dissectingmalwa.re/category/ransomware.html)\n\nHappy new year y'all. And with it there's new Ransomware to analyze, so come along for the\nride :D\n\n[Dot \"MZP\" Ransomware @ AnyRun |](https://app.any.run/tasks/56248422-b327-4226-8a79-3155e24b999d/) [VirusTotal |](https://www.virustotal.com/gui/file/bebf5c12e35029e21c9cca1da53eb43e893f9521435a246ea991bcced2fabe67/detection) [HybridAnalysis -->](https://www.hybrid-analysis.com/sample/bebf5c12e35029e21c9cca1da53eb43e893f9521435a246ea991bcced2fabe67?environmentId=100) `sha256`\n```\nbebf5c12e35029e21c9cca1da53eb43e893f9521435a246ea991bcced2fabe67\n\n```\nThis sample was first discovered by AmigoA and AkhmendTaia on the 31st of December\n2019. AV Detections and Ransomnote contents didn't seem to match any previously present\nstrain. The Note is delivered via a .txt File with a strange numeric victim ID and only one\ncontact email address. The extension appended to encrypted Files seems to be a random 8\ncharacter lowercase string.\n\n\n-----\n\n[New #MZP](https://twitter.com/hashtag/MZP?src=hash&ref_src=twsrc%5Etfw) [#Ransomwarehttps://t.co/YCY8NXzJZw](https://twitter.com/hashtag/Ransomware?src=hash&ref_src=twsrc%5Etfw)\nIt seems nothing special, but early AV-detections is uninformative.\nThanks to [@AkhmedTaia](https://twitter.com/AkhmedTaia?ref_src=twsrc%5Etfw) [pic.twitter.com/qS1YapH8jW](https://t.co/qS1YapH8jW)\n\n[— Amigo-A (@Amigo_A_) December 31, 2019](https://twitter.com/Amigo_A_/status/1212136864393637888?ref_src=twsrc%5Etfw)\n\nBecause of the \"MZP\" (4D 5A 50) Magic at the beginning of the executable file they dubbed\nthe Malware \"MZP\" Ransomware. As I explained before with the MZRevenge/MaMo\nRansomware the \"P\" after the MZ Magic String indicates that the binary was built with\nBorland Delphi and P stands for Pascal (the programming language).\n\nIn my Opinion the Name \"MZP Ransomware\" is too generic to be useful for future reference,\nso I'd like to propose the name \"Dot Ransomware\" because of the File Icon found with the\nMalware Samples. It shows the character \"Dot\" from the Warner Bros Cartoon Series\n\"Animaniacs\" popular in the mid-1990s.\n\nTwo things to note about the Output of \"Detect it easy\" for this sample:\n\n1. It confirms that the Ransomware was built with Borland Delphi (Version 4).\n\n\n-----\n\n2. This sample seems to be packed with UPX 3.91. Running `upx -d 01.exe yields us`\n\nthe unpacked Version. The Hashsums can be found in the IOC Section down below\n\nLet's try something new :D Up until now I pretty much neglected memory dump analysis as a\nwhole, but since I attended the Workshop on Volatility at 36c3 I noticed what I'm missing out\non. With `volatility -f IE9WIN7-20200102-171509.dmp --profile=Win7SP1x86_24000`\n```\npstree we can dump the process tree at the time of the capture. We can see that 01.exe is\n\n```\nrunning as a subprocess of explorer.exe.\n\nWith the privs plugin Volatility can show which process privileges are present, enabled,\nand/or enabled by default. Below you can see a screencapture of the output for the\nRansomware. The Plugins cmdscan and consoles sadly did not return any output for 01.exe.\n\n\n-----\n\n[Let's check out what IDR (Interactive Delphi Reconstructor) can tell us about the binary. First](https://github.com/crypto2011/IDR)\noff: Strings.\n\n\n-----\n\nThe first String related to the Compiler tells us that the criminals likely used HiASM (an old\nrussian IDE for Delphi Development) to build the Malware. The DLL mentioned below\n_comctl32.dll is often targeted for UAC Bypasses. It also seems to track Mouse events to_\nsome extent this could either be used as an evasion mechanism or entropy collection (the\nfirst option is a lot more plausible). \"HOW TO RESTORE ENCRYPTED FILES.txt\" is the\nfilename of the dropped ransomnote, although I'm not sure about the use of \"DECRYPT\n**FILES.txt\" since this file was not present on any infected system (Speculation: Does is**\nselect one out of multiple Filenames to make tracking more difficult?). Lastly we have a\nfilepath and a string that looks like the criminal dragged his face across the keyboard once.\n\nAlright, let's move along. Because Delphi is notoriously weird and difficult to\ndisassemble/decompile it is time to try a new tool again. Today I will be using Ghidra with\n_Dhrake developed by Jesko Hüttenhain. You can find the Git repository below and if you_\nwould like to know more about the inner workings of the two scripts you should definitely\n[read his article about them here.](https://blag.nullteilerfrei.de/2019/12/23/reverse-engineering-delphi-binaries-in-ghidra-with-dhrake/)\n\n**A short tl;dr: Dhrake is short for \"Delphi hand rake\" and tries to fix missing symbols and**\nborked function signatures by matching to the symbols extracted through IDR beforehand.\nThis will not only clean up the decompilation results in Ghidra but also automatically create\nstructs and virtual method tables for you instead of doing it by hand (as if reversing Delphi\nwasn't already painfull enough). It's pretty cool, give it a try!\n\nThe first step to success (lol who am I kidding) is firing up Ghdira and loading the sample.\nTell it to auto-analyze the file.\n\nNext we need to extract the .IDC Symbol file with the Help of IDR. For this it is sufficient to\nclone the Git Repo and paste the Knowledge Base files from the Dropbox linked at the end\nof the Readme into it. After that is done just run IDR.exe, import the binary and choose IDC\n_Generator under Tools._\n\n\n-----\n\nAfter copying the two Dhrake scripts into your ghidra_scripts folder (e.g. ~/ghidra_scripts)\nyou can refresh the list in the Script Manager once and switch to the Delphi Category. Run\nDhrakeInit and select the IDC file you created earlier.\n\nFiltering for \"VMT\" in the Symbol Tree gives you all the Symbols relevant to Dhrake. Just\nclick the Name in the Listing view once and run DhrakeParseClass (set the checkbox \"In\nTool\" and press F8 to run). The Script will now automatically create the corresponding class\nand vtable struct.\n\n\n-----\n\nSo I guess we should continue with the analysis now :D As 90% of ransomware strains do\n\"Dot\" will read the Keyboard Layout as well. GetKeyboardLayout(0) returning 7 would be\nequivalent to a Japanese Keyboard Layout (wtf?). Passing 1 to GetKeyboardType will return\nthe Subtype which is OEM specific, but will tell you how many function keys there are. Weird.\nHere's the [Documentation.](https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getkeyboardtype)\n\nDot also queries the current cursor position on the screen and passes it on to another\nfunction. Haven't investigated further yet.\n\n\n-----\n\nHere we are again: weird DLLs that may or may not be a UAC Bypass. UACme mentions\ntwo Methods (#21 and #22) employing comctl32.dll. Unsure what to make of this at the\nmoment.\n\nIn one of the Szenarios I ran Regshot to see whether the Ransomware\nadds/modifies/deletes Registry Keys, but there weren't any changes that I can attribute to it.\nDot tries to read SOFTWARE\\Borland\\Delphi\\RTL FPUMaskValue.\n\n\n-----\n\nThis is another work in progress article as I've come down with the \"Congress Flu\", so check\nback in a few days for an update. Probably the most important thing this \"report\" is still\nmissing is a look at the crypto implementation. A look at the Imports reveals that it is not\nusing the Windows Crypto API but rather a weird Delphi one. We'll see.\n\n## MITRE ATT&CK\n\n_T1107 --> File Deletion --> Defense Evasion_\n\n_T1045 --> Software Packing --> Defense Evasion_\n\n_T1012 --> Query Registry --> Discovery_\n\n_T1076 --> Remote Desktop Protocol --> Lateral Movement_\n\n## IOCs\n\n### Dot Samples\n\n\n-----\n\n```\n01.exe > SHA256: bebf5c12e35029e21c9cca1da53eb43e893f9521435a246ea991bcced2fabe67\n      SSDEEP:\n768:Qa8bmv7hNAMbgYT6hQdPLC7TasOKS/3U7fzd4tA9yenQ779Zo2lPnoCLnS9QtRbY:Ebmvs71+DKoKS/kjz\n01.exe --> SHA256: aa85b2ec79bc646671d7280ba27f4ce97e8fabe93ab7c97d0fd18d05bab6df29\n      SSDEEP:\n98304:mt+HWV4nwA+8PgzCRfjMlFBiZhfcrQSav//dH768QyO4YXoftvFUmgaJml9iUybR:NddPgzC+lFkZhER\nunpacked:\n01.exe --> SHA256: 814e061d2e58720a43bcb3fe0478a8088053f0a407e25ff84fb98850d128f81c\n      SSDEEP: 1536:CCq2EikJZdZ529nEaqQOyergddb6apjAwzHx4D:7IZYxEHJrIdFjAwzHx4\n\n### Registry Changes\n\n```\nInconclusive as Regshot didn't show anything suspicious, only Delphi related Keys at most\n\n### E-Mail Addresses\n```\nrecover_24_7@protonmail[.]com\n\n Ransomnote\nIf you want to return your .[REDACTED: random 8-letter lowercase extension] files,\ncontact us and we will send you a decryptor and a unique decryption key.\nrecover_24_7@protonmail[.]com\nAll your files have been encrypted!\nYour personal identifier:\n======================================================================================\n-----------------------------------------------------------------------------------------[REDACTED: 606-digit numeric ID]\n-----------------------------------------------------------------------------------------======================================================================================\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-02 - -Nice decorating. Let me guess, Satan-- - Dot - MZP Ransomware.pdf"
    ],
    "report_names": [
        "2020-01-02 - -Nice decorating. Let me guess, Satan-- - Dot - MZP Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "9e767b38-12ae-4ef7-9878-5ce1701066d7",
            "created_at": "2024-05-01T02:03:08.131819Z",
            "updated_at": "2025-03-27T02:05:17.413497Z",
            "deleted_at": null,
            "main_name": "NICKEL ACADEMY",
            "aliases": [
                "COVELLITE ",
                "CTG-2460 ",
                "Diamond Sleet ",
                "Guardians of Peace",
                "HIDDEN COBRA ",
                "High Anonymous",
                "Labyrinth Chollima ",
                "NNPT Group",
                "New Romanic Cyber Army Team",
                "Temp.Hermit ",
                "The Lazarus Group ",
                "UNC577 ",
                "Who Am I?",
                "Whois Team",
                "ZINC ",
                "Black Artemis "
            ],
            "source_name": "Secureworks:NICKEL ACADEMY",
            "tools": [
                " DarkMessenger",
                " Destover",
                " Duuzer",
                " HOPLIGHT",
                " Joanap",
                " KorHigh",
                " LiveJinx",
                " Volgmer",
                "Brambul"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536199,
    "ts_updated_at": 1743041574,
    "ts_creation_date": 1653701307,
    "ts_modification_date": 1653701307,
    "files": {
        "pdf": "https://archive.orkl.eu/4cce01e3dcddd75fda705cf59906ff39dee2829f.pdf",
        "text": "https://archive.orkl.eu/4cce01e3dcddd75fda705cf59906ff39dee2829f.txt",
        "img": "https://archive.orkl.eu/4cce01e3dcddd75fda705cf59906ff39dee2829f.jpg"
    }
}