{
    "id": "f438edfd-9f8e-467b-b514-b7e18c77e295",
    "created_at": "2023-01-12T15:03:06.694181Z",
    "updated_at": "2025-03-27T02:16:34.796546Z",
    "deleted_at": null,
    "sha1_hash": "8284e74ab67c700f1802971e05ce07fe8587684c",
    "title": "2022-03-04 - Legitimate Sites Used As Cobalt Strike C2s Against Indian Government",
    "authors": "",
    "file_creation_date": "2022-05-28T23:32:27Z",
    "file_modification_date": "2022-05-28T23:32:27Z",
    "file_size": 1020704,
    "plain_text": "# Legitimate Sites used as Cobalt Strike C2s against Indian Government\n\n**[telsy.com/legitimate-sites-used-as-cobalt-strike-c2s-against-indian-government/](https://www.telsy.com/legitimate-sites-used-as-cobalt-strike-c2s-against-indian-government/)**\n\nMarch 4, 2022\n\n[Cyber Threat Intelligence](https://www.telsy.com/category/cyber-threat-intelligence/)\n04 Mar\n\n## Introduction\n\nTelsy Threat Intelligence team observed an attack against members of the Indian\ngovernment or local institutions, which uses social engineering themes as an investigation\nfor a cyber attack or the classic COVID-19 theme.\n\nThe campaign, probably carried out via a spear phishing e-mail, starts with the opening of a\nlegitimate PDF attachment containing a malicious URL from which to download an ISO file.\nThe ISO file contains LNK files and a malicious DLL that executes a Cobalt Strike beacon in\nmemory.\n\nUsing a legitimate portal as C2 and encrypted HTTPS communication makes the campaign\nvery silent.\n\nCobalt Strike is a commercial penetration testing tool, which gives security testers access to\na large variety of attack capabilities.\n\nThis powerful network attack platform combines social engineering, unauthorized access\ntools, network pattern obfuscation, and a sophisticated mechanism for deploying malicious\nexecutable code on compromised systems.\n\n\n-----\n\nTherefore Cobalt Strike although a legitimate tool used by ethical hackers is also widely used\nby threat actors to launch real attacks against organizations.\n\nMost threat actors either use stolen/cracked versions of Cobalt Strike, or simply patch out the\nwatermark value to disrupt attribution attempts.\n\nCobalt Strike’s watermark 1359593325 and the analyzed infection chain might lead one to\nthink of the threat actor Nobelium aka APT29 due the similarities, both in components and\nhow the target is infected as previously described by security companies Volexity\nand Microsoft.\n\nUnfortunately, there is no clear evidence to attribute these campaigns to this threat actor.\n\n## Analysis\n\n### First PDF Analysis\n\nThe 1st PDF found, with hash 0b1cc9a276712b1d6f379b43504bd1f1d8a49cfd, has been\nuploaded to VirusTotal on: 2021-12-08.\n\n\n-----\n\nThe PDF is intended to trick the user by downloading an ISO\nfrom “hxxps://www.instade.co.in/assets/frontend/av_check.iso” which is still active at the time\n\nof writing. The domain “instade.co.in” appears to be legitimate, it uses a certificate issued by\nSectigo and according to information in the Whois registry was registered in 2015.\n\nThe downloaded ISO, with hash d5edd698c944accea764ff74978ca3d86067afab,\ncontains the following files:\n\n- 2dcbe02294e633f49806c2d5d0d1f1207a0b1959 – 'malware check.lnk'\n\n\n-----\n\n- 9152e25c2574cccba6c7bfed2e598f9ce2afdcd0 – Submit malware report.doc.lnk\n\n- 44ee7f74ca1553af0e5484213dea676c66371e53 – 'av_base/msvcwinrt.dll'\n\nOpening one of the LNK files causes the DLL to be executed and consequently, the Cobalt\nStrike beacon infects the system. The DLL is executed via rundll32.exe by specifying the\nexported 'InitShut()' function to be executed.\n\nThe DLL, as said it's just a Cobalt Strike loader, the Cobalt Strike beacon configuration is the\nfollowing.\n\nThe Cobalt Strike beacon uses the same compromised domain as C2, as seen above for the\nISO download.\n\n### Second PDF Analysis\n\nThe 2nd PDF analysed, with hash e648483ce584211520a20a155ebcd3f70166fa93\nand named 'President-Kovind-special-visit-2022.02.24.pdf', is more recent and was\nuploaded to VirusTotal on 2022-02-24. This PDF uses COVID-19 prevention as a decoy\nbefore the meeting with the Indian president.\n\n\n-----\n\nThe targets of this campaign are most likely the participants of the event advertised on the\nIndian government portal as members of one or more of these organizations:\n\n– Assam State\n\n– Guwahati Municipal\n\n– Tezpur University\n\n– Kaziranga National Park\n\n– Tiger Reserve\n\n\n-----\n\nThe PDF, as the previous tricks the user in downloading an ISO from the following\nURL hxxps://tiny.one/covid22. Also in this case the link is still up on the time being.\n\nThe downloaded ISO, with hash e2ff656f52dccc9fb70e90dc94c4fce8ab14e8ed, contains the\nfollowing files:\n\n- b2a095b6e1dad70df03763a385ff04a1036065be – 'Register.lnk'\n\n- bd165723292f62e4be7ae60d12c25461900519fb – 'Submit registration.lnk'\n\n- f80ee71efcea4736b41d6ffed777ff1bb5621043 – 'data/msvcwinrt.dll'\n\nOnce the LNK file is opened the malicious DLL is run through rundll32.exe specifying\nthe exported function named 'AwaitProperty()”.\n\nAlso in this case the DLL is a Cobalt Strike loader and the beacon has the\nfollowing configuration.\n\n\n-----\n\nThe public key and the watermark is the same as the previous beacon but the C2 is\nthe domain 'covid.comesa.int'.\n\nThe same domain hosts the ISO, with hash e2ff656f52dccc9fb70e90dc94c4fce8ab14e8ed,\nin the following path: 'hxxps://covid.comesa.int/wp-content/uploads/covid.iso'.\n\nThe domain appears to be compromised, as “comesa.int” is the official website of\nthe Common Market of Eastern and Southern Africa.\n\n\n-----\n\n### Cobalt Strike dropper analysis\n\nBoth the infection chains ends in a Cobalt Strike loader and the DLLs are pretty the same so\nthe analysis has been conducted on the following\nhash: f80ee71efcea4736b41d6ffed777ff1bb5621043.\n\nAs said, the purpose of this DLL is to load and execute a Cobalt Strike beacon, indeed\nthe sample appears very simple, even though the author has inserted some stub call\nbetween the significant code.\n\nThe sample imports a minimum set of functions, so it needs to load at runtime libraries and\nAPIs.\n\n\n-----\n\nLibraries and APIs names are stored encrypted via XOR operation in the data section using\na basic data structure. Every encrypted string has its own xor key stored in the same data\nstructure.\n\nThe structure is a basic array of struct, every item is 16 bytes long and the array with the\nencrypted string contains 24 items like the array with the xor key.\n\nBefore, entering in the specific function used to decrypt the strings, it takes a random string 8\nbytes long.\n\nThen it decrypts the string 'kernel32;ntdll' using again the xor operator and a dedicated key.\n\nFinally, it decrypts the library name and the API name, notice how the threat actor use\nallocation to store the decrypted string instead of using existing space doing in-place\ndecryption.\n\n\n-----\n\nAfter that libraries and APIs are decrypted the strings are hashed with a custom algorithm\nand stored in the structure named 'data_structure'. Every hash will take 8 bytes.\n\nThe data structure will contain all the hashes and the initial condition obtained randomically.\n\nThe string is hashed 16 bytes per time, the string, of course, can be of arbitrary length.\n\n\n-----\n\nWhen the string is smaller than 16 bytes, it is aligned to 16 bytes adding 0x80 bytes and then\nsetting the remainder to 0.\n\nOn the other hand, if the string is larger than 16 bytes the hash is calculated in chunks of 16\nbytes and the remainder will follow the logic shown before. Of course the calculated hash is\nincremental, i.e. the hash of the n-th chunk is xored to the hash of the (n-1) chunk and so on.\n\nThe hash is computed, starting from a generated random initial condition that according to\nthe string value is updated multiple times in a loop and finally returned.\n\n\n-----\n\nBasically, it treats the string/chunk, since it is 16 bytes long, in blocks 4 bytes long\ndoing some shuffle and binary operation between the blocks self and the initial condition that\nis updated from time to time.\n\nIn particular, the final hash is due to 0x1b iteration of the hashing algorithm.\n\nIn the first for loop (line 30) the string API is copied as 4 block bytes long in an integer vector.\n\nThen, in the second while loop the initial condition are updated according (line 48) to\nthe string blocks and they are updated too in the same while, the code seems contorted,\nbelow a basic re-implementation.\n\nAs said, the hash of every API to load are stored in the data structure then the API\naddresses are searched doing a basic walk into the PEB and checking the hash.\n\nEvery module and API found is hashed and compared with the hash of the API\nstring obtained initially.\n\n\n-----\n\nFinally, it loads all the APIs.\n\nThe payload is embedded in the binary using the compression algorithm: LNZT1.\n\nIndeed, after allocing the required RW memory using VirtualAlloc() the payload\nis decompressed and the pointer is returned.\n\n\n-----\n\nNot knowing the actual size of the decompressed payload, the memory allocated to contain it\nis allocated using the size of the compressed payload * 3 as its size.\n\nThen the author wanted, perhaps for greater security, to insert a further step, i.e. allocate a\nnew memory area, equal exactly to the decompressed payload size, copy into it and execute\nit.\n\nThis way to write the code is not very logical nor correct.\n\nIndeed assuming that the decompressed payload will take less of the initial space allocated\nthere will be no problem in running directly it.\n\nOn the other hand, assuming what scares the author, i.e. decompressed payload longer than\nthe allocated memory, the RtlDecompressBufferEX() will return an error,\nSTATUS_BAD_COMPRESSION_BUFFER and will lead to a NULL pointer access of the\ncode, very bad and basic error.\n\nAnother weird point is the use of the hash to resolve APIs. Usually, the hash is used\nto obfuscate strings and make harder analysis. Here the approach is hybrid, indeed doing\na trace of the sample all the required API are uncovered due to the initial decryption step.\n\nThis behavior shows that the sample likely has been written by a not so skilled programmer\nor it is product of confused cut and paste of multiple code's pieces.\n\n\n-----\n\nAnyway, in the end the new memory is made executable and run.\n\n## Indicators of Compromise\n\n\n-----\n\n## ATT&CK Matrix\n\n### Fill out the form below to download the full report\n\n[Check other cyber reports on our blog.](https://www.telsy.com/it/categoria/cyber-threat-intelligence/)\n\n\n-----\n\nThis report was produced by Telsy s Cyber Threat Intelligence team with the help of its CTI\nplatform, which allows to analyze and stay updated on adversaries and threats that could\nimpact customers’ business.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-04 - Legitimate Sites Used As Cobalt Strike C2s Against Indian Government.pdf"
    ],
    "report_names": [
        "2022-03-04 - Legitimate Sites Used As Cobalt Strike C2s Against Indian Government.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "70872c3a-e788-4b55-a7d6-b2df52001ad0",
            "created_at": "2023-01-06T13:46:39.18401Z",
            "updated_at": "2025-03-27T02:00:03.01553Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "DarkHalo",
                "StellarParticle",
                "NOBELIUM",
                "Solar Phoenix",
                "Midnight Blizzard"
            ],
            "source_name": "MISPGALAXY:UNC2452",
            "tools": [
                "SNOWYAMBER",
                "HALFRIG",
                "QUARTERRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1d3f9dec-b033-48a5-8b1e-f67a29429e89",
            "created_at": "2022-10-25T15:50:23.739197Z",
            "updated_at": "2025-03-27T02:00:55.536417Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "UNC2452",
                "NOBELIUM",
                "StellarParticle",
                "Dark Halo"
            ],
            "source_name": "MITRE:UNC2452",
            "tools": [
                "Sibot",
                "Mimikatz",
                "Cobalt Strike",
                "AdFind",
                "GoldMax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "5b748f86-ac32-4715-be9f-6cf25ae48a4e",
            "created_at": "2024-06-04T02:03:07.956135Z",
            "updated_at": "2025-03-27T02:05:17.407352Z",
            "deleted_at": null,
            "main_name": "IRON HEMLOCK",
            "aliases": [
                "ATK7 ",
                "Blue Kitsune ",
                "Cozy Bear ",
                "The Dukes",
                "UNC2452 ",
                "YTTRIUM ",
                "APT29 "
            ],
            "source_name": "Secureworks:IRON HEMLOCK",
            "tools": [
                " CozyCar",
                " CozyDuke",
                " DiefenDuke",
                " FatDuke",
                " HAMMERTOSS",
                " LiteDuke",
                " MiniDuke",
                " OnionDuke",
                " PolyglotDuke",
                " RegDuke",
                " RegDuke Loader",
                " SeaDuke",
                " Sliver",
                "CosmicDuke"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a241a1ca-2bc9-450b-a07b-aae747ee2710",
            "created_at": "2024-06-19T02:03:08.150052Z",
            "updated_at": "2025-03-27T02:05:17.409596Z",
            "deleted_at": null,
            "main_name": "IRON RITUAL",
            "aliases": [
                "Blue Dev 5 ",
                "BlueBravo ",
                "Cloaked Ursa ",
                "CozyLarch ",
                "Dark Halo ",
                "Midnight Blizzard ",
                "NOBELIUM ",
                "StellarParticle ",
                "UNC2452 ",
                "APT29"
            ],
            "source_name": "Secureworks:IRON RITUAL",
            "tools": [
                " Cobalt Strike",
                " EnvyScout",
                " GoldFinder",
                " GoldMax",
                " NativeZone",
                " RAINDROP",
                " SUNBURST",
                " Sibot",
                " TEARDROP",
                " VaporRage",
                "Brute Ratel C4"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46b3c0fc-fa0c-4d63-a38a-b33a524561fb",
            "created_at": "2023-01-06T13:46:38.393409Z",
            "updated_at": "2025-03-27T02:00:02.822155Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "The Dukes",
                "Minidionis",
                "Grizzly Steppe",
                "G0016",
                "Blue Kitsune",
                "BlueBravo",
                "SeaDuke",
                "Cloaked Ursa",
                "YTTRIUM",
                "ATK7",
                "Nobelium",
                "UAC-0029",
                "Group 100",
                "COZY BEAR",
                "IRON HEMLOCK",
                "TA421",
                "ITG11"
            ],
            "source_name": "MISPGALAXY:APT29",
            "tools": [
                "QUARTERRIG",
                "SNOWYAMBER",
                "HALFRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535786,
    "ts_updated_at": 1743041794,
    "ts_creation_date": 1653780747,
    "ts_modification_date": 1653780747,
    "files": {
        "pdf": "https://archive.orkl.eu/8284e74ab67c700f1802971e05ce07fe8587684c.pdf",
        "text": "https://archive.orkl.eu/8284e74ab67c700f1802971e05ce07fe8587684c.txt",
        "img": "https://archive.orkl.eu/8284e74ab67c700f1802971e05ce07fe8587684c.jpg"
    }
}