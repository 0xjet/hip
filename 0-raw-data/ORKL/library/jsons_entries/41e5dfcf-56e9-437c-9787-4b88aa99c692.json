{
    "id": "41e5dfcf-56e9-437c-9787-4b88aa99c692",
    "created_at": "2023-06-05T02:06:33.90021Z",
    "updated_at": "2025-03-27T02:06:08.168158Z",
    "deleted_at": null,
    "sha1_hash": "7904ec89b6d15fc3e8d087e5c44c4192f5f29c89",
    "title": "2023-05-15 - Quasar Rat Analysis - Identification of 64 Quasar Servers Using Shodan and Censys",
    "authors": "",
    "file_creation_date": "2023-06-04T12:46:52Z",
    "file_modification_date": "2023-06-04T12:46:52Z",
    "file_size": 2407910,
    "plain_text": "# Quasar Rat Analysis - Identification of 64 Quasar Servers Using Shodan and Censys\n\n**embee-research.ghost.io/hunting-quasar-rat-shodan**\n\nMatthew May 15, 2023\n\n[Analysis\nFeatured](https://embee-research.ghost.io/tag/analysis/)\nExtraction of Quasar C2 configuration via Dnspy, and using this information to pivot to\nadditional servers utilising Shodan and Censys.\n\nThis analysis will cover the extraction of Quasar configuration via Dnspy. We'll then use this\ninformation to pivot to additional servers utilising Shodan and Censys. In total, 64 additional\n**servers will be identified.**\n\nA full list of the 64 Quasar servers can be found at the end of this post.\n\n## An overview of this post\n\nObtaining the initial sample\nOverview of the unpacking process\nLocating and extracting Quasar configuration using Dnspy\nAnalysis of Quasar Configuration\nBuilding Shodan Queries\nAnalysis of identified servers\nCross-referencing detection rates with VirusTotal\nIdentifying additional servers using Censys\nComplete list of identified servers.\n\n## Sample\n\n[The malware sample was obtained from Malware Bazaar and is available here.](https://bazaar.abuse.ch/sample/78eb982abdfb385ac2e0c9a640856077379355f16e29788456a6551c166b00fe/?ref=embee-research.ghost.io)\n```\nSHA256:78eb982abdfb385ac2e0c9a640856077379355f16e29788456a6551c166b00fe\n\n## Unpacking Quasar Rat\n\n```\nI'll leave the bulk of Quasar unpacking for another post. This is a high-level summary of the\nprocess that I used.\n\nUnzip file using password infected\nIdentify high-entropy using detect-it-easy\nCheck strings and observe multiple references to ZwWriteVirtualMemory and\n```\n   InstallUtil.exe\n\n```\n\n-----\n\nAssume entropy=Loader,\nAssume InstallUtil.exe = Injection Target\nExecute malware inside Virtual Machine\nUtilise Process Hacker to observe new spawns of installutil.exe\nUse Process Hacker to observe .NET assemblies loaded into Installutil.exe\nUtilising DnSpy to dump .NET assemblies. Obtain Quasar RAT.\nLoad Quasar into Dnspy. Browse to Entry Point.\nObserve the config initialization function. Set breakpoints and create a watch window.\nObtain Configuration.\n\n## Extracting Configuration From Quasar Rat\n\nFollowing the steps above will result in the following code being identified. Portions of the\ncode have been renamed for readability.\n\nEach of the GClass65.string_8 values reference a value that has been encrypted using\nAES, and then encoded using base64.\n\nThe AES decryption code can be seen below.\n\n\n-----\n\nAs well as a reference to additional base64 encoding, on top of the initial AES encryption.\n\nBy setting appropriate breakpoints and watch windows. The configuration can be obtained\nwith minimal analysis of the encryption.\n\n## Analysis of the Quasar Configuration\n\nThe most interesting components of the configuration are the (likely) c2 of\n```\n217.196[.]96.37:5678, as well as the x509 Certificate used for SSL/TLS communications.\n\n```\nAn x509 certificate forms part of the public-key component of TLS communications\nperformed between a client and server. The certificate contains valuable information\nabout who is \"endorsing\" the communications, and who exactly is being endorsed\n\n\n-----\n\n[There are some detailed writeups with much better explanations from Sectigo and](https://sectigo.com/resource-library/what-is-x509-certificate?ref=embee-research.ghost.io)\n[Wikipedia.](https://en.wikipedia.org/wiki/X.509?ref=embee-research.ghost.io)\n\nTypically I have ignored x509 certificates. But today will be a little bit different.\n\nThe x509 certificate contains a subject and issuer value of Quasar Server CA.\n\nOf particular note is that the x509 certificate was initially encrypted by the malware. This is\nan indication that it contains something valuable that could hinder the malware if revealed\nand appropriately analysed.\n\nGenerally, I would stop my analysis here as the C2 was successfully found.\n\nToday I will take this one step further, based on some infrastructure-hunting posts from\n[@MichalKoczwara .](https://twitter.com/MichalKoczwara/?ref=embee-research.ghost.io)\n\n[You can find such posts here and](https://twitter.com/MichalKoczwara/status/1656671405495439367?s=20&ref=embee-research.ghost.io) [here.](https://twitter.com/MichalKoczwara/status/1656591648732708865?s=20&ref=embee-research.ghost.io)\n\n## How to Build a Shodan Query for Quasar\n\nTo take my analysis further, I decided to utilise the issuer information of Quasar Server CA\nto identify additional Quasar servers.\n\n[Shodan.io was my first choice for this investigation.](https://www.shodan.io/dashboard?ref=embee-research.ghost.io)\n\nTo utilise the information, I first had to build a valid query for Shodan. This was able to be\n[done using filters list from the main shodan.io site.](https://www.shodan.io/search/filters?ref=embee-research.ghost.io)\n\nThe filter ssl.cert.subject.cn seemed the most appropriate. ssl.cert.issuer.cn would\nalso work well and produced the same results in my analysis.\n\n\n-----\n\nThis resulted in an initial query of  ssl.cert.subject.cn:\"Quasar Server CA\"\n\n\n-----\n\nThis query revealed 15 servers running with the subject common name of Quasar Server\n```\nCA\n\n```\nThese 15 servers were geographically dispersed and primarily across China, Hong Kong and\nGermany. The ports used also vary, and include 1337.\n\nExpanding the search to hone in on port 1337.\n\n\n-----\n\n[The second server of 164.92[.]184.73 had 0/86 detections on VirusTotal. The other had](https://www.virustotal.com/gui/ip-address/164.92.184.73/detection?ref=embee-research.ghost.io)\n[only 1/87 as of 2023/05/15. More information on VT detection can be found later in this](https://www.virustotal.com/gui/ip-address/195.201.168.80?ref=embee-research.ghost.io)\narticle.\n\n\n-----\n\n[The servers are mostly running on cloud hosting providers. Including Hetzner,](https://www.hetzner.com/?ref=embee-research.ghost.io) [DigitalOcean](https://www.digitalocean.com/go?ref=embee-research.ghost.io)\n[and China Unicom.](https://www.chinaunicom.com.hk/en/global/home.php?ref=embee-research.ghost.io)\n\nChina Unicom is pretty interesting.\n\nAnother overview of the countries can be seen here.\n\n\n-----\n\n**Exporting the Full list**\n\nThe rest of the shodan.io data was not extremely interesting and the associated jarm/ja3s\nvalues did not reveal much.\n\nSo I decided to export the list of servers and check the rest against VirusTotal.\n\nA full list of the servers can be seen here.\n```\n2[.]133[.]130[.]23\n\n27[.]11[.]235[.]246\n\n42[.]192[.]132[.]19\n\n43[.]240[.]48[.]46\n\n43[.]244[.]89[.]152\n\n45[.]32[.]106[.]94\n\n49[.]12[.]46[.]139\n\n59[.]26[.]93[.]6\n\n80[.]168[.]201[.]195\n\n81[.]19[.]141[.]35\n\n102[.]116[.]6[.]203\n\n139[.]46[.]12[.]49\n\n144[.]168[.]46[.]50\n\n152[.]89[.]244[.]43\n\n164[.]92[.]184[.]73\n\n180[.]235[.]137[.]45\n\n195[.]201[.]168[.]80\n\n198[.]244[.]160[.]119\n\n```\n**Analysing Detections Using Virustotal**\n\nViewing the servers within VirusTotal, we can again see one of the servers running port 1337\nhas 0/86 detection\n\n\n-----\n\nThe other Quasar server running 1337 has only 1/87 detections.\n\nIn total, there were 9 servers with 0 detections as of 2023-05-15. A few of these are listed\nbelow.\n\n\n-----\n\n**Full List of VirusTotal Detections**\n\nThis is a full list of the detection rates as of 2023-05-15.\n\n\n-----\n\n```\n2.133.130.23 VT 3/87\n\n27.11.235.246 - VT 0/86\n\n42.192.132.19 - VT 1/87\n\n43.240.48.46 - VT 0/86\n\n43.244.89.152 - VT 0/86\n\n45.32.106.94 - VT 3/87\n\n49.12.46.139 - VT 0/86\n\n59.26.93.6 - VT 12/87\n\n80.168.201.195 - VT 0/86\n\n81.19.141.35 - VT 1/87\n\n102.116.6.203 - VT 0/86\n\n139.46.12.49 - VT 0/86\n\n144.168.46.50 - VT 1/87\n\n152.89.244.43 - VT 2/87\n\n164.92.184.73 - VT 0/86\n\n180.235.137.45 - VT 2/87\n\n195.201.168.80 - VT 1/87\n\n198.244.160.119 - VT 0/86\n\n```\n**Bonus Analysis Using Censys**\n\nUsing Censys I was able to identify another 46 servers. I have not checked these against\nVirusTotal. You are welcome to do so using the full list of servers at the end of this post.\n```\nservices.tls.certificates.leaf_data.subject.common_name: \"Quasar Server CA\"\n\n## Conclusion\n\n```\nSo it turns out malware analysis can get far more interesting beyond just C2 extraction. With\nminimal additional analysis you can pivot to additional C2 infrastructure\n\n\n-----\n\nIt s possible that some of these servers are not malicious per se, but I see no valid reason\nfor using a Quasar certificate for communications. I'll assume they are all malware until\nnotified otherwise.\n\n## Closing Notes\n\nIf this analysis was useful or interesting to you. Consider signing up for the site.\n\n**_It's all free - and you'll get early access to posts and full iocs/threat-intel lists like the one_**\nbelow.\nThere's also a discord server where you can ask questions and get help with analysis :)\n\n## Complete List of Quasar Infrastructure\n\nThe complete list of 64 Quasar servers.\n```\nservices.tls.certificates.leaf_data.subject.common_name: \"Quasar Server CA\"\n\n```\n\n-----\n\n```\n102.116.6.203\n\n111.90.148.240\n\n139.180.219.18\n\n139.46.12.49\n\n14.225.204.247\n\n14.225.254.32\n\n144.168.46.50\n\n146.70.113.150\n\n146.70.172.107\n\n147.182.226.65\n\n152.89.244.43\n\n164.92.184.73\n\n172.174.58.11\n\n180.235.137.45\n\n185.219.134.204\n\n185.235.128.46\n\n185.80.128.131\n\n188.173.86.162\n\n194.55.224.25\n\n194.58.188.72\n\n195.201.168.80\n\n198.244.160.119\n\n2.133.130.23\n\n20.123.197.130\n\n20.231.104.157\n\n207.32.218.112\n\n209.25.142.223\n\n212.227.45.37\n\n212.90.103.114\n\n222.106.112.206\n\n27.11.235.246\n\n3.121.208.125\n\n3.71.116.67\n\n34.96.240.37\n\n42.192.132.19\n\n43.154.232.190\n\n43.240.48.46\n\n43.244.89.152\n\n45.12.213.244\n\n45.32.106.94\n\n45.80.158.187\n\n45.88.107.55\n\n47.242.113.51\n\n47.242.167.217\n\n47.243.141.95\n\n47.243.172.172\n\n49.12.46.139\n\n51.75.52.3\n\n52.204.66.30\n\n59.26.93.6\n\n61.4.115.124\n\n```\n\n-----\n\n```\n61.4.115.99\n\n70.176.21.36\n\n73.90.120.173\n\n77.34.128.25\n\n80.168.201.195\n\n81.19.141.35\n\n85.31.45.38\n\n91.192.100.36\n\n222.106.112.206\n\n### Complete List with Port Numbers\n\n```\n\n-----\n\n```\n102.116.6.203:8009\n\n108.160.136.232:8088\n\n111.90.148.240:8088\n\n116.36.143.105:8888\n\n139.180.219.18:8088\n\n14.225.204.247:6060\n\n14.225.254.32:9090\n\n144.168.46.50:9000\n\n146.70.113.150:8443\n\n146.70.172.107:55442\n\n147.182.226.65:9702\n\n152.89.244.43:443\n\n164.92.184.73:1337\n\n180.235.137.45:9443\n\n180.235.137.45:9443\n\n185.219.134.204:54321\n\n185.219.176.42:1337\n\n185.235.128.46:4022\n\n185.80.128.131:12121\n\n188.173.86.162:4873\n\n194.55.224.25:25\n\n194.58.188.72:8543\n\n195.201.168.80:1337\n\n195.201.168.80:1337\n\n198.244.160.119:443\n\n2.133.130.23:443\n\n2.133.130.23:443\n\n20.123.197.130:8080\n\n20.231.104.157:6666\n\n207.32.218.112:4782\n\n209.25.142.223:23508\n\n212.227.45.37:80\n\n212.23.222.42:7331\n\n212.90.103.114:5431\n\n222.106.112.206:1297\n\n27.11.235.246:8089\n\n3.121.208.125:1337\n\n3.71.116.67:4567\n\n34.96.240.37:6443\n\n42.192.132.19:8443\n\n43.154.232.190:8442\n\n43.240.48.46:443\n\n45.12.213.244:4499\n\n45.32.106.94:8080\n\n45.32.106.94:8081\n\n45.32.110.240:8080\n\n45.80.158.187:3577\n\n45.88.107.55:4499\n\n47.242.113.51:8442\n\n47.242.167.217:12199\n\n47.243.141.95:5672\n\n47.243.172.172:16099\n\n```\n\n-----\n\n```\n49.12.46.139:443\n\n52.204.66.30:443\n\n59.26.93.6:443\n\n61.4.115.124:6699\n\n61.4.115.99:6699\n\n70.176.21.36:7331\n\n74.207.237.228:8877\n\n77.34.128.25:8080\n\n81.19.141.35:443\n\n81.19.141.35:443\n\n85.31.45.38:6969\n\n91.192.100.36:8084\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-05-15 - Quasar Rat Analysis - Identification of 64 Quasar Servers Using Shodan and Censys.pdf"
    ],
    "report_names": [
        "2023-05-15 - Quasar Rat Analysis - Identification of 64 Quasar Servers Using Shodan and Censys.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1685930793,
    "ts_updated_at": 1743041168,
    "ts_creation_date": 1685882812,
    "ts_modification_date": 1685882812,
    "files": {
        "pdf": "https://archive.orkl.eu/7904ec89b6d15fc3e8d087e5c44c4192f5f29c89.pdf",
        "text": "https://archive.orkl.eu/7904ec89b6d15fc3e8d087e5c44c4192f5f29c89.txt",
        "img": "https://archive.orkl.eu/7904ec89b6d15fc3e8d087e5c44c4192f5f29c89.jpg"
    }
}