{
    "id": "e0b5af62-3f44-40fd-a49a-ce99c69ad303",
    "created_at": "2022-10-25T16:48:19.506508Z",
    "updated_at": "2025-03-27T02:13:34.265167Z",
    "deleted_at": null,
    "sha1_hash": "bd52c0809e379a7dabdb35fcbb07d077f10a6edc",
    "title": "BLACKGEAR Espionage Campaign Evolves, Adds Japan To Target List",
    "authors": "Trend Micro",
    "file_creation_date": "2016-10-27T11:23:16Z",
    "file_modification_date": "2016-10-27T11:23:16Z",
    "file_size": 443405,
    "plain_text": "# BLACKGEAR Espionage Campaign Evolves, Adds Japan To Target List\n\n**[Posted on: October 27, 2016 at 1:00 am](http://blog.trendmicro.com/trendlabs-security-intelligence/2016/10/)**\n**[Posted in: Malware, Targeted Attacks](http://blog.trendmicro.com/trendlabs-security-intelligence/category/malware/)**\n\n**[Author: Trend Micro](http://blog.trendmicro.com/trendlabs-security-intelligence/author/trend-micro/)**\n\n**_By Joey Chen and MingYen Hsieh_**\n\nBLACKGEAR is an espionage campaign which has targeted users in Taiwan for many years.\nMultiple papers and talks have been released covering this campaign, which used the ELIRKS\nbackdoor when it was first discovered in 2012. It is known for taking using blogs and\nmicroblogging services to hide the location of its actual command-and-control (C&C) servers.\nThis allows an attacker to change the C&C server used quickly by changing the information in\nthese posts.\n\nLike most campaigns, BLACKGEAR has evolved over time. Our research indicates that it has\nstarted targeting Japanese users. Two things led us to this conclusion: first, the fake documents\nthat are used as part of its infection routines are now in Japanese. Secondly, it is now using\nblogging sites and microblogging services based in Japan for its C&C activity.\n\nThis post will discuss this C&C routine, the tools used in these attacks, and the connections\nbetween these tools.\n\n**_C&C configuration retrieval_**\n\n_Figure 1. Overview of C&C configuration retrieval method_\n\n\n-----\n\nBackdoors used by BLACKGEAR share a common characteristic: they all retrieve encrypted\nC&C configuration information from blogs or microblogs. An attacker would register an account\non these services and then create posts. The encrypted C&C information would be between two\nhardcoded tags, as seen below:\n\n_Figure 2. Encrypted configuration information between tags_\n\nThere are two reasons BLACKGEAR would use this technique. First, the beacon traffic of the\nbackdoor would look like normal traffic to blogs. Secondly, the threat actor would be able to\nquickly change the C&C servers used if these were blocked. A defender would be unable to\nblock this change in server from reaching any affected machines unless the legitimate site was\nblocked as well.\n\n**_Tools Used by BLACKGEAR_**\n\n_Figure 3. Tools used by BLACKGEAR campaign_\n\nThe malware tools used by BLACKGEAR can be categorized into three categories: binders,\ndownloaders and backdoors. Binders are delivered by attack vectors (such as phishing and\n\n\n-----\n\nwatering hole attacks) onto a machine. These, in turn, drop decoys and downloaders. The latter\nconnect to various sites under the control of the attacker and downloads backdoors. These use\npersistent methods to ensure that they remain present on the affected machines to give attackers\naccess to the machine in question.\n\nBy separating the attack tools into three stages, threat actors are able to adapt quickly. If one\ncomponent is detected and/or blocked, it can be replaced without disrupting the entire toolset.\n\n**_Binder_**\n\nThe binder (which we detect as the TROJ_BLAGFLDR family) hides as a normal folder by\nchanging its icon to a folder icon. Once the victim executes it, it executes the downloader in the\nbackground, drops a decoy folder that includes fake documents, then delete itself. This is so the\nvictim won’t notice that the malicious downloader has been executed.\n\n**_Downloader_**\n\n_TSPY_RAMNY_\n\nTSPY_RAMNY is a downloader dropped by TROJ_BLAGFLDR malware. To remain persistent, it\nmoves itself to the Windows temp folder and drops a *.lnk (Windows Shortcut) file in the startup\nfolder that points to itself. It also sends information about the compromised host (such as network\nsettings) back to the download site.\n\nThe download link is formatted in the following format:\n\n - http://{IP address}/{folder name}/{webpage name} (Example: http://{IP\naddress}/multi/index.html)\nThis is done so that if someone looks solely at the URL, the download of the backdoor will\nappear to be an ordinary website.\n\n_TSPY_YMALRMINI_\n\nTSPY_YMALRMINI is another downloader that is dropped by TROJ_BLAGFLDR malware, which\nalso sends information about compromised hosts back to the download site. We were unable to\ndetermine which payloads were used by this downloader. However, our research indicates that\n\nsome of these downloads are saved as drWaston.exe on the compromised host. This same file\nname is also used by some ELIRKS variants, indicating a possible connection.\nTSPY_YMALRMINI uses the same URL format as RAMNY.\n\nTSPY_YMALRMINI has the same download link pattern as TSPY_RAMNY. The family name for\nthis malware is because some variants have the PDB string “C:\\toolson-mini\\YmailerCreater –\nDebug\\Binder\\Binder\\YMailer.pdb”. In addition, these variants also create a log file\nnamed YmailerMini.log.\n\n**_Backdoors_**\n\n\n-----\n\n_BKDR_ELIRKS_\n\nBKDR_ELIRKS was the first family of backdoors tied to BLACKGEAR. It retrieves encrypted\nC&C configuration information from various blogging or microblogging services. Once decoded, it\nconnects to these C&C servers and waits for commands given by a threat actor. To remain\n\npersistent, it moves itself to the Windows temp folder and drops a *.lnk (Windows Shortcut) file in\nthe startup folder that points to itself.\n\nIts backdoor routines include getting information from the compromised host, downloading and\nrunning files, taking screenshots, and opening a remote shell.\n\n_BKDR_YMALR_\n\nBKDR_YMALR is a backdoor written using the .NET framework which is also known as\nLOGEDRUT. The detection name comes from a log file created by this malware family\nnamed YMailer.log. Its behavior is similar to ELIRKS – both in terms of C&C information retrieval\nand available commands to a threat actor.\n\n**_Encryption and Decryption_**\n\n_BKDR_ELIRKS_\n\nReverse analysis of ELIRKS allowed us to determine how to decrypt the C&C information, which\nis done in the following Python code:\n```\n#! /usr/bin/env python\nfrom ctypes import *\ndef decipher(v, k):\n   y=c_uint32(v[0])\n   z=c_uint32(v[1])\n   sum=c_uint32(0xC6EF3720)\n   delta=c_uint32(0x61C88647)\n   n=32\n   w=[0,0]\nwhile(n>0):\n   z.value -= (y.value + sum.value) ^ (y.value * 16 + k[2]) ^ (( y.value >> 5 ) + k[3])\n   y.value -= (z.value + sum.value) ^ (z.value * 16 + k[0]) ^ (( z.value >> 5 ) + k[1])\n   sum.value += delta.value\n   n -= 1\nw[0]=y.value\nw[1]=z.value\n\n```\n\n-----\n\n```\nreturn w\nif __name__ == '__main__':\n   key = [0x8F3B39F1, 0x8D3FBD96, 0x473EAA92, 0x502E41D2]\n   ciphertext = [ciphertext1, ciphertext2] # you can input cipher text here\n   res = decipher(ciphertext, key)\n   plaintext = \"%X\" % (res[0])\n   c4 = str(int(\"0x\"+plaintext[6:8],16))\n   c3 = str(int(\"0x\"+plaintext[4:6],16))\n   c2 = str(int(\"0x\"+plaintext[2:4],16))\n   c1 = str(int(\"0x\"+plaintext[:2],16))\n   print c4+\".\"+c3+\".\"+c2+\".\"+c1\n\n```\nThe malware contains shellcode with two things: the URL of the blog entry and the tags that\nidentify where in the fake articles the hidden C&C information is located. Once the fake\nblog/microblog posts are downloaded, the malware finds and decrypts the C&C information.\n\nThe C&C information is stored in the post in two short bits of text. The first is an eight-character\nstring that is decoded into a six-byte hexadecimal value. The second is a two-character string\nwhich is already in a hexadecimal format, and is concatenated towards the end. A modified\n[version of the TEA algorithm decrypts these into the C&C server locations.](https://web.archive.org/web/20070127094759/http:/www-users.cs.york.ac.uk/~matthew/TEA/)\n\n_Figure 4. BKDR_ELIRKS decryption algorithm_\n\n_BKDR_YMALR_\n\nBKDR_YMALR implements the same behavior in a slightly different manner. It contains several\nencrypted strings:\n\n\n-----\n\n_Figure 5. Encrypted strings in BKDR_YMALR_\n\nThese encrypted strings are the result of the blog URLs and tags being first encoded\nwith Base64, and then encrypted with DES. The encryption key and initialization vector are\nhardcoded, with both set to 1q2w3e4r. (Note how these are positioned on a normal keyboard.)\n\n_Figure 6. Blog URL and tags in BKDR_YMALR_\n\n_Figure 7. BKDR_YMALR decryption algorithm_\n\nOnce these have been decoded, BKDR_YMALR uses the same algorithm as ELIRKS to obtain\nthe C&C information.\n\n\n-----\n\n_Figure 8. BKDR_YMALR configuration from the blog post blog_\n\n**_Connections between tools_**\n\n_Figure 9. Connections between tools_\n\nMore than just tools being used together, it appears that there are distinct connections between\n\nthe different tools used by BLACKGEAR. The string “YMailer” shows up in the filenames of log\nfiles used by both BKDR_YMALR and TSPY_YMALRMINI, and it is in the PDB strings of the\nlatter. The two downloaders TSPY_RLMNY and TSPY_YMALRMINI both use the\n\n\n-----\n\nstring toolson in different places. Lastly, both downloaders and one backdoor share the same\ndecryption key 1q2w3e4r. The above illustration shows the connections between the families.\n\n**_Conclusion_**\n\nMalware threats need to evolve or otherwise become non-threats. Similarly, to stay relevant,\nBLACKGEAR has evolved with both new tools and new targets, and will continue to be a threat\nfor the foreseeable future. We will continue to monitor its activities in order to protect our\ncustomers.\n\n**_Indicators of Compromise (IOCs)_**\n\n_TROJ_BLAGFLDR_\n\n - 52d6b30bc578465d8079d9abd0d4c4826b51b25f\n\n - 800c7d54280f5f35e3b58a6d4dfd4845f6ed9e15\n\n - 8b6614562a79a13e60d100a88f1ba4eb601636db\n\n - 98efee8dde7d493c0d35d02a2170b6d1b52987d3\n_TSPY_RAMNY_\n\n - 02785ebcb683a380c80958f3fe2a52f805c5c12d\n\n - 74031e70ca3b4004c6b7a8197397882bc02c30cb\n\n - b4c63a0ff9b8eb8cc1a53a4dd036e93f9eeceeca\n_TSPY_YMALRMINI_\n\n - 048790098a7c6b8405761b75ef2a2fd8bd0560b6\n\n - 96f3b52460205f6ecc6b6d1a73f8db13c6634afc\n_BKDR_ELIRKS_\n\n - 17cacabcf78c4b164bb0e7d9200289be9236e7bc\n\n - 4157ecd252dc09b533fcf6a778aca2c376601354\n\n - 4f54cfcf266b73ca3759b9cb0252c27094b5b330\n\n - 521a9d73191c7740f969ae3c53e6abf70ffbedf9\n\n - 533565f7953fb1648d437d14d007003c6343b9ae\n\n - 80108d2aacb0a1f2a5350f71e7a04239fc5f96a9\n\n - 8cad1bcbdd558802b34119fb57160cc748170133\n\n - 9a768fae41ca7395b4257e85acef915e124c2981\n\n - a70001c67e81d1dcf62f808760514b6df28a411a\n\n - a9ea07caafeb63133e5131f7a56bc8da1bc3d72a\n\n - dd0ceafbe7f4bf2905e560c3348545e32bc0f684\nBKDR_YMALR\n\n - 02fed8cae7f3986c1344dd75d869ba23cfc4073a\n\n - 09d73b522f36786bb6e645b96f244bb51c3cc7ea\n\n - 0a59d52367435bc22a92c27d60023acec575a5fb\n\n - 0cc74332b1e213456693159d3ba12a3421036f68\n\n - 1120f049dcb4a62809687dc277b42589d8d1caa6\n\n - 12c8cc7e125572d614b708c056f7fd0ed49870c5\n\n - 29b08d270ba6efcf57ca2ad33d8e3edd93d6b32a\n\n - 2d3d7b9521aec637f2e99624e0489b9f140d463f\n\n - 2de7d78615ec0fbf2652790d53b50ddb0472292c\n\n\n-----\n\n- 31de946255b240c0ae2f56786ac25183f3aaeea5\n\n- 3aa8509715c7f55bdee831d5f7db22a2c516db43\n\n- 3d175b1defe7076e0fe56076dd0d5f438de43324\n\n- 4000244b2cba78a45034bb6ab2bac46d6a8a79ea\n\n- 4882735e8a465fac938fd04546a51efefb9806da\n\n- 48d373bdb31dcecd7f59bd5a964d062c8b6bfce8\n\n- 49f6eb7f8e4a27f574c9a3e8c0da0b7895df7e41\n\n- 4c7df09012fc88d336467691acf0afce64f40341\n\n- 551f9a60203bec904487113e8d42dea463ac6ca9\n\n- 5a4b15fa5a615a93191ede4c75dd3e65e87586dc\n\n- 5aa5117db6f420c81d2e1a7f036963a3c6ef02e9\n\n- 5dc007d056513cba030ec16e15bdbb9ea5fe0e5a\n\n- 628309a60ad1fbe240486519de1424f7ddc2df4d\n\n- 636e7a9effb1a244697c880832e486de56260527\n\n- 6bb5f51d03edd1acd7d38cca8095a237543c6a0d\n\n- 6c4786b792f13643d408199e1b5d43f6473f5eea\n\n- 6dd997409afec6fafbe54bd9d70d45fffff6a807\n\n- 7142ca7079da17fa9871cbc86f7633b3253aeaed\n\n- 7254b719fd3cf87c8ac8ed9327c8e1bf99abf7af\n\n- 7329a789363f890c401c286dbaf3d2bf79ee14f7\n\n- 7b2c4d14710cf2fd53486399ecc5af85cd75eca6\n\n- 88e22933b76273793e4278c433562fb0b4fe125a\n\n- 8917c582ab5c2e831de6eba33b4f19d6e3a2cb70\n\n- 8c325e92bf21d0c3737dbbc596854bc12184eeaf\n\n- 8f65cbde2f3b664bcede3822a19765bdb7f58099\n\n- 9047b6b2e8fbaa8a06b2faaa30e038058444106a\n\n- 93c3f23905599df78cd5416dd9f7c171b3f1e29e\n\n- 94750bdae0fa190116a68e96d45f3d46c24b6cf1\n\n- 9954a1c8e7b0e2f17841608f6b8c9d042b7a0780\n\n- 9b96646d152583ff58c2c29191cb1672847d56b6\n\n- 9f5a3b6db752d617f4d278d6531e2bbdb7faa977\n\n- a30cc98ceb5d3379e80443f68a186326926f73ce\n\n- a893896af5468ac6e04cdd13edff8cae04800848\n\n- a8f461749c7fe2a21116b8390cf84a8300009321\n\n- a9108bf3ce39cea40e46ac575247a9a7c077b2a8\n\n- a9fd9ade807af4779f3eea39fed2c583a50c8497\n\n- ac014e4c2d68f6c982ac58738857b698b9e46af5\n\n- acaec2b0f86ec4262be5bb8bcebcc12093e071ba\n\n- ad61c51b03022ef6bcb5e9738fe2f621e970ecb3\n\n- b28f6ba3d6571c5d85cb5276cbcdce9adf49d5a9\n\n- bc61f1b3c8eb3bda2071f6caf71ff23705128ca5\n\n- c30b305a7bea9a2f61aca2dbcf596c2b0c0e4fa0\n\n- c4c747f26f95fdbfc5bff04688dc76ae0bb48fff\n\n- c58d6fc761dec675ab45ad5c3682ffc9936cf357\n\n- c85f528900aa9d836abd88eb56902efd711491da\n\n- ca163d6ae85edede87b271267918a0ffe98040c7\n\n- cf629249fb4af86746059e638ccef5b8a43c6834\n\n- cfd9a67b4b0eb3d756bb7e449b46687e6aef006b\n\n- d107268bd767a2dfe1c8733b7da96c1a64f5d112\n\n- d7cd079f8485ea55443ed497f055dbed5ae4a668\n\n- d95c97f1525e9888571f498f2be584dda243da2a\n\n- e01f9ba6355bcdc7ccf89261658bff9f965b8c21\n\n- e05efde2b442dc4119179e3c39c74a973499e271\n\n- e1acfed710f186d86a2bc8179ff38fdd21f9a1b6\n\n- e1fb2e1866f332a5656bf55fde13ff57d5f0bbf6\n\n- e77303d80968395eec008515ea9eb3c620b14255\n\n\n-----\n\n- eb9e553524d414d862857297baf44da3b4072650\n\n- eca06f3c535ba3b3463917974a79efc821fddb6c\n\n- eeb065a1963a8aa0496e61305c076c5946d77e12\n\n- efa611262e6d4804ce9026d50bfa64f20d9271ca\n\n- fb59481d153388d2ad3bb6321d0b2875cb07f4d3\n\n- fbcbbc187e99317c5a36a3667592590a7f5a17d1\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/ws5vsndqqi7s17ysrfa39260wqy2ktyt",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2016/2016.10.27.BLACKGEAR_Espionage_Campaign_Evolves/BLACKGEAR.Espionage.Campaign.Evolves.-.Trend.Micro.pdf"
    ],
    "report_names": [
        "TrendMicro_BLACKGEAR-Espionage-Campaign(10-27-2016)",
        "BLACKGEAR.Espionage.Campaign.Evolves.-.Trend.Micro"
    ],
    "threat_actors": [
        {
            "id": "6750d709-9153-4e90-baa3-04883a9b762b",
            "created_at": "2022-10-25T16:07:23.397596Z",
            "updated_at": "2025-03-27T02:02:09.778738Z",
            "deleted_at": null,
            "main_name": "Blackgear",
            "aliases": [
                "Topgear"
            ],
            "source_name": "ETDA:Blackgear",
            "tools": [
                "Comnie",
                "Elirks",
                "Protux"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "ad59becc-29c2-4b7a-a958-d7f242d222ea",
            "created_at": "2023-01-06T13:46:38.956494Z",
            "updated_at": "2025-03-27T02:00:02.962214Z",
            "deleted_at": null,
            "main_name": "Blackgear",
            "aliases": [
                "Topgear",
                "Comnie",
                "BLACKGEAR"
            ],
            "source_name": "MISPGALAXY:Blackgear",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041614,
    "ts_creation_date": 1477567396,
    "ts_modification_date": 1477567396,
    "files": {
        "pdf": "https://archive.orkl.eu/bd52c0809e379a7dabdb35fcbb07d077f10a6edc.pdf",
        "text": "https://archive.orkl.eu/bd52c0809e379a7dabdb35fcbb07d077f10a6edc.txt",
        "img": "https://archive.orkl.eu/bd52c0809e379a7dabdb35fcbb07d077f10a6edc.jpg"
    }
}