{
    "id": "ef65b79e-3eeb-456e-bfb2-335510a3565e",
    "created_at": "2023-01-12T15:11:00.828872Z",
    "updated_at": "2025-03-27T02:05:32.084108Z",
    "deleted_at": null,
    "sha1_hash": "06500739d60e372be2b315a369939d6ac3e8d396",
    "title": "2019-11-08 - Wireshark Tutorial- Examining Trickbot Infections",
    "authors": "",
    "file_creation_date": "2022-05-27T23:29:15Z",
    "file_modification_date": "2022-05-27T23:29:15Z",
    "file_size": 11026677,
    "plain_text": "# Wireshark Tutorial: Examining Trickbot Infections\n\n**[unit42.paloaltonetworks.com/wireshark-tutorial-examining-trickbot-infections/](https://unit42.paloaltonetworks.com/wireshark-tutorial-examining-trickbot-infections/)**\n\nBrad Duncan November 8, 2019\n\nBy [Brad Duncan](https://unit42.paloaltonetworks.com/author/bduncan/)\n\nNovember 8, 2019 at 6:00 AM\n\n[Category: Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [Tutorial,](https://unit42.paloaltonetworks.com/category/tutorial/) [Unit 42](https://unit42.paloaltonetworks.com/category/unit-42/)\n\nTags: [banking,](https://unit42.paloaltonetworks.com/tag/banking/) [infection,](https://unit42.paloaltonetworks.com/tag/infection/) [pcap,](https://unit42.paloaltonetworks.com/tag/pcap/) [Trickbot,](https://unit42.paloaltonetworks.com/tag/trickbot/) [Wireshark,](https://unit42.paloaltonetworks.com/tag/wireshark/) [Wireshark Tutorial](https://unit42.paloaltonetworks.com/tag/wireshark-tutorial/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/wireshark-tutorial-examining-trickbot-infections/)\n\n## Executive Summary\n\nWhen a host is infected or otherwise compromised, security professionals with access to\npacket captures (pcaps) of the network traffic need to understand the activity and identify the\ntype of infection.\n\nThis tutorial offers tips on how to identify Trickbot, an information stealer and banking\n[malware that has been infecting victims since 2016. Trickbot is distributed through malicious](https://www.forbes.com/sites/leemathews/2019/07/14/stealthy-trickbot-malware-has-compromised-250-million-email-accounts-and-is-still-going-strong/#6f92d6d94884)\n[spam (malspam), and it is also distributed by other malware such as Emotet,](https://www.malware-traffic-analysis.net/2019/10/02/index.html) [IcedID, or](https://www.malware-traffic-analysis.net/2019/10/31/index.html)\n[Ursnif.](https://www.malware-traffic-analysis.net/2019/10/09/index.html)\n\n\n-----\n\nTrickbot has distinct traffic patterns. This tutorial reviews pcaps of Trickbot infections caused\nby two different methods: a Trickbot infection from malspam and Trickbot when it is\ndistributed through other malware.\n\nNote: Today’s tutorial requires Wireshark with a column display customized according to this\nprevious tutorial. You should already have implemented Wireshark display filters as\n[described here.](https://unit42.paloaltonetworks.com/using-wireshark-display-filter-expressions/)\n\n**Trickbot from malspam**\n\nTrickbot is often distributed through malspam. Emails from these campaigns contain links to\ndownload malicious files disguised as invoices or documents. These files may be Windows\nexecutable files for Trickbot, or they may be some sort of downloader for the Trickbot\nexecutable. In some cases, links from these emails return a zip archive that contains a\nTrickbot executable or downloader.\n\nFigure 1 shows an example from September 2019. In this example, the email contained a\nlink that returned a zip archive. The zip archive contained a Windows shortcut file that\ndownloaded a Trickbot executable. A pcap for the associated Trickbot infection is available\n[here.](https://www.malware-traffic-analysis.net/2019/09/25/index.html)\n\n_Figure 1: Flowchart from a Trickbot infection from malspam in September 2019._\n\n[Download the pcap from this page. The pcap is contained in a password-protected zip](https://www.malware-traffic-analysis.net/2019/09/25/index.html)\narchive named 2019-09-25-Trickbot-gtag-ono19-infection-traffic.pcap.zip. Extract the\npcap from the zip archive using the password infected and open it in Wireshark Use your\n\n\n-----\n\n**_basic filter to review the web-based infection traffic as shown in Figure 2._**\n\n_Figure 2: Pcap of the Trickbot infection viewed in Wireshark._\n\nReview the traffic, and you will find the following activity common in recent Trickbot\ninfections:\n\nAn IP address check by the infected Windows host\nHTTPS/SSL/TLS traffic over TCP ports 447 and 449\nHTTP traffic over TCP port 8082\nHTTP requests ending in .png that return Windows executable files\n\nUnique to this Trickbot infection is an HTTP request to www.dchristjan[.]com that returned\na zip archive and an HTTP request to 144.91.69[.]195 that returned a Windows executable\nfile. Follow the HTTP stream for the request to www.dchristjan[.]com as shown in Figure 3\nto review the traffic. In the HTTP stream, you will find indicators that a zip archive was\nreturned as shown in Figure 4.\n\n\n-----\n\n_Figure 3: Following the HTTP stream for the request to www.dchristjan[.]com._\n\n\n-----\n\n_Figure 4: Indicators the HTTP request returned a zip archive._\n\nIn Figure 4, you can also see the name of the file contained in the zip archive,\n**_InvoiceAndStatement.lnk. You can export the zip archive from the traffic using Wireshark_**\nas shown in Figure 5 and Figure 6 using the following path:\n\n**_File → Export Objects → HTTP…_**\n\n\n-----\n\n_Figure 5: Exporting HTTP objects from the pcap._\n\n_Figure 6: Exporting the zip archive from the pcap._\n\nIn a BSD, Linux, or Mac environment, you can easily confirm the extracted file is a zip\narchive, get the SHA256 hash of the file, and extract the contents of the archive in a\ncommand line environment. In this case, the content is a Windows shortcut file, which you\ncan also confirm and get the SHA256 hash as shown in Figure 7.\n\n\n-----\n\nThe command to identify the file type is file [filename], while the command to find the\nSHA256 hash of the file is shasum -a 256 [filename].\n\n_Figure 7: Checking the extracted zip archive and its contents._\n\nAn HTTP request to 144.91.69[.]195 returned a Windows executable file. This is the initial\nWindows executable for Trickbot. You can follow the HTTP stream for this HTTP request and\nfind indicators this is an executable file as shown in Figure 8 and Figure 9. You can extract\nthe executable file from the pcap as shown in Figure 10.\n\n\n-----\n\n_Figure 8: Following the HTTP stream for the HTTP request to 144.91.69[.]195._\n\n\n-----\n\n_Figure 9: Indicators the returned file is a Windows executable or DLL file._\n\n\n-----\n\n_Figure 10: Exporting the Windows executable from the pcap._\n\nPost infection traffic initially consists of HTTPS/SSL/TLS traffic over TCP port 443, 447, or\n449 and an IP address check by the infected Windows host. In this infection, shortly after the\nHTTP request for the Trickbot executable, we can see several attempted TCP connections\nover port 443 to different IP addresses before the successful TCP connection to\n187.58.56[.]26 over TCP port 449. If you use your basic+ filter, you can see these attempted\nconnections as shown in Figure 11 and Figure 12.\n\n_Figure 11: Attempted TCP connections over port 443 by the infected Windows host._\n\n\n-----\n\n_Figure 12: Scrolling down to see more TCP connections over port 443 before a successful_\n_connection to 187.58.56[.]26 over TCP port 449._\n\nThe HTTPS/SSL/TLS traffic to various IP addresses over TCP port 447 and TCP port 449\nhas unusual certificate data. We can review the certificate issuer by filtering on\n**_ssl.handshake.type == 11 when using Wireshark 2.x or tls.handshake.type == 11 when_**\nusing Wireshark 3.x. Then go to the frame details section and expand the information, finding\nyour way to the certificate issuer data as seen in Figure 13 and Figure 14.\n\n\n-----\n\n_Figure 13: Filtering for the certificate data in the HTTPS/SSL/TLS traffic, then expanding_\n_lines the frame details for the first result under TCP port 449._\n\n\n-----\n\n_Figure 14: Drilling down to the certificate issuer data on the first result over TCP port 449._\n\nIn Figure 14, we see the following certificate issuer data used in HTTPS/SSL/TLS traffic to\n187.58.56[.]26 over TCP port 449:\n\nid-at-countryName=AU\nid-at-stateOrProvinceName=Some-State\nid-at-organizationName=Internet Widgits Pty Ltd\n\nThe state or province name (Some-State) and the organization name (Internet Widgits Pty\nLtd) are not used for legitimate HTTPS/SSL/TLS traffic. This is an indicator of malicious\ntraffic, and this type of unusual certificate issuer data is not limited to Trickbot. What does a\nnormal certificate issuer look like in legitimate HTTPS/SSL/TLS traffic? If we look at earlier\ntraffic to Microsoft domains at 72.21.81.200 over TCP port 443, we find the following as seen\nin Figure 15.\n\nid-at-countryName=US\nid-at-stateOrProvinceName=Washington\nid-at-localityName=Redmond\nid-at-organizationName=Microsoft Corporation\nid-at-organizationUnitName=Microsoft IT\nid-at-commonName=Microsoft IT TLS CA 2\n\n\n-----\n\n_Figure 15: Certificate data from legitimate HTTPS traffic to a Microsoft domain._\n\nThe Trickbot-infected Windows host will check its IP address using a number of different IP\naddress checking sites. These sites are not malicious, and the traffic is not inherently\nmalicious. However, this type of IP address check is common with Trickbot and other families\nof malware. Various legitimate IP address checking services used by Trickbot include:\n\n**_api.ip[.]sb_**\n**_checkip.amazonaws[.]com_**\n**_icanhazip[.]com_**\n**_ident[.]me_**\n**_ip.anysrc[.]net_**\n**_ipecho[.]net_**\n**_ipinfo[.]io_**\n**_myexternalip[.]com_**\n**_wtfismyip[.]com_**\n\nAgain, an IP address check by itself is not malicious. However, this type of activity combined\nwith other network traffic can provide indicators of an infection, like we see in this case.\n\n\n-----\n\n_Figure 16: IP address check by the infected Windows host, right after HTTPS/SSL/TLS traffic_\n_over TCP port 449. Not inherently malicious, but this is part of a Trickbot infection._\n\nA Trickbot infection currently generates HTTP traffic over TCP port 8082 this traffic sends\ninformation from the infected host like system information and passwords from the browser\ncache and email clients. This information is sent from the infected host to command and\ncontrol servers used by Trickbot.\n\nTo review this traffic, use the following Wireshark filter:\n\n**_http.request and tcp.port eq 8082_**\n\nThis reveals the following HTTP requests as seen in Figure 17:\n\n170.238.117[.]187 port 8082 - 170.238.117[.]187 - POST\n\n/ono19/BACHMANN-BTO-PC_W617601.AC3B679F4A22738281E6D7B0C5946\n\nE42/81/\n170.238.117[.]187 port 8082 - 170.238.117[.]187 - POST\n\n/ono19/BACHMANN-BTO-PC_W617601.AC3B679F4A22738281E6D7B0C5946\n\nE42/83/\n170.238.117[.]187 port 8082 - 170.238.117[.]187 - POST\n\n/ono19/BACHMANN-BTO-PC_W617601.AC3B679F4A22738281E6D7B0C5946\n\nE42/81/\n170.238.117[.]187 port 8082 - 170.238.117[.]187:8082 - POST\n\n/ono19/BACHMANN-BTO-PC_W617601.AC3B679F4A22738281E6D7B0C5946\n\nE42/81/\n\n\n-----\n\n170.238.117[.]187 port 8082 - 170.238.117[.]187:8082 - POST\n/ono19/BACHMANN-BTO-PC_W617601.AC3B679F4A22738281E6D7B0C5946\nE42/90\n170.238.117[.]187 port 8082 - 170.238.117[.]187:8082 - POST\n/ono19/BACHMANN-BTO-PC_W617601.AC3B679F4A22738281E6D7B0C5946\nE42/90\n\n_Figure 17: HTTP traffic over TCP port 8082 caused by Trickbot._\n\nHTTP POST requests ending in 81 send cached password data from web browsers, email\nclients, and other applications. HTTP POST requests ending in 83 send form data submitted\nby applications like web browsers. We can find system information sent through HTTP POST\nrequests ending in 90. Follow the TCP or HTTP streams for any of these HTTP POST\nrequests to review data stolen by this infection.\n\n\n-----\n\n_Figure 18: Login credentials stolen by Trickbot from the Chrome web browser. This data was_\n_sent by the Trickbot-infected host using HTTP traffic over TCP port 8082._\n\n\n-----\n\n_Figure 19: System data sent by a Trickbot-infected host using HTTP traffic over TCP port_\n_8082. It starts with a list of running processes._\n\n\n-----\n\n_Figure 20: More system data sent by a Trickbot-infected host using HTTP traffic over TCP_\n_port 8082. This is later from the same HTTP stream that started in Figure 19._\n\nTrickbot sends more Windows executable files over HTTP GET requests ending in .png.\nThese follow-up Trickbot executables are used to infect a vulnerable domain controller (DC)\nwhen the infected Windows host is a client in an Active Directory environment.\n\nYou can find these URLs in the pcap by using the following Wireshark filter:\n\n**_http.request and ip contains .png_**\n\n\n-----\n\n_Figure 21: Filtering to find follow-up Trickbot EXE files sent using URLs ending with .png._\n\nFollow the TCP or HTTP stream in each of the three requests as shown in Figure 21. You\nshould see indicators of windows executable files similar to what we saw in Figure 9.\nHowever, in this case, the HTTP response headers identify the returned file as image/png\neven though it clearly is a Windows executable or DLL file.\n\n_Figure 22: Windows executable sent through URL ending in .png._\n\n\n-----\n\nYou can export these files from Wireshark, confirm they are Windows executable files, and\nget the SHA256 file hashes as we covered earlier in this tutorial.\n\n**Trickbot Distributed Through Other Malware**\n\nTrickbot is frequently distributed through other malware. Trickbot is commonly seen as\nfollow-up malware to Emotet infections, but we have also seen it as follow-up malware from\nIcedID and Ursnif infections\n\nSince Emotet frequently distributes Trickbot, lets review an Emotet with Trickbot infection in\n[September 2019 documented here. We already covered Emotet with Trickbot infections last](https://www.malware-traffic-analysis.net/2019/09/25/index2.html)\n[year in this Palo Alto Networks blog post, so this tutorial will focus on the Trickbot activity.](https://unit42.paloaltonetworks.com/unit42-malware-team-malspam-pushing-emotet-trickbot/)\n\n_Figure 23: Simplified flow chart for Emotet with Trickbot activity._\n\n[Download the pcap from this page. The pcap is contained in a password-protected zip](https://www.malware-traffic-analysis.net/2019/09/25/index.html)\narchive named 2019-09-25-Emotet-infection-with-Trickbot-in-AD-environment.pcap.zip.\nExtract the pcap from the zip archive using the password infected and open it in Wireshark.\nUse your basic filter to review the web-based infection traffic as shown in Figure 24.\n\n\n-----\n\n_Figure 24: Filtering on web traffic in an Emotet+Trickbot infection._\n\nExperienced analysts can usually identify the Emotet-generated traffic and the Trickbotgenerated traffic. Post-infection Emotet activity consists HTTP traffic with encoded data\nreturned by the server. This is distinctly different than post-infection Trickbot activity which\ngenerally relies on HTTPS/SSL/TLS traffic for command and control communications. Figure\n25 points out the different infection traffic between Emotet and Trickbot for this specific\ninfection.\n\n\n-----\n\n_Figure 25: The differences in Emotet and Trickbot traffic._\n\nThis infection happened in an Active Directory environment with 10.9.25.102 as the infected\nWindows client and 10.9.25.9 as the DC. Later in the traffic, we see the DC exhibit signs of\nTrickbot infection as shown in Figure 26.\n\n_Figure 26: Trickbot activity on the DC._\n\n\n-----\n\n[How did the infection move from client to DC? Trickbot uses a version of the EternalBlue](https://www.wired.com/story/eternalblue-leaked-nsa-spy-tool-hacked-world/)\nexploit to move laterally using Microsoft’s SMB protocol. In this case, the infected Windows\nclient sent information several times over TCP port 445 to the DC at 10.9.25.9, which then\nretrieved a Trickbot executable from 185.98.87[.]185/wredneg2.png. Use the basic+ filter to\nsee the SYN segments for the traffic between the client at 10.9.25.102 and the DC at\n10.9.25.9 right before the DC calls out to 185.98.87[.]185 as shown in Figure 27\n\n_Figure 27: Finding traffic from the client at 10.9.25.102) to the DC at 10.9.25.9 (shown in_\n_grey) before the DC retrieved a Trickbot EXE from 196.98.87[.]185/wredneg2.png._\n\nFollow one of the TCP streams, for example the line with a source as 10.9.25.102 over TCP\nport 49321 and destination as 10.9.35.9 over TCP port 445. This is highly unusual traffic for\na client to send to a DC, so it is likely related to the EternalBlue exploit. See Figure 28 for an\nexample of this traffic\n\n\n-----\n\n_Figure 28: Example of the unusual traffic from a client to DC over TCP port 445, possibly_\n_related to an EternalBlue-based exploit._\n\nOther than this unusual SMB traffic and the DC getting infected, any Trickbot-specific activity\nin this pcap is remarkably similar to our previous example.\n\n## Conclusion\n\nThis tutorial provided tips for examining Windows infections with Trickbot malware by\nreviewing two pcaps from September 2019. More pcaps with recent examples of Trickbot\nactivity can be found at [malware-traffic-analysis.net.](https://www.malware-traffic-analysis.net/index.html)\n\nFor more help with Wireshark, see our previous tutorials:\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n\n-----\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-11-08 - Wireshark Tutorial- Examining Trickbot Infections.pdf"
    ],
    "report_names": [
        "2019-11-08 - Wireshark Tutorial- Examining Trickbot Infections.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536260,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1653694155,
    "ts_modification_date": 1653694155,
    "files": {
        "pdf": "https://archive.orkl.eu/06500739d60e372be2b315a369939d6ac3e8d396.pdf",
        "text": "https://archive.orkl.eu/06500739d60e372be2b315a369939d6ac3e8d396.txt",
        "img": "https://archive.orkl.eu/06500739d60e372be2b315a369939d6ac3e8d396.jpg"
    }
}