{
    "id": "df596184-ca39-479c-ae2d-096c99bff694",
    "created_at": "2023-01-01T02:04:34.001628Z",
    "updated_at": "2025-03-27T02:11:03.969669Z",
    "deleted_at": null,
    "sha1_hash": "8b21384f29b822b126bd2a676dce2da8d9fdb330",
    "title": "",
    "authors": "",
    "file_creation_date": "2021-06-23T11:17:51Z",
    "file_modification_date": "2021-06-23T11:18:06Z",
    "file_size": 7188421,
    "plain_text": "###### www.kisa.or.kr\n\n 「Tactics,\n\n Techniques,\n\n Procedures」\n\n### TTPs#5 :\n## attack patterns in AD environment\n\n\n-----\n\n###### Contents\n\n「Tactics, Techniques, Procedures」\n\n##### TTPs#5 : attack patterns  in AD environment\n\n###### 1. Introduction 03\n\n 2. Overview 04\n\n 3. ATT&CK Matrix 08\n\n 4. Conclusion 51\n\nReproduction or copying of the contents of this report\nwithout permission from the Korea Internet & Security\nAgency is prohibited and may violate copyright laws.\n\nWritten by: \u0007Profound Analysis Team,\n\nInternet Incident Analysis Group\n\nKayoung Kim, Researcher\n\nDongwook Kim, Deputy General Researcher\n\nTaewoo Lee, Deputy General Researcher\n\nSeulgi Lee, Deputy General Researcher\n\nJaeKwang Lee, Manager\n\nEdited by: \u0007Dae-Kyu Shin, Vice President\n\nJinsoo Lim, Director\n\n\n-----\n\n1.\n\n\nIntroduction\n#### 1. Introduction\n\nThe rise in hacking incidents have led to ever-more stringent security requirements and the continuous\nevolvement of security systems to the next level. Yet, cyber incidents that were reported in the past are still\nbeing repeated today, and organizations with some of the most sophisticated cyber-defense systems are still\nfalling victims to such attacks.\n\nThe influential concept of “The Pyramid of Pain” in the sphere of cybersecurity illustrates that the most effective\nsecurity systems depend on understanding the ‘tactics, techniques and procedures’ (TTP) of the attackers. The\nultimate goal of cybersecurity is to make attacks more costly and more painful for perpetrators, in other words,\nelevated to the ‘tough’ level shown at the top of the pyramid.\n\nFigure 1-1 Pyramid of Pain, David J Bianco\n\nA cybersecurity system based on ‘indicators of compromise’ (IoC) still remains very efficient. (IoCs would refer\nto one-dimensioned indicators such as malicious IPs or domains.) However, it is also true that attackers can\neasily secure then discard attack infrastructures using such simple indicators.\n\nTTPs are different. The attacker cannot easily obtain or discard TTPs. An attacker who has locked on a target\nneeds to invest in learning and practicing TTPs to neutralize the target's security system. When moving on to the\nnext attack, the attacker will tend to select targets on which the same TTPs can be applied.\n\nThe attacker's TTPs by nature are heavily influenced by the characteristics of the targeted defense environment.\nAs such, security practitioners must have an accurate understanding of their own defense environment. They\nmust also approach the process and flow of attack from the strategic and tactical levels rather than as patterns or\nmethods. In short, the defender’s security environment and the attacker’s TTPs must be scrutinized together.\n\nA defender who understands the attacker’s TTPs should be able to answer two things: 1) ‘Would the attacker's\nTTPs be able to penetrate the defender's environment?’ and 2) ‘If so, what defensive strategy can defeat the TTPs?’\n\nThe Korea Internet & Security Agency (KISA) identifies cyberattack TTPs through its incident response process and\ndisseminates the process and countermeasures using the ATT&CK framework.[1] The various artifacts related to TTPs\nincluded in this report are merely tools to promote understanding.\n\n1  A matrix showing the tactics and techniques used in actual attacks and response measures to them\n\n\n1.\n\nIntroduction\n\n\n1.\n\nIntroduction\n\n\n-----\n\n#### 2. Overview\n\nIn the first half of 2019, there were many ransomware infections targeting companies using AD (active\n\ndirectory). Security and convenience form two sides of the same coin. AD is efficient for managing a large\n\nnumber of systems, but careless account management\n\nmay lead to the administrator rights being stolen, resulting in the entire internal network being compromised.\n\nThe Korea Internet and Security Agency has, in the past, responded to this by compiling attacker techniques,\n\nmalicious code similarities, etc. found during security incident investigations and distributed security warnings to\n\ncompanies using AD, etc. For some time, the activities of attackers in Korea decreased, but starting near the\n\nend of 2020, ransomware infections for AD environments began to once again occur in Korea.\n\nCorporations, upon hearing the news of the many ransomware incidents, realized the importance of backup\n\nand began regularly backing up important data. When corporations successfully backed up their data and did\n\nnot react to the demands of the attackers, the attackers began leaking internal information and request payment\n\nfor the leaked data.\n\nThe infiltration techniques of attacks differ slightly based on the AD environment composition, but analysis of\n\nAD ransomware infections beginning in 2019 show that most used the same TTPs.\n\nThis TTP#5 report has detailed the process closely from the initial infiltration of the AD environment to the\n\nachievement of the final goal. Through this, the aim is to be of aid to corporations who seek to inspect internal\n\nsecurity systems and build defensive strategies.\n\n\n2.\n\nOverview\n\n\n-----\n\nAt the reconnaissance stage, email stealer malicious code is used to leak Outlook data files from previously\n\ninfected systems and extract email information. Some of such email accounts are used in APT attacks targeting\n\ncorporations.\n\n###### 02 Resource Development\n\nFor internal transfers in an AD environment, commercial malicious tools such as Cobalt Strike, Ammyy Admin,\n\nTiny Met, etc. are used. Resources to be used as control servers or locations for malicious code distribution are\n\nsecured in advance, and attack tools for SMB side transfers are created.\n\n###### 03 Initial Access\n\nPreviously stolen email accounts are sent malicious files or spear-phishing email with malicious codes. In order\n\nto disguise them as normal email, the target’s work and corporation characteristics are utilized, which means the\n\nform and content of each email is always different.\n\n###### 04 Execution\n\nRemote commands are executed through remote control malicious code and pipes are created between\n\ndomain systems for carrying out of commands. The SMB port is used to run commands on other systems\n\njoined in the AD and the malicious codes are registered as a service. WMI, powershell, etc. are used to run\n\ncommands on the remote device.\n\n###### 05 Persistence\n\nIn order to keep the remote control malicious code persistent on infected systems, services and registry\n\nregistration are executed through Autorun. AD DC is taken over to distribute group policies so that all systems\n\njoined on the AD can be infected simultaneously.\n\n###### 06 Command and Control\n\nThe attackers use Ammyy RAT and Amadey Bot malicious code to execute various remote commands from\n\nan external C2 server and download additional malicious files. After taking over the base server, the SMB\n\nfeature is used to run additional commands on other systems and download/execute malicious code.\n\n###### 07 Privilege Escalation\n\nUser/administrator domain account information is stolen to connect to other systems connected via AD. For\n\npassword protection of shared folders during ransomware attacks, remote desktop session information is\n\nsometimes stolen as well.\n\n\n2.\n\nOverview\n\n\n-----\n\nThe attacker uses AD server administrator account information gathered through password dump programs for\n\ninternal transfers, or uses accounts additionally created.\n\n###### 09 Defense Evasion\n\nMalicious code with a signed certificate or encryption is used to avoid detection from security programs, and\n\nmsiexec is used to run the malicious code. After the attack is over, the malicious code, event logs, etc. are deleted.\n\n###### 10 Discovery\n\nOn initial infiltration, domain information is collected and a file directory search or network sharing exploration is\n\nused to detect the structure of the internal network. Internal transfer is used to collect and leak information of the\n\ninfected system, and process or service information is also sometimes collected for ransomware infections.\n\n###### 11 Lateral Movement\n\nAttackers use the acquired AD accounts to attempt RDP access on other systems, and the Windows\n\nfilesharing protocol feature (SMB) is usually used to spread malicious code and cause additional infections.\n\nPowershell is used to run remote commands on other systems and download/run additional malicious code\n\nfrom the attacker’s external server, or the sharing folder of the base server is used to collect malicious code\n\nand the Windows administrator sharing feature is used to copy the malicious code and execute them to other\n\nsystems.\n\n###### 12 Collection\n\nThe attacker gains AD administrator rights after the initial infiltration and repeats internal transfers until the\n\nserver is dominated. Commercial tools such as Ping castle, powerkatz, etc. are used to collect information on\n\nprocesses, networks, accounts, etc. Remote control malicious code is then used to collect information about the\n\ntarget systems and the information is encoded in a self-implemented XOR before being leaked.\n\n###### 13 Exfiltration\n\nThe data extracted from an infected system's memory is saved as a single file and leaked to the attacker's C2\n\nserver. Email and account info collected from infected systems in the reconnaissance stage have been leaked\n\nto attacker C2 servers as well.\n\n###### 14 Impact\n\nThe services and processes that are running are shut down to avoid detection prior to ransomware distribution.\n\nAfterwards, AD administrator rights are used to distribute ransomware through AD DC policy distribution or SMB\n\nprotocols are used to register services for ransomware infections.\n\n\n2.\n\nOverview\n\n\n-----\n\n2.\n\n\n2.\n\nOverview\n\n\nResource Development Resource Development Reconnaissance\n① ② ①\n\nDefesne Evasion\n②\n\nIni�al Access\n①②\n\nExecu�on Defense Evasion\n①② ⑤\n\nCommnad and Control\n①②③④ Execu�on\n\n③④⑤\n\nDiscovoery\n③\n\nPersistence Creden�al Access\n①②③ ①②\n\nPrivilege Escala�onDefense Evasion\n①② ①③④\n\nExecu�on\n\nLateral Movement\n\n⑥\n\n①②③\n\nExecu�on\n③④⑤⑦⑧\n\nCollec�on\n①②\n\nDefense Evasion Persistence Privilege Escala�on Creden�al Access\n①③④ ①②③ ①② ①②\n\nLateral Movement Lateral Movement\n\nExfiltra�on ①②③ ①②③\n①\n\nExecu�on\n\nLateral Movement ③④⑤⑦⑧\n④\n\nPrivilege Escala�on\n\nCollec�on Exfiltra�on ③④\n①② ① Collec�on Defense Evasion\n\n①②\n\n⑥\n\nExfiltra�on Lateral Movement Privilege Escala�on\n① ①②③ ⑤⑥\n\nCollec�on Discovery Impact\n①② ①②④⑤⑥⑦ ①\n\nImpact\n\n- \u0007Clicking each number navigates to the\n\n②\n\nrelevant details page.\n\n\n2.\n\nOverview\n\n\n①②\n\nDefense Evasion\n\n\nCollec�on\n\n\nCollec�on\n\n\nCreden�al Access\n\n\nCreden�al Access\n\n\nExecu�on\n\n\nPersistence\n\n\nPersistence\n④\n\n\nImpact\n\n\nCollec�on\n\n\nCollec�on\n\n\nExecu�on\n\n\nFigure 2-1 Attack summary diagram\n\n\n①②\n\nDefense Evasion\n\n\n-----\n\n3.\n\n\n#### 3. ATT&CK Matrix\n\n###### Reconnaissance\n\n\u0007Gather Victim Identity\n\n###### Resource\n\nInformation\n\n###### Development\n\n\u0007Obtain Capabilities\n\n\u0007Develop Capabilities\n\n\u0007Compromise Infrastructure\n\n###### Persistence\n\n\u0007Create Account\n\n###### Privilege Escalation\n\n\u0007Create or Modify System\nProcess\n\nValid Accounts\n\n\u0007Boot or Logon Autostart\nExecution \u0007Abuse Elevation Control\n\nMechanism\n\n\u0007Boot or Logon\nInitialization Scripts \u0007Account Token\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\nATT & CK\nMatrix\n\n\n###### Discovery\n\n\u0007Software Discovery\n\n\u0007Process Discovery\n\n\u0007Account Discovery\n\n\u0007File and Directory\nDiscovery\n\n\u0007Network Share\nDiscovery\n\n\u0007System Information\nDiscovery\n\n\u0007System Owner/User\nDiscovery\n\n###### Impact\n\n\u0007Service Stop\n\n\u0007Data Encrypted for\nImpact\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\nATT & CK\nMatrix\n\n\nOutlook Email authentication information\n\n(account, profile)\n\nemail information\n\nThunderBird\n\nHacker Server\n\nFile Signature\n\n\n###### A\n\n\n-----\n\n3.\n\n\nATT & CK\nMatrix\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\n######  Develop Capabilities – Malware: Malicious code creation\n\nIn order to spread internally through SMB, attackers use a malicious tool that is presumably self-developed.\n\nMalicious tools that use SMB\n\nTraces of malicious tool use (Malicious code logs)\n\n10.123.170.231 : Payload direct copy FAILED (67), SM opened, Payload reverse copy FAILED (1073)\n\n10.123.184.91 : Payload direct copy FAILED (112), SM opened, Payload reverse copy FAILED (1073)\n\n10.201.10.145 : Payload direct copy FAILED (1326), SM open FAILED (5)\n\n10.123.170.229 : Payload direct copy FAILED (67), SM opened, Payload reverse copy FAILED (1073)\n\n...\n\n10.201.10.83 : Payload direct-copied, SM opened, Service created, Service started, Service removed, Payload removed\n\n10.201.10.84 : Payload direct-copied, SM opened, Service created, Service started, Service removed, Payload removed\n\n######  Compromise Infrastructure – Server: Server resource acquisition\n\n\nATT & CK\nMatrix\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\nATT & CK\nMatrix\n\n\n###### C\n\n\n-----\n\n3.\n\n\nATT & CK\nMatrix\n\n\nATT & CK\nMatrix\n\n\nmalicious code\ndistribution server\n\n\nmalicious code\n\n\n###### D\n\n\n-----\n\n3.\n\n\nATT & CK\nMatrix\n\n\n.lnk\n\ndisguising as\n\n\n######  User Execution – Malicious link: Malicious link click\n\n\nATT & CK\nMatrix\n\n\nmalicious code\n\n\n-----\n\n3.\n\n\n######  Command and Scripting Interpreter – Windows Commnad Shell: Using windows commands\n\n|Account creation|net user [account name] [password] /add|\n|---|---|\n|Account privilege setting|net localgroup administrators [account name] /add|\n|Process stopping|taskkill /IM [process name]|\n|Service stopping|net stop [service name]|\n|Service creation|sc create [malicious service name] binpath= [malicious code path]|\n|Service execution|sc start [malicious service name]|\n|Service removal|sc delete [malicious service name]|\n|Domain account check|net user /domain|\n|Delete event log|for /F \\ “tokens=*\\” %1 in (‘wevtutil.exe el’) DO wevtutil.exe cl \\“%1\\”|\n|Creation of schedule|schtasks.exe /CREATE /XML C:\\Programdata\\[malicious schedule file name].xml /tn [malicious schedule name]|\n|Schedule execution|schtasks.exe /RUN /tn [malicious schedule name]|\n|Schedule stopping|schtasks.exe /END /tn [malicious schedule name]|\n|Schedule deletion|schtasks.exe /DELETE /tn [malicious schedule name] /F|\n|Process checking|tasklist|\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\n######  Command and Scripting Interpreter – Powershell: Using windows Powershell\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n|83|EC|Col3|\n|---|---|---|\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\n######  System Services – Service Execution: Service execution\n\n\nATT & CK\nMatrix\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\n######  Inter-Process Communication: Communication between malicious processes\n\n\nATT & CK\nMatrix\n\n\n###### external Process\n\n\nstatus_dd21\n\n\nstatus_2d19\n\n\n-----\n\n3.\n\n|List of pipes used|Hacking tool|\n|---|---|\n|status_887 status_776 status_34513 status_a63b status_2d19 status_dd21|CobaltStrike|\n|svcctl samr lsarpc|PsExec|\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\n######  Scheduled Task – Scheduled Task/Job: Execution via task scheduler\n\n|Creation of schedule|schtasks.exe /CREATE /XML C:\\Programdata\\[malicious schedule file name].xml /tn [malicious schedule name]|\n|---|---|\n|Schedule execution|schtasks.exe /RUN /tn [malicious schedule name]|\n|Schedule stopping|schtasks.exe /END /tn [malicious schedule name]|\n|Schedule deletion|schtasks.exe /DELETE /tn [malicious schedule name] /F|\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\n######  Windows Management Instrumentation: Windows management tool\n\n\nATT & CK\nMatrix\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n|Account creation|%COMSPEC% /C echo net user [계정명] [패스워드] /add ^> %SYSTEMDRIVE%\\ WINDOWS\\Temp\\[random_16].txt > \\WINDOWS\\Temp\\[random_16].bat & %COMSPEC% /C start %COMSPEC% /C \\WINDOWS\\Temp\\[random_16].bat|\n|---|---|\n|Account privilege setting|%COMSPEC% /C echo net localgroup administrators [계정명] /add ^> %SYSTEMDRIVE%\\ WINDOWS\\Temp\\[random_16].txt > \\WINDOWS\\Temp\\[random_16].bat & %COMSPEC% /C start %COMSPEC% /C \\WINDOWS\\Temp\\[random_16].bat|\n\n\nATT & CK\nMatrix\n\n\n###### E\n\n\n-----\n\n3.\n\n\n######  Create or Modify System Process – \u0007Windows Sevice: Maintaining persistence through  service installation\n\nFor malicious code that requires persistence maintenance, service start type is set to auto start.\n\nRansomware malicious code auto start\n\n######  \u0007Boot or Logon Autostart Execution- \u0007Registry Run Keys / Startup Folder: Autostart registration in registry and start folder\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\n######  Boot or Logon Initialization Scripts: Network Logon Script: Autostart via group policy\n\n\nATT & CK\nMatrix\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\n###### F\n\n\n-----\n\n3.\n\n\n######  Account Token Manipulation – \u0007Token Impersonation/Theft: Impersonation or theft of  other tokens\n\n\nATT & CK\nMatrix\n\n\nATT & CK\nMatrix\n\n\n###### username\n\n\n-----\n\n3.\n\n\n######  Account Token Manipulation – \u0007Create Process with Token: Creation of processes with high- privilege tokens\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\n######  Domain Policy Modification – Group Policy Modification: Group policy modification\n\n  Boot or Logon Initialization Scripts – Network Logon Script: Autostart via group policy\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\nATT & CK\nMatrix\n\n\n###### G\n\n\n-----\n\n3.\n\n\n######  Create Account: Account creation\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n|Type|Malicious code name|\n|---|---|\n|Normal program disguise|C:\\ProgramData\\Adobe\\wsus.dll C:\\ProgramData\\Adobe\\Setup\\wsus.exe C:\\Intel\\localserv.exe C:\\Intel\\logon.exe C:\\Intel\\wsus.exe C:\\hp\\sysinfo.exe C:\\hp\\slog.exe C:\\hp\\AdFind.exe C:\\hp\\sage.exe C:\\hp\\wsus.exe|\n|Windows software disguise|C:\\ProgramData\\Microsofts HeIp\\wsus.exe C:\\ProgramData\\Microsofts Help\\wsus.exe C:\\Windows\\localserv.exe C:\\Windows\\tasks\\wsusrv.exe|\n|Service name|IntelProtected|\n\n\nATT & CK\nMatrix\n\n\n###### H\n\n\n-----\n\n3.\n\n\n######  Indicator Removal on Host – File Deletion: File deletion\n\n\u0007When being infected by a malicious code, if the same malicious code is installed, the previous copy is deleted.\n\nA file deletion script is used to erase traces.\n\nInfected\nsystem\n\nInstallation\n\nNew Existing Malware\nMalicious Code\n\nDeletion\n\nFile deletion script\n\ndel “C:\\hp\\slog.exe” if exist “C:\\hp\\slog.exe” goto R del “ex.bat”\n\n######  Indicator Removal on Host – Clear Windows Event Logs: Event log deletion\n\n\nATT & CK\nMatrix\n\n\nNew\n\n\nExisting Malware\n\n\n-----\n\n3.\n\n\n######  Signed Binary Proxy Execution – Msiexec: Malicious code installation through msiexec\n\n\nATT & CK\nMatrix\n\n\nMalicious code distribution site\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\n######  Deobfuscate/Decode Files for information: File/information deobfuscation and decoding\n\n\nATT & CK\nMatrix\n\n\nFind Resource (Resource A)\n\n\nGet (Resource A)\n\n\n-----\n\n3.\n\n\nATT & CK\nMatrix\n\n\nsubt idx\n\nindex ++\n# { OX564\n\n\nATT & CK\nMatrix\n\n\n###### Base\n\nindex\n\n\n-----\n\n3.\n\n|QHActivesDEFENSE.exe|QHSAFETRAY.exe|QHWATCHDOG.exe|CMDAGENT.exe|\n|---|---|---|---|\n|CIS.exe|V3LIGHT.exe|V3MAIN.exe|V3SP.exe|\n|SPIDERAGENT.exe|DWENGINE.exe|DWARKDAEMON.exe|dbsnmp.exe|\n|steam.exe|PNTMON.exe|dbeng50.exe|Powerpnt.exe|\n|firefoxonfig.exe|mspub.exe|mysqld-opt.exe|isqlplussv.exe|\n|onenote.exe|oautoupds.exe|||\n\n|McAfeeEngineService|Symantec System Recovery|SepMasterService|tmlisten|\n|---|---|---|---|\n|NetMsmqActivator|MsExchangeMGMT|BackupExecDeviceMedia Service|ShMonitor|\n|VeeamRESTSvc|BackupExecVSSProvider|MsDtsServer|VeeamDeploySvc|\n|SQLAgent$PROD|Sophos Message Router|McShield|BackupExecJobEngine|\n|swi_filter|Sophos AutoUpdate Service|Sophos MCS Agent|MsDtsServer100|\n|IMAP4Svc|SQLSERVERAGENT|SQLsafe Filter Service|Antivirus|\n|DCAgent|SQLAgent$BACKUPExec|MSSQLSERVER|Zoolz 2 Service|\n|mfevtp|SQLAgent$VEEAMMSQL 2008R2|SQLTELEMETRY$ECWDB2|MSSQL$SHAREPOINT|\n|AcronisAgent|Sophos File Scanner Service|ReportServer$TPS|MSSQLFDLauncher$TPS|\n|MSSQL$TPS|UI0Detect|POP3Svc||\n\n|alert|alsvc.|archiv|armsvc|boanet|busine|cisvc.|clean.|cmd.|ex conhos|\n|---|---|---|---|---|---|---|---|---|---|\n|csrss.|dwm.ex|iastor|iexplo|inetin|java.e|Imigua|lms.ex|logm|ei lsass.|\n|lsm.ex|ndagen|node.e|nssm.e|ppsgne|pxcont|python|ramain|safe|st savadm|\n|savser|sdcser|search|servic|shell.|smss.e|snarec|sntpse|soph|os spools|\n|sqlbro|sqlwri|sspser|svchos|swc_se|swi_se|syslog|tasken|taskh|o timesr|\n|uns.ex|update|winini|winlog|winvnc|wmiprv|xsauth|dllhos|exce|l. explor|\n|mmc.ex|csrs.e|clamsc|regsvr|mobsyn|rundll|runonc|winwor|syste|m notepa|\n|taskmg||||||||||\n\n\nATT & CK\nMatrix\n\n\n###### I\n\n\n-----\n\n3.\n\n\n######  Account Discovery – Domain Account: Domain account discovery\n\nIn order to check for an AD environment, the malicious code uses the command “net user /domain.”\n\nThe result of the command determines whether to continue the infection.\n\n결과에 WORKGROUP 이란\n단어 포함시\n\n결과에 WORKGROUP이란\n\n단어 불포함시\n\n######  File and Directory Discovery: File/directory discovery\n\n  Network Share Discovery: Network sharing discovery\n\n|Col1|Excluded folder names|Col3|\n|---|---|---|\n|Chrome|All Users|Mozilla|\n|ProgramData|Recycle.bin|AhnLab|\n|Microsoft|Program files (x86)|Program Files|\n|Windows|BOOTMGR|RECOVERY|\n|SOPHOS|TOR BROWSER|SYSTEM VOLUME INFORMATION|\n|PERFLOGS|WINNT|APPDATA|\n\n|ClopReadMe.txt|AUTOEXEC.bat|ntldr|\n|---|---|---|\n|autoexec.bat|boot.ini|NTDETECT.COM|\n|netuser.ini|DESKTOP|desktop.ini|\n|autorun.inf|iconcache.db|bootsect.bak|\n|ntuser.dat.log|thumbs.db|ntuser.dat|\n\n|.dll|.exe|.sys|\n|---|---|---|\n|.Clop|.OCX|.lnk|\n|.Cl0p .MSI|.ICO .CHM|.INI .HLF|\n|.LNG .BAT|.TTF|.CMD|\n\n\nATT & CK\nMatrix\n\n\nIn order to check for an AD environment, the malicious code uses the command “net user /domain.”\n\nThe result of the command determines whether to continue the infection.\n\n결과에 WORKGROUP 이란\n단어 포함시 Malicious code\n\nshutdown\n\nmalicious code\n\n결과에 WORKGROUP이란단어 불포함시 operation\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n|Value name|Description|\n|---|---|\n|id|Unique ID value|\n|os|System OS information|\n|priv|Malicious code execution privileges UAC|\n|cred|User path|\n|pcname|System name|\n|avname|Vaccine information|\n|build_time|Malicious code execution time|\n|card|NFC information|\n\n|Armenian|Kazakh|Tajik|\n|---|---|---|\n|Azerbaijani|Kyrgyz|Turkmen|\n|Belarusian|Russian|Ukrainian|\n|Georgian|Swahili|Uzbek|\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\nATT & CK\nMatrix\n\n\n###### J\n\n\n-----\n\n3.\n\n\n######  Remote Services – Remote Desktop Protocol: Remote desktop connection protocol\n\nThe acquired AD account is used to attempt a remote desktop connection.\n\nRDP attack RDP attack\n\nAccount\nacquisition target system target system\n\nRDP attack RDP attack\n\ninfiltration\n\ntarget system success\n\nRDP attack\n\nRDP attack\n\nAccount\nacquisition\n\ntarget system target system\n\n######  Remote Services – Windows Remote Management: Windows remote management\n\n\nATT & CK\nMatrix\n\n\nBase\n\n1. Execute Powershell\n\n\nexternal server\n\nC2\n\n2. Malicious code\n\n\nserver 2\n\n\ntarget system\n\n\ntarget system\n\n\ninfiltration\nsuccess\n\ntarget system\n\n\n-----\n\n3.\n\n\nATT & CK\nMatrix\n\n\n######  Lateral Tool Transfer: Lateral tool transfer\n\n\nATT & CK\nMatrix\n\n\nBase server\n\nShared folder\n\naccount theft malicious\ncode / tunneling malicious\ncode / information theft\nmalicious code\n\n\n-----\n\n3.\n\n|pingcastle.exe|AD environment network information collection and weakness information discovery|\n|---|---|\n|powerkatz.dll|AD environment network information collection and weakness information discovery|\n|Process information collection tool procexp64.exe||\n\n\nATT & CK\nMatrix\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n|Value name|Description|\n|---|---|\n|id|Unique ID value|\n|os|System OS information|\n|priv|Malicious code execution privileges + UAC activation status|\n|pred|User path|\n|pcname|System name|\n|avname|Vaccine information|\n|build_time|Malicious code execution time|\n|card|NFC information|\n\n\nATT & CK\nMatrix\n\n\n######  Archive Collected Data – \u0007Archive via Custom Method: Data compression through user implemented\nencryption algorithms\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\nATT & CK\nMatrix\n\n\nDAT\n\n\nDAT\n\n###### rj_log.dat\n\n\n###### L\n\n\n-----\n\n3.\n\n|Service stopping|net stop [service name] /y|\n|---|---|\n|Process shutdown|taskkill /IM[process name] /F|\n\n|Type|Name|\n|---|---|\n|Service|McAfeeEngineService, Symantec System Recovery, NetMsmqActivator, MSExchangeMGMT, SepMasterService, tmlisten, BackupExecDeviceMediaService, ShMonitor, VeeamRESTSvc, BackupExecVSSProvider, MsDTsServer, VeeamDepolySvc, SQLAgent$PROD, Sophos Message Router, McShield, BackupExecJobEngine, swi_filter, Sophos AutoUpdate Service, Sophos MCS Agent, MsDtsServer100, IMAP4Svc, SQLSERVERAGENT, SQLsafe Filter Service, Antivirus, DCAgent, SQLAgent$bkupexec, MSSQLSERVER,|\n|Process|dbsnmp.exe, steam.exe, PNTMon.exe, dbeng50.exe, powerpnt.exe, firefoxonfig.exe, mspub.exe, mysqld-opt.exe, isplplussv.exe wordpad.exe, steam.exe, onenote.exe, mysqld.exe, outlook.exe|\n\n\nATT & CK\nMatrix\n\n\n###### M\n\n\n-----\n\n3.\n\n|Ransomware distribution policy script|Ransomware service creation through SMB|\n|---|---|\n|[Startup] 0CmdLine=cmd.exe 0Parameters=/c \"copy /y \\\\Windows\\ SysVol\\[DomainName]\\Policies\\[PolicyGUID]\\ Machine\\Scripts\\Startup\\wsusrv.exe C:\\ WINDOWS\\tasks\\wsusrv.exe && sc create msdtcstefsrv binPath= \"C:\\WINDOWS\\tasks\\ wsusrv.exe\" start= auto && sc start msdtcstefsrv\"|시스템에 서비스가 설치되었습니다. 서비스 이름: WinTempLocal 서비스 파일 이름: C:₩windows₩localserv.exe 서비스 유형: 사용자 모드 서비스 서비스 시작 유형: 자동 시작 서비스 계정: LocalSystem|\n\n\nATT & CK\nMatrix\n\n\n-----\n\n3.\n\n\nATT & CK\nMatrix\n\n\nATT & CK\nMatrix\n\n\n###### N\n\n\n-----\n\n3.\n\n\n######  Protocol Tunneling: protocol tunneling\n\n\nATT & CK\nMatrix\n\n\nATT & CK\nMatrix\n\n\n-----\n\n4.\n\n\n#### 4. Conclusion\n\n###### 【Defender‘s Insight】\n\nThe Korea Internet and Security Agency has taken a look at the types of ransomware infection attacks that\n\noccurred in AD environments. Attackers used spear-phishing infiltration, DC server domination after account\n\ntheft, and SMB internal transfer to infect using ransomware. Such accidents cause major damage including the\n\npayment demanded by the attacker, damage to the corporation’s image, system recovery costs, etc. and an\n\nAD environment being infected leads to the entire system being dominated and additional damage including\n\nleaking of important corporate information.\n\nHacking attempts against corporations will continue to occur, and corporations using AD will continue to be\n\ntargeted. Each corporation has a unique composition, privilege management, security policies, etc. and the\n\ninfiltration method and detailed attack methods could change, but privilege elevation, account theft, SMB internal\n\ntransfer, etc. are commonalities found in most AD incidents.\n\nAs such, corporations using an AD environment must place priority on account management and monitoring.\n\nAn attacker that succeeds in initial infiltration will move with administrator account theft in mind, searching the\n\ninternal network; stealing normal user accounts will not aid in the domination of the internal network. Even if\n\naccounts are stolen, the user and service account privileges must be kept separate so that the AD domain\n\ncontroller server cannot be dominated. The administrator group account use should be minimized, and systems\n\nforced to use an administrator account should be regularly monitored. In the case of AD DC in particular, a great\n\ndeal of attention must be paid to registered services and group policy lists to check for suspicious activity. Major\n\nsystem logs should be regularly backed up, and if account theft tools are detected or pipe communication is\n\nfound, the copy system must be immediately inspected.\n\nKISA has published a detailed tech report on AD environment incidents in early 2019. That report dealt with\n\na single incident and focused on attack techniques, procedures, malicious code analysis, etc. while this report\n\ndeals with various incidents that occurred between 2019 and 2021, listing the attack methods of attackers\n\naccording to an ATT&CK matrix. Even if the attack group attack types change in the future, the attack methods\n\nused against AD environments will not vary greatly.\n\nUnderstanding and ascertaining all the TTP strategies in the previous tech report and the current one will be of\n\ngreat help in application to internal corporate environments, prediction of security threats, and reorganization of\n\nsecurity.\n\n\n4.\n\nConclusion\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.boho.or.kr/filedownload.do?attach_file_seq=2808&attach_file_id=EpF2808.pdf"
    ],
    "report_names": [
        "filedownload.do?attach_file_seq=2808&attach_file_id=EpF2808.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1a76ed30-4daf-4817-98ae-87c667364464",
            "created_at": "2022-10-25T16:47:55.891029Z",
            "updated_at": "2025-03-27T02:05:17.408867Z",
            "deleted_at": null,
            "main_name": "IRON LIBERTY",
            "aliases": [
                "ATK6 ",
                "BROMINE ",
                "CASTLE ",
                "Crouching Yeti ",
                "DYMALLOY ",
                "Dragonfly ",
                "Energetic Bear / Berserk Bear ",
                "Ghost Blizzard ",
                "TEMP.Isotope ",
                "TG-4192 ",
                "ALLANITE "
            ],
            "source_name": "Secureworks:IRON LIBERTY",
            "tools": [
                " Ddex Loader",
                " Havex",
                " Karagany",
                " Loek",
                " MCMD",
                " Sysmain",
                " xfrost",
                "ClientX"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1672538674,
    "ts_updated_at": 1743041463,
    "ts_creation_date": 1624447071,
    "ts_modification_date": 1624447086,
    "files": {
        "pdf": "https://archive.orkl.eu/8b21384f29b822b126bd2a676dce2da8d9fdb330.pdf",
        "text": "https://archive.orkl.eu/8b21384f29b822b126bd2a676dce2da8d9fdb330.txt",
        "img": "https://archive.orkl.eu/8b21384f29b822b126bd2a676dce2da8d9fdb330.jpg"
    }
}