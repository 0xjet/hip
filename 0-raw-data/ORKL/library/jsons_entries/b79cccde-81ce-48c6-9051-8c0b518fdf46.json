{
    "id": "b79cccde-81ce-48c6-9051-8c0b518fdf46",
    "created_at": "2023-01-12T15:08:16.974419Z",
    "updated_at": "2025-03-27T02:05:31.483488Z",
    "deleted_at": null,
    "sha1_hash": "289fbc05c9ed768c0ff46c3fc966d20dadb6f6a8",
    "title": "2017-06-14 - Phantom of the Opaera- New KASPERAGENT Malware Campaign",
    "authors": "",
    "file_creation_date": "2022-05-28T21:54:23Z",
    "file_modification_date": "2022-05-28T21:54:23Z",
    "file_size": 1431555,
    "plain_text": "# Phantom of the Opaera: New KASPERAGENT Malware Campaign\n\n**[threatconnect.com/blog/kasperagent-malware-campaign/](https://www.threatconnect.com/blog/kasperagent-malware-campaign/)**\n\nJune 14, 2017\n\n## KASPERAGENT Malware Campaign resurfaces in the run up to May Palestinian Authority Elections\n\nThreatConnect has identified a KASPERAGENT malware campaign leveraging decoy\nPalestinian Authority documents. The samples date from April – May 2017, coinciding with\nthe run up to the May 2017 Palestinian Authority elections. Although we do not know who is\nbehind the campaign, the decoy documents’ content focuses on timely political issues in\nGaza and the IP address hosting the campaign’s command and control node hosts several\nother domains with Gaza registrants.\n\nIn this blog post we will detail our analysis of the malware and associated indicators, look\nclosely at the decoy files, and leverage available information to make an educated guess on\nthe possible intended target. Associated indicators and screenshots of the decoy documents\n[are all available here in the ThreatConnect platform.](https://app.threatconnect.com/auth/campaign/campaign.xhtml?campaign=4219181)\n\n_Some of the indicators in the following post were published on AlienVault OTX on 6/13._\n\n## Background on KASPERAGENT\n\nKASPERAGENT is Microsoft Windows malware used in efforts targeting users in the United\nStates, Israel, Palestinian Territories, and Egypt since July 2015. The malware was\ndiscovered by Palo Alto Networks Unit 42 and ClearSky Cyber Security, and publicized in\nApril 2017 in the Targeted Attacks in the Middle East Using KASPERAGENT and\nMICROPSIA blog. It is called KASPERAGENT based on PDB strings identified in the\nmalware such as “c:UsersUSADocumentsVisual Studio 2008ProjectsNew folder\n(2)kasperReleasekasper.pdb.”\n\nThe threat actors used shortened URLs in spear phishing messages and fake news websites\nto direct targets to download KASPERAGENT. Upon execution, KASPERAGENT drops the\npayload and a decoy document that displays Arabic names and ID numbers. The malware\nestablishes persistence and sends HTTP requests to the command and control domain\nmailsinfo[.]net. Of note, the callbacks were to PHP scripts that included /dad5/ in the URLs.\nMost samples of the malware reportedly function as a basic reconnaissance tool and\ndownloader. However, some of the recently identified files display “extendedcapability” including the functionality to steal passwords, take screenshots, log keystrokes,\nand steal files. These “extended-capability” samples called out to an additional command\nand control domain stikerscloud[ ]com Additionally early variants of KASPERAGENT used\n\n\n-----\n\nChrome as the user agent, while more recent samples use OPAERA – a possible\nmisspelling of the “Opera” – browser. The indicators associated with the blog article are\n[available in the ThreatConnect Technical Blogs and Reports source here.](https://app.threatconnect.com/auth/incident/incident.xhtml?incident=4003314)\n\n[The samples we identified leverage the same user agent string “OPAERA”, included the](https://app.threatconnect.com/auth/indicators/details/customIndicator.xhtml?id=29927402&owner=Common+Community)\nkasper PDB string reported by Unit 42, and used similar POST and GET requests. The\ncommand and control domains were different, and these samples used unique decoy\ndocuments to target their victims.\n\n## Identifying another KASPERAGENT campaign\n\nWe didn’t start out looking for KASPERAGENT, but a file hit on one of our YARA rules for an\nexecutable designed to display a fake XLS icon – one way adversaries attempt to trick\ntargets into thinking a malicious file is innocuous. The first malicious sample we identified\n[(6843AE9EAC03F69DF301D024BFDEFC88) had the file name “testproj.exe” and was](https://app.threatconnect.com/auth/indicators/details/file.xhtml?file=6843AE9EAC03F69DF301D024BFDEFC88)\n[identified within an archive file (4FE7561F63A71CA73C26CB95B28EAEE8) with the name](https://app.threatconnect.com/auth/indicators/details/file.xhtml?file=4FE7561F63A71CA73C26CB95B28EAEE8)\n“اﻟﺘﻔﺎﺻﯿﻞ اﻟﻜﺎﻣﻠﺔ ﻷﻏﺘﯿﺎل ﻓﻘﻬﺎء.r24”. This translates to “The Complete Details of Fuqaha’s\n[Assassination”, a reference to Hamas military leader Mazen Fuqaha who was assassinated](https://www.nytimes.com/2017/03/27/world/middleeast/mazen-fuqaha-hamas-killing-israel.html)\non March 24, 2017.\n\n[We detonated the file in VxStream’s automated malware analysis capability and found](https://www.hybrid-analysis.com/sample/16df435ea8214cb0a62ab40720d8d0f5b65ba9268c84fc9e1180d2468a966f72)\ntestproj.exe dropped a benign Microsoft Word document that pulls a jpg file from\n[treestower[.]com. Malwr.com observed this site in association with another sample](https://app.threatconnect.com/auth/indicators/details/host.xhtml?host=www.treestower.com&owner=Common+Community)\nthat called out to mailsinfo[.]net – a host identified in the Targeted Attacks in the Middle East\nUsing KASPERAGENT and MICROPSIA blog. That was our first hint that we were looking at\nKASPERAGENT.\n\nThe jpg pulled from treestower[.]com displays a graphic picture of a dead man, which also\nappeared on a Palestinian news website discussing the death of Hamas military leader\nMazen Fuqaha. A separate malicious executable –\n[2DE25306A58D8A5B6CBE8D5E2FC5F3C5 (vlc.exe) – runs when the photograph is](https://www.hybrid-analysis.com/sample/5d329690a606857871f007b990b78f876c57a571b38cafd54f3d98c9b3b42453?environmentId=100)\ndisplayed, using the YouTube icon and calling out to several URLs on\n[windowsnewupdates[.]com. This host was registered in late March and appears to be unique](https://app.threatconnect.com/auth/indicators/details/host.xhtml?host=windowsnewupdates.com&owner=Common+Community)\nto this campaign.\n\nWith our interest piqued, we pivoted on the import hashes (also known as an imphash),\nwhich captures the import table of a given file. Shared import hashes across multiple files\nwould likely identify files that are part of the same malware family. We found nine additional\nsamples sharing the imphash values for the two executables,\n[C66F88D2D76D79210D568D7AD7896B45 and](https://app.threatconnect.com/auth/browse/index.xhtml?filters=typeName%20in%20(%22Address%22%2C%20%22EmailAddress%22%2C%20%22File%22%2C%20%22Host%22%2C%20%22URL%22%2C%20%22ASN%22%2C%20%22CIDR%22%2C%20%22Mutex%22%2C%20%22Registry%20Key%22%2C%20%22User%20Agent%22)%20and%20attribute1785%20%3D%20c66f88d2d76d79210d568d7ad7896b45) [DCF3AA484253068D8833C7C5B019B07.](https://app.threatconnect.com/auth/browse/index.xhtml?filters=typeName%20in%20(%22Address%22%2C%20%22EmailAddress%22%2C%20%22File%22%2C%20%22Host%22%2C%20%22URL%22%2C%20%22ASN%22%2C%20%22CIDR%22%2C%20%22Mutex%22%2C%20%22Registry%20Key%22%2C%20%22User%20Agent%22)%20and%20attribute1785%20%3D%20dcf3aa484253068d8833c7c5b019b07a)\n\n\n-----\n\n_Import Hash Results c66f88d2d76d79210d568d7ad7896b45_\n\n_Import Hash Results dcf3aa484253068d8833c7c5b019b07a_\n\nAnalysis of those files uncovered two more imphashes,\n[0B4E44256788783634A2B1DADF4F9784 and](https://app.threatconnect.com/auth/browse/index.xhtml?filters=typeName%20in%20(%22Address%22%2C%20%22EmailAddress%22%2C%20%22File%22%2C%20%22Host%22%2C%20%22URL%22%2C%20%22ASN%22%2C%20%22CIDR%22%2C%20%22Mutex%22%2C%20%22Registry%20Key%22%2C%20%22User%20Agent%22)%20and%20attribute1785%20%3D%200b4e44256788783634a2b1dadf4f9784)\n[E44F0BD2ADFB9CBCABCAD314D27ACCFC, for a total of 20 malicious files. These](https://app.threatconnect.com/auth/browse/index.xhtml?filters=typeName%20in%20(%22Address%22%2C%20%22EmailAddress%22%2C%20%22File%22%2C%20%22Host%22%2C%20%22URL%22%2C%20%22ASN%22%2C%20%22CIDR%22%2C%20%22Mutex%22%2C%20%22Registry%20Key%22%2C%20%22User%20Agent%22)%20and%20attribute1785%20%3D%20e44f0bd2adfb9cbcabcad314d27accfc)\nadditional samples behaved similarly to the initial files; testproj.exe dropped benign decoy\nfiles and started malicious executables. The malicious executables all called out to the same\nURLs on windowsnewupdates[.]com.\n\nThese malware samples leverage the user agent string “OPAERA,” the same one identified\nin the [Targeted Attacks in the Middle East Using KASPERAGENT and MICROPSIA blog.](http://researchcenter.paloaltonetworks.com/2017/04/unit42-targeted-attacks-middle-east-using-kasperagent-micropsia/)\nAlthough the command and control domain was different from those in the report, the POST\n\n\n-----\n\nand GET requests were similar and included /dad5/ in the URL string. In addition, the\nmalware samples included the kasper PDB string reported by Unit 42, prompting us to\nconclude that we were likely looking at new variants of KASPERAGENT.\n\n## The Decoy Files\n\nSeveral of the decoy files appeared to be official documents associated with the Palestinian\nAuthority – the body that governs the Palestinian Territories in the Middle East. We do not\nknow whether the files are legitimate Palestinian Authority documents, but they are designed\nto look official. Additionally, most of the decoy files are publicly available on news websites or\nsocial media.\n\nThe first document – dated April 10, 2017 – is marked “Very Secret” and addressed to Yahya\nAl-Sinwar, who Hamas elected as its leader in Gaza in February 2017. Like the photo\ndisplayed in the first decoy file we found, this document references the death of Mazen\nFuqaha. The Arabic-language text and English translation of the document are available in\n[ThreatConnect here. A screenshot of the file is depicted below.](https://app.threatconnect.com/auth/document/document.xhtml?document=4219292)\n\n\n-----\n\nThe second legible file, dated April 23, has the same letterhead and also is addressed to\n[Yahya al-Sinwar. This file discusses the supposed announcement banning the rival Fatah](https://en.wikipedia.org/wiki/Fatah)\npolitical party, which controls the West Bank, from Gaza. It mentions closing the Fatah\nheadquarters and houses that were identified as meeting places as well as the arrest of\nsome members of the party.\n\n\n-----\n\n## Looking at the Infrastructure\n\nWe don’t know for sure who is responsible for this campaign, but digging into the passive\n[DNS results led us to some breadcrumbs. Starting with 195.154.110[.]237, the IP address](https://app.threatconnect.com/auth/indicators/details/address.xhtml?address=195.154.110.237&owner=Common+Community)\nwhich is hosting the command and control domain windowsnewupdates[.]com, we found that\nthe host is on a dedicated server.\n\n\n-----\n\n_ThreatConnect DomainTools Integration Results_\n\nUsing our Farsight DNSDB integration, we identified other domains currently and previously\nhosted on the same IP.\n\n_Reverse DNS and Passive DNS results for 195.154.110[.]237_\n\n\n-----\n\nTwo of the four domains that have been hosted at this IP since 2016 — upfile2box[.]com and\n7aga[.]net — were registered by a freelance web developer in Gaza, Palestine. This IP has\nbeen used to host a small number of domains, some of which were registered by the same\nactor, suggesting the IP is dedicated for a single individual or group’s use. While not\nconclusive, it is intriguing that the same IP was observed hosting a domain ostensibly\nregistered in Gaza AND the command and control domain associated with a series of\ntargeted attacks leveraging Palestinian Authority-themed decoy documents referencing\nGaza.\n\n## Targeting Focus?\n\nJust like we can’t make a definitive determination as to who conducted this campaign, we do\nnot know for sure who it was intended to target. What we do know is that several of the\nmalicious files were submitted to a public malware analysis site from the Palestinian\nTerritories. This tells us that it is possible either the threat actors or at least one of the targets\nis located in that area. Additionally, as previously mentioned, the decoy document subject\nmatter would likely be of interest to a few different potential targets in the Palestinian\nTerritories. Potential targets such as Hamas who controls the Gaza strip and counts Mazen\nFuqaha and Yahya al-Sinwar as members, Israel which is accused of involvement in the\nassassination of Mazen Fuqaha, and the Fatah party of which the Prime Minister and\nPresident of the Palestinian Authority are members.\n\nThe campaign corresponds with a period of heightened tension in Gaza. Hamas, who has\nhistorically maintained control over the strip, elected Yahya al-Sinwar – a hardliner from its\nmilitary wing – as its leader in February. A [Humanitarian Bulletin published by the United](https://unispal.un.org/DPA/DPR/unispal.nsf/0/AC8C02B3FA96AA208525811C00554B0D)\nNations’ Office for the Coordination of Humanitarian Affairs indicates in March 2017 (just\nbefore the first malware samples associated with this campaign were identified in early April)\nHamas created “a parallel institution to run local ministries in Gaza,” further straining the\nrelationship between Hamas and the Palestinian Authority who governs the West Bank. After\nthis announcement, the Palestinian Authority cut salaries for its employees in Gaza by 30\npercent and informed Israel that it would no longer pay for electricity provided to Gaza\ncausing blackouts throughout the area and escalating tensions between the rival groups.\nThen, in early May (two days after the last malware sample was submitted) the Palestinian\n[Authority held local elections in the West Bank which were reportedly seen as a test for the](http://abcnews.go.com/International/wireStory/palestinian-west-bank-local-elections-test-fatah-party-47389952)\nFatah party. Elections were not held in Gaza.\n\nAll of that is to say, the decoy documents leveraged in this campaign would likely be relevant\nand of interest to a variety of targets in Israel and Palestine, consistent with previously\nidentified KASPERAGENT targeting patterns. Additionally, the use of what appear to be\ncarefully crafted documents at the very least designed to look like official government\ncorrespondence suggests the malware may have been intended for a government employee\nor contractor who would be interested in the documents’ subject matter. More associated\n\n\n-----\n\nindicators, screenshots of many of the decoy documents, and descriptions of the activity are\navailable via the March – May 2017 Kasperagent Malware Leveraging\nWindowsNewUpdates[.]com Campaign in ThreatConnect.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-06-14 - Phantom of the Opaera- New KASPERAGENT Malware Campaign.pdf"
    ],
    "report_names": [
        "2017-06-14 - Phantom of the Opaera- New KASPERAGENT Malware Campaign.pdf"
    ],
    "threat_actors": [
        {
            "id": "04b07437-41bb-4126-bcbb-def16f19d7c6",
            "created_at": "2022-10-25T16:07:24.232628Z",
            "updated_at": "2025-03-27T02:02:10.146043Z",
            "deleted_at": null,
            "main_name": "Stone Panda",
            "aliases": [
                "APT 10",
                "ATK 41",
                "Bronze Riverside",
                "CTG-5938",
                "CVNX",
                "Cuckoo Spear",
                "Earth Kasha",
                "Granite Taurus",
                "Happyyongzi",
                "Hogfish",
                "ITG01",
                "Operation A41APT",
                "Operation Cache Panda",
                "Operation ChessMaster",
                "Operation Cloud Hopper",
                "Operation Cuckoo Spear",
                "Operation New Battle",
                "Operation Soft Cell",
                "Operation TradeSecret",
                "Potassium",
                "Red Apollo",
                "Stone Panda",
                "TA429",
                "menuPass",
                "menuPass Team"
            ],
            "source_name": "ETDA:Stone Panda",
            "tools": [
                "Agent.dhwf",
                "Agentemis",
                "Anel",
                "AngryRebel",
                "BKDR_EVILOGE",
                "BKDR_HGDER",
                "BKDR_NVICM",
                "BUGJUICE",
                "CHINACHOPPER",
                "ChChes",
                "China Chopper",
                "Chymine",
                "CinaRAT",
                "Cobalt Strike",
                "CobaltStrike",
                "DARKTOWN",
                "DESLoader",
                "DILLJUICE",
                "DILLWEED",
                "Darkmoon",
                "DelfsCake",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "Ecipekac",
                "Emdivi",
                "EvilGrab",
                "EvilGrab RAT",
                "FYAnti",
                "Farfli",
                "Gen:Trojan.Heur.PT",
                "Gh0st RAT",
                "Ghost RAT",
                "GreetCake",
                "HAYMAKER",
                "HEAVYHAND",
                "HEAVYPOT",
                "HTran",
                "HUC Packet Transmit Tool",
                "Ham Backdoor",
                "HiddenFace",
                "Impacket",
                "Invoke the Hash",
                "KABOB",
                "Kaba",
                "Korplug",
                "LODEINFO",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "MiS-Type",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "NBTscan",
                "NOOPDOOR",
                "Newsripper",
                "P8RAT",
                "PCRat",
                "PlugX",
                "Poison Ivy",
                "Poldat",
                "PowerSploit",
                "PowerView",
                "PsExec",
                "PsList",
                "Quarks PwDump",
                "Quasar RAT",
                "QuasarRAT",
                "RedDelta",
                "RedLeaves",
                "Rubeus",
                "SNUGRIDE",
                "SPIVY",
                "SharpSploit",
                "SigLoader",
                "SinoChopper",
                "SodaMaster",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Trochilus RAT",
                "UpperCut",
                "Vidgrab",
                "WinRAR",
                "WmiExec",
                "Wmonder",
                "Xamtrav",
                "Yggdrasil",
                "Zlib",
                "certutil",
                "certutil.exe",
                "cobeacon",
                "dfls",
                "lena",
                "nbtscan",
                "pivy",
                "poisonivy",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536096,
    "ts_updated_at": 1743041131,
    "ts_creation_date": 1653774863,
    "ts_modification_date": 1653774863,
    "files": {
        "pdf": "https://archive.orkl.eu/289fbc05c9ed768c0ff46c3fc966d20dadb6f6a8.pdf",
        "text": "https://archive.orkl.eu/289fbc05c9ed768c0ff46c3fc966d20dadb6f6a8.txt",
        "img": "https://archive.orkl.eu/289fbc05c9ed768c0ff46c3fc966d20dadb6f6a8.jpg"
    }
}