{
    "id": "139b53ac-ac55-4d8e-be2a-a74dbaa63dd9",
    "created_at": "2023-01-12T15:06:31.571819Z",
    "updated_at": "2025-03-27T02:05:34.862767Z",
    "deleted_at": null,
    "sha1_hash": "c6ac65b2f23da7040346ee517f1557c1042297f0",
    "title": "2015-11-02 - Modular trojan for hidden access to a computer",
    "authors": "",
    "file_creation_date": "2022-05-28T21:52:16Z",
    "file_modification_date": "2022-05-28T21:52:16Z",
    "file_size": 1505302,
    "plain_text": "# Модульный троян для скрытого доступа к компьютеру\n\n**[cys-centrum.com/ru/news/module_trojan_for_unauthorized_access](https://cys-centrum.com/ru/news/module_trojan_for_unauthorized_access)**\n\n## Как показывает практика, получить скрытый удаленный доступ к вашему компьютеру, заполучить пароли, записать видео или звук уже не является тяжело решаемой задачей. И в принципе, кроме персональной осведомленности в вопросах информационной безопасности, иного действенного средства не придумаешь. В данной статье предлагаем ознакомиться с базовым анализом многомодульной троянской программы и немного сблизиться с актуальными в нынешнее время техниками и средствами, используемыми злоумышленниками.\n\nСовсем недавно мы наткнулись на два интересных образца вредоносных программ.\nНаряду с тем, что вредоносы распространялись в виде документов MS Word с\nэксплойтом «на борту», их структура предполагала модульность, а степень выявления\nантивирусными продуктами была невысока в связи с достаточно высоким уровнем\nобфускации [1] за счет многоразового шифрования. Мы решили взяться за изучение\nэтого malware, а результат изложить в этой статье.\n\n\n-----\n\nТак выглядели два файла, попавшие в наше поле зрения:\n\n**Reported for TRMSCD3L Licence expired.doc**\n**Police report remit expired Licence.doc**\n\nОчень часто, исходя из названия, можно дедуктивно догадаться, «кем» и кому\nпредназначен тот или иной вредоносный файл (к примеру: «Договор.doc», «Рахунок на\nоплату.doc» – для бухгалтеров, «Приказ НБУ №159.doc» – банкам, «Списки захопл. в\nзоні АТО.doc» – военным, и т.д.). В нашем случае мы можем только догадываться, так\nкак:\n\n- слово «Licence» – написано с ошибкой;\n\n- слова «Licence expired» и «expired Licence» говорят о том, что тематика может\nкасаться срока действия какой-то лицензии;\n\n- строка «TRMSCD3L», если поискать в Google, вообще ассоциируется со SWIFT CODE\nбанка TRUST MERCHANT BANK SARL, находящегося в Демократической республике\nКонго (г. Лубумбаши).\n\nВ общем, в данном случае понять трудно. Видимо, атакующий очень хорошо знал\nжертву, так как при именовании вредоносных файлов указал целый набор едва\nсвязных посылов.\n\nКак правило, изучение вредоносных программ осуществляется с помощью\nдинамического (если возможно) и статического анализа. В статье опишем результаты\nизучения файла «Reported for TRMSCD3L Licence expired.doc».\n\n**Базовый динамический анализ**\n\nПри открытии файла с помощью MS Word происходит эксплуатация уязвимости (если\nВы на своем ПК не обновляли MS Word с 2012 года) и на компьютере создается файл c\nпроизвольным именем:\n```\nPath:    C:\\Users\\%USERNAME%\\AppData\\Local\\Microsoft\\Windows\\\nFileName:  yoymbgp.exe \nMd5:     11b6a2ea17d18c09cc274731f05e89b5\n\n```\nПомимо этого, с целью обеспечения выживаемости, файл добавляется в автозагрузку\n(рис. 1), для чего в реестр вносятся соответствующие изменения (имя значения также\nявляется произвольным):\n```\nRegKey Data:     C:\\Users\\%USERNAME% \\AppData\\Local\\Microsoft\\Windows\\\nyoymbgp.exe\nRegKey Data Type:   REG_SZ\nRegKey Value Name:   atk17n5rAA\nRegKey Name:     HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\n\n```\n\n-----\n\nРис. 1\n\nХоть это и примитивно, но мы советуем посматривать в автозагрузку вашего ПК и не\nдопускать присутствия там неведомых вам программ. Чтобы проверить автозагрузку\nможно воспользоваться как штатным функционалом вашей операционной системы (в\nкомандной строке: regedit, msconfig), так и сторонним программным обеспечением.\n\nНа следующем этапе вредоносная программа запускает легитимные процессы\nsvchost.exe и внедряет в них вредоносный код, с целью его последующей\nрасшифровки. Эта процедура повторяется несколько раз (вначале статьи мы\nупоминали о многоразовом шифровании). Также, на этом этапе осуществляется\nвзаимодействие между зараженным компьютером и сервером управления, откуда\nвредонос скачивает модули. Пример такого сетевого взаимодействия:\n```\nHTTP GET-запросы:\nhxxp:// 95.211.204.14:80/m/228131.zip\nhxxp:// 95.211.204.14:80/m/721118.zip\nhxxp:// 95.211.204.14:80/m/958232.zip\nhxxp:// 95.211.204.14:80/m/855787.zip\nhxxp:// 95.211.204.14:80/m/5594516.zip\nHTTP POST-запросы:\nhxxp://95.211.204.14:443/$rdgate?ACTION=HELLO\nhxxp://95.211.204.14:443/$rdgate?ACTION=START&ID=877A74B0199241848C931A962ADC55EB\nhxxp://95.211.204.14:80/test.php\nhxxp://95.211.204.14:80/f9S52tseWPcDGvbEY+EbYJ4RhUnZm=AUM9a6oYAcOAV1yFsXJvsCWAbvctbESC\n\n```\n**Статический анализ**\n\n\n-----\n\nДанный образец вредоносной программы был изрядно запакован – прежде чем\nприступить к его детальному изучению нам пришлось снять три «слоя» обфускации:\n```\n[binary_layer1.exe][6197736aec27686efb6f63e75cac0a6d]\n[binary_layer2.exe][6c7441ec1b630fd299d8196367aefeea]\n[binary_layer3.exe][9347cb20a1ec90c61e1ff8ded379fc81]\n\n```\nПоследующее изучение проводилось в отношении распакованного образца\n«binary_layer3.exe». При запуске вредоносной программы первым делом она\nосуществляет проверку на предмет наличия на зараженном ПК необходимых модулей\n(«check_payload_plugin»), и, при отсутствии, инициирует их скачивание с сети Интернет.\nСпециально для скачивания создается отдельный поток по адресу 0x00419A60 (мы его\nназвали «create_thread_3»).\n\nРис. 2\n\nУсловием выполнение потока 2 («create_thread_2») является наличие в реестре\nскачанных и записанных в реестр модулей вредоносной программы (рис. 3-4):\n```\nRagKey Name:    HKCU\\Software\\Google\\Update\\network\\secure\n\n```\n\n-----\n\nРис. 3\n\nРис. 4\n\nПример состояния реестра после скачивания необходимых модулей приведен на рис.\n5. Все скачанные модули хранятся в реестре в зашифрованном виде. Имена ключей в\nреестре также являются произвольными.\n\nРис. 5\n\nНекоторые артефакты сетевого взаимодействия зараженного ПК и сервера управления\n(IP-адрес сервера управления, а также URL, используемый для отправки HTTPзапроса):\n\n\n-----\n\nРис. 6\n\nРассмотрим более детально последовательность действий, выполняемых потоком 2,\nтак как именно он играет ключевую роль в расшифровке вредоносных модулей.\nПотоком 2 последовательно осуществляется составление списка модулей (рис. 7),\nрасшифровка и проверка их имен (рис. 8). Ключ для расшифровки каждого модуля\nуникален и является изменяемым значением (рис. 9).\n\nРис. 7\n\n\n-----\n\nРис. 8\n\nРис. 9\n\nПосле успешной расшифровки данных, записанных под непонятными именами в\nреестр, получаем читаемый и говорящий сам за себя список модулей.\n\n**Bot_Engine.bin**\n**PONY_STEALER.bin**\n**REMOTE_DESKTOP_SERVICE.bin**\n**SECURITY.bin**\n**VNC_HIDE_DESKTOP.bin**\n\nАлгоритм расшифровки модулей может быть описан таким псевдокодом:\n\n_Переменные:_\n```\nenc_byte   зашифрованный байт \ndec_byte   расшифрованный байт \nHIBYTE     извлекает старший байт из данного 16-разрядного значения\nLOBYTE     извлекает младший байт из данного 16-разрядного значения\nHIWORD     извлекает старшое слово из данного 32-разрядного значения\nLOWORD     извлекает младшее слово из данного 32-разрядного значения\n_DWORD     двойное слово (4 байта)\n_WORD      слово (2 байта)\nkey     ключ, состоящий из 6 байт\nsize     размер зашифрованного массива\n\n```\n_Псевдокод:_\n\n\n-----\n\n```\nv0 : (_DWORD ) key;  \nv1 := *(_WORD*) (key + 4);  \nfor (i := 0; i < size; i++) \n{        \n  dec_byte := enc_byte ^ HIBYTE(v1);  \n  v1 := HIWORD(v0) + LOWORD(v0) * (uint8)(LOBYTE(v1) + dec_byte);\n  ++enc_byte;  \n  ++dec_byte;   \n  --size;  \n}\n\n```\nРассмотрим полученные модули по порядку.\n\n**Bot_Engine.bin**\nЭтот модуль должен быть запущен под названием svchost.exe или explorer.exe, иначе\nон заблаговременно закончит свое исполнение. Пример проверки имени процесса\nпредставлен на рис. 10.\n\nРис. 10-1\n\nРис. 10-2\n\nОсновным предназначением модуля является запуск других модулей. Пример\nсоздания потоков для других модулей отображен на рис. 11.\n\n\n-----\n\nРис. 11\n\n**PONY_STEALER.bin**\nЭтот модуль представляет собою не что иное, как одноименную вредоносную\nпрограмму Pony, функционал которой предусматривает хищение логинов, паролей,\nкошельков криптовалют. На момент исследования административная панель сервера\nуправления Pony находилась по адресу:\nhttp://95.211.204.14/test.php\n\n**REMOTE_DESKTOP_SERVICE.bin**\nМодуль, обеспечивающий скрытый удаленный доступ к компьютеру жертвы\nпосредством протокола RDP и создания обратного соединения (back-connect).\nАдрес для обратного соединения:\n95.211.204.14:443\n\n**SECURITY.bin**\nДанный модуль обеспечивал проверку фактов присутствия на компьютере\nантивирусного программного обеспечения и других, обеспечивающих безопасность\nкомпьютера, программ (рис. 12).\n\n\n-----\n\nРис. 12\n\n**VNC_HIDE_DESKTOP.bin**\nМодуль, обеспечивающий скрытый удаленный доступ к компьютеру жертвы\nпосредством протокола VNC и создания обратного соединения (back-connect).\nАдрес для обратного соединения:\n95.211.204.14:8098\n\nВместо заключения.\n\nДанная статья создавалась с целью демонстрации, на примере актуальных атак,\nвозможностей, тактик и техник заинтересованных лиц по получению скрытого доступа к\nкомпьютеру исследуемого объекта, а также для повышения уровня всеобщей\nосведомленности в вопросах информационной безопасности.\n\nРассмотренная в статье атака была зафиксирована в первой декаде октября, исходя\nиз чего, мы допускаем, что актуальность приведенных индикаторов компрометации (IPадреса, в частности) может быть под вопросом.\n\nСледует отметить, что согласно данным Passive DNS (грубо говоря – истории\nсоответствия доменных имен и IP-адресов) в первом квартале 2014 года IP-адрес\n95.211.204.14 соответствовал доменному имени severodvinsk-bux.ru, которое\nпринадлежит веб-сайту, специализирующемуся на рекламе. Это может означать\nровным счетом ничего (так как прошло больше года, да и сайт сей меняет «айпишники»\nкак перчатки), но, для полноты картины, мы добавили эту частичку информации.\n\n**Отдел реагирования на инциденты CyS Centrum**\n\nИспользованные материалы:\n\n[1] https://ru.wikipedia.org/wiki/Обфускация\n\n\n-----\n\n© ООО \"САЙБЕР СЕКЬЮРИТИ ЦЕНТРУМ\", 2015 - 2021\n\nСоздано компанией [CyS Centrum](https://cys-centrum.com/)\n\n\n-----",
    "language": "RU",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-11-02 - Modular trojan for hidden access to a computer.pdf"
    ],
    "report_names": [
        "2015-11-02 - Modular trojan for hidden access to a computer.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535991,
    "ts_updated_at": 1743041134,
    "ts_creation_date": 1653774736,
    "ts_modification_date": 1653774736,
    "files": {
        "pdf": "https://archive.orkl.eu/c6ac65b2f23da7040346ee517f1557c1042297f0.pdf",
        "text": "https://archive.orkl.eu/c6ac65b2f23da7040346ee517f1557c1042297f0.txt",
        "img": "https://archive.orkl.eu/c6ac65b2f23da7040346ee517f1557c1042297f0.jpg"
    }
}