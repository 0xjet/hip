{
    "id": "2bed5bb4-1168-4852-a57a-06a534f14f70",
    "created_at": "2023-01-12T15:04:57.151696Z",
    "updated_at": "2025-03-27T02:14:34.204592Z",
    "deleted_at": null,
    "sha1_hash": "2459c114e173fddaf8aee07fb6a2f117cee2f299",
    "title": "2021-01-23 - Yet Another Bazar Loader DGA",
    "authors": "",
    "file_creation_date": "2022-05-27T21:08:48Z",
    "file_modification_date": "2022-05-27T21:08:48Z",
    "file_size": 9093300,
    "plain_text": "# Yet Another Bazar Loader DGA\n\n**johannesbader.ch/blog/yet-another-bazarloader-dga/**\n\nBazar Loader decided to change its perfectly fine domain generation algorithm (DGA) once\nagain. The change in the algorithm is very minor, but it yields more domain names.\n\n## Sample\n\nI looked at this sample:\n\n**MD5**\n9ad20d0e6da3cf135a93bf162a0a8cfb\n\n**SHA1**\na97893ab95f794cabc261483423f942f552926d0\n\n**SHA256**\n8e244f1a5b4653d6dbb4cc3978c7dd773b227a443361fbc30265b79f102f7eed\n\n**Size**\n288 KB (295616 Bytes)\n\n\n-----\n\n**Compile Timestamp**\n2021-01-20 19:37:37 UTC\n\n**Links**\n[MalwareBazaar,](https://bazaar.abuse.ch/sample/8e244f1a5b4653d6dbb4cc3978c7dd773b227a443361fbc30265b79f102f7eed/) [Malpedia,](https://malpedia.caad.fkie.fraunhofer.de/details/win.bazarbackdoor) [Dropping_sha256,](https://johannesbader.ch/blog/yet-another-bazarloader-dga/c0a087a520fdfb5f1e235618b3a5101969c1de85b498bc4670372c02756efd55) [Cape,](https://www.capesandbox.com/analysis/113625/) [VirusTotal](https://www.virustotal.com/gui/file/8e244f1a5b4653d6dbb4cc3978c7dd773b227a443361fbc30265b79f102f7eed)\n\n**Filenames**\nPreview_report20-01.exe (VirusTotal)\n\n**Detections**\n**MalwareBazaar: BazaLoader, Virustotal: 33/76 as of 2021-01-23 07:31:37 -**\nTrojan.Win32.Zenpak.4!c (AegisLab), Backdoor:Win32/KZip.90c5e0b2 (Alibaba),\nBackDoor.Bazar.55 (DrWeb), Trojan.Win32.Zenpak.bfcu (Kaspersky),\nTrojan:Win64/Bazarldr.BMB!MSR (Microsoft), Trojan.Win32.Zenpak.bfcu (ZoneAlarm)\n\nit unpacks to this\n\n**MD5**\n63784053ac2f608d94c18b17c46ab5d4\n\n**SHA1**\ne01c814d6a4993c74a2bfb87b1b661fe78c41291\n\n**SHA256**\nc0a087a520fdfb5f1e235618b3a5101969c1de85b498bc4670372c02756efd55\n\n**Size**\n98 KB (100864 Bytes)\n\n**Compile Timestamp**\n2021-01-20 19:10:11 UTC\n\n**Links**\n[MalwareBazaar,](https://bazaar.abuse.ch/sample/c0a087a520fdfb5f1e235618b3a5101969c1de85b498bc4670372c02756efd55/) [Malpedia,](https://malpedia.caad.fkie.fraunhofer.de/details/win.bazarbackdoor) [Dropping_sha256,](https://johannesbader.ch/blog/yet-another-bazarloader-dga/8e244f1a5b4653d6dbb4cc3978c7dd773b227a443361fbc30265b79f102f7eed) [Dropping_sha256,](https://johannesbader.ch/blog/yet-another-bazarloader-dga/f29253139dab900b763ef436931213387dc92e860b9d3abb7dcd46040ac28a0e) [Cape,](https://www.capesandbox.com/analysis/113626/) [VirusTotal](https://www.virustotal.com/gui/file/c0a087a520fdfb5f1e235618b3a5101969c1de85b498bc4670372c02756efd55)\n\n**Filenames**\n_none_\n\n**Detections**\n**MalwareBazaar: BazaLoader, Virustotal: 21/75 as of 2021-01-23 13:37:55 -**\nGen:Variant.Bulz.163525 (ALYac), Gen:Variant.Bulz.163525 (Ad-Aware),\nTrojan.Bulz.D27EC5 (Arcabit), Gen:Variant.Bulz.163525 (BitDefender),\nGen:Variant.Bulz.163525 (B) (Emsisoft), Gen:Variant.Bulz.163525 (GData),\nGen:Variant.Bulz.163525 (MicroWorld-eScan), Trojan:Win32/TrickBot.VSF!MTB (Microsoft),\nTrojan.TrickBot!8.E313 (TFE:5:6iToUtBEDBC) (Rising)\n\nwhich finally drops\n\n**MD5**\n7e8eddaef14aa8de2369d1ca6347b06d\n\n\n-----\n\n**SHA1**\n4543e6da0515bb7d93e930c9f30e40912d495373\n\n**SHA256**\nf29253139dab900b763ef436931213387dc92e860b9d3abb7dcd46040ac28a0e\n\n**Size**\n89 KB (91136 Bytes)\n\n**Compile Timestamp**\n2021-01-18 14:29:29 UTC\n\n**Links**\n[MalwareBazaar,](https://bazaar.abuse.ch/sample/f29253139dab900b763ef436931213387dc92e860b9d3abb7dcd46040ac28a0e/) [Malpedia,](https://malpedia.caad.fkie.fraunhofer.de/details/win.bazarbackdoor) [Dropped_by_sha256,](https://johannesbader.ch/blog/yet-another-bazarloader-dga/c0a087a520fdfb5f1e235618b3a5101969c1de85b498bc4670372c02756efd55) [Cape,](https://www.capesandbox.com/analysis/113627/) [VirusTotal](https://www.virustotal.com/gui/file/f29253139dab900b763ef436931213387dc92e860b9d3abb7dcd46040ac28a0e)\n\n**Filenames**\n_none_\n\n**Detections**\n**MalwareBazaar: None, Virustotal: 19/76 as of 2021-01-23 15:04:35 -**\nGen:Variant.Bulz.163525 (ALYac), Gen:Variant.Bulz.163525 (Ad-Aware),\nTrojan.Win32.Bulz.4!c (AegisLab), Trojan.Bulz.D27EC5 (Arcabit), Gen:Variant.Bulz.163525\n(BitDefender), Gen:Variant.Bulz.163525 (B) (Emsisoft), Gen:Variant.Bulz.163525 (FireEye),\nGen:Variant.Bulz.163525 (GData), Gen:Variant.Bulz.163525 (MicroWorld-eScan)\n\n## Difference from the Last Version\n\nThe current version is just a slight modification to the version from December. Like the\nprevious version of the algorithm, this version calculates all ordered pairs of 19 consonants\nand 6 vowels (including y ). These pairs are then permuted based on a fixed value. This\nvalue is the same, so the resulting list of 228 pairs is also the same.\n\nThe calculation of the first four letters is the same – that is, the selection of the first two pairs\nof letters: The permuted list of letters is divided into groups of 19 pairs. Then the two digits of\nthe current month determine which group is selected. From these, one pair at a time is\nrandomly – and unpredictably – selected.\n\n\n-----\n\nThe last four letters (two pairs) are still determined by the two year digits. However, the\ndivision of letter pairs into groups is different. Based on the current decade, two letters are\nchosen from a group of 22 pairs. The groups of 22 pairs partly overlap, so that theoretically\nafter every 10 years identical domains could be generated again. This in contrast to the\nversion from December, where the decade still determined a non-overlapping group of 6\npairs only. The last two letters are picked from groups of 4 — instead of 6 — letter pairs.\n\nThe DGA still generates 10'000 domains. But because there are 88 potential monthly\ncombinations for the last for letters instead of just 36 previously, the excepted number of\nunique domains is larger:\n\n$$ \\mathbb{E} = 31768 \\left( 1 - \\left(\\frac{31768 -1}{31768 }\\right)^{10000} \\right) \\approx\n8579 $$\n\nSince domain names partially repeat after each decade, domains can no longer be uniquely\nassigned to a seed. But since I strongly doubt that the domain generation algorithm will still\n[have any relevance in a few months, let alone 10 years, the domain to seed tool assumes](https://bin.re/projects/bazarbackdoor/)\ndomains are from the 20s.\n\n## IP Transformation\n\nThe A record of the domains is encrypted, just as in previous versions. Meaning, the four\nbytes of the IP are XORed with `0xFE . The IP is then used in URLs of format`\n```\nhttps://{ip}:443 . For example, if the domain omleekyw.bazar has an A record of\n220.39.239.27, then the actual contacted URL is https://34.217.17.229:443 .\n\n```\n\n-----\n\n## Reimplementation in Python\n\nThis is the new version reimplemented in Python\n\n\n-----\n\n```\nfrom itertools import product\nfrom datetime import datetime\nimport argparse\nfrom collections import namedtuple\nParam = namedtuple('Param', 'mul mod idx')\npool = (\n  \"qeewcaacywemomedekwyuhidontoibeludsocuexvuuftyliaqydhuizuctuiqow\"\n  \"agypetehfubitiaziceblaogolryykosuptaymodisahfiybyxcoleafkudarapu\"\n  \"qoawyluxqagenanyoxcygyqugiutlyvegahepovyigqyqibaeqynyfkiobpeepby\"\n  \"xaciyvusocaripfyoftesaysozureginalifkazaadytwuubzuvoothymivazyyz\"\n  \"hoevmeburedeviihiravygkemywaerdonoyryqloammoseweesuvfopiriboikuz\"\n  \"orruzemuulimyhceukoqiwfexuefgoycwiokitnuneroxepyanbekyixxiuqsias\"\n  \"xoapaxmaohezwoildifaluzihipanizoecxyopguakdudyovhaumunuwsusyenko\"\n  \"atugabiv\"\n)\ndef dga(date):\n  seed = date.strftime(\"%m%Y\")\n  params = [\n    Param(19, 19, 0),\n    Param(19, 19, 1),\n    Param(4, 22, 4),\n    Param(4, 4, 5)\n  ]\n  ranges = []\n  for p in params:\n    s = int(seed[p.idx])\n    lower = p.mul*s\n    upper = lower + p.mod\n    ranges.append(list(range(lower, upper)))\n  for indices in product(*ranges):\n    domain = \"\"\n    for index in indices:\n      domain += pool[index*2:index*2 + 2]\n    domain += \".bazar\"\n    yield domain\nif __name__ == \"__main__\":\n  parser = argparse.ArgumentParser()\n  parser.add_argument(\n    \"-d\", \"--date\", help=\"date used for seeding, e.g., 2020-06-28\",\n    default=datetime.now().strftime('%Y-%m-%d'))\n  args = parser.parse_args()\n  d = datetime.strptime(args.date, \"%Y-%m-%d\")\n  for domain in dga(d):\n    print(domain)\n\n```\n**Edit 23 March, 2021: There is also a version with a different character pool, but otherwise**\n[same algorithm (see my GitHub repo for the full code).](https://github.com/baderj/domain_generation_algorithms/blob/master/bazarbackdoor/dga_v4.py)\n\n\n-----\n\n```\npool (\n  \"yzewevmeywreomviekwyavygontowaerudsoyr\"\n  \"exvuamtyseweesuvizpituiqowuzoretzemuul\"\n  \"tiazicukoqiwolxuykosupwiymitisneroxeyx\"\n  \"anlekyixxirasiasxoapuxqaohezwooxdigyqu\"\n  \"ziutpavezohexyvyguqyqidyovynumunuwsusy\"\n  \"enxaatyvusivaripfyoftesaysozureginalif\"\n)\n\n## Characteristics\n\n```\nExcept for the number of domains per month, the characteristics are the same as for the\nprevious verion:\n\n**property** **value**\n\ntype TDD (time-dependent-deterministic)\n\ngeneration scheme arithmetic\n\nseed current date\n\ndomain change frequency every month\n\nunique domains per month 19·19·22·4 = 31'768\n\nsequence random selection, might pick domains multiple times\n\nwait time between domains 10 seconds\n\ntop level domain `.bazar`\n\nsecond level characters a-z, without j\n\nregex `[a-ik-z]{8}\\.bazar`\n\nsecond level domain length 8\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-23 - Yet Another Bazar Loader DGA.pdf"
    ],
    "report_names": [
        "2021-01-23 - Yet Another Bazar Loader DGA.pdf"
    ],
    "threat_actors": [
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535897,
    "ts_updated_at": 1743041674,
    "ts_creation_date": 1653685728,
    "ts_modification_date": 1653685728,
    "files": {
        "pdf": "https://archive.orkl.eu/2459c114e173fddaf8aee07fb6a2f117cee2f299.pdf",
        "text": "https://archive.orkl.eu/2459c114e173fddaf8aee07fb6a2f117cee2f299.txt",
        "img": "https://archive.orkl.eu/2459c114e173fddaf8aee07fb6a2f117cee2f299.jpg"
    }
}