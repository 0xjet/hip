{
    "id": "75bcebd6-e87d-40d8-a4e2-4c693c054c8a",
    "created_at": "2022-10-25T16:48:19.634736Z",
    "updated_at": "2025-03-27T02:11:04.06845Z",
    "deleted_at": null,
    "sha1_hash": "5689d93fa60e88759d1b0d9a23674a43caf87717",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-02-24T15:07:31Z",
    "file_modification_date": "2020-02-24T15:07:31Z",
    "file_size": 1537282,
    "plain_text": "Cloud Snooper - SophosLabs Page 0 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\n# Cloud Snooper attack bypasses firewall security measures\n\n## An investigation of an attack in progress on a cloud computing server reveals an unusual and innovative way for malware to communicate through firewalls\n\n#### Sergei Shevchenko\n\nCloud Snooper - SophosLabs Page 1 of 29\n\n\nCloud Snooper - SophosLabs\n\n\n-----\n\nCloud Snooper - SophosLabs\n\n### Contents\n\nRootkit in the Cloud ................................................................................................................................... 3\n\nAnomalous traffic raises alerts ............................................................................................................. 3\n\nDismantling the Cloud Snooper tools ................................................................................................. 3\n\nThe Cloud Snooper communications handler ....................................................................................... 5\n\nHow Cloud Snooper communicates through the firewall ................................................................. 5\n\nPractical examples of communication with the Snooper ............................................................. 6\n\nExplaining the attack: Wolves in sheep's clothing ............................................................................ 9\n\nTechnical analysis of Cloud Snooper network operations ........................................................ 11\n\nSample #3 ......................................................................................................................................... 13\n\nLogging .................................................................................................................................................. 15\n\nSome additional details on unused/broken 'rootkit' functionality .............................................. 16\n\nBuilding a Client ....................................................................................................................................... 17\n\nAnother variant of the rootkit .............................................................................................................. 18\n\nSample #4 ......................................................................................................................................... 18\n\nSample #5 ......................................................................................................................................... 19\n\nSample #6 ......................................................................................................................................... 19\n\nSample #7 ......................................................................................................................................... 20\n\nSample #8 ......................................................................................................................................... 21\n\nSample #9 ......................................................................................................................................... 22\n\nWindows Malware ................................................................................................................................ 23\n\nSample #10 ....................................................................................................................................... 23\n\nSample #11 - encrypted payload ................................................................................................... 23\n\nConclusion................................................................................................................................................. 28\n\nIOCs ....................................................................................................................................................... 28\n\nCloud Snooper - SophosLabs Page 2 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\n### Rootkit in the Cloud\n\nIn the course of investigating a malware infection of cloud infrastructure servers hosted in the Amazon\nWeb Services (AWS) cloud, SophosLabs discovered a sophisticated attack that employed a unique\ncombination of techniques to evade detection and that permits the malware to communicate freely\nwith its command and control (C2) servers through a firewall that should, under normal circumstances,\nprevent precisely that kind of communication from reaching the infected server.\n\nThough we discovered the technique in use on AWS, the problem is not an AWS problem per se. It\nrepresents a method of piggybacking C2 traffic on a legitimate traffic, such as normal web traffic, in a\nway that can bypass many, if not most, firewalls.\n\nThe complexity of the attack and the use of a bespoke APT (Advanced Persistent Threat) toolset gives us\nreason to believe that the malware and its operators were an advanced threat actor, possibly nationstate sponsored.\n\nThe compromised systems were running both Linux and Windows EC2 instances.\n\n##### Anomalous traffic raises alerts\n\nAs often happens with incidents like this, our investigation started when someone noticed an anomaly.\nWhile the AWS Security Groups (SGs) were properly tuned, set up to only allow inbound HTTP or HTTPS\ntraffic, the compromised Linux system was still listening for inbound connections on ports 2080/TCP and\n2053/TCP.\n\nAn analysis of this system revealed the presence of a kernel-level rootkit that granted the malware's\noperators the ability to remotely control the server through the AWS SGs. But this rootkit's capabilities\nare not limited to doing this in the Amazon cloud. It could also be used to communicate with, and\nremotely control, malware on any server behind any boundary firewall – even an on-premises server.\n\nBy unwinding other elements of this attack, we further identified other Linux hosts infected with the\nsame or a similar rootkit.\n\nFinally, we identified a compromised Windows system with a backdoor that communicated with a\nsimilar C2 as other compromised Linux hosts, using a very similar configuration format. The backdoor is\napparently based on source code of the infamous Gh0st RAT malware.\n\nAt this point in the investigation, we still have some open questions. For example, it is still unclear how\nthe attackers managed to compromise the client's system in the first place. One of the working theories\nis that the attackers broke into a server through SSH protected with password authentication.\n\n##### Dismantling the Cloud Snooper tools\n\nAs you will see from the description below, some samples we collected are directly related to each\nother, while others belong to a completely different malware family. Nevertheless, all these samples\nwere collected from the same infrastructure, and thus, we consider them part of the same toolset.\n\nEven though some questions remain, we believe it's important to share all the evidence we have\ncollected with the security community, network administrators, and researchers to raise awareness of\nthis attack.\n\nCloud Snooper - SophosLabs Page 3 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nThe description starts with the Linux malware, then progresses into its Windows counterpart that is\napparently based on Gh0st RAT.\n\nOverall, we discovered and studied 10 samples in the course of the investigation, which can be broken\ndown as:\n\n# MD5 Name File size Platform\n\n_Linux Malware, Group 1_\n\n1 a3f1e4b337ba1ed35cac3fab75cec369 `snd_floppy` 738,368 ELF64, x86\n64\n\n2 6a1d21d3fd074520cb6a1fda76d163da `snd_floppy` 738,368 ELF64, x86\n64\n\n3 c7a3fefb3c231ad3b683f00edd0e26e4 `snoopy` 305,309 ELF64, x86\n64\n\n4 9cd93bb2a12cf4ef49ee1ba5bb0e4a95 `snd_floppy` 544,832 ELF64, x86\n64\n\n5 15e96f0ee3abc9d5d2395c99aabc3b92 `vsftpd` 60,456 ELF64, x8664\n\n6 2b7d54251068a668c4fe8f988bfc3ab5 `ips` 35,580 ELF32, x86\n\n_Linux Malware, Group 2 – Gh0st RAT_\n\n7 ecac141c99e8cef83389203b862b24fd `snort` 64,412 ELF32, x86\n\n8 67c8235ac0861c8622ac2ddb1f5c4a18 `javad` 64,412 ELF32, x86\n\n9 850bf958f07e6c33a496b39be18752f3 `nood.bin` 66,000 ELF32, x86\n\n_Windows Malware – Gh0st RAT_\n\n10 a59c83285679296758bf8589277abde7 `NSIProvider.dll` 219,648 PE32, x86\n\n11 76380fea8fb56d3bb3c329f193883edf `NSIProvider.dll.crt` 516,097 [encrypted]\n\nCloud Snooper - SophosLabs Page 4 of 29\n\n|#|MD5|Name|File size|Platform|\n|---|---|---|---|---|\n|Linux Malware, Group 1|||||\n|1|a3f1e4b337ba1ed35cac3fab75cec369|snd_floppy|738,368|ELF64, x86- 64|\n|2|6a1d21d3fd074520cb6a1fda76d163da|snd_floppy|738,368|ELF64, x86- 64|\n|3|c7a3fefb3c231ad3b683f00edd0e26e4|snoopy|305,309|ELF64, x86- 64|\n|4|9cd93bb2a12cf4ef49ee1ba5bb0e4a95|snd_floppy|544,832|ELF64, x86- 64|\n|5|15e96f0ee3abc9d5d2395c99aabc3b92|vsftpd|60,456|ELF64, x86- 64|\n|6|2b7d54251068a668c4fe8f988bfc3ab5|ips|35,580|ELF32, x86|\n|Linux Malware, Group 2 – Gh0st RAT|||||\n|7|ecac141c99e8cef83389203b862b24fd|snort|64,412|ELF32, x86|\n|8|67c8235ac0861c8622ac2ddb1f5c4a18|javad|64,412|ELF32, x86|\n|9|850bf958f07e6c33a496b39be18752f3|nood.bin|66,000|ELF32, x86|\n|Windows Malware – Gh0st RAT|||||\n|10|a59c83285679296758bf8589277abde7|NSIProvider.dll|219,648|PE32, x86|\n|11|76380fea8fb56d3bb3c329f193883edf|NSIProvider.dll.crt|516,097|[encrypted]|\n\n\n-----\n\nCloud Snooper - SophosLabs\n\n### The Cloud Snooper communications handler\n\nThe central piece of the attack is a file named snd_floppy – a kernel module that sets up a network\npacket filter, using a Netfilter hook (NF_INET_LOCAL_IN and NF_INET_LOCAL_OUT).\n\nThis component was instrumental in giving the malware's operators the ability to communicate with the\nmalware, despite the firewall protecting the AWS EC2 servers.\n\nThe two nearly identical samples of snd_floppy (file snd_floppy.ko) recovered from two different\ncompromised systems are:\n\n**Sample #1**\n\nMD5 a3f1e4b337ba1ed35cac3fab75cec369\n\nSHA1 bdd3930938336cc0b1d979d6d40ab0402a4e8c6d\n\nSHA-256 959796a5b19d61286246ec27e3aef9b8ecc9ea05937da3aa1e98db07df321873\n\nFile size 738,368 bytes\n\nInternal `snd_floppy`\nname\n\n**Sample #2 (almost identical to #1):**\n\nMD5 6a1d21d3fd074520cb6a1fda76d163da\n\nSHA1 d253788241cb52a8c41ff625d423851ba4768545\n\nSHA-256 a7e288462fbd89758a2783908537e851dfcd841f213266b19c0dbad8827b8682\n\nFile size 738,368 bytes\n\nInternal `snd_floppy`\nname\n\n##### How Cloud Snooper communicates through the firewall\n\nThe NF_INET_LOCAL_IN is a type of hook that is triggered before the packet reaches the destination\nport.\n\nThe installed hook handler inspects the socket buffer of every IPv4 packet, looking for a command\nconcealed within a header – the command being the source port number of the packet originating from\nthe attacker's machine.\n\nCloud Snooper - SophosLabs Page 5 of 29\n\n|Sample #1|Col2|\n|---|---|\n|MD5|a3f1e4b337ba1ed35cac3fab75cec369|\n|SHA1|bdd3930938336cc0b1d979d6d40ab0402a4e8c6d|\n|SHA-256|959796a5b19d61286246ec27e3aef9b8ecc9ea05937da3aa1e98db07df321873|\n|File size|738,368 bytes|\n|Internal name|snd_floppy|\n\n|MD5|6a1d21d3fd074520cb6a1fda76d163da|\n|---|---|\n|SHA1|d253788241cb52a8c41ff625d423851ba4768545|\n|SHA-256|a7e288462fbd89758a2783908537e851dfcd841f213266b19c0dbad8827b8682|\n|File size|738,368 bytes|\n|Internal name|snd_floppy|\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nAn analysis of the malware samples reveal that it is looking for packets that use any of the following\nsource ports. Each unique source port represents a command, such as: 1010, 2020, 6060, 7070,\n```\n8080, or 9999. \n\n```\nFirewalls typically prevent machines behind the firewall from receiving traffic sent to arbitrary\n_destination ports, but they don't pay attention to the source ports, because source ports are normally_\nephemeral, and not relevant to the server or the services it is hosting.\n\nIn a typical cloud instance, the server may be set up to receive traffic from any IP address on port\n80/TCP (for HTTP) and on 443/TCP (for HTTPS), so the firewall will let any traffic to those ports through\nto the server. So long as the traffic coming in to one of these standard ports fits the pattern the\ncommunications handler is looking for, it will execute one of its built-in instructions. Anything else will\nbe ignored, and the server will serve web pages as normal to browsers.\n\n**Practical examples of communication with the Snooper**\n\nFor example, if the communications handler receives a TCP SYN packet with an origin port of 6060, the\nmalware will decrypt an embedded file (SHA-256:\nec22c6e3537fcc0003bb73dd42f41ae077b2cb3ad9cdab295bca46dc91eac1e1) that has been encrypted\nwith RC4 (the key is 'YaHo0@').\n\nIt will then drop that decrypted file as /tmp/snoopy, wait for half a second, and then execute it as a\nusermode application with the call_usermodehelper() syscall. Immediately after that, it deletes the\n```\n/tmp/snoopy file, so the snoopy application remains running in memory with no physical file present.\n\n```\nThe commands passed to two consecutive call_usermodehelper() syscalls are:\n\n```\n/bin/sh -c /tmp/snoopy\n\n```\n```\nrm -rf /tmp/snoopy\n\n```\n\nThe commands above will run and then delete the file from the filesystem, but an active snoopy process\nlistening on ports 2053 and 2080 remains:\n\nIf the command is 9999 as a TCP SYN packet, the /tmp/snoopy process self-terminates (in case killall\nis supported by OS), by passing the following commands to call_usermodehelper() syscall.\n\n```\n/bin/sh -c /tmp/snoopy\nrm -rf /tmp/snoopy\nkillall /tmp/snoopy\n\n```\n\nNOTE: executing snoopy again while it's already running has no effect; by using a file lock mechanism,\n```\nsnoopy makes sure only one instance is running. If that happens, it will output:\n\n```\n```\n[ERROR] there is already a instance.\n\n```\n\nCloud Snooper - SophosLabs Page 6 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nHere is the logic of the NF_INET_LOCAL_IN hook handler, which listens for SYN packets sent to the\nserver, using the various source ports:\n\n```\nif tcp:\n\n```\n```\n  if tcp.src_port == 6060:\n    if tcp.flags == SYN:\n       drop_payload()  # drops/runs snoopy\n      return NF_STOP\n  elif tcp.src_port == 7070:\n    tcp.dst_port = 2080\n     adjust_tcp_checksum()\n    return NF_STOP\n  elif tcp.src_port == 9999:\n    if tcp.flags == SYN:\n       kill_payload() # kills snoopy process\n      return NF_STOP\n  elif tcp.src_port == 2020:\n    return NF_STOP\n  elif tcp.src_port == 1010:\n    tcp.dst_port = 22\n     adjust_tcp_checksum()\n    return NF_STOP\n  else:\n    return NF_ACCEPT\nelif udp:\n  if udp.src_port == 8080:\n    udp.dst_port = 2053\n     adjust_udp_checksum()\n    return NF_STOP\nelse:\n  return NF_ACCEPT\n\n```\n\nAnd here is the logic of the NF_INET_LOCAL_OUT hook handler:\n\n```\nif tcp:\n  if tcp.dst_port == 7070:\n    tcp.src_port = 443    # or, 80 in another variant\n\n```\n\nCloud Snooper - SophosLabs Page 7 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\n```\n     adjust_udp_checksum()\n\n```\n```\n    return NF_STOP\n  if tcp.dst_port == 2020:\n    return NF_STOP\n  if tcp.dst_port == 1010:\n    tcp.src_port = 443    # or, 80 in another variant\n     adjust_udp_checksum()\n    return NF_STOP\n  else:\n    return NF_ACCEPT\nelif upd:\n  if udp.dst_port == 8080:\n    udp.src_port = 53\n    return NF_STOP\nelse:\n  return NF_ACCEPT\n\n```\n\nCloud Snooper - SophosLabs Page 8 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\n##### Explaining the attack: Wolves in sheep's clothing\n\nIn the illustration above, our castle represents the targeted server infrastructure; In the case of the incident\nwe investigated, the server was hosted by Amazon Web Services (AWS). At its perimeter, the AWS\nSecurity Groups - a set of firewall rules that provide security at the protocol and port access level – limit\nthe inbound network traffic.\n\nFor example, you might typically set up an AWS Security Group that only allows web traffic – that is,\nTCP packets that arrive at ports 80 or 443 – to reach your server. Network traffic with any other\ndestination port never makes it past the SGs.\n\nThe infection involves a rootkit that inspects network traffic, and a backdoor that the attackers leverage\nthe rootkit to send commands to, and receive data from, the backdoor.\n\nCloud Snooper - SophosLabs Page 9 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nIn order to bypass the AWS Security Groups, depicted here as guards, the attackers communicate with the\nrootkit by sending innocent-looking requests (depicted in the illustration as a wolf in sheep's clothing) to\nthe web server on the normal web server ports. A listener that inspects inbound traffic before it reaches\nthe web server intercepts the specially-crafted requests, and sends instructions to the malware based on\ncharacteristics of those requests.\n\nCloud Snooper - SophosLabs Page 10 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nThe listener sends a \"reconstructed\" C2 command to the backdoor Trojan installed by the rootkit.\nDepending on the commands included into C2 traffic, the attacker may use the backdoor to steal sensitive\ndata from the target.\n\nThe collected data is then delivered back with the C2 traffic. Only this time, the rootkit has to masquerade\nit again in order to bypass the guards: the wolf dresses itself in sheep's clothing once again. Once outside,\nthe C2 traffic delivers the collected data back to the attackers.\n\nDuring an entire operation, the normal web traffic, depicted as sheep, keeps flowing to and from the web\nserver through the allowed gate. Visually, the C2 traffic stays largely indistinguishable from the\nlegitimate web traffic.\n\n**Technical analysis of Cloud Snooper network operations**\n\nTo trigger the payload (snoopy) activation, an attacker would send the following packet:\n\nCloud Snooper - SophosLabs Page 11 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nNext, the snoopy module would be accessed by the C2, using source port 7070 for TCP-based or 8080\nfor UDP-based control:\n\nOn the way back, the NF_INET_LOCAL_OUT hook handler rebuilds the packet again to make sure its\nsource port is restored back to the original port the incoming packet was destined for. This way, the C2\ntraffic transparently flows through the port(s) allowed by the firewall:\n\nNo other Netfilter hooks within the chain, such as iptables INPUT/OUTPUT rules, will process the packet\nif the hook returns NF_STOP. This appears to be the purpose of the TCP command 2020: to bypass other\nNetfilter hooks.\n\nIn instances where the Netfilter receives inbound traffic with a source port of 1010/TCP, it directs the\ncontents to the Secure Shell (SSH) port, 22/TCP. For outbound traffic, we have seen two variants using\neither port 80 or port 443. This will allow for an SSH connection to step around a firewall with IP\nrestrictions on traffic to port 22.\n\nCloud Snooper - SophosLabs Page 12 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nHence, the ultimate purpose of the snd_floppy rootkit is to provide a covert control channel for the\n```\nsnoopy usermode process, running on a compromised host.\n\n```\nSuch covert control channels can be established via any port allowed by firewalls or AWS Security\nGroups, be it 80, 443, 22, or any other port.\n\nFrom the outside, the compromised system will show an unusually large volume of traffic that comes\nfrom the remote ports 6060, 7070, 8080, and 9999.\n\nBut what is the snoopy module? What does it do?\n\n**Sample #3**\n\nMD5 c7a3fefb3c231ad3b683f00edd0e26e4\n\nSHA1 8ba26a4082c80cc216cee89b2033678256f226ef\n\nSHA-256 ec22c6e3537fcc0003bb73dd42f41ae077b2cb3ad9cdab295bca46dc91eac1e1\n\nFile size 305,309 bytes\n\nInternal `snoopy, rrtserver`\nname\n```\nsnoopy is a backdoor trojan that can be executed both as a command line tool and as a daemon (though\n\n```\nit needs to be launched with the -d flag for that). The backdoor's internal version is 3.0.1-2.20170303.\n\nIt opens HTTP and/or DNS services on a compromised system, and allows tunneling of the traffic,\noperating both as a reverse SOCKS5 proxy server, and client.\n\nFor example, the incoming control traffic can also be relayed to a different server.\n\nWhen run with -h option, the tool prints the following syntax:\n\n|Sample #3|Col2|\n|---|---|\n|MD5|c7a3fefb3c231ad3b683f00edd0e26e4|\n|SHA1|8ba26a4082c80cc216cee89b2033678256f226ef|\n|SHA-256|ec22c6e3537fcc0003bb73dd42f41ae077b2cb3ad9cdab295bca46dc91eac1e1|\n|File size|305,309 bytes|\n|Internal name|snoopy, rrtserver|\n\n```\nUsage: rrtserver [OPTIONS]\n\n```\n```\nOPTIONS:\n    -h\n    -d\n    -s IPv4[:PORT:{udp|tcp}:{dns|http|none}]\n\n```\n\nWhere:\n```\n    -h option will print out the usage above\n    -d will run the tool as daemon\n\n```\nCloud Snooper - SophosLabs Page 13 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n```\n    -s allows to specify a server address to bind the listening socket to, its port number, and what\n\n```\nprotocol is used for the traffic: either UDP-based DNS or TCP-based HTTP\n\nThe binary requires root privilege; when run, it calls geteuid() to get the user ID. If it fails, it prints the\nline below and quits:\n\n\n_\"Administrator privileges are required.\"_\n\n\nIt sets the working directory to /tmp and obtains a lock for the file /tmp/rrtserver-lock. The lock file\nis used to make sure there is only one version of the tool running.\n\nThe incoming HTTP traffic is accepted on port 2080, and DNS traffic on port 2053.\n\n**NOTE: the port numbers 2080 and 2053 are default ones; the tool can be executed with different port**\nnumbers specified as parameters.\n\nThe rootkit parses the received DNS/HTTP traffic to extract hidden commands within it - such\ncommands are called \"rrootkit messages\" and are distinguished by the presence of a magic header or\nmarker.\n\nFor example, to find \"rrootkit messages\" in HTTP traffic, Snoopy parses the HTTP request to see if it\nstarts with \"GET /* HTTP/1.1\\r\\ndata:\" or \"HTTP/1.1 200 OK\\r\\ndata:\".\n\nNext, the \"rrootkit messages\" would start from a magic header 0xE381B7F5. If this header is found, such\ndata is called msg-data.\n\nThe received msg-data is then decrypted with RC4, using the quite specific key 'A YARN-based system\n_for parallel processing of large data sets'._\n\nThe tool then initiates several additional components. These components will process the received msg_data._\n\nDepending on a separate magic header within each msg-data, the data will be processed by a different\ncomponent.\n\nThe initiated components are:\n\n  - **view-shell (magic header 0xFC72E392): pty (pseudo terminal) that allows remote shell**\n\n`o` the HISTFILE variable is cleared, to make sure /bin/sh execution leaves no history\n`o` the received commands are then executed with /bin/sh\n\n  - **view-file (magic header 0xFC72E393): file manager that accepts three commands:**\n\n`o` _'get' - read files_\n`o` _'put' - save file_\n`o` any other command - execute file with popen() syscall\n\n  - **view-proxy (magic header 0xFC72E394): proxy server that accepts the following commands:**\n\n`o` _'exit' or 'quit' - quit proxy server_\n`o` _'socks5' - starts SOCKS5 proxy server, authentication is provided with user/password passed with_\n\nthe '-u' and '-p' parameters\n`o` _'rcsocks-cmd: socks is closed.' - closes SOCKS proxy_\n\nThe SOCKS5 server is based on [the open-source sSocks proxy](https://github.com/tostercx/ssocks) implementation:\n\nCloud Snooper - SophosLabs Page 14 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\n\n_sSocks is a package which contains: a socks5 server implements RFC 1928 (SOCKS V5) and_\n_RFC 1929 (Authentication for SOCKS V5), a reverse socks server and client, a netcat like_\n_tool, which supports socks5 with authentication and a socks5 relay (run a server and send_\n_to a another socks5 server)._\n\n\n\n  - **view-pipe (magic header 0xFC72E398): p2p communicator, that receives commands 'pwd', 'exit', 'quit',**\n_'connect'_\n\nOn receiving the 'connect' command, it accepts the same parameters as the command-line tool\n(server IP, port, protocol) and starts tunneling commands to another peer.\n\nThe pipe appears to be used to establish connections to other peers.\n\nThe negotiation protocol to other peers includes a message 'rrootkit-negotiation: hello'.\n\nOnce the connection is established, the logged message displays what peers have been\nconnected, and that a new network node is now open:\n\n_\"view-pipe: left[address, port]->right[address, port].\"_\n\n_\"view-pipe: the network node is opened.\"_\n\n  - **view-myproto (magic header 0xFC72E397): a 'ping'/'pong'; depending on a flag it receives, it either:**\n\n`o` receives a message \"rrootkit-negotiation: hello\", then responds back \"rrootkit-negotiation: ok, go\n\n_on\"_\n`o` checks if the received message was \"rrootkit-negotiation: ok, go on\"\n\n  - **loop-notifier – creates a pipe, a data channel for inter-process communication (IPC)**\nThe backdoor allows control via IPC pipe as a backup control channel.\n\n##### Logging\n```\nsnoopy stores many debug messages in clear text.\n\n```\nHowever, with the internal level of logging set to 0 (none), no debug messages are ever printed. Hence,\nthese debug messages are only used in the testing phase of the malware.\n\nSome of the debug messages are in Chinese:\n\n  - 远程路径太长! - The remote path is too long!\n\n  - 远程文件不存在! - The remote file does not exist!\n\n  - 远程内存空间分配失败! - Remote memory space allocation failed!\n\n  - 远程路径不存在! - The remote path does not exist!\n\n  - 远程文件已存在! - The remote file already exists!\n\n  - 连接失败! - Connection failed!\n\nCloud Snooper - SophosLabs Page 15 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\n  - 连接成功! - Connection succeeded!\n\n  - `参数错误! - Parameter error!`\n\nSome messages reveal poor English grammar:\n\n  - view don't found\n\n  - view-shell: data do not belong to SHELL\n\nIf the rootkit is patched so that it always logs debug messages, it will happily print them on screen:\n\n**Some additional details on unused/broken 'rootkit' functionality**\n\nThe tool has an unused (never called) function kernel_load() to drop and load kernel module from its\nown file. If the module /proc/sys/rrootkit is missing, it drops /tmp/rrtkernel.ko and loads it with:\n```\n    insmod /tmp/rrtkernel.ko 2>/dev/null\n\n```\nNext, /tmp/rrtkernel.ko is unlinked, so it's used, temporarily, to drop and then load a kernel module.\n\nThe function kernel_load() is never called though - there are no references leading to it.\n\nApart from that, /tmp/rrtkernel.ko is written by reading its own binary file, starting from the file\noffset of nearly 2GB:\n\n```\nreadlink(\"/proc/self/exe\", pathname, 0x200uLL);\nmyfd = open(pathname, 0);\nlseek(myfd, g_self_size, SEEK_SET); // file offset is set to offset bytes\n\n```\n\nwhere g_self_size is set to 0x72C9E41D:\n\n```\ng_prev_self_size_mark dd 0EF71B69Ah // unused\ng_self_size      dd 72C9E41Dh  // <-- nearly 2GB\ng_post_self_size_mark dd 33FF0055h  // unused\n\n```\n\nThis code will not work - even if this function was called (it wasn't), it would have failed.\n\nCloud Snooper - SophosLabs Page 16 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nIt would appear the author was tossing around the idea of dropping and loading a kernel module from\nits own file. There are two unused variables 'prev self size mark' and 'post self size mark' which might\nindicate some experiments the author has attempted.\n\nThe original intention is not clear. However, the presence of markers 'prev self size mark' and 'post self\n_size mark' around the file offset variable is intriguing._\n\nThe markers could be used to find the exact location of the offset in the binary:\n\nThis way, an external patcher could find and modify the actual offset from where the kernel module\ncould be read, saved, and loaded. For example, if it's set to the end of the snoopy binary, the kernel\nmodule can thus be read and loaded from the appended data.\n\nHowever, this feature wasn't implemented, and should, therefore, be considered experimental.\n\n### Building a Client\n\nBy knowing how the C2 protocol works, it is possible to build a client to talk to snoopy either directly, or\nvia snd_floppy rootkit.\n\nWhat for?\n\nFirstly, the client can ping a host located in the same network to see if it's infected or not.\n\nSecondly, if a host is infected, the client can disinfect it remotely by instructing snoopy to execute its\ndisinfection routine (see the rmmod command below – after serving it, the rootkit stopped responding as\nit was unloaded).\n\nLast but not least, building such a client is cool.\n\nThe following screenshot demonstrates the client in action. The snd_floppy rootkit intercepts traffic on\nport 22, even though it's destined for the SSH daemon (seen as 981/sshd in the snapshot below). Next,\nit re-routes such traffic internally to the snoopy module.\n\nCloud Snooper - SophosLabs Page 17 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nAs long as the rootkit is active, the attackers may attempt to smuggle the control traffic through any\nport allowed by the firewall (the screenshot demonstrates that using ports 21 and 24 makes no\ndifference – these packets are still re-routed by the rootkit to the backdoor).\n\n##### Another variant of the rootkit\n\nDuring the investigation, a different Linux host was found to be running a different variant of the\n```\nsnd_floppy rootkit.\n\n```\n**Sample #4**\n\nMD5 9cd93bb2a12cf4ef49ee1ba5bb0e4a95\n\nSHA1 b37fdb9d32e90d4be1e0bd187ef64899038c3785\n\nSHA-256 620616d76334204516501c477ae46953bfc9ab8c29e096ae4f76f2e732e69845\n\nFile size 544,832 bytes\n\nInternal `snd_floppy`\nname\n\nThis kernel module is very similar to the variant described above. The embedded resource is encrypted\nwith the same RC4 key.\n\nThe only difference is in the embedded file itself. It is a different file dropped as /bin/vsftpd\n\nCloud Snooper - SophosLabs Page 18 of 29\n\n|Sample #4|Col2|\n|---|---|\n|MD5|9cd93bb2a12cf4ef49ee1ba5bb0e4a95|\n|SHA1|b37fdb9d32e90d4be1e0bd187ef64899038c3785|\n|SHA-256|620616d76334204516501c477ae46953bfc9ab8c29e096ae4f76f2e732e69845|\n|File size|544,832 bytes|\n|Internal name|snd_floppy|\n\n\n-----\n\nCloud Snooper - SophosLabs\n\n**Sample #5**\n\nMD5 15e96f0ee3abc9d5d2395c99aabc3b92\n\nSHA1 8a34cb3d4431985dafe7e2f9843552b56b2a6641\n\nSHA-256 cedb5b81f88afbb5b718c3e66ab25bf945476b8e64b1da0f204d3860a694cce5\n\nFile size 60,456 bytes\n\nInternal `vsftpd`\nname\n```\n/bin/vsftpd in this case is not a well-known FTP server daemon but a backdoor that listens on port\n\n```\n2080.\n\nThe communications are encrypted with a custom algorithm based on AES and an additional XOR round.\nKey initialization is based on hashing the string \"replace with your password\" and a key received from\nthe server, hashed with SHA-1.\n\nThe bot can execute three commands, encoded with integer numbers 1 to 3:\n\n1: download specified file\n\ninternal name: tshd_get_file()\n\n2: upload file and save it under a specified file name\n\ninternal name: tshd_put_file()\n\n3: execute remote shell command with /bin/sh\n\ninternal name: tshd_runshell()\n\nA different version of vsftpd, a backdoor, recovered as a file named ips, was found to be listening on\nport 10443.\n\n**Sample #6**\n\nMD5 2b7d54251068a668c4fe8f988bfc3ab5\n\nSHA1 61f824bd85630b2bcc48defb7b6cb2a963a744c6\n\nSHA-256 1d6fe2f90b4e05625167c8601f07eb33d9eee4623e3338ef264cc6961f5175a0\n\nFile size 35,580 bytes\n\nInternal `ips`\nname\n\nCloud Snooper - SophosLabs Page 19 of 29\n\n|Sample #5|Col2|\n|---|---|\n|MD5|15e96f0ee3abc9d5d2395c99aabc3b92|\n|SHA1|8a34cb3d4431985dafe7e2f9843552b56b2a6641|\n|SHA-256|cedb5b81f88afbb5b718c3e66ab25bf945476b8e64b1da0f204d3860a694cce5|\n|File size|60,456 bytes|\n|Internal name|vsftpd|\n\n|Sample #6|Col2|\n|---|---|\n|MD5|2b7d54251068a668c4fe8f988bfc3ab5|\n|SHA1|61f824bd85630b2bcc48defb7b6cb2a963a744c6|\n|SHA-256|1d6fe2f90b4e05625167c8601f07eb33d9eee4623e3338ef264cc6961f5175a0|\n|File size|35,580 bytes|\n|Internal name|ips|\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nThe presence of ips suggests that another 32-bit version of snd_floppy that redirects incoming traffic\ninto port 10443 may exist.\n\nThe samples #1-#6 described above represent a combination of a rootkit and a passive backdoor that\naccepts connections on an open port.\n\n**Sample #7**\n\nApart from those samples, we have also recovered a different Linux backdoor, a backdoor that does not\nopen any ports. Instead, it relies on a C2 polling mechanism.\n\n[The analysis of this bot functionality reveals it belongs to Gh0st RAT, only it's a version that has been](https://en.wikipedia.org/wiki/Gh0st_RAT)\nwritten for Linux.\n\nIt is hard to tell if Gh0st has always existed as a multi-platform RAT, or whether the attackers developed\n[a Linux-based Gh0st after the source code of Gh0st for Windows was leaked online.](https://github.com/sincoder/gh0st)\n\nAt the end of the day, it makes sense to have clients deployed across various platforms, using a unified\nconfiguration format and C2 protocol, while having a single server for all those clients.\n\nStill, we will leave the guesswork out of this description, rather focusing on what the recovered samples\nactually do.\n\nMD5 ecac141c99e8cef83389203b862b24fd\n\nSHA1 2f4ee1c39f78ecde5a84233233d02b355022aa50\n\nSHA-256 c49371cd8dd33f725a780ea179e6281f5cb7f42e84a00836c8fe3350b7b9b2d0\n\nFile size 64,412 bytes\n\nFile Name `/bin/snort`\n```\n/bin/snort is a backdoor that contacts a remote C2 to fetch and execute commands. Its internal config\n\n```\nfile is encrypted with RC4, using the password: \"r0st@#$\":\n\n|actually do.|Col2|\n|---|---|\n|MD5|ecac141c99e8cef83389203b862b24fd|\n|SHA1|2f4ee1c39f78ecde5a84233233d02b355022aa50|\n|SHA-256|c49371cd8dd33f725a780ea179e6281f5cb7f42e84a00836c8fe3350b7b9b2d0|\n|File size|64,412 bytes|\n|File Name|/bin/snort|\n\n```\n185.86.151.67:443;|1;1;1;1;1;0;0;|10-20;|10\n\n```\n\nThe '1;1;1;1;1;0;0;' part of the config are the flags that stand for seven days of the week.\n\nThe '10-20;' seems to indicate working hours (10 a.m. to 8 p.m.), so current weekday and current hour\nshould match what's in config.\n\nIf there is no match, the bot falls asleep for just over seven minutes (423.756 seconds), then checks the\ntime again.\n\nIn case of a match, it attempts to reach the C2; if it cannot, it retries again in one minute.\n\nCloud Snooper - SophosLabs Page 20 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nTraffic to the C2 is encrypted with double RC4, where a key is randomly generated based on the current\ntime.\n\nThe backdoor has six commands:\n\n  - The bot clears environmental variable HISTFILE to make sure no history is kept for\n```\n   /bin/bash execution; the C2 responds with a string, and the bot sets TERM variable to that\n\n```\nreturned string\n\nNext, it receives a command and executes it with /bin/bash, with or without a '-c' switch\n(allows for executing commands as provided within the quotes)\n\nThe output from the executed command is sent back.\n\n  - File manipulations:\n\n`o` Locate and obtain timestamp for the specified file\n`o` Rename specified file\n`o` Recursively delete all files in the specified directory\n\n  - More file manipulations:\n\n`o` Read the contents of the specified file\n`o` Recursive search for files\n`o` Write data into a specified file\n`o` Create specified directory\n\n  - The next two commands manipulate file descriptors with fcntl() syscall, and fork child processes\n\n  - Receive data and save it into a local file /usr/include/sdfwex.h\n\nIt appears that /usr/include/sdfwex.h contains a timestamp (year, month, day, hour, minutes) for\nwhen the C2 connection should commence.\n\nIf the bot cannot open this file, it tries to open /tmp/.llock – if that file also cannot be opened, the bot\nskips the timestamp check, and proceeds with trying to connect to the C2.\n\n**Sample #8**\n\nA backdoor very similar to /bin/snort was recovered as /usr/bin/javad, described below:\n\nMD5 67c8235ac0861c8622ac2ddb1f5c4a18\n\nSHA1 6aa0b6bfe059354782febd4fa665dbacd726b488\n\nSHA-256 a8db92a8f34caa5084a3fdb8a683a1854bff84612dfd25a965bc12a454a38556\n\nFile size 64,412 bytes\n\nFile Name `/usr/bin/javad`\n\nCloud Snooper - SophosLabs Page 21 of 29\n\n|A backdoor very|y similar to /bin/snort was recovered as /usr/bin/javad, described below:|\n|---|---|\n|MD5|67c8235ac0861c8622ac2ddb1f5c4a18|\n|SHA1|6aa0b6bfe059354782febd4fa665dbacd726b488|\n|SHA-256|a8db92a8f34caa5084a3fdb8a683a1854bff84612dfd25a965bc12a454a38556|\n|File size|64,412 bytes|\n|File Name|/usr/bin/javad|\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nThis backdoor is similar to the sample #7\n(c49371cd8dd33f725a780ea179e6281f5cb7f42e84a00836c8fe3350b7b9b2d0). It uses a different\nconfiguration:\n\n```\ncloud.newsofnp.com:443;|1;1;1;1;1;1;1;|00-24;|1\n\n```\n\nAn analysis of network activity revealed that a similar domain – ssl.newsofnp.com was also resolved\nfrom a Windows host.\n\n**Sample #9**\n\nA backdoor very similar to /bin/snort and /usr/bin/javad:\n\nMD5 850bf958f07e6c33a496b39be18752f3\n\nSHA1 ea579984897dd585af348ecbfc112044a0346ca1\n\nSHA-256 dbd926b097e5a2b142b898fce94fd076b0c6283f0e38a1c6ce01ab87cf41edda\n\nFile size 66,000 bytes\n\nFile Name `nood.bin`\n\nJust like other samples, it decrypts its config file using RC4 key \"r0st@#$\".\n\nThe decrypted config is:\n\n|A backdoor very|y similar to /bin/snort and /usr/bin/javad:|\n|---|---|\n|MD5|850bf958f07e6c33a496b39be18752f3|\n|SHA1|ea579984897dd585af348ecbfc112044a0346ca1|\n|SHA-256|dbd926b097e5a2b142b898fce94fd076b0c6283f0e38a1c6ce01ab87cf41edda|\n|File size|66,000 bytes|\n|File Name|nood.bin|\n\n```\nload.CollegeSmooch.com:82;|1;1;1;1;1;1;1;|00-24;|10\n\n```\n\nJust like /bin/snort and its Windows counterpart NSIProvider.dll, it also checks if the current day\nmatches the configuration file and falls asleep for exactly 423.756 seconds (just over seven minutes)\nbefore it tries again.\n\nFor the beacon signal it sends to the C2, it collects basic system configuration into a fingerprint. This info\nconsists of:\n\n  - Hostname and IP address\n\n  - Platform type, as read from /proc/version, such as 'x86_64'\n\n  - Full name of the Linux version, as read from /etc/issue.net and /etc/issue, such as:\n```\n     'Red Hat Enterprise Linux Server release 6.10 (Santiago)' \n\n```\nor\n```\n     'Ubuntu 16.04.5 LTS' \n\n```\nCloud Snooper - SophosLabs Page 22 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nThe communications with the C2 are always encrypted using a bespoke algorithm that relies on a timebased random RC4 key with extra encryption layers.\n\nThe backdoor commands received from the C2 and executed by nood.bin fully match /bin/snort\nfunctionality. That is, it provides remote shell and a dedicated remote file manipulation capability, such\nas an ability to read, write, rename, delete, or recursively search for files.\n\n##### Windows Malware\n\n**Sample #10**\n\nMD5 a59c83285679296758bf8589277abde7\n\nSHA1 2ff1ff96fe83c607c8b7a4a279b6bc3103de1d33\n\nSHA-256 f7d69c21c683e19624169d3bc70d06b2896a9ccf6186301d16f500db520d3b19\n\nFile size 219,648 bytes\n\nFile Name: `C:\\ProgramData\\NSIProvider\\NSIProvider.dll`\n\n**Sample #11 - encrypted payload**\n\nMD5 76380fea8fb56d3bb3c329f193883edf\n\nSHA1 cd848eb12be9588609ed9e5afad74adfd5c3798a\n\nSHA-256 2bc8fea05b1e9409c3cf065a30aa450ace911d91fdbb55ad282c2925a9aac766\n\nFile size 516,097 bytes\n\nFile Name: `C:\\ProgramData\\NSIProvider\\NSIProvider.dll.crt`\n\nNSIProvider.dll is a malicious Windows service DLL, executed under svchost.exe.\n\nThe service name is NSIProvider, registered with the description name \"Netword Store Interface\nProvider.\"\n\n**NOTE: 'Netword' with 'd'.**\n\nCloud Snooper - SophosLabs Page 23 of 29\n\n|Sample #10|Col2|\n|---|---|\n|MD5|a59c83285679296758bf8589277abde7|\n|SHA1|2ff1ff96fe83c607c8b7a4a279b6bc3103de1d33|\n|SHA-256|f7d69c21c683e19624169d3bc70d06b2896a9ccf6186301d16f500db520d3b19|\n|File size|219,648 bytes|\n|File Name:|C:\\ProgramData\\NSIProvider\\NSIProvider.dll|\n\n|MD5|76380fea8fb56d3bb3c329f193883edf|\n|---|---|\n|SHA1|cd848eb12be9588609ed9e5afad74adfd5c3798a|\n|SHA-256|2bc8fea05b1e9409c3cf065a30aa450ace911d91fdbb55ad282c2925a9aac766|\n|File size|516,097 bytes|\n|File Name:|C:\\ProgramData\\NSIProvider\\NSIProvider.dll.crt|\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nThe DLL is heavily obfuscated.\n\nOnce started as a service, it conveniently spits out debug messages documenting the operation.\n\nSysinternal's DebugView shows these messages:\n\n```\n00000000 0.00000000 [4052] DLL_PROCESS_ATTACH.\n00000001 0.00489140 [4052] Rundll32Entry() \n00000002 0.01733349 [4052] ServerLoadPayload()\n00000003 0.01749189 [4052] Get Module File Name. \n00000004 0.01753826 [4052] Get Payload File Name. \n00000005 0.01757095 [4052] Switch to payload directory. \n00000006 0.01768074 [4052] Read Payload File.\n00000007 0.01811264 [4052] Decrypt Payload Data. \n00000008 0.06122175 [4052] Verify Payload Data.\n00000009 0.06732560 [4052] ServerExecutePayload() \n00000010 0.06740102 [4052] Call Shellcode.\n\n```\n\nOnce loaded, the DLL locates the encrypted payload file and loads it into memory.\n\nThe steps are:\n\n  - Get current module filename with GetModuleFileName() API, i.e.\n```\n   %PATH%\\NSIProvider.dll\n\n```\n  - Concatenate current module filename with '.crt', e.g. %PATH%\\NSIProvider.dll.crt\n\n  - Allocate memory VirtualAlloc() and read the entire payload file into memory\n\n  - Initialise a permutation table that consists of 256 DWORDs\n\nEach value of the permutation table is calculated as:\n\n```\n*ptr= ((*ptr >> 1) & 0x54384748 | ~(*ptr >> 1) & 0xABC7B8B7) ^ 0x467F3B97;\n...\nPERM_TABLE[*index] = *ptr;\n\n```\n\n\n - Start decryption loop – in this loop, a key value is subtracted from each byte of the encrypted\n\npayload; the key value itself is calculated in each iteration based on the previous key value,\ncurrent index of the decrypted byte, and the permutation table:\n\nCloud Snooper - SophosLabs Page 24 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\n```\nptr = __ptr_index++;\nval = PERM_TABLE[((*ptr & 0x67612505 | ~*ptr & 0x989EDAFA) ^ (KEY &\n0x67612505 | ~KEY & 0x989EDAFA)) & ((*ptr & 0x67612505 | ~*ptr &\n0x989EDAFA) ^ (KEY & 0x67612505 | ~KEY & 0x989EDAFA) ^ 0xFFFFFF00)];\nKEY = (val & 0x432AA81D | ~val & 0xBCD557E2) ^ ((KEY >> 8) & 0x432AA81D |\n~(KEY >> 8) & 0xBCD557E2);\n\n```\n\n\n  - The decrypted payload reveals a checksum, a number of zero bytes, followed by the initial\n\nshellcode itself:\n\nThe decrypted payload blob is copied into a newly allocated memory buffer and the initial shellcode\n(starts from bytes EB 17 58 in the image above) is called.\n\nThe initial shellcode will then decrypt the rest of the blob using an XOR key that starts from 0x2B, and\nthen incremented by the index of the decrypted byte, i.e. the XOR key values are: 0x2B, 0x2C, 0x2E,\n```\n0x31, etc.\n\n```\nAs the rest of the blob is decrypted, the configuration file is decrypted as well, followed by other parts.\n\nAfter the initial shellcode has finished the decryption, the fully decrypted blob will consist of:\n\n   - Initial shellcode\n   - Decrypted config:\n\n```\nMicrosoft.Windows.BNG|ssl.newsofnp.com:443;|1;1;1;1;1;1;1;|0024;|1\n\n```\n\n   - Zlib-compressed LIBEAY32.dll (77,871 bytes, 167,936 bytes when decompressed)\n   - Zlib-compressed LIBEAY32.dll (386,876 bytes, 851,968 bytes when decompressed)\n   - Backdoor, implemented in the form of a second-stage shellcode\n\nOnce it's decoded, the second-stage shellcode is called – this is the backdoor itself.\n\nCloud Snooper - SophosLabs Page 25 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nWhen it gets control, it dynamically obtains all the APIs it needs by using hard-coded API hashes. To find\nmatching hashes from the API names, the shellcode relies on a slight modification of the ROR-13\nalgorithm. The only difference is that it checks if the zero byte character is at the end of the loop, and\nthus has an additional ROR for the terminating zero byte.\n\nAll the required DLLs are loaded dynamically.\n\nNext, it will decompress and load two stubs as DLLs. Both DLLs have the internal name LIBEAY32.dll.\n\nBoth DLLs rely on an older (2004) build of the libeay32.dll. Below are some strings found in the body of\nthese DLLs:\n\n```\nMD2 part of OpenSSL 0.9.7d 17 Mar 2004\nMD4 part of OpenSSL 0.9.7d 17 Mar 2004\nMD5 part of OpenSSL 0.9.7d 17 Mar 2004\nSHA part of OpenSSL 0.9.7d 17 Mar 2004\nSHA1 part of OpenSSL 0.9.7d 17 Mar 2004\n\n```\n\nThe backdoor relies on these DLLs for crypto-functions required to communicate with the C2.\n\nThe config format is consistent with the ELF binaries, i.e., the seven '1;' means the bot should be active\nseven days a week, all hours (00-24), the C2 communicates via HTTPS.\n\n[The. sSame config is known to be used by the Gh0st RAT.](https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2018/april/decoding-network-data-from-a-gh0st-rat-variant/)\n\nJust like /bin/snort described above, the bot also checks if the current day and hour match what's\nspecified in the config.\n\nIf there is no match, the bot also falls asleep for just over seven minutes (423.756 seconds), then checks\nthe time again.\n\nThe code snippets below demonstrate that the 423,756-millisecond delay specified within /bin/snort\nexecutable is identical to its Windows counter-part:\n\nELF executable: /bin/snort Windows shellcode:\n\nCloud Snooper - SophosLabs Page 26 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\nOn Linux, the number 423,756 is multiplied by 1,000, then passed to usleep() syscall that takes an\nargument in microseconds.\n\nOn Windows, the same number is passed to Sleep() API, which takes the argument in milliseconds.\n\nIn both cases, the achieved delay is identical: 7.062 seconds.\n\nCloud Snooper - SophosLabs Page 27 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\n### Conclusion\n\nThis case is extremely interesting as it demonstrates the true multi-platform nature of a modern attack.\n\nA well-financed, competent, determined attacker will unlikely ever to be restricted by the boundaries\nimposed by different platforms.\n\nBuilding a unified server infrastructure that serves various agents working on different platforms makes\nperfect sense for them.\n\nWhen it comes to prevention against this attack (or similar ones), AWS Security Groups provide a robust\nboundary firewall for EC2 instances. However, this firewall does not eliminate the need for network\nadministrators to keep all external-facing services fully patched.\n\nThe default installation for the SSH server also needs extra steps to harden it against attacks, turning it\ninto a rock-solid communication daemon.\n\n##### IOCs\n\n**Ports open on a local host:**\n```\ntcp 2080\nudp 2053\ntcp 10443\nExample:\nuser@host:~$ sudo netstat -peanut | grep \":2080 \\|:2053 \"\ntcp 0 0 0.0.0.0:2080  0.0.0.0:*  LISTEN 0 34402 2226/snoopy\nudp 0 0 0.0.0.0:2053  0.0.0.0:*      0 34398 2224/snoopy\n\n```\n**To check if these ports are open on a remote compromised host with IP 192.168.5.150:**\n```\nuser@host:~$ sudo nmap 192.168.5.150 -p 2080\n...\nPORT   STATE  SERVICE\n2080/tcp filtered autodesk-nlm\nuser@host:~$ sudo nmap 192.168.5.150 -p 2053 -sU\n...\nPORT   STATE  SERVICE\n2053/udp filtered lot105-ds-upd\n\n```\n**Inbound connections from the remote ports:**\n```\n6060, 7070, 8080, 9999, 2020, 1010\n\n```\nCloud Snooper - SophosLabs Page 28 of 29\n\n\n-----\n\nCloud Snooper - SophosLabs\n\n**Domains:**\n```\ncloud.newsofnp.com\nssl.newsofnp.com\nload.CollegeSmooch.com\n\n```\n**IPs:**\n```\n62.113.255.18\n89.33.246.111\n185.86.151.67\n\n```\n**Filenames:**\n```\n/tmp/rrtserver-lock\n/proc/sys/rrootkit\n/tmp/rrtkernel.ko\n/usr/bin/snd_floppy\n\n```\n**Kernel module:**\n```\nsnd_floppy\n\n```\n**Example:**\n```\nuser@host:~$ sudo lsmod | grep \"snd_floppy\"\nsnd_floppy   316594  0\n\n```\n**Syslog message:**\n```\n\"...insmod: ERROR: could not insert module /usr/bin/snd_floppy: File exists\"\n\"...kernel: snd_floppy: loading out-of-tree module taints kernel.\"\n\"...kernel: snd_floppy: module verification failed: signature and/or required key missing –\ntainting kernel\"\n\n```\nCloud Snooper - SophosLabs Page 29 of 29\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.02.25_Cloud_Snooper/CloudSnooper_report.pdf"
    ],
    "report_names": [
        "CloudSnooper_report"
    ],
    "threat_actors": [
        {
            "id": "1a76ed30-4daf-4817-98ae-87c667364464",
            "created_at": "2022-10-25T16:47:55.891029Z",
            "updated_at": "2025-03-27T02:05:17.408867Z",
            "deleted_at": null,
            "main_name": "IRON LIBERTY",
            "aliases": [
                "ATK6 ",
                "BROMINE ",
                "CASTLE ",
                "Crouching Yeti ",
                "DYMALLOY ",
                "Dragonfly ",
                "Energetic Bear / Berserk Bear ",
                "Ghost Blizzard ",
                "TEMP.Isotope ",
                "TG-4192 ",
                "ALLANITE "
            ],
            "source_name": "Secureworks:IRON LIBERTY",
            "tools": [
                " Ddex Loader",
                " Havex",
                " Karagany",
                " Loek",
                " MCMD",
                " Sysmain",
                " xfrost",
                "ClientX"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041464,
    "ts_creation_date": 1582556851,
    "ts_modification_date": 1582556851,
    "files": {
        "pdf": "https://archive.orkl.eu/5689d93fa60e88759d1b0d9a23674a43caf87717.pdf",
        "text": "https://archive.orkl.eu/5689d93fa60e88759d1b0d9a23674a43caf87717.txt",
        "img": "https://archive.orkl.eu/5689d93fa60e88759d1b0d9a23674a43caf87717.jpg"
    }
}