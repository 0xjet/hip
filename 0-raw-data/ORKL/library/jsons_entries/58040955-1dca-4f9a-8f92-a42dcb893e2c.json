{
    "id": "58040955-1dca-4f9a-8f92-a42dcb893e2c",
    "created_at": "2023-01-12T15:07:50.58506Z",
    "updated_at": "2025-03-27T02:06:13.318181Z",
    "deleted_at": null,
    "sha1_hash": "4688d39c4ccbf05ff80b374508efe9aa70aec5ba",
    "title": "2022-08-10 - Emotet SMB Spreader is Back",
    "authors": "",
    "file_creation_date": "2022-08-18T03:58:46Z",
    "file_modification_date": "2022-08-18T03:58:46Z",
    "file_size": 679529,
    "plain_text": "# Emotet SMB Spreader is Back\n\n**bitsight.com/blog/emotet-smb-spreader-back**\n\nWritten by Jo√£o Batista\nAugust 10, 2022\nShare\nFacebook\nTwitter\nLinkedIn\n\nEmotet is back in business, and BitSight's Threat Research team is continuously monitoring\nthe evolution of this dangerous malware.\n\nNot too long ago, on June 6, our team observed the botnet Epoch4 delivering a new module\nto the infected systems that turned out to be a credit card stealer targeting Google Chrome.\nA few days later, on June 13, the botnet Epoch4 re-introduced the SMB spreader module.\nThis module was used before the law enforcement takedown in January 2021, but not since\nEmotet's return in November 2021.\n\nCurrently, all Emotet botnets (Epoch4 and Epoch5) are using these two modules giving the\nmalware the capability of stealing credit card data and moving laterally upon infecting a\nsystem.\n\nGiven the dangerous nature of the SMB spreader module, we decided to share some details\non how it works.\n\n## Hardcoded username and password lists\n\nThe spreader contains an encrypted list of usernames and an encrypted list of passwords.\nThese two lists are encrypted using a XOR cipher with 4-byte sized keys. After decrypting\nthe lists the contents are parsed and placed in two linked lists:\n\n\n-----\n\nFigure 1. Decrypting and parsing the username and password lists\n\n## Impersonating the logged-on user\n\nThe token from the logged-on user gets duplicated by calling DuplicateToken with the\nSecurityImpersonation level. Then the spreader calls ImpersonateLoggedOnUser to\ncomplete the impersonation of the logged-on user:\n\nFigure 2. Logged-on user impersonation\n\n## Finding remote servers\n\nThe spreader calls WnetOpenEnumW and WnetEnumResourceW to enumerate network\nresources. If the network resource is a server, its name gets saved into a list:\n\n\n-----\n\nFigure 3. Finding remote servers\n\n## Moving laterally\n\nThe spreader iterates over the list of servers and try to connect to the IPC$ share using the\nhardcoded usernames and passwords:\n\nFigure 4. Bruteforcing the IPC$ share\n\nIf none of the credentials worked, the spreader tries to enumerate usernames from the target\nserver by calling NetUserEnum. All usernames that are not present in the hardcoded\nusername list will be added to a linked list so that they can be bruteforced later:\n\n\n-----\n\nFigure 5. Enumerating usernames from remote servers\n\nIf the spreader finds valid credentials, it tries to connect to C$ and ADMIN$ shares. In case\nof successful authentication, Emotet's loader is copied to the remote share with a random\nfilename (derived from the machine CPU counter) and launched as a service.\n\nPaths to where loader can be copied:\n\nShare Path\n\nC$ C:\\<random>.dll\n\nADMIN$ %SystemRoot%\\<random>.dll\n\nThe newly created service will execute one of the following commands:\n\nShare Command\n\nC$ regsvr32.exe \"C:\\<random>.dll\"\n\nADMIN$ regsvr32.exe \"%SystemRoot%\\<random>.dll\"\n\n## Conclusion\n\nEmotet's ability to extend functionality through the usage of modules makes it easier to add\nnew capabilities to the malware. A module capable of stealing credit card data shows that\nthe operators are looking for new ways to monetize their botnet operations. The reintroduction of the SMB spreader shows the willingness of the operators to raise infections at\n\n\n-----\n\nthe cost of increasing Emotet s network fingerprint.\nDefenders should look for suspicious authentication attempts to network shares and be sure\nthat no users are using any of the passwords in the hardcoded password list.\n\n## IOCs\n\nSHA256 spreader module:\n\n3D8F8F406A04A740B8ABB1D92490AFEF2A9ADCD9BEECB13AECF91F53AAC736B4\n\nList of usernames:\n\nhttps://raw.githubusercontent.com/bitsightresearch/threat_research/main/emotet/smb_spreader/users.txt\n\nList of passwords:\n\nhttps://raw.githubusercontent.com/bitsightresearch/threat_research/main/emotet/smb_spreader/passwords.txt\n\n## Get the Weekly Cybersecurity Newsletter\n\nSubscribe to get security news and industry ratings updates in your inbox.\n\nRead more\nBy checking this box, I consent to sharing this information with BitSight Technologies,\nInc. to receive email and phone communications for sales and marketing purposes as\n[described in our privacy policy. I understand I may unsubscribe at any time.](https://www.bitsight.com/privacy-policy)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-10 - Emotet SMB Spreader is Back.pdf"
    ],
    "report_names": [
        "2022-08-10 - Emotet SMB Spreader is Back.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536070,
    "ts_updated_at": 1743041173,
    "ts_creation_date": 1660795126,
    "ts_modification_date": 1660795126,
    "files": {
        "pdf": "https://archive.orkl.eu/4688d39c4ccbf05ff80b374508efe9aa70aec5ba.pdf",
        "text": "https://archive.orkl.eu/4688d39c4ccbf05ff80b374508efe9aa70aec5ba.txt",
        "img": "https://archive.orkl.eu/4688d39c4ccbf05ff80b374508efe9aa70aec5ba.jpg"
    }
}