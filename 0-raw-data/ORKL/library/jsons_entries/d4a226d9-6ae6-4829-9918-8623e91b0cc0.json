{
    "id": "d4a226d9-6ae6-4829-9918-8623e91b0cc0",
    "created_at": "2023-01-12T15:08:38.41575Z",
    "updated_at": "2025-03-27T02:09:30.118131Z",
    "deleted_at": null,
    "sha1_hash": "7feb05cf49abb7b797810d87d6ad136e3f608d82",
    "title": "2021-08-09 - BlackMatter ransomware emerges from the shadow of DarkSide",
    "authors": "",
    "file_creation_date": "2022-05-28T15:19:03Z",
    "file_modification_date": "2022-05-28T15:19:03Z",
    "file_size": 1806364,
    "plain_text": "# BlackMatter ransomware emerges from the shadow of DarkSide\n\n**[news.sophos.com/en-us/2021/08/09/blackmatter-ransomware-emerges-from-the-shadow-of-darkside/](https://news.sophos.com/en-us/2021/08/09/blackmatter-ransomware-emerges-from-the-shadow-of-darkside/)**\n\nMark Loman August 9, 2021\n\n[On Friday May 7, 2021, an affiliate of the DarkSide Ransomware-as-a-Service (RaaS) hit](https://news.sophos.com/en-us/2021/05/11/a-defenders-view-inside-a-darkside-ransomware-attack/)\nColonial Pipeline, a major U.S. fuel pipeline. The attack led to widespread supply disruption,\nglobal headlines, and intense scrutiny by the national authorities. A week later, DarkSide\nannounced it was shutting down its operations after its servers were allegedly seized and its\ncryptocurrency wallets drained. DarkSide was followed into apparent retirement by another\n[ransomware service, REvil, the threat actor behind the attack on](https://news.sophos.com/en-us/2021/07/04/independence-day-revil-uses-supply-chain-exploit-to-attack-hundreds-of-businesses/) [Kaseya.](https://news.sophos.com/en-us/2021/07/02/kaseya-vsa-supply-chain-ransomware-attack/)\n\nIn late July, a new RaaS appeared on the scene. Calling itself BlackMatter, the ransomware\nclaims to fill the void left by DarkSide and REvil – adopting the best tools and techniques\nfrom each of them, as well as from the still-active LockBit 2.0.\n\nSophosLabs decided to take a closer look at the malware and the claims being made by the\nnew adversary to see what’s really going on.\n\n_Note: A Ransomware-as-a-Service (RaaS) comprises a core group of developers who_\n_maintain the ransomware and payment sites as well as recruited affiliates or “customers”_\n_who rent the ransomware, breach victims’ networks and encrypt devices._\n\n## Malware analysis\n\n\n-----\n\nThe Sophos research is based on a sample of the BlackMatter ransomware, with the SHA256 hash:\n22D7D67C3AF10B1A37F277EBABE2D1EB4FD25AFBD6437D4377400E148BCC08D6.\n\nThe operators behind the BlackMatter RaaS have established a presence on the dark web:\n\nThe list of sectors and entities this threat actor says it will not attack reflect the recent global\n[incidents involving DarkSide (Colonial Pipeline) and REvil (Kaseya) ransomware, which drew](https://news.sophos.com/en-us/2021/05/11/a-defenders-view-inside-a-darkside-ransomware-attack/)\nwidespread and probably unwelcome attention.\n\n[The operators behind BlackMatter claim that their ransomware incorporates the best features](https://www.recordedfuture.com/blackmatter-ransomware-successor-darkside-revil/)\nof DarkSide, REvil, and LockBit 2.0 ransomware. They also say that while they are closely\nacquainted with the Darkside operators, they are not the same people.\n\nTo better understand the potential relationships between the ransomware groups,\nSophosLabs has analyzed a BlackMatter ransomware sample, and uncovered a number of\ntechnical similarities with DarkSide and the other ransomware families that are worth noting.\n\nBelow is a short comparison of some of the capabilities seen in the various groups:\n\n**Feature** **REvil** **Lockbit 2.0** **DarkSide** **BlackMatter**\n\nType RaaS RaaS RaaS RaaS\n\n\n-----\n\nNetwork first – Yes No No\n\nMulti-threaded Yes Yes Yes Yes\n\nFile encryption In-place In-place In-place In-place\n\n\nEncrypt size Full Partial, 4\nKB\n\n\nPartial, 512 KB Partial, 1.024 KB\n\n\nRename After After Before Before\n\n\nDecryption blob End of\nFile\n\n\nEnd of File End of File End of File\n\n\nWallpaper Yes Yes Yes Yes\n\n\nEncrypts Russian\nsystems\n\n## Wallpaper\n\n\nNo Yes No Yes\n\n\nWhen victims are hit with the BlackMatter ransomware and the files on the drives are\nencrypted, BlackMatter sets a wallpaper that is very similar to DarkSide’s. Also, like\nDarkSide, this is stored in the same folder on disk (C:\\ProgramData), with an identical file\nsize (2,818,366 bytes), image format (.BMP) and image size (1706 x 826 pixels, 16-bit color\ndepth.)\n\n\n-----\n\nFigure: BlackMatter resetting the desktop wallpaper to a ransom notice\n\nFigure: DarkSide resetting the desktop wallpaper to a ransom notice\n\n## Initial access brokers\n\nAlthough DarkSide (and REvil) seem to have disappeared from the RaaS scene, we have\ndetected an increase in LockBit 2.0 ransomware attacks. A recent ransom wallpaper set by\nLockBit contains an advertisement to recruit an initial access broker, possibly a corporate\ninsider, to help them breach and encrypt networks for million-dollar payouts:\n\n\n-----\n\nFigure: Lockbit 2.0 resetting the desktop wallpaper to a ransom notice with a recruitment ad\n\n_“Would you like to earn millions of dollars? Our company acquire access to networks of_\n_various companies, as well as insider information that can help you steal the most valuable_\n_data of any company._\n\n_You can provide us accounting data for the access to any company, for example, login and_\n_password to RDP, VPN, corporate email, etc._\n\n_Open our letter at your email. Launch the provided virus on any computer in your company._\n\n_Companies pay us the foreclosure for the decryption of files and prevention of data leak._\n\n_You can communicate with us through the Tox messenger”_\n\n## Competitive actors\n\nRansomware actors compete to attract the best criminal hackers (partners) to work for them.\nTo appeal to potential recruits the groups want to show they have superior tools and\ntechniques, for instance, by being able to lock data faster than others.\n\nBlackMatter, DarkSide and LockBit 2.0 all employ a partial encryption scheme, which means\nthey do not encrypt the entire file but only a portion. This has the same effect but significantly\nshortens the attack duration since only a fraction of a file is read and overwritten.\n\nDepending on the protection software, being fast offers an advantage as it often takes a few\nseconds before protection initiates a memory scan and can determine that a malware is\nrunning in memory and the files are under attack. By then, many files may have already\n\n\n-----\n\nbecome scrambled and inaccessible.\n\nKnowing that solid-state drives (SSD) or M.2 NVMe storage can reach speeds of hundreds\nor thousands of megabytes per second (MB/s), you can imagine that attacking merely 1 MB\nof each file means hundreds of files can become encrypted in a second.\n\n## Multithreaded file system activity\n\nIn addition to partial encryption, most recent ransomware-as-a-service families make use of\nmultithreading. This technology is available in CPUs since 2001 and increases the utilization\nof a processor core by using the complementary processes of thread-level parallelism and\ninstruction-level parallelism.\n\nThis effectively leads to higher throughput and lower latency since data in a faster medium\n(such as memory) can be retrieved by one thread while another thread retrieves data from a\nslower medium (such as storage), with neither thread waiting for the other to finish.\n\nDuring encryption, the BlackMatter ransomware’s file system activity and use of\nmultithreading looks the same as DarkSide’s. The steps are very similar:\n\n**BlackMatter**\n\nStep Thread Operation Purpose\n\n1 A CreateFile (Generic Read) Open original document for reading\nonly\n\n2 A ReadFile Read last 132 bytes of original\ndocument (look for decryption blob)\n\n3 A ReadFile Read last 1,051 bytes of original\ndocument (look for decryption blob)\n\n4 A CloseFile Close original document (no\nchanges made)\n\n\n5 A CreateFile (Read\nAttributes)\n\n\nOpen original document\n\n\n6 A SetRenameInformationFile Rename document by adding a file\nextension, for example .7xit0dGt6\n\n7 A CloseFile Close now renamed original\ndocument\n\n\n8 A CreateFile (Generic\nRead/Write)\n\n\nOpen renamed original document for\nreading and writing\n\n\n-----\n\n9 B ReadFile Read 1 MB of renamed original\ndocument\n\n10 B WriteFile Write 1 MB of encrypted document\nin renamed original document\n\n11 C WriteFile (Offset: -1) Add decryption blob, 132 bytes, to\nend of file\n\n12 B CloseFile Close now encrypted file\n\nTable: BlackMatter ransomware file system activity when it encrypts a document\n\n**DarkSide**\n\nStep Thread Operation Purpose\n\n\n1 A CreateFile (Generic\nRead/Write)\n\n\nOpen original document for reading and\nwriting\n\n\n2 A ReadFile Read last 144 bytes of original\ndocument (look for decryption blob)\n\n3 A ReadFile Read last 1,051 bytes of original\ndocument (look for decryption blob)\n\n4 A CloseFile Close original document (no changes\nmade)\n\n\n5 A CreateFile (Read\nAttributes)\n\n\nOpen original document\n\n\n6 A SetRenameInformationFile Rename document by adding a file\nextension, for example .e35e450e\n\n7 A CloseFile Close now renamed original document\n\n\n8 A CreateFile (Generic\nRead/Write)\n\n\nOpen renamed original document for\nreading and writing\n\n\n9 B ReadFile Read 0.5 MB of renamed original\ndocument in blocks of 64 KB\n\n10 B WriteFile Write 0.5 MB of encrypted document in\nrenamed original document in blocks of\n64 KB\n\n11 C WriteFile (Offset: -1) Add decryption blob, 144 bytes, to end\nof file\n\n12 B CloseFile Close now encrypted file\n\n\n-----\n\nTable: DarkSide ransomware file system activity when it encrypts a document\n\n## Decryption blob\n\nRansomware stores a decryption blob in or alongside encrypted files. This blob is essential\nfor the decryption tool that the adversary provides to restore files after a target has paid the\nransom.\n\nThis blob of data is usually appended to the end of the file but can be prepended or stored in\none or more separate files, depending on the ransomware family. BlackMatter, DarkSide,\nREvil and LockBit all add the decryption blob at the end of the file – which is typical for most\nransomware.\n\n## Granting access to “Everyone”\n\nUnlike DarkSide, the BlackMatter ransomware takes ownership of a document before\nencrypting it by setting its discretionary access control list (DACL) to “Full” for group\n“Everyone” (via the SetSecurityFile function.) This makes the document accessible to every\nWindows user. Because of the malicious encryption that follows, this doesn’t immediately\ncause a breach of privacy. However, victims who pay the ransom demand will receive a\ndecrypter from the attacker that cannot restore the original access permissions as this\nsecurity information has been lost.\n\nIT admins should therefore check and re-enforce proper permissions when recovering from a\nBlackMatter ransomware attack.\n\n## Deployment and abuse of “Safe Mode” like REvil\n\nSophosLabs research into an attack involving BlackMatter ransomware revealed that once a\nBlackMatter operator gains access to a target’s network and is ready to deploy the\nransomware, a scheduled task is set up that executes a PowerShell script on a domainaccessible UNC path on a server, e.g., a domain controller.\n\nThe ransomware binary itself is base64 encoded and embedded inside the PowerShell\nscript. Although the PowerShell script has support to decode and reflectively load the\nransomware binary straight into memory (like some REvil ransomware attacks), the binary\ncan also be dropped to disk.\n\nIn the presence of robust endpoint protection software, the attacker can opt to use\nBlackMatter’s Safe Mode capability. Via the -safe command-line switch, the BlackMatter\nransomware can restart Windows into a diagnostic mode known as Safe Mode, where\nendpoint protection is typically not active, and perform the entire encryption attack there.\nThese are the steps:\n\n\n-----\n\nEnable the Windows built-in local Administrator account, which is normally disabled\nby default\nCreate the HKLM\\SOFTWARE\\Microsoft\\Windows\n**NT\\CurrentVersion\\Winlogon\\AutoAdminLogon registry key and set it to 1**\nCreate the HKLM\\SOFTWARE\\Microsoft\\Windows\n**NT\\CurrentVersion\\Winlogon\\DefaultUserName registry key and set it to**\n**Administrator**\nCreate the HKLM\\SOFTWARE\\Microsoft\\Windows\n**NT\\CurrentVersion\\Winlogon\\DefaultDomainName registry key and set it to local**\nhostname\nCreate an entry under the\n**HKLM\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\**\nregistry key, using a random string starting with an asterisk, like *VHJ544uhjC, and set\nits value to the full path of the ransomware executable\nChange the default boot configuration to safe mode with networking, by running this\ncommand: bcdedit /set {current} safeboot network\n\nThe ransomware then forces the machine to restart and Windows automatically boots into\n“Safe Mode with Networking,” where the ransomware can encrypt the files on the machine\nwithout being disrupted by endpoint protection software. The local account Administrator is\nautomatically logged in and the ransomware runs automatically. When the ransomware has\nfinished encrypting, it runs the following command to make sure that, going forward, the\nmachine boots into normal mode: bcdedit /deletevalue {current} safeboot. The machine is\nrestarted, although the abused Administrator account remains automatically logged in.\n\nThese steps are almost identical to those seen in a ransomware attack involving REvil\nransomware, which provided Safe Mode support via the -smode command-line switch.\n\n## Privilege elevation\n\nLike REvil, LockBit 2.0 and DarkSide, BlackMatter also attempts to elevate its privileges\nwhen it is limited by User Account Control (UAC). It does so via an elevated COM interface,\nby executing a function with this object name: Elevation:Administrator!new:{3E5FC7F9**9A51-4367-9063-A120244FBEC7}**\n\nThe same elevation trick is used by DarkSide and LockBit 2.0.\n\n## String encryption\n\nLike DarkSide (and REvil), BlackMatter uses a run-time API that can hinder static analysis of\nthe malware. And like the other two ransomware groups, strings are also encrypted and\nrevealed during runtime. While both of these techniques are common across many recent\nmalware, the way in which the runtime API and string decryption function in BlackMatter is\nvery similar to the functionality seen in DarkSide and REvil.\n\n\n-----\n\nRuntime API calls in BlackMatter\nIn another shared similarity with both REvil and Darkside, BlackMatter ransomware stores\nconfiguration information in the binary in an encoded format. SophosLabs decoded this and\nfound that BlackMatter ransomware has a similar structure and information stored in the\nconfiguration blob, like lists of processes and services to kill, the ransom note, C2 details,\ndirectories to avoid etc.\n\n## Killing processes\n\nThe ransomware can encrypt open (locked) documents. BlackMatter terminates several\nproductivity related processes before encryption begins:\n\nensvc\nthebat\nmydesktopqos\nxfssvccon\nfirefox\ninfopath\n\n\n-----\n\nwinword\nsteam\nsynctime\nnotepad\nocomm\nonenote\nmspub\nthunderbird\nagensvc\nsql\nexcel\npowerpnt\noutlook\nwordpad\ndbeng50\nisqlplussvc\nsqbcoreservice\noracle\nocautoupds\ndbsnmp\nmsaccess\ntbirdconfig\nocssd\nmydesktopservice\nvisio\n\nList of processes terminated by BlackMatter\n\n## Stealing victim details\n\nThe BlackMatter ransomware collects information from victim machines, like hostname,\nlogged in user, operating system, domain name, system type (architecture), language, as\nwell as the size of the disk and available free space.\n\n\n-----\n\nThe analyzed sample sends these details to a remote server hosted on paymenthacks.com\n\nIt uses a specific header to post the information:\n\n## Omitting countries\n\nSome ransomware attacks are set up to avoid hitting computers in certain countries. This is\noften a configurable option that RaaS affiliates can select for a specific campaign or target. It\nmeans that a protection approach based on installing, for example, an additional Cyrillic,\n\n\n-----\n\nRussian or Ukrainian keyboard will not help.\n\nDarkSide, for example, calls GetSystemDefaultUILanguage, which returns the language of\nthe default user interface of the operating system, also known as the “install language” –\nwhich cannot be changed by the user.\n\nThe analyzed BlackMatter sample encrypted our Russian machine whereas the DarkSide\nsample would not.\n\n## Ransom note\n\nThe BlackMatter ransomware drops a ransom note in user-accessible folders on the disk:\n\nBlackMatter ransom note\n\n\n-----\n\nDarkSide ransom note\nThe filename structure of DarkSide’s ransom note is slightly different: the ‘README’ string is\nnot behind but in front of the ransomware file extension. However, both notes first explain\nwhat happened and then talk about guarantees. DarkSide then goes on to claim to have\nstolen 500 gigabytes (GB) of data while BlackMatter mentions it has exfiltrated twice as\nmuch, 1 terabyte (TB).\n\nIn another recent sample we analyzed there is no mention of leaked data and the ransom\nnote was tailored to the victim as it included the victim’s company name. In addition, this\nsample sends a print job from each infected machine to the default printer, i.e., the ransom\nnote is delivered on paper across the office. This can also be via printers at home –\nsomething we’ve also seen in recent LockBit 2.0 ransomware attacks.\n\n## DarkSide and BlackMatter: the same or just related?\n\nThere are a number of factors that suggest a connection between BlackMatter and DarkSide.\nHowever, this is not simply a rebranding from one to another. Malware analysis shows that\nwhile there are similarities with DarkSide ransomware, the code is not identical.\n\nSummarizing our findings, the claims made recently by an alleged BlackMatter\nrepresentative regarding its feature set are largely true.\n\n\n-----\n\nIn the hands of an experienced attacker, this ransomware can cause a lot of damage without\ntriggering many alarms. It is important for defenders to promptly investigate endpoint\nprotection alerts as they can be an indication of an imminent attack with disastrous\nconsequences.\n\n_Note: Sophos Machine Learning automatically detects BlackMatter ransomware._\n\n## Acknowledgments\n\nSophos would also like to acknowledge SophosLabs researchers Anand Ajjan and Sean\nGallagher, and Rapid Response manager Peter Mackenzie for their contributions to this\nreport.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-09 - BlackMatter ransomware emerges from the shadow of DarkSide.pdf"
    ],
    "report_names": [
        "2021-08-09 - BlackMatter ransomware emerges from the shadow of DarkSide.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536118,
    "ts_updated_at": 1743041370,
    "ts_creation_date": 1653751143,
    "ts_modification_date": 1653751143,
    "files": {
        "pdf": "https://archive.orkl.eu/7feb05cf49abb7b797810d87d6ad136e3f608d82.pdf",
        "text": "https://archive.orkl.eu/7feb05cf49abb7b797810d87d6ad136e3f608d82.txt",
        "img": "https://archive.orkl.eu/7feb05cf49abb7b797810d87d6ad136e3f608d82.jpg"
    }
}