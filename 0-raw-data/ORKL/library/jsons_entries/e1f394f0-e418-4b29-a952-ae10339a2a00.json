{
    "id": "e1f394f0-e418-4b29-a952-ae10339a2a00",
    "created_at": "2023-01-12T15:11:00.163846Z",
    "updated_at": "2025-03-27T02:05:34.048384Z",
    "deleted_at": null,
    "sha1_hash": "c89e2112de96835d3d857d03a9fd44625358378b",
    "title": "2020-05-31 - Guildma is now using Finger and Signed Binary Proxy Execution to evade defenses",
    "authors": "",
    "file_creation_date": "2022-05-28T15:41:15Z",
    "file_modification_date": "2022-05-28T15:41:15Z",
    "file_size": 2493656,
    "plain_text": "# SANS ISC: InfoSec Handlers Diary Blog - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training InfoSec Handlers Diary Blog\n\n**isc.sans.edu/diary/27482**\n\n**Published: 2021-05-31**\n\n**Last Updated: 2021-06-01 11:00:57 UTC**\n\n**by** [Renato Marinho (Version: 1)](https://isc.sans.edu/handler_list.html#renato-marinho)\n\nWe recently identified a new Guildma/Astaroth campaign targeting South America, mainly Brazil, using a new\nvariant of the malware. Guildma is known by its multiple-staged infection chain and evasion techniques to reach\n[victim’s data and exfiltrate them. In a previous diary [1] at Morphus Labs, we analyzed a Guildma variant which](https://isc.sans.edu/diary/Guildma+malware+is+now+accessing+Facebook+and%A0YouTube+to+keep+up-to-date/25222)\nemployed an innovative strategy to stay active, using Facebook and YouTube to get a new list of its C2 servers.\n\nThe innovation this time is the use of Finger, an old service designed to retrieve information about a particular user\nor host on a network but employed by Guildma to retrieve the command that will download and start the new\n**victim’s computer infection. In addition, Guildma is bringing its own legit binary to the victim’s machine to**\nemploy a technique named Signed Binary Proxy Execution, reducing the chances of being detected.\n\nIn today’s diary, check the results of the analysis of this new variant along with MITRE ATT&CK TTPs and IOCs. To\nstart, look at Figure 1. This is the traffic generated by the new variant while contacting attackers’ Finger server and\nreceiving back the malicious command to be executed.\n\nFigure 1 – Guilma traffic while contacting attackers’ Finger server\n\n**Threat Analysis**\n\n\n-----\n\nFigure 2 – New Guildma variant analysis\n\nThe ongoing campaign starts with an e-mail phishing with a link to a ZIP file which contains an LNK. If the\nuser executes the LNK file, instead of opening a supposed PDF with a proof of payment (Comprovante.pdf7.lnk), it\nwill execute Windows native binary Finger.exe do retrieve the malicious command from attacker’s server on port\nTCP/79 and pass it to ‘cmd’ to get it executed.\n\nThe malicious LNK file is prepared to ‘cmd.exe’ with an obfuscated argument, as seen in Figure 3.\n\nFigure 3 – LNK content\n\nAnalyzing the environment variables created by the above argument, it is possible to see the arguments\nwhich will be passed to ‘cmd.exe’. Surprisingly, it calls finger.exe, a native Windows binary to an old service, and\npipes its results to a new cmd, as seen in Figure 4.\n\n\n-----\n\nFigure 4 – Deobuscated arguments\n\nThe result of the finger execution is another obfuscated command with a list of environment variables, as\nseen in Figure 5.\n\nFigure 5 – Result of finger execution\n\nOnce executed, the above command will create a JS file containing a VB Script on “%Public%\\Videos\\”\nand execute it. This execution will result in five more files downloaded and stored into a random path into Videos, as\nseen in Figure 6. The download is performed using the legitimate binary bitsadmin.exe.\n\nFigure 6 – JS and random directory created by Guildma to store malicious artifacts\n\nThe downloaded files are listed in Figure 7.\n\nFigure 7 – Downloaded artifacts\n\nThe ‘ctfmon.exe’, despite the name, is in fact, a copy of a legitimate binary named ‘coregen.exe’ which is\npart of Microsoft Silverlight product, as seen in Figure 8.\n\n\n-----\n\nFigure 8 – ‘coregen.exe’ legitimate binary brought over by the attackers\n\nThe ‘coregen.exe’ binary is used to load ‘helper.dll’ in a technique named Signed Binary Proxy\n**Execution (T1218)** **[[2]. It is like DLL Side Loading attack, but here the DLL name is passed as argument, as seen in](https://attack.mitre.org/techniques/T1218/)**\nFigure 9. In other words, the attacker is bringing the ‘coregen.exe’ legitimate binary to the victim’s machine and\nusing it as a rundll32 to have its malicious DLL loaded into it as a strategy to evade security controls.\n\n\n-----\n\nFigure 9 – Coregen.exe used to load malicious DLL\n\nThis type of misuse of ‘coregen.exe’ is mapped by Stronic [[3], as seen in Figure 10.](https://strontic.github.io/xcyclopedia/library/coregen.exe-3BF709AEDF5042C39515756FB72E9EC0.html)\n\nFigure 10 – Possible misuse of ‘coregen.exe’ by Stronic\n\n\n-----\n\nOnce loaded, the helper.dll will decrypt and load the other DLLs log32.dll and log33.dll previously downloaded. In\nthe Figure 11 I highlight the routing which decrypts the DLL contents.\n\nFigure 11 – Log32.dll decrypt routine\n\nAnd finally, once loaded, Log32.dll will perform multiple anti-debugging, anti-vm and a series of system verification,\nlike keyboard type and system language, the presence of a DLL belonging to Diebold Warsaw (wslbscr32.dll),\nbefore unpacking and launching information stealer procedures.\n\n**Final Considerations**\n\nReflecting on the use of Finger on this new variant, a possible reason that came to my mind was the attempt to\nbypass security filters that are usually applied to the HTTP/HTTPS traffic. Even employees in home office, may have\nsome type of web browsing filter applied by the company, like web proxies. However, it may not be so common for\nhome firewalls to make a more restrictive Internet outgoing filter, preventing, for example, the exit to the TCP/79\nport. In the end, as much as the content travels in clear text on Finger, the attacker may end up having more luck\nwith this strategy than if he used the most common path.\n\nFinally, it is interesting to highlight the use of Signed Binary Proxy Execution technique by the new Guildma\nvariant. Binaries signed with trusted digital certificates can execute on Windows systems protected by digital\nsignature validation – specially those signed by Microsoft, as ‘coregen.exe’.\n\nThere are mitigations and detection strategies for Signed Binary Proxy Execution mapped on MITRE ATT&CK [[2]](https://attack.mitre.org/techniques/T1218/)\nwhich include restricting the execution of particularly vulnerable binaries to privileged accounts that need to use\nthem and establish a baseline for processes and command line parameters for signed binaries to monitor and spot\nuncommon usage. There is a great project named LOLBAS [[5] (Living Off The Land Binaries and Scripts) which](https://github.com/LOLBAS-Project/LOLBAS)\nmaps ‘coregen.exe’ and other binaries that could be abused in a similar way.\n\n**References**\n\n[1] https://isc.sans.edu/diary/Guildma+malware+is+now+accessing+Facebook+and%A0YouTube+to+keep+up-todate/25222\n\n[2] [https://attack.mitre.org/techniques/T1218/](https://attack.mitre.org/techniques/T1218/)\n\n[[3]https://strontic.github.io/xcyclopedia/library/coregen.exe-3BF709AEDF5042C39515756FB72E9EC0.html](https://strontic.github.io/xcyclopedia/library/coregen.exe-3BF709AEDF5042C39515756FB72E9EC0.html)\n\n[[4]https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/finger](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/finger)\n\n\n-----\n\n[5] [https://github.com/LOLBAS Project/LOLBAS](https://github.com/LOLBAS-Project/LOLBAS)\n\n**IOCs**\n\n**Category** **Type** **Value** **Comment**\n\n\nArtifacts\ndropped\n\n\nArtifacts\ndropped\n\n\nArtifacts\ndropped\n\n\nArtifacts\ndropped\n\n\nArtifacts\ndropped\n\n\nArtifacts\ndropped\n\n\nArtifacts\ndropped\n\n\nArtifacts\ndropped\n\n\nArtifacts\ndropped\n\n\nArtifacts\ndropped\n\n\nArtifacts\ndropped\n\n\nsha256 412a6b755b2029126d46e7469854add3faa850f5a4700dd1e078fcc536ca418a ctfmon.exe\n(coregen.exe)\n\n                                                 - legitimate\nfile being\nused to start\nmalicious\nhelper.dll\n\nsha1 5f536e6701d928dd262d475cd6987777b9fa5e33 ctfmon.exe\n(coregen.exe)\n\n                                                 - legitimate\nfile being\nused to start\nmalicious\nhelper.dll\n\nmd5 3bf709aedf5042c39515756fb72e9ec0 ctfmon.exe\n(coregen.exe)\n\n                                                 - legitimate\nfile being\nused to start\nmalicious\nhelper.dll\n\nsha256 4fe8e09c61858df60222c5188af91b934d1358ee802d6dc06b4a25e162a71413 helper.dll\n\nsha1 cc19f43dbc98a5f471bb9fc926da6e9b190a925c helper.dll\n\nmd5 1d270124b1e61f21eed666afc4e60d9a helper.dll\n\nsha256 7889a7cc80dabc034cd02a3667e1f0028332669ca5ccf9a66b4f853064968158 log32.dll\n\nsha1 883bba850a4a6b84bb734841de823c25e09cc4dd log32.dll\n\nmd5 ea6ebcf305585d692fc4d519c94ed215 log32.dll\n\nsha256 5abfff61dcde664006db334859055d22da3b419e2fa2ae734bec48688c564dea log33.dll\n\nsha1 6aa3cd190f670671c2a93076dc1a77a551dfc3d3 log33.dll\n\n\n-----\n\nArtifacts\ndropped\n\n\nPayload\ninstallation\n\n\nPayload\ninstallation\n\n\nPayload\ninstallation\n\n\nmd5 126058c017ca37541da16c5ab6d91257 log33.dll\n\nsha256 9f61fc62aa9734406c164decc00f9c027574c4c5f6865d5fb297fb431f75c3bb Rt6.js\n\nsha1 77f1cc8b7ce1cbffe91f050cb1e7f790de62e257 Rt6.js\n\nmd5 50222aecc6a722564bb5844fa07af4d0 Rt6.js\n\nip-dst 45.79.215.94\n\ndomain martin21.xyz\n\ndomain martin23.xyz\n\ndomain martin24.xyz\n\ndomain martin05.xyz\n\ndomain martin17.xyz\n\ndomain martin27.xyz\n\ndomain martin06.xyz\n\ndomain martin03.xyz\n\ndomain martin04.xyz\n\ndomain martin02.xyz\n\ndomain martin01.xyz\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\n-----\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\ndomain martin08.xyz\n\ndomain martin07.xyz\n\ndomain martin10.xyz\n\ndomain martin11.xyz\n\ndomain go8357.xyz\n\ndomain alinester07.xyz\n\ndomain martin19.xyz\n\ndomain martin18.xyz\n\ndomain martin16.xyz\n\ndomain martin15.xyz\n\ndomain martin14.xyz\n\ndomain martin13.xyz\n\ndomain martin12.xyz\n\ndomain martin31.xyz\n\ndomain martin30.xyz\n\ndomain martin29.xyz\n\n\n-----\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\nNetwork\nactivity\n\n\ndomain martin28.xyz\n\ndomain martin26.xyz\n\ndomain martin25.xyz\n\ndomain martin22.xyz\n\n\n-\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-05-31 - Guildma is now using Finger and Signed Binary Proxy Execution to evade defenses.pdf"
    ],
    "report_names": [
        "2020-05-31 - Guildma is now using Finger and Signed Binary Proxy Execution to evade defenses.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536260,
    "ts_updated_at": 1743041134,
    "ts_creation_date": 1653752475,
    "ts_modification_date": 1653752475,
    "files": {
        "pdf": "https://archive.orkl.eu/c89e2112de96835d3d857d03a9fd44625358378b.pdf",
        "text": "https://archive.orkl.eu/c89e2112de96835d3d857d03a9fd44625358378b.txt",
        "img": "https://archive.orkl.eu/c89e2112de96835d3d857d03a9fd44625358378b.jpg"
    }
}