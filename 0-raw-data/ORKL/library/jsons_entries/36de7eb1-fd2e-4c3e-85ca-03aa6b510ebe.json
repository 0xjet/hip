{
    "id": "36de7eb1-fd2e-4c3e-85ca-03aa6b510ebe",
    "created_at": "2022-10-25T16:48:17.766333Z",
    "updated_at": "2025-03-27T02:08:40.428711Z",
    "deleted_at": null,
    "sha1_hash": "f8e850c0d5b3db84e2271da13afb043d2c55819d",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-10-02T03:38:51Z",
    "file_modification_date": "2019-10-02T03:38:51Z",
    "file_size": 796813,
    "plain_text": "# Targeted Attack Campaigns with Multi-Variate Malware Observed in the Cloud\n\n**[netskope.com/blog/targeted-attack-campaigns-multi-variate-malware-observed-cloud](https://www.netskope.com/blog/targeted-attack-campaigns-multi-variate-malware-observed-cloud)**\n\nAbhinav Singh March 8, 2017\n\n## This website uses cookies\n\nWe use cookies to personalise content and ads, to provide social media features and to analyse\ntraffic. We also share information about your use of our site with our social media, advertising and\nanalytics partners who may combine it with other information that you’ve provided to them or that\nthey’ve collected from your use of their services. To opt-in, select ok, otherwise select settings to\nset opt-out preferences.\n\n[OK](javascript: void(0);)\n[Show details](javascript: void(0);)\n\nThis website uses cookies for advertising and analytics purposes as described in our cookie\n[policy. For more information and to set preferences, please click here. By continuing to browse](https://www.netskope.com/cookies-policy)\nthis website, you accept our use of cookies.\n\n×\n\n\n-----\n\nNetskope Threat Research Labs has observed ongoing targeted attacks in enterprise cloud\nenvironments that lead to a malware fan-out effect through automated syncing and sharing of files\nin the cloud. While monitoring this attack, we captured several instances where the synced\nfilenames were similar to the email addresses of the attack victims. These attachments are often\nautomatically synced to cloud storage applications using file collaboration settings in popular\nSaaS applications like Office365, Google mail etc. This auto-syncing feature can also be\nachieved through third party applications as well. Since the filenames appear less suspicious,\nthey are more likely to be viewed as coming from within the organization (and therefore trusted)\nand shared with others in the same user group.\n\nFigure 1 illustrates this effect in a cloud environment and how Netskope detects the attack\npatterns at various stages.\n\n_Figure 1: Infection propagation in the Cloud_\n\n\n-----\n\nThe synced files were all zipped and contained obfuscated JavaScript. Over the course of this\ncampaign, Netskope Threat Protection detected variations in both zipped JavaScript as well as\nthe final payload that would be delivered once the JavaScript was executed. Changes in\nJavaScript were limited to varying obfuscation techniques, but there were three variations in final\npayload over the course of time. The payload’s variations were associated with keyloggers,\nremote access trojans, and more importantly, ransomware. Some of these samples would disable\nendpoint antivirus software, leaving the enterprise to rely on a remote scan engine like Netskope\nThreat Protection.\n\nConsider the example recipient as joey.tribbiani@example.com, we noticed following variations in\nattachment names for the targeted emails:\n\n_Joey.tribbiani[0-9A-Z]{6,8}_[0-9A-F]{6,8}.zip_\n\n_Joey.trbbiani_proposal_[0-9A-F]{6}.zip_\n\n_Pdf_letter-joey.tribbiani_[0-9A-F]{6}.zip_\n\n## Attack Vector\n\nThe attack vector follows the usual infection pattern in which the attached zip file contains an\nobfuscated JavaScript. We have noticed variations in the wrapper JavaScript indicating that the\nattackers were attempting multiple ways to circumvent the corporate environment. Netskope\nThreat Protection detects the attached zip file and obfuscated JavaScript inside as\nGen.Downloadrs.B1F4C42E,Gen.Downloadrs.10CC4FE0 and\nGeneric.JS.DownloaderS.B1F4C42E respectively.\n\n## Obfuscated JavaScripts\n\nDuring our investigation, we observed two variations of the obfuscated JavaScript that were\ndelivered as zip attachments to the recipients.\n\n### First Variation\n\n**_Sample Hashes – 5fcaf61df7fb44c984e5c5dcb9d2022a, a3ffac9e74fa99291d4d53ef525ed0fd_**\n\n**_Netskope detection: Gen.Downloadrs.B1F4C42,Gen.Downloadrs.10CC4FE0_**\n\nA simplified version of the obfuscated JavaScript that was delivered inside the zipped attachment\nis shown in Figure 2.\n\n\n-----\n\n_Figure 2 : Simplified version of the obfuscated wrapper JavaScript._\n\nThe above JavaScript creates a Windows script host object to establish connection with the hardcoded url (astralopitec[.]yomu[.]ru) in object named “dingy”. The fetched malware payload is then\nstored in the %TEMP% directory.\n\n### Second Variation\n\n**_Sample hash – 7340efcb3b352cd228a77782c74943a4_**\n\n**_Netskope Detection: Backdoor.Downloadr.DPW_**\n\nAnother instance of the JavaScript wrapper we observed is shown in the Figure 3.\n\n\n-----\n\n_Figure 3: Another example of obfuscated JavaScript inside the zip attachment_\n\nThe script uses multi-level obfuscation and constructs a WScript instance to setup a connection\nwith domains hosting the payloads. The box in figure 3 shows the fully constructed domain names\nonce the script is completely deobfuscated.The dropped payload is again saved with a random\nname in the %TEMP% directory.\n\n## Payload Variations\n\nWe noticed three different variations in the payloads delivered using the obfuscated JavaScript.\nThese payloads belong to Adwind RAT, iSpy keylogger and Locky ransomware families detected\nby Netskope Threat protection as Backdoor.Generckd.3312003, Gen:Variant.Rzy.73941 and\nBackdoor.Agnt.CDQB.\n\n### Payload Variation 1 : Adwind RAT\n\n**_Sample hash: 4506342ab7723d1f4cc6c98482c93433_**\n**_Netskope detection: Backdoor.Generckd.3312003_**\n\nThe first payload that we encountered while tracking this campaign was an instance of crossplatform, Java based Adwind RAT, which has the capability to infect Windows, Linux and Macs as\nshown in Figure 4.\n\n\n-----\n\n_Figure 4: Excerpt of decompiled Jar of Adwind RAT_\n\nThe RAT has the capability to launch a shell connectivity giving backdoor access to the attacker\nand has basic file stealing features. Figure 5 below shows the class files which form the crux of\nthe RATs capabilities.\n\n\n-----\n\n_Figure 5: Adwind RAT capabilities defined in the decompiled code_\n\nUpon execution on a typical windows environment, the RAT will create a random user profile and\nwill attempt to create persistence by registering an entry into HKCU Run key:\n\n_“reg.exe” (Access type: “SETVAL”; Path:_\n_“HKCU\\SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN”; Key: “HP”; Value:_\n_“”%APPDATA%\\Oracle\\bin\\javaw.exe” -jar “%USERPROFILE%\\QI\\giwauQII.cvLwffAX””)_\n\nThe jar file constructs multiple VB scripts onto the disk, which are executed by launching an\ninstance of command prompt. These visual basic scripts creates WMI command line queries and\nchecks for system information like anti-virus programs, firewall settings etc. A snapshot of the\nscripts is shown in figure 6. Adwind also copies relevant Java Runtime files to Appdata using\nxcopy command.\n\n_Figure 6: VB scripts created by the RAT to gather system information_\n\nThe sample tried connecting to a dynamic dns domain, securitypoint[.]ddns[.]net. Hosting C&C\nservers on dynamic DNS services helps attackers in quickly switching their IPs without changing\nthe host.\n\n### Payload Variation 2 : iSpy Keylogger\n\n**_Sample hash: 52de0df53e1d56e3bff153bcfd8d1938_**\n**_Netskope detection: Gen:Variant.Rzy.73941_**\n\nThe next instance of malware was observed to be the popular iSpy keylogger, which is sold in a\nsubscription based model in underground forums. iSpy is a .Net compiled keylogger that comes\npacked with loads of additional features like stealing browser history, webcam logging, keystroke\nrecording, clipboard monitoring etc. Figure 7 shows the captured strings in memory when the\nkeylogger is installed onto the system.\n\n\n-----\n\n-----\n\n_Figure 7: iSpy keylogger activities captured in memory strings_\n\nUpon execution, the malware creates a copy of itself in \\App\n_Data\\Roaming\\Microsoft\\Windows\\ScreenToGif.The malware maintains persistence by creating_\nregistry entries in HKU\\.DEFAULT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell\n_Folders\\Cache. The entry is made to invoke a payload activator executable that checks for_\nrunning instances of the main iSpy payload based on the mutex. If the malware is not already\nloaded in the memory, It will launch its new instance. The payload loader is stored in the\n%TEMP% directory. Parts of the decompiled code can be seen in Figure 8.\n\n_Figure 8: Payload loader’s decompiled code_\n\nThe code will look for running instance of process named “netprotocol” and sleeps if it is already\nloaded into the memory. It will spun up a new process by invoking the copy of malware stored in\nthe ScreenToGif folder.\n\nApart from the keylogging and information stealing features, iSpy also makes sure that it disables\nany known running instances of a wide variety of anti-virus programs onto the system as shown in\nFigure 9.\n\n_Figure 9: Process names of anti-virus solutions targeted by iSpy keylogger_\n\nThe benefit of using a cloud security solution like Netskope is that they are not affected by such\ncounter-measures implemented by sophisticated malware.\n\n\n-----\n\nThe malware stores the exfiltrated data in a file in the %TEMP% directory and sends the\nharvested data to the C&C, westech-solar[.]co. At the time of analysis, the C&C was\nunresponsive.\n\n### Payload Variation 3: Variant of Locky/Zepto\n\n**_Sample hash: 6968F0AF128C27C6C970ADC0B301D204_**\n**_Netskope detection: Backdoor.Agnt.CDQB_**\n\nThe third and last payload noticed during our monitoring, belongs to Locky ransomware family.\nWe observed a variant of Locky being delivered as the final payload once the user executes the\n[attached JavaScript. We have blogged about a detailed analysis of the variant Zepto here. The](https://resources.netskope.com/h/i/273457617-zepto-variant-of-locky-ransomware-delivered-via-popular-cloud-storage-apps)\nsamples noticed during this campaign were no different from the one we disclosed in our blog.\nThere were slight variations in the first level JavaScript where the payload execution parameters\nwere slightly obfuscated.\n\n_Figure 10: Ransom message from Locky/Zepto_\n\n## Conclusion\n\nSending malicious attachments through emails is not new, but remains a very popular method for\ndelivering targeted attacks. By crafting an attack vector that leaves little for many existing\nenterprise security solutions, it becomes easy for attackers to infect users and network.\nOrganizations using cloud storage apps further amplify the attack vector when the malicious files\nand payloads is synced across multiple users.\n\n## General recommendations\n\nNetskope recommends following course of actions to effectively counter such threats:\n\nDetect and remediate all threats at rest in sanctioned cloud services using a threat-aware\nCloud Access Security Broker like Netskope.\nDetect and remediate all threats being downloaded from unsanctioned cloud services using\n\n\n-----\n\nScan files using remote scanning services like Netskope Advanced Threat Protection, that\ncannot be disabled by malware.\nRegularly back up and turn on versioning for critical content in cloud services.\nAvoid opening email attachments if it appears to be coming from unknown sources.\nDisable automatic unzipping of files and avoid clicking on any JavaScript that comes as\nzipped archive unless fully verified by the sender or IT administrator.\nActively track usage of unsanctioned cloud services and enforce DLP policies to control\nfiles and data entering and leaving your corporate environment.\nKeep systems and antivirus updated with the latest releases and patches.\n\n## Contact Us\n\nWe'd love to hear from you!\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2017/2017.03.08.Targeted_Attack_Campaigns/Targeted%20Attack%20Campaigns%20with%20Multi-Variate%20Malware%20Observed%20in%20the%20Cloud%20-%20Netskope.pdf"
    ],
    "report_names": [
        "Targeted Attack Campaigns with Multi-Variate Malware Observed in the Cloud - Netskope"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716497,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1569987531,
    "ts_modification_date": 1569987531,
    "files": {
        "pdf": "https://archive.orkl.eu/f8e850c0d5b3db84e2271da13afb043d2c55819d.pdf",
        "text": "https://archive.orkl.eu/f8e850c0d5b3db84e2271da13afb043d2c55819d.txt",
        "img": "https://archive.orkl.eu/f8e850c0d5b3db84e2271da13afb043d2c55819d.jpg"
    }
}