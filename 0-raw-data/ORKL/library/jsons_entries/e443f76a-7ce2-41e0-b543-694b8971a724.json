{
    "id": "e443f76a-7ce2-41e0-b543-694b8971a724",
    "created_at": "2023-01-12T15:03:09.414326Z",
    "updated_at": "2025-03-27T02:06:08.529108Z",
    "deleted_at": null,
    "sha1_hash": "57070feaf0fd5eff93bd68f797bd8a109eb8df1a",
    "title": "2020-08-13 - Mekotio- These aren’t the security updates you’re looking for…",
    "authors": "",
    "file_creation_date": "2022-05-28T18:09:32Z",
    "file_modification_date": "2022-05-28T18:09:32Z",
    "file_size": 300969,
    "plain_text": "# Mekotio: These aren’t the security updates you’re looking for…\n\n**[welivesecurity.com/2020/08/13/mekotio-these-arent-the-security-updates-youre-looking-for/](https://www.welivesecurity.com/2020/08/13/mekotio-these-arent-the-security-updates-youre-looking-for/)**\n\nAugust 13, 2020\n\nAnother in our occasional series demystifying Latin American banking trojans\n\n[ESET Research](https://www.welivesecurity.com/author/esetresearch/)\n13 Aug 2020 - 11:30AM\n\nAnother in our occasional series demystifying Latin American banking trojans\n\n\n-----\n\nIn this installment of our series, we introduce Mekotio, a Latin American banking trojan\ntargeting mainly Brazil, Chile, Mexico, Spain, Peru and Portugal. The most notable feature of\nthe newest variants of this malware family is using a SQL database as a C&C server.\n\n_Figure 1. Countries affected by Mekotio_\n\nAs with many other Latin American banking trojans we have described earlier in this series,\nMekotio has followed a rather chaotic development path, with its features being modified very\noften. Based on its internal versioning, we believe there are multiple variants being developed\nsimultaneously. However, similar to [Casbaneiro, these variants are practically impossible to](https://www.welivesecurity.com/2019/10/03/casbaneiro-trojan-dangerous-cooking/)\nseparate from each other, so we will refer to them all as Mekotio.\n\n## Characteristics\n\n\n-----\n\nMekotio is a typical Latin American banking trojan that has been active since at least 2015. As\nsuch, it attacks by displaying fake pop-up windows to its victims, trying to entice them to\ndivulge sensitive information. These windows are carefully designed to target Latin American\nbanks and other financial institutions.\n\nMekotio collects the following information about its victims:\n\nFirewall configuration\nWhether the victim has administrative privileges\nVersion of the installed Windows operating system\nWhether anti-fraud protection products (GAS Tecnologia Warsaw and IBM Trusteer[1])\nare installed\nList of installed antimalware solutions\n\nMekotio ensures persistence either by using a Run key or creating an LNK file in the startup\nfolder.\n\nAs is common for most Latin American banking trojans, Mekotio has several typical backdoor\ncapabilities. It can take screenshots, manipulate windows, simulate mouse and keyboard\nactions, restart the machine, restrict access to various banking websites and update itself.\nSome variants are also able to steal bitcoins by replacing a bitcoin wallet in the clipboard and\nto exfiltrate credentials stored by the Google Chrome browser. Interestingly, one command is\napparently intended to cripple the victim’s machine by trying to remove all files and folders in\nthe C:\\Windows tree.\n\nOne way to identify Mekotio is a specific message box the trojan displays on several\noccasions (see Figure 2).\n\n_Figure 2. Message box used by all Mekotio variants_\n\n_(translation: “We are currently performing security updates on the site! Please, try again later! New security measures are being_\n\n_adopted: (1) new security plugin and (2) new visual look of the site. Your system will be restarted to complete the operation.”)_\n\n\n-----\n\nTo ease stealing passwords with its keylogging feature, Mekotio disables the AutoComplete\noption in Internet Explorer. This feature, when enabled, saves time for Internet Explorer users\nby remembering inputs on various types of fields that have been filled in previously. Mekotio\nturns it off by changing the following Windows Registry values:\n\nHKCU\\Software\\Microsoft\\windows\\CurrentVersion\\Explorer\\AutoComplete\\\n\nAutoSuggest = “No”\nHKCU\\Software\\Microsoft\\Internet Explorer\\Main\\\n\nUse FormSuggest = “No”\nFormSuggest Passwords = “No”\nFormSuggest PW Ask = “No”\n\nFor an in-depth analysis of one specific variant of Mekotio targeting Chile, refer to ESET’s\nrecently published article (in Spanish).\n\n## Distribution\n\nWe believe the main distribution method for Mekotio is spam (see Figure 3 for an example).\nSince 2018, we have observed 38 different distribution chains used by this family. Most of\nthese chains consist of several stages and end up downloading a ZIP archive, as is typical for\nLatin American banking trojans. We dissect the two most commonly used chains in the\nfollowing sections.\n\n\n-----\n\n_Figure 3. Example of a spam email distributing Mekotio_\n\n_(Translation: “Dear citizen, Your requested receipt: … Download receipt”)_\n\n### Chain 1: Passing context\n\nThe first chain consists of four consecutive stages, as illustrated in Figure 4. A simple BAT\ndropper drops a VBScript downloader and executes it using two command line parameters – a\ncustom HTTP verb[2] (“111SA”), and a URL from which to download the next stage. The\ndownloader downloads the next stage (yet another downloader) from the provided URL while\nusing a custom User-Agent value (“MyCustomUser” and its variations). The third stage\ndownloads a PowerShell script, correcting the URL from which to download Mekotio inside the\nscript’s body, before executing it. The PowerShell script then downloads Mekotio from the\ncorrected URL and installs and executes it (the execution process is described in detail later).\n\n\n-----\n\n_Figure 4. One distribution chain used by Mekotio that passes context between stages_\n\nThere are two interesting things about this chain. The first one is the usage of custom values\nfor both User-Agent header and HTTP verb. These can be used to identify some of Mekotio’s\nnetwork activity.\n\nThe other interesting aspect is the passing of context (either as command line arguments or by\nmodifying the body of the next stage). This is a simple, yet effective, form of anti-analysis\ntechnique, because if you have Downloader 1 without the matching Dropper, you will have\nneither the URL nor the custom HTTP verb needed to obtain the next stage of the malware.\nLikewise, having Downloader 3 without Downloader 2 is useless, because the URL is missing.\nThis approach makes analysis harder without the knowledge of context.\n\n### Chain 2: MSI with embedded JavaScript\n\n\n-----\n\nAs with many other Latin American banking trojans: Mekotio utilizes MSI in some of its latest\ndistribution chains. In this case, the chain is much shorter and less robust, as only a single\nJavaScript, serving as the final stage, is embedded in the MSI and executed.\n\nCompared to the PowerShell final stage from the previous chain, there are some visible\nsimilarities. The main one (shown in Figure 5) is the installation routine, called after\ndownloading and extracting the ZIP archive, that renames the contents of the extracted ZIP\narchive according to file size. That is closely connected to the execution method described in\nthe next section.\n\n_Figure 5. Comparison of installation routine in JavaScript and PowerShell scripts used by Mekotio,_\n\n_highlighting the similarity in basing the decision on file size_\n\n### Execution by abusing AutoIt interpreter\n\n\n-----\n\nMekotio is most commonly executed by abusing the legitimate AutoIt interpreter. In this\nscenario, the ZIP archive contains (besides the Mekotio banking trojan) a legitimate AutoIt\ninterpreter and a small AutoIt loader or injector script. The final stage of the distribution chain\nexecutes the AutoIt interpreter and passes the loader or injector script to it to interpret. That\nscript then executes the banking trojan. Figure 6 illustrates the whole process.\n\n_Figure 6. The execution method most commonly used by Mekotio_\n\nMekotio is not the only Latin American banking trojan using this method, but it favors it\nsignificantly more than its competitors.\n\n## Cryptography\n\n\n-----\n\nThe algorithm used to encrypt strings in Mekotio s binaries is essentially the same one\nCasbaneiro uses. However, many variants of Mekotio modify how the data are processed\nbefore being decrypted. The first few bytes of the hardcoded decryption key may be ignored,\nas may some bytes of the encrypted string. Some variants further encode encrypted strings\nwith base64. The specifics of these methods vary.\n\n## C&C server communication\n\n### SQL database as C&C server\n\n[Some variants of Mekotio base their network protocol on Delphi_Remote_Access_PC, as](https://github.com/Maickonn/Delphi_Remote_Access_PC)\ndoes Casbaneiro. When that is not the case, Mekotio utilizes a SQL database as a sort of\nC&C server. This technique is [not unheard of in relation to Latin American banking trojans.](https://securityintelligence.com/new-banking-trojan-mnubot-discovered-by-ibm-x-force-research/)\nInstead of a SELECT command, Mekotio seems to rely on executing SQL procedures. That\nway, it is not immediately clear what the underlying database looks like. However, the login\nstring is still hardcoded in the binary.\n\n### C&C server address generation\n\nWe have observed three different algorithms for how Mekotio obtains the address of its C&C\nserver. We describe them below in the chronological order that we encountered them.\n\n**Based on hardcoded lists of “fake domains”**\n\nThe first method relies on two hardcoded lists of domains – one for generating the C&C\ndomain and the other one for the port. A random domain is chosen from both lists and\nresolved. The IP address is further modified. When generating the C&C domain, a hardcoded\nnumber is subtracted from the last octet of the resolved IP address. When generating the C&C\nport, the octets are joined together and treated like a number. For clarity, we have\nimplemented both algorithms in Python, as seen in Figure 7. Notice that this approach is\n[surprisingly similar to the one used by Casbaneiro (marked as method 5 in the hyperlinked](https://www.welivesecurity.com/2019/10/03/casbaneiro-trojan-dangerous-cooking/)\nanalysis).\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n\ndef generate_domain(base_domains, num):\n\ndomain = to_ip(random.choice(base_domains))\n\noctets = domain.split(\".\")\n\noctets[3] = chr(int(octets[3]) - num)\n\nreturn octets.join(\".\")\n\ndef generate_port(base_domains):\n\ndomain = to_ip(random.choice(base_domains))\n\nreturn int(domain.split(\".\").join(\"\"))\n\n\n_Figure 7. Code for generating C&C domain and port from hardcoded lists of domains_\n\n**Based on current hour**\n\nThe second approach utilizes a Domain Generation Algorithm (DGA) based on current local\ntime (therefore, victim’s time zone affects the result). The algorithm takes the current day of\nthe week, day of the month and hour and uses them to generate a single string. It then\ncalculates the MD5 of that string, represented as a hexadecimal string. The result joined with a\nhardcoded suffix is the C&C server domain (its port is hardcoded in the binary). Figure 8\nshows our Python implementation of this algorithm.\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n\nday_names = {\n\n0: \"MON\",\n\n1: \"TUE\",\n\n2: \"WED\",\n\n3: \"THU\",\n\n4: \"FRI\",\n\n5: \"SAT\",\n\n6: \"SUN\",\n\n}\n\nhour_names = {\n\n7: \"AM02\",\n\n\n-----\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n\n30\n\n31\n\n32\n\n33\n\n34\n\n35\n\n\n8: AM03,\n\n9: \"AM04\",\n\n10: \"AM05\",\n\n11: \"AM06\",\n\n12: \"PM01\",\n\n13: \"PM02\",\n\n14: \"PM03\",\n\n15: \"PM04\",\n\n16: \"PM05\",\n\n17: \"PM06\"\n\n}\n\ndef get_hour_name(hour):\n\nif hour <= 6 or hour >= 18:\n\nreturn \"AM01\"\n\nelse\n\nreturn hour_names[hour]\n\ndef generate_domain(suffix):\n\ntime = get_current_time()\n\ndga_data = \"%s%02d%s\" % (day_names[time.dayOfWeek], time.day,\nhour_names[time.hour])\n\ndga_data = hexlify(md5(dga_data))\n\nreturn dga_data.lower() + suffix\n\n\n_Figure 8. Code for generating C&C domain based on current hour_\n\n**Based on current day**\n\nThe third algorithm is somewhat similar to the second one. It differs in the format of the string\ncreated from local time and the fact that it uses a different suffix each day. Additionally, it\ngenerates the C&C port in a similar manner. Once again, the Python re-implementation of the\n\n\n-----\n\ncode is illustrated in Figure 9.\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n\ndef generate_domain(domains_list, subdomain):\n\ntime = get_current_time()\n\ndga_data = \"%02d%02d%s\" % (time.day, time.month, subdomain)\n\ndga_data = hexlify(md5(dga_data))\n\nreturn dga_data[:20] + \".\" + domains_list[time.day - 1]\n\ndef generate_port(portstring):\n\ntime = get_current_time()\n\nreturn int(\"%d%02d%d\" % (time.day, time.dayOfWeek, time.month))\n\n\n_Figure 9. Code for generating C&C domain and port based on current day_\n\n## Multiple concurrent variants?\n\nWe already mentioned that, similar to other Latin American banking trojans, Mekotio follows a\nrather chaotic development cycle. However, besides that, there are indicators that there are\nmultiple variants of Mekotio being developed simultaneously.\n\nThe two main indicators are internal versioning and the format of the string used for exfiltrating\ninformation about the victim’s machine collected by Mekotio. We have identified four different\nversioning schemes:\n\nNumbering (001, 002, 072, 39A, …)\nVersion by date (01-07, 15-06, 17-10, 20-09, …)\nVersion by full date (02_03_20, 13_03_20, 26_05_20, …)\nNumbering and date combined (103–30-09, 279–07-05, 293–25-05, …)\n\nEach of these schemes is associated with a specific format of the exfiltrated data string. Since\nwe see multiple of these schemes simultaneously, we believe that there may be multiple threat\nactors using different variants of Mekotio.\n\n## Conclusion\n\nIn this blog post, we have analyzed Mekotio, a Latin American banking trojan active since at\nleast 2015. As in the other banking trojans described in this series, Mekotio shares common\ncharacteristics for this type of malware, such as being written in Delphi, using fake pop-up\nwindows, containing backdoor functionality and targeting Spanish- and Portuguese-speaking\ncountries.\n\n\n-----\n\nWe have focused on the most interesting features of this banking trojan, such as its primary\nmethod of execution by abusing the legitimate AutoIt interpreter, using SQL database as a\nC&C server or the different methods Mekotio uses to generate the address of its C&C server.\n\nWe have also mentioned several features that are surprisingly similar to Casbaneiro.\n\n_For any inquiries, contact us at threatintel@eset.com. Indicators of Compromise can also be_\n_found in_ _[our GitHub repository.](https://github.com/eset/malware-ioc/tree/master/mekotio)_\n\n## Indicators of Compromise (IoCs)\n\n### Hashes\n\n**Mekotio samples**\n\n**SHA-1** **Description** **ESET detection name**\n\n\nAEA1FD2062CD6E1C0430CA36967D359F922A2EC3 Mekotio\nbanking\ntrojan (SQL\nvariant)\n\n8CBD4BE36646E98C9D8C18DA954942620E515F32 Mekotio\nbanking\ntrojan\n\n297C2EDE67AE6F4C27858DCB0E84C495A57A7677 Mekotio\nbanking\ntrojan\n\n511C7CFC2B942ED9FD7F99E309A81CEBD1228B50 Mekotio\nbanking\ntrojan\n\n47C3C058B651A04CA7C0FF54F883A05E2A3D0B90 Mekotio\nbanking\ntrojan\n\n**Legitimate AutoIt interpreter being abused**\n\n**SHA-1** **Description**\n\n\nWin32/Spy.Mekotio.CQ\n\nWin32/Spy.Mekotio.O\n\nWin32/Spy.Mekotio.DD\n\nWin32/Spy.Mekotio.T\n\nWin32/Spy.Mekotio.CD\n\n**ESET**\n**detection**\n**name**\n\n\nACC07666F4C1D4461D3E1C263CF6A194A8DD1544 AutoIt v3 Script\ninterpreter\n\n### Network communication\n\n\nclean\n\n\n-----\n\nUser-Agent: MyCustomUser, 4M5yC6u4stom5U8se3r (and other variations)\nHTTP verb: “111SA”\n\n### Bitcoin wallets\n\n1PkVmYNiT6mobnDgq8M6YLXWqFraW2jdAk\n159cFxcSSpup2D4NSZiuBXgsGfgxWCHppv\n1H35EiMsXDeDJif2fTC98i81n4JBVFfru6\n\n## MITRE ATT&CK techniques\n\n[Note: This table was built using version 7 of the MITRE ATT&CK framework.](https://attack.mitre.org/versions/)\n\n**Tactic** **ID** **Name** **Description**\n\n\nInitial\nAccess\n\n\n[T1566.002](https://attack.mitre.org/versions/v7/techniques/T1566/002/) Phishing: Spearphishing Link Mekotio distribution chains\nstart with a malicious link in an\nemail.\n\n\nExecution [T1059](https://attack.mitre.org/versions/v7/techniques/T1059/) Command and Scripting\nInterpreter\n\n\n[T1059.001](https://attack.mitre.org/versions/v7/techniques/T1059/001/) Command\nand Scripting\nInterpreter:\nPowerShell\n\n[T1059.005](https://attack.mitre.org/versions/v7/techniques/T1059/005/) Command\nand Scripting\nInterpreter:\nVisual Basic\n\n\nMekotio uses PowerShell to\nexecute its distribution chain\nstages.\n\nMekotio uses VBScript to\nexecute its distribution chain\nstages.\n\n\nMekotio is most commonly\nexecuted by abusing the\nlegitimate AutoIt interpreter.\n\nMekotio ensures persistence\nby using a Run key or creating\na LNK file in the startup folder.\n\nMekotio is executed by\nrunning a legitimate AutoIt\ninterpreter and passing a\nloader script for it to interpret.\n\nMekotio steals credentials\nfrom the Google Chrome\nbrowser.\n\nMekotio discovers various\nsecurity tools and banking\napplications based on window\nnames.\n\n\nPersistence [T1547.001](https://attack.mitre.org/versions/v7/techniques/T1547/001/) Boot or Logon Autostart\nExecution: Registry Run\nKeys / Startup Folder\n\n\nDefense\nEvasion\n\nCredential\nAccess\n\n\n[T1218](https://attack.mitre.org/versions/v7/techniques/T1218/) Signed Binary Proxy\nExecution\n\n[T1555.003](https://attack.mitre.org/versions/v7/techniques/T1555/003/) Credentials from Password\nStores: Credentials from\nWeb Browsers\n\n\nDiscovery [T1010](https://attack.mitre.org/versions/v7/techniques/T1010/) Application Window\nDiscovery\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\n\n[T1083](https://attack.mitre.org/versions/v7/techniques/T1083/) File and\nDirectory\nDiscovery\n\n[T1518.001](https://attack.mitre.org/versions/v7/techniques/T1518/001/) Software\nDiscovery:\nSecurity\nSoftware\nDiscovery\n\n[T1082](https://attack.mitre.org/versions/v7/techniques/T1082/) System\nInformation\nDiscovery\n\n\nMekotio discovers banking\nprotection software based on\nfile system paths.\n\nMekotio detects the\npresence of banking\nprotection products.\n\nMekotio collects information\nabout the victim's machine,\nsuch as firewall status and\nWindows version.\n\n\nCollection [T1056.001](https://attack.mitre.org/versions/v7/techniques/T1056/001/) Input Capture: Keylogging Mekotio is capable of\ncapturing keystrokes.\n\n\nCommand\nand Control\n\n\n[T1568.002](https://attack.mitre.org/versions/v7/techniques/T1568/002/) Dynamic Resolution: Domain\nGeneration Algorithms\n\n\nMekotio generates its C&C\ndomain using a DGA.\n\n\n[T1568.003](https://attack.mitre.org/versions/v7/techniques/T1568/003/) Dynamic\nResolution:\nDNS\nCalculation\n\n[T1095](https://attack.mitre.org/versions/v7/techniques/T1095/) NonApplication\nLayer\nProtocol\n\n\nMekotio uses an algorithm to\nmodify the resolved IP\naddress to obtain the actual\nC&C address.\n\nMekotio’s network protocol in\nvariants not using SQL is\nbased on\nRemote_Delphi_Access_PC.\n\n\nExfiltration [T1041](https://attack.mitre.org/versions/v7/techniques/T1041/) Exfiltration Over C2 Channel Mekotio sends the data it\nretrieves to its C&C server.\n\n[1][2]\n\n13 Aug 2020 - 11:30AM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n\n-----\n\n### Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-13 - Mekotio- These aren’t the security updates you’re looking for….pdf"
    ],
    "report_names": [
        "2020-08-13 - Mekotio- These aren’t the security updates you’re looking for….pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535789,
    "ts_updated_at": 1743041168,
    "ts_creation_date": 1653761372,
    "ts_modification_date": 1653761372,
    "files": {
        "pdf": "https://archive.orkl.eu/57070feaf0fd5eff93bd68f797bd8a109eb8df1a.pdf",
        "text": "https://archive.orkl.eu/57070feaf0fd5eff93bd68f797bd8a109eb8df1a.txt",
        "img": "https://archive.orkl.eu/57070feaf0fd5eff93bd68f797bd8a109eb8df1a.jpg"
    }
}