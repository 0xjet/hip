{
    "id": "09f89f31-44c1-4f99-8331-8f6ad12258ba",
    "created_at": "2023-01-12T15:05:24.823827Z",
    "updated_at": "2025-03-27T02:08:40.779649Z",
    "deleted_at": null,
    "sha1_hash": "c7530c972923d4c04deb5dd5496b4bc05737d3ad",
    "title": "2022-02-28 - How to Analyze Malicious Documents – Case Study of an Attack Targeting Ukrainian Organization",
    "authors": "",
    "file_creation_date": "2022-05-28T17:29:37Z",
    "file_modification_date": "2022-05-28T17:29:37Z",
    "file_size": 1384937,
    "plain_text": "# How to analyze malicious documents – Case study of an attack targeting Ukrainian Organizations\n\n**[cybergeeks.tech/how-to-analyze-malicious-documents-case-study-of-an-attack-targeting-ukraine-organizations/](https://cybergeeks.tech/how-to-analyze-malicious-documents-case-study-of-an-attack-targeting-ukraine-organizations/)**\n\nSummary\n\nThis article presents an analysis of two malicious files and the tools used. Our approach can\nbe generalized to any other malicious documents. The last document is a .docx file that was\nused to attack Ukrainian organizations in the context of the military conflict between Russia\nand Ukraine. OLE (Object Linking and Embedding) is a technology based on COM\n(Component Object Model) that allows objects to be linked or embedded into documents.\n\n**Analyst:** [@GeeksCyber](https://twitter.com/GeeksCyber)\n\nTechnical analysis\n\n**First Document**\n\nSHA256: c2672e6fd55b129125a19c7837943c0844c03ec02dcf165af183f9e4df4dccbc\n\nThe first file to be analyzed is an Excel document. The oleid tool is used to determine if the file\ncontains any macros:\n\n\n-----\n\nFigure 1\nThe olevba tool is utilized to obtain more information about the VBA macros found:\n\n\n-----\n\nFigure 2\nAs we can see above, the tool detected a malicious macro that will run when macros are\nenabled. The certutil.exe legitimate executable is used to download a malicious binary\n(Ugrfa.bat) from a remote server and run it.\n\nOledump is a program to analyze OLE files. By running this tool against the malicious file, we\ncan confirm it contains a macro (note the letter “M”):\n\nFigure 3\n\nThe same tool is utilized to dump and decompress the VBA macro:\n\nFigure 4\n\n\n-----\n\nViperMonkey is a VBA Emulation engine that can be used to analyze and deobfuscate\nmalicious VBA macros. The tool was able to detect the entry point function (workbook_open)\nand the routine responsible for downloading a malicious executable:\n\nFigure 5\nBecause this file is equivalent to a .zip archive, we can use zipdump in order to examine its\ncontent:\n\nFigure 6\nThe 7z tool is used to decompress the xlsm file. The core.xml file contains the creator of the\ndocument and the last modified by author (“Dell”), the created date/modified date of the\ndocument:\n\n\n-----\n\nFigure 7\nThe workbook.xml file contains 2 <sheet> elements that reference the worksheets in the\nworkbook:\n\nFigure 8\nSSView is a tool that can be utilized to analyze OLE2 Structured Storage files (vbaProject.bin\nin our case):\n\nFigure 9\nThisWorkbook is the workbook where the malicious macro code is running from:\n\n\n-----\n\nFigure 10\nThe above URL is classified as malicious by multiple vendors per VirusTotal (see figure 11). At\nthis point, we were able to identify the malicious macro using different tools.\n\nFigure 11\n**Second Document**\n\nSHA256: 992df82cf31a91acd034411bb43a1ec127fa15d613b108287384882807f81764\n\nThis document was sent to organizations in Ukraine via email.\n\nOleid is used to investigate the file, which doesn’t contain any VBA macros, as displayed in\nfigure 12:\n\n\n-----\n\nFigure 12\nWe’ve also utilized the olevba tool in order to confirm the above information. It’s better to\nvalidate the findings using different tools:\n\nFigure 13\nThree embedded objects were identified using the oledump tool:\n\n\n-----\n\nFigure 14\n\nWe’re able to determine that the objects are identical. The same tool is used to dump one of\nthem:\n\nFigure 15\nThe content of the .docx file can be found using the zipdump tool, as in the first case:\n\nFigure\n\n16\nThe 7z tool is used to decompress the file. The core.xml file contains the created\ndate/modified date of the document:\n\n\n-----\n\nFigure 17\nThe document.xml.rels relationship file is shown below (we can observe the embedded\nobjects, some images, and other xml files):\n\nFigure 18\nWe’ve analyzed the content of an embedded object using SSView:\n\nFigure 19\nThe OLE Compound File Stream object called “\\1Ole10Native” from figure 20 corresponds to\nthe embedded object:\n\n\n-----\n\nFigure 20\nBecause we know that the document doesn’t contain macros, we can open the document\nusing LibreOffice in Linux. It appears to be a redacted criminal investigation report from the\nNational Police of Ukraine:\n\n\n-----\n\nFigure 21\nThe exclamation marks that can be identified above lead to the embedded objects. When a\nuser clicks on the exclamation mark, the process writes a Javascript file in the Temp directory,\nwhich will be run using wscript:\n\n\n-----\n\nFigure 22\nThe purpose of the script is downloading a file from\nhttps[:]//cdn.discordapp.com/attachments/932413459872747544/938291977735266344/putty.exe\nand saving it as GoogleChromeUpdate.exe. The attackers tried to abuse Discord’s content\ndelivery network (CDN) in order to host their payload; however, VT recognizes the URL as\nmalicious\n(https://www.virustotal.com/gui/url/d261c441e28d7b4cea8171e9cf4cc2c403d39685b97800a5\n2604de979c5576b5). The Start-Process cmdlet is utilized to execute the downloaded file.\n[According to CERT-UA (https://cert.gov.ua/article/18419), this is supposed to be OutSteel](https://cert.gov.ua/article/18419)\nTrojan.\n\nReferences\n\n[https://zeltser.com/media/docs/analyzing-malicious-document-files.pdf](https://zeltser.com/media/docs/analyzing-malicious-document-files.pdf)\n\n[https://github.com/decalage2/oletools/](https://github.com/decalage2/oletools/)\n\n[https://github.com/decalage2/ViperMonkey](https://github.com/decalage2/ViperMonkey)\n\n[https://github.com/DidierStevens/DidierStevensSuite/blob/master/oledump.py](https://github.com/DidierStevens/DidierStevensSuite/blob/master/oledump.py)\n\n[https://github.com/DidierStevens/DidierStevensSuite/blob/master/zipdump.py](https://github.com/DidierStevens/DidierStevensSuite/blob/master/zipdump.py)\n\nhttps://www.virustotal.com/gui/url/d261c441e28d7b4cea8171e9cf4cc2c403d39685b97800a52\n604de979c5576b5\n\n[https://cert.gov.ua/article/18419](https://cert.gov.ua/article/18419)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-28 - How to Analyze Malicious Documents – Case Study of an Attack Targeting Ukrainian Organization.pdf"
    ],
    "report_names": [
        "2022-02-28 - How to Analyze Malicious Documents – Case Study of an Attack Targeting Ukrainian Organization.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535924,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1653758977,
    "ts_modification_date": 1653758977,
    "files": {
        "pdf": "https://archive.orkl.eu/c7530c972923d4c04deb5dd5496b4bc05737d3ad.pdf",
        "text": "https://archive.orkl.eu/c7530c972923d4c04deb5dd5496b4bc05737d3ad.txt",
        "img": "https://archive.orkl.eu/c7530c972923d4c04deb5dd5496b4bc05737d3ad.jpg"
    }
}