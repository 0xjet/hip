{
    "id": "a43b1faf-e0b4-4187-b96d-ab5908cc04f4",
    "created_at": "2023-01-12T15:02:11.782763Z",
    "updated_at": "2025-03-27T02:05:20.353844Z",
    "deleted_at": null,
    "sha1_hash": "5dc924a6594004473d423378f2c0d04181f20592",
    "title": "2019-05-23 - Sorpresa! JasperLoader targets Italy with a new bag of tricks",
    "authors": "",
    "file_creation_date": "2022-05-27T21:31:47Z",
    "file_modification_date": "2022-05-27T21:31:47Z",
    "file_size": 2213982,
    "plain_text": "# Sorpresa! JasperLoader targets Italy with a new bag of tricks\n\n**[blog.talosintelligence.com/2019/05/sorpresa-jasperloader.html](https://blog.talosintelligence.com/2019/05/sorpresa-jasperloader.html)**\n\n## Executive summary\n\nOver the past few months, a new malware loader called JasperLoader has emerged that\n\n\n-----\n\ntargets Italy and other European countries with banking trojans such as Gootkit. We recently\n[released a comprehensive analysis of the functionality associated with JasperLoader. Shortly](https://blog.talosintelligence.com/2019/04/jasperloader-targets-italy.html)\nafter the publication of our analysis, the distribution activity associated with these campaigns\nhalted. But after several weeks of relatively low volumes of activity, we discovered a new\nversion of JasperLoader being spread. This new version features several changes and\nimprovements from the initial version we analyzed. JasperLoader is typically used to infect\nsystems with additional malware payloads which can be used to exfiltrate sensitive\ninformation, damage systems or otherwise negatively impact organizations.\n\nThe attackers behind this specific threat have implemented additional mechanisms to control\nwhere the malware can spread and are now taking steps to avoid analysis by sandboxes and\nantivirus companies. There's also a new command and control (C2) mechanism to facilitate\ncommunications between infected systems and the infrastructure being used to control them.\nThe campaigns that are currently distributing JasperLoader continue to target Italian victims\nand further demonstrate that while JasperLoader is a relatively new threat, the developers\nbehind it are continuing to actively refine and improve upon this malware at a rapid pace and\nintroduce sophistication that is not commonly seen in financially motivated malware.\n\n## Delivery changes\n\nAs mentioned in our previous analysis of JasperLoader, the distribution campaigns\nattempting to spread this malware are relying heavily on certified email services in Italy.\nHowever, the actors have made some changes to the way distribution occurs.\n\nThe initial emails we saw contained ZIP files with VBS files inside them. These VBS files\nwere similar to the VBS and DOCM files we saw in the previous campaign and began the\ninfection process. The version with attached files didn't last long and was not very high in\nvolume.\n\nShortly afterward, we saw a new shift away from using attachments directly. In the case\nshown below, you can see the initial email being sent through the typical certified email\nservice that has been repeatedly leveraged by the actors behind JasperLoader.\n\n\n-----\n\nJust as we saw previously, the email is written in Italian and states that the original message\nis included as an attachment. You can see the original email titled \"postacert.eml\" attached.\nThe following pops up once the email is opened:\n\nThis is where the distribution process started to shift. There are not any attachments in the\nemail, but instead, there is a hyperlink that makes a connection to\nhxxp:\\\\tribunaledinapoli[.]recsinc[.]com/documento.zip with a parameter that is referenced in\nthe email. For example, above the full URL was\nhxxp:\\\\tribunaledinapoli[.]recsinc[.]com/documento.zip?214299. Note that the number\n214299 is the number referenced in the email itself. When we initially saw this change, we\nimmediately began to investigate and, initially, it appeared to be benign. The URL leads to an\nHTTP 302 response from the web server. HTTP 302 is the redirect code for temporarily\nmoved and has been abused by adversaries for years, including the use of 302 cushioning\nby exploit kits several years ago.\n\n\n-----\n\nThis particular 302 redirected to www.cnnic[.]cn, which is the Chinese Internet Network\nInformation Center (CNNIC), the organization responsible for internet affairs in the People's\nRepublic of China. Obviously, this isn't the place that an adversary would send a potential\nvictim to get compromised. It was at this point that we started looking at potential geofencing.\n\nGeofencing is a technique that some adversaries use to ensure that all the victims are from a\nparticular region or country and that researchers like us have more difficulty tracking down\nthe activity. It's something we've seen repeatedly used by advanced adversaries but is not\ncommonly done with crimeware threats like JasperLoader. In order to make that\ndetermination, we routed our traffic through Italian IP space and tried to follow the same link.\n\nWhen the traffic is routed through Italian IP space, the results are drastically different. The\nrequest is met with a ZIP file that contains a malicious VBS file that is similar to the samples\nwe found attached to emails earlier in the week. Once this VBS file is executed, the infection\nprocess kicks off and the loader is installed.\n\nAs we observed in previous campaigns, JasperLoader continues to leverage domain\nshadowing, and moves rapidly across subdomains that they control. The chart below shows\nthe DNS resolution activity associated with one of the C2 domains leveraged by\nJasperLoader. The scope if fairly limited, but more than 95 percent of resolutions came from\nItaly, so the geofencing protections they put into place appear to be somewhat successful.\n\n\n-----\n\nLet's now walk through the new infection process where we highlight some of the evolutions\nwe've discovered.\n\n## JasperLoader functionality changes\n\nThe infection process associated with JasperLoader continues to feature multiple stages\nwhich are used to establish a foothold on systems, initiate communications with attackercontrolled infrastructure and implement the core functionality of the loader. While much of the\nprocess functions similar to what was described in our previous analysis of JasperLoader,\nthere have been several notable changes to the malware's operation, which are described in\nthe following sections.\n\n### Additional layers of obfuscation\n\nSimilar to what was previously seen in the JasperLoader infection process, the attackers rely\nupon several layers of obfuscation to attempt to hide the operation of the malware. In\ngeneral, they leverage character replacement mechanisms and perform mathematical\ncalculations at runtime to reconstruct the PowerShell instructions that will be executed on\ninfected systems. This same process is used by the Visual Basic Script (VBS) downloader\nobserved across these campaigns.\n\n\n-----\n\nIn current campaigns spreading JasperLoader, the attackers have introduced an additional\nlayer of character replacement to further obfuscate the underlying PowerShell. Once the\nVBS has been deobfuscated, the underlying PowerShell is:\n\n\n-----\n\nReplacing each of the characters in the previous image results in the Stage 1 PowerShell\nthat is used to retrieve additional stages from attacker controlled servers. An example of this\nstage of PowerShell is:\n\nThis PowerShell is similar to what was seen in previous JasperLoader campaigns with a few\nnotable differences.\n\n### Decoy documents\n\nAs can be seen in the PowerShell associated with Stage 1, a PDF is retrieved from the\nspecified URL and displayed to the user. This PDF is not overtly malicious and is simply\ndesigned to function as a decoy document so that when a user executes the VBS, there's an\nexpected result.\n\n\n-----\n\nWhile victims will simply see the PDF above, in the background, the infection process is\ncontinuing with the malware attempting to retrieve Stage 2.\n\n### Geolocation filtering\n\nOne of the changes made in JasperLoader is the introduction of additional geolocationbased filtering. Geolocation-based filtering was also being leveraged during the delivery\nstage of the infection process. In previous versions of JasperLoader, the malware would use\nthe Get-UICulture PowerShell cmdlet at each stage of the infection process and terminate if\nthe system was configured to use the language pack associated with People's Republic of\nChina, Russia, Ukraine or Belarus. The latest version of JasperLoader has added an\nadditional check for Romanian and will exit if any of these language settings are in use.\n\n### Virtual machine/Sandbox detection\n\n\n-----\n\nAnother new feature that has been added in the latest version of JasperLoader is detection\nfor hypervisor-based environments. In many cases, malware will perform various checks to\ndetermine if it being executed in a virtual environment and terminate execution to avoid being\nanalyzed by sandbox or anti-malware solutions\n\nThe latest version of JasperLoader has introduced mechanisms that query the Windows\nManagement Instrumentation (WMI) subsystem to obtain the model of the system that is\nbeing infected. The model identifier is then checked so see if it matches the following\nhypervisors:\n\nVirtualBox\nVMware\nKVM\n\nIf so, the malware terminates execution and does not attempt to perform any additional\nactions on the system. These same checks are performed at each stage of the infection\nprocess.\n\n### Stage 3 functionality/Payload retrieval\n\nWhile there have been minor changes at Stage 2, they are mostly related to file storage\nlocations, file naming conventions, and other characteristics are frequently modified on a\ncampaign by campaign basis, but the overall functionality and process of retrieving,\ndeobfuscating, and executing Stage 2 to obtain Stage 3 remains relatively unchanged. For\n[details of how this process works, please refer to our previous blog here.](https://blog.talosintelligence.com/2019/04/jasperloader-targets-italy.html)\n\nThe majority of the ongoing development activity appears to have been focused on Stage 3\nof the JasperLoader infection process as that is where most of the JasperLoader functionality\nresides. The latest version of JasperLoader has changed how the malware attempts to\npersist across reboots, has introduced mechanisms to protect C2 communications, and\nadded more robust mechanisms for ensuring that updates to JasperLoader get propagated\nefficiently to all of the systems that are part of the JasperLoader botnet.\n\n### Persistence mechanism\n\nIn previous versions of JasperLoader, the malware would obtain persistence on infected\nsystems by creating a malicious Windows shortcut (LNK) in the Startup folder on the system.\n\n\n-----\n\nThe latest version of JasperLoader accomplishes this using the Task Scheduler, as well. A\nscheduled task is created on infected systems using the following syntax:\n```\nschtasks.exe /create /TN \"Windows Indexing Service\" /sc DAILY /st 00:00 /f /RI 20 /du\n24:59 /TR (Join-Path $bg_GoodPAth 'WindowsIndexingService.js');\n\n```\nThis creates a Scheduled Task that will relaunch JasperLoader periodically. If this process\nfails, JasperLoader will then revert back to the use of the shortcut for persistence.\n\n### Failback C2 mechanism\n\nOne of the features that has been added to JasperLoader is a failback C2 domain retrieval\nmechanism that allows for time-based fluxing. A default C2 domain is specified. If that\ndomain is not available, the current date on the system is used to generate a series of\nfailback domains that the malware will attempt to use for C2 communications.\n\n### Bot registration\n\nThe malware has also implemented a new bot registration and ID generation mechanism\nand utilizes different pieces of information to create a unique identifier for each system than\nwhat was seen in previous versions of JasperLoader. As before, this information is\ncommunicated to the C2 as parameters within an HTTP GET request and is generated using\nthe following:\n\n\n-----\n\n### Interesting PowerShell artifacts\n\nOne interesting artifact present in the PowerShell associated with Stage 3 of JasperLoader is\nin the function responsible for defining the C2 domain to use for future communications. The\nfunction is called BG_SelectDomen(). The word \"domen\" translates to \"domain\" and is a\nword that is widely used in multiple countries, including Romania.\n\nWhile this is a low-confidence indicator, it is interesting in relation to the apparent targeting of\nthis malware as well as the geolocational checking that is performed to determine whether it\nshould continue to execute on infected systems.\n\n### Payload delivery\n\nDuring our analysis of the latest JasperLoader campaigns, we were unable to receive the\ncommands and URL information required to obtain a malicious PE32 from the attacker's C2\ninfrastructure. We did note that the C2 communications channel remained active and was\nbeaconing.\n\n\n-----\n\nThis may be due to JasperLoader not being actively used to spread additional payloads at\nthis time. The botnet operator may be attempting to obtain JasperLoader infections in order\nto build out capabilities so that they can be monetized for the purposes of leveraging the\nbotnet to distribute additional malware in the future. We have seen reports indicating that\nGootKit may again be the payload of choice for this campaign. GootKit was the payload\nduring the previous campaign we analyzed, so its inclusion in this campaign seems likely.\n\n## Conclusion\n\nAs illustrated by these new JasperLoader campaigns, adversaries are always going to take\nsteps to try and increase their ability to infect victims, while at the same time evading\ndetection and analysis. JasperLoader has taken that to the extreme and has quickly\ndeveloped additional capabilities and added additional layers of obfuscation, while at the\nsame time taking steps to evade virtual machines and geofence their victims in Italy. The\nmajority of these changes came rapidly and demonstrate the author's commitment to making\nJasperLoader a robust, flexible threat that can be updated rapidly as security controls and\ndetection capabilities change. Despite all these steps, we are still able to derive enough\nintelligence to expose their activities and protect our customers and the general public from\ntheir malicious intentions.\n\nJasperLoader is another prime example of how rapidly threats can change and illustrates just\nhow important threat intelligence is to ensuring that organizations are prepared to defend\nagainst them even as adversaries are constantly investing time, effort, and resources into\nimproving upon their tools as they attempt to stay ahead of defenses deployed on enterprise\nnetworks. As techniques become less effective, cybercriminals will continue to move to other\ntechniques to maximize their success in achieving their mission objectives. While\nJasperLoader is still relatively new compared to other established malware loaders out there,\nthey have demonstrated that they will continue to improve upon this malware and leverage it\nagainst organizations. It is expected that as this botnet continues to grow, it will likely\nbecome more heavily leveraged for the distribution of various malware payloads as the\noperators of this botnet can make use of already infected systems at the push of a button or\nthe issuance of a command.\n\n## Coverage\n\nWays our customers can detect and block this threat are listed below.\n\n\n-----\n\n[Advanced Malware Protection (AMP) is ideally suited to prevent the execution of the](https://www.cisco.com/c/en/us/products/security/advanced-malware-protection)\nmalware detailed in this post. Below is a screenshot showing how AMP can protect\ncustomers from this threat. Try AMP for free [here.](https://cisco.com/go/tryamp)\n\n[Cisco Cloud Web Security (CWS) or Web Security Appliance (WSA) web scanning prevents](https://www.cisco.com/c/en/us/products/security/cloud-web-security/index.html)\naccess to malicious websites and detects malware used in these attacks.\n\n[Email Security can block malicious emails sent by threat actors as part of their campaign.](https://www.cisco.com/c/en/us/products/security/email-security-appliance/index.html)\n\n[Network Security appliances such as Next-Generation Firewall (NGFW), Next-Generation](https://www.cisco.com/c/en/us/products/security/firewalls/index.html)\n[Intrusion Prevention System (NGIPS), and](https://www.cisco.com/c/en/us/products/security/intrusion-prevention-system-ips/index.html) [Meraki MX can detect malicious activity](https://meraki.cisco.com/products/appliances)\nassociated with this threat.\n\n[AMP Threat Grid helps identify malicious binaries and build protection into all Cisco Security](https://www.cisco.com/c/en/us/solutions/enterprise-networks/amp-threat-grid/index.html)\nproducts.\n\n[Umbrella, our secure internet gateway (SIG), blocks users from connecting to malicious](https://umbrella.cisco.com/)\ndomains, IPs, and URLs, whether users are on or off the corporate network.\n\nAdditional protections with context to your specific environment and threat data are available\nfrom the [Firepower Management Center.](https://www.cisco.com/c/en/us/products/security/firepower-management-center/index.html)\n\nOpen Source Snort Subscriber Rule Set customers can stay up to date by downloading the\n[latest rule pack available for purchase on Snort.org.](https://www.snort.org/products)\n\n## Indicators of compromise\n\nThe following IOCs are associated with various malware distribution campaigns that were\nobserved during the analysis of JasperLoader activity.\n\n\n-----\n\n### Domains\n\nA list of domains observed to be associated with JasperLoader are below.\n\nbreed[.]wanttobea[.]com\n\nzzi[.]aircargox[.]com\n\nnono[.]littlebodiesbigsouls[.]com\n\ntribunaledinapoli[.]recsinc[.]com\n\ntribunaledinapoli[.]prepperpillbox[.]com\n\ntribunaledinapoli[.]lowellunderwood[.]com\n\ntribunaledinapoli[.]rntman.com\n\n### IP addresses\n\nA list of IP addresses observed to be associated with JasperLoader are below.\n\n185[.]158[.]251[.]171\n\n185[.]158[.]249[.]116\n\n### Hashes\n\nA list of file hashes (SHA256) observed to be associated with JasperLoader are below.\n\n052c9895383eb10e4ad5bec37822f624e443bbe01700b1fe5abeeea757456aed\n\n54666103a3c8221cf3d7d39035b638f3c3bcc233e1916b015aeee2539f38f719\n\nee3601c6e111c42d02c83b58b4fc70265b937e9d4d153203a4111f51a8a08aab\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-23 - Sorpresa! JasperLoader targets Italy with a new bag of tricks.pdf"
    ],
    "report_names": [
        "2019-05-23 - Sorpresa! JasperLoader targets Italy with a new bag of tricks.pdf"
    ],
    "threat_actors": [
        {
            "id": "3c7097f4-849b-4bc0-a7e6-ba2b510722b6",
            "created_at": "2022-10-25T16:07:23.869951Z",
            "updated_at": "2025-03-27T02:02:10.003542Z",
            "deleted_at": null,
            "main_name": "Mikroceen",
            "aliases": [
                "SixLittleMonkeys"
            ],
            "source_name": "ETDA:Mikroceen",
            "tools": [
                "AngryRebel",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "Microcin",
                "Mikroceen",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "PCRat",
                "logon.dll",
                "logsupport.dll",
                "pcaudit.bat",
                "sqllauncher.dll"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535731,
    "ts_updated_at": 1743041120,
    "ts_creation_date": 1653687107,
    "ts_modification_date": 1653687107,
    "files": {
        "pdf": "https://archive.orkl.eu/5dc924a6594004473d423378f2c0d04181f20592.pdf",
        "text": "https://archive.orkl.eu/5dc924a6594004473d423378f2c0d04181f20592.txt",
        "img": "https://archive.orkl.eu/5dc924a6594004473d423378f2c0d04181f20592.jpg"
    }
}