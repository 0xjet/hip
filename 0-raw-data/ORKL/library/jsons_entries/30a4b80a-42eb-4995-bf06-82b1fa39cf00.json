{
    "id": "30a4b80a-42eb-4995-bf06-82b1fa39cf00",
    "created_at": "2023-01-12T15:05:24.882433Z",
    "updated_at": "2025-03-27T02:05:28.704048Z",
    "deleted_at": null,
    "sha1_hash": "8aca0d0c77e3b282e99dcc186a833acb23afc004",
    "title": "2020-04-07 - Unkillable xHelper and a Trojan matryoshka",
    "authors": "",
    "file_creation_date": "2022-09-01T10:22:06Z",
    "file_modification_date": "2022-09-01T10:22:06Z",
    "file_size": 847700,
    "plain_text": "# Unkillable xHelper and a Trojan matryoshka\n\n**[securelist.com/unkillable-xhelper-and-a-trojan-matryoshka/96487/](https://securelist.com/unkillable-xhelper-and-a-trojan-matryoshka/96487/)**\n\nAuthors\n\nIgor Golovin\n\nIt was the middle of last year that we detected the start of mass attacks by the xHelper\nTrojan on Android smartphones, but even now the malware remains as active as ever. The\nmain feature of xHelper is entrenchment — once it gets into the phone, it somehow remains\nthere even after the user deletes it and restores the factory settings. We conducted a\nthorough study to determine how xHelper’s creators furnished it with such survivability.\n\n\n-----\n\nShare of Kaspersky users attacked by the xHelper Trojan in the total number of attacks, 2019-2020\n\n[(download)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2020/05/12150838/xhelper_en-map.png)\n\n## How does xHelper work?\n\nLet’s analyze the family’s logic based on the currently active sample TrojanDropper.AndroidOS.Helper.h. The malware disguises itself as a popular cleaner and speedup app for smartphones, but in reality there is nothing useful about it: after installation, the\n“cleaner” simply disappears and is nowhere to be seen either on the main screen or in the\nprogram menu. You can see it only by inspecting the list of installed apps in the system\nsettings.\n\nThe Trojan’s payload is encrypted in the file /assets/firehelper.jar (since its encryption is\npractically unchanged from earlier versions, it was not difficult to decrypt). Its main task is to\nsend information about the victim’s phone (android_id, manufacturer, model, firmware\nversion, etc.) to https://lp.cooktracking[.]com/v1/ls/get…\n\n\n-----\n\n**_Decrypting the URL for sending device information_**\n\n…and downloading the next malicious module — Trojan-Dropper.AndroidOS.Agent.of.\n\nThis malware in turn decrypts and launches its payload using a bundled native library; this\napproach makes it difficult to analyze the module. At this stage, the next dropper, TrojanDropper.AndroidOS.Helper.b, is decrypted and launched. This in turn runs the malware\nTrojan-Downloader.AndroidOS.Leech.p, which further infects the device.\n\nLeech.p is tasked with downloading our old friend HEUR:Trojan.AndroidOS.Triada.dd with a\nset of exploits for obtaining root privileges on the victim’s device.\n\n\n-----\n\n**_Decoding the URL of the Leech.p C&C_**\n\n**_Downloading the Triada Trojan_**\n\nMalicious files are stored sequentially in the app’s data folder, which other programs do not\nhave access to. This matryoshka-style scheme allows the malware authors to obscure the\ntrail and use malicious modules that are known to security solutions. The malware can gain\nroot access mainly on devices running Android versions 6 and 7 from Chinese\nmanufacturers (including ODMs). After obtaining privileges, xHelper can install malicious files\ndirectly in the system partition.\n\nNote here that the system partition is mounted at system startup in read-only mode. Armed\nwith root rights, the Trojan remounts it in write mode and proceeds to the main job of starting\nthe tellingly named script forever.sh. Triada employs its best-known tricks, including\n\n\n-----\n\nremounting the system partition to install its programs there. In our case, the package\ncom.diag.patches.vm8u is installed, which we detect as Trojan-Dropper.AndroidOS.Tiny.d.\n\nAnd several executable files get copied to the /system/bin folder:\n\npatches_mu8v_oemlogo — Trojan.AndroidOS.Triada.dd\ndebuggerd_hulu —AndroidOS.Triada.dy\nkcol_ysy — HEUR:Trojan.AndroidOS.Triada.dx\n/.luser/bkdiag_vm8u_date — HEUR:Trojan.AndroidOS.Agent.rt\n\nA few more files are copied to the /system/xbin folder:\n\ndiag_vm8u_date\npatches_mu8v_oemlogo\n\nA call to files from the xbin folder is added to the file install-recovery.sh, which allows Triada\nto run at system startup. All files in the target folders are assigned the immutable attribute,\nwhich makes it difficult to delete the malware, because the system does not allow even\nsuperusers to delete files with this attribute. However, this self-defense mechanism\nemployed by the Trojan can be countered by deleting this attribute using the chattr\ncommand.\n\nThe question arises: if the malware is able to remount the system partition in write mode in\norder to copy itself there, can the user adopt the same strategy to delete it? Triada’s creators\nalso contemplated this question, and duly applied another protection technique that involved\nmodifying the system library /system/lib/libc.so. This library contains common code used by\nalmost all executable files on the device. Triada substitutes its own code for the mount\nfunction (used to mount file systems) in libc, thereby preventing the user from mounting the\n/system partition in write mode.\n\nOn top of that, the Trojan downloads and installs several more malicious programs (for\nexample, HEUR:Trojan-Dropper.AndroidOS.Necro.z), and deletes root access control\napplications, such as Superuser.\n\n## How to get rid of xHelper?\n\nAs follows from the above, simply removing xHelper does not entirely disinfect the system.\nThe program com.diag.patches.vm8u, installed in the system partition, reinstalls xHelper and\nother malware at the first opportunity.\n\n\n-----\n\n**_Installing programs without user participation_**\n\nBut if you have Recovery mode set up on your Android smartphone, you can try to extract\nthe libc.so file from the original firmware and replace the infected one with it, before removing\nall malware from the system partition. However, it’s simpler and more reliable to completely\nreflash the phone.\n\nBear in mind too that the firmware of smartphones attacked by xHelper sometimes contains\npreinstalled malware that independently downloads and installs programs (including\nxHelper). In this case, reflashing is pointless, so it would be worth considering alternative\nfirmwares for your device. If you do use a different firmware, remember that some of the\ndevice’s components might not operate properly.\n\nIn any event, using a smartphone infected with xHelper is extremely dangerous. The\nmalware installs a backdoor with the ability to execute commands as a superuser. It provides\nthe attackers with full access to all app data and can be used by other malware too, for\nexample, CookieThief.\n\n## C&C\n\n[lp.cooktracking[.]com/v1/ls/get](https://opentip.kaspersky.com/lp.cooktracking.com)\n\n[www.koapkmobi[.]com:8081](https://opentip.kaspersky.com/koapkmobi.com:8081)\n\n[45.79.110.191](https://opentip.kaspersky.com/45.79.110.191%2Fadmin201506%2FuploadApkFile%2Frt%2F20170405%2Felfm21.zip)\n\n\n-----\n\n[45.33.9.178](https://opentip.kaspersky.com/45.33.9.178%2Fadmin201506%2FuploadApkFile%2Frt%2F20190515%2Frts2019051510.zip)\n[23.239.4.169](https://opentip.kaspersky.com/23.239.4.169%2Fadmin201506%2FuploadApkFile%2Frt%2F20171231%2Fdk916.data)\n\n[172.104.215.170](https://opentip.kaspersky.com/172.104.215.170%2Fadmin201506%2FuploadApkFile%2Frt%2F20171228%2Fdk912.data)\n\n[172.​104.​208.​241](https://opentip.kaspersky.com/172.104.208.241%2Fadmin201506%2FuploadApkFile%2Frt%2F20161125%2Flookupalldata2.zip)\n\n[172.​104.​212.​184](https://opentip.kaspersky.com/172.104.212.184%2Fadmin201506%2FuploadApkFile%2Frt%2F20161119%2Fdzxex2.zip)\n\n[45.​33.​117.​188](https://opentip.kaspersky.com/45.33.117.188%2Fadmin201506%2FuploadApkFile%2Frt%2F20181017%2Fercisu-release.apk)\n\n[172.​104.​216.​43](https://opentip.kaspersky.com/172.104.216.43%2Fadmin201506%2Fuploadapkfile%2Frt%2F20161125%2Flookupalldata2.zip)\n\n[172.​104.​218.​166](https://opentip.kaspersky.com/172.104.218.166%2Fadmin201506%2Fuploadapkfile%2Frt%2F20171227%2F356.zip)\n\n[104.​200.​16.​77](https://opentip.kaspersky.com/104.200.16.77%2Fadmin201506%2FuploadApkFile%2Frt%2F20161125%2Flookupalldata2.zip)\n\n[198.​58.​123.​253](https://opentip.kaspersky.com/198.58.123.253%2Fadmin201506%2Fuploadapkfile%2Frt%2F20171227%2F356.zip)\n\n[172.​104.​211.​160](https://opentip.kaspersky.com/172.104.211.160%2Fadmin201506%2Fuploadapkfile%2Frt%2F20161125%2Flookupalldata2.zip)\n\n[172.​104.​210.​184](https://opentip.kaspersky.com/172.104.210.184%2Fadmin201506%2Fuploadapkfile%2Frt%2F20161125%2Flookupalldata2.zip)\n\n[162.​216.​18.​240](https://opentip.kaspersky.com/162.216.18.240%2Fadmin201506%2FuploadApkFile%2Frt%2F20181114%2Ffingerscan.apk)\n\n[172.​104.​212.​4](https://opentip.kaspersky.com/172.104.212.4%2Fadmin201506%2Fuploadapkfile%2Frt%2F20171227%2F356.zip)\n\n[172.​104.​214.​199](https://opentip.kaspersky.com/172.104.214.199%2Fadmin201506%2Fuploadapkfile%2Frt%2F20161125%2Flookupalldata2.zip)\n\n[172.​104.​212.​202](https://opentip.kaspersky.com/172.104.212.202%2Fadmin201506%2Fuploadapkfile%2Frt%2F20161125%2Flookupalldata2.zip)\n\n[172.​104.​209.​55](https://opentip.kaspersky.com/172.104.209.55%2Fadmin201506%2FuploadApkFile%2Frt%2F20161125%2Flookupalldata2.zip)\n\n[172.​104.​219.​210](https://opentip.kaspersky.com/172.104.219.210%2Fadmin201506%2FuploadApkFile%2Frt%2F20181017%2Fercisu-release.apk)\n\n[172.​104.​218.​146](https://opentip.kaspersky.com/172.104.218.146%2Fadmin201506%2FuploadApkFile%2F20180731%2F511163059.apk)\n\n[45.​79.​177.​230](https://opentip.kaspersky.com/45.79.177.230%2Fadmin201506%2FuploadApkFile%2F20161114%2F251185313.apk)\n\n[45.​33.​0.​123](https://opentip.kaspersky.com/45.33.0.123%2Fadmin201506%2FuploadApkFile%2F20151103%2F376163727.apk)\n\n[45.​79.​77.​161](https://opentip.kaspersky.com/45.79.77.161%2Fadmin201506%2FuploadApkFile%2F20151103%2F376163727.apk)\n\n[45.​33.​120.​75](https://opentip.kaspersky.com/45.33.120.75%2Fadmin201506%2FuploadApkFile%2F20151218%2F635224404.apk)\n\n[45.​79.​171.​160](https://opentip.kaspersky.com/45.79.171.160%2Fadmin201506%2FuploadApkFile%2F20151103%2F376163727.apk)\n\n[172.​104.​210.​193](https://opentip.kaspersky.com/172.104.210.193%2Fadmin201506%2FuploadApkFile%2Frt%2F20161125%2Flookupalldata2.zip)\n\n[45.​33.​0.​176](https://opentip.kaspersky.com/45.33.0.176%2Fadmin201506%2FuploadApkFile%2F20170719%2F540205237.apk)\n\n[45.​79.​146.​48](https://opentip.kaspersky.com/45.79.146.48%2Fadmin201506%2FuploadApkFile%2F20160413%2F541170146.apk)\n\n[ddl.​okyesmobi[.​]com](https://opentip.kaspersky.com/ddl.%E2%80%8Bokyesmobi.%E2%80%8Bcom)\n\n[45.​79.​151.​241](https://opentip.kaspersky.com/45.79.151.241%2Fadmin201506%2FuploadApkFile%2F20160414%2F969093518.apk)\n\n[172.​104.​213.​65](https://opentip.kaspersky.com/172.104.213.65%2Fadmin201506%2Fuploadapkfile%2Frt%2F20171227%2F356.zip)\n\n[172.​104.​211.​117](https://opentip.kaspersky.com/172.104.211.117%2Fadmin201506%2FuploadApkFile%2Frt%2F20180408%2Fjeadme.apk)\n\n[ddl.​okgoodmobi[.​]com](https://opentip.kaspersky.com/ddl.%E2%80%8Bokgoodmobi.%E2%80%8Bcom)\n\n## MD5\n\nTrojan-Dropper.AndroidOS.Helper.h — [59acb21b05a16c08ade1ec50571ba5d4](https://opentip.kaspersky.com/59acb21b05a16c08ade1ec50571ba5d4)\n[Trojan-Dropper.AndroidOS.Agent.of — 57cb18969dfccfd3e22e33ed5c8c66ce](https://opentip.kaspersky.com/57cb18969dfccfd3e22e33ed5c8c66ce)\n\nTrojan-Dropper.AndroidOS.Helper.b — [b5ccbfd13078a341ee3d5f6e35a54b0a](https://opentip.kaspersky.com/b5ccbfd13078a341ee3d5f6e35a54b0a)\n\n[Trojan-Downloader.AndroidOS.Leech.p — 5fdfb02b94055d035e38a994e1f420ae](https://opentip.kaspersky.com/5fdfb02b94055d035e38a994e1f420ae)\n\nTrojan.AndroidOS.Triada.dd — [617f5508dd3066de7ec647bdd1497118](https://opentip.kaspersky.com/617f5508dd3066de7ec647bdd1497118)\n\nTrojan-Dropper.AndroidOS.Tiny.d — [21ae93aa54156d0c6913243cb45700ec](https://opentip.kaspersky.com/21ae93aa54156d0c6913243cb45700ec)\n\nTrojan.AndroidOS.Triada.dd — [105265b01bac8e224e34a700662ffc4c8](https://opentip.kaspersky.com/105265b01bac8e224e34a700662ffc4c)\n\n\n-----\n\n[Trojan.AndroidOS.Agent.rt — 95e2817a37c317b17de42e565475f40f](https://opentip.kaspersky.com/95e2817a37c317b17de42e565475f40f)\n[Trojan.AndroidOS.Triada.dy — cfe7d8c9c1e43ca02a4b1852cb34d5a5](https://opentip.kaspersky.com/cfe7d8c9c1e43ca02a4b1852cb34d5a5)\n\n[Trojan.AndroidOS.Triada.dx — e778d4cc1a7901689b59e9abebc925e1](https://opentip.kaspersky.com/e778d4cc1a7901689b59e9abebc925e1)\n\nTrojan-Dropper.AndroidOS.Necro.z — [2887ab410356ea06d99286327e2bc36b](https://opentip.kaspersky.com/2887ab410356ea06d99286327e2bc36b)\n\n[Google Android](https://securelist.com/tag/google-android/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[Malware Statistics](https://securelist.com/tag/malware-statistics/)\n[Malware Technologies](https://securelist.com/tag/malware-technologies/)\n[Trojan](https://securelist.com/tag/trojan/)\n\nAuthors\n\nIgor Golovin\n\nUnkillable xHelper and a Trojan matryoshka\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-04-07 - Unkillable xHelper and a Trojan matryoshka.pdf"
    ],
    "report_names": [
        "2020-04-07 - Unkillable xHelper and a Trojan matryoshka.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535924,
    "ts_updated_at": 1743041128,
    "ts_creation_date": 1662027726,
    "ts_modification_date": 1662027726,
    "files": {
        "pdf": "https://archive.orkl.eu/8aca0d0c77e3b282e99dcc186a833acb23afc004.pdf",
        "text": "https://archive.orkl.eu/8aca0d0c77e3b282e99dcc186a833acb23afc004.txt",
        "img": "https://archive.orkl.eu/8aca0d0c77e3b282e99dcc186a833acb23afc004.jpg"
    }
}