{
    "id": "f86af6a8-35f0-4c5b-b5e4-954a37ea490c",
    "created_at": "2022-10-25T16:48:18.060822Z",
    "updated_at": "2025-03-27T02:16:52.985249Z",
    "deleted_at": null,
    "sha1_hash": "ae90917c7abe0c38ae289be9589f04c6fa7184c0",
    "title": "Vinself Now With Steganography",
    "authors": "Airbus",
    "file_creation_date": "2014-12-15T20:52:02Z",
    "file_modification_date": "2014-12-15T20:52:02Z",
    "file_size": 183309,
    "plain_text": "[VinSelf is a known RAT malware already explained on other blogs . It's a family that has been long used in](https://www.fireeye.com/blog/threat-research/2010/11/winself-a-new-backdoor-in-town.html)\n\nAPT attacks. VinSelf can be recognized in two ways:\n\nthe network patterns used;\n\nthe strings obfuscation in the binary.\n\nThe VinSelf obfuscation algorithm is quite simple, but specific enough to state that samples using it are\n\nfrom the same family:\n\ndef vinself_cipher(x, key):\n\noutput = \"\"\n\nlkey = ord(x[0])\n\nfor i in xrange(len(x)-1):\n\noutput += chr( ( ( ord(x[i+1]) ^ ord(key[i]) ) - lkey) & 0xff)\n\nlkey = ord(x[i+1])\n\nreturn output\n\nRecently, we came accross an interesting sample that, instead of connecting to a malicious C&C, was\n\ngrabbing a file (\"colors.bmp\") from Google Docs. Due to the presence of the aforementioned algorithm,\n\nthe sample had been categorized as VinSelf, so such a behavior was unexpected and confusing.\n\n## Starting point\n\nWhile the image is a valid Bitmap and can actually be displayed, it may be something more than a simple\n\nBitmap.\n\nWe have seen pieces of malware appending data at the end of legitimate/innofensive files being retrieved.\n\n[For example, VinSelf itself sends encrypted data to its C&C prepended by a \"GIF89a\" header. Foxy also](http://www.cyberesi.com/2011/08/31/trojan-foxy/)\n\n[receives encrypted commands from its C&C in what seems a legitimate JPEG image, and Shady RAT is](http://www.symantec.com/connect/blogs/truth-behind-shady-rat)\n\nconcealing commands in encrypted HTML commentaries, or inside images using real steganography.\n\nLet's look at the code following the retrieval of this file from Google Docs if there's something interesting.\n\n## Steganography\n\nThe function following the retrieval of the \"colors.bmp\" file is quite interesting.\n\n\n-----\n\n-----\n\ncounter, the next one is incrementing the column counter while the innermost one is a loop among the\n\nthree primary colors.\n\nThe function is grabbing the LSB (Least Significant Bit) of each color of each pixel, thus generating three\n\nbits of data per pixel of the image. Once all those LSBs have been grabbed, each byte of the bitstream is\n\nreversed.\n\n## Unciphering\n\nNow that we have extracted the hidden data, it must be unciphered: this is done in four steps:\n\nthe first step is the use of the VinSelf custom obfuscation algorithm with an hard-coded key in the\n\nbinary;\n\nthe second step is another use of the VinSelf custom obfuscation algorithm with the key decoded at\n\nthe previous step on the next 32 bytes of the data;\n\nthe third step is a decryption algorithm that was, at first, unknown to us. Thanks to the specific\n\nbitwise manipulations employed by this code (shifts and rotations) and to the quick and efficient\n\n[research of our cryptoteam, it was successfully identified as HC-128, a stream cipher that is not used](http://www.ecrypt.eu.org/stream/p3ciphers/hc/hc128_p3.pdf)\n\nthat much;\n\nfinally, the fourth and last step is once again the use of the VinSelf custom obfuscation algorithm\n\nwith the key used in the second step on the HC-128 decrypted data.\n\n## End point\n\nUltimately we end up with a C&C configuration that looks like:\n\n192.168.1.101:2.2.2.2:3.3.3.3:4.4.4.4\n\nAs a matter of fact, we changed the real content in the source image to not disclose the real C&C.\n\nSo instead of having just one layer of obfuscation (the custom VinSelf algorithm), we end up with several\n\nlayers:\n\nthe custom VinSelf algorithm encrypting the Google Docs URL;\n\nan LSB-extraction steganography;\n\ntwo instances of the VinSelf algorithm;\n\nan HC-128 encryption;\n\na final VinSelf encryption.\n\n\n-----\n\nrepository.\n\nSteganography is not just for hipsters, it is still being used nowadays.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/uy1tzn58yjoarnrftgs9d8ieucwf4029",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.12.12.Vinself/Vinself_steganography.pdf"
    ],
    "report_names": [
        "Vinself_steganography"
    ],
    "threat_actors": [
        {
            "id": "cf7fc640-acfe-41c4-9f3d-5515d53a3ffb",
            "created_at": "2023-01-06T13:46:38.228042Z",
            "updated_at": "2025-03-27T02:00:02.775905Z",
            "deleted_at": null,
            "main_name": "APT1",
            "aliases": [
                "GIF89a",
                "G0006",
                "PLA Unit 61398",
                "Group 3",
                "TG-8223",
                "Comment Group",
                "ShadyRAT",
                "COMMENT PANDA",
                "Comment Crew",
                "Byzantine Candor",
                "Brown Fox"
            ],
            "source_name": "MISPGALAXY:APT1",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3aaf0755-5c9b-4612-9f0e-e266ef1bdb4b",
            "created_at": "2022-10-25T16:07:23.480196Z",
            "updated_at": "2025-03-27T02:02:09.826059Z",
            "deleted_at": null,
            "main_name": "Comment Crew",
            "aliases": [
                "APT 1",
                "BrownFox",
                "Byzantine Candor",
                "Byzantine Hades",
                "Comment Crew",
                "Comment Panda",
                "GIF89a",
                "Group 3",
                "Operation Oceansalt",
                "Operation Seasalt",
                "Operation Siesta",
                "Shanghai Group",
                "TG-8223"
            ],
            "source_name": "ETDA:Comment Crew",
            "tools": [
                "Auriga",
                "Cachedump",
                "Chymine",
                "CookieBag",
                "Darkmoon",
                "GDOCUPLOAD",
                "GLOOXMAIL",
                "GREENCAT",
                "Gen:Trojan.Heur.PT",
                "GetMail",
                "Hackfase",
                "Hacksfase",
                "Helauto",
                "Kurton",
                "LETSGO",
                "LIGHTBOLT",
                "LIGHTDART",
                "LOLBAS",
                "LOLBins",
                "LONGRUN",
                "Living off the Land",
                "Lslsass",
                "MAPIget",
                "ManItsMe",
                "Mimikatz",
                "MiniASP",
                "Oceansalt",
                "Pass-The-Hash Toolkit",
                "Poison Ivy",
                "ProcDump",
                "Riodrv",
                "SPIVY",
                "Seasalt",
                "ShadyRAT",
                "StarsyPound",
                "TROJAN.COOKIES",
                "TROJAN.FOXY",
                "TabMsgSQL",
                "Tarsip",
                "Trojan.GTALK",
                "WebC2",
                "WebC2-AdSpace",
                "WebC2-Ausov",
                "WebC2-Bolid",
                "WebC2-Cson",
                "WebC2-DIV",
                "WebC2-GreenCat",
                "WebC2-Head",
                "WebC2-Kt3",
                "WebC2-Qbp",
                "WebC2-Rave",
                "WebC2-Table",
                "WebC2-UGX",
                "WebC2-Yahoo",
                "Wordpress Bruteforcer",
                "bangat",
                "gsecdump",
                "pivy",
                "poisonivy",
                "pwdump",
                "zxdosml"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716498,
    "ts_updated_at": 1743041812,
    "ts_creation_date": 1418676722,
    "ts_modification_date": 1418676722,
    "files": {
        "pdf": "https://archive.orkl.eu/ae90917c7abe0c38ae289be9589f04c6fa7184c0.pdf",
        "text": "https://archive.orkl.eu/ae90917c7abe0c38ae289be9589f04c6fa7184c0.txt",
        "img": "https://archive.orkl.eu/ae90917c7abe0c38ae289be9589f04c6fa7184c0.jpg"
    }
}