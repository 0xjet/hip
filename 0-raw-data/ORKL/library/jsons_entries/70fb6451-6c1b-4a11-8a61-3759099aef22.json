{
    "id": "70fb6451-6c1b-4a11-8a61-3759099aef22",
    "created_at": "2022-10-25T16:48:15.150617Z",
    "updated_at": "2025-03-27T02:05:24.208975Z",
    "deleted_at": null,
    "sha1_hash": "f4216af597c0aa584753043e1c6821a3fa668137",
    "title": "Second Wave of Shamoon 2 Attacks Identified - Palo Alto Networks Blog",
    "authors": "",
    "file_creation_date": "2017-01-11T13:58:32Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 704424,
    "plain_text": "## MENU\n\n\n**[Blog Home > Unit 42 > Second Wave of Shamoon 2 Attacks Identified�](http://researchcenter.paloaltonetworks.com/)**\n\n# Second Wave of Shamoon 2 Attacks Identified�\n\n**[By Robert Falcone](http://researchcenter.paloaltonetworks.com/author/robert-falcone/)**\n**January 9, 2017 at 8:00 PM**\n**[Category: Unit 42](http://researchcenter.paloaltonetworks.com/unit42/)** **[Tags: Disttrack Wiper, Shamoon 2, threat intelligence](http://researchcenter.paloaltonetworks.com/tag/disttrack-wiper/)**\n\n**2,725** **(4)**\n\n**In November 2016, we observed the reemergence of destructive attacks associated with the**\n**2012 Shamoon attack campaign. We covered this attack in detail in our blog titled Shamoon**\n**2: Return of the Disttrack Wiper, which targeted a single organization in Saudi Arabia and was**\n**set to wipe systems on November 17, 2016. Since our previous publication, we have found**\n**another, similar but different payload used to target a second organization in Saudi Arabia that�**\n**was configured to wipe systems twelve days later on November 29, 2016. This latest attack�**\n**potentially materially impacts one of the primary countermeasures employed against wiper**\n**attacks: Virtual Desktop Interface snapshots.**\n\n**The payload used in this attack was very similar to the November 17, 2016 payload, but**\n**exhibited slightly different behaviors and contained hardcoded account credentials specific to�**\n**the newly targeted organization. The hardcoded account credentials met Windows password**\n**complexity requirements, which suggests that the threat actors obtained the credentials**\n**through a previous, separate attack, similar to the November 17, 2016 attack.**\n\n**The most notable thing about this latest sample is that it contains several usernames and**\n**passwords from official Huawei documentation related to their virtual desktop infrastructure�**\n**(VDI) solutions, such as FusionCloud. VDI solutions can provide some protection against a**\n**destructive malware like Disttrack through the ability to load snapshots of wiped systems. The**\n**fact that the Shamoon attackers had these usernames and passwords may suggest that they**\n**intended on gaining access to these technologies at the targeted organization to increase the**\n**impact of their destructive attack. If true, this is a major development and organizations**\n**should consider adding additional safeguards in protecting the credentials related to their VDI**\n**deployment.**\n\n**At this time, we have no details of the attack we believe preceded this Shamoon attack to**\n**obtain credentials. We also have no details on the delivery method used to deliver the new,**\n**similar, but different Disttrack payload in this attack.�**\n\n## The Second Shamoon 2 Attack\n\n\n-----\n\n**a new, similar but different one from the original Shamoon 2 attack. Specifically, it used a 64-�**\n**bit variant that was configured to begin its destructive activities on November 29, 2016. Like�**\n**the Disttrack sample used in the first reported Shamoon 2 attack, it including a wiper and�**\n**communications module stored in resources within the executable.**\n\n**Table 1 below shows that the method the Disttrack payload uses to extract and decrypt the**\n**modules from resources is the same; however, the resource names changed from “X509”,**\n**“PKCS7” and “PKCS12” to “LANG”, “MENU” and “ICO”.**\n\n**Component** **Resource** **Offset�** **Size** **Base64 key**\n**Name**\n\n**Wiper** **LANG** **94399-14** **563712** **OWRKbTxrleYfLm…**\n**= 94385**\n\n**Communications MENU** **218709-14** **187904** **QsCfQA6ze9CoOz…**\n**= 218695**\n\n**Unknown** **ICO** **Unknown** **Unknown ijX7buB1FIjSn/0D…**\n\n**Our efforts to decrypt the “ICO” resource have thus far been unsuccessful as the Disttrack�**\n**payload has an associated key but does not contain code that decrypts and extracts this**\n**resource.**\n\n### Propagation Inside Compromised Networks\n\n**Similar to the previous attack, the Disttrack payload in this attack spreads to other systems**\n**on the local network (/24 network specifically) by logging in using legitimate domain account�**\n**credentials, copying itself to the system and creating a scheduled task that executes the**\n**[copied payload. While this method is the same as discussed in our previous blog, the](http://researchcenter.paloaltonetworks.com/2016/11/unit42-shamoon-2-return-disttrack-wiper/)**\n**account credentials used in this attack were specific to the targeted organization and the file�**\n**names used when copying the payload to remote systems were different.�**\n\n### Legitimate User Accounts\n\n**There were 16 account credentials found hardcoded within the Disttrack payload, appearing**\n**to be a mixture of individual user accounts and broader administrator accounts. All but one of**\n**the passwords met Windows complexity requirements, specifically, containing uppercase and�**\n**lowercase characters, and either a number, symbol, or both. One of the general administrator**\n**accounts seen in this payload was also in the Disttrack payload in the first Shamoon 2 attack�**\n**from November 17, 2016, which may not be specific to the targeted organization and instead�**\n**used as an attempt to guess the login credentials. Based upon the existence of these**\n**credentials, it is highly likely the threat actors had carried out a previous attack to obtain**\n**these account credentials, as it is unlikely that these passwords were guessed or brute**\n**forced.**\n\n**As noted earlier, a new development with this latest Disttrack payload is that several of the**\n**usernames and passwords are found within official documentation as administrator accounts�**\n**for Huawei’s virtualized desktop infrastructure (VDI) products, such as FusionCloud. This may**\n\n|Component|Resource Name|Offset�|Size|Base64 key|\n|---|---|---|---|---|\n|Wiper|LANG|94399-14 = 94385|563712|OWRKbTxrleYfLm…|\n|Communications|MENU|218709-14 = 218695|187904|QsCfQA6ze9CoOz…|\n|Unknown|ICO|Unknown|Unknown|ijX7buB1FIjSn/0D…|\n\n\n-----\n\n**it is also possible that the actors included these default usernames and passwords as an**\n**attempt to guess the login credentials to the VDI infrastructure.**\n\n**VDI solutions can provide some protection against a destructive malware like Disttrack**\n**through the ability to load snapshots of wiped systems. Also, since FusionCloud systems run**\n**a Linux operating system, which would not be susceptible to wiping by the Windows-only**\n**Disttrack malware, this could be seen as a reasonable countermeasure against attacks like**\n**Shamoon. However, if the attacker was able to log into the VDI management interfaces using**\n**the account credentials they could manually carry out destructive activities against the VDI**\n**deployment, as well as any snapshots. The targeting of VDI solutions with legitimate, stolen or**\n**default credential represents an escalation in tactics that administrators should be aware of**\n**and take immediate steps to evaluate and address.**\n\n### New Disttrack Names\n\n**The filenames that the payload copies itself to within the System32 folder of the remote�**\n**system differs from the previously reported attack, specifically using “ntertmgr32.exe” for 32-�**\n**bit or “ntertmgr64.exe” for 64-bit systems. The scheduled task executes these files on the�**\n**remote system, which results in the creation of a Disttrack service named “NtertSrv”**\n**compared to the service name “ntssrv” created by the Disttrack payload used in the**\n**November 17, 2016 attacks. This can be seen in Figure 1.**\n\n\n-----\n\n**The communications module used in this attack is rather hobbled, as it was configured�**\n**without an operational command and control (C2) server to communicate with. The lack of an**\n**operational C2 is much like the November 17, 2016 attack that had the IP address “1.1.1.1”**\n**within its configuration to use as a C2 server. Unlike the non-operational C2 of “1.1.1.1” used�**\n**in the first Shamoon 2 attack, this communications module completely lacked any IP address�**\n**or domain name for a C2 server within its configuration.�**\n\n**Also, in this sample, Disttrack did not save its communications module to the system using**\n**the filename “netinit.exe” like in the original attack, rather it chose a random name from the�**\n**following list:**\n\n**• caiaw00e.exe**\n\n**• sbuvideo.exe**\n\n**• caiaw00i.exe**\n\n**• olvume.exe**\n\n**• usinwb2.exe**\n\n**• briaw005.exe**\n\n**• fpwwlwf.exe**\n\n**• epiaw003.exe**\n\n**• briaw002.exe**\n\n**• olvsnap.exe**\n\n**• dmwaudio.exe**\n\n**• briaw006.exe**\n\n**• miWApRpl.exe**\n\n**• caiaw00b.exe**\n\n**• lxiaw003.exe**\n\n**Lastly, the communications module also uses different file names than the original Shamoon 2�**\n**attack. Instead of setting a custom “kill time” in a file named “usbvideo324.pnf” within the�**\n**“%WINDOWS%\\inf” folder, it uses a file name of “dcT21x400i.pnf”. It also would send the C2�**\n**server the contents of a file named “vsfnp7_6.pnf” from the folder “%WINDOWS%\\inf”�**\n**instead of “netimm173.pnf”.**\n\n### Destruction\n\n**Much like the initial attacks, the lack of an operational C2 server suggests that the threat**\n**actor’s sole intention for carrying out this Shamoon 2 attack was to destroy data and**\n**systems. Without an operational C2, the actor would be unable to issue a command to set a**\n**custom “kill time” when the Disttrack payload would begin wiping systems, which would force**\n**the payload to rely on its hardcoded “kill time”. The hardcoded date suggests that this attack**\n**was set to begin wiping systems on November 29, 2016 at 1:30 AM local Saudi Arabia time.**\n\n**Unlike the previous Shamoon attacks that occurred on a holiday and over a weekend, this kill**\n**time occurred during the work week, as November 29, 2016 was a Tuesday. However, it**\n**appears this attack attempted to maximize its impact by occurring very early in the morning**\n**before the majority of the organization’s staff were on site. This aligns with the Shamoon�**\n**actors conducting their attacks off-hours to increase the efficacy of the attack by increasing�**\n\n\n-----\n\n**component to the system using one of the following randomly chosen filenames:�**\n\n**• pdwmtphw.exe**\n\n**• caiaw00a.exe**\n\n**• sdwprint.exe**\n\n**• caiaw00d.exe**\n\n**• kyiaw002.exe**\n\n**• sdwscdrv.exe**\n\n**• briaw00a.exe**\n\n**• saiaw002.exe**\n\n**• _mvscdsc.exe**\n\n**• hdvmp32.exe**\n\n**• _s3wcap32.exe**\n\n**• hpiaw001.exe**\n\n**• lxiaw004.exe**\n\n**• cniaw001.exe**\n\n**• lxiaw006.exe**\n\n**• caiaw00f.exe**\n\n**• newtvsc.exe**\n\n**When executed, the wiper component will extract a kernel driver from its resource section and**\n**decrypt it with a 172-byte XOR key. The wiper saves the kernel driver (SHA256:**\n**5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a) to the**\n**“Windows\\System32\\Drivers” folder in a file named “vdsk911.sys”. The wiper then uses this�**\n**file to create a kernel driver service named “vdsk911”, as seen in Figure 2.�**\n\n\n-----\n\n**_Figure 2 RawDisk kernel driver service created by Disttrack wiper_**\n\n**The kernel driver is the 64-bit version of the commercial RawDisk driver by EldoS**\n**Corporation, which is the exact same file as the “drdisk.sys” driver extracted from the�**\n**Disttrack 64-bit payload in the ‘X509’ resource in the first reported Shamoon 2 attack. The�**\n**Disttrack payload will use this kernel driver to access the master boot record (MBR), partition**\n**tables and files and folders on the system to overwrite them with the same image of the�**\n**deceased Syrian boy as in the previous Shamoon 2 attack.**\n\n**During our analysis, we again observed the wiper setting the system time to a random date**\n**between August 1 and August 20, 2012, as seen in Figure 3. As mentioned in our previous**\n**blog, the reason the wiper sets the system time to this random date in August 2012 is due to**\n**a temporary license key needed to use the RawDisk kernel driver. The temporary license key**\n**used in this attack is the exact same as the first attack.�**\n\n\n-----\n\n**_Figure 3 Wiper changing the system date to a random date in August 2012_**\n\n**Since our original blog, we’ve successfully decrypted the license key, which can be seen in**\n**Figure 4. The expiration date in the temporary license key is an 8-byte field (highlighted by the�**\n**[orange box) that corresponds to Microsoft’s FILETIME structure, which represents the](https://msdn.microsoft.com/en-us/library/windows/desktop/ms724284(v=vs.85).aspx)**\n**number of 100-nanosecond intervals since January 1, 1601 (UTC). In the temporary license**\n**key used in all of the Shamoon related attacks, the expiration date was set to August 30,**\n**2012 at 8:34:29 UTC, which is the reason the wiper sets the system time to a random day**\n**between August 1 and August 20, 2012. Also, we found that the temporary license key was**\n**registered to “binnatova@bsunanotechnology.com”. We are unsure how this email address is**\n**involved with Shamoon, as it was likely compromised back in 2012 and used by the actor to**\n**obtain the temporary license for RawDisk.**\n\n**_Figure 4 RawDisk temporary license decrypted showing August 2012 expiration date_**\n\n**After the MBR, partition tables and files are overwritten, the wiper issues the command of�**\n**“shutdown -r -f -t 2” to reboot the system, which is the same command as used in the first�**\n**Shamoon 2 attack. Figure 5 shows the dialog box that pops up as a result of this command,**\n**which will be followed by a system reboot.**\n\n\n-----\n\n**_Figure 5 The shutdown dialog box opened just before reboot of a Windows 7 system wiped_**\n**_by Disttrack_**\n\n**The purpose of rebooting the system remains the same, as the portions of the hard disk and**\n**filesystem needed to successfully boot the system were overwritten with a JPEG image, the�**\n**system is no longer able to start up. Figure 6 shows the result of this reboot in an analysis**\n**virtual machine, as the operating system could no longer be found.**\n\n**_Figure 6 System unable to find its operating system�_**\n\n**The operating system fails to load as the MBR is overwritten with a JPEG image. As seen in**\n**Figure 7, sector 0 of the physical hard disk, which normally stores the master boot record now**\n**contains the beginning of a JPEG file marked by the “JFIF” magic bytes in the two orange�**\n**boxes.**\n\n\n-----\n\n**_Figure 7 Hexdump of sector 0 of the physical showing the MBR overwritten with a JPEG file�_**\n\n## Conclusion\n\n**We analyzed a second Disttrack payload associated with Shamoon 2, which suggests that the**\n**threat actors targeted a second Saudi Arabian organization in this attack campaign. The**\n**actors used the Disttrack payload to spread to other systems on the local network using**\n**legitimate credentials. The legitimate credentials were specific to the targeted organization�**\n**and were complex enough to suggest that the threat actors carried out a previous attack to**\n**obtain the credentials. Also, the actors hardcoded credentials found in Huawei’s official�**\n**documentation for its VDI solutions, suggesting that the threat actors may have had access to**\n**appliances hosting the infrastructure. The Disttrack wiper was set to begin overwriting**\n**systems on November 29, 2016 at 1:30 AM, which aligns with the Shamoon actor’s tactic to**\n**maximize its impact by attacking at a time when the targeted organization would have less**\n**staff and resources available onsite.�**\n\n**Palo Alto Networks customers are protected from the Disttrack payload used in this attack:**\n\n**WildFire properly classifies Disttrack samples as malicious�**\n**Threat protection AV signature of Virus/Win32.WGeneric.ktoto detects the new payload.**\n**[AutoFocus customers can monitor Disttrack activity using the Disttrack tag](https://autofocus.paloaltonetworks.com/#/tag/Unit42.Disttrack)**\n\n## Indicators of Compromise\n\n**Hashes**\n\n**010d4517c81bcdc438cb36fdf612274498d08db19bba174462ecbede7d9ce6bb (64-bit**\n**Disttrack)**\n**efd2f4c3fe4e9f2c9ac680a9c670cca378cef6b8776f2362ed278317bfb1fca8 (Communication)**\n**113525c6bea55fa2a2c6cf406184092d743f9d099535923a12cdd9b9192009c4 (Wiper)**\n**5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a (vdsk911.sys)**\n\n**Filenames**\n\n**ntertmgr32.exe**\n**ntertmgr64.exe**\n**vdsk911.sys**\n**dcT21x400i.pnf**\n**vsfnp7_6.pnf**\n\n\n-----\n\n**caiaw00i.exe**\n**olvume.exe**\n**usinwb2.exe**\n**briaw005.exe**\n**fpwwlwf.exe**\n**epiaw003.exe**\n**briaw002.exe**\n**olvsnap.exe**\n**dmwaudio.exe**\n**briaw006.exe**\n**miWApRpl.exe**\n**caiaw00b.exe**\n**lxiaw003.exe**\n**pdwmtphw.exe**\n**caiaw00a.exe**\n**sdwprint.exe**\n**caiaw00d.exe**\n**kyiaw002.exe**\n**sdwscdrv.exe**\n**briaw00a.exe**\n**saiaw002.exe**\n**_mvscdsc.exe**\n**hdvmp32.exe**\n**_s3wcap32.exe**\n**hpiaw001.exe**\n**lxiaw004.exe**\n**cniaw001.exe**\n**lxiaw006.exe**\n**caiaw00f.exe**\n**newtvsc.exe**\n\n**Service Names**\n\n**NtertSrv**\n**vdsk911**\n\n### Got something to say?\n\n\n-----\n\n**Leave a comment...**\n\n\n**Notify me of followup comments via e-**\n**mail**\n\n\n**Name (required)**\n\n\n**Email (required)**\n\n\n**Website**\n\n\n**SUBMIT**\n\n\n**SUBSCRIBE TO NEWSLETTERS**\n\n**Email**\n\n**COMPANY**\n\n**[Company](https://www.paloaltonetworks.com/company)**\n\n**[Careers](https://www.paloaltonetworks.com/company/careers)**\n\n**[Sitemap](https://www.paloaltonetworks.com/sitemap)**\n\n**[Report a Vulnerability](https://www.paloaltonetworks.com/security-disclosure)**\n\n**LEGAL NOTICES**\n\n**[Privacy Policy](https://www.paloaltonetworks.com/legal-notices/privacy)**\n\n**[Terms of Use](https://www.paloaltonetworks.com/legal-notices/terms-of-use)**\n\n**ACCOUNT**\n\n\n**Email**\n\n\n-----\n\n**© 2016 Palo Alto Networks, Inc. All rights reserved.**\n\n\n**[TAKE A TEST DRIVE](http://connect.paloaltonetworks.com/virtual-utd)**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2017/2017.01.09.second-wave-shamoon-2-attacks-identified/unit42-second-wave-shamoon-2-attacks-identified.pdf"
    ],
    "report_names": [
        "unit42-second-wave-shamoon-2-attacks-identified"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716495,
    "ts_updated_at": 1743041124,
    "ts_creation_date": 1484143112,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/f4216af597c0aa584753043e1c6821a3fa668137.pdf",
        "text": "https://archive.orkl.eu/f4216af597c0aa584753043e1c6821a3fa668137.txt",
        "img": "https://archive.orkl.eu/f4216af597c0aa584753043e1c6821a3fa668137.jpg"
    }
}