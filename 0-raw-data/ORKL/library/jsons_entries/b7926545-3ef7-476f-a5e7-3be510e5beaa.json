{
    "id": "b7926545-3ef7-476f-a5e7-3be510e5beaa",
    "created_at": "2022-10-25T16:48:14.204869Z",
    "updated_at": "2025-03-27T02:05:18.045308Z",
    "deleted_at": null,
    "sha1_hash": "33450474e871a2ee1eb50742373a8c14f9584d63",
    "title": "",
    "authors": "",
    "file_creation_date": "2018-12-07T13:21:13Z",
    "file_modification_date": "2018-12-07T13:21:13Z",
    "file_size": 4187463,
    "plain_text": "# Let's go with a Go RAT!\n\n###### Dec 2018�\n\n Yoshihiro Ishikawa�\n\n\n-----\n\n#### • Organization: LAC Co.,Ltd.(lac.co.jp)\n • Department: Cyber Emergency Center\n • Job Title: Cyber Threat Analyst and handler\n\n### Yoshihiro Ishikawa (CISSP)\n\n#### • Department: Cyber Emergency Center\n • Job Title: Cyber Threat Analyst and handler\n\n\n-----\n\n#### n Purpose\n n A study of Go language (GoLang)\n n wellmess and its detail\n n wellmess C2 traffic simulation (DEMO)\n n Prevention method\n n Conclusion\n\n\n-----\n\n###### n wellmess malware and its botnet is currently\n still categorized as an unknown Golang malware\n n several incident cases that we handled from\n January 2018\n n Not detected[2] by security software until we\n published analysis report[1] about June 2018\n\n#### We would like to introduce the analysis result of \"wellmess\"  And now hopefully will be useful to prevent the attack in the future.\n\n\n-----\n\nbased on advanced security technologies.\n\nCYBER  - EDUCATION  - PENTEST  - JSOC  - 119  - CONSULTING\n\n## A study of Golang executable�\n\n\n-----\n\n###### n Go[3] is an open source programming language developed by\n\n#### Google Inc. in 2009, in our presentation we call it as “GoLang”.\n\n###### n Current stable version 1.11.2\n n Run on various platforms such as Linux, Mac, Windows, Android\n n Golang malware\n n Mirai(C2/Server) is one of the most famous\n n Otherwise such as Lady[4], GoARM.Bot[5], Go Athena RAT[6], Encriyoko[7],\n\n\n-----\n\n###### n Go executables is huge file size (even packed by UPX[8] < 4Mb)\n n Function name is left intact in the executable files (in many cases)\n n The character string becomes one continuous block (go1.8 higher)\n\n Not stripped\n\n\n-----\n\n###### The function names can be specified by using IDAGolangHelper[9] in IDA Pro[11].\n\n Before After\n\n Rename functions\n\n\n-----\n\n###### Not every string-blob can be separated IDAGolangHelper, so we need to do it manually\n\n\n###### Not every string-blob can be separated IDAGolangHelper, so we need to do it manually\n\n Possible\n\n split values\n\n Impossible\n\n\n-----\n\nbased on advanced security technologies.\n\nCYBER  - EDUCATION  - PENTEST  - JSOC  - 119  - CONSULTING\n\n## wellmess and its detail�\n\n\n-----\n\n###### wellmess is a RAT coded on GoLang on multiple platform operating systems.\n\n n C2 Functions\n n Command Execution (RCE)\n n File Upload and Download\n n Identification\n n Lang: GoLang (main) & .Net (minor version only)\n n Type: Windows 32/64-bit Executable(these main slides) & ELF x64 (Appendix:C)\n n Characteristic: \n n Compiled with Ubuntu (go1.8.3), Windows (go1.8)\n n \"wellmess” naming is coming from \"Welcome Message” (attacker’s thought)\n\n\n-----\n\n#### Does he means choice?\n\n Does he means welcome message?\n\n Does he means Mozilla?\n\n\n-----\n\n###### different package name C2 server\n\n Supports Japanese,  Korean and Chinese\n\n\n-----\n\n#### Each wellmess had a different User-Agents hard-coded.\n\n###### n Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko)\n Chrome/41.0.2228.0 Safari/537.36\n n Mozilla/5.0 (X11; U; Linux x86_64; ja-JP; rv:1.9.2.16) Gecko/20110323\n Ubuntu/10.10 (maverick) Firefox/3.6.16\n n Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.75.14\n (KHTML, Like Gecko) Version/7.03 Safari/7046A194A\n n Mozilla/5.0 (X11; OpenBSD amd64; rv:28.0) Gecko/20100101 Firefox/28.0\n n Mozzila/5.0 (Windows NT 6.1; WOW64; rv:56.0) Gecko/20100101 Firefox/\n 56.0\n n Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0;\n\n\n-----\n\n###### welmess doesn’t have lateral movement function, for that purpose the attacker was using another tool, in some cases they used gost[13], a tunneling tools written by Golang\n\n Victim\n\n Attacker\n\n\n-----\n\n###### dnSpy[13]\n\n (too long, redacted) Payload(DLL file) is encrypted\n\n Replace strings and Base64, decrypt RC6 Payload DLL file is loaded and executed using AppDomain CreateInstanceAndU nwrap method\n\n\n-----\n\n###### .NET version RCE is also using Powershell\n Has similar functions methods which are not found in the\n\n\n-----\n\n|Functions|Golang (mostly spotted)|.NET (several cases only)|\n|---|---|---|\n|Support OS|Windows, Linux, (NAS)|Windows|\n|Encryption|RC6, AES, RSA, obfuscation|RC6, AES, RSA, obfuscation|\n|Bot commands|Command Execution File Upload and Download|Command Execution File Upload and Download|\n|How to Command Exec|CMD (Windows) Execve (Linux)|PowerShell, CMD|\n|C2 Protocol|HTTP, POST, Cookie|HTTP, POST, Cookie|\n|Packer|UPX or none|Original Packer (bytes obfuscator)|\n|Latest version(ITW) #Virus Total First Submission|2018-10-02|2018-07-25|\n\n\n###### Functions Golang (mostly spotted) .NET (several cases only)\n\n Support OS Windows, Linux, (NAS) Windows\n\n Encryption RC6, AES, RSA, obfuscation RC6, AES, RSA, obfuscation\n\n Bot commands Command Execution Command Execution File Upload and Download File Upload and Download\n\n How to Command Exec CMD (Windows) PowerShell, CMD Execve (Linux)\n\n C2 Protocol HTTP, POST, Cookie HTTP, POST, Cookie\n\n Packer UPX or none Original Packer (bytes obfuscator)\n\n Latest version(ITW) 2018-10-02 2018-07-25 #Virus Total First Submission\n\n\n-----\n\n|Functions|Golang (mostly spotted)|.NET (several cases only)|\n|---|---|---|\n|Support OS|Windows, Linux, (NAS)|Windows|\n|Encryption|RC6, AES, RSA, obfuscation|RC6, AES, RSA, obfuscation|\n|Bot commands data.re|Command Execution place(\"+\", \" \").replace(\" \", File Upload and Download|Command Execution \"=\").replace(\". \", \"\").replace(\" File Upload and Download|\n|\", \"\").r How to Command Exec|eplace(\",\", \"+\").replace(\":\", CMD (Windows) Execve (Linux)|\"/\") reference by JPCERT/CC [15] PowerShell, CMD|\n|C2 Protocol|HTTP, POST, Cookie|HTTP, POST, Cookie|\n|Packer|UPX or none|Original Packer (bytes obfuscator)|\n|Latest version(ITW) #Virus Total First Submission|2018-10-02|2018-07-25|\n\n\n###### Functions Golang (mostly spotted) .NET (several cases only)\n\n Support OS Windows, Linux, (NAS) Windows\n\n Encryption RC6, AES, RSA, obfuscation RC6, AES, RSA, obfuscation\n\n Bot commands Command Execution Command Execution\n data.replace(\"+\", \" \").replace(\"  \", \"=\").replace(\". \", \"\").replace(\"\n File Upload and Download File Upload and Download\n \", \"\").replace(\",\", \"+\").replace(\":\", \"/\") reference by JPCERT/CC [15]\n How to Command Exec CMD (Windows) PowerShell, CMD Execve (Linux)\n\n C2 Protocol HTTP, POST, Cookie HTTP, POST, Cookie\n\n Packer UPX or none Original Packer (bytes obfuscator)\n\n Latest version(ITW) 2018-10-02 2018-07-25 #Virus Total First Submission\n\n\n-----\n\n###### wellmess uses tags in XML format to communicate tag C2 commands Following is regular expression matching rules of the tags\n\n#### Golang version ; ?P key ; *? ; ?P value *? ; ; *?; < ( < >[^ ] ) >( < >[^<] )< [^ ] >\n .NET version ; ? key ; *? ; ? value *? ; ; *?; < ( < >[^ ] ) >( < >[^<] )< [^ ] >\n\n\n-----\n\n|ot commands�|Col2|Col3|\n|---|---|---|\n|Tag|Command|Functions|\n|<;head;>|C|Used with <;service;> tag|\n||G|C2 server acceptance|\n|<;service;>|p|(Re)Initialize AES key and Sending Host Info|\n||fu|File upload (from C2 to bot)|\n||fd|File download (from bot to C2)|\n||m|Change the division size per communication|\n||u|Change user-agent|\n||||\n||a:x_x|Item number information of divided communication|\n\n\n###### Tag Command Functions\n\n <;head;> C Used with <;service;> tag\n\n G C2 server acceptance\n <;service;> p (Re)Initialize AES key and Sending Host Info\n\n fu File upload (from C2 to bot)\n\n fd File download (from bot to C2)\n\n m Change the division size per communication\n\n u Change user-agent\n\n <;title;> a:x_x Item number information of divided communication\n\n rc Waiting C2 command\n\n\n-----\n\n###### AOyniCcS=1bLTL+NuPy0+%2CeDJx+1Q%2Cm0+1zZ8a+uj84J+VLbRk+tYH8v+pCeL6+gRkR; D9y5yGqO=G +B%3AbW%3Ao.+Y8GDHj+K2QKny+WZ2vQZ+L1v84h+p3P1qT.+Z8auj8+4JVLbR+ktYH8v+pCfbOO+ZDq5 77.+LySyuj+30PqHX+%2CXho8Z+YzBMr8+tQIevh.+rxEbIz+OVIVRP+x9DfH6+duxldn+PKi3f4.+y%2CI6td+ RfavbR+67eQVw+twTN%3AI+HB1vPy.+hWzm2f+ASQlzB+Jiz9pt+EzNRQA+fRv1mL.+pziFHi+vzbux9+VA2 zkY+8Ve9rz+T0u8jb.+1LH0%2Cx+WDpcVw+TIJjDV+5Dy6Mx+GTUarDtVk+++\n\n Decrypted Cookie header\n\n#### ;head; 57494e2d3550464b544835345154517c636f6e < > 736f6c657c57494e2d3550464b544835345154517c757 36572e3b0c44298fc1c149afbf4c8996fb92427ae41e46 49b934ca495991b7852b855 p ;head; ;title; a 1 0 ;title / < >< > : _ <\n\n\n-----\n\n###### Bot C2\n There are 4 steps until command & control communication \n\n 1 1.Bot sends AES + iv + Host Information\n 1’\n 2 1ʼ.C2 acceptance�\n 2’\n 3 2.Bot sends Host Information\n 3’\n 4 2ʼ.C2 acceptance\n 4’\n 3.Bot sends ready signal to RCE\n\n 3ʼ.C2 send RCE\n We must prepare the\n 4.Bot sends result of RCE\n hard-coded RC6 key and\n\n\n-----\n\n###### Bot C2\n Cookie Header: Infected Host Information in RC6\n\n 1\n\n POST Body: AES + iv in RSA public key\n\n\n-----\n\n|“|p” means Initial phase|\n|---|---|\n\n\n###### Bot C2\n\n 1\n\n “p” means Initial phase Phase 1 of 2\n\n\n-----\n\n|Col1|Col2|Col3|Col4|Col5|Col6|\n|---|---|---|---|---|---|\n|||||||\n|||||||\n|||||||\n|||||||\n|||||||\n|||||||\n\n\n###### Bot C2\n NULL of SHA256 hash\n\n 1\n\n HexDump Infected PC Information\n\n\n-----\n\n###### Bot C2\n\n 1\n\n\n-----\n\n###### Bot C2\n\n 1 Cookie Header: C2 Server\n 1’ response in RC6\n\n “G” means just received\n\n\n-----\n\n###### Bot C2\n Cookie Header: Infected Host Information in RC6\n\n 1\n 1’\n 2\n\n POST Body: Host Information in RSA public key\n\n\n-----\n\n###### Bot C2\n\n 1\n 1’\n 2\n\n Phase 2 of 2\n\n\n-----\n\n###### Bot C2\n\n 1\n 1’\n 2\n\n Computer Mode User User Name Domain Name\n\n\n-----\n\n###### Bot C2 Cookie Header: standby to receive C2 Command\n\n 1\n 1’\n 2\n 2’\n 3\n\n POST Body: It looks like no data is included\n\n\n-----\n\n###### Bot C2\n\n 1\n 1’\n 2\n 2’\n 3\n “rc” means to standby receiving C2 command\n\n\n-----\n\n###### Bot C2\n\n 1\n 1’\n 2\n POST Body:\n 2’\n 3 C2 Command in AES\n 3’\n\n\n-----\n\n###### Bot C2\n\n Cookie Header: split block number in RC6\n\n 1\n 1’\n 2\n 2’\n 3\n 3’\n 4\n\n\n-----\n\n###### Bot C2\n\n 1\n 1’\n 2\n 2’\n 3\n 3’ Phase 1 of 1\n 4\n\n\n-----\n\n###### Bot C2\n\n The Japanese font is garbled\n\n\n-----\n\nbased on advanced security technologies.\n\nCYBER  - EDUCATION  - PENTEST  - JSOC  - 119  - CONSULTING\n\n## wellmess C2 traffic simulation DEMO�\n\n\n-----\n\n###### n It is forbidden in Japan to share any form of any malicious code\n\n#### without the written acknowledgement from and to the law enforcement.\n\n###### n In this demonstration there is a possibility the used PoC code can be\n\n#### misused to control a real alive malware, there is a risk for malicious used if this PoC leaks, it is considered as malicious code.\n\n###### n Due the circumstances above, we can not share the source code\n\n#### used for this demonstration, however, this demonstration itself is explaining enough details to proofing the concept of the C2 communication traffic/protocol used by wellmess malware. \n\n\n-----\n\n###### n C2 traffic connection in network detection\n n wellmess traffic detect at using Suricata[16] or snort[17]\n\n alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:\"wellmess C2 traffic detection!\"; content:\"Accept-Encoding|3a 20|gzip\"; content: \"POST / HTTP/1.1\"; pcre:\"/Cookie\\x3a [a- zA-Z0-9]{8}=/\"; content:\"Content-Type|3A| application|2F|x-www-form-urlencoded|3b| charset|3d|utf-8\"; sid:1000000;)\n\n n Static and dynamic detection\n n YARA[18]\n n wellmess malware can be detected and identified. By the YARA rule (will\n be introduce next slide)\n n EDR\n\n\n-----\n\n###### For Golang For .NET\n\n rule wellmess_go { rule chatbot_net {\n meta: meta:   author = \"LAC Co., Ltd.\"   author = \"LAC Co., Ltd.\" strings: strings:   $mz = { 4D 5A }   $mz = { 4D 5A }   $elf = {7F 45 4C 46}   $str = \"Start bot\" wide   $str1 = \"botlib.FromNormalToBase64\"   $str2 = \"ROL\"   $str2 = \"botlib.AES_Encrypt\"   $str3 = \"ROR\"   $str3 = \"botlib.UnpackB\"   $str4 = \"FromBase64ToNormal\"   $str4 = \"botchat.go\"   $str5 = \"FromNormalToBase64\"   $str5 = \"choise.go\"   $str6 = \"SSL\"   $str6 = \"wellmess.go\" condition: condition:   ($mz at 0) and all of them\n\n\n-----\n\n###### Windows Defender ATP[19] Machine Timeline\n\n\n-----\n\n###### n wellmess is a RAT coded on GoLang and .NET, a RAT\n\n### controlled by the C2 botnet.\n\n###### n We have confirmed some cases where wellmess infection\n\n### was found in targeted organizations. So, Attacks using the malware may continue in other countries.\n\n###### n For the information sharing with OPSEC on a global\n\n### scale, you are more than welcome to contact us !\n\n\n-----\n\n###### 1. https://www.lac.co.jp/lacwatch/pdf/20180614_cecreport_vol3.pdf 2. https://www.virustotal.com/ja/file/ 0b8e6a11adaa3df120ec15846bb966d674724b6b92eae34d63b665e0698e0193/analysis/ 3. https://golang.org/ 4. https://news.drweb.com/show/?i=10140&lng=en 5. http://blog.0day.jp/2014/09/linuxgoarmbot.html 6. https://blog.talosintelligence.com/2017/02/athena-go.html#more 7. https://www.symantec.com/connect/blogs/malware-uses-google-go-language 8. https://upx.github.io/ 9. https://github.com/sibears/IDAGolangHelper 10. https://www.hex-rays.com/products/ida/ 11. https://www.paterva.com/web7/ 12. https://github.com/ginuerzh/gost 13. https://github.com/0xd4d/dnSpy 14. https://blogs.jpcert.or.jp/en/2018/07/malware-wellmes-9b78.html 15. https://suricata-ids.org/ 16. https://www.snort.org/ 17 http://virustotal github io/yara/\n\n\n-----\n\n###### n Golang\n n efda5178286678794b40987e66e686ce\n n 6fd56f2df05a77bdfd3265a4d1f2abac\n n b981736a057b888170148a91bcd86a59\n n 579d3af1b487ea3c442870eabe886a4f\n\n n .NET\n n 98fe909510c79b21e740fec32fb6b1a0\n n 4a2b8954695b32322508e844ff7e74f5\n\n\n-----\n\n###### Initial communication\n\n\n-----\n\n###### Receive response  & Bot process\n\n\n-----\n\n###### Execute Bot Command\n\n\n-----\n\n###### Continue Bot  Command \n\n\n-----\n\nbased on advanced security technologies.\n\nCYBER  - EDUCATION  - PENTEST  - JSOC  - 119  - CONSULTING\n\n##### Thank you. Any Questions ?\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.botconf.eu/wp-content/uploads/2018/12/2018-Y-Ishikawa-S-Nagano-Lets-go-with-a-Go-RAT-_final.pdf"
    ],
    "report_names": [
        "2018-Y-Ishikawa-S-Nagano-Lets-go-with-a-Go-RAT-_final.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716494,
    "ts_updated_at": 1743041118,
    "ts_creation_date": 1544188873,
    "ts_modification_date": 1544188873,
    "files": {
        "pdf": "https://archive.orkl.eu/33450474e871a2ee1eb50742373a8c14f9584d63.pdf",
        "text": "https://archive.orkl.eu/33450474e871a2ee1eb50742373a8c14f9584d63.txt",
        "img": "https://archive.orkl.eu/33450474e871a2ee1eb50742373a8c14f9584d63.jpg"
    }
}