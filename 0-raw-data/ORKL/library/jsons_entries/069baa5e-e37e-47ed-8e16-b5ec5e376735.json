{
    "id": "069baa5e-e37e-47ed-8e16-b5ec5e376735",
    "created_at": "2023-01-12T15:02:12.652009Z",
    "updated_at": "2025-03-27T02:11:00.247382Z",
    "deleted_at": null,
    "sha1_hash": "b7af08a234110c4d614f1993bdf7c11af2c10e97",
    "title": "2015-03-03 - C99Shell not dead",
    "authors": "",
    "file_creation_date": "2022-05-27T21:15:12Z",
    "file_modification_date": "2022-05-27T21:15:12Z",
    "file_size": 190923,
    "plain_text": "# C99Shell not dead\n\n**bartblaze.blogspot.com/2015/03/c99shell-not-dead.html**\n\nIn today's blog post, we'll talk about C99shell - a powerful PHP backdoor.\n\n[Introduction](https://bartblaze.blogspot.co.uk/2015/03/c99shell-not-dead.html#introduction)\n\n[Analysis](https://bartblaze.blogspot.co.uk/2015/03/c99shell-not-dead.html#analysis)\n\n[Disinfection](https://bartblaze.blogspot.co.uk/2015/03/c99shell-not-dead.html#disinfection)\n\n[Prevention](https://bartblaze.blogspot.co.uk/2015/03/c99shell-not-dead.html#prevention)\n\n[Conclusion](https://bartblaze.blogspot.co.uk/2015/03/c99shell-not-dead.html#conclusion)\n\n**Introduction**\n\nI recently got contacted on Twitter in regards to a hacked webpage:\n\n[@bartblaze Hey, maybe interesting for you: http://t.co/6rZUD1O1qZ Found on hacked](https://twitter.com/bartblaze)\njoomla page Got a lot of those files. All have same scheme\n\n[— Florian Gümbel (@fgdesign) February 25, 2015](https://twitter.com/fgdesign/status/570607038990041090)\n\nAfter I received the files two things became apparent:\n\nthe webserver (and thus the website) was infected with C99shell;\nthe webserver was infected with other PHP backdoors.\n\n**Analysis**\n\n**PHP/c99shell or simply c99shell should be well known by now - it is a PHP backdoor that**\nprovides a lot of functionality, for example:\n\nrun shell commands;\ndownload/upload files from and to the server (FTP functionality);\nfull access to all files on the hard disk;\nself-delete functionality.\n\n\n-----\n\nIn short, it can pretty much do everything you want, which results in end-users getting\nmalware onto their systems and/or data getting stolen and/or personal information\ncompromised.\n\nThere's an excellent blog post over at Malwaremustdie in regards to C99shell, you can read\nit here:\nHow EVIL the PHP/C99Shell can be? From SQL Dumper, Hacktools, to Trojan Distributor\nFuture?\n\nNow, here's one of the files gathered from the webserver:\n\nIt's heavily obfuscated as one would expect; after some deobfuscating/decoding we get:\n\nIt also has a nice web interface:\n\nSeems like we are dealing with a slightly updated version of C99shell, version 2.1:\n\nAnd last but not least, some functionality:\n\n\n-----\n\nYou can find the decoded C99shell backdoor on Pastebin:\n\n[Decoded PHP/c99shell](http://pastebin.com/L02T4kFp)\n\nDetections aren't too great for this PHP backdoor, but it surely has improved since\nMalwaremustdie started blogging about it, some VirusTotal results: [0,](https://www.virustotal.com/en/file/7f812800041f27ed3b00f923a184700750bb2959d71206804dec09bf856a1cd9/analysis/) [1,](https://www.virustotal.com/en/file/9962b659015424b7261620f94a3f85a200a1bab59b19dc41265e751ca566e81c/analysis/) [2.](https://www.virustotal.com/en/file/5a649e2964b9fba5db6de363dc02103e897cbecfc0b6f9e26bb36c92c61e9648/analysis/)\n\nAs I mentioned before, other PHP backdoors were present, for example:\n\nAfter some manual decoding, we turn up with the following interesting line:\n\ngetenv(HTTP_X_UP_CALLING_LINE_ID);\n\nAnother example:\n\ngetenv(HTTP_X_NOKIA_ALIAS);\n\nThe \"x-headers\" HTTP_X_UP_CALLING_LINE_ID and HTTP_X_NOKIA_ALIAS are actually\npart of WML, the [Wireless Markup Language.](http://en.wikipedia.org/wiki/Wireless_Markup_Language)\n\nThus, this PHP backdoor seems specifically designed to target mobile users. I've put a copy\nof the script in screenshot above on Pastebin as well:\n\n[Unknown PHP backdoor](http://pastebin.com/a8VFXq9i)\n\nDarryl from [Kahu Security has written an excellent post on how to manually decode this kind](https://twitter.com/kahusecurity)\n[of PHP obfuscation: Deobfuscating a Wicked-Looking Script](http://www.kahusecurity.com/2015/deobfuscating-a-wicked-looking-script/)\n\n\n-----\n\nIf you have any information on what kind of PHP backdoor this might be (if not generic), feel\nfree to let me know.\n\n**Disinfection**\n\nWhat if your website's already been hacked and serving up malware to the unknowing\nvisitor? Best practice is to simply take your website offline and restore from an earlier backup. (don't forget to verify if your back-up isn't infected as well!)\n\nIf that's not a possibility for whatever reason, you'll first need to find where any malicious\ncode was injected (or created) on your website, or how it was infected in the first place.\n\nAn easy way would be to simply check all recently changed files on your web server.\nHowever, those dates can be altered. So what's a better alternative? You can comb over the\nfiles one by one, or you can use an online tool to check your website.\n\nA short overview:\n\n[http://sitecheck.sucuri.net/](http://sitecheck.sucuri.net/)\nYou can use Sucuri's SiteCheck to quickly spot if they detect any malware, see if you're\nblacklisted and, the most useful part in this case is to check whether or not you have any\noutdated plugin or CMS running - as well as a list of links.\n\n[http://aw-snap.info/file-viewer/](http://aw-snap.info/file-viewer/)\nUse Redleg's file viewer to easily see if any malicious iframes have been injected - you can\neven choose which Referrer and User Agent should be used (some malware requires you to\nvisit the site via a specific Referrer or User Agent).\n\n[http://www.rexswain.com/httpview.html](http://www.rexswain.com/httpview.html)\nUseful additional tool to Redleg's file viewer. Allows you to only fetch headers of a website, or\nfetch both header and content.\n\n[http://jsunpack.jeek.org/](http://jsunpack.jeek.org/)\nExcellent tool in case any malicious Javascript (iframe) is injected into any of your web\nserver files. Less intuitive, but provides a great overview.\n\n[http://urlquery.net/](http://urlquery.net/)\nExcellent tool and more graphical as opposed to JSunpack - especially useful is to see if any\n[IDS was triggered as well as JavaScript and HTTP Transactions.](http://en.wikipedia.org/wiki/Intrusion_detection_system)\n\n[https://www.virustotal.com/](https://www.virustotal.com/)\nAs usual, VirusTotal is a great resource as well - it can pinpoint which Antivirus (if any) is\ntriggering an alert related to your website.\n\n\n-----\n\n[https://hackertarget.com/wordpress-security-scan/](https://hackertarget.com/wordpress-security-scan/)\nOnline WordPress Security Scanner to test vulnerabilities of a WordPress installation.\nChecks include application security, WordPress plugins, hosting environment and web\nserver.\n\n[https://github.com/nbs-system/php-malware-finder](https://github.com/nbs-system/php-malware-finder)\nNBS System's PHP Malware Finder does its very best to detect obfuscated/dodgy code as\nwell as files using PHP functions often used in malwares/webshells.\n\n[https://github.com/sullo/nikto](https://github.com/sullo/nikto)\nNikto web server scanner.\n\nIf nothing is found using any of these tools, but you are still receiving reports from either\nblacklists (eg. Google) or users, you'll have to manually go over all your files to see if any\ncode was attached.\n\nIf you're hosting a web server yourself, you obviously know where you've installed it, so be\nsure to check in there. If you're not sure where it's installed, may want to look in any of these\ndefault locations, if they exist:\n\nLinux:\n\n**/var/www/**\n**/var/www/html**\n**var/lib/tomcat7/webapps**\n\nWindows:\n\n**C:\\inetpub**\n**C:\\inetpub\\wwwroot\\**\n**...**\n\nAnother method (and obviously not foolproof) is to copy over all your files to a Windows\nsystem and scan them with an antivirus. An example of such antivirus, which works on both\n[Linux and Windows, is ClamAV. I think you're starting to realize why back-ups are important.](https://www.clamav.net/)\n\nIf you had any outdated plugins running, chances are very high the backdoor or script was\ncreated/added in that specific directory. For example for WordPress this is typically:\n**/www/wp-content/plugins/**\n\nYou can also install a plugin for your CMS which can scan your web server for any infected\nfiles. (Which is ironic, but might still do the trick should you not be able to find anything\nmanually.)\n\nLast but not least: check your access logs! See any unauthorized (FTP) logins for example?\nTake a look in any of these locations:\n\n\n-----\n\n**/var/log/httpd**\n**var/log/nginx**\n**/var/log/apache**\n**/var/log/apache2**\n\nYou may also want to take a peek in:\n**/var/log**\n\nContact your hosting provider - they might be able to provide you with assistance.\n\nIf you're still stuck, feel free to shoot me an email or contact me on [Twitter. Otherwise,](https://twitter.com/bartblaze)\ncontact one of X companies which can help you assist in clean-up.\n\nDon't forget: after clean-up, reset all your passwords (and don't use the same for everything)\nand follow the prevention tips above, or you'll simply get infected again.\nAdditionally, always install relevant security patches or updates for your operating system if\nyou are hosting the web server yourself.\n\n**Prevention**\n\nThis shouldn't be repeated normally, but I will again just for good measure:\n\nCreate back-ups regularly! Yes, even for your website.\nKeep your CMS up-to-date; whether you use WordPress, Joomla, Drupal, ...\nKeep your installed plugins up-to-date. Remove any unnecessary plugins.\nUse strong passwords for your FTP account(s), as well as for your CMS/admin panel\nlogin.\nUse appropriate file permissions - meaning don't use 777 everywhere. (seriously, don't)\nDepending on how you manage your website - keep your operating system up-to-date\nand, if applicable, install and update antivirus software.\n[Consider using a tool like Splunk to monitor your access logs.](http://www.splunk.com/en_us/products/splunk-light.html)\nConsider installing a security plugin. For WordPress, you have a plugin called All In\nOne WordPress Security which has a ton of options to better secure your website.Don't\nforget to keep this one up-to-date as well.\n\nMore (extended) tips can be found over at StopBadware:\n[Preventing badware: Basics](https://www.stopbadware.org/prevent-badware-basics)\n\nThere are also guides available on how to harden your specific CMS installation, for\nexample:\n\n\n-----\n\nWordPress: [Hardening WordPress](http://codex.wordpress.org/Hardening_WordPress)\n[Joomla: Security Checklist/Joomla! Setup](https://docs.joomla.org/Security_Checklist/Joomla!_Setup)\nDrupal: [Writing secure code](https://www.drupal.org/writing-secure-code)\n\n**Conclusion**\n\nC99shell is obviously not dead and neither are other PHP backdoors - or any other malware\nfor that matter. Securing your website is not only beneficial for you, but also for your\ncustomers and other visitors. This blog post should have provided you with the essentials on\nsecuring your website and cleaning it up should it ever be infected\n\nRepeating: best practice is to take your website offline and restore from a back-up.\n\n**Resources**\n\n_For webmasters:_\n[StopBadware - My site has badware](https://www.stopbadware.org/my-site-has-badware)\n[Google - If your site is infected](https://support.google.com/webmasters/answer/163634?hl=en)\n[Redleg - If you're having redirects (\"Google says my site is redirecting to a malicious or spam](http://aw-snap.info/articles/redirects.php)\n_site.\")_\n\n_For researchers:_\n[Online JavaScript Beautifier - http://jsbeautifier.org/](http://jsbeautifier.org/)\nPHP Formatter - [http://beta.phpformatter.com/](http://beta.phpformatter.com/)\nKahu Security tools - [http://www.kahusecurity.com/tools/](http://www.kahusecurity.com/tools/)\n(for this specific blog post, PHP Converter is a must-use and very effective tool)\n[Base 64 Decoder - http://www.opinionatedgeek.com/dotnet/tools/Base64Decode/](http://www.opinionatedgeek.com/dotnet/tools/Base64Decode/)\n\nAbove list is obviously my own personal flavor, feel free to leave a comment with your\nfavorite tool.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-03-03 - C99Shell not dead.pdf"
    ],
    "report_names": [
        "2015-03-03 - C99Shell not dead.pdf"
    ],
    "threat_actors": [
        {
            "id": "3fad11c6-4336-4b28-a606-f510eca5452e",
            "created_at": "2022-10-25T16:07:24.346573Z",
            "updated_at": "2025-03-27T02:02:10.183211Z",
            "deleted_at": null,
            "main_name": "Turbine Panda",
            "aliases": [
                "APT 26",
                "Black Vine",
                "Bronze Express",
                "Group 13",
                "JerseyMikes",
                "KungFu Kittens",
                "PinkPanther",
                "Shell Crew",
                "Turbine Panda",
                "WebMasters"
            ],
            "source_name": "ETDA:Turbine Panda",
            "tools": [
                "Agent.dhwf",
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "FF-RAT",
                "FormerFirstRAT",
                "Hurix",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mivast",
                "PlugX",
                "RbDoor",
                "RedDelta",
                "RibDoor",
                "Sakula",
                "Sakula RAT",
                "Sakurel",
                "Sogu",
                "StreamEx",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Winnti",
                "Xamtrav",
                "cobeacon",
                "ffrat"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535732,
    "ts_updated_at": 1743041460,
    "ts_creation_date": 1653686112,
    "ts_modification_date": 1653686112,
    "files": {
        "pdf": "https://archive.orkl.eu/b7af08a234110c4d614f1993bdf7c11af2c10e97.pdf",
        "text": "https://archive.orkl.eu/b7af08a234110c4d614f1993bdf7c11af2c10e97.txt",
        "img": "https://archive.orkl.eu/b7af08a234110c4d614f1993bdf7c11af2c10e97.jpg"
    }
}