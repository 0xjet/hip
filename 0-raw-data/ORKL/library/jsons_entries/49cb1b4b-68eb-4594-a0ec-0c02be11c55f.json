{
    "id": "49cb1b4b-68eb-4594-a0ec-0c02be11c55f",
    "created_at": "2023-01-12T15:02:46.421989Z",
    "updated_at": "2025-03-27T02:10:49.305381Z",
    "deleted_at": null,
    "sha1_hash": "f7fca2b3167945791c6f7e961e6d474669627220",
    "title": "2022-02-08 - NaturalFreshMall- a mass store hack",
    "authors": "",
    "file_creation_date": "2022-05-28T23:21:43Z",
    "file_modification_date": "2022-05-28T23:21:43Z",
    "file_size": 198576,
    "plain_text": "# NaturalFreshMall: a mass store hack\n\n**sansec.io/research/naturalfreshmall-mass-hack**\n\n### 8th February 2022\n\n Web Skimming / Sansec Threat Research\nLearn about new eCommerce hacks?\n\n\nFebruary 8, 2022\n\n\n### Receive an alert whenever we discover new hacks or vulnerabilities that may affect your online store.\n\nWhat is\n\nMagecart?\n\n### Also known as digital skimming, this crime has surged since 2015. Criminals steal card data during online shopping. Who are behind these notorious hacks, how does it work, and how have Magecart attacks evolved over time?\n\n About Magecart\n\n\n-----\n\n### More than 350 ecommerce stores infected with malware in a single day.\n Today our global crawler discovered 374 ecommerce stores infected with the same strain of malware. 370 of these stores load the malware via https://naturalfreshmall[.]com/image/pixel[.]js.\n\n â€” Sansec (@sansecio) January 25, 2022\n\n Last week Sansec detected a mass breach of over 500 stores running the Magento 1 ecommerce platform. All stores were victim of a payment skimmer loaded from the\n```\nnaturalfreshmall.com domain. We invited victims to reach out to us, so we could find a\n\n common point of entry and protect other merchants against a potentional new attack. The first investigation is now completed: attackers used a clever combination of an SQL injection (SQLi) and PHP Object Injection (POI) attack to gain control of the Magento store.\n\n## Zend_Memory_Manager POI attack\n\n### Attackers abused a (known) leak in the Quickview plugin. While this is typically abused to inject rogue Magento admin users, in this case the attacker used the flaw to run code directly on the server. But how?\n\n First, the attacker abused Quickview to add a validation rule to the\ncustomer_eav_attribute table:\n45.72.31.112 2022-01-28T15:11:59Z \"GET\n/quickview/index/view/path/');UPDATE%20customer_eav_attribute%20SET%20validate_rules=\n HTTP/1.1\"\n\n The added validation rule is (result of UNHEX()):\n\n This POI payload is used to trick the host application into crafting a malicious object. In this case Zend_Memory_Manager and Zend_CodeGenerator_Php_File are used to create a file called api_1.php with a simple backdoor eval($_POST['z']) .\n\n```\n\n-----\n\n## Signing up as new customer, activates attack\n\n### However, just adding it to the database will not run the code. Magento actually needs to unserialize the data. And there is the cleverness of this attack: by using the validation rules for new customers, the attacker can trigger an unserialize by simply browing the Magento sign up page. This is illustrated with the following requests:\n```\n45.72.31.112  2022-01-28T15:12:02Z \"GET /customer/account/create/ HTTP/1.1\"\n45.72.31.112  2022-01-28T15:12:08Z \"GET /api_1.php HTTP/1.1\"\n\n Voila! The attacker can now run any PHP code via the api_1.php backdoor.\n\n Are you also victim of this hack? Reach out to us and we will run a clean-up and investigation free of charge.\n\n## Other indicators of compromise\n\n### In this case, the attacker left no less than 19 (!) backdoors on the system. It is essential to eliminate each and every one of them, because leaving one in place means that your system will be hit again next week.\n\n The actual payment interception code was added to the core_config_data table in the\ndesign/footer/absolute_footer section.\n\n The following files were either entirely malicious, or are part of the Magento code but had malicious code added to them. Your system may have similar or entirely different backdoors, so we recommend to run a malware scanner to find all of them.\n/api.php\n/api_1.php\n/install.php\n/sc_api.php\n/phpinfo.php\n/adminer.php\n/app/code/core/Mage/Page/Block/Html.php\n/errors/api.php\n/media/api.php\n/media/catalog/category/test.jpeg\n/media/catalog/category/panch.jpg\n/js/api.php\n/js/cartcheckout.php\n/skin/api.php\n/skin/adminhtml/default/default/images/loader.php\n/skin/adminhtml/default/default/controller.php\n/skin/frontend/default/default/upldr.php\n/skin/frontend/base/default/conf.php\n/var/importexport/customer.csv\n\n IPs that were implicated in this attack:\n\n```\n\n-----\n\n```\n132.255.135.230 US 52485 networksdelmanana.com\n132.255.135.51 US 52485 networksdelmanana.com\n138.36.92.216  US 265645 HOSTINGFOREX S.A.\n138.36.92.253  US 265645 HOSTINGFOREX S.A.\n138.36.93.206  US 265645 HOSTINGFOREX S.A.\n138.36.94.2   US 265645 HOSTINGFOREX S.A.\n138.36.94.224  US 265645 HOSTINGFOREX S.A.\n138.36.94.241  US 265645 HOSTINGFOREX S.A.\n138.36.94.59  US 265645 HOSTINGFOREX S.A.\n138.94.216.131 US 263744 Udasha S.A.\n138.94.216.172 US 263744 Udasha S.A.\n138.94.216.186 US 263744 Udasha S.A.\n138.94.216.230 US 263744 Udasha S.A.\n141.193.20.147 US 64249 ENDOFFICE\n144.168.218.117 US 55286 SERVER-MANIA\n144.168.218.136 US 55286 SERVER-MANIA\n144.168.218.249 US 55286 SERVER-MANIA\n144.168.218.70 US 55286 SERVER-MANIA\n144.168.218.94 US 55286 SERVER-MANIA\n144.168.221.92 US 55286 SERVER-MANIA\n186.179.14.102 US 52393 Corporacion Dana S.A.\n186.179.14.134 US 52393 Corporacion Dana S.A.\n186.179.14.179 US 52393 Corporacion Dana S.A.\n186.179.14.204 US 52393 Corporacion Dana S.A.\n186.179.14.44  US 52393 Corporacion Dana S.A.\n186.179.14.76  US 52393 Corporacion Dana S.A.\n186.179.14.97  US 52393 Corporacion Dana S.A.\n186.179.39.183 US 52393 Corporacion Dana S.A.\n186.179.39.226 US 52393 Corporacion Dana S.A.\n186.179.39.35  US 52393 Corporacion Dana S.A.\n186.179.39.7  US 52393 Corporacion Dana S.A.\n186.179.39.74  US 52393 Corporacion Dana S.A.\n186.179.47.205 US 52393 Corporacion Dana S.A.\n186.179.47.39  US 52393 Corporacion Dana S.A.\n191.102.149.106 US 394474 WHITELABELCOLO393\n191.102.149.197 US 394474 WHITELABELCOLO393\n191.102.149.253 US 394474 WHITELABELCOLO393\n191.102.163.202 US 394474 WHITELABELCOLO393\n191.102.163.208 US 394474 WHITELABELCOLO393\n191.102.163.7  US 394474 WHITELABELCOLO393\n191.102.163.74 US 394474 WHITELABELCOLO393\n191.102.170.173 US 394474 WHITELABELCOLO393\n191.102.170.81 US 394474 WHITELABELCOLO393\n191.102.174.128 US 394474 WHITELABELCOLO393\n191.102.174.211 US 394474 WHITELABELCOLO393\n191.102.174.239 US 394474 WHITELABELCOLO393\n191.102.174.247 US 394474 WHITELABELCOLO393\n191.102.174.52 US 394474 WHITELABELCOLO393\n191.102.179.22 US 394474 WHITELABELCOLO393\n191.102.179.31 US 394474 WHITELABELCOLO393\n191.102.179.62 US 394474 WHITELABELCOLO393\n192.198.123.164 US 55286 SERVER-MANIA\n192.198.123.225 US 55286 SERVER-MANIA\n192.198.123.226 US 55286 SERVER-MANIA\n192.198.123.43 US 55286 SERVER-MANIA\n\n```\n\n-----\n\n```\n192.241.67.128 US 55286 SERVER MANIA\n193.32.8.1   US 201814 Meverywhere sp. z o.o.\n193.32.8.33   US 201814 Meverywhere sp. z o.o.\n193.32.8.63   US 201814 Meverywhere sp. z o.o.\n193.32.8.76   US 201814 Meverywhere sp. z o.o.\n193.8.238.91  US 60781 LeaseWeb Netherlands B.V.\n195.123.246.212 CZ 204957 ITL-Bulgaria Ltd.\n198.245.77.132 US 55081 24SHELLS\n198.245.77.217 US 55081 24SHELLS\n198.245.77.253 US 55081 24SHELLS\n206.127.242.99 US 201106 Spartan Host Ltd\n209.127.104.174 US 55286 SERVER-MANIA\n209.127.105.225 US 55286 SERVER-MANIA\n209.127.105.73 US 55286 SERVER-MANIA\n209.127.106.211 US 55286 SERVER-MANIA\n209.127.106.44 US 55286 SERVER-MANIA\n209.127.107.141 US 55286 SERVER-MANIA\n209.127.107.169 US 55286 SERVER-MANIA\n209.127.107.187 US 55286 SERVER-MANIA\n209.127.109.138 US 55286 SERVER-MANIA\n209.127.109.225 US 55286 SERVER-MANIA\n209.127.109.87 US 55286 SERVER-MANIA\n209.127.110.144 US 55286 SERVER-MANIA\n209.127.110.177 US 55286 SERVER-MANIA\n209.127.111.68 US 55286 SERVER-MANIA\n209.127.111.99 US 55286 SERVER-MANIA\n209.127.116.101 US 55286 SERVER-MANIA\n209.127.116.167 US 55286 SERVER-MANIA\n209.127.116.231 US 55286 SERVER-MANIA\n209.127.117.214 US 55286 SERVER-MANIA\n209.127.117.49 US 55286 SERVER-MANIA\n209.127.118.136 US 55286 SERVER-MANIA\n209.127.118.96 US 55286 SERVER-MANIA\n209.127.172.15 US 55081 24SHELLS\n209.127.172.60 US 55081 24SHELLS\n209.127.172.99 US 55081 24SHELLS\n209.127.173.13 US 55081 24SHELLS\n209.127.173.154 US 55081 24SHELLS\n209.127.173.215 US 55081 24SHELLS\n209.127.174.177 US 55081 24SHELLS\n209.127.175.113 US 55081 24SHELLS\n209.127.97.6  US 55286 SERVER-MANIA\n209.127.98.244 US 55286 SERVER-MANIA\n209.127.98.81  US 55286 SERVER-MANIA\n209.127.98.91  US 55286 SERVER-MANIA\n209.127.99.16  US 55286 SERVER-MANIA\n209.127.99.205 US 55286 SERVER-MANIA\n217.170.207.111 NO 34989 ServeTheWorld AS\n23.106.125.64  SG 59253 Leaseweb Asia Pacific pte. ltd.\n45.72.112.143  US 55081 24SHELLS\n45.72.18.133  US 55081 24SHELLS\n45.72.18.234  US 55081 24SHELLS\n45.72.18.236  US 55081 24SHELLS\n45.72.31.112  US 55081 24SHELLS\n45.72.85.178  US 55081 24SHELLS\n\n```\n\n-----\n\n```\n45.72.86.142  US 55081 24SHELLS\n45.72.86.201  US 55081 24SHELLS\n\n### NB. While the Magento 1 platform has been declared End-Of-Life by Adobe, thousands of professional merchants are still using it. As Adobe does not provide security patches anymore, we recommend to take extra measures to keep your store safe. Monitoring for malware is vital (such as with our ecomscan scanner). Also, there are community-provided patches available for Magento 1. Either open-source via OpenMage or with commercial support via Mage-One.\n\n data-size=\"large\" > Follow @sansecio\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-08 - NaturalFreshMall- a mass store hack.pdf"
    ],
    "report_names": [
        "2022-02-08 - NaturalFreshMall- a mass store hack.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "5a0483f5-09b3-4673-bb5a-56d41eaf91ed",
            "created_at": "2023-01-06T13:46:38.814104Z",
            "updated_at": "2025-03-27T02:00:02.925972Z",
            "deleted_at": null,
            "main_name": "MageCart",
            "aliases": [],
            "source_name": "MISPGALAXY:MageCart",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535766,
    "ts_updated_at": 1743041449,
    "ts_creation_date": 1653780103,
    "ts_modification_date": 1653780103,
    "files": {
        "pdf": "https://archive.orkl.eu/f7fca2b3167945791c6f7e961e6d474669627220.pdf",
        "text": "https://archive.orkl.eu/f7fca2b3167945791c6f7e961e6d474669627220.txt",
        "img": "https://archive.orkl.eu/f7fca2b3167945791c6f7e961e6d474669627220.jpg"
    }
}