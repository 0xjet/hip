{
    "id": "01d4de1e-ffb0-4090-83b7-a6370090cdfa",
    "created_at": "2022-10-25T16:48:12.77709Z",
    "updated_at": "2025-03-27T02:17:16.834475Z",
    "deleted_at": null,
    "sha1_hash": "ffac1bcec0a990cdf9e995766efd19b473e4785a",
    "title": "",
    "authors": "",
    "file_creation_date": "2021-01-07T06:12:54Z",
    "file_modification_date": "2021-01-07T06:12:54Z",
    "file_size": 337350,
    "plain_text": "# The Case of the Modified Binaries\n\n**[leviathansecurity.com/blog/the-case-of-the-modified-binaries](https://www.leviathansecurity.com/blog/the-case-of-the-modified-binaries)**\n\nJosh Pitts October 23, 2014\n\n## Summary\n\nAfter creating and using a new exitmap module, I found downloaded binaries being\npatched through a Tor exit node in Russia. Tor is a wonderful tool for protecting the\nidentity of journalists, their sources, and even regular users around the world; however,\nanonymity does not guarantee security.\n\n## Background\n\n[At DerbyCon this year I gave a presentation of my binary patching framework, BDF.](http://www.youtube.com/watch?v=LjUN9MACaTs)\nMany binaries are hosted without any transport layer security encryption. Some binaries\nare signed to prevent modification, but most are not. During that presentation, I talked\nabout the MITM patching of binaries during download, and showed how easy it was\n[using BDFProxy. I also mentioned that similar techniques are probably already in use on](https://github.com/secretsquirrel/BDFProxy)\nthe Internet.\n\nI had only circumstantial evidence until recently.\n\n## Circumstantial Evidence\n\n Microsoft Updates Error\n\nI tested BDFProxy against a number of binaries and update processes, including\nMicrosoft Windows Automatic updates. The good news is that if an entity is actively\npatching Windows PE files for Windows Update, the update verification process detects\nit, and you will receive error code 0x80200053.\n\n\n-----\n\nfailedSigs\n\nThis error code indicates a failed signature verification for the downloaded binary.\nWindows Update produces this error code for three root causes:\n\n1. The file was truncated during download. Very possible.\n2. The file was patched during download. Improbable.\n3. MS certificate verification is broken. Very improbable.\n\nIf you Google the error code, the official Microsoft response is troublesome.\n\n\n-----\n\nGoogle_error_80200053\n\n[The first link will bring you to the official Microsoft Answers website. Notice that this](http://answers.microsoft.com/en-us/windows/forum/windows_other-windows_update/error-code-80200053-on-windows-update-in-windows-7/0dafeca5-66ab-47c0-b594-c363f11961f1)\nquestion has been viewed over 34,000 times.\n\nquestion\n\nIf you follow the three steps from the official MS answer, two of those steps result in\ndownloading and executing a MS 'Fixit' solution executable.\n\n\n-----\n\nanswer\n\nIf an adversary is currently patching binaries as you download them, these ‘Fixit’\nexecutables will also be patched. Since the user, not the automatic update process, is\ninitiating these downloads, these files are not automatically verified before execution as\nwith Windows Update. In addition, these files need administrative privileges to execute,\nand they will execute the payload that was patched into the binary during download with\nthose elevated privileges.\n\nNote: a Windows Home or Enterprise user could configure AppLocker to only run signed\nbinaries.\n\n## Nullsoft Scriptable Install System (NSIS) Error\n\nNSIS provides a form of self-checking that weakly ensures that a binary was not\nmodified after compiling. It issues the following error when the self-checking fails:\n\n\n-----\n\nNSIScheck\n\nLooking at [Google Trends, this error message is quite common:](https://www.google.com/trends/explore#q=NSIS%20error)\n\nNSISerror\n\nNotice the top countries where this search is originating:\n\n\n-----\n\ntopCountries\n\nA user can receive an error code for any of the following three root causes:\n\n1. The binary was patched. Improbable.\n2. The binary was truncated due to a poor Internet connection. Very probable.\n3. An actual error with the install program. Very improbable.\n\nThis combined circumstantial evidence left me wondering if there is an individual or\ngroup actively patching binaries on the greater Internet.\n\n## Caught Red-Handed\n\nTo have the best chance of catching modified binaries in transit over the Internet, I\n[needed as many exit points in as many countries as possible. Using Tor would give me](https://www.torproject.org/index.html.en)\nthis access, and thus the greatest chance of finding someone conducting this malicious\nMITM patching activity.\n\n[After researching the available tools, I settled on exitmap. Exitmap is Python-based and](https://github.com/NullHypothesis/exitmap)\nallows one to write modules to check exit nodes for various modifications of traffic.\n[Exitmap is the result of a research project called Spoiled Onions that was completed by](http://www.cs.kau.se/philwint/spoiled_onions/)\n[both the PriSec group at Karlstad University and SBA Research in Austria.](http://prisec.kau.se/)\n\n[I wrote a module for exitmap, named patchingCheck.py, and have submitted a pull](https://github.com/leviathansecurity/exitmap/blob/master/src/modules/patchingCheck.py)\n[request to the official GitHub repository. See the usage example.](https://github.com/leviathansecurity/exitmap/blob/master/src/modules/patchingCheck.py#L45)\n\nSoon after building my module, I let exitmap run. It did not take long, about an hour, to\ncatch my first malicious exit node.\n\n\n-----\n\nfalseNegative\n\nDetails from https://check.torproject.org/exit-addresses\n\nExitNode 8361A794DFA231D863E109FC9EEEF21F4CF09DDD\n\nPublished 2014-10-22 01:06:40\n\nLastStatus 2014-10-22 02:02:33\n\nExitAddress 78.24.222.229 2014-10-22 02:08:01\n\nThis exit node was very active.\n\n**Patched Binaries by Exit Node**\n**8361A794DFA231D863E109FC9EEEF21F4CF09DDD**\n\n**Original Binary Download URL**\n\n**Online Sandbox Analysis URL**\n\nhttp://download.microsoft.com/download/5/B/C/5BC5DBB3-652D-4DCE-B14A475AB85EEF6E/vcredist_x86.exe\n\n[Malwr.com Analysis Results](https://malwr.com/analysis/ZmY0ZGFlY2ZjMWMzNDNkZmE3YzE1MzhjNWEyNjlhNTk/)\n\nhttp://download.microsoft.com/download/3/2/2/3224B87F-CFA0-4E70-BDA33DE650EFEBA5/vcredist_x64.exe\n\n[Malwr.com Analysis Results](https://malwr.com/analysis/N2Y2MWZiODdkODIwNDZiOGIzYTA2NGI5ZTY4MDBkMTc/)\n\nhttp://download.tuxfamily.org/notepadplus/6.6.9/npp.6.6.9.Installer.exe\n\n[Malwr.com Analysis Results](https://malwr.com/analysis/OTY5MDQyNzcxNjQyNDYzMDkzMWRlZGRiOTI3MTU4MzA/)\n\nhttp://downloads.malwarebytes.org/file/mbam/\n\n[Malwr.com Analysis Results](https://malwr.com/analysis/OWY1YTI1ZDI4OGNmNDU3MThiM2E5NGU3ZDI5OTk4ODI/)\n\nhttp://live.sysinternals.com/psexec.exe\n\n[Malwr.com Analysis Results](https://malwr.com/analysis/OTBkOTc1OTdhMWM3NGU0ZWEzMjUyOWM2NmIxZGNiMDQ/)\n\nhttp://live.sysinternals.com/tcpview.exe\n\n[Malwr.com Analysis Results](https://malwr.com/analysis/ZjBlMWNjOTM4NmFjNGYyNzkyYmMzOGY3ZjU1YWNjOGY/)\n\nhttp://nmap.org/dist/nmap-6.47-setup.exe\n\nOver size limit for Malwr.com.\n\n\n-----\n\n[VirusTotal Results](https://www.virustotal.com/en/file/7060ed6c3d3015e245142465ab14e38d8f9c38bef5da4d2d2983e3c2252add57/analysis/1414001690/)\n\nhttp://www.ntcore.com/files/ExplorerSuite.exe\n\n[Malwr.com Analysis Results](https://malwr.com/analysis/MTIyYzFjYmQzM2IyNDNhNjkyNWMwNWQwYjE3OWEyMGU/)\n\nhttp://www.spybotupdates.com/files/filealyz-2.0.5.57.exe\n\n[Malwr.com Analysis Results](https://malwr.com/analysis/ZjI1OGMwYTRiMjk1NGM5ZGE5ZGZjNWUyZmM0M2NlNWE/)\n\nhttp://live.sysinternals.com/procexp.exe\n\n[Malwr.com Analysis Results](https://malwr.com/analysis/ODQwY2JkYzk1MDM5NDBjNWE1NDAyODU0Nzg3OWQ3OWQ/)\n\nUpon further inspection, the original binary is wrapped within another binary similar to\nthe technique mentioned in the research from Flex Grobert, et al, titled “Software\nDistribution Malware Infection Vector” (2008). However, these malware authors solved\nthe icon issue noted in the paper by keeping the .rsrc section intact. By using a wrapper\nfor the original binary, the malware authors do not invoke the NSIS error and bypass\nsimple self-checking mechanisms.\n\nOut of over 1110 exit nodes on the Tor network, this is the only node that I found\npatching binaries, although this node attempts to patch just about all the binaries that I\ntested. The node only patched uncompressed PE files. This does not mean that other\nnodes on the Tor network are not patching binaries; I may not have caught them, or they\nmay be waiting to patch only a small set of binaries.\n\nLeviathan has notified the Tor Project of the issue.\n\n## Going Forward\n\nCompanies and developers need to make the conscious decision to host binaries via\nSSL/TLS, whether or not the binaries are signed. All people, but especially those in\ncountries hostile to “Internet freedom,” as well as those using Tor anywhere, should be\nwary of downloading binaries hosted in the clear---and all users should have a way of\nchecking hashes and signatures out of band prior to executing the binary.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.10.23.Modified_Binaries/leviathansecurity.com-The%20Case%20of%20the%20Modified%20Binaries.pdf"
    ],
    "report_names": [
        "leviathansecurity.com-The Case of the Modified Binaries"
    ],
    "threat_actors": [
        {
            "id": "59be3740-c8c7-47aa-84c8-e80d0cb7ea3a",
            "created_at": "2022-10-25T15:50:23.481057Z",
            "updated_at": "2025-03-27T02:00:55.480695Z",
            "deleted_at": null,
            "main_name": "Leviathan",
            "aliases": [
                "MUDCARP",
                "Kryptonite Panda",
                "Gadolinium",
                "BRONZE MOHAWK",
                "TEMP.Jumper",
                "APT40",
                "TEMP.Periscope",
                "Gingham Typhoon"
            ],
            "source_name": "MITRE:Leviathan",
            "tools": [
                "Windows Credential Editor",
                "BITSAdmin",
                "HOMEFRY",
                "Derusbi",
                "at",
                "BLACKCOFFEE",
                "BADFLICK",
                "gh0st RAT",
                "PowerSploit",
                "MURKYTOP",
                "NanHaiShu",
                "Orz",
                "Cobalt Strike",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b9806584-4d82-4f32-ae97-18a2583e8d11",
            "created_at": "2022-10-25T16:07:23.787833Z",
            "updated_at": "2025-03-27T02:02:09.978883Z",
            "deleted_at": null,
            "main_name": "Leviathan",
            "aliases": [
                "APT 40",
                "ATK 29",
                "Bronze Mohawk",
                "Gadolinium",
                "Gingham Typhoon",
                "ISLANDDREAMS",
                "ITG09",
                "Kryptonite Panda",
                "Mudcarp",
                "Red Ladon",
                "TA423",
                "TEMP.Jumper",
                "TEMP.Periscope"
            ],
            "source_name": "ETDA:Leviathan",
            "tools": [
                "AIRBREAK",
                "Agent.dhwf",
                "Agentemis",
                "AngryRebel",
                "BADFLICK",
                "BlackCoffee",
                "CHINACHOPPER",
                "China Chopper",
                "Cobalt Strike",
                "CobaltStrike",
                "DADJOKE",
                "Dadstache",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "Farfli",
                "GRILLMARK",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEFRY",
                "Hellsing Backdoor",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "LUNCHMONEY",
                "Living off the Land",
                "MURKYTOP",
                "Moudour",
                "Mydoor",
                "NanHaiShu",
                "Orz",
                "PCRat",
                "PNGRAT",
                "PlugX",
                "RedDelta",
                "SeDLL",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "ZoxPNG",
                "cobeacon",
                "gresim",
                "scanbox"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "83025f5e-302e-46b0-baf6-650a4d313dfc",
            "created_at": "2024-05-01T02:03:07.971863Z",
            "updated_at": "2025-03-27T02:05:17.278721Z",
            "deleted_at": null,
            "main_name": "BRONZE MOHAWK",
            "aliases": [
                "Flaccid Rose ",
                "GADOLINIUM ",
                "Kryptonite Panda ",
                "Leviathan ",
                "Nanhaishu ",
                "Pickleworm ",
                "Temp.Jumper ",
                "Temp.Periscope ",
                "APT40 "
            ],
            "source_name": "Secureworks:BRONZE MOHAWK",
            "tools": [
                " BlackCoffee",
                " China Chopper",
                " Cobalt Strike",
                " Derusbi",
                " Derusbi Trojan",
                " FUSIONBLAZE",
                " GreenCrash",
                " HOMEFRY",
                " MURKYTOP",
                " Metasploit",
                " Metasploit / Meterpreter",
                " Nanhaishu",
                " Orz",
                " ScanBox",
                " SeDll",
                "AIRBREAK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1666716492,
    "ts_updated_at": 1743041836,
    "ts_creation_date": 1609999974,
    "ts_modification_date": 1609999974,
    "files": {
        "pdf": "https://archive.orkl.eu/ffac1bcec0a990cdf9e995766efd19b473e4785a.pdf",
        "text": "https://archive.orkl.eu/ffac1bcec0a990cdf9e995766efd19b473e4785a.txt",
        "img": "https://archive.orkl.eu/ffac1bcec0a990cdf9e995766efd19b473e4785a.jpg"
    }
}