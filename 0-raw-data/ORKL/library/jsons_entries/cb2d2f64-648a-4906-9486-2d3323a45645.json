{
    "id": "cb2d2f64-648a-4906-9486-2d3323a45645",
    "created_at": "2023-01-12T15:07:12.813996Z",
    "updated_at": "2025-03-27T02:15:26.183363Z",
    "deleted_at": null,
    "sha1_hash": "3fc4c9f9ba49cb518c3dfdc9c303c9024882889a",
    "title": "2022-04-07 - A Bad Luck BlackCat",
    "authors": "",
    "file_creation_date": "2022-05-28T02:05:31Z",
    "file_modification_date": "2022-05-28T02:05:31Z",
    "file_size": 1387610,
    "plain_text": "# A Bad Luck BlackCat\n\n**securelist.com/a-bad-luck-blackcat/106254/**\n\nAuthors\n\nGReAT\n\nIn early December 2021, a new ransomware actor started advertising its services on a Russian\nunderground forum. They presented themselves as ALPHV, a new generation Ransomwareas-a-Service (RaaS) group. Shortly afterwards, they dialed up their activity, infecting numerous\ncorporate victims around the world. The group is also known as BlackCat.\n\nOne of the biggest differences from other ransomware actors is that BlackCat malware is\nwritten in Rust, which is unusual for malware developers. Their infrastructure websites are also\ndeveloped differently from other ransomware groups. Due to Rust’s advanced crosscompilation capabilities, both Windows and Linux samples appear in the wild. In other words,\nBlackCat has introduced incremental advances and a shift in technologies to address the\nchallenges of ransomware development.\n\nThe actor portrays itself as a successor to notorious ransomware groups like BlackMatter and\nREvil. The cybercriminals claim they have addressed all the mistakes and problems in\nransomware development and created the perfect product in terms of coding and\ninfrastructure. However, some researchers see the group not only as the successors to the\n\n\n-----\n\nBlackMatter and REvil groups, but as a complete rebranding. Our telemetry suggests that at\nleast some members of the new BlackCat group have links to the BlackMatter group, because\nthey modified and reused a custom exfiltration tool we call Fendr and which has only been\nobserved in BlackMatter activity.\n\nThis use of a modified Fendr, also known as ExMatter, represents a new data point connecting\nBlackCat with past BlackMatter activity. The group attempted to deploy the malware\nextensively within organizations in December 2021 and January 2022. BlackMatter prioritized\ncollection of sensitive information with Fendr to successfully support their scheme of double\ncoercion. In addition, the modification of this reused tool demonstrates a more sophisticated\nplanning and development regimen for adapting requirements to target environments,\ncharacteristic of a maturing criminal enterprise.\n\n## Two incidents of special interest\n\nTwo recent BlackCat incidents stand out as particularly interesting. One demonstrates the risk\npresented by shared cloud hosting resources, and the other demonstrates an agile approach\nto customized malware re-use across BlackMatter and BlackCat activity.\n\nIn the first case, it appears the ransomware group penetrated a vulnerable ERP provider in the\nMiddle East hosting multiple sites. The attackers delivered two different executables\nsimultaneously to the same physical server, targeting two different organizations virtually\nhosted there. The initial access was mistaken by the attackers for two different physical\nsystems and drives to infect and encrypt. The kill chain was triggered prior to the “preencryption” activity, but the real point of interest here lies in the shared vulnerabilities and the\ndemonstrable risk of shared assets across cloud resources. At the same time, the group also\ndelivered a Mimikatz batch file along with executables and Nirsoft network password recovery\nutilities. In a similar incident dating back to 2019, REvil, a predecessor of BlackMatter, appears\nto have penetrated a cloud service supporting a large number of dental offices in the US.\nPerhaps this same affiliate has reverted to some old tactics.\n\nThe second case involves an oil, gas, mining and construction company in South America.\nThis related incident further connects BlackMatter ransomware activity with BlackCat. Not only\ndid the affiliate behind this ransomware incident attempt to deliver BlackCat ransomware within\nthe target network, but approximately 1 hour 40 minutes before its delivery they installed a\nmodified custom exfiltration utility that we call Fendr. Also known as ExMatter, this utility had\npreviously been used exclusively in BlackMatter ransomware activity.\n\nHere, we can see that the BlackCat group increased the number of file extensions for\nautomatic collection and exfiltration by the tool:\n\nFendr file extensions\n(17146b91dfe7f3760107f8bc35f4fd71)\n\n.doc .docx .xls .xlsx .xlsm .pdf\n\n\n-----\n\n.msg .ppt .pptx .sda .sdm .sdw\n\n.zip .json .config .ts .cs .sqlite\n\n.aspx .pst .rdp .accdb .catpart .catproduct\n\n.catdrawing .3ds .dwt .dxf .csv\n\nThese additional file extensions are used in industrial design applications, like CAD drawings\nand some databases, as well as RDP configuration settings, making the tool more customized\ntowards the industrial environments that we see being targeted by this group. And, if we\nbelieve the PE header timestamp, the group compiled this Fendr modification just a few hours\nbefore its initial use. One of the organizations targeted with the Fendr exfiltration tool has\nbranches all over the world, resulting in a surprising mix of locations. Not all of the systems\nreceived a ransomware executable.\n\n## Technical details\n\n**MD5** B6B9D449C9416ABF96D21B356A41A28E\n\n**SHA1** 38fa2979382615bbee32d1f58295447c33ca4316\n\n**SHA256** be8c5d07ab6e39db28c40db20a32f47a97b7ec9f26c9003f9101a154a5a98486\n\n**Compiler** Rust\n\n**Filesize** 2.94 MB\n\nThe analyzed BlackCat ransomware file “<xxx>_alpha_x86_32_windows_encrypt_app.exe” is\na 32-bit Windows executable file that was coded in Rust. The resulting Rust compiled binaries\nuse the Rust standard library with a lot of safety checks, memory allocations, string processing,\nand other operations. They also include various external crates with libraries for required\nfunctionality, like Base64, AES encryption, etc. This particular language, and its compilation\noverhead, makes disassembly analysis more complicated. However, with the proper approach\nand Rust STD function signatures applied in IDA (or your disassembler of choice, for example\nGhidra), it’s possible to understand the full malware capabilities with static analysis. Additional\nRust library usage can be obtained from strings in clear form as no obfuscation is whatsoever\nused by the malware:\n\n\n-----\n\n**_External cargo is used in malware_**\n\nRust is a cross-compilation language, so a number of BlackCat Linux samples quickly\nappeared in the wild shortly after their Windows counterparts.\n\nThis BlackCat sample is a command line application. After execution, it checks the command\nline arguments provided:\n\n\n-----\n\n**_Command line arguments for malware_**\n\nBlackCat is an affiliate actor. This means it provides infrastructure, malware samples, ransom\nnegotiations, and probably cash-out. Anyone who already has access to compromised\nenvironments can use BlackCat’s samples to infect a target. And a little help with ransomware\nexecution is likely to come in handy.\n\nThe command line arguments are pretty self-explanatory. Some are related to VM’s, such as\nwiping or not wiping VM snapshots or stopping VM on ESXi. Also, it’s possible to select\nspecific file folders to process or execute malware as a child process.\n\nShortly after execution, the malware gets the “MachineGuid” from the corresponding Windows\nregistry key:\n\n**_Obtaining machine GUID_**\n\nThis GUID will be used later in the encryption key generation process.\n\nThe malware then gets a unique machine identifier (UUID) using a WMIC query executed as a\nseparate command by creating a new cmd.exe process:\n\n**_Obtaining UUID_**\n\nThis UUID is used together with the “–access-token” command-line argument to generate a\nunique ACCESS KEY for victim identification.\n\n\n-----\n\nBlackCat ransomware uses Windows named pipes for inter-process communication. For\nexample, data returned by the cmd.exe process will be written into named pipes and later\nprocessed by malware:\n\n**_Pipe creation_**\n\n_The names of the pipes are not unique and are hard-coded into malicious samples._\n\nThe malware checks which version of the Windows operating system it’s being executed\nunder. That is done using the fairly standard technique of getting this information from the\nProcess Environment Block structure:\n\n**_Obtaining OS version_**\n\nThe operating system version is required to implement a proper Privilege Escalation technique\nsuch as:\n\nSimple process token impersonation\nCOM elevation moniker UAC Bypass\n\n\n-----\n\n**_COM object initialization_**\n\n[The malware uses a previously known technique, used by LockBit ransomware, for example,](https://gist.github.com/api0cradle/d4aaef39db0d845627d819b2b6b30512)\nto exploit an undocumented COM object (3E5FC7F9-9A51-4367-9063-A120244FBEC7). It is\nvulnerable to the CMSTPLUA UAC bypass.\n\nUsing “cmd.exe” malware executes a special command:\n\n1 fsutil behavior set SymlinkEvaluation R2L:1\n\nThis command adjusts the behavior of the Windows file system symlinks. It allows the malware\nto follow shortcuts with remote paths.\n\nAnother command executed as part of pre-encryption is:\n\n1 vssadmin.exe delete shadows /all /quiet\n\nThis is almost standard for any ransomware and deletes all Windows shadow copy backups.\nThen the malware gets a list of services to be killed, as well as files and folders to be excluded\nfrom the encryption process, kills processes and starts encryption using separate working\nthreads:\n\n\n-----\n\n**_Embedded process list to kill_**\n\nThis particular sample was observed to be run with “–access-token xxx –no-prop-servers \\\\xxx\n–propagated” command line parameters. In addition to the activity detailed above, the malware\nwill attempt to propagate, but will not re-infect the server that it is attempting to run on. It will\nperform a hard stop on any IIS services hosted on the system with “iisreset.exe /stop”, check\nthe local area network for immediately reachable systems with “arp -a”, and increase the upper\nlimit on the number of concurrent commands that can be outstanding between a client and a\nserver by increasing the MaxMpxCt to the maximum allowed with:\n\n\n1\n\n2\n\n3\n\n\ncmd /c reg add\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters\n/v\n\nMaxMpxCt /d 65535 /t REG_DWORD /f\n\n\nAlso, it is notable that the group uses a compressed version of PsExec to spread laterally\nwithin an organization, as was observed with the remote execution of this sample.\n\nThe malware appends an extension to the encrypted files, but the exact extension varies from\nsample to sample. The extension can be found hard-coded in the malware’s JSON formatted\nconfiguration file.\n\n\n-----\n\nFor encryption, the malware used the standard BCryptGenRandom Windows API function to\ngenerate encryption keys. AES or CHACHA20 algorithms are used for file encryption. The\nglobal public key that is used to encrypt local keys is extracted from the configuration file.\n\nMost of these executables maintain a hard-coded set of username/password combinations that\nwere stolen earlier from the victim organization for use during propagation and privilege\nescalation. There often appears to be almost half a dozen accounts, and a combination of\ndomain administrative and service level credentials. This means the individual executable is\ncompiled specifically for the target organization, containing sensitive information about the\norganization.\n\nAfter the encryption process, the malware drops a ransomware note with details on how to\ncontact the BlackCat ransomware operators.\n\n## Conclusion\n\nAfter the REvil and BlackMatter groups shut down their operations, it was only a matter of time\nbefore another ransomware group took over the niche. Knowledge of malware development, a\nnew written-from-scratch sample in an unusual programming language, and experience in\nmaintaining infrastructure is turning the BlackCat group into a major player on the ransomware\nmarket.\n\nHere we present a new data point connecting BlackCat with past BlackMatter activity – the\nreuse of the exfiltration malware Fendr. The group modified the malware for a new set of\nvictims collected from data stores commonly seen in industrial network environments. BlackCat\nattempted to deploy the malware extensively within at least two organizations in December\n2021 and January 2022. In the past, BlackMatter prioritized collection of sensitive information\nwith Fendr to successfully support their double coercion scheme, just as BlackCat is now\ndoing, and it demonstrates a practical but brazen example of malware re-use to execute their\nmulti-layered blackmail. The modification of this reused tool demonstrates a more\nsophisticated planning and development regimen for adapting requirements to target\nenvironments, characteristic of a more effective and experienced criminal program.\n\n[Cybercrime](https://securelist.com/tag/cybercrime/)\n[Data Encryption](https://securelist.com/tag/data-encryption/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[Malware Technologies](https://securelist.com/tag/malware-technologies/)\n[Ransomware](https://securelist.com/tag/ransomware/)\n[Targeted attacks](https://securelist.com/tag/targeted-attacks/)\n\nAuthors\n\n\n-----\n\nGReAT\n\nA Bad Luck BlackCat\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-07 - A Bad Luck BlackCat.pdf"
    ],
    "report_names": [
        "2022-04-07 - A Bad Luck BlackCat.pdf"
    ],
    "threat_actors": [
        {
            "id": "6e23ce43-e1ab-46e3-9f80-76fccf77682b",
            "created_at": "2022-10-25T16:07:23.303713Z",
            "updated_at": "2025-03-27T02:02:09.727245Z",
            "deleted_at": null,
            "main_name": "ALPHV",
            "aliases": [
                "ALPHV",
                "ALPHVM",
                "BlackCat Gang",
                "UNC4466"
            ],
            "source_name": "ETDA:ALPHV",
            "tools": [
                "ALPHV",
                "ALPHVM",
                "BlackCat",
                "GO Simple Tunnel",
                "GOST",
                "Impacket",
                "LaZagne",
                "MEGAsync",
                "Mimikatz",
                "Munchkin",
                "Noberus",
                "PsExec",
                "Remcom",
                "RemoteCommandExecution",
                "WebBrowserPassView"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536032,
    "ts_updated_at": 1743041726,
    "ts_creation_date": 1653703531,
    "ts_modification_date": 1653703531,
    "files": {
        "pdf": "https://archive.orkl.eu/3fc4c9f9ba49cb518c3dfdc9c303c9024882889a.pdf",
        "text": "https://archive.orkl.eu/3fc4c9f9ba49cb518c3dfdc9c303c9024882889a.txt",
        "img": "https://archive.orkl.eu/3fc4c9f9ba49cb518c3dfdc9c303c9024882889a.jpg"
    }
}