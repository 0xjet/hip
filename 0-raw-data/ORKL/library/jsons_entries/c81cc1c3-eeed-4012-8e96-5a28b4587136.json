{
    "id": "c81cc1c3-eeed-4012-8e96-5a28b4587136",
    "created_at": "2023-01-12T15:06:24.834352Z",
    "updated_at": "2025-03-27T02:05:51.144359Z",
    "deleted_at": null,
    "sha1_hash": "118e5f249a8c0f019905d9bf7ecb99cb0124e946",
    "title": "2014-12-18 - Chthonic- a new modification of ZeuS",
    "authors": "",
    "file_creation_date": "2022-05-28T16:50:30Z",
    "file_modification_date": "2022-05-28T16:50:30Z",
    "file_size": 1286342,
    "plain_text": "# Chthonic: a new modification of ZeuS\n\n**[securelist.com/chthonic-a-new-modification-of-zeus/68176/](https://securelist.com/chthonic-a-new-modification-of-zeus/68176/)**\n\nAuthors\n\n[Yury Namestnikov](https://securelist.com/author/yurynamestnikov/)\n\n[Vladimir Kuskov](https://securelist.com/author/vladimirkuskov/)\n\nOleg Kupreev\n\nIn the fall of 2014, we discovered a new banking Trojan, which caught our attention for two\nreasons:\n\nFirst, it is interesting from the technical viewpoint, because it uses a new technique for\nloading modules.\nSecond, an analysis of its configuration files has shown that the malware targets a\nlarge number of online-banking systems: over 150 different banks and 20 payment\nsystems in 15 countries. Banks in the UK, Spain, the US, Russia, Japan and Italy make\nup the majority of its potential targets.\n\nKaspersky Lab products detect the new banking malware as Trojan-Banker.Win32.Chthonic.\n\n\n-----\n\nThe Trojan is apparently an evolution of ZeusVM, although it has undergone a number of\nsignificant changes. Chthonic uses the same encryptor as Andromeda bots, the same\nencryption scheme as Zeus AES and Zeus V2 Trojans, and a virtual machine similar to that\nused in ZeusVM and KINS malware.\n\n## Infection\n\nWe have seen several techniques used to infect victim machines with TrojanBanker.Win32.Chthonic:\n\nsending emails containing exploits;\ndownloading the malware to victim machines using the Andromeda bot\n(Backdoor.Win32.Androm in Kaspersky Lab classification).\n\nWhen sending messages containing an exploit, cybercriminals attached a specially crafted\nRTF document, designed to exploit the [CVE-2014-1761 vulnerability in Microsoft Office](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-1761)\nproducts. The file has a .DOC extension to make it look less suspicious.\n\n_Sample message with CVE-2014-1761 exploit_\n\nIn the event of successful vulnerability exploitation, a downloader for the Trojan was\ndownloaded to the victim computer. In the example above, the file is downloaded from a\ncompromised site – hxxp://valtex-guma.com.ua/docs/tasklost.exe.\n\nThe Andromeda bot downloaded the downloader from\nhxxp://globalblinds.org/BATH/lider.exe.\n\n## Downloading the Trojan\n\n\n-----\n\nOnce downloaded, the downloader injects its code into the msiexec.exe process. It seems\nthat the downloader is based on the Andromeda bot’s source code, although the two use\ndifferent communication protocols.\n\n_Example of common functionality of Andromeda and Chthonic downloaders_\n\n_Differences in communication protocols used by Andromeda and Chthonic C&C_\n\nThe Chthonic downloader contains an encrypted configuration file (similar encryption using a\nvirtual machine was used in KINS and ZeusVM). The main data contained in the\nconfiguration file includes: a list of С&С servers, a 16-byte key for RC4 encryption,\nUserAgent, botnet id.\n\n\n-----\n\n_The main procedure of calling virtual machine functions_\n\nAfter decrypting the configuration file, its individual parts are saved in a heap – in the\nfollowing format:\n\nThis is done without passing pointers. The bot finds the necessary values by examining each\nheap element using the RtlWalkHeap function and matching its initial 4 bytes to the relevant\nMAGIC VALUE.\n\nThe downloader puts together a system data package typical of ZeuS Trojans (local_ip,\nbot_id, botnet_id, os_info, lang_info, bot_uptime and some others) and encrypts it first using\nXorWithNextByte and then using RC4. Next, the package is sent to one of the C&C\naddresses specified in the configuration file.\n\nIn response, the malware receives an extended loader – a module in a format typical of\nZeuS, i.e., not a standard PE file but a set of sections that are mapped to memory by the\nloader itself: executable code, relocation table, point of entry, exported functions, import\ntable.\n\n_Code with section IDs matching the module structures_\n\nIt should be noted that the imports section includes only API function hashes. The import\ntable is set up using the Stolen Bytes method, using a disassembler included in the loader\nfor this purpose. Earlier, we saw a similar import setup in Andromeda.\n\n\n-----\n\n_Fragment of the import setup function in Andromeda and Chthonic_\n\n_Header of a structure with module_\n\nThe extended loader also contains a configuration file encrypted using the virtual machine. It\nloads the Trojan’s main module, which in turn downloads all the other modules. However, the\nextended loader itself uses AES for encryption, and some sections are packed using UCL.\nThe main module loads additional modules and sets up import tables in very much the same\nway as the original Chthonic downloader, i.e. this ZeuS variant has absorbed part of the\nAndromeda functionality.\n\nThe entire sequence in which the malware loads, including the modules that are described\nbelow, is as follows:\n\n\n-----\n\n## Modules\n\nTrojan-Banker.Win32.Chthonic has a modular structure. To date, we have discovered the\nfollowing modules:\n\n**Name** **Description** **Has a 64bit version**\n\n**main** Main module (v4.6.15.0 – v4.7.0.0) Yes\n\n**info** Collects system information Yes\n\n**pony** Module that steals saved passwords No\n\n**klog** Keylogger Yes\n\n**http** Web injection and formgrabber module Yes\n\n**vnc** Remote access Yes\n\n**socks** Proxy server Yes\n\n**cam_recorder** Recording video from the web camera Yes\n\nThe impressive set of functions enables the malware to steal online banking credentials\nusing a variety of techniques. In addition, VNC and cam recorder modules enable attackers\nto connect to the infected computer remotely and use it to carry out transactions, as well as\nrecording video and sound if the computer has a webcam and microphone.\n\n## Injections\n\n\n-----\n\nWeb injections are Chthonic s main weapon: they enable the Trojan to insert its own code\nand images into the code of pages loaded by the browser. This enables the attackers to\nobtain the victim’s phone number, one-time passwords and PINs, in addition to the login and\npassword entered by the victim.\n\nFor example, for one of the Japanese banks the Trojan hides the bank’s warnings and injects\na script that enables the attackers to carry out various transactions using the victim’s\naccount:\n\n_Online banking page screenshots before and after the injection_\n\n_Interesting functions in injected script_\n\nThe script can also display various fake windows in order to obtain the information needed\nby the attackers. Below is an example of a window which displays a warning of non-existent\nidentification problems and prompts the user to enter TAN:\n\n\n-----\n\n_Fake TAN entry window_\n\nOur analysis of attacks against customers of Russian banks has uncovered an unusual web\ninjection scenario. When opening an online banking web page in the browser, the entire\ncontents of the page is spoofed, not just parts of it as in an ordinary attack. From the\ntechnical viewpoint, the Trojan creates an iframe with a phishing copy of the website that has\nthe same size as the original window.\n\nBelow is a fragment of injected code, which replaces everything between title and body\nclosing tags with the following text:\n\nAnd here is the script itself:\n\n\n-----\n\nAdditionally, the bot receives a command to establish a backconnect connection if the\ninjection is successful:\n\n## Coverage\n\nThere are several botnets with different configuration files. Overall, the botnets we are aware\nof target online banking systems of over 150 different banks and 20 payment systems in 15\ncountries. The cybercriminals seem most interested in banks in the UK, Spain, the US,\nRussia, Japan and Italy.\n\n\n-----\n\n_Chtonic target distribution by country_\n\nIt is worth noting that, in spite of the large number of targets on the list, many code fragments\nused by the Trojan to perform web injections can no longer be used, because banks have\nchanged the structure of their pages and, in some cases, the domains as well. It should also\nbe noted that we saw some of these fragments in other bots’ config files (e.g., Zeus V2) a\nfew years back.\n\n## Conclusion\n\nWe can see that the ZeuS Trojan is still actively evolving and its new implementations take\nadvantage of cutting-edge techniques developed by malware writers. This is significantly\nhelped by the ZeuS source code having been leaked. As a result, it has become a kind of\nframework for malware writers, which can be used by anyone and can easily be adapted to\ncybercriminals’ new needs. The new Trojan – Chthonic – is the next stage in the evolution of\nZeuS: it uses Zeus AES encryption, a virtual machine similar to that used by ZeusVM and\nKINS, and the Andromeda downloader.\n\nWhat all of this means is that we will undoubtedly see new variants of ZeuS in the future.\n\n## A few md5:\n\n\n-----\n\n12b6717d2b16e24c5bd3c5f55e59528c\n148563b1ca625bbdbb60673db2edb74a\n6db7ecc5c90c90b6077d5aef59435e02\n5a1b8c82479d003aa37dd7b1dd877493\n2ab73f2d1966cd5820512fbe86986618\n329d62ee33bec5c17c2eb5e701b28639\n615e46c2ff5f81a11e73794efee96b38\n77b42fb633369de146785c83270bb289\n78575db9f70374f4bf2f5a401f70d8ac\n97d010a31ba0ddc0febbd87190dc6078\nb670dceef9bc29b49f7415c31ffb776a\nbafcf2476bea39b338abfb524c451836\nc15d1caccab5462e090555bcbec58bde\nceb9d5c20280579f316141569d2335ca\nd0c017fef12095c45fe01b7773a48d13\nd438a17c15ce6cec4b60d25dbc5421cd\n\n[Financial malware](https://securelist.com/tag/financial-malware/)\n[Trojan Banker](https://securelist.com/tag/trojan-banker/)\n[Vulnerabilities and exploits](https://securelist.com/tag/vulnerabilities-and-exploits/)\n[ZeuS](https://securelist.com/tag/zeus/)\n\nAuthors\n\n[Yury Namestnikov](https://securelist.com/author/yurynamestnikov/)\n\n[Vladimir Kuskov](https://securelist.com/author/vladimirkuskov/)\n\nOleg Kupreev\n\nChthonic: a new modification of ZeuS\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2014/2014-12-18 - Chthonic- a new modification of ZeuS.pdf"
    ],
    "report_names": [
        "2014-12-18 - Chthonic- a new modification of ZeuS.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535984,
    "ts_updated_at": 1743041151,
    "ts_creation_date": 1653756630,
    "ts_modification_date": 1653756630,
    "files": {
        "pdf": "https://archive.orkl.eu/118e5f249a8c0f019905d9bf7ecb99cb0124e946.pdf",
        "text": "https://archive.orkl.eu/118e5f249a8c0f019905d9bf7ecb99cb0124e946.txt",
        "img": "https://archive.orkl.eu/118e5f249a8c0f019905d9bf7ecb99cb0124e946.jpg"
    }
}