{
    "id": "bdbfe2cb-8c7f-4a5e-8c56-690271832cc7",
    "created_at": "2023-01-12T15:06:24.37816Z",
    "updated_at": "2025-03-27T02:14:08.580066Z",
    "deleted_at": null,
    "sha1_hash": "a9c87e12454b9985511011a695b3c86684e70cfb",
    "title": "2022-06-13 - Translating Saitama's DNS tunneling messages",
    "authors": "",
    "file_creation_date": "2022-06-18T23:18:32Z",
    "file_modification_date": "2022-06-18T23:18:32Z",
    "file_size": 200688,
    "plain_text": "# SANS ISC: InfoSec Handlers Diary Blog - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training InfoSec Handlers Diary Blog\n\n**[isc.sans.edu/diary/Translating+Saitama's+DNS+tunneling+messages/28738](https://isc.sans.edu/diary/Translating+Saitama%27s+DNS+tunneling+messages/28738)**\n\n## Translating Saitama's DNS tunneling messages\n\n**Published: 2022-06-13**\n\n**Last Updated: 2022-06-13 15:00:45 UTC**\n\n**by** [Renato Marinho (Version: 1)](https://isc.sans.edu/handler_list.html#renato-marinho)\n\n[0 comment(s)](https://isc.sans.edu/forums/diary/Translating+Saitamas+DNS+tunneling+messages/28738/#comments)\nSaitama is a backdoor that uses the DNS protocol to encapsulate its command and\n**[control (C2) messages - a technique known as DNS Tunneling (MITRE ATT&CK T1071).](https://attack.mitre.org/techniques/T1071/004)**\nSpotted and documented by MalwareBytes in two articles posted last month (How the\nSaitama backdoor uses DNS tunneling and APT34 targets Jordan Government using new\nSaitama backdoor), Saitama was used in a phishing e-mail targeted to a government official\nfrom Jordan’s foreign ministry on an attack attributed to the Iranian group APT34.\n\nSaitama caught my attention for two reasons: the stealth way the C2 messages are hidden in\nDNS protocol and the ease of access to malware implementation details by simply\ndecompiling the .Net binary. Those points may increase the potential for other groups to use\nsimilar DNS tunneling techniques.\n\n**Saitama's DNS tunneling stealth strategy**\n\nCommand and control (C2) over DNS is not new. It is common for a Victim <-> C2\ncommunication occurs in the following way: data can be exfiltrated or answered from the\nvictim to a C2 encoded in the hostname portion of the FQDN (i.e.,\noxn009lc7n5887k96c4zfckes6uif.rootdomain.com). In the other rand, commands or\nadditional payloads can be downloaded from the C2 by the victim by querying TXT records\nto the attacker's controlled DNS server.\n\nSaitama's implementation differs by not using TXT or other records able to store large data\nto encapsulate orders from the C2 to the victim. Instead, the orders are encapsulated in the\nIPV4 addresses themselves. For example, to issue the command 'whoami', the server will\n\n\n-----\n\nanswer two IP addresses: 70.119.104.111 and 97.109.105.49. The first octet (70) has a\nspecial meaning to the Saitama (a command will be issued), and the following octets are the\nASCII code of the 'whoami' characters: w=119, h=104, o=111, and so on until i=105. The\nremaining octet is discarded. Look at the image below the communication between a victim\nand the C2 by issuing the command 'whoami':\n\n### Saitama Translator\n\nAfter analyzing Saitama's code, we developed a simple tool (available at\n[https://github.com/morphuslabs/saitama_translator) capable of translating/decrypting the](https://github.com/morphuslabs/saitama_translator)\nmessages issued by the infected victim to the C2 server (the DNS queries). It may be helpful\nfor those who face Saimanta or variants messages and need to try to discover what data is\nbeing sent to the C2.\n\n**Usage examples:**\n\n1. Passing one FQDN. In this case, the first response from Saitama do C2 after executing\nthe command 'ver' on the infected system:\n```\n$ python translate.py vy5xxxxvzz650coacbsf03f2jkviwui9.joexpediagroup.com\nagent_id: 114, msg_type: 1,  msg_offset:0,  msg_size:43,  \nmsg_content:b'9Microsoft W',  \nrequest:vy5xxxxvzz650coacbsf03f2jkviwui9.joexpediagroup.com,  count:4749\n\n```\n\n-----\n\n2. Passing multiple FQDN at once. In this case, all the responses from Saitama to C2 after\nexecuting 'ver' command:\n```\n$ python translate.py vy5xxxxvzz650coacbsf03f2jkviwui9.joexpediagroup.com\noxn009lc7n5887k96c4zfckes6uif.joexpediagroup.com pqxwwk9cyl1upnxwyqwinn0wgzui5.uberasia.com w7irwrisb5lxwkow81udr.uber-asia.com\nagent_id: 114, msg_type: 1,  msg_offset:0,  msg_size:43,  \nmsg_content:b'9Microsoft W',  \nrequest:vy5xxxxvzz650coacbsf03f2jkviwui9.joexpediagroup.com,  count:4749\nagent_id: 114, msg_type: 1,  msg_offset:12, msg_size:None, msg_content:b'indows\n[Vers',  request:oxn009lc7n5887k96c4zfckes6uif.joexpediagroup.com,    count:4750\nagent_id: 114, msg_type: 1,  msg_offset:24, msg_size:None, msg_content:b'ion\n10.0.183',  request:pqxwwk9cyl1upnxwyqwinn0wgzui5.uber-asia.com,  count:4751\nagent_id: 114, msg_type: 1,  msg_offset:36, msg_size:None, \nmsg_content:b'63.418]', request:w7irwrisb5lxwkow81udr.uber-asia.com,  count:4752\n\n```\nNotice that the string \"Microsoft Windows [Version 10.0.18363.418]\" was sent to the C2\nserver in four requests.\n\n**Saitama sample**\n\ne0872958b8d3824089e5e1cfab03d9d98d22b9bcb294463818d721380075a52d\n\n**References**\n\n[https://attack.mitre.org/techniques/T1071/004](https://attack.mitre.org/techniques/T1071/004)\n\nhttps://blog.malwarebytes.com/threat-intelligence/2022/05/how-the-saitama-backdoor-usesdns-tunnelling/\n\nhttps://blog.malwarebytes.com/threat-intelligence/2022/05/apt34-targets-jordan-governmentusing-new-saitama-backdoor/\n\nKeywords:\n\n[0 comment(s)](https://isc.sans.edu/forums/diary/Translating+Saitamas+DNS+tunneling+messages/28738/)\n\nJoin us at SANS! Attend [with Renato Marinho in starting](https://isc.sans.edu/diary/Translating+Saitama%27s+DNS+tunneling+messages/28738)\n\nTop of page\n×\n\n[Diary Archives](https://isc.sans.edu/diaryarchive.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-06-13 - Translating Saitama's DNS tunneling messages.pdf"
    ],
    "report_names": [
        "2022-06-13 - Translating Saitama's DNS tunneling messages.pdf"
    ],
    "threat_actors": [
        {
            "id": "ce10c1bd-4467-45f9-af83-28fc88e35ca4",
            "created_at": "2022-10-25T15:50:23.458833Z",
            "updated_at": "2025-03-27T02:00:55.475188Z",
            "deleted_at": null,
            "main_name": "APT34",
            "aliases": null,
            "source_name": "MITRE:APT34",
            "tools": [
                "netstat",
                "Systeminfo",
                "PsExec",
                "SEASHARPEE",
                "Tasklist",
                "Mimikatz",
                "POWRUNER",
                "certutil"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3eebdb3f-f4e3-42e5-bb4d-f02a13328316",
            "created_at": "2024-05-01T02:03:08.014303Z",
            "updated_at": "2025-03-27T02:05:17.306592Z",
            "deleted_at": null,
            "main_name": "COBALT EDGEWATER",
            "aliases": [
                "Cold River ",
                "DNSpionage ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT EDGEWATER",
            "tools": [
                " DNSpionage",
                " Karkoff",
                " MailDropper",
                " SideTwist",
                " TWOTONE",
                "AgentDrable"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8f9c8a6e-f6b6-431b-bedd-94fdeea5474a",
            "created_at": "2024-05-01T02:03:08.022974Z",
            "updated_at": "2025-03-27T02:05:17.310877Z",
            "deleted_at": null,
            "main_name": "COBALT GYPSY",
            "aliases": [
                "CHRYSENE ",
                "Crambus ",
                "EUROPIUM ",
                "Hazel Sandstorm ",
                "Helix Kitten ",
                "ITG13 ",
                "OilRig ",
                "Yellow Maero ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT GYPSY",
            "tools": [
                " Helminth",
                " Jason",
                " MacDownloader",
                " PoisonFrog",
                " RGDoor",
                " ThreeDollars",
                " TinyZbot",
                " Toxocara",
                " Trichuris",
                " TwoFace",
                "Glimpse"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535984,
    "ts_updated_at": 1743041648,
    "ts_creation_date": 1655594312,
    "ts_modification_date": 1655594312,
    "files": {
        "pdf": "https://archive.orkl.eu/a9c87e12454b9985511011a695b3c86684e70cfb.pdf",
        "text": "https://archive.orkl.eu/a9c87e12454b9985511011a695b3c86684e70cfb.txt",
        "img": "https://archive.orkl.eu/a9c87e12454b9985511011a695b3c86684e70cfb.jpg"
    }
}