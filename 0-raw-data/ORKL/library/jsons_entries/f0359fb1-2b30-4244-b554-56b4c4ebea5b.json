{
    "id": "f0359fb1-2b30-4244-b554-56b4c4ebea5b",
    "created_at": "2023-01-12T15:06:04.246383Z",
    "updated_at": "2025-03-27T02:09:18.460318Z",
    "deleted_at": null,
    "sha1_hash": "24c7e10ed7de26cd58ab0b69292b7b0a1dfa8dde",
    "title": "2021-05-02 - Trickbot Brief- Creds and Beacons",
    "authors": "",
    "file_creation_date": "2022-05-28T18:03:43Z",
    "file_modification_date": "2022-05-28T18:03:43Z",
    "file_size": 781226,
    "plain_text": "# Trickbot Brief: Creds and Beacons\n\n**[thedfirreport.com/2021/05/02/trickbot-brief-creds-and-beacons/](https://thedfirreport.com/2021/05/02/trickbot-brief-creds-and-beacons/)**\n\n\nMay 2, 2021\n\n\n-----\n\n### Intro\n\n#### “TrickBot malware—first identified in 2016—is a Trojan developed and operated by a sophisticated group of cybercrime actors. The cybercrime group initially designed TrickBot as a banking trojan to steal financial data. Through continued development and new functionality, TrickBot has become a highly modular, multi-stage malware that provides its operators a full suite of tools to conduct a myriad of illegal cyber activities. Since TrickBot’s inception, the cybercrime group has used the malware to attack individuals and businesses globally across a wide range of sectors.”\n\n Source – Fact Sheet: TrickBot Malware Source\n\n In an intrusion this past month, threat actors were seen enumerating and collecting information related to the domain as well as dumping passwords before leaving the network. Multiple Cobalt Strike Beacons were deployed and remained connected despite the lack of activity from the threat actors.\n\n### Case Summary\n\n#### We assess, with moderate confidence, the Trickbot DLL that we executed was originally delivered via a malicious Office document. The threat actors were observed leveraging Trickbot and Cobalt Strike for C2 communication. They began their discovery by running net and nltest commands as well as PowerView domain discovery modules. Minutes later, Lazagne (“retrieve lots of passwords”) was executed using the “all” switch. A registry value was set to enable storing logon credentials in plaintext in memory (WDigest), likely to facilitate future activity as the host was not restarted for this change to take effect.\n\n Before the threat actors departed the network, they successfully accessed the LSASS process and retrieved credentials from memory. No lateral movement or execution on mission was observed.\n\n### Timeline\n\n\n-----\n\n#### Analysis and reporting completed by @kostastsale, @ICSNick, and @RoxpinTeddy.\n\n Reviewed by @TheDFIRReport\n\n### MITRE ATT&CK\n\n\n-----\n\n### Initial Access\n\n#### We assess with moderate confidence that this DLL was dropped by a malicious Office document.\n\n### Execution\n\n#### Trickbot (click.php.dll) was manually executed on a single endpoint.\n\n Source: https://tria.ge/210412-wmdnkzp5la\n\n Trickbot, from its injected wermgr process, spawned a command process to then run a PowerShell Cobalt Strike Beacon.\n\n Reviewing the above PowerShell code, we can extract the shellcode to discover the IP and User-agent string, the beacon will communicate with.\n\n\n-----\n\n#### Getting the IP and port using scdbg.\n\n The threat actor also executed a second Cobalt Strike Beacon (wsuC3C.tmp) using the injected wermgr.exe process.\n```\nrundll32.exe C:\\Users\\redacted\\AppData\\Local\\Temp\\wsuC3C.tmp,ControlUnitSpeed\n\n### Persistence\n\n#### A scheduled task was created to keep the Trickbot malware persistent on the system.\n\n```\n\n-----\n\n```\nC:\\Windows\\system32\\rundll32.exe\"\n\"C:\\Users\\redacted\\AppData\\Roaming\\DownloadMngNet5353711913\\xxclickdr.dwn\",#1\n\n### Defense Evasion\n\n#### Trickbot injected into wermgr.exe processes and used this for communication to command and control infrastructure.\n\n```\n\n-----\n\n### Credential Access\n\n#### Lazagne was used with the “all” switch, which runs all modules.\n\n Below we can see registry hives being saved to disk.\n\n LSASS was accessed by rundll32, but we did not see anything written to disk.\n\n Trickbot was used to enable the storage of clear text credentials (WDigest) by setting UseLogonCredential to 1.\n\n\n-----\n\n```\nKey - SYSTEM\\ControlSet001\\Control\\SecurityProviders\\WDigest\nValue name - UseLogonCredential\nSet value data - 1\n\n### Discovery\n\n#### The following net commands were used by the threat actor from the injected Trickbot process.\nnet config workstation\nnet view /all \nnet view /all /domain\nnet group “Domain Computers” /domain \n\n The following nltest commands were used by the threat actor from the injected Trickbot process.\nnltest /domain_trusts\nnltest /domain_trusts /all_trusts\n\n PowerView modules were also used by the threat actor executed from the Cobalt Strike beacons.\nGet-DomainSearcher\nGet-NetComputer\nGet-NetDomain\n\n The local network was scanned for port 445/SMB.\n\n```\n\n-----\n\n#### ipconfig was used to show all IP info.\n```\nipconfig /all\n\n### Command and Control\n\n#### Trickbot\ngtag: rob52\n\n Cobalt Strike C2 #1\n\n```\n\n-----\n\n#### 147.135.78[.]200:80 (Our Threat Feed service has known about this Cobalt Strike server since at least 4-4-2021)\n\n CS Config:\n```\n\"x64\": {\n\"md5\": \"d963ff232b5b519014cbca17e7e9d512\",\n\"sha256\": \"0f0cf5e9b35012fc51306179ba4c8cfdaa4f60bf293d8140a77a74db548182e5\",\n\"sha1\": \"77430b1da03bf6fee12d12abd810666a7751e3c0\",\n\"config\": {\n\"HTTP Method Path 2\": \"/submit.php\",\n\"Method 2\": \"POST\",\n\"C2 Server\": \"147.135.78.200,/cx\",\n\"Method 1\": \"GET\",\n\"Polling\": 60000,\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\",\n\"Beacon Type\": \"0 (HTTP)\",\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\",\n\"Jitter\": 0,\n\"Port\": 80\n\"x86\": {\n\"md5\": \"ec2fc2b33d60ddc829c9aeabb6ce0bbe\",\n\"sha256\": \"93008b078e8358c948877c7fde261231fc72bcd45143132070761550046701f2\",\n\"sha1\": \"91ea27632c363b821d8f84b8320b1d76f1d91899\",\n\"config\": {\n\"HTTP Method Path 2\": \"/submit.php\",\n\"Method 2\": \"POST\",\n\"C2 Server\": \"147.135.78.200,/push\",\n\"Method 1\": \"GET\",\n\"Polling\": 60000,\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\rundll32.exe\",\n\"Beacon Type\": \"0 (HTTP)\",\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\rundll32.exe\",\n\"Jitter\": 0,\n\"Port\": 80\n\n Cobalt Strike C2 #2\n\n 23.108.57[.]39:443 (Our Threat Feed service has known about this Cobalt Strike server since at least 4-12-2021)\n wideri[.]com\nJA3s:ae4edc6faf64d08308082ad26be60767\nJA3:a0e9f5d64349fb13191bc781f81f42e1\nCertificate:[10:cd:12:74:dc:9d:3d:15:b5:e9:f1:f1:22:e1:ff:65:77:a3:c9:93]\nNot Before: 2021/04/04 00:00:00 \nNot After: 2022/04/04 23:59:59 \nIssuer Org: Sectigo Limited \nSubject Common: wideri.com \nPublic Algorithm:rsaEncryption\nJARM:07d14d16d21d21d07c42d41d00041d58c7162162b6a603d3d90a2b76865b53\n\n```\n\n-----\n\n#### CS Config:\n```\n\"x64\": {\n\"time\": 1618262029857.8,\n\"config\": {\n\"Jitter\": 46,\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\wusa.exe\",\n\"Beacon Type\": \"8 (HTTPS)\",\n\"Method 1\": \"GET\",\n\"Method 2\": \"POST\",\n\"C2 Server\": \"wideri.com,/tab_shop.css\",\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\wusa.exe\",\n\"Port\": 443,\n\"Polling\": 5000,\n\"HTTP Method Path 2\": \"/language\"\n},\n\"md5\": \"249f38615a76d47892fc530102a8a178\",\n\"sha256\": \"91d6230999853424f158fd58bd343c781fd687c71173ee39ed98429181d3cdb4\",\n\"sha1\": \"9b1f5d93af2344529b37055af8e3db0d3867c5bc\"\n\"x86\": {\n\"time\": 1618262025634.5,\n\"config\": {\n\"Jitter\": 46,\n\"Spawn To x86\": \"%windir%\\\\syswow64\\\\wusa.exe\",\n\"Beacon Type\": \"8 (HTTPS)\",\n\"Method 1\": \"GET\",\n\"Method 2\": \"POST\",\n\"C2 Server\": \"wideri.com,/language.css\",\n\"Spawn To x64\": \"%windir%\\\\sysnative\\\\wusa.exe\",\n\"Port\": 443,\n\"Polling\": 5000,\n\"HTTP Method Path 2\": \"/sq\"\n},\n\"md5\": \"46a3380418ce59563c3adfa8f6624d3f\",\n\"sha256\": \"8cf43734e0d187aaad93e950646a883820b20ca2837480c1140e1751cf6557b2\",\n\"sha1\": \"44e19c7f2534226e6774591713fbd659931d2e10\"\n\n### Impact\n\n#### Aside from the initial compromise on the beachhead host and the stolen credentials, no further impact was observed during this intrusion. No lateral movement or execution on mission was observed.\n\n### IOCs\n\n Network\n\n#### Cobalt Strike: \n\n```\n\n-----\n\n```\n147.135.78.200|80 \n23.108.57.39|443\nwideri[.]com\nhttp://172.82.179.170/w.dll\n\n#### Trickbot:\n102.68.17.97|443 \n103.76.150.14|443 \n103.9.188.23|449 \n109.185.139.90|449 \n138.185.72.142|443 \n148.216.32.55|443 \n173.81.4.147|443 \n182.253.184.130|449 \n185.205.250.162|443 \n190.122.168.219|443 \n196.41.57.46|449 \n200.90.11.177|449 \n202.166.211.197|443 \n31.134.124.90|443 \n31.211.85.110|443 \n41.77.134.250|443 \n5.59.205.32|443 \n62.213.14.166|443 \n77.95.93.132|449 \n78.138.187.231|443 \n81.95.45.234|449 \n84.21.206.164|449 \n85.112.74.178|449 \n87.116.151.237|449 \n87.76.1.81|449 \n89.250.208.42|449 \n91.185.236.170|449 \n91.225.231.120|443 \n96.9.77.142|443\n\n### File\n\n```\n\n-----\n\n```\nclick.php.dll\n8c0d352934271350cfe6c00b7587e8dc8d062817\n0ae86e5abbc09e96f8c1155556ca6598c22aebd73acbba8d59f2ce702d3115f8\nxxclickdr.dwn\n8c0d352934271350cfe6c00b7587e8dc8d062817\n0ae86e5abbc09e96f8c1155556ca6598c22aebd73acbba8d59f2ce702d3115f8\nwsuC3C.tmp\nb7d9f3e387021bba138dbe3d153fef4e7e2196ad\n97dedd5ca85a13ab1a8910416b13ffd088b1c7e3486d6629a71f5c118d56fbea\n lazagne.exe \n75f4115024b5d0818f0696345eef98d92db92118\n61deb3a206cc203252418b431f6556e3f7efd9556fc685eeda7281d9baf89851\n\n## Detections\n\n### Network\nET CNC Feodo Tracker Reported CnC Server group 11\nET MALWARE Trickbot Checkin Response\nET INFO SUSPICIOUS Dotted Quad Host MZ Response\n\n Sigma\n\n#### https://github.com/SigmaHQ/sigma/blob/084cd39505861188d9d8f2d5c0f2835e4f750a3f/rule s/windows/process_creation/win_malware_trickbot_recon_activity.yml\n\n https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rul es/windows/process_creation/win_grabbing_sensitive_hives_via_reg.yml\n\n https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_susp_p owershell_enc_cmd.yml\n\n### Yara\n\n```\n\n-----\n\n```\n/\nYARA Rule Set\nAuthor: The DFIR Report\nDate: 2021-04-27\nIdentifier: Case 3521 Trickbot\nReference: https://thedfirreport.com\n*/\n/* Rule Set ----------------------------------------------------------------- */\nimport \"pe\"\nrule click_php {\nmeta:\ndescription = \"files - file click.php.dll\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-04-27\"\nhash1 = \"0ae86e5abbc09e96f8c1155556ca6598c22aebd73acbba8d59f2ce702d3115f8\"\nstrings:\n$s1 = \"f_+ (Q\" fullword wide\n$s2 = \"'/l~;2m\" fullword wide\n$s3 = \"y'L])[\" fullword wide\n$s4 = \"1!1I1m1s1\" fullword ascii\n$s5 = \"&+B\\\"wm\" fullword wide\n$s6 = \">jWR=C\" fullword wide\n$s7 = \"W!\\\\R.S\" fullword wide\n$s8 = \"r-`4?b6\" fullword wide\n$s9 = \"]Iip!x\" fullword wide\n$s10 = \"!k{l`<\" fullword wide\n$s11 = \"D~C:RA\" fullword wide\n$s12 = \"]{T~as\" fullword wide\n$s13 = \"7%8+8^8\" fullword ascii\n$s14 = \"f]-hKa\" fullword wide\n$s15 = \"StartW\" fullword ascii /* Goodware String - occured 5 times */\ncondition:\nuint16(0) == 0x5a4d and filesize < 1000KB and\n( pe.imphash() == \"8948fb754b7c37bc4119606e044f204c\" and pe.exports(\"StartW\") or 10\nof them )\n}\n\n## MITRE\n\n#### User Execution – T1204\n Command and Scripting Interpreter – T1059\n PowerShell – T1059.001\n Windows Command Shell – T1059.003\n Domain Trust Discovery – T1482\n Network Service Scanning – T1046\n Remote System Discovery – T1018\n System Network Configuration Discovery – T1016\n System Information Discovery – T1082\n\n```\n\n-----\n\n#### Process Injection – T1055 Credentials from Web Browsers – T1555.003 OS Credential Dumping – T1003 LSASS Memory – T1003.001 Exfiltration Over C2 Channel – T1041 Non-Standard Port – T1571\n\n Internal case #3521\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-02 - Trickbot Brief- Creds and Beacons.pdf"
    ],
    "report_names": [
        "2021-05-02 - Trickbot Brief- Creds and Beacons.pdf"
    ],
    "threat_actors": [
        {
            "id": "77b28afd-8187-4917-a453-1d5a279cb5e4",
            "created_at": "2022-10-25T15:50:23.768278Z",
            "updated_at": "2025-03-27T02:00:55.5423Z",
            "deleted_at": null,
            "main_name": "Inception",
            "aliases": [
                "Inception Framework",
                "Cloud Atlas"
            ],
            "source_name": "MITRE:Inception",
            "tools": [
                "PowerShower",
                "VBShower",
                "LaZagne"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a97cf06d-c2e2-4771-99a2-c9dee0d6a0ac",
            "created_at": "2022-10-25T16:07:24.349252Z",
            "updated_at": "2025-03-27T02:02:10.184406Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "ATK 13",
                "Belugasturgeon",
                "Blue Python",
                "CTG-8875",
                "Group 88",
                "ITG12",
                "Iron Hunter",
                "Krypton",
                "Makersmark",
                "Operation Epic Turla",
                "Operation Moonlight Maze",
                "Operation Penguin Turla",
                "Operation Satellite Turla",
                "Operation Skipper Turla",
                "Operation Turla Mosquito",
                "Operation WITCHCOVEN",
                "Pacifier APT",
                "Pensive Ursa",
                "Popeye",
                "SIG15",
                "SIG2",
                "SIG23",
                "Secret Blizzard",
                "TAG-0530",
                "Turla",
                "UNC4210",
                "Venomous Bear",
                "Waterbug"
            ],
            "source_name": "ETDA:Turla",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "ATI-Agent",
                "AdobeARM",
                "Agent.BTZ",
                "Agent.DNE",
                "BigBoss",
                "COMpfun",
                "Chinch",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobra Carbon System",
                "ComRAT",
                "DoublePulsar",
                "EmPyre",
                "EmpireProject",
                "Epic Turla",
                "EternalBlue",
                "EternalRomance",
                "GoldenSky",
                "Group Policy Results Tool",
                "HTML5 Encoding",
                "HyperStack",
                "IcedCoffee",
                "IronNetInjector",
                "KSL0T",
                "Kapushka",
                "Kazuar",
                "KopiLuwak",
                "Kotel",
                "LOLBAS",
                "LOLBins",
                "LightNeuron",
                "Living off the Land",
                "Maintools.js",
                "Metasploit",
                "Meterpreter",
                "MiamiBeach",
                "Mimikatz",
                "MiniDionis",
                "Minit",
                "NBTscan",
                "NETTRANS",
                "NETVulture",
                "Neptun",
                "NetFlash",
                "NewPass",
                "Outlook Backdoor",
                "Penquin Turla",
                "Pfinet",
                "PowerShell Empire",
                "PowerShellRunner",
                "PowerShellRunner-based RPC backdoor",
                "PowerStallion",
                "PsExec",
                "PyFlash",
                "QUIETCANARY",
                "Reductor RAT",
                "RocketMan",
                "SMBTouch",
                "SScan",
                "Satellite Turla",
                "SilentMoon",
                "Sun rootkit",
                "TTNG",
                "TadjMakhal",
                "Tavdig",
                "TinyTurla",
                "TinyTurla Next Generation",
                "TinyTurla-NG",
                "Topinambour",
                "Tunnus",
                "Turla",
                "Turla SilentMoon",
                "TurlaChopper",
                "Uroburos",
                "Urouros",
                "WCE",
                "WITCHCOVEN",
                "WhiteAtlas",
                "WhiteBear",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Wipbot",
                "WorldCupSec",
                "XTRANS",
                "certutil",
                "certutil.exe",
                "gpresult",
                "nbtscan",
                "nbtstat",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a97fee0d-af4b-4661-ae17-858925438fc4",
            "created_at": "2023-01-06T13:46:38.396415Z",
            "updated_at": "2025-03-27T02:00:02.823045Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Uroburos",
                "Hippo Team",
                "Pacifier APT",
                "MAKERSMARK",
                "ATK13",
                "UAC-0003",
                "IRON HUNTER",
                "Waterbug",
                "TAG_0530",
                "KRYPTON",
                "Popeye",
                "SIG23",
                "UAC-0144",
                "G0010",
                "Blue Python",
                "VENOMOUS Bear",
                "Group 88",
                "Pfinet",
                "ITG12",
                "UNC4210",
                "Secret Blizzard",
                "UAC-0024"
            ],
            "source_name": "MISPGALAXY:Turla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535964,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653761023,
    "ts_modification_date": 1653761023,
    "files": {
        "pdf": "https://archive.orkl.eu/24c7e10ed7de26cd58ab0b69292b7b0a1dfa8dde.pdf",
        "text": "https://archive.orkl.eu/24c7e10ed7de26cd58ab0b69292b7b0a1dfa8dde.txt",
        "img": "https://archive.orkl.eu/24c7e10ed7de26cd58ab0b69292b7b0a1dfa8dde.jpg"
    }
}