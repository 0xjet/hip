{
    "id": "744a36f0-a18d-4628-bdc6-929cbb92a361",
    "created_at": "2023-01-12T15:07:58.212619Z",
    "updated_at": "2025-03-27T02:09:18.458182Z",
    "deleted_at": null,
    "sha1_hash": "045ae6e19713557e908698941ee45b44c0f1fd4b",
    "title": "2021-01-18 - Raindrop- New Malware Discovered in SolarWinds Investigation",
    "authors": "",
    "file_creation_date": "2022-05-28T23:07:42Z",
    "file_modification_date": "2022-05-28T23:07:42Z",
    "file_size": 1007560,
    "plain_text": "# Raindrop: New Malware Discovered in SolarWinds Investigation\n\n**[symantec-enterprise-blogs.security.com/blogs/threat-intelligence/solarwinds-raindrop-malware](https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/solarwinds-raindrop-malware)**\n\nThreat Hunter TeamSymantec\n\n## Tool was used to spread onto other computers in victims’ networks.\n\nSymantec, a division of Broadcom (NASDAQ: AVGO), has uncovered an additional piece of malware used in the\nSolarWinds attacks which was used against a select number of victims that were of interest to the attackers.\n\n\n-----\n\nRaindrop (Backdoor.Raindrop) is a loader which delivers a payload of Cobalt Strike. Raindrop is very similar to the\nalready documented Teardrop tool, but there are some key differences between the two. While Teardrop was delivered\nby the initial Sunburst backdoor (Backdoor.Sunburst), Raindrop appears to have been used for spreading across the\nvictim’s network. Symantec has seen no evidence to date of Raindrop being delivered directly by Sunburst. Instead, it\nappears elsewhere on networks where at least one computer has already been compromised by Sunburst.\n\n## Raindrop attacks\n\nIn one victim, in early July 2020, Sunburst was installed through the SolarWinds Orion update, as has been well\ndocumented. Two computers were compromised.\n\nThe following day, Teardrop was subsequently installed on one of these computers. That computer was found to have\nan active directory query tool, as well as a credential dumper designed specifically for SolarWinds Orion databases.\n[The credential dumper was similar to, but not the same as, the open source Solarflare tool.](https://github.com/mubix/solarflare)\n\nEleven days later, on a third victim computer in the organization, where no previous malicious activity had been\nobserved, a copy of the previously unseen Raindrop was installed under the name bproxy.dll. This computer was\nrunning computer access and management software. The attackers could have used this software to access any of the\ncomputers in the compromised organization.\n\nOne hour later, the Raindrop malware installed an additional file called \"7z.dll\". We were unable to retrieve this file,\nhowever, within hours a legitimate version of 7zip was used to extract a copy of what appeared to be Directory Services\nInternals (DSInternals) onto the computer. DSInternals is a legitimate tool which can be used for querying Active\nDirectory servers and retrieving data, typically passwords, keys, or password hashes.\n\nAn additional tool called mc_store.exe was later installed by the attackers on this computer. The tool is an unknown\nPyInstaller packaged application. No further activity was observed on this computer.\n\nFigure 1.\n\nExample of Raindrop victim timeline\nIn a second victim where the Raindrop loader was seen, it was installed in a file called astdrvx64.dll in late May. Several\ndays later, in early June, PowerShell commands were executed on that computer, attempting to execute further\ninstances of Raindrop on additional computers in the organization.\n\n\"Invoke-Command -ComputerName REDACTED -ScriptBlock { rundll32\nc:\\Packages\\Plugins\\Microsoft.Powershell.DSC\\2.77.0.0\\bin\\TelemetryStatus.dll Tk_CreateItemType}\"\n\n\"Invoke-WMIMethod win32_process -name create -argumentlist 'rundll32\nc:\\windows\\Speech_OneCore\\Engines\\TTS\\en-US\\enUS.Media.dll TkChangeEventWindow' -ComputerName\nREDACTED\"\n\nIn a third victim, where Raindrop was seen, the instance of Cobalt Strike that was extracted did not have a HTTP-based\ncommand and control server, but was rather configured to use a network pipe over SMB\n(\\\\.\\pipe\\protected_storage[REDACTED]). It's possible that in this instance, the victim computer did not have direct\naccess to the internet, and so command and control was routed through another computer on the local network.\n\n## Raindrop technical analysis\n\n\n-----\n\nRaindrop is similar to Teardrop in that both pieces of malware act as a loader for Cobalt Strike Beacon. Raindrop uses a\ncustom packer to pack Cobalt Strike. This packer is different to the one used by Teardrop.\n\nRaindrop is compiled as a DLL, which is built from a modified version of 7-Zip source code. The 7-Zip code is not\nutilized and is designed to hide malicious functionality added by the attackers. The DLL is compiled where the Name file\nof the Export Directory Table is “\"7-zip.dll\" and the Export Names are:\n\nDllCanUnloadNow\nDllGetClassObject\nDllRegisterServer\nDllUnregisterServer\n\nAnd one of the following, selected at random:\n\nTk_DistanceToTextLayout\nTk_GetScrollInfoObj\nTk_MainLoop\nXGetGeometry\n\n[The Export Names used seem to overlap with names used by Tcl/Tk projects (see here and](https://github.com/tcltk/tk/blob/main/generic/tk.decls) [here).](https://github.com/tcltk/tk/blob/main/generic/tkInt.decls)\n\n## Custom packer\n\nWhenever the DLL is loaded, it starts a new thread from the DllMain subroutine that executes the malicious code. This\nmalicious thread performs the following actions:\n\nExecutes some computation to delay execution. This does not affect functionality.\nLocates start of the encoded payload which is embedded within legitimate 7-Zip machine code.\n\nIn order to locate the start of the encoded payload, the packer uses steganography by scanning the bytes starting from\nthe beginning of the subroutine and skipping any bytes until the first occurrence of the following bytes that represent\noperation codes (opcodes) of interest:\n\n.data:0000000180053008 opcodes     db 5, 0Dh, 15h, 1Dh, 25h, 2Dh, 35h, 3Dh, 0B8h\n\nThe malware will then perform the following actions:\n\nExtract the encoded payload. This involves simply copying data from pre-determined locations that happen to\ncorrespond to immediate values of the relevant machine instructions.\nDecrypt the extracted payload. This uses the AES algorithm in CBC mode.\nDecompress the decrypted payload. This uses the LZMA algorithm.\nDecrypt the decompressed payload. This is simple XOR with byte key and as such does not impact compression\nratio.\nExecute the decrypted payload as shellcode.\n\n## Raindrop and Teardrop comparison\n\nAlthough Raindrop is very similar to Teardrop, there are some key differences between the tools. As mentioned\npreviously, Raindrop uses a different packer. The packers differ in the following ways:\n\n**TEARDROP** **RAINDROP**\n\n\nPAYLOAD\nFORMAT\n\n\nCustom, reusing features from PE format. It may be\npossible to reuse the packer with a range of different\npayloads supplied as PE DLLs with automatic conversion.\n\n\nShellcode only.\n\n\n-----\n\nPAYLOAD\nEMBEDDING\n\nPAYLOAD\nENCRYPTION\n\nPAYLOAD\nCOMPRESSION\n\n\n**TEARDROP** **RAINDROP**\n\nBinary blob in data section. Steganography, stored at predetermined locations within the\nmachine code.\n\nvisualDecrypt combined with XOR using long key. AES layer before decompression;\nseparate XOR layer using one\nbyte key after decompression.\n\nNone. LZMA.\n\n\nOBFUSCATION Reading JPEG file. Inserted blocks of junk code, some\ncould be generated using a polymorphic engine.\n\n\nEXPORT\nNAMES\n\n\nExport names vary, in some cases names overlapping with\nTcl/Tk projects.\n\n\nNon-functional code to delay\nexecution.\n\nExport names overlap with Tcl/Tk\nprojects.\n\nRecompiled third-party source\ncode.\n\n\nSTOLEN CODE Byte-copy of machine code from pre-existing third-party\ncomponents. The original code is distributed in compiled\nformat only.\n\n\nWhile both malware families are designed to deploy Cobalt Strike Beacon, there are differences in Cobalt Strike\nconfiguration. To date, Symantec has seen four samples of Raindrop. In three cases, Cobalt Strike was configured to\nuse HTTPS as a communication protocol. In the fourth it was configured to use SMB Named Pipe as a communication\nprotocol.\n\nAll three Raindrop samples using HTTPS communication follow very similar configuration patterns as previously seen in\none Teardrop sample (b820e8a2057112d0ed73bd7995201dbed79a79e13c79d4bdad81a22f12387e07).\n\nThe most important similarities are highlighted below.\n\nTEARDROP\n\nSHA256 b820e8a2057112d0ed73bd7995201dbed79a79e13c79d4bdad81a22f12387e07\n\nURLs https(://)infinitysoftwares(.)com/files/information_055.pdf\n\nhttps(://)infinitysoftwares(.)com/wp-admin/new_file.php\n\nPOST FORM name=\"uploaded_1\";filename=\"33139.pdf\" Content-Type: text/plain\n\nRAINDROP\n\nSHA256 be9dbbec6937dfe0a652c0603d4972ba354e83c06b8397d6555fd1847da36725\n\nURLs https(://)bigtopweb(.)com/files/page_306.pdf\n\nhttps(://)bigtopweb(.)com/wp-admin/admin-ajax.php\n\nPOST FORM name=\"uploaded_1\";filename=\"84921.pdf\" Content-Type: text/plain\n\nRAINDROP\n\nSHA256 f2d38a29f6727f4ade62d88d8a68de0d52a0695930b8c92437a2f9e4de92e418\n\nURLs https(://)panhardware(.)com/files/documentation_076.pdf\n\nhttps(://)panhardware(.)com/wp-admin/new_file.php\n\nPOST FORM name=\"uploaded 1\";filename=\"18824.pdf\" Content-Type: text/plain\n\n\n-----\n\nAll of the aforementioned domains use a common Registrar, NameSilo, LLC and, except for panhardware[.]com, which\nis currently sinkholed, have common name servers:\n\nns1.dnsowl.com\nns2.dnsowl.com\nns3.dnsowl.com\n\n## Clearer picture\n\nThe discovery of Raindrop is a significant step in our investigation of the SolarWinds attacks as it provides further\ninsights into post-compromise activity at organizations of interest to the attackers. While Teardrop was used on\ncomputers that had been infected by the original Sunburst Trojan, Raindrop appeared elsewhere on the network, being\nused by the attackers to move laterally and deploy payloads on other computers.\n\n## Protection/Mitigation\n\nTools associated with these attacks will be detected and blocked on machines running Symantec Endpoint products.\n\n**File-based protection:**\n\nBackdoor.Raindrop\nBackdoor.Teardrop\nBackdoor.Sunburst\nBackdoor.Sunburst!gen1\nBackdoor.SuperNova\n\n**Network-based protection:**\n\nSystem Infected: Sunburst Malware Activity\n\n[For the latest protection updates, please visit the Symantec Protection Bulletin.](https://www.broadcom.com/support/security-center/protection-bulletin)\n\n## Yara Rules\n\n[The Yara rules are also available for download on GitHub.](https://github.com/Symantec/threathunters/blob/main/Hagensia/raindrop.yara)\n\n## Indicators of Compromise\n\n**SHA256** **DESCRIPTION**\n\nf2d38a29f6727f4ade62d88d8a68de0d52a0695930b8c92437a2f9e4de92e418 astdrvx64.dll & sddc.dll (Raindrop)\n\nbe9dbbec6937dfe0a652c0603d4972ba354e83c06b8397d6555fd1847da36725 bproxy.dll (Raindrop)\n\n955609cf0b4ea38b409d523a0f675d8404fee55c458ad079b4031e02433fdbf3 cbs.dll (Raindrop)\n\nN/A Telemetry.Settings.dll (Likely Raindrop)\n\nN/A enUS.Media.dll (Likely Raindrop)\n\nN/A TelemetryStatus.dll (Likely Raindrop)\n\n240ef5b8392b8c7a5a025c36a7e5b0e03e5bb0d0d1a28703bb22e6159a4fd10e mc_store.exe (Unknown)\n\nf2d38a29f6727f4ade62d88d8a68de0d52a0695930b8c92437a2f9e4de92e418 panhardware[.]com\n\n955609cf0b4ea38b409d523a0f675d8404fee55c458ad079b4031e02433fdbf3 \\\\.\\pipe\\protected_storage[REDACTED]\n\nbe9dbbec6937dfe0a652c0603d4972ba354e83c06b8397d6555fd1847da36725 bigtopweb[.]com\n\n\n-----\n\n## About the Author\n\n### Threat Hunter Team\n\n**Symantec**\n\nThe Threat Hunter Team is a group of security experts within Symantec whose mission is to investigate targeted\nattacks, drive enhanced protection in Symantec products, and offer analysis that helps customers respond to attacks.\n\n## Want to comment on this post?\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-18 - Raindrop- New Malware Discovered in SolarWinds Investigation.pdf"
    ],
    "report_names": [
        "2021-01-18 - Raindrop- New Malware Discovered in SolarWinds Investigation.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536078,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653779262,
    "ts_modification_date": 1653779262,
    "files": {
        "pdf": "https://archive.orkl.eu/045ae6e19713557e908698941ee45b44c0f1fd4b.pdf",
        "text": "https://archive.orkl.eu/045ae6e19713557e908698941ee45b44c0f1fd4b.txt",
        "img": "https://archive.orkl.eu/045ae6e19713557e908698941ee45b44c0f1fd4b.jpg"
    }
}