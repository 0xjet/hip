{
    "id": "4c49b69e-211a-46c2-ad5b-efd489729124",
    "created_at": "2023-01-12T15:08:55.970536Z",
    "updated_at": "2025-03-27T02:06:12.092539Z",
    "deleted_at": null,
    "sha1_hash": "9f6d6cf8bd935ffca7871f61c477a1ddacc76e1c",
    "title": "2017-06-26 - How Spora ransomware tries to fool antivirus",
    "authors": "",
    "file_creation_date": "2022-05-27T21:55:27Z",
    "file_modification_date": "2022-05-27T21:55:27Z",
    "file_size": 517607,
    "plain_text": "# How Spora ransomware tries to fool antivirus\n\n**[nakedsecurity.sophos.com/2017/06/26/how-spora-ransomware-tries-to-fool-antivirus/](https://nakedsecurity.sophos.com/2017/06/26/how-spora-ransomware-tries-to-fool-antivirus/)**\n\nBy Bill Brenner 26 Jun 2017\n\n[Spora ransomware first](https://www.sophos.com/en-us/products/intercept-x.aspx) [detected in January is back with a new technique that attempts to](https://nakedsecurity.sophos.com/2017/01/16/spora-ransomware-goes-freemium-with-four-different-payment-options/)\nconfuse and bypass antivirus products and email filters, SophosLabs researchers have\ndiscovered.\n\nLike previous campaigns, the contagion arrives in an email bearing a tainted HTA (HTML\nApplication) file. But while the file clearly has an HTA file extension, the file itself is crafted to\nconfuse scanners that might ordinarily stop an HTA file into thinking it’s a harmless PDF and\nletting it through instead.\n\nThe technique has only been seen in attacks that target a Russian-speaking population,\nbut if it works well, chances are better than average that we’ll see the same trick being used\nto target users in other countries.\n\n## Route to infection\n\nSpora was previously delivered in a multi-stage attack that unfolds like this:\n\n**Victims receive a ZIP file and are invited to look inside. Opening up ZIPs, even if**\nthey arrived in an email, is generally regarded as a low-risk exercise, in the same way\nthat looking at a list of files in a folder is much less dangerous than actually opening\nindividual files inside the folder.\n\n\n-----\n\n**The ZIP contains an HTA file with an enticing name. HTA is short for HTML**\n_Application, meaning that Windows treats an HTA file like a web page that isn’t subject_\nto the sandboxing and other security controls imposed when you are browsing. If an\nHTA contains an embedded script, that script gets the same sort of run-time power as a\ndownloaded program (.EXE file).\n**The HTA file contains a script that creates and runs an embedded JavaScript file.**\n\n## What’s new\n\nWindows treats the files as an HTA because it recognizes the file extension and ignores the\nfirst bytes that declare the file as something else.\n\nFiltering products typically do the opposite — trusting the file’s byte content more than its\nextension. Scanners and filters see the attachment as a PDF and tries to process it as such.\n\nSince the HTA script is tacked on at the end of a file otherwise created to look like a PDF, the\nchances of the ransomware getting through are greater.\n\n## The process, step by step\n\nWhat follows is the step-by-step process by which Spora is delivered to its victims, according\nto the SophosLabs analysis:\n\nFirst, we see a filename and icon for one of the samples. Filenames seen so far are all\nRussian but appear to center around a payment or invoice. They are, as you’d imagine,\ndesigned to lure recipients into clicking on them.\n\nWindows doesn’t show file extensions by default so if you unzip the file you’ll see a filename\nending in `_pdf, which might be enough to fool you in to thinking you’re dealing with a PDF.`\n\nThat’s why we recommend that you configure Windows to show file extensions. If you’re\nmachine is configured to show file extensions then you’ll see a filename ending\nin `.hta which might give you pause.`\n\nHere’s what the embedded file looks like in a hex editor:\n\n\n-----\n\nThe PDF end-of-file marker is followed by the HTA code:\n\n\n-----\n\nCleaned up with syntax highlighting the HTA code looks like this:\n\n\n-----\n\nIf you double click on the file then the malicious code is dropped and executed:\n\nHere’s what the encrypted images look like on the computer after the victim has opened the\nHTA:\n\n\n-----\n\nOnce infected, the victim receives the following ransom HTML page:\n\nTo reach the payment page, the victim must upload one file that the ransomware has\nencrypted. This appears to be the mechanism to create unique “accounts.” Here is the\npayment page:\n\n\n-----\n\nNext we see the public thread between the victims and the bad guys. This screenshot\nexplains the “immunity” payment — a service that prevents the user from being hit by Spora\nagain. It’s cost has gone down but all other options have gone up:\n\n\n-----\n\nAfter the ransomware runs the Program Files directory is hidden and replaced with a\nWindows Shortcut file:\n\nThis appears to be a method for spreading the ransomware to other computers with access\nto the same shares. Clicking on the fake Program Files directory opens the hidden directory\nin Explorer and causes the malware to copy itself to the user’s temp directory and then run\nitself from there.\n\nThis way, anyone browsing to a share of an infected network will also have their files\nencrypted.\n\n## Sophos detection\n\nSophos customers are protected, Sophos products detect the ZIP files containing the HTA as\nCXmail/JSDl-O. They detect the standalone PDF-HTA as Troj/HTADrp-AD, and the dropped\nEXE as Mal/EncPk-ACO. The dropped LNK files are detected as Mal/RansomLnk-A.\n\n\n-----\n\n## Defensive measures: malicious attachments\n\n**If you receive an attachment of any kind by email and don’t know the person who**\nsent it, DON’T OPEN IT.\n**Configure Windows to show file extensions. This gives you a better chance of**\nspotting files that aren’t what they seem.\n**Use an** **[anti-virus with an on-access scanner (also known as real-time](https://secure2.sophos.com/en-us/products/cloud.aspx)**\n**protection). This can help you block malware of this type in a multi-layered defense,**\nfor example, by stopping an initial booby-trapped PDF or HTA file.\n**[Consider stricter email gateway settings. Some staff are more exposed to malware-](https://www.sophos.com/en-us/products/secure-email-gateway.aspx)**\nsending crooks than others (such as the order processing department), and may\nbenefit from more stringent precautions, rather than being inconvenienced by them.\n\n## Defensive measures: ransomware\n\nThe best defense against ransomware is not to get infected in the first place, so we’ve\n[published a guide entitled How to stay protected against ransomware that we think you’ll](https://www.sophos.com/en-us/medialibrary/Gated%20Assets/white%20papers/sophosransomwareprotectionwpna.pdf?la=en)\nfind useful:\n\n[You might also enjoy our Techknow podcast Dealing with Ransomware:](https://nakedsecurity.sophos.com/2014/11/25/sophos-techknow-dealing-with-ransomware/)\n\n**LISTEN NOW**\n\n[(Audio player above not working? Listen on Soundcloud or access via iTunes.)](https://soundcloud.com/sophossecurity/sophos-techknow-dealing-with-ransomware)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-06-26 - How Spora ransomware tries to fool antivirus.pdf"
    ],
    "report_names": [
        "2017-06-26 - How Spora ransomware tries to fool antivirus.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536135,
    "ts_updated_at": 1743041172,
    "ts_creation_date": 1653688527,
    "ts_modification_date": 1653688527,
    "files": {
        "pdf": "https://archive.orkl.eu/9f6d6cf8bd935ffca7871f61c477a1ddacc76e1c.pdf",
        "text": "https://archive.orkl.eu/9f6d6cf8bd935ffca7871f61c477a1ddacc76e1c.txt",
        "img": "https://archive.orkl.eu/9f6d6cf8bd935ffca7871f61c477a1ddacc76e1c.jpg"
    }
}