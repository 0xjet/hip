{
    "id": "c21cd82f-c60a-41a0-bcf0-c7a03c4309ce",
    "created_at": "2023-01-12T15:09:15.718343Z",
    "updated_at": "2025-03-27T02:06:10.86647Z",
    "deleted_at": null,
    "sha1_hash": "8fa519e974d55c27dceec396f1729461d8c1c5aa",
    "title": "2022-03-17 - Analysis of CaddyWiper",
    "authors": "",
    "file_creation_date": "2022-05-28T04:53:36Z",
    "file_modification_date": "2022-05-28T04:53:36Z",
    "file_size": 349542,
    "plain_text": "# Analysis of CaddyWiper\n\n**nioguard.com/2022/03/analysis-of-caddywiper.html**\n\n## Summary\n\nName: CaddyWiper\n\nDiscovered in March 2022\n\nWas used in a targeted attack in Ukraine\n\nDeployed via Microsoft Active Directory GPO\n\nCorrupts files and disk partitions\n\nPE32 sample written in C++\n\nCompiled on the same day when it was deployed on targeted systems in Ukraine\n\n_by Denis Popov_\n\n\n-----\n\n## Introduction\n\n[On March 14 2022 ESET research found a new disruptive malware deployed in Ukraine. It](https://twitter.com/ESETresearch/status/1503436420886712321)\nwas called CandyWiper and it is already the third wiper that was found in the Ukrainian\nsystems. The previous ones were WhisperGate and HermeticWiper. As well as the\nHermeticWiper, CaddyWiper was also deployed via Microsoft Active Directory GPO.\n\n## Technical Details\n\n### Overview\n\nThe CaddyWiper sample was written in C++ and had compilation timestamp 14-03-2022,\nwhich matches with the day when it was deployed in the victim's system. This sample has\nonly 10 functions.\n\n### Execution\n\nAll code in the sample is obfuscated in an interesting way. All strings are separated by one\ncharacter. Even function calls are obfuscated in the same way, so malware has only one\nimported function and library, but others will be imported during execution.\n\n\n-----\n\nCaddyWiper retrieves the machine role in the system using the\n‘DsRoleGetPrimaryDomainInformation’ function. If the obtained value is\n‘DsRole_RolePrimaryDomainController’, the wiper terminates its execution, if other, then it\nproceeds.\n\nThe first folder where CaddyWiper starts its operation is the “C:\\Users”. File corruption\nroutine is the ‘sub_6522A0()’ function.\n\n\n-----\n\nDuring ‘sub_6522A0()’ execution wiper loads and uses next functions:\n\nFindFirstFileA\n\nFindNextFileA\n\nCreateFileA\n\nLocalAlloc\n\nSetFilePointer\n\nWriteFile\n\nLocalFree\n\nCloseHandle\n\nFindClose\n\nSetEntriesInAclA\n\nAllocateAndInitializeSid\n\nSetNamedSecurityInfoA\n\nGetCurrentProcess\n\nOpenProcessToken\n\n\n-----\n\nFreeSid\n\nIf the current file is used by another process, CaddyWiper obtains access to it using\n“SeTakeOwnershipPrivilege”. The first file in the system which CaddyWiper overwrites is\n‘C:\\Users\\desktop.ini’. After overwriting this file the desktop background will be deleted and\nall shortcuts will be unusable.\n\nAfter corrupting the ‘C:\\Users’ folder, malware proceeds and goes to the ‘D:\\’ logical drive. If\nit’s present, malware will corrupt its files in the same way as the previous one. This operation\nwill be repeated for all logical drives from ‘D:\\’ to ‘Z:\\’. If these drives are missing or file\ncorruption is done, it calls the ‘sub_4011D0()’ function, which will corrupt the disk partition.\n\n\n-----\n\nTo perform disk corruption CaddyWiper obtains access to the disk partitions from\n‘\\.\\\\\\PHYSICALDRIVE9’ to ‘\\.\\\\\\PHYSICALDRIVE0’ and performs overwriting the first 1920\nbytes of data with ‘0’ using ‘CreateFileW’ and ‘DeviceIoControl’ functions. This operation can\nbe done only if the malware was executed as administrator.\n\nOverwriting first 780h(1920 in decimal) bytes\n\n\n-----\n\nAfter disk partitions are corrupted the machine will be rebooted, but the system won’t be\nstarted, instead the “FATAL: INT18: BOOT FAILURE” message will be shown on the screen.\n\n### Obfuscation\n\nAll function calls and library names are separated in the PE file. Also, malware employs\nWinAPI calls obfuscation.\n\n\n-----\n\n## Conclusion\n\nCaddyWiper continues the trend of data wipers in Ukraine. It is the third one found. The\n[previous ones were WhisperGate and HermeticWiper. CaddyWiper doesn’t have any](https://www.nioguard.com/2022/01/analysis-of-whispergate.html)\nsimilarities with them, but as well as HermeticWiper, was deployed via Microsoft Active\nDirectory GPO. The analyzed sample has obfuscated strings and API calls. It has two main\ndisruptive functions, one of them corrupts files in the ‘C:\\Users’ folder and logical drives from\n‘D:\\’ to ‘Z:\\’, the second one overwrites disk partitions from ‘\\.\\\\\\PHYSICALDRIVE9’ to\n‘\\.\\\\\\PHYSICALDRIVE0’. After the corruption process is done the system will be rebooted, but\nwon’t be started.\n\n## IoCs\n\n### Files\n\nFile name SHA256\n\ncaddy1.exe a294620543334a721a2ae8eaaf9680a0786f4b9a216d75b55cfd28f39e9430ea\n\n### MITRE attack techniques\n\n\n-----\n\nTactic Technique\n\nDefense evasion [T1140 – Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140/)\n\n[T1027 – Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027/)\n\nDiscovery [T1083 – File and Directory Discovery](https://attack.mitre.org/techniques/T1083/)\n\n[T1082 - System Information Discovery](https://attack.mitre.org/techniques/T1082/)\n\nImpact [T1485 – Data Destruction](https://attack.mitre.org/techniques/T1485/)\n\n[T1529 – System Shutdown/Reboot](https://attack.mitre.org/techniques/T1529/)\n\n## References\n\n1. https://www.bleepingcomputer.com/news/security/new-caddywiper-data-wiping\nmalware-hits-ukrainian-networks/\n\n2. https://www.virustotal.com/gui/file/a294620543334a721a2ae8eaaf9680a0786f4b9a216\n\nd75b55cfd28f39e9430ea/details\n\n[3. https://app.any.run/tasks/399165f5-4f4d-417f-93dd-077718d81512/](https://app.any.run/tasks/399165f5-4f4d-417f-93dd-077718d81512/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-17 - Analysis of CaddyWiper.pdf"
    ],
    "report_names": [
        "2022-03-17 - Analysis of CaddyWiper.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536155,
    "ts_updated_at": 1743041170,
    "ts_creation_date": 1653713616,
    "ts_modification_date": 1653713616,
    "files": {
        "pdf": "https://archive.orkl.eu/8fa519e974d55c27dceec396f1729461d8c1c5aa.pdf",
        "text": "https://archive.orkl.eu/8fa519e974d55c27dceec396f1729461d8c1c5aa.txt",
        "img": "https://archive.orkl.eu/8fa519e974d55c27dceec396f1729461d8c1c5aa.jpg"
    }
}