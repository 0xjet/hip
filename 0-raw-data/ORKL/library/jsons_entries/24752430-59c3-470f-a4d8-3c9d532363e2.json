{
    "id": "24752430-59c3-470f-a4d8-3c9d532363e2",
    "created_at": "2023-01-12T15:04:57.448138Z",
    "updated_at": "2025-03-27T02:09:18.541982Z",
    "deleted_at": null,
    "sha1_hash": "f07ed50d6af05ff498b566d5a33399bf075d7f82",
    "title": "2021-07-28 - Finding AnchorDNS C2s With Iris Investigate",
    "authors": "",
    "file_creation_date": "2022-05-27T19:08:13Z",
    "file_modification_date": "2022-05-27T19:08:13Z",
    "file_size": 547488,
    "plain_text": "# Finding AnchorDNS C2s With Iris Investigate\n\n**[domaintools.com/resources/blog/finding-anchordns-c2s-with-iris-investigate](https://www.domaintools.com/resources/blog/finding-anchordns-c2s-with-iris-investigate)**\n\n## Executive Summary\n\nTaking Kryptos Logic's initial report, DomainTools Researchers illustrate how to hunt for\nAnchorDNS C2s in infrastructure data with a combination of passive DNS and infrastructure\nobservables for identifying those C2s accurately. Through this process they uncover an\nadditional four C2 domains not found in the initial reporting.\n\n## Background on AnchorDNS\n\n[AnchorDNS is a backdoor most commonly used by TrickBot when going after their most](https://www.malwarebytes.com/trickbot)\nprized victims. As an exfiltration tool, AnchorDNS uses DNS for C2 communications as well\nas exfiltration of data. This remains highly effective as most organizations do not filter their\noutbound DNS traffic.\n\n[Last week the researchers at Kryptos Logic published an article on recent changes to](https://www.kryptoslogic.com/blog/2021/07/adjusting-the-anchor/)\nAnchorDNS and a new tool dubbed Anchor Adjuster that allows the attackers using the\nexfiltration tool to adjust the configuration on the fly for further evasion. Along with this tool\ncomes a change in the way that the malware communicates with the C2 as well as new\nencoding that makes detection more difficult. This is all run from [Cobalt Strike, the](https://malpedia.caad.fkie.fraunhofer.de/details/win.cobalt_strike)\ncommercial tool loved by so many threat actors operating today.\n\n\n-----\n\n## Hunting AnchorDNS\n\nKryptos Logic provides an excellent breakdown of the changes in operation along with a\nfully detailed write up of the various queries and responses that’s worth reading if you are a\ndefender looking into these samples. Through their analysis of the samples, Kryptos Logic\nfound the following set of C2 domains:\n```\nfarfaris[.]com\nkalarada[.]com\nxyskencevli[.]com\nsluaknhbsoe[.]com\njetbiokleas[.]com\nnyhgloksa[.]com\n\n```\nLooking for ways to detect new C2s through our daily scanning of the Internet, DomainTools\nResearchers noticed an interesting change when reading this report that we will pivot on:\nthe sleep and retry response from the C2. When an AnchorDNS C2 receives a bot’s\ncommand successfully, the C2 responds with its own IP address. Additionally, when the C2\nis unable to respond the response will be 239.255.255[.]255 which tells the bot to sleep for\nthe configured amount of time and retry again later. Typically, addresses under 224.0.0.0/4\nare reserved for [Multicast and shouldn’t be seen in a DNS response in this way. This makes](https://en.wikipedia.org/wiki/Multicast#:~:text=In%20computer%20networking%2C%20multicast%20is,point%2Dto%2Dmultipoint%20communication.)\nlooking for them in passive DNS and subsequently verifying the resulting domains based on\ntheir query labels matching the AnchorDNS encoding scheme rather trivial.\n\nDue to the encoding scheme there ends up being a lot of noise in these queries. In fact, if\nwe query Farsight passive DNS alone for the number of results that match our query within\nthe time frame that this AnchorDNS variant has been active we see over 130,000 query and\nresponse pairs.\n\n\n-----\n\nTo reduce the noise we can filter these by just the second-level domain (SLD). Iris\nInvestigate does this automatically for you with the “Send Domains to Pivot Engine” button\nin the bottom-right of the passive DNS interface. Once in the Pivot Engine there are a\nnumber of new potential C2 domains:\n```\nlimeal[.]com\nmuncuc[.]com\nnewarg[.]com\ntuxomibo[.]com\n\n```\nIf we examine those domains alongside the known domains from the original Kryptos Logic\nreport, we see that the known domains are already scored by the DomainTools Risk Score\nengine as 100 or already on a blocklist. The other new C2 domains are in varying states of\nrisk, some high enough to be alarming and others flying under the radar entirely.\n\n## Additional Observations\n\nSince DomainTools researchers like to treat all indicators of compromise (IoCs) as\n[composite objects, there are a few other elements outside of just the noise and construction](https://www.domaintools.com/resources/blog/analyzing-network-infrastructure-as-composite-objects)\nof the query and response pairs found in passive DNS that make up this C2 infrastructure\nthat could be used in hunting for C2s in the future. These additional elements are important\nbecause they are fundamental in how these new samples work to make up a more robust\nmethod for identifying this infrastructure.\n\n\n-----\n\nThe oldest domain in this set that matches our profile is muncuc[.]com and comes in at just\nless than a year old with records up to the time of this writing. This tells us that when\nhunting for these result sets, researchers can time box to the last year when looking for new\nC2 infrastructure and that older infrastructure remains active.\n\nNext, there is the use of a varied number of hosting providers but there are overlaps in\nColoCrossing (AS36532), Green Floid (AS50979), and Owned-Networks (AS40676). This\nshows a preference that can be used to narrow down potential detections before moving\nfurther up the [Pyramid of Pain and analyzing a sample to discover the specific, custom](https://detect-respond.blogspot.com/2013/03/the-pyramid-of-pain.html)\nencoding for the DNS queries.\n\nLastly, the IP of the A record is the same as the IP of the two NS records which point to ns1.\n\n[domain].com and ns2.[domain].com. This makes sense and is a requirement for malicious\ninfrastructure performing DNS tunneling. Without control of the nameservers the attackers\ncould not have the additional logic required to parse and respond to messages with\ncommands. In fact, this is often a quick indicator that a domain is malicious as most\nlegitimate groups opt to outsource their DNS infrastructure these days to a number of\ndifferent cloud services that make management easy and programmatic.\n\n## Takeaways\n\nData sets such as passive DNS are ideal for hunting for C2 communications that leverage\nDNS for exfiltration due to the sheer number of query and response pairs required by the\nattacker. While this data is available in public data sets like the four passive DNS providers\nin [DomainTools Iris Investigate, a similar setup using free and open source tools such as](https://www.domaintools.com/products/iris?utm_source=Blog&utm_campaign=finding-anchordns-c2s-with-iris-investigate)\n[CIRCL’s d4 Project can be useful for passively monitoring the DNS queries in your own](https://d4-project.org/)\ninfrastructure and useful for revealing malicious software operating over passive DNS.\n\nAdditionally, domain data found in Iris Investigate is useful for further verification of any\ndomains which surface as potential C2 communication. Attackers have to control the\nentirety of a nameserver for DNS exfiltration and signaling so NS records for C2 domains\nare an always useful signal in determining the intent of a domain.\n\n## Iris Hash Containing All Known C2s\n```\nU2FsdGVkX19QbpKjLRpwXzsMlsolXaIChMZoKECwCmCkCtr06hGK0ginsvV/jsBNNd5fNML2HOcDz0GBqdRKX\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-28 - Finding AnchorDNS C2s With Iris Investigate.pdf"
    ],
    "report_names": [
        "2021-07-28 - Finding AnchorDNS C2s With Iris Investigate.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bdbf873a-048d-4c5d-9d92-922327cc83a8",
            "created_at": "2023-01-06T13:46:39.387696Z",
            "updated_at": "2025-03-27T02:00:03.071819Z",
            "deleted_at": null,
            "main_name": "DEV-0586",
            "aliases": [
                "Ruinous Ursa",
                "Cadet Blizzard"
            ],
            "source_name": "MISPGALAXY:DEV-0586",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535897,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653678493,
    "ts_modification_date": 1653678493,
    "files": {
        "pdf": "https://archive.orkl.eu/f07ed50d6af05ff498b566d5a33399bf075d7f82.pdf",
        "text": "https://archive.orkl.eu/f07ed50d6af05ff498b566d5a33399bf075d7f82.txt",
        "img": "https://archive.orkl.eu/f07ed50d6af05ff498b566d5a33399bf075d7f82.jpg"
    }
}