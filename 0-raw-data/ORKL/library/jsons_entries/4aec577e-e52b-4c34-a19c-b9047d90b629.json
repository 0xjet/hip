{
    "id": "4aec577e-e52b-4c34-a19c-b9047d90b629",
    "created_at": "2023-01-12T15:06:09.138857Z",
    "updated_at": "2025-03-27T02:16:39.598515Z",
    "deleted_at": null,
    "sha1_hash": "c552ae582d556471a602c1c817dc20c74ed5e835",
    "title": "2021-06-08 - ThunderCats Hack the FSB - Your Taxes Didn’t Pay For This Op",
    "authors": "",
    "file_creation_date": "2022-08-18T03:43:57Z",
    "file_modification_date": "2022-08-18T03:43:57Z",
    "file_size": 2309157,
    "plain_text": "# ThunderCats Hack the FSB | Your Taxes Didn’t Pay For This Op\n\n**[sentinelone.com/labs/thundercats-hack-the-fsb-your-taxes-didnt-pay-for-this-op](https://www.sentinelone.com/labs/thundercats-hack-the-fsb-your-taxes-didnt-pay-for-this-op)**\n\nJuan Andrés Guerrero-Saade\n\n## Key Findings\n\nThis research focuses on the ‘Mail-O’ malware used against the FSB and other\nRussian government organizations, detailed in the May 2021 FSB NKTsKI and\nRostelecom-Solar report.\nEarly armchair commentary presumed that given the targets, this attack would\nundoubtedly be the work of a Western government, Five Eyes, or the United States.\nOur analysis disproves that hypothesis.\nInstead, we present the argument that the Mail-O malware is a variant of a relatively\nwell-known malware called PhantomNet or SManager used by a threat actor ‘TA428’\nPrevious reporting on TA428 points to Chinese origin and details a history of attacks\nagainst South East Asian and Russian targets.\n\n## Actor Disambiguation\n\n**Related actors: TA428, suspected IronHusky**\n\n**Related operations: Operation SignSight, Operation LagTimeIT**\n\n**Related malware: PhantomNet, SManager, TManger, CoughingDown**\n\n\n-----\n\nIn May 2021, the Russian Federal Security Service s National Coordination Center for\n[Computer Incidents (NKTsKI) in coordination with Rostelecom announced that several](https://rt-solar.ru/analytics/reports/2203/)\nRussian government institutions had been victims of an APT campaign. While the Russian\n[government has made a similar announcement before, it’s the first time they’ve accompanied](https://www.bbc.com/news/world-europe-36933239)\nit with a [moderately detailed technical analysis. Several researchers, myself included,](https://rt-solar.ru/upload/iblock/b55/Ataki-na-FOIV_otchet-NKTSKI-i-Rostelekom_Solar_otkrytyy.pdf)\njumped on the opportunity to write our YARA rules and hope for a glimpse at the culprit.\n\nThe InfoSec twitterverse needed no such artifacts as blind speculation immediately pointed\nat a Western government, Five Eyes, or the United States as de facto culprits. I think we’ll be\nrelieved to find out that was most likely not the case – if solely because we’ve come to\nexpect a higher standard for Western malware development.\n\nInitial attempts to find the samples were fruitless but that changed this past weekend as\nsome kind soul (or more likely a bulk autosubmitter) uploaded a copy of the ‘Mail-O’ malware\nto [VirusTotal. We track this activity under the name ‘ThunderCats’.](https://www.virustotal.com/gui/file/603881f4c80e9910ab22f39717e8b296910bff08cd0f25f78d5bff1ae0dce5d7/details)\n\n## Technical Analysis\n```\nSHA256\n603881f4c80e9910ab22f39717e8b296910bff08cd0f25f78d5bff1ae0dce5d7\n\nSHA1\nb7c1ec9484c4c2dcd01f861eeaa3b915c3e3312e\n\nMD5\nd58b95f8413f784552d7fdadbb621243\n\nSize\n2.82 MB\n\nCompilation Timestamp\n2019-12-20 02:13:01\n\nFirst Submitted\n2021-06-05 05:22:04\n\n\n```\nIn line with the findings of the NKTsKI-Rostelecom report, the Mail-O malware acts as a\n[downloader with a thin veneer of similarity to the legitimate Mail.ru Disk-O software. The](https://disk-o.cloud/en/)\ndisguise consists of a version number (“19.05.0045”) lifted from a legitimate Disk-O\nexecutable and the use of a real Mail.ru to post victim details and host a next stage payload.\n\nThe executable is bulked up to 2.8MB by statically linking both libcurl 7.64.1 and OpenSSL.\nFocus becomes important to avoid going down a pointless rabbithole of reversing unrelated\nopen-source code. For that reason, we should focus primarily on the exported functions.\n\nThe Mail-O malware exports two functions, `Entery and` `ServiceMain :`\n\n\n-----\n\nMail-O malware’s exported functions\n\n### Mail-O: ServiceMain\n\nServiceMain function pseudocode\n```\nServiceMain takes a service name as an argument and attempts to register a service\n\n```\ncontrol handler with a specific `HandlerProc function meant to check and set the status of`\nthat service. With a valid service status handle, Mail-O detaches the calling process from its\nconsole, changes the service status values to reflect its current running state, and calls the\n```\nEntery function. Note the ServiceMain function with the debug string “ServiceMain\n\n```\nLoad” – a template that comes into play in looking for connections to other malware.\n\n### Mail-O: Entery\n\nThe `Entery function is called at the end of` `ServiceMain, but it can also be`\nindependently invoked. It checks for the presence of `‘%AllUsersProfile%PSEXESVC.EXE’`\nand launches it as a process. This function is registered as a top level exception filter.\n\n\n-----\n\nMail-O PSEXESVC.exe check function\nThe main `Entery logic is orchestrated in the next function. First, Mail-O checks the registry`\nfor an existing install of the legitimate Mail.Ru Disk-O software. It decrypts configuration\nstrings and contacts `https://dispatcher.cloud.mail.ru/ .`\n\nMail-O uses the SystemTime to POST the encrypted victim hostname (or in its absence the\nstring “[none]”) and receive a payload. The payload is written to a temporary path before\nbeing launched. Mail-O then goes into a sleep loop until a predetermined amount of time.\n\nWe’ve yet to see ‘Webdav-O’, the other malware component described in the RostelecomSolar report. However, that shouldn’t keep us from following an interesting lead.\n\n## The ‘Entery’ Connection\n\n\n-----\n\nLeft: TManger sample [(NTT Security)](https://insight-jp.nttsecurity.com/post/102gi9b/pandas-new-arsenal-part-1-tmanger)\n\n71fe3edbee0c27121386f9c01b723e1cfb416b7af093296bd967bbabdc706393\n\nRight: Mail-O sample:\n\n603881f4c80e9910ab22f39717e8b296910bff08cd0f25f78d5bff1ae0dce5d7\n\nMail-O exports a function called `Entery, presumably a misspelling of ‘Entry’. Misspellings`\nare a true gift for malware researchers. As it turns out, this isn’t the first time that misspelling\nhas been noted in a recently deployed piece of malware.\n\nIn December 2020, Ignacio Sanmillan and Matthieu Faou released an excellent report on a\nVietnamese supply-chain attack that used PhantomNet (aka SManager) malware. The\nresearchers noted that the malware’s persistence was established via a scheduled task that\ncalled the malicious DLL’s export, ‘Entery’. The researchers note that this same export was\n[pointed out by NTT Security in their analysis of TManger malware, which they in turn](https://insight-jp.nttsecurity.com/post/102gi9b/pandas-new-arsenal-part-1-tmanger)\ncorrelate with Proofpoint’s ‘TA428’ threat actor. That nondescript threat actor name is\n[adopted by Dr. Web in reporting recent attacks against additional Russian targets including](https://st.drweb.com/static/new-www/news/2021/april/drweb_research_attacks_on_russian_research_institutes_en.pdf)\nresearch institutes.\n\nWhile that might all seem a bit convoluted, I rehearse the logical connections to illustrate two\npoints:\n\n\n-----\n\n1. There s an established history of this very non-Western threat actor in targeting both\n\nAsian and Russian targets.\n2. These presumably Chinese clusters of activity are confusing and difficult to\n\ndisentangle. Tooling is likely shared among multiple threat actors (likely including\nPhantomNet/SManager), and what’s being referred to as ‘TA428’ is probably an\namalgam of multiple threat groups.\n\nFor skeptics, we’ve provided a YARA rule below for the `Entery overlap, which entails not`\njust the export function name but also the general layout of the function and some shared\n[strings. Note that the layout has likely developed iteratively from an open-source template.](https://www.cnblogs.com/csnd/p/12062234.html)\n\nFinally, while I’m quick to disparage the quality of the malware as not up to some exalted\nWestern standard, it’s important to note that ThunderCats (and the larger TA428 umbrella)\nare pulling off custom-tailored region-specific supply chain attacks, successfully punching\nway above their weight in their intelligence collection efforts, and they should not be\nunderestimated as an adversary.\n\n### YARA\n```\nimport \"pe\"\n\nrule apt_CN_ThunderCats_Overlap\n\n{\n\n     meta:\n\n    desc = \"Thundercats Entery Export Overlap\"\n\n    author = \"JAG-S @ SentinelLabs\"\n\n    version = \"1.0\"\n\n    last_modified = \"06.08.2021\"\n\n    reference = \"https://rt-solar.ru/upload/iblock/b55/Ataki-na-FOIV_otchetNKTSKI-i-Rostelekom_Solar_otkrytyy.pdf\"\n\n     strings:\n\n          $psexesvc = \"%AllUsersProfile%PSEXESVC.EXE\" ascii wide\n\n          $sm_load = \"ServiceMain Load\" ascii wide fullword\n\n     condition:\n\n          uint16(0) == 0x5a4d\n\n          and\n\n          pe.exports(\"Entery\")\n\n          and\n\n          pe.exports(\"ServiceMain\")\n\n          and\n\n          all of them\n\n}\n\n\n## References\n\n```\n\n-----\n\n[https://www.bbc.com/news/world-europe-36933239](https://www.bbc.com/news/world-europe-36933239)\nhttps://www.reuters.com/technology/russias-fsb-reports-unprecedented-hacking-campaignaimed-government-agencies-2021-05-26/\n\n[https://rt-solar.ru/analytics/reports/2203/](https://rt-solar.ru/analytics/reports/2203/)\n\nhttps://rt-solar.ru/upload/iblock/b55/Ataki-na-FOIV_otchet-NKTSKI-iRostelekom_Solar_otkrytyy.pdf\n\nhttps://st.drweb.com/static/newwww/news/2021/april/drweb_research_attacks_on_russian_research_institutes_en.pdf\n\nhttps://www.welivesecurity.com/2020/12/17/operation-signsight-supply-chain-attacksoutheast-asia/\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-08 - ThunderCats Hack the FSB - Your Taxes Didn’t Pay For This Op.pdf"
    ],
    "report_names": [
        "2021-06-08 - ThunderCats Hack the FSB - Your Taxes Didn’t Pay For This Op.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bbdb2d7d-4bf4-4100-a108-f4742cfd69ff",
            "created_at": "2022-10-25T16:07:24.01101Z",
            "updated_at": "2025-03-27T02:02:10.074776Z",
            "deleted_at": null,
            "main_name": "Operation SignSight",
            "aliases": [],
            "source_name": "ETDA:Operation SignSight",
            "tools": [
                "Mimikatz",
                "PhantomNet",
                "SManager"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a4aca3ca-9e04-42d1-b037-f7fb3fbab0b1",
            "created_at": "2023-01-06T13:46:39.042499Z",
            "updated_at": "2025-03-27T02:00:02.984002Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Colourful Panda",
                "BRONZE DUDLEY"
            ],
            "source_name": "MISPGALAXY:TA428",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d06cd44b-3efe-47dc-bb7c-a7b091c02938",
            "created_at": "2023-11-08T02:00:07.135638Z",
            "updated_at": "2025-03-27T02:00:03.193635Z",
            "deleted_at": null,
            "main_name": "IronHusky",
            "aliases": [],
            "source_name": "MISPGALAXY:IronHusky",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2f07a03f-eb1f-47c8-a8e9-a1a00f2ec253",
            "created_at": "2022-10-25T16:07:24.277669Z",
            "updated_at": "2025-03-27T02:02:10.157972Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Operation LagTime IT",
                "Operation StealthyTrident",
                "ThunderCats"
            ],
            "source_name": "ETDA:TA428",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Agent.dhwf",
                "Albaniiutas",
                "BlueTraveller",
                "Chymine",
                "Cotx RAT",
                "CoughingDown",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "LuckyBack",
                "PhantomNet",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "RoyalRoad",
                "SManager",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TManger",
                "TVT",
                "Thoper",
                "Xamtrav",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c416260c-7ff6-4a74-a5ba-a15f40d3543f",
            "created_at": "2024-05-01T02:03:07.939268Z",
            "updated_at": "2025-03-27T02:05:17.25652Z",
            "deleted_at": null,
            "main_name": "BRONZE DUDLEY",
            "aliases": [
                "Temp.Hex ",
                "Vicious Panda ",
                "TA428 "
            ],
            "source_name": "Secureworks:BRONZE DUDLEY",
            "tools": [
                "PoisonIvy"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2caf4672-1812-4bb9-9576-6011e56102d2",
            "created_at": "2022-10-25T16:07:23.742765Z",
            "updated_at": "2025-03-27T02:02:09.957037Z",
            "deleted_at": null,
            "main_name": "IronHusky",
            "aliases": [
                "BBCY-TA1",
                "Operation MysterySnail"
            ],
            "source_name": "ETDA:IronHusky",
            "tools": [
                "Agent.dhwf",
                "Chymine",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "MysterySnail",
                "MysterySnail RAT",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Xamtrav",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "115ee14e-a122-47a4-bef7-5d3668cda109",
            "created_at": "2025-01-10T02:00:03.15179Z",
            "updated_at": "2025-03-27T02:00:03.477693Z",
            "deleted_at": null,
            "main_name": "CoughingDown",
            "aliases": [],
            "source_name": "MISPGALAXY:CoughingDown",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535969,
    "ts_updated_at": 1743041799,
    "ts_creation_date": 1660794237,
    "ts_modification_date": 1660794237,
    "files": {
        "pdf": "https://archive.orkl.eu/c552ae582d556471a602c1c817dc20c74ed5e835.pdf",
        "text": "https://archive.orkl.eu/c552ae582d556471a602c1c817dc20c74ed5e835.txt",
        "img": "https://archive.orkl.eu/c552ae582d556471a602c1c817dc20c74ed5e835.jpg"
    }
}