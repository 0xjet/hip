{
    "id": "65eda31b-a583-43ba-93f5-9de6ad56b797",
    "created_at": "2023-01-12T15:06:50.663716Z",
    "updated_at": "2025-03-27T02:05:41.120339Z",
    "deleted_at": null,
    "sha1_hash": "bbb0ce619e2fffb1755348aac8c2e5f13bc0f547",
    "title": "2020-03-18 - Parallax- The new RAT on the block",
    "authors": "",
    "file_creation_date": "2022-05-28T17:09:25Z",
    "file_modification_date": "2022-05-28T17:09:25Z",
    "file_size": 1980180,
    "plain_text": "# Parallax: The New RAT on the Block\n\n**blog.morphisec.com/parallax-rat-active-status**\n\n[Tweet](https://twitter.com/share)\n\n[Following the increase in Parallax RAT campaigns -- the new RAT on the block, Morphisec](https://www.bleepingcomputer.com/news/security/parallax-rat-common-malware-payload-after-hacker-forums-promotion/)\nLabs decided to release more technical details on some of the latest campaigns that the\nMorphisec Unified Threat Prevention Platform intercepted and prevented on our customer’s\n\n\n-----\n\nsites.\n\nParallax is an advanced remote access trojan that supports all Windows OS versions. It is\ncapable of bypassing advanced detection solutions, stealing credentials, executing remote\n[commands, and has also been linked to several coronavirus malware campaigns.](https://blog.talosintelligence.com/2020/02/coronavirus-themed-malware.html)\n\nParallax is mostly delivered through malicious spam campaigns with Microsoft word\ndocuments as the delivery vehicle of choice as will also be described in the following blog\npost\n\n## Technical Details\n\nBefore we dive into the details, we would like to cover the general flow of one of the attack\nchains we investigated.\n\n### General Flow:\n\nThe first stage in this campaign is a Microsoft Word document with embedded macros. When\nmacros are enabled, a DLL is dropped to the %Temp% directory. The export function of this\ndll is then invoked, which injects shellcode to the “Notepad.exe” process. This process is\nresponsible for downloading the next stage from pastebin, which is the Parallax RAT loader.\n\nThe Parallax RAT loader does similar things in order to execute the final Parallax RAT\npayload. It injects a shellcode to the “mstsc.exe” process, which is responsible for\ndownloading the next stage from “i.imgur.com” in the form of a picture. It then decrypts the\npicture and injects it into the “cmd.exe” process. As part of its persistence mechanism,\nscheduled tasks will be created to launch the malware at various intervals.\n\n_Figure 1 -- The infection process tree_\n\n\n-----\n\n_Figure 2 -- The Parallax working directory_\n\n_Figure 3 -- A downloaded image from Imgur_\n\n### First Stage:\n\n**Document:**\n\nBelow is one example of a Microsoft Word document that’s used to deliver Parallax RAT.\nNote the low detection rate according to VirusTotal. Morphisec Labs has seen these\ndocuments delivered via phishing emails to targeted machines since January 2020.\n\n_Figure 4 -- The low detection rate in Virus Total_\n\nThe content of the document is designed to lure the victim into enabling macros. Once that’s\ndone, the RAT can run and deliver its payload.\n\n\n-----\n\n_Figure 5 --_\n\n_Document content seems unreadable._\n\nIf we look at the embedded macros, we can see that there are two interesting calls in\nbetween the garbage code.\n\n_Figure 6 -- Macro_\n\n_call to dropper function._\n\nThese calls are responsible for parsing the words in the document itself and converting them\nback to DLL, 64-bit and 32-bit versions respectively. The words (numbers) in the document\nare actually the DLL split into decimal values. The first two arguments passed to the function\nmark the start and the end of the DLL, the third argument stands for the DLL name to be\ndropped in the %temp% folder, fourth and fifth are garbage and never used.\n\nWe found the same behavior in other documents with different names, as well as the same\ngarbage code and the same number of unused arguments.\n\n\n-----\n\n_Figure 7 -- The export function is invoked_\n\nThe DLL export function is invoked after parsing completes.\n\n### Second stage:\n\n**DLL:**\n\nThe invoked DLL export function is responsible for decoding a shellcode that injects the next\nstage shellcode into a Notepad.exe process.\n\n_Figure 8 -- The_\n\n_invoked DLL export function_\n\n### First Stage Shellcode\n\nIn order to hide the use of the low level (Nt* and Zw* functions) process hollowing injection,\nthe shellcode uses direct syscalls. Attackers use this technique to escape debugger\nbreakpoints as well as evade userland hooks. Parallax maps its own copy of ntdll into\n\n\n-----\n\nmemory to utilize this technique.\n\n_Figure 9 -- Parallax maps its own ntdll copy to memory._\n\nAfter the new copy of ntdll is mapped, Parallax uses simple offset extraction from the opcode\nto extract the system calls.\n\n_Figure 10 -- syscall_\n\n_extractions from suspicious functions._\n\n_Figure 11 -- Direct syscall invocation._\n\n### Injected shellcode\n\nThe injected shellcode (usually injected to Notepad.exe) is responsible for downloading and\ndecoding Parallax RAT from pastebin.\n\n_Figure 12 -- Pastebin raw content_\n\nThe pastebin content is decoded using base64 and XORed with a key that is generated\nusing CRC32 checksum function on the pastebin URL.\n\n\n-----\n\n_Figure 13 -- The_\n\n_Decoding routine._\n\nThe decoded Parallax payload is then dumped and executed from the %temp% directory.\n[Vitali K covered the loader and image decoder that makes up Parallax RAT, while the](https://www.vkremez.com/2020/02/lets-learn-inside-parallax-rat-malware.html)\npastebin decoder is accessible via Github at\n[https://gist.github.com/osipovar/a80e8b6b3caad209f17616761530302b](https://gist.github.com/osipovar/a80e8b6b3caad209f17616761530302b)\n\n## Conclusion\n\nThis new Parallax RAT campaign is indicative of the trend toward Malware-as-a-Service, or\nMaaS, one of the most pernicious weapons in the arsenal of threat actors. It’s also the trend\nthat has largely driven the level of innovation in malware available to cybercriminals. Despite\nthis, Morphisec customers can remain confident that they are protected against Parallax RAT\nand other remote access trojans through the power of moving target defense.\n\n## Appendix\n\nIOCs:\n\nDoc (SHA1):\n\n2b2eaf94189d21b7a4418ff480fa332832aa0d98\ne793d2e0ac963357dc7895f62071c1036eba8284\ne440f67ca7d34be0f7346013d078072f64774e8c\n45df85b3fe8954099cd49fdc5d59863baf1e6b76\n40efa7e40846c5041e33ecd3396082a160f8d72c\nb4d8a4470ed1dc1dec7cf62c6d0bada7ca1fed21\n242c71fda9c05f89730204361ff6a21cdae025e7\n2ab5bae45055e0c18ac9f0ccc190f6f277dc806f\nff8c49fbfb3da3a8e84bc332e646e4df3f3f6760\n50c623fab59258300680f3dd0447cf3815498d89\nff8c49fbfb3da3a8e84bc332e646e4df3f3f6760\n161820606da9b7949dd45b93fe39b07b01bd973e\n2fb1a63a3505427e42323bafef10349cc48b2a8b\n\n\n-----\n\n420d9ffc0a760c40ca2e8ea480b8e268225a07f2\n1dc94d5d49cd4ab215f291d188544a4996c05654\n8642f6bb8b1db4c3adaad1c90167430f28536362\n\nPastebin:\n\nhxxps://pastebin[.]com/raw/2spx5VGG\nhxxps://pastebin[.]com/raw/5PiLyRjs\nhxxps://pastebin[.]com/raw/5UNceFha\nhxxps://pastebin[.]com/raw/aKj2aqwc\nhxxps://pastebin[.]com/raw/AvEEMK9J\nhxxps://pastebin[.]com/raw/BTiRSV6C\nhxxps://pastebin[.]com/raw/BXBbPstB\nhxxps://pastebin[.]com/raw/cpfstw2k\nhxxps://pastebin[.]com/raw/CuUTrPX0\nhxxps://pastebin[.]com/raw/drvV1FPJ\nhxxps://pastebin[.]com/raw/EnTPcdwc\nhxxps://pastebin[.]com/raw/exs0tSC7\nhxxps://pastebin[.]com/raw/FAUCzPvi\nhxxps://pastebin[.]com/raw/eYRSb32g\n\nPNG:\n\nhxxps://i.imgur[.]com/02OZh3h.png\nhxxps://i.imgur[.]com/KPolbR1.png\nhxxps://i.imgur[.]com/s9Nu51u.png\nhxxps://i.imgur[.]com/bnFTfnL.png\nhxxps://i.imgur[.]com/B4MGZog.png\nhxxps://i.imgur[.]com/swnDCdS.png\nhxxps://i.imgur[.]com/H0RNHhb.png\nhxxps://i.imgur[.]com/4lQl9FZ.png\nhxxps://i.imgur[.]com/8kZ4rhJ.png\nhxxps://i.imgur[.]com/FGfZfCf.png\nhxxps://i.imgur[.]com/82WDYmV.png\nhxxps://i.imgur[.]com/aNQrMu1.png\n\n[Contact SalesInquire via Azure](http://10.10.0.46/mailto:sales@morphisec.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-03-18 - Parallax- The new RAT on the block.pdf"
    ],
    "report_names": [
        "2020-03-18 - Parallax- The new RAT on the block.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536010,
    "ts_updated_at": 1743041141,
    "ts_creation_date": 1653757765,
    "ts_modification_date": 1653757765,
    "files": {
        "pdf": "https://archive.orkl.eu/bbb0ce619e2fffb1755348aac8c2e5f13bc0f547.pdf",
        "text": "https://archive.orkl.eu/bbb0ce619e2fffb1755348aac8c2e5f13bc0f547.txt",
        "img": "https://archive.orkl.eu/bbb0ce619e2fffb1755348aac8c2e5f13bc0f547.jpg"
    }
}