{
    "id": "5a3ae2fb-d7c1-4305-94d9-a9d8f2f9ea09",
    "created_at": "2023-01-12T15:00:08.905735Z",
    "updated_at": "2025-03-27T02:05:41.450796Z",
    "deleted_at": null,
    "sha1_hash": "4ee0198c75d116ff09970e91a04da059f1cf619a",
    "title": "2022-01-06 - Malware Analysis Spotlight- XLoader’ Cross-platform Support Utilizing XBinder",
    "authors": "",
    "file_creation_date": "2022-05-28T23:19:54Z",
    "file_modification_date": "2022-05-28T23:19:54Z",
    "file_size": 1291441,
    "plain_text": "# Malware Analysis Spotlight: XLoader’ Cross-platform Support Utilizing XBinder\n\n**[vmray.com/cyber-security-blog/malware-analysis-spotlight-xbinder-xloader/](https://www.vmray.com/cyber-security-blog/malware-analysis-spotlight-xbinder-xloader/)**\n\n## XLoader’ Cross-platform Support Utilizing XBinder\n\n**_From the VMRay Labs Team_**\n\n## Introduction\n\nLately, a rebranded version of the stealer FormBook named XLoader has emerged. In\ncontrast to FormBook, which targets Windows only, XLoader supports macOS as well.\nDuring our research, we observed Office documents, which exploit vulnerabilities in MS\nOffice products, and malicious loaders like Smoke Loader or GuLoader distributing\nFormBook and XLoader Windows samples.\n\nIn addition to XLoader, the developers published another tool called XBinder written in Java.\nIt combines samples that target different operating systems into one single file. Given the\nexecutable file format differs between Windows and macOS, it is most likely the purpose of\nthis tool to ease the platform-independent distribution of samples.\n\n\n-----\n\nIn this Spotlight, we take a closer look at XBinder and XLoader s behavior. We adopt the\nperspective of an attacker and use XBinder to combine two public XLoader samples into one\nsingle sample that we are going to analyze further.\n\n[View the VMRay Analyzer Report for XLoader macOS and](https://www.vmray.com/analyses/xloader-macos/report/overview.html) [XLoader Windows](http://vmray.com/analyses/xloader-windows/report/overview.html)\n\n## Distribution with XBinder\n\nAs mentioned before, XBinder is written in Java and combines two samples into one a Java\nArchive sample. Therefore, the generated sample is executable on both operating systems\nas long as the Java Runtime Environment (JRE) is installed. In case the JRE is missing, the\nJava Archive can’t be executed. Besides the samples for the operating systems Windows\nand macOS, XBinder requests a display file that it shows to the victim at execution (Figure\n1). Attackers can use this display file to remain inconspicuous by, for example, executing\nbenign software or showing an error message. For this Spotlight, we have chosen a simple\ntext file as the display file.\n\n_Figure 1: XBinder Builder_\n\nBy submitting the generated sample to the VMRay Platform and selecting a macOS and\nWindows Virtual Machine, we can observe its behavior and the behavior of both XLoader\npayloads (see XLoader macOS and XLoader Windows ). We can see that in both analyses,\nthe sample tries to evade a debugger, achieves persistence, and access system data (Figure\n2).\n\n\n-----\n\n_Figure 2: VMRay Platform – VTI indicating XLoader and XBinder on Windows (left) and_\n_macOS (right)._\n\nFigure 3. shows the process graphs generated by the VMRay Platform for Windows (top)\nand macOS (bottom) of the generated sample. In both analyses, the sample leads to\npayload execution and showing the display file using TextEdit or Notepad.\n\nThe payloads are dropped in the user’s home directory ( %USERPROFILE% or $HOME ).\nThese dropped files are the respective XLoader payloads selected above.\n\n_Figure 3: VMRay Platform – Process graph of both analyses_\n\n\n-----\n\nFigure 4. shows the main function of the decompiled sample file and its content. Both\npayloads and the display file are encrypted with the AES (Advanced Encryption\nStandard) and stored as three separate resources. Upon execution, the sample determines\nthe current operating system, decrypts the display file and respective payload, and performs\nthe previously seen behavior.\n\n_Figure 4: Decompiled XBinder sample_\n\nSo far, we have seen that three different (executable) file types are involved in the analyses.\nBecause XLoader is compiled natively, it can only be executed on either Windows or macOS\nbut not on both. To achieve cross-platform support at the sample level, actors can use\nXBinder and benefit from Java’s cross-platform support.\n\n## Comparison of XLoader Payloads\n\nUp until now, we have seen how the generated example executes the payloads and how\nXBinder adds cross-platform support on the sample level. Next, lets take a look at the\nbehavior of both payloads.\n\nAt first glance, the behavior of the Windows payload is similar to FormBook’s. For\nexample, both abuse the explorer process to spawn a new process of a legitimate Windows\nbinary. Next, they inject into this created process which has explorer as its parent and\n\n\n-----\n\ntherefore looks like it was initially started by the user. FormBook and XLoader Windows steal\ncredentials from browsers including Mozilla Firefox, Opera, and Chrome and target FTP\napplications. In addition to that, we can observe a similar anti-analysis behavior. For\nexample, debugger detection and hiding the process.\n\nOn the other hand, the XLoader macOS payload avoids being debugged by\ncalling ptrace with PT_DENY_ATTACH and seems to target browsers only. Another\ndifference is that XLoader macOS starts a copy of itself directly without injecting into systemrelated processes (Figure 3 bottom).\n\nBoth payloads try to be persistent on the running system either by using the registry key\n(Windows) or by creating a launch agent (macOS).\n\n_Figure 5: VMRay Platform – Persistence mechanism on macOS._\n\nBy taking a look at the binary level, we see that XLoader Windows resolves API functions at\nruntime which is similar to FormBook. Another commonality is the usage of socalled encbufs. These encbufs are part of the code section and look at first sight like ordinary\nfunctions because they have a typical function prologue. However, they are used to store\nencrypted data. Both of these techniques complicate a manual analysis without a sandbox.\n\nMoving forward to the network communication, both XLoader and FormBook use a specific\nbyte pattern, also known as magic bytes, in the C2 communication which is build upon HTTP.\nThese bytes are part of the messages transmitted during the communication. While\nFormBook uses “FBNG”, XLoader uses the magic bytes “XLNG”.\n\nIn addition to the network connection to their C2 servers, both connect to multiple benign\nURLs at runtime, which include the mission-id of the respective sample. We refer to them in\nthe following as decoy URLs. Figure 6. shows the HTTP requests sent to one of the decoy\nURLs the sample connects to. As highlighted in the figure, it includes the mission-id (“xzes”)\n\n\n-----\n\ndespite being a decoy while the real C2 elsist[.]online is unreachable. This makes it\nchallenging to identify the real C2 server from the decoy URLs based on network connection\nattempts because the attempts look similar.\n\n_Figure 6: VMRay Platform – C2 Communication including decoys from the XLoader Windows_\n_payload._\n\nThis behavior makes it hard to separate the real C2 URL from the decoy URLs and\ncomplicates the automatic extraction of IOCs in general.\n\nIn such a case, the VMRay platform’s artifact scoring feature assists analysts to distinguish\nartifacts from IOCs. It can mark the real C2 URL as an IOC while the decoy URLs remain\nartifacts. Therefore, the platform can extract the real network IOCs more reliable.\n\n## Conclusion\n\nIn this Spotlight, we discussed XLoader with a focus on the distribution with XBinder. The\ngenerated sample involves three different file types. Performing a dynamic analysis of the\nsample using a sandbox requires the sandbox supports these file types and respective\noperating systems.\n\nFurthermore, FormBook and XLoader use decoy domains to make the C2 connection\nunapparent. Through the VMRay platform’s custom IOC generation, the network IOC\nextraction of the real C2 URL is more reliable.\n\n### Resources\n\n[https://blogs.blackberry.com/en/2021/09/threat-thursday-xloader-infostealer](https://blogs.blackberry.com/en/2021/09/threat-thursday-xloader-infostealer)\n\n\n-----\n\nhttps://research.checkpoint.com/2021/time-proven-tricks-in-a-new-environment-the-macosevolution-of-formbook/\n\n[https://www.netscout.com/blog/asert/formidable-formbook-form-grabber](https://www.netscout.com/blog/asert/formidable-formbook-form-grabber)\n\n### IOCs\n\n**C2 URLs – www[.]elsist[.]online/xzes**\n\n-www[.]iregentos[.]info/09rb\n\n**SHA-256 XLoader macOS –**\n97d6b194da410db82d9974aec984cff8ac0a6ad59ec72b79d4b2a4672b5aa8aa\n\n**SHA-256 XLoader Windows –**\n4216ff4fa7533209a6e50c6f05c5216b8afb456e6a3ab6b65ed9fcbdbd275096\n\n**SHA-256 XBinder Builder –**\n693d6f0ac1e3f5e3e5b68c45d2a77bcc9d8976f7b091d5bfa1e719ad8b97fd25\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-06 - Malware Analysis Spotlight- XLoader’ Cross-platform Support Utilizing XBinder.pdf"
    ],
    "report_names": [
        "2022-01-06 - Malware Analysis Spotlight- XLoader’ Cross-platform Support Utilizing XBinder.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535608,
    "ts_updated_at": 1743041141,
    "ts_creation_date": 1653779994,
    "ts_modification_date": 1653779994,
    "files": {
        "pdf": "https://archive.orkl.eu/4ee0198c75d116ff09970e91a04da059f1cf619a.pdf",
        "text": "https://archive.orkl.eu/4ee0198c75d116ff09970e91a04da059f1cf619a.txt",
        "img": "https://archive.orkl.eu/4ee0198c75d116ff09970e91a04da059f1cf619a.jpg"
    }
}