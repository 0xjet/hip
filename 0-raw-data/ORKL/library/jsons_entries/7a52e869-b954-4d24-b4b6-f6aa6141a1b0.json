{
    "id": "7a52e869-b954-4d24-b4b6-f6aa6141a1b0",
    "created_at": "2023-03-03T02:07:13.82932Z",
    "updated_at": "2025-03-27T02:14:13.689127Z",
    "deleted_at": null,
    "sha1_hash": "d613cc184e9774e6bf25c3b02b654aaaed10ee7a",
    "title": "2023-02-23 - Getting Dumped- A Trust Relationship Destroyed by Lorenz",
    "authors": "",
    "file_creation_date": "2023-03-01T09:37:23Z",
    "file_modification_date": "2023-03-01T09:37:23Z",
    "file_size": 630794,
    "plain_text": "# Lorenz Abuses Magnet RAM Capture\n\n**arcticwolf.com/resources/blog/lorenz-ransomware-getting-dumped/**\n\nby\nSteven Campbell, Ross Phillips, Seth Battles, and Markus Neis February 23, 2023\n\n\n-----\n\n-----\n\n## Executive Summary ­\n\n[As organizations implement additional security controls and detections, threat actors adjust to bypass them. Since our initial investigation into a](https://arcticwolf.com/resources/blog/lorenz-ransomware-chiseling-in/)\nLorenz ransomware intrusion that exploited a Mitel MiVoice VoIP appliance, we have observed a shift in the group’s Tactics, Techniques, and\nProcedures (TTPs).\n\nThe Arctic Wolf Labs team recently investigated additional Lorenz ransomware intrusions, which also exploited a Mitel MiVoice VoIP appliance\nvulnerability (CVE-2022-29499) for initial access. In at least one case in late-2022, we observed the threat actors leveraging a compromised\n[VPN account to regain access to the victim’s environment and execute Magnet RAM Capture—a free tool that is typically used by law](https://www.magnetforensics.com/resources/magnet-ram-capture/)\nenforcement and forensic teams to capture the physical memory of a victim’s device—on a Mitel Digital Voicemail system (running Microsoft\nWindows Server 2016). The threat actors leveraged Magnet RAM Capture to bypass the victim’s EDR (Endpoint Detection and Response).\nArctic Wolf Labs has informed Magnet Forensics about the known abuse of their tool by the Lorenz group.\n\n[We have published a compiled list of Indicators of Compromise (IOCs) and related artifacts we observed in this intrusion to our GitHub here.](https://github.com/rtkwlf/wolf-tools/tree/main/threat-intelligence/lorenz-ransomware-getting-dumped)\nAlso included in our GitHub are Sigma and YARA rules that our team developed to assist defenders in detecting unexpected use of Magnet\nRAM capture on their hosts.\n\n**Note: Arctic Wolf Labs has deployed detections in our platform to identify potential malicious activity associated with the Lorenz ransomware**\ngroup, including the TTPs mentioned in this blog.\n\n### Key Findings\n\nThe Lorenz ransomware group targeted the same victim and adapted their TTPs to successfully bypass security controls when the first\nattempt was not successful.\nThis is the first Lorenz ransomware intrusion publicly documented where the threat actors leveraged Magnet RAM Capture to dump\nmemory.\n\n### Substantive Analysis\n\nIn at least one intrusion, the Lorenz ransomware group was not able to start the encryption process due to their registry modification attempts\nand PowerShell commands being blocked by the EDR. The techniques and procedures in this intrusion were almost identical to the Lorenz\nransomware case we investigated in September 2022.\n\nWe observed the use of the Chisel tunneling tool, dumping of LSASS, and encryption attempts via BitLocker Drive Encryption. Notably, data\nexfiltration did not occur until the threat actors noticed their PowerShell commands were being prevented by security controls. Approximately\ntwo hours after unsuccessful data encryption, we observed the threat actors download and execute FileZilla on multiple systems to exfiltrate as\nmuch data as possible. Like other Lorenz intrusions, the threat actors exfiltrated the data to Digital Ocean IP addresses.\n\nHowever, data exfiltration and extortion were not enough for Lorenz, and approximately a month later, the threat actors leveraged\ncompromised VPN credentials to regain access. The compromised VPN credentials were tied to a vendor account used to service the Mitel\ninfrastructure, which were obtained via activity from the previous incident when the credentials had been reset but set to “User must change\npassword at next logon,” which prompted the threat actors to change the password when logging in via the vendor account.\n\nUltimately this access allowed Lorenz to pivot into the Mitel environment and set up Chisel as a SOCKS proxy as well as obtaining additional\ncredentials and creating accounts for persistence.\n\n\n-----\n\nOpe at g t e e ode g es a ad e sa y access to t e ost p eged a eas o a ope at g syste o obta e e e e p eges\nthreat actors often leverage a technique known as “Bring Your Own Vulnerable Driver” (BYOVD). BYOVD allows a threat actor full kernel\nmemory read and write operations and gives them the ability to evade endpoint security solutions by removing telemetry sources. Multiple\n[threat actors have leveraged BYOVD to bypass and disable endpoint security solutions, including Lazarus,](https://www.welivesecurity.com/2022/09/30/amazon-themed-campaigns-lazarus-netherlands-belgium/) [AvosLocker, and](https://www.trendmicro.com/en_us/research/22/e/avoslocker-ransomware-variant-abuses-driver-file-to-disable-anti-Virus-scans-log4shell.html) [BlackByte.](https://news.sophos.com/en-us/2022/10/04/blackbyte-ransomware-returns/)\n\nWell-known vulnerable driver exploits are easily detected by most EDRs, forcing advanced threat actors to research kernel driver\nvulnerabilities and develop exploits, which can be a time-consuming and tedious task.\n\n[Lorenz, however, did not use a vulnerability to gain kernel access; instead, they leveraged Magnet RAM Capture, a user-mode application](https://www.magnetforensics.com/resources/magnet-ram-capture/)\nwhich comes equipped with a signed kernel driver, like many other RAM acquisition tools, to directly access the physical memory. The use of\nMagnet RAM Capture allowed the threat actor to bypass the EDR on the victim host and enabled them to obtain a memory dump of the host.\nAlthough a RAM capture is not completely structured, threat actors can extract sensitive information like credentials via readily available\nmemory forensics tools.\n\n_Example of obtaining credentials from RAM Capture_\n\n### Conclusion\n\nThe Lorenz ransomware group consistently shows inventive ways to achieve their objectives. This added technique demonstrates how the\nLorenz threat actors are willing to adjust their TTPs to evade security controls. In this case, they relied on a known RAM Capture tool to bypass\nan EDR solution.\n\nMany security vendors provide free tools to help security professionals perform better research and security investigations. Even with access\ncontrols, threat actors will continue to find ways to obtain and abuse legitimate tools to bypass security controls.\n\n## Recommendations\n\n**Ensure Secure Password Reset After a Compromise**\n\nWhen leveraging the “User must change password at next logon” ensure all accounts that received the prompt have successfully changed\ntheir password and logged in; this includes user, service, and vendor accounts.\n\nIf not, threat actors could leverage previously compromised credentials to reset the password and obtain access again, negating the password\nreset. Administrators should also understand all accounts tied to the service so that all resets can be tracked and recorded.\n\nFor user or vendor accounts that are tied to individuals outside of your organization, consider not using the “User must change password at\nnext logon” feature. Instead, reset the password directly with a new value and send the password to the account holder out of band. Ensure\nthe user resets the password upon logging in to the account.\n\n**Implement Multi-factor Authentication**\n\nImplement multi-factor authentication (MFA) wherever possible within your environment, especially VPN accounts. Multi-factor authentication\nreduces the impact leaked or compromised credentials have on an organization.\n\n**Conduct Network and Host Baselines to aid in Monitoring of Malicious Traffic and Binaries**\n\nUnderstanding your environment can help you identify malicious traffic and binaries in a more efficient manner. For example, if your\norganization does not use Magnet RAM Capture for legitimate business purposes or there is no purpose for it to be present on a target system,\nthe use of the binary could potentially be a good indicator that malicious activity is present in your environment. Understanding your\nenvironment’s baseline and approved software will ensure malicious activity is caught earlier in the kill chain.\n\n**Audit or Block Unwanted Drivers using Windows Defender Application Control (WDAC)**\n\nOrganizations can consider auditing or blocking unwanted drivers via Windows Defender Application Control (WDAC). Microsoft has detailed\n[many methods of restricting unwanted drivers in their “Microsoft recommended driver block rules” article.](https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/microsoft-recommended-driver-block-rules)\n\n### Detection Opportunities\n\n\n-----\n\nMultiple detection opportunities exist and below we provide a subset based on the Magnet RAM Capture sample observed during the Lorenz\nintrusion:\n\n**SHA256 72dc1ba6ddc9d572d70a194ebdf6027039734ecee23a02751b0b3b3c4ea430de**\n\nThe Arctic Wolf Labs team has developed Sigma and YARA rules that can assist defenders in detecting unexpected use of Magnet RAM\ncapture on their hosts.\n\n**Note: Arctic Wolf Labs has deployed detections in our platform to identify potential malicious activity associated with the Lorenz ransomware**\ngroup, including the TTPs mentioned in this blog.\n\n**Hunting for Execution**\n\nMagnet RAM Capture requires admin privileges and can either be executed via GUI or the command line.\n\nBoth types of execution can be identified by leveraging PE header metadata for process execution events, as these details have been defined\nby Magnet Forensics and have been consistent over various identified versions of the tool.\n\n**Example Process Create Event**\n```\nProcess Create:\nDescription: Magnet RAM Capture\n\nProduct: Magnet RAM Capture\n\nCompany: Magnet Forensics Inc.\n\nOriginalFileName: MRC.exe\n\n```\nIf execution is done via the command line, defenders can monitor for Magnet RAM Capture parameter invocations.\n\n**Parameter** **Description**\n\n**/accepteula*** Accepts the EULA (no user interaction required)\n\n**/go*** <optional output path, including output file name> – No user input required; start RAM capture immediately, saving to a .raw\nfile in the current folder unless a path is provided (if the path contains spaces, use quotes around the entire path).\n\n**/split** 500MB|1GB|2GB|4GB – Split the RAM capture into segments of 500MB, 1GB, 2GB, or 4GB (e.g. /split 2GB) – requires /go\nparameter.\n\n**/silent*** Captures RAM in the background; no interface or progress displayed – requires /go parameter.\n\n**/?** This help screen\n\n**_Source: Magnet RAM Capture_**\n\n*Required parameters to successfully invoke Magnet RAM capture via command line.\n\n**Example Process Create Event**\n```\nProcess Create:\nCommandLine: \"C:\\<SNIP>\\<magnet_path>\\magnet.exe\" /silent /go debug.raw /accepteula\n\n```\n**Driver Load**\n\nThe Magnet RAM capture main executable contains multiple signed drivers for various CPU architectures within its PE resources. A driver for\nthe correct architecture is dropped into the same directory from where the tool was executed with a .tmp extension.\n\n**Example Driver Load Event**\n```\nDriver loaded:\nImageLoaded: C:\\<SNIP>\\<magnet_path>\\magA46.tmp\n\nHashes:\n\nMD5=35AEF87E63302FB7273870CFF3117279\n\nSHA256=5FFF657939E757922941162376ADB86B7A37DC329A1F9969C70F23E7D54B7B4C\n\nIMPHASH=99ABE3BC6F5A07246949FFC36BC1F543\n\nSigned: true\n\nSignature: Magnet Forensics Inc.\n\nSignatureStatus: Valid\n\n```\nWe have extracted the drivers and recommend detecting on driver load events that contain any of the values seen below:\n\n\n-----\n\n**SHA256** **MD5** **SHA1**\n\n5FFF657939E757922941162376ADB86B7A37DC329A1F9969C70F23E7D54B7B4C 35AEF87E63302FB7273870CFF3117279 68DBA\n\nC0CAFFD00B9576725ACF9DBE15AF8FC64EA000CB527F1FBCAA3CBDCF52C99152 F6D77EF0B07B6FFF1B91357C890DCF88 5D798\n\n3766619B7564F84185CF8CC952EE5513C45C6D858EF971C5FD1B0BDF234B8BAA FFDC58CD04A6E6295725F1C9B9C0D0CE CB330\n\n654629028CF878126A25B8449B5F1AC4D828B5ADC03BB393062D46415A78F39B 1DD0E3E168B5B4704583B59E0F5A63A2 B7C36\n\n**Service Creation**\n\nMagnet Ram Capture creates a kernel driver service with a service name consisting of the FileDescription name of the driver that is used with\nan ImagePath pointing to a .tmp file which is the signed driver that gets written into the same directory from where the tool was executed.\n```\nWindows Event ID 7045\nServiceName: MagnetRAMCapture Driver\n\nImagePath: C:\\<SNIP>\\<magnet_path>\\mag7E01.tmp\n\nServiceType: kernel mode driver\n\nStartType: demand start\n\n### Indicators of Compromise (IOCs)\n\n```\n**Indicator** **Type** **Context**\n\n\n138.68.62[.]46 IP\nAddress\n\n192.241.152[.]84 IP\nAddress\n\n138.68.50[.]118 IP\nAddress\n\n206.189.198[.]191 IP\nAddress\n\n23.28.148[.]190 IP\nAddress\n\n45.61.136[.]141 IP\nAddress\n\n\nData exfiltration via FileZilla\n\nChisel Tunnel\n\nChisel Tunnel\n\nData Exfiltration via FileZilla\n\nUsed to connect to the victim’s SSL\nVPN\n\nUsed to connect to the victim’s SSL\nVPN\n\n\n97FF99FD824A02106D20D167E2A2B647244712A558639524E7DB1E6A2064A68D SHA256 Chisel Tunnel**\n\n72DC1BA6DDC9D572D70A194EBDF6027039734ECEE23A02751B0B3B3C4EA430DE SHA256 Magnet RAM Capture*\n\n5FFF657939E757922941162376ADB86B7A37DC329A1F9969C70F23E7D54B7B4C SHA256 Signed Driver used by Magnet RAM\nCapture\n\nC:\\Users\\MRCv120.exe Filepath Magnet RAM Capture*\n\nMagnetRAMCapture.sys Filename PE Original Name of Signed Driver\nused by Magnet RAM Capture\n\ndebug.raw Filename Observed name for RAM capture\noutput\n\n\\tmp\\.tmp\\mem Filepath Chisel Tunnel\n\n_* Magnet RAM Capture can be used for legitimate purposes. We recommend leveraging the hash values to hunt for potential malicious activity,_\n_but also leverage environment context to make a determination on the legitimacy of the tools in your environment._\n\n_** Chisel can be used for legitimate purposes. However, in most instances that Arctic Wolf Labs has observed the tool has been used for_\n_malicious activity. We recommend leveraging the hash values to hunt for potential malicious activity, but also leverage environment context to_\n_make a determination on the legitimacy of the tools in your environment._\n\n\n-----\n\n### &C at\n\n**Tactic** **ID** **Name** **Details**\n\n\nInitial\nAccess\n\n\n[T1190](https://attack.mitre.org/techniques/T1190/) Exploit Public-Facing Application Lorenz exploited CVE-2022-29499 on an exposed Mitel\ndevice, achieving Remote Code Execution (RCE).\n\n\nPersistence [T1078](https://attack.mitre.org/techniques/T1078/) Valid Accounts The threat actors leveraged compromised VPN credentials\nto regain access.\nThe threat actors created an additional account on the Mitel\nDigital Voicemail system.\n\n\nCommand\n& Control\n\nCredential\nAccess\n\n[T1003.002](https://attack.mitre.org/techniques/T1003/002/)\n[T1003.004](https://attack.mitre.org/techniques/T1003/004/)\n\n\n[T1095](https://attack.mitre.org/techniques/T1095/) Non-Application Layer Protocol Lorenz set up a SOCKS proxy via Chisel on the Mitel\ndevice.\n\n\n[T1003.001](https://attack.mitre.org/techniques/T1003/001/)\n\nOS Credential\nDumping:\n\nSecurity\nAccount\nManager\n\nOS Credential\nDumping:\n\nLSA Secrets\n\n\nOS Credential Dumping:\n\nLSASS Memory\n\nThe threat actors used Magnet RAM Capture\nto acquire a physical memory dump.\n\n\nThe threat actors dumped LSASS memory.\nThe threat actors used Magnet RAM capture to acquire a\nphysical memory dump.\n\nLorenz executed multiple Powershell commands that were\nprevented by the EDR.\n\nThe threat actors exfiltrated data via FileZilla.\n\n\nExecution [T1059.001](https://attack.mitre.org/techniques/T1059/001/) Command and Scripting Interpreter:\nPowershell\n\n\nData\nExfiltration\n\nDefense\nEvasion\n\n\n[T1048.002](https://attack.mitre.org/techniques/T1048/002/) Exfiltration Over Alternative Protocol:\n\nExfiltration Over Asymmetric Encrypted NonC2 Protocol\n\n\n[T1553.002](https://attack.mitre.org/techniques/T1553/002/) Subvert Trust Controls: Code Signing Magnet RAM Capture comes with a signed driver that\nallowed the threat actor to bypass the EDR.\n\n\n**[Note: To download a full listing of IOCs, artifacts, and detections for mentioned in this blog, refer to our GitHub here.](https://github.com/rtkwlf/wolf-tools/tree/main/threat-intelligence/lorenz-ransomware-getting-dumped)**\n\nFor additional recommendations and insights regarding Lorenz ransomware, check out our first blog, Chiseling In: Lorenz Ransomware Group\nCracks MiVoice And Calls Back For Free, published on September 12, 2022.\n\n## References\n\n**By Steven Campbell, Ross Phillips, Seth Battles, Markus Neis**\n\n**Steven Campbell | Senior Threat Intelligence Researcher**\n\nSteven Campbell is a Senior Threat Intelligence Researcher at Arctic Wolf Labs and has more than eight years of experience in intelligence\nanalysis and security research. He has a strong background in infrastructure analysis and adversary tradecraft.\n\n**Ross Phillips | Senior Threat Intelligence Researcher**\n\nRoss is a Sr. Threat Intelligence Researcher at Arctic Wolf Labs with almost a decade of experience in the security landscape. Prior to this,\nRoss worked as a Technical Lead for the Arctic Wolf SOC and an Internal Tech Resident at Google after graduating from Rochester Institute of\nTechnology in 2012 majoring in Information Security & Forensics.\n\n**Seth Battles | Senior Forensics Analyst**\n\nSeth Battles is a Senior Forensics Analyst with Arctic Wolf Incident Response. He has years of experience in various facets of security\noperations, with a focus on incident response. His technical proficiencies include Digital Forensics, Exploit analysis, and Offensive Security.\n\n**Markus Neis | Principal Threat Intelligence Researcher**\n\nMarkus Neis is a Principal Threat Intelligence Researcher in Arctic Wolf Labs focused on leading advanced threat research. He has more than\na decade of experience in researching adversary tradecraft and responding to sophisticated attacks.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-02-23 - Getting Dumped- A Trust Relationship Destroyed by Lorenz.pdf"
    ],
    "report_names": [
        "2023-02-23 - Getting Dumped- A Trust Relationship Destroyed by Lorenz.pdf"
    ],
    "threat_actors": [
        {
            "id": "4e453d66-9ecd-47d9-b63a-32fa5450f071",
            "created_at": "2024-06-19T02:03:08.077075Z",
            "updated_at": "2025-03-27T02:05:17.381141Z",
            "deleted_at": null,
            "main_name": "GOLD LOTUS",
            "aliases": [
                "Hecamede ",
                "BlackByte"
            ],
            "source_name": "Secureworks:GOLD LOTUS",
            "tools": [
                " Cobalt Strike",
                " ExByte",
                " MEGA",
                " RDP",
                " SoftPerfect Network Scanner",
                "BlackByte"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1677809233,
    "ts_updated_at": 1743041653,
    "ts_creation_date": 1677663443,
    "ts_modification_date": 1677663443,
    "files": {
        "pdf": "https://archive.orkl.eu/d613cc184e9774e6bf25c3b02b654aaaed10ee7a.pdf",
        "text": "https://archive.orkl.eu/d613cc184e9774e6bf25c3b02b654aaaed10ee7a.txt",
        "img": "https://archive.orkl.eu/d613cc184e9774e6bf25c3b02b654aaaed10ee7a.jpg"
    }
}