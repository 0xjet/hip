{
    "id": "58dddaae-03c8-40db-9a79-34e6049575ec",
    "created_at": "2023-01-12T15:00:04.158085Z",
    "updated_at": "2025-03-27T02:05:43.39264Z",
    "deleted_at": null,
    "sha1_hash": "006dc43e49fde5a7e05f193898589022321a4c6f",
    "title": "2018-11-08 - Metamorfo Banking Trojan Keeps Its Sights on Brazil",
    "authors": "",
    "file_creation_date": "2022-05-27T21:58:10Z",
    "file_modification_date": "2022-05-27T21:58:10Z",
    "file_size": 1052769,
    "plain_text": "# Metamorfo Banking Trojan Keeps Its Sights on Brazil\n\n**[blog.talosintelligence.com/2018/11/metamorfo-brazilian-campaigns.html](https://blog.talosintelligence.com/2018/11/metamorfo-brazilian-campaigns.html)**\n\n## Executive Summary\n\nFinancially motivated cybercriminals have used banking trojans for years to steal sensitive\nfinancial information from victims. They are often created to gather credit card information\nand login credentials for various online banking and financial services websites so this data\ncan be monetized by the attackers. Cisco Talos recently identified two ongoing malware\ndistribution campaigns being used to infect victims with banking trojans, specifically financial\ninstitutions' customers in Brazil. Additionally, during the analysis of these campaigns, Talos\nidentified a dedicated spam botnet that is currently delivering malicious spam emails as part\nof the infection process.\n\n## Distribution campaigns\n\nWhile analyzing these campaigns, Talos identified two separate infection processes that we\nbelieve attackers have used between late October and early November. These campaigns\nused different file types for the initial download and infection process, and ultimately\ndelivered two separate banking trojans that target Brazilian financial institutions. Both\ncampaigns used the same naming convention for various files used during the infection\nprocess and featured the abuse of link-shortening services to obscure the actual distribution\n\n\n-----\n\nservers used. The use of link shorteners also allows some additional flexibility. Many\norganizations allow their employees to access link shorteners from corporate environments,\nwhich could enable the attacker to shift where they are hosting malicious files, while also\nenabling them to leverage these legitimate services in email-based campaigns.\n\n## Campaign 1\n\nTalos identified a spam campaign using a zipped file hosted on a free web hosting platform.\nThis archive contains a Windows LNK file (Link). During this campaign, the filename followed\nthe following format:\n\n\"Fatura-XXXXXXXXXX.zip,\" where \"XXXXXXXXXX\" is a 10-digit numeric value.\n\nThe LNK file format was:\n\n\"__Fatura pendente - XXXX.lnk,\" where \"XXXX\" is a four-digit alphanumeric value.\n\nThe purpose of the LNK file was to download a PowerShell script with an image filename\nextension (.bmp or .png):\n\nThe purpose of this command is to download and execute a PowerShell script from the\nattacker's URL. This new PowerShell script is also obfuscated:\n\n\n-----\n\nThis script is used to download an archive hosted on Amazon Web Services (AWS):\n\nhXXps://s3-eu-west-1[.]amazonaws[.]com/killino2/image2.png.\n\nThis archive contains two files:\n\nA dynamic library (.DLL)\nA compressed payload (.PRX)\n\nThe library decompresses the PRX file and executes it in a remote process (library injection).\nThis injected code is the final payload described later in this post.\n\n## Campaign 2\n\nIn addition to the infection process described in Campaign 1, Talos also observed a second\nseries of campaigns that leveraged a different process to deliver and execute malware on\nvictim systems. This campaign also appeared to target Portuguese-speaking victims.\n\n\n-----\n\nIn this series of campaigns, attackers leveraged malicious PE32 executables to perform the\ninitial stage of the infection process rather than Windows shortcut files (LNK). These PE32\nexecutables were delivered in ZIP archives using the following naming convention:\n\n\"Fatura-XXXXXXXXXX.zip,\" where \"XXXXXXXXXX'\" is a 10-digit numeric value.\n\nA PE32 executable is inside of the ZIP archive. These executables used the following\nnaming convention:\n\n\"__Fatura pendente - XXXX.exe,\" where \"XXXX\" is a four-digit alphanumeric value.\n\nWhen executed, these PE32 files are used to create a batch file in a subdirectory of\n%TEMP%.\n\nThe Windows Command Processor is then used to execute the batch file which, in turn,\nexecutes PowerShell with the instructions to download the contents hosted on the attackercontrolled server and pass it to the Invoke-Expression (IEX) using the following syntax:\n\nThe batch file is then deleted and the infection process continues.\n\n\n-----\n\nWhen the system reaches out to Bitly, the link shortener, to access the contents hosted at\nthe shortened link destination, an HTTP redirection redirects the client to the attackercontrolled server hosting a PowerShell script that is passed into IEX and executed as\npreviously described. The server delivers the following PowerShell:\n\nThis PowerShell script retrieves and executesthe malicious payload that is being delivered to\nthe system. This PowerShell also leverages the Bitly service, as seen in the previous\nscreenshot.\n\nWith Bitly links, users can obtain some further information by adding the \"+\" sign to the end\nof the shortened URL. By doing this, we discovered that the link was created on Oct. 21,\nmost likely around the campaign start time, and the number of clicks that have been\nregistered through the Bitly service, we identified 699 clicks so far.\n\nWhile the HTTP request is made for a JPEG and the content type specified is \"image/jpeg,\"\nthe server actually delivers a ZIP archive containing a Windows DLL file called \"b.dll.\"\n\n\n-----\n\nThe script then executes sleep mode for 10 seconds after which it extracts the archive and\nsaves the DLL to a subdirectory of %APPDATA% on the system. RunDLL32 is then used to\nexecute the malware, infecting the system. The uncompressed DLL is very large,\napproximately 366MB in size, due to the inclusion of a large number of 0x00 within the\nbinary. This may have been used to evade automated detection and analysis systems, as\nmany will not properly process large files. Similarly, this will avoid sandbox detonation, as\nmost sandboxes will not allow files of this size.\n\nAdditionally, infected systems beacon to an attacker-controlled server (srv99[.]tk) during the\ninfection process.\n\nAnalysis of the DNS communications associated with this domain shows an increase in\nattempts to resolve this domain, which corresponds with the campaigns that have been\nobserved.\n\n\n-----\n\nThe majority of these resolution requests have occurred from systems located in Brazil.\n\nThe PowerShell execution also facilitates communications with a dynamic DNS service.\nSimilarly to the first Bitly link, we were able to obtain additional information in relation to this\ndomain:\n\nWe once again see a creation time, but this time, it's a few days later. This potentially shows\nthe actor pivoting to a different email list to send the same spam information to.\n\n## Spam tools\n\nBoth of these campaigns eventually deliver a banking trojan. However, Talos identified\nadditional tools and malware hosted on the Amazon S3 Bucket. This malware is a remote\n\n\n-----\n\nadministration tool with the capability to create emails. The emails are created on the BOL\nOnline email platform, an internet portal that provides email hosting and free email services\nin Brazil. The attacker's main goal appears to be creating a botnet of systems dedicated to\nemail creation.\n\nThe malware is developed in C# and contains many Portuguese words.\n\nHere is the function used to create a BOL email:\n\nOnce created, the randomly generated username and password are sent to a C2 server.\nBOL Online uses a CAPTCHA system to keep machines from creating emails. To bypass\nthis protection, the malware author uses the Recaptcha API with the token provided from the\nC2 server:\n\n\n-----\n\nDuring our investigation, all the created emails were prefixed by \"financeir.\"\n\nThe trojan has the capability to clean itself, send created email credentials and restart,\ndownload and execute binaries provided by the C2 server.\n\nTalos identified three C2 servers:\n\nhxxp://criadoruol[.]site/\nhxxp://jdm-tuning[.]ru/\nhxxp://www[.]500csgo[.]ru/\n\nWe identified more than 700 compromised systems on the servers that are members of his\nbotnet. The oldest machine was compromised on Oct. 23. This botnet created more than\n4,000 unique emails on the BOL Online service using the the aforementioned technique.\nSome of these emails were used to initiate the spam campaigns we tracked as part of this\nresearch.\n\nGiven the filename patterns, the victimology along with the specific targeting aspect of both\ncampaigns, Talos assesses with moderate confidence that both of these campaigns\nleveraged the same email generation tool we discovered on the actors open S3 Bucket. This\nshows a link between both campaigns to the same actor using the same toolset. Likely the\nactor attempted to use different delivery methods and email lists to deliver his malspam.\n\n## Final payload\n\nWe identified two different payloads deployed during these campaigns. The payloads are\ndeveloped in Delphi and are banking trojans targeting Brazilian banks.\n\n\n-----\n\n[Fellow security firm FireEye already covered the first payload here. It gets information on the](https://www.fireeye.com/blog/threat-research/2018/04/metamorfo-campaign-targeting-brazilian-users.html)\ncompromised system and exfiltrates the data to a C2 server. It also includes a keylogger,\nwhich is exactly the same as the keylogger we described in this post. When the user is\nlogged into their bank's website, the malware can interact with them by showing a fake\npopup alleging to be from the bank. Here is an example that attempts to steal the user's\nCVV:\n\nThe second one has exactly the same features but is implemented differently. It mainly\ntargets two=factor authentication by displaying fake popups to the user:\n\n\n-----\n\nA keylogger then retrieves the information entered by the target.\n\nThe following financial services organizations are being targeted by this malware: Santander,\nItaù, Banco do Brasil, Caixa, Sicredi, Bradesco, Safra, Sicoob, Banco da Amazonia, Banco\ndo Nordeste, Banestes, Banrisul, Banco de Brasilia and Citi.\n\n## Conclusion\n\nThis strain of malware is prevalent throughout the world and is further proof that banking\ntrojans remain popular. With this sample the attacker targets specific Brazilian banking\ninstitutions. This could suggest the attacker is from South America, where they could find it\neasier to use the obtained details and credentials to carry out illicit financial activities. We will\ncontinue to monitor financial crimeware activities throughout the threat landscape. This is not\na sophisticated trojan, and most banking malware rarely is, but it's the latest example of how\neasy it can be for criminals steal from users by abusing spam to send their malicious\npayloads.This threat also shows the lengths that actors are going to in order to obtain\nadditional emails to abuse, creating an automatic generation mechanism to get new emails\nfor additional spam campaigns.\n\n## Coverage\n\n\n-----\n\nAdditional ways our customers can detect and block this threat are listed below.\n\n[Advanced Malware Protection (AMP) is ideally suited to prevent the execution of the](https://www.cisco.com/c/en/us/products/security/advanced-malware-protection)\nmalware used by these threat actors.\n\n[Cisco Cloud Web Security (CWS) orWeb Security Appliance (WSA) web scanning prevents](https://www.cisco.com/c/en/us/products/security/cloud-web-security/index.html)\naccess to malicious websites and detects malware used in these attacks.\n\n[Email Security can block malicious emails sent by threat actors as part of their campaign.](https://www.cisco.com/c/en/us/products/security/email-security-appliance/index.html)\n\n[Network Security appliances such asNext-Generation Firewall (NGFW), Next-Generation](https://www.cisco.com/c/en/us/products/security/firewalls/index.html)\n[Intrusion Prevention System (NGIPS), and Meraki MX can detect malicious activity](https://meraki.cisco.com/products/appliances)\nassociated with this threat.\n\n[AMP Threat Grid helps identify malicious binaries and build protection into all Cisco Security](https://www.cisco.com/c/en/us/solutions/enterprise-networks/amp-threat-grid/index.html)\nproducts.\n\n[Umbrella, our secure internet gateway (SIG), blocks users from connecting to malicious](https://umbrella.cisco.com/)\ndomains, IPs, and URLs, whether users are on or off the corporate network.\n\nOpen Source SNORTⓇ Subscriber Rule Set customers can stay up to date by downloading\n[the latest rule pack available for purchase on Snort.org.](https://www.snort.org/products)\n\n## Indicators of Compromise (IOCs)\n\nThe following IOCs are associated with various malware distribution campaigns that were\nobserved during the analysis of associated malicious activity.\n\n### Campaign #1\n\n\n-----\n\n**Stage 1 Downloaders (LNK Shortcuts):**\n\n627a24cb61ace84a51dd752e181629ffa6faf8ce5cb152696bd65a1842cf58fd\n\n**Stage 1 Downloaders Filenames (LNK Shortcuts):**\n\n_Fatura pendente - HCBF.lnk\n\n**Stage 2 URLs**\n\nhxxps://marcondesduartesousa2018[.]000webhostapp[.]com/downs/imagemFr.bmp\n\nhxxps://s3-eu-west-1[.]amazonaws[.]com/killino2/image2.png\n\n**Stage 2 Powershell**\n\n01fd7fdb435d60544d95f420f7813e6a30b6fa64bf4f1522053144a02f961e39\n\n**Stage 3 Archive**\n\na01287a79e76cb6f3a9296ecf8c147c05960de44fe8b54a5800d538e5c745f84\n\n**Stage 3 Loader**\n\n1ed49bd3e9df63aadcb573e37dfcbafffbb04acb2e4101b68d02ecda9da1eee7\n\n**Stage 3 Compressed Payload**\n\n3ff7d275471bb29199142f8f764674030862bc8353c2a713333d801be6de6482\n\n**Stage 4 Final Payload**\n\n61df7e7aad94942cb0bb3582aed132660caf34a3a4b970d69359e83e601cbcdb\n\n### Campaign #2\n\n**Stage 1 PE32 Executables:**\n\n3b237b8a76dce85e63c006db94587f979af01fbda753ae88c13af5c63c625a12\n\n\n-----\n\n46d77483071c145819b5a8ee206df89493fbe8de7847f2869b085b5a3cb04d2c\nbce660e64ebdf5d4095cee631d0e5eafbdf052505bc5ff546c6fbbb627dbff51\n7b241c6c12e4944a53c84814598695acc788dfd059d423801ff23d1a9ed7bbd2\n91781126feeae4d1a783f3103dd5ed0f8fc4f2f8e6f51125d1bfc06683b01c39\n\n**Stage 1 PE32 Filenames:**\n\n_Fatura pendente - QD95.exe\n\n_Fatura pendente - QW2I.exe\n\n_Fatura pendente - 9X3H.exe\n\n**Stage 1 Archive Filenames:**\n\nFatura-2308132084.zip\n\n**Stage 1 URLs:**\n\nhxxp://pgs99[.]online:80/script.txt\n\nhxxp://pgs99[.]online:80/bb.jpg\n\n**Stage 1 Domains:**\n\npgs99[.]online\n\n**Stage 2 URLs:**\n\nhxxp://srv99[.]tk:80/conta/?89dhu2u09uh4hhy4rr8\n\nhxxp://srv99[.]tk:80/favicon.ico\n\n**Link Shorteners:**\n\nhxxps://bit[.]ly/2CTUB9H#\n\nhxxps://bit[.]ly/2SdhUQl?8438h84hy389\n\n**C2 Domains:**\n\nhxxp://mydhtv[.]ddns[.]net:80/\n\n### Spam tools\n\n\n-----\n\n**PE Sample:**\n\n2a1af665f4692b8ce5330e7b0271cfd3514b468a92d60d032095aebebc9b34c5\n\n**C2 Servers:**\n\nhxxp://criadoruol[.]site/\n\nhxxp://jdm-tuning[.]ru/\n\nhxxp://www[.]500csgo[.]ru/\n\n### Final Payload\n\n**PE Samples:**\n\n61df7e7aad94942cb0bb3582aed132660caf34a3a4b970d69359e83e601cbcdb\n\n4b49474baaed52ad2a4ae0f2f1336c843eadb22609eda69b5f20537226cf3565\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-11-08 - Metamorfo Banking Trojan Keeps Its Sights on Brazil.pdf"
    ],
    "report_names": [
        "2018-11-08 - Metamorfo Banking Trojan Keeps Its Sights on Brazil.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535604,
    "ts_updated_at": 1743041143,
    "ts_creation_date": 1653688690,
    "ts_modification_date": 1653688690,
    "files": {
        "pdf": "https://archive.orkl.eu/006dc43e49fde5a7e05f193898589022321a4c6f.pdf",
        "text": "https://archive.orkl.eu/006dc43e49fde5a7e05f193898589022321a4c6f.txt",
        "img": "https://archive.orkl.eu/006dc43e49fde5a7e05f193898589022321a4c6f.jpg"
    }
}