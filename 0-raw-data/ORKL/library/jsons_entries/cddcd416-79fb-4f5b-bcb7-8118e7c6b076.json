{
    "id": "cddcd416-79fb-4f5b-bcb7-8118e7c6b076",
    "created_at": "2022-10-25T16:48:24.143968Z",
    "updated_at": "2025-03-27T02:15:35.532998Z",
    "deleted_at": null,
    "sha1_hash": "5217218444c642545031eaaabe9a0dd0f8dc4644",
    "title": "DNSpionage Campaign Targets Middle East",
    "authors": "",
    "file_creation_date": "2018-11-29T02:19:43Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 413762,
    "plain_text": "# DNSpionage Campaign Targets Middle East\n\n**[blog.talosintelligence.com/2018/11/dnspionage-campaign-targets-middle-east.html](https://blog.talosintelligence.com/2018/11/dnspionage-campaign-targets-middle-east.html)**\n\n_This blog post was authored by_ _[Warren Mercer and Paul Rascagneres.](https://twitter.com/securitybeard)_\n\n_Update 2018-11-27 15:30:00 EDT: A Russian-language document has been removed._\n_Subsequent analysis leads us to believe it is unrelated to this investigation._\n\n## Executive Summary\n\nCisco Talos recently discovered a new campaign targeting Lebanon and the United Arab\nEmirates (UAE) affecting .gov domains, as well as a private Lebanese airline company.\nBased on our research, it's clear that this adversary spent time understanding the victims'\nnetwork infrastructure in order to remain under the radar and act as inconspicuous as\npossible during their attacks.\nBased on this actor's infrastructure and TTPs, we haven't been able to connect them with\nany other campaign or actor that's been observed recently. This particular campaign\nutilizes two fake, malicious websites containing job postings that are used to compromise\ntargets via malicious Microsoft Office documents with embedded macros. The malware\nutilized by this actor, which we are calling \"DNSpionage,\" supports HTTP and DNS\ncommunication with the attackers.\n\nIn a separate campaign, the attackers used the same IP to redirect the DNS of legitimate\n.gov and private company domains. During each DNS compromise, the actor carefully\ngenerated Let's Encrypt certificates for the redirected domains. These certificates provide\nX.509 certificates for TLS free of charge to the user. We don't know at this time if the DNS\nredirections were successful.\n\nIn this post, we will break down the attackers' methods and show how they used malicious\ndocuments to attempt to trick users into opening malicious websites that are disguised as\n\"help wanted\" sites for job seekers. Additionally, we will describe the malicious DNS\nredirection and the timeline of the events.\n\n## Infection vectors\n\n### Fake job websites\n\nThe attackers' first attempt to compromise the user involved two malicious websites that\nmimicked legitimate sites that host job listings:\n\nhr-wipro[.]com (with a redirection to wipro.com)\nhr-suncor[.]com (with a redirection to suncor.com)\n\n\n-----\n\nsuncor[.]com/Suncor_employment_form[.]doc.\nThe document is a copy of a legitimate file available on the website for Suncor Energy, a\nCanadian sustainable energy company, and contains a malicious macro.\n\nAt this time, we don't know how the target received these links. The attackers most likely\nsent the malicious document via email as part of a spear-phishing campaign, but it also\ncould have circulated via social media platforms, such as LinkedIn, in an attempt to\nlegitimize the opportunity for a new job.\n\n### Malicious Office document\n\nUpon opening the first Office document, the user receives a message that says \"Content\nMode Available:\"\n\n### Macros used\n\nThe macros of the analysed samples can be divided into two steps:\n\n1. When the document is opened, the macro will decode a PE file encoded with base64\n\nand will drop it in %UserProfile%\\.oracleServices\\svshost_serv.doc\n2. When the document is closed, the macro will rename the file \"svshost_serv.doc\" to\n\n\"svshost_serv.exe.\" Then, the macro creates a scheduled task named \"chromium\nupdater v 37.5.0\" in order to execute the binary. The scheduled task is executed\nimmediately and repeatedly every minute.\n\nThe purpose of these two steps is to avoid sandbox detection\n\n\n-----\n\ninteraction to deploy it. The macros, while available through analysis, are also passwordprotected in Microsoft Word to stop the victim from exploring the macro code via Microsoft\nOffice.\n\nAdditionally, the macro uses classical string obfuscation in order to avoid strings detection:\n\nThe \"schedule.service\" string is created by concatenation. The final payload is a remote\nadministration tool that we named \"DNSpionage.\"\n\n## DNSpionage malware\n\n### Malware analysis\n\nThe malware dropped by the malicious document is an undocumented remote\nadministration tool. We are naming it DNSpionage due to the fact that it supports DNS\ntunneling as a covert channel to communicate with the attackers' infrastructure.\nDNSpionage creates its own data in the running directory:\n\n%UserProfile%\\.oracleServices/\n%UserProfile%\\.oracleServices/Apps/\n%UserProfile%\\.oracleServices/Configure.txt\n%UserProfile%\\.oracleServices/Downloads/\n%UserProfile%\\.oracleServices/log.txt\n%UserProfile%\\.oracleServices/svshost_serv.exe\n%UserProfile%\\.oracleServices/Uploads/\n\nThe Downloads directory is used by the attackers to store additional scripts and tools\ndownloaded from the C2 server.\nThe Uploads directory is used by the attacker to temporarily store files before exfiltrating\nthem to the C2 server.\n\nThe log.txt file contains logs in plain text.\n\nAll the executed commands can be logged in this file, it also contains the result of the\ncommands.\n\n\n-----\n\nattackers can specify a custom command and control (C2) server URL, a URI and a domain\nthat serves as a DNS covert channel. Additionally, the attackers can specify a custom\nbase64 alphabet for obfuscation. We discovered that the attackers used a custom\nalphabet for each target.\n\nAll the data is transferred in JSON. That's why a large part of the code of the malware is the\nJSON library.\n\n### Communication Channels\n\nThe malware uses HTTP and DNS in order to communicate with the C2 server.\n\n#### HTTP mode\n\nA DNS request (to 0ffice36o[.]com) is performed with random data encoded with base64.\nThis request registers the infected system and received the IP of an HTTP server\n(185.20.184.138 during the investigation). An example of a DNS request:\n\nyyqagfzvwmd4j5ddiscdgjbe6uccgjaq[.]0ffice36o[.]com\n\nThe malware is able to craft DNS requests used to provide the attacker with further\ninformation. Here is an example of request:\n\noGjBGFDHSMRQGQ4HY000[.]0ffice36o[.]com\n\nIn this context, the first four characters are randomly generated by the malware using\nrand(). The rest of the domain is then encoded in base32, once decoded the value is\n1Fy2048. \"Fy\" is the target ID and \"2048\" (0x800) means \"Config file not found\". The request\nis performed if the configuration file was not retrieved on the infected machine. This is a\nmessage is used to inform the attacker.\nThe malware performs an initial HTTP request to retrieve its configuration at\nhxxp://IP/Client/Login?id=Fy.\n\nThis request will be used to create the configuration file, particularly to set the custom\nbase64 dictionary.\n\nThe second HTTP request is hxxp://IP/index.html?id=XX (where \"XX\" is the ID for the\ninfected system)\n\nThe purpose of this request is to retrieve the orders. The site is a fake Wikipedia page:\n\n\n-----\n\nThe commands are included in the source code of the page:\n\nIn this example, the commands are encoded with a standard base64 algorithm because we\ndid not receive a custom alphabet. Here is another example with a custom alphabet in the\nconfiguration file:\n\nHere are the three commands automatically sent to the compromised system:\n\n\n-----\n\n{\"c\": \"systeminfo | findstr /B /C:\\\"Domain\\\"\", \"i\": \"-6000\", \"t\": -1, \"k\": 0}\n\nThe malware generates the following snippet of code after executing those commands:\n\nThe attackers ask for the username and hostname to retrieve the infected user's domains.\nThe first step is clearly a reconnaissance phase. The data is eventually sent to\nhxxp://IP/Client/Upload.\nFinally, CreateProcess() executes the commands, and the output is redirected to a pipe to\nthe malware created with CreatePipe().\n\n#### DNS mode\n\nThe malware also supports a DNS-only mode. In this mode, the orders and answers are\nhandled via DNS. This option is dictated within the configure.txt file on the infected\nmachine. Using DNS can sometimes be easier to allow for information to be sent back to\nthe attacker as it will generally avoid proxies or web filtering in place by leveraging the DNS\nprotocol.\nFirst, the malware initiates a DNS query to ask for orders, for example:\n\nRoyNGBDVIAA0[.]0ffice36o[.]com\n\nThe first four characters must be ignored, as mentioned earlier in the article this is random\ngenerated characters, and the relevant data is GBDVIAA0. The decoded value (base32) is\n\"0GT\\x00\". GT is the target ID and \\x00 the request number. The C2 server replies with an\nanswer to the DNS request, this will be an IP address, whilst not always a valid IP it is\nperfectly acceptable for the DNS protocol, for example 0.1.0.3. We believe the first value\n(0x0001) is the command ID for the next DNS request and 0x0003 is the size of the\ncommand.\nSecondly, the malware performs a DNS query with the command ID:\n\nt0qIGBDVIAI0[.]0ffice36o[.]com (GBDVIAI0 => \"0GT\\x01\")\n\nThe C2 server will return a new IP: 100.105.114.0. If we convert the value in ASCII we have\n\"dir\\x00\", the command to be execute.\n\n\n-----\n\nTwGHGJDVIATVNVSSA000.0ffice36o[.]com > GJDVIATVNVSSA000 > 2GT\\x02ume\n\n1QMUGJDVIA3JNYQGI000.0ffice36o[.]com -> GJDVIA3JNYQGI000 -> \"2GT\\x03in d\"\niucCGJDVIBDSNF3GK000.0ffice36o[.]com -> GJDVIBDSNF3GK000 -> \"2GT\\x04rive\"\n\nviLxGJDVIBJAIMQGQ000.0ffice36o[.]com -> GJDVIBJAIMQGQ000 -> \"2GT\\x05 C h\"\n\n[...]\n\n## Victimology\n\nThanks to the DNS exfiltration and Cisco Umbrella, we are able to identify the origin of\nsome of the victims and the period of activity in October and November. Here is the graph\nfor 0ffice36o[.]com, the DNS we mentioned above:\n\nThe queries were performed from Lebanon and UAE. This information is confirmed by the\nDNS redirection described in the next section.\n\n## DNS redirection\n\n### Introduction\n\nTalos discovered three IPs linked to the DNSpionage domain:\n\n185.20.184.138\n185.161.211.72\n185.20.187.8\n\nThe three IPs are hosted by DeltaHost.\nThe last one was used in a DNS redirection attack between September and November.\nMultiple nameservers belonging to the public sector in Lebanon and UAE, as well as some\ncompanies in Lebanon, were apparently compromised, and hostnames under their control\nwere pointed to attacker-controlled IP addresses. The attackers redirected the hostnames\nto the IP 185.20.187.8 for a short time. Just before redirecting the IP, the attackers created\na certificate matching the domain name with the Let's Encrypt service.\n\nIn this section, we will present all the DNS redirection instances we identified and the\nattacker-generated certificates associated with each. We don't know if the redirection\nattack was ultimately successful, or what exact purpose the DNS redirection served.\nHowever, the impact could be significant, as the attackers were able to intercept all traffic\n\n\n-----\n\nVPN traffic specifically, they may have been used to harvest additional information, such as\nemail and/or VPN credentials.\n\nAs incoming email would also be arriving at the attackers' IP address, if there was multifactor authentication, it would allow the attackers to obtain MFA codes to abuse. Since the\nattackers were able to access email, they could carry out additional attacks or even\nblackmail the target.\n\nThe DNS redirection we identified occurs in multiple locations where there is no direct\ncorrelation of infrastructure, staff, or job routines. It also occurs in both the public and\nprivate sectors. Therefore, we believe it was not human error, nor a mistake by an\nadministrative user within any of the impacted organisations. This was a deliberate,\nmalicious attempt by the attackers to redirect DNS.\n\n### Lebanon government redirection\n\nTalos identified that the Finance Ministry of Lebanon's email domain was the victim of a\nmalicious a DNS redirection.\n\nwebmail.finance.gov.lb was redirected to 185.20.187.8 on Nov. 6 06:19:13 GMT. On\n[the same date at 05:07:25 a Let's Encrypt certificate was created.](https://crt.sh/?id=922787324)\n\n### UAE government redirection\n\nUAE public domains were targeted, as well. We identified a domain from the Police (VPN\nand College) and the Telecommunication Regulatory Authority.\n\nadpvpn.adpolice.gov.ae redirected to 185.20.187.8 on Sept. 13 at 06:39:39 GMT. The\n[same date at 05:37:54 a Let's Encrypt certificate was created.](https://crt.sh/?id=741047630)\nmail.mgov.ae redirected to 185.20.187.8 on Sept. 15 at 07:17:51 GMT. A Let's\nEncrypt certificate was also created at 06:15:51 GMT.\nmail.apc.gov.ae redirected to 185.20.187.8 on Sept. 24. A [Let's Encrypt certificate](https://crt.sh/?id=820893483)\nwas also created at 05:41:49 GMT.\n\n### Middle East Airline redirection\n\nTalos discovered that Middle East Airlines (MEA), a Lebanese airline, was also the victim of\nDNS redirection.\n\nmemail.mea.com.lb redirected to 185.20.187.8 on Nov. 14 at 11:58:36 GMT\nOn Nov. 6, at 10:35:10 GMT, a [Let's Encrypt certificate was created.](https://crt.sh/?id=923463031)\n\nThis certificate contains alternative names in the subject lines, this is a feature with DNS to\nallow for multiple domains to be added to the certificate for SSL activities:\n\n\n-----\n\nmemail.mea.com.lb\nautodiscover.mea.com.lb\nowa.mea.com.lb\nwww.mea.com.lb\nautodiscover.mea.aero\nautodiscover.meacorp.com.lb\nmea.aero\nmeacorp.com.lb\nmemailfr.meacorp.com.lb\nmeoutlook.meacorp.com.lb\ntmec.mea.com.lb\n\nThese domains show a clear understanding of the victims' domains, leads us to believe the\nattacker was active in these environments to understand the specific domains and\ncertificates they would be required to produce.\n\n\n-----\n\nOur investigation discovered two events: the DNSpionage malware and a DNS redirection\ncampaign. In the case of the malware campaign, we don't know the exact target, but we do\nknow the attackers went after users in Lebanon and the UAE. However, as outlined above,\nwe were able to uncover the targets of the redirect campaign.\nWe are highly confident that both of these campaigns came from the same actor. However,\nwe do not know much about the location of the actors and their exact motivations. It is\nclear that this threat actor was able to redirect DNS from government-owned domains in\ntwo different countries over the course of two months, as well as a national Lebanese\nairline. They were able to work from the system's point of view by using a Windows\nmalware, as well as the network, by using DNS exfiltration and redirection. It is unclear if\nthese DNS redirection attacks were successful, but the attackers have kept up their efforts,\nlaunching five attacks so far this year, including one in the past two weeks.\n\nUsers should use these campaigns as proof that their endpoint protection as well as the\nnetwork protection need to be as strong as possible. This is an advanced actor who\nobviously has their sights set on some important targets, and they don't appear to be letting\nup any time soon.\n\n## Coverage\n\n[Snort rules 48444 and 48445 will prevent DNSpionage from making an outbound](https://snort.org/advisories/talos-rules-2018-11-27)\nconnection.\nAdditional ways our customers can detect and block this threat are listed below.\n\n[Advanced Malware Protection (AMP) is](https://www.cisco.com/c/en/us/products/security/advanced-malware-protection)\nideally suited to prevent the execution\nof the malware used by these threat\nactors.\n[Cisco Cloud Web Security ( CWS) orWeb](https://www.cisco.com/c/en/us/products/security/cloud-web-security/index.html)\nSecurity Appliance (WSA) web\nscanning prevents access to malicious\nwebsites and detects malware used in\nthese attacks.\n\n[Email Security can block malicious](https://www.cisco.com/c/en/us/products/security/email-security-appliance/index.html)\nemails sent by threat actors as part of\ntheir campaign.\n\nNetwork Security appliances such as [Next-Generation Firewall (NGFW](https://www.cisco.com/c/en/us/products/security/firewalls/index.html) ), Next-Generation\n[Intrusion Prevention System (NGIPS), and Meraki MX can detect malicious activity](https://meraki.cisco.com/products/appliances)\nassociated with this threat.\n\n[AMP Threat Grid helps identify malicious binaries and build protection into all Cisco](https://www.cisco.com/c/en/us/solutions/enterprise-networks/amp-threat-grid/index.html)\nS it d t\n\n\n-----\n\ndomains, IPs, and URLs, whether users are on or off the corporate network.\n\nOpen Source SNORTâ“‡ Subscriber Rule Set customers can stay up to date by downloading\n[the latest rule pack available for purchase on Snort.org.](https://www.snort.org/products)\n\n## Indicators of Compromise (IOCs)\n\nThe following IOCs are associated with various malware distribution campaigns that were\nobserved during the analysis of associated malicious activity.\n\n### Fake job websites:\n\nhr-wipro[.]com\nhr-suncor[.]com\n\n### Malicious documents:\n\n9ea577a4b3faaf04a3bddbfcb934c9752bed0d0fc579f2152751c5f6923f7e14 (LB submit)\n15fe5dbcd31be15f98aa9ba18755ee6264a26f5ea0877730b00ca0646d0f25fa (LB submit)\n\n### DNSpionage samples:\n\n2010f38ef300be4349e7bc287e720b1ecec678cacbf0ea0556bcf765f6e073ec\n82285b6743cc5e3545d8e67740a4d04c5aed138d9f31d7c16bd11188a2042969\n45a9edb24d4174592c69d9d37a534a518fbe2a88d3817fc0cc739e455883b8ff\n\n### C2 Server IPs:\n\n185.20.184.138\n185.20.187.8\n185.161.211.72\n\n### C2 Server Domains:\n\n0ffice36o[.]com\n\n### DNS Hijack Domains (pointed to 185.20.187.8):\n\n2018-11-14 : memail.mea.com.lb\n2018-11-06 : webmail.finance.gov.lb\n2018-09-24 : mail.apc.gov.ae\n\n\n-----\n\n### Domains in the MEA certificate (on 185.20.187.8):\n\nmemail.mea.com.lb\nautodiscover.mea.com.lb\nowa.mea.com.lb\nwww.mea.com.lb\nautodiscover.mea.aero\nautodiscover.meacorp.com.lb\nmea.aero\nmeacorp.com.lb\nmemailr.meacorp.com.lb\nmeoutlook.meacorp.com.lb\ntmec.mea.com.lb\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2018/2018.11.27.dnspionage-campaign-targets-middle-east/DNSpionage%20Campaign%20Targets%20Middle%20East.pdf"
    ],
    "report_names": [
        "DNSpionage Campaign Targets Middle East"
    ],
    "threat_actors": [
        {
            "id": "4632103e-8035-4a83-9ecb-c1e12e21288c",
            "created_at": "2022-10-25T16:07:23.542255Z",
            "updated_at": "2025-03-27T02:02:09.854487Z",
            "deleted_at": null,
            "main_name": "DNSpionage",
            "aliases": [],
            "source_name": "ETDA:DNSpionage",
            "tools": [
                "Agent Drable",
                "AgentDrable",
                "CACTUSPIPE",
                "DNSpionage",
                "DropperBackdoor",
                "Karkoff",
                "MailDropper",
                "OILYFACE"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "8d76e350-dfb5-4733-800d-876de41f690d",
            "created_at": "2023-01-06T13:46:38.841887Z",
            "updated_at": "2025-03-27T02:00:02.932838Z",
            "deleted_at": null,
            "main_name": "DNSpionage",
            "aliases": [
                "COBALT EDGEWATER"
            ],
            "source_name": "MISPGALAXY:DNSpionage",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3eebdb3f-f4e3-42e5-bb4d-f02a13328316",
            "created_at": "2024-05-01T02:03:08.014303Z",
            "updated_at": "2025-03-27T02:05:17.306592Z",
            "deleted_at": null,
            "main_name": "COBALT EDGEWATER",
            "aliases": [
                "Cold River ",
                "DNSpionage ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT EDGEWATER",
            "tools": [
                " DNSpionage",
                " Karkoff",
                " MailDropper",
                " SideTwist",
                " TWOTONE",
                "AgentDrable"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1543457983,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/5217218444c642545031eaaabe9a0dd0f8dc4644.pdf",
        "text": "https://archive.orkl.eu/5217218444c642545031eaaabe9a0dd0f8dc4644.txt",
        "img": "https://archive.orkl.eu/5217218444c642545031eaaabe9a0dd0f8dc4644.jpg"
    }
}