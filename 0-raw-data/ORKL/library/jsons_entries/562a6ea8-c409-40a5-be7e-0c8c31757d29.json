{
    "id": "562a6ea8-c409-40a5-be7e-0c8c31757d29",
    "created_at": "2023-01-12T15:09:48.253801Z",
    "updated_at": "2025-03-27T02:10:54.40429Z",
    "deleted_at": null,
    "sha1_hash": "7936a0b8f9980844d22aa9af592db4b49e2dadda",
    "title": "2021-12-12 - More Flagpro, More Problems",
    "authors": "",
    "file_creation_date": "2022-05-28T17:50:40Z",
    "file_modification_date": "2022-05-28T17:50:40Z",
    "file_size": 580362,
    "plain_text": "# More Flagpro, More Problems\n\n**[cyberandramen.net/2021/12/12/more-flagpro-more-problems/](https://cyberandramen.net/2021/12/12/more-flagpro-more-problems/)**\n\nDecember 12, 2021\n\nNo stranger to this blog, BlackTech has continued to modify techniques to compromise\nnetworks and even suffered an OPSEC slip in the way of an open directory.\n\nThis post will cover a malicious document similar to that identified by [1] PWC and [2] NTT in\nthe previous reporting on the group. While I cannot definitively answer that the malicious\nexecutable recovered in this case is Flagpro, I would like to highlight some of the similarities\nand differences found in this sample.\n\n## An Empty Excel Doc\n\nFigure 1\nSHA256:0911e5d1ec48430ff9a863f5c4a38f0c71872d8bd6c89f07d6ae16d78eca162f\n\nFilename: 2021-10工资中公积金问题咨询.xlsm (roughly translates to “Constitution on\nProvident Fund Issues in 2021-10 Salary”. Google Translate)\n\nWhile there isn’t much in the way of a lure to entice the user to open the document, the title\nand delivery method would likely pique a user’s interest. Upon enabling content, a Windows\nexecutable named dwm.exe is dropped into the Startup folder which ensures persistence\nand is executed.\n\nThe malicious macros embedded in the Excel document are almost an exact copy of the\ncode seen in the PWC report. Although the malicious executable is named dwm.exe, this\nisn’t the original name of the application as can be seen in Figure 2.\n\n\n-----\n\nFigure 2\n\n## What’s New\n\nThe Microsoft Foundation Class, or MFC is also heavily utilized in the dropped file. A number\nof the MFC libraries found running strings on this sample differed from previous reports on\nFlagpro.\n\nNote the absence of the “CV20” prefixes in Figure 3 on the MFC classes, as reported by NTT\nSecurity. Previous reporting theorized that the CV20 served as the version number for\nFlagpro. This minor development change could have been in response to public reporting, or\nto different development practices.\n\n\n-----\n\nFigure 3\n\nIn PWC’s VB 2021 localhost presentation, the mutex identified for Flagpro malware began\nwith “71564__”. Mutexes associated with this sample are below.\n\nZonesCacheCounterMutex\nZonesLockedCacheCounterMutex.\n\nFigure 4\nWhile this is certainly not a smoking gun, these are somewhat interesting development\nchanges to the malware.\n\nOpening the executable in Ghidra, the command and control (C2) domain is broken up over\nthree different variables, initialized in reverse order.\n\nAdditionally, the HTTP request headers and User-Agent were similarly hardcoded and\npieced back together before making a request.\n\n\n-----\n\nFigure 5\n\nFigure 6\nUtilizing MFC classes allows threat actors to wrap Windows APIs routinely linked to malware\ninside the MFC library. A majority of the suspicious code can be found in the DoModal\nfunction, which houses a number of calls linked to taking screenshots of the victim’s\ncomputer.\n\n\n-----\n\nFigure 7\n\n## Network Indicators\n\nAs identified in Figure 6, dwm.exe contacted the following domain:\n\ncentos.onthewifi[.]com\nRegistrar: TLDS L.L.C. d/b/a SRSPlus\nResolving IP: 103.195.150[.]181\nLocation: Hong Kong\nOrganization: Cloudie Limited\n\nIf you have read prior reporting on BlackTech intrusion operations, the above domain naming\nscheme should come as no surprise. Like other threat actors, BlackTech tends to use\nsoftware and security companies for their C2 domain naming. The threat actor has used\nsome form of “centos” as a C2 domain on at least four different occasions.\n\nAccording to PassiveDNS (pDNS) information, centos.onthewifi[.]com previously resolved to\n172.104.109[.]217. Utilizing ZoomEye to investigate the previous IP, the same “Hello Boy” C2\nresponse NTT-Security reported on is displayed. An additional response of “1” was also\nfound at the same IP on port 80/https.\n\n\n-----\n\nFigure 8\n\nFigure 9\nAn additional domain possibly linked to the above is redhatstate.hopto[.]org which is also\nhosted at 103.195.150[.]181.\n\nA special thanks to Twitter user, @500mk500 for noticing the above domain that matches\nprevious BlackTech domain naming.\n\n## Conclusion\n\nThe above are not definitive links to BlackTech, however, I believe the similarities are strong\nenough to warrant attention and maybe a closer look by analysts. Changes in domain\nhosting should also be of interest to APT network infrastructure hunters, as this could be a\nchange in technique or simply a new team has taken over procurement of network\ninfrastructure. In any case, BlackTech remains an aggressive actor intent on cyber\nespionage in the APAC region.\n\n## Endnotes\n\n[1] [https://vblocalhost.com/uploads/VB2021-50.pdf](https://vblocalhost.com/uploads/VB2021-50.pdf)\n\n[2] [https://insight-jp.nttsecurity.com/post/102h7vx/blacktechflagpro (Japanese)](https://insight-jp.nttsecurity.com/post/102h7vx/blacktechflagpro)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-12 - More Flagpro, More Problems.pdf"
    ],
    "report_names": [
        "2021-12-12 - More Flagpro, More Problems.pdf"
    ],
    "threat_actors": [
        {
            "id": "2646f776-792a-4498-967b-ec0d3498fdf1",
            "created_at": "2022-10-25T15:50:23.475784Z",
            "updated_at": "2025-03-27T02:00:55.479958Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "BlackTech",
                "Palmerworm"
            ],
            "source_name": "MITRE:BlackTech",
            "tools": [
                "Kivars",
                "PsExec",
                "TSCookie",
                "Flagpro",
                "Waterbear"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d3a7123c-f519-49a0-a234-de24a1ef052a",
            "created_at": "2022-10-25T16:47:55.545211Z",
            "updated_at": "2025-03-27T02:05:17.254744Z",
            "deleted_at": null,
            "main_name": "BRONZE CANAL",
            "aliases": [
                "CTG-6177 ",
                "Circuit Panda ",
                "Palmerworm ",
                "Shrouded Crossbow ",
                "BlackTech"
            ],
            "source_name": "Secureworks:BRONZE CANAL",
            "tools": [
                " DRIGO",
                " Flagpro",
                " Gh0stTimes",
                " PLEAD",
                " Spiderpig",
                " Waterbear",
                "Bifrose"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75024aad-424b-449a-b286-352fe9226bcb",
            "created_at": "2023-01-06T13:46:38.962724Z",
            "updated_at": "2025-03-27T02:00:02.964002Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "CIRCUIT PANDA",
                "Temp.Overboard",
                "G0098",
                "Red Djinn",
                "HUAPI",
                "Palmerworm",
                "T-APT-03",
                "Manga Taurus",
                "Earth Hundun"
            ],
            "source_name": "MISPGALAXY:BlackTech",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "efa7c047-b61c-4598-96d5-e00d01dec96b",
            "created_at": "2022-10-25T16:07:23.404442Z",
            "updated_at": "2025-03-27T02:02:09.781478Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "BlackTech",
                "Circuit Panda",
                "Earth Hundun",
                "Manga Taurus",
                "Operation PLEAD",
                "Operation Shrouded Crossbow",
                "Operation Waterbear",
                "Palmerworm",
                "Radio Panda",
                "Red Djinn",
                "T-APT-03",
                "TEMP.Overboard"
            ],
            "source_name": "ETDA:BlackTech",
            "tools": [
                "BIFROST",
                "BUSYICE",
                "BendyBear",
                "Bluether",
                "CAPGELD",
                "DRIGO",
                "Deuterbear",
                "Flagpro",
                "GOODTIMES",
                "Gh0stTimes",
                "IconDown",
                "KIVARS",
                "LOLBAS",
                "LOLBins",
                "Linopid",
                "Living off the Land",
                "TSCookie",
                "Waterbear",
                "XBOW",
                "elf.bifrose"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536188,
    "ts_updated_at": 1743041454,
    "ts_creation_date": 1653760240,
    "ts_modification_date": 1653760240,
    "files": {
        "pdf": "https://archive.orkl.eu/7936a0b8f9980844d22aa9af592db4b49e2dadda.pdf",
        "text": "https://archive.orkl.eu/7936a0b8f9980844d22aa9af592db4b49e2dadda.txt",
        "img": "https://archive.orkl.eu/7936a0b8f9980844d22aa9af592db4b49e2dadda.jpg"
    }
}