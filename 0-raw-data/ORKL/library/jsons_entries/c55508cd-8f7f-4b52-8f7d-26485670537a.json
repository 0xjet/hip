{
    "id": "c55508cd-8f7f-4b52-8f7d-26485670537a",
    "created_at": "2022-10-25T16:48:22.229425Z",
    "updated_at": "2025-03-27T02:17:11.645691Z",
    "deleted_at": null,
    "sha1_hash": "d6c8819c55c41b32b1d1d75fff4346407609acf2",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-11-13T04:07:10Z",
    "file_modification_date": "2020-11-13T04:07:10Z",
    "file_size": 2636506,
    "plain_text": "# The CostaRicto Campaign: Cyber-Espionage Outsourced\n\n**[blogs.blackberry.com/en/2020/11/the-costaricto-campaign-cyber-espionage-outsourced](https://blogs.blackberry.com/en/2020/11/the-costaricto-campaign-cyber-espionage-outsourced)**\n\n[RESEARCH & INTELLIGENCE / 11.12.20 / The BlackBerry Research and Intelligence Team](https://blogs.blackberry.com/en/category/research-and-intelligence)\n\n_With the undeniable success of Ransomware-as-a-Service (RaaS), the cybercriminal market has_\n_expanded its portfolio to add dedicated phishing and espionage campaigns to the list of illicit services_\n_on offer…_\n\n[During the past six months, the BlackBerry Research and Intelligence team have been monitoring a](https://blogs.blackberry.com/en/author/the-blackberry-research-and-intelligence-team)\ncyber-espionage campaign that is targeting disparate victims around the globe. The campaign, dubbed\nCostaRicto by BlackBerry, appears to be operated by “hackers-for-hire”, a group of APT mercenaries who\npossess bespoke malware tooling and complex VPN proxy and SSH tunnelling capabilities.\n\nMercenary groups offering APT-style attacks are becoming more and more popular. Their tactics,\ntechniques, and procedures (TTPs) often resemble highly sophisticated state-sponsored campaigns, but\nthe profiles and geography of their victims are far too diverse to be aligned with a single bad actor’s\ninterests.\n\nAlthough in theory the customers of a mercenary APT might include anyone who can afford it, the more\nsophisticated actors will naturally choose to work with patrons of the highest profile – be it large\norganizations, influential individuals, or even governments. Having a lot at stake, the cybercriminals\nmust choose very carefully when selecting their commissions to avoid the risk of being exposed.\n\n\n-----\n\nOutsourcing an espionage campaign, or part of it, to a mercenary group might be very compelling,\nespecially to businesses and individuals who seek intelligence on their competition yet may not have the\nrequired tooling, infrastructure and experience to conduct an attack themselves. But even notorious\nadversaries experienced in cyber-espionage can benefit from adding a layer of indirection to their\nattacks. By using a mercenary as their proxy, the real attacker can better protect their identity and thwart\nattempts at attribution.\n\n**Key Findings:**\n\nCostaRicto targets are scattered across different countries in Europe, Americas, Asia, Australia and\nAfrica, but the biggest concentration appears to be in South Asia (especially India, Bangladesh and\nSingapore), suggesting that the threat actor could be based in that region, but working on a wide\nrange of commissions from diverse clients.\n\nThe command-and-control (C2) servers are managed via Tor and/or through a layer of proxies; a\ncomplex network of SSH tunnels are also established in the victim’s environment. These practices\nreveal better-than-average operation security.\n\nThe backdoor used as a foothold is a new strain of never-before-seen malware – a custom-built tool\nwith a suggestive project name, well-structured code, and detailed versioning system. The earliest\ntimestamps are from October 2019, and based on the version numbers, the project appears to be in\nthe debug testing phase. It’s not clear as of now if it’s something that the threat actors developed\nin-house or obtained for exclusive use as part of beta testing from another entity.\n\nThe timestamps of payload stagers go back to 2017, which might suggest the operation itself has\nbeen going on for a while, but used to deliver a different payload. It’s not impossible, though, that\nthe stagers are simply being reused without recompilation (i.e.: by changing the C2 URLs via\nbinary editing).\n\n[The backdoor project is called Sombra, which is a reference to an Overwatch game persona – an](https://overwatch.fandom.com/wiki/Sombra)\nagent of the antagonist organization, who specializes in espionage and intelligence assessment and\nis characterized by stealth, infiltration and hacking skills.\n\nSome of the domain names hardcoded in the backdoor binaries seem to spoof legitimate domains\n(e.g.: the malicious domain sbibd[.]net spoofing a legitimate domain of the State Bank of India\nBangladesh, sbibd.com). However, victims affected by these backdoors are unrelated, suggesting\nreuse of existing infrastructure which served another purpose.\n\n\n-----\n\nOne of the IP addresses which the backdoor domains were registered to overlaps with an earlier\n[phishing campaign attributed to APT28 (i.e.: according to RiskIQ data, the SombRAT domain](https://blogs.blackberry.com/en/2019/08/inside-the-apt28-dll-backdoor-blitz)\nakams[.]in was at the time of attack registered to the same IP address as the phishing domain\nmail.kub-gas[.]com). However, BlackBerry researchers believe that a direct link between\nCostaRicto and APT28 is highly unlikely. It might be that the IP overlap is coincidental, or – just as\nplausible – that the earlier phishing campaigns have been outsourced to the mercenary on behalf\nof the actual threat actor.\n\n**Targeting**\n\nUnlike most of the state-sponsored APT actors, the CostaRicto adversary seems to be indiscriminate\nwhen it comes to the victims' geography. Their targets are located in numerous countries across the\nglobe with just a slight concentration in the South-Asian region:\n\nIndia\nBangladesh\nSingapore\nChina\nU.S.\nBahamas\nAustralia\nMozambique\nFrance\nNetherlands\nAustria\nPortugal\nCzechia\n\nThe victims’ profiles are diverse across several verticals, with a large portion being financial institutions.\n\n**Delivery**\n\nAfter gaining access to the victim’s environment (presumably by using stolen credentials, either obtained\nvia phishing, or bought on the dark web), the attacker sets up remote tunnelling using a SSH tool. The\ntool is configured to redirect traffic from a malicious domain to a proxy that is listening on a local port.\nThe tunnel is authenticated using the attacker’s private key.\n\nIn order to pull down the backdoor, a payload stager, either HTTP or reverse-DNS, is executed with the\nuse of a scheduled task.\n\nThe backdoor comes either wrapped up in a PowerSploit reflective loader, or in the form of a custombuilt dropper that uses a simple virtual machine (VM) mechanism to decode and inject the payload.\n\n**Toolset**\n\nSombRAT: A custom backdoor (with both x86 and x64 versions)\nCostaBricks: A custom VM-based payload loader (seen only with x86 SombRAT payloads so far)\n[PowerSploit’s reflective PE injection module (seen with x64 SombRAT payloads)](https://powersploit.readthedocs.io/en/latest/CodeExecution/Invoke-ReflectivePEInjection/)\nHTTP and reverse DNS payload stagers\n\n\n-----\n\nnmap: Port scanner\nPsExec\n\n**PS1 Loader (x64)**\n\nThe 64-bit backdoor is deployed in a fairly standard way. It is distributed as a set of scripts and\nencrypted files and utilizes a PowerShell loader based on the Invoke-ReflectivePEInjection PowerSploit\nmodule to decode and inject the final payload DLL into memory:\n\n**File Name** **Function**\n\n**autorun.-** Obfuscated batch script that sets PowerShell execution policy to unrestricted and exe**bat** cutes autorun.ps1\n\n**au-** Obfuscated PowerShell script that decodes and executes another PowerShell loader\n**torun.ps1** stored in ntuser.c file\n\n**ntuser.a** XOR key used to decode the PowerShell loader and payload binary\n\n**ntuser.b** XOR encoded payload binary\n\n**ntuser.c** XOR encoded Invoke-ReflectivePEInjection module, modified to add payload decryption\nroutine\n\n**CostaBricks Loader (x86)**\n\nThe loader used with 32-bit backdoors is more technically compelling. It implements a simple custombuilt virtual machine mechanism that will execute an embedded bytecode to decode and inject the\npayload into memory.\n\nThis attempt at obfuscation, although not new, is rather uncommon in relation to targeted attacks. Code\nvirtualization has been most prevalent in commercial software protectors which use much more\nadvanced solutions; simpler virtual machines are sometimes also featured in off-the-shelf malicious\npackers used by widespread financial crimeware. This particular implementation, however, is unique\n(there are just a handful of samples in the public domain) and seems to be used only with SombRAT\npayloads – which makes us believe it is a custom-built tool that is private to the attackers.\n\nTo further confuse anti-malware solutions, the loader contains the entire unobfuscated code of a\n[legitimate open source application called Blink (https://github.com/crosire/blink), which never gets](https://github.com/crosire/blink)\nexecuted:\n\n|File Name|Function|\n|---|---|\n|autorun.- bat|Obfuscated batch script that sets PowerShell execution policy to unrestricted and exe- cutes autorun.ps1|\n|au- torun.ps1|Obfuscated PowerShell script that decodes and executes another PowerShell loader stored in ntuser.c file|\n|ntuser.a|XOR key used to decode the PowerShell loader and payload binary|\n|ntuser.b|XOR encoded payload binary|\n|ntuser.c|XOR encoded Invoke-ReflectivePEInjection module, modified to add payload decryption routine|\n\n\n-----\n\n_Figure 1: Strings belonging to Blink code_\n\nThere is also an unused zlib decompression routine that seems to be leftover code from an older version\nof the loader.\n\nThe compilation timestamps suggest that both the loader and the embedded payload are compiled at the\nsame time (with only a few seconds difference).\n\nOne of the loaders had the following PDB path, suggesting that the internal name of the project is\nCostaRicto/ CostaBricks:\n\n_Figure 2: PDB path from one of the x86 loader samples_\n\n**Virtual Machine Internals**\n\nThe virtual machine mechanism is implemented with the usage of C++ objects and classes. There are 20\ndifferent VM instructions, each having between zero and three operands. A pointer to the bytecode to\nexecute is passed as a parameter to the VM initialization routine:\n\n\n-----\n\n_Figure 3: Initialization of the virtual machine_\n\nA VM instance is initialized by setting its context structure, which contains the instruction pointer, zero\nflag, instructions list and pointer to the registers:\n\n**Offset** **Field** **Description**\n\n**0x00** Instruction pointer Index of the bytecode instruction to execute\n\n**0x04** Zero flag Used for conditional jumps\n\n**0x08** Instructions_list.first Points to the first instruction in the list\n\n**0x0C** Instructions_list.current Points to the current instruction in the list\n\n**0x10** Instructions_list.next Points to the next instruction in the list\n\n**0x14** Registers pointer Points to the list of registers\n\n**0x18** Registers count Incremented when new register is allocated\n\n**_Instructions and Operands_**\n\n|Offset|Field|Description|\n|---|---|---|\n|0x00|Instruction pointer|Index of the bytecode instruction to execute|\n|0x04|Zero flag|Used for conditional jumps|\n|0x08|Instructions_list.first|Points to the first instruction in the list|\n|0x0C|Instructions_list.current|Points to the current instruction in the list|\n|0x10|Instructions_list.next|Points to the next instruction in the list|\n|0x14|Registers pointer|Points to the list of registers|\n|0x18|Registers count|Incremented when new register is allocated|\n\n\n-----\n\nInstructions, operands, and opcode handlers are implemented as doubly linked lists. Each VM\ninstruction has its own index and contains information such as the opcode number, flags, operands\ncount, and the operands:\n\n_Figure 4: An example of VM instruction format for the SUB opcode_\n\nThe operands can either be immediate values or \"registers\". Dynamically allocated “registers” are small\nmemory regions organized in the form of dictionary objects in doubly linked list. Each register has its\nown unique index that can store up to 8 bytes of data (including pointers to larger memory buffers) and\ncan be either read or written to.\n\nIf the operand metadata specifies the index value, the operand is a \"register\"; otherwise the operand\ncontains an immediate value. The value (either immediate or pointed to by a \"register\") is an integer:\nqword by default, but different lengths (byte, word or double-word) can be specified in the metadata:\n\n**Offset** **Field** **Notes**\n\n**0x00** Instruction index Consecutive numbers starting with 0\n\n**0x04** Opcode 0 – 0x13 (19.)\n\n**0x06** Skip bool If set, then the instruction will be ignored\n\n**0x08** Operands count 0 – 3\n\n**0x0C** Operand type read (0) or write (1)\n\n**0x0E** Operand flag Specifies length: 0x10 = byte, 0x20 = word, 0x40 = dword\n\n**0x10** Operand register index Consecutive numbers starting with 0x9435C739\n\n**0x14** Operand value Immediate value (if operand is not a register)\n\n**0x1C** Operand 2 Optional\n\n**0x2C** Operand 3 Optional\n\n**_Opcodes_**\n\n|Offset|Field|Notes|\n|---|---|---|\n|0x00|Instruction index|Consecutive numbers starting with 0|\n|0x04|Opcode|0 – 0x13 (19.)|\n|0x06|Skip bool|If set, then the instruction will be ignored|\n|0x08|Operands count|0 – 3|\n|0x0C|Operand type|read (0) or write (1)|\n|0x0E|Operand flag|Specifies length: 0x10 = byte, 0x20 = word, 0x40 = dword|\n|0x10|Operand register index|Consecutive numbers starting with 0x9435C739|\n|0x14|Operand value|Immediate value (if operand is not a register)|\n|0x1C|Operand 2|Optional|\n|0x2C|Operand 3|Optional|\n\n\n-----\n\nEach opcode has its own handler routine, which is executed in the main VM loop:\n\n_Figure 5: Loop processing VM instructions_\n\nThe handler routine will check to see if the number and types of operands are valid, read operand values\nfrom VM “registers”, perform a specific action (arithmetic/byte operation, comparison, jump, API call),\nand save results to a destination “register”:\n\n\n-----\n\n_Figure 6: XOR opcode handler routine_\n\n|Op- code (hex)|Operands|Instruction|Description|\n|---|---|---|---|\n|0x00|dst, src|mov|Move from src (either immediate value or pointer/register) to register at dst. If no operands, this acts as a NOP in- struction, used mostly as a label to jump to|\n|0x01|dst, src|xor|Exclusive or dst with src, result pointed by dst|\n|0x02|dst, src|add|Add src to dst, result pointed by dst|\n|0x03|dst, src|and|And dst with src, result pointed by dst|\n|0x04|dst, src|sub|Subtract src from dst, result pointed by dst|\n|0x05|addr|call|Call address in operand 1 (can be immediate value or register)|\n\n\n-----\n\n|0x06|-|ret|Return 1|\n|---|---|---|---|\n|0x07|mem_ptr, size|virtual_alloc|Allocate memory (call VirtualAlloc), size in operand 2, pointer returned in operand 1 (register)|\n|0x08|mem_ptr|virtual_free|Free memory (VirtualFree), pointer in operand 1 (register)|\n|0x09|dst, src, size|memmove|Source pointed by operand 2, destination pointed by op- erand 1, size in operand 3|\n|0x0A|dst, src|cmp|Compare value at dst (register) with src (immediate or reg- ister value), set zero flag in VM context structure|\n|0x0B|dst, src|alldiv|Dividend in operand 1 register, divisor in operand 2 (imme- diate or register), result in operand 1 register|\n|0x0C|dst|jnz|If zero flag not set, jump to location specified by operand|\n|0x0D|dst|jz|If zero flag set, jump to location specified by operand|\n|0x0E|dst|jmp|Unconditional jump; set instruction pointer to the value of operand|\n|0x0F|dll_handle, dll_name|load_library|Call LoadLibraryA, pointer to library name in operand 2 (register), handle to loaded library in operand 1 (register)|\n|0x10|dll_handle, proc_name, api_address|get_proc_addr|Call GetProcAddress, pointer to DLL handle in operand 1, pointer to process name in operand 2, API address re- turned in operand 3 (all operands are registers)|\n|0x11|-|exit_proc|Call ExitProcess(0)|\n|0x12|dst, src|shr|Shift right (divide dst by src)|\n|0x13|dst, src|shl|Shift left (multiply dst by src)|\n\n\n**The Bytecode**\n\nAll of the x86 loaders BlackBerry has seen thus far embed the exact same bytecode that is 1800 (0x708)\nlines long. Most of these 1800 instructions are superfluous (i.e.: have no influence on the code\nfunctionality) and were inserted there for obfuscation only.\n\n\n-----\n\nThe purpose of the bytecode is to decrypt the embedded payload, load it into memory reflectively and\nexecute it:\n\n_Figure 7: A fragment of VM bytecode - setting the decryption key_\n\nThe payload decryption routine uses a custom symmetric algorithm based on arithmetic and byte-shift\ninstructions – a combination of SHL/SHR/SUB/ADD/XOR – with hardcoded keys.\n\nThese constant values are used in all x86 SombRAT droppers we’ve seen so far:\n\n\n-----\n\n_Figure 8: Payload decoding algorithm_\n\n**SombRAT Backdoor**\n\nThe backdoor delivered by the above-mentioned loaders is a C++ compiled executable developed with\nheavy usage of objects, classes, and interfaces. It has a plugin architecture and basic functionality of a\nfoothold RAT that is mainly used to download and execute other malicious payloads – either as its own\nplugins or standalone binaries. It can also perform other simple actions, like collecting system\ninformation, listing and killing processes, and uploading files to the C2.\n\n**Features:**\n\nCommunication over DNS tunnel with a hardcoded domain name and DGA-generated subdomain\nC2 traffic encrypted with RSA-2048\nCustom AES-encrypted storage format used to store configuration, plugins, and harvested data\n\nUnique version number for each sample\n\n\n-----\n\n_Figure 9: Backdoor classes hierarchy_\n\nAccording to a PDB path found in the 64-bit specimens, the project was originally called Sombra –\n[possibly in reference to the Overwatch game character:](https://overwatch.fandom.com/wiki/Sombra)\n\n\n-----\n\n_Figure 10: PDB path from 64-bit backdoor with project name ‘Sombra’_\n\nIn the Overwatch game world, Sombra is an agent of an antagonist organization called Talon. She is\nskilled in computer hacking and cryptography and specializes in espionage and intelligence assessment:\n\n_“One of the world's most notorious hackers, Sombra uses information to manipulate those in power._\n\n_Sombra's skills include computer hacking and cryptography; these are activities she greatly enjoys, to_\n_the point where the desire to get past locks and solving mysteries is ingrained in her personality. She is_\n_a known associate of Reaper, specializing in espionage and intelligence assessment._\n\n_Stealth and debilitating attacks make Sombra a powerful infiltrator. Her hacking can disrupt her_\n_enemies, ensuring they're easier to take out, while her EMP provides the upper hand against multiple_\n_foes at once. Sombra’s ability to Translocate and camouflage herself makes her a hard target to pin_\n_down.”1_\n\nEmbedded in each sample is a hardcoded version number, with the following versions observed thus far:\n\n**Version** **Compilation timestamp** **Architecture**\n\n**0.0.1.114499** 31-10-2019 21:22:39 UTC x86\n\n**0.0.1.14630 (T)** 09-11-2019 21:53:44 UTC x86\n\n**0.1.60 (DT)** 11-11-2019 14:55:45 UTC x86\n\n**0.1.208 (DT)** 17-11-2019 20:58:25 UTC x86\n\n**0.1.724 (DT)** 24-12-2019 10:33:41 UTC x64\n\n**0.2.404 (DT)** 20-08-2020 01:36:50 UTC x64\n\nOne of the backdoor samples (0.1.60 (DT)) was found to be hosted on\nhttp[://]159.65.31[.]84/svolcdst.exe.\n\n**Behaviour**\n\n|Version|Compilation timestamp|Architecture|\n|---|---|---|\n|0.0.1.114499|31-10-2019 21:22:39 UTC|x86|\n|0.0.1.14630 (T)|09-11-2019 21:53:44 UTC|x86|\n|0.1.60 (DT)|11-11-2019 14:55:45 UTC|x86|\n|0.1.208 (DT)|17-11-2019 20:58:25 UTC|x86|\n|0.1.724 (DT)|24-12-2019 10:33:41 UTC|x64|\n|0.2.404 (DT)|20-08-2020 01:36:50 UTC|x64|\n\n\n-----\n\nBefore entering the command processing loop, the backdoor will check to see if it’s running as a service,\nand will create a run-once mutex consisting of %HOSTNAME% with a postfix of “S”, “U”, or “SU”,\ndepending on which privileges it was executed with.\n\nThe C2 domain name for the DNS communication is hardcoded and obfuscated using XOR. The\nbackdoor will generate a subdomain using a custom domain generation algorithm (DGA) and try to send\nan initial beacon to the C2 via DNS tunneling:\n\n_Figure 11: Decoding the C2 domain name_\n\nThe configuration, along with downloaded plugins and all harvested data are stored in a custom\ndatabase format inside a single file under the %TEMP% directory. The file name is hardcoded and\nobfuscated with XOR. The storage file is encrypted with AES-256 using a hardcoded key and is\ndecrypted each time the malware needs to read or write it and re-encrypted after new data is added:\n\n_Figure 12. Hardcoded AES key for storage encryption_\n\nStrings used as backdoor commands and in debugging messages sent to the C2 are encoded with a\nsimple alphabet substitution. These are not decrypted by the backdoor on the victim’s side, and the key\nfor decryption is not present in the binary. Most probably the backdoor client decrypts them locally:\n\n\n-----\n\n_Figure 13: Substitution-encoded strings_\n\n**Command and Control (C2)**\n\nThe C2 communication can either be performed via DNS tunnelling or TCP sockets. Traffic is SSLencrypted and can bypass HTTP/SOCKS5 proxies. The C2 domain name is hardcoded in the binary and\nobfuscated with a single-byte XOR key which differs between samples. In order to establish\ncommunication, the malware first uses a DGA (Domain Generation Algorithm) to generate the\nsubdomain to connect to. Depending on an internal boolean setting, one of the following URL formats is\nused:\n\nimages%x.%s\nimages%x.elmako.%s\n\nwhere %s is the hardcoded domain name and %x contains 8 hexadecimal characters generated based on\nthe result of the GetTickCount API:\n\nIf the connection is unsuccessful, the backdoor will try to generate and connect to several other URLs in\nthe same domain, using the same algorithm but without the “images” prefix.\n\nIt seems that in most cases, the malware sends out data using DNS_TYPE_TEXT requests, while the\nattackers issue commands separately over the TCP channel with the IP address associated with the DGAgenerated subdomain.\n\nAll the communication is compressed with zlib and encrypted with AES. Additionally, an embedded RSA\npublic key is used to secure the AES key exchange:\n\n_Figure 14: RSA key used for C2 traffic encryption_\n\n**Backdoor Commands**\n\n\n-----\n\nBoth the x86 and x64 versions of the backdoor feature approximately 50 different commands organized\ninto six groups, each group served by a different interface:\n\nCore\nTaskman\nConfig\nStorage\nDebug\nNetwork\n\n**Command** **Type** **Description**\n\n**networkdiscon-** Core Broadcast “networkdisconnected” message\n**nected**\n**broadcast**\n\n**informationac-** Core Save provided session ID to memory struct, broadcast “informationac**cepted** cepted” message\n**broadcast**\n\n**networkcon-** Core Broadcast session ID and system info\n**nected**\n**broadcast**\n\n**ping** Core Send a \"ping\" to the C2 server\n\n**loadasdll** Core Load additional DLL into memory\n\n**loadfromstor-** Core Inject DLL into memory (from storage)\n**age**\n\n**loadfromfile** Core Inject DLL into memory (from disk)\n\n**loadfrommem** Core Inject DLL into memory (from memory)\n\n**loadplugincom-** Core Execute a plugin that is already loaded\n**plete**\n\n**initializeand-** Core Load and execute a plugin; plugins are stored as zlib-compressed\n**loadpluginby-** and AES encrypted PE files inside the storage and referred to by\n**uniqid** unique identifier\n\n**getinfo** Core Obtain environment strings, computer name, username, OS version\ninformation, system time, etc.\n\n|Command|Type|Description|\n|---|---|---|\n|networkdiscon- nected broadcast|Core|Broadcast “networkdisconnected” message|\n|informationac- cepted broadcast|Core|Save provided session ID to memory struct, broadcast “informationac- cepted” message|\n|networkcon- nected broadcast|Core|Broadcast session ID and system info|\n|ping|Core|Send a \"ping\" to the C2 server|\n|loadasdll|Core|Load additional DLL into memory|\n|loadfromstor- age|Core|Inject DLL into memory (from storage)|\n|loadfromfile|Core|Inject DLL into memory (from disk)|\n|loadfrommem|Core|Inject DLL into memory (from memory)|\n|loadplugincom- plete|Core|Execute a plugin that is already loaded|\n|initializeand- loadpluginby- uniqid|Core|Load and execute a plugin; plugins are stored as zlib-compressed and AES encrypted PE files inside the storage and referred to by unique identifier|\n\n\n-----\n\n|restart|Core|Respawn using ShellExecuteW|\n|---|---|---|\n|shutdown|Core|Exit process|\n|uninstall|Core|(unimplemented)|\n|updatemyself|Core|Create backup of itself (with .old extension) and spawn new instance via CreateProcessW|\n|pluginunload|Core|Unload and remove plugin from storage|\n|getprocesslist|Taskman|Obtain a list of running processes|\n|killprocess- bypid|Taskman|Terminate a process by PID|\n|killprocessby- name|Taskman|Terminate a process by name|\n|get|Config|Read specified values from .config file in storage and send to the C2|\n|set|Config|Set specific config fields and save to .config file in storage|\n|del|Config|Delete specified config fields from .config file in storage|\n|initdefaults|Config|Initialize config fields with default values and save to .config file in storage|\n|clear|Config|Zero-out config fields and save to .config file in storage|\n|save|Config|Save provided config values to .config file in storage|\n|enum|Config|Read values from .config file in storage to memory|\n|write|Storage|Encrypt and write data to storage file|\n|create|Storage|Create new encrypted storage file|\n|close|Storage|Encrypt and flush data to storage file|\n\n\n-----\n\n|drop|Storage|Write supplied file content to storage file|\n|---|---|---|\n|delete|Storage|Delete file with specified ID from storage; enumerate files in storage|\n|enum|Storage|Enumerate files in storage (name, written, size)|\n|upload|Storage|Decrypt and upload file with specified ID from storage file|\n|clearall|Storage|Remove all files from storage|\n|archivebypath|Storage|Read file(s) from specified path and save to storage file, then enumer- ate storage|\n|restorestorage|Storage|Delete storage file and open a new storage|\n|cancel1 /closeand- deletestorage|Storage|Remove all files from storage and delete storage temp file|\n|closestorage|Storage|Close storage temp file|\n|openstorage|Storage|Open storage temp file|\n|getcontent|Storage|(unimplemented)|\n|awaitcreate|Storage|Create new encrypted storage file|\n|await&putcon- tent|Storage|Read from C2 and save to the storage file|\n|await&getcon- tent|Storage|Read from content from storage and send via C2|\n|debuglog|Debug|Enable debug logging|\n|broadcast|Network|Set networkconnected or networkdisconnected bool in memory|\n|touchconnect|Network|Send the networkconnected bool setting to the C2|\n\n\n**stats** Network Send details of sent/received bytes\n\n\n-----\n\n|reconnect|Network|Close socket and reconnect|\n|---|---|---|\n|disconnect|Network|Close socket|\n|switchtotcp|Network|Switch C2 communication to TCP/IP|\n|switchdns|Network|Switch C2 communication to DNS|\n|setproxy2|Network|Set proxy type, host, port, domain, user, password|\n|checkproxy2|Network|(unimplemented)|\n|getproxy3|Network|Send current proxy configuration to C2|\n|resetproxy3|Network|(unimplemented)|\n\n\n_1 – before v0.1.60t_\n_2 – since at least v0.1.208_\n_3 – since at least v0.1.724_\n\n**Network**\n\n**_Infosportals[.]com_**\n\nFirst active during October 2019, infosportals[.]com was utilized by early SombRATs as the primary C2\ndomain. Since then, the domain shifted IP address multiple times, was then taken offline between\nFebruary and May, before being reactivated briefly between late May and mid-June as part of another\noffensive:\n\n_Figure 15: Timeline of IP resolutions for infosportals[.]com_\n\n\n-----\n\n_Figure 16: Table of IP resolutions for infosportals[.]com_\n\n**_Sbibd[.]net_**\n\nA phishing domain mimicking the legitimate sbibd.com (registered to the State Bank of India,\nBangladesh), sbibd[.]net was first active for a short spell from early November to December 2019, then\nreactivated again between February and March 2020 and was used as the primary C2 with several\nSombRAT variants:\n\n_Figure 17: Timeline of IP resolutions for sbibd[.]net_\n\n_Figure 18: Table of IP resolutions for sbibd[.]net_\n\n**_Akams[.]in_**\n\nFirst active for a few weeks from late December 2019 to mid-January 2020, akams[.]in was also used by\nmultiple SombRAT samples for C2 communications. One of the prior resolutions, for IP 45.89.175.206,\nis particularly interesting, as it overlaps with another domain called mail[.]kub-gas[.]com, which was\n\n\n-----\n\nimplicated as being associated with an APT-28/Fancy Bear/Sofacy phishing campaigns in a report by\nArea 1 Security. However, after much scrutiny, it would appear highly likely that there is no direct\nconnection between the SombRAT campaign and APT-28 activity.\n\n_Figure 19: Timeline of IP resolutions for akams[.]in_\n\n_Figure 20: Table of IP resolutions for akams[.]in_\n\n**_newspointview[.]com_**\n\nRegistered and active during late June 2020, newspointview[.]com has been used with more recent\nSombRAT variants as the primary C2 domain:\n\n_Figure 21: Timeline of IP resolutions for newspointview[.]com_\n\n_Figure 22: Table of IP resolutions for newspointview[.]com_\n\n\n-----\n\n**Timeline**\n\nThe following timeline shows key domain/IP resolutions and known SombRAT releases:\n\n\n-----\n\n-----\n\n_Figure 23: Timeline of IP resolutions and SombRAT versions_\n\n**Conclusions**\n\nThere are several factors that lead us to the assumption that the threat actor behind CostaRicto is a\nmercenary group:\n\nThe toolset used in CostaRicto campaign consists of bespoke malware that appeared around\nOctober 2019 and has been rarely seen in the wild since. It therefore appears to be private to this\nparticular adversary.\n\nMoreover, the constant development, detailed versioning system and well-structured code that\nallows for easy functionality expansion – all suggest that the toolset is part of a long-term project,\nrather than a one-off campaign.\n\nThe apparent sharing of network infrastructure with a previous, seemingly unrelated phishing\ncampaign attributed to APT28, as well as the reuse of phishing domain names as C2 servers in\nattacks against unrelated victims, indicates that the same entity is likely behind a diverse range of\nattacks.\n\nFinally, the diversity and geography of the victims doesn’t fit a picture of a campaign sponsored by\na particular state; rather, it’s a mix of targets that could be explained by different assignments\ncommissioned by disparate entities.\n\nWith the undeniable success of Ransomware-as-a-Service (RaaS), it's not surprising that the\ncybercriminal market has expanded its portfolio to add dedicated phishing and espionage campaigns to\nthe list of services on offer. Outsourcing attacks or certain parts of the attack chain to unaffiliated\nmercenary groups has several advantages for the adversary – it saves their time and resources and\nsimplifies the procedures, but most importantly it provides an additional layer of indirection, which\nhelps to protect the real identity of the threat actor.\n\nResearchers and investigators tend to group adversaries based on similar tactics, techniques and\nprocedures, code reuse, and physical infrastructure overlap. The attribution is often derived by analyzing\nthe nature and geography of the campaign targets in relation to geopolitical situation. However, in the\ncase of mercenary APTs, the selection of victims might appear random and will rarely reveal a bigger\npicture about the motives behind the campaigns.\n\nWhen dealing with threat actors that outsource their campaigns, only the entity that performed the\nattack can be tracked, while the actual perpetrator becomes more elusive than ever.\n\n**Indicators of Compromise (IoCs):**\n\n\n-----\n\n|Indicator|Type|Description|\n|---|---|---|\n|130fa726df5a58e9334cc28dc62e3ebaa0b7c0d637fce1a66daff66ee05a9437|SHA256|SombRAT x86 loader|\n|8062e1582525534b9c52c5d9a38d6b012746484a2714a14febe2d07af02c32d5|SHA256|SombRAT x86 loader|\n|d69764b22d1b68aa9462f1f5f0bf18caebbcff4d592083f80dbce39c64890295|SHA256|SombRAT x86 loader|\n|f6ecdae3ae4769aaafc8a0faab30cb66dab8c9d3fff27764ff208be7a455125c|SHA256|SombRAT x86 loader|\n|561bf3f3db67996ce81d98f1df91bfa28fb5fc8472ed64606ef8427a97fd8cdd|SHA256|SombRAT x86 pay- load (memory dump)|\n|8323094c43fcd2da44f60b46f043f7ca4ad6a2106b6561598e94008ece46168b|SHA256|SombRAT x86 payload|\n|ee0f4afee2940bbe895c1f1f60b8967291a2662ac9dca9f07d9edf400d34b58a ee0f4afee2940bbe895c1f1f60b8967291a2662ac9dca9f07d9edf400d34b58a|SHA256|SombRAT x86 pay- load (UPX)|\n|70d63029c65c21c4681779e1968b88dc6923f92408fe5c7e9ca6cb86d7ba713a|SHA256|SombRAT encoded payload (x64)|\n|79009ee869cec789a3d2735e0a81a546b33e320ee6ae950ba236a9f417ebf763|SHA256|SombRAT decoded payload (x64)|\n|d8189ebdec637fc83276654635343fb422672fc5e3e2818df211fb7c878a3155|SHA256|Payload stager|\n|fa74f70baa15561c28c793b189102149d3fb4f24147adc5efbd8656221c0960b|SHA256|GO-socks5 proxy|\n|c0db3dadf2e270240bb5cad8a652e5e11e3afe41b8ee106d67d47b06f5163261|SHA256|Pcheck proxy|\n|6df8271ae0380737734b2dd6d46d0db3a30ba35d7379710a9f- b05d1510495b49|SHA256|Pcheck proxy|\n|7424d6daab8407e85285709dd27b8c- ce7c633d3d4a39050883ad9d82b85198bf|SHA256|Pscan port scanner|\n\n\n-----\n\n|svolcdst.exe|File- name|SombRAT loader|\n|---|---|---|\n|tunnusvcen.exe|File- name|SombRAT loader|\n|C:\\Projects\\Sombra\\_Bin\\x64\\Release\\Sombra.pdb|PDB path|SombRAT x64|\n|C:\\Wokrflow\\CostaRicto\\Release\\CostaBricks.pdb|PDB path|SombRAT loader|\n|%HOSTNAME%UI724|Mutex|Run-once mutex|\n|%HOSTNAME%SUI724|Mutex|Run-once mutex|\n|sbibd[.]net|Domain|SombRAT C2|\n|infosportals[.]com|Domain|SombRAT C2|\n|akams[.]in|Domain|SombRAT C2|\n|newspointview[.]com|Domain|SombRAT C2|\n|159.65.31.84|IP|SombRAT hosting place|\n|212.83.61.227|IP|sbibd[.]net|\n|144.217.53.146|IP|sbibd[.]net, akams[.]in, infosportals[.]com|\n|45.89.175.206|IP|akams[.]in|\n|45.138.172.54|IP|newspointview[.]com|\n|212.114.52.98|IP|infosportals[.]com|\n\n\n**MITRE ATT&CK:**\n\n\n-----\n\n|Tactic|ID|Name|Description|\n|---|---|---|---|\n|Initial Access|T1078|Valid Accounts|Suspected initial compromise us- ing stolen credentials|\n|Execution|T1106|Execution through API|SombRAT – C2 command|\n||T1053/005|Scheduled Task/Job: Scheduled Task|Used to download SombRAT loader|\n||T1059/001|Command and Scripting Inter- preter: PowerShell|Used to load x64 SombRAT|\n|Defence Evasion|T1055|Process Injection|Invoke-ReflectivePEInjection Pow- erSploit module|\n||T1140|Deobfuscate/Decode Files or Information|SombRAT – Decode strings and custom storage data|\n|Discovery|T1057|Process Discovery|SombRAT – C2 command|\n||T1082|System Information Discovery|SombRAT – C2 command|\n||T1124|System Time Discovery|SombRAT – C2 command|\n||T1046|Network Service Scanning|pscan, nmap|\n|Collection|T1560/003|Archive Collected Data: Archive via Custom Method|SombRAT – Custom storage file|\n|Command and Control|T1572|Protocol Tunneling|SombRAT - DNS tunnelling for C2|\n||T1071/001|Application Layer Protocol: Web Protocols|SombRAT – HTTP for C2|\n||T1573/002|Encrypted Channel: Asymmetric Cryptography|SombRAT – RSA for C2 encryption|\n||T1090/002|Proxy: External Proxy|pcheck HTTP/S proxy, GO SOCK- S5 proxy, PuTTY|\n\n\n-----\n\n|Exfiltration|T1041|Exfiltration Over C2 Channel|SombRAT|\n|---|---|---|---|\n\n\n**Yara Hunting Rules:**\n\nimport \"pe\"\nimport \"hash\"\n\n**rule costaricto_vm_dropper**\n{\nmeta:\ndescription = \"Rule to detect SombRAT loader by code similarity\"\nauthor = \"BlackBerry Threat Hunting and Intelligence Team\"\n\nstrings:\n// vm class name\n$classname = \"VMBASERUNNER\" ascii wide nocase\n\n// start of vm bytecode\n$vmbytecode = {37C7359438C73594}\n\n// start of encrypted payload\n$encpayload_1 = {77D2C7AC59B2EB0DF37028AC950971FB}\n\n// binary string from enc payload (some payloads differ only in the header)\n$encpayload_2 = {06359D29C83125C321C201CF9AE7D1626B8F4281C33617EECE86BD106C628FE593936F00C2C\n68E28843BE5374F876840FCD1BFD014D5DEFF4BA8EB6A5FFFB24F932138B04C1BE6D5BD8BB572B8116799AE1C8F0\nD5DB774ABA4884B9E706981FC3740B4CD891F8A0EA6900D41B675CFC98A}\n\n// vm execution loop\n$vmcode_1 = {8B ?? 08 8B ?? 0C 89 ?? 29 ?? C1 ?? 02 39 ?? 74 4E 83 ?? ?? 08 8D ?? ?? 8B\n?? ?? 8D ?? 01 89 ?? 8B ?? ?? 66 83 ?? 08 00 75 28 8B ?? ?? 8D ?? 04 5? 5? E8 ?? ?? FF FF 8B\n?? ?? 83 ?? 0C 5? 8B ?? 0C 89 ?? 5? FF ?? 14 83 C4 08 8B ?? 8B ?? 08 8B ?? 0C 89 ?? 29 ?? C1\n?? 02 39 ?? 89 ?? 75 B9}\n\n// vm execution loop (sample from Nov 2019)\n$vmcode_2 = {8B ?? 4? 89 ?? 8B ?? 08 8B ?? 88 33 ?? 66 39 ?? 08 75 19 8D ?? 04 5? 8D ??\n08 E8 ?? ?? 00 00 8B ?? 8D ?? 0C 5? 5? FF ?? 5? 5? 8B ?? 8B ?? 0C 2B ?? 08 C1 ?? 02 3B ?? 75\nC7}\n\ncondition:\nuint16(0) == 0x5a4d and filesize < 5MB and filesize > 20KB and any of them\n}\n\n**rule costaricto_vm_dropper_pdb_path**\n{\nmeta:\ndescription = \"Rule to detect samples with CostaRicto PDB path\"\nauthor = \"BlackBerry Threat Hunting and Intelligence Team\"\npdb_string = \"C:\\\\Wokrflow\\\\CostaRicto\\\\Release\\\\CostaBricks.pdb\"\n\nstrings:\n$a = \"CostaRicto\" ascii wide nocase\n\n$b = \"CostaBricks pdb\" ascii wide nocase\n\n\n-----\n\n$c1 = \"C:\\\\Wokrflow\\\\\" ascii wide nocase\n$c2 = \"Release\" ascii wide nocase\n$c3 = \".pdb\" ascii wide nocase\n\ncondition:\nuint16(0) == 0x5a4d and filesize < 5MB and filesize > 20KB and ($a or $b or all of ($c*))\n}\n\n**rule costaricto_sobmrat_pdb_path**\n{\nmeta:\ndescription = \"Rule to detect samples with SombRAT PDB path\"\nauthor = \"BlackBerry Threat Hunting and Intelligence Team\"\npdb_string = \"C:\\\\Projects\\\\Sombra\\\\_Bin\\\\x64\\\\Release\\\\Sombra.pdb\"\npdb_string_2 = \"c:\\\\projects\\\\sombra\\\\libraries\"\n\nstrings:\n$a = \"\\\\Projects\\\\Sombra\\\\\" ascii wide nocase\n$b = \"Sombra.pdb\" ascii wide nocase\n\ncondition:\nuint16(0) == 0x5a4d and filesize < 5MB and filesize > 20KB and ($a or $b)\n}\n\n**rule costaricto_backdoored_blink**\n{\nmeta:\ndescription = \"Rule to detect backdoored Blink application\"\nauthor = \"BlackBerry Threat Hunting and Intelligence Team\"\n\nstrings:\n$a1 = \"Failed to open target application process!\"\n$a2 = \"Machine architecture mismatch between target application and this application!\"\n$a3 = \"Failed to create new communication pipe!\"\n$b = \"Plauger, licensed by Dinkumware, Ltd.\"\n\ncondition:\nuint16(0) == 0x5a4d and filesize < 5MB and filesize > 50KB and ($b and 1 of ($a*))\n}\n\n**rule costaricto_rich_header**\n{\nmeta:\ndescription = \"Rule to detect Rich header associated with CostaRicto campaign\"\nauthor = \"BlackBerry Threat Hunting and Intelligence Team\"\n\ncondition:\npe.rich_signature.toolid(0xf1, 40116) and\npe.rich_signature.toolid(0xf3, 40116) and\npe.rich_signature.toolid(0xf2, 40116) and\npe.rich_signature.toolid(0x105, 26706) and\npe.rich_signature.toolid(0x104, 26706) and\npe.rich_signature.toolid(0x103, 26706) and\npe.rich_signature.toolid(0x93, 30729) and\npe.rich_signature.toolid(0x109, 27023) and\npe.rich_signature.toolid(0xff, 27023) and\n\n\n-----\n\npe.rich_signature.toolid(0x97, 0) and\npe.rich_signature.toolid(0x102, 27023)\n}\n\n**rule costaricto_rich_header_august**\n{\nmeta:\ndescription = \"Rule to detect Rich header associated with CostaRicto campaign\"\nauthor = \"BlackBerry Threat Hunting and Intelligence Team\"\n\ncondition:\npe.rich_signature.toolid(0xf1, 40116) and\npe.rich_signature.toolid(0xf2, 40116) and\npe.rich_signature.toolid(0xf3, 40116) and\npe.rich_signature.toolid(0x102, 26428) and\npe.rich_signature.toolid(0x103, 26131) and\npe.rich_signature.toolid(0x104, 26131) and\npe.rich_signature.toolid(0x105, 26131) and\npe.rich_signature.toolid(0x103, 26433) and\npe.rich_signature.toolid(0x104, 26433) and\npe.rich_signature.toolid(0x109, 26428) and\npe.rich_signature.toolid(0x93, 30729) and\npe.rich_signature.toolid(0xff, 26428)\n}\n\n**rule costaricto_rich_xor_key**\n{\nmeta:\ndescription = \"Rule to detect Rich header associated with CostaRicto campaign\"\nauthor = \"BlackBerry Threat Hunting and Intelligence Team\"\n\ncondition:\n// x86 droppers\npe.rich_signature.key == 0x2e8d923f or\npe.rich_signature.key == 0x97d94c45 or\n\n// x86 payload\npe.rich_signature.key == 0xef257087 or\npe.rich_signature.key == 0x4f257087 or\npe.rich_signature.key == 0x1e816e7e or\n\n// x64 payload\npe.rich_signature.key == 0xd1e5ae6c or\npe.rich_signature.key == 0x5df9c60b\n}\n\n**rule costaricto_sombrat_unpacked**\n{\nmeta:\ndescription = \"Rule to detect unpacked SombRAT backdoor\"\nauthor = \"BlackBerry Threat Hunting and Intelligence Team\"\n\nstrings:\n// class names\n$a1 = \"PEHeadersBackup\"\n$a2 = \"PeLoaderDummy\"\n$a3 = \"PeLoaderLocal\"\n\n\n-----\n\n$a4 = \"PeLoaderBaseClass\"\n$a5 = \"PDTaskman\"\n$a6 = \"PDMessageParamArray\"\n$a7 = \"NetworkDriverLayerWebsockets\"\n$a8 = \"NetworkDriverLayerDNSReader\"\n$a9 = \"WaitForPluginIOCPFullyClosed\"\n\n// substitution-encrypted strings\n$b1 = \"~ydcv{{rs{~|r\"      // installedlike\n$b2 = \"~yg{vcqxez\"       // winplatform\n$b3 = \"~yqxezvc~xyvttrgcrs\"   // informationaccepted\n$b4 = \"xvsqexzdcxevpr\"     // loadfromstorage\n$b5 = \"xvsqexzzrzxen\"      // loadfrommemory\n$b7 = \"xgrydcxevpr\"       // openstorage\n$b8 = \"g{bp~y{xvstxzg{rcr\"   // pluginloadcomplete\n$b9 = \"g{bp~yby{xvs\"      // pluginunload\n\n// AES-encrypted strings\n$c1 = {44 5B 7F 52 0C 13 52 1A 16 45 4C 75 65 72 60 53}\n\n// RSA public key\n$d1 = {EF C9 77 B9 A3 8E 48 92 77 C8 E1 E1 0C 46 35 2B}\n\ncondition:\nuint16(0) == 0x5a4d and filesize < 5MB and filesize > 20KB and any of them\n}\n\n**rule costaricto_pcheck_proxy**\n{\nmeta:\ndescription = \"Rule to detect a custom proxy tool related to the CostaRicto campaign\"\nauthor = \"BlackBerry Threat Hunting and Intelligence Team\"\n\nstrings:\n$a = \"exe.exe host host_port proxy_host proxy_port\"\n$b = \"Tool jobs done\"\n\ncondition:\nuint16(0) == 0x5a4d and filesize < 500KB and filesize > 10KB and ($a or $b)\n}\n\n**rule costaricto_pscan_port_scanner**\n{\nmeta:\ndescription = \"Rule to detect a custom proxy tool related to the CostaRicto campaign\"\nauthor = \"BlackBerry Threat Hunting and Intelligence Team\"\n\nstrings:\n$a1 = \"Invalid arguments count (ver \"\n$a2 = \"Example: ./pscan\"\n$a3 = \"127-130.0.0.1\"\n$b1 = \"[output.txt]\"\n$b2 = \"Invalid ip address range\"\n\ncondition:\nuint16(0) == 0x5a4d and filesize < 500KB and filesize > 10KB and any of ($a*) or all of ($b*)\n}\n\n\n-----\n\n**IDAPython Scripts:**\n\n\n-----\n\n#!/usr/bin/python\n\n**import sys, os, struct, array**\n\nfin = sys.argv[1]\nfout = \"%s_decoded\" %(fin)\nf = open(fin, \"r+w+b\")\nf2 = open(fout, \"w+b\")\nencsize = os.path.getsize(fin) **/ 4**\n\nkey_1 = 0x14820285\nkey_2 = 0x26820323\nkey_3 = 0x35223562\nkey_4 = 0x41256421\ncst_1 = 0x61C88647\ncst_2 = 0x9E3779B9\n\nenc = array.array('I')\nenc.read(f, encsize)\n\ni = 0\n\n**while i < encsize:**\nencdw_1 = enc[i]\nencdw_2 = enc[i+1]\n\ntmp_1a = encdw_1 << 4 & 0xffffffff\ntmp_1b = encdw_1 >> 5 & 0xffffffff\ntmp_1c = encdw_1 - cst_1 & 0xffffffff\ntmp_2a = tmp_1a + key_3 & 0xffffffff\ntmp_2b = tmp_1b + key_4 & 0xffffffff\ntmp_3 = tmp_2a ^ tmp_1c\n\nkeydw_2 = tmp_3 ^ tmp_2b\ndecdw_2 = encdw_2 - keydw_2 & 0xffffffff\n\nmagic_1 = decdw_2 << 4 & 0xffffffff\nmagic_2 = decdw_2 >> 5 & 0xffffffff\nkey_1a = key_1 + magic_1 & 0xffffffff\nkey_2a = key_2 + magic_2 & 0xffffffff\ncst_2a = cst_2 + decdw_2 & 0xffffffff\ntmp_5 = key_1a ^ cst_2a\n\nkeydw_1 = tmp_5 ^ key_2a\ndecdw_1 = encdw_1 - keydw_1 & 0xffffffff\n\ndata1 = struct.pack('I', decdw_1)\ndata2 = struct.pack('I', decdw_2)\n\nf2.seek(i*4)\nf2.write(data1)\nf2.seek(i*4+4)\nf2.write(data2)\n\ni = i + 2\n\n\n-----\n\n_Figure 24: SombRAT payload decryption script_\n\n**import idc, idaapi, idautils**\n**import idautils**\n**import string, array, struct, binascii**\n\n**def isprintable(s, codec='ascii'):**\n**try: s.decode(codec)**\n**except UnicodeDecodeError:** **return** **False**\n**else:** **return** **True**\n\n**def get_int(addr):**\n**return struct.unpack('I', get_bytes(addr, 4))[0]**\n\n**def add_comment(offset, comment):**\nidc.MakeComm(offset, comment)\ntarget = idc.DfirstB(offset)\n**while target != BADADDR:**\nidc.MakeComm(target, comment)\ntarget = idc.DnextB(offset, target)\n\n**def substitution(start, size, patch):**\ndec = \"\"\nenclen = size\nplain = \"`abcdefghijklmnopqrstuvwxyz{|}~H&\\x7F\"\nkey =  \"wvutsrqp\\x7F~}|{zyxgfedcba`onmlkji&Hh\"\n**if len(key)** **!= len(plain):**\nwarning(\"Lenght differs!\")\ni = 0\n**for i in range(enclen):**\nc = Byte(start + i)\nidx = key.find(str(chr(c)))\n**if idx !=** **-1:**\nc = plain[idx]\n**else:**\nc = str(chr(c))\ndec = dec + c\n**if patch ==** **True:**\npatch_byte(start + i, c)\ni += 1\n**return dec**\n\n# iterate over all segments\n**for s in idautils.Segments():**\n**if \".data\" in idc.SegName(s):**\nstart = idc.GetSegmentAttr(s, idc.SEGATTR_START)\nend = idc.GetSegmentAttr(s, idc.SEGATTR_END)\nnum = 0\n**while start < end - 4:**\n**if get_int(start)** **== 0:**\nenclen = get_int(start+4)\nencstrcheck = get_int(start+8)\n**if enclen > 1 and enclen < 100 and encstrcheck > 0x2020:**\nencstr = idc.get_bytes(start+8, enclen)\n\n\n-----\n\n**if isprintable(encstr)** **==** **True:**\nnum += 1\nstartaddr = start+8\n\n**print(\"#%i\")** **%num**\n**print(\"address = 0x{:08x}\".format(start))**\n**print(\"len = %i\")** **%enclen**\n**print(\"encstr = %s\")** **%encstr**\ndecstr = \"\"\ndecstr = substitution(startaddr, enclen, 0)\n**print(\"decstr =%s\") % decstr**\n**print(\"-----------------------------------------\")**\nidc.MakeComm(start, \"{}\".format(decstr))\ndecname = \"s_\" +\n**(''.join(e for e in decstr if e.isalnum()))[:20]**\ndecname = decname.strip()\nres = MakeNameEx(start, decname,\nSN_NOCHECK | SN_NOWARN | 0x800)\n\nstart += 4\n\n_Figure 25: SombRAT string decoding IDA Python script (for x86 payloads)_\n\n## About The BlackBerry Research and Intelligence Team\n\nThe BlackBerry Research and Intelligence team examines emerging and persistent threats, providing\nintelligence analysis for the benefit of defenders and the organizations they serve.\n\n[Back](javascript:history.back())\n\n© 2020 BlackBerry Limited. All rights reserved.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.11.12.CostaRicto_Campaign/The%20CostaRicto%20Campaign_%20Cyber-Espionage%20Outsourced.pdf"
    ],
    "report_names": [
        "The CostaRicto Campaign_ Cyber-Espionage Outsourced"
    ],
    "threat_actors": [
        {
            "id": "c72c09b8-81ba-4e6e-9094-cd84ee4bda79",
            "created_at": "2022-10-25T15:50:23.667393Z",
            "updated_at": "2025-03-27T02:00:55.517974Z",
            "deleted_at": null,
            "main_name": "CostaRicto",
            "aliases": [
                "CostaRicto"
            ],
            "source_name": "MITRE:CostaRicto",
            "tools": [
                "PowerSploit",
                "SombRAT",
                "PsExec",
                "PS1",
                "CostaBricks"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b77f9b40-dca7-449d-819e-115cd2295b41",
            "created_at": "2022-10-25T16:07:23.502671Z",
            "updated_at": "2025-03-27T02:02:09.834738Z",
            "deleted_at": null,
            "main_name": "CostaRicto",
            "aliases": [],
            "source_name": "ETDA:CostaRicto",
            "tools": [
                "CostaBricks",
                "PowerSploit",
                "PsExec",
                "SombRAT",
                "nmap"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "115cf618-02a8-42b8-8d25-305292eafedb",
            "created_at": "2023-11-21T02:00:07.396534Z",
            "updated_at": "2025-03-27T02:00:03.251048Z",
            "deleted_at": null,
            "main_name": "CostaRicto",
            "aliases": [],
            "source_name": "MISPGALAXY:CostaRicto",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bbe36874-34b7-4bfb-b38b-84a00b07042e",
            "created_at": "2022-10-25T15:50:23.375277Z",
            "updated_at": "2025-03-27T02:00:55.457787Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "APT37",
                "InkySquid",
                "ScarCruft",
                "Group123",
                "TEMP.Reaper",
                "Ricochet Chollima"
            ],
            "source_name": "MITRE:APT37",
            "tools": [
                "BLUELIGHT",
                "CORALDECK",
                "KARAE",
                "SLOWDRIFT",
                "ROKRAT",
                "SHUTTERSPEED",
                "POORAIM",
                "HAPPYWORK",
                "Final1stspy",
                "Cobalt Strike",
                "NavRAT",
                "DOGCALL",
                "WINERACK"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f0bccc3d-ad77-49c4-8dfd-8a8a8d6fba26",
            "created_at": "2024-05-01T02:03:08.134022Z",
            "updated_at": "2025-03-27T02:05:17.415028Z",
            "deleted_at": null,
            "main_name": "NICKEL FOXCROFT",
            "aliases": [
                "Group 123 ",
                "Moldy Pisces ",
                "RICOCHET CHOLLIMA ",
                "Reaper ",
                "ScarCruft ",
                "APT37 "
            ],
            "source_name": "Secureworks:NICKEL FOXCROFT",
            "tools": [
                "ROKRAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "9b02c527-5077-489e-9a80-5d88947fddab",
            "created_at": "2022-10-25T16:07:24.103499Z",
            "updated_at": "2025-03-27T02:02:10.108504Z",
            "deleted_at": null,
            "main_name": "Reaper",
            "aliases": [
                "APT 37",
                "ATK 4",
                "Cerium",
                "Crooked Pisces",
                "Geumseong121",
                "Group 123",
                "ITG10",
                "InkySquid",
                "Moldy Pisces",
                "Opal Sleet",
                "Operation Are You Happy?",
                "Operation Battle Cruiser",
                "Operation Black Banner",
                "Operation Daybreak",
                "Operation Dragon messenger",
                "Operation Erebus",
                "Operation Evil New Year",
                "Operation Evil New Year 2018",
                "Operation Fractured Block",
                "Operation Fractured Statue",
                "Operation FreeMilk",
                "Operation Golden Bird",
                "Operation Golden Time",
                "Operation High Expert",
                "Operation Holiday Wiper",
                "Operation Korean Sword",
                "Operation North Korean Human Right",
                "Operation Onezero",
                "Operation Rocket Man",
                "Operation SHROUDED#SLEEP",
                "Operation STARK#MULE",
                "Operation STIFF#BIZON",
                "Operation Spy Cloud",
                "Operation Star Cruiser",
                "Osmium",
                "Red Eyes",
                "Ricochet Chollima",
                "Ruby Sleet",
                "ScarCruft",
                "TA-RedAnt",
                "TEMP.Reaper",
                "Venus 121"
            ],
            "source_name": "ETDA:Reaper",
            "tools": [
                "Agentemis",
                "BLUELIGHT",
                "Backdoor.APT.POORAIM",
                "CARROTBALL",
                "CARROTBAT",
                "CORALDECK",
                "Cobalt Strike",
                "CobaltStrike",
                "DOGCALL",
                "Erebus",
                "Exploit.APT.RICECURRY",
                "Final1stSpy",
                "Freenki Loader",
                "GELCAPSULE",
                "GOLDBACKDOOR",
                "GreezeBackdoor",
                "HAPPYWORK",
                "JinhoSpy",
                "KARAE",
                "KevDroid",
                "Konni",
                "MILKDROP",
                "N1stAgent",
                "NavRAT",
                "Nokki",
                "Oceansalt",
                "POORAIM",
                "PoohMilk",
                "PoohMilk Loader",
                "RICECURRY",
                "RUHAPPY",
                "RokRAT",
                "SHUTTERSPEED",
                "SLOWDRIFT",
                "SOUNDWAVE",
                "SYSCON",
                "Sanny",
                "ScarCruft",
                "StarCruft",
                "Syscon",
                "VeilShell",
                "WINERACK",
                "ZUMKONG",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1605240430,
    "ts_modification_date": 1605240430,
    "files": {
        "pdf": "https://archive.orkl.eu/d6c8819c55c41b32b1d1d75fff4346407609acf2.pdf",
        "text": "https://archive.orkl.eu/d6c8819c55c41b32b1d1d75fff4346407609acf2.txt",
        "img": "https://archive.orkl.eu/d6c8819c55c41b32b1d1d75fff4346407609acf2.jpg"
    }
}