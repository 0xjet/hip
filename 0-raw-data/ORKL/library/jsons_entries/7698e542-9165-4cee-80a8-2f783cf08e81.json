{
    "id": "7698e542-9165-4cee-80a8-2f783cf08e81",
    "created_at": "2023-01-12T15:04:11.206526Z",
    "updated_at": "2025-03-27T02:16:34.622939Z",
    "deleted_at": null,
    "sha1_hash": "e1b5537b512365f68263ac8d5eeae95a8d645fa6",
    "title": "2018-12-03 - Analysis of cyberattack on U.S. think tanks, non-profits, public sector by unidentified attackers",
    "authors": "",
    "file_creation_date": "2022-05-28T21:58:09Z",
    "file_modification_date": "2022-05-28T21:58:09Z",
    "file_size": 1584432,
    "plain_text": "# Analysis of cyberattack on U.S. think tanks, non-profits, public sector by unidentified attackers\n\n**cloudblogs.microsoft.com/microsoftsecure/2018/12/03/analysis-of-cyberattack-on-u-s-think-tanks-non-profits-public-sector-by-unidentified-**\nattackers/\n\nDecember 3, 2018\n\nReuters recently reported a hacking campaign focused on a wide range of targets across the globe. In the days\nleading to the Reuters publication, Microsoft researchers were closely tracking the same campaign.\n\nOur sensors revealed that the campaign primarily targeted public sector institutions and non-governmental\norganizations like think tanks and research centers, but also included educational institutions and private-sector\ncorporations in the oil and gas, chemical, and hospitality industries.\n\n[Microsoft customers using the complete Microsoft Threat Protection solution were protected from the attack.](https://techcommunity.microsoft.com/t5/Security-Privacy-and-Compliance/Announcing-Microsoft-Threat-Protection/ba-p/262783)\nBehavior-based protections in multiple Microsoft Threat Protection components blocked malicious activities and\nexposed the attack at its early stages. [Office 365 Advanced Threat Protection caught the malicious URLs used in](https://docs.microsoft.com/en-us/office365/securitycompliance/office-365-atp)\nemails, driving the blocking of said emails, including first-seen samples. Meanwhile, numerous alerts in Windows\nDefender Advanced Threat Protection exposed the attacker techniques across the attack chain.\n\nThird-party security researchers have attributed the attack to a threat actor named APT29 or CozyBear, which\nlargely overlaps with the activity group that Microsoft calls YTTRIUM. While our fellow analysts make a\ncompelling case, Microsoft does not yet believe that enough evidence exists to attribute this campaign to\nYTTRIUM.\n\nRegardless, due to the nature of the victims, and because the campaign features characteristics of previously\nobserved nation-state attacks, Microsoft took the step of notifying thousands of individual recipients in hundreds\n[of targeted organizations. As part of the Defending Democracy Program, Microsoft encourages eligible](https://blogs.microsoft.com/on-the-issues/2018/04/13/announcing-the-defending-democracy-program/)\n[organizations to participate in Microsoft AccountGuard, a service designed to help these highly targeted](https://blogs.microsoft.com/on-the-issues/2018/08/20/protecting-democracy-with-microsoft-accountguard/)\ncustomers protect themselves from cybersecurity threats.\n\n## Attack overview\n\nThe aggressive campaign began early in the morning of Wednesday, November 14. The targeting appeared to\nfocus on organizations that are involved with policy formulation and politics or have some influence in that area.\n\n\n-----\n\n_Phishing targets in different industry verticals_\n\nAlthough targets are distributed across the globe, majority are located in the United States, particularly in and\naround Washington, D.C. Other targets are in Europe, Hong Kong, India, and Canada.\n\n\n-----\n\n_Phishing targets in different locations_\n\nThe spear-phishing emails mimicked sharing notifications from OneDrive and, as noted by Reuters,\nimpersonated the identity of individuals working at the United States Department of State. If recipients clicked a\nlink on the spear-phishing emails, they began an exploitation chain that resulted in the implantation of a DLL\nbackdoor that gave the attackers remote access to the recipients’ machines.\n\n\n-----\n\n_Attack chain_\n\n## Analysis of the campaign\n\n### Delivery\n\nThe spear-phishing emails used in this attack resemble file-sharing notifications from OneDrive.\n\n\n-----\n\nThe emails contain a link to a legitimate, but compromised third-party website:\n```\nhxxps://www.jmj.com/personal/nauerthn_state_gov/TUJE7QJl[random string]\n\n```\nThe random strings are likely used to identify distinct targeted individuals who clicked on the link. However, all\nobserved variants of this link redirect to a specific link on the same site:\n```\nhxxps://www.jmj.com/personal/nauerthn_state_gov/VFVKRTdRSm\n\n```\nWhen users click the link, they are served a ZIP archive containing a malicious LNK file. All files in a given attack\nhave the same file name, for example, ds7002.pdf, ds7002.zip, and ds7002.lnk.\n\n### Installation\n\nThe LNK file represents the first stage of the attack. It executes an obfuscated PowerShell command that\nextracts a base64-encoded payload from within the LNK file itself, starting at offset 0x5e2be and extending\n16,632 bytes.\n\n_Encoded content in the LNK file_\n\nThe encoded payload—another heavily obfuscated PowerShell script—is decoded and executed:\n\n\n-----\n\n_Decoded second script_\n\nThe second script carves out two additional resources from within the .LNK file:\n\n_ds7002.PDF (A decoy PDF)_\n_cyzfc.dat (The first stage implant)_\n\n### Command and control\n\nThe first-stage DLL, cyzfc.dat, is created by the PowerShell script in the path %AppData%\\Local\\cyzfc.dat. It is a\n64-bit DLL that exports one function: PointFunctionCall.\n\nThe PowerShell script then executes cyzfc.dat by calling rundll32.exe. After connecting to the first-stage\ncommand-and-control server at pandorasong[.]com (95.216.59.92), cyzfc.dat begins to install the final payload by\ntaking the following actions:\n\n1. Allocate a ReadWrite page for the second-stage payload\n2. Extract the second-stage payload as a resource\n3. Take a header that is baked into the first payload with a size 0xEF bytes\n4. Concatenate the header with the resource, starting at byte 0x12A.\n5. De-XOR the second-stage payload with a rolling XOR (ROR1), starting from key 0xC5.\n\nThe second stage is an instance of Cobalt Strike, a commercially available penetration testing tool, which\nperforms the following steps:\n\n1. Define a local named pipe with the format \\\\.\\pipe\\MSSE-<number>-server, where <number> is a random\n\nnumber between 0 and 9897\n2. Connecting to the pipe, write it global data with size 0x3FE00\n\n\n-----\n\n3. Implement a backdoor over the named pipe:\n\n1. Read from the pipe (maximum 0x3FE00 bytes) to an allocated buffer\n2. DeXOR the payload onto a new RW memory region, this time with a much simple XOR key: simple\n\nXORing every 4 bytes with 0x7CC2885F\n3. Turn the region to be RX\n4. Create a thread that starts running the payload’\n\nThe phase that writes to global data to the pipe actually writes a third payload. That payload is XORed with the\nsame XORing algorithm used for reading. When decrypted, it forms a PE file with a Meterpreter header,\ninterpreting instructions in the PE header and moving control to a reflective loader:\n\n\n-----\n\nThe third payload eventually gets loaded and connects to the command-and-control (C&C) server address that is\nbaked-in inside configuration information in the PE file. This configuration information is de-XORed at the third\npayload runtime:\n\nThe configuration information itself mostly contains C&C information:\n\nCobaltStrike is a feature-rich penetration testing tool that provides remote attackers with a wide range of\ncapabilities, including escalating privileges, capturing user input, executing arbitrary commands through\nPowerShell or WMI, performing reconnaissance, communicating with C&C servers over various protocols, and\ndownloading and installing additional malware.\n\n## End-to-end defense through Microsoft Threat Protection\n\n[Microsoft Threat Protection is a comprehensive solution for enterprise networks, protecting identities, endpoints,](https://techcommunity.microsoft.com/t5/Security-Privacy-and-Compliance/Announcing-Microsoft-Threat-Protection/ba-p/262783)\nuser data, cloud apps, and infrastructure. By integrating Microsoft services, Microsoft Threat Protection facilitates\nsignal sharing and threat remediation across services. In this attack, Office 365 Advanced Threat Protection and\nWindows Defender Advanced Threat Protection quickly mitigated the threat at the onset through durable\nbehavioral protections.\n\n[Office 365 ATP has enhanced phishing protection and coverage against new threats and polymorphic variants.](https://docs.microsoft.com/en-us/office365/securitycompliance/office-365-atp)\nDetonation systems in Office 365 ATP caught behavioral markers in links in the emails, allowing us to\nsuccessfully block campaign emails—including first-seen samples—and protect targeted customers. Three\nexisting behavioral-based detection algorithms quickly determined that the URLs were malicious. In addition,\n\n\n-----\n\nOffice 365 ATP uses security signals from Windows Defender ATP, which had a durable behavior based antivirus\ndetection (Behavior:Win32/Atosev.gen!A) for the second-stage malware. If you are not already secured against\n[advanced cyberthreat campaigns via email, begin a free Office 365 E5 trial today.](https://portal.office.com/signup/logout?OfferId=101bde18-5ffb-4d79-a47b-f5b2c62525b3&dl=ENTERPRISEPREMIUM&culture=en-US&country=US)\n\n[Safe Links protection in Office 365 ATP protects customers from attacks like this by analyzing unknown URLs](https://docs.microsoft.com/en-us/office365/securitycompliance/atp-safe-links)\nwhen customers try to open them. [Zero-hour Auto Purge (ZAP) actively removes emails post-delivery after they](https://docs.microsoft.com/en-us/office365/securitycompliance/zero-hour-auto-purge)\nhave been verified as malicious—this is often critical in stopping attacks that weaponize embedded URLs after\nthe emails are sent.\n\nAll of these protections and signals on the attack entry point are shared with the rest of the Microsoft Threat\nProtection components. Windows Defender ATP customers would see alerts related to the detection of the\nmalicious emails by Office 365 ATP, as well the behavior-based antivirus detection.\n\n[Windows Defender ATP detects known filesystem and network artifacts associated with the attack. In addition,](https://www.microsoft.com/en-us/windowsforbusiness/windows-atp?ocid=cx-blog-mmpc)\nthe actions of the LNK file are detected behaviorally. Alerts with the following titles are indicative of this attack\nactivity:\n\n_Artifacts associated with an advanced threat detected_\n_Network activity associated with an advanced threat detected_\n_Low-reputation arbitrary code executed by signed executable_\n_Suspicious LNK file opened_\n\nNetwork protection blocks connections to malicious domains and IP addresses. The following attack surface\nreduction rule also blocks malicious activities related to this attack:\n\n_Block executable files from running unless they meet a prevalence, age, or trusted list criteria_\n\nThrough Windows Defender Security Center, security operations teams could investigate these alerts and pivot\n[to machines, users, and the new Incidents view to trace the attack end-to-end. Automated investigation and](https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-atp/incidents-queue)\n[response capabilities, threat analytics, as well as advanced hunting and new custom detections, empower](https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-atp/threat-analytics)\nsecurity operations teams to defend their networks from this attack. To test how Windows Defender ATP can help\nyour organization detect, investigate, and respond to advanced attacks, sign up for a free Windows Defender\n**ATP trial.**\n\nThe following Advanced hunting query can help security operations teams search for any related activities within\nthe network:\n\n\n-----\n\n```\n Q y g\nlet fileHash = \"9858d5cb2a6614be3c48e33911bf9f7978b441bf\";\nfind in (FileCreationEvents, ProcessCreationEvents, MiscEvents, \nRegistryEvents, NetworkCommunicationEvents, ImageLoadEvents)\nwhere SHA1 == fileHash or InitiatingProcessSHA1 == fileHash\n| where EventTime > ago(10d)\n//Query 2: C&C connection\nNetworkCommunicationEvents \n| where EventTime > ago(10d) \n| where RemoteUrl == \"pandorasong.com\" \n//Query 3: Malicious PowerShell\nProcessCreationEvents \n| where EventTime > ago(10d) \n| where ProcessCommandLine contains \n\"-noni -ep bypass $zk='\nJHB0Z3Q9MHgwMDA1ZTJiZTskdmNxPTB4MDAwNjIzYjY7JHRiPSJkczcwMDIubG5rIjtpZiAoLW5vdChUZXN0LVBhdGggJHRiKSl7JG9lP\n//Query 4: Malicious domain in default browser commandline\nProcessCreationEvents \n| where EventTime > ago(10d) \n| where ProcessCommandLine contains \n\"https://www.jmj.com/personal/nauerthn_state_gov\" \n//Query 5: Events involving the ZIP\nlet fileHash = \"cd92f19d3ad4ec50f6d19652af010fe07dca55e1\";\nfind in (FileCreationEvents, ProcessCreationEvents, MiscEvents, \nRegistryEvents, NetworkCommunicationEvents, ImageLoadEvents)\nwhere SHA1 == fileHash or InitiatingProcessSHA1 == fileHash\n| where EventTime > ago(10d)\n\n```\nThe provided queries check events from the past ten days. Change EventTime to focus on a different period.\n\n**_Windows Defender Research team, Microsoft Threat Intelligence Center, and Office 365 ATP research_**\n**_team_**\n\n### Indicators of attack\n\nFiles (SHA-1)\n\nds7002.ZIP: cd92f19d3ad4ec50f6d19652af010fe07dca55e1\nds7002.LNK: e431261c63f94a174a1308defccc674dabbe3609\nds7002.PDF (decoy PDF): 8e928c550e5d44fb31ef8b6f3df2e914acd66873\ncyzfc.dat (first-stage): 9858d5cb2a6614be3c48e33911bf9f7978b441bf\n\nURLs\n\nhxxps://www.jmj[.]com/personal/nauerthn_state_gov/VFVKRTdRSm\n\nC&C servers\n\npandorasong[.]com (95.216.59.92) (first-stage C&C server)\n\n\n-----\n\n**Talk to us**\n\n[Questions, concerns, or insights on this story? Join discussions at the Microsoft community and](https://answers.microsoft.com/en-us/protect) Windows\nDefender Security Intelligence.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-12-03 - Analysis of cyberattack on U.S. think tanks, non-profits, public sector by unidentified attackers.pdf"
    ],
    "report_names": [
        "2018-12-03 - Analysis of cyberattack on U.S. think tanks, non-profits, public sector by unidentified attackers.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "5b748f86-ac32-4715-be9f-6cf25ae48a4e",
            "created_at": "2024-06-04T02:03:07.956135Z",
            "updated_at": "2025-03-27T02:05:17.407352Z",
            "deleted_at": null,
            "main_name": "IRON HEMLOCK",
            "aliases": [
                "ATK7 ",
                "Blue Kitsune ",
                "Cozy Bear ",
                "The Dukes",
                "UNC2452 ",
                "YTTRIUM ",
                "APT29 "
            ],
            "source_name": "Secureworks:IRON HEMLOCK",
            "tools": [
                " CozyCar",
                " CozyDuke",
                " DiefenDuke",
                " FatDuke",
                " HAMMERTOSS",
                " LiteDuke",
                " MiniDuke",
                " OnionDuke",
                " PolyglotDuke",
                " RegDuke",
                " RegDuke Loader",
                " SeaDuke",
                " Sliver",
                "CosmicDuke"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a241a1ca-2bc9-450b-a07b-aae747ee2710",
            "created_at": "2024-06-19T02:03:08.150052Z",
            "updated_at": "2025-03-27T02:05:17.409596Z",
            "deleted_at": null,
            "main_name": "IRON RITUAL",
            "aliases": [
                "Blue Dev 5 ",
                "BlueBravo ",
                "Cloaked Ursa ",
                "CozyLarch ",
                "Dark Halo ",
                "Midnight Blizzard ",
                "NOBELIUM ",
                "StellarParticle ",
                "UNC2452 ",
                "APT29"
            ],
            "source_name": "Secureworks:IRON RITUAL",
            "tools": [
                " Cobalt Strike",
                " EnvyScout",
                " GoldFinder",
                " GoldMax",
                " NativeZone",
                " RAINDROP",
                " SUNBURST",
                " Sibot",
                " TEARDROP",
                " VaporRage",
                "Brute Ratel C4"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46b3c0fc-fa0c-4d63-a38a-b33a524561fb",
            "created_at": "2023-01-06T13:46:38.393409Z",
            "updated_at": "2025-03-27T02:00:02.822155Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "The Dukes",
                "Minidionis",
                "Grizzly Steppe",
                "G0016",
                "Blue Kitsune",
                "BlueBravo",
                "SeaDuke",
                "Cloaked Ursa",
                "YTTRIUM",
                "ATK7",
                "Nobelium",
                "UAC-0029",
                "Group 100",
                "COZY BEAR",
                "IRON HEMLOCK",
                "TA421",
                "ITG11"
            ],
            "source_name": "MISPGALAXY:APT29",
            "tools": [
                "QUARTERRIG",
                "SNOWYAMBER",
                "HALFRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535851,
    "ts_updated_at": 1743041794,
    "ts_creation_date": 1653775089,
    "ts_modification_date": 1653775089,
    "files": {
        "pdf": "https://archive.orkl.eu/e1b5537b512365f68263ac8d5eeae95a8d645fa6.pdf",
        "text": "https://archive.orkl.eu/e1b5537b512365f68263ac8d5eeae95a8d645fa6.txt",
        "img": "https://archive.orkl.eu/e1b5537b512365f68263ac8d5eeae95a8d645fa6.jpg"
    }
}