{
    "id": "b5a7f6ea-4815-4656-be39-63fb1df04451",
    "created_at": "2023-01-12T15:06:03.058882Z",
    "updated_at": "2025-03-27T02:05:24.451719Z",
    "deleted_at": null,
    "sha1_hash": "8244d533ef743b5aff0532f6ab03e176aeb476ff",
    "title": "2021-06-24 - Malicious spam campaigns delivering banking Trojans",
    "authors": "",
    "file_creation_date": "2022-05-28T04:49:49Z",
    "file_modification_date": "2022-05-28T04:49:49Z",
    "file_size": 352636,
    "plain_text": "# Malicious spam campaigns delivering banking Trojans\n\n**[securelist.com/malicious-spam-campaigns-delivering-banking-trojans/102917](https://securelist.com/malicious-spam-campaigns-delivering-banking-trojans/102917)**\n\nAuthors\n\n[Anton Kuzmenko](https://securelist.com/author/antonkuzmenko/)\n\nIn mid-March 2021, we observed two new spam campaigns. The messages in both cases\nwere written in English and contained ZIP attachments or links to ZIP files. Further research\nrevealed that both campaigns ultimately aimed to distribute banking Trojans. The payload in\nmost cases was IcedID (Trojan-Banker.Win32.IcedID), but we have also seen a few QBot\n(Backdoor.Win32.Qbot, also known as QakBot) samples. During campaign spikes we\nobserved increased activity of these Trojans: more than a hundred detections a day.\n\nIcedID is a banking Trojan capable of web injects, VM detection and other malicious actions.\nIt consists of two parts – the downloader and the main body that performs all the malicious\nactivity. The main body is hidden in a PNG image, which is downloaded and decrypted by\nthe downloader.\n\nQBot is also a banking Trojan. It’s a single executable with an embedded DLL (main body)\ncapable of downloading and running additional modules that perform malicious activity: web\ninjects, email collection, password grabbing, etc.\n\n\n-----\n\nNeither of these malware families are new – we ve seen them being distributed before via\n[spam campaigns and different downloaders, like the recently taken-down Emotet. However,](https://securelist.com/the-chronicles-of-emotet/99660/)\nin the recent campaign we observed several changes to the IcedID Trojan.\n\n## Technical details\n\n### Initial infection\n\n**DotDat**\n\nThe first campaign we called ‘DotDat’. It distributed ZIP attachments that claimed to be some\nsort of cancelled operation or compensation claims with the names in the following format\n\n[document type (optional)]-[some digits]-[date in MMDDYYYY format]. We assume the dates\ncorrespond with the campaign spikes. The ZIP archives contained a malicious MS Excel file\nwith the same name.\n\nThe Excel file downloads a malicious payload via a macro (see details below) from a URL\nwith the following format [host]/[digits].[digits].dat and executes it. The URL is generated\nduring execution using the Excel function NOW(). The payload is either the IcedID\ndownloader (Trojan.Win32.Ligooc) or QBot packed with a polymorph packer.\n\n**[Excel macro details (3e12880c20c41085ea5e249f8eb85ded)](https://opentip.kaspersky.com/3e12880c20c41085ea5e249f8eb85ded/?utm_source=SL&utm_medium=SL&utm_campaign=SL)**\n\nThe Excel file contains obfuscated Excel 4.0 macro formulas to download and execute the\npayload (IcedID or QBot). The macro generates a payload URL and calls the WinAPI\nfunction URLDownloadToFile to download the payload.\n\n**_Macro downloads IcedID downloader_**\n\nAfter a successful download, the payload is launched using the EXEC function and Windows\nRundll32 executable.\n\n\n-----\n\n**_Macro starts payload_**\n\n**Summer.gif**\n\nThe spam emails of the second campaign contained links to hacked websites with malicious\narchives named “documents.zip”, “document-XX.zip”, “doc-XX.zip” where XX stands for two\nrandom digits. Like in the first campaign, the archives contained an Excel file with a macro\nthat downloaded the IcedID downloader. According to our data, this spam campaign peaked\non 17/03/2021. By April, the malicious activity had faded away.\n\n**[Excel macro details (c11bad6137c9205d8656714d362cc8e4)](https://opentip.kaspersky.com/c11bad6137c9205d8656714d362cc8e4/?utm_source=SL&utm_medium=SL&utm_campaign=SL)**\n\nLike in the other case, Excel 4.0 macro formulas and the URLDownloadToFile function are\nused in this campaign. The main difference in the download component is that the URL is\nstored in a cell inside the malicious file.\n\n**_Payload download_**\n\n\n-----\n\nThough the URL seems to refer to a file named summer.gif, the payload is an executable,\nnot a GIF image. To execute the payload, the macro uses WMI and regsvr32 tools.\n\n**_Macro starts payload_**\n\n### IcedID\n\nAs we mention above, IcedID consists of two parts – downloader and main body. The\ndownloader sends some user information (username, MAC address, Windows version, etc.)\nto the C&C and receives the main body. In the past, the main body was distributed as a\nshellcode hidden in a PNG image. The downloader gets the image, decrypts the main body\nin the memory and executes it. The main body maps itself into the memory and starts to\nperform its malicious actions such as web injects, data exfiltration to the C&C, download and\nexecution of additional payloads, exfiltration of system information and more.\n\n**IcedID new downloader**\n\nBesides the increase in infection attempts, the IcedID authors also changed the downloader\na bit. In previous versions it was compiled as an x86 executable and the malware\nconfiguration after decryption contained fake C&C addresses. We assume this was done to\ncomplicate analysis of the samples. In the new version, the threat actors moved from x86 to\nan x86-64 version and removed the fake C&Cs from the configuration.\n\n**_Configuration of the old version of IcedID downloader_**\n\n\n-----\n\n**_New version configuration_**\n\nWe also observed a minor change in the malware’s main body. While it’s still distributed as a\nPNG image, and the decryption and C&C communication methods remain the same, the\nauthors decided not to use shellcode. Instead, IcedID’s main body is distributed as a\nstandard PE file with some loader-related data in the beginning.\n\n**Geography of IcedID attacks**\n\n_[Geography of IcedID downloader detections, March 2021 (download)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2021/06/21144104/01-en-icedid-and-qbot-maps.png)_\n\nIn March 2021, the greatest number of users attacked by Ligooc (IcedID downloader) were\nobserved in China (15.88%), India (11.59%), Italy (10.73%), the United States (10.73%) and\nGermany (8.58%).\n\n### Qbot\n\nUnlike IcedID, QBot is a single executable with an embedded DLL (main body) stored into\nthe resource PE section. In order to perform traffic interception, steal passwords, perform\nweb injects and take remote control of the infected system, it downloads additional modules:\nweb inject module, hVNC (remote control module), email collector, password grabber and\nothers. All the details on Qbot, as well as IoCs, MITRE ATT&CK framework data, YARA rules\nand hashes relating to this threat are available to users of our Financial Threat Intelligence\nservices.\n\n**Geography of Qbot attacks**\n\n_[Geography of QBot attacks, March 2021 (download)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2021/06/21144130/02-en-icedid-and-qbot-maps.png)_\n\nIn March 2021, QBot was also most active in China (10.78%), India (10.78%) and the United\nStates (4.66%), but we also observed it in Russia (7.60%) and France (7.60%).\n\n## Indicators of compromise\n\nFile Hashes (MD5)\n\n**Excel with macros**\n\n[042b349265bbac709ff2cbddb725033b](https://opentip.kaspersky.com/042b349265bbac709ff2cbddb725033b/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[054532b8b2b5c727ed8f74aabc9acc73](https://opentip.kaspersky.com/054532b8b2b5c727ed8f74aabc9acc73/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[1237e85fe00fcc1d14df0fb5cf323d6b](https://opentip.kaspersky.com/1237e85fe00fcc1d14df0fb5cf323d6b/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[3e12880c20c41085ea5e249f8eb85ded](https://opentip.kaspersky.com/3e12880c20c41085ea5e249f8eb85ded/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n\n-----\n\n**Documents.zip**\n\n[c11bad6137c9205d8656714d362cc8e4](https://opentip.kaspersky.com/c11bad6137c9205d8656714d362cc8e4/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n**Trojan.Win32.Ligooc**\n\n[997340ab32077836c7a055f52ab148de](https://opentip.kaspersky.com/997340ab32077836c7a055f52ab148de/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n**Trojan-Banker.Win32.QBot**\n\n[57f347e5f703398219e9edf2f31319f6](https://opentip.kaspersky.com/57f347e5f703398219e9edf2f31319f6/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n**Domains/IPs**\n\n[Apoxiolazio55[.]space](https://opentip.kaspersky.com/Apoxiolazio55.space/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[Karantino[.]xyz](https://opentip.kaspersky.com/Karantino.xyz/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[uqtgo16datx03ejjz[.]xyz](https://opentip.kaspersky.com/uqtgo16datx03ejjz.xyz/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n[188.127.254[.]114](https://opentip.kaspersky.com/188.127.254.114/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\n\n[Macros](https://securelist.com/tag/macros/)\n[Malicious spam](https://securelist.com/tag/malicious-spam/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[Malware Technologies](https://securelist.com/tag/malware-technologies/)\n[Microsoft Excel](https://securelist.com/tag/microsoft-excel/)\n[Trojan](https://securelist.com/tag/trojan/)\n[Trojan Banker](https://securelist.com/tag/trojan-banker/)\n\nAuthors\n\n[Anton Kuzmenko](https://securelist.com/author/antonkuzmenko/)\n\nMalicious spam campaigns delivering banking Trojans\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-24 - Malicious spam campaigns delivering banking Trojans.pdf"
    ],
    "report_names": [
        "2021-06-24 - Malicious spam campaigns delivering banking Trojans.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535963,
    "ts_updated_at": 1743041124,
    "ts_creation_date": 1653713389,
    "ts_modification_date": 1653713389,
    "files": {
        "pdf": "https://archive.orkl.eu/8244d533ef743b5aff0532f6ab03e176aeb476ff.pdf",
        "text": "https://archive.orkl.eu/8244d533ef743b5aff0532f6ab03e176aeb476ff.txt",
        "img": "https://archive.orkl.eu/8244d533ef743b5aff0532f6ab03e176aeb476ff.jpg"
    }
}