{
    "id": "3f15722d-dd3f-4876-a7a1-a6d4beb21b3a",
    "created_at": "2023-01-12T15:06:46.579574Z",
    "updated_at": "2025-03-27T02:12:03.95376Z",
    "deleted_at": null,
    "sha1_hash": "dc2081ff6bbea271f1c4b2728cb2ec7d1f9a22c5",
    "title": "2021-03-03 - Alert (AA21-062A)- Mitigate Microsoft Exchange Server Vulnerabilities",
    "authors": "",
    "file_creation_date": "2022-05-27T22:50:33Z",
    "file_modification_date": "2022-05-27T22:50:33Z",
    "file_size": 561956,
    "plain_text": "# Mitigate Microsoft Exchange Server Vulnerabilities\n\n**us-cert.cisa.gov/ncas/alerts/aa21-062a**\n\n## Summary\n\n_Updated July 19, 2021: The U.S. Government attributes this activity to malicious cyber actors affiliated with the People's Republic of_\n_[China (PRC) Ministry of State Security (MSS). Additional information may be found in a statement from the White House. For more](https://www.whitehouse.gov/briefing-room/statements-releases/2021/07/19/the-united-states-joined-by-allies-and-partners-attributes-malicious-cyber-activity-and-irresponsible-state-behavior-to-the-peoples-republic-of-china/)_\n_information on Chinese malicious cyber activity, refer to_ _[us-cert.cisa.gov/China.](https://us-cert.cisa.gov/china)_\n\n**_Note: This Alert was updated April 13, 2021, to provide further guidance._**\n\nCybersecurity and Infrastructure Security Agency (CISA) partners have observed active exploitation of vulnerabilities in Microsoft\nExchange Server products. Successful exploitation of these vulnerabilities allows an unauthenticated attacker to execute arbitrary\ncode on vulnerable Exchange Servers, enabling the attacker to gain persistent system access, as well as access to files and\nmailboxes on the server and to credentials stored on that system. Successful exploitation may additionally enable the attacker to\ncompromise trust and identity in a vulnerable network. Microsoft released out-of-band patches to address vulnerabilities in Microsoft\nExchange Server. The vulnerabilities impact on-premises Microsoft Exchange Servers and are not known to impact Exchange Online\nor Microsoft 365 (formerly O365) cloud email services.\n\nThis Alert includes both tactics, techniques and procedures (TTPs) and the indicators of compromise (IOCs) associated with this\nmalicious activity. To secure against this threat, CISA recommends organizations examine their systems for the TTPs and use the\nIOCs to detect any malicious activity. If an organization discovers exploitation activity, they should assume network identity\ncompromise and follow incident response procedures. If an organization finds no activity, they should apply available patches\nimmediately and implement the mitigations in this Alert.\n\n[Click here for IOCs in STIX format.](https://us-cert.cisa.gov/sites/default/files/publications/AA21-062A.stix.xml)\n\n## Technical Details\n\n_(Updated April 14, 2021):_ [Microsoft's April 2021 Security Update newly discloses and mitigates significant vulnerabilities affecting on-](https://msrc.microsoft.com/update-guide/releaseNote/2021-Apr)\npremises Exchange Server 2013, 2016, and 2019.\n\nMicrosoft has released out-of-band security updates to address four vulnerabilities in Exchange Server:\n\n[CVE-2021-26855 allows an unauthenticated attacker to send arbitrary HTTP requests and authenticate as the Exchange](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-26855)\nServer. The vulnerability exploits the Exchange Control Panel (ECP) via a Server-Side Request Forgery (SSRF). This would\nalso allow the attacker to gain access to mailboxes and read sensitive information.\n[CVE-2021-26857,](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-26857) [CVE-2021-26858, and](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-26858) [CVE-2021-27065 allow for remote code execution.](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-27065)\n\nCVE-2021-26858 and CVE-2021-27065 are similar post-authentication arbitrary write file vulnerabilities in Exchange. An\nattacker, authenticated either by using CVE-2021-26855 or via stolen admin credentials, could write a file to any path on\nthe server.\n\nCVE-2021-26857 is an insecure deserialization vulnerability in the Unified Messaging service. An attacker, authenticated\neither by using CVE-2021-26855 or via stolen admin credentials, could execute arbitrary code as `SYSTEM` on the\nExchange Server.\n\n[To locate a possible compromise of these CVEs, CISA encourages organizations read the Microsoft Advisory.](https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/)\n\nIt is possible for an attacker, once authenticated to the Exchange server, to gain access to the Active Directory environment and\ndownload the Active Directory Database.\n\n_[(Updated March 12, 2021): Microsoft Security Intelligence has released a tweet on](https://twitter.com/MsftSecIntel/status/1370236539427459076)_ [DearCry ransomware being used to exploit](https://www.bleepingcomputer.com/news/security/ransomware-now-attacks-microsoft-exchange-servers-with-proxylogon-exploits/)\ncompromised on-premises Exchange Servers. Ransomware infections can have negative consequences to an affected organization,\nincluding:\n\ntemporary or permanent loss of sensitive or proprietary information,\ndisruption to regular operations,\nfinancial losses incurred to restore systems and files, and\npotential harm to an organization’s reputation.\n\n(Updated April 12, 2021): CISA recommends organizations review Malware Analysis Report (MAR) MAR-10330097-1.v1 – DearCry\nRansomware for detailed analysis, along with TTPs and IOCs.\n\n\n-----\n\n_(Updated March 12, 2021): CISA encourages organizations to review CISAs_ [Ransomware web page for guidance and resources.](https://www.cisa.gov/ransomware)\n[Victims of ransomware should report it immediately to CISA at www.us-cert.gov/report, a local FBI Field Office, or](https://www.us-cert.gov/report) Secret Service Field\nOffice.\n\n## Tactics, Techniques and Procedures\n\n_(Updated March 10, 2021): Microsoft has released a script that scans Exchange log files for IOCs. CISA strongly encourages_\n[organizations to run the Test-ProxyLogon.ps1 script—as soon as possible—to help determine whether their systems are](https://github.com/microsoft/CSS-Exchange/tree/main/Security)\ncompromised.\n\n_[(Updated March 16, 2021): Note: Microsoft has released the Exchange On-premises Mitigation Tool (EOMT.ps1) that can automate](https://msrc-blog.microsoft.com/2021/03/15/one-click-microsoft-exchange-on-premises-mitigation-tool-march-2021/)_\nportions of both the detection and patching process. Microsoft stated the following along with the release: \"[the tool is intended] to\nhelp customers who do not have dedicated security or IT teams to apply these security updates. We have tested this tool across\nExchange Server 2013, 2016, and 2019 deployments. This new tool is designed as an interim mitigation for customers who are\nunfamiliar with the patch/update process or who have not yet applied the on-premises Exchange security update.” Review the\n[EOMT.ps1 blog post for directions on using the tool.](https://msrc-blog.microsoft.com/2021/03/15/one-click-microsoft-exchange-on-premises-mitigation-tool-march-2021/)\n\n_(Updated March 10, 2021): CISA recommends investigating for signs of a compromise from at least January 1, 2021 through present._\n\n_(Updated April 12, 2021): CISA has identified 10 webshells associated with this activity. This is not an all-inclusive list of webshells_\nthat are being leveraged by actors. CISA recommends organizations review the following MARs for detailed analysis of the\n10 webshells, along with TTPs and IOCs. These MARs include CISA-developed YARA rules to help network defenders detect\nassociated malware.\n\n[1. AR21-072A: MAR-10328877.r1.v1: China Chopper Webshell](https://us-cert.cisa.gov/ncas/analysis-reports/ar21-072a)\n[2. AR21-072B: MAR-10328923.r1.v1: China Chopper Webshell](https://us-cert.cisa.gov/ncas/analysis-reports/ar21-072b)\n[3. AR21-072C: MAR-10329107.r1.v1: China Chopper Webshell](https://us-cert.cisa.gov/ncas/analysis-reports/ar21-072c)\n[4. AR21-072D: MAR-10329297.r1.v1: China Chopper Webshell](https://us-cert.cisa.gov/ncas/analysis-reports/ar21-072d)\n[5. AR21-072E: MAR-10329298.r1.v1: China Chopper Webshell](https://us-cert.cisa.gov/ncas/analysis-reports/ar21-072e)\n6. AR21-072F: [MAR-10329301.r1.v1: China Chopper Webshell](https://us-cert.cisa.gov/ncas/analysis-reports/ar21-072f)\n7. AR21-072G: [MAR-10329494.r1.v1: China Chopper Webshell](https://us-cert.cisa.gov/ncas/analysis-reports/ar21-072g)\n[8. AR21-084A: MAR-10329496-1.v1: China Chopper Webshell](https://us-cert.cisa.gov/ncas/analysis-reports/ar21-084a)\n[9. AR21-084B: MAR-10329499-1.v1: China Chopper Webshell](https://us-cert.cisa.gov/ncas/analysis-reports/ar21-084b)\n[10. AR21-102A: MAR-10331466-1.v1: China Chopper Webshell](https://us-cert.cisa.gov/ncas/analysis-reports/ar21-102a)\n\n_(Updated March 13, 2021): A webshell is a script that can be uploaded to a compromised Microsoft Exchange Server to enable_\nremote administration of the machine. Webshells are utilized for the following purposes:\n\nTo harvest and exfiltrate sensitive data and credentials;\nTo upload additional malware for the potential of creating, for example, a watering hole for infection and scanning of further\nvictims;\nTo use as a relay point to issue commands to hosts inside the network without direct internet access;\nTo use as command-and-control infrastructure, potentially in the form of a bot in a botnet or in support of compromises to\nadditional external networks. This could occur if the adversary intends to maintain long-term persistence.\n\n_(Updated March 13, 2021): For more information, see TA15-314A Compromised Web Servers and Web Shells - Threat Awareness_\nand Guidance.\n\n[The majority of the TTPs in this section are sourced from a blog post from Volexity, a third-party cybersecurity firm. Note: the United](https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/)\nStates Government does not endorse any commercial product or service, including any subjects of analysis. Any reference to specific\ncommercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not constitute or imply\ntheir endorsement, recommendation, or favoring by the United States Government.\n\nVolexity has observed the following files as targets of `HTTP POST requests:`\n\n\n-----\n\nAdministrators should search the ECP server logs for the following string (or something similar):\n\n```\nS:CMD=Set-OabVirtualDirectory.ExternalUrl='\n\n```\n\nThe logs can be found at `<exchange install path>\\Logging\\ECP\\Server\\ .`\n\nTo determine possible webshell activity, administrators should search for `aspx files in the following paths:`\n\n`\\inetpub\\wwwroot\\aspnet_client\\` (any `.aspx file under this folder or sub folders)`\n\n`\\<exchange install path>\\FrontEnd\\HttpProxy\\ecp\\auth\\` (any file besides `TimeoutLogoff.aspx )`\n\n`\\<exchange install path>\\FrontEnd\\HttpProxy\\owa\\auth\\` (any file or modified file that is not part of a standard install)\n\n`\\<exchange install path>\\FrontEnd\\HttpProxy\\owa\\auth\\Current\\` (any `aspx` file in this folder or subfolders)\n\n`\\<exchange install path>\\FrontEnd\\HttpProxy\\owa\\auth\\<folder with version number>\\` (any `aspx` file in this\nfolder or subfolders)\n\nAdministrators should search in the `/owa/auth/Current directory for the following non-standard web log user-agents. These`\nagents may be useful for incident responders to look at to determine if further investigation is necessary.\n\nThese should not be taken as definitive IOCs:\n\n```\n(KHTML,+like+Gecko)+Chrome/51.0.2704.103+Safari/537.36\n\n```\n\nVolexity observed these user-agents in conjunction with exploitation to `/ecp/` URLs:\n```\n   ExchangeServicesClient/0.0.0.0\n   python-requests/2.19.1\n   python-requests/2.25.1\n\n```\nThese user-agents were also observed having connections to post-exploitation web-shell access:\n```\n   antSword/v2.1\n   Googlebot/2.1+(+http://www.googlebot.com/bot.html)\n   Mozilla/5.0+(compatible;+Baiduspider/2.0;++http://www.baidu.com/search/spider.html)\n\n```\nAs with the non-standard user-agents, responders can examine internet information services (IIS) logs from Exchange Servers to\nidentify possible historical activity. Also, as with the non-standard user agents, these should not be taken as definitive IOCs:\n```\n   POST /owa/auth/Current/\n   POST /ecp/default.flt\n   POST /ecp/main.css\n   POST /ecp/<single char>.js\n\n```\nVolexity has seen attackers leverage the following IP addresses. Although these are tied to virtual private servers (VPSs) servers and\nvirtual private networks (VPNs), responders should investigate these IP addresses on their networks and act accordingly:\n\n```\n203.160.69[.]66\n\n```\n\n-----\n\n```\n211.56.98[.]146\n\n```\n\nVolexity has also provided the following YARA signatures that can be run within your network to assist in finding signs of a\ncompromise.\n\nrule webshell_aspx_simpleseesharp : Webshell Unclassified\n{\nmeta:\nauthor = \"threatintel@volexity.com\"\ndate = \"2021-03-01\"\ndescription = \"A simple ASPX Webshell that allows an attacker to write further files to disk.\"\nhash = \"893cd3583b49cb706b3e55ecb2ed0757b977a21f5c72e041392d1256f31166e2\"\n\nstrings:\n$header = \"<%@ Page Language=\\\"C#\\\" %>\"\n$body = \"<% HttpPostedFile thisFile = Request.Files[0];thisFile.SaveAs(Path.Combine\"\n\ncondition:\n$header at 0 and\n$body and\nfilesize < 1KB\n}\n\nrule webshell_aspx_reGeorgTunnel : Webshell Commodity\n{\nmeta:\nauthor = \"threatintel@volexity.com\"\ndate = \"2021-03-01\"\ndescription = \"A variation on the reGeorg tunnel webshell\"\nhash = \"406b680edc9a1bb0e2c7c451c56904857848b5f15570401450b73b232ff38928\"\nreference = \"https://github.com/sensepost/reGeorg/blob/master/tunnel.aspx\"\n\nstrings:\n$s1 = \"System.Net.Sockets\"\n$s2 = \"System.Text.Encoding.Default.GetString(Convert.FromBase64String(StrTr(Request.Headers.Get\"\n// a bit more experimental\n$t1 = \".Split(‘|’)\"\n$t2 = \"Request.Headers.Get\"\n$t3 = \".Substring(\"\n$t4 = \"new Socket(\"\n$t5 = \"IPAddress ip;\"\n\ncondition:\nall of ($s*) or\nall of ($t*)\n}\n\n\n-----\n\nrule webshell_aspx_sportsball : Webshell Unclassified\n{\nmeta:\nauthor = \"threatintel@volexity.com\"\ndate = \"2021-03-01\"\ndescription = \"The SPORTSBALL webshell allows attackers to upload files or execute commands on the system.\"\nhash = \"2fa06333188795110bba14a482020699a96f76fb1ceb80cbfa2df9d3008b5b0a\"\n\nstrings:\n$uniq1 = \"HttpCookie newcook = new HttpCookie(\\\"fqrspt\\\", HttpContext.Current.Request.Form\"\n$uniq2 = \"ZN2aDAB4rXsszEvCLrzgcvQ4oi5J1TuiRULlQbYwldE=\"\n\n$var1 = \"Result.InnerText = string.Empty;\"\n$var2 = \"newcook.Expires = DateTime.Now.AddDays(\"\n$var3 = \"System.Diagnostics.Process process = new System.Diagnostics.Process();\"\n$var4 = \"process.StandardInput.WriteLine(HttpContext.Current.Request.Form[\\\"\"\n$var5 = \"else if (!string.IsNullOrEmpty(HttpContext.Current.Request.Form[\\\"\"\n$var6 = \"<input type=\\\"submit\\\" value=\\\"Upload\\\" />\"\n\ncondition:\nany of ($uniq*) or\nall of ($var*)\n}\nA list of webshell hashes have also been provided by Microsoft:\n```\n   b75f163ca9b9240bf4b37ad92bc7556b40a17e27c2b8ed5c8991385fe07d17d0\n   097549cf7d0f76f0d99edf8b2d91c60977fd6a96e4b8c3c94b0b1733dc026d3e\n   2b6f1ebb2208e93ade4a6424555d6a8341fd6d9f60c25e44afe11008f5c1aad1\n   65149e036fff06026d80ac9ad4d156332822dc93142cf1a122b1841ec8de34b5\n   511df0e2df9bfa5521b588cc4bb5f8c5a321801b803394ebc493db1ef3c78fa1\n   4edc7770464a14f54d17f36dc9d0fe854f68b346b27b35a6f5839adf1f13f8ea\n   811157f9c7003ba8d17b45eb3cf09bef2cecd2701cedb675274949296a6a183d\n   1631a90eb5395c4e19c7dbcbf611bbe6444ff312eb7937e286e4637cb9e72944\n\n```\n**Note: this is not an all-inclusive list of indicators of compromise and threat actors have been known to use short-term leased IP**\naddresses that change very frequently. Organizations that do not locate any of the IOCs in this Alert within your network traffic, may\n[nevertheless have been compromised. CISA recommends following the guidance located in the Microsoft Advisory to check your](https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/)\nservers for any signs of a compromise.\n\n## Conduct Forensic Analysis\n\nShould your organization see evidence of compromise, your incident response should begin with conducting forensic analysis to\ncollect artifacts and perform triage. Please see the following list of recommendations on how to conduct forensic analysis using\nvarious tools.\n\nAlthough the following free tools are not endorsed by the Federal Government, incident responders commonly use them to perform\nforensics.\n\nWhile collecting artifacts to perform triage, use processes and tools that minimize the alteration of the data being collected and that\nminimize impact to the operating system itself.\n\nIdeally, during data collection, store the data on removable/external media and, when possible, run the artifact collection tools from\nthe same media.\n\nKey artifacts for triage that should be collected:\n\nMemory\nAll registry hives\nAll windows event logs\nAll web logs\n\n\n-----\n\nMemory can be collected with a variety of open source tools (e.g., FTK Imager by AccessData, Ram Capture by Belkasoft).\n\nRegistry and Windows Event logs can be collected with a variety of open source tools as well (e.g., FTK_Imager, Kroll Artifact Parser\nAnd Extractor [KAPE]).\n\nWeb logs can also be collected with a variety of open source tools (e.g., FTK Imager).\n\n**Windows Artifact Collection Guide**\n\nExecute the following steps in order.\n\n**1) Download the latest FTK Imager from** [https://accessdata.com/product-download/.](https://accessdata.com/product-download/)\n\n**Note: Ensure your review of and compliance with the applicable license associated with the product referenced, which can be**\nfound in the product’s User Guide. The United States Government does not endorse any commercial product or service,\nincluding any subjects of analysis. Any reference to specific commercial products, processes, or services by service mark,\ntrademark, manufacturer, or otherwise, does not constitute or imply their endorsement, recommendation, or favoring by the\nUnited States Government.\n\n**2) Collect memory from live system using FTK Imager. See Memory Capture with FTK Imager.pdf for instructions. Note:**\nDownload and copy “FTK Imager” folder to an external drive. Run FTK Imager.exe from the FTK Imager folder from external drive.\nWait until memory collect is complete before proceeding to step 2.\n\n**3) Collect important system artifacts using KAPE. See KAPE Collection Procedure. Note: Download KAPE from a separate**\nsystem; do not download KAPE to the target system. Run KAPE from external drive.\n\n**4) Collect disk image using FTK Imager. See Live Image with FTK Imager.pdf for instructions. Note: Run FTK Imager.exe from the**\n“FTK Imager” folder from external drive.\n\n**Memory Capture with FTK Imager**\n\n**1) Open FTK Imager. Log into the system with Administrator privileges and launch “FTK Imager.”**\n\n**Note: Ensure your review of and compliance with the applicable license associated with the product referenced. The United**\nStates Government does not endorse any commercial product or service, including any subjects of analysis. Any reference to\nspecific commercial products, processes, or services by service mark, trademark, manufacturer, or otherwise, does not\nconstitute or imply their endorsement, recommendation, or favoring by the United States Government.\n\n**2) Open “Capture Memory.\" Select “Capture Memory…” from the File menu.**\n\n_Figure 1: FTK Imager – Capture Memory Command_\n\n\n-----\n\n**3) Select Path and Filenames. On the window that appears, use the Browse button to identify the destination of the memory**\ncapture. Save the memory capture to an external device and not the main hard drive of the system. Doing so will prevent the saved\nfile from overwriting any dataspace on the system.\n\nName the destination file with a descriptive name (i.e., hostname of the system).\nSelect the box “Include pagefile” and provide a name of the pagefile that is descriptive of the system.\nDo not select “Create AD1 file.”\n\n_Figure 2: FTK Imager – Memory Capture_\n\n**4) Capture Memory. Click on “Capture Memory” to begin the capture process. The process will take several minutes depending on**\nthe size of the pagefile and the amount of memory on the system.\n\n_Figure 3: FTK Imager – Capture Process_\n\n**[KAPE Collection Procedure [1]](https://ericzimmerman.github.io/KapeDocs/#!Pages%5C2.-Getting-started.md)**\n\n[1) Download KAPE from https://www.kroll.com/en/services/cyber-risk/investigate-and-respond/kroll-artifact-parser-extractor-kape.](https://www.kroll.com/en/services/cyber-risk/investigate-and-respond/kroll-artifact-parser-extractor-kape)\n\n2) Disable any antivirus or host protection mechanisms that prevent execution from removable media, or data loss prevention (DLP)\nmechanisms that restrict utilization of removable media.\n\nEnable antivirus and host protection once this process is completed.\n\n3) Unzip Kape.zip and run gkape.exe as admin from your removable media\n\n4) Target source should be the drive on which the OS resides, typically C:.\n\n5) Target destination should be an external drive folder, not the same drive as the Target source. If available, use an external hard\ndrive or flash drive.\n\nA KAPE execution with these parameters will typically produce output artifacts with a total size of 1-25 GB.\n\n\n-----\n\nIf you are going to be running KAPE on different machines and want to save to the same drive, ensure the Target destination\nfolder is unique for each execution of KAPE.\n\n6) Uncheck Flush checkbox (it is checked natively).\n\n7) Check Add %d and Add %m checkboxes.\n\n8) Select ALL checkboxes to ensure KAPE will target all available data that it is capable of targeting. This takes some time; use the\ndown arrow and space bar to move through the list quickly.\n\n9) Check Process VSCs checkbox.\n\n10) Select Zip radio button and add Base name TargetOutput.\n\n11) Ensure Deduplicate checkbox is checked (it is checked natively).\n\nAt the bottom you should now see a large Current command line, similar to:\n\n.\\kape.exe --tsource C: --tdest E:\\%d%m --tflush --target\n!BasicCollection,!SANS_Triage,Avast,AviraAVLogs,Bitdefender,ComboFix,ESET,FSecure,HitmanPro,Malwarebytes,\nMcAfee,McAfee_ePO,RogueKiller,SentinelOne,Sophos,SUPERAntiSpyware,Symantec_AV_Logs,TrendMicro,VIPRE,\nWebroot,WindowsDefender,Ammyy,AsperaConnect,BoxDrive,CiscoJabber,CloudStorage,ConfluenceLogs,Discord, Dropbox,\nExchange,ExchangeClientAccess,ExchangeTransport,FileZilla,GoogleDrive,iTunesBackup,JavaWebCache,Kaseya,LogMeIn,Notepad++,\nOneDrive,OutlookPSTOST,ScreenConnect,Skype,TeamViewerLogs,TeraCopy,VNCLogs,\nChrome,ChromeExtensions,Edge,Firefox,InternetExplorer,WebBrowsers,ApacheAccessLog,IISLogFiles,ManageEngineLogs,\nMSSQLErrorLog,NGINXLogs,PowerShellConsole,KapeTriage,MiniTimelineCollection,RemoteAdmin, VirtualDisks,\nGigatribe,TorrentClients,Torrents,$Boot,$J,$LogFile,$MFT,$SDS,$T,Amcache,ApplicationEvents,BCD,CombinedLogs,\nEncapsulationLogging,EventLogs,EventLogs-RDP,EventTraceLogs,\nEvidenceOfExecution,FileSystem,GroupPolicy,LinuxOnWindowsProfileFiles,LnkFilesAndJumpLists,LogFiles,MemoryFiles,\nMOF,OfficeAutosave,OfficeDocumentCache,Prefetch,RDPCache,RDPLogs,RecentFileCache,Recycle, RecycleBin,\nRecycleBinContent,RecycleBinMetadata,RegistryHives,RegistryHivesSystem,RegistryHivesUser,ScheduledTasks,SDB,\nSignatureCatalog,SRUM,StartupInfo,Syscache,ThumbCache,USBDevicesLogs,WBEM,WER,WindowsFirewall,\nWindowsIndexSearch,WindowsNotifcationsDB,WindowsTimeline,XPRestorePoints --vss --zip TargetOutput –gui\n\nIn the bottom right corner hit the Execute! Button.\nScreenshot below shows `gkape.exe during execution, you will also see a command window execute. Note: KAPE usually`\ntakes less than 20 minutes to complete on a workstation; if it is taking significantly longer there may be an issue.\n\n_Figure 4: gkape.exe screenshot_\n\n## Mitigations\n\n[CISA strongly recommends organizations read Microsoft’s advisory and](https://msrc-blog.microsoft.com/2021/03/02/multiple-security-updates-released-for-exchange-server/) [security blog post for more information on how to look for this](https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/)\nmalicious activity and to apply critical patches as soon as possible.\n\n\n-----\n\n_(Updated March 4, 2021): CISA is aware of threat actors using open source tools to search for vulnerable Microsoft Exchange_\nServers. This particular type of attack is scriptable, allowing attackers to easily exploit vulnerabilities through automated mechanisms.\nCISA advises all entities to patch as soon as possible to avoid being compromised.\n\n_(Updated March 4, 2021): From_ [Microsoft's patch release, the security updates are available for the following operating systems:](https://techcommunity.microsoft.com/t5/exchange-team-blog/released-march-2021-exchange-server-security-updates/ba-p/2175901)\n\nExchange Server 2010 (update requires SP 3 or any SP 3 RU – this is a Defense in Depth update)\nExchange Server 2013 (update requires CU 23)\nExchange Server 2016 (update requires CU 19 or CU 18)\nExchange Server 2019 (update requires CU 8 or CU 7)\n\n_(Updated March 4, 2021): If you are running an older CU then what the patch will accept, you must upgrade to at least the required_\nCU as stated above then apply the patch.\n\n_(Updated March 4, 2021): All patches must be applied using administrator privileges._\n\n_(Updated March 5, 2021): If patching is not an immediate option, CISA strongly recommends following alternative mitigations found in_\n[Microsoft’s blog on Exchange Server Vulnerabilities Mitigations. However, these options should only be used as a temporary solution,](https://msrc-blog.microsoft.com/2021/03/05/microsoft-exchange-server-vulnerabilities-mitigations-march-2021/)\nnot a replacement for patching. Additionally, there are other mitigation options available. CISA recommends limiting or blocking\nexternal access to internet-facing Exchange Servers via the following:\n\nRestrict untrusted connections to port 443, or set up a VPN to separate the Exchange Server from external access; note that\nthis will not prevent an adversary from exploiting the vulnerability if the attacker is already in your network.\nBlock external access to on-premises Exchange:\n\nRestrict external access to OWA URL: `/owa/ .`\nRestrict external access to Exchange Admin Center (EAC) aka Exchange Control Panel (ECP) URL: /ecp/ .\n\n_(Updated March 4, 2021): Disconnect vulnerable Exchange servers from the internet until a patch can be applied._\n\nCISA would like to thank Microsoft and Volexity for their contributions to this Alert.\n\n## Resources\n\n(Updated April 14, 2021) Microsoft's April 2021 Security Update that mitigates significant vulnerabilities affecting on-premises\nExchange Server 2013, 2016, and 2019.\n_[(Updated March 12, 2021) Check my OWA tool for checking if a system has been affected. Disclaimer: this tool does not check](https://checkmyowa.unit221b.com/)_\n_against an exhaustive list of compromised domains. It is meant for informational purposes only. The United States Government_\n_does not provide any warranties of any kind regarding this information and cannot assure its accuracy or completeness;_\n_therefore, entities should not rely solely on this information to justify foregoing CISA’s recommendations for action described on_\n_this webpage._\nMicrosoft Advisory: [https://msrc-blog.microsoft.com/2021/03/02/multiple-security-updates-released-for-exchange-server/](https://msrc-blog.microsoft.com/2021/03/02/multiple-security-updates-released-for-exchange-server/)\nMicrosoft Security Blog - Hafnium targeting Exchange Servers: https://www.microsoft.com/security/blog/2021/03/02/hafniumtargeting-exchange-servers/\n[Volexity Blog: https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/](https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/)\nMicrosoft’s blog on Exchange Server Vulnerabilities Mitigations: https://msrc-blog.microsoft.com/2021/03/05/microsoftexchange-server-vulnerabilities-mitigations-march-2021/\n\n## References\n\n[Eric Zimmerman: KAPE Documentation](https://ericzimmerman.github.io/KapeDocs/#!Pages%5C2.-Getting-started.md)\n[Emergency Directive 21-02: Mitigate Microsoft Exchange On-Premises Product Vuln…](https://cyber.dhs.gov/ed/21-02/)\n[Supplemental Direction V1 to Emergency Directive 21-02: Mitigate Microsoft Exch…](https://cyber.dhs.gov/ed/21-02/#supplemental-direction)\n[Supplemental Direction V2 to Emergency Directive 21-02: Mitigate Microsoft Exch…](https://cyber.dhs.gov/ed/21-02/#supplemental-direction-v2)\n\n## Revisions\n\nMarch 3, 2021: Initial Version\n\nMarch 4, 2020: Updated Mitigations and Technical Details sections\n\nMarch 5, 2021: Updated Mitigations Guidance from Microsoft\n\nMarch 10, 2021: Updated TTP Section\n\n\n-----\n\nMarch 12, 2021: Updated Resources Section\n\nMarch 12, 2021: Added information on DearCry Ransomware\n\nMarch 13, 2021: Added seven China Chopper Webshell MARs\n\nMarch 14, 2021: Updated information on DearCry Ransomware\n\nMarch 16, 2021: Added information on EOMT tool\n\nMarch 25, 2021: Added two China Chopper Webshell MARs\n\nMarch 25, 2021: Updated MARs to include YARA Rules\n\nMarch 31, 2021: Added links to ED 21-02 and ED 21-02 Supplemental Direction\n\nApril 12, 2021: Added one China Chopper Webshell MAR and one DearCry Ransomware MAR\n\nApril 13, 2021: Added links to Microsoft's April 2021 Security Update and ED 21-02 Supplemental Direction V2\n\nApril 14, 2021: Added Exchange Server 2013 to list of on-premises Exchange Servers affected by the vulnerabilities dislcosed on\nApril 13, 2021.\n\nJuly 19, 2021: Added attribution note\n\n[This product is provided subject to this Notification and this](https://us-cert.cisa.gov/privacy/notification) [Privacy & Use policy.](https://www.dhs.gov/privacy-policy)\n\n**Please share your thoughts.**\n\n[We recently updated our anonymous product survey; we'd welcome your feedback.](https://www.surveymonkey.com/r/CISA-cyber-survey?product=https://us-cert.cisa.gov/ncas/alerts/aa21-062a)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-03 - Alert (AA21-062A)- Mitigate Microsoft Exchange Server Vulnerabilities.pdf"
    ],
    "report_names": [
        "2021-03-03 - Alert (AA21-062A)- Mitigate Microsoft Exchange Server Vulnerabilities.pdf"
    ],
    "threat_actors": [
        {
            "id": "529c1ae9-4579-4245-86a6-20f4563a695d",
            "created_at": "2022-10-25T16:07:23.702006Z",
            "updated_at": "2025-03-27T02:02:09.93109Z",
            "deleted_at": null,
            "main_name": "Hafnium",
            "aliases": [
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "ETDA:Hafnium",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7c969685-459b-4c93-a788-74108eab6f47",
            "created_at": "2023-01-06T13:46:39.189751Z",
            "updated_at": "2025-03-27T02:00:03.017103Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "ATK233",
                "G0125",
                "Operation Exchange Marauder",
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "MISPGALAXY:HAFNIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2704d770-43b4-4bc4-8a5a-05df87416848",
            "created_at": "2022-10-25T15:50:23.306305Z",
            "updated_at": "2025-03-27T02:00:55.43633Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "HAFNIUM",
                "Operation Exchange Marauder",
                "Silk Typhoon"
            ],
            "source_name": "MITRE:HAFNIUM",
            "tools": [
                "Tarrask",
                "ASPXSpy",
                "Impacket",
                "PsExec",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "760f2827-1718-4eed-8234-4027c1346145",
            "created_at": "2023-01-06T13:46:38.670947Z",
            "updated_at": "2025-03-27T02:00:02.888195Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Thallium",
                "G0086",
                "APT43",
                "Springtail",
                "Sparkling Pisces",
                "Velvet Chollima",
                "Black Banshee",
                "Operation Stolen Pencil",
                "Emerald Sleet",
                "THALLIUM"
            ],
            "source_name": "MISPGALAXY:Kimsuky",
            "tools": [
                "RevClient",
                "xrat",
                "QUASARRAT",
                "RDP Wrapper",
                "TightVNC",
                "BabyShark"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "191d7f9a-8c3c-442a-9f13-debe259d4cc2",
            "created_at": "2022-10-25T15:50:23.280374Z",
            "updated_at": "2025-03-27T02:00:55.423485Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "Kimsuky",
                "Black Banshee",
                "Velvet Chollima",
                "Emerald Sleet",
                "THALLIUM",
                "APT43",
                "TA427"
            ],
            "source_name": "MITRE:Kimsuky",
            "tools": [
                "schtasks",
                "Amadey",
                "Brave Prince",
                "CSPY Downloader",
                "gh0st RAT",
                "AppleSeed",
                "NOKKI",
                "QuasarRAT",
                "Gold Dragon",
                "PsExec",
                "KGH_SPY",
                "Mimikatz",
                "BabyShark"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "71a1e16c-3ba6-4193-be62-be53527817bc",
            "created_at": "2022-10-25T16:07:23.753455Z",
            "updated_at": "2025-03-27T02:02:09.963016Z",
            "deleted_at": null,
            "main_name": "Kimsuky",
            "aliases": [
                "APT 43",
                "Black Banshee",
                "Emerald Sleet",
                "ITG16",
                "KTA082",
                "Kimsuky",
                "Larva-24005",
                "Operation Baby Coin",
                "Operation Covert Stalker",
                "Operation DEEP#DRIVE",
                "Operation DEEP#GOSU",
                "Operation Kabar Cobra",
                "Operation Mystery Baby",
                "Operation Red Salt",
                "Operation Smoke Screen",
                "Operation Stealth Power",
                "Operation Stolen Pencil",
                "SharpTongue",
                "Sparkling Pisces",
                "Springtail",
                "TA406",
                "TA427",
                "Thallium",
                "UAT-5394",
                "Velvet Chollima"
            ],
            "source_name": "ETDA:Kimsuky",
            "tools": [
                "AngryRebel",
                "AppleSeed",
                "BITTERSWEET",
                "BabyShark",
                "BoBoStealer",
                "CSPY Downloader",
                "Farfli",
                "FlowerPower",
                "Gh0st RAT",
                "Ghost RAT",
                "Gold Dragon",
                "GoldDragon",
                "GoldStamp",
                "JamBog",
                "KGH Spyware Suite",
                "KGH_SPY",
                "KPortScan",
                "KimJongRAT",
                "Kimsuky",
                "LATEOP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Lovexxx",
                "MailPassView",
                "Mechanical",
                "Mimikatz",
                "MoonPeak",
                "Moudour",
                "MyDogs",
                "Mydoor",
                "Network Password Recovery",
                "PCRat",
                "ProcDump",
                "PsExec",
                "ReconShark",
                "Remote Desktop PassView",
                "SHARPEXT",
                "SWEETDROP",
                "SmallTiger",
                "SniffPass",
                "TODDLERSHARK",
                "TRANSLATEXT",
                "Troll Stealer",
                "TrollAgent",
                "VENOMBITE",
                "WebBrowserPassView",
                "xRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536006,
    "ts_updated_at": 1743041523,
    "ts_creation_date": 1653691833,
    "ts_modification_date": 1653691833,
    "files": {
        "pdf": "https://archive.orkl.eu/dc2081ff6bbea271f1c4b2728cb2ec7d1f9a22c5.pdf",
        "text": "https://archive.orkl.eu/dc2081ff6bbea271f1c4b2728cb2ec7d1f9a22c5.txt",
        "img": "https://archive.orkl.eu/dc2081ff6bbea271f1c4b2728cb2ec7d1f9a22c5.jpg"
    }
}