{
    "id": "66ee183b-a685-4fdf-a356-4496132c01df",
    "created_at": "2023-01-12T15:00:37.41372Z",
    "updated_at": "2025-03-27T02:15:47.927991Z",
    "deleted_at": null,
    "sha1_hash": "8d2d21dd75307d2906fb5bb46fc23770b7def315",
    "title": "2020-03-26 - Would You Exchange Your Security for a Gift Card-",
    "authors": "",
    "file_creation_date": "2022-05-27T21:07:40Z",
    "file_modification_date": "2022-05-27T21:07:40Z",
    "file_size": 2367706,
    "plain_text": "# Would You Exchange Your Security for a Gift Card?\n\n**[trustwave.com/en-us/resources/blogs/spiderlabs-blog/would-you-exchange-your-security-for-a-gift-card/](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/would-you-exchange-your-security-for-a-gift-card/)**\n\nUPDATED 27.March.2020\n\n## Overview\n\nWe often talk about attackers targeting companies with social engineering attacks. These\nusually take the form of phishing attacks that attempt to trick the recipient into opening a\nmalicious attachment or clicking on a malicious link. Less discussed are targeted attacks\nusing physical media. Penetration Testers that perform physical \"pentests\" are well versed\nin dropping \"malicious\" USB sticks in a target's parking lot or waiting room. More complex\nare so-called \"Rubber Ducky\" (https://github.com/hak5darren/USB-Rubber-Ducky/wiki)\nattacks, where what looks like a USB stick is actually, in effect, a malicious USB keyboard\npreloaded with keystrokes. Those types of attacks are typically so explicitly targeted that it's\nrare to find them coming from actual attackers in the wild. Rare, but still out there.\n\n## The Attack\n\nThis letter was supposedly from Best Buy giving out a $50 gift card to its loyal customers.\nIncluded in this letter is seemingly a USB drive that claims to contain a list of items to spend\non. Very nice gesture!\n\n\n-----\n\nFigure 1. Suspicious Best Buy gift card containing a malicious USB device\n\nOne of our digital forensics and incident response retainer clients brought this device to our\nattention. One of their business associates received this suspicious letter. Fortunately, our\nclient and their associate did not plug the drive into any computer. Thank you, security\n\n\n-----\n\ntraining!\n\n## Analysis\n\nTo start the analysis, we inspected the drive for inscriptions such as serial numbers. At the\nhead of the drive on the printed circuit board we saw “HW-374”. A quick Google search for\nthis string found a “BadUSB Leonardo USB ATMEGA32U4” for sale on shopee.tw.\n\nFigure 2: The website images matched the drive that the client received!\n\nThis USB device uses an Arduino microcontroller ATMEGA32U4 and was programmed to\nemulate a USB keyboard. Since PCs trust keyboard USB devices by default, once it is\nplugged in, the keyboard emulator can automatically inject malicious commands.\n\nTo quickly get the payload off the USB drive we connected it to an air-gapped laptop that\nhad Ubuntu installed while Wireshark captured traffic on the third USB bus and the active\nwindow was set Vim. We figured Vim could act as a rudimentary jail to capture traffic and\nthat the intended target is the Windows OS. Sure enough, we were presented with the\nfollowing payload.\n\n## Powershell Payload\n\n\n-----\n\nFigure 3. Payload was intercepted through VIM and reveals an obfuscated PowerShell\nscript\n\nDe-obfuscating the PowerShell command is a simple mono substitution cipher by which the\ncipher text ASCII table is shifted 1 step to the left. For example, to decode the character ‘j’\ncan be done by shifting 1 step backward and is equal to ‘i’, for ‘f’ is substituted by ‘e’ then ‘y’\n= ‘x’ so on and so forth.\n\nFigure 4. PowerShell command deobfuscated using CyberChef\n\nThe de-obfuscated string reveals a command that downloads the second stage PowerShell\ncode from hxxps://milkmovemoney[.]com/st/mi.ini.\n\n_Figure 5. Downloaded 2nd Stage Powershell Code_\n\n\n-----\n\nFigure 6\n\nTo summarize, this is the second stage PowerShell execution flow:\n\n1. Copy wscript.exe to %AppData%\\Microsoft\\Windows\\wipre.exe\n2. Decode a JScript command and save it as prada.txt\n3. Execute prada.txt with the command “cmd.exe /c wipre.exe /e:jscript prada.txt”\n4. Show a fake message box warning\n\nFigure 7. A convincing fake message box pops up\n\n## Javascript Payload\n\nThe Jscript code saved to prada.txt is the third stage payload. This is executed using the\nWindows built-in script host engine - wscript.exe.\n\n\n-----\n\nFigure 8. de-obfuscated JScript saved as Prada.txt\n\nThe Jscript is mildly obfuscated using a simple variable substitution. The main function of\nthis script is to register the infected host to the command and control (C&C) server with a\nunique ID, then in return, it receives an additional JScript code that is executed using eval()\nfunction.\n\nBelow is the step by step execution flow of the Jscript code:\n\n1. Generates a unique ID by getting the current UTC milliseconds\n2. Check if the script is in the folder %AppData%\\Microsoft\\Windows and delete itself if it\n\nis not\n3. Delay execution for 2 minutes\n\n\n-----\n\n4. Generate a data containing the following information:\n\n1. group : f1 (hardcoded)\n2. rt : 2 (hardcoded)\n3. secret : secret hash (hardcoded)\n4. time : 120000\n5. uniq_id : current UTC milliseconds\n6. id : MAC address and hostname (using WMI query)\n5. URL encode the data and XOR encode it using a random generated key.\n6. Append the generated XOR key to the encoded data delimited with “&_&”\n7. Form a HTTP POST body containing the parameter.\n\n1. kbaxmaconhuc=<encoded data+generated XOR key>\n8. Form a URL path:\n\n1. https://<command and control domain>/<random path>/<random file>/?\n\ntype=name\n9. Send the data to the command and control URL as a HTTP POST raw body and\n\nusing the following HTTP request header:\n\n1. User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:69.0)\n\nGecko/20100101 Firefox/50.0'\n2. Content-Type: %application/x-www-form-urlencoded'\n10. Command and control responds an encoded JScript code\n\n11. Decode and execute Jscript code using eval()\n\nIn the event that the C&C server is alive, it will respond with an encoded data as shown in\nfigure 9. The encoded data includes a XOR key to decode it. Data and the key is delimited\nwith “&_&” or URL encoded “%26_%26”. The decoded data reveals an additional Jscript\ncode that will be executed in the infected host.\n\nFigure 9: The C&C server responded with this encoded data\n\n\n-----\n\nThe JScript code could be anything. But when we decoded it, it reveals a code that gathers\nsystem information from the infected host.\n\nFigure 10: The deobfuscated JScript code that was part of the code sent by the C&C server\n\nThe following information is collected, encoded then sent back to the C&C server:\n\nUsername\nHostname\nUser’s System Privilege\n\n\n-----\n\nUses WMI query to get the:\n\nProcess owner\nDomain name\nComputer model\nOperating system information\n\nOS name\nOS build\nOS version\nMemory capacity\nFree memory available\nOS registered user\nOS registered organization\nOS serial number\nLast boot up time\nInstall date\nOS architecture\nOS product type\nLanguage code\nTime zone\nNumber of users\nDesktop monitor type\nDesktop resolution\nUAC level privilege\nOffice and Adobe acrobat installation\nList of running Processes (including PID)\nWhether the infected host is running in a virtualized environment\n\nAfter this gathered information is sent to C&C server. The main Jscript code enters an\ninfinite loop sleeping for 2 minutes in each loop iteration then getting a new command from\nthe command and control. Here is the full attack flow:\n\n\n-----\n\n_Figure 11: Attack Flow_\n\n## Conclusion\n\nIn summary, once a USB controller chip is reprogrammed to unintended use (in this case as\nan emulated USB keyboard) these devices could be used to launch an attack and infect\nunsuspecting users’ computer without them realizing it.\n\nThese types of USB devices are widely known and used by security professionals. The fact\nthat they are also cheap and readily available to anyone meant that it was just a matter of\ntime to see this technique used by criminals \"in the wild.\" Since USB devices are\nubiquitous, used, and seen everywhere, some consider them innocuous and safe. Others\ncan be very curious about the contents of an unknown USB device. If this story teaches us\nanything, it's that one should never trust such a device.\n\n## IOCs\n```\nbece1545132af25c68777fade707046c (2nd stage Powershell)\n\n```\n```\n84d77a3b76ac690ce7a60199c88ceeb5 (prada.txt)\n\n```\n\n## UPDATE 27.March.2020:\n\n\n-----\n\nSince our initial publication, we ve received confirmation from multiple sources that this\ncampaign matches IOCs from similar campaigns from FIN7\n[(https://attack.mitre.org/groups/G0046/). FIN7 is a cybercriminal collective that has been](https://attack.mitre.org/groups/G0046/)\ntargeting the hospitality and retail sectors since at least 2015.\n\n\n-----\n\n-----\n\nIn addition, anyone who receives a suspicious USB drive under similar circumstances,\nshould contact their local FBI office at [https://www.fbi.gov/contact-us/field-offices.](https://www.fbi.gov/contact-us/field-offices)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-03-26 - Would You Exchange Your Security for a Gift Card-.pdf"
    ],
    "report_names": [
        "2020-03-26 - Would You Exchange Your Security for a Gift Card-.pdf"
    ],
    "threat_actors": [
        {
            "id": "ab9d6b30-7c60-4d0b-8f49-e2e913c28508",
            "created_at": "2022-10-25T16:07:24.584775Z",
            "updated_at": "2025-03-27T02:02:10.289029Z",
            "deleted_at": null,
            "main_name": "UNC1878",
            "aliases": [],
            "source_name": "ETDA:UNC1878",
            "tools": [
                "Agentemis",
                "BEERBOT",
                "BazarBackdoor",
                "BazarCall",
                "BazarLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "KEGTAP",
                "Ryuk",
                "Team9Backdoor",
                "bazaloader",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "63061658-5810-4f01-9620-7eada7e9ae2e",
            "created_at": "2022-10-25T15:50:23.752974Z",
            "updated_at": "2025-03-27T02:00:55.538582Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "Wizard Spider",
                "UNC1878",
                "TEMP.MixMaster",
                "Grim Spider",
                "FIN12",
                "GOLD BLACKBURN",
                "ITG23",
                "Periwinkle Tempest",
                "DEV-0193"
            ],
            "source_name": "MITRE:Wizard Spider",
            "tools": [
                "TrickBot",
                "AdFind",
                "BITSAdmin",
                "Bazar",
                "LaZagne",
                "Nltest",
                "GrimAgent",
                "Dyre",
                "Ryuk",
                "Conti",
                "Emotet",
                "Rubeus",
                "Mimikatz",
                "Diavol",
                "PsExec",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "0a4f4edc-ea8c-4a30-8ded-35394e29de01",
            "created_at": "2023-01-06T13:46:39.178183Z",
            "updated_at": "2025-03-27T02:00:03.014032Z",
            "deleted_at": null,
            "main_name": "UNC1878",
            "aliases": [],
            "source_name": "MISPGALAXY:UNC1878",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bfded1cf-be73-44f9-a391-0751c9996f9a",
            "created_at": "2022-10-25T15:50:23.337107Z",
            "updated_at": "2025-03-27T02:00:55.445946Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "FIN7",
                "GOLD NIAGARA",
                "ITG14",
                "Carbon Spider",
                "ELBRUS",
                "Sangria Tempest"
            ],
            "source_name": "MITRE:FIN7",
            "tools": [
                "Mimikatz",
                "AdFind",
                "JSS Loader",
                "HALFBAKED",
                "REvil",
                "PowerSploit",
                "CrackMapExec",
                "Carbanak",
                "Pillowmint",
                "Cobalt Strike",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRat",
                "Lizar",
                "TEXTMATE",
                "BOOSTWRITE"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "bb8702c5-52ac-4359-8409-998a7cc3eeaf",
            "created_at": "2023-01-06T13:46:38.405479Z",
            "updated_at": "2025-03-27T02:00:02.82533Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "JokerStash",
                "ATK32",
                "G0046",
                "Coreid",
                "Carbanak",
                "Sangria Tempest",
                "CARBON SPIDER",
                "GOLD NIAGARA",
                "G0008",
                "ELBRUS",
                "Carbon Spider"
            ],
            "source_name": "MISPGALAXY:FIN7",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d85adfe3-e1c3-40b0-b8bb-d1bacadc4d82",
            "created_at": "2022-10-25T16:07:23.619566Z",
            "updated_at": "2025-03-27T02:02:09.890982Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "APT-C-11",
                "ATK 32",
                "Gold Niagara",
                "ITG14",
                "TAG-CR1"
            ],
            "source_name": "ETDA:FIN7",
            "tools": [
                "7Logger",
                "Agentemis",
                "Anunak",
                "Astra",
                "BIOLOAD",
                "BIRDWATCH",
                "Bateleur",
                "Boostwrite",
                "CROWVIEW",
                "Carbanak",
                "Cobalt Strike",
                "CobaltStrike",
                "DICELOADER",
                "DNSMessenger",
                "FOWLGAZE",
                "HALFBAKED",
                "JSSLoader",
                "KillACK",
                "LOADOUT",
                "Lizar",
                "Meterpreter",
                "Mimikatz",
                "POWERPLANT",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "TEXTMATE",
                "Tirion",
                "VB Flash",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535637,
    "ts_updated_at": 1743041747,
    "ts_creation_date": 1653685660,
    "ts_modification_date": 1653685660,
    "files": {
        "pdf": "https://archive.orkl.eu/8d2d21dd75307d2906fb5bb46fc23770b7def315.pdf",
        "text": "https://archive.orkl.eu/8d2d21dd75307d2906fb5bb46fc23770b7def315.txt",
        "img": "https://archive.orkl.eu/8d2d21dd75307d2906fb5bb46fc23770b7def315.jpg"
    }
}