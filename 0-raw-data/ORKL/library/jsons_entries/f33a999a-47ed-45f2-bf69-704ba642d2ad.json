{
    "id": "f33a999a-47ed-45f2-bf69-704ba642d2ad",
    "created_at": "2023-01-12T15:09:23.270866Z",
    "updated_at": "2025-03-27T02:16:25.778505Z",
    "deleted_at": null,
    "sha1_hash": "4da1ff457c19b77ead64aa62023add1df947af18",
    "title": "2021-10-21 - Stopping GRACEFUL SPIDER- Falcon Complete’s Fast Response to Recent SolarWinds Serv-U Exploit Campaign",
    "authors": "",
    "file_creation_date": "2022-05-27T22:52:24Z",
    "file_modification_date": "2022-05-27T22:52:24Z",
    "file_size": 1962249,
    "plain_text": "# How Falcon Complete Stopped a SolarWinds Serv-U Exploit Campaign\n\n**[crowdstrike.com/blog/how-falcon-complete-stopped-a-solarwinds-serv-u-exploit-campaign/](https://www.crowdstrike.com/blog/how-falcon-complete-stopped-a-solarwinds-serv-u-exploit-campaign/)**\n\nAlex Clinton - Tasha Robinson October 21, 2021\n\n[This blog describes how the CrowdStrike Falcon Complete™ team quickly responded to a](https://www.crowdstrike.com/endpoint-security-products/falcon-complete/)\nrecent campaign involving the SolarWinds Serv-U product exploitation. SolarWinds issued a\n[public notice of the vulnerability in July 2021 along with releasing a hotfix to mitigate the](https://www.solarwinds.com/trust-center/security-advisories/cve-2021-35211)\n[exploit. The National Vulnerability Database has more details, found here: CVE-2021-35211.](https://nvd.nist.gov/vuln/detail/CVE-2021-35211#vulnCurrentDescriptionTitle)\n\nThe Falcon Complete team identified active implants at multiple customers and neutralized\nthe threat by performing network containment of the affected systems, preventing any further\nlateral movement or follow-on activity. Investigation revealed that the threat actor attempted\n[to deploy additional tooling, which likely indicated preparation for ransomware. One of the](https://www.crowdstrike.com/cybersecurity-101/ransomware/)\nunique artifacts about this campaign is the multi-stage Component Object Model (COM)\npersistence mechanism used, allowing an attacker to execute arbitrary code on behalf of a\ntrusted process. Although machine-based detections are highly effective at uncovering\nintrusion activity, today’s sophisticated adversaries can fly under the radar by abusing trusted\nprocesses to gain access to an environment, underscoring the need for human expertise in\ntracking and neutralizing threats.\n\n\n-----\n\nThe events outlined in this blog have been attributed to the GRACEFUL SPIDER adversary\ngroup by CrowdStrike Intelligence. GRACEFUL SPIDER is suspected to be operating out of\nEastern Europe and Russia. They have typically been seen targeting companies in a variety\nof sectors across the world. The common monetization techniques are requiring ransom\npayments through cryptocurrency, extorting stolen data if the ransom is not paid, engaging in\nmonetary theft through wire fraud from victim accounts, and likely selling payment card data\nvia criminal marketplaces.\n\n## The Initial Detection\n\nEarly in the adversary’s post-exploitation activity, a CrowdStrike Falcon® detection was\ntriggered on an MFT server for execution of a reverse shell with a parent process of\nWINLOGON.EXE. Analysis of the SYSINFO.EXE binary indicated that TinyMet, which is an\nopen-source Meterpreter-based reverse shell, was used to provide the attackers with access\nto the target host. In addition, network telemetry from both of these processes indicated they\nwere attempting to communicate with suspicious IPs.\n\nFigure 1. TinyMet shell execution\n\nSoon after, another detection was triggered for encoded PowerShell execution with a parent\nprocess of SVCHOST.EXE. Decoding this PowerShell confirmed that it was malicious as it\nused randomly named variables and attempted to execute content pulled from a registry key,\nboth of which would be highly abnormal for a legitimate script.\n\n\n-----\n\nFigure 2. Encoded PowerShell execution\n\nBoth of these actions were prevented by Falcon, but the active connections to suspicious\ninfrastructure and execution of a malicious PowerShell script, without an obvious source for\neither, indicated there was an unresolved threat on the device. The host was immediately\nnetwork-contained and isolated to prevent further actions on the objective, while Falcon\nComplete continued its investigation to ascertain the source of the threat.\n\nFigure 3. Network Containment\n\n\n-----\n\nThe malicious activity being executed by legitimate Windows processes as well as the\nSYSTEM user account indicated that the host may have been compromised by a publicfacing exploit and not another attack vector such as a user-level phish. In addition, as a\nportion of the suspicious activity was originating from legitimate WINLOGON.EXE processes,\nthere was a high likelihood of process injection.\n\nFrom here, the Falcon Complete team pivoted the investigation into endpoint activity\nmonitoring (EAM) data to gain further context and determine the origin of the activity.\n\n## Investigation with Endpoint Detection and Response Data\n\nOnce Falcon Complete reviewed the detection information at hand and confirmed that the\nactivity noted was malicious, the next step was to identify the full scope of the threat. This is\nwhere Falcon Complete’s knowledge and skill set come into play.\n\nLet’s take a step back and outline what occurred.\n\n### Finding the Foothold\n\nIn order to prevent further malicious activity, the Falcon Complete team needs to identify how\nthe threat actor managed to gain a foothold on the host.\n\nBased on the data reviewed thus far, the team suspected that the adversary may have\ngained access to this host through exploitation of a public-facing service. By viewing the\nrunning processes on the device, Falcon Complete was able to see that it hosted a\nSolarWinds Serv-U FTP server. Searching through various sources for the hash of the\nassociated process provided the version number of the software.\n\nFigure 4. SolarWinds Serv-U Version Information\n\nA quick search for this version confirmed that there are multiple known exploits including\n[CVE-2021-35211, for which a CISA advisory had recently been released.](https://us-cert.cisa.gov/ncas/current-activity/2021/07/13/solarwinds-releases-advisory-serv-u-vulnerability)\n\n\n-----\n\nOur starting point in this investigation was the malicious usage of the legitimate\nWINLOGON.EXE process. This process is often used by threat actors hoping to achieve\nfurther stealth via process injection. The following EAM search was used to identify process\ninjection attempts on the host.\n```\n(event_simpleName=*Reflective* OR DetectName=*Reflective* AND\nReflectiveDllName!=NULL) OR (event_simpleName=*Inject* OR event_simpleName=*inject*) \n| table _time aid event_simpleName ComputerName InjectorImageFileName\nInjecteeImageFileName Reflective* Injected* CallStackModuleNames SourceThreadModule\nTargetThreadModule ParentProcessId_decimal TargetProcessId_decimal\nContextProcessId_decimal\n\n```\nFigure 5. Process injection chain (Click to enlarge)\n\nBased on the information in Figure 5, we are able to see that Serv-U.exe was the initial\nsource of the injection into lsass.exe, followed by lsass.exe injection into winlogon.exe.\nLsass.exe was also used to perform injection into explorer.exe. This injection chain\nconfirmed that Serv-U was the source of the infection. In addition, utilizing Falcon’s Process\nTimeline dashboard, the IP performing the initial exploitation could be identified.\n\nFigure 6. Falcon Process Timeline: Serv-U\n\nFinally, by reviewing the Process Timeline for each of the injected processes during the\nrelevant times, we are able to see that the adversary attempted to deploy additional tooling\nincluding the previously identified TinyMet shell, a Cobalt Strike beacon (which was\nprevented by Falcon), and a copy of AdFind. Tools like TinyMet and Cobalt Strike are often\nused by eCrime groups, including GRACEFUL SPIDER, to sell or transition access to an\nenvironment. These remote access tools (RATs) along with AdFind (generally used for\nenumeration of the environment) will often indicate the initial steps taken by a threat actor\nbefore the deployment of ransomware. The increase in ransomware broker networks\nhighlights the necessity for quick action when detections are triggered on a host.\n\n\n-----\n\n### Persistence\n\nWhen any compromise is identified, Falcon Complete will always ensure the host and the\ncustomer environment is brought to a clean state before resolution of the incident. The next\nstage was to identify any mechanisms the threat actor had used to keep their foothold on the\nhost. Although a variety of persistence mechanisms was reviewed, an investigation of\nscheduled tasks on the host quickly revealed a multi-stage execution chain utilizing COM\nregistry objects.\n\nAlthough the source of the infection was identified, the host still had multiple detections\ntriggered for Base64-encoded PowerShell execution unrelated to WinLogon. This indicated\nthat the threat actor had likely established a persistence mechanism on the host, potentially\nusing a scheduled task due to the frequency of incoming detections.\n\nA search for recently registered scheduled tasks on the host revealed a single task that\npointed to a COM object within the Windows registry.\n\nFigure 7. Scheduled task registration (Click to enlarge)\n\nThis scheduled task is a known default scheduled task that appears on many Windows\nhosts, making it an easy target for the threat actor to target and point it to their malicious\nCOM object. COM objects within the Windows registry are effective locations to hide\nmalware, as they will allow for some forms of auto-execution without being in an obvious\nlocation. This feature is used legitimately by a variety of software on Windows, but in this\ncase it was hijacked for malicious code execution.\n\nAt this point, Falcon Complete was able to pivot to Falcon Real Time Response (RTR) on the\nhost for further analysis. RTR provides analysts with a shell on the host to quickly validate\nand complement data found within EAM. In addition, once investigation is complete, RTR\ncan be used to perform remediation of malicious artifacts on the host. A review of this COM\nobject using RTR identified a TreatAs key pointing to a second COM object registry key.\n\n\n-----\n\nFigure 8. Malicious COM object (Click to enlarge)\n\nA review of the second registry key revealed the Base64-encoded PowerShell that had been\nattempting to execute, as shown in Figure 2. Decoding this revealed a PowerShell command\nto pull the contents of a third COM-based registry key and execute it.\n\nThe script found within the third key was encoded and lightly obfuscated with unused code.\nWhen decoded and deobfuscated, we were able to confirm that the script would clear the\nhost’s EventLog, but its primary function was to load a DLL into memory, which was located\nwithin a fourth registry key.\n\nFigure 9. Malicious PowerShell snippet\n\nAnalysis of the DLL by the CrowdStrike Intelligence team confirmed that it located the\npayload at a fifth and final registry key calculated using the hostname and drive serial\nnumber. The malware loaded from this location was a RAT unique to GRACEFUL SPIDER\ncalled FlawedGrace.\n\nThis persistence chain was relatively stealthy, as it kept the malicious content largely in\nmemory, except for additional tooling deployed.\n\n\n-----\n\nFigure 10. Persistence chain\n\nAnalysis of this persistence mechanism by the Falcon Complete team, as well as partnership\nwith the CrowdStrike Falcon OverWatch™ and CrowdStrike Intelligence teams, allowed for\nquick attribution of this incident to GRACEFUL SPIDER, as well as identification of malicious\nartifacts at affected customers.\n\n## The Remediation\n\nOnce triage and investigation reached a conclusion, the Falcon Complete team remediated\nthe host of any malicious artifacts associated with this incident. This includes all persistence\nmechanisms, which in this case were the elusive COM registry objects:\n```\nHKLM\\Software\\Classes\\CLSID\\(unique ID_1)\\TreatAs\nHKLM\\Software\\Classes\\CLSID\\(unique ID_2)\\LocalServer\nHKLM\\Software\\Classes\\CLSID\\(unique ID_2)\\ProgID\nHKLM\\Software\\Classes\\CLSID\\(unique ID_2)\\VersionIndependentProgID\n\n```\nThe additional tooling identified in EAM (TinyMet shell and AdFind) was ultimately blocked\nand then quarantined by the Falcon sensor. They were not found on disk and did not require\nany additional action to remediate. As part of the investigation, the team identified multiple\ninjected processes on the host. In order to completely clean the system and prevent\nreinfection, these processes were terminated, including the original source, Serv-U.exe.\n\nAlong with Falcon Complete’s remediation summary, the affected customers were provided\nwith all indicators of compromise and a list of all available patches applicable to the system\nto prevent any further exploitation in the future. Falcon Complete recommended blocking the\n\n\n-----\n\nassociated IPs at the perimeter, resetting passwords for all user accounts on the affected\nsystems (due to the compromise of LSASS), and applying all available patches as soon as\npossible. The customers promptly performed these actions in order to prevent the possibility\nof data exfiltration and ransomware deployment.\n\n### Associated C2 Activity\n```\n46.161.40[.]87 - Injected WinLogon\n179.60.150[.]26 - TinyMetShell C2\n179.60.150[.]32 - Cobalt Strike C2\n45.129.137[.]232 - remote IP contacted by exploited Serv-U.exe process\n\n## Conclusion\n\n```\nFalcon Complete identified an active campaign on public-facing Serv-U MFT servers,\ncontained the activity and prevented the attacker from completing their actions on objectives.\nThe team leveraged EAM, the Falcon Process Timeline dashboard, Falcon RTR, and some\nopen-source intelligence (OSINT) to quickly shut down this attempted breach in real time.\n\nIn addition to removing the associated artifacts, Falcon Complete identified the vulnerable\napplication being exploited early on and was able to quickly provide all affected customers\nwith the critical, time-sensitive information they needed to patch their vulnerable public-facing\nMFT servers, secure their business from further attacks and check other servers for\nvulnerabilities.\n\nIn rare cases where the hosts were not patched in a timely fashion, GRACEFUL SPIDER\nhas been known to return for further attempts to deliver Cobalt Strike beacons. These\nattempts were quickly blocked by the Falcon agent. Campaigns such as these illustrate the\npersistence and stealth tactics that can be employed by an adversary like GRACEFUL\nSPIDER to gain and keep a foothold in target organizations. Fortunately, Falcon provides the\ntelemetry and tools to quickly identify, investigate and remediate attacks that remain largely\nin memory, such as this one.\n\nThe Falcon Complete team works closely with the Falcon OverWatch and CrowdStrike\nIntelligence teams, applying vast skill sets to enable organizations to investigate and identify\nthreat groups quickly — and fueling our mission to stop breaches.\n\n**Additional Resources**\n\n_[Learn more by visiting the Falcon Complete product webpage.](https://www.crowdstrike.com/endpoint-security-products/falcon-complete/)_\n_Read a white paper: CrowdStrike Falcon Complete: Instant Cybersecurity Maturity for_\n_Organizations of All Sizes._\n_Read about adversaries tracked by CrowdStrike in 2020 in the 2021 CrowdStrike_\n_Global Threat Report._\n_Test CrowdStrike next-gen AV for yourself:_ _[Start your free trial of Falcon Prevent™.](https://go.crowdstrike.com/try-falcon-prevent.html)_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-21 - Stopping GRACEFUL SPIDER- Falcon Complete’s Fast Response to Recent SolarWinds Serv-U Exploit Campaign.pdf"
    ],
    "report_names": [
        "2021-10-21 - Stopping GRACEFUL SPIDER- Falcon Complete’s Fast Response to Recent SolarWinds Serv-U Exploit Campaign.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536163,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653691944,
    "ts_modification_date": 1653691944,
    "files": {
        "pdf": "https://archive.orkl.eu/4da1ff457c19b77ead64aa62023add1df947af18.pdf",
        "text": "https://archive.orkl.eu/4da1ff457c19b77ead64aa62023add1df947af18.txt",
        "img": "https://archive.orkl.eu/4da1ff457c19b77ead64aa62023add1df947af18.jpg"
    }
}