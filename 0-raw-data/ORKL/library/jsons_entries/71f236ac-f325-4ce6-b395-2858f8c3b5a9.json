{
    "id": "71f236ac-f325-4ce6-b395-2858f8c3b5a9",
    "created_at": "2023-01-12T15:06:41.852039Z",
    "updated_at": "2025-03-27T02:05:32.950967Z",
    "deleted_at": null,
    "sha1_hash": "e1a3b52d7589f9c41e928bcdb6c8365044f349ea",
    "title": "2021-05-14 - DarkSide Ransomware Operations - Preventions and Detections",
    "authors": "",
    "file_creation_date": "2022-05-25T14:12:43Z",
    "file_modification_date": "2022-05-25T14:12:43Z",
    "file_size": 192675,
    "plain_text": "# DarkSide Ransomware Operations – Preventions and Detections.\n\n**[blueteamblog.com/darkside-ransomware-operations-preventions-and-detections](https://blueteamblog.com/darkside-ransomware-operations-preventions-and-detections)**\n\nMay 14, 2021\n\nBy [Auth 0r / May 14, 2021 /](https://blueteamblog.com/author/auth0r) [Cybersecurity,](https://blueteamblog.com/category/cybersecurity) [SIEM,](https://blueteamblog.com/category/siem) [Threat Hunting,](https://blueteamblog.com/category/threat-hunting) [Threat Intelligence](https://blueteamblog.com/category/threat-intelligence)\n[No Comments](https://blueteamblog.com/darkside-ransomware-operations-preventions-and-detections#respond)\n\nI decided to release this blog post as a longer form, more in depth version of this twitter\nthread I released on the 12th of May. The aim of this blog post is to provide you with\nactionable prevention’s and detection’s against known TTPs which have been seen during\nDarkSide ransomware operations from the group and their affiliates.\n\nIt is important to note that many of these prevention’s and detection’s will work not only for\nthis group, but for preventing and detecting attacks from many threat actors due to their\ngeneric nature.\n\nThis thread was in response to the fantastic blog post by FireEye – “Shining a Light on\nDARKSIDE Ransomware Operations” released on the 10th of May.\n\nBefore getting into the post, here are some further reading resources on DarkSide if you are\ninterested.\n\n\n-----\n\n_Time to get into the detection s and prevention s. I have listed a large number of SIEM rules_\n_below which I have had stored on a personal database for a while. I can’t remember exactly_\n_who created each and every one of them (Various people – it wasn’t me) – but apologies_\n_that I am unable to give particular credits for these. I know some were created by Florian_\n_Roth, Samir Bousseaden, Markus Neis and Roberto Rodriguez. I hope however sharing_\n_them will make up for this in providing further detection’s to the community._\n\n_Also, for all the SIEM rules I have listed below, keep sure of three things if you create them._\n_1. Do you have the correct auditing configured, 2. Are the logs in your SIEM, 3. Are the_\n_properties being parsed correctly. If any of these answer no, they won’t work._\n\n## INITIAL COMPROMISE\n\n### Password attacks on perimeter\n\nThe first initial compromise method mentioned was password spray attacks against VPNs.\n\nThis is extremely common, but luckily for us relatively easy to protect against compared to\nother attack vectors. Password spray attacks and brute forces will happen not just against\nVPN’s but any public facing authentication methods, such as Azure Active Directory.\n\nI know everyone says this, but they say it for a reason – Multi-factor authentication should be\nused for all accounts in your network. Also ensure users are using unique passwords for each\nservice / platform they have access too. This will make the likelihood of a password attack\nbreaching your perimeter a lot lower. You also want to ensure you have lockout thresholds\nfor failed logins to any accounts. If an attacker is attempting various password attacks, this\nmay at least slow them down whilst you react to alerts.\n\nIn terms of detection’s, there are a number of things we want to look for. Do your best to\nensure all perimeter facing devices are on boarded to your SIEM so you can monitor\nauthentication events.\n\n**Password Spraying – Create an alert looking for one Source IP failing to login to 5+**\nAccounts within 20 minutes. (This is just an example, you will need to modify the\nthresholds depending on the log type and your environment.)\n\n**Impossible Travel – Most SIEM’s have a function to detect the geographic location**\nof IP addresses. Monitor if a user account logs in successfully from 2 different countries\nwithin an hour. (You may need to allowlist any VPN providers which are commonly\nused by your user base)\n\n\n-----\n\n**Attempted user login from multiple Sources – A sign of potentially leaked user**\ncredentials or password cracking is when there is numerous successful or failed logins\nto one user account from multiple IPs in a day. Create an alert looking for 5 IPs\nsuccessfully or failing to login to the same user account in a 24 hour period (As\nprevious, you may need to alert thresholds depending on your environment and risk\nappetite)\n\n**Other – It is also worth looking at creating rules looking for large numbers of failed**\nlogins to one account, large numbers of failed logins from one source and large\nnumbers of failed logins to one destination. The thresholds and exceptions you will use\nfor these will depend greatly on what you are monitoring and your environment. Run\nsome queries, find what is normal and alert above that.\n\nFinally for this section, it is mentioned in the report that attackers may have used a\nvulnerability in SonicWall to disable MFA on the VPN.\n\nI always recommend that you audit change events on any networking equipment in your\nenvironment. You likely have VPN’s, Firewall’s and a plethora of other networking\nequipment logging network traffic and authentications – keep sure you are also auditing and\nlogging change activities on these too.\n\nLook for events such as deletions, creations and modifications of objects, policies and\naccounts on these devices. Alert on them and ensure that any changes are legitimate and\nexpected.\n\n### Malicious Emails\n\nIt is mentioned that another initial access vector was, unsurprisingly; malicious emails.\n\nI’m not going to cover email security and all its facets here. Rather, this tweet from\n@TinkerSec at the time sums up up the basics pretty well. Look into each of these aspects\nseparately and see if you have them, or a direct alternative; in place.\n\nSo plan on it.\n\n– Use email security proxies to conduct scans of attachments ahead of time.\n\n– Use endpoint protection.\n\n– Use outbound domain inspection.\n\n– Have a way for users to report phishes.\n\n– Don't punish users if they self report.\n\n— Tinker (@TinkerSec) [May 11, 2021](https://twitter.com/TinkerSec/status/1392196981733445635?ref_src=twsrc%5Etfw)\n\n## ESTABLISH FOOTHOLD\n\n\n-----\n\n### BEACON\n\nThis is mentioned in this phase and also for lateral movement, but I will just include it here.\nBeacon / Cobaltstrike is now known for being used in a large number of intrusions to\nperform numerous functions (which you can learn about in the below link)\n\n[To hunt for it, detect it or are looking for IOCs, this is your go-to link.](https://github.com/MichaelKoczwara/Awesome-CobaltStrike-Defence)\n\nAwesome-CobaltStrike-Defense contains the following topics and is regularly updated.\n\nHunting and Detection Tools\nYara Rules\nSigma Rules\nIOCs\nResearch articles\nTrainings\nVideos\n\n## MAINTAIN PERSISTENCE\n\n### Teamviewer / Anydesk and other remote acccess applications\n\nThe report shows us that the threat actor downloaded and used Teamviewer. They also\nbrowsed to locations indicating downloads of Anydesk. I would recommend that, if possible;\nyour business mandates one remote access application which is allowed to be used. Then,\nanything outside this is immediately suspicious.\n\nIn terms of alerting, we should approach this from two avenues. Firstly, I recommend you\nlook for outbound connections on the following ports which are used by common remote\naccess applications.\n\n**RDP – 3389**\n\n**Anydesk – 6568**\n**Dameware – 6129, 6130, 6132, 6133**\n\n**Teamviewer – 5938**\n\n**VNC – 5800/5900**\n\nIf your business does mandate the use of one, or no; remote access applications. Block the\ndownload links for these and then alert if there is a blocked connection to these download\nURLs (such as hxxps://dl.teamviewer[.]com/download)\n\n### Legitimate Credentials\n\n\n-----\n\nThis is difficult to deal with and is a huge challenge that we face, as threat actors purchase\nworking user credentials and log directly into systems. There is some steps that we can take\nhowever.\n\n[Firstly, sign up for domain monitoring on haveibeenpwned. If an employees credentials](https://haveibeenpwned.com/DomainSearch)\nare breached, ensure that they reset their password to a new, complete different one.\nInform users to create unique, lengthy passwords for all services. Therefore, if an\nattackers does buy a credential it will only work on one of the applications / services\netc.\nI mentioned it already, but MFA on everything. Then, if a password is breached, you\nhave another layer of defense.\n\nIn terms of detection’s, for this we really need to look at anomalous behaviour patterns, such\nas.\n\nUsers accessing, or attempting to access; a host they have never accessed before.\nUser logging or attempting to login outside of their normal working hours.\nMentioned already above, but Impossible Travel scenarios can be a good way of\ncatching legtimate credentials being used.\nFor your critical servers / hosts (Domain Controllers, Network Devices, Exchange\nServers, Databases etc – whatever you consider critical) you should know who\n(Domain Admins, Network Admins etc) is allowed to access these. Create an alert if any\nusers outside this accesses, or attempts to access; your critical servers and hosts.\n\n## ESCALATE PRIVILEGES\n\n### Mimikatz\n\nMimikatz is another tool which commonly used during many attacks, especially for privilege\nescalation.\n\nDue to its common usage, it is worth taking your time to mitigate as many potential attacks\nas possible. The following articles detail numerous mitigation’s which can be taken against\nMimikatz.\n\n[SANS – Mitigations against Mimikatz style attacks.](https://isc.sans.edu/forums/diary/Mitigations+against+Mimikatz+Style+Attacks/24612/)\n\n[Tempest Security – Mitigating credential theft attacks.](https://sidechannel.tempestsi.com/mimikatz-mitigating-credential-theft-attacks-5fdeabdc1622)\n\nOnce you have mitigated potential issues, it is then worth implementing the below\ndetection’s. Mimikatz does so much it is hard to list a detection for everything that it can do,\nso here are the more common ones.\n\n[There are 3 good Sysmon detection’s in this Medium post.](https://medium.com/@levurge/detecting-mimikatz-with-sysmon-f6a96669747e)\n\n\n-----\n\n[Sigma rule to detect well-known mimikatz command line arguments](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_mimikatz_command_line.yml)\n\n[Sigma rule to detect mimikatz keywords in different Windows Eventlogs](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/win_alert_mimikatz_keywords.yml)\n\n**Mimikatz DC Sync. (When Mimikatz is used to perform DCSync) EventID 4662,**\nProperties contain *Replicating Directory Changes All* and/or *1131f6ad-9c07-11d1f79f-00c04fc2dcd2*\n\n**Mimikatz Detection LSASS Access (Mimikatz normal behaviour) Sysmon Event**\n10, Target Image C:\\windows\\system32\\lsass.exe, Granted Access”0x1410″\n\n**Credential Dumping Service Execution. (Looking for services known to be used**\nto dump credentials) Event ID 7045 or 4697 and ServiceName contains “Mimikatz or\nmimidrv or gsecdump or cachedump or pwdump or wce service or wceservice or\nfgexec.”\n\n**OverPass The Hash. (Detection of successful overpass the hash attack) Event ID =**\n4624, Logon Type = 9, Logon Process Name = seclogo, Authentication Package =\nNegotiate\n\n### LSASS Memory Dump\n\nCommonly at this phase of an attack, attackers will look to dump the memory from LSASS\nand other attacks against the service.\n\n[I highly recommend reading this threat detection report by RedCanary. It explains well what](https://redcanary.com/threat-detection-report/techniques/lsass-memory/)\nLSASS is, why it is attacked so frequently and several detection’s for these attacks.\n\nI also recommend reviewing the MITRE sub technique – OS Credential Dumping: LSASS\nMemory . This provides further extra information and resources around what LSASS is,\npotential mitigation’s and detection’s.\n\nSome detection’s which are relating to LSASS below (I also listed some in the previous\nsection as Mimikatz targets LSASS)\n\n**LSASS Access from Non System Account. EventID 4663 or 4665. Object Type =**\nProcess, Object Name ends with lsass.exe. SubjectUsername does not end with $.\n\n**Password Dumper activity on LSASS. EventID 4656. Process Name =**\nC:\\Windows\\System32\\lsass.exe. AccessMask = 0x705. ObjectType = SAM_DOMAIN.\n\n**LSASS Memory Dumping. Windows Process Creation. CommandLine contains**\nlsass and .dmp. CommandLine does not end with .werfault.exe OR CommandLine does\nnot end with .exe and contain procdump.\n\n## MOVE LATERALLY\n\n\n-----\n\n### RDP\n\nRDP has been used extensively by many threat actors for lateral movement among other\npurposes, therefore it is important we monitor its the best we can.\n\nBut before we get to the detection stage, as always lets first try to mitigate. MITRE have some\n[fantastic mitgations listed here which I highly recommend following to deter and make an](https://attack.mitre.org/techniques/T1021/001/)\nattackers life more difficult.\n\nNow onto the detection’s. RDP is such a frequently used protocol during attacks, so I am\ngoing to list a bunch of my favourites below which I recommend looking into.\n\n**User RDP Spike. Alert on a user making numerous RDP connections in a short**\nperiod.\n\n**Abnormal RDP Access. Alert on devices being accessed via RDP which are not**\nnormally accessed using the protocol.\n\n**Source with many Destinations. Alert on a Source IP with a large number of**\nDestination IPs in a 24 hour period using RDP.\n\n**Possible RDP Tunneling. Look for EventID 4624, Logon Type 10, Source Address =**\n127.0.0.1 or ::1\n\n**Netsh RDP Port Forwarding. Look for EventID 4688 where CommandLine = netsh**\ni* p*=3389 c*\n\n**Potential tsclient being used to place RDP Backdoor. Sysmon Event 11, Image:**\n‘\\mstsc.exe’, TargetFileName: ‘\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*’\n\n**Suspicious Outbound RDP Connections. Sysmon Event 3, Destination Port 3389.**\nImage is not any of mstsc.exe, RTSApp.exe, RTS2App.exe, RDCMan.exe,\nws_TunnelService.exe, RSSensor.exe, RemoteDesktopManagerFree.exe,\nRemoteDesktopManager.exe, RemoteDesktopManager64.exe, mRemoteNG.exe,\nmRemote.exe, Terminals.exe, spiceworks-finder.exe, FSDiscovery.exe,\nFSAssessment.exe, MobaRTE.exe, chrome.exe, thor.exe, thor64.exe.\n\n## INTERNAL RECONNAISSANCE\n\n### Powerview / Bloodhound\n\nThreat actors commonly use tools such as Powerview and Bloodhound to perform internal\nrecon against Windows targets.\n\n\n-----\n\nMy main recommendation here? Run them yourself first. Find and fix the weaknesses before\n[they do. I discussed Active Directory Security Hardening, Auditing and Detection Rules on a](https://blueteamblog.com/active-directory-security-hardening-auditing-and-detection-rules)\npost a while ago. I recommend giving it a read and following the steps outlined within.\n\nThere are some SIEM rules which we can look to implement to pick up the activity from these\ntools.\n\n**Powerview Add-DomainObjectAcl DCSync AD Extend Right.** **(Detects**\nPowerView being used to grant DCSync permissions to a user. Only false positve is if a\nnew DC Account is being created) EventID 5136. LDAPDisplayName =\nntSecurityDescriptor. Value contains either 1131f6ad-9c07-11d1-f79f-00c04fc2dcd2 OR\n1131f6aa-9c07-11d1-f79f-00c04fc2dcd2 OR 89e95b76-444d-4c62-991a-0facbeda640c.\n\n**[Use of Bloodhound and Sharphound. There is a nice Sigma rule here.](https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_hack_bloodhound.yml)**\n\n### Built in Windows Utilities\n\nFrequently we see threat actors using built in Windows utilities to aid their reconnaissance\nand attacks in general. Outside of this incident, we can also see this when we look at reports\n[from the likes of TheDFIRReport. Almost every post, there is evidence of an attacker using](https://thedfirreport.com/)\nthese in built utilities.\n\nTherefore, we have to try and detect this. Between the DFIRReport link above and JPCert –\nWindows Commands used by Attackers we can quickly build a list of frequently used\ncommands.\n\nIt is worth taking these commands and creating a rule looking for a user running 5+ of them\nin 5 minutes. (You may need to change your thresholds). You will need to allow list Domain\nAdmins, Network Admins and potentially other staff members depending on role.\n\nOn top of this, there are a number of other good built in recon rules which can be found in\n[this Sigma repository and search for recon.](https://github.com/SigmaHQ/sigma/tree/master/rules/windows/process_creation)\n\n### Advanced IP Scanner\n\nDuring most reconnaissance attackers will run various network scans to fingerprint the\ntarget environment and find vulnerable devices, open ports etc.\n\nBefore we get into the detection’s, the best mitigation here is to ensure only required ports\nare open on devices. This will limit what an attacker can find out about your devices, or at\nleast make the job more difficult in the worst case.\n\nIt is therefore important that we monitor for suspicious network activity. I wrote this blog\npost a while back, it needs updated but contains some basic logic around network\n[monitoring. If you have DNS logs, also take a look at this post.](https://blueteamblog.com/7-ways-to-detect-malicious-dns-traffic-using-siem)\n\n\n-----\n\nOn top of the two above articles you should also be looking for things such as –\n\nTelnet / SSH – Source IP with many destinations in a day (Strange – these is a\nmanagement port – investigate why)\nAbnormal spike in traffic from a host. Either based on Event Count and/or Data\nVolume. This can be abnormal either to your environment, subnet or the host itself\ncompared to its previous traffic.\nBasic Port Scans within your network. Look at internal traffic only. Then alert on if 1\nSource IP connects to either 100 destinations on the same port within 5 minutes or 1\ndestination over 100 ports in 5 minutes. (These thresholds may need modified and you\nmay need to allowlist certain devices such as vulnerability scanners)\n\n## COMPLETE MISSION\n\n### PSExec\n\nPSExec has been seen during DarkSide ransomware attacks to deploy the ransomware itself.\n\nIn terms of what PSExec is, why threat actors use it and how we can detect it; the following\ntwo posts are fantastic.\n\nFirstly, Praetorian – Threat Hunting: [How to Detect PsExec. This contains details on what it](https://www.praetorian.com/blog/threat-hunting-how-to-detect-psexec/)\nis, how to detect, variants of PSExec and further considerations.\n\nNext up, another great RedCanary post. Threat Hunting for PsExec, Open-Source Clones,\nand Other Lateral Movement Tools. This contains similar detail on PSExec but goes on to\nfocus on the many clones of PSExed, what they are, and how we can detect them also.\n\n## FINAL THOUGHTS\n\nBefore we finish, I have some final thoughts which I thought were best to mention at the end\nrather than throughout the rest of the post.\n\n**Patch – I know this can be easier said than done at times, but it can be the difference**\nbetween being breached, and not. Most attacks, if the breach itself wasn’t due to a\nvulnerability; the attackers was able as part of their attack chain to exploit some vulnerability\nto speed up their attack or bypass defenses. Do your best to limit their opportunities to do\nthis.\n\n**Test your prevention’s and detection’s – Once you have mitigation’s and detection’s in**\nplace, test them. Are things really being blocked? Do alerts really trigger in your SIEM?\nTesting your hard work is a vital step in the process which should never be skipped.\n\n\n-----\n\n**Response – If a serious incident does occur – do you have an IR team? Do you have one on**\nretainer? Have you played out scenarios and went through the how, who and why you will\n[respond to a real event? There are some fantastic Incident Response resources here.](https://blueteamblog.com/incident-response-what-why-and-how-to-learn-it)\n\n_Thanks for taking your time to read this blog post and I hope you found it useful. I always_\n_love feedback, so contact me at_ _[My Twitter if you want to discuss this article, or anything](https://twitter.com/blueteamblog)_\nrelated.\n\n### Leave a Reply\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-14 - DarkSide Ransomware Operations - Preventions and Detections.pdf"
    ],
    "report_names": [
        "2021-05-14 - DarkSide Ransomware Operations - Preventions and Detections.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536001,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1653487963,
    "ts_modification_date": 1653487963,
    "files": {
        "pdf": "https://archive.orkl.eu/e1a3b52d7589f9c41e928bcdb6c8365044f349ea.pdf",
        "text": "https://archive.orkl.eu/e1a3b52d7589f9c41e928bcdb6c8365044f349ea.txt",
        "img": "https://archive.orkl.eu/e1a3b52d7589f9c41e928bcdb6c8365044f349ea.jpg"
    }
}