{
    "id": "fcc753fc-c065-439a-ac3c-026baed81c02",
    "created_at": "2023-01-12T15:08:07.993633Z",
    "updated_at": "2025-03-27T02:08:40.773866Z",
    "deleted_at": null,
    "sha1_hash": "b285b996058966e971fccb6e48e15ae626cba82c",
    "title": "2020-11-10 - Threat Hunting for REvil Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T01:21:50Z",
    "file_modification_date": "2022-05-28T01:21:50Z",
    "file_size": 2097810,
    "plain_text": "# Threat Hunting for REvil Ransomware\n\n**[awakesecurity.com/blog/threat-hunting-for-revil-ransomware/](https://awakesecurity.com/blog/threat-hunting-for-revil-ransomware/)**\n\n## Summary\n\n\nNovember 9, 2020\n\n\nREvil (short for Ransomware Evil and also referred to as Sodinokibi) ransomware is in the\nransomware-as-a-service(RaaS) business. The malware is handed over to the affiliates to\ninfect users and extort money. In turn the original REvil developers take 20-30% of the\namount that the affiliates receive. The ransomware developers say that they have made\nmore than $100 million in one year by infecting users owning large businesses. Attacks\nattributed to REvil were first spotted in April 2019, soon after the shutdown of the Gandcrab\n[ransomware family. In fact, the developers of REvil have admitted that they did not build from](https://www.bleepingcomputer.com/news/security/revil-ransomware-gang-claims-over-100-million-profit-in-a-year/)\nscratch, but instead used the Grandcrab code base. In this post we describe how security\noperations teams can hunt for REvil ransomware and the artifacts it produces / leaves\nbehind.\n\n## Understanding REvil\n\nFigure 1: Tor Payment page from a REvil infected machine\n\nTo encrypt files, REvil uses elliptic curve cryptography(ECC). This allows smaller keys\ncompared to other approaches without compromising on effectiveness of the encryption .\nSince its first appearance, this ransomware family has exploited vulnerabilities in software\n\n\n-----\n\nsuch as Windows Servers like 2012, 2012 R2 etc, as well as more recently Remote Desktop\nGateway (RD Gateway).\n\nFigure 2: REvil result from Virustotal\n\nThe configuration that the malware reads is a JSON file and it is stored in a special section of\nthe malware binary called .iyaw in this case (Figure 3). The name changes with every new\nsample and the configuration is RC4 encrypted.\n\nFigure 3: Section header containing ransomware configuration\n\nThe configuration defines the files to be excluded from encryption as well as the ransom note\nto be displayed. The sample configuration after being decrypted is shown in Figure 4.\n\n\n-----\n\nFigure 4: Decrypted REvil configuration (Source: cybereason)\n\nAfter encryption the wallpaper changes (Figure 5) to display that all files have been\nencrypted and all the instructions are in a text file (Figure 6).\n\nFigure 5: Wallpaper changed after REvil infection\n\n\n-----\n\nFigure 6: Note containing instruction for ransom payment\n\n## Process Cooldown\n\nThe configuration file (Figure 4) contains prc and svc fields which are process names and\nservices that would be killed before the encryption process begins. REvil also deletes\nVolume Shadow Copies (VSS) using the PowerShell command shown in Figure 7.\n\nFigure 7: Encoded Powershell command to delete VSS\n\nDecoding the command reveals the actual command (Figure 8).\n\nFigure 8: Decoded Powershell command\n\n## Threat Hunting for REvil\n\n\n-----\n\nWith that background, how does a security analyst uncover REvil, ideally before significant\nimpact across the organization? After the files have been encrypted, the ransomware\nreaches out to over a 1000 domains generated based on information from the configuration\nfile. Each URL contains the following pattern:\n\n**https://<domain>/<path1>/<path2>/<filename>.<ext>**\n\nOut of these 1000 domains, many are legitimate while others are C2 servers owned by the\nREvil operators which receive information from the infected machine. This technique allows\nthe attackers to hide the real attacker servers. All the communication happens in TLS and\nthe SNI can be seen in Figure 9.\n\nFigure 9: SNIs reached by REvil\n\nFrom having looked at multiple REvil samples, it appears that the TLS cipher suites (Figure\n10) are always constant for any domain accessed by the ransomware.\n\nFigure 10: TLS cipher suites for domains accessed by REvil\n\nSimilarly, the TLS client extension codes also remain constant across all domains.\n\n\n-----\n\nFigure 11: TLS client extension codes for REvil C2 domains\n\nThe fact that the TLS fields are identical across all of the REvil session can be observed\nusing TLS fingerprinting. This fact can be used with a technology like JA3 and can be fine\ntuned for true positives by using additional analytics. Specifically, the JA3 hash of the REvil\ntraffic is 1d095e68489d3c535297cd8dffb06cb9. However, simply relying on this hash is\nlikely to lead to false positives. For instance, searching customer networks for the same JA3\nhash showed some traffic that was clearly not ransomware (Figure 12).\n\nFigure 12: JA3 False Positive; Basespace AWS API Traffic\n\nThis is where deep security analytics can help. For instance, it is possible to identify devices\nwithin this list that have the behavior described above where thousands of different\ndestinations are accessed in quick succession.\n\n\n-----\n\nWithin the Awake Security Platform, Ava, performs this analysis automatically for you much\nlike an experienced threat hunter. For instance, Ava will automatically connect the dots\nacross the different behaviors we described above to triage and narrow down to just the trust\npositives. Ava can also account for threat intelligence and open source intelligence indicators\nto confirm the compromise and recommend next steps for investigation and response.\nFinally, Ava can trigger response actions by integrating with the rest of the organizationâ€™s\nsecurity and IT infrastructure. Especially when dealing with ransomware, speed of\nremediation is of the essence and the automated triage, investigation and response that Ava\nbrings to this process helps mitigate impact.\n\nFigure 13: Awake Situation for REvil ransomware detection\n\n## Remediation\n\nIt is recommended to backup all important data to external drives or in the cloud for better\n[security. Additionally, organizations should protect and monitor all the early vectors of](https://awakesecurity.com/white-papers/wp-maze-ransomware-its-too-late-if-they-exfiltrate/)\nransomware. This includes protecting email and securely working with attachments\nespecially from unknown sources as well as monitoring and protecting the entire attack\nsurface e.g. externally exposed remote desktop or VPN services etc.. Finally, identify the\nsequence and patterns of communication we describe in this blog post and hunt for those to\nuncover the presence of REvil on your network.\n\n## References\n\n Subscribe!\n\nIf you liked what you just read, subscribe to hear about our threat research and security\nanalysis.\n\n\n-----\n\nAshish Gahlot\n\nThreat Researcher\n\n[LinkedIn](https://www.linkedin.com/in/ashishga21/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-11-10 - Threat Hunting for REvil Ransomware.pdf"
    ],
    "report_names": [
        "2020-11-10 - Threat Hunting for REvil Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536087,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1653700910,
    "ts_modification_date": 1653700910,
    "files": {
        "pdf": "https://archive.orkl.eu/b285b996058966e971fccb6e48e15ae626cba82c.pdf",
        "text": "https://archive.orkl.eu/b285b996058966e971fccb6e48e15ae626cba82c.txt",
        "img": "https://archive.orkl.eu/b285b996058966e971fccb6e48e15ae626cba82c.jpg"
    }
}