{
    "id": "0f05da07-688e-4e89-8250-1fc6b0721d1d",
    "created_at": "2023-01-12T15:06:58.0194Z",
    "updated_at": "2025-03-27T02:09:18.258406Z",
    "deleted_at": null,
    "sha1_hash": "36140fcc54cebed5a863a7a79c5478de34eb5c54",
    "title": "2022-07-27 - Targeted Attacks Being Carried Out Via DLL SideLoading",
    "authors": "",
    "file_creation_date": "2022-08-18T04:02:29Z",
    "file_modification_date": "2022-08-18T04:02:29Z",
    "file_size": 3085568,
    "plain_text": "# Targeted Attacks being carried out via DLL SideLoading\n\n**[blog.cyble.com/2022/07/27/targeted-attacks-being-carried-out-via-dll-sideloading/](https://blog.cyble.com/2022/07/27/targeted-attacks-being-carried-out-via-dll-sideloading/)**\n\nJuly 27, 2022\n\n## Threat Actors Leveraging Microsoft Applications to Deliver Cobalt-Strike Beacons\n\nDLL (Dynamic-Link Library) sideloading is a technique used by Threat Actors to infect users using\nlegitimate applications which load malicious DLL files that spoof legitimate ones. Recently Cyble\n[Research Labs published a blog about Qakbot malware that leverages a calculator to perform DLL](https://blog.cyble.com/2022/07/21/qakbot-resurfaces-with-new-playbook/)\nSideloading.\n\n[Similarly, we came across a Twitter post wherein researchers mentioned a document file that performs](https://twitter.com/SBousseaden/status/1550903546916311043?t=koePtR6554CWSPYcitG6Zw&s=19)\nDLL Sideloading using Microsoft applications such as “Teams.exe” and “OneDrive.exe.” The dropped\nDLL contains the C&C URL through which the malware can deliver a Cobalt-Strike beacon.\n\nCobalt Strike is a penetration testing product that allows Threat Actors (TAs) to deploy an agent named\n‘Beacon’ on the victim machine. The Beacon provides various functionalities to TAs, including command\nexecution, key logging, file transfer, SOCKS proxying, privilege escalation, mimikatz, port scanning, and\nlateral movement.\n\n\n-----\n\nSeveral TAs are actively using this tool, from ransomware operators to espionage-focused Advanced\nPersistent Threats (APTs).\n\nUpon analyzing the malicious doc file, we observed that it was targeting a company located in Italy that\nprovides services such as Credit Servicing, Fund and Asset Management, and Real Estate services.\nThe below figure shows the malicious document file content.\n\nFigure 1 – Document with Macro Content\n\n## Technical Analysis\n\nWhen opening the malicious document, it shows a security warning stating that macros have been\ndisabled. The malware then requests the user to enable the content. Once enabled, the malicious\ndocument runs the macro code automatically in the background using the AutoOpen() function.\n\nFigure 2 –\n\nAutoOpen() function in Macro\nThe malware then calls the function process(), which identifies the path of the OneDrive and Teams\napplications. The below figure shows the VBA macro code with the base64 decoded path of the\nOneDrive and Teams applications.\n\n\n-----\n\nFigure 3 – Path identification to Drop DLL file\nIn the event that any of the application’s paths are identified by the malicious document, the malware\ndrops a DLL file in that path with the name cache-XJDNSJWPFHD.tmp and renames it as iphlpapi.dll by\ncalling the EnableContent() function as shown below.\n\nFigure 4 – Drops DLL File\n\n\n-----\n\nThe document file contains an embedded DLL file in reversed Base64 encoded format. The malware\nthen calls the GetParagraph() function, which gets the Base64 encoded strings and performs the\n_StrReverse and Base64Decode operations to drop the malicious DLL file in the location where the_\nOneDrive and Team applications are present.\n\nFigure 5 – StrReverse and Base64Decode Operations to get DLL\nThe below figure shows the malicious DLL file dropped in the Teams and OneDrive locations.\n\nFigure 6 – Dropped DLL Files Present in MS App Installation Folders\nUpon execution of the Teams application, the dropped malicious DLL file (“iphlpapi.dll”) is sideloaded, as\nshown below.\n\n\n-----\n\nFigure 7 – DLL Sideloading in Microsoft Teams App\n\n### Payload Analysis\n\nThe below figure shows the code of sideloaded DLL malware, which creates a mutex with the name\n“MSTeams.Synchronization.Primitive.2.0″ to avoid running another instance on the same machine. The\nmalware then communicates to the C&C server using the below URL:\n_d2xiq5m2a8wmm4.cloudfront[.]net/communications._\n\nFigure 8 – Creates Mutex and Connects to C&C server\nWhile monitoring the malware’s traffic, we observed the C&C communication with the same URL\nmentioned above.\n\n\n-----\n\nFigure 9 – Traffic Interception\nAfter analysing the C&C URL: d2xiq5m2a8wmm4.cloudfront[.]net/communications, we concluded that it\nexecutes a Cobalt-Strike on the victim’s machine.\n\nThe Cobalt-Strike Beacon can be used for malicious activities such as downloading additional payloads,\nlateral movement, etc.\n\n## Conclusion\n\nTAs are adopting various sophisticated techniques to deploy malware. In this particular case, we\nobserved how TAs are using Microsoft apps such as Teams and OneDrive to sideload a malicious library\nfile that can deploy the Cobalt Strike Beacon.\n\nCyble Research Labs continuously monitors all new and existing malware to keep our readers aware\nand informed.\n\n## Our Recommendations\n\nWe have listed some essential cybersecurity best practices that create the first line of control against\nattackers. We recommend that our readers follow the best practices given below:\n\nAvoid downloading files from unknown websites.\nUse a reputed anti-virus and internet security software package on your connected devices,\nincluding PC, laptop, and mobile.\nRefrain from opening untrusted links, email attachments, or unknown document files without\nverifying their authenticity.\nEducate employees in terms of protecting themselves from threats like phishing’s/untrusted URLs.\nMonitor the beacon on the network level to block data exfiltration by malware or TAs.\nEnable Data Loss Prevention (DLP) Solution on the employees’ systems.\n\n### MITRE ATT&CK® Techniques\n\n**Tactic** **Technique ID** **Technique Name**\n\nExecution [T1204](https://attack.mitre.org/techniques/T1204/) User Execution\n\n\n-----\n\nDefense Evasion [T1140](https://attack.mitre.org/techniques/T1140/)\n\n[T1574](https://attack.mitre.org/techniques/T1574/002/)\n\n[T1564](https://attack.mitre.org/techniques/T1564)\n\n\nDeobfuscate/Decode Files or Information\n\nHijack Execution Flow: DLL Side-Loading\n\nHide Artifacts: VBA Stomping\n\n\nCommand and Control [T1071](https://attack.mitre.org/techniques/T1071/) Application Layer Protocol\n\n### Indicators of Compromise (IOCs)\n\n**Indicators** **Indicator**\n**Type**\n\n\n697ac31e2336c340e46ae8a777f51cdb\n\n91bd5585383685b82af8e801ce8f43586a797f49\n\n92e7395073c6588e1d8172148525144189c3d92ed052a163b8f7fad231e7864c\n\n6e1e6194dd00f88638d03db3f74bb48a\n\nd4a3050246d30a26671d05b90ffa17de39d5e842\n\nee56e43ed64e90d41ea22435baf89e97e9238d8e670fc7ed3a2971b41ce9ffaf\n\n\nMD5\n\nSHA-1\n\nSHA-256\n\nMD5\n\nSHA-1\n\nSHA-256\n\n\n**Description**\n\nMalicious\nDoc\n\nSideloaded\nDLL\n\n\nd2xiq5m2a8wmm4.cloudfront.net URL CobaltStrike C&C\nURL\n\n\nhxxps://laureatiprelios.azureedge[.]net/forms/Modulo_Testimone_Universitario_v3.doc\n\n\nURL Download\nURL\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-27 - Targeted Attacks Being Carried Out Via DLL SideLoading.pdf"
    ],
    "report_names": [
        "2022-07-27 - Targeted Attacks Being Carried Out Via DLL SideLoading.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536018,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1660795349,
    "ts_modification_date": 1660795349,
    "files": {
        "pdf": "https://archive.orkl.eu/36140fcc54cebed5a863a7a79c5478de34eb5c54.pdf",
        "text": "https://archive.orkl.eu/36140fcc54cebed5a863a7a79c5478de34eb5c54.txt",
        "img": "https://archive.orkl.eu/36140fcc54cebed5a863a7a79c5478de34eb5c54.jpg"
    }
}