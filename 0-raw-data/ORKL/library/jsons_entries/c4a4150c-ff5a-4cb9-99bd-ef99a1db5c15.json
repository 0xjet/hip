{
    "id": "c4a4150c-ff5a-4cb9-99bd-ef99a1db5c15",
    "created_at": "2024-03-08T02:07:03.180967Z",
    "updated_at": "2025-03-27T02:05:18.741815Z",
    "deleted_at": null,
    "sha1_hash": "d34fdcfff1605ca007c479ae8856a60fafe04fd9",
    "title": "LockBit Attempts to Stay Afloat with a New Version",
    "authors": "",
    "file_creation_date": "2024-02-22T09:22:49Z",
    "file_modification_date": "2024-02-22T09:22:49Z",
    "file_size": 1034985,
    "plain_text": "# LockBit Attempts to Stay Afloat with a New Version\n### Appendix\n\n\n-----\n\n## Technical Appendix: LockBit-NG-Dev Detailed Analysis\n\nThe new LockBit version we analyzed was packed using the MPRESS packer, possibly to\nevade static file detections. After unpacking, we can see that this new version seems to have\nbeen written in .NET and possibly compiled using CoreRT, which is different from the usual\nC/C++ language used for past versions.\n\nFigure 1. Shows the use of MPRESS packer using the Detect-It-Easy tool\n\nLike past versions, it still has an embedded configuration that dictates the routines it can\nperform. The configuration, which is in JSON format, is decrypted at runtime and includes\ninformation like date range for execution, the ransom note filename and content, unique\nIDs for the ransomware, the RSA public key, and some other flags and lists for its other\nroutines. A table with the full configuration options is included at the end of this brief.\n\nFigure 2. Decrypted configuration in JSON format\n\nAfter decrypting the configuration, LockBit will then create a mutex using the value of ID\nfield from the configuration as the mutex name. If the mutex already exists, the process will\nexit to avoid multiple instances of execution.\n\n\n-----\n\nFigure 3. Mutex checking routine\n\nOne of the new behaviors of LockBit is its ability to check if the current date is within the\ndate range set in the configuration. If the date is not within this range, the process will\nterminate. The analyzed sample only works between a specified start and end date. This is\nprobably LockBit’s way to limit affiliates from reusing their ransomware, forcing them to\npurchase a new version from the operators once the date expires. This can also be\nconsidered an anti-analysis and anti-sandbox technique — however, it is relatively simple\nfor an analyst to bypass this during reverse engineering. On the other hand, it could would\nbe more difficult for an affiliate to patch the binary before using it against a victim.\n\nFigure 4. Checking if the current date is within the valid date range\n\nSimilar to other ransomware, it terminates processes and stops services that may be\naccessing files it is attempting to encrypt or security-related processes and services that\nmay hinder the execution of the ransomware to ensure the proper encryption of files,. To\ndo so, it first needs to check if the StopProcesses or StopServices flags are true in the\nconfiguration. If true, it will terminate processes from the list of process names under the\n_ProcessesToStop field and services from the list of services in the ServicesToStop field in the_\nconfiguration.\n\nFigure 5. Routine checking if processes and services will be stopped\n\nLockBit also inhibits recovery from shadow copies and backups by performing the following\nroutines before encryption:\n\n\n-----\n\nIt checks if DeleteVolumeShadowCopies is true in the configuration, and if it is, deletes shadow\ncopies by executing the following command:\n\n_“C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe vssadmin Delete_\n_Shadows /All /Quite”_\n\nTo delete the Windows backups, it checks if DeleteWindowsSystemBackups is true in the\nconfiguration, and if it is, it executes the following command:\n\n_“C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe wbadmin DELETE_\n_BACKUP –keepVersions:0 -quiet”_\n\nFigure 6. Routine executing PowerShell commands to delete shadow copies and backups\n\nOne of the routines it possesses that was also in past versions is the ability to rename the\nencrypted files with random filenames. It does this by checking if the ChangeFilename field is\ntrue in the configuration, then it generates a random filename using a randomizer function.\n\nThe original file name will then be placed within the content of the file after the encrypted\nblob. For files that are not encrypted with full encrypt mode, it will just be appended on the\nfile. Meanwhile, those encrypted via full encrypt mode will have filenames that will be\nincluded in the RSA encrypted buffer.\n\nFigure 7. File encrypted with Intermittent mode has the original filename in its content\n\nFigure 8. File encrypted with full encrypted mode has the original filename in the RSA\n\nencrypted buffer\n\n\n-----\n\nLockBit has three encryption modes: fast, intermittent and full. Files are usually encrypted\nunder fast mode to speed up encryption (an option commonly favored by affiliates), but it\ncan be configured to perform different modes based on file extensions.\n\nThe sample we analyzed has set “.txt” file extensions to full encryption mode, while “.csv”\nand “.sql” are encrypted with intermittent mode. The three modes to encrypt files are as\nfollows:\n\n  - **Fast encrypts the first 0x1000 bytes of the file (files listed in Fast Set will use**\n_Buffersize value to determine the size to encrypt)._\n\n  - **Intermittent only encrypts a certain percentage of the file based on the value set in**\nthe configuration under the Percent field. Also, the field Segmentation determines the\ndistance between encrypted blocks.\n\n  - **Full encrypts the whole file.**\n\nLike other ransomware, LockBit-NG-Dev avoids encrypting certain directories, files and file\nextensions. These files are listed in the configuration under the DirectoryList, FileSet, and\n_NoneSet fields. Also, the configuration fields IncludeFiles, IncludeDirectories, and_\n_IncludeExtensions need to be set to false. It also has a regex option for the files and_\ndirectories to avoid under the fields FilesRegexQueryString and DirectoriesRegexQueryString.\n\nFor network encryption, if EnableNetworkShares is true, it also encrypts files on available\nnetwork shares.\n\nLockBit-NG-Dev encrypts files using the AES algorithm and encrypts the AES key using the\nembedded RSA public key that can also be found in the configuration. The AES keys are\nrandomly generated for each file to be encrypted.\n\nThe ransom note content and file name are also in the configuration. It can also be set in\nthe configuration if the ransom note will be dropped on all directories or only in specific\ndirectories by exact path/s that match a regular expression.\n\nAn option exists wherein the ransom note would first be dropped on target directories (or\nall traversed directories) before encryption begins. If this is enabled, dropping the same text\nfile on multiple directories could be flagged by behavior monitoring tools as a suspicious\nroutine and may terminate the execution process before the actual encryption begins.\n\n\n-----\n\nFigure 9. Checking if the ransom note will be dropped before encryption\n\nFinally, if Self-delete is true in the configuration, it will remove traces of the ransomware by\nzeroing out its contents using the following command:\n\n_powershell.exe -Stop-Process -Id {process id} -Force; fsutil.exe file setZeroData offset=0_\n_length=9999999999 “{Path of ransomware}”_\n\nFig 10. Checking if “Self-delete” field is true\n\nFigure 11. Executing commands via PowerShell\n\n\n-----\n\n## Full configuration\n\n|Full configuration|Col2|\n|---|---|\n|Field|Description|\n|MinDate|Minimum Date where ransomware will execute (format. MM/DD/YYYY)|\n|MaxDate|Maximum Date where ransomware will execute (format. MM/DD/YYYY)|\n|AppendedExtension|Extension that will be appended on encrypted files (ex. locked_for_LockBit)|\n|NoteFilename|Filename of the ransom note|\n|ID|Unique identifier for the ransomware|\n|ChangeFilename|If true, change filename of encrypted files to a random one.|\n|EncryptNetworkShares|if true, include network drives in encryption|\n|SkipHiddenFiles|if true, will not encrypt files with attribute hidden|\n|DeleteVolumeShadowCopies|If true, delete shadow copies by executing vssadmin command|\n|DeleteWindowsSystemBackups|If true, delete windows backup by executing wbadmin command|\n|EfficiencyMode|Flag to check if will use enough or more resources during encryption|\n|SelfDelete|If true, overwrite contents of ransomware with null bytes|\n|DropNoteBeforeEncryption|If true, ransom note will be dropped first before encrypting|\n|DropNoteInEveryDirectory|if true, drop ransom note on every directory|\n|DropNoteInSpecificDirectories|if true, drop note only on the specified directory in field DirectoriesToDropNoteIn|\n|DirectoriesToDropNoteIn|List of file path to drop ransom note in|\n|RegexDropNoteInSpecificDirectories|if true, drop note on directory if it matches the regex expressions under the DirectoriesToDropNoteInRegexQueryString|\n|DirectoriesToDropNoteInRegexQueryString|List of regex expression of desired directories to drop ransom note|\n|StopProcesses|If true, terminate processes under the ProcessesToStop field.|\n|ProcessesToStop|List of process names to stop|\n|StopServices|If true, stop services under the ServicesToStop field.|\n|ServicesToStop|List of service name to stop|\n|IncludeFiles|If true, include the files under FileSet in encryption routine, otherwise avoid encrypting if set to false|\n|FileSet|List of files that would be excluded in encryption if IncludeFiles is set to false.|\n|RegexIncludeFiles|If true, include the files that matches the regular expression under FilesRegexQueryString in encryption routine, otherwise avoid encrypting if set to false|\n|FilesRegexQueryString|Regular expression of files to include or avoid in encryption|\n\n\n-----\n\n|IncludeDirectories|If true, include the directories under DirectoryList in encryption routine, otherwise avoid encrypting if set to false|\n|---|---|\n|DirectoryList|List of directories that would be excluded in encryption if IncludeDirectories is set to false|\n|RegexIncludeDirectories|If true, include the directories that matches the regular expression under DirectoriesRegexQueryString in encryption routine, otherwise avoid encrypting if set to false|\n|DirectoriesRegexQueryString|Regular expression of directories to include or avoid in encryption|\n|IncludeExtensions|If true, include the files with extension under NoneSet in encryption routine, otherwise avoid encrypting if set to false|\n|NoneSet|List of file extension to avoid during encryption, if IncludeExtensions is False|\n|FastSet|List of extension of files that are targeted to only be encrypted with the first x bytes where x is value set in BufferSize|\n|IntermitttentSet|List of extension of files that would only be partially encrypted depending on the value of Percent|\n|FullSet|List of extension of files that would be fully encrypted regardless of size|\n|BufferSize|Size to encrypt for files listed in FastSet (ex. 4096)|\n|Percent|Percentage value of intermittent encryption to perform|\n|Segmentation|Value to compute offset of blocks to encrypt under Intermittent Encryption (ex. 256)|\n|PublicKey|RSA public key.|\n\n\nTable 1. Full configuration settings\n\n## Indicators of Compromise\n\nDetected as Ransom.Win64.LOCKBIT.YXDLS\n\n**SHA256**\n\nf56cba51a4e86f3be5208dfce598d0d6a86cbbc820b214d5d5df7d327e580b82\n\n**TLSH**\n\nT1615533707F603835DB3BD27B546D0D8892FB39789A198BFAC0661F87185691F0907A8F\n\n\n-----\n\nTrend Micro, a global cybersecurity leader, helps make the world safe for exchanging digital information. Fueled\n\nby decades of security expertise, global threat research, and continuous innovation, our unified cybersecurity\n\nplatform protects hundreds of thousands of organizations and millions of individuals across clouds, networks,\n\ndevices, and endpoints.\n\nWith 7,000 employees across 56 countries, and the world’s most advanced global threat research and\n\nintelligence, Trend Micro enables organizations to simplify and secure their connected world.\n\n[TrendMicro.com](https://www.trendmicro.com/)\n\n©2024 by Trend Micro Incorporated All rights reserved Trend Micro and the Trend Micro t-ball logo are trademarks or\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        }
    ],
    "references": [
        "https://www.trendmicro.com/content/dam/trendmicro/global/en/research/24/b/lockbit-attempts-to-stay-afloat-with-a-new-version/technical-appendix-lockbit-ng-dev-analysis.pdf"
    ],
    "report_names": [
        "technical-appendix-lockbit-ng-dev-analysis.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1709863623,
    "ts_updated_at": 1743041118,
    "ts_creation_date": 1708593769,
    "ts_modification_date": 1708593769,
    "files": {
        "pdf": "https://archive.orkl.eu/d34fdcfff1605ca007c479ae8856a60fafe04fd9.pdf",
        "text": "https://archive.orkl.eu/d34fdcfff1605ca007c479ae8856a60fafe04fd9.txt",
        "img": "https://archive.orkl.eu/d34fdcfff1605ca007c479ae8856a60fafe04fd9.jpg"
    }
}