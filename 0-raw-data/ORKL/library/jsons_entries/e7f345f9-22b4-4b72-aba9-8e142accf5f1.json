{
    "id": "e7f345f9-22b4-4b72-aba9-8e142accf5f1",
    "created_at": "2023-01-12T15:00:25.164162Z",
    "updated_at": "2025-03-27T02:06:13.201764Z",
    "deleted_at": null,
    "sha1_hash": "8edb24763ddf92a3b9590e0ffa1575759e20e6d0",
    "title": "2020-10-21 - T-RAT 2.0- Malware control via smartphone",
    "authors": "",
    "file_creation_date": "2022-05-28T02:21:54Z",
    "file_modification_date": "2022-05-28T02:21:54Z",
    "file_size": 1967035,
    "plain_text": "# T-RAT 2.0: Malware control via smartphone\n\n**gdatasoftware.com/blog/trat-control-via-smartphone**\n\nMalware sellers want to attract customers with convenience features. Now criminals can remote control malware\nduring their bathroom routine by just using a smartphone and Telegram app.\n\n## Advertisments on Russian forums\n\n[The researcher @3xp0rtblog discovered T-RAT 2.0 and](https://twitter.com/3xp0rtblog) [posted about it on Twitter, including a sample hash and](https://twitter.com/3xp0rtblog/status/1304006897729761280)\nselling threads on Russian forums. One extravagant advertisment is shown below.\n\nThe images below show a section each of a 1000x5429 advertisment banner posted on lolz.guru (found and\nreported by 3xp0rtblog). The Russian text praises comfort and convenience while using T-RAT because it can be\ncontrolled via smartphone with Telegram app.\n\n\n-----\n\nTranslation: \"An\n\nupdated, full-fledged RAT - in your pocket. Get access and use now all functionality. Control from any device,\neverything you need for it to work are the Internet and T-RAT\"\n\n\n-----\n\nTranslation:\n\n\"Advantages - why you should consider buying: comfort and convenience, simple control, huge functionality at a nice\ncost, anonymity and reliability, updates and improvements, cleaning from detectors\"\n\n## Infection chain and persistence\n\nThe first known stage of infection is the downloader[4]. It obtains an encrypted file[6] from\n**hxxps://hgfhhdsf.000webhostapp.com/1DJjnw(dot)jpg and saves it to %TEMP%/gfdggfd.jpg.**\n\nFor decrypting the payload, the downloader applies XOR with the key 0x01. The resulting file is a ZIP archive which\nit saves to %TEMP%/hrtghgesd .zip. The downloader proceeds to delete %TEMP%/gfdggfd.jpg and extracts the\nZIP archive. Sidenote: Both hardcoded names consist of characters whose keys are right besides each other on a\nQWERTY keyboard, so the threat actor likely just rolled a body part on the keyboard to create them.\n\nThe location of the extracted malware is determined as follows:\n\n1) The downloader checks if the current user has administrator rights. If they have, the first part of the path is one of\nthe following (chosen randomly)\n\n%APPDATA%\\Microsoft\\Windows\\\n%USERPROFILE%\\Windows\\System32\\\n%LOCALAPPDATA%\\Microsoft\\Windows\\\n\nIf they don't have administrator rights, the first part of the path is one of the following\n\n%SYSTEM%\\Microsoft\\Protect\\\n%COMMONAPPDATA%\\Microsoft\\Windows\\\n\n\n-----\n\n%USERPROFILE%\\AppData\\LocalLow\\Microsoft\\Windows\\\nC:\\Windows\\assembly\\GAC\\\n\n2) For the second part of the malware path the downloader generates a random number between 347 and 568203,\nconverts that to a string, then generates the hash either using MD5, SHA1 or SHA256. It uses the hash's\nhexadecimal representation as second part of the malware path.\n\nThe archive contains the actual T-RAT executable, named sihost.exe, as well as several DLLs that the RAT needs.\nSome notable libraries are the Telegram.Bot.dll and socks5.dll.\n\nA subfolder named service contains six more files (hashes are in the IoC listing):\n\n**Filename** **Description**\n\nconv.exe High Performance MPEG 1.0/2.0/2.5 Audio Player\n\nin.exe RDP Wrapper\n\nultravnc.ini UltraVNC configuration file\n\nvnchooks.dll UltraVNC - VNCHooks DLL\n\nwinserv1.exe VNC Server 32 bit\n\nwinserv2.exe VNC Server 64 bit\n\nThe downloader persists sihost.exe by scheduling a daily task. The name for the task is the processor ID of the\nsystem. If the current user has admin rights, it will set the run level to HIGHEST. Afterwards the downloader deletes\nitself with the help of a Batch file.\n\nContent of ZIP archive [3]\n\nContent of service folder in\n\nZIP archive [3]\n\n## Packer and obfuscator\n\nThe original T-RAT sample[1] as well as the downloader[4] are .NET assemblies and packed the same way. The\npacked part is embedded as base64 string in the overlay of the file. Beginning and end of the strings are marked by\nthe sequence \"ghjghjbnv\". The packer stub searches the sequence to find the packed image, decodes the base64\nstring and dynamically loads the resulting .NET assembly.\n\n\n-----\n\nsequence in a hex editor\n\nvisualization makes the base64 string visible as blue area in the byteplot.\n\n\nThe base64 string with marker\n\nPortexAnalyzer\n\n\n-----\n\nThe unpacked .NET assemblies are obfuscated with a variant of ConfuserEx. Some Russian strings are visible\nbut most of the referenced strings are base64 encoded.\n\nAfter deobfuscating the assembly with NoFuserEx, the base64 encoded strings remain. I wrote a small Python script\nto do the rest (see Appendix A). It replaces the IL code for calls to FromBase64String with NOPs and replaces the\nbase64 strings with their decoded counterparts. Since the decoded strings are shorter, the remainder is filled with\n**U+200B which is the zero width space Unicode character. (Sidenote: this is a rather lazy solution which does not**\ncreate a perfectly working executable but is good enough for continuing static analysis.)\n\nThe most time-intensive part of deobfuscation for this assembly cannot be automated. The symbol names for\nmethods and classes were eradicated by the obfuscator. So while analysing the code of T-RAT, I added my own\nnames along the way. The code base is comparably on the large side with 98 different commands to control the TRAT client.\n\n\n-----\n\nT-RAT sample before\n\nand after manual deobfuscation\n\n## Functionality overview\n\nThe attacker controls T-RAT via Telegram using text based commands and command buttons provided by the RAT.\nThe commands are in English, the help messages mostly Russian. One section of the advertisment banner\ndemonstrates the controls and how they look like on the phone (see picture below).\n\n\n-----\n\nTranslation for first passage: \"What do you get? A full-fledged RAT for Telegram. Our product implements interesting\nand most importantly necessary functionality. The functionality of a RAT, stealer, keylogger VNC, HRDP, clipper,\nhidden proxy server will be combined right in your pocket and so much more. We invite you to look at our\nfunctionality in more detail.\" The next passages explain stealer and clipper.\nT-RAT has 98 commands. Instead of describing every single command within the main article, I categorized them\ninto groups which are explained below. The full command listing is in Appendix B.\n\n**1. Menu navigation**\n\nThese are commands to enter or exit certain modules like the file manager. They help to make controls via\nsmartphone more convenient.\n\n**2. File manager**\n\nT-RAT can navigate on the file system, show information about the drives and available space, folder contents and\nmodify files and folders. It can also send files to the attacker. Interestingly it mixes in Unix command names. E.g., the\nfile listing is done with ls.\n\n\n-----\n\n**3. Stealer**\n\nThis module allows to obtain passwords, cookies, autofill data from browsers, session or config data of Telegram,\nDiscord, Steam, Nord, Viber, Skype and Filezilla. Most of the data files are either saved besides the T-RAT\nexecutable in text files or to a ZIP archive in %TEMP%/winsys/ before being sent to Telegram.\n\n**4. Clipper**\n\nThe clipper checks the clipboard for coin addresses and replaces them, thus, any digital currency is sent to the\nattacker's wallet. It supports Qiwi, WMR, WMZ, WME, WMX, Yandex money, Payeer, CC, BTC, BTCG, Ripple, Doge\nand Tron. The attackers uses the clipper commands to save their addresses for the specified crypto currency and to\nstart or stop execution of the clipper.\n\n**5. Monitoring and spying**\n\nEnables the attacker to run a keylogger, create screenshots, record audio via the microphone, take pictures via\nwebcam, send clipboard contents.\n\n**6. Evasion**\n\nT-RAT has various methods to bypass UAC, including Fodhelper, Cmstp, Cleanup, Computerdefaults. It can disable\nWindows Defender and Smart Screen notifications. It can disable various security settings, e.g., Association policies\ncan be changed to set \".exe\" as a low-risk file extension, and ZoneIdentifiers can be turned off. It has a check for\nsandboxes and virtual machines.\n\n**7. Disruption**\n\nThese commands kill processes, block websites via the hosts file, block and redirect programs by setting a debugger\nvia Image File Execution Options (for blocking the debugger is one that doesn't exist), disable the taskbar and the\ntask manager.\n\n**8. Remote control**\n\nT-RAT provides a Powershell or CMD terminal via Telegram. Remote control can also be done via HRDP or VNC.\n\nT-RAT runs the HRDP client named service\\in.exe which resides in the executable's location. Then it will create a\nnew user account with a randomized password and name and send the credentials to the attacker. It adds the newly\ncreated user to the Remote Desktop Users group and enables remote access by setting fDenyTSConnections to\n\"0\".\n\nThe VNC server is service\\winserv1.exe on 32 bit systems and service\\winserv2.exe on 64 bit systems.\n\n## Indicators of Compromise\n\n### Sample hashes\n\n**Sample** **Filename** **SHA256**\n\n\n\n[1] T-RAT,\npacked\n\n[2] T-RAT,\nunpacked\nfrom [1]\n\n[3] ZIP\narchive\ncontaining\n\n[1][7-11]\n\n\nUpdate Service.exe\n\nsihost.exe\n\n\ndfa35a3bed8aa7e30e2f3ad0927fa69adecb5b6f4c8a8535b05c28eacbd0dad8\n\n\nNA 0388c08ae8bf8204ed609a4730a93a70612d99e66f1d700c2edfb95197ab7cc9\n\n\n%TEMP%/hrtghgesd\n.zip\n\n\n9fe677aa81790414db3187bba2e159c5aafda6dc0411fbd5d4786b7e596143f3\n\n\n-----\n\n**Sample** **Filename** **SHA256**\n\n\n\n[4] T-RAT\ndownloader\n\n[5] T-RAT\ndownloader,\nunpacked\nfrom [4]\n\n[6] Raw\ndownload\n\n[7] Audio\nPlayer\n\n[8] RDP\nWrap\n\n[9] VNC\nServer\n\n[10] VNC\nServer\n\n[11] Ultra\nVNC Hooks\nDLL\n\n\nUpdate Service.exe b6093289ff0470053bd7dde771fa3a6cd21dae99fc444bfebcd33eb153813263\n\nNA e7604cc2288b27e29f1c0b2aeade1af486daee7b5c17b0478ce336dcdbeee2f1\n\n\n1DJjnw.jpg\n\n%TEMP%/gfdggfd.jpg\n\n\n27dcb69c1d010da7d1f359523b398e14e0af0dd5bad1a240734a31ffce8b9262\n\n\nconv.exe 96ba1d40eb85f60a20224e199c18126b160fe165e727b7dee268890dc5148c68\n\nin.exe ac92d4c6397eb4451095949ac485ef4ec38501d7bb6f475419529ae67e297753\n\nwinserv1.exe c1316ac68d5f3f5ec080d09ffc7c52670a7c42672f0233b9ef50e4b739bd0586\n\nwinserv2.exe 912913d897dd2f969fbcbdb54dde82e54f287ade97725380232dce664417c46c\n\nvnchooks.dll c8164ccc0cf04df0f111d56d7fb717e6110f8dee77cfc3ef37507f18485af04d\n\n\n### IoCs for downloader[4]\n\n**Download URL** hxxps://hgfhhdsf.000webhostapp.com/1DJjnw.jpg\n\n**Download location** %TEMP%/gfdggfd.jpg\n\n**Decrypted download** %TEMP%/hrtghgesd .zip\n\n**Mutex** dwm\n\n**Scheduled task** for sihost.exe[1], task name is the processor ID of infected system\n\n\n### IoCs for T-RAT[1]\n\n**File name** sihost.exe\n\n**Mutex** srvhost\n\n**Creates processes** winserv1.exe, winserv2.exe, in.exe\n\n**IFEO Debugger** fghdshdzfhgsdfh.exe\n\n**User account on system** usr[1000-10000], e.g., usr3432\n\n**Data folder** %TEMP%/winsys/\n\n## Appendix A: Deobfuscation script\n\n\n-----\n\n```\n         py\nimport re\nimport base64\nimport sys\nimport os\nimport argparse\nfrom shutil import copyfile\ndef isBase64(s): try: return base64.b64encode(base64.b64decode(s)) == s except Exception: return False\ndef searchAndReplace(search, replace, binfile): content = \"\" with open(binfile,\"rb\") as bif: content =\nbif.read() new_content = content.replace(search, replace) if new_content == content: print\n\"Search string not found.\" return with open(binfile,\"wb+\") as wif: wif.write(new_content)\nif __name__ == \"__main__\": parser = argparse.ArgumentParser(description='Decode and replace base64\nstrings in binary. Karsten Hahn @ G DATA CyberDefense') parser.add_argument('str_listing', help='Text file\nwith strings listing of sample. E.g. use Sysinternals strings.exe') parser.add_argument('sample',\nhelp='Sample file where base64 strings should be replaced') args = parser.parse_args() inputfile =\nargs.sample outputfile = args.sample + \".decoded\" copyfile(inputfile, outputfile) base64Regex =\nre.compile(r'^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$') str_listing =\nargs.str_listing with open(str_listing) as ref_file: print 'Extracting base64 strings...'\nbase_strings = [] for line in ref_file: base_strings += base64Regex.findall(line) print\n\"Replacing base64 strings...\" for base_str in sorted(base_strings, key=len, reverse=True): if\nlen(base_str) > 3 and isBase64(base_str): decoded_string = base64.b64decode(base_str)\ndecoded_bytes = bytearray(str(decoded_string).decode('utf-8').encode(\"utf-16le\")) base_bytes =\nbytearray(str(base_str).decode('utf-8').encode(\"utf-16le\")) while len(decoded_bytes) < len(base_bytes):\ndecoded_bytes.extend(b'\\x0B\\x20') #print decoded_bytes searchAndReplace(base_bytes, decoded_bytes,\noutputfile) print \"Replacing calls to decode Base64...\" # Optional: remove calls to Base64\nconversion, this is specific to the sample # for T-RAT # searchAndReplace(b'\\x28\\x27\\x00\\x00\\x0A',\nb'\\x00\\x00\\x00\\x00\\x00', outputfile) # for T-RAT downloader # searchAndReplace(b'\\x28\\x17\\x00\\x00\\x0A',\nb'\\x00\\x00\\x00\\x00\\x00', outputfile) print 'All done' print 'Deobfuscated file written to',\noutputfile\n\n## Appendix B: T-RAT Commands\n\n```\nThese are all T-RAT 2.0 commands and a description for some of them.\n\n**Command** **Description**\n\n/help Print available commands (shows different commands depending on the state of the\nmenu)\n\n/getscreen Takes a screenshot and sends as photo to Telegram\n\n/webcam Takes a picture using the webcam and sends as photo to Telegram\n\n/record Records audio using the microphone. Saves it to record.wav in the executable's\nfolder.\n\n/sysinfo Shows: username, IP, MAC, computername, processor model, number of cores,\nprocessor size, graphics card model, RAM, operating system, architecture, system\ndirectory, antivirus, firewall, drive info and available space\n\n/isadmin Checks if executable has admin rights\n\n/activewindow\n\n/openwindows\n\n/programs Shows list of installed programs by obtaining all DisplayName values for all subkeys\nof SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\n\n/processlist\n\n/killprocess [process]\n\n\n-----\n\n**Command** **Description**\n\n/run [path] Creates a hidden folder in %TEMP% named winsys. Puts a VBScript file named\n<random_digits>.vbs in this folder. The VBScript uses ShellExecute to run the file\ngiven in [path] parameter.\n\nIt uses a template called \"Run2\" in the resources for the VBScript and replaces\n\"lmao\" with [path]\n\n/clipboard Posts clipboard content to Telegram\n\n/location\n\n/path\n\n\n/blocksite [example\ngoogle.com]\n\n/redirectprogram [first]\n\n[second]\n\n/blockprogram [name]\n\n[block|unblock]\n\n\nBlocks a site via hosts file redirection to localhost\n\nSets the second parameter as debugger for the first via Image File Execution\nOptions (IFEO)\n\n**block: Sets a non-existant debugger (\"fghdshdzfhgsdfh.exe\") for the program via**\nImage File Execution Options (IFEO)\n\n**unblock: Removes the IFEO debugger from registry**\n\n\n/CmstpUACBypass UAC bypass via cmstp.exe\n\n/CleanupUACBypass UAC bypass via SilentCleanup\n\n/FodHelperUACBypass UAC bypass via fodhelper.exe\n\n/ComputerDefUACBypass UAC bypass via computerdefaults.exe\n\n/OffCertChecking In Attachment Policies sets: HideZoneInfoOnProperties to \"1\" and\nSaveZoneInformation to \"2\" (= Off)\n\nIn Associations Policies sets: DefaultFileTypeRisk to \"6152\" (= Low) and\nLowRiskFileTypes to \".exe\" (yes, only \".exe\")\n\n/DisableWindowsDefender Disables TamperProtection; enables DisableAntiSpyware,\nDisableBehaviorMonitoring, DisableOnAccessProtection and\nDisableScanOnRealtimeEnable\n\n/OffAvNotification Disables SmartScreen and sets registry values to \"0\" for: EnableLUA,\nConsentPromptBehaviorAdmin, PromptOnSecureDesktop\n\n/cmd Provides a remote cmd terminal\n\n/powershell Provides a remote powershell console\n\n/settings\n\n/disconnect\n\n/opencd Calls mciSendStringA with \"set cdaudio door open\"\n\n/closecd Calls mciSendStringA with \"set cdaudio door closed\"\n\n/exploreroff Sets DisableTaskMgr to \"1\"\n\n/exploreron Deletes subkey tree for\nSoftware\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\n\n/hidetaskbar Calls user32.dll ShowWindow with SW_HIDE parameter\n\n\n-----\n\n**Command** **Description**\n\n/showtaskbar Calls user32.dll ShowWindow for Shell_TrayWnd\n\n/wallpaper Asks the user to send a picture to set as wallpaper\n\n/collapsewindows\n\n/reboot\n\n/kill\n\n/suicide\n\ncd [directory] Sets working directory\n\nback Goes one step back in the command listing\n\nls\n\ndrives\n\naction [name] Provides file operations: info, run, delete, read, send, cd\n\nmkdir [NameFileInFolder] Creates a directory\n\nremove [NameFileInFolder],\n\n[AnotherDirectory]\n\nrename [NameFileInFolder],\n\n[NewName]\n\n/hrdp 1) Runs service\\in.exe from executable folder.\n\n2) Sets fDenyTSConnections to \"0\"\n\n3) Creates new user account named usr<rand_nr1000-10000> with password\n**<rand_nr10000-20000>**\n\n4) Adds new user to Remote Desktop Users group\n\n5) Prints credentials for new user to Telegram\n\n/StartProxyServer Starts a Socks5 proxy using port 5901\n\n/StopProxyServer Stops above proxy\n\n/StartVNC Runs service\\winserv1.exe for 32 bit architecture, or service\\winserv2.exe for 64\nbit architecture. Both reside in the executable folder.\n\n/StopVNC Kills any process with a name containing the substring winserv1 (32 bit)or\n**winserv2 (64 bit)**\n\n/CheckVNC Returns if a process name containing winserv1 or winserv2 exists\n\n/commands Menu navigation\n\n/control Menu navigation\n\n/stealer Menu navigation\n\n/filemanager Menu navigation\n\n/StealPasswords\n\n/StealWebData Searches for Web Data folder in the %LOCALAPPDATA% directory and extracts\nautofill information. This folder is part of Chrome.\n\n\n-----\n\n**Command** **Description**\n\n/StealCookies Saves cookies to Cookies.txt in the executable folder and uploads it to Telegram\n\n/GetTelegramSession Steal Telegram data\n\n/GetSteamFiles Steal Steam data\n\n/GetNordData Steal Nord data\n\n/GetFilezillaConfig Steal Filezilla configuration\n\n/GetSkypeSession Saves skype appdata folder contents to %TEMP%/winsys/Skype.zip and uploads\nthis file to Telegram\n\n/GetDiscordSession Saves Discord\\Local Storage\\leveldb folder contents to\n%TEMP%/winsys/Discord.zip and uploads this to Telegram\n\n/GetViberSession Steal Viber data\n\n/SetQiwi [wallet] Set Qiwi wallet for clipper\n\n/SetWMR [wallet] Set WMR wallet for clipper\n\n/SetWMZ [wallet] Set WMZ wallet for clipper\n\n/SetWME [wallet] Set WME wallet for clipper\n\n/SetWMX [wallet] Set WMX wallet for clipper\n\n/SetYandexMoney [wallet] Set Yandex Money wallet for clipper\n\n/SetCC [wallet] Set CC wallet for clipper\n\n/SetPayeer [wallet] Set Payeer wallet for clipper\n\n/SetRipple [wallet] Set Ripple wallet for clipper\n\n/SetDogechain [wallet] Set Doge wallet for clipper\n\n/SetTron [wallet] Set Tron wallet for clipper\n\n/SetBTCG [wallet] Set BTCG wallet for clipper\n\n/SetBTC [wallet] Set BTC waller for clipper\n\n/wallets\n\n/SaveConfig\n\n/SendConfig\n\n/StartScreenLogger\n\n/StartKeyLogger\n\n/SendLog\n\n/StopKeyLogger\n\n/SendScreenshots\n\n/StopScreenLogger\n\n/ClipperStart\n\n\n-----\n\n**Command** **Description**\n\n/ClipperStop\n\n/ClipboardLoggerStart\n\n/ClipboardLoggerSend\n\n/ClipboardLoggerStop\n\n/clipboard\n\n/functions\n\n/exit Menu navigation\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-10-21 - T-RAT 2.0- Malware control via smartphone.pdf"
    ],
    "report_names": [
        "2020-10-21 - T-RAT 2.0- Malware control via smartphone.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535625,
    "ts_updated_at": 1743041173,
    "ts_creation_date": 1653704514,
    "ts_modification_date": 1653704514,
    "files": {
        "pdf": "https://archive.orkl.eu/8edb24763ddf92a3b9590e0ffa1575759e20e6d0.pdf",
        "text": "https://archive.orkl.eu/8edb24763ddf92a3b9590e0ffa1575759e20e6d0.txt",
        "img": "https://archive.orkl.eu/8edb24763ddf92a3b9590e0ffa1575759e20e6d0.jpg"
    }
}