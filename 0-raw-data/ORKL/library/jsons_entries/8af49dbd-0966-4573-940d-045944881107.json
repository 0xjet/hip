{
    "id": "8af49dbd-0966-4573-940d-045944881107",
    "created_at": "2022-10-25T16:48:23.389118Z",
    "updated_at": "2025-03-27T02:15:18.831065Z",
    "deleted_at": null,
    "sha1_hash": "829bf301061a9a6358c233ca5aa459439fc0aec8",
    "title": "New Zero-Day Exploit Targeting Internet Explorer Versions 9 Through 11 Identified In Targeted Attacks",
    "authors": "FireEye",
    "file_creation_date": "2014-08-29T15:07:06Z",
    "file_modification_date": "2014-08-29T15:07:06Z",
    "file_size": 94579,
    "plain_text": "# through 11 Identified in Targeted Attacks\n\n**Summary**\n\nFireEye Research Labs identified a new Internet Explorer (IE) zero-day exploit used in targeted attacks.\n\nThe vulnerability affects IE6 through IE11, but the attack is targeting IE9 through IE11. This zero-day\n\nbypasses both ASLR and DEP. Microsoft has assigned CVE-2014-1776 to the vulnerability and released\n\n[security advisory to track this issue.](https://technet.microsoft.com/en-US/library/security/2963983)\n\nThreat actors are actively using this exploit in an ongoing campaign which we have named “Operation\n\nClandestine Fox.” However, for many reasons, we will not provide campaign details. But we believe this is\n\na significant zero day as the vulnerable versions represent about a quarter of the total browser market. We\n\nrecommend applying a patch once available.\n\n[According to NetMarket Share, the market share for the targeted versions of IE in 2013 were:](http://www.netmarketshare.com/browser-market-share.aspx?qprid=2&qpcustomd=0&qpsp=168&qpnp=12&qptimeframe=M)\n\nIE 9   13.9%\n\nIE 10  11.04%\n\nIE 11   1.32%\n\nCollectively, in 2013, the vulnerable versions of IE accounted for 26.25% of the browser market. The\n\nvulnerability, however, does appear in IE6 through IE11 though the exploit targets IE9 and higher.\n\n## The Details\n\nThe exploit leverages a previously unknown use-after-free vulnerability, and uses a well-known Flash\n\nexploitation technique to achieve arbitrary memory access and bypass Windows’ ASLR and DEP\n\nprotections.\n\n## Exploitation\n\n### • Preparing the heap\n\nThe exploit page loads a Flash SWF file to manipulate the heap layout with the common technique heap\n\nfeng shui. It allocates Flash vector objects to spray memory and cover address 0×18184000. Next, it\n\nallocates a vector object that contains a flash.Media.Sound() object, which it later corrupts to pivot control\n\nto its ROP chain.\n\n### • Arbitrary memory access\n\n\n-----\n\nvector object in the heapspray. The SWF file loops through the heapspray to find the corrupted vector\n\nobject, and uses it to again modify the length of another vector object. This other corrupted vector object is\n\nthen used for subsequent memory accesses, which it then uses to bypass ASLR and DEP.\n\n### • Runtime ROP generation\n\nWith full memory control, the exploit will search for ZwProtectVirtualMemory, and a stack pivot (opcode\n\n0×94 0xc3) from NTDLL. It also searches for SetThreadContext in kernel32, which is used to clear the\n\n[debug registers. This technique, documented here, may be an attempt to bypass protections that use](http://piotrbania.com/all/articles/anti_emet_eaf.txt)\n\nhardware breakpoints, such as EMET’s EAF mitigation.\n\nWith the addresses of the aforementioned APIs and gadget, the SWF file constructs a ROP chain, and\n\nprepends it to its RC4 decrypted shellcode. It then replaces the vftable of a sound object with a fake one\n\nthat points to the newly created ROP payload. When the sound object attempts to call into its vftable, it\n\ninstead pivots control to the attacker’s ROP chain.\n\n### • ROP and Shellcode\n\nThe ROP payload basically tries to make memory at 0×18184000 executable, and to return to 0x1818411c\n\nto execute the shellcode.\n\n0:008> dds eax\n\n18184100 770b5f58 ntdll!ZwProtectVirtualMemory\n\n18184104 1818411c\n\n18184108 ffffffff\n\n1818410c 181840e8\n\n18184110 181840ec\n\n18184114 00000040\n\n18184118 181840e4\n\nInside the shellcode, it saves the current stack pointer to 0×18181800 to safely return to the caller.\n\nmov   dword ptr ds:[18181800h],ebp\n\nThen, it restores the flash.Media.Sound vftable and repairs the corrupted vector object to avoid\n\napplication crashes.\n\n18184123 b820609f06   mov   eax,69F6020h\n\n18184128 90       nop\n\n\n-----\n\n1818412a c700c0f22169  mov   dword ptr [eax],offset\n\nFlash32_11_7_700_261!AdobeCPGetAPI+0x42ac00 (6921f2c0)\n\n18184133 b800401818   mov   eax,18184000h\n\n18184138 90       nop\n\n18184139 90       nop\n\n1818413a c700fe030000  mov   dword ptr [eax],3FEh\n\nds:0023:18184000=3ffffff0\n\nThe shellcode also recovers the ESP register to make sure the stack range is in the current thread stack\n\nbase/limit.\n\n18184140 8be5      mov   esp,ebp\n\n18184142 83ec2c     sub   esp,2Ch\n\n18184145 90       nop\n\n18184146 eb2c      jmp   18184174\n\nThe shellcode calls SetThreadContext to clear the debug registers. It is possible that this is an attempt to\n\nbypass mitigations that use the debug registers.\n\n18184174 57       push  edi\n\n18184175 81ece0050000  sub   esp,5E0h\n\n1818417b c7042410000100 mov   dword ptr [esp],10010h\n\n18184182 8d7c2404    lea   edi,[esp+4]\n\n18184186 b9dc050000   mov   ecx,5DCh\n\n1818418b 33c0      xor   eax,eax\n\n1818418d f3aa      rep stos byte ptr es:[edi]\n\n1818418f 54       push  esp\n\n18184190 6afe      push  0FFFFFFFEh\n\n18184192 b8b308b476   mov   eax,offset kernel32!SetThreadContext\n\n(76b408b3)\n\n18184197 ffd0      call  eax\n\nThe shellcode calls URLDownloadToCacheFileA to download the next stage of the payload, disguised as\n\nan image.\n\n## Mitigation\n\nUsing EMET may break the exploit in your environment and prevent it from successfully controlling your\n\n\n-----\n\n**Enhanced Protected Mode in IE breaks the exploit in our tests. EPM was introduced in IE10.**\n\nAdditionally, the attack will not work without Adobe Flash. Disabling the Flash plugin within IE will\n\n**prevent the exploit from functioning.**\n\n## Threat Group History\n\nThe APT group responsible for this exploit has been the first group to have access to a select number of\n\nbrowser-based 0-day exploits (e.g. IE, Firefox, and Flash) in the past. They are extremely proficient at\n\nlateral movement and are difficult to track, as they typically do not reuse command and control\n\ninfrastructure. They have a number of backdoors including one known as Pirpi that we previously\n\n[discussed here. CVE-2010-3962, then a 0-day exploit in Internet Explorer 6, 7, and 8 dropped the Pirpi](http://www.fireeye.com/blog/technical/botnet-activities-research/2010/11/ie-0-day-hupigon-joins-the-party.html)\n\npayload discussed in this previous case.\n\nAs this is still an active investigation we are not releasing further indicators about the exploit at this time.\n\n_Acknowledgement: We thank Christopher Glyer, Matt Fowler, Josh Homan, Ned Moran, Nart_\n\n_Villeneuve and Yichong Lin for their support, research, and analysis on these findings._\n\n[This entry was posted in Advanced Malware, Exploits, Targeted Attack, Uncategorized and tagged zero-](http://www.fireeye.com/blog/category/technical/malware-research)\n\n[day by Xiaobo Chen, Dan Caselden and Mike Scott. Bookmark the permalink.](http://www.fireeye.com/blog/author/xiaobo-chen)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/5epjx7i7fc3q8jh8o4exabquoar1s3ii",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.04.26.Operation_Clandestine_Fox/Op_Clandestine_Fox.pdf"
    ],
    "report_names": [
        "Op_Clandestine_Fox"
    ],
    "threat_actors": [
        {
            "id": "13354d3f-3f40-44ec-b42a-3cda18809005",
            "created_at": "2022-10-25T15:50:23.275272Z",
            "updated_at": "2025-03-27T02:00:55.418075Z",
            "deleted_at": null,
            "main_name": "APT3",
            "aliases": [
                "APT3",
                "Gothic Panda",
                "Pirpi",
                "UPS Team",
                "Buckeye",
                "Threat Group-0110",
                "TG-0110"
            ],
            "source_name": "MITRE:APT3",
            "tools": [
                "OSInfo",
                "schtasks",
                "PlugX",
                "LaZagne",
                "SHOTPUT",
                "RemoteCMD"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "06f622cb-3a78-49cf-9a4c-a6007a69325f",
            "created_at": "2022-10-25T16:07:23.315239Z",
            "updated_at": "2025-03-27T02:02:09.733197Z",
            "deleted_at": null,
            "main_name": "APT 3",
            "aliases": [
                "APT 3",
                "Bronze Mayfair",
                "Buckeye",
                "Gothic Panda",
                "Group 6",
                "Operation Clandestine Fox",
                "Operation Clandestine Fox, Part Deux",
                "Operation Clandestine Wolf",
                "Operation Double Tap",
                "Red Sylvan",
                "TG-0110",
                "UPS Team"
            ],
            "source_name": "ETDA:APT 3",
            "tools": [
                "APT3 Keylogger",
                "Agent.dhwf",
                "BKDR_HUPIGON",
                "Backdoor.APT.CookieCutter",
                "Badey",
                "Bemstour",
                "CookieCutter",
                "Destroy RAT",
                "DestroyRAT",
                "DoublePulsar",
                "EXL",
                "EternalBlue",
                "HTran",
                "HUC Packet Transmit Tool",
                "Hupigon",
                "Hupigon RAT",
                "Kaba",
                "Korplug",
                "LaZagne",
                "MFC Huner",
                "OSInfo",
                "Pirpi",
                "PlugX",
                "RedDelta",
                "RemoteCMD",
                "SHOTPUT",
                "Sogu",
                "TIGERPLUG",
                "TTCalc",
                "TVT",
                "Thoper",
                "Xamtrav",
                "remotecmd",
                "shareip",
                "w32times"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716503,
    "ts_updated_at": 1743041718,
    "ts_creation_date": 1409324826,
    "ts_modification_date": 1409324826,
    "files": {
        "pdf": "https://archive.orkl.eu/829bf301061a9a6358c233ca5aa459439fc0aec8.pdf",
        "text": "https://archive.orkl.eu/829bf301061a9a6358c233ca5aa459439fc0aec8.txt",
        "img": "https://archive.orkl.eu/829bf301061a9a6358c233ca5aa459439fc0aec8.jpg"
    }
}