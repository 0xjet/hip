{
    "id": "46ff6572-fd5c-457e-8c6b-3739eac9817a",
    "created_at": "2022-10-25T16:48:24.42639Z",
    "updated_at": "2025-03-27T02:08:41.227235Z",
    "deleted_at": null,
    "sha1_hash": "78ea4b8589b7b776b4a9fe94fd42bd74740d4276",
    "title": "IRONGATE ICS Malware: Nothing to See Here...Masking Malicious Activity on SCADA Systems",
    "authors": "FireEye",
    "file_creation_date": "2016-06-11T00:10:49Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 746280,
    "plain_text": "# O G CS a a e o g o See e e as g Malicious Activity on SCADA Systems\n\n**www.fireeye.com** [/blog/threat-research/2016/06/irongate_ics_malware.html](https://www.fireeye.com/blog/threat-research/2016/06/irongate_ics_malware.html)\n\nIn the latter half of 2015, the FireEye Labs Advanced Reverse Engineering (FLARE) team identified several versions\nof an ICS-focused malware crafted to manipulate a specific industrial process running within a simulated Siemens\ncontrol system environment. We named this family of malware IRONGATE.\n\nFLARE found the samples on VirusTotal while researching droppers compiled with PyInstaller — an approach used\nby numerous malicious actors. The IRONGATE samples stood out based on their references to SCADA and\nassociated functionality. Two samples of the malware payload were uploaded by different sources in 2014, but none\nof the antivirus vendors featured on VirusTotal flagged them as malicious.\n\nSiemens Product Computer Emergency Readiness Team (ProductCERT) confirmed that IRONGATE is not viable\nagainst operational Siemens control systems and determined that IRONGATE does not exploit any vulnerabilities in\nSiemens products. We are unable to associate IRONGATE with any campaigns or threat actors. We acknowledge\nthat IRONGATE could be a test case, proof of concept, or research activity for ICS attack techniques.\n\n[Our analysis finds that IRONGATE invokes ICS attack concepts first seen in Stuxnet, but in a simulation](http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/stuxnet_0_5_the_missing_link.pdf)\nenvironment. Because the body of industrial control systems (ICS) and supervisory control and data acquisition\n(SCADA) malware is limited, we are sharing details with the broader community.\n\n## Malicious Concepts\n\n**Deceptive Man-in-the-Middle**\n\nIRONGATE's key feature is a man-in-the-middle (MitM) attack against process input-output (IO) and process\noperator software within industrial process simulation. The malware replaces a Dynamic Link Library (DLL) with a\nmalicious DLL, which then acts as a broker between a PLC and the legitimate monitoring software. This malicious\nDLL records five seconds of 'normal' traffic from a PLC to the user interface and replays it, while sending different\ndata back to the PLC. This could allow an attacker to alter a controlled process unbeknownst to process operators.\n\n**Sandbox Evasion**\n\nIRONGATE's second notable feature involves sandbox evasion. Some droppers for the IRONGATE malware would\nnot run if VMware or Cuckoo Sandbox environments were employed. The malware uses these techniques to avoid\ndetection and resist analysis, and developing these anti-sandbox techniques indicates that the author wanted the\ncode to resist casual analysis attempts. It also implies that IRONGATE’s purpose was malicious, as opposed to a\ntool written for other legitimate purposes.\n\n**Dropper Observables**\n\nWe first identified IRONGATE when investigating droppers compiled with PyInstaller — an approach used by\nnumerous malicious actors. In addition, strings found in the dropper include the word “payload”, which is commonly\nassociated with malware.\n\n## Unique Features for ICS Malware\n\n\n-----\n\nrotor speeds at the Natanz uranium enrichment facility; it also demonstrates new features for ICS malware.\n\nBoth pieces of malware look for a single, highly specific process.\n\nBoth replace DLLs to achieve process manipulation.\n\nIRONGATE detects malware detonation/observation environments, whereas Stuxnet looked for the presence\nof antivirus software.\n\nIRONGATE actively records and plays back process data to hide manipulations, whereas Stuxnet did not\nattempt to hide its process manipulation, but suspended normal operation of the S7-315 so even if rotor\n[speed had been displayed on the HMI, the data would have been static.](http://www.langner.com/en/wp-content/uploads/2013/11/To-kill-a-centrifuge.pdf)\n\n## A Proof of Concept\n\nIRONGATE’s characteristics lead us to conclude that it is a test, proof of concept, or research activity.\n\nThe code is specifically crafted to look for a user-created DLL communicating with the Siemens PLCSIM\nenvironment. PLCSIM is used to test PLC program functionality prior to in-field deployment. The DLLs that\nIRONGATE seeks and replaces are not part of the Siemens standard product set, but communicate with the\nS7ProSim COM object. Malware authors test concepts using commercial simulation software.\n\nCode in the malicious software closely matched usage on a control engineering blog dealing with PLCSIM\n(https://alexsentcha.wordpress.com/using-s7-prosim-with-siemens-s7-plcsim/ and\nhttps://pcplcdemos.googlecode.com/hg/S7PROSIM/BioGas/S7%20v5.5/).\n\nWhile we have identified and analyzed several droppers for the IRONGATE malware, we have yet to identify\nthe code’s infection vector.\n\nIn addition, our analysis did not identify what triggers the MitM payload to install; the scada.exe binary that\ndeploys the IRONGATE DLL payload appears to require manual execution.\n\nWe have not identified any other instances of the ICS-specific IRONGATE components (scada.exe and\nStep7ProSim.dll), despite their having been compiled in September of 2014.\n\nSiemens ProductCERT has confirmed that the code would not work against a standard Siemens control\nsystem environment.\n\n## Implications for ICS Asset Owners\n\nEven though process operators face no increased risk from the currently identified members of the IRONGATE\nmalware family, IRONGATE provides valuable insight into adversary mindset.\n\nNetwork security monitoring, indicator of compromise (IoC) matching, and good practice guidance from vendors and\nother stakeholders represent important defensive techniques for ICS networks.\n\nTo specifically counter IRONGATE’s process attack techniques, ICS asset owners may, over the longer term,\nimplement solutions that:\n\nRequire integrity checks and code signing for vendor and user generated code. Lacking cryptographic\nverification facilitates file replacement and MitM attacks against controlled industrial processes.\n\nDevelop mechanisms for sanity checking IO data, such as independent sensing and backhaul, and\ncomparison with expected process state information. Ignorance of expected process state facilitates an\n\n\n-----\n\n## IRONGATE Dropper Family\n\nFireEye has identified six IRONGATE droppers:\n\nbla.exe, update.exe1, update_no_pipe.exe1, update_no_pipe.exe2, update_no_pipe.exe2, update.exe3. All but one\n\nof these Python-based droppers first checks for execution in a VMware or Cuckoo Sandbox environment. If found,\nthe malware exits.\n\n[If not found, the IRONGATE dropper extracts a UPX-packed, publicly available utility (NirSoft NetResView version](http://www.nirsoft.net/utils/netresview.html)\n1.27) to audiodg.exe in the same directory as the dropper. The dropper then executes the utility using the command\n\naudiodg.exe /scomma scxrt2.ini. This command populates the file scxrt2.ini with a comma-separated list of network\nresources identified by the host system.\n\nThe dropper iterates through each entry in scxrt2.ini, looking for paths named move-to-operational or move-tooperational.lnk. If a path is found, the dropper first extracts the Base64-encoded .NET executable scada.exe to the\ncurrent directory and then moves the file to the path containing move-to-operational or move-to-operational.lnk. The\npath move-to-operational is interesting as well, perhaps implying that IRONGATE was not seeking the actual\nrunning process, but rather a staging area for code promotion. The dropper does not execute the scada.exe\npayload after moving it.\n\n**Anti-Analysis Techniques**\n\nEach IRONGATE dropper currently identified deploys the same .NET payload, scada.exe. All but one of the\ndroppers incorporated anti-detection/analysis techniques to identify execution in VMware or the Cuckoo Sandbox. If\nsuch environments are detected, the dropper will not deploy the .NET executable (scada.exe) to the host.\n\nFour of the droppers (\n\nupdate.exe1, update_no_pipe.exe1, update_no_pipe.exe2, and update.exe3) detect Cuckoo environments by\n\nscanning subdirectories of the %SystemDrive%. Directories with names greater than five, but fewer than ten\ncharacters are inspected for the subdirectories drop, files, logs, memory, and shots. If a matching directory is found,\nthe dropper does not attempt to deploy the scada.exe payload.\n\nThe update.exe1 and update.exe3 droppers contain code for an additional Cuckoo check using the SysInternals\n\npipelist program, install.exe, but the code is disabled in each.\n\nThe update.exe2 dropper includes a check for VMware instead of Cuckoo. The VMWare check looks for the registry\n\nkey\n\nHKLM\\SOFTWARE\\VMware, Inc.\\VMware Tools and the files %WINDIR%\\system32\\drivers\\vmmouse.sys and\n%WINDIR%\\system32\\drivers\\vmhgfs.sys. If any of these are found, the dropper does not attempt to deploy the\nscada.exe payload.\n\nThe dropper bla.exe does not include an environment check for either Cuckoo or VMware.\n\n**scada.exe Payload**\n\nWe surmise that scada.exe is a user-created payload used for testing the malware. First, our analysis did not\n\n\n-----\n\nWhen scada.exe executes, it scans drives attached to the system for filenames ending in Step7ProSim.dll.\nAccording to the Siemens ProductCERT, Step7ProSim.dll is not part of the Siemens PLCSIM software. We were\nunable to determine whether this DLL was created specifically by the malware author, or if it was from another\nsource, such as example code or a particular custom ICS implementation. We surmise this DLL simulates\ngeneration of IO values, which would normally be provided by an S7-based controller, since the functions it includes\nappear derived from the Siemens PLCSIM environment.\n\nIf scada.exe finds a matching DLL file name, it kills all running processes with the name biogas.exe. The malware\nthen moves Step7ProSim.dll to Step7ConMgr.dll and drops a malicious Step7ProSim.dll – the IRONGATE payload\n– to the same directory.\n\nThe malicious Step7ProSim.dll acts as an API proxy between the original user-created Step7ProSim.dll (now named\nStep7ConMgr.dll) and the application biogas.exe that loads it. Five seconds after loading, the malicious\nStep7ProSim.dll records five seconds of calls to ReadDataBlockValue. All future calls to ReadDataBlockValue return\nthe recorded data.\n\nSimultaneously, the malicious DLL discards all calls to WriteDataBlockValue and instead calls\n\nWriteInputPoint(0x110, 0, 0x7763) and WriteInputPoint(0x114, 0, 0x7763) every millisecond. All of these functions\nare named similarly to Siemens S7ProSim v5.4 COM interface. It appears that other calls to API functions are\npassed through the malicious DLL to the legitimate DLL with no other modification.\n\n**Biogas.exe**\n\nAs mentioned previously, IRONGATE seeks to manipulate code similar to that found on a blog dealing with\nsimulating PLC communications using PLCSIM, including the use of an executable named biogas.exe.\n\nExamination of the executable from that blog’s demo code shows that the WriteInputPoint function calls with byte\nindices 0x110 and 0x114 set pressure and temperature values, respectively:\n\nIRONGATE:\n\nWriteInputPoint(0x110, 0, 0x7763)\nWriteInputPoint(0x114, 0, 0x7763)\n\nEquivalent pseudo code from Biogas.exe:\n\nS7ProSim.WriteInputPoint(0x110, 0, (short)this.Pressure.Value)\nS7ProSim.WriteInputPoint(0x114, 0, (short)this.Temperature.Value)\n\nWe have been unable to determine the significance of the hardcoded value 0x7763, which is passed in both\ninstances of the write function.\n\nBecause of the noted indications that IRONGATE is a proof of concept, we cannot conclude IRONGATE’s author\nintends to manipulate specific temperature or pressure values associated with the specific biogas.exe process, but\nfind the similarities to this example code striking.\n\n## Artifacts and Indicators\n\n\n-----\n\nThe IRONGATE droppers are Python scripts converted to executables using PyInstaller. The compiled droppers\ncontain PyInstaller artifacts from the system the executables were created on. These artifacts may link other\nsamples compiled on the same system. Five of the six file droppers (\n\nbla.exe, update.exe1, update_no_pipe.exe1, update_no_pipe.exe2 and update.exe3) all share the same PyInstaller\n\nartifacts listed in Table 1.\n\nTable 1: Pyinstaller Artifacts\n\nThe remaining dropper, update.exe2, contains the artifacts listed in Table 2.\n\n\n-----\n\n## Unique Strings\n\nFigure 1 and 2 list the unique strings discovered in the scada.exe and Step7ProSim.dll binaries.\n\nFigure 1: Scada.exe Unique Strings\n\nFigure 2: Step7ProSim.dll Unique Strings\n\n## File Hashes\n\nTable 3 contains the MD5 hashes, file and architecture type, and compile times for the malware analyzed in this\nreport.\n\n\n-----\n\nTable 3: File MD5 Hashes and Compile Times\n\nFireEye detects IRONGATE. A list of indicators can be found [here.](https://github.com/fireeye/iocs)\n\nSpecial thanks to the Siemens ProductCERT for providing support and context to this investigation.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/6s871m2xa63x4ru8glto9crcv6kk8jor"
    ],
    "report_names": [
        "FireEye_IRONGATE_ICS(06-02-2016)"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1465603849,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/78ea4b8589b7b776b4a9fe94fd42bd74740d4276.pdf",
        "text": "https://archive.orkl.eu/78ea4b8589b7b776b4a9fe94fd42bd74740d4276.txt",
        "img": "https://archive.orkl.eu/78ea4b8589b7b776b4a9fe94fd42bd74740d4276.jpg"
    }
}