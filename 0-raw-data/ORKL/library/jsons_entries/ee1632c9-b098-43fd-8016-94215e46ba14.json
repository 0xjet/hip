{
    "id": "ee1632c9-b098-43fd-8016-94215e46ba14",
    "created_at": "2023-01-12T15:04:26.93989Z",
    "updated_at": "2025-03-27T02:15:35.572151Z",
    "deleted_at": null,
    "sha1_hash": "f1b29ec642fe0c6813898b96484cda933333d0cb",
    "title": "2020-12-10 - Widespread malware campaign seeks to silently inject ads into search results, affects multiple browsers",
    "authors": "",
    "file_creation_date": "2022-05-28T22:09:43Z",
    "file_modification_date": "2022-05-28T22:09:43Z",
    "file_size": 2807490,
    "plain_text": "# Widespread malware campaign seeks to silently inject ads into search results, affects multiple browsers\n\n**microsoft.com/security/blog/2020/12/10/widespread-malware-campaign-seeks-to-silently-inject-ads-into-search-**\nresults-affects-multiple-browsers/\n\nDecember 10, 2020\n\nA persistent malware campaign has been actively distributing an evolved browser modifier\nmalware at scale since at least May 2020. At its peak in August, the threat was observed on\nover 30,000 devices every day. The malware is designed to inject ads into search engine\nresults pages. The threat affects multiple browsers—Microsoft Edge, Google Chrome,\nYandex Browser, and Mozilla Firefox—exposing the attackers’ intent to reach as many\nInternet users as possible.\n\nWe call this family of browser modifiers Adrozek. If not detected and blocked, Adrozek adds\nbrowser extensions, modifies a specific DLL per target browser, and changes browser\nsettings to insert additional, unauthorized ads into web pages, often on top of legitimate ads\nfrom search engines. The intended effect is for users, searching for certain keywords, to\ninadvertently click on these malware-inserted ads, which lead to affiliated pages. The\nattackers earn through affiliate advertising programs, which pay by amount of traffic referred\nto sponsored affiliated pages.\n\n\n-----\n\n_Figure 1. Comparison of search results pages on an affected machine and one with Adrozek_\n_running._\n\nCybercriminals abusing affiliate programs is not new—browser modifiers are some of the\noldest types of threats. However, the fact that this campaign utilizes a piece of malware that\naffects multiple browsers is an indication of how this threat type continues to be increasingly\nsophisticated. In addition, the malware maintains persistence and exfiltrates website\ncredentials, exposing affected devices to additional risks.\n\nSuch a sustained, far-reaching campaign requires an expansive, dynamic attacker\ninfrastructure. We tracked 159 unique domains, each hosting an average of 17,300 unique\nURLs, which in turn host more than 15,300 unique, polymorphic malware samples on\naverage. In total, from May to September 2020, we recorded hundreds of thousands of\nencounters of the Adrozek malware across the globe, with heavy concentration in Europe\nand in South Asia and Southeast Asia. As this campaign is ongoing, this infrastructure is\nbound to expand even further.\n\n\n-----\n\n_Figure 2. Geographic distribution of Adrozek encounters from May to September 2020._\n\nEffectively protecting against rampant, persistent campaigns like this that incorporate\nmultiple components, polymorphism, and evolved malware behavior requires advanced,\nbehavior-based detection and visibility across the whole attack chain rather than specific\ncomponents. [Microsoft Defender Antivirus, the built-in endpoint protection solution on](https://www.microsoft.com/windows/comprehensive-security)\nWindows 10, blocks this threat using behavior-based, machine learning-powered protections.\n[For enterprises, Microsoft 365 Defender provides deep visibility into malicious behaviors. In](https://www.microsoft.com/en-us/microsoft-365/security/microsoft-365-defender)\nthis blog, we’ll share our in-depth analysis of this campaign, including the distribution\narchitecture and malware behavior, and provide recommended defenses.\n\n## Distribution infrastructure\n\nThe Adrozek malware is installed on devices through drive-by download. In our tracking of\nthe Adrozek campaign from May to September 2020, we saw 159 unique domains used to\ndistribute hundreds of thousands of unique malware samples. Attackers relied heavily on\npolymorphism, which allows attackers to churn huge volumes of samples as well as to evade\ndetection.\n\nWhile many of the domains hosted tens of thousands of URLs, a few had more than 100,000\nunique URLs, with one hosting almost 250,000. This massive infrastructure reflects how\ndetermined the attackers are to keep this campaign operational.\n\n\n-----\n\n_Figure 3. Number of URLs and number of files hosted on Adrozek domains with at least 100_\n_files._\n\nThe distribution infrastructure is also very dynamic. Some of the domains were up for just\none day, while others were active for longer, up to 120 days. Interestingly, we saw some of\nthe domains distributing clean files like Process Explorer, likely an attempt by the attackers to\nimprove the reputation of their domains and URLs, and evade network-based protections.\n\n## Installation\n\nAttackers use this sprawling infrastructure to distribute hundreds of thousands of unique\nAdrozek installer samples. Each of these files is heavily obfuscated and uses a unique file\nname that follows this format: setup_<application name>_<numbers>.exe.\n\n\n-----\n\n_Figure 4. Adrozek attack chain_\n\nWhen run, the installer drops an .exe file with a random file name in the %temp% folder. This\nfile in drops the main payload in the Program Files folder using a file name that makes it look\nlike a legitimate audio-related software. We have observed the malware use various names\nlike Audiolava.exe, QuickAudio.exe, and converter.exe. The malware is installed like a usual\nprogram that can be accessed through Settings>Apps & features, and registered as a\nservice with the same name.\n\n\n-----\n\n_Figure 5. Adrozek installed as a program that can be accessed through the Apps & features_\n_setting_\n\n## Modifying browser components\n\nOnce installed, Adrozek makes multiple changes to the browser settings and components.\nThese changes allow the malware to inject ads into search engine result pages.\n\n## Extensions\n\nThe malware makes changes to certain browser extensions. On Google Chrome, the\nmalware typically modifies “Chrome Media Router”, one of the browser’s default extensions,\nbut we have seen it use different extensions.\n\nEach extension on Chromium-based browsers has a unique 32-character ID that users can\nuse to locate the extension on machines or on the Chrome Web store. On Microsoft Edge\nand Yandex Browser, it uses IDs of legitimate extensions, such as “Radioplayer” to\nmasquerade as legitimate. As it is rare for most of these extensions to be already installed\non devices, it creates a new folder with this extension ID and stores malicious components in\nthis folder. On Firefox, it appends a folder with a Globally Unique Identifier (GUID) to the\nbrowser extension. In summary, the paths and extension IDs used by the malware for each\nbrowser are below:\n\n**Browser** **Extension paths examples**\n\n\nMicrosoft\nEdge\n\nGoogle\nChrome\n\n\n_%localappdata%\\Microsoft\\Edge\\User_\n_Data\\Default\\Extensions\\fcppdfelojakeahklfgkjegnpbgndoch_\n\n_%localappdata%\\Google\\Chrome\\User_\n_Data\\Default\\Extensions\\pkedcjkdefgpdelpbcmbmeomcjbeemfm (might vary)_\n\n\n-----\n\nMozilla\nFirefox\n\nYandex\nBrowser\n\n\n_%appdata%\\Roaming\\Mozilla\\Firefox\\Profiles\\<profile>\\Extensions\\_\n_{14553439-2741-4e9d-b474-784f336f58c9}_\n\n_%localappdata%\\Yandex\\YandexBrowser\\User_\n_Data\\Default\\Extensions\\fcppdfelojakeahklfgkjegnpbgndoch_\n\n\nDespite targeting different extensions on each browser, the malware adds the same\nmalicious scripts to these extensions. In some cases, the malware modifies the default\nextension by adding seven JavaScript files and one manifest.json file to the target\nextension’s file path. In other cases, it creates a new folder with the same malicious\ncomponents.\n\n_Figure 6. JavaScript and JSON files added to the target extension’s file path_\n\nThese malicious scripts connect to the attacker’s server to fetch additional scripts, which are\nresponsible for injecting advertisements into search results. The domain name of the remote\nserver is specified in the extension’s scripts. The malware also sends information about the\ndevice to the said remote server.\n\n\n-----\n\n_Figure 7. Additional downloaded script_\n\n## Browser DLLs\n\nThe malware also tampers with certain browser DLLs. For instance, on Microsoft Edge, it\nmodifies MsEdge.dll to turn off security controls that are crucial for detecting any changes in\nthe Secure Preferences file.\n\n_Figure 8. Comparison of original and tampered with MsEdge.dll._\n\nThis technique impacts not only Microsoft Edge but other Chromium-based browsers. These\nbrowsers store user settings and preferences, such as home page and default search\nengine, in the Preferences file. For each of the four target browsers, it modifies the relevant\nDLL:\n\n**Browser** **Modified files**\n\n\nMicrosoft\nEdge\n\nGoogle\nChrome\n\n\n_%PROGRAMFILES%\\Microsoft\\Edge\\Application\\<version>\\msedge.dll_\n\n_%localappdata%\\Microsoft\\Edge\\User Data\\Default\\Secure Preferences_\n\n_%localappdata%\\Microsoft\\Edge\\User Data\\Default\\Preferences_\n\n_%PROGRAMFILES%\\Google\\Chrome\\Application\\<version>\\chrome.dll_\n\n_%localappdata%\\Google\\Chrome\\User Data\\Default\\Secure Preferences_\n\n_%localappdata%\\Google\\Chrome\\User Data\\Default\\Preferences_\n\n\n-----\n\nYandex\nBrowser\n\n\n_%PROGRAMFILES%\\Yandex\\YandexBrowser\\<version>\\browser.dll_\n\n_%localappdata%\\Yandex\\YandexBrowser\\User Data\\Default\\Secure_\n_Preferences_\n\n_%localappdata%\\Yandex\\YandexBrowser\\User Data\\Default\\Preferences_\n\n\nFirefox _%PROGRAMFILES%\\Mozilla Firefox\\omni.ja_\n\n_%appdata%\\Mozilla\\Firefox\\Profiles\\<profile>\\extensions.json_\n\n_%appdata%\\Mozilla\\Firefox\\Profiles\\<profile>\\prefs.js_\n\n## Browser security settings\n\nBrowsers have security settings that defend against malware tampering. The Preferences\nfile, for example, contains sensitive data and security settings. Chromium-based browsers\ndetects any unauthorized modifications to these settings through signatures and validation\non several preferences. These preferences, as well as configuration parameters, are stored\nin JSON file name Secure Preferences.\n\nThe Secure Preferences file is similar in structure to the Preferences file except that the\n[former adds hash-based message authentication code (HMAC) for every entry in the file.](https://en.wikipedia.org/wiki/HMAC)\nThis file also contains a key named super_mac that verifies the integrity of all HMACs. When\nthe browser starts, it validates the HMAC values and the super_mac key by calculating and\ncomparing with the HMAC SHA-256 of some of the JSON nodes. If it finds values that don’t\nmatch, the browser resets the relevant preference to its default value.\n\nIn the past, browser modifiers calculated the hashes like browsers do and update the Secure\n_Preferences accordingly. Adrozek goes one step further and patches the function that_\nlaunches the integrity check. The two-byte patch nullifies the integrity check, which makes\nthe browser potentially more vulnerable to hijacking or tampering.\n\n_Figure 9. Two-byte patch to the function in Secure Preferences file that launches the integrity_\n_check_\n\n\n-----\n\nWith the integrity check disabled, Adrozek proceeds to modify security settings. On Google\nChrome or Microsoft Edge, the malware modifies the following entries in the Secure\n_Preferences file to add permissions that enable the malicious extensions to have more_\ncontrol over Chrome APIs:\n\n\n**Entry in Secure**\n**_Preferences file_**\n\n\n**Value** **Result**\n\n\nbrowser_action_visible false Plugin not visible in the browser toolbar\n\nextension_can_script_all_urls true Allows the extension to script on all URLs without\nexplicit permission\n\nincognito true The extension can run in the incognito mode\n\nsafebrowsing false Turns off safe browsing\n\nThe screenshot below shows the permissions added to the Secure Preferences file:\n\n_Figure 10. Permissions added to the Secure Preferences file_\n\nOn Mozilla Firefox, Adrozek modifies the following security settings:\n\n**Modified file name** **Content** **Purpose**\n\n\n_prefs.js_ _user_pref(“app.update.auto”, false);_\n_user_pref(“app.update.enabled”, false);_\n_user_pref(“app.update.service.enabled”,_\n_false)_\n\n_extensions.json_ _(appends details about the malicious_\n_extension)_\n\n\nTurn off updates\n\nRegister the\nextension to the\nbrowser\n\n\n_Omni.ja_\n_(XPIDatabase.jsm_\n_module)_\n\n## Browser updates\n\n\n_isNewInstall = false_ Load the extension\n\n\n-----\n\nTo prevent the browsers from being updated with the latest versions, which could restore\nmodified settings and components, Adrozek adds a policy to turn off updates.\n\n_Figure 11. Policy added to turn off updates_\n\n## Persistence\n\nIn addition to modifying browser setting and components, Adrozek also changes several\nsystems settings to have even more control of the compromised device. It stores its\nconfiguration parameters at the registry key\n_HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\<programName>. The ‘tag’ and ‘did’_\nentries contain the command-line arguments that it uses to launch the main payload. More\nrecent variants of Adrozek use random characters instead of ‘tag’ or ‘did’.\n\n_Figure 12. Registry entries with command-line arguments that launch the main payload_\n\nTo maintain persistence, the malware creates a service named “Main Service”.\n\n\n-----\n\n_Figure 13. Service created to maintain persistence_\n\n## Ad injection\n\nAfter tampering with multiple browser components and settings, the malware gains the\ncapability to inject ads on search results on affected browsers. The injection of ads is\nperformed by malicious scripts downloaded from remote servers.\n\nDepending on the search keyword, scripts add related ads at the top of legitimate ads and\nsearch results. The number of ads inserted and the sites they point to vary. And while we\nhave not seen these ads point to malware-hosting and other malicious sites, the attackers\ncan presumably make that change anytime. The Adrozek attackers, however, operate the\nway other browser modifiers do, which is to earn through affiliate ad programs, which pay for\nreferral traffic to certain websites.\n\n\n-----\n\n_Figure 14. Comparison of search results pages on an affected machine and one with_\n_Adrozek running_\n\n## Credential theft\n\nOn Mozilla Firefox, Adrozek takes things further. It makes the most of its foothold by\nperforming credential theft. It downloads an additional randomly named .exe file, which\ncollects device information and the currently active username. It sends this information to the\nattacker.\n\n\n-----\n\n_Figure 15. Additional executable file written to the %temp% folder_\n\nIt then starts locating specific files, including login.json. On Mozilla Firefox, the said file,\nwhich is located at %appdata%\\Roaming\\Mozilla\\Firefox \\Profiles\\<profile>\\logins.json,\nstores user credentials in encrypted form and the browsing history.\n\n_Figure 16. JSON file containing stolen credentials_\n\nThe malware looks for specific keywords like encryptedUsername and encryptedPassword to\nlocate encrypted data. It then decrypts the data using the function PK11SDR_Decrypt()\nwithin the Firefox library and sends it to attackers.\n\nWith this additional function, Adrozek sets itself apart from other browser modifiers and\ndemonstrates that there’s no such thing as low-priority or non-urgent threats. Preventing the\nfull range of threat from gaining access in the first place is of utmost importance.\n\n## Defending against sophisticated browser modifiers\n\nAdrozek shows that even threats that are not thought of as urgent or critical are increasingly\nbecoming more complex. And while the malware’s main goal is to inject ads and refer traffic\nto certain websites, the attack chain involves sophisticated behavior that allow attackers to\ngain a strong foothold on a device. The addition of credential theft behavior shows that\nattackers can expand their objectives to take advantage of the access they’re able to gain.\n\nThese complex behaviors, and the fact that the campaign uses polymorphic malware,\nrequire protections that focus on identifying and detecting malicious behavior. Microsoft\nDefender Antivirus, the built-in endpoint protection solution on Windows 10, uses behaviorbased machine learning-powered detections to block Adrozek\n\n\n-----\n\nEnd users who find this threat on their devices are advised to re-install their browsers.\nConsidering the massive infrastructure that was used to distribute this threat on the web,\n[users should also educate themselves about preventing malware infections and the risks of](https://docs.microsoft.com/en-us/windows/security/threat-protection/intelligence/prevent-malware-infection)\ndownloading and installing software from untrusted sources and clicking ads or links on\nsuspicious websites. Users should also take advantage of URL filtering solutions, such as\nMicrosoft Defender SmartScreen on Microsoft Edge. Configuring security software to\nautomatically download and install updates, as well as running the latest versions of the\noperating system and applications and deploying the latest security updates help harden\nendpoints from threats.\n\nFor enterprises, defenders should look to reduce the attack surface for these types of\nthreats. Application control allows organizations to enforce the use of only authorized apps\nand services. Enterprise-grade browsers like Microsoft Edge provide additional security\nfeatures like conditional access and Application Guard that defend against threats on the\nbrowser.\n\nIt’s also important for enterprises to gain deep visibility into malicious behaviors on endpoints\nand the capability to correlate with threat data from other domains like cloud apps, email and\n[data, and identities. Microsoft 365 Defender delivers coordinated protection across domains](https://www.microsoft.com/en-us/microsoft-365/security/microsoft-365-defender)\nand provides rich investigation tools that empower defenders to respond to attacks. Learn\n[how your organization can stop attacks through automated, cross-domain security and built-](https://www.microsoft.com/en-us/microsoft-365/security/microsoft-365-defender)\nin AI with Microsoft Defender 365.\n\n_Microsoft 365 Defender Research Team_\n\n### Talk to us\n\nQuestions, concerns, or insights on this story? Join discussions at the Microsoft 365\nDefender tech community.\n\n[Read all Microsoft security intelligence blog posts.](https://www.microsoft.com/security/blog/microsoft-security-intelligence/)\n\nFollow us on Twitter **[@MsftSecIntel.](https://twitter.com/MsftSecIntel)**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-10 - Widespread malware campaign seeks to silently inject ads into search results, affects multiple browsers.pdf"
    ],
    "report_names": [
        "2020-12-10 - Widespread malware campaign seeks to silently inject ads into search results, affects multiple browsers.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9792e41f-4165-474b-99fa-e74ec332bd87",
            "created_at": "2023-01-06T13:46:38.986789Z",
            "updated_at": "2025-03-27T02:00:02.970288Z",
            "deleted_at": null,
            "main_name": "Lucky Cat",
            "aliases": [
                "White Dev 9",
                "TA413"
            ],
            "source_name": "MISPGALAXY:Lucky Cat",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "3b1367ff-99dc-41f0-986f-4a1dcb41bbbf",
            "created_at": "2022-10-25T16:07:24.273478Z",
            "updated_at": "2025-03-27T02:02:10.157226Z",
            "deleted_at": null,
            "main_name": "TA413",
            "aliases": [
                "White Dev 9"
            ],
            "source_name": "ETDA:TA413",
            "tools": [
                "Exile RAT",
                "ExileRAT",
                "Sepulcher"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535866,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1653775783,
    "ts_modification_date": 1653775783,
    "files": {
        "pdf": "https://archive.orkl.eu/f1b29ec642fe0c6813898b96484cda933333d0cb.pdf",
        "text": "https://archive.orkl.eu/f1b29ec642fe0c6813898b96484cda933333d0cb.txt",
        "img": "https://archive.orkl.eu/f1b29ec642fe0c6813898b96484cda933333d0cb.jpg"
    }
}