{
    "id": "6c822770-a7f4-4714-a44c-6bce512cbafb",
    "created_at": "2023-01-12T15:07:34.275719Z",
    "updated_at": "2025-03-27T02:16:50.892456Z",
    "deleted_at": null,
    "sha1_hash": "d5889e533ff64deace5b09915315bbae4fba34ba",
    "title": "2018-03-10 - APT15 is alive and strong- An analysis of RoyalCli and RoyalDNS",
    "authors": "",
    "file_creation_date": "2022-05-28T19:41:33Z",
    "file_modification_date": "2022-05-28T19:41:33Z",
    "file_size": 180897,
    "plain_text": "# APT15 is Alive and Strong: An Analysis of RoyalCli and RoyalDNS\n\n**[research.nccgroup.com/2018/03/10/apt15-is-alive-and-strong-an-analysis-of-royalcli-and-royaldns/](https://research.nccgroup.com/2018/03/10/apt15-is-alive-and-strong-an-analysis-of-royalcli-and-royaldns/)**\n\nMarch 10, 2018\n\nIn May 2017, NCC Group’s Incident Response team reacted to an ongoing incident where\nour client, which provides a range of services to UK Government, suffered a network\ncompromise involving the advanced persistent threat group APT15.\n\n**APT15 is also known as, Ke3chang, Mirage, Vixen Panda GREF and Playful**\n**Dragon.**\n\nA number of sensitive documents were stolen by the attackers during the incident and we\nbelieve APT15 was targeting information related to UK government departments and military\ntechnology.\n\n## APT15 expands its arsenal\n\n\n-----\n\nDuring our analysis of the compromise, we identified new backdoors that now appear to be\npart of APT15’s toolset. The backdoor BS2005 – which has traditionally been used by the\ngroup – now appears alongside the additional backdoors RoyalCli and RoyalDNS.\n\nThe RoyalCli backdoor appears to be an evolution of BS2005 and uses familiar encryption\nand encoding routines. The name RoyalCli was chosen by us due to a debugging path left in\nthe binary:\n```\nc:\\users\\wizard\\documents\\visual studio 2010\\Projects\\RoyalCli\\Release\\RoyalCli.pdb\n\n```\nRoyalCli and BS2005 both communicate with the attacker’s command and control (C2)\nthrough Internet Explorer (IE) by using the COM interface IWebBrowser2. Due to the nature\nof the technique, this results in C2 data being cached to disk by the IE process; we’ll get to\nthis later.\n\nAnalysis of the domains and IP address infrastructure used by APT15 identified a number of\nsimilar possible domains, shown at the bottom of the post. These appeared to be hosted on\neither Linode or Google Cloud, with a preference for using the ASN AS63949.\n\nAll of the backdoors identified – excluding RoyalDNS – required APT15 to create batch\nscripts in order to install its persistence mechanism. This was achieved through the use of a\nsimple Windows run key. We believe that APT15 could have employed this technique in\norder to evade behavioural detection, rather than due to a lack of sophistication or\ndevelopment capability.\n\nAdditional tools were recovered during the incident, including a network\nscanning/enumeration tool, the archiving tool WinRAR and a bespoke Microsoft SharePoint\nenumeration and data dumping tool, known as ‘spwebmember’.\n\nspwebmember was written in Microsoft .NET and includes hardcoded values for client\nproject names for data extraction. The tool would connect to the SQL SharePoint database\nand issue a query to dump all data from the database to a temporary file affixed with\n‘spdata’. The group also used keyloggers and their own .NET tool to enumerate folders and\ndump data from Microsoft Exchange mailboxes.\n\nAPT15 was also observed using Mimikatz to dump credentials and generate Kerberos\ngolden tickets. This allowed the group to persist in the victim’s network in the event of\nremediation actions being undertaken, such as a password reset.\n\n## APT15 lives off the land\n\nUpon ejection from the network, APT15 managed to regain access a couple of weeks later\nvia the corporate VPN solution with a stolen VPN certificate, which they had extracted from a\ncompromised host.\n\n\n-----\n\nThis time, APT15 opted for a DNS based backdoor: RoyalDNS. The persistence mechanism\nused by RoyalDNS was achieved through a service called ‘Nwsapagent’.\n\nC2 of this backdoor was performed using the TXT record of the DNS protocol. C2 was\ncommunicating with the domain ‘andspurs[.]com’.\n\nWe mentioned earlier that due to the nature of the IE injection technique used by the HTTPbased backdoors, a number of C2 commands were cached to disk. We were able to recover\nthese files and reverse engineer the encoding routine used by the backdoors in order to\nuncover the exact commands executed by the attacker.\n\nIn total, we were able to recover more than 200 commands executed by the attacker against\nthe compromised hosts and were able to gain a clear insight into the attacker’s TTPs. Our\n[decode scripts can be found on our Github page: https://github.com/nccgroup/Royal_APT](https://github.com/nccgroup/Royal_APT)\n\nAnalysis of the commands executed by APT15 reaffirmed the group’s preference to ‘live off\nthe land’. They utilised Windows commands in order to enumerate and conduct\nreconnaissance activities such as tasklist.exe, ping.exe, netstat.exe, net.exe,\nsysteminfo.exe, ipconfig.exe and bcp.exe.\n\nLateral movement was conducted through by a combination of net command, mounting the\nC$ share of hosts and manually copying files to or from compromised hosts. APT15 then\nused a tool known as RemoteExec (similar to Microsoft’s Psexec) in order to remotely\nexecute batch scripts and binaries.\n\nDuring our analysis of the decoded attacker commands we noticed a typographical mistake,\nshown below in the folder name ‘systme’. This indicates that a human operative was\nexecuting commands on a command line style interface, rather than an automated or GUI\nprocess.\n\n## IOCs\n\nBelow are a number of hashes relating to the backdoors identified in use by APT15\n```\nRoyal DNS: bc937f6e958b339f6925023bc2af375d669084e9551fd3753e501ef26e36b39d>\nBS2005: 750d9eecd533f89b8aa13aeab173a1cf813b021b6824bc30e60f5db6fa7b950b\nBS2005: 6ea9cc475d41ca07fa206eb84b10cf2bbd2392366890de5ae67241afa2f4269f\nRoyalCli: 6df9b712ff56009810c4000a0ad47e41b7a6183b69416251e060b5c80cd05785\nMS Exchange Tool: 16b868d1bef6be39f69b4e976595e7bd46b6c0595cf6bc482229dbb9e64f1bce\n\n```\n\n-----\n\nNCC Group & Fox-IT have created a number of Suricata IDS rules to detect APT15 activity\nthrough the use of these backdoors. These, along with YARA signatures for the backdoors\nidentified, can be found in the Github repository linked above.\n\n## Domains\n\nThe RoyalCli backdoor was attempting to communicate to the following domains:\n\nNews.memozilla[.]org\nvideo.memozilla[.]org\n\nThe BS2005 backdoor utilised the following domains for C2:\n\nRun.linodepower[.]com\nSinga.linodepower[.]com\nlog.autocount[.]org\n\nRoyalDNS backdoor was seen communicating to the domain:\n\nandspurs[.]com\n\nPossible linked APT15 domains include:\n\nMicakiz.wikaba[.]org\ncavanic9[.]net\nridingduck[.]com\nzipcodeterm[.]com\ndnsapp[.]info\n\nWritten by Rob Smallridge\n\nFirst published on 10/03/18\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-03-10 - APT15 is alive and strong- An analysis of RoyalCli and RoyalDNS.pdf"
    ],
    "report_names": [
        "2018-03-10 - APT15 is alive and strong- An analysis of RoyalCli and RoyalDNS.pdf"
    ],
    "threat_actors": [
        {
            "id": "2ac63ef4-a7b8-4a30-96ad-b30ccb2073fc",
            "created_at": "2022-10-25T16:07:23.546262Z",
            "updated_at": "2025-03-27T02:02:09.856624Z",
            "deleted_at": null,
            "main_name": "Donot Team",
            "aliases": [
                "APT-C-35",
                "SectorE02"
            ],
            "source_name": "ETDA:Donot Team",
            "tools": [
                "BackConfig",
                "EHDevel",
                "Jaca",
                "yty"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "cfdd350b-de30-4d29-bbee-28159f26c8c2",
            "created_at": "2023-01-06T13:46:38.433736Z",
            "updated_at": "2025-03-27T02:00:02.832565Z",
            "deleted_at": null,
            "main_name": "VICEROY TIGER",
            "aliases": [
                "OPERATION HANGOVER",
                "Donot Team",
                "APT-C-35",
                "SectorE02",
                "Orange Kala"
            ],
            "source_name": "MISPGALAXY:VICEROY TIGER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "adfbe698-24b2-41fc-a701-781fef330b16",
            "created_at": "2024-01-09T02:00:04.17648Z",
            "updated_at": "2025-03-27T02:00:03.274931Z",
            "deleted_at": null,
            "main_name": "GREF",
            "aliases": [],
            "source_name": "MISPGALAXY:GREF",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "0a03e7f0-2f75-4153-9c4f-c46d12d3962e",
            "created_at": "2022-10-25T15:50:23.453824Z",
            "updated_at": "2025-03-27T02:00:55.473216Z",
            "deleted_at": null,
            "main_name": "Ke3chang",
            "aliases": [
                "Ke3chang",
                "APT15",
                "Vixen Panda",
                "GREF",
                "Playful Dragon",
                "RoyalAPT",
                "Nylon Typhoon"
            ],
            "source_name": "MITRE:Ke3chang",
            "tools": [
                "Okrum",
                "Systeminfo",
                "netstat",
                "spwebmember",
                "Mimikatz",
                "Tasklist",
                "MirageFox",
                "Neoichor",
                "ipconfig"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7c8cf02c-623a-4793-918b-f908675a1aef",
            "created_at": "2023-01-06T13:46:38.309165Z",
            "updated_at": "2025-03-27T02:00:02.801298Z",
            "deleted_at": null,
            "main_name": "APT15",
            "aliases": [
                "BRONZE PALACE",
                "Nylon Typhoon",
                "VIXEN PANDA",
                "Playful Dragon",
                "BRONZE DAVENPORT",
                "BRONZE IDLEWOOD",
                "G0004",
                "Red Vulture",
                "Ke3Chang",
                "Metushy",
                "Lurid",
                "Social Network Team",
                "Royal APT"
            ],
            "source_name": "MISPGALAXY:APT15",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "7d5531e2-0ad1-4237-beed-af009035576f",
            "created_at": "2024-05-01T02:03:07.977868Z",
            "updated_at": "2025-03-27T02:05:17.283109Z",
            "deleted_at": null,
            "main_name": "BRONZE PALACE",
            "aliases": [
                "BRONZE DAVENPORT ",
                "BRONZE IDLEWOOD ",
                "CTG-9246 ",
                "Ke3chang ",
                "Playful Dragon",
                "Vixen Panda ",
                "APT15 "
            ],
            "source_name": "Secureworks:BRONZE PALACE",
            "tools": [
                " BS2005",
                " Enfal",
                " Mirage",
                " RoyalCLI",
                " RoyalDNS",
                "BMW"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "17b1b76b-16da-4c4f-8b32-f6fede3eda8c",
            "created_at": "2022-10-25T16:07:23.750796Z",
            "updated_at": "2025-03-27T02:02:09.961401Z",
            "deleted_at": null,
            "main_name": "Ke3chang",
            "aliases": [
                "APT 15",
                "BackdoorDiplomacy",
                "Bronze Davenport",
                "Bronze Idlewood",
                "Bronze Palace",
                "CTG-9246",
                "GREF",
                "Ke3chang",
                "Metushy",
                "Nylon Typhoon",
                "Operation Ke3chang",
                "Operation MirageFox",
                "Playful Dragon",
                "Playful Taurus",
                "Red Vulture",
                "Royal APT",
                "Social Network Team",
                "Vixen Panda"
            ],
            "source_name": "ETDA:Ke3chang",
            "tools": [
                "Agentemis",
                "Anserin",
                "BS2005",
                "BleDoor",
                "CarbonSteal",
                "Cobalt Strike",
                "CobaltStrike",
                "DarthPusher",
                "DoubleAgent",
                "EternalBlue",
                "GoldenEagle",
                "Graphican",
                "HenBox",
                "HighNoon",
                "IRAFAU",
                "Ketrican",
                "Ketrum",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "MS Exchange Tool",
                "Mebroot",
                "Mimikatz",
                "MirageFox",
                "NBTscan",
                "Okrum",
                "PluginPhantom",
                "PortQry",
                "ProcDump",
                "PsList",
                "Quarian",
                "RbDoor",
                "RibDoor",
                "Royal DNS",
                "RoyalCli",
                "RoyalDNS",
                "SAMRID",
                "SMBTouch",
                "SilkBean",
                "Sinowal",
                "SpyWaller",
                "Theola",
                "TidePool",
                "Torpig",
                "Turian",
                "Winnti",
                "XSLCmd",
                "cobeacon",
                "nbtscan",
                "netcat",
                "spwebmember"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536054,
    "ts_updated_at": 1743041810,
    "ts_creation_date": 1653766893,
    "ts_modification_date": 1653766893,
    "files": {
        "pdf": "https://archive.orkl.eu/d5889e533ff64deace5b09915315bbae4fba34ba.pdf",
        "text": "https://archive.orkl.eu/d5889e533ff64deace5b09915315bbae4fba34ba.txt",
        "img": "https://archive.orkl.eu/d5889e533ff64deace5b09915315bbae4fba34ba.jpg"
    }
}