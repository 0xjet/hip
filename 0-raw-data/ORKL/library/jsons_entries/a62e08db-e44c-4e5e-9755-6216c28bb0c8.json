{
    "id": "a62e08db-e44c-4e5e-9755-6216c28bb0c8",
    "created_at": "2022-10-25T16:48:22.103286Z",
    "updated_at": "2025-03-27T02:15:35.640966Z",
    "deleted_at": null,
    "sha1_hash": "eb99c745139bd6e46e81745dfd72e41325a02ad4",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-02-11T08:52:13Z",
    "file_modification_date": "2020-02-11T08:52:13Z",
    "file_size": 3253152,
    "plain_text": "# Is Emotet gang targeting companies with external SOC?\n\n**[marcoramilli.com/2019/10/14/is-emotet-gang-targeting-companies-with-external-soc](https://marcoramilli.com/2019/10/14/is-emotet-gang-targeting-companies-with-external-soc/)**\n\nView all posts by marcoramilli October 14, 2019\n\n## Introduction\n\n##### The group behind Emotet malware is getting smarter and smarter in the way the deliver such a Malware. While the infection schema looks alike from years; the way the group tries to infect victims improves from day to day. Today I’d like to share a quick analysis resulted by a very interesting email which claimed to deliver a SOC “weekly report” on the victim email. First of all the attacker knew the target organization was protected by a SOC (Security Operation Center) so she sent a well crafted email claiming to deliver a Microsoft document wrapping out the weekly SOC report as a normal activity in order to induce the victim to open-it.\n\n SOC report 10 12 2019.doc (\n```\n6125489453c1824da3e28a54708e7c77875e500dd82a59c96c1d1e5ee88dcad7 ) is the delivered\n\n file sent on Oct 11, 2019, 11:06:09 PM from grecia@ambientehomedecor.com . I believe that\nambientehomedecor.com is not a malicious domain but mostly a new compromised one.\n\n## Technical Analysis\n\n#### Hash 6125489453c1824da3e28a54708e7c77875e500d‐ d82a59c96c1d1e5ee88dcad7\n\n Threat Word document Dropper (Emotet)\n\n```\n\n#### Brief Description\n\n\n#### First stage of Emotet campaign targeting organization with Security Op‐ eration Centers\n\n\n#### Ssdeep 6144:tkPNPASKUzSRnLx3Q4td9pB8LGme764XNNHBly:tkPNPAfU‐ GRt3b3B8LGL6CNJ\n\n##### Following the original eMail headers from grecia@ambientehomedecor.com to victim’s email box it is possible to figure-out the attacker used a SMPT client who left trace about the original sender IP address which happens to be: 81.48.36.59 . According to IPLocation that address is related to a very nice town in northern France: Thury-Harcourt, France.\n\n\n-----\n\n###### Thury-Harcourt, France. Sender IP\n\n##### The attached document is a well obfuscated Microsoft Word document which asks to enable macros in order to view its content. The autoopen function begins a complex obfuscated chain which tries to deter analyst by introducing junk code, junk variable assignments and fake apparent real comments. The following image proves the adopted obfuscation technique. The function c878cxx90590 is the “Real Code” by meaning is not part of junk code but actually is the function who really performs malicious actions. As you might see being in the middle of hundreds similar lines of code it gets hard to spot.\n\n###### Obfuscated Macro\n\n##### The obfuscated macro creates on-memory objects and runs them without passing through temporary files. The following image shows the auto-run created object before the Drop’n Execute. The analysed variable in the following image is the c0639047895c6 which, in that specific run, holds the Win32_ProcessStartup created Object for fulfill persistence on the victim machine.\n\n\n-----\n\n###### Object Building\n\n##### Once the dropper assured the persistence and to run during the start-up, it carves from itself the following powershell script. The script runs an encoded string hiding the dropping ULRs. The base64 decoded string shows a romantic foreach statement looping through a list of compromised websites hosting the real payload :\n```\nde6a8b8612b5236a18eea1a6a8f53e117d046cf2ad95e079a6715af68f8d2216 (VT 6/69). It\n\n finally saves the dropped file in a userprofile location as placed in the variable xc0x57b38b2x7, before running it. The following image shows the powershell script before and after the encoding by giving a quick description on it.\n\n###### Final Deobfuscated Dropper\n\n```\n\n-----\n\n##### According to VT, the final run looks like Emotet, a banking trojan who steals credentials, cookies and eCoin wallets. Emotet is also able to access to saved credentials of the major browser like Chromium, Firefox, Opera, Vivaldi to exfiltrate cookies, and to send back to command and control found victim information. But let’s try to quickly check it.\n\n### Analysis of dropped and executed file (emotet)\n\n#### Hash de6a8b8612b5236a18eea1a6a8f53e117d046cf2ad95e079a6715af68f8d2216\n\n Threat Emotet. Data Exfiltration\n\n\n#### Brief De‐ scrip‐ tion\n\n Ss‐ deep\n\n\n#### Dropped and Executed by previous stage\n\n 3072:2xUIvfl2nnKJFddS2TZGjRurmOEfRtaG/70Jfm4JuLYwO9/+Tl:2lvfUn‐ KJFddhAjYrmOEpzcflQu1+\n\n\n##### The dropped file (VT 12/69), grabbed from the dropping URLs inside the previous powershell script, is an executable packed by internal functions which uses several techniques to avoid static and dynamic analysis. For example it deletes the original file once executed, it resolves an unusual very high number of APIs and it dynamically resolves functions avoiding static analysis.\n\n###### Emotet Depacked\n\n##### During the running phase the analyzed sample records many information on the hosting machine, it asks for local public IP address by querying an external resource: http[://185[.42[.221[.78:443/whoami.php and finally it pushes out those information to external Command and Control (please refer to IoC section for the complete C2 list).\n\n\n-----\n\n###### Recorded Information\n\n##### The sample starts a local service called khmerdefine and assures its persistence by adding that file in c:\\Windows\\SysWOW64 and setting up a system service in autorun. AV and plenty static traffic signatures confirm we are facing a new encrypted version of Emotet trojan.\n\n## Conclusion\n\n##### Emotet gang is getting smarter and smarter in delivery artifacts. That time they addressed companies having an external Security Operation Center (SOC) pretending to simulate an external SOC operator who sends periodic reports to the company. The delivery content was a Microsoft word document within heavily obfuscated Macros who eventually drops and executes Emotet Malware. The following image represent the compiled MITRE ATT&CK matrix in order to qualify stages and to describe the overall behavior.\n\n###### MITRE ATT&CK\n\n## IoC\n\n##### email: grecia@ambientehomedecor.com\n\n Hash: 6125489453c1824da3e28a54708e7c77875e500dd82a59c96c1d1e5ee88dcad7 (.doc) de6a8b8612b5236a18eea1a6a8f53e117d046cf2ad95e079a6715af68f8d2216 (.exe)\n\n Drop URLs: http[://xsnonline[.us/blogs/4x466v/ http[://obbydeemusic[.com/aqoeivj4fd/us5htvn/ http[://veeplan[.com/wp-content/dW0o3RoJNG/ http[://wwwkmacobd[.com/u9r/ http[://aijdjy[.com/dup-installer/t0/\n\n C2 (Emotet): http[://186[.75[.241[.230/cone/loadan/splash/merge/ http[://186[.75[.241[.230/results/json/\n\n\n-----\n\n##### http[://186[.75[.241[.230/balloon/json/ http[://186[.75[.241[.230/enable/arizona/splash/merge/ http[://186[.75[.241[.230/acquire/ http[://181[.143[.194.[138:443/health/splash/sess/merge/ http[://85[.104[.59[.244:20/enable/rtm/sess/merge/\n\n## Yara Rules\n\n\n-----\n\n```\nrule EMOTET_SOC_EXE {\n  meta:\n   date = \"2019-10-13\"\n   hash1 = \"de6a8b8612b5236a18eea1a6a8f53e117d046cf2ad95e079a6715af68f8d2216\"\n  strings:\n   $x1 = \"c:\\\\Users\\\\User\\\\Desktop\\\\2003\\\\Efential\\\\Release\\\\EFENTIAL.pdb\" fullword\nascii\n   $s2 = \"EFENTIAL.exe\" fullword ascii\n   $s3 =\n\"ZNtlsIkbp2bxIIBXLbRtd3e85g7mJ73gSFPnybocDj/xsKVPWxzllXY/FdB150/ewzkkdzDw5VMbiVfS/SPd0FlXp\n ascii\n   $s4 =\n\"tblJgbnpgZmZCaHxmfEpoaS9Cb31DfHpZfVJobW5SYG56YGZmQmh8ZnxKaGkvQm99Q3x6WX1SaG1uUmBuemBmZkJo\n ascii /* base64 encoded string\n'nR`nz`ffBh|f|Jhi/Bo}C|zY}RhmnR`nz`ffBh|f|Jhi/Bo}C|zY}RhmnR`nz`ffBh|f|Jhi/Bo}C|zY}RhmnR`nz\n */\n   $s5 =\n\"C9813Hcfx1BkY3VrYVwfB4tWs+/Eb93UVwdvrbdywicNqMdPSiMzJFXbZbSLG6cDA/O9Vy2ob3d3PeVLcie95EpT5\n ascii\n   $s6 =\n\"G+MfTPu8J3chkKdvVwmN7R/fNdx3H8cxWUFva2FcHweLIPfrnG/d1FcHb/FxEOQnDajHT0qu26c122W0ixunZpkE2\n ascii\n   $s7 =\n\"RSVloG9h6HM56NP1tCMFZKs69gEEW+JoiOCz9U3uI3uYsb+mL2+97Wf903wpFDCKiBjjtt/TznbwXOcnHS87rh7rG\n ascii\n   $s8 =\n\"iOC7W7cnZWhtQTw5nu3bSa/eHxvVFB3RfZP9CFkKs3KWazNkXJPk+HTPmTvpWFcnpLn2DUFtp2v1ELP9acqRoKOXI\n ascii\n   $s9 =\n\"6RzgkjSOWDNk6FtXIb1gBQ0oTx93sMelCVJYrG9ZEJB07FiwoYhZkKiSkNh3DQweyOCz9UXEmKjkHOXYfeRY2qT4p\n ascii\n   $s10 =\n\"StOEJiPbZbiKG6dLTcWrVy28bnd3MRHI6Se9+EtT5xnfnbI/8aimT1vHvvS1PxXYdudP5QazN3cw+OZTG6WMoPkj3\n ascii\n   $s11 =\n\"mQOhiAgYsPyI4DhFgdYtLdGQ1W9Bxmd6m3lnTJcfr4gYGLD8iOA41oOuIaXdCNnnTaphWJ1HYWqR+qqIKBiwmIjgO\n ascii\n   $s12 =\n\"Jd812HQfx5Qv5tVrYSAcB4t1CVi1b93QVAdvpSmDyCcNpMRPSpcCbzzbZbCIG6fu/FMSVy20bHd3ShSspye94ElT5\n ascii\n   $s13 =\n\"f64odyFEoG9XrrnC4d81EHAfx9MLlPdrYegYB4s9h95Cb91oUAdvuYg3nCcNHMBPSk5z9mnbZfiNG6fklZhYVy38a\n ascii\n   $s14 =\n\"G5WtAP8+00dbvQhs6PgZzXSo8WjM1YD2S2wk9prpUJn8oG0I4laYrNKGZTi4kPTVMKbGcImVZllhx5Tj+amkWDhXp\n ascii\n   $s15 =\n\"3ie9qEhT593fXyw/8filT1s1hgetPxWodedPR5foK3cwiOVTG/Eyi+Yj3ZhZV6cVyoNtTw00TR93mxbYI2udnBnjH\n ascii\n   $s16 =\n\"RpFqNpYQapubxqPNu6yDXrsXC6qB7CzF0GzVj0FjbT6RdW15ncWnY7/vh92xHgE5j7MjB9mZ3mVK5FiwlKhYoKj4k\n ascii\n   $s17 =\n\"5Ewf7cgaGLAv7VSjeroTTJAjcpy+a7Ql2VPnU2HVntv/mUgzY6rVrB/TYQX35L9Xj+N9SPwkjLT2k+D48S0nWy/tV\n ascii\n   $s18 =\n\"5Ewf7cgaGLAv7VSjeroTTJAjcpy+a7Ql2VPnU2HVntv/mUgzY6rVrB/TYQX35L9Xj+N9SPwkjLT2k+D48S0nWy/tV\n ascii\n\n```\n\n-----\n\n```\n   $s19 =\n\"iBunjDe9gVct7Gx3d65SQF8nvahJU+cRqKveP/H4pE9bLL3YAz8VqHTnT7v1JHR3MIjkUxv0uwvjI92YWFenoW2yz\n ascii\n   $s20 =\n\"pKjTapsqZ36hVbhZOPU4sD5ekeEYE2WaixuncUK41ZSfp87TA/3tI91r1DvwoBcDoQywknwbTexd6FjAV+2Ac8gY7\n ascii\n  condition:\n   uint16(0) == 0x5a4d and filesize < 800KB and\n   ( pe.imphash() == \"ffcd1ab4ae5e052202d6af1ea2767498\" or ( 1 of ($x*) or 4 of them )\n)\n}\nrule EMOTET_SOC_PE {\n  meta:\n   date = \"2019-10-13\"\n   hash1 = \"6125489453c1824da3e28a54708e7c77875e500dd82a59c96c1d1e5ee88dcad7\"\n  strings:\n   $x1 = \"*\\\\G{0D452EE1-E08F-101A-852E02608C4D0BB4}#2.0#0#C:\\\\windows\\\\system32\\\\FM20.DLL#Microsoft Forms 2.0 Object Library\"\nfullword wide\n   $x2 = \"Customer50041 Keeling Bypass, North Christellefort, Tunisia Global128 Manuel\nStravenue, New Nicholasfort, Montserrat\" fullword ascii\n   $x3 = \"*\\\\G{00020430-0000-0000-C000000000000046}#2.0#0#C:\\\\Windows\\\\system32\\\\stdole2.tlb#OLE Automation\" fullword wide\n   $x4 = \"Forward297 German Trail, West Miloshire, Germany Product44796 Chesley\nBypass, East Santos, Antigua and Barbudan\" fullword ascii\n   $x5 = \"Regional1198 Rahsaan Motorway, Klockoburgh, Czech Republic Human326 Olson\nBypass, North Nicholaus, Zimbabwe\" fullword ascii\n   $x6 = \"Dynamic6743 Hickle Bypass, West Karliborough, United States Minor Outlying\nIslands Product6344 Zieme Inlet, Gloverfurt, Taiwan\" fullword ascii\n   $x7 = \"*\\\\G{3D3F9F38-A9F3-48A3-AE6038AE7491F39A}#2.0#0#C:\\\\Users\\\\ADMINI~1\\\\AppData\\\\Local\\\\Temp\\\\Word8.0\\\\MSForms.exd#Micros\n Forms\" wide\n   $s8 = \"Central080 Ari Ranch, Port Sarinachester, Saint Vincent and the Grenadines\nProduct4773 Cornelius Ford, Maybelleville, Morocco\" fullword ascii\n   $s9 = \"Senior75970 Kiehn Brook, Port Joaquin, Comoros Forward6656 Parker Extension,\nHalvorsonton, Zambia\" fullword ascii\n   $s10 = \"6868686868686868686868\" ascii /* reversed goodware string\n'8686868686868686868686' */ /* hex encoded string 'hhhhhhhhhhh' */\n   $s11 = \"*\\\\G{2DF8D04C-5BFA-101B-BDE5-00AA0044DE52}#2.8#0#C:\\\\Program Files\\\\Common\nFiles\\\\Microsoft Shared\\\\OFFICE16\\\\MSO.DLL#Microsoft \" wide\n   $s12 = \"Dynamic98251 Karli Mission, Deronhaven, Democratic People's Republic of\nKorea Chief1365 Hermann Passage, Rickyport, Oman24 \" fullword ascii\n   $s13 = \"Forward0973 Nienow Dam, Walkermouth, Egypt Customer976 MacGyver Mountain,\nSchoentown, Northern Mariana Islands+ Lo \" fullword ascii\n   $s14 = \"Corporate28089 Etha Bypass, Jastbury, Turkmenistan Dynamic764 Price Cliffs,\nWelchtown, Algeriaog(1 \" fullword ascii\n   $s15 = \"National4629 Brianne Locks, Port Shadburgh, Bangladesh Forward481 Ashton\nCourse, Lake Judson, Pakistana Pr\" fullword ascii\n   $s16 = \"Forward563 Sasha Mountains, Nitzschestad, Palau Lead58549 Lesch Parkways,\nPort Archburgh, Burundi\" fullword ascii\n   $s17 = \"Forward00009 Labadie Valley, Lake Othaview, Brunei Darussalam Future796\nFritsch Road, Mertzchester, Montserrat1831 \" fullword ascii\n   $s18 = \"Central9007 Leland Isle, Laurynview, Morocco Product75313 Mueller Harbors,\nWest Nakiafort, Lithuania+ Log( \" fullword ascii\n   $s19 = \"Regional973 Aubrey Squares, South Simoneville, Svalbard & Jan Mayen Islands\nDynamic7842 Madilyn Course, O'Harastad, Armenia\" fullword ascii\n    $s20 = \"Lead7617 Nicolas Meadows, West Odell, Saint Pierre and Miquelon Product9412\n\n```\n\n-----\n\n```\nStamm Cove, South Katlynnport, Comoros \" fullword ascii\n  condition:\n   uint16(0) == 0xcfd0 and filesize < 900KB and\n   1 of ($x*) and 4 of them\n}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.10.14.Emotet_external_SOC/Is%20Emotet%20gang%20targeting%20companies%20with%20external%20SOC.pdf"
    ],
    "report_names": [
        "Is Emotet gang targeting companies with external SOC"
    ],
    "threat_actors": [
        {
            "id": "89542ecf-606b-4913-87c5-21512f9b82b9",
            "created_at": "2022-10-25T15:50:23.681673Z",
            "updated_at": "2025-03-27T02:00:55.522794Z",
            "deleted_at": null,
            "main_name": "RTM",
            "aliases": [
                "RTM"
            ],
            "source_name": "MITRE:RTM",
            "tools": [
                "RTM"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "6a99bf81-8ed4-4233-82e2-575e4f9bf282",
            "created_at": "2022-10-25T16:07:24.137248Z",
            "updated_at": "2025-03-27T02:02:10.119569Z",
            "deleted_at": null,
            "main_name": "RTM",
            "aliases": [],
            "source_name": "ETDA:RTM",
            "tools": [
                "AtNow",
                "RTM",
                "RTM Banker",
                "Redaman"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1581411133,
    "ts_modification_date": 1581411133,
    "files": {
        "pdf": "https://archive.orkl.eu/eb99c745139bd6e46e81745dfd72e41325a02ad4.pdf",
        "text": "https://archive.orkl.eu/eb99c745139bd6e46e81745dfd72e41325a02ad4.txt",
        "img": "https://archive.orkl.eu/eb99c745139bd6e46e81745dfd72e41325a02ad4.jpg"
    }
}