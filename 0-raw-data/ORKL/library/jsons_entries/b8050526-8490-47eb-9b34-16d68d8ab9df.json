{
    "id": "b8050526-8490-47eb-9b34-16d68d8ab9df",
    "created_at": "2022-10-25T16:48:21.088743Z",
    "updated_at": "2025-03-27T02:06:03.0317Z",
    "deleted_at": null,
    "sha1_hash": "cd8ae99c908220d52b892089c5d18ed39b0d0937",
    "title": "KASPERAGENT Malware Campaign resurfaces in May Election",
    "authors": "ThreatConnect",
    "file_creation_date": "2017-06-28T03:49:13Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 853462,
    "plain_text": "# p g y Election\n\n**threatconnect.com** [/blog/kasperagent-malware-campaign/](https://www.threatconnect.com/blog/kasperagent-malware-campaign/)\n\n## KASPERAGENT Malware Campaign resurfaces in the run up to May Palestinian Authority Elections\n\n\n6/14/2017\n\n\nThreatConnect has identified a KASPERAGENT malware campaign leveraging decoy Palestinian Authority\ndocuments. The samples date from April - May 2017, coinciding with the run up to the May 2017 Palestinian\nAuthority elections. Although we do not know who is behind the campaign, the decoy documents’ content focuses on\ntimely political issues in Gaza and the IP address hosting the campaign’s command and control node hosts several\nother domains with Gaza registrants.\n\nIn this blog post we will detail our analysis of the malware and associated indicators, look closely at the decoy files,\nand leverage available information to make an educated guess on the possible intended target. Associated\n[indicators and screenshots of the decoy documents are all available here in the ThreatConnect platform.](https://app.threatconnect.com/auth/campaign/campaign.xhtml?campaign=4219181)\n\n_Some of the indicators in the following post were published on AlienVault OTX on 6/13._\n\n### Background on KASPERAGENT\n\nKASPERAGENT is Microsoft Windows malware used in efforts targeting users in the United States, Israel,\nPalestinian Territories, and Egypt since July 2015. The malware was discovered by Palo Alto Networks Unit 42 and\nClearSky Cyber Security, and publicized in April 2017 in the Targeted Attacks in the Middle East Using\nKASPERAGENT and MICROPSIA blog. It is called KASPERAGENT based on PDB strings identified in the malware\nsuch as “c:\\Users\\USA\\Documents\\Visual Studio 2008\\Projects\\New folder (2)\\kasper\\Release\\kasper.pdb.”\n\nThe threat actors used shortened URLs in spear phishing messages and fake news websites to direct targets to\ndownload KASPERAGENT. Upon execution, KASPERAGENT drops the payload and a decoy document that\ndisplays Arabic names and ID numbers. The malware establishes persistence and sends HTTP requests to the\ncommand and control domain mailsinfo[.]net. Of note, the callbacks were to PHP scripts that included /dad5/ in the\nURLs. Most samples of the malware reportedly function as a basic reconnaissance tool and downloader. However,\nsome of the recently identified files display “extended-capability” including the functionality to steal passwords, take\nscreenshots, log keystrokes, and steal files. These “extended-capability” samples called out to an additional\ncommand and control domain, stikerscloud[.]com. Additionally, early variants of KASPERAGENT used “Chrome” as\nthe user agent, while more recent samples use “OPAERA” - a possible misspelling of the “Opera” - browser. The\nindicators associated with the blog article are available in the ThreatConnect Technical Blogs and Reports source\n[here.](https://app.threatconnect.com/auth/incident/incident.xhtml?incident=4003314)\n\n[The samples we identified leverage the same user agent string “OPAERA”, included the kasper PDB string reported](https://app.threatconnect.com/auth/indicators/details/customIndicator.xhtml?id=29927402&owner=Common+Community)\nby Unit 42, and used similar POST and GET requests. The command and control domains were different, and these\nsamples used unique decoy documents to target their victims.\n\n### Identifying another KASPERAGENT campaign\n\nWe didn’t start out looking for KASPERAGENT, but a file hit on one of our YARA rules for an executable designed to\ndispla a fake XLS icon one a ad ersaries attempt to trick targets into thinking a malicio s file is innoc o s The\n\n\n-----\n\n[and was identified within an archive file (4FE7561F63A71CA73C26CB95B28EAEE8) with the name اﻟﻜﺎﻣﻠﺔ اﻟﺘﻔﺎﺻﯿﻞ](https://app.threatconnect.com/auth/indicators/details/file.xhtml?file=4FE7561F63A71CA73C26CB95B28EAEE8)\n\nﻓﻘﻬﺎء ﻷﻏﺘﯿﺎل.r24”. This translates to “The Complete Details of Fuqaha's Assassination”, a reference to Hamas military\n[leader Mazen Fuqaha who was assassinated on March 24, 2017.](https://www.nytimes.com/2017/03/27/world/middleeast/mazen-fuqaha-hamas-killing-israel.html)\n\n[We detonated the file in VxStream’s automated malware analysis capability and found testproj.exe dropped a](https://www.hybrid-analysis.com/sample/16df435ea8214cb0a62ab40720d8d0f5b65ba9268c84fc9e1180d2468a966f72)\n[benign Microsoft Word document that pulls a jpg file from treestower[.]com. Malwr.com observed this site in](https://app.threatconnect.com/auth/indicators/details/host.xhtml?host=www.treestower.com&owner=Common+Community)\nassociation with another sample that called out to mailsinfo[.]net - a host identified in the Targeted Attacks in the\nMiddle East Using KASPERAGENT and MICROPSIA blog. That was our first hint that we were looking at\nKASPERAGENT.\n\nThe jpg pulled from treestower[.]com displays a graphic picture of a dead man, which also appeared on a\nPalestinian news website discussing the death of Hamas military leader Mazen Fuqaha. A separate malicious\n[executable - 2DE25306A58D8A5B6CBE8D5E2FC5F3C5 (vlc.exe) - runs when the photograph is displayed, using](https://www.hybrid-analysis.com/sample/5d329690a606857871f007b990b78f876c57a571b38cafd54f3d98c9b3b42453?environmentId=100)\n[the YouTube icon and calling out to several URLs on windowsnewupdates[.]com. This host was registered in late](https://app.threatconnect.com/auth/indicators/details/host.xhtml?host=windowsnewupdates.com&owner=Common+Community)\nMarch and appears to be unique to this campaign.\n\nWith our interest piqued, we pivoted on the import hashes (also known as an imphash), which captures the import\ntable of a given file. Shared import hashes across multiple files would likely identify files that are part of the same\nmalware family. We found nine additional samples sharing the imphash values for the two executables,\n[C66F88D2D76D79210D568D7AD7896B45 and DCF3AA484253068D8833C7C5B019B07.](https://app.threatconnect.com/auth/browse/index.xhtml?filters=typeName in (%22Address%22%2C %22EmailAddress%22%2C %22File%22%2C %22Host%22%2C %22URL%22%2C %22ASN%22%2C %22CIDR%22%2C %22Mutex%22%2C %22Registry Key%22%2C %22User Agent%22) and attribute1785 %3D c66f88d2d76d79210d568d7ad7896b45)\n\n_Import Hash Results c66f88d2d76d79210d568d7ad7896b45_\n\n\n-----\n\n_Import Hash Results dcf3aa484253068d8833c7c5b019b07a_\n\nAnalysis of those files uncovered two more imphashes, [0B4E44256788783634A2B1DADF4F9784 and](https://app.threatconnect.com/auth/browse/index.xhtml?filters=typeName in (%22Address%22%2C %22EmailAddress%22%2C %22File%22%2C %22Host%22%2C %22URL%22%2C %22ASN%22%2C %22CIDR%22%2C %22Mutex%22%2C %22Registry Key%22%2C %22User Agent%22) and attribute1785 %3D 0b4e44256788783634a2b1dadf4f9784)\n[E44F0BD2ADFB9CBCABCAD314D27ACCFC, for a total of 20 malicious files. These additional samples behaved](https://app.threatconnect.com/auth/browse/index.xhtml?filters=typeName in (%22Address%22%2C %22EmailAddress%22%2C %22File%22%2C %22Host%22%2C %22URL%22%2C %22ASN%22%2C %22CIDR%22%2C %22Mutex%22%2C %22Registry Key%22%2C %22User Agent%22) and attribute1785 %3D e44f0bd2adfb9cbcabcad314d27accfc)\nsimilarly to the initial files; testproj.exe dropped benign decoy files and started malicious executables. The malicious\nexecutables all called out to the same URLs on windowsnewupdates[.]com.\n\nThese malware samples leverage the user agent string “OPAERA,” the same one identified in the Targeted Attacks\nin the Middle East Using KASPERAGENT and MICROPSIA blog. Although the command and control domain was\ndifferent from those in the report, the POST and GET requests were similar and included /dad5/ in the URL string. In\naddition, the malware samples included the kasper PDB string reported by Unit 42, prompting us to conclude that\nwe were likely looking at new variants of KASPERAGENT.\n\n### The Decoy Files\n\nSeveral of the decoy files appeared to be official documents associated with the Palestinian Authority - the body that\ngoverns the Palestinian Territories in the Middle East. We do not know whether the files are legitimate Palestinian\nAuthority documents, but they are designed to look official. Additionally, most of the decoy files are publicly available\non news websites or social media.\n\nThe first document - dated April 10, 2017 - is marked “Very Secret” and addressed to Yahya Al-Sinwar, who Hamas\nelected as its leader in Gaza in February 2017. Like the photo displayed in the first decoy file we found, this\ndocument references the death of Mazen Fuqaha. The Arabic-language text and English translation of the document\n[are available in ThreatConnect here. A screenshot of the file is depicted below.](https://app.threatconnect.com/auth/document/document.xhtml?document=4219292)\n\n\n-----\n\nThe second legible file, dated April 23, has the same letterhead and also is addressed to Yahya al-Sinwar. This file\n[discusses the supposed announcement banning the rival Fatah political party, which controls the West Bank, from](https://en.wikipedia.org/wiki/Fatah)\nGaza. It mentions closing the Fatah headquarters and houses that were identified as meeting places as well as the\narrest of some members of the party.\n\n\n-----\n\n### Looking at the Infrastructure\n\nWe don’t know for sure who is responsible for this campaign, but digging into the passive DNS results led us to\n[some breadcrumbs. Starting with 195.154.110[.]237, the IP address which is hosting the command and control](https://app.threatconnect.com/auth/indicators/details/address.xhtml?address=195.154.110.237&owner=Common+Community)\ndomain windowsnewupdates[.]com, we found that the host is on a dedicated server.\n\n\n-----\n\n_ThreatConnect DomainTools Integration Results_\n\nUsing our Farsight DNSDB integration, we identified other domains currently and previously hosted on the same IP.\n\n\n-----\n\nTwo of the four domains that have been hosted at this IP since 2016 -- upfile2box[.]com and 7aga[.]net -- were\nregistered by a freelance web developer in Gaza, Palestine. This IP has been used to host a small number of\ndomains, some of which were registered by the same actor, suggesting the IP is dedicated for a single individual or\ngroup’s use. While not conclusive, it is intriguing that the same IP was observed hosting a domain ostensibly\nregistered in Gaza AND the command and control domain associated with a series of targeted attacks leveraging\nPalestinian Authority-themed decoy documents referencing Gaza.\n\n### Targeting Focus?\n\nJust like we can’t make a definitive determination as to who conducted this campaign, we do not know for sure who\nit was intended to target. What we do know is that several of the malicious files were submitted to a public malware\nanalysis site from the Palestinian Territories. This tells us that it is possible either the threat actors or at least one of\nthe targets is located in that area. Additionally, as previously mentioned, the decoy document subject matter would\nlikely be of interest to a few different potential targets in the Palestinian Territories. Potential targets such as Hamas\nwho controls the Gaza strip and counts Mazen Fuqaha and Yahya al-Sinwar as members, Israel which is accused of\ninvolvement in the assassination of Mazen Fuqaha, and the Fatah party of which the Prime Minister and President\nof the Palestinian Authority are members.\n\nThe campaign corresponds with a period of heightened tension in Gaza. Hamas, who has historically maintained\ncontrol over the strip, elected Yahya al-Sinwar - a hardliner from its military wing - as its leader in February. A\n[Humanitarian Bulletin published by the United Nations’ Office for the Coordination of Humanitarian Affairs indicates](https://unispal.un.org/DPA/DPR/unispal.nsf/0/AC8C02B3FA96AA208525811C00554B0D)\nin March 2017 (just before the first malware samples associated with this campaign were identified in early April)\nHamas created “a parallel institution to run local ministries in Gaza,” further straining the relationship between\nHamas and the Palestinian Authority who governs the West Bank. After this announcement, the Palestinian Authority\n[cut salaries for its employees in Gaza by 30 percent and informed Israel that it would no longer pay for electricity](https://www.nytimes.com/2017/04/27/world/middleeast/palestinian-authority-hamas-gaza-electricity.html)\nprovided to Gaza causing blackouts throughout the area and escalating tensions between the rival groups. Then, in\n[early May (two days after the last malware sample was submitted) the Palestinian Authority held local elections in](http://abcnews.go.com/International/wireStory/palestinian-west-bank-local-elections-test-fatah-party-47389952)\nthe West Bank which were reportedly seen as a test for the Fatah party. Elections were not held in Gaza.\n\nAll of that is to say, the decoy documents leveraged in this campaign would likely be relevant and of interest to a\nvariety of targets in Israel and Palestine, consistent with previously identified KASPERAGENT targeting patterns.\nAdditionally, the use of what appear to be carefully crafted documents at the very least designed to look like official\ngovernment correspondence suggests the malware may have been intended for a government employee or\ncontractor who would be interested in the documents’ subject matter. More associated indicators, screenshots of\nmany of the decoy documents, and descriptions of the activity are available via the March - May 2017 Kasperagent\nMalware Leveraging WindowsNewUpdates[.]com Campaign in ThreatConnect.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/vye9qg0l3u5180jk03mwul4p7wlc3gvo"
    ],
    "report_names": [
        "ThreatConnect_KASPERAGENT-Campaign-resurfaces-May-Election(06-14-2017)"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041163,
    "ts_creation_date": 1498621753,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/cd8ae99c908220d52b892089c5d18ed39b0d0937.pdf",
        "text": "https://archive.orkl.eu/cd8ae99c908220d52b892089c5d18ed39b0d0937.txt",
        "img": "https://archive.orkl.eu/cd8ae99c908220d52b892089c5d18ed39b0d0937.jpg"
    }
}