{
    "id": "e4eb75a6-8cb2-4b44-bba1-56e7ac7d22d0",
    "created_at": "2022-10-25T16:48:19.724125Z",
    "updated_at": "2025-03-27T02:16:20.975374Z",
    "deleted_at": null,
    "sha1_hash": "96173322b936132aa4cdc0328e4a247d40ae5152",
    "title": "The Uroburos Case: New Sophisticated Rat Identified",
    "authors": "Gdata",
    "file_creation_date": "2014-11-11T14:12:55Z",
    "file_modification_date": "2014-11-11T14:12:55Z",
    "file_size": 71282,
    "plain_text": "**In February 2014, the experts of the G DATA SecurityLabs published an analysis of Uroburos, the**\n\n**rootkit with Russian roots. We explained that a link exists between Uroburos and the Agent.BTZ**\n\n**malware, which was responsible for \"the most significant breach of U.S. military computers ever.\"**\n\n**[1] Nine months later, after the buzz around Uroburos, aka Snake or Turla, we now identified a new**\n\n**generation of Agent.BTZ We dubbed it ComRAT and, by now, analyzed two versions of the threat**\n\n**(v3.25 and v3.26).**\n\nAs reported earlier this year, Agent.BTZ used the same encoding key and the installation log file name as Uroburos.\n\nComRAT, in its version 3.25, shows the same behavior. Furthermore, the attackers also shared a C&C domain. The\n\nlatest version of ComRAT known to us (v3.26) uses a new key and does not create the installation log file, in order to\n\ncomplicate the analysis and to disguise the link between the two cases.\n\nAnother very interesting fact: the attackers use COM Object hijacking, the same persistence mechanism as\n\n[COMpfun, which we described recently.](https://blog.gdatasoftware.com/blog/article/com-object-hijacking-the-discreet-way-of-persistence.html)\n\nTaken everything into consideration, the indications we saw during our analyzes lead to the supposition that the\n\ngroup behind Agent.BTZ and Uroburos is still active and is pursuing the Agent.BTZ path once more to improve and\n\nchange the RAT.\n\n## Dropper\n\nThe analyzed file is the latest version we identified: v3.26. The version identification is described in the chapter “Log\n\nfiles”. The major difference between this version and the older version(s) will be described there.\n\n### File installation\n\nThe first task of the malware is to install the file credprov.tlb in %APPDATA%\\Microsoft\\. This file is the main\n\npayload of the malware. The dropper executes the following command in order to install a second file:\n\nrundll32.exe %APPDATA%\\Microsoft\\credprov.tlb,Install %APPDATA%\\Microsoft\\shdocvw.tlp\n\nThe second file is shdocw.tlp. The two files are Microsoft Windows dynamic libraries.\n\n### Persistence\n\nTo be started during the boot process of the infected machine, the malware creates the following registry key:\n\nHKCU\\Software\\Classes\\CLSID\\{42aedc87-2188-41fd-b9a3-0c966feabec1}\\InprocServer32 =\n\n%APPDATA%\\shdocvw.tlp\n\nThis registry key is used to associate the library shdocvw.tlp to the object 42aedc87-2188-41fd-b9a3-0c966feabec1\n\n[as previously explained in the article about COMpfun. The purpose is to load the library into each and every process](https://blog.gdatasoftware.com/blog/article/com-object-hijacking-the-discreet-way-of-persistence.html)\n\nexecuted on the infected system.\n\n\n-----\n\nIf the version of the malware is older than 3.26, the dropper creates an additional file called winview.ocx. We\n\nnoticed that the file name is still the same as the file name used by Agent.BTZ in the past. The file is xored with the\n\nfollowing obfuscation key (used by both, Uroburos and Agent.BTZ):\n\n1dM3uu4j7Fw4sjnbcwlDqet4F7JyuUi4m5Imnxl1pzxI6as80cbLnmz54cs5Ldn4ri3do5L6gs923HL34x2f5cvd0fk6c1a0s\n\nHere is the decoded log file content:\n\nuser1@gdata$ ./decode.py winview.ocx\n\nLog begin: 06.11.2014 22:55:55\n\nTVer=2.2\n\n06.11.2014 22:55:55 TVer=2.3\n\n06.11.2014 22:55:55 CFG: CFG_4\n\n06.11.2014 22:55:55 User: user1\n\n06.11.2014 22:55:55 Machine: x86\n\n06.11.2014 22:55:55 Removing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\shdocvw.tlb [2]\n\n06.11.2014 22:55:55 Removing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\oleaut32.dll [2]\n\n06.11.2014 22:55:55 Removing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\oleaut32.tlb [2]\n\n06.11.2014 22:55:55 Removing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\credprov.tlb [2]\n\n06.11.2014 22:55:55 Removing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\libadcodec.dll [2]\n\n06.11.2014 22:55:55 Removing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\libadcodec.tlb [2]\n\n06.11.2014 22:55:55 Writing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\shdocvw.tlb 51200B\n\nOk\n\n06.11.2014 22:55:56 Writing C:\\Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\credprov.tlb\n\n260096B Ok\n\n06.11.2014 22:55:57 Exit code1 0\n\n06.11.2014 22:55:57 Writing 3072B Ok\n\nWe can notice that the malware checks if an older version is installed on the system and if this is the case, the\n\ndropper removes the older version. In contrast to this, in our Uroburos analysis, we found out that Uroburos does\n\nnot install itself in case a version of Agent.BTZ was found on a system.\n\n## Execution flow and features\n\nDuring the startup of the infected machine, the shdocvw.tlp library is loaded into all processes. If the process is\n\nexplorer.exe, this library will load the other library called credprov.tlb. This library is the real payload. Its features\n\nare common for a Remote Administration Tool (RAT):\n\ncommand execution;\n\nfile download;\n\nfile upload;\n\ninformation gathering.\n\n\n-----\n\ne p o e .e e o de to avo d be g b oc ed by a e a o t e syste o a y add t o a secu ty p oducts. e\n\ncommunication between the processes is performed by named pipe.\n\n## Log files\n\nTwo log files are created during the malware execution: mskfp32.ocx and msvcrtd.tlb. If the malware version is\n\nolder than 3.26, the xored key is the same as the dropper key. Concerning the version 3.26, the malware uses a new\n\nnon-ASCII key. Here is an example of decoded log file for the version 3.26:\n\nuser1@gdata$ ./decode.py mskfp32.ocx\n\n<?xml version=\"1.0\" encoding=\"unicode\"?>\n\n<Ch>\n\n<TVer>2.1</TVer>\n\n<AppendLog>0</AppendLog>\n\n<add key=\"Id\" value=\"168466483094462\" />\n\n<add key=\"PVer\" value=\"3.26\" />\n\n<add key=\"OSVer\" value=\"512600 Service Pack 30\" />\n\n<add key=\"Machine\" value=\"x86\" />\n\n<add key=\"CryptKeyType\" value=\"3\" />\n\n<add key=\"CryptKeyId\" value=\"0\" />\n\n<add ke=\"IsAdmin\" value=\"1\" />\n\n<add key=\"Http idx1\" value=\"4294967295\" />\n\n<add key=\"Http idx2\" value=\"4294967295\" />\n\n<add key=\"Http timeout\" value=\"60\" />\n\n<add key=\"Time\" value=\"06:11:2014 15:54:34\" />\n\n<add key=\"Bias\" value=\"-2\" />\n\n<add key=\"PcName\" value=\"USER1-ABC1234\" />\n\n<add key=\"UserName\" value=\"user1\" />\n\n<add key=\"WinDir\" value=\"C:\\\\WINDOWS\" />\n\n<add key=\"TempDir\" value=\"C:\\\\DOCUME~1\\\\user1\\\\LOCALE~1\\\\Temp\\\\\" />\n\n<add key=\"WorkDir\" value=\"C:\\\\ Documents and Settings\\user1\\Application Data\\\\Microsoft\\\\\" />'\n\n</Ch>\n\nWe can identify the version of the malware thanks to the PVer flag. The command and control server information is\n\nstored in the registry, not in an XML, and encoded:\n\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\SessionMRU\\IPlace\n\nFor example, in the analyzed sample the CC is: weather-online.hopto.org. This domain is far from unknown, as it\n\n[has been mentioned in BAE System’s Uroburos (aka Snake) analysis paper as C&C server domain for the Uroburos](http://info.baesystemsdetica.com/rs/baesystems/images/snake_whitepaper.pdf)\n\nmalware. Another connection between the cases.\n\nIf the malware version in lower than 3 26 the XML log file contains the command and control server information:\n\n\n-----\n\nadd e s d va ue /\n\n<add key=\"Http address\" value=\"webonline.mefound.com\" />\n\n<add key=\"Http address\" value=\"sportacademy.my03.com\" />\n\n<add key=\"Http address2\" value=\"easport-news.publicvm.com\" />\n\n<add key=\"Http address2\" value=\"new-book.linkpc.net\" />\n\n<add key=\"Http idx1\" value=\"4294967295\" />\n\n[…]\n\n## Summary\n\nLet us summarize the similarities and differences between Agent.BTZ, Uroburos and ComRAT as far as we can:\n\n**Similarities:**\n\n**Before version 3.26:**\n\nuse of the same xor key\n\nuse of the same file name for the log\n\n**On all versions:**\n\nSome parts of the code are exactly the same (appears to be copy & paste)\n\nThat is the reason why the sample is detected as Uroburos (aka Turla). The same code was used by Agent.BTZ\n\nand also the dll loaded into userland during the Uroburos analysis.\n\nCommand and control server domains are shared between Uroburos and ComRAT.\n\n**Differences:**\n\nIn version 3.26, the author changed the key and remove the known file name\n\nThis action can be an indication for the developer’s effort to hide this connection\n\nThe main difference is the design\n\nAgent.BTZ is a common RAT, a simple library executed on an infected machine. ComRAT is more complex\n\nand cleverer. The malware is loaded into each and every process of the infected machine and the main part\n\n(payload) of the malware is only executed in explorer.exe. Furthermore, the C&C communication blends into\n\nthe usual browser traffic and the malware communicates to the browser by named pipe. It is by far a more\n\ncomplex userland design than Agent.BTZ.\n\nThese differences, mainly the more complex design, lead us to give this malware a new name.\n\nThe analyzed dropper of v3.25 has a compilation date of February 6th 2014. The more recent dropper of v3.26,\n\nwhich has all the mentioned changes implemented, reveals a compilation date of January 3rd 2013. We suspect that\n\nthis date is spoofed in order to disguise that this is in fact a newer version.\n\n\n-----\n\nThis analysis shows that even after the Uroburos publication in February 2014, the group behind this piece of\n\nmalware seems to be still active. In any case, the ComRAT developers implemented new mechanisms, changed keys,\n\nremoved log files to hide their activities and tried to disguise the connections between the RAT ComRAT, the rootkit\n\nUroburos and the RAT Agent.BTZ as much as possible. However, we can still follow the evolution of the malware by\n\ncomparing the versions.\n\nThe persistence mechanism discovered in October 2014 makes it possible to intrude into a system in a really discreet\n\nmanner and we estimate that other actors will use the same persistence mechanism in the near future.\n\nWe will definitely keep our ears and eyes open and continue analyzing.\n\n## IOC\n\n### MD5\n\n51e7e58a1e654b6e586fe36e10c67a73  (dropper v3.25)\n\ne6ce1f962a47479a86ff2e67129f4ecc  (lib1, v3.25)\n\nec7e3cfaeaac0401316d66e964be684e  (lib2, v3.25)\n\n0ae421691579ff6b27f65f49e79e88f6  (dropper v3.26)\n\n255118ac14a9e66124f7110acd16f2cd  (lib1 v3.26)\n\nb407b6e5b4046da226d6e189a67f62ca  (lib2, v3.26)\n\n8ebf7f768d7214f99905c99b6f8242dc  (dropper, unknown version)\n\n9d481769de63789d571805009cbf709a  (dropper, unknown version)\n\n83a48760e92bf30961b4a943d3095b0a  (lib 64-Bit, unknown version)\n\nea23d67e41d1f0a7f7e7a8b59e7cb60f  (lib 64-Bit; unknown version)\n\n### Paths\n\n%APPDATA%\\\\Microsoft\\\\shdocvw.tlb\n\n%APPDATA%\\\\Microsoft\\\\oleaut32.dll\n\n%APPDATA%\\\\Microsoft\\\\oleaut32.tlb\n\n%APPDATA%\\\\Microsoft\\\\credprov.tlb\n\n%APPDATA%\\\\Microsoft\\\\libadcodec.dll\n\n%APPDATA%\\\\Microsoft\\\\libadcodec.tlb\n\n### Registry\n\nHKCU\\Software\\Classes\\CLSID\\{42aedc87-2188-41fd-b9a3-0c966feabec1}\\InprocServer32\n\n### Command and control\n\nweather-online.hopto.org\n\n\n-----\n\nspo tacade y. y03.co\n\neasport-news.publicvm.com\n\nnew-book.linkpc.net\n\n------------------------------\n## Related articles:\n\n[October 30th 2014: COM Object hijacking: the discreet way of persistence](http://com/)\n\n[June 2nd 2014: Analysis of Uroburos, using WinDbg](https://blog.gdatasoftware.com/blog/article/analysis-of-uroburos-using-windbg.html)\n\n[May 13th 2014: Uroburos rootkit: Belgian Foreign Ministry stricken](https://blog.gdatasoftware.com/blog/article/uroburos-rootkit-belgian-foreign-ministry-stricken.html)\n\n[March 3rd 2014: Uroburos - Deeper travel into kernel protection mitigation](https://blog.gdatasoftware.com/blog/article/uroburos-deeper-travel-into-kernel-protection-mitigation.html)\n\n[February 28th 2014: Uroburos - highly complex espionage software with Russian roots](https://blog.gdatasoftware.com/blog/article/uroburos-highly-complex-espionage-software-with-russian-roots.html)\n\n------------------------------\n[[1] www.foreignaffairs.com/articles/66552/william-j-lynn-iii/defending-a-new-domain](http://www.foreignaffairs.com/articles/66552/william-j-lynn-iii/defending-a-new-domain)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/sg4cyodukt7edmmba6bfikuiu1jgzv59",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.11.11.ComRAT/The_Uroburos_case.pdf"
    ],
    "report_names": [
        "The_Uroburos_case"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "08c8f238-1df5-4e75-b4d8-276ebead502d",
            "created_at": "2023-01-06T13:46:39.344081Z",
            "updated_at": "2025-03-27T02:00:03.056208Z",
            "deleted_at": null,
            "main_name": "Copy-Paste",
            "aliases": [],
            "source_name": "MISPGALAXY:Copy-Paste",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a97cf06d-c2e2-4771-99a2-c9dee0d6a0ac",
            "created_at": "2022-10-25T16:07:24.349252Z",
            "updated_at": "2025-03-27T02:02:10.184406Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "ATK 13",
                "Belugasturgeon",
                "Blue Python",
                "CTG-8875",
                "Group 88",
                "ITG12",
                "Iron Hunter",
                "Krypton",
                "Makersmark",
                "Operation Epic Turla",
                "Operation Moonlight Maze",
                "Operation Penguin Turla",
                "Operation Satellite Turla",
                "Operation Skipper Turla",
                "Operation Turla Mosquito",
                "Operation WITCHCOVEN",
                "Pacifier APT",
                "Pensive Ursa",
                "Popeye",
                "SIG15",
                "SIG2",
                "SIG23",
                "Secret Blizzard",
                "TAG-0530",
                "Turla",
                "UNC4210",
                "Venomous Bear",
                "Waterbug"
            ],
            "source_name": "ETDA:Turla",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "ATI-Agent",
                "AdobeARM",
                "Agent.BTZ",
                "Agent.DNE",
                "BigBoss",
                "COMpfun",
                "Chinch",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobra Carbon System",
                "ComRAT",
                "DoublePulsar",
                "EmPyre",
                "EmpireProject",
                "Epic Turla",
                "EternalBlue",
                "EternalRomance",
                "GoldenSky",
                "Group Policy Results Tool",
                "HTML5 Encoding",
                "HyperStack",
                "IcedCoffee",
                "IronNetInjector",
                "KSL0T",
                "Kapushka",
                "Kazuar",
                "KopiLuwak",
                "Kotel",
                "LOLBAS",
                "LOLBins",
                "LightNeuron",
                "Living off the Land",
                "Maintools.js",
                "Metasploit",
                "Meterpreter",
                "MiamiBeach",
                "Mimikatz",
                "MiniDionis",
                "Minit",
                "NBTscan",
                "NETTRANS",
                "NETVulture",
                "Neptun",
                "NetFlash",
                "NewPass",
                "Outlook Backdoor",
                "Penquin Turla",
                "Pfinet",
                "PowerShell Empire",
                "PowerShellRunner",
                "PowerShellRunner-based RPC backdoor",
                "PowerStallion",
                "PsExec",
                "PyFlash",
                "QUIETCANARY",
                "Reductor RAT",
                "RocketMan",
                "SMBTouch",
                "SScan",
                "Satellite Turla",
                "SilentMoon",
                "Sun rootkit",
                "TTNG",
                "TadjMakhal",
                "Tavdig",
                "TinyTurla",
                "TinyTurla Next Generation",
                "TinyTurla-NG",
                "Topinambour",
                "Tunnus",
                "Turla",
                "Turla SilentMoon",
                "TurlaChopper",
                "Uroburos",
                "Urouros",
                "WCE",
                "WITCHCOVEN",
                "WhiteAtlas",
                "WhiteBear",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Wipbot",
                "WorldCupSec",
                "XTRANS",
                "certutil",
                "certutil.exe",
                "gpresult",
                "nbtscan",
                "nbtstat",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8aaa5515-92dd-448d-bb20-3a253f4f8854",
            "created_at": "2024-06-19T02:03:08.147099Z",
            "updated_at": "2025-03-27T02:05:17.408118Z",
            "deleted_at": null,
            "main_name": "IRON HUNTER",
            "aliases": [
                "Belugasturgeon ",
                "Blue Python ",
                "CTG-8875 ",
                "ITG12 ",
                "KRYPTON ",
                "MAKERSMARK ",
                "Pensive Ursa ",
                "Secret Blizzard ",
                "Turla",
                "UAC-0003 ",
                "UAC-0024 ",
                "UNC4210 ",
                "Venomous Bear ",
                "Waterbug ",
                "ATK13 "
            ],
            "source_name": "Secureworks:IRON HUNTER",
            "tools": [
                " ComRAT",
                " Kazuar",
                " KopiLuwak",
                " LightNeuron",
                " Mosquito",
                " Nautilus",
                " Neuron",
                " Penquin",
                " PoisonFrog",
                " PyFlash",
                " Skipper",
                " Snake",
                " Tavdig",
                " TinyTurla",
                " Tunnus",
                "Carbon-DLL"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a97fee0d-af4b-4661-ae17-858925438fc4",
            "created_at": "2023-01-06T13:46:38.396415Z",
            "updated_at": "2025-03-27T02:00:02.823045Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Uroburos",
                "Hippo Team",
                "Pacifier APT",
                "MAKERSMARK",
                "ATK13",
                "UAC-0003",
                "IRON HUNTER",
                "Waterbug",
                "TAG_0530",
                "KRYPTON",
                "Popeye",
                "SIG23",
                "UAC-0144",
                "G0010",
                "Blue Python",
                "VENOMOUS Bear",
                "Group 88",
                "Pfinet",
                "ITG12",
                "UNC4210",
                "Secret Blizzard",
                "UAC-0024"
            ],
            "source_name": "MISPGALAXY:Turla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041780,
    "ts_creation_date": 1415715175,
    "ts_modification_date": 1415715175,
    "files": {
        "pdf": "https://archive.orkl.eu/96173322b936132aa4cdc0328e4a247d40ae5152.pdf",
        "text": "https://archive.orkl.eu/96173322b936132aa4cdc0328e4a247d40ae5152.txt",
        "img": "https://archive.orkl.eu/96173322b936132aa4cdc0328e4a247d40ae5152.jpg"
    }
}