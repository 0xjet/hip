{
    "id": "73bf4c9d-df3f-4c0c-b401-e47977347296",
    "created_at": "2023-01-12T15:08:31.354887Z",
    "updated_at": "2025-03-27T02:16:26.097155Z",
    "deleted_at": null,
    "sha1_hash": "6819f0333d06d6a4dfa1f574e1c66eae8480d0ee",
    "title": "2021-04-14 - From PoC to Exploit Kit- Purple Fox now exploits CVE-2021-26411",
    "authors": "",
    "file_creation_date": "2022-05-28T19:08:51Z",
    "file_modification_date": "2022-05-28T19:08:51Z",
    "file_size": 3978115,
    "plain_text": "# Recent Posts\n\n**[threatresearch.ext.hp.com/purple-fox-exploit-kit-now-exploits-cve-2021-26411/](https://threatresearch.ext.hp.com/purple-fox-exploit-kit-now-exploits-cve-2021-26411/)**\n\nApril 14, 2021\n\n[HP Threat Research Blog • From PoC to Exploit Kit: Purple Fox now exploits CVE-2021-](https://threatresearch.ext.hp.com/blog/)\n26411\n\n## From PoC to Exploit Kit: Purple Fox now exploits CVE-2021-26411\n\n Brief history\n\n[Purple Fox is a multi-component malware family that was first documented by Qihoo 360 in](https://blog.360totalsecurity.com/en/purple-fox-trojan-burst-out-globally-and-infected-more-than-30000-users/)\nSeptember 2018. Originally, it was a trojan that was delivered using the Rig exploit kit (EK).\n[Since then its developers have added new capabilities, including a rootkit component and an](https://www.trendmicro.com/en_us/research/19/i/purple-fox-fileless-malware-with-rookit-component-delivered-by-rig-exploit-kit-now-abuses-powershell.html)\nexploit kit (also known as Purple Fox EK) to deliver the malware. In mid-2020, Proofpoint\n[suggested that Purple Fox EK may have been developed to replace Rig, plausibly as a cost-](https://www.proofpoint.com/us/blog/threat-insight/purple-fox-ek-adds-exploits-cve-2020-0674-and-cve-2019-1458-its-arsenal)\nsaving measure to avoid having to pay another entity to distribute the malware. Exploits\n[against two vulnerabilities, CVE-2020-0674 and](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2020-0674) [CVE-2019-1458, were integrated into Purple](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2019-1458)\nFox at this time. The former exploits a vulnerability in Internet Explorer’s scripting engine to\ngain code execution, while the latter exploits a vulnerability in win32k.sys to run code with\nelevated privileges.\n\nIn October 2020, [SentinelOne described a significant change to Purple Fox’s infection chain](https://labs.sentinelone.com/purple-fox-ek-new-cves-steganography-and-virtualization-added-to-attack-flow/)\nand the integration of other privilege escalation exploits. In addition to running several stages\nof obfuscated PowerShell code to infect systems, Purple Fox’s developers added a feature\n\n\n-----\n\nenabling it to extract other malware stages from image files. Notably, malicious code is\nhidden inside the images using steganography to avoid detection by web proxies and\nfirewalls.\n\n## March 2021 – Purple Fox developers add CVE-2021-26411 exploit\n\nOn 12 April 2021, we isolated a Purple Fox EK sample from a HP Sure Click Enterprise\ncustomer in the Middle East. Interestingly, the sample attempted to exploit a memory\ncorruption vulnerability in Internet Explorer (CVE-2021-26411) that appeared to be a new\naddition to Purple Fox’s exploit arsenal. Other Purple Fox EK samples exploiting this\n[vulnerability in the wild were also reported by security researchers.](https://twitter.com/nao_sec/status/1378546891349106692)\n\nWhat is notable about this exploit is that the code run by Purple Fox is very similar to a proof\n[of concept (PoC) published by Enki to the public in mid-March 2021. According to Enki, the](https://enki.co.kr/blog/2021/02/04/ie_0day.html)\nPoC script was originally exploited in a social engineering campaign targeting security\nresearchers in January 2021. One possible explanation for their similarity is that the Purple\nFox developers simply copied the script from that article. Since the time from PoC to in the\nwild (ITW) sightings was a couple of weeks (Figure 1), organisations only had a small\nwindow to patch before risking compromise by Purple Fox.\n\n\n-----\n\nFigure 1 – Timeline showing the history of CVE-2021-26411. The PoC-to-ITW time is\nhighlighted in orange.\n\n## Infection chain\n\nThe user encountered Purple Fox EK after searching for the term “زﯾﺎرة-ﺗﻤﺪﯾﺪ-ﻧﻤﻮذج-” (“Formextension-visit-” in Arabic) in Google. They clicked on one of the search results to\nloislandgraf[.]us, which then led to the exploit via several redirects. During the analysis, we\nnoticed that the exploit is not triggered in every case because geofencing was used to\ncontrol who is targeted. The attacker’s exact strategy in terms of targeted regions remains\nunclear. The page could not be accessed from countries such as the USA, UK, France,\nGermany, the Netherlands and Egypt, whereas Italy, Switzerland, Ireland, Sweden and\nJapan could trigger the infection chain, although this is not an exhaustive list.\n\nFigure 2 – Purple Fox EK web redirections.\n\nExamining the exploit code shows that it is obfuscated in several stages and encrypted using\nAES. We were able to recover the source code, which shares many similarities to the PoC\ncode released by Enki. The only major difference between the two is that the shellcode in the\nPurple Fox exploit script is much longer.\n\n\n-----\n\nFigure 3 – CVE-2021-26411 exploit shellcode.\n\nThe shellcode is straightforward to decode. It runs a PowerShell statement that downloads a\nfile from a remote server and executes it once again with PowerShell. The following diagram\nshows the process flow of the exploit, which was isolated inside a disposable micro-virtual\nmachine by HP Sure Click Enterprise when the user clicked on the link.\n\nFigure 4 – Process execution flow in HP Sure Controller, showing the exploit that HP Sure\nClick Enterprise isolated.\n\nThe execution of the malware largely corresponds to the infection chain already described by\nSentinelOne. The script checks whether the user is an administrator and installs the malware\nusing an MSI file if this is the case. If the user is not an administrator, further malware\nmodules are downloaded from the Internet. Steganography now comes into play.\n\nFigure 5 – Purple Fox EK steganographic images (code removed).\n\nPowerShell scripts are extracted from the downloaded images, which are then executed and\nlead to privilege escalation through one of the integrated exploits:\n\nCVE-2015-1701\nCVE-2018-8120\n\n\n-----\n\nCVE-2019-1458\nCVE-2019-0808\nCVE-2020-1054\nCVE-2021-1732 (Nb. The exploit delivered by Purple Fox EK is similar to this publicly\navailable PoC.)\n\nIf the exploit is successful, then the MSI and the payload is installed on the client.\n\n## Conclusion\n\nAlthough we have seen fewer sightings of EKs since 2017, the active development of Purple\nFox EK suggests this malware delivery method has not gone completely out of fashion.\nPurple Fox has been around for over two and a half years, during which its developers have\nregularly extended the EK with new exploits and additional functionality to bypass detection.\nThe addition of a CVE-2021-26411 exploit about a month after the release of the patch does\nnot rule out the possibility that the vulnerability was exploited by the malware before.\nHowever, the code similarity between the Enki PoC and the exploit code run by Purple Fox\ndemonstrates how malware developers can easily and quickly adapt public exploit code to\ntheir needs. The short time from PoC to real-world sightings once again shows how\nimportant it is to patch security vulnerabilities promptly and to monitor and detect anomalies\nas they occur.\n\n## Indicators of Compromise\n\nJavaScript:\nbe9fc372f19c9a50c1a72bfb0a59e8c61188ea5c249fee0f861d91943b7e44ff\n46114cd251ce7724db978be8ade624c798b125467e1599fac19a31ff099c94d7\nbfa9cc5c1ce788349e8c215ce100a8d91f620b12d0b89de9e84aac4e9c271f99\n\nPowerShell:\na1cf6f10a700c70d95941497164b03b08ea63eb3b8f67d88255bf775aa564d1f\na4237b2123f701136a2e1e01eb2fefcb99a8f2ee32ad147e2280fa39aa3f0109\nf7938b01fc97daa164bce34c5cd0ab4c02a8c58c9d4a7102364dd9dfe0f90d30\n\nMSI:\nf68e95cde6170068ca64f57f34757ddfe9386c888090d02afb32a89204b8bc09\n7a8469d5ca87ce05b91cc1e22183513af54f26a0b9684a2f31e6ab243fa2ffde\n231485bfd3e299ba3cc51fc6ce48a60b8d205adb3c9c0662210a2e654f593967\n\nImages containing code hidden using steganography:\nd20ccd52ffd1a3b831c65a1f1f7955494d267cdf5df3df7a95c47f4de34f72c2\n01f954cbc2e1b35c67f86e1ae090f4641ce9d7a40efe0b73517d1817274ffab9\n2dea273fa8f6f15297d0f0f98d7e27ac1ec02b59b81c6b7888ae3b99c57b3d8f\n\n\n-----\n\n419848f8832a9a4cefdfff4d712922cce05aa72bd47b84aafc5276d050072111\n0cb6e176a87702a779b73b5cf4787f5dfc6ebf763c895ec37a6422b8335287ab\n1a71c739d20fb3c8649a7e620d0d046ba01a3cbeddc5d3b2c2d7fa3b136bae12\n\nPrivilege escalation exploits:\nca7bd2830405ed53fd7f56738d7644ff8ecfd5bc63d079d322c99601c6106843\n7b9a0b674d9502abe5a7227ef60f3854ef6e12803a74b480581a199c6df3165c\ne0092a2d0da3eb745d0b0fbf57c0f68ea781770c216ff7bdeb4cd0029bd4d1c3\n079c13fbc30a32e4f0386cd53c56d68404961b8f1cd4d4fde1a1e9def42aa557\n7465b738ba31fa2fff7fef1d770ef32e43b01d49a937b3b1c11dc2e4e45fd019\n90658e4d79007577c3ad13a79a9d47f39c6949dcca3ee618de476c27b214c5a1\n\nDomains:\nwww.loislandgraf[.]us\nwww.healthier-patriot[.]shop\niauisdoenki[.]xyz\neyoruas.iauisdoenki[.]xyz\nveoipc.ahntncaiiribi[.]xyz\nahntncaiiribi[.]xyz\ncnghfekiutetw[.]xyz\niauisdoenki[.]xyz\nktecydnn[.]xyz\nvmendehep[.]xyz\nktecydnn[.]xyz\nbroad-block-d151.weteon.workers[.]dev\nplain-forest-2233.ethcrartb.workers[.]dev\nshy-feather-00c8.itttsfbir.workers[.]dev\nsummer-shadow-5f60.oryfannne.workers[.]dev\nrawcdn.githack[.]net\n\nTags\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-14 - From PoC to Exploit Kit- Purple Fox now exploits CVE-2021-26411.pdf"
    ],
    "report_names": [
        "2021-04-14 - From PoC to Exploit Kit- Purple Fox now exploits CVE-2021-26411.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536111,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653764931,
    "ts_modification_date": 1653764931,
    "files": {
        "pdf": "https://archive.orkl.eu/6819f0333d06d6a4dfa1f574e1c66eae8480d0ee.pdf",
        "text": "https://archive.orkl.eu/6819f0333d06d6a4dfa1f574e1c66eae8480d0ee.txt",
        "img": "https://archive.orkl.eu/6819f0333d06d6a4dfa1f574e1c66eae8480d0ee.jpg"
    }
}