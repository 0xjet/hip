{
    "id": "c99ca191-6ef3-4deb-8612-76c4e5364f03",
    "created_at": "2023-01-12T15:03:34.204971Z",
    "updated_at": "2025-03-27T02:06:03.028563Z",
    "deleted_at": null,
    "sha1_hash": "b58bdc672f0f1d560f4ab331670b7f249329baf9",
    "title": "2022-01-20 - New STRRAT RAT Phishing Campaign",
    "authors": "",
    "file_creation_date": "2022-11-28T19:09:10Z",
    "file_modification_date": "2022-11-28T19:09:10Z",
    "file_size": 2007714,
    "plain_text": "# New STRRAT RAT Phishing Campaign\n\n**[fortinet.com/blog/threat-research/new-strrat-rat-phishing-campaign](https://www.fortinet.com/blog/threat-research/new-strrat-rat-phishing-campaign)**\n\nThreat Research\n\nBy [James Slaughter\n| January 20, 2022](https://www.fortinet.com/blog/search?author=James+Slaughter)\n\n\nJanuary 20, 2022\n\n\nShipping is an indispensable part of modern life. It is the lifeblood of the global economy, with\nnumerous large companies (and their equally large container ships) perpetually moving\ngoods from one corner of the earth to the other to provide consumers and industries with the\nnecessities of life.\n\nDue to the critical importance of shipping and receiving goods to most organizations, threat\nactors often use shipping as a lure for phishing emails—such as false invoices, changes in\nshipping delivery, or notices related to a fictitious purchase—to entice recipients into opening\nmalicious attachments and inadvertently downloading malware.\n\n\n-----\n\nFortiGuard Labs recently came across an example of such an email which was subsequently\nfound to harbor a variant of the STRRAT malware as an attachment.\n\nThis blog will detail the deconstruction of the phishing email and its malicious payload.\n\n**Affected Platforms: Windows**\n\n**Impacted Users: Windows users**\n\n**Impact: Collects sensitive information from the compromised end point**\n\n**Severity Level: Medium**\n\n## Examining the phishing email\n\nSTRRAT is a multi-capability Remote Access Trojan that dates to at least mid-2020.\nUnusually, it is Java-based and is typically delivered via phishing email to victims.\n\nLike most phishing attacks, previous STRAAT campaigns have used an intermediate dropper\n(e.g., a malicious Excel macro) attached to the email that downloads the final payload when\nopened. This sample dispenses with that tactic and instead attaches the final payload\ndirectly to the phishing email.\n\nFigure 1. Spoofed email sender and subject\n\nAs Figure 1 shows, this sample is clearly not from Maersk Shipping. The threat actors are\nhoping that recipients do not look too closely. Digging into the email headers further, the full\ntrail of where the email has come from becomes apparent:\n\nFigure 2. Email headers\n\nAfter departing the sender’s local infrastructure, the message eventually routes through\n“acalpulps[.]com” before being delivered to the final recipient. This domain was only\nregistered in August 2021, making the domain somewhat suspicious. Additionally, the\ndomain used in the “Reply-To” address, “ftqplc[.]in”, was also recently registered (October\n2021), making it also highly suspect.\n\nThe email body encourages the recipient to open attachments about a scheduled shipment.\n\nFigure 3. Email body\n\nAs of the publish date of this blog, the domain “v[.]al” included in the body of the letter does\nnot resolve.\n\nFigure 4. Email attachments\n\nAttached directly to the sample email are a PNG image and two Zip archives. “maersk.png”\nis just an image file, as shown in Figure 4. The two Zip archives,\n“SHIPMENT DOCUMENTS INV-PLIST01256 BL PDF[ ]zip” and\n\n\n-----\n\nSHIPMENT_DOCUMENTS_INV-PLIST01256_BL PDF (2)[.]zip, however, contain an\nembedded copy of STRRAT.\n\n## Examining the STRRAT attachment\n\n“SHIPMENT_DOCUMENTS_INV-PLIST01256_BL PDF[.]zip” and\n“SHIPMENT_DOCUMENTS_INV-PLIST01256_BL PDF (2)[.]zip” are identical files, as can\nbe seen through their respective SHA256 hash values.\n\nFigure 5. SHA256 hash of “SHIPMENT_DOCUMENTS_INV-PLIST01256_BL PDF[.]zip”\n\nFigure 6. SHA256 hash of “SHIPMENT_DOCUMENTS_INV-PLIST01256_BL PDF (2)[.]zip”\n\nUnzipping one of these archives presents the file “SHIPMENT_DOCUMENTS_INVPLIST01256_BL PDF[.]jar”. However, upon opening the file in Jar Explorer, a few things\nbecome immediately apparent.\n\nFigure 7. Initial view of “SHIPMENT_DOCUMENTS_INV-PLIST01256_BL PDF[.]jar” in Jar\nExplorer\n\nFirstly, a large number of Java class files are part of this package. Secondly, the class\n“FirstRun” strings appear to be scrambled or encoded. Lines that are appended with\n“ALLATORIxDEMO” indicate the presence of the Allatori Java Obfuscator.\n\nThis can be validated by attempting to execute the jar file.\n\nFigure 8. Splash screen shown when attempting to execute\n“SHIPMENT_DOCUMENTS_INV-PLIST01256_BL PDF[.]jar”\n\nConfirming that this has been obfuscated using Allatori helps in the analysis process as\nopen-source tools are available that can roll this back and reveal the actual content inside\n[the jar file. Java Deobfuscator (https://github.com/java-deobfuscator/deobfuscator) works](https://github.com/java-deobfuscator/deobfuscator)\nparticularly well against Allatori and successfully restores the original string content, as\nshown below.\n\nFigure 9. The same view of class “FirstRun” now deobfuscated\n\nIndependently encoded from the class files in STRRAT is the configuration file (config.txt).\nOn first view, it is base 64 encoded, as shown in Figure 10.\n\nFigure 10. Base 64 encoded “config.txt”\n\nWhen decoded, the file is unfortunately still scrambled.\n\nFigure 11. “Decoded” configuration file\n\n\n-----\n\nBy searching the code for config.txt, we can see that the configuration file was encrypted\nusing AES and uses the passphrase of “strigoi.” Decrypting the config file now becomes\npossible.\n\nFigure 12. Decrypted configuration file\n\nThe final item in the line in Figure 12 was of particular interest, as this sample appeared\nduring the height of the Log4Shell event. Khonsari was the name of a ransomware variant\ntaking advantage of that particular vulnerability. Here, though, the word functions as a\nsoftware key, and there is no evidence of any link between the two pieces of malware.\n\nMost malware strains have a requirement to maintain persistence across reboots and\nsessions so they can complete tasks they’ve been set. STRRAT accomplishes this by\ncopying itself into a new directory and then adding entries to the Windows registry to run at\nsystem startup.\n\nFigure 13. Code to modify the registry\n\nFigure 14. Modified registry\n\nSTRRAT queries the host to determine its architecture and anti-virus capability on startup. It\nalso queries running processes, local storage, and network capability.\n\nIn terms of capabilities, STRRAT can log keystrokes and maintain an HTML-based log to\nstore items of interest.\n\nFigure 15. Code to create the keyboard log file\n\nFigure 16. Keyboard log file ready to be populated\n\nSTRRAT can also facilitate the remote control of an infected system by dropping HRDP – a\nremote access tool.\n\nFigure 17. HRDP\n\nAdditional capabilities include siphoning passwords from browsers, such as Chrome, Firefox,\nand Microsoft Edge, and email clients, like Outlook, Thunderbird, and Foxmail.\n\nOne of the more curious modules present in STRRAT is its pseudo-ransomware ability.\n\nFigure 18. Pseudo-ransomware module\n\nThe code cycles through files in the user’s home directories and appends a file extension of\n“.crimson” to them. No encryption of the files is undertaken, making this only suitable as a\ndecoy or perhaps as a scare tactic against less savvy users. A ransom note template was\nnot found in the code.\n\n\n-----\n\nOn the network side of things, we see STRRAT looking to reach out and pull down several\nJava dependencies upon startup.\n\nFigure 19. Java dependencies\n\nAs shown in Figure 12, this sample is using IP address 198[.]27.77.242 for C2 (Command\nand Control). Examining that traffic in Wireshark shows STRRAT being exceptionally noisy.\nThis is likely due to the C2 channel being offline at the time of the investigation. In its effort to\nobtain further instructions, the sample attempts to communicate over port 1780 and 1788 at\none-second intervals, if not more in some instances.\n\nFigure 20. Attempted C2 communication as shown in Wireshark\n\n_Figure 12 also shows a URL containing the domain “jbfrost[.]live”. This appears to be part of_\nthe C2 infrastructure for the malware but does not appear to be used (at least not at this\ntime). The domain does not resolve currently.\n\n## Conclusion\n\nThreat actors expend an enormous amount of effort to craft campaigns that take advantage\nof the basic day-to-day operations of companies. This includes the intake of raw materials\nand the output of finished goods via shipping and transportation networks. Threats of this\nnature are only set to increase in the coming months and years and organizations need to be\non guard for attempts to subvert their operations in this manner.\n\nThis campaign is one such attempt. STRRAT doesn’t garner as much attention as some of\nthe more widely seen trojans in the malware ecosystem, but it is a capable and resilient\nthreat where encountered.\n\n## Fortinet Protections and Mitigations\n\nFortiGuard Labs provides the following AV coverage against the files used in this attack:\n\nJava/Agent.X!tr\n\nFortiMail protects Fortinet customers by blocking phishing emails and applying FortiGuard’s\nWeb Filtering, AntiVirus, and CDR (content disarm and reconstruction) technologies.\n\nAll network IOCs are blocked by the WebFiltering client.\n\nFortiEDR detects the malicious files based on reputation and behavior.\n\n**IOCs**\n\n**E-mail**\n\n\n-----\n\n**_Addresses_**\n\nshipping@acalpulps.com\n\nexports@ftqplc.in\n\n**Trojan**\n\n**_SHA256 Hash_**\n\n409ad1b62b478477ce945791e15e06b508e5bb156c4981263946cc232df89996\n(SHIPMENT_DOCUMENTS_INV-PLIST01256_BL PDF[.]zip)\n\n3380d42b418582b6f23cfd749f3f0851d9bffc66b51b338885f8aa7559479054\n(SHIPMENT_DOCUMENTS_INV-PLIST01256_BL PDF[.]jar)\n\n**_URL_**\n\nhXXp://jbfrost[.]live/strigoi/server/?hwid=1&lid=m&ht=5\n\n**_IP Address_**\n\n198[.]27.77.242 (C2)\n\n_Learn more about Fortinet’s_ _[FortiGuard Labs threat research and intelligence organization](https://www.fortinet.com/fortiguard/labs?utm_source=blog&utm_campaign=fortiguard-labs)_\n_[and the FortiGuard Security Subscriptions and Services portfolio.](https://www.fortinet.com/fortiguard/labs?tab=security-bundles&utm_source=blog&utm_campaign=security-bundles)_\n\n## Related Posts\n\nCopyright © 2022 Fortinet, Inc. All Rights Reserved\n\n[Terms of ServicesPrivacy Policy](https://www.fortinet.com/corporate/about-us/legal.html)\n| Cookie Settings\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-20 - New STRRAT RAT Phishing Campaign.pdf"
    ],
    "report_names": [
        "2022-01-20 - New STRRAT RAT Phishing Campaign.pdf"
    ],
    "threat_actors": [
        {
            "id": "c7d9878a-e691-4c6f-81ae-84fb115a1345",
            "created_at": "2022-10-25T16:07:23.359506Z",
            "updated_at": "2025-03-27T02:02:09.752427Z",
            "deleted_at": null,
            "main_name": "APT 41",
            "aliases": [
                "BrazenBamboo",
                "Bronze Atlas",
                "Double Dragon",
                "Earth Baku",
                "Grayfly",
                "Operation ColunmTK",
                "Operation CuckooBees",
                "Operation ShadowHammer",
                "Red Kelpie",
                "SparklingGoblin",
                "TA415",
                "TG-2633"
            ],
            "source_name": "ETDA:APT 41",
            "tools": [
                "9002 RAT",
                "ADORE.XSEC",
                "ASPXSpy",
                "ASPXTool",
                "AceHash",
                "Agent.dhwf",
                "Agentemis",
                "AndroidControl",
                "AngryRebel",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BLUEBEAM",
                "Barlaiy",
                "BlackCoffee",
                "Bladabindi",
                "BleDoor",
                "CCleaner Backdoor",
                "CHINACHOPPER",
                "COLDJAVA",
                "China Chopper",
                "ChyNode",
                "Cobalt Strike",
                "CobaltStrike",
                "Crackshot",
                "CrossWalk",
                "CurveLast",
                "CurveLoad",
                "DAYJOB",
                "DBoxAgent",
                "DEADEYE",
                "DEADEYE.APPEND",
                "DEADEYE.EMBED",
                "DEPLOYLOG",
                "DIRTCLEANER",
                "DUSTTRAP",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "DodgeBox",
                "DragonEgg",
                "ELFSHELF",
                "EasyNight",
                "Farfli",
                "FunnySwitch",
                "Gh0st RAT",
                "Ghost RAT",
                "HDD Rootkit",
                "HDRoot",
                "HKDOOR",
                "HOMEUNIX",
                "HUI Loader",
                "HidraQ",
                "HighNoon",
                "HighNote",
                "Homux",
                "Hydraq",
                "Jorik",
                "Jumpall",
                "KEYPLUG",
                "Kaba",
                "Korplug",
                "LATELUNCH",
                "LOLBAS",
                "LOLBins",
                "LightSpy",
                "Living off the Land",
                "Lowkey",
                "McRAT",
                "MdmBot",
                "MessageTap",
                "Meterpreter",
                "Mimikatz",
                "MoonBounce",
                "MoonWalk",
                "Motnug",
                "Moudour",
                "Mydoor",
                "NTDSDump",
                "PACMAN",
                "PCRat",
                "PINEGROVE",
                "PNGRAT",
                "POISONPLUG",
                "POISONPLUG.SHADOW",
                "POTROAST",
                "PRIVATELOG",
                "PipeMon",
                "PlugX",
                "PortReuse",
                "ProxIP",
                "ROCKBOOT",
                "RbDoor",
                "RedDelta",
                "RedXOR",
                "RibDoor",
                "Roarur",
                "RouterGod",
                "SAGEHIRE",
                "SPARKLOG",
                "SQLULDR2",
                "STASHLOG",
                "SWEETCANDLE",
                "ScrambleCross",
                "Sensocode",
                "SerialVlogger",
                "ShadowHammer",
                "ShadowPad Winnti",
                "SinoChopper",
                "Skip-2.0",
                "SneakCross",
                "Sogu",
                "Speculoos",
                "Spyder",
                "StealthReacher",
                "StealthVector",
                "TERA",
                "TIDYELF",
                "TIGERPLUG",
                "TOMMYGUN",
                "TVT",
                "Thoper",
                "Voldemort",
                "WIDETONE",
                "WINNKIT",
                "WINTERLOVE",
                "Winnti",
                "WyrmSpy",
                "X-Door",
                "XDOOR",
                "XMRig",
                "XShellGhost",
                "Xamtrav",
                "ZXShell",
                "ZoxPNG",
                "certutil",
                "certutil.exe",
                "cobeacon",
                "gresim",
                "njRAT",
                "pwdump",
                "xDll"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535814,
    "ts_updated_at": 1743041163,
    "ts_creation_date": 1669662550,
    "ts_modification_date": 1669662550,
    "files": {
        "pdf": "https://archive.orkl.eu/b58bdc672f0f1d560f4ab331670b7f249329baf9.pdf",
        "text": "https://archive.orkl.eu/b58bdc672f0f1d560f4ab331670b7f249329baf9.txt",
        "img": "https://archive.orkl.eu/b58bdc672f0f1d560f4ab331670b7f249329baf9.jpg"
    }
}