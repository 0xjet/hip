{
    "id": "de9abd8f-79f0-4a2f-a4f0-4621b1ace076",
    "created_at": "2023-01-12T15:08:53.908219Z",
    "updated_at": "2025-03-27T02:06:13.763738Z",
    "deleted_at": null,
    "sha1_hash": "735c210045387de60d6a7ef2f1a1eab51bd53964",
    "title": "2021-05-28 - DarkSide on Linux- Virtual Machines Targeted",
    "authors": "",
    "file_creation_date": "2022-05-28T16:50:26Z",
    "file_modification_date": "2022-05-28T16:50:26Z",
    "file_size": 1586984,
    "plain_text": "# DarkSide on Linux: Virtual Machines Targeted\n\n**trendmicro.com/en_us/research/21/e/darkside-linux-vms-targeted.html**\n\nRansomware\n\n\nMay 28, 2021\n\n\nWe focus on the behavior of the DarkSide variant that targets Linux. We discuss how it targets virtual machine-related\nfiles on VMware ESXI servers, parses its embedded configuration, kills virtual machines (VMs), encrypts files on the\ninfected machine, collects system information, and sends it to the remote server.\n\nBy: Mina Naiim May 28, 2021 Read time: ( words)\n\n**_Updated June 1, 2021, 12:02 am ET: This article has been updated to remove the Command-and-Control_**\n**_(C&C) URI String field in Table 1. Further study showed that it does not apply consistently to a number of_**\n**_samples._**\n\n[As we discussed in our previous blog, the DarkSide ransomware is targeting organizations in manufacturing, finance,](https://www.trendmicro.com/en_us/research/21/e/what-we-know-about-darkside-ransomware-and-the-us-pipeline-attac.html)\nand critical infrastructures in regions such as the United States, France, Belgium, and Canada. The DarkSide\nransomware targets both Windows and Linux platforms. We also noticed that the Linux variant, in particular, targets\nESXI servers.\n\nIn this blog, we focus on the behavior of the variant that targets Linux. This entry also discusses how this variant\ntargets virtual machine-related files on VMware ESXI servers, parses its embedded configuration, kills virtual\nmachines (VMs), encrypts files on the infected machine, collects system information, and sends it to the remote\nserver.\n\nThis table summarizes some of the differences between the behavior of the DarkSide ransomware on Windows and\non Linux:\n\nTable 1. Comparison of DarkSide variants on Windows and Linux\n\n**Windows Variant** **Linux Variant**\n\n\n**Encryption**\n**Mechanism**\n\n**Cipher**\n**Blocks**\n\n\nSalsa20 with RSA-1024 ChaCha20 with RSA-4096\n\n\nSalsa20 matrix is custom and randomly generated using\n**“RtlRandomExW”**\n\n\nChaCha20 initial block is standard, built\nusing “expand 32-byte k” as a\nconstant string\n\n\n**Configuration** Encrypted Not encrypted\n\n\n**Terminates**\n**VMs?**\n\n\nNo Yes\n\n\n**Target Files** All files on the system except the files, folders, and file\nextensions mentioned in the configuration\n\n\nVM-related files on VMware ESXI\nservers, with specific file extensions\nmentioned in the configuration\n\nHard-coded in the embedded\nconfiguration as “.darkside” or passed\nby execution parameters\n\n\n**New**\n**Extension**\n\n\nGenerated by applying CRC32 several times on the\nHWID of the victim machine as “.4731c768”\n\n\n-----\n\n**Ransom Note**\n**File Name**\n\n\nConsists of hard-coded part in the configuration as\n“README.” and the generated ID mentioned\npreviously: for example, “README. 4731c768.TXT”\n\n\nHard-coded in the embedded\nconfiguration as\n**“darkside_readme.txt” or passed by**\nexecution parameters\n\n\nAnalysis of the Linux Variant\n\n**_Targets_**\n\nAs we noted earlier, DarkSide also has a Linux variant to infect more machines and cause more damage in the victim\nnetwork. However, this variant is quite specific, as its main configuration targets VM-related files on VMware ESXI\nservers as seen in the following figure:\n\nFigure 1. Target file extensions\n**_Configuration_**\n\nUnlike the Windows variant, the Linux variant’s strings and configuration are not obfuscated. The configuration of the\nLinux variant specifies features of the sample, such as the extension for encrypted files, C&C URL, number of\nthreads, and a constraint on a minimum size of the target files to be encrypted.\n\nNote that the root path — the starting point for encryption — in the following figure is “/vmfs/volumes/”, which is the\ndefault location for the VM files on ESXI hosts.\n\nFigure 2.\n\nConfiguration of the Linux variant\nIn addition to the hard-coded configuration, the ransomware executable can accept parameters to infect more files\nand change its default settings. Figure 3 shows where the malware parses execution parameters.\n\n\n-----\n\nFigure 3.\n\nLinux variant parameter parsing\n**_ESXCLI Commands_**\n\nDarkSide runs several ESXCLI commands (such as the command- line interface framework in vSphere) in order to\ncollect information about the infected ESXI host, such as the running virtual machinesVMs, storage- related\ninformation, and vSAN- related information.\n\nTable 2 shows a list of ESXCLI commands run by DarkSide on the victim machine.\n\nTable 2. ESXCLI Commands\n\n**Commands** **Desription**\n\n\n**esxcli --formatter=csv --format-**\n**param=fields==\"Device,DevfsPath” storage core device list**\n\n\nList the Devfs Path of the devices currently\nregistered with the storage\n\n\n**esxcli --formatter=csv storage filesystem list** List the logical sections of storage currently\nconnected to the ESXI host\n\n\n**esxcli --format-param=fields==\"WorldID,DisplayName” vm**\n**process list**\n\n\nList the running VMs on the ESXI host\n\n\n**esxcli vsan debug vmdk list** List the status of VMDKs in vSAN\n\n\n**esxcli --format-**\n**param=fields==\"Type,ObjectUUID,Configuration” vsan**\n**debug object list**\n\n\nList the UUID of the vSAN objects\n\n\nFigure 4 shows how the DarkSide ransomware lists the running virtual machines on the ESXI.\n\nFigure 4. Listing running VMs\n**_Killing Virtual Machines_**\n\nBefore encryption, the Linux variant of the DarkSide ransomware can power off running VMs on the ESXI server\nusing the following ESXI command:\n\n**“esxcli vm process kill** **type= force** **world id= <WorldNumber>”**\n\n\n-----\n\nFigure 5. Terminating\n\nrunning VMs\n\nFigure 6. Reporting on VM killing status\n**_Encryption_**\n\n[The Linux variant of the DarkSide ransomware uses a ChaCha20 stream cipher with RSA-4096 to encrypt targeted](https://cr.yp.to/chacha.html)\nfiles on the victim machine.\n\nIt loops across the files on the root path mentioned in the embedded configuration or in the given parameter, as\nshown in Figure 7.\n\nFigure 7. Linux variant looping across files/directories\n\n\n-----\n\nBefore encryption, the ransomware performs a file size check to make sure that this is more than the minimum file\nsize given in the embedded configuration or in the parameters.\n\nFigure 8. Linux variant performing a file size check\nThe malware then opens the target file, reads the content based on the part and space size given in the configuration\nor in the parameters, encrypts them, and writes to the file as shown in the following code:\n\nFigure 9. File encryption\nUnlike the Windows variant that randomly generates its custom Salsa20 matrix by calling “RtlRandomExW” several\ntimes, the malware uses the standard constant \"expand 32-byte k\" in the Chacha20 cipher used to encrypt files on\nthe victim machine, as shown in the next figure.\n\n\n-----\n\nFigure 10. Using\n\n\"expand 32-byte k” as a constant in the Chacha20 cipher\nAfter encryption, the malware then adds a header and a cipher at the end of the encrypted files as shown in Figure\n11.\n\nFigure 11. Adding code to header\n\n\n-----\n\nFigure 12. Hex view of the encrypted file\nThe ransomware output console shows the results of the encryption, the encrypted filenames, the discarded files after\nsize check, the time of encryption, and more.\n\nFigure 13.\n\nRansomware output console\n**_Ransom note and added extensions_**\n\nThe Linux variant drops a ransom note on the victim machine and adds a new file extension to the encrypted files.\n\nUnlike the Windows variant, the ransom note file name and the new extension for encrypted files are hard-coded in\nthe malware configuration file or given in a parameter, and the malware does not add any ID at the end of it.\n\nFor the analyzed samples, the new extension was “.darkside” andthe hard-coded ransom note file name was\n**“darkside_readme.txt”.**\n\n\n-----\n\nFigure 14. Encrypted\n\nfolder with ransom note\n**_C&C Beaconing_**\n\nThe DarkSide ransomware can send a C&C beaconing message with the collected system information to a remote\nserver hardcoded in the configuration. It collects system information on the victim machine, such as host name,\ndomain, and disk information, as evidenced in Figure 15.\n\nFigure 15. System information collection\nThe ransomware then puts the collected system information of the victim machine with a hard-coded UID value in the\nfollowing format:\n\n\n-----\n\nFigure 16. System information format\nIt hashes the collected information before sending it to the URL mentioned in the embedded configuration of the\nsample. DarkSide also uses a random parameter of eight characters in the request body to make its C&C traffic more\ndifficult to detect by IPS/IDS devices on the victim network. The request body has the following format:\n\n**<Random 8-character variable> = <Encrypted collected information> & <Random 8-character variable> =**\n**<hardcoded UID>**\n\nFigure 17 shows the HTTP POST request sent by the malware to the remote server with the collected information.\n\n\n-----\n\nFigure\n\n17. C2 beaconing HTTP traffic\nConclusion\n\nThe DarkSide ransomware family targets both Windows and Linux platforms. There are similarities between the Linux\nand Windows variants, but they are different with regard to some features, such as encryption mechanism, target\nfiles, ransom note name, extension, C&C URL, and more.\n\nThe Linux variant uses a ChaCha20 stream cipher with RSA-4096 in order to encrypt the files on the victim machine.\nIt mainly targets VM-related files on VMWare ESXI servers, such as VMDK files. It can also accept parameters to\ninfect more files on the victim machine. Additionally, the DarkSide ransomware runs ESXCLI commands to get vSAN\nand storage information on the victim machine. It also lists and kills running VMs on the infected ESXI host before\nencryption. Lastly, it drops a ransom note on the encrypted directories on the victim machine.\n\nIndicators of Compromise\n\n**C&C servers:**\n\ncatsdegree[.]com\nsecurebestapp20[.]com\ntemisleyes[.]com\n\n**SHA256** **Trend Micro Detection Name**\n\n984ce69083f2865ce90b48569291982e786980aeef83345953276adfcbbeece8 Ransom.Linux.DARKSIDE.THDBGBA\n\n9cc3c217e3790f3247a0c0d3d18d6917701571a8526159e942d0fffb848acffb\n\nc93e6237abf041bc2530ccb510dd016ef1cc6847d43bf023351dce2a96fdc33b\n\n\n-----\n\nda3bb9669fb983ad8d2ffc01aab9d56198bd9cedf2cc4387f19f4604a070a9b5\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-28 - DarkSide on Linux- Virtual Machines Targeted.pdf"
    ],
    "report_names": [
        "2021-05-28 - DarkSide on Linux- Virtual Machines Targeted.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536133,
    "ts_updated_at": 1743041173,
    "ts_creation_date": 1653756626,
    "ts_modification_date": 1653756626,
    "files": {
        "pdf": "https://archive.orkl.eu/735c210045387de60d6a7ef2f1a1eab51bd53964.pdf",
        "text": "https://archive.orkl.eu/735c210045387de60d6a7ef2f1a1eab51bd53964.txt",
        "img": "https://archive.orkl.eu/735c210045387de60d6a7ef2f1a1eab51bd53964.jpg"
    }
}