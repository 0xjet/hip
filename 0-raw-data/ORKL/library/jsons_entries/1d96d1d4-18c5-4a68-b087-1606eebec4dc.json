{
    "id": "1d96d1d4-18c5-4a68-b087-1606eebec4dc",
    "created_at": "2023-01-12T15:00:23.265252Z",
    "updated_at": "2025-03-27T02:16:20.907733Z",
    "deleted_at": null,
    "sha1_hash": "b010c78d9bc3cf1f418f90f1f1fb7fbbc5da43f5",
    "title": "2020-09-01 - An Exhaustively-Analyzed IDB for ComRAT v4",
    "authors": "",
    "file_creation_date": "2022-05-28T18:26:53Z",
    "file_modification_date": "2022-05-28T18:26:53Z",
    "file_size": 306322,
    "plain_text": "# An Exhaustively-Analyzed IDB for ComRAT v4\n\n**[msreverseengineering.com/blog/2020/8/31/an-exhaustively-analyzed-idb-for-comrat-v4](https://www.msreverseengineering.com/blog/2020/8/31/an-exhaustively-analyzed-idb-for-comrat-v4)**\n\nSeptember 1, 2020 [Rolf Rolles](http://10.10.0.46/blog?author=5111cf9ee4b0a36262da10df)\n\n\nSeptember 1, 2020\n\n\nThis blog entry announces the release of an exhaustive analysis of ComRAT v4. You can\nfind the IDBs here.\n\nMore specifically, an IDB for the sample with hash\n0139818441431C72A1935E7F740A1CC458A63452, which was mentioned in the ESET\n[report (see especially its attached PDF), and which is available online on Hybrid Analysis.](https://www.welivesecurity.com/wp-content/uploads/2020/05/ESET_Turla_ComRAT.pdf)\nAll of the analysis has been performed in Hex-Rays 64-bit, so the results will be less\ninteresting to IDA users who do not own Hex-Rays 64-bit. That is to say, if you open the\nIDB, you should definitely use Hex-Rays to view the function decompilations, as that is\nwhere all of the naming and commenting has taken place. It is rich with detail, in\ncomparison to the disassembly listing's barrenness.\n\nThis analysis took roughly six weeks of full-time work. I have spent the pandemic working\non a new training class on C++ reverse engineering; part of the preparation includes largescale analysis of C++ programs. As such, ESET's report of ComRAT's use of C++ caught\nmy eye. ComRAT has a beautiful architecture, and many sophisticated components, all of\nwhich I believe deserve a detailed report unto themselves. I had begun writing such a\nreport, but decided that it was side-tracking me from my ultimate goals with my new training\nclass. Hence, I had decided to wait until the class was ready, and release a collection of\nreports on the software architectures of C++ malware families (perhaps as a book) after I\nwas done. Thus, my write-up on ComRAT's architecture will have to wait. You can consider\nthis release, instead, as a supplement to the ESET report.\n\n(Note that if you are interested in the forthcoming C++ training class, it probably will not be\navailable for roughly another year. More generally, remote public classes (where individual\nstudents can sign up) are temporarily suspended; remote private classes (multiple students\non behalf of the same organization) are currently available. If you would like to be notified\nwhen public classes become available, or when the C++ course is ready, please sign up on\nour [no-spam, very low-volume, course notification mailing list. (Click the button that says](http://10.10.0.46/training-classes)\n\"Provide your email to be notified of public course availability\".) )\n\n(Note also that I have more analyses like this waiting to be released. FlawedGrace and\nXAgent are ready; Kelihos is in progress. If you can provide me with a bundle of Careto\nSGH samples, preferably Windows 64-bit, please get in touch.)\n\n\n-----\n\n## About the Analysis\n\nThis analysis was conducted purely statically, without access to RTTI, or any other form of\ndebug information. The only external information I had was the ESET report. I have reverse\nengineered every function in the binary that is not part of the C++ standard library, and\nsome of those that are. To get an idea of what the sample looks like before and after\nanalysis, here's a screenshot of the binary freshly loaded into IDA on the left, versus the\nanalyzed one on the right. See if you can spot the difference:\n\nAlthough I believe that the IDB could probably be loaded in versions of IDA prior to 7.5, I\nnevertheless recommend using IDA 7.5 to view it. The reason for that is because I have\nmade extensive use of 7.5's new \"folders\" feature to organize the functions and local types\nwindows, which I found massively useful for large-scale reverse engineering. Those two\nwindows have a nearly identical organization; if you were to dock the windows side-by-side,\nyou would see something like this:\n\n\n-----\n\nAs a result of this analysis, I wrote many Hex-Rays plugins, and devised a number of\ntechniques in C++ reverse engineering that were new to me. Eventually, I will publish on\ntopics such as the following:\n\nA Hex-Rays plugin for navigating virtual function cross-references\n\nReverse engineering STL containers, the easy way\n\nA Hex-Rays plugin for virtual inheritance\n\nTips for reverse engineering multiple inheritance\n\nAutomated creation of VTable structure types\n\nAutomation for detecting inlined functions, and the addition of stock comments\n\nComRAT uses a lot of C++ features; a mostly complete list follows. If you're interested in\nlearning how to reverse engineer C++ programs, you might do well to study how I analyzed\nthe parts of the binary that interact with them.\n\nInheritance\n\nPolymorphism (virtual functions)\n\nCustom templates\n\nMultiple and virtual inheritance (due to iostreams)\n\n\n-----\n\nSTL, listed in descending order of usage frequency:\n\nshared_ptr<T>\n\nvector<T>\n\nstring\n\nwstring\n\nlocale\n\nunique_ptr<T>\n\nwstringstream\n\nstringstream\n\nfstream\n\nlist<T>\n\nmap<K,V>\n\nregex\n\nwstring_convert\n\nrandom\n\n## Notes on the Sample\n\n1. Although the use of Gmail as a covert channel was a major aspect of the ESET\n\nreport, I could not get my hands on any samples that had that feature. However, this\nsample does contain some of the Gmail communication code -- the Gumbo library is\ncompiled into it, and the configuration in the virtual file system contains a \"mail\"\nsubdirectory, with similar entries to those in the ESET report. Perhaps that feature was\nstill in development, or was deliberately not compiled into my sample for whatever\nreason.\n\n2. One striking feature of the ESET report was that their sample had RTTI information\n\ncompiled into it, which provided the names of many of the classes used within\nComRAT. I.e., section 4.3 of the ESET report mentions specific class names, as\ncreated by the ComRAT programmers. However, my sample had no such RTTI\ninformation. Therefore, all of my analysis had to be done from scratch. I used the few\nnames provided in the report as a guide when creating my own.\n\n\n-----\n\n3. To the extent I was able to verify their claims, everything in the ESET report is\n\naccurate. There are a few minor technical details in my sample that were different, but\nare barely worth mentioning, and might have legitimately changed between the\ncreation of my sample and the non-public one they analyzed.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-09-01 - An Exhaustively-Analyzed IDB for ComRAT v4.pdf"
    ],
    "report_names": [
        "2020-09-01 - An Exhaustively-Analyzed IDB for ComRAT v4.pdf"
    ],
    "threat_actors": [
        {
            "id": "67bf0462-41a3-4da5-b876-187e9ef7c375",
            "created_at": "2022-10-25T16:07:23.44832Z",
            "updated_at": "2025-03-27T02:02:09.806007Z",
            "deleted_at": null,
            "main_name": "Careto",
            "aliases": [
                "Careto",
                "The Mask",
                "Ugly Face"
            ],
            "source_name": "ETDA:Careto",
            "tools": [
                "Careto"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f5bf6853-3f6e-452c-a7b7-8f81c9a27476",
            "created_at": "2023-01-06T13:46:38.677391Z",
            "updated_at": "2025-03-27T02:00:02.889755Z",
            "deleted_at": null,
            "main_name": "Careto",
            "aliases": [
                "The Mask",
                "Ugly Face"
            ],
            "source_name": "MISPGALAXY:Careto",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a97cf06d-c2e2-4771-99a2-c9dee0d6a0ac",
            "created_at": "2022-10-25T16:07:24.349252Z",
            "updated_at": "2025-03-27T02:02:10.184406Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "ATK 13",
                "Belugasturgeon",
                "Blue Python",
                "CTG-8875",
                "Group 88",
                "ITG12",
                "Iron Hunter",
                "Krypton",
                "Makersmark",
                "Operation Epic Turla",
                "Operation Moonlight Maze",
                "Operation Penguin Turla",
                "Operation Satellite Turla",
                "Operation Skipper Turla",
                "Operation Turla Mosquito",
                "Operation WITCHCOVEN",
                "Pacifier APT",
                "Pensive Ursa",
                "Popeye",
                "SIG15",
                "SIG2",
                "SIG23",
                "Secret Blizzard",
                "TAG-0530",
                "Turla",
                "UNC4210",
                "Venomous Bear",
                "Waterbug"
            ],
            "source_name": "ETDA:Turla",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "ATI-Agent",
                "AdobeARM",
                "Agent.BTZ",
                "Agent.DNE",
                "BigBoss",
                "COMpfun",
                "Chinch",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobra Carbon System",
                "ComRAT",
                "DoublePulsar",
                "EmPyre",
                "EmpireProject",
                "Epic Turla",
                "EternalBlue",
                "EternalRomance",
                "GoldenSky",
                "Group Policy Results Tool",
                "HTML5 Encoding",
                "HyperStack",
                "IcedCoffee",
                "IronNetInjector",
                "KSL0T",
                "Kapushka",
                "Kazuar",
                "KopiLuwak",
                "Kotel",
                "LOLBAS",
                "LOLBins",
                "LightNeuron",
                "Living off the Land",
                "Maintools.js",
                "Metasploit",
                "Meterpreter",
                "MiamiBeach",
                "Mimikatz",
                "MiniDionis",
                "Minit",
                "NBTscan",
                "NETTRANS",
                "NETVulture",
                "Neptun",
                "NetFlash",
                "NewPass",
                "Outlook Backdoor",
                "Penquin Turla",
                "Pfinet",
                "PowerShell Empire",
                "PowerShellRunner",
                "PowerShellRunner-based RPC backdoor",
                "PowerStallion",
                "PsExec",
                "PyFlash",
                "QUIETCANARY",
                "Reductor RAT",
                "RocketMan",
                "SMBTouch",
                "SScan",
                "Satellite Turla",
                "SilentMoon",
                "Sun rootkit",
                "TTNG",
                "TadjMakhal",
                "Tavdig",
                "TinyTurla",
                "TinyTurla Next Generation",
                "TinyTurla-NG",
                "Topinambour",
                "Tunnus",
                "Turla",
                "Turla SilentMoon",
                "TurlaChopper",
                "Uroburos",
                "Urouros",
                "WCE",
                "WITCHCOVEN",
                "WhiteAtlas",
                "WhiteBear",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Wipbot",
                "WorldCupSec",
                "XTRANS",
                "certutil",
                "certutil.exe",
                "gpresult",
                "nbtscan",
                "nbtstat",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8aaa5515-92dd-448d-bb20-3a253f4f8854",
            "created_at": "2024-06-19T02:03:08.147099Z",
            "updated_at": "2025-03-27T02:05:17.408118Z",
            "deleted_at": null,
            "main_name": "IRON HUNTER",
            "aliases": [
                "Belugasturgeon ",
                "Blue Python ",
                "CTG-8875 ",
                "ITG12 ",
                "KRYPTON ",
                "MAKERSMARK ",
                "Pensive Ursa ",
                "Secret Blizzard ",
                "Turla",
                "UAC-0003 ",
                "UAC-0024 ",
                "UNC4210 ",
                "Venomous Bear ",
                "Waterbug ",
                "ATK13 "
            ],
            "source_name": "Secureworks:IRON HUNTER",
            "tools": [
                " ComRAT",
                " Kazuar",
                " KopiLuwak",
                " LightNeuron",
                " Mosquito",
                " Nautilus",
                " Neuron",
                " Penquin",
                " PoisonFrog",
                " PyFlash",
                " Skipper",
                " Snake",
                " Tavdig",
                " TinyTurla",
                " Tunnus",
                "Carbon-DLL"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a97fee0d-af4b-4661-ae17-858925438fc4",
            "created_at": "2023-01-06T13:46:38.396415Z",
            "updated_at": "2025-03-27T02:00:02.823045Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Uroburos",
                "Hippo Team",
                "Pacifier APT",
                "MAKERSMARK",
                "ATK13",
                "UAC-0003",
                "IRON HUNTER",
                "Waterbug",
                "TAG_0530",
                "KRYPTON",
                "Popeye",
                "SIG23",
                "UAC-0144",
                "G0010",
                "Blue Python",
                "VENOMOUS Bear",
                "Group 88",
                "Pfinet",
                "ITG12",
                "UNC4210",
                "Secret Blizzard",
                "UAC-0024"
            ],
            "source_name": "MISPGALAXY:Turla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535623,
    "ts_updated_at": 1743041780,
    "ts_creation_date": 1653762413,
    "ts_modification_date": 1653762413,
    "files": {
        "pdf": "https://archive.orkl.eu/b010c78d9bc3cf1f418f90f1f1fb7fbbc5da43f5.pdf",
        "text": "https://archive.orkl.eu/b010c78d9bc3cf1f418f90f1f1fb7fbbc5da43f5.txt",
        "img": "https://archive.orkl.eu/b010c78d9bc3cf1f418f90f1f1fb7fbbc5da43f5.jpg"
    }
}