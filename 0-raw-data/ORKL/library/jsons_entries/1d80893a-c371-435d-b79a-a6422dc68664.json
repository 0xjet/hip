{
    "id": "1d80893a-c371-435d-b79a-a6422dc68664",
    "created_at": "2023-01-12T15:06:46.130398Z",
    "updated_at": "2025-03-27T02:09:20.176881Z",
    "deleted_at": null,
    "sha1_hash": "f885a4422e037a68e9d9ce0eded0f4be21ce4f13",
    "title": "2021-10-27 - Extracting type information from Go binaries",
    "authors": "",
    "file_creation_date": "2022-05-28T04:50:22Z",
    "file_modification_date": "2022-05-28T04:50:22Z",
    "file_size": 265640,
    "plain_text": "# Extracting type information from Go binaries\n\n**[securelist.com/extracting-type-information-from-go-binaries/104715/](https://securelist.com/extracting-type-information-from-go-binaries/104715/)**\n\nAuthors\n\n[Ivan Kwiatkowski](https://securelist.com/author/ivankwiatkowski/)\n\nDuring the 2021 edition of the SAS conference, I had the pleasure of delivering a workshop\nfocused on reverse-engineering Go binaries. The goal of the workshop was to share basic\nknowledge that would allow analysts to immediately start looking into malware written in Go.\nA [YouTube version of the workshop was released around the same time. Of course, the](https://www.youtube.com/watch?v=_cL-OwU9pFQ)\ndrawback of providing entry-level or immediately actionable information is that a few\nsubtleties must be omitted. One particular topic I brushed aside was related to the way that\nGo creates objects.\n\n\n-----\n\nIn this screenshot taken from IDA Pro, we can see a call to the runtime.newobject function,\nwhich receives a structure as an argument (here, in the RDX register, two lines above the\n[call). The malware presented in the workshop (Sunshuttle, from the DarkHalo APT, MD5](https://securelist.com/darkhalo-after-solarwinds-the-tomiris-connection/104311/)\n[5DB340A70CB5D90601516DB89E629E43) is straightforward to the extent that it can be](https://opentip.kaspersky.com/5DB340A70CB5D90601516DB89E629E43/?utm_source=SL&utm_medium=SL&utm_campaign=SL)\nunderstood without paying too much attention to these objects. In the videos, I recommend\nignoring these calls and instead focusing on documented Golang API functions. With the\nhelp of a debugger, it is easy to obtain the arguments and mentally reconstruct the original\nsource code of the application.\nHowever, Go malware following different coding practices could be littered with this kind of\nobjects, to a point where the reverse engineer has no choice but to understand their nature\nto figure out what the code is supposed to do. Unfortunately, the contents of the structure\npassed as an argument to runtime.newobject does not immediately appear to contain useful\ninformation:\n\n[To find out more about this structure, we need to have a look at the Go source code to find](https://github.com/golang/go/blob/fad4a16fd43f6a72b6917eff656be27522809074/src/reflect/type.go#L317)\nthe definition for the rtype structure. At the time of writing, its definition for the latest version\nof Go is as shown below.\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n\ntype rtype struct {\n\nsize    uintptr\n\nptrdata  uintptr // number of bytes in the type that can contain pointers\n\nhash    uint32 // hash of type; avoids computation in hash tables\n\ntflag   tflag  // extra type information flags\n\nalign   uint8  // alignment of variable with this type\n\nfieldAlign uint8  // alignment of struct field with this type\n\nkind    uint8  // enumeration for C\n\n// function for comparing objects of this type\n\n// (ptr to object A, ptr to object B) -> ==?\n\nequal   func(unsafe.Pointer, unsafe.Pointer) bool\n\ngcdata  *byte  // garbage collection data\n\nstr    nameOff // string form\n\nptrToThis typeOff // type for pointer to this type, may be zero\n\n}\n\n\nThere are two fields in this structure that are relevant to us. The first one is “kind”, which is\n[an enum (defined in the same file) representing a sort of base type for the object: Boolean,](https://github.com/golang/go/blob/fad4a16fd43f6a72b6917eff656be27522809074/src/reflect/type.go#L241)\nintegers of various lengths, but also arrays, maps, interfaces, etc. The other is “nameOff”,\nwhich is a pointer to a string representation of the described type for the purposes of\n[reflection. The latter is extremely useful to reverse engineers, as it immediately tells us what](https://golangbot.com/reflection/)\n[the object is. This structure can itself be contained in specialized ones for interfaces,](https://github.com/golang/go/blob/fad4a16fd43f6a72b6917eff656be27522809074/src/runtime/type.go#L342) [maps,](https://github.com/golang/go/blob/fad4a16fd43f6a72b6917eff656be27522809074/src/runtime/type.go#L348)\nand so on.\n\nAlas, the result of creating these structures in IDA Pro and applying the correct one to the\nnewobject argument is somewhat underwhelming:\n\n\n-----\n\nWhere is our human-readable name? It turns out that the offset provided by nameOff is\nrelative to the .rdata section of the PE in the case of Windows programs – this is something\nyou can confirm with a hex editor.\n\nThe offset leads us to another structure, which contains some information about the string,\nincluding its size, and finally, the string itself. Initially, the size of the string had a [fixed length](https://github.com/golang/go/blob/release-branch.go1.16/src/reflect/type.go#L443)\n[(2 bytes), but that appears to have changed in Go 1.17 (now varint-encoded). Nonetheless,](https://github.com/golang/go/blob/8c99421f01aca303240a8f809bc65fa0c56db861/src/reflect/type.go#L455)\nthe coveted information lies here: the object instantiated in our original newobject call was an\nmd5.digest, which we can now look up in the documentation if needed.\n\nGo programs may contain hundreds of these calls, and newobject is not the only function\nthat relies on these rtype structures (i.e. runtime.makechan, runtime.makemap, etc.), so it is\nobviously impractical to manually look up each type using a hex editor. Enter IDA scripting! It\nis, in fact, possible to entirely automate this operation by writing a few lines of Python.\n\nThe script I use in my daily work has been included in SentinelOne’s recently released\n[AlphaGoLang repository, as](https://github.com/sentinelabs/alphagolang) [step 5 of the process. It performs the following actions:](https://github.com/SentineLabs/AlphaGolang/blob/main/5.extract_types.py)\n\nInspect all the calls to functions, such as newobject, and look at their arguments to find\nrtype\nApply the structure shown above to those bytes in IDA to make them easier to read.\nLook up the corresponding string representation for the type and add it as a comment\nwherever it is referred to.\n\n\n-----\n\nOne thing the script struggles with a little is figuring out how the string size is encoded, as I\nwas not able to find an easy way of determining the Go version from a Python script (yet).\nShould this cause problems, the many comments should allow you to update the script to fit\nyour use case. If you are new to IDA scripting, I would also recommend that you go have a\nlook at the source code, as it is a great example of the many things you can do with the\nPython API! And if you would like to learn even more on the subject (and more) with detailed\n[video tutorials, please consider signing up for our online reverse-engineering course on the](https://xtraining.kaspersky.com/courses/targeted-malware-reverse-engineering?reseller=gl_xtr-trgt-mlwr_acq_ona_smm__onl_b2b_securelist_post_______&utm_source=securelist&utm_medium=blog&utm_campaign=gl_xtr-trgt-mlwr_az0075&utm_content=link&utm_term=gl_securelist_organic_euysd9zrw6wzq75)\nXtraining platform.\n\nI hope you find the script useful! Feel free to report any bugs or submit fixes and updates on\nGitHub!\n\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[Reverse engineering](https://securelist.com/tag/reverse-engineering/)\n[Security conference](https://securelist.com/tag/security-conference/)\n[Security technology](https://securelist.com/tag/security-technology/)\n\nAuthors\n\n[Ivan Kwiatkowski](https://securelist.com/author/ivankwiatkowski/)\n\nExtracting type information from Go binaries\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-27 - Extracting type information from Go binaries.pdf"
    ],
    "report_names": [
        "2021-10-27 - Extracting type information from Go binaries.pdf"
    ],
    "threat_actors": [
        {
            "id": "493c47f7-b265-4b10-95de-d86af942c543",
            "created_at": "2023-04-27T02:04:45.385041Z",
            "updated_at": "2025-03-27T02:02:10.174137Z",
            "deleted_at": null,
            "main_name": "Tomiris",
            "aliases": [],
            "source_name": "ETDA:Tomiris",
            "tools": [
                "JLOGRAB",
                "JLORAT",
                "Kapushka",
                "KopiLuwak",
                "Meterpreter",
                "QUIETCANARY",
                "RATel",
                "RocketMan",
                "Roopy",
                "Telemiris",
                "Tomiris",
                "Topinambour",
                "Tunnus",
                "Warzone",
                "Warzone RAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "70872c3a-e788-4b55-a7d6-b2df52001ad0",
            "created_at": "2023-01-06T13:46:39.18401Z",
            "updated_at": "2025-03-27T02:00:03.01553Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "DarkHalo",
                "StellarParticle",
                "NOBELIUM",
                "Solar Phoenix",
                "Midnight Blizzard"
            ],
            "source_name": "MISPGALAXY:UNC2452",
            "tools": [
                "SNOWYAMBER",
                "HALFRIG",
                "QUARTERRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1d3f9dec-b033-48a5-8b1e-f67a29429e89",
            "created_at": "2022-10-25T15:50:23.739197Z",
            "updated_at": "2025-03-27T02:00:55.536417Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "UNC2452",
                "NOBELIUM",
                "StellarParticle",
                "Dark Halo"
            ],
            "source_name": "MITRE:UNC2452",
            "tools": [
                "Sibot",
                "Mimikatz",
                "Cobalt Strike",
                "AdFind",
                "GoldMax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536006,
    "ts_updated_at": 1743041360,
    "ts_creation_date": 1653713422,
    "ts_modification_date": 1653713422,
    "files": {
        "pdf": "https://archive.orkl.eu/f885a4422e037a68e9d9ce0eded0f4be21ce4f13.pdf",
        "text": "https://archive.orkl.eu/f885a4422e037a68e9d9ce0eded0f4be21ce4f13.txt",
        "img": "https://archive.orkl.eu/f885a4422e037a68e9d9ce0eded0f4be21ce4f13.jpg"
    }
}