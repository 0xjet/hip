{
    "id": "f8d1f558-e5fa-45fb-87e8-e802cfb3b4e1",
    "created_at": "2023-01-12T15:02:55.952769Z",
    "updated_at": "2025-03-27T02:16:50.835159Z",
    "deleted_at": null,
    "sha1_hash": "93a8dfaeb9ecfd573f98104f087342efeee2e37b",
    "title": "2020-01-02 - The Curious Case of DeathRansom- Part I",
    "authors": "",
    "file_creation_date": "2022-05-28T23:50:24Z",
    "file_modification_date": "2022-05-28T23:50:24Z",
    "file_size": 332908,
    "plain_text": "# The Curious Case of DeathRansom: Part I\n\n**[fortinet.com/blog/threat-research/death-ransom-new-strain-ransomware.html](https://www.fortinet.com/blog/threat-research/death-ransom-new-strain-ransomware.html)**\n\n**_A FortiGuard Labs Threat Analysis Report_**\n\n## Introduction\n\n\nJanuary 2, 2020\n\n\n[Ransomware is certainly a significant global threat. According to one recent report, ransomware is](https://safeatlast.co/blog/ransomware-statistics/#gref)\nestimated to have cost businesses more than $8 billion in 2018, up from just $1 billion in 2016,\nwhile this year alone losses for the healthcare industry have already reached $25 billion.\n\nPart of this increase is due to the rise of Ransomware as a Service, with variants such as\nGandCrab generating as much as $2 billion in revenue for its developers, and our observation in\nthe [FortiGuard Labs Threat Landscape Report for Q3 that two additional ransomware families –](https://www.fortinet.com/blog/threat-research/fortinet-q3-threat-landscape-report.html)\nSodinokibi and Nemty – have now been deployed as RaaS solutions as well. Another part of the\nreason for this growth is that cybercriminals continue to develop new ransomware variants. This\ndramatic escalation of ransomware over the past few years is part of the reason why we here at\nFortiGuard Labs [keep such close track of it.](https://www.fortinet.com/blog/threat-research/looking-into-anatova-ransomware.html)\n\nAnd recently, our threat radar detected a new ransomware variant that we break down for you in\nthis threat analysis, ominously called DeathRansom. In this analysis, we will first be looking at a\nversion with a SHA256 sample of:\n\n7C2DBAD516D18D2C1C21ECC5792BC232F7B34DADC1BC19E967190D79174131D1\n\nSubsequent samples exhibit slightly different behaviors, as we describe later in our analysis.\n\n\n-----\n\nFigure 1. TimeDateStamp of the sample\n\nAs you can see, the TimeDateStamp of this sample is very new (Sat Nov 16 08:37:02 2019), so\nnaturally, we decided to dig deeper and learn more.\n\n## The Workflow of the DeathRansom Ransomware\n\nAt a high level, this ransomware follows a sensible design: it scans and encrypts files on local and\nnetwork drives.\n\nFigure 2. start()\n\nIt’s clear that right off the bat (in start() ), that DeathRansom gets right to the business of being a\nransomware: by enumerating and encrypting files. To enumerate network resources, the malware\nuses standard Windows APIs (WNetOpenEnumW, WNetEnumResourceW etc.)\n\nFigure 3. Recursively Scanning Network Resources\n\nInside this function (processNetwork), it recursively scans network resources until it hits a normal\ndirectory, at which point it processes it like a directory (processDir).\n\nFigure 4. processDir()\n\nJust like processNetwork, **processDir is also recursive. The difference is that it needs to**\nperform some sanity checks to make sure that the item is indeed a folder (but not “.” or “..”), and\nfurther, that the item is not excluded (see exclusion2, below).\n\nFigure 5. Exclusions\n\nWe can see here that the malware author has made a number of reasonable choices, including:\n\nExcluding important Windows folders (Program Files, Windows, etc) to avoid rendering the\nsystem unusable\nWhen it comes to files, similar checks also occur.\nDeathRansom also avoids “encrypting” the systems files (ntuser.dat, etc)\n\nCertainly, this list is not comprehensive, but it does show that the author does have some skills\nand knowledge about system programming.\n\nFigure 6. “Encrypting” Files\n\nAn astute reader may have noticed that DeathRansom does not really encrypt file content. In this\ncase, victims only have to rename the affected files (hint: remove the extension) to restore the\nsystem back to normal.\n\nFigure 7. Ransom Note\n\n\n-----\n\nIn spite of this, like almost all ransomware, DeathRansom still displays a ransom note called\nread_me.txt. In that note one can see clearly that the author calls the malware DEATHRANSOM.\nThe email also informs its victims that they need to contact the culprits at death@cxxxxxxver.me\nand death@fxxxxxxx.cc\n\n## Other Interesting Technical Details\n\nWhen the malware launches, but before it begins “encoding” files, it performs some interesting\nchecks about the languages used in the victim’s system.\n\nFigure 8. Language Checks\n\n[We can use LangID to look up the names of these language from the authoritative source at](https://docs.microsoft.com/en-us/windows/win32/intl/language-identifier-constants-and-strings)\nMicrosoft.\n\nFigure 9. Language Identifier Constants and Strings\n\nInterestingly, DeathRansom checks not just for one language but several languages, but we can\nstill see a clear pattern: it avoids infecting systems in Eastern European countries.\n\nWe also managed to extract some interesting information from an undocumented header\n(specifically, the [Rich Signature):](https://www.ntcore.com/files/richsign.htm)\n\nFigure 10. Rich Signature\n\nBased on this information, we were able to figure out the product used to make this malware.\nNotice the following extra marks used in the descriptions:\n\n+ [ C ] - object files produced by C compiler\n\n+ [IMP] - DLL import record in library file\n\n+ [LNK] - files produced by a linker\n\nproduct id: 0x0083 = MSVS2008 [ C ]\n\nproduct id: 0x0004 = MSVS6 [LNK]\n\nproduct id: 0x000E = ?\n\nproduct id: 0x0093 = MSVS2008 [IMP]\n\nproduct id: 0x0001 Objects without @comp.id\n\nproduct id: 0x0109 = ?\n\nproduct id: 0x0102 = VS 2019 / 2017 / 2015 [LNK]\n\nIt’s interesting that a product from 1998 (e.g. MSVS6) is still being used to make malware.\n\n\n-----\n\n## New Version Encrypts Files\n\nRecently, we found a new version of DeathRansom, and the primary change is that the malware\nnow actually encrypts files. Our analysis is focused on a sample with the SHA256 hash of:\n\n_ab828f0e0555f88e3005387cb523f221a1933bbd7db4f05902a1e5cc289e7ba4._\n\nThe new version of this ransomware uses a combination of Curve25519 algorithm for the Elliptic\nCurve Diffie-Hellman (ECDH) key exchange scheme, Salsa20, RSA-2048, AES-256 ECB, and a\nsimple block XOR algorithm to encrypt files.\n\nFigure 11. Key generation and file encryption\n\n**Diffie-Hellman Key Exchange**\n\n[1. A random 32-byte value is generated using advapi32.SystemFunction036 (the same as](https://docs.microsoft.com/en-us/windows/win32/api/ntsecapi/nf-ntsecapi-rtlgenrandom)\nRtlGenRandom). This serves as the victim’s curve25519 private key to the ECDH key exchange.\n\n[2. Using the Curve25519 algorithm, the victim’s Curve25519 public key is derived from the](https://cr.yp.to/ecdh.html)\nvictim’s Curve25519 private key. This is the main information needed by the attacker to eventually\ndecrypt the victim’s files. This is included in the registry “HKCU\\Software\\Wacatac\\private” as\nshown below.\nFigure 12. Added Registries\n\n3. Using the Curve25519 algorithm, a shared secret key is derived from a 32-byte hardcoded\nvalue (the attacker’s Curve25519 public key) and the previously generated victim’s Curve25519\nprivate key described in step 1.\n\n4. The SHA256 hash of the shared secret key is computed, which will be used later on.\n\n**RSA Key Pair Generation**\n\n5. An RSA-2048 key pair is generated\n\n6. The RSA-2048 private key is encrypted using Salsa20, with the secret key’s SHA256 hash\n(from step 4, above) and then included in the registry file “HKCU\\Software\\Wacatac\\private” (see\nFig 12).\n\n7. The RSA-2048 public key is written in the registry file “HKCU\\Software\\Wacatac\\public” (see\nFig 12).\n\n**File Encryption**\n\n8. A random 32-byte value is generated using the advapi32.SystemFunction036, which is used as\nthe AES-256 key. This is done for every file.\n\n9. A 16-byte hardcoded value is encrypted with AES-256 ECB, using the previously generated\nrandom value as the AES-256 key.\n\n\n-----\n\n10. The result from step 9 is the used as the key to a 16-byte block XOR operation with the\ncontent of the targeted file.\n\n11. Repeat steps 9 and 10 while incrementing the hard-coded value by 1 on each loop until it\nencrypts the whole file or until it encrypts 4 kilobytes (4096 bytes).\n\n12. The AES key (from step 8) is encrypted using the victim’s RSA-2048 public key (generated in\nstep 5)\n\n13. The encrypted AES key and the marker 0xABEFCDAB, is then appended to the encrypted\nfile.\n\nFigure 13. Encrypted file format\n\nUltimately, for the victim files to be decrypted the shared secret must be generated. And for that,\nat least one of the following pairs is needed:\n\nThe victim’s curve25519 public key (which can be obtained from registry or ransom note)\nand the attacker’s curve25519 private key (possessed by attacker)\nThe attacker’s curve25519 public key (embedded in the binary) and the victim’s curve25519\nprivate key (lost after the malware’s execution)\n\n_NOTE: Further investigation of this ransomware’s encryption behavior in underway to check for_\n_any implementation flaws. We will be releasing updates for any new findings._\n\nAfter encryption, it drops a ransom note in every directory. It includes a LOCK-ID that is unique for\nevery user. This is the same data that can be found in the “HKCU\\Software\\Wacatac\\private”\nregistry and encoded in base64.\n\nFigure 14. New Ransom Note\n\nAside from a connection to hxxps://iplogger[.]org/1Zqq77 to get the victim’s public IP address, the\nransomware does not have any other network communication. However, as we discussed in the\nprevious section, to generate the shared secret key needed to decrypt the files the attacker must\nobtain the victim’s curve25519 public key. This is why the instruction to the victim in the ransom\nnote is for them to send the LOCK-ID through email.\n\n## Solution\n\nInternal testing by FortiGuard Labs shows that all networks and devices being protected by\nFortiGate solutions running the latest updates were automatically protected from this malware. In\naddition:\n\nThe FortiGuard Web Filtering service blocks hxxps://iplogger[.]org/1Zqq77\n\nThe FortiGuard Antivirus service detects the SHA 256 samples used in this analysis as the\nfollowing:\n\n\n-----\n\n7C2DBAD516D18D2C1C21ECC5792BC232F7B34DADC1BC19E967190D79174131D1\n\n- This is detected as W32/Filecoder.B!tr.ransom\n\n13D263FB19D866BB929F45677A9DCBB683DF5E1FA2E1B856FDE905629366C5E1\n\nAB828F0E0555F88E3005387CB523F221A1933BBD7DB4F05902A1E5CC289E7BA4\n\n- These are detected as W32/Kryptik.ANT!tr\n\n_[Finally, as part of our membership in the Cyber Threat Alliance, details of this threat were shared](https://www.cyberthreatalliance.org/)_\n_in real time with other Alliance members to help create better protections for customers._\n\n## Conclusion\n\nDeathRansom is a new malware. Naturally, things are moving fast. In our experience, a malware\nauthor changes the malware often over time to improve features or to avoid detection. In fact,\nafter our intital assessment of the first version of DeathRansom we noticed a short article\ndescribing how DeathRansom had begun encrypting files, making them inaccessible. Our\nresearch confirmed that, indeed, the malware author has addressed the missing part of the initial\nrelease and DeathRansom has now become a “proper” ransomware.\n\nIn our [follow-up analysis we try to shed light on how DeathRansom can be associated with other](https://www.fortinet.com/blog/threat-research/death-ransom-attribution.html)\nattacks, and who may be behind the creation of this malicious program. Continue reading to learn\n[more in DeathRansom Part II: Attribution.](https://www.fortinet.com/blog/threat-research/death-ransom-attribution.html)\n\n_The author would like to thank Artem Semenchenko, Rommel Joven and Joie Salvio for additional_\n_insights during the research process._\n\n## IOCs\n\nSamples:\n\n7C2DBAD516D18D2C1C21ECC5792BC232F7B34DADC1BC19E967190D79174131D1\n\n13D263FB19D866BB929F45677A9DCBB683DF5E1FA2E1B856FDE905629366C5E1\n\nAB828F0E0555F88E3005387CB523F221A1933BBD7DB4F05902A1E5CC289E7BA4\n\nNetwork:\n\n_hxxps://iplogger[.]org/1Zqq77_\n\n_[Learn more about how FortiGuard Labs provides unmatched security and intelligence services](https://www.fortinet.com/fortiguard/threat-intelligence/threat-research.html?utm_source=nreleaseblog&utm_campaign=2018-q2-fortiguardlabs-cta)_\n_[using integrated AI systems. Find out about the FortiGuard Security Services portfolio and sign](https://twitter.com/hashtag/AI?src=hashtag_click)_\n_up for our weekly FortiGuard Threat Brief._\n\n\n-----\n\n_[Read about the FortiGuard Security Rating Service, which provides security audits and best](https://www.fortinet.com/support-and-training/support-services/fortiguard-security-subscriptions/security-rating.html?utm_source=blog&utm_campaign=2018-blog-security-rating-service)_\n_practices to guide customers in designing, implementing, and maintaining the security posture_\n_best suited for their organization._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-02 - The Curious Case of DeathRansom- Part I.pdf"
    ],
    "report_names": [
        "2020-01-02 - The Curious Case of DeathRansom- Part I.pdf"
    ],
    "threat_actors": [
        {
            "id": "fdf8d396-bbe4-454c-970a-81c4c3093b27",
            "created_at": "2022-10-25T16:07:23.763387Z",
            "updated_at": "2025-03-27T02:02:09.970069Z",
            "deleted_at": null,
            "main_name": "BeagleBoyz",
            "aliases": [
                "BeagleBoyz",
                "Operation FASTCash"
            ],
            "source_name": "ETDA:BeagleBoyz",
            "tools": [
                "Cyruslish",
                "ECCENTRICBANDWAGON",
                "FASTCash",
                "NACHOCHEESE",
                "NachoCheese",
                "PSLogger",
                "TWOPENCE",
                "VIVACIOUSGIFT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "adfbe698-24b2-41fc-a701-781fef330b16",
            "created_at": "2024-01-09T02:00:04.17648Z",
            "updated_at": "2025-03-27T02:00:03.274931Z",
            "deleted_at": null,
            "main_name": "GREF",
            "aliases": [],
            "source_name": "MISPGALAXY:GREF",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "0a03e7f0-2f75-4153-9c4f-c46d12d3962e",
            "created_at": "2022-10-25T15:50:23.453824Z",
            "updated_at": "2025-03-27T02:00:55.473216Z",
            "deleted_at": null,
            "main_name": "Ke3chang",
            "aliases": [
                "Ke3chang",
                "APT15",
                "Vixen Panda",
                "GREF",
                "Playful Dragon",
                "RoyalAPT",
                "Nylon Typhoon"
            ],
            "source_name": "MITRE:Ke3chang",
            "tools": [
                "Okrum",
                "Systeminfo",
                "netstat",
                "spwebmember",
                "Mimikatz",
                "Tasklist",
                "MirageFox",
                "Neoichor",
                "ipconfig"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f426f0a0-faef-4c0e-bcf8-88974116c9d0",
            "created_at": "2022-10-25T15:50:23.240383Z",
            "updated_at": "2025-03-27T02:00:55.404232Z",
            "deleted_at": null,
            "main_name": "APT38",
            "aliases": [
                "APT38",
                "NICKEL GLADSTONE",
                "BeagleBoyz",
                "Bluenoroff",
                "Stardust Chollima",
                "Sapphire Sleet",
                "COPERNICIUM"
            ],
            "source_name": "MITRE:APT38",
            "tools": [
                "ECCENTRICBANDWAGON",
                "HOPLIGHT",
                "Mimikatz",
                "KillDisk",
                "DarkComet"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "679e335a-38a4-4db9-8fdf-a48c17a1f5e6",
            "created_at": "2023-01-06T13:46:38.820429Z",
            "updated_at": "2025-03-27T02:00:02.927526Z",
            "deleted_at": null,
            "main_name": "FASTCash",
            "aliases": [],
            "source_name": "MISPGALAXY:FASTCash",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "17b1b76b-16da-4c4f-8b32-f6fede3eda8c",
            "created_at": "2022-10-25T16:07:23.750796Z",
            "updated_at": "2025-03-27T02:02:09.961401Z",
            "deleted_at": null,
            "main_name": "Ke3chang",
            "aliases": [
                "APT 15",
                "BackdoorDiplomacy",
                "Bronze Davenport",
                "Bronze Idlewood",
                "Bronze Palace",
                "CTG-9246",
                "GREF",
                "Ke3chang",
                "Metushy",
                "Nylon Typhoon",
                "Operation Ke3chang",
                "Operation MirageFox",
                "Playful Dragon",
                "Playful Taurus",
                "Red Vulture",
                "Royal APT",
                "Social Network Team",
                "Vixen Panda"
            ],
            "source_name": "ETDA:Ke3chang",
            "tools": [
                "Agentemis",
                "Anserin",
                "BS2005",
                "BleDoor",
                "CarbonSteal",
                "Cobalt Strike",
                "CobaltStrike",
                "DarthPusher",
                "DoubleAgent",
                "EternalBlue",
                "GoldenEagle",
                "Graphican",
                "HenBox",
                "HighNoon",
                "IRAFAU",
                "Ketrican",
                "Ketrum",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "MS Exchange Tool",
                "Mebroot",
                "Mimikatz",
                "MirageFox",
                "NBTscan",
                "Okrum",
                "PluginPhantom",
                "PortQry",
                "ProcDump",
                "PsList",
                "Quarian",
                "RbDoor",
                "RibDoor",
                "Royal DNS",
                "RoyalCli",
                "RoyalDNS",
                "SAMRID",
                "SMBTouch",
                "SilkBean",
                "Sinowal",
                "SpyWaller",
                "Theola",
                "TidePool",
                "Torpig",
                "Turian",
                "Winnti",
                "XSLCmd",
                "cobeacon",
                "nbtscan",
                "netcat",
                "spwebmember"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535775,
    "ts_updated_at": 1743041810,
    "ts_creation_date": 1653781824,
    "ts_modification_date": 1653781824,
    "files": {
        "pdf": "https://archive.orkl.eu/93a8dfaeb9ecfd573f98104f087342efeee2e37b.pdf",
        "text": "https://archive.orkl.eu/93a8dfaeb9ecfd573f98104f087342efeee2e37b.txt",
        "img": "https://archive.orkl.eu/93a8dfaeb9ecfd573f98104f087342efeee2e37b.jpg"
    }
}