{
    "id": "87057be3-7ddc-45ef-9196-47ee0eabe780",
    "created_at": "2023-01-12T15:04:04.589661Z",
    "updated_at": "2025-03-27T02:09:18.364691Z",
    "deleted_at": null,
    "sha1_hash": "954b52cfe2cb52ac30babea2d233f5901761193c",
    "title": "2021-11-18 - Conti Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T16:13:24Z",
    "file_modification_date": "2022-05-28T16:13:24Z",
    "file_size": 730333,
    "plain_text": "# Conti Ransomware\n\n**blog.qualys.com/vulnerabilities-threat-research/2021/11/18/conti-ransomware**\n\nGhanshyam More November 18, 2021\n\nConti is a sophisticated Ransomware-as-a-Service (RaaS) model first detected in December 2019. Since its inception, its use has grown\nrapidly and has even displaced the use of other RaaS tools like Ryuk. The Cybersecurity and Infrastructure Security Agency (CISA) and the\nFederal Bureau of Investigation (FBI) issued a warning about Conti in Sept 2021, noting that they had observed it being used in more than 400\ncyberattacks globally, though concentrated in North America and Europe.\n\nThe most common initial infection vectors used are spear phishing and RDP (Remote Desktop Protocol) services. Phishing emails work either\nthrough malicious attachments, such as Word documents with an embedded macro that can be used to drop/download BazarLoader, Trickbot,\nIceID trojans, or via social engineering tactics employed to get the victim to provide additional information or access credentials. Following\ninitial access, attackers download and execute a Cobalt Strike beacon DLL to gather information about domain admin accounts. Additionally,\nthreat actors use Kerberos attacks to attempt to get admin hash in order to conduct brute force attacks.\n\n[A Conti affiliate recently leaked what has been dubbed the Conti playbook. The playbook revealed that Conti actors also exploit vulnerabilities](https://www.bleepingcomputer.com/news/security/translated-conti-ransomware-playbook-gives-insight-into-attacks/)\nin unpatched assets to escalate privileges and move laterally across a victim’s network. They check for the “PrintNightmare” vulnerability\n(CVE-2021-34527) in Windows Print spooler service, EternalBlue vulnerability (CVE-2017-0144) in Microsoft Windows Server Message Block,\nand the “Zerologon” vulnerability (CVE-2020-1472) in Microsoft Active Directory Domain Controller. The playbook has been translated from\nRussian to English by security researchers and has provided other useful Indicators of Compromise (IoC).\n\nConti actors also use the RouterScan tool to identify router devices in a provided range of IPs and attempt to find logins/passwords from a\nstandard list available with the RouterScan tool. They then install AnyDesk or Atera on the target machine to maintain an open communication\nchannel. Like other ransomware attacks, Conti actors exfiltrate data from victims’ networks to cloud storage services like MEGA and then\ndeploy Conti ransomware. To upload data on cloud storage Conti uses open-source Rclone command-line software. They use a double\nextortion approach in which they demand a ransom to release the encrypted data or threaten to publicly release it if a ransom is not paid. They\nmay also sell the data to the highest bidder.\n\n## Technical Details:\n\nConti ransomware uses obfuscation. The most notable use is to hide various Windows API calls used by the malware. It is common for some\nmalware to lookup API calls during execution. Initially, it brings import module names then decrypts the API names and gets their addresses.\n\n\n-----\n\nFig. 1 De-obfuscation of Windows API\nConti uses a unique String Decryption Routine that is applied to almost every string text or API name used by the malware as shown in Fig. 2:\n\nFig.\n\n2 String Decryption Routine\nAfter getting API addresses, it calls for `CreateMutexA API with the Mutex Value of “CONTI” as shown below in Fig. 3:`\n\nFig. 3 Create\n\nMutex\nIt deletes Windows Volume Shadow Copies and also resizes shadow storage for drives C to H:\n\n\n-----\n\nFig. 4 Deletes Windows Volume Shadow Copy\nNext, Conti executes commands for stopping potential Windows Services related to antivirus, security, backup, database, and email solutions:\n\nFig. 5 Stop Potential Windows Services\nThe table below contains the names of the Windows Services that Conti stopped by calling the code in Fig. 5 in the loop.\n\nMSSQL$BKUPEXEC MSSQL$SQLEXPRESS MSSQLFDLauncher$SHAREPOINT\n\nMSSQL$ECWDB2 MSSQL$SYSTEM_BGC MSSQLFDLauncher$SQL_2008\n\nMSSQL$PRACTICEMGT MSSQL$TPS MSSQLFDLauncher$SYSTEM_BGC\n\nMSSQL$PRACTTICEBGC MSSQL$TPSAMA MSSQLFDLauncher$TPS\n\nMSSQL$PROD MSSQL$VEEAMSQL2008R2 MSSQLFDLauncher$TPSAMA\n\nMSSQL$PROFXENGAGEMENT MSSQL$VEEAMSQL2008R2 MSSQLSERVER\n\nMSSQL$SBSMONITORING MSSQL$VEEAMSQL2012 MSSQLServerADHelper\n\nMSSQL$SHAREPOINT MSSQLFDLauncher MSSQLServerADHelper100\n\nMSSQL$SOPHOS MSSQLFDLauncher$PROFXENGAGEMENT MSSQLServerOLAPService\n\nMSSQL$SQL_2008 MSSQLFDLauncher$SBSMONITORING MySQL57\n\nAcronis VSS Provider Mfemms DCAgent\n\nAcronisAgent Mfevtp EhttpSrv\n\nAcrSch2Svc MMS Ekrn\n\nAntivirus Mozyprobackup Enterprise Client Service\n\nARSM MsDtsServer EPSecurityService\n\nAVP MsDtsServer100 EPUpdateService\n\nBackupExecAgentAccelerator MsDtsServer110 EraserSvc11710\n\nBackupExecAgentBrowser MSExchangeES EsgShKernel\n\nBackupExecDeviceMediaService MSExchangeIS ESHASRV\n\nBackupExecJobEngine MSExchangeMGMT FA_Scheduler\n\nBackupExecManagementService MSExchangeMTA MSOLAP$TPSAMA\n\nBackupExecRPCService MSExchangeSA McShield\n\nBackupExecVSSProvider MSExchangeSRS McTaskManager\n\nBedbg msftesql$PROD Mfefire\n\nIISAdmin MSOLAP$SQL_2008 Klnagent\n\nIMAP4Svc MSOLAP$SYSTEM BGC MSOLAP$TPS\n\n\n-----\n\nCo t a so e e ages t e do s esta t a age to c ose app cat o s a d se ces t at a e u g o de to a e t e a a ab e o\nencryption and to maximize the damage:\n\nFig. 6 Unlock files with Windows Restart Manager\nIt collects information about drives and drive types present on compromised systems:\n\nFig. 7 Collect Drives Information\nAs shown in Fig. 8, Conti uses multi-threaded tactics. It calls `CreateIoCompletionPort API to create multiple instances of worker threads`\ninto memory to wait for data. Once the file listing is completed, it is passed to the worker threads. Utilizing the computing power of multi-core\nCPUs, the data is quickly encrypted:\n\n\n-----\n\nFig. 8 Implementation of Multi-threaded Processing\n\nFig. 9 Multiple Threads Perform\n\nFile Encryption\nConti then iterates files on the local system and those on remote SMB network shares to determine what data to encrypt. It looks for folders\nand drives shared on remote systems using `NetShareEnum API. If the remote share is accessible, it encrypts the files present in that share:`\n\n\n-----\n\nFig. 10 Getting Info of Remote Shares\nIt collects ARP cache information from the local system using the `GetIpNetTable API. ARP cache information is a list of all the systems with`\nwhich the computer recently communicated. It checks for “172.”, “192.168.” etc., on the collected IP list. If an IP address is in a different range\nit skips that system from encryption:\n\nFig. 11 Collect ARP Cache Information\nIt uses an AES-256 encryption key per file with a hard-codedRAS-4096 public encryption key. As shown in Fig. 12, the 0x6610 parameter is\nused while calling the `CryptGenKey API. 0x6610 is the value of the CALG_AES_256 identifier and is only alg_id:`\n\nFig. 12 Create CALG_AES_256 Key\nConti has a unique feature that allows attackers to perform file encryption in command line mode:\n\n\n-----\n\nFig. 13 Command Line Mode of Operation\n\n## Modes of Operation\n\nConti allows 2 command line modes `--encrypt-mode and` `- h :`\n\nFig. 14 Command Line `--encrypt-mode Mode`\n```\n--encrypt-mod marks which files are encrypted. There are 3 options for its value: all, local, and network . By default, ransomware\n\n```\nruns with the `all parameter:`\n\nFig.\n\n15 Command Line `--encrypt-mode with Value` `all`\nIn `all, encryption carried out for – local and network.` `network means that shared resources on the local network will be encrypted:`\n\nFig. 16 Command Line `--encrypt-mode Mode with Value` `local`\n\nFig. 17 Command Line `--encrypt-mode Mode with Value` `network`\nIn command line `-h mode, the parameter may contain the name of a file that lists the DNS and NetBIOS addresses of remote servers. The`\nmalware will then build a list of folders to ignore during encryption:\n\n\n-----\n\nFig. 18 Folders Ignored in Encryption\nIt skips the following extensions during encryption: .exe, .dll, .sys, .lnk, and .CONTI. It appends the file extension `.CONTI and creates a`\nransom note named `CONTI_README.txt in every folder to notify users about the infection:`\n\nFig. 19\n\n__CONTI” Extension Appended to Files\n\n## The Ransom Note:\n\nThe ransom note and the note’s file information are present in the resource of malware files:\n\nFig. 20 Ransom Note Content\n\n\n-----\n\nFig. 21 Ransom Note Name\nIt calls the `LoadResource API to get ransom note-related information:`\n\nFig. 22 Code to Collect Data Related to the Ransom Note\nThe ransom note contains 2 email addresses to get in touch with the attackers. The addresses are unique for each victim:\n\n\n-----\n\nFig. 23 Ransom Note\n\n## IoC:\n```\neae876886f19ba384f55778634a35a1d975414e83f22f6111e3e792f706301fe\n\n TTP Map:\n\n```\n\n**Credential**\n**Access** **Discovery**\n\n\n**Lateral**\n**Movement** **Collect**\n\n\n**Initial Access** **Execution** **Persistence**\n\n\n**Privilege**\n**Escalation** **Defense Evasion**\n\n\nValid\nAccounts\n(T1078)\n\nPhishing:\nSpearphishing\nAttachment\n(T1566.001)\n\nPhishing:\nSpearphishing\nLink\n(T1566.002)\n\nExploit publicfacing\napplication\n(T1190)\n\n\nCommand and\nScripting\nInterpreter:\nWindows\nCommand\nShell\n(T1059.003)\n\nNative\nApplication\nProgramming\nInterface (API)\n(T1106)\n\nWindows\nManagement\nInstrumentation\n(T1047)\n\nUser execution\n(T1204)\n\nScheduled\ntask/job:\nscheduled task\n(T1053.005)\n\nCommand and\nScripting\nInterpreter:\nPowerShell\n(T1059.001)\n\n\nValid\nAccounts\n(T1078)\n\nExternal\nRemote\nServices\n(T1133)\n\nScheduled\ntask/job:\nscheduled\ntask\n(T1053.005)\n\nStartup item\n(T1165)\n\nBoot or\nlogon\nautostart\nexecution:\nWinlogon\nHelper DLL\n(T1547.004)\n\n\nProcess\nInjection:\nDynamiclink Library\nInjection\n(T1055.001)\n\nValid\naccounts:\ndomain\naccounts\n(T1078.002)\n\n\nObfuscated Files or\nInformation (T1027)\n\nProcess Injection:\nDynamic-link Library\nInjection\n(T1055.001)\n\nDeobfuscate/Decode\nFiles or Information\n(T1140)\n\nImpair defenses:\ndisable or modify\ntools (T1562.001)\n\n\nBrute Force\n(T1110)\n\nSteal or\nForge\nKerberos\nTickets:\nKerberoasting\n(T1558.003)\n\nOS credential\ndumping\n(T1003)\n\nCredentials\nfrom\npassword\nstores\n(T1555)\n\n\nSystem\nNetwork\nConfiguration\nDiscovery\n(T1016)\n\nSystem\nNetwork\nConnections\nDiscovery\n(T1049)\n\nProcess\nDiscovery\n(T1057)\n\nFile and\nDirectory\nDiscovery\n(T1083)\n\nNetwork\nShare\nDiscovery\n(T1135)\n\nRemote\nSystem\nDiscovery\n(T1018)\n\nNetwork\nService\nScanning\n(T1046)\n\n\nRemote\nServices:\nSMB/Windows\nAdmin Shares\n(T1021.002)\n\nTaint Shared\nContent\n(T1080)\n\nExploitation of\nRemote\nServices\n(T1210)\n\nLateral tool\ntransfer\n(T1570)\n\n\nArchive\nCollecte\nData:\nArchive\nUtility\n(T1560.\n\n\n-----\n\n**Credential**\n**Access** **Discovery**\n\nPermission\ngroups\ndiscovery:\ndomain\ngroups\n(T1069.002)\n\nSystem\ninformation\ndiscovery\n(T1082)\n\nSystem\nowner/user\ndiscovery\n(T1033)\n\nSecurity\nsoftware\ndiscovery\n(T1063)\n\nAccount\nDiscovery:\nLocal\nAccount\n(T1087.001)\n\nPermissions\nGroup\nDiscovery:\nLocal Groups\n(T1069.001)\n\n\n**Lateral**\n**Movement** **Collect**\n\n\n**Initial Access** **Execution** **Persistence**\n\n## Summary\n\n\n**Privilege**\n**Escalation** **Defense Evasion**\n\n\nTo defend against threats, Qualys recommends good cyber hygiene practices, and moving to a preventative approach by keeping network\nconfigurations, backup, application access, and patching up-to-date.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-18 - Conti Ransomware.pdf"
    ],
    "report_names": [
        "2021-11-18 - Conti Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "77b28afd-8187-4917-a453-1d5a279cb5e4",
            "created_at": "2022-10-25T15:50:23.768278Z",
            "updated_at": "2025-03-27T02:00:55.5423Z",
            "deleted_at": null,
            "main_name": "Inception",
            "aliases": [
                "Inception Framework",
                "Cloud Atlas"
            ],
            "source_name": "MITRE:Inception",
            "tools": [
                "PowerShower",
                "VBShower",
                "LaZagne"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535844,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653754404,
    "ts_modification_date": 1653754404,
    "files": {
        "pdf": "https://archive.orkl.eu/954b52cfe2cb52ac30babea2d233f5901761193c.pdf",
        "text": "https://archive.orkl.eu/954b52cfe2cb52ac30babea2d233f5901761193c.txt",
        "img": "https://archive.orkl.eu/954b52cfe2cb52ac30babea2d233f5901761193c.jpg"
    }
}