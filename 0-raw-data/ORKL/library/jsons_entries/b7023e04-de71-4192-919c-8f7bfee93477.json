{
    "id": "b7023e04-de71-4192-919c-8f7bfee93477",
    "created_at": "2023-01-12T15:00:29.813243Z",
    "updated_at": "2025-03-27T02:05:37.093222Z",
    "deleted_at": null,
    "sha1_hash": "ad00a72ea562ec8498d2dcb1f4c4e75f9b9aba98",
    "title": "2017-03-30 - Trochilus and New MoonWind RATs Used In Attack Against Thai Organizations",
    "authors": "",
    "file_creation_date": "2022-05-28T16:07:43Z",
    "file_modification_date": "2022-05-28T16:07:43Z",
    "file_size": 782893,
    "plain_text": "# Trochilus and New MoonWind RATs Used In Attack Against Thai Organizations\n\n**researchcenter.paloaltonetworks.com/2017/03/unit42-trochilus-rat-new-moonwind-rat-used-attack-thai-utility-**\norganizations/\n\nJen Miller-Osborn, Josh Grunzweig March 30, 2017\n\nBy [Jen Miller-Osborn and](https://unit42.paloaltonetworks.com/author/jen-miller-osborn/) [Josh Grunzweig](https://unit42.paloaltonetworks.com/author/joshgruznweig/)\n\nMarch 30, 2017 at 5:00 AM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [MoonWind RAT,](https://unit42.paloaltonetworks.com/tag/moonwind-rat/) [RAT,](https://unit42.paloaltonetworks.com/tag/rat/) [Thailand,](https://unit42.paloaltonetworks.com/tag/thailand/) [Trochilus RAT,](https://unit42.paloaltonetworks.com/tag/trochilus-rat/) [Utilites](https://unit42.paloaltonetworks.com/tag/utilites/)\n\nFrom September 2016 through late November 2016, a threat actor group used both the\nTrochilus RAT and a newly idenfied RAT we’ve named MoonWind to target organizations in\nThailand, including a utility organization. We chose the name ‘MoonWind’ based on\ndebugging strings we saw within the samples, as well as the compiler used to generate the\nsamples. The attackers compromised two legitimate Thai websites to host the malware,\nwhich is a tactic this group has used in the past. Both the Trochilus and MoonWind RATs\nwere hosted on the same compromised sites and used to target the same organization at the\nsame time. The attackers used different command and control servers (C2s) for each\nmalware family, a tactic we believe was meant to thwart attempts to tie the attacks together\nusing infrastructure alone. The compromised websites are the site for a group of information\ntechnology companies in Thailand, and all the tools were stored in the same directory.\n\n\n-----\n\nWe were also able to find a post-compromise tool along with the two RATs, which afforeded\nus insight into one of the tools the attackers used once they gained a foothold inside an\norganization. In addition to Trochilus and MoonWind we found Mimikatz, a popular credential\nharvesting tool.\n\nFurther research led us to additional MoonWind samples using the same C2 (dns[.]\nwebswindows [.]com) but hosted on a different compromised but legitimate website. The\nattacks in that case took place in late September to early October 2016 and the attackers\nstored the MoonWind samples as RAR files, while in the November attacks the RATs were\nstored as executables. We were not able to find additional tools, but the attackers again\ncompromised a legitimate Thai website to host their malware, in this case the student portal\nfor a Thai University.\n\n## MoonWind Analysis\n\nThe MoonWind sample used for this analysis was compiled with a Chinese compiler known\n[as BlackMoon, the same compiler used for the BlackMoon banking Trojan. While a number](https://www.proofpoint.com/us/threat-insight/post/Updated-Blackmoon-Banking-Trojan)\nof attributes match the BlackMoon banking Trojan, the malware is not the same. Both\nmalware families were simply compiled using the same compiler, and it was the BlackMoon\nartifacts that resulted in the naming of the BlackMoon banking Trojan. But because this new\nsample is different from the BlackMoon banking Trojan, we have named it MoonWind, by\ncombining the BlackMoon compiler artifacts with the embedded string below:\n\nE:\\StarWind\\FW__Project_RTPD-PIBICs\\Table.ini\n\nWhen MoonWind first runs, it will copy itself to one of the following locations with a filename\nof ‘svcohos.exe’:\n\nC:\\Documents and Settings\\All Users\\Ufyaginptxb\\\nC:\\Users\\All Users\\\nC:\\PorgramData\\\nC:\\Program Files\\Common Files\\\n\nIt then executes a new instance of itself in a new process. Also, it will remove the original file\nvia the following command that is executed in a batch script named 'date.bat’.\n\n1 cmd /c timeout /t 6 & del \"C:\\ProgramData\\Ufyaginptxb\\svcohost.exe\" & del date.bat\n\nDuring this routine, a randomly generated victim identifier will be created and written to a file\nnamed 'micr.ini'. This file is located in the same path as the malware. The following contents\nrepresent an example of a victim ID contained in this file:\n\n\n1\n2\n\n\n\n[mic]\nMic=2199LLLLLL\n\n\n-----\n\nDuring the install routine, the malware will also setup a timer that will execute a file named\n'sevrsvos.exe'. This sample\n(815df680be80b26b5dff0bcaf73f7495b9cae5e3ad3acb7348be188af3e75201) acts as a\nruntime persistence mechanism. It installs itself as a service with the following properties:\n\n**Service Name: Windows Ejlptxtxbfjn Rvzd**\n**Display Name: Windows Ejlptxtxbfjn Rvzd**\n**Description: Windows Ejlptxtxbfjn Rvzd Hlptxbfjnr**\n**Startup Type: Automatic**\n\nThis service serves the single purpose of checking every 60 seconds if the 'svcohos.exe'\nprocess is running. If not, the service will spawn a new instance of it. In doing so, this\nsecondary malware sample acts as both a runtime persistence mechanism, as well as a\npersistence mechanism across reboots.\n\nAfter installation, a keylogging routine begins. The malware writes keystrokes and window\ninformation to a filename in the present working directory with the following filename:\n\njop[year][month][day][hour][minute][seconds].zip\n\nAdditionally, it writes a 'win.ini' file that contains this file path above.\n\nThe malware proceeds to collect the following victim information:\n\nHostname\nUsername\nWindows version\nIP address\nCurrent time\nRAM amount\nNumber of total drives\nNumber of removable drives\nUnique victim identifier\n\nAfter this information is aggregated, MoonWind enters its command and control loop, and\nbegins reaching out to the servers and ports specified in its configuration embedded in the\nsvcohos.exe file. The following remote hosts were specified in this particular sample:\n\ndns.webswindows[.]com|80\ndns.webswindows[.]com|443\ndns.webswindows[.]com|53\ndns.webswindows[.]com|8080\n\n\n-----\n\nWhile the ports associated with this sample s configuration pertain normally to HTTP,\nHTTPS, or DNS, network communication takes place via raw sockets. The malware first\nreceives data, which has the following format as shown in Figure 1:\n\n_Figure 1 C2 to MoonWind communication_\n\nDigging into the packet further, we can break out individual pieces, as seen in Figure 2:\n\n_Figure 2 MoonWind network communication packet format_\n\nThe encrypted data portion is encrypted via RC4 with the following static key:\n\nHHSADh!@#$YUAGEWYGhjfsjd5465fsaQWAFGDA/jfdafdjhhasgfh==\n\nIn the above example, the encrypted data decrypts to ‘\\x20\\x20\\x20\\x20\\x20\\x20’, or six\nspaces. This particular command requests that the malware send the previously collected\nvictim information.\n\nThe data returned by MoonWind has the same format, however, uses the following static key\nfor encryption instead:\n\nSSHqWSSAFdhjklfahj!@##4*&&!!HQ12785452!@!!$$$32#@$$11!!\n\nAn example of such data returned by the malware can be seen below in figure 3.\n\n\n-----\n\n_Figure 3 MoonWind to C2 communication_\n\nWhen decrypted, we see the data shown in Figure 4. Note that the first six bytes contains the\nreturn command (‘WYR002’), followed by the payload. The payload contains information\npreviously discussed, delimited by ‘*/*’. Certain variables, such as ‘cdg’ and ‘ip’ are\nhardcoded. We also see what is most likely a malware versioning string at the end (V2.1).\nThis string is also hardcoded to the sample.\n\n_Figure 4 Decrypted data sent by MoonWind_\n\nIn total, MoonWind has 73 possibly commands that it can accept. We have not yet fully\nresearched all of the commands, but the majority of them have been identified, as we can\nsee in the Appendix.\n\n## Conclusion\n\n[Trochilus was first reported by Arbor Networks in their Seven Pointed Dagger report tying its](https://www.arbornetworks.com/blog/asert/wp-content/uploads/2016/01/ASERT-Threat-Intelligence-Brief-2015-08-Uncovering-the-Seven-Point-Dagger.pdf)\nuse to other targeted Southeast Asia activity. The activity dates to at least 2013 and has ties\nto multiple reports by other researchers. It is highly likely MoonWind is yet another new tool\nbeing used by the group or groups responsible for that activity, indicating they are not only\nstill active but continuing to evolve their playbook.\n\n\n-----\n\nPalo Alto Networks customers are protected from this threat in the following ways:\n\nThe malware discussed in this report is blocked by WildFire and Traps\nThe domain names included in this report are blocked by Threat Prevention\n\nAutoFocus subscribers can investigate the activities further with the following tags:\n\n[Trochilus](https://autofocus.paloaltonetworks.com/#/tag/Unit42.Trochilus)\n[MoonWind](https://autofocus.paloaltonetworks.com/#/tag/Unit42.MoonWind)\n\n## Appendix\n\n**MoonWind Commands**\n\n\n**Command** **Description** **Response**\n**Command**\n\n\n**Notes**\n\n\n\\x20\\x20\\x20\\x20\\x20\\x20 Returns\ncollected victim\ninformation.\n\n\nWYR002\n\n\nWYR002 Null command. None\n\n\nWYR003 Spawns\nmessage box\nthat allows\nvictim to send\na message.\n\nWYR005 Modifies\nservices.\n\nWYR006 Returns a list\nof running\nprocesses.\n\nWYR007 Kills specified\nprocess.\n\nqdcmdl Spawns an\ninteractive\nshell.\n\n\nWYR003\n\nWYR005 Subcommands of either 'fuwu'\n(create service), 'exit' (stop\nservice), 'stop' (pause service),\n'reun' (continue service), or\n'yrun' (start service)\n\nWYR006\n\nNone\n\ncmdok1\n\n\n-----\n\nWYR009 Send\ncommand to\ninteractive\nshell and\nreceive results.\n\nWYR010 Terminates\ninteractive\nshell.\n\nWYR011 Get size of\ndisks.\n\nWYR012 Returns space\nof given\ndirectory.\n\nWYR013 Return a\ndirectory listing\nof specified\ndirectory (C:\\\ndefault).\n\nWYR014 Execute\nspecified\ncommand.\n\nWYR015 Open specified\ncommand with\nShellExecuteA.\n\nWYR016 Open specified\ncommand with\nShellExecuteA\n(Hidden).\n\nWYR018 Perform\ndirectory listing\nwith file\nattributes.\n\nxiazai Read contents\nof file\nspecified.\n\ncxqdcx Restart\nMoonWind.\n\npingmu Return screen\nresolution.\n\nqdkzpm Unknown.\n\n\nWYRCCC\n\nNone\n\nWYR011\n\nWYR012\n\nWYR013\n\nNone\n\nNone\n\nNone\n\nWYR018\n\nwrdown\n\nNone Uses %TEMP%/restart.bat to\nperform restart.\n\npmgksj\n\n\n-----\n\njixujj Unknown.\n\nsbkzxx Performs\nvarious mouse\nactions.\n\nxhpmkz Unknown.\n\naxjpsj Submits\nkeyboard\ninputs.\n\nksjljp Starts\nkeylogging\nfunctionality.\n\ntzjljp Stops\nkeylogging\nfunctionality.\n\nhqjljp Return\nkeylogging\ndata.\n\nscjpjl Deletes the\nkeylogging file.\n\nxzcxzs Uninstalls\nmalware.\n\nhttpxx Unknown.\n\nzaicif Unknown.\n\nxiaokl Unknown.\n\n\nNone Subcommands of either 'sj'\n(double left-click), 'yk' (move to\nposition and right-up), 'zk'\n(move to position and rightdown), 'zx' (move to position\nand left-up), or 'yd' (move to\nposition and left-down)\n\nNone\n\nNone\n\nNone\n\njpjlhq\n\nNone\n\nNone Uses ‘x.bat’ to accomplish\nuninstall. Written to present\nworking directory (PWD) of\nmalware.\n\n\njuxuxi Null command. None\n\nshangc Unknown.\n\necscwj Unknown.\n\nscwjwb Unknown.\n\n\n-----\n\nscmlcj Creates\nspecified\ndirectory.\n\nycxiaz Unknown.\n\nzcycxz Unknown.\n\nycxjml Creates\nspecified\ndirectory.\n\nxjwjcj Writes\nspecified file\nwith provided\ncontents.\n\nshanwj Deletes\nspecified file.\n\nshanml Removes\nspecified\ndirectory.\n\ngengmj Moves\nspecified file.\n\nycgwjj Sets hidden\nattribute on\nspecified file.\n\ncopywj Copies\nspecified file.\n\nfzmlwj Copies\nspecified\ndirectory.\n\nsdxtcs Unknown.\n\nqypxxl Get disk space\nof specified\ndrive.\n\nscdqwj Unknown.\n\nwyycwj Unknown.\n\nxzwcsc Unknown.\n\n\nmlwzcj\n\nNone\n\nNone Command format is\n‘[filename]|[data]’.\n\nNone\n\nNone\n\nNone Command format is ‘[src]|^|\n\n[dst]’.\n\nNone\n\ncopyok Command format is\n‘[src]^|^[dst]’.\n\ncopyok Command format is\n‘[src]^|^[dst]’.\n\nqdypxx\n\n\n-----\n\nxzwcyx Executes\nspecified\ncommand\nwithin batch\nscript.\n\ndwjjxc Unknown.\n\ndwjcwj Unknown.\n\ndqscds Returns\nfilesize of\nspecified file.\n\nsjkqzd Unknown.\n\nsswjsj Finds specified\nfile and returns\nresults\nincluding\nattributes.\n\ndwjsjx Unknown.\n\nxzbwza Unknown.\n\nhqurl1 Returns C2\nconfiguration\nof MoonWind.\n\nghsxip Writes data to\nwin.dll and\nloads it.\n\nkhljcg Unknown.\n\ndqyxml Unknown.\n\ngxycwj Unknown.\n\ngxwjbc Unknown.\n\ngxwjok Unknown.\n\nfxgxcs Unknown.\n\ngxwjsy Open specified\ncommand with\nShellExecuteA.\n\ngxyxcx Unknown.\n\n\nNone Uses ‘boot.bat’ to accomplish\nuninstall. Written to PWD of\nmalware.\n\nqcwjcd\n\nwjsswb\n\nqcsxdz\n\nsdczip\n\nNone\n\n\n-----\n\nbddkzf Unknown.\n\nscwjdx Unknown.\n\nxzwjdx\n\n## Indicators of Compromise\n\n**MoonWind**\n\nfd4856f2ec676f273ff71e1b0a1729cf6251c82780fc9e7d628deca690b02928\n\nce3da112e68e00621920911b1f9c72d7175894901173e703a44ac3700e4d427c\n\ne31679b82be58ace96b1d9fdfc2b62b6e91d371ed93957e0764cd7c464b04b9d\n\nf2589745671949422b19beec0856ca8b9608c02d5df4402f92c0dcc9d403010b\n\n**MoonWind Persistence Mechanism**\n\n815df680be80b26b5dff0bcaf73f7495b9cae5e3ad3acb7348be188af3e75201\n\n**Trochilus**\n\n59f8a31d66f053f1efcc8d7c7ebb209a8c12233423cc2dc3673373dde9b3a149\n\nwebswindows[.]com\n\n192.225.226[.]195\n\n**Ignite ’17 Security Conference: Vancouver, BC June 12–15, 2017**\n\nIgnite ’17 Security Conference is a live, four-day conference designed for today’s security\nprofessionals. Hear from innovators and experts, gain real-world skills through hands-on\nsessions and interactive workshops, and find out how breach prevention is changing the\n\n\n-----\n\nsecurity industry. Visit the [Ignite website for more information on tracks, workshops and](http://www.paloaltonetworksignite.com/)\nmarquee sessions.\n\n**Get updates from**\n**Palo Alto**\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-03-30 - Trochilus and New MoonWind RATs Used In Attack Against Thai Organizations.pdf"
    ],
    "report_names": [
        "2017-03-30 - Trochilus and New MoonWind RATs Used In Attack Against Thai Organizations.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535629,
    "ts_updated_at": 1743041137,
    "ts_creation_date": 1653754063,
    "ts_modification_date": 1653754063,
    "files": {
        "pdf": "https://archive.orkl.eu/ad00a72ea562ec8498d2dcb1f4c4e75f9b9aba98.pdf",
        "text": "https://archive.orkl.eu/ad00a72ea562ec8498d2dcb1f4c4e75f9b9aba98.txt",
        "img": "https://archive.orkl.eu/ad00a72ea562ec8498d2dcb1f4c4e75f9b9aba98.jpg"
    }
}