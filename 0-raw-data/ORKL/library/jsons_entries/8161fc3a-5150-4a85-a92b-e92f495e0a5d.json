{
    "id": "8161fc3a-5150-4a85-a92b-e92f495e0a5d",
    "created_at": "2023-01-12T15:07:16.809284Z",
    "updated_at": "2025-03-27T02:16:08.444674Z",
    "deleted_at": null,
    "sha1_hash": "c6c7f9c1de356ec5d6eddaccc52f1c7a9ceadde5",
    "title": "2017-06-01 - Microsoft Word Intruder Integrates CVE-2017-0199, Utilized by Cobalt Group to Target Financial Institutions",
    "authors": "",
    "file_creation_date": "2022-05-28T15:58:27Z",
    "file_modification_date": "2022-05-28T15:58:27Z",
    "file_size": 2991245,
    "plain_text": "# Microsoft Word Intruder Integrates CVE-2017-0199, Utilized by Cobalt Group to Target Financial Institutions\n\n**[proofpoint.com/us/threat-insight/post/microsoft-word-intruder-integrates-cve-2017-0199-utilized-cobalt-group-target](https://www.proofpoint.com/us/threat-insight/post/microsoft-word-intruder-integrates-cve-2017-0199-utilized-cobalt-group-target)**\n\nJune 1, 2017\n\n\n-----\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\nMicrosoft Word Intruder Integrates CVE-2017-0199, Utilized by Cobalt Group to Target Financial\nInstitutions\n\n\n-----\n\nJune 01, 2017 Matthew Mesa, Axel F, Pierre T, Travis Green\n\n**Overview**\n\nIn May, Proofpoint observed multiple campaigns using a new version of Microsoft Word Intruder (MWI).\nMWI is a tool sold on underground markets for creating exploit-laden documents, generally used in\ntargeted attacks. We previously reported about MWI when it added support for CVE-2016-4117 [2].\nAfter the latest update, MWI is now using CVE-2017-0199 [4][5] to launch an HTML Application (HTA)\nused for both information collection and payload execution.\n\nThis activity targets organizations in the financial vertical including banks, banking software vendors,\nand ATM software and hardware vendors. The emails are sent to technology and security personnel\nworking in departments including Fraud and Information Security.\n\nThe actor involved is believed to be the Cobalt group -- an actor known to target banks in Europe and\nAsia and previously documented by Group IB [1]. The malicious documents created with MWI for use\n[in these activities delivered Metasploit Stager, Cobalt Strike, and previously undocumented malware](https://www.proofpoint.com/us/threat-reference/malware)\nwe named Cyst Downloader.\n\n**Email Lures**\n\nWhile we observed numerous malicious attachments, we describe two here and list the rest in the IOC\nsection.\n\nIn the first campaign, the email (Figure 1) purported to be from FinCERT [8] with the subject\n“Памятка по информационной безопасности” (Information Security Notice) and contained a\nMicrosoft Word attachment named “сводка1705.doc” (report1705) (Figure 3).\nAnother email (Figure 2) purported to be from Security Support for PCI-DSS [3] at a major credit\ncard company with the subject line “Безопасность” (security) and a Microsoft Word attachment\n(Figure 4) “Требования безопасности.doc” (Safety requirements).\n\n\n-----\n\n_Figure 1: Email used to deliver the MWI document (Body translated: “Good day, important to familiarize_\n_yourself!”)_\n\n\n-----\n\n_Figure 2: Email used to deliver the MWI document (Body translated: Please accept following advice_\n_and recommendations regarding necessary safety precautions”)_\n\n_Figure 3: MWI document after the exploit is triggered; the lure displays unreadable characters_\n\n\n-----\n\n_Figure 4: MWI document after the exploit is triggered; the lure describes the different ways to pay for a_\n_delinquent MTS (Russian mobile provider) bill_\n\n**MWI Advertising Integration of CVE-2017-0199**\n\nBefore we describe our MWI analysis, it is worth mentioning that on May 8, 2017, an advertisement for\nMWI on an underground site stated that this exploit document builder integrated CVE-2017-0199, and\nwas recruiting customers for several available seats. The full version of the original Russian\nadvertisement and its English translation follows:\n\nMicrosoft Office Word Exploits, universal .doc exploit-pack\n\nимеется несколько мест на CVE-2017-0199 (OLE2LINK)\n\n- билдер\n\n- статистика\n\n- запуск exe/dll (скриплеттов)\n\n- запуск cmd/powershell\n\n- поддержка, обновления, чистки\n\nподробности: [REDACTED_EMAIL]\n\n--\n[*] MICROSOFT WORD INTRUDER 8 - the best APT-like *.doc exploit pack\n\nCVE-2016-4117 + CVE-2015-2545 + CVE-2015-1641 + CVE-2012-0158\n\n\n-----\n\nTranslation:\n\nMicrosoft Office Word Exploits, universal .doc exploit-pack\nThere are several spots available for the CVE-2017-0199 (OLE2LINK)\n\n- Builder\n\n- Statistics\n\n- Running exe / dll (scriptlets)\n\n- Starting cmd / powershell\n\n- Support, updates, cleaning\nDetails: [REDACTED_EMAIL]\n--\n[*] MICROSOFT WORD INTRUDER 8 - the best APT-like * .doc exploit pack\nCVE-2016-4117 + CVE-2015-2545 + CVE-2015-1641 + CVE-2012-0158\n\n**MWI Analysis**\n\nWhen the document is opened, it drops the embedded payload into a temporary directory as is typical\nof RTFs with embedded objects[6]. Next, the CVE-2017-0199 exploit downloads and executes the\nHTA.\n\nFrom our analysis, the purpose of the HTA is two-fold. It is used to download and/or execute the\npayload as well as collect information about the infected machine. Thus the advertisement description\nis accurate. In the example analyzed here, shown in Figure 5, the MWI HTA is configured to run an\nexecutable payload embedded in the document, which was previously saved into the temporary\ndirectory when the recipient opened the document. Note that the HTA could have alternatively been\nconfigured to download and run an executable, DLL, or a JScript/VBscript file. It is also configured to\ncollect and report information about the system, such as installed antivirus applications, running\nprocesses, and whether execution of the payload was successful.\n\n\n-----\n\n_Figure 5: Configuration section of the MWI HTA_\n\nAs mentioned above, depending on how MWI is configured, it has different ways of executing the\npayload. Figure 6 shows the code snippet used for executing EXE and DLL payloads. There is also\nfunctionality for executing JScript/VBScript (Figure 7) and cmd/Powershell. All three methods generate\na section for the Command and Control (C&C) report letting the operator know if the execution was\nsuccessful.\n\n\n-----\n\n_Figure 6: Portion of the HTA code responsible for running DLLs and Executables_\n\n_Figure 7: Portion of the HTA code responsible for executing VBScript/Jscript_\n\n\n-----\n\nThe information collection code is responsible for profiling the system. It collects network details,\noperating system information, installed antivirus products, and running processes (see list below). This\ncollected information is encoded with base64 and sent it to its C&C server.\n\nUserName\nComputerName\nUserDomain\nOS Version\nOS SerialNumber\nWindowsDirectory\nCodeSet\nCountryCode\nOSLanguage\nCurrentTimeZone\nLocale\nDefaultProxy\nAntivirus displayName\nAntivirus instanceGuid\nAntivirus pathToSignedProductExe\nAntivirus pathToSignedReportingExe\nAntivirus productState\nAntivirus Timestamp\nRunning process ProcessId\nRunning process Name\nRunning process ExecutablePath\n\n_Figure 8: Section of the HTA responsible for collecting information about the system_\n\n\n-----\n\n_Figure 9: Section of the HTA responsible for sending collected data_\n\n_Figure 10: Function in the HTA used to send collected data_\n\n**Malware Payload: Metasploit Stager**\n\nThe payload installed most frequently by MWI was the Metasploit stager, which in turn downloaded\nCobalt Strike. The Metasploit stager [7] is used to stage additional malware and we often see it in\npenetration testing as well as real attacks.\n\n**Malware Payload: Cyst Downloader and Plugin**\n\n\n-----\n\nHowever, in at least in one case we observed an MWI document install a previously unknown malware\n(SHA256: af17a3b5bf4c78283b2ee338ac6d457b9f3e7b7187c7e9d8651452b78574b3d3). We are\ncalling it the Cyst Downloader. The functionality of this loader is limited. It can create a mutex such as\n“syst<10 digits>” and communicate with the the C&C server to receive a DLL plugin. The URI path\npattern of the C&C beacon contains a folder (random alphanumeric name) followed by a file (random\nalphanumeric name) with a .jpg, .php, .gif, or .png extension. The downloaded DLL is encrypted with a\nhardcoded \"\\x28\\xBF\\x0A\\xBE\\x5B\\x6E\\x70\\x03\" RC4 key and base64 encoded. The server sends the\nDLL in HTML comments in a fake 404 response.\n\n_Figure 11: Cyst Downloader communicating with the C&C and receiving a payload plugin_\n\nThe DLL plugin is loaded in memory by the loader and does not access the disk. This plugin has the\ninternal name “test.dll”, which may indicate it is still in development. This plugin has only one export\nnamed “Execute”, which is hardcoded into the Cyst loader. The plugin enumerates URLs stored in the\nbrowser history, with support for Internet Explorer, Chrome, Firefox, and Opera:\n\nIE: parse history using the IUrlHistoryStg2::EnumUrls method\nChrome: parse history using a SQL query : “SELECT url, (last_visit_time/1000000-11644473600)\nFROM urls”\nFirefox: parse history using a SQL query : “SELECT url, (last_visit_date/1000000) FROM\nmoz places”\n\n\n-----\n\nOpera: parse history using a SQL query : SELECT url, (last_visit_time/1000000-11644473600)\nFROM urls”\n\nThese methods of browser history parsing are well-known and have been used for a long time by\nmalware authors. The visited URLs retrieved are stored in malware memory using this format :\n\n\"browser: (IE|Chrome|Firefox|Opera)\\r\\n” + “url: %s” + \" | time: %d\\r\\n\"\n\n_Figure 12: Example of visited URLs (recovered from browser history) stored in memory_\n\nThis data is then RC4 encrypted and sent to the same C&C. The attacker is likely parsing the data on\nthe server side and searching for a set of selected domains relevant to their attack, making it an\nefficient filter for interesting targets.\n\n**Conclusion**\n\nMicrosoft Word Intruder is a powerful tool for creating exploit documents that can be used in a variety\nof malicious campaigns. In this case, not only was it used to install known malware and customizable\nscripts and executables, but also installed a previously undocumented malware called Cyst\nDownloader. While exploit documents are less commonly used in attacks as malicious attachments\nand hosted files than macro documents, the availability of often unpatched vulnerabilities like CVE2017-0199 make it attractive to threat actors. We will continue to monitor MWI development and\ncampaigns by Cobalt and other actors using associated exploit documents.\n\n**Acknowledgements**\n\n[Special thanks to our colleague Andrew Komarov (InfoArmor Inc.) for his help in this study.](https://www.infoarmor.com/)\n\n**References**\n\n[1] [http://www.group-ib.com/cobalt.html](http://www.group-ib.com/cobalt.html)\n\n[2] https://www.proofpoint.com/us/threat-insight/post/microsoft-word-intruder-8-adds-support-for-flashvulnerability\n\n[3] [https://en.wikipedia.org/wiki/Payment_Card_Industry_Data_Security_Standard](https://en.wikipedia.org/wiki/Payment_Card_Industry_Data_Security_Standard)\n\n[4] [https://www.proofpoint.com/us/threat-insight/post/apt-targets-financial-analysts](https://www.proofpoint.com/us/threat-insight/post/apt-targets-financial-analysts)\n\n\n-----\n\n[5] https://www.proofpoint.com/us/threat-insight/post/dridex-campaigns-millions-recipients-unpatchedmicrosoft-zero-day\n\n[6] https://www.proofpoint.com/us/threat-insight/post/dyre-malware-campaigners-innovate-distributiontechniques\n\n[7] [https://blog.cobaltstrike.com/2013/06/28/staged-payloads-what-pen-testers-should-know/](https://blog.cobaltstrike.com/2013/06/28/staged-payloads-what-pen-testers-should-know/)\n\n[8] [https://www.scmagazine.com/fincert-to-help-russian-banks-respond-to-cyber-attacks/article/535448/](https://www.scmagazine.com/fincert-to-help-russian-banks-respond-to-cyber-attacks/article/535448/)\n\n**Indicators of Compromise (IOCs)**\n\n\n**IOC** **IOC**\n**Type**\n\n\n**Description**\n\n\ne559c65b51a874b9ebf4faacd830223428e507a865788c2f32a820b952ccf0b4 SHA256 MWI\nDocument\n\n2a918030be965cd5f365eb28cd5a0bebec32d05c6a27333ade3beaf3c54d242c SHA256 MWI\nDocument\n\ne0f6073aee370d5e1e29da20208ffa10e1b30f4cf7860bb1a9dde67a83dee332 SHA256 MWI\nDocument\n\n61afc2bf91283ccc478406a4c1277a0c8549584716d8b3a89d36f9bcdc45c4fe SHA256 MWI\nDocument\n\naf17a3b5bf4c78283b2ee338ac6d457b9f3e7b7187c7e9d8651452b78574b3d3 SHA256 MWI\nDocument\n\n326a01a5e2eeeeebe3dade94cf0f7298f259b72e93bd1739505e14df3e7ac21e SHA256 MWI HTA\n\nhxxp://37.1.207[.]202/wstat/ URL MWI C&C\n\nhxxp://5.45.66[.]161/wstat/ URL MWI C&C\n\n39ac90410bd78f541eb42b1108d2264c7bd7a5feafe102cd7ac8f517c1bd3754 SHA256 Metasploit\nStager\n\nhxxps://176.9.99[.]134/MAUy URL Cobalt\nStrike\nDownload\n\n\n-----\n\nhxxps://176.9.99[.]134/kQ6j URL Cobalt\nStrike\nDownload\n\nhxxps://52.15.209[.]133/Els8 URL Cobalt\nStrike\nDownload\n\n138d3f20da09e9f5aa5a367b8ff89d349fe20a63682df2379a7a6f78f31eb53d SHA256 Cobalt\nStrike\n\n176.9.99[.]134 IP Cobalt\nStrike C&C\n\n52.15.209[.]133 IP Cobalt\nStrike C&C\n\n922e3bccd3eb151ee46afb203f9618ae007b99a758ca95caf5324d650a496426 SHA256 Cyst\nDownloader\n\n96.44.188[.]57 IP Cyst\nDownloader\nC&C\n\n24973014fa8174ffff190ae7967a65307a23d42386683dc672babd9c6cf1e5ee SHA256 Cyst Plugin\n(browser\nhistory\nchecker)\n\n**ET and ETPRO Suricata/Snort Coverage**\n\n2024306     ET TROJAN MWI Maldoc Load Payload\n\n2024197     ET CURRENT_EVENTS SUSPICIOUS MSXMLHTTP DL of HTA (Observed in RTF 0day )\n\n2024307     ET TROJAN MWI Maldoc Posting Host Data\n\n2814013     ETPRO TROJAN Meterpreter or Other Reverse Shell SSL Cert\n\n2023629     ET INFO Suspicious Empty SSL Certificate - Observed in Cobalt Strike\n\n2826544     ETPRO TROJAN Cyst Downloader Fake 404\n\nSubscribe to the Proofpoint Blog\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-06-01 - Microsoft Word Intruder Integrates CVE-2017-0199, Utilized by Cobalt Group to Target Financial Institutions.pdf"
    ],
    "report_names": [
        "2017-06-01 - Microsoft Word Intruder Integrates CVE-2017-0199, Utilized by Cobalt Group to Target Financial Institutions.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2dfaa730-7079-494c-b2f0-3ff8f3598a51",
            "created_at": "2022-10-25T16:07:23.474746Z",
            "updated_at": "2025-03-27T02:02:09.822683Z",
            "deleted_at": null,
            "main_name": "Cobalt Group",
            "aliases": [
                "ATK 67",
                "Cobalt Gang",
                "Cobalt Spider",
                "Gold Kingswood",
                "Mule Libra",
                "TAG-CR3"
            ],
            "source_name": "ETDA:Cobalt Group",
            "tools": [
                "ATMRipper",
                "ATMSpitter",
                "Agentemis",
                "AmmyyRAT",
                "AtNow",
                "COOLPANTS",
                "CobInt",
                "Cobalt Strike",
                "CobaltStrike",
                "Cyst Downloader",
                "Fareit",
                "FlawedAmmyy",
                "Formbook",
                "Little Pig",
                "Metasploit Stager",
                "Mimikatz",
                "More_eggs",
                "NSIS",
                "Nullsoft Scriptable Install System",
                "Pony Loader",
                "Ripper ATM",
                "SDelete",
                "Siplog",
                "SoftPerfect Network Scanner",
                "SpicyOmelette",
                "Taurus Builder",
                "Taurus Builder Kit",
                "Taurus Loader",
                "Terra Loader",
                "ThreatKit",
                "VenomKit",
                "cobeacon",
                "win.xloader"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c11abba0-f5e8-4017-a4ee-acb1a7c8c242",
            "created_at": "2022-10-25T15:50:23.744036Z",
            "updated_at": "2025-03-27T02:00:55.537114Z",
            "deleted_at": null,
            "main_name": "Cobalt Group",
            "aliases": [
                "Cobalt Group",
                "GOLD KINGSWOOD",
                "Cobalt Gang",
                "Cobalt Spider"
            ],
            "source_name": "MITRE:Cobalt Group",
            "tools": [
                "Mimikatz",
                "More_eggs",
                "SpicyOmelette",
                "SDelete",
                "Cobalt Strike",
                "PsExec"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536036,
    "ts_updated_at": 1743041768,
    "ts_creation_date": 1653753507,
    "ts_modification_date": 1653753507,
    "files": {
        "pdf": "https://archive.orkl.eu/c6c7f9c1de356ec5d6eddaccc52f1c7a9ceadde5.pdf",
        "text": "https://archive.orkl.eu/c6c7f9c1de356ec5d6eddaccc52f1c7a9ceadde5.txt",
        "img": "https://archive.orkl.eu/c6c7f9c1de356ec5d6eddaccc52f1c7a9ceadde5.jpg"
    }
}