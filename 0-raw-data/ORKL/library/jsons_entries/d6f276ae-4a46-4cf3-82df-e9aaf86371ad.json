{
    "id": "d6f276ae-4a46-4cf3-82df-e9aaf86371ad",
    "created_at": "2023-01-12T15:01:10.204313Z",
    "updated_at": "2025-03-27T02:13:07.939586Z",
    "deleted_at": null,
    "sha1_hash": "c40cf44a9f34b11bd971d723d990ce55e063fff3",
    "title": "2022-08-19 - Is Tox The New C&C Method For Coinminers-",
    "authors": "",
    "file_creation_date": "2022-09-01T10:20:00Z",
    "file_modification_date": "2022-09-01T10:20:00Z",
    "file_size": 1091590,
    "plain_text": "# Is Tox The New C&C Method For Coinminers?\n\n**[uptycs.com/blog/is-tox-the-new-cc-method-for-coinminers](https://www.uptycs.com/blog/is-tox-the-new-cc-method-for-coinminers)**\n\n_Research by: Siddharth Sharma and Nischay Hedge_\n\nTox is a peer-to-peer serverless messaging system that uses NaCl for encryption and\ndecryption. Since itâ€™s serverless, it uses UDP and the DHT to find online peers, similar to\nwhat BitTorrent does. It is also meant to be anonymous, which means each user gets a\n[public key that also acts as their ID within the system. Tox has been used before by threat](https://unit42.paloaltonetworks.com/helloxd-ransomware/)\nactors as a contact method, but in this case, Tox is being used for remote administration. The\nUptycs threat research team recently found an ELF sample that acts as a bot and can run\nscripts on the victim machine using the Tox protocol.\n\n## Technical Overview\n\nThe binary found in the wild is a stripped but dynamic executable, making decompilation\neasier. The entire binary appears to be written in C, and has only statically linked the ctoxcore library.\n\nFigure 1 shows the decompiled main function of the sample or starting point:\n\n\n-----\n\n_Figure 1: main function_\n\nThe shell_script variable itself is suspicious, but it only kills certain programs that are known\nto infect linux servers. It also deletes the crontab, which is something frequently used for\npersistence. Highlighted (see figure 1) is a function called start_routine1 (decompilation in\nfigure 2), which opens a file with a random filename in /var/tmp/ (Figure 3) and dumps the\ncontents of shell_script in there and later executes it.\n\n\n-----\n\n_Figure 2: start_routine1_\n\n_Figure 3: The script that is dropped into /var/tmp/_\n\nThe dropped shell script contains commands to kill cryptominer related processes.\n\nstart_routine2 gets called via pthread_create in the main function, which appears to send the\noutput of every command over UDP to the Tox recipient.\n\n\n-----\n\n_Figure 4: start_routine2_\n\nThere are some bash commands (see Figure 5) that warrant attention. The dig command\nattempts to use resolver4.opendns.com as a DNS server and looks up myip.opendns.com,\n[something similar to this.](https://www.ptsecurity.com/ru-ru/research/pt-esc-threat-intelligence/space-pirates-tools-and-connections/)\n\nUsing curl -s -m 20 ifconfig.me, the IP address of the machine is saved into a variable named\nname_var and `cat /var/lib/dbus/machine-id` gives the hardware ID of the machine, which is\nalso stored into the same variable and further used in tox_self_set_name to set the name of\nthe user. Later, `nproc`, `uname -a` and `whoami` commands are run, which are then stored\ninto status_var, used in tox_self_set_status_message to set the status message of the user.\n\n\n-----\n\n_Figure 5: some of the main function_\n\n\n-----\n\n_Figure 6: rest of the main function_\n\nMoving on in the main function, we can see tox related functions tox_new,\ntox_self_set_name, and tox_self_set_status_message which are most likely used for tox\nsetup on the victim machine.\n\nIn Figure 6, tox_callback_friend_message, gets called which looks at the previous message\nfrom a friend, and decides what to do based on the message received.\n\nThere are three commands that are a part of the callback function(passed as arg to\ntox_callback_friend_message), as shown in Figure 7.\n\n`updatekilllist` updates the script executed in start_routine1, `execscript` runs the script ondemand, `getinfo` prints information, and `exit` quits the tox connection.\n\n\n-----\n\n_Figure 7: callback_func_\n\n## Conclusion\n\nWhile the discussed sample does not do anything explicitly malicious, we feel that it might be\na component of a coinminer campaign. We are observing it for the first time where Tox\nprotocol is used to run scripts onto the machine. We have seen attackers using Tox as a\ncommunication mechanism in the past, like in HelloXD ransomware, where the attacker used\nTox and onion-based messengers. Therefore, it becomes important to monitor the network\ncomponents involved in the attack chains.\n\n## IOC\n\n333a6b3cf226c55d4438c056e6c302fec3ec5dcf0520fc9b0ccee75785a0c8c5\n\n\n-----\n\n## To learn more about the latest threat research conducted by the Uptycs Team, check out our most recent threat bulletin below.\n\nTag(s): [Threat Hunting,](https://www.uptycs.com/blog/tag/threat-hunting) [Threat Intelligence,](https://www.uptycs.com/blog/tag/threat-intelligence) [Threat Research](https://www.uptycs.com/blog/tag/threat-research)\n\n## Uptycs Threat Research\n\nResearch and updates from the Uptycs Threat Research team.\n\nConnect with the author\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-19 - Is Tox The New C&C Method For Coinminers-.pdf"
    ],
    "report_names": [
        "2022-08-19 - Is Tox The New C&C Method For Coinminers-.pdf"
    ],
    "threat_actors": [
        {
            "id": "536ca49a-2666-4005-8a50-e552fc7e16ef",
            "created_at": "2023-11-21T02:00:07.375813Z",
            "updated_at": "2025-03-27T02:00:03.245695Z",
            "deleted_at": null,
            "main_name": "Webworm",
            "aliases": [
                "Space Pirates"
            ],
            "source_name": "MISPGALAXY:Webworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "8e385d36-06a2-4294-b3d3-01fe8e9d95f4",
            "created_at": "2022-10-25T16:07:24.219051Z",
            "updated_at": "2025-03-27T02:02:10.142803Z",
            "deleted_at": null,
            "main_name": "Space Pirates",
            "aliases": [
                "Erudite Mogwai",
                "Webworm"
            ],
            "source_name": "ETDA:Space Pirates",
            "tools": [
                "9002 RAT",
                "Agent.dhwf",
                "AngryRebel",
                "BH_A006",
                "Chymine",
                "Darkmoon",
                "Deed RAT",
                "Destroy RAT",
                "DestroyRAT",
                "Farfli",
                "Gen:Trojan.Heur.PT",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "Homux",
                "Hydraq",
                "Kaba",
                "Korplug",
                "McRAT",
                "MdmBot",
                "Moudour",
                "MyKLoadClient",
                "Mydoor",
                "PCRat",
                "PCShare",
                "POISONPLUG.SHADOW",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "ShadowPad Winnti",
                "SnappyBee",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Trochilus RAT",
                "XShellGhost",
                "Xamtrav",
                "Zupdax",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535670,
    "ts_updated_at": 1743041587,
    "ts_creation_date": 1662027600,
    "ts_modification_date": 1662027600,
    "files": {
        "pdf": "https://archive.orkl.eu/c40cf44a9f34b11bd971d723d990ce55e063fff3.pdf",
        "text": "https://archive.orkl.eu/c40cf44a9f34b11bd971d723d990ce55e063fff3.txt",
        "img": "https://archive.orkl.eu/c40cf44a9f34b11bd971d723d990ce55e063fff3.jpg"
    }
}