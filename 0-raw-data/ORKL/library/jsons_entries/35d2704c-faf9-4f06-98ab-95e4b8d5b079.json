{
    "id": "35d2704c-faf9-4f06-98ab-95e4b8d5b079",
    "created_at": "2023-01-12T15:11:04.714828Z",
    "updated_at": "2025-03-27T02:06:15.530611Z",
    "deleted_at": null,
    "sha1_hash": "29243a6ee25becfac902ba783ac1c1ea60f53a82",
    "title": "2020-08-20 - QakBot (QBot) Maldoc Campaign Introduces Two New Techniques into Its Arsenal",
    "authors": "",
    "file_creation_date": "2022-05-28T17:09:37Z",
    "file_modification_date": "2022-05-28T17:09:37Z",
    "file_size": 982456,
    "plain_text": "# QakBot (QBot) Maldoc Campaign Introduces Two New Techniques into Its Arsenal\n\n**[blog.morphisec.com/qakbot-qbot-maldoc-two-new-techniques](https://blog.morphisec.com/qakbot-qbot-maldoc-two-new-techniques)**\n\n[Tweet](https://twitter.com/share)\n\nMorphisec Labs has tracked a massive maldoc campaign delivering the QakBot/QBot\nbanking trojan, starting earlier this month. Qakbot leverages advanced techniques to evade\ndetection and hamper manual analysis of the threat. In this post we will mention two of those\ninteresting techniques.\n\n\n-----\n\nQakBot attacks typically include a malicious attachment to a phishing email. Often these are\nbare Microsoft Word documents attached to the spam email. This particular campaign\nfeatures a ZIP file; within the ZIP attachment is a Word document that includes macros within\nthe document. These macros execute a PowerShell script that then downloads the Qakbot\npayload from specific URLs.\n\nThis particular QakBot campaign also includes two new techniques: a bypass of the content\ndisarm and reconstruction (CDR) technology through zipping the Word document, and a\nbypass of child-parent pattern detection because Visual Basic is executed using Explorer.\n\n## QakBot Technical Analysis\n\nThe first step in the attack chain is a phishing email sent with a ZIP file attached. As in\nclassic phishing attacks, the email is designed to encourage the target to click on the file and\ndownload it. Though phishing through ZIP is very popular today and you would expect to find\nexecutable in the zip, in this case it was just a simple word phishing document. The question\nthen is why would an attacker send a document through zip and not directly? The reason is\nthat many content disarm and reconstruction (CDR) systems will strip a document delivered\nas an attachment from all the malicious artifacts. Sending a Word document in a ZIP file, as\nthe attacker does here, is a perfect way to bypass CDR systems.\n\nFigure 1: An example of the phishing email the target receives\n\nThe ZIP file contains a Microsoft Word document. The attackers use a common tactic to lure\nthe victim to enable macros: when the target downloads the file, it asks for the target to\nenable editing and then enable content in order to view the document.\n\n\n-----\n\nFigure 2: The maldoc asks for the target to enable editing and to enable content\n\nWhen we looked at the macros, we noticed two automatically triggered functions: AutoOpen\nand AutoClose. As the names suggest, these two functions activate when the document is\nopened and when the document is closed.\n\n\n-----\n\nFigure 3: The AutoOpen and AutoClose triggered functions\n\nThe AutoOpen function creates a decoy VBS file filled with some spaces in the ProgramData\n[directory, then triggers the AutoClose function by executing the command Application.Quit.](https://docs.microsoft.com/en-us/office/vba/api/word.application.quit(method))\n\nWhen triggered, the AutoClose function dumps all of the form caption into another VBS file in\nProgramData, which is then executed using the WScript.Shell Exec method with the\ncommand \"explorer.exe C:\\ProgramData\\Portes.vbs\" that is stored in the\nDefaultTargetFrame property. Executing through explorer.exe is simple but still very unique\nand will break many of the existing pattern recognition capabilities of different EDR products.\nThis may reduce the score of the attack just enough to stay under the radar.\n\nFigure 4: WScript.Shell\n\nWhen the script is executed, it dumps a couple of commands to a separate batch script and\nexecutes it. The batch script kills the WINWORD.exe process, and then runs a PowerShell\ncommand that iterates over several URLs. If active, it will download and execute the payload,\nwhich is QakBot(QBot). Last, the batch script deletes all of the artifacts from the infected\nmachine.\n\n\n-----\n\n## Conclusions\n\nMorphisec identified an increase in QakBot/QBot delivery during the last several months.\nEDRs / AVs have a hard time detecting distributed behaviour in which not a single process\ndoes something malicious but all the processes combined act in a malicious way. We\nidentified a similar execution in the delivery of other malwares such as Emotet, Tesla and\nmore.\n\nA proactive, prevention-first approach to cybersecurity is key to protecting your enterprise\nagainst these evasive threats. This approach includes hardening your environment or\ndeploying advanced preventive technology in your enterprise. The moving target defense\n[technology that underpins Morphisec Shield and](https://www.morphisec.com/products/morphisec-shield-threat-prevention) [Morphisec Guard immunizes your](https://www.morphisec.com/products/morphisec-guard-endpoint-protection)\nenterprise and protects you against advanced evasive threats such as QakBot.\n\nIOCs(SHA-1):\n\nDocs:\n\n8253ed3b08ab8996d471af5d25a7223d8c259f45\nbe852364d22d508f8ef601bb3bc9eac6bd98713b\nd772f78169d9ba175d22c8ecf1a0c3f0328ff6eb\n2bd118bb81b709b1013d7ffd8789f05d4e1f734f\n78f498003afb55d18207ab7bb22170c6c8c7ef98\n39d29aa254c55a5222ea0ec63dc22da67e3b483d\n295e604af22f8ced8fe5349765d345507fd3c079\n\nQakbot(QBot):\n\n791179b20d936cf76d885d1949d4a50a295b4918\ne36af99c29a474f82cd57f2736b9d1b5ecadfdfd\nb841a34ec95bd1c3d1afe6d578aadef9439f3c38\ne7480e6adb6af1c992bc91605e4bba682d76c43d\n952917654b5c0328a31c3bbd8c7bf7a70a4a82e7\n58b023e339a9557adbdbf0de63c0584500438b9b\n147101a88cc1fe91bac9161425986a1c1e15bc16\n\nURLs:\n\nhxxp://akindustrieschair.com/smuvtnrgvmd/55555.png\nhxxp://nashsbornik.com/rqzvoxtjyhw/555555.png\nhxxp://maplewoodstore.com/rmwclxnbeput/555555.png\nhxxp://akersblog.top/kipql/555555.png\nhxxp://all-instal.eu/mgpui/555555.png\nhxxp://ankaramekanlari.net/vmnzwr/555555.png\nhxxp://optovik.store/bkatah/555555.png\n\n\n-----\n\nhxxp://store.anniebags.com/qyvbyjaiu/555555.png\nhxxp://atsepetine.com/evuyrurweyib/555555.png\nhxxp://duvarsaatcisi.com/gbmac/555555.png\nhxxp://rijschoolfastandserious.nl/rprmloaw/111111.png\nhxxp://nanfeiqiaowang.com/tsxwe/111111.png\nhxxp://forum.insteon.com/suowb/111111.png\nhxxp://webtest.pp.ua/yksrpucvx/111111.png\nhxxp://quoraforum.com/btmlxjxmyxb/111111.png\nhxxp://quickinsolutions.com/wfqggeott/111111.png\nhxxp://bronco.is/pdniovzkgwwt/111111.png\nhxxp://studiomascellaro.it/wnzzsbzbd/111111.png\nhxxp://craniotylla.ch/vzufnt/111111.png\nhxxp://marineworks.eu/dwaunrsamlbq/111111.png\n\n[Contact SalesInquire via Azure](http://10.10.0.46/mailto:sales@morphisec.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-20 - QakBot (QBot) Maldoc Campaign Introduces Two New Techniques into Its Arsenal.pdf"
    ],
    "report_names": [
        "2020-08-20 - QakBot (QBot) Maldoc Campaign Introduces Two New Techniques into Its Arsenal.pdf"
    ],
    "threat_actors": [
        {
            "id": "068b67c8-604c-4272-b808-350413fa9ee3",
            "created_at": "2022-10-25T16:07:23.975708Z",
            "updated_at": "2025-03-27T02:02:10.058689Z",
            "deleted_at": null,
            "main_name": "Operation NightScout",
            "aliases": [],
            "source_name": "ETDA:Operation NightScout",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b5550c4e-943a-45ea-bf67-875b989ee4c4",
            "created_at": "2022-10-25T16:07:23.675771Z",
            "updated_at": "2025-03-27T02:02:09.918749Z",
            "deleted_at": null,
            "main_name": "Gelsemium",
            "aliases": [
                "Operation NightScout",
                "Operation TooHash"
            ],
            "source_name": "ETDA:Gelsemium",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agentemis",
                "BadPotato",
                "CHINACHOPPER",
                "China Chopper",
                "Chrommme",
                "Cobalt Strike",
                "CobaltStrike",
                "FireWood",
                "Gelsemine",
                "Gelsenicine",
                "Gelsevirine",
                "JuicyPotato",
                "OwlProxy",
                "Owowa",
                "SAMRID",
                "SessionManager",
                "SinoChopper",
                "SpoolFool",
                "SweetPotato",
                "WolfsBane",
                "cobeacon",
                "reGeorg"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536264,
    "ts_updated_at": 1743041175,
    "ts_creation_date": 1653757777,
    "ts_modification_date": 1653757777,
    "files": {
        "pdf": "https://archive.orkl.eu/29243a6ee25becfac902ba783ac1c1ea60f53a82.pdf",
        "text": "https://archive.orkl.eu/29243a6ee25becfac902ba783ac1c1ea60f53a82.txt",
        "img": "https://archive.orkl.eu/29243a6ee25becfac902ba783ac1c1ea60f53a82.jpg"
    }
}