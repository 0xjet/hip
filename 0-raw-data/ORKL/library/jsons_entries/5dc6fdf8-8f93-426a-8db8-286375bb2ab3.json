{
    "id": "5dc6fdf8-8f93-426a-8db8-286375bb2ab3",
    "created_at": "2023-01-12T15:08:22.291427Z",
    "updated_at": "2025-03-27T02:05:28.255773Z",
    "deleted_at": null,
    "sha1_hash": "cfe15ac845e29a338a972f4a1244a9166655819c",
    "title": "2020-08-24 - RATs and Spam- The Node.JS QRAT",
    "authors": "",
    "file_creation_date": "2022-05-28T15:19:21Z",
    "file_modification_date": "2022-05-28T15:19:21Z",
    "file_size": 1737945,
    "plain_text": "# RATs and Spam: The Node.JS QRAT\n\n**[trustwave.com/en-us/resources/blogs/spiderlabs-blog/rats-and-spam-the-nodejs-qrat/](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/rats-and-spam-the-nodejs-qrat/)**\n\nThe Qua or Quaverse Remote Access Trojan (QRAT) is a Java-based RAT that can be used to gain\ncomplete control over a system. Introduced in 2015, QRAT was marketed as an undetectable Java RAT\nand is offered under the software-as-a-service model. Just after its original debut, we blogged about\nQRATs being spammed. As shown in Figure 1, the functionality of the spammed QRATs can be\nextended through the plugins offered by Quaverse.\n\n\n-----\n\n_[Figure 1: The website of Quaverse, captured from the 2015 blog, offering plugins for QRATs](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/quaverse-rat-remote-access-as-a-service/)_\nRecently, we have encountered more spam campaigns that attempt to spread QRATs. The initial\nmalware contains a subscription account for QHub (user:<digits>@qhub_subscription[.]store[.]qua[.]one), a service that offers a single interface to control remote machines. Its_\ndomain qua.one contains the same logo as to Quaverse’s website we have seen way back in 2015.\n\n_Figure 2: The QHub service is offered as a Premium Service_\n\n## Malware Analysis\n\n_Figure 3: The spam campaign flow_\n\n## The JAR Downloader\n\nThis spam campaign using QRAT malware has multi-stage downloaders. The first one is a JAR file that\nmay arrive as an email attachment or can be downloaded from a link contained in a spam message. All\n[the JAR files we have collected related to this campaign are obfuscated using the Allatori Obfuscator –](http://www.allatori.com/)\nthe class names all have the same name and length but have different case.\n\n\n-----\n\n_Figure 4: The JAR attachment Spec#0034.jar is obfuscated with Allatori_\n\n_Figure 5: The HTML downloader attached to the malspam has link to the first stage downloader hosted_\n_in a cloud service platform_\n\nThe first downloader has 2 major functions. These are setting up the Node.Js platform onto the system,\nand then downloading and executing the second-stage downloader.\n\n\n-----\n\n_Figure 6: The code snippet of java.exe’s memory dump when the attachment Spec#0034.jar from_\n_Figure 4 was executed_\n\nFirstly, upon the execution of the JAR file, the process architecture of the system will be checked, and\nthat information will be used in downloading the appropriate Node.js for the machine. The JAR files we\nobserved downloaded Node.Js version 13.13.0 from https://nodejs.org/dist/v13.13.0/node-v13.13.0-win_<x86|x64>.zip and extracted its content at %userprofile%/qnode-node-v13.13.0-win-<x86|x64>.zip. The_\nJAR files were designed to run in Windows environments only.\n\nSecondly, the JAR file Spec#0034.jar downloaded wizard.js from its command and control servers\n(C&Cs) then saved it under the qnodejs folder located inside the Node.js installation path. Then, the\nJAR file executed wizard.js with the C&Cs and the QHub service subscription user as arguments, as\nshown in Figure 6.\n\n## The Node.Js Downloader\n\nThe downloaded file wizard.js is the second stage downloader written in Node.Js. This script file is\nresponsible for setting the persistence of this threat, and the downloading and execution of the payload.\nJust like the JAR file, this supports the Windows platform only. Without the arguments from the JAR file,\nthis script will not work.\n\nWe were able to obtain the file wizard.js, from hxxps://environment[.]theworkpc[.]com/scripts/wizard[.]js,\nthrough the JAR file from Figure 5. The file wizard.js is encrypted using Base64. Looking through its\ndecrypted code, this script has its own defined modules.\n\n_Figure 7: The code snippet of the downloaded second stage downloader_\n\n\n-----\n\n_Figure 8: The modules of wizard.js_\n\nThe first main function of wizard.js is to set its persistence. The file qnode-<8 hex>.cmd will serve as the\nautorun file and written in it are the same arguments that the JAR file downloader set on wizard.js (see\nFigure 6) appended with a “--delegate” command.\n\n_Figure 9: The two main functions of wizard.js_\n\nThen, based on the platform and architecture of the system its running on, wizard.js will download the\nmain malware. Using the C&Cs from the JAR file in Figure 4, we were able to download qnodejs-win32_ia32.js on 24-July-2020._\n\nBefore downloading, as shown in Figure 9, the script wizard.js verified the sha1 of the main malware\n_qnodejs-win32-ia32.js through the file qnodejs-win32-ia32.sha256. Lastly, the main malware was_\nexecuted using the same arguments supplied to wizard.js in Figure 6 plus a “serve” command after the\npath of qnodejs-win32-ia32.js.\n\n_Figure 10: The Node.Js process which executes the payload qnodejs-win32-ia32.js_\n\n## The Payload – Node.Js QRAT\n\n\n-----\n\nJust like the downloader wizard.js, the main payload qnode-win32-ia32.js is written in Node.Js, its code\nis encrypted with Base64, and it has its own written modules. It contains an encrypted Node.Js\npackages folder node_modules hence its size is almost 12KB.\n\nThe Node.Js script uses the string “qnode-service” as the node command name and requires the\narguments --central-base-url and --group when executed.\n\n_Figure 11: The help menu of the qnode-win32-ia32.js_\n\nThe QRAT qnode-win32-ia32.js has the following functionalities:\n\nobtain system information\nperform file operations\nacquire credentials of certain applications\n\nSome of the information, like the machine’s UUID, tags, and labels generated by the malware, will be\nwritten in the config file %userprofile%/<hex>-config.json. Meanwhile, the malware will use the service\n_hxxps://wtfismyip[.]com to obtain network information._\n\n_Figure 12: The filename of the config and error logs were prepended with the hex representation of the_\n_QHub subscription account shown in Figure 6_\n\n_Figure 13: Code snippet of the data retrieved from the service hxxps://wtfismyip[.]com/json_\n\n\n-----\n\n_Figure 14: The applications chrome, firefox, thunderbird, and outlook are supported in this QRAT’s_\n_password-recovery functionality_\n\nThis threat will communicate to its C&Cs through the Websocket connection protocol and below is the\nlist of commands related to the 3 functions of the QRAT qnode-win32-ia32.js file mentioned above.\n\n_Figure 15: List of commands_\n\n## Summary\n\nRemote access trojans are one of the commodity malware nowadays. With services like QHub, RATs\ncan be a more attractive instrument to the threat actors as the machines infected by the RATs can be\neasily monitored in an already available environment they offer. The QRAT and its downloader are\ncurrently supporting the windows platform for now. Since they leveraged Node.Js which is a crossplatform, there is a possibility that this threat will be enhanced to support other platforms in the future.\n\nIn terms of mitigation, we recommend blocking inbound emails with Java files outright at the email\n[gateway. We have also added protection for this threat to the Trustwave Secure Email Gateway for our](https://www.trustwave.com/en-us/services/technology/secure-email-gateway/)\ncustomers.\n\n## IOCs\n\n\n-----\n\nSpec#0034.jar (12139 bytes) SHA1: 36DA7F23828283B6EA323A46806811F8312DD468\nLegal_Proceeding_concerning_Overdue_invoices_pdf.jar (12,241 bytes) SHA1:\n42d843c74e304d91297e21e748f4b528df422316\nwizard.js (14433 bytes) SHA1: D6B1D3317C0D938C8AF21F1C22FD1B338A06B1C2\nqnodejs-win32-ia32.js (11916833 bytes) SHA1: 31F541074C73D02218584DF6C8292B80E6C1FF7D\n\nhxxps://legalproceedings[.]uc[.]r[.]appspot[.]com/Legal_Proceeding_concerning_Overdue_invoices_pdf[.]jar\nhxxps://rtdqhub[.]home-webserver[.]de/\nhxxps://rtdqhub[.]redirectme[.]net\nhxxps://environment[.]theworkpc[.]com\nhxxps://environment[.]spdns[.]org\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-24 - RATs and Spam- The Node.JS QRAT.pdf"
    ],
    "report_names": [
        "2020-08-24 - RATs and Spam- The Node.JS QRAT.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536102,
    "ts_updated_at": 1743041128,
    "ts_creation_date": 1653751161,
    "ts_modification_date": 1653751161,
    "files": {
        "pdf": "https://archive.orkl.eu/cfe15ac845e29a338a972f4a1244a9166655819c.pdf",
        "text": "https://archive.orkl.eu/cfe15ac845e29a338a972f4a1244a9166655819c.txt",
        "img": "https://archive.orkl.eu/cfe15ac845e29a338a972f4a1244a9166655819c.jpg"
    }
}