{
    "id": "b3fc34e9-7644-460f-bfef-e6f4e6068d49",
    "created_at": "2023-01-12T15:10:38.606347Z",
    "updated_at": "2025-03-27T02:06:14.308152Z",
    "deleted_at": null,
    "sha1_hash": "4ed0615d1f9ae9c0606848107d6f7881394f4183",
    "title": "2019-07-02 - LooCipher- The New Infernal Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T00:38:01Z",
    "file_modification_date": "2022-05-28T00:38:01Z",
    "file_size": 623503,
    "plain_text": "# LooCipher: The New Infernal Ransomware\n\n**[blog.yoroi.company/research/loocipher-the-new-infernal-ransomware/](https://blog.yoroi.company/research/loocipher-the-new-infernal-ransomware/)**\n\n07/02/2019\n\n## Introduction\n\n\nJuly 2, 2019\n\n\nA new Ransomware began to threats the digital world. This time using a nice but scary\nname: LooCipher. The name is at the same time an allusion to its capabilities (thank to the\nterm “Cipher”) and to the popular religious figure, Lucifer. Despite its evocative nickname, the\nfunctionalities of this malware are pretty straight forward, not very different from those\nbelonging to many other ransomware families, but digging into its internals we also found\nelements suggesting its operators could be able to run large scale campaigns.\n\n## Technical Analysis\n\nUnlike most ransomware, LooCipher uses a macro-weaponized document as dropper of the\nreal threat. We identified two different document files involved to deploy the ransomware,\nthey are called: “Info_BSV_2019.docm” and “Info_Project_BSV_2019.docm”. Both files are\nvery poor in design and contain a single text line inviting the user to enable macro execution.\n\nFigure 1. Document content\n\n\n-----\n\nExploring the content in-depth, we retrieved its minimal macro code payload: its only purpose\nis to download the ransomware from the\n_“hxxp://hcwyo5rfapkytajg.onion[.]pet/2hq68vxr3f.exe” dropurl and launch it._\n\nThe author did not care to obfuscate in any sophisticated way his malicious code, even some\ncomment strings like “//binary” and “//overwrite” are still visible.\n\nFigure 2. Macro code\nOnce run, it starts the encryption of all the victim’s files, except for the system and programs\nfolders: “Program Files”, “Program Files (x86)”, “Windows”. Obviously, this trick allows to\navoid the corruption of the files needed to start the operating system, letting the user login to\nits PC to see the ransom request.\n\nFigure 3. Ransomware excluded folders\nAfter a long files enumeration phase, the ransomware encrypts all files ending with the\nfollowing extensions:\n\n.jpg, .jpeg, .xml, .xsl, .wps, .cmf, .vbs, .accdb, .cdr, .svg, .conf, .config, .wb2, .msg, .azw,\n.azw1, .azw3, .azw4, .lit, .apnx, .mobi, .p12, .p7b, .p7c, .pfx, .pem, .cer, .key, .der, .mdb,\n.htm, .html, .class, .java, .asp, .aspx, .cgi, .php, .py, .jsp, .bak, .dat, .pst, .eml, .xps, .sqllite,\n.sql, .jar, .wpd, .crt, .csv, .prf, .cnf, .indd, .number, .pages, .x3f, .srw, .pef, .raf, .rf, .nrw, .nef,\n.mrw, .mef, .kdc, .dcr, .crw, .eip, .fff, .iiq, .k25, .crwl, .bay, .sr2, .ari, .srf, .arw, .cr2, .raw, .rwl,\n.rw2, .r3d, .3fr, .eps, .pdd, .dng, .dxf, .dwg, .psd, .png, .jpe, .bmp, .gif, .tiff, .gfx, .jge, .tga,\n.jfif, .emf, .3dm, .3ds, .max, .obj, .a2c, .dds, .pspimage, .yuv, .3g2, .3gp, .asf, .asx, .mpg,\n.mpeg, .avi, .mov, .flv, .wma, .wmv, .ogg, .swf, .ptx, .ape, .aif, .av, .ram, .m3u, .movie,\n.mp1, .mp2, .mp3, .mp4, .mp4v, .mpa, .mpe, .mpv2, .rpf, .vlc, .m4a, .aac, .aa3, .amr, .mkv,\n.dvd, .mts, .vob, .3ga, .m4v, .srt, .aepx, .camproj, .dash, .zip, .rar, .gzip, .mdk, .mdf, .iso,\n.bin, .cue, .dbf, .erf, .dmg, .toast, .vcd, .ccd, .disc, .nrg, .nri, .cdi, .ai, .doc, .docm, .docx,\n.dxg, .odb, .odm, .odp, .ods, .odt, .orf, .ppt, .pptm, .pptx, .rtf, .xlk, .xls, .xlsb, .xlsm, .xlsx,\n.pdf, .mobi, .epub, .sage\n\nDuring the encryption phase, for each file to be encrypted, the malware creates the\nencrypted copy of the files but it does not delete the original ones, rather it empties them and\nforces a 0-byte size.\n\nFigure 4. Example of ciphered file with empty original file\nIt is not clear if this mechanism derives from buggy code or it is a specific peculiarity of this\nmalware, intentionally introduced by the author.\n\nFigure 5. Actions during encryption phase\nWhen the encryption phase ends, it creates a FAQ folder within victim’s desktop reporting the\ninstructions to proceed with ransom payment in a “friendly” Q&A form.\n\nFigure 6. File containing the payment instructions\n\n\n-----\n\nAs stated in the payment instruction file, the victim has only five days to proceed with the\npayment. After this period, the key will be automatically destroyed, preventing any way to\nrecover the user content. Similar information is also displayed in the image set as\nbackground and into the interactive pop-up window.\n\nFigure 7. Background image and pop-up window reporting info about the payment\nAs soon as the encryption phase is ended, the malicious process contacts its C2 sending\ninformation about the infected machine and retrieving the BTC address to display in the popup window.\n\nFigure 8. Example of HTTP request to retrieve the BTC address\nThe C2 is hosted in the TOR Network, at the “hxxp://hcwyo5rfapkytajg[.]onion” address, so\nthe malware uses some services which act as proxies between the Darknet and clearnet to\neasily perform its malicious actions, avoiding the installation of TOR libraries on the victim\nmachine. The abused services are:\n\nThe request sent by the malware includes information like the User-ID assigned to the victim\nmachine during the encryption phase “u=rEui7jhIJk6SaRTyhL08N7h1Sft” and its public IP\naddress “i=xxx.xxx.xxx.xxx”. The C2 server replies specifying the BTC Address the user will\npay the requested amount to, for instance “BTC_ADDR:\n_16HDCwCuy2R5b7YFCmsidXzHQrvHmT7VHGG”._\n\nWe noticed that every time the ransomware contacts its C2 at the “k.php” resource, the\nserver generates a new BTC Address. Probably, the backend embeds a BTC wallet factory\nable to register a new wallet on the blockchain for each ransomware infection. This trick\nsurely allows to make more stealthy BTC transactions, avoiding a huge number of\ntransactions towards the same wallet and hardening the cash flow reconstruction. In the\nfollowing table we inserted some of the BTC addresses generated by the C2:\n\n1LhT45NdcrRBeFfxp67gcKteKp7K5BR374\n1QGq13GGdDtfUiBKLS4Re8fdYlVkK8Zbe\n1M1ZS5QfZ3Z3ufFagJ455QDqkMvHJhNkwT\n15XWd5ixtznsinWFZ9YEk8HUCaMqcm4SiZ\n1AUfa421Huj5Hmh5JDFmg36X8VmJPHy7LS\n17BvolK1P1kFQq7BPB4iNocisdqE6sEKkv\n1UwSDTuTkbPxQt7zglQVsigQunpxhL9Qk\n13YNF7U7VTt9DGw7QNWpTEGCrYEmV2qjcx\n1MPKAcpe8pnZubBQgUuw3k8wfkTB6sFYAT\n16HDCwCuy2RSb7YFCwwdXzHQrvilmT7VHGG\n...\n\n_Table. Example of Generated BTC Addresses_\n\nHowever, if the victim machine is offline the ransomware is not able to download the BTC\naddress to display in the window. For this reason, the malware also embeds a fallback\naddresses list to use when it fails to reach the C2\n\n\n-----\n\nFigure 9. Other BTC addresses embedded in ransomware binary\n\n1Ps5Vd9dKWuy9FuMDkec9qquCyTLjc2Bxe\n19YmdTjw7ZWHEDac8wWzCNdZT8oXsDedtV\n1CrdZvvtzrZTJ78k92XuPizhhgtDxQ8c4B\n1JHEqi4QsTWz4gB9qZTACP7JggJzAmf6eA\n1Azfk7fWwCRynRk8p7qupLqqaADsjwFm4N\n\n_Table. Hardcoded BTC Addresses on sample_\n\nAn interesting peculiarity of this ransomware is its capability to work both as encryptor and as\ndecryptor. The last answer of the instruction file, in fact, reports that the decryptor software is\nembedded into the ransomware binary in order to make the decryption process as simple as\npossible.\n\nIn fact, after the payment the victim can click on “Check Payment” button included in the popup window, and so, if the transaction has been confirmed, the “DECRYPT” button will be\nenabled. Moreover, if the user accidentally closes the pop-up window needed to trigger the\ndecryption, he can download a new copy of the ransomware and use it as decryptor. That\ncopy is hosted on the MEGA repository “hxxps://mega\n\n[.nz/#!KclRVIRY!YrUgGjvldsoTuNZbCOjebAz5La7hbB41nJHk1mlgqZo”.\n\nClicking the “Check Payment” button, the process sends a new HTTP request to its C2 to\n_“/d.php” in order to check if the payment related to the specific User-ID has been received._\n\nFigure 10. Example of HTTP request to check if the payment has been executed\nIn the specific case, the server replies with the “0” value, indicating the payment has not\nbeen approved, so the “DECRYPT” button will not be enabled. Moreover, if the contacted\nserver is down, the malware tries to reach its TOR C2 using one of the other abovementioned proxies, avoiding proxy service failures.\n\nFigure 11. HTTP-TOR proxy services used by the malware\n\n## Conclusion\n\nIn the nowadays, Ransomware is one of the quickest ways to monetize cyber-criminal\nactivities, and for this reason a wide-range of threat actors, including micro cyber-criminals,\nleverage these \"tools\" to threaten organizations and companies. LooCipher is a new entry in\nthis sector: it's a Ransomware family spreading through malicious emails embedding infected\nOffice documents, differently from the recent Sodinokibi campaign that used redirectors to\nland the victims on Exploit Kits infected pages (eg RIG EK).\n\nLooCipher encrypts all files on victim computer, it abuses Clearnet-to-Tor proxy services to\nconnect to its Command and Control hidden behind onion sites. Cybaze-Yoroi ZLAB advises\nto always keep a recent, tested and offline backup of all the business critical data.\n\n\n-----\n\n## Indicators of Compromise\n\nHashes:\n\nff24d9575694ae2a1e6a6101a2dbaa95dd1ab31b44a3931f6d6a62bbf5be2cbd\ne824650b66c5cdd8c71983f4c4fc0e1ac55cd04809d562f3b6b4790a28521486\n43cfb0a439705ab2bd7c46b39a7265ff0a14f7bd710b3e1432a9bdc4c1736c49\n924cc338d5d03f8914fe54f184596415563c4172679a950245ac94c80c023c7d\n\nDropURL:\n\nhxxp://hcwyo5rfapkytajg[.]onion/2hq68vxr3f.exe\nhxxp://hcwyo5rfapkytajg[.]onion/3agpke31mk.exe\nhxxp://hcwyo5rfapkytajg[.]onion/Info_BSV_2019.docm\nhxxp://hcwyo5rfapkytajg[.]onion/Info_Project_BSV_2019.docm\nhxxp://hcwyo5rfapkytajg.onion[.]pet/2hq68vxr3f.exe\nhxxp://hcwyo5rfapkytajg.onion[.]pet/3agpke31mk.exe\nhxxp://hcwyo5rfapkytajg.onion[.]pet/Info_BSV_2019.docm\nhxxp://hcwyo5rfapkytajg.onion[.]pet/Info_Project_BSV_2019.docm\nhxxps://hcwyo5rfapkytajg.darknet[.]to/2hq68vxr3f.exe\nhxxps://hcwyo5rfapkytajg.darknet[.]to/3agpke31mk.exe\nhxxps://hcwyo5rfapkytajg.darknet[.]to/Info_BSV_2019.docm\nhxxps://hcwyo5rfapkytajg.onion[.]sh/2hq68vxr3f.exe\nhxxps://hcwyo5rfapkytajg.onion[.]sh/3agpke31mk.exe\nhxxps://hcwyo5rfapkytajg.onion[.]sh/Info_BSV_2019.docm\nhxxps://hcwyo5rfapkytajg.onion[.]ws/2hq68vxr3f.exe\nhxxps://hcwyo5rfapkytajg.onion[.]ws/3agpke31mk.exe\nhxxps://hcwyo5rfapkytajg.onion[.]ws/Info_BSV_2019.docm\nhxxps://hcwyo5rfapkytajg.tor2web[.]xyz/2hq68vxr3f.exe\nhxxps://hcwyo5rfapkytajg.tor2web[.]xyz/3agpke31mk.exe\nhxxps://hcwyo5rfapkytajg.tor2web[.]xyz/Info_BSV_2019.docm\n\nC2s:\n\nhxxp://hcwyo5rfapkytajg.onion[.]pet/k.php\nhxxp://hcwyo5rfapkytajg.onion[.]pet/d.php\nhxxps://hcwyo5rfapkytajg.darknet[.]to/k.php\nhxxps://hcwyo5rfapkytajg.darknet[.]to/d.php\nhxxps://hcwyo5rfapkytajg.onion[.]sh/k.php\nhxxps://hcwyo5rfapkytajg.onion[.]sh/d.php\nhxxps://hcwyo5rfapkytajg.onion[.]ws/k.php\nhxxps://hcwyo5rfapkytajg.onion[.]ws/d.php\nhxxps://hcwyo5rfapkytajg.tor2web[.]xyz/k.php\nhxxps://hcwyo5rfapkytajg.tor2web[.]xyz/d.php\n\n\n-----\n\n### Yara Rules\n```\nimport \"pe\"\nrule LooCipher_dropper_1906 {\nmeta:\n     description = \"Yara Rule for LooCipher ransomware .docm dropper\"\n     author = \"Cybaze - Yoroi ZLab\"\n     last_updated = \"2019-06-21\"\n     tlp = \"white\"\n     category = \"informational\"\nstrings:\n     $s1 = {FF FD 72 77 6D 3A 3F 96 45 70 00 63 85 92 19 8A}\n     $s2 = {35 58 34 CB AF AF 52 A6 13 A6 0C BC 18 A5 C1 38}\n     $a1 = { 50 4B 03 04 }\ncondition:\n     $a1 and 1 of ($s*)\n}\nrule LooCipher_1906 {\nmeta:\n     description = \"Yara Rule for LooCipher ransomware\"\n     author = \"Cybaze - Yoroi ZLab\"\n     last_updated = \"2019-06-21\"\n     tlp = \"white\"\n     category = \"informational\"\nstrings:\n     $s1 = \".lcphr\"\n     $s2 = \"hcwyo5rfapkytajg\"\n     $s3 = \"LooCipher_wallpaper.bmp\"\n     $a1 = { 4D 5A }\ncondition:\n     $a1 and 1 of ($s*) and pe.sections[6].name == \".00cfg\"\n}\n\n```\n_This blog post was authored by Antonio Farina, Antonio Pirozzi and Luca Mella of Cybaze-_\n_Yoroi Z-LAB_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-07-02 - LooCipher- The New Infernal Ransomware.pdf"
    ],
    "report_names": [
        "2019-07-02 - LooCipher- The New Infernal Ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536238,
    "ts_updated_at": 1743041174,
    "ts_creation_date": 1653698281,
    "ts_modification_date": 1653698281,
    "files": {
        "pdf": "https://archive.orkl.eu/4ed0615d1f9ae9c0606848107d6f7881394f4183.pdf",
        "text": "https://archive.orkl.eu/4ed0615d1f9ae9c0606848107d6f7881394f4183.txt",
        "img": "https://archive.orkl.eu/4ed0615d1f9ae9c0606848107d6f7881394f4183.jpg"
    }
}