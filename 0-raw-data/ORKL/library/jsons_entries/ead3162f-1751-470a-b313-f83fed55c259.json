{
    "id": "ead3162f-1751-470a-b313-f83fed55c259",
    "created_at": "2023-01-12T15:02:28.451641Z",
    "updated_at": "2025-03-27T02:15:35.495409Z",
    "deleted_at": null,
    "sha1_hash": "c4b1235f85bac9f5da5941a08fb9c3a2f005d1b2",
    "title": "2021-06-14 - Behind the scenes of business email compromise- Using cross-domain threat data to disrupt a large BEC campaign",
    "authors": "",
    "file_creation_date": "2022-05-28T23:12:16Z",
    "file_modification_date": "2022-05-28T23:12:16Z",
    "file_size": 728311,
    "plain_text": "# Behind the scenes of business email compromise: Using cross-domain threat data to disrupt a large BEC campaign\n\n**microsoft.com/security/blog/2021/06/14/behind-the-scenes-of-business-email-compromise-using-cross-domain-threat-**\ndata-to-disrupt-a-large-bec-infrastructure/\n\nJune 14, 2021\n\nMicrosoft 365 Defender researchers recently uncovered and disrupted a large-scale\nbusiness email compromise (BEC) infrastructure hosted in multiple web services. Attackers\nused this cloud-based infrastructure to compromise mailboxes via phishing and add\nforwarding rules, enabling these attackers to get access to emails about financial\ntransactions.\n\nIn this blog, we’ll share our technical analysis and journey of unraveling this BEC operation,\nfrom the phishing campaign and compromised mailboxes to the attacker infrastructure. This\nthreat highlights the importance of building a comprehensive defense strategy, which should\ninclude strong pre-breach solutions that can prevent attackers from gaining access and\ncreating persistence on systems in the first place, as well as advanced post-breach\ncapabilities that detect malicious behavior, deliver rich threat data, and provide sophisticated\nhunting tools for investigating and resolving complex cyberattacks.\n\nThis investigation also demonstrates how cross-domain threat data, enriched with expert\ninsights from analysts, drives protection against real-world threats, both in terms of detecting\n[attacks through products like Microsoft Defender for Office 365, as well as taking down](https://www.microsoft.com/en-us/microsoft-365/security/office-365-defender)\noperations and infrastructures.\n\n\n-----\n\nThe use of attacker infrastructure hosted in multiple web services allowed the attackers to\noperate stealthily, characteristic of BEC campaigns. The attackers performed discrete\nactivities for different IPs and timeframes, making it harder for researchers to correlate\nseemingly disparate activities as a single operation. However, even with the multiple ways\nthat the attackers tried to stay under the radar, [Microsoft 365 Defender’s cross-domain](https://www.microsoft.com/en-us/microsoft-365/security/microsoft-365-defender)\nvisibility uncovered the operation.\n\n_Figure 1. Signals from Microsoft 365 Defender services that researchers correlated to_\n_expose the BEC attack_\n\nThis depth and breadth of this visibility is especially critical in detecting and stopping BEC\nbecause these attacks have minimal footprint, create very low signals that don’t rise to the\ntop of a defender’s alert list, and tend to blend in with the usual noise of corporate network\ntraffic. BEC attacks unfortunately can stay undetected until they cause real monetary loss\nbecause of limited or partial visibility provided by security solutions that don’t benefit from\ncomprehensive visibility into email traffic, identities, endpoints, and cloud behaviors, and the\nability to combine together isolated events and deliver a more sophisticated cross-domain\ndetection approach. Armed with intelligence on phishing emails, malicious behavior on\nendpoints, activities in the cloud, and compromised identities, Microsoft researchers\nconnected the dots, gained a view of the end-to-end attack chain, and traced activities back\nto the infrastructure.\n\nDisrupting BEC operations is one of the areas of focus of Microsoft’s Digital Crimes Unit\n(DCU), which works with law enforcement and industry partners to take down operational\ninfrastructure used by cybercriminals. For the specific BEC operation discussed in this blog,\nindustry partnership was critical to the disruption. As our research uncovered that attackers\nabused cloud service providers to perpetrate this campaign, we worked with Microsoft Threat\nIntelligence Center (MSTIC) to report our findings to multiple cloud security teams, who\nsuspended the offending accounts, resulting in the takedown of the infrastructure.\n\n\n-----\n\n## Initial access via phishing\n\nUsing Microsoft 365 Defender threat data, we correlated the BEC campaign to a prior\nphishing attack. The credentials stolen at this stage were used by the attackers to access\ntarget mailboxes. It’s important to note that multi-factor authentication (MFA) blocks attackers\nfrom signing into mailboxes. Attacks like this can be prevented by enabling MFA.\n\nOur analysis shows that shortly before the forwarding rules were created, the mailboxes\nreceived a phishing email with the typical voice message lure and an HTML attachment. The\nemails originated from an external cloud provider’s address space.\n\n_Figure 2. Sample phishing email used to steal credential to be used for BEC attack_\n\nThe HTML attachment contained JavaScript that dynamically decoded an imitation of the\nMicrosoft sign-in page, with the username already populated.\n\n\n-----\n\n_Figure 3. Phishing page with user name prepopulated_\n\nWhen the target user entered their password, they were presented with animations and,\neventually, a “File not found message”.\n\n\n-----\n\n_Figure 4. Phishing page with animation before eventually serving a fake error_\n\nMeanwhile, in the background, the JavaScript transmitted the credentials to the attackers via\na redirector also hosted by an external cloud provider.\n\n\n-----\n\n_Figure 5. JavaScript code used to send stolen credentials to attackers_\n\n## Persistence and exfiltration\n\nHaving already gained access to mailboxes via the credential phishing attack, attackers\n[gained persistent data exfiltration channel via email forwarding rules (MITRE T114.003).](https://attack.mitre.org/techniques/T1114/003/)\nDuring the course of our investigation of this campaign, we saw hundreds of compromised\nmailboxes in multiple organizations with forwarding rules consistently fitting one of patterns\nbelow:\n\n**Mailbox rule name** **Condition**\n\n**o365 default** If Body contains\n\n_invoice_\n_payment_\n_statement_\n\nForward the email to\n\n_ex@exdigy[.]net_\n\n**o365 (del)** If Body contains ex@exdigy[.]net delete message\n\n**Mailbox rule name** **Condition**\n\n**o365 default** If Body contains\n\n_invoice_\n_payment_\n_statement_\n\nForward the email to\n\n_in@jetclubs[.]biz_\n\n**o365 (del)** If Body contains in@jetclubs[.]biz delete message\n\nThese forwarding rules allowed attackers to redirect financial-themed emails to the attackercontrolled email addresses ex@exdigy.net and in@jetclubs.biz. The attackers also added\nrules to delete the forwarded emails from the mailbox to stay stealthy.\n\n\n-----\n\n_Figure 6. Alert in Microsoft 365 security center showing detection of forwarding rule creation_\n\n## BEC infrastructure in the cloud\n\nOur analysis revealed that the attack was supported by a robust cloud-based infrastructure.\nThe attackers used this infrastructure to automate their operations at scale, including adding\nthe rules, watching and monitoring compromised mailboxes, finding the most valuable\nvictims, and dealing with the forwarded emails.\n\nThe attackers took steps to make it harder for analysts to connect their activities to one\noperation, for example, running distinct activities for different IPs and timeframes. The attack,\nhowever, was conducted from certain IP address ranges. We saw these commonalities in the\nuser agents:\n\nCredentials checks with user agent “BAV2ROPC”, which is likely a code base using\nlegacy protocols like IMAP/POP3, against Exchange Online. This results in an ROPC\nOAuth flow, which returns an “invalid_grant” in case MFA is enabled, so no MFA\nnotification is sent.\nForwarding rule creations with Chrome 79.\nEmail exfiltration with an POP3/IMAP client for selected targets.\n\nWe observed the above activities from IP address ranges belonging to an external cloud\nprovider, and then saw fraudulent subscriptions that shared common patterns in other cloud\nproviders, giving us a more complete picture of the attacker infrastructure.\n\nThe attackers used a well-defined worker structure in the VMs, where each VM executed\nonly a specific operation, which explains why activities originated from different IP sources.\nThe attackers also set up various DNS records that read very similar to existing company\ndomains. These are likely used to blend into existing email conversations or used for more\ntailored phishing campaign against specific targets.\n\n\n-----\n\nThe attackers pulled various tools on the VMs. One of the tools was called EmailRuler, a\n[C# application that uses ChromeDriver to automatically manipulate the compromised](https://chromedriver.chromium.org/)\nmailboxes. The stolen credentials and the state of the mailbox compromised are stored in a\nlocal MySQL database as well as the state of the mailbox compromise.\n\n_Figure 7. Decompilation of EmailRuler tool_\n\nIn addition, we also observed that on selected compromised user accounts, the attackers\nattempted to pull emails from the mailbox. A tool called “Crown EasyEmail” in the attacker’s\nVMs was likely used for this activity, consistent with the observation of using a POP3/IMAP\nclient.\n\n## Defending against BEC and cloud-based attacker infrastructure with Office 365\n\nBusiness email compromise is a constant threat to enterprises. As this research shows, BEC\nattacks are very stealthy, with attackers hiding in plain sight by blending into legitimate traffic\nusing IP ranges with high reputation and by conducting discrete activities at specific times\nand connections.\n\nMicrosoft empowers organizations to comprehensively defend multiplatform and multicloud\nenvironments against these types of attacks through a wide range of cross-domain solutions\nthat include advanced pre-breach and post-breach protection capabilities. External email\nforwarding is now disabled by default in Office 365, significantly reducing the threat of BEC\ncampaigns that use this technique, while giving organizations the flexibility to control external\nforwarding. Organizations can further reduce their attack surface by reducing or disabling the\nuse of [legacy protocols like POP3/IMAP and enable multi-factor authentication for all users.](https://docs.microsoft.com/en-US/exchange/troubleshoot/user-and-shared-mailboxes/pop3-imap-owa-activesync-office-365)\n\nAs [BEC attacks continue to increase in scope and sophistication, organizations need](https://www.microsoft.com/security/blog/2021/05/06/business-email-compromise-how-microsoft-is-combating-this-costly-threat/)\nadvanced and comprehensive protection like that provided by Microsoft Defender for Office\n365. Microsoft Defender for Office 365 protects against email threats using its multi-layered\nemail filtering stack which includes edge protection sender intelligence content filtering\n\n\n-----\n\nand post-delivery protection. It uses AI and machine learning to detect anomalous account\nbehavior, as well as emails that utilize user and domain impersonation. In addition to\ndisabling external forwarding by default, Microsoft Defender for Office 365 raises alerts for\ndetected suspicious forwarding activity, enabling security teams to investigate and remediate\nattacks. Features like Attack simulation training further helps organizations improve user\nawareness on phishing, BEC, and other threats.\n\n_Figure 8. Sample suspicious email forwarding activity alert in Microsoft Defender for Office_\n_365_\n\nSignals from Microsoft Defender for Office 365 informs Microsoft 365 Defender, which\ncorrelates cross-domain threat intelligence to deliver coordinated defense. Expert insights\nfrom researchers who constantly monitor the threat landscape help enrich this intelligence\nwith an understanding of attacker behaviors and motivations. AI and machine learning\ntechnologies in our security products use this intelligence to protect customers. These\nsignals and insights also enable us to identify and take action on threats abusing cloud\nservices. The resulting takedown of this well-organized, cross-cloud BEC operation by\nmultiple cloud security teams stresses the importance of industry collaboration in the fight\nagainst attacks and improving security for all.\n\nLearn how Microsoft is combating business email compromise, one of the costliest security\nthreats.\n\nStop attacks through automated, cross-domain security and built-in AI with Microsoft\nDefender 365.\n\n**_Stefan Sellmer, Microsoft 365 Defender Research Team_**\n\n**_Nick Carr, Microsoft Threat Intelligence Center (MSTIC)_**\n\n\n-----\n\n### Advanced hunting query\n\nRun the following query to locate forwarding rules:\n```\nlet startTime = ago(7d);\nlet endTime = now();\nCloudAppEvents\n| where Timestamp between(startTime .. endTime)\n| where ActionType == \"New-InboxRule\"\n| where (RawEventData contains \"ex@exdigy.net\" or RawEventData contains\n\"in@jetclubs.biz\")\nor\n(RawEventData has_any(\"invoice\",\"payment\",\"statement\") and RawEventData has\n\"BodyContainsWords\")\n| project Timestamp, AccountDisplayName, AccountObjectId, IPAddress\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-14 - Behind the scenes of business email compromise- Using cross-domain threat data to disrupt a large BEC campaign.pdf"
    ],
    "report_names": [
        "2021-06-14 - Behind the scenes of business email compromise- Using cross-domain threat data to disrupt a large BEC campaign.pdf"
    ],
    "threat_actors": [
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535748,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1653779536,
    "ts_modification_date": 1653779536,
    "files": {
        "pdf": "https://archive.orkl.eu/c4b1235f85bac9f5da5941a08fb9c3a2f005d1b2.pdf",
        "text": "https://archive.orkl.eu/c4b1235f85bac9f5da5941a08fb9c3a2f005d1b2.txt",
        "img": "https://archive.orkl.eu/c4b1235f85bac9f5da5941a08fb9c3a2f005d1b2.jpg"
    }
}