{
    "id": "c463b2e3-3fdf-4024-b155-db0841ce49f1",
    "created_at": "2023-01-12T14:59:46.659811Z",
    "updated_at": "2025-03-27T02:13:16.638127Z",
    "deleted_at": null,
    "sha1_hash": "1ef4b4244d0267aa7eaa96ca691d7e2c3bce52a5",
    "title": "2022-02-23 - Dridex bots deliver Entropy ransomware in recent attacks",
    "authors": "",
    "file_creation_date": "2022-05-27T21:54:34Z",
    "file_modification_date": "2022-05-27T21:54:34Z",
    "file_size": 1141822,
    "plain_text": "# Dridex bots deliver Entropy ransomware in recent attacks\n\n**[news.sophos.com/en-us/2022/02/23/dridex-bots-deliver-entropy-ransomware-in-recent-attacks/](https://news.sophos.com/en-us/2022/02/23/dridex-bots-deliver-entropy-ransomware-in-recent-attacks/)**\n\nAndrew Brandt February 23, 2022\n\nA pair of incidents at different organizations in which attackers deployed a ransomware\ncalled Entropy were preceded by infections with tools that provided the attackers with\nremote access — Cobalt Strike beacons and Dridex malware — on some of the targets’\ncomputers, before the attackers launched the ransomware.\n\nSophos analysts hadn’t encountered Entropy prior to these incidents. Notably, there were\nsignificant differences in the methodologies employed by the attackers between both cases:\nHow the attackers gained a foothold in the targets; the time the attackers spent inside the\ntarget’s network; and the malware that was used to prepare the final phase of the attack\nwere substantially different.\n\nSome aspects of the attacks were consistent: In both cases, the attackers relied heavily on\nCobalt Strike as a means to infect more machines, meeting variable levels of success\ndepending on whether the target had protection installed on a given machine. The attackers\nalso performed redundant exfiltration of private data to more than one cloud storage provider.\nDuring a forensic analysis, we encountered multiple instances of Dridex, the well-known,\ngeneral-purpose malware that its operators can use to distribute other malware.\n\n\n-----\n\nThe Entropy ransom note\nIn the first incident, the attackers exploited the ProxyShell vulnerability on the network\nbelonging to a North American media organization, to install a remote shell on the target’s\nExchange server, and leveraged that to spread Cobalt Strike beacons to other computers.\nOver a four-month period, the attackers took their time probing the organization, and stealing\ndata, before launching the attack at the beginning of December. Subsequent post-attack\nforensics revealed several Dridex payloads on some of the infected machines.\n\nAnalysis of the second Entropy attack — this time on a regional government organization —\nrevealed that a malicious email attachment had infected a user’s computer with the Dridex\nbotnet Trojan, and that the attackers used Dridex to deliver additional malware (as well as\nthe commercial remote access utility ScreenConnect) and move laterally within the target’s\nnetwork. Significantly, in this second attack, only about 75 hours passed between the initial\ndetection of a suspicious login attempt on a single machine and the attackers commencing\ndata exfiltration from the target – installing, then using WinRAR to compress files into\narchives, then uploading the archives to a variety of cloud storage providers,\nincluding privatlab.com, dropmefiles.com, and mega.nz.\n\n\n-----\n\nAnd while not all machines on either organization s networks had endpoint protection\ninstalled prior to the attack, on the ones where protection existed, the attackers\nunsuccessfully attempting to execute the ransomware turned up an intriguingly coincidental\ndetection signature: The packer code used to protect the Entropy ransomware was picked up\nby a detection signature (Mal/EncPk-APX) that analysts had previously created to detect the\npacker code employed by Dridex.\n\nUnder additional reverse-engineering scrutiny, SophosLabs analysts discovered that some of\nthe other subroutines the ransomware uses to obfuscate its behavior (and make it harder for\nanalysts to study it) were reminiscent of subroutines used for similar functions in Dridex –\nthough not conclusively, and not without a lot of effort to strip away other obfuscations that\ncomplicated the code-comparison process.\n\n## Attacker behavior and use of free and commercial tools\n\nThe ransomware attackers in both cases used freely-available tools like the Windows\n[Sysinternals tools PsExec and](https://docs.microsoft.com/en-us/sysinternals/downloads/psexec) [PsKill, and the utility](https://docs.microsoft.com/en-us/sysinternals/downloads/pskill) [AdFind, which is designed to let IT](http://www.joeware.net/freetools/tools/adfind/)\nadmins query Active Directory servers. They also used the free compression utility WinRAR\nto package up collections of private data they stole, and then uploaded it to a variety of cloud\nstorage providers using the Chrome browser.\n\nThese tactics are, unfortunately, quite common among ransomware threat actors. Endpoint\nprotection tools don’t typically block the use of these and other utility programs since they do\nhave legitimate uses.\n\nThe attackers, in both cases, tried repeatedly (and unsuccessfully) to load and launch Cobalt\nStrike remote control tools on machines during the final phase of the attack. In the second\nattack, after multiple failed attempts to use Cobalt Strike, they also tried to install Metasploit’s\nMeterpreter on some machines, and eventually decided to install a commercial remote\naccess tool called ScreenConnect. The attackers attempted to use file-sharing tools within\nScreenConnect to push Cobalt Strike down to the protected machines, but ultimately failed.\n\nEventually, the attackers dropped a set of files onto an Active Directory server they had\ntaken control of. The threat actor dropped these files in C:\\share$:\n\n**comps.txt – List of hosts to attack.**\n**pdf.dll – The ransomware payload**\n**PsExec.exe – a legitimate application by Microsoft**\n**COPY.bat – Instructions to copy pdf.dll to all the hosts using PsExec**\n**EXE.bat – Instructions to execute pdf.dll to all the hosts using PsExec**\n\nThey then ran the COPY batch script followed by the EXE batch script.\n\n## Comparing subroutines in Dridex and Entropy\n\n\n-----\n\nThe Entropy samples in both cases were delivered in the form of Windows DLL files\ncompiled for a 32-bit architecture. Dridex payloads were recovered from various systems in\nboth an EXE and DLL format, compiled for 32-bit and 64-bit architectures. We looked at the\n32-bit Dridex bots for our comparison.\n\nThe threat actors had compiled custom versions of the Entropy ransomware DLL for each\ntargeted organization. The malware contains hardcoded references to the targeted\norganization in its code, including text and images later used in an HTML ransom note\ndropped on infected machines.\n\nThe ransom note cautions victims not to contact police or the FBI (“They won’t listen to You\nneither they care about your business”) or to hire ransom negotiators or data recovery firms\n(“They think they good in negotioations, but they’re not. They will take your money, have a\nsmall chit-chat with us by their pathetic scripts (oh yes, we know almost all of their lines) and\n[FAIL.”) with the word FAIL linking to a 2019 investigation by ProPublica that reported how](https://features.propublica.org/ransomware/ransomware-attack-data-recovery-firms-paying-hackers/)\nsome companies who claim to specialize in ransomware data recovery just pay the ransom.\n\nAttackers executed it using a command line that passed two parameters to the DLL; The first\nis a standard function call, DllRegisterServer, but the second parameter was a randomlooking string of characters that serve as a sort of password: The ransomware wouldn’t run\nproperly without it.\n\nFortunately, we were able to find the precise command the attackers used to launch the\nmalware, so we could study the samples in a controlled environment. Entropy’s execution\ncommand looked like this:\n```\nregsvr32 c:\\users\\public\\xyz.dll DllRegisterServer <20 random characters>\n\n```\nRansomware necessarily would have significant functional differences from a more generalpurpose botnet bot like Dridex, which complicates a line-by-line comparison. Instead, we\nstudied aspects of the code both malware apparently use in an attempt to complicate\nanalysis: The packer code, which prevents easy static analysis of the underlying malware; a\nsubroutine that the programs use to conceal the API calls they make; and a subroutine that\ndecrypts encrypted text strings embedded within the malware.\n\n## Entropy’s Packer behavior\n\nThe packer Entropy uses works in two stages to decompress the program code: In the first\nlayer, it allocates some memory, then copies the encrypted data to that memory space and\nthe packer transfers execution to the first layer. Next, the packer decrypts the code into\nanother portion of the same memory allocation where it stored the encrypted data, and then\ntransfers the execution to this second layer.\n\n\n-----\n\nThe instructions that dictate how Entropy performs the first layer of unpacking are similar\nenough to Dridex that the analyst who looked at the packer code, and in particular the\nportion that refers to an API called LdrLoadDll — and that subroutine’s behavior, described it\nas “very much like a Dridex v4 loader,” and compared it to a similar loader used by a Dridex\nsample from 2018. The behavior in question has been highlighted in other vendors’ research\nabout Dridex. Specifically, it is looking for a DLL named snxhk.dll, which is a memory\nprotection component of another company’s endpoint security product, in order to sabotage\nthat protection.\n\nNotably, Sophos has had a static detection for the Dridex packer in our endpoint products for\nsome time. The signature name is Mal/EncPk-APX, which is notable because telemetry\nshows that during these incidents, machines protected by Sophos made a detection of that\npacker when Entropy, but not Dridex, was present.\n\nAnother SophosLabs manager also had notes about detections of this particular packer code\non Sophos-protected machines where attackers had unsuccessfully attempted to run the\nransomware called DoppelPaymer. That ransomware, whose origin (like Dridex) has been\nattributed to the gang known as Evil Corp, was in use from about April, 2019 until May, 2021.\nAfter the US Department of the Treasury Office of Foreign Asset Control (OFAC) sanctioned\nEvil Corp over Dridex in December, 2019, the group went through a rapid set of name and\nbranding changes to their ransomware, cycling through many names including\nWastedLocker, Hades, Phoenix, Grief, Macaw, and now, possibly, Entropy.\n\n## Vectored Exception Handler subroutine\n\nOnce the malware has unpacked itself, the packer’s final act is to start up the malware at a\nmemory location known as the entrypoint, which is where the first instructions the malware\nexecutes begin. In both the case of Dridex and Entropy, the entrypoint code sets up a\nprocess called a Vectored Exception Handler (VEH), which is another form of anti-analysis\nwrinkle that malware authors may insert into the final product. A VEH sets up an alternate\nway for the program to invoke API calls in the operating system, which makes it harder for an\nanalyst to see exactly what the code is doing on any given instruction.\n\nUsing VEHs for this purpose is nonstandard behavior for benign programs, so its very\npresence is a weak heuristic for maliciousness, and a stronger indicator of Dridex, since it\nhas used the VEH technique for some time. However, the analyst notes, while the VEH code\nis definitely the same in both Dridex and Entropy, “weirdly, I am *not* seeing that code being\nused by Entropy.”\n\n## Entropy string decoding and API resolving subroutines\n\nWe also looked at two other aspects of the ransomware’s behavior and compared it to similar\nsubroutines found in Dridex. One of these subroutines is used to decode encrypted strings\nembedded in the malware.\n\n\n-----\n\nIn this side-by-side comparison, the Dridex form of this subroutine appears on the left, and\nthe Entropy form appears on the right. The analyst who looked at these examples had to\nsignificantly clean up the code in order to produce this side-by-side comparison. They\ndescribed the string decryption logic as fundamentally similar code flow and logic, but “with a\nbit of optimization” in the Entropy version.\n\nLikewise, the analyst compared the source code for subroutines Dridex and Entropy use to\nresolve API calls. While there are small differences (Dridex takes two hash values as input,\nwhile Entropy only takes one), the analysts say the logic for “walking” (navigating through\nevery available API) then parsing the Process Environment Block (PEB) and modulelist,\nlooks remarkably similar.\n\n\n-----\n\nIn summary, this behavior of walking the structures to get the base DLL name, and\n[eventually their function addresses — using PEB_LDR_DATA and](https://docs.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb_ldr_data)\n[LDR_DATA_TABLE_ENTRY — is a behavioral trait shared by both Entropy and Dridex.](https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/api/ntldr/ldr_data_table_entry.htm)\n\nAnother notable detail, almost too insignificant to mention, is that the decrypted strings from\nthe ransomware contain a line of text that starts with the targeted organization’s name,\nfollowed by “…falls apart. Entropy Increases.” This doesn’t appear in the ransom note, or\nanywhere else, only inside the binary. This appears to be a reference to a line in the 2005\nyoung adult fiction novel Looking For Alaska by John Green: “Entropy increases. Things fall\napart.”\n\n## Detection and guidance\n\n\n-----\n\nIn both cases, the attackers relied upon a lack of diligence – both targets had vulnerable\nWindows systems that lacked current patches and updates. Properly patched machines, like\nthe Exchange server, would have forced the attackers to work harder to make their initial\naccess into the organizations they penetrated. A requirement to use multifactor\nauthentication, had it been in place, would have created further challenges for unauthorized\nusers to log in to those or other machines.\n\nEntropy ransomware infections were preceded by detections of Cobalt Strike beacons\n(ATK/Tlaboc-A), Dridex malware (Mal/EncPk-APX, Troj/Dridex-AIZ), and the batch scripts\n(Troj/Agent-BCJY) that were eventually used to spread the ransomware to other machines.\nThe ransomware components are detected a number of ways: in memory, behaviorally, and\nby the static detection of the runtime packer.\n\nSophosLabs would like to acknowledge the contributions of Anand Ajjan, Colin Cowie, Abhijit\nGupta, Steven Lott, Rahil Shah, Vikas Singh, Felix Weyne, Syed Zaidi, and Xiaochuan\nZhang to our analysis of Dridex and Entropy, and the attackers’ methodology.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-23 - Dridex bots deliver Entropy ransomware in recent attacks.pdf"
    ],
    "report_names": [
        "2022-02-23 - Dridex bots deliver Entropy ransomware in recent attacks.pdf"
    ],
    "threat_actors": [
        {
            "id": "8670f370-1865-4264-9a1b-0dfe7617c329",
            "created_at": "2022-10-25T16:07:23.69953Z",
            "updated_at": "2025-03-27T02:02:09.929725Z",
            "deleted_at": null,
            "main_name": "Hades",
            "aliases": [
                "Operation TrickyMouse"
            ],
            "source_name": "ETDA:Hades",
            "tools": [
                "Brave Prince",
                "Gold Dragon",
                "GoldDragon",
                "Lovexxx",
                "Olympic Destroyer",
                "Running RAT",
                "RunningRAT",
                "SOURGRAPE",
                "running_rat"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "6c4f98b3-fe14-42d6-beaa-866395455e52",
            "created_at": "2023-01-06T13:46:39.169554Z",
            "updated_at": "2025-03-27T02:00:03.011739Z",
            "deleted_at": null,
            "main_name": "Evil Corp",
            "aliases": [
                "GOLD DRAKE"
            ],
            "source_name": "MISPGALAXY:Evil Corp",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "50068c14-343c-4491-b568-df41dd59551c",
            "created_at": "2022-10-25T15:50:23.253218Z",
            "updated_at": "2025-03-27T02:00:55.408128Z",
            "deleted_at": null,
            "main_name": "Indrik Spider",
            "aliases": [
                "Indrik Spider",
                "Evil Corp",
                "Manatee Tempest",
                "DEV-0243",
                "UNC2165"
            ],
            "source_name": "MITRE:Indrik Spider",
            "tools": [
                "Mimikatz",
                "PsExec",
                "Dridex",
                "WastedLocker",
                "BitPaymer",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "9806f226-935f-48eb-b138-6616c9bb9d69",
            "created_at": "2022-10-25T16:07:23.73153Z",
            "updated_at": "2025-03-27T02:02:09.950784Z",
            "deleted_at": null,
            "main_name": "Indrik Spider",
            "aliases": [
                "Blue Lelantos",
                "DEV-0243",
                "Evil Corp",
                "Gold Drake",
                "Gold Winter",
                "Manatee Tempest",
                "UNC2165"
            ],
            "source_name": "ETDA:Indrik Spider",
            "tools": [
                "Advanced Port Scanner",
                "Agentemis",
                "Babuk",
                "Babuk Locker",
                "Babyk",
                "BitPaymer",
                "Bugat",
                "Bugat v5",
                "Cobalt Strike",
                "CobaltStrike",
                "Cridex",
                "Dridex",
                "EmPyre",
                "EmpireProject",
                "FAKEUPDATES",
                "FakeUpdate",
                "Feodo",
                "FriedEx",
                "Hades",
                "IEncrypt",
                "LINK_MSIEXEC",
                "MEGAsync",
                "Macaw Locker",
                "Metasploit",
                "Mimikatz",
                "PayloadBIN",
                "Phoenix Locker",
                "PowerShell Empire",
                "PowerSploit",
                "PsExec",
                "QNAP-Worm",
                "Raspberry Robin",
                "RaspberryRobin",
                "SocGholish",
                "Vasa Locker",
                "WastedLoader",
                "WastedLocker",
                "cobeacon",
                "wp_encrypt"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b296f34c-c424-41da-98bf-90312a5df8ef",
            "created_at": "2024-06-19T02:03:08.027585Z",
            "updated_at": "2025-03-27T02:05:17.350153Z",
            "deleted_at": null,
            "main_name": "GOLD DRAKE",
            "aliases": [
                "Indrik Spider ",
                "Evil Corp"
            ],
            "source_name": "Secureworks:GOLD DRAKE",
            "tools": [
                " Cobalt Strike",
                " Covenant",
                " Donut",
                " Dridex",
                " Hades",
                " Koadic",
                " LockBit",
                " Macaw Locker",
                " Mimikatz",
                " Payload.Bin",
                " Phoenix CryptoLocker",
                " PowerSploit",
                " Powershell Empire",
                " SocGholish",
                " WastedLocker",
                "BitPaymer"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535586,
    "ts_updated_at": 1743041596,
    "ts_creation_date": 1653688474,
    "ts_modification_date": 1653688474,
    "files": {
        "pdf": "https://archive.orkl.eu/1ef4b4244d0267aa7eaa96ca691d7e2c3bce52a5.pdf",
        "text": "https://archive.orkl.eu/1ef4b4244d0267aa7eaa96ca691d7e2c3bce52a5.txt",
        "img": "https://archive.orkl.eu/1ef4b4244d0267aa7eaa96ca691d7e2c3bce52a5.jpg"
    }
}