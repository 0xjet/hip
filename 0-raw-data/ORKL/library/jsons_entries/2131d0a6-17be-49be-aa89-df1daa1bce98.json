{
    "id": "2131d0a6-17be-49be-aa89-df1daa1bce98",
    "created_at": "2022-10-25T16:48:17.295522Z",
    "updated_at": "2025-03-27T02:10:09.539984Z",
    "deleted_at": null,
    "sha1_hash": "924193affc6bcd25cc2d9b1b952a8c8dcf068669",
    "title": "Thriving Beyond The Operating System: Financial Threat Group Targets Volume Boot Record « Threat Research | FireEye Inc",
    "authors": "",
    "file_creation_date": "2015-12-08T14:32:29Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 237447,
    "plain_text": "**December 07, 2015 | By Dimiter Andonov, Willi Ballenthin, Nalani Fraser, Will Matson, Jay Taylor | Threat**\n**Research, Advanced Malware**\n\n**In September, Mandiant Consulting identified a financially motivated threat group targeting payment card data**\n**using sophisticated malware that executes before the operating system boots. This rarely seen technique,**\n**referred to as a ‘bootkit’, infects lower-level system components making it very difficult to identify and detect.**\n**The malware’s installation location also means it will persist even after re-installing the operating system,**\n**widely considered the most effective way to eradicate malware.**\n\n**We first identified this activity during a recent investigation at an organization in the financial industry. We**\n**identified the presence of a financially motivated threat group that we track as FIN1, whose activity at the**\n**organization dated back several years. The threat group deployed numerous malicious files and utilities, all of**\n**which were part of a malware ecosystem referred to as ‘Nemesis’ by the malware developer(s),[1] and used**\n**this malware to access the victim environment and steal cardholder data. FIN1, which may be located in**\n**Russia or a Russian-speaking country based on language settings in many of their custom tools, is known for**\n**stealing data that is easily monetized from financial services organizations such as banks, credit unions, ATM**\n**operations, and financial transaction processing and financial business services companies.**\n\n**Nemesis, the malware ecosystem used by FIN1, includes comprehensive backdoors that support a variety of**\n**network protocols and communication channels for command and control (CnC). It provides a robust set of**\n**capabilities, including: file transfer, screen capture, keystroke logging, process injection, process**\n**manipulation, and task scheduling. The threat group continually updated the Nemesis malware during their**\n**ongoing access to the victim environment, deploying several different variants of the same tools and adding**\n**functionality between iterations. In early 2015, FIN1 updated their toolset to include a utility that modifies the**\n**legitimate system Volume Boot Record (VBR) and hijacks the system boot process to begin loading Nemesis**\n**components before the Windows operating system code. We refer to this utility as BOOTRASH.**\n\n### A Brief Refresh\n\n**On a Windows system, the Master Boot Record (MBR) is critical to the boot process. The MBR stores**\n**information about the disk, including the number and layout of any partitions, and a small amount of code**\n**used during the boot process.[2] This code searches for the primary active partition, and passes control over**\n**to that partition's VBR.[3]**\n\n**A VBR, on partitioned devices, is located in the first sector of an individual partition. The VBR contains**\n**machine code specific to the operating system or program on that partition. For example, in situations where**\n**more than one operating system is installed on a computer, each operating system is installed on a separate**\n**partition and each partition contains a VBR with instructions on how to start the respective operating**\n**system.[4] The VBR instructs the operating system code to begin the boot process, which involves loading the**\n**necessary software into memory.**\n\n**Figure 1 depicts a simplified boot process. The MBR loads the VBR, which loads the operating system code.**\n**BOOTRASH hijacks this boot process in order to load the Nemesis payload before the operating system**\n**boots**\n\n\n-----\n\n**Figure 1. Simplified normal boot process**\n\n### BOOTRASH Step by Step\n\n**To successfully hijack the boot process, the malware first uses a complex multi-step process to create a**\n**custom virtual file system[5] to store the Nemesis components in the unallocated space between partitions. It**\n**then hijacks the original VBR by overwriting the bootstrap code with its own malicious code. The bootstrap**\n**code calls the Nemesis bootkit, which intercepts certain boot process functions and injects the Nemesis**\n**components into the Windows kernel. Following is a description of the installation and hijacking process:**\n\n### Step 1: System Checks\n\n**Prior to installation, the BOOTRASH installer gathers statistics about the system, including the operating**\n**system version and architecture. The installer is capable of deploying 32-bit or 64-bit versions of the Nemesis**\n**components depending on the system’s processor architecture. The installer will install the bootkit on any hard**\n**disk that has a MBR boot partition, regardless of the specific type of hard drive. However, if the partition uses**\n**the GUID Partition Table disk architecture, as opposed to the MBR partitioning scheme, the malware will not**\n**continue with the installation process.**\n\n**The malware checks to make sure a copy of the BOOTRASH installer is not already running on the system. It**\n**also checks to see if the Microsoft .NET 3.5 framework is installed on the system - a prerequisite for the**\n**malware. If the installer is already running or the .NET framework is not installed, the malware will quit.**\n\n### Step 2: Available Space Calculations & Virtual File System Creation\n\n**BOOTRASH creates its own custom virtual file system (VFS) to store the components of the Nemesis**\n**ecosystem. The malware performs several calculations to determine the positioning of the file system and**\n**whether the system has enough space to fit the file structure.**\n\n**To determine how much space is needed for the installation, the malware uses Windows Management**\n**Instrumentation (WMI) to query the system’s boot disk and partition. The malware then calculates the total**\n**size of the 32-bit or 64-bit components to ensure there is enough space for the custom file system in the free**\n**space between the system’s partitions.**\n\n### Step 3: Boot Sector Hijacking\n\n**The installer reads the original boot sector into memory and saves an encoded backup copy of the VBR code**\n**at 0xE sectors from the start of the partition. Next, the malware applies two algorithms (CRC16-CCITT and**\n**MD5) to the original boot sector in order to check its integrity at a later time. With the original boot sector**\n**saved, the malware decodes the new bootstrap code from one of its embedded resources and overwrites the**\n**existing bootstrap code, effectively hijacking the boot process of the compromised system.**\n\n\n-----\n\n**The installer always uses the virtual file system for saving the three components responsible for creating and**\n**installing the bootkit: vbr.bin, vbs.bin, and bootldr.sys. The rest of the components can be either saved in the**\n**virtual file system or as binary data within the HKCU\\.Default\\Identities registry keys. These components are**\n**responsible for the primary C2 functionality of the Nemesis ecosystem that includes: file transfer, screen**\n**capture, keystroke logging, process injection, process manipulation, and task scheduling.**\n\n**Table 1 details the associated registry keys.**\n\n**Registry Value Name** **File Content**\n\n**HKCU\\.Default\\Identities\\{3D04DDFA-AE6F-4BC2-**\n**core.sys**\n**9AE6-4A76A471147A}**\n\n**HKCU\\.Default\\Identities\\{424D9649-5B57-4C9B-A55A-**\n**vfs.sys**\n**00D6CD382092}**\n\n**HKCU\\.Default\\Identities\\{AA1F2588-670C-450E-833B-**\n**nemesis.sys**\n**C8CAAF26DA5E}**\n\n**HKCU\\.Default\\Identities\\{95E4F335-E152-4778-B3B0-**\n**injproxy.dll**\n**3422B37B3A3D}**\n\n**HKCU\\.Default\\Identities\\{C34C01DC-8E9D-40AF-**\n**loader.dll**\n**82FF-79DB2735C333}**\n\n**HKCU\\.Default\\Identities\\{4EED1600-54C9-471E-B74F-**\n**nemesis.dll**\n**2A88BAC188B4}**\n\n**HKCU\\.Default\\Identities\\{36203264-DFF1-43AC-**\n**nmscfg.dat**\n**94AD-096592297776}**\n\n**Table 1: Nemesis components optionally saved as registry values**\n\n### Step 5: Hijacked Boot Process\n\n**As previously discussed, during a normal boot process the MBR loads the VBR, which loads the operating**\n**system code. However, during the hijacked boot process, the compromised system’s MBR will attempt to load**\n**the boot partition’s VBR, which has been overwritten with the malicious BOOTRASH bootstrap code. This**\n**code loads the Nemesis bootkit components from the custom virtual file system. The bootkit then passes**\n**control to the original boot sector, which was saved to a different location on disk during the installation**\n**process. From this point the boot process continues with the loading and executing of the operating system**\n**software. Figure 2 illustrates the hijacked boot process.**\n\n|Registry Value Name|File Content|\n|---|---|\n|HKCU\\.Default\\Identities\\{3D04DDFA-AE6F-4BC2- 9AE6-4A76A471147A}|core.sys|\n|HKCU\\.Default\\Identities\\{424D9649-5B57-4C9B-A55A- 00D6CD382092}|vfs.sys|\n|HKCU\\.Default\\Identities\\{AA1F2588-670C-450E-833B- C8CAAF26DA5E}|nemesis.sys|\n|HKCU\\.Default\\Identities\\{95E4F335-E152-4778-B3B0- 3422B37B3A3D}|injproxy.dll|\n|HKCU\\.Default\\Identities\\{C34C01DC-8E9D-40AF- 82FF-79DB2735C333}|loader.dll|\n|HKCU\\.Default\\Identities\\{4EED1600-54C9-471E-B74F- 2A88BAC188B4}|nemesis.dll|\n|HKCU\\.Default\\Identities\\{36203264-DFF1-43AC- 94AD-096592297776}|nmscfg.dat|\n\n\n-----\n\n**Figure 2. Simplified hijacked boot process**\n\n**The bootkit intercepts several system interrupts to assist with the injection of the primary Nemesis**\n**components during the boot process. The bootkit hijacks the BIOS interrupt[6] responsible for miscellaneous**\n**system services and patches the associated Interrupt Vector Table entry so it can intercept memory queries**\n**once the operating system loader gains control. The bootkit then passes control to the original VBR to allow**\n**the boot process to continue. While the operating system is being loaded, the bootkit also intercepts the**\n**interrupt and scans the operating system loader memory for a specific instruction that transfers the CPU from**\n**real mode to protected mode.[7] This allows the bootkit to patch the Interrupt Descriptor Table each time the**\n**CPU changes from real mode to protected mode. This patch involves a modified interrupt handler that**\n**redirects control to the bootkit every time a specific address is executed. This is what allows the bootkit to**\n**detect and intercept specific points of the operating system loader execution and inject Nemesis components**\n**as part of the normal kernel loading.**\n\n### Uninstall Option\n\n**BOOTRASH has a built in option for restoring the original boot sector, in the event that the threat actors wish**\n**to remove the hijacking process. This option only restores the original boot sector – it does not remove the**\n**custom virtual file system or the backup VBR that was created by BOOTRASH.**\n\n### Other Bootkits\n\n**Malware that persists by compromising the MBR or VBR is unusual, but not unknown. ESET documented**\n**their technical research into bootkit malware families such as ‘TDL4’ (also known as ‘Olmarik’), ‘Necurs’, and**\n**‘Rovnix’ in 2011,[8] and cataloged various MBR and VBR infection vectors in 2012.[9]**\n\n**In addition, there have been reports of financially motivated malware utilizing bootkits. In 2013, RSA warned**\n**that a banking Trojan named ‘KINS’ had VBR bootkit functionality and was being advertised on a Russian-**\n**speaking online forum[10]. There was also reporting in 2013 that the source code for another banking Trojan,**\n**known as ‘Carberp,’ was publicly leaked. Reports stated the Trojan had been sold for $40,000 due to the**\n**addition of bootkit functionality[11]. Further reporting indicated the bootkit component might not have been**\n**completely operational[12]. Regardless, the high price commanded for the malware is indicative of the bootkit**\n**code complexity, as well as the demand for banking malware with this evasive capability.**\n\n### Not Just a Financial Threat\n\n**In 2012, Mandiant observed a suspected China-based, Advanced Persistent Threat (APT) group utilizing a**\n**MBR (as opposed to VBR) bootkit that we call ROCKBOOT to establish persistence for backdoors at victim**\n**organizations within an industry unrelated to financial services. This group, like many of the threat groups we**\n**track, primarily uses more traditional techniques for ensuring their malware remains persistent, such as**\n**modifying Windows registry keys or using techniques like DLL search order hijacking. This threat group**\n\n\n-----\n\n**sophisticated toolsets. The threat actors may selectively deploy these advanced toolsets when the victim**\n**organization is difficult to penetrate or if the targeted data is of high value and the threat actors want to ensure**\n**continued access to the compromised environment.**\n\n### Elevating Detection Capabilities\n\n**Bootkits, such as BOOTRASH, are very difficult to detect because they have the potential to be installed and**\n**executed almost completely outside of the Windows operating system.[13] Because the malicious boot loader**\n**executes before Windows itself is fully loaded, it is not subject to typical operating system integrity checks.**\n**The components used to load the malware payload are not scanned by anti-virus software, because they are**\n**stored in a VFS outside the Windows file system. In addition, the malware components themselves are stored**\n**either in the VFS or the Windows registry – another location not typically scanned by anti-virus. This leaves**\n**live memory as the only location where the malware is likely to be detected; and unless the bootkit and VFS**\n**components are removed, the malware will execute and load every time the system starts. Wiping the**\n**operating system partition and re-installing will not remove the bootkit or VFS components written to**\n**unallocated space.**\n\n**During the investigation with BOOTRASH, we used Mandiant Intelligent Response (MIR), a proprietary host-**\n**based technology that provides raw disk access, to look for malware persistence outside of the operating**\n**system. This tool allowed us to identify systems that had a modified VBR.**\n\n### Conclusion\n\n**The use of malware that persists outside of the operating system requires a different approach to detection**\n**and eradication. Malware with bootkit functionality can be installed and executed almost completely**\n**independent of the Windows operating system. As a result, incident responders will need tools that can**\n**access and search raw disks at scale for evidence of bootkits. Similarly, re-installing the operating system**\n**after a compromise is no longer sufficient. System administrators should perform a complete physical wipe of**\n**any systems compromised with a bootkit and then reload the operating system.**\n\n### Appendix: Associated MD5 Hashes\n\n**MD5 Hash** **Function**\n\n**372f1e4d2d5108bbffc750bb0909fc49** **BOOTRASH dropper**\n\n**Windows 7 and later 32-bit**\n**ac64ef80f8209ae7b67be0be9ea6400e**\n**modified VBR**\n\n**Windows 7 and later 64-bit**\n**073a2998a6f1ccf0ea89fe60ce4bdeaf**\n**modified VBR**\n\n**Windows XP 32-bit modified**\n**c145624f148980ad026ea7b79e61212d**\n**VBR**\n\n**Windows XP 64-bit modified**\n**472926fe51fc6a4fdf687e8a4de64d78**\n**VBR**\n\n**Bootstrap code for systems**\n**1c17c92519523a129e9abd298bb78521**\n**with NTFS/MBR**\n\n|MD5 Hash|Function|\n|---|---|\n|372f1e4d2d5108bbffc750bb0909fc49|BOOTRASH dropper|\n|ac64ef80f8209ae7b67be0be9ea6400e|Windows 7 and later 32-bit modified VBR|\n|073a2998a6f1ccf0ea89fe60ce4bdeaf|Windows 7 and later 64-bit modified VBR|\n|c145624f148980ad026ea7b79e61212d|Windows XP 32-bit modified VBR|\n|472926fe51fc6a4fdf687e8a4de64d78|Windows XP 64-bit modified VBR|\n\n\n-----\n\n|012e6f3ee70d6558f8002d0efce5c9e0|64-bit Boot loader driver|\n|---|---|\n|dd366fcb810594e0620fdf672b03f4d5|32-bit Core services driver|\n|fed12e07499e8cd3a5a47f1f7a8db0be|64-bit Core services driver|\n|21cd4a30ac322bfc9bd2401ea17acfc0|32-bit Nemesis driver|\n|76b6dc622264e3ad822a691a7ec68865|64-bit Nemesis driver|\n|d0b9f9bccbc3725bfcc9546986982ff3|32-bit VFS driver|\n|efbff3b08b5d368976eb4675bb4c000f|64-bit VFS driver|\n\n\n\n**[1] The name ‘Nemesis’ is referenced in several build paths for the malware.**\n\n**[2] https://technet.microsoft.com/en-us/library/cc976797.aspx**\n\n**[3] https://en.wikipedia.org/wiki/Volume_boot_record**\n\n**[4] http://windows.microsoft.com/en-us/windows/install-multiple-operating-system-multiboot#1TC=windows-7**\n\n**[5] http://www.malwaretech.com/2014/11/virtual-file-systems-for-beginners.html**\n\n**[6] A BIOS interrupt is a hardware or software driven condition requiring the interruption of the current code**\n**the processor is executing.**\n\n**[7] Protected mode is an operating state that provides hardware-level protections for a system’s memory. Real**\n**mode does not provide this protection support.**\n\n**[8] http://www.welivesecurity.com/2011/08/23/hasta-la-vista-bootkit-exploiting-the-vbr/**\n\n**[9] http://www.welivesecurity.com/2012/12/27/win32gapz-new-bootkit-technique/**\n\n**[10] https://blogs.rsa.com/is-cybercrime-ready-to-crown-a-new-kins-inth3wild/**\n\n**[11] http://threatpost.com/carberp-source-code-leaked/101070/**\n\n**[12] http://krebsonsecurity.com/tag/carberp-bootkit/**\n\n**[13] Malware with bootkit functionality still relies on the operating system to initiate installation. However, the**\n**actual payload (the bootkit itself) can be allocated to disk outside of the operating system.**\n\n**This entry was posted on Mon Dec 07 08:00:00 EST 2015 and filed under Advanced Malware, Blog, Dimiter**\n**Andonov, Jay Taylor, Latest Blog Posts, Malware, Mandiant, Nalani Fraser, Threat Research, Will Matson,**\n**Willi Ballenthin and bootkits.**\n\n\n-----\n\n## Last Name\n\n\n**Cyber Security Fundamentals**\n\n**Careers**\n\n**Events**\n\n**Webinars**\n\n**Support**\n\n**Partners**\n\n\n## First Name\n\n\n-----\n\n**Blog**\n\n**[Investor Relations](http://investors.fireeye.com/)**\n\n**Incident?**\n\n**Contact Us**\n\n**[Communication Preferences](https://www2.fireeye.com/manage-your-preferences.html)**\n\n**Report Security Issue**\n\n**Supplier Documents**\n\n\n# � � � � � �\n\n\n**[Facebook](https://www.facebook.com/FireEye)**\n\n**[LinkedIn](https://www.linkedin.com/company/fireeye)**\n\n**[Twitter](https://twitter.com/fireeye)**\n\n**[Google+](https://plus.google.com/+Fireeye/videos)**\n\n**[YouTube](https://www.youtube.com/user/FireEyeInc)**\n\n**[Glassdoor](http://www.glassdoor.com/Overview/Working-at-FireEye-EI_IE235161.11,18.htm)**\n\n\n**Copyright © 2015 FireEye, Inc. All rights reserved.**\n\n**Privacy & Cookies Policy | Safe Harbor**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2015/2015.12.07.Thriving_Beyond_The_Operating_System/fin1-targets-boot-record.pdf"
    ],
    "report_names": [
        "fin1-targets-boot-record"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8455ee67-fecd-4905-a2de-cbb85b016968",
            "created_at": "2023-01-06T13:46:38.96875Z",
            "updated_at": "2025-03-27T02:00:02.965565Z",
            "deleted_at": null,
            "main_name": "FIN1",
            "aliases": [],
            "source_name": "MISPGALAXY:FIN1",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716497,
    "ts_updated_at": 1743041409,
    "ts_creation_date": 1449585149,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/924193affc6bcd25cc2d9b1b952a8c8dcf068669.pdf",
        "text": "https://archive.orkl.eu/924193affc6bcd25cc2d9b1b952a8c8dcf068669.txt",
        "img": "https://archive.orkl.eu/924193affc6bcd25cc2d9b1b952a8c8dcf068669.jpg"
    }
}