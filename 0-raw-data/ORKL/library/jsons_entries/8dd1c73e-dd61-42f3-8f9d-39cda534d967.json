{
    "id": "8dd1c73e-dd61-42f3-8f9d-39cda534d967",
    "created_at": "2023-01-12T15:00:50.877646Z",
    "updated_at": "2025-03-27T02:05:51.735896Z",
    "deleted_at": null,
    "sha1_hash": "17d0f15b250ae8b74a74f44905646b3bda511787",
    "title": "2022-08-10 - spynote",
    "authors": "",
    "file_creation_date": "2022-09-01T10:08:33Z",
    "file_modification_date": "2022-09-01T10:08:33Z",
    "file_size": 2088933,
    "plain_text": "# SpyNote – An Android Snooper\n\n**[labs.k7computing.com/index.php/spynote-an-android-snooper/](https://labs.k7computing.com/index.php/spynote-an-android-snooper/)**\n\nBy Baran S August 10, 2022\n\nThreat actors are constantly using new tricks and tactics to target users across the globe.\nThis blog is about SpyNote, an Android RAT targeting Indian Defense personnel. The\n[initial attack vector information was found on the newindianexpress website.](https://www.newindianexpress.com/cities/delhi/2022/jul/17/security-at-risk-whatsapp-malware-targeting-army-personnel-detected-2477529.html)\n\nLet’s now get into the details of how this SpyNote works.\n\nThis RAT is propagated via WhatsApp with the name “CSO_SO on Deputation DRDO.\n**apk“.**\n\nOnce the user falls prey to this RAT and installs this malicious “CSO_SO on Deputation\n**DRDO. apk”, this app pretends to be the genuine Adobe reader icon in the device app**\ndrawer as shown in Figure 1.\n\n\n-----\n\nFigure 1: Fake\n\nAdobe Reader icon of the malware\nUpon launching, this application opens a Google Drive URL that is hardcoded in the app’s\n“strings.xml” file and displays the images as shown in Figure 2. Google Drive URL\nhardcoded in the app’s “strings.xml” file as shown in Figure 3.\n\n\n-----\n\nFigure\n\n\n2: Images from Google Drive\n\n\n-----\n\nFigure 3: Hardcoded Google Drive URL string\n\n## Technical Analysis\n\nFigure 4 shows that this malware refers to services in the AndroidManifest.xml file but not\ndefined in the classes.dex in the APK’s root folder. This indicates that the services’\nclasses or another dex containing the classes would be loaded in memory at run-time\nusing any one of the dynamic loading techniques.\n\nFigure 4: Undefined Class Names in AndroidManifest.xml\nSpyNote sample which we analyzed employs the technique of using the “base application\ncontext” to the class “com.android.protector.ProtectApplication” as shown in Figure 5.\n\nFigure 5: AndroidManifest.XML showing base context to\n“com.android.protector.ProtectApplication”\nHence, when the application’s launcher activity is triggered, “attachbasecontext” function\nfrom the class “com.android.protector.ProtectApplication” is executed and the other\nclasses.dex (carried within the APK) are loaded and functions in those classes.dex files\n\n\n-----\n\nare invoked using reflection and MultiDex support as shown in Figure 6 and 7.\n\nFigure 6: “attachbasecontext” using reflection to load the secondary dex files in the APK\n\nFigure 7: classLoader API loading secondary dex files using MultiDex support\nLooking at the logcat at runtime, with MultiDex support, secondary dex files are loaded as\nbase.apk.classes1.zip and converted as executable ‘base.apk.classes1.odex’ as shown in\nFigure 8.\n\nFigure 8: The logcat image showing the base.apk.classes1.odex file at runtime\n\n## Analyzing the Payload\n\nThe payload file base.apk.classes1.zip as shown in Figure 9 has the references to\nservices’ classes declared in the AndroidManifest.xml.\n\n\n-----\n\nFigure 9: Defined\n\nClass Name from AndoridManifest.xml\nThis malware collects location information like altitude, latitude, longitude, precision and\neven the speed at which the device is moving as shown in Figure 10.\n\nFigure 10: Collects the device location information\nSpyNote then proceeds to combine all the aforementioned data and compresses (using\n**gZIPOutputStream API) them before forwarding it to the C2 server as shown in Figure 11.**\n\n\n-----\n\nFigure\n\n11: DATA compression using gZIPOutputStream\n\n## C2 Communication\n\nThis RAT contacts the C2 server at IP 213.136.80[.]208, which is hardcoded in the\n“strings.xml” file (refer Figure 3). Figure 12 shows the connection established with the C2.\n\nFigure 12: TCP connection with the C2 server\nAfter the connection is established, the malware sends the gzip compressed data to the\nC2 as evident from the network packet’s header in Figure 13.\n\n\n-----\n\nFigure 13: gzip data sent\n\nby the device after establishing the connection with the C2 Server\nThe decompressed content of the data is shown below in Figure 14.\n\nFigure 14: Decompressed gzip data showing IP address\n\n## Decode packets from the C2\n\nThe C2 responds by sending a series of compressed data, which when decompressed, is\nrevealed to be system commands and the related APK payload as shown in Figure 15. In\nour case, the APK was extracted using Cyberchef.\n\n\n-----\n\nFigure 15: Getting commands and APK file from C&C server\nWe analyzed the C&C command ‘info’ and the associated APK. This command collects the\nclipboard data and verifies the victims’ device for the presence of a hardcoded list of\nmobile security products, may be with the aim of disabling them or forwarding the info to\nthe C2.\n\nFigure 16: Collects the clipboard information\n\n\n-----\n\nFigure 17:\n\nChecks for the presence of security related products\nThe structure of the commands sent from the C2 to victims’ device is as follows:\n\nFigure 18: Commands sent by C2\n\n\n-----\n\nAt K7, we protect all our customers from such threats. Do ensure that you protect your\nmobile devices with a reputable security product like K7 Mobile Security and also\nregularly update and scan your devices with it. Also keep your devices updated and\npatched against the latest vulnerabilities.\n\n## Indicators of Compromise (IoC)\n\n**Package Name** **Hash** **K7 Detection**\n**Name**\n\ncom.editorpdf.acrobat F115C634016A9199054358515C19B40B Trojan ( 005652621\n)\n\n### C2\n\n213.136.80[.]208\n\nvmi876244.contaboserver[.]net\n\n## MITRE ATT&CK\n\n**Tactics** **Techniques**\n\nDefense Evasion Application DiscoveryObfuscated Files or Information,\nVirtualization/Sandbox Evasion\n\nDiscovery Security Software Discovery, System Information Discovery\n\nCollection Email Collection, Data from Local System\n\n\nCommand and\nControl\n\n\nEncrypted Channel, NonStandard Port\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-10 - spynote.pdf"
    ],
    "report_names": [
        "2022-08-10 - spynote.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535650,
    "ts_updated_at": 1743041151,
    "ts_creation_date": 1662026913,
    "ts_modification_date": 1662026913,
    "files": {
        "pdf": "https://archive.orkl.eu/17d0f15b250ae8b74a74f44905646b3bda511787.pdf",
        "text": "https://archive.orkl.eu/17d0f15b250ae8b74a74f44905646b3bda511787.txt",
        "img": "https://archive.orkl.eu/17d0f15b250ae8b74a74f44905646b3bda511787.jpg"
    }
}