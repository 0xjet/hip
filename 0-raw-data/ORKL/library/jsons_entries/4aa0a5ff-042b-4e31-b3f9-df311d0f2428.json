{
    "id": "4aa0a5ff-042b-4e31-b3f9-df311d0f2428",
    "created_at": "2023-01-12T14:59:52.795673Z",
    "updated_at": "2025-03-27T02:05:26.085143Z",
    "deleted_at": null,
    "sha1_hash": "81123dbf8690fb1c15989321fee8495651357454",
    "title": "2017-10-17 - WaterMiner – a New Evasive Crypto-Miner",
    "authors": "",
    "file_creation_date": "2022-05-28T21:55:20Z",
    "file_modification_date": "2022-05-28T21:55:20Z",
    "file_size": 2566440,
    "plain_text": "# WaterMiner – a New Evasive Crypto-Miner\n\n**[blog.minerva-labs.com/waterminer-a-new-evasive-crypto-miner](https://blog.minerva-labs.com/waterminer-a-new-evasive-crypto-miner)**\n\n[Tweet](https://twitter.com/share)\n\nMinerva Labs has uncovered malicious software that implements a new evasive\ncryptocurrency mining campaign.\n\n\n-----\n\nThis post explains the nature of malicious cryptocurrency miners (cryptominers), dissects the\nnewly discovered malware, and explains its evasive techniques and infection vectors that the\nadversaries employed to get around endpoint security tools. We also provide details about\nthe identity of the person who is likely behind this campaign.\n\n## The Monero Gold Rush\n\nCryptocurrencies are becoming increasingly common. Bitcoin is the most widely adopted\nexample, having gained popularity among even the non-tech-savvy crowds, and accepted by\nwell-known retailers [like Expedia.](https://www.expedia.com/Checkout/BitcoinTermsAndConditions)\n\nBut Bitcoin is not the only cryptocurrency out there. There are more than 10 different\ncryptocurrencies with a market cap exceeding 1 billion US dollars including Ethereum,\nLitecoin, ZCash and Monero. Some are very similar, but others significantly differ in the\nmathematical and computational properties of their implementation.\n\nIt is possible to gain cryptocurrency as a reward for performing heavy computational\noperations, this process is often referred to as mining. Crypto-mining malware abuses its\nvictim’s resources to perform the heavy computational operations required in the mining\nprocess, while the cybercriminal collects the reward for the mining. Lately, we saw an\nincrease in malware mining a specific type of cryptocurrency – Monero. Monero’s design\nmakes it anonymous and virtually untraceable, causing it to be highly popular among\ncybercriminals.\n\nLast May Proofpoint uncovered the [Adylkuzz Monero mining malware which shared the](https://www.proofpoint.com/us/threat-insight/post/adylkuzz-cryptocurrency-mining-malware-spreading-for-weeks-via-eternalblue-doublepulsar)\nsame exploits as WannaCry to spread laterally.\n\nAdditional examples of controversial mining of Monero were observed last month, when the\nsecurity researcher [@PaulWebSec observed that popular websites such as](https://twitter.com/PaulWebSec/status/913055079112036352) CBS\nShowtime, [The Pirate Bay and](https://www.engadget.com/2017/09/16/pirate-bay-hijacks-cpus-for-digital-currency-mining/) [many others executed code that “borrowed” CPU time from](https://twitter.com/PaulWebSec/status/913055079112036352)\ntheir visitors to mine Monero:\n\n\n-----\n\n_@PaulWebSec enumerating top websites mining Monero_\nMinerva recently discovered another illicit Monero-mining campaign, which deployed\nmalicious Monero miners and targeted Russian-speaking individuals, as described below.\n\n## What is WaterMiner?\n\nThe intercepted campaign, which we dubbed WaterMiner, infects victims with a simple yet\neffective Monero mining malware which is designed to hide from endpoint monitoring tools.\nHow effective could such mining software be on consumer-grade CPUs? After all, it’s no\nlonger feasible to mine some of the more established cryptocurrencies such as Bitcoin\nwithout a [special dedicated pricy setup utilizing high-end customized electronics.](https://www.nytimes.com/2017/09/13/business/bitcoin-mine-china.html?mcubz=0)\n\nInterestingly, it turns out that mining Monero on machines with regular CPUs is still effective\ndue to the nature of the cryptographic algorithm that Monero uses. This feasibility, combined\nwith the anonymous nature of its design, makes Monero even more attractive to\ncybercriminals.\n\nThe attackers spread WaterMiner by illicitly bundling this crypto-mining malware with gaming\n“mods”, which patched computer games to augment or bypass their functionality. The\ncampaigned distributed the malicious software on a Russian-speaking forum. For instance,\none of the Trojanized mods claimed to “enhance” the popular R-rated game GTA. It was\ndistributed to the victims under the name “Arbuz” - watermelon in Russian, which is why we\nnamed the campaign WaterMiner.\n\nSeveral forum members posted a download link to the Trojanized file on different forums,\nmarketing its various features to the potential victims, even adding a link to a clean scan of\nthe mod on VirusTotal.\n\n\n-----\n\n_One of the posts publishing the Trojanized mod, note the link to VT_\n\n_Another case of the same content posted on a different forum by a member with a different_\n_nickname_\nThe mod, bundled with the miner’s downloader, was hosted at Yandex.Disk, the Russian\nequivalent of Google Drive or Dropbox, as a RAR archive. The RAR file provides the\nproclaimed mod functionality; however, among the dozens of files, it includes a file called\n\n\n-----\n\npawncc.exe, as shown in the following screenshot. This is the bridgehead which will\ndownload the cryptominer once the mod is executed.\n\nOnce executed on the victim’s system, pawncc.exe acts as a downloader, launching a chain\nof events that results in the execution of the WaterMiner malware.\n\nThe pawncc.exe process begins by verifying that the machine is not already infected with\nthis malicious software. If the miner is not already present, it creates an infection marker. The\ninfection marker creates the registry key “HKLM\\Software\\IntelPlatform” with the value\nnamed “Ld566xsMp01a” set to “Nothing”:\n\n_A Cuckoo sandbox execution trace of the downloader, showing the initialization of the_\n_infection marker_\nNext, pawncc.exe downloads WaterMiner to the temp folder from a Google Drive link. It sets\nthe value of the infection marker to “loaded” and the miner will be executed on a new\nprocess named “Intel (R) Security Assistent.exe”:\n\n\n-----\n\n_Download the miner, save it to the temp folder and execute it as “Intel (R) Security_\n_Assistent.exe”_\nThe malware will not procced to the next stage if the infection marker’s value is already set\nto“loaded”, making this simple registry value an effective vaccine against it.\n\nYou may see in the image below the test for the infection marker. The lower block, which\nincludes the function in charge of downloading and executing the malware, will be skipped if\nthe infection marker is already present and set to “Loaded”:\n\n_The second code block is skipped if the infection marker is found_\nWhile examining the downloader, Minerva found unique indicators, which helped trace\nthe [source code of an earlier version on Pastebin, an online copy and paste service. The](https://pastebin.com/8vvqMFFX)\nauthor’s comments within the source explicitly refer to the `mining functionality and indicate\nthat the attacker intentionally included the miner as part of the mod:\n\n\n-----\n\n_Interesting comments by Martin 0pc0d3r in an earlier version of the miner’s downloader_\nTranslated from Russian, the first part of the comments goes through existing functionality:\n\n-    Loading 11 miner files to the temp folder\n\n-    Adding persistency mechanism\n\n-    Hiding the files and the persistency mechanism\n\n-    Downloading the miner files only once\n\nThere are even some comments in the TODO section, suggesting the upcoming\nimprovements to the miner:\n\n-    Creating a backup of the miner files\n\n-    Using the task scheduler for persistency\n\n-    Execute the miner as a service to hide it\n\npawncc.exe downloads the mining software to the victim’s system and saves it in\n“%TEMP%\\Intel(R) Security Assistent.exe”, a 64-bit executable\n\nThe miner establishes persistence to survive any reboots using the registry, hiding under a\nRunOnce key, disguised as an “Oracle Corporation” application:\n\n\n-----\n\nNext, it will start mining and will communicate with xmr.pool.minergate.com on TCP port\n45560. This hostname belongs to a mining pool. These pools are a collaboration of multiple\nminers, enabling them to [share their resources and rewards according to their contribution to](https://en.wikipedia.org/wiki/Mining_pool)\n[the pool. At the moment, there are dozens of Monero mining pools available to the public.](http://moneropools.com/)\n\nAfter examining the miner, Minerva observed that it is a modified version of the common\nopen-source miner called [XMRig:](https://github.com/xmrig/xmrig)\n\nOn the left - XMRig instructions, on the right - strings extracted from the customized miner\nXMRig is not malicious on its own, but installing it on systems without authorization to gain\nillicit profit from unsuspecting victims, is not a legit use case.\n\nMinerva also came across older versions of the dropper, which distributed a different miner\ncalled [Nice Hash. However, the adversary switched to XMRig probably because Nice Hash](https://github.com/nicehash/NiceHashMiner)\nrequired almost a dozen of different files to run properly on the victim’s system\n\n\n-----\n\n### Fooling Victims, Hiding in Plain Sight\n\nMiners are performing heavy computational calculations as part of the mining process so\nnaturally, they consume a significant percentage of its victim’s CPU. This means that the\nvictim will notice the anomaly when the infected system suddenly slows down. To investigate,\nthe person will probably open the Windows task manager or equivalent apps to inspect,\nwhich application is slowing down the system. In the WaterMiner campaign, the attacker\nchose to evade detection by tweaking the original XMRig to continuously search if there is an\nopen window titled:\n\n-    Windows Task Manager (in English and Russian)\n\n-    Task Manager\n\n-    AnVir (Russian task manager equivalent)\n\n-    Process Hacker\n\nAn excerpt from the tweaked XMRig code that checks for these windows is captured in the\nfollowing screenshot:\n\n\n-----\n\nWindow titles that will cause WaterMiner to stop mining to evade detection\nIf the miner detects any of the above apps, the mining operation would halt, making it less\nlikely that the victim will detect the presence of the malicious program.\n\nMalware variants that the same attacker spread in earlier campaigns included a different\ntype of test: instead of looking for windows, the miner tried to detect the monitoring apps by\ninspecting the running process list and terminating itself if any of the processes shown in the\nscreenshot below are found:\n\n\n-----\n\nIf Task Manager or AnVir are found - call taskkill to terminate the malware\n**Minerva’s Anti-Evasion Platform blocks WaterMiner malware by making it believe that it**\nis constantly monitored – forcing it to avoid any mining activity by exploiting the miner’s own\nevasive design.\n\n## Who is behind WaterMiner?\n\nIn the world of cybercrime, we often come-across well-organized gangs. However, it seems\nthat Monero also attracts resourceful individuals who are not the classic attackers we might\nimagine as criminal masterminds, just like Alaska lured many unskilled miners during the\ngold rush.\n\n\n-----\n\n[Mining during the gold rush, Alaska (credit)](https://commons.wikimedia.org/wiki/File:Nome_1900.jpg)\nAccording to several forum posts and the source code Minerva tracked down, the person\nbehind the WaterMiner campaign appears to hide under the alias “Martin Opc0d3r”, and has\nsome history in developing other forms of questionable or malicious software, such as autoaiming bots and mods for computer games. However, it seems that lately he realized it’s\npossible to earn money from his popular mods by infecting his “clients” with multiple types of\nmalware, including cryptominers.\n\nMinerva located the URL hardcoded in one of the WaterMiner samples,\nhxxp://cw36634[.]tmweb[.]ru/getfile[.]php?file=12, to at least [a dozen more samples created](https://www.virustotal.com/#/ip-address/92.53.96.133)\nby the same actor, downloaded from almost identical URLs:\n\n\n-----\n\nMinerva located additional samples that used another domain, with a URL that followed a\nsimilar pattern:\n\nSome of the payloads are no longer available and were probably removed either by the\nhosting services provider or by the attacker himself. Yet, from an inspection of those that are\navailable, we found various versions of the tweaked XMRig and NiceHash miners showing\ngreat resemblance to previous samples and code snippets we associated with the\nWaterMiner campaign. Another one of 0pc0d3r’s snippets publicly available [on Pastebin,](https://pastebin.com/Nae6NTxP)\nmakes us believe that some of the payloads, which are no longer available in the above links\nwere Trojans:\n\n\n-----\n\nOne of the comments mentions a Trojan, possibly extracted from a different file at runtime\nOther evidence suggesting older Trojanized mods of 0pc0d3r were detected by end users. In\nthe thread Minerva located on another Russian forum,\nhxxps://video[.]fishyoutube[.]com/watch?v=lU0xJSuj-ZM, we observed the publication of a\ndifferent mod. Its users posted comments to flag it with words such as “stealer”, “Trojan” and\ncalled 0pc0d3r “the result of incest”:\n\n\n-----\n\nFrom 0pc0d3r’s poor operational security (opsec), it is clear that we are not dealing with an\nexperienced cybercriminal. By following the activities associated with this alias, we\ndiscovered the possible identity of the person behind it.\n\nIn the Russian social network VK, one of 0pc0d3r’s mods [was offered by a different identity,](https://webcache.googleusercontent.com/search?q=cache:-jC9bYdfQLoJ:https://vk.com/wall-119857463_17114%3Foffset%3Dlast%26f%3D)\nAnton [ redacted]:\n\n\n-----\n\nWhen a user blamed Anton for reselling 0pc0d3r’s work, Anton proudly admitted to be the\nman behind this identity:\n\nCombined with other sensitive information we collected when analyzing this campaign, we\nbelieve that Anton is likely to be 0pc0d3r – the man behind WaterMiner.\n\n## Conclusions and Recommendations\n\nThere cannot be good without bad, and this applies to the rapidly growing industry of\ncryptocurrencies. This innovative field, mixing cutting-edge cryptography with abstract\neconomic ideas like fungibility, is not immune to individuals abusing it to make quick money\nthrough illicit means.\n\nAt the moment, cryptominers are not very sophisticated and backlisting host and port\ncombinations will successfully block most miners. However, we predict that mining-malware\nwill become increasingly sophisticated and will maneuver around firewall and IPS\\IDS\nproducts. Fortunately, just like other more conventional malware, the more evasive such\nmalware is, the more effective Minerva’s Anti-Evasion Platform is at stopping it.\n\n## IoC\n\n\n-----\n\n### IP\n\n-    93[.]188[.]160[.]90\n\n-    92[.]53[.]96[.]133\n\n### Hashes (SHA-256)\n\n-    1852bf95b91bc50fb10cd0388595d88ce524dca9607aa3621e7b2587f326ec9d (original\nmod)\n\n-    b23ce6a8af6cbf7dae517f6736aa69c451347f6b5e7e66d5a1339a4d74e10e66\n(WaterMiner downloader)\n\n-    715c3a8f7d5cd921b321a4fa180862315846f408b903d9d2888ae95912dbb9ca\n(payload)\n\n-    db4f825732f27f1163367226c7d565714455f3f51c1cdbd858ed4a0b2335515b (older\npayload)\n\n-    f5f762a56578a939623da00d8a7bd857c10432b6623d335da20731f9a1b131ba (older\npayload)\n\n-    1347fbbb5f0c41a27dd06d4d02588e72cd1c8ba6dd609ae15d042895ed1211e9 (older\npayload)\n\n-    83cfa3f13e6e851c670e491ea29feafa98cb9554fb0458b4897b20b5b0598be2 (older\npayload)\n\n### Process Names\n\n-    Intel(R) Security Assistent.exe\n\n### URLs\n\n-    Downloader:\n\no  hxxps://goo[.]gl/MWTs3Y\n\no  hxxps://drive[.]google.com/uc?\nauthuser=0&id=0B04cozXxVfySSGN6UEZfb2xpZms&export=download\n\n-    Payload delivery:\n\no  hxxp://cw36634[.]tmweb[.]ru\n\no  hxxp://0psofter[.]esy[.]es\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-10-17 - WaterMiner – a New Evasive Crypto-Miner.pdf"
    ],
    "report_names": [
        "2017-10-17 - WaterMiner – a New Evasive Crypto-Miner.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535592,
    "ts_updated_at": 1743041126,
    "ts_creation_date": 1653774920,
    "ts_modification_date": 1653774920,
    "files": {
        "pdf": "https://archive.orkl.eu/81123dbf8690fb1c15989321fee8495651357454.pdf",
        "text": "https://archive.orkl.eu/81123dbf8690fb1c15989321fee8495651357454.txt",
        "img": "https://archive.orkl.eu/81123dbf8690fb1c15989321fee8495651357454.jpg"
    }
}