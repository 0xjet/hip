{
    "id": "5b871c36-bd8c-4a52-af40-c686e9b68824",
    "created_at": "2023-01-12T14:59:43.48596Z",
    "updated_at": "2025-03-27T02:14:42.35602Z",
    "deleted_at": null,
    "sha1_hash": "47b4f0c884e84a5f9c805f0e3e336e6d666d7f6c",
    "title": "2016-12-09 - Windows 10- protection, detection, and response against recent Depriz malware attacks",
    "authors": "",
    "file_creation_date": "2022-05-28T21:53:26Z",
    "file_modification_date": "2022-05-28T21:53:26Z",
    "file_size": 767492,
    "plain_text": "# Windows 10: protection, detection, and response against recent Depriz malware attacks\n\n**[blogs.technet.microsoft.com/mmpc/2016/12/09/windows-10-protection-detection-and-response-against-recent-attacks/](https://blogs.technet.microsoft.com/mmpc/2016/12/09/windows-10-protection-detection-and-response-against-recent-attacks/)**\n\nDecember 10, 2016\n\nA few weeks ago, multiple organizations in the Middle East fell victim to targeted and destructive attacks that\nwiped data from computers, and in many cases rendering them unstable and unbootable. Destructive attacks like\nthese have been observed repeatedly over the years and the Windows Defender and Windows Defender\nAdvanced Threat Protection Threat Intelligence teams are working on protection, detection, and response to\nthese threats.\n\nMicrosoft Threat Intelligence identified similarities between this recent attack and previous 2012 attacks against\ntens of thousands of computers belonging to organizations in the energy sector. Microsoft Threat Intelligence\nrefers to the activity group behind these attacks as TERBIUM, following our internal practice of assigning rogue\nactors chemical element names.\n\nAlthough the extent of damage caused by this latest attack by TERBIUM is still unknown, Windows 10 customers\nhave a set of features available for them to enable to mitigate such attack. Windows 10 has built-in proactive\n[security components, such as Device Guard, that mitigate this threat;](https://blogs.technet.microsoft.com/ash/2016/03/02/windows-10-device-guard-and-credential-guard-demystified/) [Windows Defender customers are](https://www.microsoft.com/en-us/windows/windows-defender)\nprotected through multiple signature-based detections; and Windows Defender Advanced Threat Protection\n(ATP) customers are provided extensive visibility and detection capabilities across the attack kill chain, enabling\nsecurity operation teams to respond quickly. Microsoft’s analysis has shown that the components and techniques\nused by TERBIUM in this campaign trigger multiple detections and threat intelligence alerts in Windows Defender\nAdvanced Threat Protection.\n\nTo test how Windows Defender ATP can help your organization detect, investigate, and respond to advanced\nattacks, **[sign up for a free trial.](https://www.microsoft.com/en-us/windowsforbusiness/windows-atp?ocid=cx-blog-mmpc)**\n\n## Attack composition\n\nMicrosoft Threat Intelligence has observed that the malware used by TERBIUM, dubbed “Depriz” by Microsoft,\nreuses several components and techniques seen in the 2012 attacks, and has been highly customized for each\ntargeted organization.\n\nWe do not see any indicators that a zero-day exploit is being used by TERBIUM.\n\n### Step 1: Writing to disk\n\nThe initial infection vector TERBIUM uses is unknown. As credentials have been hard-coded in the malware\nTERBIUM uses, it is suspected that TERBIUM has harvested credentials or infiltrated the target organization\npreviously. Once TERBIUM has a foothold in the organization, its infection chain starts by writing an executable\nfile to disk that contains all the components required to carry out the data-wiping operation. These components\nare encoded in the executables resources as fake bitmap images.\n\n\n-----\n\n_Figure 1. The components of the Trojan are fake bitmap images_\n\nWe decoded the components as the following files:\n\nPKCS12 – a destructive disk wiper component\nPKCS7 – a communication module\nX509 – 64-bit variant of the Trojan/implant\n\n### Step 2: Propagation and persistence through the target network\n\nWe have seen TERBIUM use hardcoded credentials embedded in the malware to propagate within a local\nnetwork. The availability of these credentials to the activity group suggests that the attacks are highly targeted at\nspecific enterprises.\n\nThe propagation and persistence is carried out as follows:\n\n1. First, it tries to start the RemoteRegistry service on the computer it is trying to copy itself to, then uses\n\n_RegConnectRegistryW to connect to it._\n2. Next, it attempts to disable [UAC remote restrictions by setting the LocalAccountTokenFilterPolicy registry](https://support.microsoft.com/en-us/kb/951016)\n\nkey value to “1”.\n3. Once this is done, it connects to the target computer and copies itself as %System%\\ntssrvr32.exe or\n\n_%System%\\ntssrvr64.exe before setting either a remote service called “ntssv” or a scheduled task._\n\n### Step 3: Wiping the machine\n\nNext, the Trojan installs the wiper component. Note: TERBIUM establishes a foothold throughout the organization\nand does not proceed with the destructive wiping operation until a specific date/time: November 17, 2016 at 8:45\np.m.\n\nThe wiper component is installed as %System%\\<random name>.exe. During our testing, it used the name\n“routeman.exe”, but static analysis shows it can use several other names that attempt to imitate file names of\nlegitimate system tools.\n\nThe wiper component also contains encoded files in its resources as fake bitmap images.\n\nThe first encoded resource is a legitimate driver called RawDisk from the Eldos Corporation that allows a user\nmode component raw disk access. The driver is saved as %System%\\drivers\\drdisk.sys and installed by creating\na service pointing to it using “sc create” and “sc start”. This behavior can be observed in the process tree\navailable in the Windows Defender ATP portal. The below alert represents an example of the generic detections\nin Windows Defender ATP:\n\n\n-----\n\n_Figure 2. Windows Defender ATP alert: Depriz starting ephemeral service to load RawDisk driver “drdisk”_\n\n_Figure 3. Windows Defender ATP event tree: Depriz Trojan dropping the wiper component (named “routeman” in_\n_this instance), which in turn drops the RawDisk driver “drdisk”_\n\nThere are two interesting things worth noting about RawDisk:\n\nIt requires a valid license key from Eldos Corporation to run. However, the license key included in Depriz is\nthe same as the one used in the 2012 attacks – and this license key was only valid for a short period in\n2012. TERBIUM works around this by changing the system time on targeted computers to a valid period in\n2012.\nIt is the same as the driver used in the 2012 attacks.\n\n\n-----\n\n_Figure 4. Depriz license key (the same as the one used in 2012 attacks) and its limited validity period_\n\nThe wiper component uses an image file to overwrite files in locations listed in the following:\n\n_Master Boot Records (MBR)_\n_HKLM\\System\\CurrentControlSet\\Control\\SystemBootDevice_\n_HKLM\\System\\CurrentControlSet\\Control\\FirmwareBootDevice_\n_C:\\Windows\\System32\\Drivers_\n_C:\\Windows\\System32\\Config\\systemprofile_\nTypical user folders like “Desktop”, “Downloads”, “Documents”, “Pictures”, “Videos” and “Music”\n\nMicrosoft is also aware of a second threat that uses a distinct wiping component. We detect this as\n[Trojan:Win32/Cadlotcorg.A!dha in Defender and generic detections with Defender ATP. Microsoft is continuing to](https://www.microsoft.com/security/portal/threat/encyclopedia/Entry.aspx?Name=Trojan:Win32/Cadlotcorg.A)\nmonitor for additional information on this threat.\n\n### Step 4: Rendering the machine unusable\n\nFinally, the following command is used to reboot the system into the intended unusable state:\n\n_shutdown -r -f -t 2_\n\nWhen the computer attempts to restart after shutting down, it is unable to find the operating system because the\nMBR was overwritten in step 3. The machine will no longer boot properly.\n\n## Mitigation: Multiple layers of protection from Microsoft\n\nWindows 10 protects, detects and responds to this threat. Windows 10 has built-in proactive security\n[components, such as Device Guard, that mitigate this threat by restricting execution to trusted applications and](https://blogs.technet.microsoft.com/ash/2016/03/02/windows-10-device-guard-and-credential-guard-demystified/)\nkernel drivers.\n\nIn addition, [Windows Defender detects and remediates all components on endpoints as](https://www.microsoft.com/en-us/windows/windows-defender)\n[Trojan:Win32/Depriz.A!dha,](https://www.microsoft.com/security/portal/threat/encyclopedia/entry.aspx?Name=Trojan:Win32/Depriz.A!dha) [Trojan:Win32/Depriz.B!dha,](https://www.microsoft.com/security/portal/threat/encyclopedia/entry.aspx?Name=Trojan:Win32/Depriz.B!dha) [Trojan:Win32/Depriz.C!dha, and](https://www.microsoft.com/security/portal/threat/encyclopedia/entry.aspx?Name=Trojan:Win32/Depriz.C!dha)\n[Trojan:Win32/Depriz.D!dha.](https://www.microsoft.com/security/portal/threat/encyclopedia/entry.aspx?Name=Trojan:Win32/Depriz.D!dha)\n\n[Windows Defender Advanced Threat Protection (ATP), our post-breach security service, provides an additional](https://www.microsoft.com/en-us/windowsforbusiness/windows-atp?ocid=cx-blog-mmpc)\nlayer of security to enterprise users. With threat intelligence indicators, generic detections, and machine learning\n[models, Windows Defender ATP (trial link) provides extensive visibility and detection capabilities across the](https://www.microsoft.com/en-us/windowsforbusiness/windows-atp?ocid=cx-blog-mmpc)\nattack kill chain of threats like TERBIUM.\n\n### Appendix – Indicators of compromise\n\nWe discovered the following SHA1s in relation to TERBIUM:\n\nSHA1 hashes for malicious files\n\n\n-----\n\n5c52253b0a2741c4c2e3f1f9a2f82114a254c8d6\ne7c7f41babdb279c099526ece03ede9076edca4e\na2669df6f7615d317f610f731b6a2129fbed4203\n425f02028dcc4e89a07d2892fef9346dac6c140a\nad6744c7ea5fee854261efa403ca06b68761e290\n\nSHA1 hashes for legitimate RawDisk drivers\n\n1292c7dd60214d96a71e7705e519006b9de7968f\nce549714a11bd43b52be709581c6e144957136ec\n\nSignature names for malicious files\n\n_Mathieu Letourneau_\n\n\n-----\n\n**Talk to us**\n\n[Questions, concerns, or insights on this story? Join discussions at the Microsoft community and](https://answers.microsoft.com/en-us/protect) Windows\nDefender Security Intelligence.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-12-09 - Windows 10- protection, detection, and response against recent Depriz malware attacks.pdf"
    ],
    "report_names": [
        "2016-12-09 - Windows 10- protection, detection, and response against recent Depriz malware attacks.pdf"
    ],
    "threat_actors": [
        {
            "id": "f5fb4dc1-5777-4021-b9c2-4866246e4d74",
            "created_at": "2022-10-25T16:07:24.323585Z",
            "updated_at": "2025-03-27T02:02:10.170718Z",
            "deleted_at": null,
            "main_name": "Terbium",
            "aliases": [],
            "source_name": "ETDA:Terbium",
            "tools": [
                "Depriz"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "fec1dd86-d929-4691-b9ca-f804fb22971b",
            "created_at": "2023-01-06T13:46:38.5052Z",
            "updated_at": "2025-03-27T02:00:02.85067Z",
            "deleted_at": null,
            "main_name": "TERBIUM",
            "aliases": [],
            "source_name": "MISPGALAXY:TERBIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535583,
    "ts_updated_at": 1743041682,
    "ts_creation_date": 1653774806,
    "ts_modification_date": 1653774806,
    "files": {
        "pdf": "https://archive.orkl.eu/47b4f0c884e84a5f9c805f0e3e336e6d666d7f6c.pdf",
        "text": "https://archive.orkl.eu/47b4f0c884e84a5f9c805f0e3e336e6d666d7f6c.txt",
        "img": "https://archive.orkl.eu/47b4f0c884e84a5f9c805f0e3e336e6d666d7f6c.jpg"
    }
}