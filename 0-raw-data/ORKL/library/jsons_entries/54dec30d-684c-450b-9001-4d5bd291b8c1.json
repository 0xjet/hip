{
    "id": "54dec30d-684c-450b-9001-4d5bd291b8c1",
    "created_at": "2023-01-12T15:01:47.290515Z",
    "updated_at": "2025-03-27T02:09:18.742007Z",
    "deleted_at": null,
    "sha1_hash": "349d40703e80ea4e9342f8b1206dd96b361d2f9c",
    "title": "2022-07-27 - Gootkit Loader’s Updated Tactics and Fileless Delivery of Cobalt Strike",
    "authors": "",
    "file_creation_date": "2022-08-18T03:44:17Z",
    "file_modification_date": "2022-08-18T03:44:17Z",
    "file_size": 1587977,
    "plain_text": "# Gootkit Loader’s Updated Tactics and Fileless Delivery of Cobalt Strike\n\n**[trendmicro.com/en_us/research/22/g/gootkit-loaders-updated-tactics-and-fileless-delivery-of-cobalt-strike.html](https://www.trendmicro.com/en_us/research/22/g/gootkit-loaders-updated-tactics-and-fileless-delivery-of-cobalt-strike.html)**\n\nCyber Threats\n\n\nJuly 27, 2022\n\n\nGootkit has been known to use fileless techniques to drop Cobalt Strike and other malicious payloads. Insights from a recent attack reveal\nupdates in its tactics.\n\nBy: Buddy Tancio, Jed Valderama\nJuly 27, 2022\nRead time: ( words)\n\nOur in-depth analysis of what began as an unusual PowerShell script revealed intrusion sets associated with Gootkit loader. In the past,\nGootkit used freeware installers to mask malicious files; now it uses legal documents to trick users into downloading these files. We uncovered\n[this tactic through managed extended detection and response (MxDR) and by investigating a flag for a PowerShell script that allowed us to](https://www.trendmicro.com/vinfo/us/security/definition/managed-detection-and-response)\nstop it from causing any damage and dropping its payload.\n\nGootkit has been known to use fileless techniques to deliver noteworthy threats such as the SunCrypt, and REvil (Sodinokibi) ransomware,\n[Kronos trojans, and Cobalt Strike. In 2020, we reported on Gootkit capabilities. While it has kept much the same behavior as that in our](https://www.trendmicro.com/en_us/research/20/l/investigating-the-gootkit-loader.html)\nprevious report, updates reveal its continuing activity and development nearly two years later.\n\nAttack overview\n\n[Having been associated with a variety of payloads, we can assume that Gootkit runs on an access-a-as-a-service model. It can therefore be](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/investigating-the-emerging-access-as-a-service-market)\nused by different groups to conduct their attacks, making it worth monitoring to prevent bigger threats from successfully entering a system.\n\nFigure 1 illustrates its infection routine. It begins with a user searching for specific information in a search engine. In this case, the user had\nsearched for the keywords “disclosure agreement real estate transaction”. A website compromised by Gootkit operators was among the\nresults, meaning that the user did not open this compromised website by chance. Indeed, the operators had tweaked the odds in their favor by\nusing Search Engine Optimization (SEO) poisoning to make this website rank high in the search results, leading the user to visit the\ncompromised website. This also means that the website’s URL will not be available for long and that a full analysis would be difficult to conduct\nif not done immediately.\n\n\n-----\n\nFigure 1. The infection chain of Gootkit Loader as seen by MxDR\nUpon opening the website, we found that it presented itself as an online forum directly answering the victim’s query. This forum housed a ZIP\narchive that contains the malicious .js file. When the user downloaded and opened this file, it spawned an obfuscated script which, through\nregistry stuffing, installed a chunk of encrypted codes in the registry and added scheduled tasks for persistence. The encrypted code in the\nregistry was then reflectively loaded through PowerShell to reconstruct a Cobalt Strike binary that runs directly in the memory filelessly.\n\nMuch of what we have just described is still in line with the behavior we reported in 2020, but with a few minor updates. This indicates that\nGootkit Loader is still actively being developed and has proved successful in compromising unsuspecting victims.\n\nTwo noticeable changes stand out:\n\nThe search term now leverages legal document templates instead of freeware installers.\nEncrypted registries now use custom text replacement algorithm instead of base64 encoding.\n\nThe compromised website\n\nFollowing the behavior of users, we can now look at the website visited in the attack. Threat actors have been known to simply compromise a\nvulnerable or a misconfigured website to plant their malware or tools instead of creating or registering a new one for their malicious operation.\nIn the case of Gootkit, since it compromised a legitimate domain, the website used was likely to pass reputation services. For an unsuspecting\nuser, visiting the site would not arouse suspicion as it appears like a harmless website for a singing and voice coach.\n\n\n-----\n\nFigure 2. Homepage of the legitimate compromised website\nPerforming Google search specifically on the downloaded file (“disclosure agreement real estate transaction”) shows that the site’s content\nwas unrelated to its owner and its purpose. Additionally, none of these search result links can be found by navigating the site’s homepage\nitself. This is evidence that the website has been compromised, as it has allowed adversaries to inject or create new unrelated web content.\n[We also found more evidence of vulnerabilities when we queried the IP address via Shodan where the website was hosted.](https://www.shodan.io/)\n\nFigure 3.\n\nGoogle searches reveal unwanted contents in the website\n\n\n-----\n\ns tact c s ot g e o Goot t Coup ed t S O po so g, Goot t ope ato s ca e d ct s to a co p o sed ebs te a d ba t\nthem into downloading a file they are looking for. For this incident, we were able to stop Gootkit loader in its tracks before it dropped its\npayload. However, the user had already visited the website, downloaded the malicious ZIP file, and opened it. The unusual PowerShell script\nthat resulted from these actions alerted us to possible malicious activity. In this investigation, we try to piece together what would have\nhappened if the PowerShell script had not been flagged and had been allowed to run.\n\nInvestigation and analysis\n\nAs mentioned, the user visited the compromised website and downloaded the ZIP archive using Google Chrome. As logged by Trend Micro\nVision OneTM, the exact URL they visited is as follows:\n\nhxxps://www[.]{domain name}[.]co[.]uk/forum[.]php?\nuktoz=znbrmkp&iepdpjkwxusknzkq=3147417f829ff54ffe9acd67bbf216c217b16d47ac6a2e02c1b42f603121c9ad4b18757818e0bbdd5bab3aa1\n\nAs of writing, this URL is no longer accessible. However, we were able to analyze the ZIP archive downloaded by the user. As mentioned, it\nwas named disclosure agreement real estate transaction(8321).zip. In another instance, the JavaScript file was named tenancy agreement\n_between family members template(98539).zip. Both file names strongly suggest that Gootkit leverages keywords that refer to legal document_\ntemplates, likely to lure users into downloading files. It’s important to note that this chosen search term and topic is one of the notable changes\nfrom past campaigns.\n\nFigure 4. Vision One interface showing\n\nevidence of the user visiting the compromised website and downloading the ZIP archive\nThe ZIP archive was successfully saved in the Downloads folder C:\\Users\\{username}\\Downloads\\disclosure agreement real estate\n_transaction (8321).zip._\n\nFigure 5. The ZIP archive successfully saved in the\n\nuser’s Downloads folder\nThe user then opened the .js file inside the ZIP archive, which spawned an obfuscated PowerShell Script. The detected command line\nincluded wscript.exe, the default script interpreter of Windows operating systems. This command line runs the malicious JavaScript file. The\nfolder file path and the file name can be seen here:\n\nC:\\Windows\\System32\\WScript.exe\n\nC:\\Users\\{username}AppData\\Local\\Temp\\Temp1_disclosure agreement real estate\ntransaction(8321).zip\\disclosure_agreement_real_estate_transaction 3994.js\n\n\n-----\n\nFigure 6. Obfuscated PowerShell Script\n\nspawned through the .js file\nBy using Vision One’s AMSI Telemetry, the team was able to view the decoded script at runtime and build the order of events that it generated.\nIn the decoded script, there are three potentially compromised domains listed. The domains themselves are legitimate websites. Gootkit only\nselects one and constructs the full URL to get the next stage of script execution. The three domains are listed here:\n\n_learn[.]openschool.ua – Education_\n_lakeside-fishandchips[.]com – Restaurants and food_\n_kristinee[.]com – Personal sites_\n\nFigure 7. Decoded script logged by Vision One’s AMSI telemetry\nDecoding the script also led us to discover that two stages of script are used to complete the operation. The first stage script carries out the\nfollowing:\n\nIt checks for the registry HKCU\\PJZTLE and creates it if not found. This serves as an infection marker as we discussed in our previous\nblog.\nIt then checks if the current user is logged in to a domain that might be used to bypass sandbox tools.\nNext, it connects to the constructed URL to fetch the next script to be executed. For this case, it retrieved the second stage script from\n_hxxps://learn[.]openschool[.]ua/test.php?mthqpllauigylit=738078785565141._\nIt then sleeps for 10 seconds before running the fetched codes.\n\nFigure 8. First stage script execution flow as logged by Vision One’s AMSI telemetry\nTh d t i t t i d f th f ti d i d b it li h th li t d i f ti h\n\n\n-----\n\nt gets t e cu e t use a e a e o e t st gs\nIt checks the target registry and creates it if it does not exist. It performs registry stuffing for persistence, wherein two sets of registries\nare created, each containing encrypted binaries to be decoded and executed later:\n\nHKEY_CURRENT_USER\\\\SOFTWARE\\\\Microsoft\\\\Phone\\\\{loggedOnUser}\\\\{consecutive numbers}, which contains binary payload\nencrypted using custom text replacement\nHKEY_CURRENT_USER\\\\SOFTWARE\\\\Microsoft\\\\Phone\\\\{loggedOnUser}0\\\\{consecutive numbers}, which contains hex-encoded\nbinary used to decode and execute the first registry\n\nFigure 9. Registry stuffing on \\\\Phone\\\\{loggedOnUser}\\\\ as logged by Vision One’s AMSI telemetry\n\nFigure 10. Registry stuffing on \\\\Phone\\\\{loggedOnUser}0\\\\ as logged by Vision One’s AMSI telemetry\nAfter these two stages, it finally executes two encrypted PowerShell scripts also logged by AMSI Telemetry. The first one decrypts the binary of\nthe registry \\\\Phone\\\\{loggedOnUser}0\\\\ and uses to initiate a function named “Test”.\n\nFigure 11. Decoded first PowerShell script as logged by Vision One’s AMSI telemetry\nThe second PowerShell script installs persistence mechanism via Scheduled Task, where it assigns the username as its Task Name.\n\nFigure 12. Decoded second PowerShell script as logged by Vision One’s AMSI telemetry\nThe scheduled task loads the binary on \\Phone\\{loggedOnUser}0 registry, which in turn decrypts and executes the final payload found in\n_\\Phone\\{loggedOnUser} registry using the same reflective code loading technique._\n\nThe final payload for this instance was found to be a Cobalt Strike binary, which has also been spotted to connect to Cobalt Strike’s commandand-control (C&C) server.\n\nThe Cobalt Strike payload\n\nThe Cobalt Strike binary reflectively loaded directly to the memory has been seen connecting to the IP address 89[.]238[.]185[.]13. Using\ninternal and external threat intelligence, the team validated that the IP address is a Cobalt Strike C&C. Cobalt Strike, a tool used for postexploitation activities, uses the beacon component as the main payload that allows the execution of PowerShell scripts, logging keystrokes,\ntaking screenshots, downloading files, and spawning other payloads.\n\n\n-----\n\nFigure 13. Cobalt Strike C&C based on the graph from Virus Total\nSecurity recommendations\n\nOne key takeaway from this case is that Gootkit is still active and improving its techniques. This implies that this operation has proven\neffective, as other threat actors seem to continue using it. Users are likely to encounter Gootkit in other campaigns in the future, and it is likely\nthat it will use new means of trapping victims.\n\nThis threat also shows that SEO poisoning remains an effective tactic in luring unsuspecting users. The combination of SEO poisoning and\ncompromised legitimate websites can mask indicators of malicious activity that would usually keep users on their guard. Such tactics highlight\nthe importance of user awareness and the responsibility of website owners in keeping their cyberspaces safe.\n\nOrganizations can help by conducting user security awareness training for their employees, which aims to empower people to recognize and\nprotect themselves against the latest threats. In this instance, for example, the threat could have been avoided earlier if the user had been\nmore wary of downloading JavaScript files. On the other hand, website owners must make better web hosting choices by opting for web host\nproviders who emphasize security in their own servers\n\n\n-----\n\ns case g g ts t e po ta ce o / o to g otab y, c oss p at o p e e ted t s attac o esca at g, s ce e e e ab e\nto isolate the affected machine quickly stopping the threat from inflicting further damage on the network. A Cobalt Strike payload, for example,\ncan result in worse problems, such as the deployment of ransomware, credential dumping for lateral movement, and data exfiltration. Managed\nXDR service prevented all of this from being realized.\n\n[Organizations can consider Trend Micro Vision One, which offers the ability to detect and respond to threats across multiple security layers. It](https://www.trendmicro.com/en_us/business/products/detection-response.html)\ncan isolate endpoints, which are often the source of infection, until they are fully cleaned or the investigation is done.\n\nIndicators of compromise (IOCs)\n\nTrojan.BAT.POWLOAD.TIAOELD\n\ncbc8733b9079a2efc3ca1813e302b1999e2050951e53f22bc2142a330188f6d4\nf1ece614473c7ccb663fc7133654e8b41751d4209df1a22a94f4640caff2406d\n\nTrojan.PS1.SHELLOAD.BC\n\n8536bb3cc96e1188385a0e230cb43d7bdc4f7fe76f87536eda6f58f4c99fe96b\n\nURLs\n\nhxxps://www[.]{domain name}[.]co[.]uk/forum[.]php?\nuktoz=znbrmkp&iepdpjkwxusknzkq=3147417f829ff54ffe9acd67bbf216c217b16d47ac6a2e02c1b42f603121c9ad4b18757818e0bbdd5bab3aa\n= Disease vector\nhxxps://learn[.]openschool.ua/test[.]php?mthqpllauigylit=738078785565141 = Disease vector\n89[.]238[.]185[.]13 = C&C server (Cobalt Strike IP address)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-27 - Gootkit Loader’s Updated Tactics and Fileless Delivery of Cobalt Strike.pdf"
    ],
    "report_names": [
        "2022-07-27 - Gootkit Loader’s Updated Tactics and Fileless Delivery of Cobalt Strike.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535707,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1660794257,
    "ts_modification_date": 1660794257,
    "files": {
        "pdf": "https://archive.orkl.eu/349d40703e80ea4e9342f8b1206dd96b361d2f9c.pdf",
        "text": "https://archive.orkl.eu/349d40703e80ea4e9342f8b1206dd96b361d2f9c.txt",
        "img": "https://archive.orkl.eu/349d40703e80ea4e9342f8b1206dd96b361d2f9c.jpg"
    }
}