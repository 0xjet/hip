{
    "id": "9d896cf6-c222-4f6f-a2ae-d8c3c7526d2b",
    "created_at": "2022-10-25T16:48:16.240988Z",
    "updated_at": "2025-03-27T02:16:11.629291Z",
    "deleted_at": null,
    "sha1_hash": "e44fd15d300201fd936f9556f40de578c8049f41",
    "title": "VB2021 paper: UNC788: Iran’s decade of credential harvesting and surveillance operations",
    "authors": "",
    "file_creation_date": "2021-07-15T15:23:23Z",
    "file_modification_date": "2021-07-15T15:33:13Z",
    "file_size": 3796931,
    "plain_text": "#### emiel.haeghebaert1@mandiant.com\n\n\n**7 - 8 October, 2021 / vblocalhost.com**\n\n\n-----\n\n**ABSTRACT**\n\nDriven by the authoritarian’s desire for regime survival, Iran’s Islamic Revolutionary Guard Corps (IRGC) and Ministry of\nIntelligence (MOIS) have long conducted extensive domestic surveillance and espionage operations against the country’s\ndomestic populace and foreign targets of strategic intelligence value. This paper analyses and dissects UNC788’s most\nrecent domestic surveillance operation with a malicious Android application dubbed PINEFLOWER. Our analysis\nconfirmed that the actors exfiltrated recorded phone calls, room audio recordings, pictures and entire SMS inboxes along\nwith relevant metadata from devices which appeared to belong to individuals residing in Iran. At least one device belonged\nto an individual who appears to be engaged in social activism in Iran. This activity confirms long-standing suspicions that\nUNC788 conducts domestically focused operations as part of its mandate to conduct cyber espionage and credential\nharvesting operations in support of Iranian strategic priorities.\n\nThe results presented in this paper are based on threat intelligence, collection and reverse engineering of threat actor tools,\nand analysis of their malicious infrastructure. This paper will focus on my experience and analytical process uncovering\nthis operation by stepping through the initial discovery of the malicious infrastructure, discussing the various tools used to\npivot to additional actor resources and to facilitate victim data analysis, and by exploring the evidence underpinning our\nattribution assessment.\n\n**INTRODUCTION**\n\nIn December 2020, FireEye published a blog post [1] detailing its use of ‘UNC’ groups – or ‘uncategorized’ groups – as\na way of clustering and keeping track of threat activity clusters that are not yet eligible to be classified as APT or FIN\ngroups. As the blog notes, UNCs are created around a defining, anchoring characteristic of threat activity and, ‘as we\ndiscover new artifacts associated with other incidents and proactive collections efforts, the UNC provides a framework\nto join discrete pieces of evidence together.’ UNCs include observables such as adversary infrastructure, tools and\ntradecraft, and can grow, merge with, or break off from other clusters as more data becomes available over time. The\nblog provides several case studies.\n\n_FireEye analysts created UNC788 in May 2017 to track a large group of credential-harvesting domains. Over time, we_\ncreated new UNCs that we suspected, but at the time could not prove, were part of the same sustained credential-harvesting\neffort defined by UNC788. As of early 2021, however, we have merged seven clusters with UNC788, resulting in a large\nactivity that we believe first became operational in 2012. The group remains highly active.\n\nIt is inherent in any threat intelligence capability that clustering of activity does not map 1:1 in all cases to those of other\nresearchers, vendors or organizations. As a result we have a complex adversary- and malware-naming environment, where\nmultiple names can refer to either the same activity, elements thereof, or simply a related operation. The threat activity we\ntrack as UNC788, however, largely corresponds to activity others track as TA453 (Proofpoint), Phosphorus (Microsoft) and\nCharming Kitten (ClearSky Cyber Security, Certfa Lab).\n\n**LITERATURE REVIEW**\n\nUNC788 operations have been well documented over the past several years. One of the first public reports on the group\ndates to June 2015, when ClearSky Cyber Security (‘ClearSky’) published its report on ‘Thamar Reservoir’ [2], an\noperation targeting approximately 500 individuals active in academia, security and defence, journalism, and human rights\nactivism in the Middle East. ClearSky further suggested that the campaign may have begun in mid-2014. A 2017 ClearSky\nreport then named Charming Kitten as an Iranian cyber espionage group pursuing access to private email and Facebook\naccounts as opposed to compromising larger organizations, linking the Thamar Reservoir activity to Charming Kitten [3].\nTwo years later, ClearSky reported that it had observed Charming Kitten targeting academic researchers and influential\npublic figures around the world. To do so, the group used spear phishing messages impersonating researchers or journalists\ninviting the victim to an event or encouraging the target to review their resume [4].\n\nThis type of activity is consistent with Microsoft’s reporting on ‘Phosphorus’ in October 2019, when the company stated\nits security researchers had observed Phosphorus, which they linked to the Iranian government, targeting accounts\n‘associated with a US presidential campaign, current and former US government officials, journalists covering global\npolitics and prominent Iranians living outside Iran’ [5]. Microsoft noted that the group, while not technically\nsophisticated, appeared highly motivated and willing to invest significant time and resources in its operations. This\nreport came on the heels of Microsoft’s filing of an official complaint in March 2019, alleging the defendants had\nestablished an Internet-based cyber-theft operation referred to as Phosphorus, which allowed the company to seize 99\ndomains used by the group [6].\n\nIn a follow-on report in October 2019, ClearSky researchers subsequently wrote that they assessed with a medium to high\nlevel of confidence that the aforementioned Microsoft blog and ClearSky’s reporting were indeed tracking the same activity\n\n[7]. In this report, they further detailed Charming Kitten’s most recent attack vectors, including spear phishing,\nimpersonating social media websites and using these platforms to distribute malicious links, and sending SMS messages\ndirectly to a target’s cellular device.\n\n\n-----\n\nThe group remained highly active during 2020, with numerous news articles discussing UNC788’s persistent operations\nagainst high-level individuals, journalists, conference attendees, and political and human rights activists. In January 2020,\n_Certfa Lab (‘Certfa’) published a report detailing its investigation of phishing campaigns with the apparent objective to_\nsteal email account data and information on the victim’s contacts. The group used fake interview invitations, and in one\ncase impersonated a known New York Times reporter, to entice the target to log into, for example, a fake Google page.\nSimilar to the activity described in previous reporting, this time Charming Kitten went after government institutions, think\ntanks, and academics institutions, but also organizations with ties to the Baha’i faith [8]. Additional campaigns in 2020\ntargeted attendees at the Munich Security Conference [9] and an Iran analyst at the Atlantic Council [10]. Notably, in\nmid-2020, researchers at IBM X-Force retrieved from an open directory server what appeared to be ‘training demonstrations\nthe Iran-backed hackers made to show junior team members how to handle hacked accounts’ [11]. This discovery appears\nto corroborate Microsoft’s perception that the group is not particularly adept at operational security.\n\nIn the early stages of the COVID-19 pandemic, a noticeable shift in the group’s targeting patterns occurred. For the first\ntime, UNC788 started pursuing public health, medical technology, and pharmaceutical information. According to\n_Reuters, the actor started conducting credential harvesting operations against the personal email accounts of staff at the_\nWorld Health Organization [12]. In May 2020, open sources reported that the group targeted Gilead, a US drugmaker at\nthe time working on treatments for COVID-19 [13]. Interestingly, the group appeared interested in medical research\nbeyond treatments or vaccines for COVID-19. Most recently, in March 2021, Proofpoint reported that TA453 had\n‘launched a credential phishing campaign targeting senior medical professionals who specialize in genetic, neurology\nand oncology research in the United States and Israel’ [14]. Iran suffers from rampant shortages of medical equipment,\nsupplies, and drugs, including for cancer treatments [15], despite US economic sanctions explicitly not applying to\nmedical devices or medicine. These types of operations may indicate renewed efforts by the regime to try to offset\nthese challenges.\n\n**_Note: The threat activity cluster Mandiant tracks as UNC788 generally corresponds with the activity ClearSky and Certfa_**\n_have reported on as Charming Kitten, that Microsoft tracks as Phosphorus, and that Proofpoint calls TA453. However, public_\n_reporting frequently describes this actor as ‘also known as APT35’. Mandiant tracks APT35 as distinct from UNC788._\n\n**UNC788 DEFINED**\n\nUNC788 is a cluster of threat activity Mandiant suspects conducts cyber espionage operations on behalf of the Iranian\ngovernment. The group is characterized by credential theft operations against corporate and personal email accounts and\nhas consistently targeted Western think tanks and academics, current and former government officials, members of the\nIranian diaspora in the United Kingdom, Israel, and the United States, as well as high-profile individuals within Iran. In\n2020, we also observed UNC788 targeting employees of pharmaceutical companies in the United States and the United\nKingdom, in line with public reporting, in a likely effort to obtain medical information in support of the COVID-19\nresponse. This suggests the group may alter its operational focus as Iran’s strategic priorities evolve over time. UNC788 has\nbeen operational since at least 2012 and likely evolved from the participants of Iranian hacktivist forums.\n\nIran’s Islamic Revolutionary Guard Corps (IRGC) and Ministry of Intelligence (MOIS) have long conducted extensive\ndomestic surveillance and espionage operations against its domestic populace and foreign targets of strategic\nintelligence value.\n\nIn March 2021, we uncovered a widespread domestic surveillance operation using a malicious Android application\ndubbed PINEFLOWER. We detected the campaign during our routine monitoring for UNC788 infrastructure procurement.\nThe next several sections of this paper will discuss our discovery of this operation and our analysis of the PINEFLOWER\nmalware.\n\n**INFRASTRUCTURE: INITIAL DISCOVERY**\n\nDuring routine monitoring for newly procured infrastructure configured in a manner consistent with UNC788’s domain\nregistration pattern, we identified the domain ‘display-monitor[.]site’ resolving to the IP addresses 198[.]23[.]213[.]155 and\n198[.]23[.]213[.]157, where it still resolves at the time of writing and is likely parked. Also resolving to the former IP\naddress a few weeks prior was the domain ‘account-inbox[.]com’ (see Table 1).\n\n**Domain** **Registered on** **IP resolution** **First seen** **Last seen**\n\n198.23.213.155 2020-02-20 2020-02-21\ndisplay-monitor.site 2021-02-20\n\n198.23.213.157 2021-02-22 2020-06-07\n\naccount-inbox.com 2020-12-20 198.23.213.155 2020-12-20 2021-01-03\n\n_Table 1: Suspicious domains and resolution data._\n\n|Domain|Registered on|IP resolution|First seen|Last seen|\n|---|---|---|---|---|\n|display-monitor.site|2021-02-20|198.23.213.155|2020-02-20|2020-02-21|\n|||198.23.213.157|2021-02-22|2020-06-07|\n|account-inbox.com|2020-12-20|198.23.213.155|2020-12-20|2021-01-03|\n\n\n-----\n\nThe DNS Start of Authority (SOA) entry for ‘account-inbox.com’ was set to ‘nami.rosoki@gmail.com’, an email address\nwe have historically observed UNC788 use to register malicious infrastructure. One of these malicious domains,\n‘youtubee-videos.com’, was registered in July 2017 and mimicked the Telegram login page in an attempt to steal user\ncredentials, as detailed in this 2018 Cisco Talos blog [16]. The re-use of this email address for domain registration is also\nindicative of the actor’s relatively low regard for operational security.\n\n_Figure 1: Domain registration email for ‘account-inbox[.]com’ on DomainTools._\n\n**INFRASTRUCTURE: PIVOTING**\n\nThe domain ‘display-monitor[.]site’ hosted content impersonating a legitimate flower shop based in North Carolina in the\nUnited States. A scan of the domain available on VirusTotal also shows that links to the legitimate company’s social media\npages were hosted on this site, suggesting the actors had scraped the flower shop’s website in an attempt to make the\ndomain appear benign.\n\nPivoting on the URLs in VirusTotal leads to another suspicious domain, ‘developer-app[.]xyz’, which also matched\nUNC788’s domain registration patterns. The actors hosted the same scraped flower shop content on this domain, according\nto a screenshot saved by DomainTools.\n\n_VirusTotal showed a file that communicated with this domain, named ‘WhatsApp.apk’ (Figure 2). Considering the_\nproximity in space of ‘display-monitor[.]site’ to ‘developer-app[.]xyz’, which served as a C&C server for this newly\nidentified APK, we hypothesize that this implant may be operated by the same actor. Having observed the scraped flower\nshop content on the two malicious domains, we chose to dub the Android malware f amily PINEFLOWER.\n\n_Figure 2: ‘WhatsApp.apk’ listed as a communicating file to ‘developer-app[.]xyz’._\n\nThe APK file appeared to have two DEX files bundled within it (Figure 3).\n\n_Figure 3: WhatsApp.apk bundled files._\n\nThe strings of the ‘assets/classes.dex’ file show the string ‘.data_gsc98647a3’, which appeared to be relatively unique\n(Figure 4).\n\n\n-----\n\n_Figure 4: ‘assets/classes.dex’ strings._\n\nA second DEX file contained this unique string, suggesting they may be related, even though this second sample was\nsubmitted to VirusTotal in January 2018. The parent APK file appeared to be spoofing Google Services, using\n‘GoogleServices’ as the subject and issuer of the certificate, and using the Google Services icon.\n\n**Filename** **SHA256** **C&C**\n\nWhatsApp.apk c2c1d804aeed1913f858df48bf89a58b1f9819d7276a70b50785cf91c9d34083 developer-app[.]xyz\n\nN/A (spoofing hardship90e5fa3f382c5b15a85484c17c15338a6c8dbc2b0ca4fb73c521892bd853f226\nGoogle Services) management[.]com\n\n_Table 2: PINEFLOWER samples._\n\nThe C&C server ‘hardship-management[.]com’ had been mentioned in a public blog called Iran Cyber News and an article\ntitled ‘CORRUPT KITTEN Exposed’ [17]. CORRUPT KITTEN was the author’s chosen name for an Android implant that,\naccording to the blog, ‘supports a full range of spying and device management capability’. The blog contained a summary\nanalysis of this CORRUPT KITTEN implant and an MD5 hash for a DEX file allegedly using the same C&C server.\nNotably, the author also noted that the malware stored files ready for exfiltration in a directory named ‘.data_gsc98647a3’,\nthe string we identified in our PINEFLOWER samples. It seemed likely that CORRUPT KITTEN and PINEFLOWER\nwere one and the same.\n\nFinally, by pivoting on the known infrastructure, we identified additional domains that may be related to UNC788 activity.\nNotably, the C&C server 91[.]134[.]244[.]133 shared an SSL certificate with the IP address 79[.]137[.]3[.]102, which also\nhosted both ‘developer-app[.]xyz’ and ‘inbox-account[.]info’. In turn, the IP 91[.]121[.]217[.]34 had also hosted\n‘secure-team[.]xyz’ and ‘device-monitor[.]xyz’ (see Table 2). While this infrastructure is suspicious and roughly matches\nUNC788’s domain registration pattern, we were unable to definitively attribute the domains to the group at the time this\nreport was written.\n\n**Domain** **IP resolution** **First seen** **Last seen**\n\ndeveloper-app.xyz 79.137.3.102 2020-08-18 2020-12-31\n\n79.137.3.102 2021-01-09 2021-01-09\n\ninbox-account.info\n\n91.121.217.34 2020-09-23 2020-12-16\n\nsecure-team.xyz 91.121.217.34 2020-09-20 2020-09-21\n\nsecure-team.xyz 51.178.144.3 2020-09-10 2020-09-10\n\ndevice-monitor.xyz 91.121.217.34 2020-10-07 2021-06-10\n\n_Table 3: Additional suspicious infrastructure._\n\n|Filename|SHA256|C&C|\n|---|---|---|\n|WhatsApp.apk|c2c1d804aeed1913f858df48bf89a58b1f9819d7276a70b50785cf91c9d34083|developer-app[.]xyz|\n|N/A (spoofing Google Services)|90e5fa3f382c5b15a85484c17c15338a6c8dbc2b0ca4fb73c521892bd853f226|hardship- management[.]com|\n\n|Domain|IP resolution|First seen|Last seen|\n|---|---|---|---|\n|developer-app.xyz|79.137.3.102|2020-08-18|2020-12-31|\n|inbox-account.info|79.137.3.102|2021-01-09|2021-01-09|\n||91.121.217.34|2020-09-23|2020-12-16|\n|secure-team.xyz|91.121.217.34|2020-09-20|2020-09-21|\n|secure-team.xyz|51.178.144.3|2020-09-10|2020-09-10|\n|device-monitor.xyz|91.121.217.34|2020-10-07|2021-06-10|\n\n\n-----\n\nFigure 5 provides a visual overview of our discovery and pivots, including the activity surrounding the Android implant we\ndubbed PINEFLOWER, the suspected related activity, and the links to historical activity.\n\n**PINEFLOWER: TECHNICAL ANALYSIS**\n\nIn this section, I describe the technical analysis we conducted on PINEFLOWER. We used a variety of tools including the\n_MobSF Framework [18], an Android emulator built into Android Studio, and jadx GUI [19] for code analysis. While our_\ninitial analysis was done statically, followed by running PINEFLOWER in an emulator and MobSF, we have combined our\nfindings here to describe the execution pattern of the malware. Of the two samples available for analysis, we focused on the\nsample most recently submitted to VirusTotal, ‘WhatsApp.apk’.\n\n**Initial execution**\n\nUsing the emulator built into Android Studio, we ran the ‘WhatsApp.apk’ sample on several devices to observe its\nbehaviour. Upon installation of the PINEFLOWER malware, the malicious application masquerades as WhatsApp before\nhiding itself and running in the background. On devices running Android 11, the user is prompted to accept various\npermissions and the application remains visible from the main menu (Figure 6).\n\n_Figure 5: Overview of PINEFLOWER activity._\n\n\n-----\n\n_Figure 6: Installing WhatsApp.apk_\n_(SHA256: c2c1d804aeed1913f858df48bf89a58b1f9819d7276a70b50785cf91c9d34083) on Android 11._\n\nOn older devices, the user is not prompted to accept permissions. Instead, once the application is installed, it is hidden from\nthe main menu while it continues running in the background (Figure 7).\n\n_Figure 7: Installing WhatsApp.apk_\n_(SHA256: c2c1d804aeed1913f858df48bf89a58b1f9819d7276a70b50785cf91c9d34083) on Android 4.0._\n_Install complete (left), application list (middle), running process (right)._\n\n\n-----\n\nOnce the malware has successfully been installed on the device, it sends an initial beacon to the command-and-control\nserver. PINEFLOWER first reads the decimal-encoded C&C hard coded in the malware (Figure 8). The array decodes to\nhttp://developer-app.xyz/.\n\n_Figure 8: Hard-coded C&C in WhatsApp.apk_\n_(SHA256: c2c1d804aeed1913f858df48bf89a58b1f9819d7276a70b50785cf91c9d34083)._\n\nThe beacon, sent to the C&C via an HTTP POST request, contains a SHA-1 value of the hard-coded AES key, device, and\nnetwork information:\n\n**Parameter** **Value**\n\n&sk= Plaintext SHA-1 value of the hard-coded AES key\n\n&di= Device information\n\n&t= Network type\n\n&st= Network sub-type\n\n&dt= Current timestamp\n\n_Table 4: Parameters and values for initial beacon._\n\nThe device information passed to the C&C server is formatted into JSON in the following key-value pairs (Figure 9):\n\n_Figure 9: Device information included in the initial beacon._\n\nUsing MobSF’s dynamic analysis feature, we captured an example beacon containing device information to the C&C server\n‘developer-app[.]xyz’ via port TCP/80:\n\n|Parameter|Value|\n|---|---|\n|&sk=|Plaintext SHA-1 value of the hard-coded AES key|\n|&di=|Device information|\n|&t=|Network type|\n|&st=|Network sub-type|\n|&dt=|Current timestamp|\n\n\n-----\n\nPOST http://developer-app.xyz/ HTTP/1.1\n\nConnection: Keep-Alive\n\nContent-Type: application/x-www-form-urlencoded\n\nUser-Agent: Dalvik/2.1.0 (Linux; U; Android 9; Samsung A50 Build/PI)\n\nHost: developer-app.xyz\n\nAccept-Encoding: gzip\n\nContent-Length: 507\n\ngs=&sk=dd8b9bf8f4d243a20bc8a0e34464d69a1fd3786c&di=t3W0kEXtGPdUm3jOw3dfo0PRlTb4I3O0mabCQnROU2sgUWas4y0Bx2gQj1vNdNFlpQNHIuVjdt5qwsNT3THVDW60fXHP8GvjzLLWNSHF6W6l6E82ie0OeNpvuEpCGw4TlnlOA65VjvZZ5TNk-sxMRJXiqnpR9nKtJ77GAXBUIIInrBcQf08aJFhNPW8gJUPR-j-DWj3zwYIMnQnmHaE5fybUCaCkjq9U\nlYhvboC-2eWuxntf6TbWZlEkkqIt-cYx7dbynJbw4D6MsNlF8yShNSzMHDl1iNL3yqtz7mcyWEg-bdX4O5ANJsHQaYew_\nEwAkgZl8IOKrz4gFIVMAHHOEKe8V4iXwnYtg0Xm9NY6BQAzBzHelewx62B8_i1mOgX1U-WjhAMAcM76R17YXts8rUaRwGbjFs\nvKGTvxtUwAk=&t=WIFI&st=&dt=1615044612295\n\nAfter this initial beacon, PINEFLOWER waits for commands from the C&C server and uses a local SQLite database to\nstore queued commands as well as results of tasks run by these commands. When the malware successfully executes one of\nits modules following a command from its C&C, it adds a new entry to the SQL database. The final SQLite database can be\nuploaded to the C&C server (Figure 10).\n\n_Figure 10: PINEFLOWER reading SQLite into an ArrayList for uploading to the C&C._\n\n**Supported commands**\n\nPINEFLOWER can receive and support a wide range of commands from the C&C server. Some notable commands,\nincluding ‘calls_recorder’, ‘sound_recorder’, ‘sms_inbox’ and ‘picture_take’, suggest the malware is capable of recording\ncalls, triggering sound recordings, taking pictures using the compromised device’s camera, and exfiltrating SMS inboxes.\nTable 5 shows the supported commands and the first 16 characters of the corresponding SHA-1 value, which the malware\nthen uses to name files for exfiltration.\n\n**Staging & exfiltration**\n\nFiles ready for exfiltration are stored in a directory that is hard coded into the malware:\n\n - Android/.data_gsc98647a3\n\nWhen PINEFLOWER writes the files to this folder, it generates a unique filename in the following format:\n\n - <first 16 characters of command name SHA-1 value>_<first 21 characters of a random UUID, dashes removed>.<Unix\ntimestamp>.complete.d\n\nFor example, for the file ‘c2cc53c99fb858a9_871388f9f5f14c178246e.1606985941.complete.d’:\n\n - ‘c2cc53c99fb858a9’ are the first 16 characters of the SHA-1 value for ‘sound_recorder’, which is\nc2cc53c99fb858a9c6c836d0f48c874b1d78d00b.\n\n - ‘871388f9f5f14c178246e’ is the result of a randomly generated UUID with the dashes removed.\n\n - ‘1606985941’ is a Unix timestamp that converts to ‘12/3/2020 03:55:35’.\n\n\n-----\n\n|Command|Corresponding SHA-1 substring|\n|---|---|\n|apps_list|8f3be153969c9aa6|\n|browser_history|56f4befcfa372f61|\n|call_number|8b9df28139b454a9|\n|calls_log_incoming|d4d5231bef6126e8|\n|calls_log_missed|46f2dbefa9720460|\n|calls_log_outgoing|a4efe3347d23277c|\n|calls_recorder|e7726cbe08d9659f|\n|camera_list|608b155f62c6c1b4|\n|contacts|9db49a59249eefb6|\n|device_info|34d58e358ce6f6c8|\n|directory_list|df0f6e126aaa7f10|\n|error_list|41ad8be6d52578e0|\n|file_delete|922e797471f4ba60|\n|file_download|2a8cc636df3df9b8|\n|file_list|0d4a23c7f51b588e|\n|file_upload|cfd82bcb40eef62d|\n|live_stream|66d94e991e567a62|\n|location_gps|0833b18e25e64e42|\n|location_gsm|3187d46fc0eca417|\n|network_activity|cb427b6ab37d2df6|\n|network_speed|5f199ca6dc7c3d64|\n|network_state|357443daf3d17473|\n|off_bluetooth|e73d159feaa06fa1|\n|off_data|de4e691bfe0e4915|\n|off_wifi|cdf0e953385891d7|\n|on_bluetooth|1d92dfb895429a27|\n|on_data|b2a51f869599157b|\n|on_wifi|0717a22ec8f04949|\n|picture_take|5a0f66c8648bd121|\n|screen_state|7c3412627241e1c3|\n|sim_card|6cd9c5d08fc6f34d|\n|sms_drafts|fc64df0c3c72954a|\n|sms_inbox|9f3d6768e601e1ac|\n|sms_outbox|073fb2c5ce013bcc|\n|sms_send|3d0226299ebe4e8d|\n|sound_recorder|c2cc53c99fb858a9|\n|storage_activity|b502a71ef356e559|\n|video_recorder|be2b031af63496f2|\n\n\n_Table 5: PINEFLOWER supported commands._\n\n\n-----\n\n_Figure 11: Filename generation methods._\n\nPINEFLOWER uses a compression and encryption routine to obfuscate the files prior to exfiltration. Similar to the\nhard-coded C&C, the encryption key and IV for the AES-128-CBC encryption are stored in a decimal-encoded byte array\n(Figure 12).\n\n_Figure 12: Encryption key and IV hard coded into decimal-encoded byte arrays._\n\nPINEFLOWER first compresses the data via GZIP, and then passes the key and IV as parameters to a function that encrypts\nthe data using AES-128-CBC (Figure 13).\n\n\n-----\n\n_Figure 13: Compression with GZIP and encryption using AEC-128-CBC._\n\nFinally, for each exfiltrated file, the malware appends a Base64-encoded JSON object containing the name of the original\ncommand, a Unix timestamp, and a Boolean ‘data’ field to the file data. The following is an example of such\nBase64-encoded string that would be appended to an audio file:\n\n - eyJuYW1lIjoic291bmRfcmVjb3JkZXIiLCJkYXRlIjoxNjA2OTg3NjQwMTczLCJkYXRhIjoiZmFsc2UifQ\n\nBase64 decoded, this string is:\n\n - {“name”:“sound_recorder”,“date”:1606987640173,“data”:“false”}\n\nOur analysis showed that PINEFLOWER would not use the compression and encryption routine on every file it prepares\nfor exfiltration. Rather, some files are simply saved in the .complete.d format and have the Base64-encoded string, as\nshown above, appended to the content. It is therefore likely that these files could simply be saved with the correct file\nextension or opened with appropriate software.\n\nThe only differences we observed between the two samples of PINEFLOWER are in the hard-coded key and IV\ncombinations for the encryption routine and the C&C servers. While the Iran Cyber News blog listed an MD5 hash value\nfor a third sample we were unable to retrieve, the blog’s description of the implant matched our analysis of PINEFLOWER.\n\n**Hash value** **Key** **IV**\n\n0ab74c36977632a8dc517fb0c8c95189 (Iran Cyber News) f3544c085656c997 4fcff6864c594343\n\nc2c1d804aeed1913f858df48bf89a58b1f9819d7276a70b50785cf91c9d34083 f3544c085656c997 4fcff6864c594343\n\n90e5fa3f382c5b15a85484c17c15338a6c8dbc2b0ca4fb73c521892bd853f226 f3544c085656c997 13b51944653a5fff\n\n_Table 6: PINEFLOWER samples and AES-128-CBC encryption keys and IVs._\n\n**PINEFLOWER summary**\n\nWhile the AndroidManifest.xml file details a much longer list of permissions requested by the application, the most\nnoteworthy features of PINEFLOWER include the following capabilities:\n\n - Surveying:\n\n    - Installed apps\n\n    - Call logs and recording calls\n\n    - Stored contacts\n\n    - Files in local storage\n\n    - SMS drafts, inboxes and outboxes\n\n    - Live device locations via GPS and cell tower\n\n    - Connectivity state, speed and activity\n\n    - Screen state\n\n - Uploading basic device, software, SIM information, and errors during command execution\n\n - Deleting, downloading and uploading files\n\n - Live screen recording\n\n - Toggling Bluetooth, Wi-Fi and mobile data on or off\n\n - Taking pictures\n\n - Sending SMS messages\n\n - Recording sound and video\n\n|Hash value|Key|IV|\n|---|---|---|\n|0ab74c36977632a8dc517fb0c8c95189 (Iran Cyber News)|f3544c085656c997|4fcff6864c594343|\n|c2c1d804aeed1913f858df48bf89a58b1f9819d7276a70b50785cf91c9d34083|f3544c085656c997|4fcff6864c594343|\n|90e5fa3f382c5b15a85484c17c15338a6c8dbc2b0ca4fb73c521892bd853f226|f3544c085656c997|13b51944653a5fff|\n\n\n-----\n\n**PINEFLOWER SUSPECTED TARGETING**\n\nAs discussed in the literature review section, UNC788 has long targeted members of the Iranian diaspora, dissidents, and\nother individuals of interest to the Iranian regime. This campaign is no exception. Our analysis confirmed that the actors\nexfiltrated recorded phone calls, room audio recordings, pictures, and entire SMS inboxes along with relevant metadata\nfrom devices which appeared to belong to individuals residing in Iran. At least one device belonged to an individual who\nappears to be engaged in social activism in Iran. This activity confirms long-standing suspicions that UNC788 conducts\ndomestically focused operations as part of their ostensible mandate to conduct cyber espionage and credential harvesting\noperations in support of Iranian strategic priorities.\n\n**CONCLUSION**\n\nThe use of Android malware to target individuals of interest to the Iranian government provides UNC788 with a productive\nmethod of obtaining sensitive information on their targets, including movement, contacts of interest, and personal\ninformation. The malware’s ability to record phone calls, activate the microphone and record the audio, exfiltrate images\nand take pictures on command, read SMS messages, and track the victim’s GPS location in real time poses a real-world risk\nto the individual victims of this campaign.\n\nWhile UNC788 carries out frequent credential-harvesting operations using pages spoofing login portals to services like\n_Gmail, Yahoo and Outlook Web Access, we have confirmed that a subset of its operations also targets mobile device users._\nThe group clearly has access to an expansive toolset, so we deem it likely that they have additional mobile malware tools at\ntheir disposal, and that the PINEFLOWER samples we observed are but a few of many.\n\n**REFERENCES**\n\n[1] Vanderlee, K. DebUNCing Attribution: How Mandiant Tracks Uncategorized Threat Actors. FireEye Stories. 2020.\n[https://www.fireeye.com/blog/products-and-services/2020/12/how-mandiant-tracks-uncategorized-threat-actors.](https://www.fireeye.com/blog/products-and-services/2020/12/how-mandiant-tracks-uncategorized-threat-actors.html)\nhtml.\n\n[2] ClearSky Security. Thamar Reservoir: An Iranian cyber-attack campaign against targets in the Middle East. 2015.\nhttps://www.clearskysec.com/wp-content/uploads/2015/06/Thamar-Reservoir-public1.pdf.\n\n[3] ClearSky Security. Charming Kitten: Iranian cyber espionage against human rights activists, academic researchers\n[and media outlets – and the HBO hacker connection. 2017. https://www.clearskysec.com/wp-content/](https://www.clearskysec.com/wp-content/uploads/2017/12/Charming_Kitten_2017.pdf)\nuploads/2017/12/Charming_Kitten_2017.pdf.\n\n[4] ClearSky Security. The Kittens Are Back in Town Charming Kitten Campaign Against Academic Researchers.\n[2019. https://www.clearskysec.com/wp-content/uploads/2019/09/The-Kittens-Are-Back-in-Town-Charming-](https://www.clearskysec.com/wp-content/uploads/2019/09/The-Kittens-Are-Back-in-Town-Charming-Kitten-Sep-2019.pdf)\nKitten-Sep-2019.pdf.\n\n[5] Microsoft. Recent Cyberattacks Require Us All to be Vigilant. 2019. https://blogs.microsoft.com/on-theissues/2019/10/04/recent-cyberattacks-require-us-all-to-be-vigilant/.\n\n[6] Microsoft. New steps to protect customers from hacking. 2019. https://blogs.microsoft.com/on-theissues/2019/03/27/new-steps-to-protect-customers-from-hacking/.\n\n[7] ClearSky Security. The Kittens Are Back in Town 2: Charming Kitten Campaign Keeps Going on, Using New\n[Impersonation Methods. 2019. https://www.clearskysec.com/wp-content/uploads/2019/10/The-Kittens-Are-Back-](https://www.clearskysec.com/wp-content/uploads/2019/10/The-Kittens-Are-Back-in-Town-2.pdf)\nin-Town-2.pdf.\n\n[8] Certfa Lab. Fake Interview: The New Activity of Charming Kitten. 2020. https://blog.certfa.com/posts/fakeinterview-the-new-activity-of-charming-kitten/.\n\n[9] Microsoft. Cyberattacks target international conference attendees. 2020. https://blogs.microsoft.com/on-theissues/2020/10/28/cyberattacks-phosphorus-t20-munich-security-conference/.\n\n[10] Dagres, H. How Iranian Hackers Tried to Phish Me. Washington Post. 2020. http://web.archive.org/\n[web/20201020165905if_/https://www.washingtonpost.com/opinions/2020/05/20/how-iranian-hackers-tried-phish-](http://web.archive.org/web/20201020165905if_/https://www.washingtonpost.com/opinions/2020/05/20/how-iranian-hackers-tried-phish-me/)\nme/.\n\n[11] Greenberg, A. Iranian Spies Accidentally Leaked Videos of Themselves Hacking. Wired. 2020. https://www.wired.\ncom/story/iran-apt35-hacking-video/.\n\n[12] Reuters. Hackers linked to Iran target WHO staff emails during coronavirus. 2020. https://www.reuters.com/article/\n[us-health-coronavirus-cyber-iran-exclusi/exclusive-hackers-linked-to-iran-target-who-staff-emails-during-](https://www.reuters.com/article/us-health-coronavirus-cyber-iran-exclusi/exclusive-hackers-linked-to-iran-target-who-staff-emails-during-coronavirus-sources-idUSKBN21K1RC)\ncoronavirus-sources-idUSKBN21K1RC.\n\n[13] Reuters. Iran-linked hackers recently targeted coronavirus drugmaker Gilead. 2020. https://www.reuters.com/\n[article/us-healthcare-coronavirus-gilead-iran-ex/exclusive-iran-linked-hackers-recently-targeted-coronavirus-](https://www.reuters.com/article/us-healthcare-coronavirus-gilead-iran-ex/exclusive-iran-linked-hackers-recently-targeted-coronavirus-drugmaker-gilead-sources-idUSKBN22K2EV)\ndrugmaker-gilead-sources-idUSKBN22K2EV.\n\n\n-----\n\n[14] Proofpoint. BadBlood: TA453 Targets US and Israeli Medical Research Personnel in Credential Phishing\n[Campaigns. 2021. https://www.proofpoint.com/us/blog/threat-insight/badblood-ta453-targets-us-and-israeli-](https://www.proofpoint.com/us/blog/threat-insight/badblood-ta453-targets-us-and-israeli-medical-research-personnel-credential)\nmedical-research-personnel-credential.\n\n[15] NPR. Iran Under Sanctions: A Scramble for Cancer Care and Blame to Go Around. 2019.\n[https://www.npr.org/2019/08/24/753446099/iran-under-sanctions-a-scramble-for-cancer-care-and-blame-to-go-](https://www.npr.org/2019/08/24/753446099/iran-under-sanctions-a-scramble-for-cancer-care-and-blame-to-go-around)\naround.\n\n[16] Adamatis, D.; Mercer, W.; Rascagneres, P.; Ventura, V.; Kuhla, E. Persian Stalker pillages Iranian users of\nInstagram and Telegram. Cisco Talos. 2018. https://blog.talosintelligence.com/2018/11/persian-stalker.html.\n\n[[17] Iran Cyber News. CORRUPT KITTEN EXPOSED. 2019. https://irancybernews.org/news/corrupt-kitten-exposed/.](https://irancybernews.org/news/corrupt-kitten-exposed/)\n\n[[18] https://github.com/MobSF/Mobile-Security-Framework-MobSF.](https://github.com/MobSF/Mobile-Security-Framework-MobSF)\n\n[[19] https://github.com/skylot/jadx.](https://github.com/skylot/jadx)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        }
    ],
    "references": [
        "https://vblocalhost.com/uploads/VB2021-Haeghebaert.pdf"
    ],
    "report_names": [
        "VB2021-Haeghebaert.pdf"
    ],
    "threat_actors": [
        {
            "id": "82b92285-4588-48c9-8578-bb39f903cf62",
            "created_at": "2022-10-25T15:50:23.850506Z",
            "updated_at": "2025-03-27T02:00:55.501372Z",
            "deleted_at": null,
            "main_name": "Charming Kitten",
            "aliases": [
                "Charming Kitten"
            ],
            "source_name": "MITRE:Charming Kitten",
            "tools": [
                "DownPaper"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d0e8337e-16a7-48f2-90cf-8fd09a7198d1",
            "created_at": "2023-03-04T02:01:54.091301Z",
            "updated_at": "2025-03-27T02:00:03.119447Z",
            "deleted_at": null,
            "main_name": "APT42",
            "aliases": [
                "UNC788",
                "CALANQUE"
            ],
            "source_name": "MISPGALAXY:APT42",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae26d287-8ba7-447e-9391-cf13c02d7481",
            "created_at": "2023-03-04T02:01:54.0962Z",
            "updated_at": "2025-03-27T02:00:03.120665Z",
            "deleted_at": null,
            "main_name": "TA453",
            "aliases": [],
            "source_name": "MISPGALAXY:TA453",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d8af157e-741b-4933-bb4a-b78490951d97",
            "created_at": "2023-01-06T13:46:38.748929Z",
            "updated_at": "2025-03-27T02:00:02.908256Z",
            "deleted_at": null,
            "main_name": "APT35",
            "aliases": [
                "Newscaster Team",
                "Magic Hound",
                "G0059",
                "Phosphorus",
                "Mint Sandstorm",
                "TunnelVision",
                "COBALT MIRAGE"
            ],
            "source_name": "MISPGALAXY:APT35",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "761d1fb2-60e3-46f0-9f1c-c8a9715967d4",
            "created_at": "2023-01-06T13:46:38.269054Z",
            "updated_at": "2025-03-27T02:00:02.789278Z",
            "deleted_at": null,
            "main_name": "APT3",
            "aliases": [
                "TG-0110",
                "Group 6",
                "Buckeye",
                "Boyusec",
                "BORON",
                "BRONZE MAYFAIR",
                "Red Sylvan",
                "GOTHIC PANDA"
            ],
            "source_name": "MISPGALAXY:APT3",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "47fa514e-15a8-4adb-a782-e2ffb12944d8",
            "created_at": "2024-04-24T02:00:49.644637Z",
            "updated_at": "2025-03-27T02:00:55.560836Z",
            "deleted_at": null,
            "main_name": "UNC788",
            "aliases": [
                "UNC788"
            ],
            "source_name": "MITRE:UNC788",
            "tools": [
                "HilalRAT"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "04888f75-158b-47f9-8ad9-4ff83f618ece",
            "created_at": "2024-05-01T02:03:08.03763Z",
            "updated_at": "2025-03-27T02:05:17.319276Z",
            "deleted_at": null,
            "main_name": "COBALT MIRAGE",
            "aliases": [
                "Nemesis Kitten ",
                "PHOSPHORUS ",
                "TunnelVision ",
                "UNC2448 ",
                "DEV-0270 "
            ],
            "source_name": "Secureworks:COBALT MIRAGE",
            "tools": [
                " Custom powershell scripts",
                " DiskCryptor",
                " Drokbk",
                " FRPC",
                " Fast Reverse Proxy (FRP)",
                " Impacket wmiexec",
                " Ngrok",
                " Plink",
                " PowerLessCLR",
                " TunnelFish",
                "BitLocker"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "029625d2-9734-44f9-9e10-b894b4f57f08",
            "created_at": "2023-01-06T13:46:38.364105Z",
            "updated_at": "2025-03-27T02:00:02.815023Z",
            "deleted_at": null,
            "main_name": "Charming Kitten",
            "aliases": [
                "Parastoo",
                "iKittens",
                "Group 83",
                "NewsBeef",
                "G0058",
                "CharmingCypress"
            ],
            "source_name": "MISPGALAXY:Charming Kitten",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b0261705-df2e-4156-9839-16314250f88a",
            "created_at": "2023-01-06T13:46:38.373617Z",
            "updated_at": "2025-03-27T02:00:02.817313Z",
            "deleted_at": null,
            "main_name": "Rocket Kitten",
            "aliases": [
                "Operation Woolen-Goldfish",
                "Thamar Reservoir",
                "Timberworm",
                "TEMP.Beanie",
                "Operation Woolen Goldfish"
            ],
            "source_name": "MISPGALAXY:Rocket Kitten",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "08a3b64c-8e18-455d-af57-28dca63808c4",
            "created_at": "2024-05-01T02:03:08.027871Z",
            "updated_at": "2025-03-27T02:05:17.313679Z",
            "deleted_at": null,
            "main_name": "COBALT ILLUSION",
            "aliases": [
                "APT42 ",
                "Charming Kitten ",
                "CharmingCypress ",
                "ITG18 ",
                "Magic Hound ",
                "Mint Sandstorm sub-group ",
                "NewsBeef ",
                "Newscaster ",
                "PHOSPHORUS sub-group ",
                "TA453 ",
                "UNC788 ",
                "Yellow Garuda ",
                "APT35 "
            ],
            "source_name": "Secureworks:COBALT ILLUSION",
            "tools": [
                " MagicHound Toolset",
                " PupyRAT",
                "Browser Exploitation Framework (BeEF)"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "e3676dfe-3d40-4b3a-bfbd-4fc1f8c896f4",
            "created_at": "2022-10-25T15:50:23.808974Z",
            "updated_at": "2025-03-27T02:00:55.550912Z",
            "deleted_at": null,
            "main_name": "Magic Hound",
            "aliases": [
                "Magic Hound",
                "TA453",
                "COBALT ILLUSION",
                "Charming Kitten",
                "ITG18",
                "Phosphorus",
                "APT35",
                "Mint Sandstorm"
            ],
            "source_name": "MITRE:Magic Hound",
            "tools": [
                "Impacket",
                "CharmPower",
                "FRP",
                "Mimikatz",
                "Systeminfo",
                "ipconfig",
                "netsh",
                "PowerLess",
                "Pupy",
                "DownPaper",
                "PsExec",
                "Havij",
                "sqlmap"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "06f622cb-3a78-49cf-9a4c-a6007a69325f",
            "created_at": "2022-10-25T16:07:23.315239Z",
            "updated_at": "2025-03-27T02:02:09.733197Z",
            "deleted_at": null,
            "main_name": "APT 3",
            "aliases": [
                "APT 3",
                "Bronze Mayfair",
                "Buckeye",
                "Gothic Panda",
                "Group 6",
                "Operation Clandestine Fox",
                "Operation Clandestine Fox, Part Deux",
                "Operation Clandestine Wolf",
                "Operation Double Tap",
                "Red Sylvan",
                "TG-0110",
                "UPS Team"
            ],
            "source_name": "ETDA:APT 3",
            "tools": [
                "APT3 Keylogger",
                "Agent.dhwf",
                "BKDR_HUPIGON",
                "Backdoor.APT.CookieCutter",
                "Badey",
                "Bemstour",
                "CookieCutter",
                "Destroy RAT",
                "DestroyRAT",
                "DoublePulsar",
                "EXL",
                "EternalBlue",
                "HTran",
                "HUC Packet Transmit Tool",
                "Hupigon",
                "Hupigon RAT",
                "Kaba",
                "Korplug",
                "LaZagne",
                "MFC Huner",
                "OSInfo",
                "Pirpi",
                "PlugX",
                "RedDelta",
                "RemoteCMD",
                "SHOTPUT",
                "Sogu",
                "TIGERPLUG",
                "TTCalc",
                "TVT",
                "Thoper",
                "Xamtrav",
                "remotecmd",
                "shareip",
                "w32times"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "1699fb41-b83f-42ff-a6ec-984ae4a1031f",
            "created_at": "2022-10-25T16:07:23.83826Z",
            "updated_at": "2025-03-27T02:02:09.995863Z",
            "deleted_at": null,
            "main_name": "Magic Hound",
            "aliases": [
                "APT 35",
                "Ballistic Bobcat",
                "Charming Kitten",
                "CharmingCypress",
                "Cobalt Illusion",
                "Cobalt Mirage",
                "Educated Manticore",
                "Magic Hound",
                "Mint Sandstorm",
                "Operation BadBlood",
                "Operation Sponsoring Access",
                "Operation SpoofedScholars",
                "Operation Thamar Reservoir",
                "Phosphorus",
                "TA453",
                "TEMP.Beanie",
                "Tarh Andishan",
                "Timberworm",
                "TunnelVision",
                "UNC788",
                "Yellow Garuda"
            ],
            "source_name": "ETDA:Magic Hound",
            "tools": [
                "7-Zip",
                "AnvilEcho",
                "BASICSTAR",
                "CORRUPT KITTEN",
                "CWoolger",
                "CharmPower",
                "ChromeHistoryView",
                "CommandCam",
                "DistTrack",
                "DownPaper",
                "FRP",
                "Fast Reverse Proxy",
                "FireMalv",
                "Ghambar",
                "GoProxy",
                "GorjolEcho",
                "HYPERSCRAPE",
                "Havij",
                "MPK",
                "MPKBot",
                "Matryoshka",
                "Matryoshka RAT",
                "MediaPl",
                "Mimikatz",
                "MischiefTut",
                "NETWoolger",
                "NOKNOK",
                "PINEFLOWER",
                "POWERSTAR",
                "PowerLess Backdoor",
                "PsList",
                "Pupy",
                "PupyRAT",
                "SNAILPROXY",
                "Shamoon",
                "TDTESS",
                "WinRAR",
                "WoolenLogger",
                "Woolger",
                "pupy",
                "sqlmap"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041771,
    "ts_creation_date": 1626362603,
    "ts_modification_date": 1626363193,
    "files": {
        "pdf": "https://archive.orkl.eu/e44fd15d300201fd936f9556f40de578c8049f41.pdf",
        "text": "https://archive.orkl.eu/e44fd15d300201fd936f9556f40de578c8049f41.txt",
        "img": "https://archive.orkl.eu/e44fd15d300201fd936f9556f40de578c8049f41.jpg"
    }
}