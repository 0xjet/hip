{
    "id": "7be078d0-b41b-44f5-895d-5e5a9e6307c8",
    "created_at": "2022-10-25T16:48:12.455683Z",
    "updated_at": "2025-03-27T02:05:50.329774Z",
    "deleted_at": null,
    "sha1_hash": "62df4dd012589910b6be8df92f23e231c493772a",
    "title": "T9000: Advanced Modular Backdoor Uses Complex Anti Analysis Techniques",
    "authors": "Palo Alto",
    "file_creation_date": "2016-02-18T20:44:01Z",
    "file_modification_date": "2016-02-18T20:44:01Z",
    "file_size": 1143815,
    "plain_text": "# T9000: Advanced Modular Backdoor Uses Complex Anti­Analysis Techniques ­ Palo Alto Networks Blog\n\nMost custom backdoors used by advanced attackers have limited functionality. They evade detection\n\nby keeping their code simple and flying under the radar. But during a recent investigation we found a\n\nbackdoor that takes a very different approach. We refer to this backdoor as T9000, which is a newer\n\nvariant of the T5000 malware family, also known as Plat1.\n\nIn addition to the basic functionality all backdoors provide, T9000 allows the attacker to capture\n\nencrypted data, take screenshots of specific applications and specifically target Skype users. The\n\nmalware goes to great lengths to identify a total of 24 potential security products that may be running\n\non a system and customizes its installation mechanism to specifically evade those that are installed. It\n\nuses a multi­stage installation process with specific checks at each point to identify if it is undergoing\n\nanalysis by a security researcher.\n\nThe primary functionality of this tool is to gather information about the victim. In fact, the author chose\n\nto store critical files dropped by the Trojan in a directory named “Intel.” T9000 is pre­configured to\n\nautomatically capture data about the infected system and steal files of specific types stored on\n\nremovable media.\n\nWe have observed T9000 used in multiple targeted attacks against organizations based in the United\n\nStates. However, the malware’s functionality indicates that the tool is intended for use against a broad\n\nrange of users. In this report, we share an analysis of each stage in T9000’s execution flow. Stay\n\ntuned for a future report in which we will provide more detail on how this tool has been used and the\n\ninfrastructure we have identified as part of our analysis.\n\n## T9000 Backdoor Analysis\n\nThe entire execution flow of the malware is represented in the following diagram:\n\nAs this malware uses a multistage execution flow we’ll discuss each stage individually\n\n\n-----\n\nThe sample of T9000 used in this analysis was originally dropped via a RTF file that contained\n\n[exploits for both CVE­2012­1856 and CVE­2015­1641. When triggered, an initial shellcode stage is](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1856)\n\nrun, which is responsible for locating and executing a secondary shellcode stub. The second stage\n\nshellcode reads the initial RTF document and seeks to the end of the file, using the last four bytes as\n\nthe size of the embedded payload.\n\nWith the payload size confirmed, the shellcode will create a file in the %TEMP% folder using a\n\ntemporary filename. The shellcode will decrypt and subsequently load the embedded payload in the\n\nRTF file. The decrypted payload is written to the temporary file and executed using WinExec. The\n\nshellcode then attempts to decrypt an embedded decoy document with the same algorithm used to\n\ndecrypt the payload, which it will save to %TEMP%\\~tmp.doc path. This file is opened using the\n\nfollowing command:\n\n_cmd /C %TEMP%\\~tmp.doc_\n\nHowever, this particular sample did not contain a decoy document.\n\n**Stage 1**\n\nWhen this temporary file is initially executed, it will begin by creating the following mutex to ensure\n\nonly one instance of the malware is running at a given time:\n\n_820C90CxxA1B084495866C6D95B2595xx1C3_\n\nIt continues to perform a number of checks for installed security products on the victim machine. The\n\nfollowing security platforms are queried by checking entries within the HKLM\\Software\\ registry path:\n\nSophos\n\nINCAInternet\n\nDoctorWeb\n\nBaidu\n\nComodo\n\nTrustPortAntivirus\n\nGData\n\nAVG\n\nBitDefender\n\nVirusChaser\n\nMcAfee\n\nPanda\n\nTrend Micro\n\nKingsoft\n\nNorton\n\nMicropoint\n\nFilseclab\n\n\n-----\n\nTencent\n\nAvira\n\nKaspersky\n\nRising\n\n360\n\nThese security products are represented by a value that is binary AND­ed with any other products\n\nfound. The following numbers represent each respective security product.\n\n_0x08000000 : Sophos_\n\n_0x02000000 : INCAInternet_\n\n_0x04000000 : DoctorWeb_\n\n_0x00200000 : Baidu_\n\n_0x00100000 : Comodo_\n\n_0x00080000 : TrustPortAntivirus_\n\n_0x00040000 : GData_\n\n_0x00020000 : AVG_\n\n_0x00010000 : BitDefender_\n\n_0x00008000 : VirusChaser_\n\n_0x00002000 : McAfee_\n\n_0x00001000 : Panda_\n\n_0x00000800 : Trend Micro_\n\n_0x00000400 : Kingsoft_\n\n_0x00000200 : Norton_\n\n_0x00000100 : Micropoint_\n\n_0x00000080 : Filseclab_\n\n_0x00000040 : AhnLab_\n\n_0x00000020 : JiangMin_\n\n_0x00000010 : Tencent_\n\n_0x00000004 : Avira_\n\n_0x00000008 : Kaspersky_\n\n_0x00000002 : Rising_\n\n_0x00000001 : 360_\n\nSo, for example, if both Trend Micro and Sophos were discovered on a victim machine, the resulting\n\nvalue would be 0x08000800. This numerical value is written to the following file:\n\n_%APPDATA%\\Intel\\avinfo_\n\nThe malware proceeds to drop the following files to the %APPDATA%\\Intel directory:\n\n\n-----\n\nAdditionally, the following two files are written to the Data directory:\n\nThe following table provides a description of each file dropped:\n\n**File Name** **Description**\n\n~1 Debug information about files used by malware.\n\navinfo Installed security products on victim.\n\nhccutils.dll Malicious DLL. Loads ResN32.dll.\n\nhccutils.inf Malicious INF file. Points to hccutils.dll.\n\nhjwe.dat Encrypted core of malware family.\n\n\n-----\n\nEncrypted plugin. Hooks a number of functions and logs\nqhnj.dat\n\nresults.\n\nQQMgr.dll Malicious DLL. Sets persistence via Run registry key.\n\nQQMgr.inf Malicious INF file. Points to QQMgr.dll\n\nResN32.dat String pointing to path of encrypted core of malware.\n\nMalicious DLL. Decrypts, decompresses, and loads\nResN32.dll\n\ncore malware.\n\n\nEncrypted plugin. Takes screenshots and collects Skype\ntyeu.dat\n\ninformation.\n\nEncrypted plugin. Finds files on removable drives on\nvnkd.dat\n\nvictim machine.\n\ndtl.dat Encrypted configuration information.\n\nglp.uin Plugin configuration information.\n\nYou’ll notice that QQMgr* files are not listed in the original malware execution flow diagram. In the\n\nevent the victim is running any of the following operating system versions, as well as either Kingsoft,\n\nFilseclab, or Tencent security products, the malware will be installed using an alternative method.\n\nWindows 2008 R2\n\nWindows 7\n\nWindows 2012\n\nWindows 8\n\nIn such a situation, the malware will find and run the built­in Microsoft Windows InfDefaultInstall.exe\n\nprogram, which will install a DLL via an INF file. Should Tencent be installed, the malware will execute\n\nthe InfDefaultInstall.exe program with an argument of ‘QQMgr.inf’. Otherwise, it will use ‘hccutils.inf’\n\nas an argument.\n\nQQMgr.inf will install the QQMgr.dll, while hccutils.inf will install the hccutils.dll library. QQMgr.dll will\n\nset the following registry key:\n\n_HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Eupdate – %APPDATA%\\Intel\\ResN32.dll_\n\nThe QQMgr.dll file has the following debug string found within it:\n\n_H:\\WORK\\PROJECT\\InfInstallBypassUAC\\Release\\BypassUAC.pdbThe hccutils.dll file is described_\n\nlater within this post.\n\nAfter the malware drops the required files by default the malware will spawn\n\n\n-----\n\nexecution.\n\n**Stage 2**\n\n[The igfxtray.exe is a legitimate Microsoft Windows executable that sideloads the malicious hccutils.dll](https://attack.mitre.org/wiki/DLL_side-loading)\n\nDLL file. This DLL has the following debug string embedded within it:\n\n_D:\\WORK\\T9000\\hccutils_M4\\Release\\hccutils.pdb_\n\nUpon loading this malicious DLL, the malware will initially perform the same queries for security\n\nproducts that were witnessed in stage 1.\n\nThree separate techniques for starting stage 3 are used depending on the properties of the victim.\n\nThe first technique is used if the victim meets the following criteria:\n\nMicrosoft Windows 8 / Windows Server 2012 R2\n\nDoctorWeb security product installed\n\nFor this situation, the following registry key is set:\n\n_HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\update – %SYSTEM%\\rundll32.exe_\n\n_%APPDATA\\Intel\\ResN32.dll Run_\n\nThis ensures that the ResN32.dll library will be run using the ‘Run’ exported function whenever the\n\nmachine is rebooted.\n\nThe second technique is used if the victim meets any of the following sets of criteria:\n\nMicrosoft Windows 8 / Windows Server 2012 R2\n\nNot running Kingsoft, Tencent, or DoctorWeb security products\n\nMicrosoft Windows XP or lower\n\nNo security products installed, or running any of the following:\n\nSophos\n\nGData\n\nTrendMicro\n\nAhnLab\n\nKaspersky\n\nIn these situations, the following persistence technique is used.\n\n_HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs –_\n\n_%APPDATA%\\Intel\\ResN32.dllHKLM\\Software\\Microsoft\\Windows_\n\n_NT\\CurrentVersion\\Windows\\LoadAppInit_DLLs – 0x1_\n\nSetting these registry keys both enables the AppInit_DLL functionality, and ensures that every user\n\nmode process that is spawned will load the ResN32.dll library. More information about this can be\n\n\n-----\n\nThe third technique is used in any other situation. When this occurs, the malware will first identify the\n\nexplorer.exe process identifier. It proceeds to inject the ResN32.dll library into this process.\n\nAt this point, the third stage of the malware family is loaded.\n\n**Stage 3**\n\nThe third stage begins when the ResN32.dll file begins operating. This file contains the following\n\ndebug string:\n\n_D:\\WORK\\T9000\\ResN_M2\\Release\\ResN32.pdb_\n\nThe ResN32.dll library begins by spawning a new thread that is responsible for the majority of the\n\ncapabilities built into this sample. This thread begins by checking the operating system version, and\n\nonce again runs a query on the various security products installed on the victim machine.\n\nUnder certain conditions, the following registry key is set, ensuring persistence across reboots:\n\n_HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\update – c:\\windows\\system32\\rundll32.exe_\n\n_%APPDATA\\Intel\\ResN32.dll Run_\n\nFollowing this, a new thread is created that is responsible for deleting previously written files. This\n\nthread creates the following mutex:\n\n_Global\\\\deletethread_\n\nIt proceeds to attempt to delete the following files in an infinite loop until said files have been deleted:\n\n%STARTUP%\\hccutils.dll\n\n%STARTUP%\\hccutil.dll\n\n%STARTUP%\\igfxtray.exe\n\nThe ResN32.dll malware proceeds to read in the ResN32.dat file that was previously written to disk.\n\nThis file contains a path to the hjwe.dat file, which is subsequently read in.\n\nThe data within the hjwe.dat file is decrypted using the RC4 algorithm, and subsequently\n\ndecompressed using the LZMA algorithm. The following script can be used to decrypt the hjwe.dat\n\nfile, along with the plugins that will be discussed later.\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n\n-----\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n\n30\n\n31\n\n32\n\n33\n\n34\n\n35\n\n36\n\n37\n\n38\n\nimport sys, pylzma\n\nfrom base64 import *\n\nfrom binascii import *\n\nfrom struct import *\n\ndef rc4( data, key ):\n\nS = range(256)\n\nj = 0\n\nout = []\n\nfor i in range(256):\n\nj = (j + S[i] + ord( key[i % len(key)] )) % 256\n\nS[i], S[j] = S[j], S[i]\n\ni = j = 0\n\n\n-----\n\ni = ( i + 1 ) % 256\n\nj = ( j + S[i] ) % 256\n\nS[i], S[j] = S[j], S[i]\n\nout.append(chr(ord(char) ^ S[(S[i] + S[j]) % 256]))\n\nreturn ''.join(out)\n\nf = open(sys.argv[1], 'rb')\n\nfd = f.read()\n\nf.close()\n\nbytes_0_4, bytes_4_8, bytes_8_12, bytes_12_16 = unpack(\"<IIII\", fd[0:16])\n\nif bytes_0_4 == 0xf7e4aa65:\n\nlength = bytes_8_12\n\nif len(fd)­16 != length:\n\nprint \"[*] Possible error reading in length of data.\"\n\nkey_size = 260\n\nkey = fd[16:16+key_size]\n\ndata = fd[16+key_size:]\n\ndecrypted = rc4(data, key)\n\ndecompressed = pylzma.decompress_compat(decrypted)\n\nf1 = open(sys.argv[1]+\".decompressed\", 'wb')\n\nf1.write(decompressed)\n\nf1.close\n\nprint \"[+] Wrote %s\" % (sys.argv[1]+\".decompressed\")\n\nAfter this file has been decrypted and decompressed, it is written to a file in the %TEMP% directory\n\nwith a file prefix of ‘____RES’. This file, which contains a Windows DLL, is then loaded into the\n\ncurrent process. After the malicious library has been loaded, the previously written temporary file is\n\ndeleted. This begins the last stage of the malware, which will load the core of the malware family.\n\n**Stage 4**\n\nOnce the decrypted and decompressed hjwe.dat file is loaded, it begins by checking its parent\n\nprocess against the following list. If the parent process matches the following blacklist, the malicious\n\nDLL will exit without performing any malicious activities.\n\nwinlogon.exe\n\ncsrss.exe\n\nlogonui.exe\n\nctfmon.exe\n\ndrwtsn32.exe\n\nlogonui.exe\n\nexplore.exe\n\nSystem\n\nDbgview.exe\n\n\n-----\n\nlsass.exe\n\nwmiprvse.exe\n\nservices.exe\n\ninetinfo.exe\n\navp.exe\n\nRtvscan.exe\n\nThe malware proceeds to collect the username of the victim, as well as the operating system version.\n\nIt then compares its parent process against the following list of executables:\n\nwinlogon.exe\n\ncsrss.exe\n\nlogonui.exe\n\nctfmon.exe\n\ndrwtsn32.exe\n\nlogonui.exe\n\nSystem\n\nDwm.exe\n\nQQPCRTP.exe\n\nTasking.exe\n\nTaskhost.exe\n\nTaskmgr.exe\n\nDbgview.exe\n\nsuerinit.exe\n\nlsass.exe\n\nwmiprvse.exe\n\nservices.exe\n\ninetinfo.exe\n\navp.exe\n\nRtvscan.exe\n\nNotice the repeated check for the ‘logonui.exe’, as well as the overlap with the previous parent\n\nexecutable check, which implies sloppiness by the malware author.\n\nAfter these checks are performed, the following mutex is created.\n\n_Global\\\\{A59CF429­D0DD­4207­88A1­04090680F714}_\n\nThe following folders are then created:\n\nutd_CE31\n\nXOLOADER\n\nUpdate\n\n\n-----\n\npossibilities exist:\n\n%ALLUSERSPROFILE%\\Documents\\My Document\\\n\n%PUBLIC%\\Downloads\\Update\\\n\nAt this point, the malware will read in the dtl.dat file, which contains configuration data. Data\n\ncontained with this file starting at offset 0x20 is xor­encrypted using a single­byte key of 0x5F. The\n\nfollowing script can be used to extract the IP address and port for the C2 server from this file.\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\nfrom struct import *\n\nimport sys, socket\n\ndef int2ip(addr):\n\nreturn socket.inet_ntoa(pack(\"!I\", addr))\n\nconfig_file = sys.argv[1]\n\nf = open(config_file, 'rb')\n\nfd = f.read()\n\nf.close()\n\ndecrypted = \"\"\n\nfor x in fd[32:]:\n\ndecrypted += chr(ord(x) ^ 0x5f)\n\nport = unpack(\"<I\", decrypted[4:8])[0]\n\nip int2ip(unpack(\">I\" decrypted[8:12])[0])\n\n\n-----\n\nprint \"Port    : %d\" % port\n\nThe malware will then read in and parse the included plugin configuration information, which is found\n\nwithin the glp.uin file that was previously dropped. These included plugins are encrypted and\n\ncompressed using the same method witnessed by the hjwe.dat file previously. The previously\n\nincluded script can be used to decrypt and decompress the following three plugin files:\n\ntyeu.dat\n\nvnkd.dat\n\nqhnj.dat\n\nThese three plugins are subsequently loaded after being decrypted and decompressed. An overview\n\nof these plugins can be found later in this post.\n\nThe malware proceeds to create the following event:\n\n_Global\\\\{34748A26­4EAD­4331­B039­673612E8A5FC}_\n\nAdditionally, the following three mutexes are created:\n\n_Global\\\\{3C6FB3CA­69B1­454f­8B2F­BD157762810E}_\n\n_Global\\\\{43EE34A9­9063­4d2c­AACD­F5C62B849089}_\n\n_Global\\\\{A8859547­C62D­4e8b­A82D­BE1479C684C9}_\n\nThe malware will spawn a new thread to handle network communication. The following event is\n\ncreated prior to this communication occurring:\n\n_Global\\\\{EED5CA6C­9958­4611­B7A7­1238F2E1B17E}_\n\nThe malware includes proxy support in the event that the victim is behind a web proxy. Network traffic\n\noccurs over a binary protocol on the port specified within the configuration. Traffic is xor­encrypted\n\nwith a single­byte key of 0x55 in an attempt to bypass any network security products that may be in\n\nplace. Once decrypted, the following traffic is sent by the malware.\n\n\n-----\n\nAs we can see from the above image, the malware will send out an initial beacon, followed by various\n\ncollected information from the victim machine. The following information is exfiltrated:\n\nInstalled security products\n\nSystem time\n\nBuild Number\n\nCPU Architecture (32­bit/64­bit)\n\nMAC Address\n\nIP Address\n\nHostname\n\nUsername\n\nParent executable name\n\nPlugin configuration information\n\nThe malware is configured to receive a number of commands. The following command functionalities\n\nhave been identified.\n\n**Command** **Description**\n\nDIR Directory listing\n\nLIR Drive listing\n\nRUN Execute command (Either interactively or not)\n\nCIT Send command to interactively spawned command\n\nCFI Kill interactively spawned process\n\nDOW Download file\n\nUPL Upload file\n\nDEL Delete file\n\nDTK Retrieve statistics for file\n\nERR Null command\n\nAdditionally, the following commands have been identified, however, their functionalities have yet to\n\nbe fully discovered.\n\nPNG\n\nPLI\n\nPLD\n\n\n-----\n\nOSC\n\nOSF\n\nSDA\n\nQDA\n\nTFD\n\nSDS\n\nSCP\n\nFMT\n\nSTK\n\nCRP\n\n**Plugin #1 – tyeu.dat**\n\nWhen this plugin is called with the default exported function, it will create the following mutex:\n\n_{CE2100CF­3418­4f9a­9D5D­CC7B58C5AC62}_\n\nWhen called with the SetCallbackInterface function export, the malicious capabilities of the plugin\n\nbegin. The plugin begins by collecting the username of the running process, and determining if it is\n\nrunning under the SYSTEM account. If running as SYSTEM, the plugin will associate the active\n\ndesktop with the plugin’s thread.\n\nThe plugin proceeds to create the following named event:\n\n_Global\\\\{EED5CA6C­9958­4611­B7A7­1238F2E1B17E}_\n\nMultiple threads are then spawned to handle various actions. The first thread is responsible for taking\n\na screenshot of the desktop of the victim machine. This screenshot data is both compressed and\n\nencrypted using a single­byte xor key of 0x5F. This data is written to one of the following files:\n\n_%PUBLIC%\\Downloads\\Update\\S[random].dat_\n\n_%ALLUSERSPROFILE%\\Documents\\My Document\\S[random].dat_\n\nThe random data is generated via the current system time. Additionally, when a screenshot is written,\n\none of the following log files has data appended to it:\n\n_%PUBLIC%\\Downloads\\Update\\Log.txt_\n\n_%ALLUSERSPROFILE%\\Documents\\My Document\\Log.txt_\n\n\n-----\n\nA second thread is responsible for monitoring the foreground window every 20 seconds. The thread\n\nwill target the window names set within the plugin configuration. In this particular instance, the\n\nmalware will target the ‘notepad’ process.\n\nWhen this process is discovered to be running in the foreground window, the malware will take a\n\nscreenshot of this window. The data is compressed and encrypted using a single­byte xor key of\n\n0x5F. This data is written to one of the following files:\n\n_%PUBLIC%\\Downloads\\Update\\W[random].dat_\n\n_%ALLUSERSPROFILE%\\Documents\\My Document\\W[random].dat_\n\nLike the previous thread, this one attempts to write another log file to the disk. However, due to a bug\n\nwithin the code of this plugin, the malware author attempts to append the\n\n‘C:\\\\Windows\\\\Temp\\\\Log.txt’ string to the path, resulting in an inaccessible file path. In the event this\n\nbug did not exist, the following example data would be written:\n\n_08:37:49 2000 [4] PrintKeyTitleWnd: ===>> Process ID : 2000_\n\nThe third and final thread spawned by this plugin is responsible for collecting information from the\n\nSkype program. The malware will use the built­in Skype API to accomplish this. This only takes places\n\nif both Skype is running and the victim is logged into Skype. It makes calls to the following functions:\n\nSkypeControlAPIDiscover\n\nSkypeControlAPIAttach\n\nWhen hooking into the Skype API, the victim is presented with the following dialog:\n\nFigure 3: Skype API access request\n\nThe victim must explicitly allow the malware to access Skype for this particular functionality to work.\n\nHowever, since a legitimate process is requesting access, the user may find him­ or herself allowing\n\nthis access without realizing what is actually happening.\n\nOnce enabled, the malware will record video calls, audio calls, and chat messages. Audio and video\n\nfiles are stored in the following folder:\n\n_%APPDATA%\\Intel\\Skype_\n\nTemporary audio and video files are stored within the audio and video sub­folders respectively. After\n\na call is finished, this data is compressed and encrypted using the same techniques previously\n\nwitnessed. These files are stored in randomly named .dat files within the Skype folder.\n\n\n-----\n\nWhen decrypted, we can see that the malware periodically takes images of the video calls. Audio\n\ncalls are stored as .wav files.\n\nFigure 4: A lonely malware reverser is captured on video by the malicious plugin\n\nThe original name for this plugin is ‘CaptureDLL.dll’. This is aptly named, as we see that this plugin\n\nhas the following functionality:\n\nCapture full desktop screenshots\n\nCapture window screenshots of targeted processes\n\nCapture Skype audio, video, and chat messages\n\n**Plugin #2 – vnkd.dat**\n\nThe vnkd.dat plugin has the following debug path, leading us to believe that the original name for this\n\nplugin is ‘FlashDiskThief’:\n\n_e:\\WORK\\Project\\T9000\\Windows\\Target\\FlashDiskThief.pdb_\n\nWhen loaded with the default DllEntryPoint exported function, it will create the following mutex:\n\n\n-----\n\nLike the other plugins associated with this malware, the majority of the functionality for this malware\n\nresides within the SetCallbackInterface exported function. This function spawns a new thread that\n\nbegins by registering a new window with a class name and window name of ‘xx’.\n\nThe plugin proceeds to iterate through all connected drives on the system, looking for removable\n\ndrives.\n\nFigure 5. Plugin check for removable drives\n\nShould a removable drive be discovered, the plugin will seek any files residing on this device based\n\non the plugin’s configured list. In this particular instance, the malware will seek out the following file\n\ntypes:\n\n*.doc\n\n*.ppt\n\n*.xls\n\n*.docx\n\n*.pptx\n\n*.xlsx\n\nIf one of these file types is found, the malware will create a copy of the file in one of the following\n\npaths:\n\n_%PUBLIC%\\Downloads\\Update\\D[random].tmp_\n\n_%ALLUSERSPROFILE%\\Documents\\My Document\\D[random].tmp_\n\nThe data found within this file is encrypted using a single­byte xor key of 0x41. The file header\n\nstructure, with the underlying data still encrypted, can be seen below.\n\n\n-----\n\nFigure 7: File structure post decryption\n\nThis concludes the functionality of the vnkd.dat plugin, or FlaskDiskThief as it’s known by the\n\nmalware’s author. While specific in nature, this plugin allows attackers to collect files being passed\n\naround from one machine to another via removable drives.\n\n**Plugin #3 – qhnj.dat**\n\nThis particular plugin appears to have an original filename of ‘kplugin.dll’ due to debugging\n\ninformation found within the file. The qhnj.dat plugin is responsible for hooking a number of common\n\nMicrosoft Windows API calls, and logging the results.\n\nThe following functions are hooked by this plugin:\n\nImmGetCompositionStringA\n\nImmGetCompositionStringW\n\nCreateFileW\n\nDeleteFileW\n\nCopyFileExW\n\nMoveFileWithProgressW\n\nCreateDirectoryW\n\nCreateDirectoryExW\n\nRemoveDirectoryW\n\nGetClipboardData\n\nCryptEncrypt\n\nCryptDecrypt\n\nThe plugin is most likely hooking the ImmGetCompositionString* functions in order to collect\n\ninformation about Unicode characters on the victim machine, such as Chinese, Japanese, and\n\nKorean.\n\nHooking the various file and directory operations allows the malware to log what file changes are\n\noccurring on the system. When a file is created, copied, moved, or deleted on the system, the\n\nmalware will check the directory of said file against the following blacklist:\n\n\n-----\n\n:\\\\program files\\\\\n\n\\\\AppData\\\\\n\n\\\\temporary internet files\\\\\n\n\\\\application data\\\\\n\n\\\\Local Settings\\\\\n\n\\\\cookies\\\\\n\n\\\\temp\\\\\n\n\\\\history\\\\\n\nAdditionally, the filename is compared against the ‘.tmp’ extension to ensure a temporary file is\n\nignored.\n\nShould the file meet the required criteria, this data is logged. Additionally, all folder modifications and\n\nclipboard data are logged as well.\n\nThe Crypt* functions allow the malware to collect sensitive encrypted data sent to and from the victim\n\nmachine. This is especially useful when viewing network traffic, allowing the attackers to potentially\n\ngain access to remote systems used by the victim.\n\nAll of the data logged by the qhnj.dat plugin file is stored in one of the following file paths. Data is\n\nencrypted using a single­byte XOR key of 0x79.\n\n_%PUBLIC%\\Downloads\\Update\\uai[random].tmp_\n\n_%ALLUSERSPROFILE%\\Documents\\My Document\\uai[random].tmp_\n\nThis last plugin allows the attackers to record important actions taken by the victim, which in turn may\n\nallow them to gain additional access as well as insight into the victim’s actions.\n\n## Conclusion\n\nT9000 appears to be the latest version of this Trojan, which has been partially exposed in previous\n\n[reports. In 2013, Cylance published a report on a group they named “Grand Theft Auto Panda”,](http://blog.cylance.com/grand-theft-auto-panda)\n\n[which includes some details on the T5000 version of this Trojan. FireEye researchers also noted that](https://www.fireeye.com/blog/threat-research/2014/03/spear-phishing-the-news-cycle-apt-actors-leverage-interest-in-the-disappearance-of-malaysian-flight-mh-370.html)\n\nthe malware was used in an attack in 2014 using a lure related to the disappearance of Malaysian\n\nflight MH370.\n\nThe author of this backdoor has gone to great lengths to avoid being detected and to evade the\n\nscrutiny of the malware analysis community. We hope that sharing the details of how this tool works\n\nas well as the indicators in the section below will help others defend themselves against attacks using\n\nthis tool.\n\nIn a future report, we will detail the infrastructure used by the variants of the malware we have\n\nidentified and discuss the methods attackers use to infect systems with it.\n\n\n-----\n\nsecurity platform, including the following.\n\n**Threat Prevention signatures for the software vulnerabilities listed in this report are available to**\n\ndetect the exploit files during delivery.\n\n**Traps is capable of preventing exploitation of the vulnerabilities exploited to install T9000.**\n\n**WildFire classifies all of the malware described in this report as malicious.**\n\n**Anti­malware signatures for the files listed in this report.**\n\n**[AutoFocus users can identify the malware discussed in this report with the T5000 tag](https://autofocus.paloaltonetworks.com/#/tag/Unit42.T5000)**\n\n## Indicators of Compromise\n\n**Hashes**\n\nRTF File, d5fa43be20aa94baf1737289c5034e2235f1393890fb6f4e8d4104565be52d8c\n\nQQMGr.dll, bf1b00b7430899d33795ef3405142e880ef8dcbda8aab0b19d80875a14ed852f\n\nQQMGR.inf, ace7e3535f2f1fe32e693920a9f411eea21682c87a8e6661d3b67330cd221a2a\n\nResN32.dat, aa28db689f73d77babd1c763c53b3e63950f6a15b7c1a974c7481a216dda9afd\n\nResN32.dll, 1cea4e49bd785378d8beb863bb8eb662042dffd18c85b8c14c74a0367071d9a7\n\nhqwe.dat, bb73261072d2ef220b8f87c6bb7488ad2da736790898d61f33a5fb7747abf48b\n\nhqwe.dat.decrypted, 7daf3c3dbecb60bee3d5eb3320b20f2648cf26bd9203564ce162c97dcb132569\n\nhccutils.dll, 3dfc94605daf51ebd7bbccbb3a9049999f8d555db0999a6a7e6265a7e458cab9\n\nhccutils.inf, f05cd0353817bf6c2cab396181464c31c352d6dea07e2d688def261dd6542b27\n\nigfxtray.exe, 21a5818822a0b2d52a068d1e3339ed4c767f4d83b081bf17b837e9b6e112ee61\n\nqhnj.dat, c61dbc7b51caab1d0353cbba9a8f51f65ef167459277c1c16f15eb6c7025cfe3\n\nqhnj.dat.decrypted, 2b973adbb2addf62cf36cef9975cb0193a7ff0b960e2cff2c80560126bee6f37\n\ntyeu.dat, e52b5ed63719a2798314a9c49c42c0ed4eb22a1ac4a2ad30e8bfc899edcea926\n\ntyeu.dat.decrypted, 5fc3dc25276b01d6cb2fb821b83aa596f1d64ae8430c5576b953e3220a01d9aa\n\nvnkd.dat, c22b40db7f9f8ebdbde4e5fc3a44e15449f75c40830c88932f9abd541cc78465\n\nvnkd.dat.decrypted, 157e0a9323eaaa911b3847d64ca0d08be8cd26b2573687be461627e410cb1b3f\n\ndtl.dat, 00add5c817f89b9ec490885be39398f878fa64a5c3564eaca679226cf73d929e\n\nglp.uin, 3fa05f2f73a0c44a5f51f28319c4dc5b8198fb25e1cfcbea5327c9f1b3a871d4\n\n**Mutexes**\n\n820C90CxxA1B084495866C6D95B2595xx1C3\n\nGlobal\\\\deletethread\n\nGlobal\\\\{A59CF429­D0DD­4207­88A1­04090680F714}\n\nGlobal\\\\{3C6FB3CA­69B1­454f­8B2F­BD157762810E}\n\nGlobal\\\\{43EE34A9­9063­4d2c­AACD­F5C62B849089}\n\nGlobal\\\\{A8859547­C62D­4e8b­A82D­BE1479C684C9}\n\n{CE2100CF­3418­4f9a­9D5D­CC7B58C5AC62}\n\nGlobal\\\\{6BB1120C­16E9­4c91­96D5­04B42D1611B4}\n\n**Named Events**\n\n\n-----\n\n**File Modifications**\n\n%TEMP%\\~tmp.doc\n\n%APPDATA%\\Intel\\avinfo\n\n%APPDATA%\\Intel\\Data\\dtl.dat\n\n%APPDATA%\\Intel\\Data\\glp.uin\n\n%APPDATA%\\Intel\\Data\\\n\n%APPDATA%\\Intel\\~1\n\n%APPDATA%\\Intel\\hccutils.dll\n\n%APPDATA%\\Intel\\hccutils.inf\n\n%APPDATA%\\Intel\\hjwe.dat\n\n%APPDATA%\\Intel\\igfxtray.exe\n\n%APPDATA%\\Intel\\qhnj.dat\n\n%APPDATA%\\Intel\\QQMgr.dll\n\n%APPDATA%\\Intel\\QQMgr.inf\n\n%APPDATA%\\Intel\\ResN32.dll\n\n%APPDATA%\\Intel\\ResN32.dat\n\n%APPDATA%\\Intel\\tyeu.dat\n\n%APPDATA%\\Intel\\vnkd.dat\n\n%STARTUP%\\hccutils.dll\n\n%STARTUP%\\hccutil.dll\n\n%STARTUP%\\igfxtray.exe\n\n%ALLUSERSPROFILE%\\Documents\\My Document\\utd_CE31\n\n%ALLUSERSPROFILE%\\Documents\\My Document\\XOLOADER\n\n%ALLUSERSPROFILE%\\Documents\\My Document\\update\n\n%ALLUSERSPROFILE%\\Documents\\My Document\\Log.txt\n\n%PUBLIC%\\Downloads\\Update\\utd_CE31\n\n%PUBLIC%\\Downloads\\Update\\XOLOADER\n\n%PUBLIC%\\Downloads\\Update\\update\n\n%PUBLIC%\\Downloads\\Update\\Log.txt\n\n%APPDATA%\\Intel\\Skype\n\n**Registry Modifications**\n\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Eupdate – %APPDATA%\\Intel\\ResN32.dll\n\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\update – %SYSTEM%\\rundll32.exe\n\n%APPDATA\\Intel\\ResN32.dll Run\n\nHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs –\n\n%APPDATA%\\Intel\\ResN32.dll\n\nHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\LoadAppInit_DLLs – 0x1\n\nHKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\update – c:\\windows\\system32\\rundll32.exe\n\n%APPDATA\\Intel\\ResN32.dll Run\n\n\n-----\n\n198.55.120[.]143:8080\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/u9eldsgol20dmuw0nljeqo9nlw4r9ms7"
    ],
    "report_names": [
        "PaloAlto_T9000-Advanced-Modular-Backdoor-Uses-Complex-Anti-Analysis-Techniques(Feb-04-16)"
    ],
    "threat_actors": [
        {
            "id": "2f07a03f-eb1f-47c8-a8e9-a1a00f2ec253",
            "created_at": "2022-10-25T16:07:24.277669Z",
            "updated_at": "2025-03-27T02:02:10.157972Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Operation LagTime IT",
                "Operation StealthyTrident",
                "ThunderCats"
            ],
            "source_name": "ETDA:TA428",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Agent.dhwf",
                "Albaniiutas",
                "BlueTraveller",
                "Chymine",
                "Cotx RAT",
                "CoughingDown",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "LuckyBack",
                "PhantomNet",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "RoyalRoad",
                "SManager",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TManger",
                "TVT",
                "Thoper",
                "Xamtrav",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716492,
    "ts_updated_at": 1743041150,
    "ts_creation_date": 1455828241,
    "ts_modification_date": 1455828241,
    "files": {
        "pdf": "https://archive.orkl.eu/62df4dd012589910b6be8df92f23e231c493772a.pdf",
        "text": "https://archive.orkl.eu/62df4dd012589910b6be8df92f23e231c493772a.txt",
        "img": "https://archive.orkl.eu/62df4dd012589910b6be8df92f23e231c493772a.jpg"
    }
}