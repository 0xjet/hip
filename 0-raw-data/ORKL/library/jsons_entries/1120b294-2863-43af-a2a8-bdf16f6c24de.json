{
    "id": "1120b294-2863-43af-a2a8-bdf16f6c24de",
    "created_at": "2024-06-26T02:03:23.351932Z",
    "updated_at": "2025-03-27T02:14:56.663615Z",
    "deleted_at": null,
    "sha1_hash": "5466ede3c4fe9fb79bfcf245e1dac2b40671fcdf",
    "title": "100DaysofYARA - SpectralBlur | A Clever Blog Name by Greg Lesnewich",
    "authors": "",
    "file_creation_date": "2024-06-26T01:29:18Z",
    "file_modification_date": "2024-06-26T01:29:18Z",
    "file_size": 419862,
    "plain_text": "# 100DaysofYARA - SpectralBlur\n\n**[g-les.github.io/yara/2024/01/03/100DaysofYARA_SpectralBlur.html](https://g-les.github.io/yara/2024/01/03/100DaysofYARA_SpectralBlur.html)**\n\nA Clever Blog Name by Greg Lesnewich January 3, 2024\n\n### Jan 3, 2024\n\n Today will be a quick post on a TA444 (aka Sapphire Sleet, BLUENOROFF, STARDUST CHOLLIMA) Macho family tracked as SpectralBlur we found in August, and how finding it led us to stumble upon an early iteration of KANDYKORN (aka SockRacket). Please read Elastic’s EXCELLENT piece on that family.\n\n Long story short, internet scan data from Censys tipped us a suspicious domain\n```\npxaltonet[.]org that we believed had tentative links to the Interception cluster (which\n\n we have since merged with TA444 in our dataset). We monitored this domain on VirusTotal (NetIoc rules will make this easier now!) and observed a file called .macshare being downloaded from the auth subdomain.\n\n## Triage\n\n### In checking out this file, we don’t see a lot of initial toolmarks from the developers in the metadata (no codesigning, no leftover RPath, etc.) but a decent amount in the strings - mostly function names! I’ve trimmed the strings output to only show us interesting ones.\n\n```\n\n-----\n\n```\n{\n  \"FileType\": \"THIN\",\n  \"Slices\": [\n    {\n      \"Header\": {\n        \"Type\": \"mach_header_64\",\n        \"Magic\": 4277009103,\n        \"CPUType\": \"X86_64\",\n        \"CPUSubType\": \"ALL\",\n        \"FileType\": \"EXECUTE\",\n        \"LoadCount\": 16,\n        \"LoadSize\": 1368,\n        \"Flags\": [\n          \"NOUNDEFS\",\n          \"DYLDLINK\",\n          \"TWOLEVEL\",\n          \"PIE\"\n        ],\n        \"Reserved\": 0\n      },\n      \"LinkedImages\": {\n        \"LOAD_DYLIB\": [\n          \"/usr/lib/libSystem.B.dylib\"\n        ]\n      },\n      \"Version\": {\n        \"BuildVersion\": {\n          \"Platform\": \"MACOS\",\n          \"MinOS\": \"13.0.0\",\n          \"SDK\": \"13.3.0\",\n          \"Ntools\": 1\n        },\n        \"SourceVersion\": 0\n      },\n      \"UUID\": \"833902ac1aba3cee87dc52ac9f045f26\",\n      \"BaseName\": \"\",\n      \"InstallName\": \"\"\n    }\n  ]\n}\nemit macshare | carve printable --min=6\n/usr/lib/dyld\n/usr/lib/libSystem.B.dylib\nfffff.\nAWAVATSH\n[A\\A^A_]\n%s\n%s\n%s\nThere is NO WARRANTY, to the extent permitted by law.\n/dev/null\n/bin/sh\n\n```\n\n-----\n\n```\n_mh_execute_header\nauthchannel\nhangout\nload_config\nopenchannel\nread_packet\nxcrypt\nlose_fcontext\n_fcontext\nprocess\nthread\nownload\n_content\ngetcfg\nhibernate\ntestconn\nupload\nestart\n_content\nave_config\nigchild\nocket_\nonnect\nait_read\nrite_packet\n_value\n__mh_execute_header\n_authchannel\n_close_fcontext\n_hangout\n_init_fcontext\n_load_config\n_mainprocess\n_mainthread\n_openchannel\n_proc_die\n_proc_dir\n_proc_download\n_proc_download_content\n_proc_getcfg\n_proc_hibernate\n_proc_none\n_proc_restart\n_proc_rmfile\n_proc_setcfg\n_proc_shell\n_proc_sleep\n_proc_stop\n_proc_testconn\n_proc_upload\n_proc_upload_content\n_procs\n_read_packet\n_save_config\n sigchild\n\n```\n\n-----\n\n```\n_socket_close\n_socket_connect\n_socket_recv\n_socket_send\n_wait_read\n_write_packet\n_write_packet_value\n_xcrypt\n\n### So two things happened from this point for me - I load the binary up in Binary Ninja or Ghidra, and at the same time, I started running queries on some of the unique strings and kicked off a retrohunt with a rule very similar to the following. I ignored some super unique strings like xcrypt, authchannel, or load_config to do exactly what I accomplished - finding a potentially related family!\n\n```\n\n-----\n\n```\nrule APT_NK_TA444_SpectralBlur_SockRacket_Overlap\n{\n     meta:\n          author = \"Greg Lesnewich\"\n          description = \"track overlaps across KandyKorn/SockRacket and\nSpectralBlur\"\n          date = \"2023-08-21\"\n          version = \"1.0\"\n          hash =\n\"0753859738620c7394f04220e273974982203a6ea1c2a30247149a9c8ff07037\" //SockRacket\n          hash =\n\"1d6cf7159c8dd98299798b0985f62dd15cb2e64550cd57a9e747dc3bee5f46d8\" //SockRacket\n          hash =\n\"c99729c39d197dd774e6febab5ec33abdf31f4404b4ffadad553efb3aa86192d\" //SockRacket\n          hash =\n\"d2d60f678d0b881b3e079b46bdb813f9f7d8802a227aea46926e4bbd1838f9e5\" //SockRacket\n          hash =\n\"d57a2e0c42c63659d6c09fc593fd5d272aec75b3629d9993b760142c731a191d\" //SockRacket\n          hash =\n\"f91801b458d875cfe61f927d16202b3a853d07e89a66ca4663989878e94242ad\" //SockRacket\n          hash =\n\"6f3e849ee0fe7a6453bd0408f0537fa894b17fc55bc9d1729ae035596f5c9220\" //SpectralBlur\n     strings:\n          $s_dylib = \"/usr/lib/libSystem.B.dylib\" ascii wide\n          $s_string1 = \"/dev/null\" ascii wide\n          $s_string2 = \"SHELL\" ascii wide\n          $s_string3 = \"/bin/sh\" ascii wide\n          $s_import1 = \"inet_addr\" ascii wide\n          $s_import2 = \"inet_ntoa\" ascii wide\n          $s_import3 = \"socket\" ascii wide\n          $s_import4 = \"socket\" ascii wide\n          $s_import5 = \"gethostbyname\" ascii wide\n          $s_import6 = \"getpwuid\" ascii wide\n          $s_import7 = \"kill\" ascii wide\n          $fp1 = \"ftp\" nocase ascii wide\n          $fp2 = \"kermit\" nocase ascii wide\n     condition:\n          (\n          uint32(0) == 0xfeedface or // Mach-O MH_MAGIC\n          uint32(0) == 0xcefaedfe or // Mach-O MH_CIGAM\n          uint32(0) == 0xfeedfacf or // Mach-O MH_MAGIC_64\n          uint32(0) == 0xcffaedfe or // Mach-O MH_CIGAM_64\n          uint32(0) == 0xcafebabe or // Mach-O FAT_MAGIC\n          uint32(0) == 0xbebafeca  // Mach-O FAT_CIGAM\n          )\n          and filesize < 3MB and all of ($s_*) and none of ($fp*)\n}\n\n### As the retro hunt was running, I started my analysis. And, thankfully, the operators kept function names intact when they compiled, so it made my life easy! SpectralBlur is a moderately capable backdoor, that can upload/download files, run a shell, update its configuration, delete files, hibernate or sleep, based on commands issued from the C2.\n\n```\n\n-----\n\n### It communicates via sockets wrapped in RC4\n\n The available commands listed under the term proc\n\n\n-----\n\n### And once the retro came back, we can see some similarities from sound familiar to the KandyKorn article you read from Elastic?? But these feel like families developed by different folks with the same sort of requirements.\n\n\n-----\n\n### I haven’t the time or skill to fully reverse SpectralBlur so if anyone in the community is keen on it, go for it!! But that XCrypt function looks unique enough to sig on along with some of the function names.\n\n\n-----\n\n```\nrule APT_NK_TA444_SpectralBlur\n{\n     meta:\n          author = \"Greg Lesnewich\"\n          description = \"track the SpectralBlur backdoor\"\n          date = \"2023-08-21\"\n          version = \"1.0\"\n          hash =\n\"6f3e849ee0fe7a6453bd0408f0537fa894b17fc55bc9d1729ae035596f5c9220\"\n          DaysofYARA = \"3/100\"\n     strings:\n          $xcrypt1 = {\n              99         // cdq\n              f7 [4-8]      // idiv  dword [rbp-0x11c {var_124}]\n              8b [4-8]      // mov   eax, dword [rbp-0x14c\n{var_154_1}]\n              48 63 d2      // movsxd rdx, edx\n              0f b6 0c 11    // movzx  ecx, byte [rcx+rdx]\n              01 c8       // add   eax, ecx\n              b9 00 01 00 00   // mov   ecx, 0x100\n              99         // cdq\n              f7 f9       // idiv  ecx\n          }\n          $xcrypt2 = {\n              8b 85 c4 fe ff ff    // mov   eax, dword [rbp-0x13c\n{var_144_2}]\n              83 c0 01         // add   eax, 0x1\n              b9 00 01 00 00      // mov   ecx, 0x100\n              99            // cdq\n              f7 f9          // idiv  ecx\n              [20-40]\n              01 c8          // add   eax, ecx\n              b9 00 01 00 00      // mov   ecx, 0x100\n              99            // cdq\n              f7 f9          // idiv  ecx\n          }\n          $symbol1 = \"xcrypt\" ascii wide\n          $symbol2 = \"_proc_die\" ascii wide\n          $symbol3 = \"_proc_dir\" ascii wide\n          $symbol4 = \"_proc_download\" ascii wide\n          $symbol5 = \"_proc_download_content\" ascii wide\n          $symbol6 = \"_proc_getcfg\" ascii wide\n          $symbol7 = \"_proc_hibernate\" ascii wide\n          $symbol8 = \"_proc_none\" ascii wide\n          $symbol9 = \"_proc_restart\" ascii wide\n          $symbol10 = \"_proc_rmfile\" ascii wide\n          $symbol11 = \"_proc_setcfg\" ascii wide\n          $symbol12 = \"_proc_shell\" ascii wide\n          $symbol13 = \"_proc_sleep\" ascii wide\n          $symbol14 = \"_proc_stop\" ascii wide\n          $symbol15 = \"_proc_testconn\" ascii wide\n          $symbol16 = \" proc upload\" ascii wide\n\n```\n\n-----\n\n```\n          $symbol17 = \"_proc_upload_content\" ascii wide\n          $symbol18 = \"_sigchild\" ascii wide\n          $string1 = \"/dev/null\" ascii wide\n          $string2 = \"SHELL\" ascii wide\n          $string3 = \"/bin/sh\" ascii wide\n          $string4 =\n{2573200a2573200a2573200a2573200a2573200a2573200a2573200a257320} // %s with\nrepeating new lines string\n     condition:\n          //(\n          //uint32(0) == 0xfeedface or // Mach-O MH_MAGIC\n          //uint32(0) == 0xcefaedfe or // Mach-O MH_CIGAM\n          //uint32(0) == 0xfeedfacf or // Mach-O MH_MAGIC_64\n          //uint32(0) == 0xcffaedfe or // Mach-O MH_CIGAM_64\n          //uint32(0) == 0xcafebabe or // Mach-O FAT_MAGIC\n          //uint32(0) == 0xbebafeca  // Mach-O FAT_CIGAM\n          //) and\n          (any of ($xcrypt*) or 4 of ($symbol*) or (all of ($string*)))\n}\n\n## Wrapping Up\n\n### TA444 keeps running fast and furious with these new MacOS malware families. Looking for similar strings lead us to link SpectralBlur and KandyKorn (which were further linked to TA444 after more samples turned up, and eventually, a phishing campaign hit our visibility that pulled down KandyKorn). So knowing your Macho stuff will help track emerging DPRK capability if that is your interest!\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2024/2024.01.03.SpectralBlur_North_Korean/100DaysofYARA%20-%20SpectralBlur%20_%20A%20Clever%20Blog%20Name%20by%20Greg%20Lesnewich.pdf"
    ],
    "report_names": [
        "100DaysofYARA - SpectralBlur _ A Clever Blog Name by Greg Lesnewich"
    ],
    "threat_actors": [
        {
            "id": "1bdb91cf-f1a6-4bed-8cfa-c7ea1b635ebd",
            "created_at": "2022-10-25T16:07:23.766784Z",
            "updated_at": "2025-03-27T02:02:09.971636Z",
            "deleted_at": null,
            "main_name": "Bluenoroff",
            "aliases": [
                "APT 38",
                "ATK 117",
                "Alluring Pisces",
                "Black Alicanto",
                "Bluenoroff",
                "CTG-6459",
                "Copernicium",
                "Nickel Gladstone",
                "Sapphire Sleet",
                "Selective Pisces",
                "Stardust Chollima",
                "T-APT-15",
                "TA444",
                "TAG-71",
                "TEMP.Hermit"
            ],
            "source_name": "ETDA:Bluenoroff",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "810fada6-3a62-477e-ac11-2702f9a1ef80",
            "created_at": "2023-01-06T13:46:38.874104Z",
            "updated_at": "2025-03-27T02:00:02.94053Z",
            "deleted_at": null,
            "main_name": "STARDUST CHOLLIMA",
            "aliases": [],
            "source_name": "MISPGALAXY:STARDUST CHOLLIMA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d14271be-be2e-4be7-9578-5b6196e35481",
            "created_at": "2023-11-21T02:00:07.355328Z",
            "updated_at": "2025-03-27T02:00:03.24142Z",
            "deleted_at": null,
            "main_name": "TA444",
            "aliases": [],
            "source_name": "MISPGALAXY:TA444",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f426f0a0-faef-4c0e-bcf8-88974116c9d0",
            "created_at": "2022-10-25T15:50:23.240383Z",
            "updated_at": "2025-03-27T02:00:55.404232Z",
            "deleted_at": null,
            "main_name": "APT38",
            "aliases": [
                "APT38",
                "NICKEL GLADSTONE",
                "BeagleBoyz",
                "Bluenoroff",
                "Stardust Chollima",
                "Sapphire Sleet",
                "COPERNICIUM"
            ],
            "source_name": "MITRE:APT38",
            "tools": [
                "ECCENTRICBANDWAGON",
                "HOPLIGHT",
                "Mimikatz",
                "KillDisk",
                "DarkComet"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "8bc1a044-a23b-4904-903c-13f463605cb3",
            "created_at": "2024-05-01T02:03:08.136237Z",
            "updated_at": "2025-03-27T02:05:17.415795Z",
            "deleted_at": null,
            "main_name": "NICKEL GLADSTONE",
            "aliases": [
                "Bluenoroff ",
                "CTG-6459 ",
                "Citrine Sleet ",
                "HIDDEN COBRA ",
                "Lazarus Group",
                "Sapphire Sleet ",
                "Stardust Chollima ",
                "APT38 "
            ],
            "source_name": "Secureworks:NICKEL GLADSTONE",
            "tools": [
                " Bankshot",
                " CATCH22",
                " CCGC_Proxy",
                " Cur1Agent",
                " Ratankba",
                " Server_TrafficForwarder",
                " Wcry",
                "AlphaNC"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1719367403,
    "ts_updated_at": 1743041696,
    "ts_creation_date": 1719365358,
    "ts_modification_date": 1719365358,
    "files": {
        "pdf": "https://archive.orkl.eu/5466ede3c4fe9fb79bfcf245e1dac2b40671fcdf.pdf",
        "text": "https://archive.orkl.eu/5466ede3c4fe9fb79bfcf245e1dac2b40671fcdf.txt",
        "img": "https://archive.orkl.eu/5466ede3c4fe9fb79bfcf245e1dac2b40671fcdf.jpg"
    }
}