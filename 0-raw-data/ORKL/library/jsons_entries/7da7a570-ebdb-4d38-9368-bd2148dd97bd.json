{
    "id": "7da7a570-ebdb-4d38-9368-bd2148dd97bd",
    "created_at": "2023-01-12T15:09:12.773685Z",
    "updated_at": "2025-03-27T02:09:29.120748Z",
    "deleted_at": null,
    "sha1_hash": "f2e55ab78462b11ad3a8036d4acce04846f40844",
    "title": "2012-07-13 - Rovnix bootkit framework updated",
    "authors": "",
    "file_creation_date": "2022-05-28T15:45:31Z",
    "file_modification_date": "2022-05-28T15:45:31Z",
    "file_size": 326993,
    "plain_text": "# Rovnix bootkit framework updated\n\n**[welivesecurity.com/2012/07/13/rovnix-bootkit-framework-updated/](https://www.welivesecurity.com/2012/07/13/rovnix-bootkit-framework-updated/)**\n\nJuly 13, 2012\n\nChanges in the threatscape as regards exploitation of 64-bit systems, exemplified by the\nlatest modifications to the Rovnix bootkit.\n\n13 Jul 2012 - 11:05AM\n\nChanges in the threatscape as regards exploitation of 64-bit systems, exemplified by the\nlatest modifications to the Rovnix bootkit.\n\nWe have been tracking the activity of the Rovnix bootkit family since April 2011. Rovnix was\nthe first bootkit family to use VBR (Volume Boot Record) infection (NTFS bootstrap code)\nfor loading unsigned kernel-mode drivers on x64 (64 bit) platforms. The reason for exploring\nfurther is the desire of the Rovnix developers to bypass antivirus detection. The payload of\nthe first samples in the wild blocked internet connection for Russian users and forced them\nto send an SMS to a premium number in order to get their connection unblocked (Hasta La\nVista, Bootkit: Exploiting the VBR).\n\nThese variants with the internet blocking payload stopped using the bootkit component\nduring the summer of 2011. At that time the Rovnix framework was sold to Carberp\ndevelopers responsible for the botnet Hodprot/Origami (Evolution of Win32Carberp: going\ndeeper). The Carberp developers used droppers incorporating bootkit framework only up to\nthe end of 2011. We don’t have information about other sales of the Rovnix bootkit\nframework. But we only have information relating to a really small percentage of infections\nwith Rovnix based bootkit code. A few days ago we got some interesting samples and quick\nanalysis revealed similar VBR modifications to the Rovnix.B family. After unpacking the\ndropper we found a typical component for providing the next steps for  installation of the\nRovnix bootkit’s BkSetup.dll module. The compilation timestamp of BkSetup.dll module\nlooks fresh and is dated 24/06/2012: certainly it’s possible to fake a timestamp, but up to\nnow developers had not changed the date on BkSetup.dll).\n\n\n-----\n\nThere is also a version information structure to be found in the resource section of\nBkSetup.dll filled as follows:\n\nThe file version has been changed to 2.4: previously, Carberp used version 2.1 of\nBkSetup.dll and stored the information in the debug string sent to the C&C as debugging\ninformation.\n\nThe base functionality of BkSetup.dll is centred on the process of infection and setting up\nthe hidden storage partition. A call graph of the main BkSetup.dll routines looks like this:\n\nA new sample with a new version of the Rovnix bootkit framework is indirect evidence of\nrenewed sales activity and in the near future we may possible be able to disclose details of\nthe relationship between Rovnix and other malware families. And now we will go deeper\ninto the technical details of the Rovnix.D modification.\n\n## Polymorphic bootstrap code\n\nSince Rovnix.B the modified bootstrap code has used polymorphic code in order to bypass\nstatic antivirus signature detection. Originally, polymorphic decryption code was detected in\nCarberp samples incorporating bootkit code. The following figure shows the basic workings\nof the polymorphic decryption code.\n\n\n-----\n\nA simple trick of polymorphism based on permutations of the basic code blocks always\nresults in the malware’s getting control of the decrypted malicious VBR code. The basic\ncode blocks look like this:\n\n[polymorphic code from Rovnix.B]\n\nThe reason for using polymorphic code is to bypass static signature detections by antivirus\nengines: this code can only be detected generically using emulation. Emulation is a\ntechnique closely related to sandboxing where the code is executed in a safe virtual\nenvironment in order to analyse it dynamically. The differences between the Rovnix.D and\nRovnix.B versions are presented in this flow graph:\n\n\n-----\n\n[Rovnix.D variant (left) and Rovnix.B variant (right)]\n\nThe place where the encrypted malicious VBR is stored has been changed too, and after\nexecution of the polymorphic code, control is transferred to the decrypted malicious VBR\ncode. The different placement of the encrypted malicious VBR looks like this:\n\n\n-----\n\nWe also found changes to the function for decrypting and reading the malicious unsigned\ndriver from raw sectors in the hard drive. These sectors are not used for general hidden\nstorage, but only as a location for storing the malicious driver, which injects the payload into\nspecified user-mode processes on the infected machine. Differences can be seen in the\nfollowing figure:\n\n[Rovnix.D variant (left) and Rovnix.B variant (right)]\n\nAll these changes are directed towards bypassing antivirus detections and do not represent\nfundamental changes in the general Rovnix bootkit framework structure.\n\n\n-----\n\n## Changes in hidden file storage\n\nThe structure of the hidden file system looks similar to the previous Rovnix modification and\nhas already been described in previous blog posts (Rovnix Reloaded: new step of\nevolution). However insignificant changes were found in the file system initialization code. A\nstrange function call was detected with the ability to read the file INJECTS.SYS from hidden\nstorage.\n\nThis curious function extracts one or two paths from the file INJECTS.SYS to files on the\nstandard file system. The function code is presented in the figure below:\n\nControl flow never gets to execution of this code because the condition always receives\nNULL and control is never transferred to this code. In my opinion this modification in\nRovnix.D is used for tests, and we aren’t seeing many detections in the wild. Rovnix.D\nseems to be a transitional version in preparation for something else, but at this moment we\ndon’t have a clear understanding of what that might be.\n\n\n-----\n\n## Payload\n\nThe payload module includes functionality for downloading and executing additional\nmodules from the C&C server. This module does not provide hooks and other malicious\nmodifications to system memory, and is not generally detected by most common antivirus\nengines.\n\nThe C&C domain is rtttt-windows.com\n\nThe payload module works in multithreading mode and can communicate with the malicious\ndriver. For synchronization reasons the payload generates the mutex:\nGlobal<Generated_string>. The call graph for the main thread looks like this:\n\nThe payload module can also send an encrypted buffer to the malicious driver to be written\nto hidden storage and injection into processes. Before this Rovnix has not used any\nfunctionality for multiple injects, and provided only one payload module. Rovnix.D can use\nmultiple payloads and can be used to provide a botnet for rent, and at the end of the rental\nperiod the payload will be changed.\n\n## Conclusion\n\nAt this moment changes can be seen in the landscape of complex threats for the x64\nplatform. The Sirefef (ZeroAccess) family has been migrated to user-mode in its latest\n[modifications (ZeroAccess: code injection chronicles). Olmarik/Olmasco (TDL4 and MaxSS](https://www.welivesecurity.com/2012/06/25/zeroaccess-code-injection-chronicles)\nmodification) does not account for a large percentage of infections in the wild and has\n[stopped evolving (The Evolution of TDL: Conquering x64). Why are rootkits/bootkits for the](http://go.eset.com/us/resources/white-papers/The_Evolution_of_TDL.pdf)\n64 bit platform dying? In my opinion the ways in which x64 systems can be infected are\nseverely limited, and the search for something new requires ample time and considerable\nexperience on the part of the developer. Most bootkit infections have used MBRmodification, but this method is pretty old and by this time most common antivirus engines\nprovide checks for a modified MBR. The Rovnix family used other ways to infect with\nmodification of the VBR, but a constant stream of new modifications necessitates the\nprovision of a great deal of debugging information to the C&C. The complexity of\ndevelopment and debugging on multiple platforms is one reason for the high price of the\nRovnix bootkit framework. For example the fully-featured builder costs $60.000 including\nbasic support for half a year. This price is only for the bootkit package and excludes the cost\nof exploits for escalating privilege in order to get access allowing modifications deep into the\nsystem.\n\n\n-----\n\nIn future, complex stealth technologies will mostly be used in targeted attacks, because the\ncost of buying and using them is not commensurate with the anticipated profit for typical\ncybercriminals. We now have less than ten families of x64 bootkits and their activity in the\nwild is also decreasing.\n\nSHA1 hashes for the Rovnix.D droppers mentioned are:\n\nC1C0CC056D31222D3735E6801ACBA763AC024C5B\n764B4F0202097F2B41A2821D30A7424490BF3A42\n\n_Special thanks to my colleagues Pawel Smierciak and Maxim Grigoryev._\n\n**Aleksandr Matrosov, Security Intelligence Team Lead**\n\n13 Jul 2012 - 11:05AM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2012/2012-07-13 - Rovnix bootkit framework updated.pdf"
    ],
    "report_names": [
        "2012-07-13 - Rovnix bootkit framework updated.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536152,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653752731,
    "ts_modification_date": 1653752731,
    "files": {
        "pdf": "https://archive.orkl.eu/f2e55ab78462b11ad3a8036d4acce04846f40844.pdf",
        "text": "https://archive.orkl.eu/f2e55ab78462b11ad3a8036d4acce04846f40844.txt",
        "img": "https://archive.orkl.eu/f2e55ab78462b11ad3a8036d4acce04846f40844.jpg"
    }
}