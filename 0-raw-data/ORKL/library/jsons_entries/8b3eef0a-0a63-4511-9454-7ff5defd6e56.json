{
    "id": "8b3eef0a-0a63-4511-9454-7ff5defd6e56",
    "created_at": "2023-01-12T15:04:46.211677Z",
    "updated_at": "2025-03-27T02:16:26.174803Z",
    "deleted_at": null,
    "sha1_hash": "09df610393fcf94be04ec38c358f199950a41547",
    "title": "2017-06-20 - Ztorg- from rooting to SMS",
    "authors": "",
    "file_creation_date": "2022-05-29T01:03:22Z",
    "file_modification_date": "2022-05-29T01:03:22Z",
    "file_size": 592471,
    "plain_text": "# Ztorg: from rooting to SMS\n\n**securelist.com/ztorg-from-rooting-to-sms/78775/**\n\nAuthors\n\n[Roman Unuchek](https://securelist.com/author/romanunuchek/)\n\nI’ve been monitoring Google Play Store for new Ztorg Trojans since September 2016, and\nhave so far found several dozen new malicious apps. All of them were rooting malware that\nused exploits to gain root rights on the infected device.\n\nThen, in the second half of May 2017 I found one that wasn’t. Distributed on Google Play\nthrough two malicious apps, it is related to the Ztorg Trojans, although not a rooting malware\nbut a Trojan-SMS that can send Premium rate SMS and delete incoming SMS. The apps had\nbeen installed from Google Play more than 50,000 and 10,000 times respectively.\n\nKaspersky Lab products detect the two Trojan apps as Trojan-SMS.AndroidOS.Ztorg.a. We\nreported the malware to Google, and both apps have been deleted from the Google Play\nStore.\n\nThe first malicious app, called “Magic browser” was uploaded to Google Play on May 15,\n2017 and was installed more than 50,000 times.\n\n\n-----\n\n_Trojan-SMS.AndroidOS.Ztorg.a on Google Play Store_\n\nThe second app, called “Noise Detector”, with the same malicious functionality, was installed\nmore than 10,000 times.\n\n\n-----\n\n_Trojan-SMS.AndroidOS.Ztorg.a on Google Play Store_\n\n## What can they do?\n\nAfter starting, the Trojan will wait for 10 minutes before connecting to its command and\ncontrol (C&C) server. It uses an interesting technique to get commands from the C&C: it\nmakes two GET requests to the C&C, and in both includes part of the International Mobile\nSubscriber Identity (IMSI). The first request will look like this:\n\n_GET c.phaishey.com/ft/x250_c.txt, where 250 – first three digits of the IMSI._\n\nIf the Trojan receives some data in return, it will make the second request. The second\nrequest will look like this:\n\n\n-----\n\n_GET c.phaishey.com/ft/x25001_0.txt, where 25001 – first five digits of the IMSI._\n\nWhy does the Trojan need these digits from the IMSI?\n\n[The interesting thing about the IMSI is that the first three digits are the MCC (mobile country](https://en.wikipedia.org/wiki/Mobile_country_code)\ncode) and the fourth and fifth digits are the MNC (mobile network code). Using these digits,\nthe cybercriminals can identify the country and mobile operator of the infected user. They\nneed this to choose which premium rate SMS should be sent.\n\nIn answer to these requests, the Trojan may receive an encrypted JSON file with some data.\nThis data should include a list of offers, and every offer carries a string field called ‘url’, which\nmay or may not contain an actual url. The Trojan will try to open/view the field using its own\nclass. If this value is indeed a url, the Trojan will show its content to the user. But if it is\nsomething else and carries an “SMS” substring, the user will send an SMS containing the\ntext supplied to the number provided.\n\n_Malicious code where the Trojan decides if it should send an SMS._\n\nThis is an unusual way to send SMS. Just after it receives urls to visit, or SMS to send, the\nTrojan will turn off the device sound, and start to delete all incoming SMS.\n\nI wasn’t able to get any commands for the Trojans distributed through Google Play. But for\nother Trojans located elsewhere that have the same functionality, I got the command:\n\n{“icon”:”http://down.rbksbtmk.com/pic/four-dault06.jpg”,”id”:”-1″,”name”:”Brower”,”result”:1,”status”:1,”url”:”http://global.621.co/trace?\noffer_id=111049&aff_id=100414&type=1″}\n\nIt was a regular advertising offer.\n\n## WAP billing subscriptions\n\nI was able to find several more malicious apps with the same functionality distributed outside\nthe Google Play Store. The interesting thing is that they don’t look like standalone Trojans,\nmore like an additional module for some Trojan.\n\n\n-----\n\nFurther investigation revealed that these Trojans were installed by a regular Ztorg Trojan\nalong with other Ztorg modules.\n\nIn a few of these Trojans, I found that they download a JS file from the malicious url using the\nMCC.\n\n_Malicious code where the Trojan downloads a JS file._\n\nI downloaded several JS files, using different MCC’s, to find out what cybercriminals are\ngoing to do with users from a different countries. I wasn’t able to get a file for a US MCC, but\nfor other countries that I tried I received files with some functions. All the files contain a\n[function called “getAocPage” which most likely references AoC – Advice of Charge. After](http://www.wirelessdictionary.com/Wireless-Dictionary-Advice-Of-Charge-AOC-Definition.html)\n[analyzing these files, I found out that their main purpose is to perform clickjacking attacks on](https://en.wikipedia.org/wiki/Clickjacking)\n[web pages with WAP billing. In doing so, the Trojan can steal money from the user’s mobile](https://en.wikipedia.org/wiki/Clickjacking)\naccount. WAP billing works in a similar way to Premium rate SMS, but usually in the form of\nsubscriptions and not one-time payments as most Premium rate SMS.\n\n\n-----\n\n_JS file from a CnC for Russian users (MCC = 250)_\n\nIt means that urls which the Trojan receives from the CnC may not only be advertising urls,\nbut also urls with WAP billing subscriptions. Furthermore some Trojans with this functionality\nuse CnC urls that contain “/subscribe/api/” which may reference subscriptions too.\n\nAll of these Trojans, including Trojans from Google Play, are trying to send SMS from any\ndevice. To do so they are using lots of methods to send SMS:\n\n\n-----\n\n_Part of the “Magic browser” app’s code_\n\nIn total, the “Magic browser” app tries to send SMS from 11 different places in its code.\nCybercriminals are doing this in order to be able to send SMS from different Android versions\nand devices. Furthermore, I was able to find another modification of the TrojanSMS.AndroidOS.Ztorg that is trying to send an SMS via the “am” command, although this\napproach should not work.\n\n\n-----\n\n## Connection with the Ztorg malware family\n\nThe “Magic browser” app was promoted in a similar way to other Ztorg Trojans. Both the\nMagic browser” and “Noise detector” apps shared code similarities with other Ztorg Trojans.\nFurthermore, the latest version of the “Noise detector” app contains the encrypted file\n“girl.png” in the assets folder of the installation package. After decryption, this file become a\nZtorg Trojan.\n\nI found several more Trojans with the same functionality that were installed by a regular\nZtorg Trojan along with the other Ztorg modules. And it isn’t the first case where additional\nZtorg modules were distributed from Google Play as a standalone Trojan. In April 2017, I\nfound that a malicious app called “Money Converter”, had been installed more than 10,000\ntimes from Google Play. It uses Accessibility Services to install apps from Google Play.\nTherefore, the Trojan can silently install and run promoted apps without any interaction with\nthe user, even on updated devices where it cannot gain root rights.\n\n## Trojan-SMS vs. rooting\n\nThere were two malicious apps on Google Play with the same functionality – “Noise\nDetector” and “Magic browser” but I think that they each had a different purpose. “Magic\nbrowser” was uploaded first and I assume that the cybercriminals were checking if they were\nable to upload this kind of functionality. After they uploaded the malicious app they didn’t\nupdate it with newer versions.\n\nBut it is a different story with “Noise Detector” – here it looks like the cybercriminals were\ntrying to upload an app infected with a regular version of the Ztorg Trojan. But in the process\nof uploading they decided to add some malicious functionality to make money while they\nwere working on publishing the rooting malware. And the history of “Noise Detector” updates\nprove it.\n\nOn May 20 they uploaded a clean app called “Noise Detector”. A few days later they updated\nit with another clean version.\n\nThen, a few days after that, they uploaded a version to Google Play that contained an\nencrypted Ztorg Trojan, but without the possibility of decrypting and executing it. On the\nfollowing day they finally updated their app with the Trojan-SMS functionality, but still didn’t\nadd the possibility to execute the encrypted Ztorg module. It is likely that, if the app hadn’t\nbeen removed from Google Play, they would have added this functionality at the next stage.\nThere is also the possibility that attempting to add this functionality is what alerted Google to\nthe Trojan’s presence and resulted in its deletion.\n\n## Conclusions\n\n\n-----\n\nWe found a very unusual Trojan-SMS being distributed through Google Play. It not only uses\naround a dozen methods to send SMS, but also initializes these methods in an unusual way:\nby processing web-page loading errors using a command from the CnC. And it can open\nadvertising urls. Furthermore, it is related to Ztorg malware with the same functionality, that is\noften installed by Ztorg as an additional module.\n\nBy analyzing these apps I found that cybercriminals are working on clickjacking WAP billing.\nIt means that these Trojans may not only open ad urls, or send Premium rate SMS, but also\nopen web-pages with WAP billing and steal money from a user’s account. To hide these\nactivities the Trojans turn off the device sound and delete all incoming SMS.\n\nThis isn’t the first time that the cybercriminals distributed Ztorg modules through Google Play.\nFor example, on April 2017 they uploaded a module that can click on Google Play Store app\nbuttons to install or even buy promoted apps.\n\nMost likely, the attackers are publishing Ztorg modules to make some additional money while\nthey are trying to upload the regular rooting Ztorg Trojan. I suggest this because one of the\nmalicious apps had an encrypted Ztorg module but it wasn’t able to decrypt it.\n\n## MD5\n\nF1EC3B4AD740B422EC33246C51E4782F\nE448EF7470D1155B19D3CAC2E013CA0F\n55366B684CE62AB7954C74269868CD91\nA44A9811DB4F7D39CAC0765A5E1621AC\n1142C1D53E4FBCEFC5CCD7A6F5DC7177\n\n[Google Android](https://securelist.com/tag/google-android/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[Mobile Malware](https://securelist.com/tag/mobile-malware/)\n[Ztorg](https://securelist.com/tag/ztorg/)\n\nAuthors\n\n[Roman Unuchek](https://securelist.com/author/romanunuchek/)\n\nZtorg: from rooting to SMS\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-06-20 - Ztorg- from rooting to SMS.pdf"
    ],
    "report_names": [
        "2017-06-20 - Ztorg- from rooting to SMS.pdf"
    ],
    "threat_actors": [
        {
            "id": "bfded1cf-be73-44f9-a391-0751c9996f9a",
            "created_at": "2022-10-25T15:50:23.337107Z",
            "updated_at": "2025-03-27T02:00:55.445946Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "FIN7",
                "GOLD NIAGARA",
                "ITG14",
                "Carbon Spider",
                "ELBRUS",
                "Sangria Tempest"
            ],
            "source_name": "MITRE:FIN7",
            "tools": [
                "Mimikatz",
                "AdFind",
                "JSS Loader",
                "HALFBAKED",
                "REvil",
                "PowerSploit",
                "CrackMapExec",
                "Carbanak",
                "Pillowmint",
                "Cobalt Strike",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRat",
                "Lizar",
                "TEXTMATE",
                "BOOSTWRITE"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "bb8702c5-52ac-4359-8409-998a7cc3eeaf",
            "created_at": "2023-01-06T13:46:38.405479Z",
            "updated_at": "2025-03-27T02:00:02.82533Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "JokerStash",
                "ATK32",
                "G0046",
                "Coreid",
                "Carbanak",
                "Sangria Tempest",
                "CARBON SPIDER",
                "GOLD NIAGARA",
                "G0008",
                "ELBRUS",
                "Carbon Spider"
            ],
            "source_name": "MISPGALAXY:FIN7",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d85adfe3-e1c3-40b0-b8bb-d1bacadc4d82",
            "created_at": "2022-10-25T16:07:23.619566Z",
            "updated_at": "2025-03-27T02:02:09.890982Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "APT-C-11",
                "ATK 32",
                "Gold Niagara",
                "ITG14",
                "TAG-CR1"
            ],
            "source_name": "ETDA:FIN7",
            "tools": [
                "7Logger",
                "Agentemis",
                "Anunak",
                "Astra",
                "BIOLOAD",
                "BIRDWATCH",
                "Bateleur",
                "Boostwrite",
                "CROWVIEW",
                "Carbanak",
                "Cobalt Strike",
                "CobaltStrike",
                "DICELOADER",
                "DNSMessenger",
                "FOWLGAZE",
                "HALFBAKED",
                "JSSLoader",
                "KillACK",
                "LOADOUT",
                "Lizar",
                "Meterpreter",
                "Mimikatz",
                "POWERPLANT",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "TEXTMATE",
                "Tirion",
                "VB Flash",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535886,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1653786202,
    "ts_modification_date": 1653786202,
    "files": {
        "pdf": "https://archive.orkl.eu/09df610393fcf94be04ec38c358f199950a41547.pdf",
        "text": "https://archive.orkl.eu/09df610393fcf94be04ec38c358f199950a41547.txt",
        "img": "https://archive.orkl.eu/09df610393fcf94be04ec38c358f199950a41547.jpg"
    }
}