{
    "id": "faa984f1-0835-4d28-84db-5ea8c5e336e2",
    "created_at": "2023-01-12T14:59:00.086769Z",
    "updated_at": "2025-03-27T02:05:50.051595Z",
    "deleted_at": null,
    "sha1_hash": "49351f34f09402a2725a7901a1d8fda5f6162f9b",
    "title": "2020-10-26 - Excel 4 Macros- -Abnormal Sheet Visibility-",
    "authors": "",
    "file_creation_date": "2022-05-28T19:53:32Z",
    "file_modification_date": "2022-05-28T19:53:32Z",
    "file_size": 254387,
    "plain_text": "# SANS ISC: InfoSec Handlers Diary Blog - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training InfoSec Handlers Diary Blog\n\n**isc.sans.edu/diary/rss/26726**\n\n## Excel 4 Macros: \"Abnormal Sheet Visibility\"\n\n**Published: 2020-10-26**\n\n**Last Updated: 2020-10-26 21:53:07 UTC**\n\n**by** [Didier Stevens (Version: 1)](https://isc.sans.edu/handler_list.html#didier-stevens)\n\n[3 comment(s)](https://isc.sans.edu/forums/diary/Excel+4+Macros+Abnormal+Sheet+Visibility/26726/#comments)\n[Excel 4 macros are composed of formulas (commands) and values stored inside a sheet.](https://isc.sans.edu/forums/diary/Maldoc+Excel+40+Macros/24750/)\n\n[Each sheet in a spreadsheet can be \"visible\", \"hidden\" or \"very hidden\". Malware authors will](https://isc.sans.edu/diary/Excel+Maldocs%3A+Hidden+Sheets/25876)\noften make Excel 4 macro sheets hidden or very hidden.\n\nIn .xls files, spreadsheet data is stored in the Workbook stream as BIFF records. There is a\nBIFF record for sheets: the BOUNDSHEET record. The byte value at position 5 in a\nBOUNDSHEET record defines the visibility of a sheet: visible (0x00), hidden (0x01) or very\nhidden (0x02):\n\nEncoding the visibility of a sheet is done with the 2 least significant bits. Per Microsoft's\ndocumentation, the 6 more significant bits are unused bits and must be ignored. In\nspreadsheets created with Excel, these bits are set to 0.\n\n\n-----\n\nFrom time to time, I find malicious Excel 4 macro documents, where these bits are not zero:\n\n[oledump's plugin_biff will report this: \"reserved bits not zero\".](https://blog.didierstevens.com/programs/oledump-py/)\n\nThe \"visibility\" value is 0x0A, that's 0x08 + 0x02: thus the sheet is very hidden (0x02).\n\nExcel has no problem at all opening a spreadsheet like this (the unused bits must be\nignored). But if you use or develop detection rules like YARA, Suricata, ... ; be aware that\nthese unused bits can be set to 1 in stead of 0.\n\nYou might wonder: 2 bits to encode visibility. Visible (0x00), hidden (0x01) or very hidden\n(0x02).\n\nWhat about 0x03?\n\n\n-----\n\nWhen a sheet's visibility is set to 0x03 (I do this by patching the .xls with a binary editor), my\ntests with Excel 2016 and 2019 show that an Excel 4 macro sheet will behave as \"very\nhidden\", and the macro code will be executed.\n\nHowever, before a user is prompted to enable macros, that user will have to click through\nextra warnings:\n\nDidier Stevens\n\nSenior handler\n\nMicrosoft MVP\n\n[blog.DidierStevens.com](http://blog.didierstevens.com/) [DidierStevensLabs.com](http://didierstevenslabs.com/)\n\n[Keywords: excel4](https://isc.sans.edu/tag.html?tag=excel4) [macros](https://isc.sans.edu/tag.html?tag=macros) [maldoc](https://isc.sans.edu/tag.html?tag=maldoc) [vibility](https://isc.sans.edu/tag.html?tag=vibility)\n[3 comment(s)](https://isc.sans.edu/forums/diary/Excel+4+Macros+Abnormal+Sheet+Visibility/26726/)\n\nJoin us at SANS! Attend [with Didier Stevens in starting](https://isc.sans.edu/diary/rss/26726)\n\n\n-----\n\nTop of page\n√ó\n\n[Diary Archives](https://isc.sans.edu/diaryarchive.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-10-26 - Excel 4 Macros- -Abnormal Sheet Visibility-.pdf"
    ],
    "report_names": [
        "2020-10-26 - Excel 4 Macros- -Abnormal Sheet Visibility-.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535540,
    "ts_updated_at": 1743041150,
    "ts_creation_date": 1653767612,
    "ts_modification_date": 1653767612,
    "files": {
        "pdf": "https://archive.orkl.eu/49351f34f09402a2725a7901a1d8fda5f6162f9b.pdf",
        "text": "https://archive.orkl.eu/49351f34f09402a2725a7901a1d8fda5f6162f9b.txt",
        "img": "https://archive.orkl.eu/49351f34f09402a2725a7901a1d8fda5f6162f9b.jpg"
    }
}