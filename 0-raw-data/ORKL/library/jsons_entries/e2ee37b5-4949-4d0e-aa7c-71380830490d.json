{
    "id": "e2ee37b5-4949-4d0e-aa7c-71380830490d",
    "created_at": "2023-01-12T15:09:57.336681Z",
    "updated_at": "2025-03-27T02:05:29.393617Z",
    "deleted_at": null,
    "sha1_hash": "65982e7f263640466132e3dabe75c15e58f619dc",
    "title": "2021-06-08 - New large-scale campaign targets Kubeflow",
    "authors": "",
    "file_creation_date": "2022-05-29T01:26:23Z",
    "file_modification_date": "2022-05-29T01:26:23Z",
    "file_size": 552375,
    "plain_text": "# New large-scale campaign targets Kubeflow\n\n**[techcommunity.microsoft.com/t5/azure-security-center/new-large-scale-campaign-targets-kubeflow/ba-p/2425750](https://techcommunity.microsoft.com/t5/azure-security-center/new-large-scale-campaign-targets-kubeflow/ba-p/2425750)**\n\nJun 08 2021 04:29 AM\n\nYossi Weizman\n\nSenior Security Research Engineer, Cloud Security Research, ILDC\n\n\nJune 8, 2021\n\n\n[Last June, we reported on a cryptocurrency mining campaign that targeted Kubeflow workloads. Kubeflow is a popular](https://www.microsoft.com/security/blog/2020/06/10/misconfigured-kubeflow-workloads-are-a-security-risk/)\nframework for running machine learning (ML) tasks in Kubernetes, started as a project for running TensorFlow jobs on\nKubernetes.\n\nThe attack in the report abused exposed Kubeflow dashboards for deploying malicious containers. In that report, we\ndescribed how attackers might use the Kubeflow dashboard to deploy their malicious container via Jupyter notebooks.\n\nRecently, we discovered a new campaign that also targets Kubeflow deployments. Similarly, the attackers use exposed\nKubeflow interfaces for running cryptocurrency mining containers, with some changes from what we’ve previously seen:\n\nTowards the end of May, we observed a spike in deployments of TensorFlow pods on various Kubernetes clusters. The\n[pods ran legitimate TensorFlow images, from the official Docker Hub account. Looking at the entrypoint of the pods,](https://hub.docker.com/u/tensorflow)\nrevealed that they aim to mine cryptocurrency.\n\nThe burst of deployments on the various clusters was simultaneous. This indicates that the attackers scanned those\nclusters in advance and maintained a list of potential targets, which were later attacked on the same time.\n\nTwo different images were used: The first is the latest version of TensorFlow (tensorflow/tensorflow:latest) and the\nsecond is the latest version with GPU support (tensorflow/tensorflow:latest-gpu).\n\nThis is not the first time we see attackers use legitimate images for running their malicious code. Particularly in this case,\nthe existence of TensorFlow images in the cluster makes a lot of sense: It’s not uncommon to find TensorFlow containers\nin a ML workload. If the images in the cluster are monitored, usage of legitimate image can prevent attackers from being\ndiscovered. Also, the TensorFlow image that was used is a convenient method to run GPU tasks using CUDA, which\nallows the attacker to maximize the mining gains from the host.\n\n\n-----\n\nIn this attack, the attackers abused the access to the Kubeflow centralized dashboard in order to create a new pipeline.\n[Kubeflow Pipelines is a platform for deploying ML pipelines, based on Argo Workflow. Pipeline is a series of steps, each](https://www.kubeflow.org/docs/components/pipelines/overview/pipelines-overview/)\none of them is an independent container, and together they form a ML workflow. The image of the container that run in\neach step is determine in the pipeline configuration.\n\nIf attackers have access to the pipelines UI, they can create a new pipeline in the cluster. In this case, the containers run\nTensorFlow images which perform cryptocurrentcy mining tasks.\n\nThe names of the malicious pods are all with the same pattern:\n\n**“sequential-pipeline-{random pattern}”.**\n\nThis name is originated in the “generateName” field of the Argo Workflow object that is used for creating the pipeline.\n\nOn each cluster, at least two pods were deployed: one for CPU mining, and the other for GPU mining. Both containers\nused open-source miners from GitHub: Ethminer in case of the GPU container and XMRIG in case of the CPU one:\n\nAs part of the attacking flow, the attackers also deployed reconnaissance container that queries information about the\nenvironment such as GPU and CPU information, as preparation for the mining activity. This also ran from a TensorFlow\ncontainer.\n\nThe attack is still active, and new Kubernetes clusters that run Kubeflow get compromised.\n\n**What should I do?**\n\n\n-----\n\n1. If you run Kubeflow, make sure that the centralized dashboard isn t insecurely exposed to the Internet. If Kubeflow\n\n[should be exposed to the Internet, make sure you use authentication. For example, Kubeflow supports OIDC using](https://www.kubeflow.org/docs/distributions/azure/authentication-oidc/)\nAzure Active Directory for Azure deployments.\n2. For getting all the pods that are running in the cluster in JSON format, run:\n\n**_kubectl get pods --all-namespaces -o json_**\nSearch for containers that run TensorFlow images. If exist, inspect the entrypoint of those containers.\n\n**How Microsoft Defender for Kubernetes can help?**\n\nMicrosoft Defender for Kubernetes can detect exposure of Kubeflow deployments to the Internet. In addition, Microsoft\nDefender for Kubernetes detects execution of malicious containers, like in those that were used in this attack.\n\n**IoCs**\n\n**Description** **Type** **SHA256**\n\n\ntensorflow/tensorflow:latestgpu\n\n\nImage 0cb24474909c8ef0a3772c64a0fd1cf4e5ff2b806d39fd36abf716d6ea7eefb3\n\n\ntensorflow/tensorflow:latest Image 788c345613ff6cfe617b911dda22b1a900558c28c75afe6c05f8fa0d02bd9811\n\nEthminer Executable 274fabc7dea01750c5f0cbb659e10f15bcbf05f304d8e50f730ddfe54b7dd255\n\nXMRIG Executable 54b45e93cee8f08a97b86afa78a78bc070b6167dcc6cdc735bd167af076cb5b3\n\n\nsequential-pipeline-{random\npattern}\n\n\nPod name \n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-08 - New large-scale campaign targets Kubeflow.pdf"
    ],
    "report_names": [
        "2021-06-08 - New large-scale campaign targets Kubeflow.pdf"
    ],
    "threat_actors": [
        {
            "id": "f809bfcb-b200-4988-80a8-be78ef6a52ef",
            "created_at": "2023-01-06T13:46:39.186988Z",
            "updated_at": "2025-03-27T02:00:03.016358Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "Adept Libra"
            ],
            "source_name": "MISPGALAXY:TeamTNT",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c3ca592f-0669-49bd-ab5c-310007ab2fb4",
            "created_at": "2022-10-25T15:50:23.334495Z",
            "updated_at": "2025-03-27T02:00:55.445098Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "TeamTNT"
            ],
            "source_name": "MITRE:TeamTNT",
            "tools": [
                "Peirates",
                "MimiPenguin",
                "LaZagne",
                "Hildegard"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536197,
    "ts_updated_at": 1743041129,
    "ts_creation_date": 1653787583,
    "ts_modification_date": 1653787583,
    "files": {
        "pdf": "https://archive.orkl.eu/65982e7f263640466132e3dabe75c15e58f619dc.pdf",
        "text": "https://archive.orkl.eu/65982e7f263640466132e3dabe75c15e58f619dc.txt",
        "img": "https://archive.orkl.eu/65982e7f263640466132e3dabe75c15e58f619dc.jpg"
    }
}