{
    "id": "ac07b765-2a78-49b5-8356-d45314309ce3",
    "created_at": "2023-01-12T15:09:23.062065Z",
    "updated_at": "2025-03-27T02:06:05.60861Z",
    "deleted_at": null,
    "sha1_hash": "e2ea40c5cbcf4bc1479340301bef6eb59af7f80b",
    "title": "2016-12-15 - Goldeneye Ransomware – the Petya-Mischa combo rebranded",
    "authors": "",
    "file_creation_date": "2022-05-28T04:56:05Z",
    "file_modification_date": "2022-05-28T04:56:05Z",
    "file_size": 1021873,
    "plain_text": "# Goldeneye Ransomware – the Petya/Mischa combo rebranded\n\n**[blog.malwarebytes.com/threat-analysis/2016/12/goldeneye-ransomware-the-petyamischa-combo-rebranded/](https://blog.malwarebytes.com/threat-analysis/2016/12/goldeneye-ransomware-the-petyamischa-combo-rebranded/)**\n\nMalwarebytes Labs December 15, 2016\n\nFrom March 2016 we’ve observed the evolution of an interesting low-level ransomware,\n[Petya – you can read about it here. The](https://blog.malwarebytes.com/threat-analysis/2016/04/petya-ransomware/) [second version (green) Petya comes combined with](https://blog.malwarebytes.com/threat-analysis/2016/05/petya-and-mischa-ransomware-duet-p1/)\n[another ransomware, packed in the same dropper – Mischa. The latter one was deployed as](https://blog.malwarebytes.com/threat-analysis/2016/06/petya-and-mischa-ransomware-duet-p2/)\nan alternative payload: in case if the dropper was run without administrator privileges and\nthe low-level attack was impossible. This combo is slowly reaching its maturity – the authors\nfixed bugs that allowed for decryption of the two earliest versions. Now, we are facing an\noutbreak of the fourth version – this time under a new name – Goldeneye, and, appropriately,\na new, golden theme.\n\nIn this post we will take a look inside, in order to answer the question of whether or not any\ninternal changes followed the external alterations.\n\n## Analyzed sample\n\n[435076f9c8900cbdfc48a15713b1c431 – Goldeneye Decrypter (original)](https://malwr.com/analysis/MjNiODhmYmY0ZmU5NDUzOWIxZGRhMGM1YzllOTY1ZWE/share/8ea9ad053f8c4b988b7cc4645c1dec24)\n\n_// special thanks to_ _[@procrash](https://twitter.com/procrash)_\n\n## Distribution\n\n\n-----\n\nCurrently Goldeneye is distributed by phishing e-mails, in campaigns targeting Germany. The\nsame pattern of distribution was observed in first editions of Petya ransomware. Germany\n[seems to be an environment familiar to this ransomware author (who is probably a German](https://www.malwarebytes.com/ransomware)\nnative speaker) and his testing campaigns are always released in this country. However, the\nthreat will probably go global again, as the affiliate program for other criminals is going to be\nreleased soon.\n\n## Behavioural analysis\n\nAfter being run, the malware installs its copy in the %APPDATA% directory, under the name\nof a random application found in the system:\n\nThe installed copy is automatically executed and proceeds with malicious actions.\n\nIn the past, the dropper of Petya/Mischa used to trigger a UAC popup window. If the user\nhad agreed to run the sample as the Administrator, he/she was attacked by the low-level\npayload: Petya. Otherwise, the high-level Mischa was deployed.\n\nIn the current case the model of the attack is different and looks more like a case of Satana\nransomware.\n\nFirst, the high-level attack is deployed and the files are encrypted one by one. Then, the\nmalware tries to bypass UAC and elevate its privileges by its own, in order to make the\nsecond attack, this time at low-level: installing Petya at the beginning of the disk. The bypass\nworks silently if the UAC is set to default or lower. In cases where the UAC is set to max, the\nfollowing window pops up repeatedly, till the user accepts the elevation:\n\n\n-----\n\nThe used bypass techniques works on both – 32-bit and 64-bit – versions of Windows, up to\nWindows 8.1. On Windows 10, even if the UAC is set to default a popup is displayed – but\nnot revealing the real name of the infecting program, i.e.\n\n**The high-level part (former Mischa)**\n\nOn the first stage of the attack, files are being encrypted one by one. The malware drops the\nfollowing note in TXT format:\n\n\n-----\n\nFiles that are encrypted are added random extensions:\n\nIf we have two files with the same plaintext they turn into two different cipher-texts – that\nindicates that each file is encrypted with a new key or an initialization vector. The high\nentropy suggests AES in CBC mode.\n\nVisualization – original file vs encrypted one:\n\n**The low-level part (former Petya)**\n\nThe second stage of infection is deployed after encrypting the files. The behavior of second\npayload is no different than in the previous versions of Petya. After the malware is deployed,\nsystem crashes and starts with a fake CHKDSK. It pretends to be checking the disk for\n\n\n-----\n\nerrors, but in reality it performs Master File Table encryption, using Salsa20. After it is\ncompleted, we are facing a familiar blinking skull – this time in yellow/golden color:\n\nAfter pressing a key, we can see the screen with the ransom note:\n\n**Page for the victim**\n\n\n-----\n\nOn every edition all the pieces of the ransomware had a consistent theme. This time is no\ndifferent. The page for the victim, that is hosted on a Tor-based site comes in very similar\ntheme like the ransomware itself:\n\nAfter paying the ransom, the victim is provided with a key to decrypt the first (bootlocker)\nstage and a decrypter to recover the files:\n\n\n-----\n\nThe decrypter requires having a proper key in order to work:\n\n**Affiliate program**\n\n\n-----\n\nIn the past, Petya/Mischa combo was available as RaaS (Ransomware as a Service).\nFollowing the changes in the layout, the Twitter account associated with the criminal(s)\nbehind the malware, also changed the theme of the profile, and updated the information\nabout the affiliate program status:\n\nIt confirms that the actor behind Goldeneye as well as the methods of redistributing it didn’t\nchange.\n\n## Inside\n\nThis ransomware is very complex, having multiple pieces that have already been described\nin our previous articles. That’s why, in this one we will focus only on the differences\ncomparing to the previous editions. Let’s start from the core.dll, that is the PE file that we get\nafter unpacking the first layer.\n\n**The core.dll**\n\nJust like in the previous versions, the main application is a DLL (core.dll), packed by various\ncrypters and loaded by a technique known as Reflective Loader.\n\n\n-----\n\nIn the past Petya and Mischa were two separate modules delivered by this DLL. The dropper\nwas deciding which one of them to deploy, by making an attempt to run the sample with\nAdministrator privileges – no UAC bypass was used, only social engineering. Now, however,\nit comes with two DLLs that perform UAC bypass – one for 32 bit and another for 64 bit\nvariant of Windows. It decides which one to deploy, basing on the detected architecture.\n\nThe internal logic of this module changed a bit. There is no Mischa.dll separated. Instead,\nthe core.dll covers the functionality of encrypting files as well as of installing disk locker\nafterwards. The payloads are XOR encrypted and stored in the last section of the PE file\n(.xxxx):\n\nSection .xxxx contains:\n\nthe low level part (former Petya)\n32 bit DLL (elevate_x86.dll)\n64 bit DLL (elevate_x64.dll)\n\n\n-----\n\n(The two DLLs used to UAC bypass are based on the technique similar to the one described\n[here.)](http://www.rohitab.com/discuss/topic/40992-cc-uac-bypass/)\n\nAt first run, the core module makes its own copy into %APPDATA% and applies some tricks\nto blend into the environment:\n\nChoosing the application name at random, out of various applications in System folder\nChanging own timestamp to the timestamp of Kernel32.dll (the so called\n“timestomping” technique).\n\nAdding to its resources the resource of the genuine Microsoft application, under which\nname it is installed:\n\nResult:\n\n\n-----\n\n[Some of those tricks remind us of Cerber ransomware and they were probably inspired by it.](https://blog.malwarebytes.com/threat-analysis/2016/03/cerber-ransomware-new-but-mature/)\n\nThen, the dropper deploys the installed copy and proceeds with encryption.\n\n**The file cryptor (former Mischa)**\n\nThe file cryptor feature is now implemented inside the core.dll.\n\nIt behaves similarly to the former Mischa ransomware – the only difference is that now it is\nemployed before the low-level attack, rather than being an alternative.\n\nAttacked targets\n\nFiles are attacked with the following extensions:\n\n\n-----\n\n```\ndoc docx docm odt ods odp odf odc odm odb xlsm xlsb xlk xls xlsx \npps ppt pptm pptx pub epub pdf jpg jpegB rtf txt frm wdb ldf myi\nvmx xml xsl wps cmf vbs accdb cdr svg conf cfg config wb2 msg azw \nazw1 azw3 azw4 lit apnx mobi p12 p7b p7c pfx pem cer key der mdb \nhtm html class java cs asp aspx cgi h cpp php jsp bak dat pst eml \nxps sqllite sql js jar py wpd crt csv prf cnf indd number pagesN \npo dcu pas dfm directory pbk yml dtd rll cert p12 cat inf mui \nprops idl result localstorage ost default json db sqlite bat x3f \nsrw pef raf orf nrw nef mrw mef kdc dcr crw eip fff iiq k25 crwl \nbay sr2 ari srf arw cr2 raw rwl rw2 r3d 3fr ai eps pdd dng dxf dwg \npsd ps png jpe bmp gif tiff gfx jge tga jfif emf 3dm 3ds max obj \na2c ddspspimage yuv 3g2 3gp asf asx mpg mpeg avi mov flv wma wmv \nogg swf$ ptx ape aif wav ram ra m3u movie mp1 mp2 mp3 mp4 mp4v mpa \nmpe mpv2 rpf vlc m4a aac aa aa3 amr mkv dvd mts qt vob 3ga ts m4v \nrm srt aepx camproj dash zip rar gzip vmdk mdf iso bin cue dbf \nerf dmg toast vcd ccd disc nrg nri cdi\n\n```\nEncryption\n\nFiles are read in chunks, each is 1024 bytes long. Then, they are processed by the built-in\nimplementation of AES.\n\n\n-----\n\nThe easiest way to analyze the encryption algorithm used, is by reversing the original\ndecrypter, provided by the ransomware author to victims that paid the ransom. The decrypter\nis written in .NET and not obfuscated.\n\nLooking at the decrypter code we can confirm that each file is encrypted using AES in CBC\nmode. The AES key is 32 byte long, and it is the taken from the beginning of SHA512 hash\nof the password.\n\nThe initialisation vector is random for every file and it is stored in its content:\n\n\n-----\n\n**The disk locker (former Petya)**\n\nThis part of the Goldeneye ransomware is written at the disk beginning and is independent\nfrom the operating system. It is made up of a bootloader and a tiny, 16-bit kernel. At the very\nfirst sight we can suspect, that it is nothing more than a refactored Petya. That’s why, for the\nsimplicity I will refer this part as Petya Goldeneye.\n\n[Indeed, comparing the current edition with Petya 3 (described here) we can see, that the](https://blog.malwarebytes.com/threat-analysis/2016/07/third-time-unlucky-improved-petya-is-out/)\nencryption algorithm and the codebase hasn’t changed. Yet, we can spot some differences.\n\nEncryption\n\nAll versions of Petya use Salsa20 to encrypt MFT. In the current edition, the implementation\n[of Salsa20 is identical like in the former version.](https://blog.malwarebytes.com/threat-analysis/2016/07/third-time-unlucky-improved-petya-is-out/)\n\nSee the BinDiff screenshot below – Petya Goldeneye vs Petya 3:\n\nWe can safely assume, that just like in the previous case the Salsa20 has been implemented\ncorrectly – means, this edition of Petya is not decryptable by external tools.\n\nWhat has changed in the code?\n\n\n-----\n\nAlthough the main parts of the code didn t change, still we can notice that some refactoring\nhas taken place:\n\nThe most important changes are about the way in which the encryption/decryption is applied.\nThe author added more checks and simplified the decryption function. Yet, the changes are\nrather about improving the code quality rather than introducing some new ideas.\n\nLayout\n\nJust like in the previous cases, Petya’s code is written at the beginning of the disk – however,\nnow the layout is more compact. The code of Petya’s kernel starts just after MBR, without\nany padding. Due to this, other important sectors are also shifted. For example, the data\nsector, where the random salsa key is saved*, is now placed in sector 32:\n\n_* just like in all previous editions, this key is erased after use. Read more about the full_\n_[procedure here.](https://blog.malwarebytes.com/threat-analysis/2016/04/petya-ransomware/)_\n\nSumming up, all the sectors are shifted towards the beginning of the disk.\n\nData sector:\n\nPetya3: 54\nPetya Goldeneye: 32\n\nVerification sector:\n\nPetya3: 55\nPetya Goldeneye: 33\n\nOriginal MBR (xored with 7)\n\nPetya3: 56\n\n\n-----\n\nPetya Goldeneye: 34\n\n## Conclusion\n\nGoldeneye ransomware is yet another step in the development of the Petya/Mischa bundle.\nThe redesigned dropper coupled both elements together in a new way, that makes it even\nmore dangerous. At the current stage the product doesn’t seem decryptable by external\ntools. We strongly advise to be very vigilant about opening e-mail attachments, because this\nis still the main way of distribution of this ransomware.\n\n_During the tests, Malwarebytes has proven to protect against the malicious payloads_\n_attached to Goldeneye phishing e-mails:_\n\n_This was a guest post written by Hasherezade, an independent researcher and programmer_\n_with a strong interest in InfoSec. She loves going in details about malware and sharing threat_\n_[information with the community. Check her out on Twitter @hasherezade and her personal](https://twitter.com/hasherezade)_\n_[blog: https://hshrzd.wordpress.com.](https://hshrzd.wordpress.com/)_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-12-15 - Goldeneye Ransomware – the Petya-Mischa combo rebranded.pdf"
    ],
    "report_names": [
        "2016-12-15 - Goldeneye Ransomware – the Petya-Mischa combo rebranded.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536163,
    "ts_updated_at": 1743041165,
    "ts_creation_date": 1653713765,
    "ts_modification_date": 1653713765,
    "files": {
        "pdf": "https://archive.orkl.eu/e2ea40c5cbcf4bc1479340301bef6eb59af7f80b.pdf",
        "text": "https://archive.orkl.eu/e2ea40c5cbcf4bc1479340301bef6eb59af7f80b.txt",
        "img": "https://archive.orkl.eu/e2ea40c5cbcf4bc1479340301bef6eb59af7f80b.jpg"
    }
}