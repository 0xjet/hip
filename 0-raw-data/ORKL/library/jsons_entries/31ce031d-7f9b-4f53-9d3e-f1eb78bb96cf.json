{
    "id": "31ce031d-7f9b-4f53-9d3e-f1eb78bb96cf",
    "created_at": "2022-10-25T16:48:19.639553Z",
    "updated_at": "2025-03-27T02:16:26.430183Z",
    "deleted_at": null,
    "sha1_hash": "ae511e37067348208579e7fcf8da0389626b2044",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-03-14T14:52:45Z",
    "file_modification_date": "2020-03-14T14:52:45Z",
    "file_size": 3457664,
    "plain_text": "[About TrendLabs Security Intelligence Blog](https://blog.trendmicro.com/trendlabs-security-intelligence/about-us/)\n\nSearch:\n\nGo to‚Ä¶\n\n[Home](http://blog.trendmicro.com/trendlabs-security-intelligence/)\nCategories\n\n[Home  ¬ª  Malware  ¬ª  Dissecting Geost: Exposing the Anatomy of the Android Trojan Targeting Russian Banks](https://blog.trendmicro.com/trendlabs-security-intelligence/)\n\n# Dissecting Geost: Exposing the Anatomy of the Android Trojan Targeting Russian Banks\n\n[Posted on:March 5, 2020 at 3:58 am](https://blog.trendmicro.com/trendlabs-security-intelligence/2020/03/)\n[Posted in:Malware, Mobile](https://blog.trendmicro.com/trendlabs-security-intelligence/category/malware/)\nAuthor:\n[Vit Sembera (Threats Analyst)](https://blog.trendmicro.com/trendlabs-security-intelligence/author/vits/)\n\n0\n\nThe Android banking trojan Geost was first revealed in a research by Sebastian Garc√≠a, Maria Jose Erquiaga and Anna Shirokova from the [Stratosphere Laboratory.](https://www.stratosphereips.org/)\nThey detected the trojan by monitoring HtBot malicious proxy network. The botnet targets Russian banks, with the victim count at over 800,000 users at the time the\nstudy was published in Virus Bulletin last year.\n\nThe research disclosed the types of information that Geost (detected by Trend Micro as AndroidOS_Fobus.AXM) steals from victims, as well as the activities of the\ngroup behind the botnet, including operational tactics and internal communication between masters and botnet coders.\n\nBuilding upon this interesting finding, we decided to dig deeper into the behavior of Geost by reverse engineering a sample of the malware. The trojan employed\nseveral layers of obfuscation, encryption, reflection, and injection of non-functional code segments that made it more difficult to reverse engineer. To study the code\nand analyze the algorithms, we had to create Python scripts to decrypt strings first.\n\n### Initial Analysis\n\nGeost hides in malicious apps that are distributed via unofficial web pages with randomly generated server hostnames. The victims usually encounter these as they\nlook for apps that are not available on Google Play, or when they don‚Äôt have access to the app store. They then find a link to that application on some obscure web\nserver, download the app, then launch it on their phones. The app will then request for permissions that, when the victims allow, enables malware infection.\n\nThe Geost sample we analyzed resided in the malicious app named ‚Äú—É—Å—Ç–∞–Ω–æ–≤–∫–∞‚Äù in Russian, which means ‚Äúsetting‚Äù in English. The app showed a version of the\nGoogle Play logo as its own icon, which did not appear on the phone screen after launch.\n\n_Figure 1. Application icon of the malicious app —É—Å—Ç–∞–Ω–æ–≤–∫–∞_\n\nWhen the app was launched, it requested device administrator privileges. This was unusual since legitimate apps don‚Äôt often ask for this, as it basically gives an app\ncomplete rights over a device.\n\nImportant permissions that the user might unknowingly allow include those for accessing SMS messages, including confirmation messages from banking apps. These\nmessages allow the malware to harvest the victims‚Äô names, balances, and other bank account details. With just a few clicks, attackers can then transfer money from\nthe bank accounts of unaware victims.\n\n\nGo to‚Ä¶\n\n\n-----\n\nFigure 2: Screen that requests device admin permission\n\nFigure 3: Application permissions requested\n\nAfter confirming necessary permissions, the visible part of the app will close and the app icon disappears, making victims think that the app was deleted. The sample\ndevice did not show any alarming signs of malicious activity at first, but the malware is working in the background and the attackers just gained access to the device,\nallowing them to monitor sent and received messages, including SMS confirmation messages from banking apps.\n\nTo maintain persistence across reboots, it registers for BOOT_COMPLETED and QUICKBOOT_POWERON broadcasts.\n\n\n-----\n\n### Stage One\n\nLike many malware types, Geost‚Äôs run-time life is split into stages. The first stage is small and simple, which will then download and/or decrypt and run the next\nstage, which is more complex.\n\nThe Geost sample‚Äôs APK housed compiled Java code in classes.dex file. It also contained AndroidManifest.xml and resource files, which are usual contents of APK\nfiles. It also had a ‚Äú.cache‚Äù file with a size of 125k.\n\nTo decompile the extracted classes.dex file, several Java decompilers, namely dex2jar, jadx, jd-core/jd-gui and Ghidra, were all used, as no single decompiler was\nable to decompile all the Smali code.\n\nFigure 5: Decompiled Java source code\n\nAt first glance, the decompiled code seemed to be partially encoded in a series of strings; however, character frequency analysis showed random character usage.\n\nFurther analysis revealed that the malware contained additional pieces of code that have no impact on the app‚Äôs behavior except to slow down its execution. It made\nreverse engineering more difficult because the malware split useful code into parts and frequently changed execution paths. Which branch was taken was usually\ndependent on some variable with an unknown value. The same is applied with ‚Äúswitch‚Äù, ‚Äúif‚Äù, and ‚Äútry/catch‚Äù command blocks. Functions without meaningful code\nwere inserted to make overall understanding of the malware actions harder.\n\nFigure 6: Example of code with case switch\n\nThe non-functional code segments were gradually removed and the first decryption algorithm used was identified. All strings in stage one were encrypted through\nRC4, using an algorithm that was split into several functions to avoid indication that it used RC4. After this, the next step was to find the key for RC4 decryption.\n\n\n-----\n\nFigure 7: Decompiled Java source, which is part of the RC4 algorithm\n\nFigure 8: Part of cleaned up RC4 code\n\nFigure 9: RC4 key\n\nRC4 is a stream cipher, with an internal state that changes with every decrypted symbol. To decrypt several encrypted strings, usually the decryption must be\nperformed in the very same order the encryption used. Fortunately, this was not the case with the sample. The code authors simplified RC4 without keeping internal\nstate between decryptions, as the RC4 encryption code always copied state array S[].\n\nFigure 10: RC4 encryption always copied state array S[]\n\nAfterwards, the search for common code libraries began. Android.support.v4 libraries and ReflectASM Java Reflection libraries were found.\n\nFigure 11: Code with encrypted strings\n\n\n-----\n\nAt this point, the stage one code became understandable: It uses reflection code to hide interesting classes and methods from curious eyes. Basically, the first stage\ndecrypted the second stage file with the same RC4 algorithm and key.\n\nFigure 13: Example of reflection method invocation\n\nThe aforementioned ‚Äú.cache‚Äù file is renamed to .localsinfotimestamp1494987116 and saved after decryption as ydxwlab.jar, from which the .dex file is loaded and\nlaunched.\n\nFigure 14: Decrypting and saving second stage\n\nCode authors inserted a false flag, HttpURLConnection and its URL, which seemed to connect to the Command and Control (C&C) server. But this http open\nconnection is never executed.\n\nFigure 15: False flag\n\nStage one loads a class from the second stage, which the researcher named ‚ÄúMaliciousClass‚Äù.\n\nFigure 16: Launching the second stage\n\n### Stage Two\n\nLooking at the classes.dex, it‚Äôs clear that obfuscation and encryption were used again in stage two. But this time, the symbol names were partially replaced by strings\n1-2 characters long instead of the previous 6-12 character strings. Also, the string encryption algorithm is modified, making it different from the algorithm used in the\nprevious stage. Different tools were used. Additionally, parameters of the decryption algorithm were modified separately for each class.\n\nAll Java decompilers had problems decompiling the decryption algorithm due to goto command jumping into the if block. Only Jeb decompiler handled this\nconstruction well.\n\n\n-----\n\nFigure 17: Smali code of decryption algorithm\n\nFigure 18: Java code of decryption algorithm\n\nEach class decryption method contained different parameter orders and different constants; writing the Python decryption script was made more difficult. It meant\neither the decryption script must detect the algorithm setup from the Smali code and adapt itself, or the parameters must be manually set up within the script before\ndecryption for each class.\n\nFigure 19: Example of an encrypted string\n\nAfter string decryption, libraries used could be detected. These include:\n\nAES encryption engine\nBase64 encoding\nEmulator detector\nFile download service\nIExtendedNetworkService\nUSSD api library\nZip4jUtil\n\n### Initialization phase\n\nThe aforementioned MaliciousClass invoked from the first stage serves as an envelope for the instantiated class the researcher named ‚ÄúContext.‚Äù\n\nFigure 20: Context Class\n\nThe Context class launches the EmulatorDetector service first. It then starts two other services: AdminService and LPService, followed by the main application\nIntent.\n\n\n-----\n\nFigure 21: Main initialization routine\n\n_Emulator Detector_\n\nThe emulator detector checks for signs that it‚Äôs running in an emulated environment. The sample detected the existence of Nox, Andy, Geny, Bluestacks and Qemu\nAndroid emulators.\n\nFigure 22: Emulated enviroment traces\n\n_AdminService_\n\nThis service is responsible for granting admin permission to the application. This is a critical part since it enables access to sensitive data and can launch privileged\nactions.\n\nFigure 23: Critical part of AdminService\n\n_LPService_\n\nThis service was responsible for keeping the application running and connected to the C&C server. It used WakeLock and WifiLock acquire() calls to reach this state.\nA side effect to this is high battery drain, which most victims usually ignore.\n\n\n-----\n\nFigure 24: Locking to CPU and WiFi resources\n\nLPService then creates LPServiceRunnable Thread, which wakes up every five seconds and is responsible for monitoring and relaunching these services:\n\nMainService\nAdminService\nSmsKitkatService\n\nThis service also collects information about running processes and tasks. It also periodically starts WebViewActivity, which can open browser window to arbitrary\nURLs or launch malicious code. WebViewActivity code was not implemented in this sample.\n\n_MainService_\n\nThe MainService first hooks to AlarmManager for time scheduling tasks, then registers two broadcast receivers, MainServiceReceiver1 and MainServiceReceiver2.\nAt the end of the initialization phase, it will launch MainServiceRunnable Thread. When the sample executes overloaded onDestroy() method, it restarts the\nMainService again.\n\nFigure 25: Overloaded onDestroy to restart MainService\n\nAn important method of MainService is processApiResponse(), which processes commands formatted as JSON string received from C&C server.\n\nFigure 26: Processing C&C server commands\n\n_ClearService_\n\nThis service invokes the ClearServiceRunnable thread, which takes care of locking/unlocking commands (blocking/unblocking user activity) so the botnet operator\ncan perform remote tasks without user intervention. The ClearService also relaunches itself if there is an attempt to terminate it.\n\nFigure 27: ClearService class\n\n\n-----\n\nFigure 28: ClearServiceRunnable\n\n_SmsKitkatService_\n\nThis service was prepared to replace the standard SMS messaging application with a different one written by the attackers. In this version, it used a default one.\n\nFigure 29: Code for replacement of\ndefault SMS application\n\n### Commands\n\nThe list of commands that this malware recognized can be seen in the table and screenshot below (organized by the order they were defined in the code):\n\n**Commands** **Description**\n\n\n#conversations\n\n#contacts\n\n#calls\n\n\nCollects the address, body, date, and type columns\nfrom all SMS messages from\ncontent://sms/conversations/, content://sms/inbox\nand content://sms/sent, and sends to the C&C\nserver\n\nCollects a list of all contacts from\ncontent://com.android.contacts/data/phones and\nsends to the C&C server\n\nCollects all calls performed from\ncontent://call_log/calls and sends to the C&C\nserver\n\n\nCollects list of installed package names and labels\n#apps\nand sends to C&C server\n#bhist This command is ignored in this sample\n\nSets time period for fetching C&C server\n#interval {set:number}\ncommands\n\nSets the phone numbers from which to intercept\n#intercept\nSMS (‚Äúall‚Äù or a list of numbers)\n#send id:, to:, body: Sends SMS\n#ussd {to:address, tel:number} Calls a number via USSD framework\n#send_contacts Sends SMS to all contacts in phonebook\n#server Sets scheduled time to run\n# h k { h i } S d li f i C&C\n\n\n-----\n\nhxxp://fwg23tt23qwef.ru/\n#send_mass {messages: {to:address, Sends multiple SMS messages to different\nbody:text}, delay:ms} addresses, with a delay between sends\n\n\n#lock\n\n\nStarts RLA service from ClearServiceRunnable,\nwhich intercepts events from key press\nAKEYCODE_HOME, AKEYCODE_CAMERA,\nand AKEYCODE_FOCUS. It also intercepts\nonBackPressed() Activity method, mutes ringer,\nclears all SMS notifications, stops itself, and makes\nthe phone unresponsive\n\n\nDisables actions listed under #lock command and\n#unlock\nunlocks phone by stopping ClearServiceRunnable\n\nCalls a number using standard\n#makecall {number:tel_number}\nandroid.intent.action.CALL API\n#openurl {filesDir=j:url} Opens a webpage URL\n\nHooks to a number ‚Äì it forwards all incoming SMS\n#hooksms {number:tel_number}\nmessages to a number in the parameter\n\nSets task time to unparsable string value, which\n#selfdelete\nstops its self-scheduling tasks\n\nFigure 30: List of C&C SERVER commands\n\n### ApiRequest, ApiResponse, ApiInterfaceImpl\n\nThe ApiRequest, ApiResponse, and ApiInterfaceImpl classes enable communication with the C&C server. In the connection parameters initialization, the value of\nreplaceWithRandomStr variable was set to true by default and is not changed within the code.\n\n\n-----\n\nFigure 31: Building C&C server connection string\n\nFigure 32: Connection parameters initialization\n\nAn algorithm was used to generate a random string for the C&C server URL. The API connection was then initialized, and the hostname of the C&C server was set\nup.\n\nFigure 33: Building random string for the C&C server URL\n\nFigure 34: API connection initialization\n\nFigure 35: Setting up C&C server hostname\n\nAn example of C&C server API usage was shown as the C&C server command ‚Äú#contacts‚Äú was implemented. Finally, parameters for commands are appended as\nJSON format and converted to string.\n\nFigure 36: Example of C&C server API calling\n\n### Best Practices and Trend Micro Solutions\n\nIn its [2020 Security Predictions, Trend Micro predicted the continued proliferation of mobile malware families, such as Geost, that target online banking and payment](https://www.trendmicro.com/vinfo/us/security/research-and-analysis/predictions/2020)\nsystems. Mobile users should safeguard themselves as they navigate the treacherous mobile landscape by following [best practices for securing mobile devices. One](https://www.trendmicro.com/vinfo/us/security/news/mobile-safety/best-practices-securing-your-mobile-device/)\nsuch step is to avoid downloading apps outside official app stores.\n\nU f l h l fi d d li i i l i i Al i h h i d i f h\n\n\n-----\n\nshould also conduct regular audits to remove unused apps.\n\nFor additional defense against mobile threats, users can install a multilayered mobile security solution such as [Trend Micro‚Ñ¢ Mobile Security to protect devices from](https://www.trendmicro.com/us/home/products/mobile-solutions/android-security/#compare-versions)\nmalicious applications and other mobile threats.\n\n### Indicator of Compromise\n\n**SHA 256** **Detection Name**\n92394e82d9cf5de5cb9c7ac072e774496bd1c7e2944683837d30b188804c1\nAndroidOS_Fobus.AXM\n810\n\n## Related Posts:\n\n**[New Version of XLoader That Disguises as Android Apps and an iOS Profile Holds New Links to FakeSpy](https://blog.trendmicro.com/trendlabs-security-intelligence/new-version-of-xloader-that-disguises-as-android-apps-and-an-ios-profile-holds-new-links-to-fakespy/)**\n**[Anubis Android Malware Returns with Over 17,000 Samples](https://blog.trendmicro.com/trendlabs-security-intelligence/anubis-android-malware-returns-with-over-17000-samples/)**\n**[Malicious Optimizer and Utility Android Apps on Google Play Communicate with Trojans that Install Malware, Perform Mobile Ad Fraud](https://blog.trendmicro.com/trendlabs-security-intelligence/malicious-apps-on-google-play-communicate-with-trojans-install-malware-perform-mobile-ad-fraud/)**\n**[Mac Malware that Spoofs Trading App Steals User Information, Uploads it to Website](https://blog.trendmicro.com/trendlabs-security-intelligence/mac-malware-that-spoofs-trading-app-steals-user-information-uploads-it-to-website/)**\n\n\nLearn how to protect Enterprises, Small Businesses, and Home Users from ransomware:\n\n[ENTERPRISE](http://www.trendmicro.com/us/security-intelligence/enterprise-ransomware/index.html) ¬ª [SMALL BUSINESS](http://www.trendmicro.com/us/security-intelligence/small-business-ransomware/index.html) ¬ª [HOME](http://www.trendmicro.com/us/home/consumer-ransomware/index.html) ¬ª\n\n\nTags: [androidGeostMalwareRussianTrojan](https://blog.trendmicro.com/trendlabs-security-intelligence/tag/android/)\n\n**0 Comments** **[TrendLabs](https://disqus.com/home/forums/trendlabs/)** [üîí Privacy Policy](https://help.disqus.com/customer/portal/articles/466259-privacy-policy) [ÓòÉ1](https://disqus.com/home/inbox/) **Login**\n\n\nÔÑà Recommend\n\n\nt Tweet f Share **Sort by Best**\n\n\n### Start the discussion‚Ä¶\n\n\n**LOG IN WITH** **OR SIGN UP WITH DISQUS**\n\n\nName\n\n\nBe the first to comment.\n\n‚úâ **Subscribe** d **[Add Disqus to your siteAdd DisqusAdd](https://disqus.com/)**\n\n‚ö† **D** **[N t S ll M D t](https://disqus.com/data-sharing-settings/)**\n\n### Security Predictions for 2020\n\nCybersecurity in 2020 will be viewed through many lenses ‚Äî from differing attacker motivations and cybercriminal arsenal to technological developments and\nglobal threat intelligence ‚Äî only so defenders can keep up with the broad range of threats.\n[Read our security predictions for 2020.](https://www.trendmicro.com/vinfo/us/security/research-and-analysis/predictions/2020)\n\n### Business Process Compromise\n\nAttackers are starting to invest in long-term operations that target specific processes enterprises rely on. They scout for vulnerable practices, susceptible\nsystems and operational loopholes that they can leverage or abuse. To learn more, [read our Security 101: Business Process Compromise.](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/security-101-business-process-compromise)\n\n### Recent Posts\n\n\n-----\n\n[Dissecting Geost: Exposing the Anatomy of the Android Trojan Targeting Russian Banks](https://blog.trendmicro.com/trendlabs-security-intelligence/dissecting-geost-exposing-the-anatomy-of-the-android-trojan-targeting-russian-banks/)\n\n### Popular Posts\n\n[LokiBot Impersonates Popular Game Launcher and Drops Compiled C# Code File](https://blog.trendmicro.com/trendlabs-security-intelligence/lokibot-impersonates-popular-game-launcher-and-drops-compiled-c-code-file/)\n\n[Misconfigured Container Abused to Deliver Cryptocurrency-mining Malware](https://blog.trendmicro.com/trendlabs-security-intelligence/misconfigured-container-abused-to-deliver-cryptocurrency-mining-malware/)\n\n[Dissecting Geost: Exposing the Anatomy of the Android Trojan Targeting Russian Banks](https://blog.trendmicro.com/trendlabs-security-intelligence/dissecting-geost-exposing-the-anatomy-of-the-android-trojan-targeting-russian-banks/)\n\n[February Patch Tuesday: Fixes for Critical LNK, RDP, Trident Vulnerabilities](https://blog.trendmicro.com/trendlabs-security-intelligence/february-patch-tuesday-fixes-for-critical-lnk-rdp-trident-vulnerabilities/)\n\n[Outlaw Updates Kit to Kill Older Miner Versions, Targets More Systems](https://blog.trendmicro.com/trendlabs-security-intelligence/outlaw-updates-kit-to-kill-older-miner-versions-targets-more-systems/)\n\n### Stay Updated\n\nEmail Subscription\n\n\nYour email here\n\n\n[Home and Home Office](http://www.trendmicro.com/us/home/index.html)\n|\n[For Business](http://www.trendmicro.com/us/business/index.html)\n|\n[Security Intelligence](http://www.trendmicro.com/us/security-intelligence/index.html)\n|\n[About Trend Micro](http://www.trendmicro.com/us/about-us/index.html)\n\n[Asia Pacific Region (APAC): Australia /](http://www.trendmicro.com.au/au/home/index.html) [New Zealand, ‰∏≠ÂõΩ, ‚ΩáÊú¨, ÎåÄÌïúÎØºÍµ≠, Âè∞ÁÅ£](http://www.trendmicro.co.nz/nz/home/index.html)\nLatin America Region (LAR): [Brasil, M√©xico](http://br.trendmicro.com/br/home/index.html)\nNorth America Region (NABU): [United States, Canada](http://www.trendmicro.com/us/index.html)\nEurope, Middle East, & Africa Region (EMEA): [France, Deutschland / √ñsterreich / Schweiz, Italia, –†–æ—Å—Å–∏—è, Espa√±a, United Kingdom / Ireland](http://www.trendmicro.fr/)\n\n[Privacy Statement](http://www.trendmicro.com/us/about-us/legal-policies/privacy-statement/index.html)\n[Legal Policies](http://www.trendmicro.com/us/about-us/legal-policies/index.html)\n\nCopyright ¬© 2020 Trend Micro Incorporated. All rights reserved.\n\n\nYour email here\n\nSubscribe\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.03.05_Dissecting_Geost/Dissecting%20Geost_%20Exposing%20the%20Anatomy%20of%20the%20Android%20Trojan%20Targeting%20Russian%20Banks%20-%20TrendLabs%20Security%20Intelligence%20Blog.pdf"
    ],
    "report_names": [
        "Dissecting Geost_ Exposing the Anatomy of the Android Trojan Targeting Russian Banks - TrendLabs Security Intelligence Blog"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1584197565,
    "ts_modification_date": 1584197565,
    "files": {
        "pdf": "https://archive.orkl.eu/ae511e37067348208579e7fcf8da0389626b2044.pdf",
        "text": "https://archive.orkl.eu/ae511e37067348208579e7fcf8da0389626b2044.txt",
        "img": "https://archive.orkl.eu/ae511e37067348208579e7fcf8da0389626b2044.jpg"
    }
}