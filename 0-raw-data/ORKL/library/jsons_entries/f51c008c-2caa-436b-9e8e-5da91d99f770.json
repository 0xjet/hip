{
    "id": "f51c008c-2caa-436b-9e8e-5da91d99f770",
    "created_at": "2022-10-25T16:48:11.826829Z",
    "updated_at": "2025-03-27T02:05:48.418886Z",
    "deleted_at": null,
    "sha1_hash": "e33f1fbc1d290de7393db9c38c9b646362a17ce0",
    "title": "",
    "authors": "",
    "file_creation_date": "2014-12-31T11:51:38Z",
    "file_modification_date": "2014-12-31T11:51:38Z",
    "file_size": 7690343,
    "plain_text": "## SS7: Locate. Track. Manipulate.\n\n###### You have a remote-controlled tracking device in your pocket\n\n Tobias Engel <tobias@ccc.de>\n @2b_as\n\n\n-----\n\n###### SS7: Locate Track Manipulate 2\n\n\n###### SS7: Locate Track Manipulate 2\n\n\n-----\n\n##### Signalling System #7\n\n###### Protocol suite used by most telecommunications network operators throughout\n\n### •\n###### the world to talk to each other\n Standardized in the 1980s in ITU-T Q.700 series\n\n### •\n###### When it was designed, there were only few telecoms operators, and they were\n\n### •\n###### either state controlled or really big corporations\n “Walled Garden” approach: trusted each other, so no authentication built in\n\n### •\n\n###### SS7: Locate Track Manipulate\n\n\n###### 3\n\n\n-----\n\n##### Signalling System #7 today\n\n###### New protocols added in the 1990s and 2000s by ETSI and 3GPP to support\n\n### •\n###### mobile phones and the services they need (roaming, SMS, data...)\n Mobile Application Part (MAP)\n\n### •\n###### Contains everything mobile phones need that is not call signalling\n### ‣\n###### CAMEL Application Part (CAP)\n\n### •\n###### New protocol that allows the network operator to build custom services that\n### ‣\n###### are not possible with MAP\n still no authentication for any of this\n\n### •\n\n###### SS7: Locate Track Manipulate\n\n\n###### 4\n\n\n-----\n\n##### Signalling System #7 today\n\n###### Getting access is easier than ever\n\n### •\n###### Can be bought from telcos or roaming hubs for a few hundred euros a month\n### ‣\n###### Usually (not always), roaming agreements with other networks are needed,\n### ‣\n###### but some telcos are reselling their roaming agreements\n Some network operators leave their equipment unsecured on the internet\n### ‣\n###### Femtocells are part of the core network and have been shown to be hackable\n### ‣\n\n###### SS7: Locate Track Manipulate\n\n\n###### 5\n\n\n-----\n\n##### SS7 Procotol Stack\n\n\n###### This talk\n Mobile Application Part: specifies additional signalling that is\n ISDN User Part: CAP MAP required for mobile phones (roaming,\n Call Control SMS, etc.)\n\n\n###### required for mobile phones (roaming,\n\n\n###### specifies additional signalling that is\n\n\n###### Mobile Application Part:\n\n\n###### ISDN User Part:\n\n\n###### Call Control\n\n\n###### TCAP\n\n\n###### ISUP\n\n\n###### CAP\n\n\n###### Signalling Connection Control Part:\n network layer protocol, contains source and destination addresses for\n MAP messages\n\n\n###### Signalling Connection Control Part:\n\n\n###### source and destination addresses for\n\n\n###### MTP Level 3\n\n\n###### SCCP\n\n\n###### MAP\n\n\n###### MTP Level 2\n\n\n###### network layer protocol, contains\n\n\n###### SMS, etc.)\n\n\n###### M2UA\n\n\n###### MAP messages\n\n\n###### MTP Level 2\n\n\n###### M2UA\n\n\n###### SCTP\n\n\n###### SCTP\n\n\n###### MTP Level 1\n\n\n###### IP\n\n\n###### SS7 transport over IP\n\n\n###### MTP Level 1\n\n\n###### IP\n\n\n###### Ethernet\n\n\n###### SIGTRAN (example):\n\n\n###### SS7: Locate Track Manipulate\n\n\n###### Ethernet\n\n\n###### 6\n\n\n-----\n\n##### Network overview\n\n###### MSC/\n SMSC\n SMSC VLR\n\n SS7 SS7\n SS7 interconnect\n\n HLR\n HLR\n\n Core Network Core Network\n\n This talk\n\n SS7: Locate Track Manipulate\n\n\n###### SMSC\n\n\n###### MSC/\n VLR\n\n\n###### MSC/\n VLR\n\n\n###### BSC/\n RNC\n\n\n###### HLR\n\n\n###### Basestation Subsystem\n\n\n###### Core Network\n\n\n###### Carrier A\n\n\n###### 7\n\n\n###### SMSC\n\n\n###### MSC/\n VLR\n\n\n###### HLR\n\n\n-----\n\n##### Network overview\n\n###### MSC/\n SMSC\n SMSC VLR\n\n SS7 SS7\n SS7 interconnect\n\n HLR\n HLR\n\n Core Network Core Network\n\n SS7: Locate Track Manipulate\n\n\n###### SMSC\n\n\n###### MSC/\n VLR\n\n\n###### MSC/\n VLR\n\n\n###### BSC/\n RNC\n\n\n###### HLR\n\n\n###### on a subscriber:\n\n\n###### Basestation Subsystem\n\n\n###### Core Network\n\n\n###### Carrier A\n\n\n###### 8\n\n\n###### SMSC\n\n\n###### MSC/\n VLR\n\n\n###### HLR\n\n\n-----\n\n##### Network overview\n\n###### MSC/\n SMSC\n SMSC VLR\n\n SS7 SS7\n SS7 interconnect\n\n •\n HLR\n HLR\n\n •\n Core Network Core Network\n\n •\n •\n SS7: Locate Track Manipulate\n\n\n###### SMSC\n\n\n###### MSC/\n VLR\n\n\n###### MSC/\n VLR\n\n\n###### BSC/\n RNC\n\n\n###### HLR\n\n\n###### on a subscriber:\n\n\n###### Basestation Subsystem\n\n\n###### Core Network\n\n\n###### Carrier A\n\n\n###### 9\n\n\n###### SMSC\n\n\n###### MSC/\n VLR\n\n\n\n###### •\n HLR\n\n\n-----\n\n##### Network overview\n\n###### +13123149810\n\n MSC/\n SMSC\n SMSC VLR\n\n +491710760000\n\n SS7 SS7\n SS7 interconnect\n\n HLR\n HLR\n\n +12404494085\n +491700960314\n Core Network Core Network\n\n Adressing by Global Title (looks\n like an international phone\n number)\n\n SS7: Locate Track Manipulate\n\n\n###### Adressing by Global Title (looks\n like an international phone\n number)\n\n\n###### SMSC\n\n\n###### MSC/\n VLR\n\n\n###### MSC/\n VLR\n\n\n###### BSC/\n RNC\n\n\n###### HLR\n\n\n###### Basestation Subsystem\n\n\n###### Core Network\n\n\n###### Carrier A\n\n\n###### 10\n\n\n###### SMSC\n\n\n###### MSC/\n VLR\n\n\n###### HLR\n\n\n-----\n\n##### Cell-Level Tracking\n\n###### The network needs to know which base station (“cell”) is\n\n### •\n###### closest to the subscriber to deliver calls, SMS...\n If you can find out the ID of that cell, it’s geographical position\n\n### •\n###### can be looked up in one of several databases\n The location of the cell tower is also a good approximation of\n\n### •\n###### the subscriber’s location\n In cities, cell towers are so close that subscriber tracking down\n\n### •\n###### to street level is possible\n\n SS7: Locate Track Manipulate\n\n\n###### 11\n\n\n-----\n\n##### Commercial Tracking Providers\n\n###### Several commercial providers offer cell-level tracking as service, claim\n\n### •\n###### coverage of about 70% of worldwide mobile subscribers (with some restrictions...)\n Only the MSISDN (phone number) is required to locate a subscriber\n\n### •\n\n###### SS7: Locate Track Manipulate\n\n\n###### 12\n\n\n-----\n\n##### Cell Level Tracking with SS7/MAP\n\n###### MAP’s anyTimeInterrogation (ATI) service can query the subscriber’s HLR for\n\n### •\n###### her Cell-Id and IMEI (phone serial number, can be used to look up phone type)\n\n Home Visited network network\n\n MSC/ HLR\n VLR\n\n anyTimeInterrogation\n req provideSubscriberInfo\n Paging Request req\n\n provideSubscriberInfo Paging Response\n resp\n anyTimeInterrogation\n resp\n\n SS7: Locate Track Manipulate\n\n\n###### HLR\n\n\n###### network\n\n\n###### 13\n\n\n###### MSC/\n VLR\n\n\n###### Visited network\n\n\n###### Home\n\n\n-----\n\n##### Cell Level Tracking with SS7/MAP\n\n###### Only meant as a network-internal service (e.g. to implement “home zones”).\n\n### •\n###### External networks should not be able to invoke it\n but still...\n\n### •\n\n\n###### 14\n\n\n###### SS7: Locate Track Manipulate\n\n\n-----\n\n##### Cell Level Tracking with SS7/MAP\n\n###### Many networks actually block ATI by now\n\n### •\n\n###### Home Visited network network\n\n MSC/ HLR\n VLR\n\n anyTimeInterrogation\n req\n\n returnError ati-not-allowed\n\n SS7: Locate Track Manipulate\n\n\n###### network\n\n\n###### 15\n\n\n###### MSC/\n VLR\n\n\n###### Visited network\n\n\n###### Home\n\n\n-----\n\n##### Cell Level Tracking with SS7/MAP\n\n###### Instead, query the MSC/VLR directly\n • But MSC/VLR use IMSIs (International Mobile Subscriber Identifiers), not phone\n • numbers, to identify subscribers\n ask the HLR for the subscriber’s IMSI and Global Title of the current MSC/VLR\n •\n Home Visited network network\n\n MSC/ HLR\n VLR\n\n sendRoutingInfoForSM\n req\n\n sendRoutingInfoForSM\n resp\n\n SS7: Locate Track Manipulate\n\n\n###### network\n\n\n###### 16\n\n\n###### MSC/\n VLR\n\n\n###### Visited network\n\n\n###### Home\n\n\n-----\n\n##### Cell Level Tracking with SS7/MAP\n\n###### When the attacker knows the IMSI of the subscriber and the Global Title, the\n\n### •\n###### MSC/VLR can be asked for the cell id of the subscriber\n\n Home Visited network network\n\n MSC/ HLR\n VLR\n\n sendRoutingInfoForSM\n req\n\n sendRoutingInfoForSM\n resp\n provideSubscriberInfo req\n Paging Request\n\n Paging Response\n provideSubscriberInfo resp\n\n SS7: Locate Track Manipulate\n\n\n###### network\n\n\n###### 17\n\n\n###### MSC/\n VLR\n\n\n###### Visited network\n\n\n###### Home\n\n\n-----\n\n##### Cell Level Tracking with SS7/MAP\n\n###### Works for a lot of\n\n### •\n###### networks\n Most VLR/MSC accept\n\n### •\n###### requests from anywhere\n no plausibility checks\n\n### •\n\n###### SS7: Locate Track Manipulate\n\n\n###### 18\n\n\n-----\n\n##### Real-life tracking\n\n###### We tracked some folks (but only after asking for permission)\n\n### •\n###### For about two weeks, cell id was queried once per hour\n\n### •\n\n###### Many, many thanks to Sascha for his work on the maps!\n\n### •\n\n###### SS7: Locate Track Manipulate\n\n\n###### 19\n\n\n-----\n\n##### Observations of a German network operator\n\n###### The Operator started filtering all network-internal messages at the network’s\n\n### •\n###### borders\n This (combined with SMS home routing, which the operator has in place)\n\n### •\n###### essentially eliminated the simple form of tracking as seen before\n Attack traffic dropped more than 80%:\n\n### •\n###### Some of that traffic was due to misconfiguration at other networks\n### ‣\n###### Commercial use cases:\n### ‣\n###### a shipping company was tracking its vehicles\n### ###### an SMS service provider for banks who use text messages as a second\n### ###### form of authentication (mTAN) was using the MAP sendIMSI request to find out if the SIM was recently swapped\n\n SS7: Locate Track Manipulate\n\n\n###### 20\n\n\n-----\n\n##### Observations of a German network operator\n\n###### Some of the network operators where the attacks originated either did not\n\n### •\n###### respond or played dumb when the issue was addressed by the German operator\n The operator believes that those attacks are being performed by state actors or\n\n### •\n###### the other network’s operators themselves\n Some attacks are still happening, which requires other information sources or\n\n### •\n###### brute-forcing to get VLR/MSC and IMSI\n\n SS7: Locate Track Manipulate\n\n\n###### 21\n\n\n-----\n\n##### Location Services (LCS)\n\n###### In the US, E911 mandates: “Wireless network operators must provide the\n\n### •\n###### latitude and longitude of callers within 300 meters, within six minutes of a request by a Public Safety Answering Point”\n LCS can use triangulation to further narrow down a subscriber’s position or\n\n### •\n###### even request a GPS position from the phone (via RRLP)\n Emergency services request a subscriber’s location from the Gateway Mobile\n\n### •\n###### Location Center (GMLC)\n GMLC requires authentication\n\n### •\n\n###### SS7: Locate Track Manipulate\n\n\n###### 22\n\n\n-----\n\n##### Location Services (LCS)\n\n###### 3GPP TS 23.271 version 11.2.0 Release 11 66 ETSI TS 123 271 V11.2.0 (2013-04)\n\n HLR/ VMSC/ Client GMLC UE\n E.g. police HSS MSC SERVER RAN\n\n 1. LCS Service Request\n\n 2. Provide Subscriber Location\n\n 3. Location Request\n Requires authentication\n\n\n###### RAN\n\n\n###### Figure 9.3: Positioning for a Emergency Services MT-LR without HLR Query\n\n SS7: Locate Track Manipulate\n\n\n###### 23\n\n\n-----\n\n##### Location Services (LCS)\n\n###### 3GPP TS 23.271 version 11.2.0 Release 11 66 ETSI TS 123 271 V11.2.0 (2013-04)\n\n HLR/ VMSC/ Client GMLC UE\n E.g. police HSS MSC SERVER RAN\n\n 1. LCS Service Request\n\n 2. Provide Subscriber Location\n\n 3. Location Request\n Requires authentication\n\n\n###### RAN\n\n\n###### Figure 9.3: Positioning for a Emergency Services MT-LR without HLR Query\n\n SS7: Locate Track Manipulate\n\n\n###### 24\n\n\n-----\n\n##### Location Services (LCS)\n\n###### Authentication at the GMLC can also be circumvented by directly querying the\n\n### •\n###### VLR\n\n Home Visited network network\n\n MSC/ HLR\n VLR\n\n sendRoutingInfoForSM\n req\n\n sendRoutingInfoForSM\n resp\n\n provideSubscriberLocation req\n\n RRLP Requests\n\n provideSubscriberLocation resp\n\n SS7: Locate Track Manipulate\n\n\n###### HLR\n\n\n###### network\n\n\n###### 25\n\n\n###### MSC/\n VLR\n\n\n###### Visited network\n\n\n###### Home\n\n\n-----\n\n##### Verifying the sender, MAP-style\n\n\n###### CAP MAP\n\n\n###### MAP\n\n\n###### TCAP\n\n\n###### TCAP\n\n\n###### SCCP\n\n\n###### SCCP\n\n\n###### Routing of MAP messages\n\n### •\n###### happens in the SCCP layer\n Requests get routed to the\n\n### •\n###### “Called Party Address” (e.g. the address of an VLR)\n Responses will be sent back to\n\n### •\n###### the “Calling Party Address” from the request\n\n SS7: Locate Track Manipulate\n\n\n##### Verifying the sender, MAP-style\n\n\n###### CAP\n\n\n###### 26\n\n\n-----\n\n##### Verifying the sender, MAP-style\n\n###### Problem:\n\n### •\n###### SCCP doesn’t know anything\n\n### •\n###### about MAP or what entities should be able to use which MAP services\n “Solution”:\n\n### •\n###### Have the sender(!) put another\n\n### •\n###### copy of its “Calling Party Address” in an extra field in the MAP layer, so it can be verified\n Routing will still happen to\n\n### •\n###### addresses from the network layer\n\n SS7: Locate Track Manipulate\n\n\n###### Response will\n be routed to\n this address\n\n This address\n gets verified\n\n\n###### 27\n\n\n-----\n\n##### Verifying the sender, MAP-style\n\n###### If we tell the truth:\n\n### •\n\n###### Same address\n\n SS7: Locate Track Manipulate\n\n\n###### 28\n\n\n###### Same address\n\n SS7: Locate Track Manipulate\n\n\n-----\n\n##### Verifying the sender, MAP-style\n\n###### If we enter an address from the same network that we sent the request to:\n\n### •\n\n###### Similar addresses\n\n Response still\n gets routed back to this\n address\n\n SS7: Locate Track Manipulate\n\n\n###### 29\n\n\n###### Similar addresses\n\n Response still\n gets routed back to this\n address\n\n SS7: Locate Track Manipulate\n\n\n-----\n\n##### Denial of Service\n\n###### It is not only possible to read subscriber data - it can also be modified, since\n\n### •\n###### most network’s VLR/MSC don’t do any plausibility checks\n Control every aspect of what a subscriber is allowed to do: enable or disable\n\n### •\n###### incoming and/or outgoing calls / SMS or data or delete the subscriber from the VLR altogether\n\n Visited network\n\n MSC/\n VLR\n\n Get IMSI / VLR address from HLR\n\n insertSubscriberData req deleteSubscriberData req /\n cancelLocation req\n\n## X\n\n###### SS7: Locate Track Manipulate\n\n|MSC/ VLR Get IMSI / VLR address from HLR insertSubscriberData req deleteSubscriberData req / cancelLocation req|Col2|\n|---|---|\n|Get IM address f|SI / VLR rom HLR|\n|||\n\n\n## X\n\n\n###### MSC/\n VLR\n\n\n###### 30\n\n\n###### Visited network\n\n\n-----\n\n##### CAMEL\n\n###### ???\n\n “Customised Applications for Mobile networks Enhanced Logic”\n\n### •\n###### Specified in 3GPP TS 23.078\n\n### •\n###### Like an overlay over usual MAP logic\n\n### •\n###### Defines a set of events, for which the VLR should contact the CAMEL entity in\n\n### •\n###### the subscriber’s home network (gsmSCF = “GSM Service Control Function)\n The gsmSCF then decides if the desired action can continue unmodified or\n\n### •\n###### modified or will be aborted\n\n SS7: Locate Track Manipulate\n\n\n###### ???\n\n Logic”\n\n\n###### 31\n\n\n-----\n\n##### CAMEL\n\n###### Example: German subscriber is roaming in France\n\n### •\n###### German HLR tells French VLR “notify my gsmSCF at address +4917...\n\n### •\n###### whenever the subscriber wants to make a call”\n\n Home network Visited network\n\n gsm MSC/\n HLR\n SCF VLR\n\n insertSubscriberData req with gsmSCF address and list of events\n to report (“Detection Points”)\n\n SS7: Locate Track Manipulate\n\n\n###### MSC/\n VLR\n\n\n###### gsm\n SCF\n\n\n###### Visited network\n\n\n###### 32\n\n\n###### HLR\n\n\n###### Home network\n\n\n-----\n\n##### CAMEL\n\n###### Subscriber wants to make a phone call, but dials number in German national format\n • (0317654...)\n MSC asks gsmSCF in home network what to do with the call\n • gsmSCF rewrites number to international format (+49317654...) and tells MSC to continue with\n • the new number\n\n Home network Visited network\n\n gsm MSC/\n HLR\n SCF VLR\n\n Setup initialDP 0317654... 0317654...\n connect +49317654...\n\n Call setup to rewritten number\n\n SS7: Locate Track Manipulate\n\n\n###### MSC/\n VLR\n\n\n###### gsm\n SCF\n\n\n###### Visited network\n\n\n###### 33\n\n\n###### HLR\n\n\n###### Home network\n\n\n-----\n\n##### Intercepting calls with CAMEL\n\n###### Attacker overwrites gsmSCF address in subscriber’s MSC/VLR with it’s own,\n\n### •\n###### “fake gsmSCF” address\n\n Caller network\n\n MSC/\n VLR\n\n insertSubscriberData req\n with address of attacker\n as gsmSCF\n\n SS7: Locate Track Manipulate\n\n\n###### Caller network\n\n\n###### 34\n\n\n###### MSC/\n VLR\n\n\n-----\n\n##### Intercepting calls with CAMEL\n\n###### Subscriber wants to call +345678..., but the MSC now contacts the attacker\n\n### •\n###### instead of the subscriber’s gsmSCF\n\n Caller network +345678...\n +210987...\n\n MSC/\n VLR\n\n Setup initialDP +345678... +345678...\n\n SS7: Locate Track Manipulate\n\n\n###### +345678...\n\n\n###### +345678...\n\n\n###### 35\n\n\n###### MSC/\n VLR\n\n\n###### +210987...\n\n\n###### +345678...\n\n\n-----\n\n##### Intercepting calls with CAMEL\n\n###### Attacker rewrites number to +210987..., his recording proxy (e.g. an Asterisk\n\n### •\n###### PBX)\n\n Caller network +345678...\n +210987...\n\n MSC/\n VLR\n\n Setup initialDP +345678... +345678...\n connect +210987...\n\n SS7: Locate Track Manipulate\n\n\n###### +210987...\n\n\n###### +345678...\n\n\n###### +210987...\n\n\n###### 36\n\n\n###### MSC/\n VLR\n\n\n###### +210987...\n\n\n###### +345678...\n\n\n-----\n\n##### Intercepting calls with CAMEL\n\n###### MSC sets up call to +210987..., which bridges it to the original +345678...\n\n### •\n###### Both subscribers can talk to each other, while the attacker records the\n\n### •\n###### conversation\n\n Caller network +345678...\n +210987...\n\n MSC/\n VLR\n\n Setup initialDP +345678... +345678...\n connect +210987...\n\n Voicecall to\n +210987... Voicecall to\n +345678...\n\n SS7: Locate Track Manipulate\n\n\n###### +210987...\n\n\n###### Caller network\n\n\n###### +210987...\n\n\n###### +345678...\n\n\n###### +210987...\n\n\n###### 37\n\n\n###### MSC/\n VLR\n\n\n###### +210987...\n\n\n###### +345678...\n\n\n-----\n\n##### HLR: Location Update\n\n###### When a subscriber travels to another region or country, the VLR/MSC sends a\n\n### •\n###### MAP updateLocation request to the subscriber’s HLR\n\n Home Visited network network\n\n MSC/ HLR\n VLR\n\n Location Updating\n Request\n updateLocation req\n\n SS7: Locate Track Manipulate\n\n\n###### MSC/\n VLR\n\n\n###### network\n\n\n###### Home network\n\n\n###### 38\n\n\n###### HLR\n\n\n###### Home\n\n\n-----\n\n##### HLR: Update Location\n\n###### The HLR sends a copy of the subscriber’s data to the VLR/MSC and saves the\n\n### •\n###### address of the VLR/MSC\n\n Home Visited network network\n\n MSC/ HLR\n VLR\n\n Location Updating\n Request\n updateLocation req\n\n Saves MSC/VLR address\n\n insertSubscriberData req\n\n SS7: Locate Track Manipulate\n\n|Visited network Home network|Col2|\n|---|---|\n|MSC/ HLR VLR Location Updating Request updateLocation req Saves MSC/VLR address insertSubscriberData req||\n|Saves MSC/|VLR address|\n|in||\n\n\n###### MSC/\n VLR\n\n\n###### network\n\n\n###### Home network\n\n\n###### 39\n\n\n###### HLR\n\n\n###### Home\n\n\n-----\n\n##### HLR: Update Location\n\n###### Now, when somebody wants to call or text the subscriber, the HLR gets asked for\n\n#### •\n###### routing information (sendRoutingInfo...) and hands out the address of the VLR/ MSC\n\n Some Home Visited network network network\n\n MSC/\n SMSC HLR\n VLR\n\n sendRoutingInfoForSM\n req sendRoutingInfoForSM\n resp\n\n mt-forwardSM\n req\n SMS-DELIVER\n\n SS7: Locate Track Manipulate\n\n\n###### SMSC\n\n\n###### HLR\n\n\n###### Visited network\n\n\n###### network\n\n\n###### Home\n\n\n###### 40\n\n\n###### MSC/\n VLR\n\n\n###### network\n\n\n###### Some\n\n\n-----\n\n##### HLR: Stealing Subscribers\n\n###### The updateLocation procedure is also not authenticated\n\n### •\n###### An attacker can simply pretend that a subscriber is in his “network” by sending\n\n### •\n###### the updateLocation with his Global Title to the subscriber’s HLR\n\n\n###### Home network\n\n\n## “  ” X\n\n|HLR Saves attacker’s address|Col2|MSC/ VLR up inser|X dateLocation req tSubscriberData req|\n|---|---|---|---|\n|Saves attack|er’s address|||\n|||||\n\n\n## X\n\n\n###### SMSC\n\n\n###### HLR\n\n\n## “  ”\n\n\n###### network\n\n\n###### Home\n\n\n###### SS7: Locate Track Manipulate\n\n\n###### network\n\n\n###### Some\n\n\n###### 41\n\n\n###### MSC/\n VLR\n\n\n-----\n\n##### HLR: Stealing Subscribers\n\n###### Now, calls and SMS for that subscriber are routed to the attacker\n\n### •\n###### Example: Subscriber’s bank sends text with mTAN. Attacker intercepts\n\n### •\n###### message and transfers money to his own account\n\n\n###### Some network\n\n\n###### Home network\n\n\n## “  ” X\n\n|SMSC HLR sendRoutingInfoForSM req sendRoutingInfoForSM resp mt-forw re|MSC/ VLR ardSM q|X|\n|---|---|---|\n\n\n## X\n\n\n###### SMSC\n\n\n###### HLR\n\n\n## “  ”\n\n\n###### network\n\n\n###### Home\n\n\n###### SS7: Locate Track Manipulate\n\n\n###### network\n\n\n###### Some\n\n\n###### 42\n\n\n###### MSC/\n VLR\n\n\n-----\n\n##### HLR: Supplementary Services\n\n###### USSD codes can be executed for other subscribers\n\n### •\n###### Some carriers offer transfer of prepaid credits via\n### ‣\n###### USSD\n Call forwardings can be set/deleted\n\n### •\n###### An attacker could forward a subscriber’s calls to a\n### ‣\n###### premium rate number controlled by him and then call the subscriber’s number, billing all the premium rate calls to the subscriber\n Switch active SIM in case of Multi-SIM\n\n### •\n\n###### SS7: Locate Track Manipulate\n\n\n###### 43\n\n\n-----\n\n##### HLR: Supplementary Services\n\n###### Requests can even be sent without a previous updateLocation procedure,\n\n### •\n###### because the HLR does not check if the subscriber is in the network that is sending the request\n\n SS7: Locate Track Manipulate\n\n\n###### 44\n\n\n-----\n\n##### Hybrid Attacks: TMSI De-anonymization\n\n###### An attacker can find out the phone numbers of subscribers around him:\n\n### •\n###### Paging of subscribers (e.g. to notify them of an incoming call) has to happen\n### ‣\n###### unencrypted\n TMSI (Temporary Mobile Subscriber Identifier) is normally used for paging so\n### ‣\n###### that the real identity of the subscriber (IMSI) does not have to be sent over the air unencrypted\n\n MSC/\n VLR\n\n Paging Request\n contains TMSI\n\n SS7: Locate Track Manipulate\n\n\n###### MSC/\n VLR\n\n\n###### 45\n\n\n-----\n\n##### Hybrid Attacks: TMSI De-anonymization\n\n###### Attacker captures TMSI over the air, e.g. with OsmocomBB\n\n### •\n\n###### MSC/\n VLR\n\n Paging Request\n contains TMSI\n\n SS7: Locate Track Manipulate\n\n\n###### MSC/\n VLR\n\n\n###### 46\n\n\n-----\n\n##### Hybrid Attacks: TMSI De-anonymization\n\n###### The MSC can be asked to hand out the IMSI if the TMSI is known\n\n### •\n###### With updateLocation, the attacker can figure out the MSISDN belonging to\n\n### •\n###### the IMSI\n\n MSC/\n VLR\n\n Paging Request\n contains TMSI\n\n sendIdentification req\n\n sendIdentification resp\n containing IMSI\n\n SS7: Locate Track Manipulate\n\n\n###### req\n\n\n###### MSC/\n VLR\n\n\n###### 47\n\n\n-----\n\n##### Hybrid Attacks: Intercept Calls\n\n###### The MSC can be also be asked for the session key for of the subscriber!\n\n### •\n\n###### MSC/\n VLR\n\n sendIdentification req with TMSI\n\n sendIdentification resp containing session keys\n\n SS7: Locate Track Manipulate\n\n\n###### 48\n\n\n###### MSC/\n VLR\n\n\n-----\n\n##### Hybrid Attacks: Intercept Calls\n\n###### If the attacker captures an encrypted GSM or UMTS call, he can then decrypt\n\n### •\n###### it using the session key\n Passive attack, no IMSI catcher necessary\n\n### •\n\n###### MSC/\n VLR\n\n sendIdentification req with TMSI\n\n sendIdentification resp containing session keys\n\n Voicecall\n\n SS7: Locate Track Manipulate\n\n\n###### 49\n\n\n-----\n\n##### LTE\n\n###### LTE uses the Diameter protocol in the core network\n\n### •\n###### SS7 is becoming a legacy protocol, but:\n\n### •\n###### A lot of the SS7 design has been ported to Diameter, including its flaws\n### ‣\n###### E.g. there is still no end-to-end authentication for subscribers\n### ‣\n###### GSM/UMTS (and with them SS7) will be around for a long time to come\n### ‣\n###### (probably around 20 years)\n To be able to have connections from GSM/UMTS to LTE, there are interfaces\n\n### •\n###### mapping most of the SS7 functionality (including its flaws) onto Diameter\n\n SS7: Locate Track Manipulate\n\n\n###### 50\n\n\n-----\n\n##### Summary\n\n###### An attacker needs SS7 access and (most of the time) SCCP roaming with his\n\n#### •\n###### victim’s network\n Then, with only his victim’s phone number, he can\n\n#### •\n###### Track his victim’s movements (in some networks with GPS precision)\n#### ‣\n###### Intercept his victim’s calls, text messages (and probably data connections, not\n#### ‣\n###### verified)\n Disable calls, SMS, data\n#### ‣\n###### Re-route calls, at the victim’s expense\n#### ‣\n###### With only a TMSI, captured over the air interface, he can\n\n#### •\n###### decrypt calls captured off the air (GSM, UMTS)\n#### ‣\n###### find out the IMSI and phone number belonging to the TMSI\n#### ‣\n\n###### SS7: Locate Track Manipulate\n\n\n###### 51\n\n\n-----\n\n##### Countermeasures (for operators)\n\n###### Network operators should remove all necessities to hand out a subscriber’s\n\n### •\n###### IMSI and current VLR/MSC to other networks\n With SMS Home Routing, all text messages traverse an SMS router in the\n### ‣\n###### subscriber’s home network\n When the HLR receives sendRoutingInfoForSM request, it only needs to\n### ‣\n###### hand out the address of the SMS router instead of the MSC address\n Instead of the subscriber’s IMSI, only a correlation id will be returned (that\n### ‣\n###### can be resolved by the SMS router)\n All MAP and CAP messages only needed internally in the network should be\n\n### •\n###### filtered at the network’s borders\n If Optimal Routing is not used, sendRoutingInfo (the one for voice calls,\n### ‣\n###### another source of MSC and IMSI), can also be filtered\n\n SS7: Locate Track Manipulate\n\n\n###### 52\n\n\n-----\n\n##### Countermeasures (for subscribers)\n\n###### Tell your operator to take action\n\n### •\n###### Throw away phone\n\n### •\n\n###### (Sorry, there really isn’t that much you can do)\n\n### •\n\n###### SS7: Locate Track Manipulate\n\n\n###### 53\n\n\n-----\n\n##### Thank you!\n\n\n# Questions?\n\n###### Tobias Engel <tobias@ccc.de>\n @2b_as\n\n SS7: Locate Track Manipulate 54\n\n\n-----\n\n##### References\n\n###### Verint Skylock product brochure: http://apps.washingtonpost.com/g/page/business/skylock-product-description-2013/1276/\n •\n Defentek Infiltrator product brochure: http://infiltrator.mobi/infiltrator.pdf\n • Signalling System #7, ITU-T Q.700 series: http://www.itu.int/rec/T-REC-Q/e\n •\n Mobile Application Part (MAP) specification, 3GPP TS 29.002: http://www.3gpp.org/ftp/Specs/archive/29_series/29.002/\n • CAMEL Phase 4; Stage 2: 3GPP TS 23.078: http://www.3gpp.org/ftp/Specs/archive/23_series/23.078/\n •\n CAMEL Application Part (CAP) specification, 3GPP TS 29.078: http://www.3gpp.org/ftp/Specs/archive/29_series/29.078/\n • Washington Post, For sale: Systems that can secretly track where cellphone users go around the globe: http://wapo.st/\n • 1qavLmF\n Functional stage 2 description of Location Services (LCS), 3GPP TS 23.271: http://www.3gpp.org/ftp/Specs/archive/\n • 23_series/23.271/\n osmocomBB: http://bb.osmocom.org/trac/\n •\n Evolved Packet System (EPS): MME and SGSN related interfaces based on Diameter protocol, 3GPP TS 29.272: http://\n • www.3gpp.org/ftp/Specs/archive/29_series/29.272/\n Study into routeing of MT-SMs via the HPLMN, 3GPP TR 23.840: http://www.3gpp.org/ftp/Specs/archive/23_series/23.840/\n •\n Sergey Puzankov and Dmitry Kurbatov, How to Intercept a Conversation Held on the Other Side of the Planet: http://\n • www.slideshare.net/phdays/phd4-pres-callinterception119\n\n SS7: Locate Track Manipulate\n\n\n###### 55\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://berlin.ccc.de/~tobias/31c3-ss7-locate-track-manipulate.pdf"
    ],
    "report_names": [
        "31c3-ss7-locate-track-manipulate.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716491,
    "ts_updated_at": 1743041148,
    "ts_creation_date": 1420026698,
    "ts_modification_date": 1420026698,
    "files": {
        "pdf": "https://archive.orkl.eu/e33f1fbc1d290de7393db9c38c9b646362a17ce0.pdf",
        "text": "https://archive.orkl.eu/e33f1fbc1d290de7393db9c38c9b646362a17ce0.txt",
        "img": "https://archive.orkl.eu/e33f1fbc1d290de7393db9c38c9b646362a17ce0.jpg"
    }
}