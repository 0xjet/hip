{
    "id": "5d1e827d-f3d4-4a47-9c92-e5cd809efb68",
    "created_at": "2023-01-12T15:06:51.561521Z",
    "updated_at": "2025-03-27T02:06:14.264638Z",
    "deleted_at": null,
    "sha1_hash": "5e67c16779971141f34e8849518862e4793a6a6d",
    "title": "2020-04-02 - Pekraut - German RAT starts gnawing",
    "authors": "",
    "file_creation_date": "2022-05-28T02:21:33Z",
    "file_modification_date": "2022-05-28T02:21:33Z",
    "file_size": 771489,
    "plain_text": "# Pekraut - German RAT starts gnawing\n\n**gdatasoftware.com/blog/2020/04/35849-pekraut-german-rat-starts-gnawing**\n\n04/02/2020\n\nG DATA Blog\nFeature-rich remote access malware Pekraut emerges. The rodent seems to be of German origin and is ready to be released. We\nanalyzed the malware in-depth.\n\nWhile searching for new malware via suspicious pathes, a fake svchost.exe in %APPDATA%/Microsoft tipped us off. The sample[1] is a\n[.NET application which is packed with ConfuserEx. The file was uploaded as netRat.exe to Virustotal. The same name is also stated in](https://yck1509.github.io/ConfuserEx/)\nthe file's version information as InternalName and OriginalFilename. Version information also has a copyright statement for 2019.\n\nPortexAnalyzer output for ConfuserEx packed Pekraut sample\n\n\n-----\n\nPortexAnalyzer output for unpacked Pekraut sample\n\nVia similarity search we found a second sample[2] that was uploaded to Virustotal a day later. It is not packed but obfuscated with\nDotfuscator. Unpacking the ConfuserEx sample[1] results in a file that is almost the same as the second sample[2].\n\n\nThe obfuscation removed the original names of .NET symbols like classes, variables and methods. We didn't find any non-obfuscated\nPekraut sample, so we manually named the symbols based on their usage resulting in sample[3]. The deobfuscated sample[3] is also\nused for screenshots in this article. Please note that those symbol names aren't part of the original source code and thus do not suffice\nfor signatures.\n\n## Pekraut RAT's command list\n\nPekraut's client accepts 27 commands. The help command sends a German description for every command to the server. The\ncommands themselves are still English, though.\n\nSome commands aren't exactly offering what the explanations are saying. E.g. the dbg command is not fully implemented.\n\nThe class responsible for managing all commands has seven placeholder objects in the command listing (see image below). The\nreason is most likely just a quirky way to place a newline when printing the help string of all commands.\n\n\n-----\n\nTo sum up, the whole RAT is quite function rich and fully implemented except for the debugging option. Malware authors are not\nexcempt from being so confident in their code that precautionary steps are neglected.\n\nThe table below sums up our analysis of the actual implementation for the commands.\n\n**Command** **Description**\n\n**spy_cb** Writes the clipboard data or reads and sends it back to the server. Images stored in the clipboard are also\nsupported.\n\n**spy_keylogger** Logs keystrokes. Supports these special keys: VK_OEM_NEC_EQUAL, VK_LShift, VK_RShift, VK_Scroll,\nVK_LMenu, VK_RMenu, VK_RControl, VK_LControl\n\n**spy_mic** Starts and stops recording with a microphone and sends the data to the server.\n\n**spy_scr** Shows information about a screen or takes a screenshot for a chosen screen and sends it to the server.\n\n**spy_cam** Takes a single picture via webcam or streams webcam to the server.\n\n**reg_list** Lists all subkeys and values of a given registry key.\n\n**reg_del** Deletes a registry key/value and sends the deleted key to the server.\n\n**reg_read** Reads a registry value and sends it to the server.\n\n**reg_value** Creates/writes a value in the registry.\n\n**proc_kill** Kills a process via name or ID.\n\n**proc_list** Sends process names and IDs of all running processes to the server.\n\n**proc_start** Executes a file via a given path.\n\n**file_delete** Deletes a file or folder.\n\n**file_download** Downloads a file from a given URL.\n\n**file_info** Sends the following information about a file to the server : filename, filename extension, size, creation date,\nlast access and the read-only attribute.\n\n**file_list** Sends all file and folder names within a folder to the server. Extra option to list all available drives.\n\n**file_send** Sends a file to the server.\n\n**exploit_admin_win10** Uses a Windows 10 UAC bypass method to start a given program with admin rights. More details to this later\non.\n\n**pc_cmd** Starts a command via cmd.exe and sends the output to the server.\n\n**pc_shutdown** Shuts down the PC.\n\n**sysinfo** Sends information like the machine name, the username, the OS and processor architecture, the screen\ncount, the webcam count and the microphone count to the server.\n\n**dbg** Option to start an endless-loop. Supposed to debug the client but not fully implemented yet.\n\n**exit** Disconnects from the server and terminates itself.\n\n**help** Sends all commands / the description of a command to the server.\n\n**client_err** Sends the last error to the server.\n\n**tasks** Sends currently executed commands to the server and has the option to terminate them.\n\n**client_install** Installs / uninstalls the client by using the procedure outlined in PekrautRAT's install / uninstall routine.\n\n## UAC bypass via ComputerDefaults.exe\n\nPekraut RAT uses a Windows 10 UAC bypass which utilizes ComputerDefaults.exe. The bypass was first mentioned in October 2018\non [Packetstormsecurity by](https://packetstormsecurity.com/files/149885/Microsoft-Windows-10-UAC-Bypass-By-computerDefault.html) [Fabien Dromas. It works is as follows:](https://twitter.com/St0rnPentest)\n\n1. Creating the registry key [HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command]\n2. Creating the value [HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command\\DelegateExecute] with no data.\n\n\n-----\n\n3. Setting the [HKCU\\Software\\Classes\\ms settings\\shell\\open\\command\\(default)] value with the data provided by the server. The\n\ndata is the program to be launched with admin rights.\n4. Launching ComputerDefaults.exe.\n\n_ComputerDefaults.exe will now execute the program since the DelegateExecute value is present. After launching_\n_ComputerDefaults.exe, Pekraut will remove all registry traces of the UAC bypass._\n\n## Pekraut RAT's install / uninstall routine\n\nPekraut RAT contains an installation and uninstallation routine. This Pekraut sample fakes svchost.exe and an update for Internet\nExplorer.\n\n### Installation\n\n1. Copies itself to\n\n_%USERPROFILE%\\AppData\\Roaming\\Microsoft\\svchost.exe_\n2. The file attributes of svchost.exe are set to hidden and system. This will make the file invisible from a normal directory listing and\n\nmakes it part of the system files.\n3. The registry value [HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell] by default contains the string\n\n\"explorer.exe\". Pekraut appends \",%USERPROFILE%\\AppData\\Roaming\\Microsoft\\svchost.exe\" to the string. That means after\nlogging in, explorer.exe and the fake svchost.exe will be executed.\n4. A windows shortcut file is created at C:\\Users\\<USERNAME>\\AppData\\Roaming\\Microsoft\\Windows\\Start\n\n_Menu\\Programs\\Startup\\IExplorerUpdate.lnk. It points to %USERPROFILE%\\AppData\\Roaming\\Microsoft\\svchost.exe._\n\nSince the drive for the shortcut location is hardcoded, this won't work on any systems that are not installed on drive C:\n5. Lastly, it pings 8.8.8.8 a three times to pass time, then deletes its original file and start it's copy\n\n_%USERPROFILE%\\AppData\\Roaming\\Microsoft\\svchost.exe._\n\n\n-----\n\nPart of Pekraut's installation routine that sets a Windows shortcut and adds the executable to Winlogon Shell\n\n### Uninstallation\n\n1. Restores the default for the registry value [HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell] by setting the\n\ndata to \"explorer.exe\".\n2. Deletes the previously created shortcut.\n3. Lastly, pings 8.8.8.8 to pass time and then deletes itself.\n\n### Install and uninstall settings\n\nInstall and uninstall routines use nine different flags that make it possible to turn certain behaviour on and off easily. There are also four\npublic static strings that denote the install location, install subfolder, name of the copied files and name of the windows shortcut. Those\nflags and strings are most likely to be set via a malware builder. A summary is in the screenshot below. As you can see all flags are\nturned on for our sample except the useInstallSubFolder option. If it was turned on, the file would be copied to the location\n\n_%USERPROFILE%\\AppData\\Roaming\\Microsoft\\<installSubFolder>\\svchost.exe_\n\n## Connection routine of Pekraut\n\nPekraut RAT sets up a socket connection to the server. The connection details are provided in the configuration class (see picture\nbelow).\n\n\n-----\n\n[The threat actor uses the portfowarding service portmap.io to hide the real IP address of their server. Possibly the server is even the](http://portmap.io/)\nactors home desktop machine.\n\nThe RAT has different data classes to send or receive the following types of data: a new password for encryption, keystrokes, text,\nimages, audio, video, errors, files or authentication info.\n\nText data is encrypted via AES with the password in the configuration. Other data is compressed via zlib.\n\n## Pekraut RAT is an upcoming threat\n\nWe didn't see any other samples in the wild so far but there are indications that this malware is just about to be released.\n\nThe version number stated in the configuration is 1.1\nThe RAT is feature-rich and prepared to be created en masse in modified versions by a builder\nOnce a builder is available for criminals, more versions of the malware will be found in the wild\nThe way of persistence via fake svchost and a fake Internet Explorer update excludes any benign use as remote access tool\n\n## We're social!\n\nIf you want to stay updated about malware, be sure to follow these accounts:\n\n[Struppigel - Personal Twitter account from Karsten Hahn.](https://twitter.com/struppigel)\n\n[RansomBleed - Personal Twitter account from Ransombleed.](https://twitter.com/RansomBleed)\n\n[G DATA CyberDefense â€“ G DATA CyberDefense Twitter account.](https://twitter.com/GDATA)\n\n## Indicators of Compromise\n\n### Sample hashes\n\n**Description** **Detection Name** **SHA256**\n\n\n\n[1] Pekraut,\nConfuserEx packed\n\n[2] Pekraut,\nunpacked,\nDotfuscator\n\n[3] Pekraut\ndeobfuscated,\nsymbol renaming\n\n[4]\nIExplorerUpdate.lnk\n\n\nMSIL.Backdoor.NetRat.UAPQUG cbc500b76995d36c76d04061c58ceaf93a1880af32be494e5ac1e099663ed0fd\n\nMSIL.Backdoor.NetRat.ZDZHYY 2dab95abe3460e34954527e88223662a03512938a9a28ab57e7f0a8ec298f367\n\nMSIL.Backdoor.NetRat.IJKLE3 4a89c3676dd86531c1fefb4e76d49cc31dc07a1a68c149dd08967e6fd7f6135a\n\nWin32.Malware.FakeSvchost.A 9dfffcbfb6537dc051b60f630ed1cd3f768bb0024a8e998752ab9ef6f4c30c65\n\n\n### File pathes and registry\n\nC:\\Users\\%USERNAME%\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\IExplorerUpdate.lnk\n\n%APPDATA%\\Microsoft\\svchost.exe\n\n\n-----\n\n[HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell] = \"explorer.exe, %APPDATA%\\Microsoft\\svchost.exe\"\n\n[HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command\\DelegateExecute] = \"\"\n\n[HKCU\\Software\\Classes\\ms-settings\\shell\\open\\command\\(default)] = <Program path>\n\n### C&C related\n\n**Port** 37648\n\n**Authentication ID** Nga8tG123hragGJjqt10jgag123\n\n**Password used to encrypt commands and logs** Ag2asgh2thGas37\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-04-02 - Pekraut - German RAT starts gnawing.pdf"
    ],
    "report_names": [
        "2020-04-02 - Pekraut - German RAT starts gnawing.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536011,
    "ts_updated_at": 1743041174,
    "ts_creation_date": 1653704493,
    "ts_modification_date": 1653704493,
    "files": {
        "pdf": "https://archive.orkl.eu/5e67c16779971141f34e8849518862e4793a6a6d.pdf",
        "text": "https://archive.orkl.eu/5e67c16779971141f34e8849518862e4793a6a6d.txt",
        "img": "https://archive.orkl.eu/5e67c16779971141f34e8849518862e4793a6a6d.jpg"
    }
}