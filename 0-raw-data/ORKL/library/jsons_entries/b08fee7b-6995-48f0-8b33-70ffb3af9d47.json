{
    "id": "b08fee7b-6995-48f0-8b33-70ffb3af9d47",
    "created_at": "2023-01-12T15:04:35.77659Z",
    "updated_at": "2025-03-27T02:16:34.612566Z",
    "deleted_at": null,
    "sha1_hash": "329f3d643d093a1dc299d8fd219208f6bba58069",
    "title": "2022-07-19 - Russian APT29 Hackers Use Online Storage Services, DropBox and Google Drive",
    "authors": "",
    "file_creation_date": "2022-08-18T03:22:03Z",
    "file_modification_date": "2022-08-18T03:22:03Z",
    "file_size": 5146562,
    "plain_text": "# Russian APT29 Hackers Use Online Storage Services, DropBox and Google Drive\n\n**unit42.paloaltonetworks.com/cloaked-ursa-online-storage-services-campaigns/**\n\nMike Harbison, Peter Renals July 19, 2022\n\nBy [Mike Harbison and](https://unit42.paloaltonetworks.com/author/mike-harbison/) [Peter Renals](https://unit42.paloaltonetworks.com/author/peter-renals/)\n\nJuly 19, 2022 at 3:00 AM\n\n[Category: Malware](https://unit42.paloaltonetworks.com/category/malware-2/)\n\nTags: [APT,](https://unit42.paloaltonetworks.com/tag/apt/) [APT 29,](https://unit42.paloaltonetworks.com/tag/apt-29/) [Cloaked Ursa,](https://unit42.paloaltonetworks.com/tag/cloaked-ursa/) [Cobalt Strike,](https://unit42.paloaltonetworks.com/tag/cobalt-strike/) [EnvyScout](https://unit42.paloaltonetworks.com/tag/envyscout/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/cloaked-ursa-online-storage-services-campaigns/)\n\n## Executive Summary\n\nOrganizations around the world rely on the use of trusted, reliable online storage services – such as DropBox and Google Drive – to conduct\nday-to-day operations. However, our latest research shows that threat actors are finding ways to take advantage of that trust to make their\n[attacks extremely difficult to detect and prevent. The latest campaigns conducted by an advanced persistent threat (APT) that we track as](https://unit42.paloaltonetworks.com/unit-42-threat-group-naming-update/)\nCloaked Ursa (also known as APT29, Nobelium or Cozy Bear) demonstrate sophistication and the ability to rapidly integrate popular cloud\nstorage services to avoid detection.\n\nThe use of trusted, legitimate [cloud services isn't entirely new to this group. Extending this trend, we have discovered that their two most](https://www.mandiant.com/resources/tracking-apt29-phishing-campaigns)\nrecent campaigns leveraged Google Drive cloud storage services for the first time. The ubiquitous nature of Google Drive cloud storage\nservices – combined with the trust that millions of customers worldwide have in them – make their inclusion in this APT’s malware delivery\nprocess exceptionally concerning.\n\nWhen the use of trusted services is combined with encryption, as we see here, it becomes extremely difficult for organizations to detect\nmalicious activity in connection with the campaign.\n\nThe cybersecurity industry has long considered Cloaked Ursa to be affiliated with the Russian government. This aligns with the group’s historic\ntargeting focus, dating back to malware campaigns against Chechnya and other former Soviet bloc countries in 2008. In recent years, the hack\nof the United States Democratic National Committee (DNC) in 2016 has been attributed to this group, as well as the SolarWinds supply chain\n[compromises in 2020. Increasing the specificity of the attribution, both the United States and the](https://media.defense.gov/2021/Apr/15/2002621240/-1/-1/0/CSA_SVR_TARGETS_US_ALLIES_UOO13234021.PDF) [United Kingdom have publicly attributed this](https://www.ncsc.gov.uk/news/joint-advisory-further-ttps-associated-with-svr-cyber-actors)\ngroup to Russia’s Foreign Intelligence Service (SVR).\n\nThe most recent campaigns by this actor provided a lure of an agenda for an upcoming meeting with an ambassador. These campaigns are\nbelieved to have targeted several Western diplomatic missions between May and June 2022. The lures included in these campaigns suggest\ntargeting of a foreign embassy in Portugal as well as a foreign embassy in Brazil. In both cases, the phishing documents contained a link to a\n[malicious HTML file (EnvyScout) that served as a dropper for additional malicious files in the target network, including a Cobalt Strike payload.](https://www.microsoft.com/security/blog/2021/05/28/breaking-down-nobeliums-latest-early-stage-toolset/)\n\n\n-----\n\na o to et o s custo e s ece e p otect o s o t e d cato s o co p o se ( oCs) desc bed t s b og t oug Co te,\nAdvanced URL Filtering, DNS Security and WildFire malware analysis.\n\nFull visualization of the techniques observed, relevant courses of action and IoCs related to this report can be found in the Unit 42 ATOM\nviewer.\n\nPalo Alto Networks disclosed this activity to both Google and DropBox, and they have taken action to block the activity.\n\nNames for threat actor group discussed Cloaked Ursa, APT29, Nobelium, Cozy Bear\n\n## Table of Contents\n\nLatest Campaigns\n\nRecent Related Cloaked Ursa Campaigns\n\nCampaign 2\n\nCampaign 1\n\nConclusion\n\nProtections and Mitigations\n\nIndicators of Compromise\n\nXQL Hunting Queries for Cortex XDR\n\nAdditional Resources\n\n## Latest Campaigns\n\n[On May 13, 2022, Cluster25 published a report that outlined Cloaked Ursa’s inclusion of DropBox services in their malware campaigns for the](https://cluster25.io/2022/05/13/cozy-smuggled-into-the-box/)\nfirst time. (Here, we refer to this as campaign 1.) Searching for similar techniques, we have seen the actors continue to evolve their tactics,\nincluding by incorporating popular online storage services in their campaigns.\n\nLess than two weeks after the Cluster25 report, on May 24, 2022, Unit 42 identified a new campaign targeting a NATO country in Europe. (We\nrefer to this as campaign 2.)\n\nThe campaign oddly consisted of two emails to the same target country a few hours apart. Both emails contained the same lure document\nnamed Agenda.pdf, which provided a link to an agenda for an upcoming meeting with an ambassador in Portugal.\n\nFigure 1.\n\nPortuguese Embassy lure file.\nExamining the two emails sent to the targeted nation provided clues as to why two emails were sent. The first email was sent at 2022-0524T11:41:55Z with an Agenda.pdf hash of a0bdd8a82103f045935c83cb2186524ff3fc2d1324907d9bd644ea5cefacbaaf. This PDF had the\nfollowing traits:\n\nCreated: 2022:04:04 13:51:53+02:00\n\nModified: 2022:05:24 13:28:23+02:00\n\nProducer: 2.4.12 (4.3.5)\n\nPDF Version: 1.5\n\nLink: www.dropbox[.]com/s/dhueerinrg9k97k/agenda.html?dl=1\n\n\n-----\n\nte est g y, t s sa p e as ast od ed oug y t o ou s be o e t as se t to ts ta get dd t o a y, t s sa p e as des g ed to ca out\nto DropBox to retrieve an EnvyScout payload.\n\nThe second email was sent at 2022-05-24T13:46:54Z with an Agenda.pdf hash of\nf9b10323b120d8b12e72f74261e9e51a4780ac65f09967d7f4a4f4a8eabc6f4c. This PDF had the following traits:\n\nCreated: 2022:04:04 13:51:53+02:00\n\nModified: 2022:05:24 14:27:02+02:00\n\nProducer: 2.4.14 (4.3.5)\n\nPDF Version: 1.5\n\nLink: wethe6and9[.]ca/wp-content/Agenda.html\n\nSimilarly, this second sample was last modified less than an hour before it was sent to its target. Comparing the two samples, we see that the\ncreation times remained consistent while the modification times aligned to the dates when the samples were used. The producer version in the\nsecond sample is incrementally higher, climbing from 12 to 14. Additionally, we see that the link in the document was updated to point to a\nlegitimate web and digital marketing company in Toronto (wethe6and9[.]ca).\n\nWhile speculative, one likely scenario is that the recipient could not access the file hosted in DropBox. There could be various reasons for this,\nincluding restrictive government network policies blocking access to cloud storage services. Regardless of the reason, the actors were\ncompelled to rapidly build and send a second spear phishing email the same day with a link to an EnvyScout HTML file with the same name\nhosted on a legitimate website.\n\nPivoting on the creation time, producer and PDF version metadata in the two samples, we were able to quickly identify several additional\nsuspicious documents in VirusTotal dating back to early April 2022. Many of these documents appear to be phishing documents associated\nwith common cybercrime techniques. This suggests that there is likely a common phishing builder being leveraged by cybercrime and APT\nactors alike to generate these documents.\n\nTable 1.\n\nSamples with similar metadata.\nReviewing this list, we identified a third Agenda.pdf created on June 30, 2022 that we assess to be part of a second phishing campaign by\nCloaked Ursa. Examining the file, we found that its lure was consistent with the previous campaign. Specifically, the lure contained the same\nlanguage and a similar link to an EnvyScout dropper hosted on a legitimate domain (porodicno[.]ba/wp-content/Agenda.html). Where the two\ncampaigns differed was their target. While the first two lures were addressed to a Portuguese Embassy, this third lure was addressed to an\nembassy in Brazil.\n\n\n-----\n\nFigure 2.\n\nCampaign 2 lure file Agenda.pdf\nFinally, in comparing both campaigns, we found that Cloaked Ursa had evolved their use of cloud storage services in their delivery tactics.\nNotably, rather than continuing their use of the DropBox services, identified by Cluster25 in early May, these new campaigns incorporated\nGoogle Drive storage services as a means to obfuscate their actions and deploy additional payloads into target environments. A detailed\nanalysis of both campaigns can be found below, particularly starting with the sections on Campaign 2 and Campaign 1.\n\n## Recent Related Cloaked Ursa Campaigns\n\nThe May campaign using Agenda.pdf represents repeat targeting of a particular NATO country. On Jan. 17, 2022, just days after the\n[WhisperGate attacks in Ukraine, this NATO country was targeted in a Cloaked Ursa phishing campaign using a lure with the subject line of](https://unit42.paloaltonetworks.com/ukraine-cyber-conflict-cve-2021-32648-whispergate/)\n“Note Verbal - Ambassador Absence.”\n\nAdditionally, this is not the first time we have seen Portugal serve as a focus for Cloaked Ursa campaigns. On Feb. 8, 2022, a phishing\ncampaign targeted the Austrian Ministry of Foreign affairs. This campaign used a lure of “NV - Non-working days of the Embassy of Portugal”\nand originated from a potentially compromised Portuguese government email account.\n\n\n-----\n\nFigure 3. Email\n\nto Austrian Ministry of Foreign Affairs.\nDays later, on Feb. 17, 2022, another phishing campaign was discovered with a lure of “Embassy closure due to COVID-19.” The text of the\nemail stated that the Embassy of the Republic of Turkey was being transferred to a state of isolation and was closing to the public. While the\ntarget of that campaign remains unknown, the original email was eventually seen by an employee of the Portuguese Ministry of Foreign Affairs\nwho promptly forwarded the malicious email to their embassy staff in Egypt. Both of these email campaigns contained the malicious EnvyScout\ndropper.\n\nFigure 4. Email\n\nto Portuguese Embassy in Egypt.\n\n## Campaign 2\n\nBeginning with the most recent spear phishing activity first, we analyzed a diplomatic-themed PDF file named Agenda.pdf (SHA256:\nce9802b22a37ae26c02b1f2c3225955a7667495fce5b106113434ab5a87ae28a)\n\n\n-----\n\nFigure 5.\n\nVirusTotal detections for campaign 2 lure file Agenda.pdf\nThis PDF document contains information that appears to address a foreign embassy in Brazil while using Brazil's official logo and notably\nmisspelling “Brazil” as “Brzail.” The document was created on April 4, 2022, and later modified on June 30, 2022. All three URL links in the\ndocument point to an internet-facing web server that is hosting a file named Agenda.html. This file is EnvyScout, a malicious HTML document.\nThe contents of Agenda.pdf are shown in Figure 6 below.\n\nFigure 6.\n\nCampaign 2 lure file Agenda.pdf\nA high-level overview of campaign 2 is depicted below in Figure 7.\n\n\n-----\n\nFigure 7.\n\nCampaign 2 overview.\n\n### EnvyScout – Agenda.html, Malicious HTML File\n\n[EnvyScout can be described as an auxiliary tool that is used to further infect the target with the actor's implant. It is used to deobfuscate the](https://www.microsoft.com/security/blog/2021/05/28/breaking-down-nobeliums-latest-early-stage-toolset/)\n[contents of the secondary malware, which is a malicious ISO file. This technique is known as HTML Smuggling. In this case, the file](https://attack.mitre.org/techniques/T1027/006/)\nAgenda.html is responsible for deobfuscating a payload, and also for writing a malicious ISO file to the intended target hard drive. The payload\nfile is an ISO file named Agenda.iso. It should be noted that the word “Agenda” is used throughout this attack, starting with the lure file,\nAgenda.pdf, and then carrying through to the named files on the target's hard drive.\n\nThe deobfuscation of the embedded payload is performed by subtracting 17 from each value. Once complete, the data is saved as\nAgenda.iso.\n\nFigure 8.\n\nDeobfuscation routine in EnvyScout Campaign 2.\nThe saving of the ISO is performed via JavaScript with the first attempt using the msSaveOrOpenBlob method. This method is the same as a\nuser using Internet Explorer wanting to download and save/open a file from the internet. In the event this fails, a second file save method is\nused, console.save. This method creates a FileBlob from the input, and then automatically downloads it to the target. At this stage of infection,\nthe user is prompted to open Agenda.iso by double clicking it.\n\n\n-----\n\nFigure 9.\n\nAgenda.html ISO download.\n\n### Layers to Code Execution\n\nOnce the ISO has been downloaded, user interaction is required in order to achieve code execution on the victim machine. The user must\ndouble-click the ISO file and subsequently double-click the shortcut file, Information.lnk, to kick off the unpacking and infection process.\n\n\n-----\n\nLayers to Stage 2 payload.\n\n**Agenda.iso - Malicious ISO Image**\n\n\nFigure 10.\n\nFigure 11.\n\n\nAgenda.iso\nAgenda.iso (SHA256: 347715f967da5debfb01d3ba2ede6922801c24988c8e6ea2541e370ded313c8b) is the malicious ISO file created by\nEnvyScout (Agenda.html). At the time of writing, only one vendor on VirusTotal identified this sample as malicious.\n\nOnce double-clicked by the user and mounted by the operating system, the following is displayed to the user via Windows File Explorer:\n\n\n-----\n\nFigure 12.\n\nAgenda.iso contents; hidden files not enabled.\nBy default, Windows File Explorer doesn’t show hidden files. The only file presented is Information.lnk. If “show hidden items” is selected,\nWindows File Explorer displays the following:\n\nFigure 13.\n\nAgenda.iso contents; hidden files is enabled.\n\nTable 2.\n\nAgenda iso embedded file properties Campaign 2\n\n\n-----\n\nge da so as t e o o g p ope t es\n\nCreated on: 6/29/2022 3:27:43 PM\nLabel: INFO\nApplication ID: IMGBURN V2.5.8.0 - THE ULTIMATE IMAGE BURNER!\nVolume Set ID: UNDEFINED\n\n**Information.lnk – Microsoft Shortcut File**\n\nThis file is responsible for starting the infection chain on the target machine. It has the following properties:\n\nLink CLSID: 00021401-0000-0000-C000-000000000046\nCommand line arguments: /k start agenda.exe\nIcon location: %windir%/system32/shell32.dll\nTarget ansi: %windir%/system32/cmd.exe\nCreation, Modified, Accessed: None\n[MS-PROPSTORE value: 46588ae2-4cbc-4338-bbfc-139326986dce](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-propstore/39ea873f-7af5-44dd-92f9-bc1f293852cc)\n\nConverts to: S-1-5-21-2842427291-3266668846-140208303-1103\n\n[*Note about the SID in this lnk file. The SID has been found in other APT29 sample lure files (lnk) bundled with Cobalt Strike.](https://cluster25.io/2022/05/13/cozy-smuggled-into-the-box/)\n\nOnce the shortcut file is double-clicked by the user, cmd.exe is used to execute agenda.exe in the current working directory. The /k parameter\npassed to cmd.exe instructs cmd.exe to carry out the execution and wait for agenda.exe to complete.\n\n**Agenda.exe – Adobe Executable**\n\nAgenda.exe is part of Adobe software, and is originally named WCChromeNativeMessagingHost.exe. It is digitally signed by Adobe, Inc., and\nis being used to evade detection from endpoint protection and antivirus software by abusing the trust of digitally signed applications. The\n[technique is commonly referred to as DLL Side Loading.](https://attack.mitre.org/techniques/T1574/002/)\n\n**Vcruntime140.dll – DLL loaded by agenda.exe**\n\nVcruntime140 is a dependency file for agenda.exe. Since it exists in the same directory as agenda.exe, Windows will load it, making the APIs it\ncontains available to it. Vcruntime140.dll is a common runtime library for Microsoft Visual Studio (Visual C++) versions 2015/2017/2019. Visual\nC++ runtime libraries are used for running programs developed in Microsoft Visual Studio. However, this file is not the legitimate Microsoft file,\nas it has been altered to load the actor’s malicious DLL, vctool140.dll. Hijacking a common library file, such as vcruntime140.dll, avoids\nobvious detection, as one would assume the file is legitimate.\n\n**Vctool140.dll – DLL loaded by vcruntime140.dll**\n\nVctool140.dll is the actor’s core file. It searches for a payload file named underscore (_), decompresses it in memory into a .Net x64\nexecutable and loads it. The file compression algorithm is Microsoft Zip (MSZIP), which requires the dependency file of cabinet.dll. Cabinet.dll\nis a Microsoft Windows library that is used to decompress Windows cabinet files, and it is typically installed on all Windows operating systems.\n\nThe technical details of how code execution is achieved are beyond the scope of this blog. In summary, it is achieved by instantiating the .Net\nCommon Language Runtime (CLR) and using the ICorRuntimeHost interface to execute the loaded assembly. The technique is loading the\nCLR using native code. The in-memory code is an x64 .Net binary that is named GoogleDrive.\n\n**Payload – GoogleDrive**\n\nThe decompressed payload is that of a .Net X64 executable that has been named GoogleDrive. It has the following properties:\n\n\n-----\n\nFigure 14.\n\nGoogleDrive metadata.\n[It was compiled on June 29, 2022, and masquerades as a Google product. The binary is using Google Drive API to communicate with a](https://developers.google.com/drive/api/guides/about-sdk)\nGoogle account for uploads and downloads to a Google Drive share. It uses the following to authenticate to Google's services:\n\nClient_Id = 477421423157-doqkohd8ihvnpgtsnbld4e4kd1lbs01b.apps.googleusercontent.com\nClient_Secret = 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\nRefresh_Token = 1//0czAXEdbKrikVCgYIARAAGAwSNwFL9IrjcOVo9aYPFogMEutV6W3cSJMh195N7Ty2cHvtpXf3FNQ9QKDHwN5SKG9FmrMSw5fnsI\n\nGoogle Drive network authentication example, as shown below:\n\nFigure 15.\n\nGoogleDrive authentication.\nThe sample has the following PDB string:\n\nFigure 16. PDB\n\nstring.\nOnce authenticated with Google, the following events occur:\n\n1. For runtime persistence, checks if the registry key AgendaE exists in:\n\nHKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\n\n\n-----\n\nt e ey does ot e st, t s c eated t t e o o g a ues\n1. C:\\Users\\[USERNAME]\\AppData\\Roaming\\agenda.exe\n2. Copies the following files to C:\\Users\\[USERNAME]\\AppData\\Roaming\\\n\n1. _\n2. agenda.exe\n3. vcruntime14.dll\n4. vctool140.dll\n3. Generates a random number.\n4. Retrieves the username from the running process.\n5. Computes the SHA256 of the username.\n6. Retrieves information from the victim such as: running processes, machine name and network IP information.\n7. Encrypts the data collected in step 6 via the following:\n\n1. XOR encrypt using a 44-byte key of\n\n0x8F380CDA296F34DE27697A1A53051849B69D59E528D7E669F17CF8D3CF220B6696DA776534401C8A0F0C31C6\n2. Base64 encoded step a.\n8. Uploads the data collected from step 7 to the Google Drive share with a unique client ID and a .txt file extension.\n9. Creates a comment for the file uploaded in step 8.\n10. Checks to see if any files are available to download for the current user ID.\n\n1. If any files exist, download them – these are payloads.\n2. Payload files are AES-CBC encrypted.\n\n1. AES key:0x9ECD936FE845D4B20175880E74410851EC3DB30412CB0E57BA6A8E958CB87E21\n2. AES IV: 0x4F083C8599B2F330694A38CA9741409C\n3. Payloads are .Net assembly files\n11. Loads and executes downloaded payload file in memory.\n12. Finishes.\n\n## Campaign 1\n\nFor the first campaign observed in late May 2022, the target was a NATO country’s Ministry of Foreign Affairs. Similar to the campaign\ndescribed above, this campaign also used lure files named Agenda.pdf. While two files were delivered to the intended target, for the purpose\nof this section, we provide analysis on the execution flow for SHA256\na0bdd8a82103f045935c83cb2186524ff3fc2d1324907d9bd644ea5cefacbaaf.\n\nFigure 17.\n\nVirusTotal detections for campaign 1 lure file Agenda.pdf\nThis sample was sent to the target on May 24, 2022 with the following information:\n\nEmail Sender: matysovi@seznam[.]cz\nEmail Subject: Meeting request - Ambassador of Portugal\nSource IP: 77.75.78[.]212\nSource Country: Czech Republic (CZ)\n\nThis PDF document contains information that appears to address a foreign nation’s embassy in Portugal, and even uses an official Portuguese\ngovernment logo. The document was created on April 4, 2022, and later modified on May 24, 2022. All three URL links in the document point\nto a DropBox URL that is hosting a file named, Agenda.html. Similar to the campaign above, Agenda.html is EnvyScout, a malicious HTML\ndocument. The contents of Agenda.pdf are shown in Figure 18 below.\n\n\n-----\n\nCampaign 1 lure file Agenda.pdf\nA high level overview of campaign 1 is depicted below in figure 19 below.\n\n\nFigure 18.\n\nFigure 19.\n\n\nCampaign 1 overview.The naming convention for the files involved in both campaigns is the same. For brevity, we will focus on the differences\nbetween the two campaigns.\nAgenda.html (SHA256: cbe92abb2e275770fdff2e9187dee07cce1961b13c0eda94237aceeb06eefbbd) is a malicious HTML file (EnvyScout)\nthat is hosted on DropBox and is identical to the file used in campaign 2 with the exception of the deobfuscation routine that is used to build the\nmalicious ISO file. In campaign 1, the malicious ISO file is generated by subtracting 13 from each value (instead of 17), as shown below.\n\n\n-----\n\nFigure 20.\n\nDeobfuscation routine in EnvyScout campaign 1.\nThe deobfuscated payload, agenda.iso (SHA256: de06cf27884440f51614a41623a4b84e0cb3082d6564ee352f6a4d8cf9d92ec5) has the same\nfile names and hidden file attributes as campaign 2. However, the Windows shortcut file is now named Agenda.lnk versus Information.lnk. A\ncomplete file listing is shown below in table 3.\n\nTable 3.\n\nAgenda.iso embedded file properties - Campaign 1.\nAgenda.iso has the following properties:\n\nCreated on: 5/24/2022 1:56:19 PM\nLabel: AGENDA\nApplication ID: IMGBURN V2.5.8.0 - THE ULTIMATE IMAGE BURNER!\nVolume Set ID: UNDEFINED\n\nOnce a user double-clicks the Windows shortcut file, Agenda.lnk, the same runtime artifacts occur as in campaign 2, as depicted below:\n\nFigure 21.\n\nDepiction of runtime artifacts.\nThe underscore file is the MSZIP compressed payload. It is in-memory loaded by the actor’s loader, vctool140.dll. Once decompressed, it is\nthe same code base as in campaign 2, a Google Drive x64 .Net binary. The differences between this Google Drive binary and campaign 2 are:\n\nIt was compiled on May 24, 2022.\nFor persistence, creates the following registry key:\nHKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\AdobeUpdate\n\n\n-----\n\ne c ede t a s o t e Goog e e accou t a e\nClientId: 891757970989-9ejifbns5l2to04dtp4uofsi1jtuuftk.apps.googleusercontent.com\nClientSecret: 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\nRefreshToken: 1//09QkhnFYvBS_uCgYIARAAGAkSNwFL9IrMBe27bDvHC1mqbkHJ3_W4xZRd2sT8G04lbff4U_fFBIrvYKtWQ1CJKm4FxPnfHUGFAI\nXOR key: 0xDDE5C7BB5B3A13E63A46D9BA9586B86A0BFAE23B6160DF7B14DE5AF187A96F15686034B506EE787E886238\nAES-CBC key: 0x5F7C003E182BBC08B66717894AC934E54FDA2C809391A3FC09CDB7563B707811\nAES IV: 0x4E8E525004C2DBFFFED47E9C087EBA4C\n\nLike campaign 2, both samples share the same PDB string of:\n\nFigure 22. PDB\n\nstring.\n\n## Conclusion\n\n[Cloaked Ursa has been attributed to Russia’s Foreign Intelligence Service (SVR) by both the United States and the](https://media.defense.gov/2021/Apr/15/2002621240/-1/-1/0/CSA_SVR_TARGETS_US_ALLIES_UOO13234021.PDF) [United Kingdom. Over the](https://www.ncsc.gov.uk/news/joint-advisory-further-ttps-associated-with-svr-cyber-actors)\npast six months, they have launched several phishing campaigns targeting foreign diplomatic missions.\n\nSince early May, Cloaked Ursa has continued to evolve their abilities to deliver malware using popular online storage services. Their two most\nrecent campaigns demonstrate their sophistication and their ability to obfuscate the deployment of their malware through the use of DropBox\nand Google Drive services. This is a new tactic for this actor and one that proves challenging to detect due to the ubiquitous nature of these\nservices and the fact that they are trusted by millions of customers worldwide.\n\nWe encourage all organizations to review their email policies and the IoCs provided in this report in order to address this threat.\n\nSpecial thanks to Google’s Threat Analysis Group (TAG) and DropBox for their collaboration and support for this research.\n\n_Palo Alto Networks has shared these findings, including file samples and indicators of compromise, with our fellow Cyber Threat Alliance_\n_members. CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber_\n_[actors. Learn more about the Cyber Threat Alliance.](https://www.cyberthreatalliance.org/)_\n\n## Protections and Mitigations\n\nFor Palo Alto Networks customers, our products and services provide the following coverage associated with this group:\n\n[WildFire cloud-based threat analysis service accurately identifies the known samples as malicious.](https://www.paloaltonetworks.com/products/secure-the-network/wildfire)\n\n[Threat Prevention provides protection against Cobalt Strike Beacon traffic.](https://www.paloaltonetworks.com/products/secure-the-network/subscriptions/threat-prevention)\n\n[Advanced URL Filtering and](https://www.paloaltonetworks.com/network-security/advanced-url-filtering) [DNS Security identify domains associated with this group as malicious.](https://www.paloaltonetworks.com/network-security/dns-security)\n\n[Cortex XDR prevents the execution of known malware samples as malicious and also prevents the execution of Cobalt Strike using Behavioral](https://www.paloaltonetworks.com/cortex/cortex-xdr)\nThreat Protection.\n\n[If you think you may have been impacted or have an urgent matter, get in touch with the Unit 42 Incident Response team or call:](http://start.paloaltonetworks.com/contact-unit42.html)\n\nNorth America Toll-Free: 866.486.4842 (866.4.UNIT42)\nEMEA: +31.20.299.3130\nAPAC: +65.6983.8730\nJapan: +81.50.1790.0200\n\n## Indicators of Compromise\n\n**Lure File Samples-PDFs:**\n\nCE9802B22A37AE26C02B1F2C3225955A7667495FCE5B106113434AB5A87AE28A\n\nF9B10323B120D8B12E72F74261E9E51A4780AC65F09967D7F4A4F4A8EABC6F4C\n\nA0BDD8A82103F045935C83CB2186524FF3FC2D1324907D9BD644EA5CEFACBAAF\n\n**ISO File Samples:**\n\n347715F967DA5DEBFB01D3BA2EDE6922801C24988C8E6EA2541E370DED313C8B\n\nDE06CF27884440F51614A41623A4B84E0CB3082D6564EE352F6A4D8CF9D92EC5\n\n\n-----\n\n**yScout Sa** **p es** **es**\n\n0ED71B0F4F83590CCA66C0C9E9524A0C01D7A44CF06467C3AE588C1FE5B13118\n\nCBE92ABB2E275770FDFF2E9187DEE07CCE1961B13C0EDA94237ACEEB06EEFBBD\n\n**Malicious DLLs:**\n\nA018F4D5245FD775A17DC8437AD55C2F74FB6152DD4FDF16709A60DF2A063FFF\n\n9230457E7B1AB614F0306E4AAAF08F1F79C11F897F635230AA4149CCFD090A3D\n\nFBA3A311A4C0A283753B5A0CDCADD3FE19F5A1174F03CB966F14D04BBF3D73EE\n\n**Compressed Payload Files-Underscore Files:**\n\n09F0EA9B239385EB22F794DCECAEC1273BE87F3F118A2DA067551778971CA677\n\n56CFFE5E224ACBE5A7E19446238E5BB9110D9200B6B1EA8B552984D802B71547\n\n**Decompressed in-memory payload:**\n\n295452A87C0FBB48EB87BE9DE061AB4E938194A3FE909D4BCB9BD6FF40B8B2F0\n\nBC9AD574C42BC7B123BAAAFB3325CE2185E92E46979B2FAADDD4BC80DDFAC88A\n\n**Infrastructure linked to samples:**\n\nporodicno[.]ba/wp-content/Agenda.html\n\nwethe6and9[.]ca/wp-content/Agenda.html\n\ndropbox[.]com/s/raw/dhueerinrg9k97k/agenda.html\n\n**Cobalt Strike C2s:**\n\ncrossfity[.]com\n\ntechspaceinfo[.]com\n\n**Cobalt Strike IPs:**\n\n185.47.128[.]39\n\n31.31.74[.]79\n\n**Registry Keys:**\n\nHKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\AgendaE\n\nHKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\AdobeUpdate\n\n**Email Senders:**\n\nmatysovi@seznam[.]cz\n\n**Emails:**\n\n761ED73512CB4392B98C84A34D3439240A73E389F09C2B4A8F0CCE6A212F529C\n\n4C1ED0F6470D0BBE1CA4447981430E8CEB1157D818656BE9C8A992C56C10B541\n\n## XQL Hunting Queries for Cortex XDR\n\n### Query 1:\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n// Description: Detect execution of legitimate Adobe binary renamed to Agenda.exe and abused for DLL Side Loading\n\ndataset = xdr_data\n| filter\nevent_type = PROCESS and\n(\naction_process_signature_vendor = \"Adobe Inc.\" or\naction_process_signature_vendor contains \"Adobe Systems\"\n) and\naction_process_image_name = \"Agenda.exe\"\n| fields agent_hostname, actor_effective_username, actor_process_image_path, actor_process_command_line,\naction_process_image_path, action_process_signature_vendor, action_process_signature_status,\naction_process_image_command_line\n\n\n### Query 2:\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n// Description: Search for registry key indicator matches\n\ndataset = xdr_data\n| filter event_type = ENUM.REGISTRY and action_registry_key_name contains\n\"\"\"\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\"\"\" and\n(\naction_registry_value_name = \"AgendaE\" or\naction_registry_value_name = \"AdobeUpdate\"\n)\n| fields event_type, event_sub_type, agent_hostname, actor_effective_username, actor_process_command_line, action_registry*\n\n\n### Query 3:\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n// Description: Search for SHA256, IP, or domain indicator matches\n\ndataset = xdr_data | filter\naction_file_sha256 in\n(\"09F0EA9B239385EB22F794DCECAEC1273BE87F3F118A2DA067551778971CA677\",\"56CFFE5E224ACBE5A7E19446238E5BB9110D9\nOR\naction_module_sha256 in\n(\"09F0EA9B239385EB22F794DCECAEC1273BE87F3F118A2DA067551778971CA677\",\"56CFFE5E224ACBE5A7E19446238E5BB9110D9\nOR\ndst_action_external_hostname ~=\".*crossfity.com|.*techspaceinfo.com\" OR\ndns_query_name ~=\".*crossfity.com|.*techspaceinfo.com\" OR\naction_external_hostname ~=\".*crossfity.com|.*techspaceinfo.com\" OR\naction_remote_ip in (\"185.47.128.39\",\"31.31.74.79\")\n| fields agent_hostname, agent_version,causality_actor_process_image_path, actor_process_image_path, action_file_path, action_file_sha2\n\n\n## Additional Resources\n\n[Breaking down NOBELIUM’s latest early-stage toolset](https://www.microsoft.com/security/blog/2021/05/28/breaking-down-nobeliums-latest-early-stage-toolset/)\n\n[Cozy Smuggled Into The Box: APT29 Abusing Legitimate Software For Targeted Operations In Europe](https://cluster25.io/2022/05/13/cozy-smuggled-into-the-box/)\n\n[Trello From the Other Side: Tracking APT29 Phishing Campaigns | Mandiant](https://www.mandiant.com/resources/tracking-apt29-phishing-campaigns)\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-19 - Russian APT29 Hackers Use Online Storage Services, DropBox and Google Drive.pdf"
    ],
    "report_names": [
        "2022-07-19 - Russian APT29 Hackers Use Online Storage Services, DropBox and Google Drive.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "70872c3a-e788-4b55-a7d6-b2df52001ad0",
            "created_at": "2023-01-06T13:46:39.18401Z",
            "updated_at": "2025-03-27T02:00:03.01553Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "DarkHalo",
                "StellarParticle",
                "NOBELIUM",
                "Solar Phoenix",
                "Midnight Blizzard"
            ],
            "source_name": "MISPGALAXY:UNC2452",
            "tools": [
                "SNOWYAMBER",
                "HALFRIG",
                "QUARTERRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1d3f9dec-b033-48a5-8b1e-f67a29429e89",
            "created_at": "2022-10-25T15:50:23.739197Z",
            "updated_at": "2025-03-27T02:00:55.536417Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "UNC2452",
                "NOBELIUM",
                "StellarParticle",
                "Dark Halo"
            ],
            "source_name": "MITRE:UNC2452",
            "tools": [
                "Sibot",
                "Mimikatz",
                "Cobalt Strike",
                "AdFind",
                "GoldMax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "5b748f86-ac32-4715-be9f-6cf25ae48a4e",
            "created_at": "2024-06-04T02:03:07.956135Z",
            "updated_at": "2025-03-27T02:05:17.407352Z",
            "deleted_at": null,
            "main_name": "IRON HEMLOCK",
            "aliases": [
                "ATK7 ",
                "Blue Kitsune ",
                "Cozy Bear ",
                "The Dukes",
                "UNC2452 ",
                "YTTRIUM ",
                "APT29 "
            ],
            "source_name": "Secureworks:IRON HEMLOCK",
            "tools": [
                " CozyCar",
                " CozyDuke",
                " DiefenDuke",
                " FatDuke",
                " HAMMERTOSS",
                " LiteDuke",
                " MiniDuke",
                " OnionDuke",
                " PolyglotDuke",
                " RegDuke",
                " RegDuke Loader",
                " SeaDuke",
                " Sliver",
                "CosmicDuke"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a241a1ca-2bc9-450b-a07b-aae747ee2710",
            "created_at": "2024-06-19T02:03:08.150052Z",
            "updated_at": "2025-03-27T02:05:17.409596Z",
            "deleted_at": null,
            "main_name": "IRON RITUAL",
            "aliases": [
                "Blue Dev 5 ",
                "BlueBravo ",
                "Cloaked Ursa ",
                "CozyLarch ",
                "Dark Halo ",
                "Midnight Blizzard ",
                "NOBELIUM ",
                "StellarParticle ",
                "UNC2452 ",
                "APT29"
            ],
            "source_name": "Secureworks:IRON RITUAL",
            "tools": [
                " Cobalt Strike",
                " EnvyScout",
                " GoldFinder",
                " GoldMax",
                " NativeZone",
                " RAINDROP",
                " SUNBURST",
                " Sibot",
                " TEARDROP",
                " VaporRage",
                "Brute Ratel C4"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46b3c0fc-fa0c-4d63-a38a-b33a524561fb",
            "created_at": "2023-01-06T13:46:38.393409Z",
            "updated_at": "2025-03-27T02:00:02.822155Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "The Dukes",
                "Minidionis",
                "Grizzly Steppe",
                "G0016",
                "Blue Kitsune",
                "BlueBravo",
                "SeaDuke",
                "Cloaked Ursa",
                "YTTRIUM",
                "ATK7",
                "Nobelium",
                "UAC-0029",
                "Group 100",
                "COZY BEAR",
                "IRON HEMLOCK",
                "TA421",
                "ITG11"
            ],
            "source_name": "MISPGALAXY:APT29",
            "tools": [
                "QUARTERRIG",
                "SNOWYAMBER",
                "HALFRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535875,
    "ts_updated_at": 1743041794,
    "ts_creation_date": 1660792923,
    "ts_modification_date": 1660792923,
    "files": {
        "pdf": "https://archive.orkl.eu/329f3d643d093a1dc299d8fd219208f6bba58069.pdf",
        "text": "https://archive.orkl.eu/329f3d643d093a1dc299d8fd219208f6bba58069.txt",
        "img": "https://archive.orkl.eu/329f3d643d093a1dc299d8fd219208f6bba58069.jpg"
    }
}