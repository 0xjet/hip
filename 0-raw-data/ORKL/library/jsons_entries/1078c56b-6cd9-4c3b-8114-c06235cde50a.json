{
    "id": "1078c56b-6cd9-4c3b-8114-c06235cde50a",
    "created_at": "2022-10-25T16:48:19.910058Z",
    "updated_at": "2025-03-27T02:06:02.999122Z",
    "deleted_at": null,
    "sha1_hash": "c7cee789438ab54ef5a2f49e4ceaa7880b56976e",
    "title": "NEWLY OBSERVED CRYPTOMINER.v4",
    "authors": "",
    "file_creation_date": "2018-03-26T17:54:12Z",
    "file_modification_date": "2018-03-26T17:54:01Z",
    "file_size": 19876001,
    "plain_text": "# NEWLY OBSERVED CRYPTOMINER\n\n### Max Henderson | Security Analyst\n\n\n-----\n\nPondurance’s Threat Hunting and Response (TH+R) team has encountered a variety of Cryptocurrency Miner outbreaks\nthroughout the first quarter of 2018, led by the prevalent and crippling WannaMine Cryptominer that desires 100% CPU usage\nand renders affected systems virtually unusable. WannaMine is particularly innovative due to incorporating a credentialharvesting module and the EternalBlue SMBv1 exploit to perform lateral movements and privilege escalation on a victim\nnetwork. On March 22, 2018, when Pondurance’s TH+R team observed a large quantity of systems downloading PowerShell\n.ps1 scripts combined with connections to cryptomining pools, their fear was another WannaMine outbreak. However, upon\nfurther observation, they realized the outbreak was from a newly observed Cryptominer.\n\n## TECHNICAL CHAIN OF EVENTS\n\nAll affected systems exhibited the same sequence of HTTP GET requests from an external server hosted at 191.101.21.81.\nThese requests included one .ps1 file, six .txt files, and one .xml file (Fig. 1).\n\nFigure 1: This shows the series of GET requests from the attacker’s server that initiated the infection process\n\nThe first PowerShell script arrived in plaintext and downloaded the remaining files, in addition to revealing various\npersistence mechanisms for the malware. This malware appears to differ from other miners in that it modifies the following\nregistry keys:\n\nHKLM:\\SOFTWARE\\Policies\\Power\\PowerSettings -Name a -Value $a\nHKLM:\\SOFTWARE\\Policies\\Power\\PowerSettings -Name b -Value $b\nHKLM:\\SOFTWARE\\Policies\\Power\\PowerSettings -Name c -Value $c\nHKLM:\\SOFTWARE\\Policies\\Power\\PowerSettings -Name d -Value $d\nHKLM:\\SOFTWARE\\Policies\\Power\\PowerSettings -Name e -Value $e\nHKLM:\\SOFTWARE\\Policies\\Power\\PowerSettings -Name x -Value $firstScript\n\nFrom here, the PowerShell script establishes the ReportScriptErrors.xml as a Scheduled Task. The final step of this script\nlaunched a powercfg.exe process, with the apparent goal of retaining the ability to wake from sleep (Fig. 2).\n\nFigure 2: Excerpt from the initial PowerShell script shows the launching of a powercfg.exe process\n\n\n-----\n\ncontaining data consistent with an executable, but only a_32.txt held the executable identifying MZ header. Pondurance\nappended these in reverse order and decoded the base64 to reach an executable approximately 1MB in size that was\ncompiled on 03-19-2018. This executable was observed reaching out to two different IPs for mining purposes. Additionally, a\nthird and unused mining IP was found in the executable’s code. The final script, first_script.txt, fed commands into\nPowerShell.exe and also referenced calls to the Invoke_ReflectivePEInjection, often leveraged in pentesting, which is used to\ninject executable code into legitimate processes. At this time, the specific code that may have been injected has not been\ndetermined. Additionally, there remains a partial custom-encoded portion of this script that Pondurance has not fully decoded\nyet.\n\nPondurance also leveraged their pre-deployed EDR agent to identify a malicious PowerShell.exe instance (Fig. 3) that was\nlaunched from \\sys32\\taskeng.exe (taskeng.exe was launched by \\sys32\\svchost.exe). This PowerShell process held open a\ntcp connection to 142.91.104.87 over port 80.\n\nFigure 3: PowerShell instance launched by the CryptoMiner\n\nIt was determined that all affected systems resided in a network that was not connected to the victim’s domain and did not\nleverage Active Directory. Additionally, it was then uncovered that this environment was maintained by a vendor that\nleveraged a remote access agent for each system in the environment. After the victim contacted the vendor, the vendor\nacknowledged they had been compromised and potentially affected a large number of clients.\n## CONCLUSION\n\nWhile this malware did not appear to possess the lateral-moving capabilities and exfiltration capabilities of WannaMine, it\ndoes present a significant concern for 3rd party remote access and privileges in a network. Had this network been connected\nto the main victim domain, the risk of further compromise would have been significantly higher.\n\nIndicators of Compromise (IOCs):\nIP: 191.101.21.81\nIP: 142.91.104.87\nIP: 138.128.5.66\nIP: 45.76.34.221 (Unobserved, referenced in code)\nHash: e11d84d970bb8e5000bda9ed7f241ce9\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        }
    ],
    "references": [
        "https://www.pondurance.com/wp-content/uploads/2018/03/NEWLY-OBSERVED-CRYPTOMINER_Final.pdf"
    ],
    "report_names": [
        "NEWLY-OBSERVED-CRYPTOMINER_Final.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041162,
    "ts_creation_date": 1522086852,
    "ts_modification_date": 1522086841,
    "files": {
        "pdf": "https://archive.orkl.eu/c7cee789438ab54ef5a2f49e4ceaa7880b56976e.pdf",
        "text": "https://archive.orkl.eu/c7cee789438ab54ef5a2f49e4ceaa7880b56976e.txt",
        "img": "https://archive.orkl.eu/c7cee789438ab54ef5a2f49e4ceaa7880b56976e.jpg"
    }
}