{
    "id": "f20aedbf-f7a2-465a-b3f1-1fc3f927e192",
    "created_at": "2023-01-12T15:06:44.140802Z",
    "updated_at": "2025-03-27T02:06:00.81059Z",
    "deleted_at": null,
    "sha1_hash": "d950930983eb63da6acd157f48faff790ebd3a5c",
    "title": "2018-03-22 - GhostMiner- Cryptomining Malware Goes Fileless",
    "authors": "",
    "file_creation_date": "2022-05-27T19:10:47Z",
    "file_modification_date": "2022-05-27T19:10:47Z",
    "file_size": 704860,
    "plain_text": "# GhostMiner: Cryptomining Malware Goes Fileless\n\n**blog.minerva-labs.com/ghostminer-cryptomining-malware-goes-fileless**\n\n[Tweet](https://twitter.com/share)\n\nCybercriminals are increasingly relying on malicious cryptominers as a way of making money online, often shifting from using\nransomware or diversifying revenue streams.\n\n[Though in late 2017 these activities were relatively niche, as illustrated by the case of the WaterMiner, 2018 has shown the use of](https://blog.minerva-labs.com/waterminer-a-new-evasive-crypto-miner?hsLang=en-us)\n[increasingly aggressive tactics to deploy malicious miners, including the use of advanced exploit kits.](https://blog.malwarebytes.com/threat-analysis/2018/01/rig-exploit-kit-campaign-gets-deep-into-crypto-craze/)\n\nSecurity vendors reacted by improving their detection capabilities; however, as we have seen in the past, cyber criminals remain one\nstep ahead of the defenders, this time shifting to fileless techniques in order to remain undetected.\n\nThis post describes a recent attack Minerva’s research team dissected, dubbed GhostMiner, after our solution prevented this infection at\na customer site. It provides an example of how malicious miners are evolving to use advanced fileless techniques to succeed in mining\nMonero and spreading silently on a global scale. In this attack, we also witnessed how competing miners are fighting each other to\ngenerate more income for themselves, removing other miners on the endpoint. Minerva Labs analyzed the attack and presents a novel\nway of turning the tables on mining attackers by using their scripts to remove competitors, against them.\n\n### Dissecting GhostMiner – How it Spreads and Mines\n\n The Use of Fileless Evasion Frameworks\n\nThe core activity of GhostMiner’s components was performed by a compiled malicious Windows executable. To stay undetected, the\n[executable relied on a couple of nested PowerShell evasion frameworks - Out-CompressedDll and](https://github.com/PowerShellMafia/PowerSploit/blob/master/ScriptModification/Out-CompressedDll.ps1) [Invoke-ReflectivePEInjection, which](https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1)\nemployed fileless techniques to conceal the presence of the malicious program.\n\n\n-----\n\n_Two PowerShell frameworks wrap the payload which is unpacked directly into the memory at runtime_\n\nEach component was launched from a different PowerShell script:\n\n_ps1: in charge of propagation by infecting new victims,_\n_ps1 (or WMI64.ps1 on x64 machines): mining Monero cryptocurrency_\n\n[This evasive approach was highly effective at bypassing many security tools: some of the payloads analyzed were fully undetected by all](https://www.virustotal.com/#/file/40a507a88ba03b9da3de235c9c0afdfcf7a0473c8704cbb26e16b1b782becd4d/detection)\nthe security vendors:\n\n_WMI.ps1 malicious miner goes undetected by all security vendors, analysis results as of March 21 2018st_\n\n[This amazing result can be compared with the compiled executable below from the same actors, implementing the same functionality of](https://www.virustotal.com/#/file/97e1338de44f8c8799e2d0e0f32a1362a6084004ec64c754950e8bde50a33735/detection)\nthe miner hidden within WMI.ps1. Once the miner doesn’t use a fileless technique, 41 vendors now detect the malicious payload:\n\n_Miner now detected once fileless techniques are not used_\n\nMinerva’s [Memory Injection Prevention thwarted the fileless attack from both spreading and mining as it tried to unpack in memory.](https://minerva-labs.com/memory-injection)\n\n### Spreading GhostMiner\n\nNeutrino.ps1 infects new victims, seeking and attacking servers running the following applications:\n\n[Oracle’s WebLogic (using CVE-2017-10271, similar case already reported by FireEye)](https://nvd.nist.gov/vuln/detail/CVE-2017-10271)\nMSSQL\n\n\n-----\n\nphpMyAdmin\n\nDespite the potential of targeting several applications, the attacks analyzed only aimed to exploit WebLogic servers. The malware\naccomplished this by randomly probing IP addresses, creating numerous new TCP connections each second with the expectation of\neventually finding a vulnerable target.\n\n_The distribution component of the miner scans for exploitable WebLogic servers on TCP port 7001_\n\nTo avoid detection by network security tools, this component of the attack communicates with its C2 server over HTTP by encoding\nrequests and replies in Base64. Messages are exchanged using a protocol which includes a simple hand shake followed by a request to\nperform various tasks, such as, infect other servers or take screenshots. Once the task is completed, the client will report to the C2 and\nrequest another task:\n\nIn the following example, the original encoded message was blurred for confidentiality reasons; however, we added in the core elements\nof the decoded content to display key aspects of the message. The request (in red) includes a request for a new task with identifiers of\nthe infected endpoint, the response (in blue) orders the malware to initiate a random hunt for exploitable WebLogic servers:\n\n\n-----\n\n_HTTP request and response example which demonstrates how the threat was spread e.g. a task to scan and exploit WebLogic servers_\n\nNote the referrer header is hard-coded: qq.com which is one of the most popular Chinese websites. This, alongside other indicators we\nfound, suggests that the attacker crafted the malicious HTTP requests to hide in organizations with Chinese-speaking users.\n\nHow Mining was Performed in GhostMiner\n\nThe mining component itself, as mentioned above, is launched directly from memory using the evasion frameworks described above. It\nis a slightly customized version of the open source XMRig miner, as we observed in its outgoing traffic:\n\nDuring the time of analysis, the operation was already running for roughly three weeks:\n\n_Attackers’ address stats, courtesy of_ _[http://www.minexmr.com](http://www.minexmr.com/)_\n\n\n-----\n\nAs of the date of this publication, the accumulated sum in the XMR wallet associated with this campaign was a mere 1.03 XMR,\nequivalent to just over $200. However, it is highly plausible that there are other addresses used in this campaign, undetectable due to\nMonero’s anonymity features.\n\nAnother potential explanation for the low “revenues” of the GhostMiner campaign is the aggressive rivalry between mining gangs. There\nare plenty of potential victims, but the exploits and techniques they use are public. The attackers are aware that their competitors share\nthe same toolset and try to infect the same vulnerable machines.\n\n### Eliminating Malicious Mining Competitors\n\nThe battle on exploitable endpoints is fierce. This miner starts its operation only after eliminating the competition–killing any miner on the\nendpoint that they can identify. The sample we analyzed implemented a wide range of techniques, some weren’t reported before,\nincluding:\n\nKill running miners using PowerShell’s “Stop-Process -force” command, detecting it by a hard-coded blacklist\nStop and delete miner blacklisted services by name using exe\nRemove miners that run as blacklisted scheduled tasks by the task name using exe\nStop and removie miners by their commandline arguments, e.g. if one of the arguments contains the word “*cryptonight*”–using\nWMI and PowerShell\nStop and remove miners by going through the list of established TCP connections, looking for ports associated with miners (the\ndata is collected using exe)\n\n_Detecting and removing other miners by their arguments_\n\n[In the past, malware researchers such as Xavier Mertens (@xme)](https://twitter.com/xme) [suggested that defenders can use scripts similar to the “competitors](https://isc.sans.edu/forums/diary/The+Crypto+Miners+Fight+For+CPU+Cycles/23407/)\nkiller” we’ve found as an IOC list to detect systems compromised by malicious miners.\n\nWe suggest taking it a bit further and consider running a slightly modified version of the “killer script” as an aid for incident response\nteams. We believe that it is a good starting point for writing one’s own PowerShell script for removing malicious miners. The script is\nprovided in Minerva’s research team’s [GitHub account.](https://github.com/MinervaLabsResearch/BlogPosts/tree/master/MinerKiller)\n\nIt implements all the aforementioned tactics – removing known processes, tasks and services by name and unfamiliar ones by\narguments or TCP connections typical to miners.\n\n**Note that MinerKiller is provided as-is with no liability, use it only if you know what you are doing! It might stop or even delete**\n**important processes in some cases!**\n\n**_Interested to learn more about what we’re doing here at Minerva to protect endpoints?_**\n\n[Book a demo at RSA 2018, we’ll be at booth #2329, Moscone South or come hear us as BSides San Francisco on April 15 where ourth](https://l.minerva-labs.com/schedule-a-meeting-with-minerva-labs-us-at-rsa-2018?hsLang=en-us)\n[VP Research and co-founder, Omri Moyal will be talking about the Rise of Coinminers.](https://bsidessf2018.sched.com/event/E6ir)\n\n## IOCs\n\nC2 IP Address:\n\n123[.]59[.]68[.]172\n\n\n-----\n\nHashes (SHA 256)\n\nNeutrino.ps1:\n\n4b9ce06c6dc82947e888e919c3b8108886f70e5d80a3b601cc6eb3752a1069a1\n9a326afeeb2ba80de356992ec72beeab28e4c11966b28a16356b43a397d132e8\nWMI.ps1:\n\n40a507a88ba03b9da3de235c9c0afdfcf7a0473c8704cbb26e16b1b782becd4d\nWMI64.ps1:\n\n8a2bdea733ef3482e8d8f335e6a4e75c690e599a218a392ebac6fcb7c8709b52\nAssociated Monero address:\n\n43ZSpXdMerQGerimDrUviDN6qP3vkwnkZY1vvzTV22AbLW1oCCBDstNjXqrT3anyZ22j7DEE74GkbVcQFyH2nNiC3fchGfc\n\n\n-----\n\nKiller script:\n\nService names\n\nxWinWpdSrv\nSVSHost\nMicrosoft Telemetry\nlsass\nMicrosoft\nsystem\nOracleupdate\nCLR\nsysmgt\ngm\nWmdnPnSN\nSougoudl\nNationaaal\nNatimmonal\nNationaloll\nTask names\n\nMysa\nMysa1\nMysa2\nMysa3\nok\nOracle Java\nOracle Java Update\nMicrosoft Telemetry\nSpooler SubSystem Service\nOracle Products Reporter\nUpdate service for products\ngm\nngm\nProcess names\n\nmsinfo\nxmrig*\nminerd\nMinerGate\nCarbon\nyamm1\nupgeade\nauto-upgeade\nsvshost\nSystemIIS\nSystemIISSec\nWindowsUpdater*\nWindowsDefender*\nupdate\ncarss\nservice\ncsrsc\ncara\njavaupd\ngxdrv\nlsmosee\n\n\n-----\n\nMiner related server side TCP ports\n\n1111\n2222\n3333\n4444\n5555\n6666\n7777\n8888\n9999\n14433\n14444\n45560\n65333\n55335\nMiner related command line arguments\n\n*cryptonight*\n*stratum+*\n*--donate-level*\n*--max-cpu-usage*\n*-p x*\n*pool.electroneum.hashvault\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-03-22 - GhostMiner- Cryptomining Malware Goes Fileless.pdf"
    ],
    "report_names": [
        "2018-03-22 - GhostMiner- Cryptomining Malware Goes Fileless.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536004,
    "ts_updated_at": 1743041160,
    "ts_creation_date": 1653678647,
    "ts_modification_date": 1653678647,
    "files": {
        "pdf": "https://archive.orkl.eu/d950930983eb63da6acd157f48faff790ebd3a5c.pdf",
        "text": "https://archive.orkl.eu/d950930983eb63da6acd157f48faff790ebd3a5c.txt",
        "img": "https://archive.orkl.eu/d950930983eb63da6acd157f48faff790ebd3a5c.jpg"
    }
}