{
    "id": "94aa1949-73a9-4b08-8cce-b0f43c686387",
    "created_at": "2023-01-12T15:10:33.904843Z",
    "updated_at": "2025-03-27T02:16:25.974322Z",
    "deleted_at": null,
    "sha1_hash": "1c00331fc66fcd700d9b8c73c5adb8183403899b",
    "title": "2014-09-23 - Android malware based on SMS encryption and with KitKat support",
    "authors": "",
    "file_creation_date": "2022-05-28T19:32:01Z",
    "file_modification_date": "2022-05-28T19:32:01Z",
    "file_size": 177951,
    "plain_text": "# Android malware based on SMS encryption and with KitKat support\n\n**[maldr0id.blogspot.ch/2014/09/android-malware-based-on-sms-encryption.html](http://maldr0id.blogspot.ch/2014/09/android-malware-based-on-sms-encryption.html)**\n\n≈Åukasz\n\nMost of the malware based on the SMS C&C communication channel is not compatible with\nAndroid 4.4 KitKat. This is due to the fact that KitKat introduced a concept of one messaging\napp, which all other apps had to go trough before they send or handle a received text\nmessage. This prevented malware from hiding received short messages or sending without\nsaving them in the \"Sent\" folder.\n\nWell, it wasn't hard to predict that this state of affairs wouldn't last long and that malware\nauthors would eventually catch up. Malware described here not only supports KitKat, but\n[also uses an open-source SMS encryption tool as a basis for its code. Let's have a look at](https://play.google.com/store/apps/details?id=org.thoughtcrime.securesms)\nthe insides of the new sample (hash: 84e2e9e8430792b583d02d3cc1bf8535) and let's call it\nSmsSecure, just for the sake of brevity.\n\n## Open-source encryption\n\nI have to say that I did lie a bit. Well, I didn't tell the whole truth. Commands sent trough the\nSMS channel are not encrypted per se. Only the code for secure messaging is used as a\nbasis for this malware, presumably because it supports Android 4.4 out-of-the-box and it is\neasier to encourage users to install \"Secure SMS\" application as a main messaging app. It\nhas the same package name, org.thoughtcrime.securesms and hides main portion of its\ncode in the x* (namely xlibs, xservices, xpack, xbroadcast) subpackages. These are\nresponsible e.g. for sending received text messages to the C&C server.\n\n\n-----\n\nThere are two channels of communication: one trough unencrypted text messages and the\nother one trough POST requests, which body is encrypted using blowfish. So, all of this talk\nabout \"encrypted SMS\" is just a scam.\n\n## Emulator detection and other techniques\n\nWhat we are used to is that the Android malware increasingly has a code that detects\nwhether it is run on the emulator or not. There are couple of usual checks (e.g. phone model)\nand a couple of unusual checks illustrated below.\n\nNot that frequent technique is checking for the Network Operator and SIM Operator name.\nThese names are hardcoded in the emulator and are equal to Android.\n\nAnother interesting feature is the configuration. Configuration is stored as the Raw\nResources, because it is encrypted. Encryption method is Blowfish/CBC\n(IV=\"12345678\") and the key is stored in the resource cleverly called blfs.key and the\nconfiguration is encrypted in two files named in the same cunning way: config.cfg and\nconfig1.cfg. However, if you try to just decode the configs using the key provided, you will\nfail. Key is somewhat \"obfuscated\" using a byte2hex function outlined below.\n\nIt takes every byte in the key file, renders it to a hexstring and then construct a new string of\nthis hexstrings. The function that gets the key limits it size to 50 bytes. So instead of the key:\n\nNfvnkjlnvkjKCNXKDKLFHSKD:LJmdklsXKLNDS:<XObcniuaebkjxbcz\n\n\n-----\n\nwe get:\n\n4e66766e6b6a6c6e766b6a4b434e584b444b4c4648534b443a\n\nReally clever obfuscation technique. After decrypting the configuration files we get two\nbeautiful XMLs:\n\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<config>\n<data rid=\"25\"\nshnum10=\"\" shtext10=\"\" shnum5=\"\" shtext5=\"\" shnum3=\"\" shtext3=\"\" shnum1=\"\"\nshtext1=\"\"\ndel_dev=\"0\"\nurl_main=\"\"\nurl_data=\"\"\nurl_sms=\"\"\nurl_log=\"\"\nphone_number=\"+43676800505476\"\ndownload_domain=\"ttt\"\nready_to_bind=\"0\" />\n\n</config>\n\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<config>\n<data rid=\"25\"\nshnum10=\"\" shtext10=\"\" shnum5=\"\" shtext5=\"\" shnum3=\"\" shtext3=\"\" shnum1=\"\"\nshtext1=\"\"\ndel_dev=\"0\"\nurl_main=\"\"\nurl_data=\"\"\nurl_sms=\"\"\nurl_log=\"\"\nphone_number=\"15555215554\"\nready_to_bind=\"0\" />\n</config>\n\nSee if you can spot the fake one. Anyhow, that's it for the text-based C&C, but what about\nthe HTTP-based dropzone? Well, there isn't any URL hard coded. The dropzone URL comes\nvia the text command.\n\n## SMS commands\n\n\n-----\n\nEach command is send in a following form (the originating number is completely ignored):\n\n<control_code> <command> <number> <service_code>\n\nTwo last values are optional. control_code should be one of the 6-digit predefined codes.\nservice_code is a number to which the logs will be send (as a text messages) and will be\nupdated no matter what the issued command is. What are the possible commands? Well,\nthere are eleven of them, listed below.\n\nSTART - starts redirecting all text messages to the number (service_code is ignored)\nby setting the RTB (ready to bind) value to 2 and sending the \"Service Started\" SMS to\nthe number.\nSTARTB - starts redirecting all text messages to the number URL (URLs are for some\nreason called \"buffers\") by setting the RTB value to 1 and sending the message as\nabove (but via HTTP).\nSTOP - command complimentary to the START and STARTB commands. Sets the\nRTB value to 0 and sends \"Service stopped\" SMS/POST request to the number.\nDEL - removes the application. Just like that. But you still have to send the correct\ncontrol_code. Sends back the \"Delete command received\" to the number.\nSETB - sets what the author calls \"Buffers\". These are all the URLs needed for the\nHTTP communications. URLs are set according to the following\npattern: number/[1|2|3|4].php. First one is used for a ping-back, second one is a\ndropzone for the captured messages, third one is for the configuration update and the\nlast one is for the logs (e.g. that some action has started).\nCLEARB - clears the \"buffers\" i.e. the URLs mentioned above.\nSETP - sets the phone number that will overwrite any number that comes in the text\nmessage. Useful for using the fake number values in the subsequent commands.\nCLEARP - reverts the above setting.\nCLEAR - does both the CLEARB and CLEARP.\nLOCK - [set the password for the device to number and locks the device. I don't think](https://developer.android.com/reference/android/app/admin/DevicePolicyManager.html#resetPassword%28java.lang.String,%20int%29)\nthis feature is enabled in the mentioned sample, as the sample does not require the\nDevice Admin privileges.\nUNLOCK - clears the password and locks the device (which makes it unlockable after\nthe lock above).\n\nThe application also supports blocking messages from some numbers. These numbers\nshould be contained in the \"filters\" variable (separated by the semicolon) and can only be\nupdated via the HTTP or in the starting configs.\n\n## Summary\n\nThis is a fine example of the malware evolution - now completely compatible with KitKat. It\neven checks whether you have set it as a main messaging app already and displays a\npestering notification if not. It also tries to do some targeting based on the SIM operator (as\n\n\n-----\n\npictured below). However, this function is never used in the code, as it was probably dropped\nat some point by the authors. Anyhow, the targeted countries were supposed to be Austria,\nRussia and Switzerland.\n\nHowever, my favorite part is how they extensively log everything and use \"setted\" instead of\n\"set\".\n\n**Update**\n\n[@seckle_ch reports that the SmsSecure is used in conjunction with the retefe banking trojan,](https://twitter.com/seckle_ch/status/514791727564353536)\ntargeting Austria, Switzerland and Sweden.\n\n## Android malware goes Mono and Lua - part 2 (Ransomware)\n\n KLM's \"We'll keep you grounded\" Programme\n\n Using World War II techniques to fight ransomware\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2014/2014-09-23 - Android malware based on SMS encryption and with KitKat support.pdf"
    ],
    "report_names": [
        "2014-09-23 - Android malware based on SMS encryption and with KitKat support.pdf"
    ],
    "threat_actors": [
        {
            "id": "e58deb93-aff1-4be5-8deb-37fe8af0b7ed",
            "created_at": "2022-10-25T16:07:23.918534Z",
            "updated_at": "2025-03-27T02:02:10.02879Z",
            "deleted_at": null,
            "main_name": "Greenbug",
            "aliases": [
                "Greenbug",
                "Volatile Kitten"
            ],
            "source_name": "ETDA:Greenbug",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6bba8e81-73af-4010-86dc-d43c408ca342",
            "created_at": "2023-01-06T13:46:38.553459Z",
            "updated_at": "2025-03-27T02:00:02.860364Z",
            "deleted_at": null,
            "main_name": "Greenbug",
            "aliases": [],
            "source_name": "MISPGALAXY:Greenbug",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "25896473-161f-411f-b76a-f11bb26c96bd",
            "created_at": "2023-01-06T13:46:38.75749Z",
            "updated_at": "2025-03-27T02:00:02.910627Z",
            "deleted_at": null,
            "main_name": "CHRYSENE",
            "aliases": [
                "Greenbug"
            ],
            "source_name": "MISPGALAXY:CHRYSENE",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b6436f7b-6012-4969-aed1-d440e2e8b238",
            "created_at": "2022-10-25T16:07:23.91517Z",
            "updated_at": "2025-03-27T02:02:10.027531Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "APT 34",
                "ATK 40",
                "Chrysene",
                "Cobalt Gypsy",
                "Crambus",
                "DEV-0861",
                "EUROPIUM",
                "Earth Simnavaz",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "Helix Kitten",
                "IRN2",
                "ITG13",
                "Scarred Manticore",
                "Storm-0861",
                "TA452",
                "Twisted Kitten",
                "UNC1860",
                "Yellow Maero"
            ],
            "source_name": "ETDA:OilRig",
            "tools": [
                "AMATIAS",
                "Agent Drable",
                "Agent Injector",
                "AgentDrable",
                "Alma Communicator",
                "BONDUPDATER",
                "CACTUSPIPE",
                "Clayslide",
                "CypherRat",
                "DNSExfitrator",
                "DNSpionage",
                "DROPSHOT",
                "DistTrack",
                "DropperBackdoor",
                "Fox Panel",
                "GREYSTUFF",
                "GoogleDrive RAT",
                "HighShell",
                "HyperShell",
                "ISMAgent",
                "ISMDoor",
                "ISMInjector",
                "Jason",
                "Karkoff",
                "LIONTAIL",
                "LOLBAS",
                "LOLBins",
                "LONGWATCH",
                "LaZagne",
                "Living off the Land",
                "MailDropper",
                "Mimikatz",
                "MrPerfectInstaller",
                "OILYFACE",
                "OopsIE",
                "POWBAT",
                "POWRUNER",
                "Plink",
                "Poison Frog",
                "PowerExchange",
                "PsList",
                "PuTTY Link",
                "QUADAGENT",
                "RDAT",
                "RGDoor",
                "SEASHARPEE",
                "Saitama",
                "Saitama Backdoor",
                "Shamoon",
                "SideTwist",
                "SpyNote",
                "SpyNote RAT",
                "StoneDrill",
                "TONEDEAF",
                "TONEDEAF 2.0",
                "ThreeDollars",
                "TwoFace",
                "VALUEVAULT",
                "Webmask",
                "WinRAR",
                "ZEROCLEAR",
                "ZeroCleare",
                "certutil",
                "certutil.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536233,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653766321,
    "ts_modification_date": 1653766321,
    "files": {
        "pdf": "https://archive.orkl.eu/1c00331fc66fcd700d9b8c73c5adb8183403899b.pdf",
        "text": "https://archive.orkl.eu/1c00331fc66fcd700d9b8c73c5adb8183403899b.txt",
        "img": "https://archive.orkl.eu/1c00331fc66fcd700d9b8c73c5adb8183403899b.jpg"
    }
}