{
    "id": "fb2c918b-3935-40c5-ba28-b6372e3f6165",
    "created_at": "2023-01-12T15:05:44.512465Z",
    "updated_at": "2025-03-27T02:17:00.702711Z",
    "deleted_at": null,
    "sha1_hash": "5adba62aca65dfd9d6cb9d979ae3045fd43a7471",
    "title": "2022-02-18 - EvilPlayout- Attack Against Iran’s State Broadcaster",
    "authors": "",
    "file_creation_date": "2022-05-28T17:41:07Z",
    "file_modification_date": "2022-05-28T17:41:07Z",
    "file_size": 2735973,
    "plain_text": "# EvilPlayout: Attack Against Iran’s State Broadcaster\n\n**[research.checkpoint.com/2022/evilplayout-attack-against-irans-state-broadcaster/](https://research.checkpoint.com/2022/evilplayout-attack-against-irans-state-broadcaster/)**\n\nFebruary 18, 2022\n\nFebruary 18, 2022\nIn the past few months, a new wave of cyberattacks has been flooding Iran. These attacks are far from minor website\ndefacements – the recent wave is hitting national infrastructure and causing major disruptions to public services.\n\nThis article provides an in-depth technical analysis of one of the attacks against the Iranian national media corporation, Islamic\nRepublic of Iran Broadcasting (IRIB) which occurred in late January 2022.\n\n## Key findings\n\nOn January 27, Iranian state broadcaster IRIB became the subject of a targeted cyberattack that resulted in several staterun TV channels broadcasting footage of opposition leaders and calling for the assassination of the supreme leader. Check\nPoint Research team investigated this attack and was able to retrieve the files and forensics evidence related to the\nincident from publicly available resources.\nWe found malicious executables whose purpose was to air the protest message, in addition, we discovered evidence that\na wiper malware was used. This indicates that the attackers’ aim was also to disrupt the state’s broadcasting networks,\nwith the damage to the TV and radio networks possibly more serious than officially reported.\nAmong the tools used in the attack, we identified malware that takes screenshots of the victims’ screens, several custommade backdoors, and related batch scripts and configuration files used to install and configure the malicious executables.\nWe could not find any evidence that these tools were used previously, or attribute them to a specific threat actor.\nIn this article, we provide a technical analysis of the tools related to the attack, as well as the attackers’ tactics.\n\n## Background\n\n Cyberattacks Hit Iran\n\n[In July 2021, an attack hit the Iranian national railway and cargo services, and caused “unprecedented disruptions” to the](https://www.reuters.com/world/middle-east/hackers-breach-iran-rail-network-disrupt-service-2021-07-09/)\n[country’s trains. Just a day later, media outlets reported that the website of Iran’s Ministry of Roads and Urban Development, in](https://www.reuters.com/world/middle-east/iran-transport-ministry-hit-by-second-apparent-cyberattack-days-2021-07-10/)\ncharge of transportation, was taken down in a ‘cyber disruption’, preventing access to their official portal and sub-services. As if\nforcing railway employees to update the train schedule manually – across all train stations – wasn’t enough, the message\n\n\n-----\n\ndisplayed on the train schedule boards referred perplexed passengers to the Supreme Leader s office phone number. The\n[previously unknown group called ‘Predatory Sparrow’ quickly claimed responsibility for the attacks. Besides that, Check Point](https://kayhan.london/fa/1400/04/18/%D8%AD%D9%85%D9%84%D9%87-%D8%B3%D8%A7%DB%8C%D8%A8%D8%B1%DB%8C-%D8%A8%D9%87-%D8%B3%DB%8C%D8%B3%D8%AA%D9%85%E2%80%8C%D9%87%D8%A7%DB%8C-%DA%A9%D8%A7%D9%85%D9%BE%DB%8C%D9%88%D8%AA%D8%B1%DB%8C-%D8%B4%D8%B1)\n[Research investigated these attacks and the tools they deployed, and found similar tactics and techniques were used in](https://research.checkpoint.com/2021/indra-hackers-behind-recent-attacks-on-iran/)\nprevious operations against private companies in Syria, linking all of those attacks to anti-regime group called Indra.\n\nSince then, cyber-attacks continue to hit national Iranian entities. Inspecting the targets, it appears that each one was carefully\n[selected to send a tailored message. In August 2021, the hacktivist group Tapandegan, previously known for hacking and](https://www.seattletimes.com/nation-world/hackers-briefly-shut-off-airport-monitors-in-irans-tabriz/)\n[displaying protest messages on the electronic flight arrival and departure boards in the Mashad and Tabriz international airports](https://en.radiofarda.com/a/iran-hackers-post-protest-messages-mashad-airport/29250247.html)\nin 2018, [released security camera footage from the Evin prison, a Tehran facility in which many political prisoners are held. The](https://old.iranintl.com/en/iran/hackers-release-security-footage-iran%E2%80%99s-evin-prison)\nvideos, which show prisoner abuse, were acquired by a group called Edalat-e Ali (‘Ali’s justice’) in protest against human rights\n[violations. In October 2021, every gas station in Iran was paralyzed by an attack that disrupted the electronic payment process.](https://www.npr.org/2021/10/27/1049566231/irans-president-says-cyberattack-was-meant-to-create-disorder-at-gas-pumps)\nThe incident led to extremely long queues at gas stations for two days and prevented customers from paying with the\ngovernment-issued electronic cards used to purchase subsidized fuel. When the card was swiped for payment, the Supreme\nLeader office phone number appeared on the screen, taunting the highest ranking office in the regime yet again. Iranian officials\n[claimed that foreign actors, such as Israel and the US, were behind the attack. However, Predatory Sparrow](https://www.reuters.com/business/energy/iran-says-israel-us-likely-behind-cyberattack-gas-stations-2021-10-30/) [claimed](https://www.bbc.com/news/world-middle-east-59062907)\nresponsibility for this attack as well.\n\n[In November 2021, Iranian airline Mahan Air announced that it foiled an attempted attack against its internal systems, with no](https://www.bloomberg.com/news/articles/2021-11-21/iran-s-mahan-air-says-it-foiled-cyber-attack-on-systems)\n[harm done. Curiously, this time a group called ‘Hooshyaran-e Vatan’ (Vigilant of the Nation) claimed responsibility, and over the](https://www.jpost.com/breaking-news/irans-mahan-air-hit-by-cyberattack-685575)\nnext two months published documents allegedly stolen in the hack that link the airline to the IRGC (Islamic Revolutionary Guard\nCorps).\n\n[Recently, on February 7, 2022, the Edalat-e Ali group released footage from closed-circuit cameras in another Iranian prison,](https://www.iranintl.com/en/202202075594)\nGhezel Hesar.\n\n**Figure 1 – Timeline of latest cyberattacks in Iran.**\n\n## The Voice and Vision of the Islamic Republic of Iran\n\n[On January 27, only two weeks before the anniversary of the 1979 Islamic Revolution, reports were published that the IRIB,](https://www.reuters.com/world/middle-east/irans-state-broadcaster-says-it-was-hacked-10-seconds-2022-01-27/)\nIran’s national broadcaster, was hacked. The Islamic Republic of Iran Broadcasting, also called ‘The Voice and Vision of the\nIslamic Republic of Iran’, is a state-operated monopoly in charge of all radio and television services in Iran. The cyberattack\nresulted in state-run TV channels broadcasting what was described by IRIB officials as “the faces and voices of hypocrites ”\n\n\n-----\n\nHypocrites is a term used by the Iranian regime to refer to the Mujahedin e Khalq (MEK, also called the People s Mujahedin of\n[Iran), an exiled militant organization and the biggest political opposition group, which advocates overthrowing the current regime](https://www.theguardian.com/news/2018/nov/09/mek-iran-revolution-regime-trump-rajavi)\nand installing its own government, relying on an alternative interpretation of Islam. In the hijacked video, the faces of MEK\nleaders Maryam and Masoud Rajavi appeared, followed by the image of Ayatollah Khamenei crossed out with red lines and the\ndeclaration “Salute to Rajavi, death to (Supreme Leader) Khamenei!.” The deputy head of technical affairs for IRIB, Reza\nAlidadi, stated that “only the owners of the technology in use by the corporation would have been able to carry out an attack\nrelying on the system features installed on the systems and the exploited backdoor.” He further stated that similar attacks have\nhit other state-operated radio channels.\n\n**Figure 2 – Frame from the video with the opposition leaders’ faces broadcast by state-run Iranian TV channels as a**\n**result of the cyber attack.**\n\nAlthough not the part of this investigation, it is worth mentioning that several days later, on February 1, the web-based streaming\n[platform of IRIB, Telewebion, was hijacked yet again to broadcast protest messages urging citizens to rise up against the](https://www.iranintl.com/en/202202012324)\nSupreme Leader and stating that “the regime’s foundations are rattling”. Cleverly, the incident took place in the middle of a live\nbroadcast of the Iran-UAE soccer match. This time, politically motivated group Edalat-e Ali, responsible for the attacks targeting\n[prison facilities’ security cameras, claimed responsibility. This claim is plausible, as the video broadcast during the hack features](https://twitter.com/EdaalateAli1400/status/1488561598583218178)\nthe group’s logo on the top left corner.\n\n## IRIB attack artifacts\n\n[According to Iranian state-run news network Akharin Khabar (Latest News), “the technical and broadcasting systems are](https://t.me/akharinkhabar/301980)\ncompletely isolated, they are equipped with acceptable security protocols and are not accessible via the Internet.” In the same\npost, it was reported that security forces associated with the regime’s state broadcasting network considered sabotage as the\n[most likely scenario, with the Iranian officials calling the attack “extremely complex.”](https://english.alarabiya.net/News/middle-east/2022/01/27/Iran-s-state-broadcaster-says-it-was-hacked-for-10-seconds)\n\nIt is still not clear how the attackers gained initial access to these networks. We were able to retrieve only the files related to the\nlater stages of these attacks, responsible for:\n\nEstablishing backdoors and their persistence.\nLaunching the “malicious” video or audio track.\nInstalling the wiper malware in an attempt to disrupt operations in the hacked networks.\n\nAll of these samples were uploaded to VirusTotal (VT) from multiple sources, mostly with Iranian IPs, and included short batch\nscripts that install or launch payloads, several forensics artifacts like Windows Event Log files or memory dumps, and the\npayloads themselves. The latter are mostly .NET executables, with no obfuscation but a timestamped compilation date in the\n\n\n-----\n\nfuture. In addition to having the same language and same VT submitters, these files also share other similarities, such as PDB\npaths, common commands, names, code reuse, and general coding style.\n\n## Hijacking broadcast signals\n\nFrom the MP4 video file that was used to interrupt the TV stream, and was uploaded to VT as `TSE_90E11.mp4, we were able`\nto pivot to other artifacts related to the broadcast hijacking, supposedly run on servers that broadcast TV programs (playouts).\nTo play the video file, the attackers used a program called `SimplePlayout.exe, a .NET-based executable compiled in debug`\nmode with the PDB path `c:\\work\\SimplePlayout\\obj\\Debug\\SimplePlayout.pdb . This executable has a single`\nfunctionality: to play a video file in a loop using the .NET MPlatform SDK by Medialooks.\n\n**Figure 3 – Part of the SimplePlayout code using MPlatform SDK to play the video file.**\n\nFirst, the SimplePlayout program looks for a configuration file called `SimplePlayout.ini which contains two lines: the video`\nfile path, and a number representing the video format. The respective `SimplePlayout.ini file uploaded together with`\nSimplePlayout specifies the values that correspond to the MP4 file located at `c:\\windows\\temp\\TSE_90E11.mp4 and a video`\nformat of HD 1080i with a refresh rate of 50 Hz.\n\nTo kill the video stream already playing, the attackers used a batch script called `playjfalcfgcdq.bat . It kills the running`\nprocess and deletes the executable of TFI Arista Playout Server, a software which the IRIB is [known to use for broadcasting,](https://rd.irib.ir/documents/25760057/f39f659c-8a0b-42f3-a1e9-d716cd5b8afe)\nand subsequently uninstalls the Matrox DSX driver, a part of the software for media processing in virtualized broadcast\ninfrastructures,\n\nTo combine all the malicious components, another script `layoutabcpxtveni.bat does several things:`\n\nRenames the MP4 video file located at `c:\\windows\\temp\\TSE_90E11.003 to` `TSE_90E11.mp4 . This file was probably`\ndropped there by one of the backdoors, which we discuss later.\nKills the running process of `QTV.CG.Server.exe, possibly a part of Autocue QTV broadcasting software, and overwrites`\nthe original server located at `D:\\CG 1400\\QTV.CG.Server.exe with SimplePlayout, the tool used by the attackers to play`\ntheir video.\nCopies `c:\\windows\\SimplePlayout.exe to` `SimplePlayout.ini in the same directory where` `QTV.CG.Server.exe`\nresides. At least this sample of the batch script contains a typo, as the actors probably meant to copy\n```\n   SimplePlayout.ini next to the malicious executable.\n\n```\nRuns `SimplePlayout.exe from both the initial and replaced locations.`\n\n\n-----\n\nIn another set of related artifacts that we discovered, the attackers utilize the WAV file containing the 25 seconds audio track\ntitled `TSE_90E11.001, similar to the file name of the MP4 file used in the hijacked TV stream. An executable called` `Avar.exe`\n[is based on NAudio, an open-source .NET audio library, and is responsible for playing the WAV file. Unlike the](https://github.com/naudio/NAudio)\n```\nSimplePlayout.exe, Avar.exe does not rely on the configuration file. Instead, it contains the path to the WAV file hardcoded\n\n```\nas `C:\\windows\\temp\\TSE_90E11.001 . After it executes,` `Avar.exe attempts to enumerate through all active audio devices`\nand play the WAV file on each one.\n\nFinally, a batch script named `avapweiguyyyw.bat puts the pieces together. It kills a process called` `ava.exe and replaces`\nthe executable at `C:\\Program Files\\MIT\\AVA\\ava.exe with` `Avar.exe . The use of the name Ava in the files and folders`\n[might suggest that these files were intended for IRIB’s AVA radio, although the fact it was also impacted by this attack has not](https://english.mojahedin.org/news/iran-news/iran-state-tv-radio-massoud-maryam-rajavi-khamenei-irib-20220127/)\nbeen confirmed officially.\n\n## The Wiper\n\nWe found two identical .NET samples named `msdskint.exe whose main purpose is to wipe the computer’s files, drives, and`\nMBR. This can also be deduced from the PDB path: `C:\\work\\wiper\\Wiper\\obj\\Release\\Wiper.pdb . In addition, the`\nmalware has the capability to clear Windows Event Logs, delete backups, kill processes, change users’ passwords, and more.\nBoth samples were uploaded to VT by the same submitters and in the same timeframe as the previously discussed artifacts.\n\n**Figure 4 – Overview of the wiper capabilities.**\n\nThe wiper has three modes to corrupt the files, and fills the bytes with random values:\n\ndefault – Overwrite the first 200 bytes of each chunk of 1024 bytes in the file.\n```\n   light-wipe – Overwrite a number of chunks specified in the configuration.\n   full_purge – Overwrite the entire file content.\n\n```\nThe wiper gets its configuration for the wiping process in one of these ways: in command-line arguments, or from the hardcoded\ndefault configuration and exclude list in the file <code>meciwipe.ini</code>. The default configuration contains a pre-defined list\nof exclusions related to Windows OS and Kaspersky and Symantec security products, which are widely used in Iran:\n\n\n-----\n\n```\n  g p\n\"-stop-iis\",\n\"-logs\",\n\"-shadows\",\n\"-processes\",\n\"*sql\",\n\"-mbr\",\n\"-fork-bomb\",\n\"-wipe-all\",\n\"-wipe-stage-2\",\n\"-wipe-exclude\", \"C:\\\\\\\\Windows\",\n\"-wipe-exclude\", \"C:\\\\\\\\$Recycle.Bin\",\n\"-wipe-exclude\", \"C:\\\\\\\\$WinREAgent\",\n\"-wipe-exclude\", \"C:\\\\\\\\Config.Msi\",\n\"-wipe-exclude\", \"C:\\\\\\\\Recovery\",\n\"-wipe-exclude\", \"C:\\\\\\\\Program Files\\\\\\\\IBM\\\\\\\\*\",\n\"-wipe-exclude\", \"C:\\\\\\\\System Volume Information\",\n\"-wipe-exclude\", \"C:\\\\\\\\Program Files\\\\\\\\Symantec*\",\n\"-wipe-exclude\", \"C:\\\\\\\\Program Files (x86)\\\\\\\\Symantec*\",\n\"-wipe-exclude\", \"C:\\\\\\\\Program Files\\\\\\\\Kaspersky*\",\n\"-wipe-exclude\", \"C:\\\\\\\\Program Files (x86)\\\\\\\\Kaspersky*\",\n\"-wipe-exclude\", \"C:\\\\\\\\Program Files\\\\\\\\Microsoft*\",\n\"-wipe-exclude\", \"C:\\\\\\\\Program Files (x86)\\\\\\\\Microsoft*\",\n\"-wipe-exclude\", \"C:\\\\\\\\Program Files\\\\\\\\Windows*\",\n\"-wipe-exclude\", \"C:\\\\\\\\Program Files (x86)\\\\\\\\Windows*\"\n\n```\nIf the malware has no arguments, it runs as a service named “ Service1 ”.\n\nThe main wiper function computes the FNV1A32 hash of every argument and uses that to determine the action:\n\n**Arguments** **Options** **Action**\n\n\n“-forkbomb”\n\n“-sessions”\n\n“-deleteusers”\n\n“-breakusers”\n\n\nfile_path or list of users\n(* = all users)\n\nfile_path or list of users\n(* = all users)\n\n\nStart two more instances of the wiper, with the “-fork-bomb” argument as well\n\nKill other users sessions with the cmd commands: `logoff {0} and rwinsta {0}`\n\nDelete the specified users using the cmd command: `net user {0} /delete`\n\nBreak the specified users by changing their password to an 8-bytes random string\nappended with “ aA1! ”\n\n\n“-logs” – Delete events from Windows Event Log using the cmd command: `for /F`\n```\n                    \\\"tokens=*\\\" %1 in ('wevtutil.exe el') DO wevtutil.exe cl \\\"%1\\\"\n\n```\n\n“passwords”\n\n\n– None\n\n\n“-shadows” – Destroy shadow copies using the cmd command: `echo delete shadows all >`\n```\n                    1.s && diskshadow /s 1.s && del 1.s\n\n```\n“-start-iis” – Start Internet Information Services (IIS) with `iisreset /start`\n\n“-stop-iis” – Stop Internet Information Services (IIS) with `iisreset /stop`\n\n“-config” file_path Read the arguments from the specified config file\n\n“-light-wipe” size Corrupt only specified size of 1024-byte chunks in a file\n\n\n“-wipeexclude”\n\n“-delete”\n\n“processes”\n\n\nlist of directories Add the directories that the wiper won’t wipe\n\n\nfile_path or list of\nprocesses (* = all\nprocesses)\n\n\nKill the specified processes using the cmd command: `taskkill /PID {0} /f`\n\n\n-----\n\n**Arguments** **Options** **Action**\n\n\n“-wipestage-2”\n\n\n– Enable `wipe_stage_2 flag which means wiping the files by default method and`\nthen delete them\n\n\n“-purge” – Enable `full_purge flag which means corrupting the whole file and not only`\nchunks\n\n“-wipe-only” file_path or list of files Add a list of files to wipe\n\n“-wipe-all” – Wipe all the files with supported extensions\n```\nDestroyMBR flag enables the malware to wipe the MBR by writing a hardcoded base64-encoded binary to the file\nprecg.exe and then running it. precg.exe is an MBRKiller based on the Gh0stRAT MBR wiper.\n\n```\nThe main wiping procedure starts by searching for the last file that was wiped. The malware writes its path to the file named\n```\nlastfile (or lastfile2 in the case of wipe_stage_2). Then, every file is checked to see if it is excluded or its extension is\n\n```\nnot in the predefined list:\n```\n\".accdb\", \".cdx\", \".dmp\", \".h\", \".js\", \".pnf\", \".rom\", \".tif\", \".wmdb\", \".acl\", \".cfg\", \".doc\", \".hlp\",\n\".json\", \".png\", \".rpt\", \".tiff\", \".wmv\", \".acm\", \".chk\", \".docx\", \".hpi\", \".lnk\", \".pps\", \".rsp\",\n\".tlb\", \".xdr\", \".amr\", \".com\", \".dot\", \".htm\", \".log\", \".ppt\", \".sam\", \".tmp\", \".xls\", \".apln\", \".cpl\",\n\".drv\", \".html\", \".lst\", \".pptx\", \".scp\", \".tsp\", \".xlsx\", \".asp\", \".cpx\", \".dwg\", \".hxx\", \".m4a\",\n\".pro\", \".scr\", \".txt\", \".xml\", \".avi\", \".dat\", \".eml\", \".ico\", \".mid\", \".psd\", \".sdb\", \".vbs\", \".xsd\",\n\".ax\", \".db\", \".exe\", \".inc\", \".nls\", \".rar\", \".sig\", \".wab\", \".zip\", \".bak\", \".dbf\", \".ext\", \".ini\",\n\".one\", \".rar\", \".sql\", \".wab~\", \".bin\", \".dbx\", \".fdb\", \".jar\", \".pdf\", \".rdf\", \".sqlite\", \".wav\",\n\".bmp\", \".dll\", \".gif\", \".jpg\", \".pip\", \".resources\", \".theme\", \".wma\", \".config\", \".mxf\", \".mp3\",\n\".mp4\", \".cs\", \".vb\", \".tib\", \".aspx\", \".pem\", \".crt\", \".msg\", \".mail\", \".enc\", \".msi\", \".cab\", \".plb\",\n\".plt\"\n\n```\nThe `full_purge mode that overrides all the bytes of the file is always enabled for the files from <code>the`\npurge_extensions</code> list:\n\n```\n\".json\", \".htm\", \".log\", \".html\", \".lst\", \".txt\", \".xml\", \".vbs\", \".inc\", \".ini\", \".sql\"\n\n```\n\nIf the `delete_files flag is enabled, the wiper also deletes the files after overwriting them.`\n\nWe found additional forensics artifacts, submitted together with the wiper samples, that prove that the wiper was indeed\nexecuted in a TV environment:\n\nThe `lastfile2 containing the path to the last wiped file:` `C:\\users\\tpa\\videos\\captures\\desktop.ini . This file is`\ncreated only if the wiper was run in wipe_stage_2 mode, which deletes the files after the wiping procedures.\nThe `breakusufjkjdil.bat file, which shows that at least one instance of the wiper was supposed to run with the intent`\nto kill existing user sessions and change passwords for all the users: `\"c:\\windows\\temp\\msdskint.exe\" -break-users`\n```\n   * -sessions\n\n```\nThe Event Viewer Application log file shows events related to the wiper service `Service1 . The logs contain a timestamp`\nwhich is a few hours after the attack:\n\n**Figure 5 – Windows Event Viewer logs shows the wiper execution in the Iranian TV environment.**\n\n\n-----\n\n## Backdoors\n\n WinScreeny\n\nThe name of this tool comes from the PDB path: `C:\\work\\winscreeny\\winscreeny\\obj\\Debug\\winscreeny.pdb . The main`\npurpose of the backdoor is to make screenshots of the victim’s computer. We found two samples of this backdoor: the first one is\nthe release version uploaded to VT with the name `mslicval.exe, and the second one is the debug version named`\n```\nprecg2.exe . Needless to say, these files were submitted to VT together with the other artifacts that we discovered.\n\n```\nThe backdoor can be run in different ways, based on the command-line argument:\n\nNone – Runs a SimpleTCPServer that listens on port 18000.\n```\n   service – Runs as a service named Service1 . At start, the service creates a scheduled task with the command:\n\n```\n```\nschtasks /create /TN \\\"Microsoft\\\\Windows\\\\.NET Framework\\\\.NETASM\\\"/TR \\” <file_path> \\\" /ST\n\n```\n```\n   <current_time + 1:10> /SC ONCE /F .\n   setup – Tries to gain privileges using the LsaAddAccountRights API function and then run itself as a service.\n\n```\nThe malware listens for packets on port 18000, and for each packet, it checks if the message contains the `scr= command sent`\nwith the POST method. If these conditions are met, the malware saves a screenshot to a file named `screeny-`\n```\n<timestamp>.png and a “done” message is returned to the attacker if it succeeded.\n\n```\n**Figure 6 – Winscreeny screenshot capture code.**\n\nInterestingly, the release version of this malware is also capable of command execution: it supports the `s= command which`\ngets a base64-encoded string XORed with 1-byte key 0x24. The decoded string is run by cmd and the execution result is\nreturned to the server. The code that handles this feature is also reused in the HttpService backdoor that we discuss later.\n\n## HttpCallbackService\n\nHttpCallbackService is a Remote Administration Tool (RAT) with a familiar PDB path:\n```\nC:\\work\\simpleserver\\HttpCallbackService\\obj\\Release\\HttpCallbackService.pdb . Its C&C URL can be specified in\n\n```\ntwo different ways: a command-line argument or the configuration file `callservice.ini . Next, the received value is appended`\nwith a short string: `?m= if the URL ends with “.aspx” or “.php”;` `m=, if the URL ends with “/”, or` `/m= in any other case.`\n\nUnfortunately, we didn’t find any configuration or other artifacts related to HttpCallbackService, so the C&C server in this attack\nremains unknown.\n\nEvery 5 seconds, HttpCallbackService sends a request to the C&C URL using the `webClient.DownloadString method to`\nreceive the list of commands split by ‘ \\r\\n ’. If the malware doesn’t receive any commands in the last 5 minutes and the\n```\nisStayAliveMode flag is disabled, this time frame is increased to 1 minute.\n\n```\n\n-----\n\nThese are the commands supported by the RAT:\n\n**Command** **Arguments** **Action**\n\n\n“upload” upload_path, base64encoded content\n\n\nUpload a file to the victim’s computer. The server may send the file in chunks, each of\nthem sequentially decoded from base64 and appended to the file\n\n\n“download” file name Download file from the victim’s computer to C&C server, the file is base-64 encoded and\nsent in chunks of 102400 bytes\n\n\n“cooldown”\n\n\n– Disable the `isStayAliveMode flag`\n\n\nDefault command string Run the command in cmd and return the result to the C&C server\n\nWhen the results of the commands are uploaded to the server, the data is sent to a slightly different URL: the C&C URL defined\npreviously, now appended with “1”. The data is sent using the `WebClient.UploadValues method in the following format:`\n```\n   download=<file_name>\\r\\n--------------\\r\\n<base64 of chunk> for the download command\n   <command>\\r\\n--------------\\r\\n<result> for the cmd command.\n\n## HttpService\n\n```\nHttpService is another backdoor that listens on a specified port: it can be a command-line argument, the pre-defined port\ndepending on the sample, or the value from the configuration file: `<exe_name>.ini . We found several samples with the default`\nports 19336, 19334, 19333, as well as two different configuration files uploaded to VT, with 19336 and 19335 values.\n\nEach sample has a hardcoded version. The files that we discovered belong to three different versions: 0.0.5, 0.0.11v4H and\n0.0.15v4H. The version 0.0.5 listens to the specified port with a Simple TCP server, whereas 0.0.11v4H and 0.0.15v4H are\nbased on the Simple HTTP Server. All of them use the HTML Agility Pack for HTML parsing and IonicZip library for compression\nactions.\n\nThe highest version (0.0.15v4H) of the backdoor has multiple capabilities, including command execution and manipulation with\nthe files.\n\n**Command execution: The command “ cmd ” makes the backdoor run the specified command with cmd.exe and return the**\nresult in this format: `<div style='color: red'><result_string></div> . In addition, the backdoor can launch an`\ninteractive cmd shell when it receives the “ i= ” command, whose arguments can be:\n\n“ 1 ” – Get the output from the shell and send it back to the C&C.\n“ 2 ” – End the interactive shell and clean up.\ndefault – Decode and decrypt the XORed string and then run the command in the shell and save the output.\n\nSimilar to WinScreeny, the malware also has the “ s= ” command with the string XORed with 1-byte key `0x24 as an argument.`\nThe decoded string is run by cmd.exe and the result is returned to the server.\n\n**Proxy connections: After the “ p= ” or “ b= ” command is received, the backdoor uses the victim’s computer as a proxy to the**\nURL it gets as an argument. The backdoor communicates with this URL, redirects the request of the C&C server, and waits for a\nresponse to send it back to the C&C.\n\n**Download and upload files: The “ f= ” or “ 1= ” command allows the backdoor to download a file from the path given as an**\nargument or write a file given as an argument with the content of the message body. After it receives the “ m= ” command, the\nmalware writes the body of the message to the path `<base_directory><client_address>.out, reads data from`\n```\n<base_directory><client_address>.in, and sends it to the C&C. If the file does not exist, the malware creates the file and\n\n```\nwrites to it the current date and time.\n\n**Run SQL commands: The “ con= ” / “ c= ” command receives the SQL DB connection string and SQL query, and returns the**\nresult to the server.\n\n**Manipulate the local files: The “ <path> ” command checks if the file/directory exists and then does one of these three things,**\nbased on the query value:\n\n\n-----\n\n```\n    zip  Creates a zip file from the directory contents and returns it to the C&C.\n\n```\n“ unzip ” – Unzips the file using the path provided by the C&C.\n“ del ” – Deletes the file.\n\nInterestingly, in all three cases, the malware sends back the entire directory contents (including sub-directories) as an HTML\npage that contains the `Zip,` `Unzip and` `Delete buttons, depending on the type of the file. This is how the interface looks on`\nthe attackers’ side:\n\n**Figure 7 – HTML page with the directory listing returned to the C&C server.**\n\n## ServerLaunch dropper\n\nThe sample of HttpServer version 0.0.5 was submitted together with its dropper, called `dwDrvInst.exe, which mimics the`\nremote access software executable by DameWare. The tool’s PDB path has the same pattern,\n```\nC:\\work\\ServerLaunch\\Release\\ServerLaunch.pdb . However, the tool is written in C++, not .NET like all the others, and\n\n```\nwas compiled on December 2, 2021, almost 2 months prior to the attack.\n\nServerLaunch contains three executable in resources, which it drops to `ionic.zip.dll,` `httpservice2 and`\n```\nhttpservice4, all in C:\\Users\\Public\\ . The malware then starts both httpservice2 and httpservice4 with no\n\n```\narguments. Each of them has a different pre-defined port to listen on, which likely allows the attackers to ensure some sort of\nredundancy of the C&C communication.\n\n## Connecting the files to the attack\n\nWe’ve discussed several different tools and some of artifacts related to their execution. It is clear that all these tools were\ncreated by the same actor and are connected. For example, the screenshot tool Winscreeny doesn’t contain the functionality to\nupload the created screenshots back to the attackers, which likely means that it relies on other backdoors to perform this\noperation. The recurring `Service1 name for all the tools indicates that different backdoors, if running on the same machine`\nwere mostly executed with command-line arguments or provided configuration files.\n\nTaking into account that the samples are related to each other, we can substantiate the connection between these files and the\nIRIB cyberattack:\n\nThe whole cluster of activity is interconnected and was submitted to VT mostly from Iranian IPs all at the same timeframe,\nlikely by incident responders.\nThe audio and video files utilized by the tools are the same as those broadcast live on hacked Iranian TV. The Twitter\naccount @GhyamSarnegouni (“Uprising to overflow”) featured in this video contains a few recordings of different TV\nchannels streams that feature both the video and the audio tracks we’ve discussed.\nMultiple artifacts such as Matrox DSX, Autocue QTV, TFI Arista Playout Server, etc. that were referenced in the samples\nindicate that these files were intended for a broadcast environment.\nAmong the forensics artifacts submitted together with video and executables, we discovered Windows Event Viewer files\nthat contain evidence that the samples were attempted to be executed in the Iranian TV network environment, a domain\nnot resolved publicly. The timestamp of these specific logs is after the time of the actual incident.\n\n\n-----\n\n**Figure 8 – Screenshot of the Application log that contains the wiper execution evidence.**\n\nNumerous other forensics evidence from this VT file cluster contains other artifacts directly related to IRIB. For example,\nan internal tool called `MIT_FreeSizeService (md5:307e7440a15c8eed720566f067a2e96b) bears the IRIB logo, and the`\n[memory dump of the MetaSAN software called](https://en.wikipedia.org/wiki/MetaSAN) `executable.4504.exe (md5:1fc57ccec4668bbcbebaa9c734a437ba)`\nfeatures memory strings that indicate the software was run on the machine from the `MIT-TV domain.`\n\n**Figure 9 – VT submission of the unknown tool featuring the MIT (same as the domain name) string and containing the**\n**IRIB logo**\n\n## Attribution\n\nIranian officials appear to be confident that MEK is behind this attack, with the deputy head of technical affairs for Islamic\n[Republic of Iran Broadcasting claiming the same. However, the opposition group itself denies any involvement, stating that “the](https://www.bloomberg.com/news/articles/2022-01-27/iran-state-tv-says-exiled-dissidents-briefly-hacked-broadcasts)\ngroup had become aware of the incident only when it happened but that the hacking might have been the work of supporters in\nIran.”\n\nThe hacktivist group Predatory Sparrow, which claimed responsibility for the attacks against the national railway services, the\ntransportation ministry, and the Iranian gas stations, affiliated itself with the IRIB attack via its Telegram channel. On the morning\nbefore the attack, they [wrote “Wait for the good news from our team. Do not switch the channel.” Later the same evening, they](https://t.me/GonjeshkeDarande/143)\n[posted a video from one of the disrupted TV channels, introducing it as a “cyber-attack on the country’s radio and television](https://t.me/GonjeshkeDarande/146)\norganization by the Predatory Sparrow team.” Currently, no technical proof of the group’s attribution to the attack has been\ndiscovered. The video displayed on the channel is available online and refers to a different Telegram account\n@GhyamSarnegouni, so the claims should be treated with caution.\n\n\n-----\n\n**Figure 10 – Posts from ‘Predatory Sparrow’s Telegram channel, in which the group claims responsibility for the attack.**\n\n## Conclusion\n\nIn this article, we analyzed a set of tools that likely was used in a cyberattack against the IRIB, which disrupted several state-run\nTV and radio channels. The use of wiper malware in the attack against a state entity in Iran begs us to compare the tools with\n[those belonging to Indra, who, among other attacks, is responsible for unleashing a wiper in the Iranian Railways and Ministry of](https://research.checkpoint.com/2021/indra-hackers-behind-recent-attacks-on-iran/)\nRoads systems. Although these wipers are coded and behave very differently, some implementation details such as execution\nbased on batch files, or the password changing patterns ( [random sequence]aA1! for this attack and `Aa153![random`\n```\nsequence] in Indra’s case), suggests that the attackers behind the IRIB hack may have been inspired by previous attacks\n\n```\nhappened in Iran.\n\nAs in the case with Indra, it appears that the actor may have many capabilities that have yet to be explored. On the one hand,\nthe attackers managed to pull off a complicated operation to bypass security systems and network segmentation, penetrate the\nbroadcaster’s networks, produce and run the malicious tools that heavily rely on internal knowledge of the broadcasting software\nused by victims, all while staying under the radar during the reconnaissance and initial intrusion stages.\n\nOn the other hand, the attackers’ tools are of relatively low quality and sophistication, and are launched by clumsy and\nsometimes buggy 3-line batch scripts. This might support the theory that the attackers might have had help from inside the IRIB,\nor indicate a yet unknown collaboration between different groups with different skills.\n\n[Meanwhile, almost two weeks after the attack happened, MEK-affiliated news published a status report of the attack claiming](https://english.mojahedin.org/news/iran-despite-utilizing-all-resources-after-12-days-regimes-radio-and-tv-networks-have-not-returned-to-a-normal-status/)\nthat the “regime’s radio and TV networks have not returned to a normal status” and provided an elaborate list of affected devices\nwith the statement “more than 600 servers, advanced digital production, archiving, and broadcasting of radio and television\nequipment have been destroyed, and their software has been damaged.” There is no way for us to verify these claims, but if at\nleast some of them are true, the extent of destruction caused by the wiper and other malicious tools that we’ve discovered (and\nthose that are yet unknown), exceeded expectations.\n\n## IOCs\n\n**Attack files:**\n\n**hash** **name** **description**\n\n1607f31ac66dfec739dc675ade921582acb8446c2ac7d6d1bc65a3e993fc5b54 msdskint.exe Wiper\n\n42ed646eed4f949c456c637a222e7d94dd8ac67ed5ebda5e63c7b7979076d9cf msdskint.exe Wiper\n\n\n-----\n\n**hash** **name** **description**\n\n8bdf6e262966a59a7242d279e511dd694467f07d1d76c456a0c26d0db2ec48a8 HttpService2.exe HttpService\n\n427c105859c3dc62ece790e41a42b0f6ae587496a07d3bd190143179cdf6c6bd HttpService4.exe HttpService\n\ne3d61cbbfbe41295dd52acff388d1d8b1d414a143d77def4221fd885aae6cd83 HttpService2.exe HttpService\n\n096bae94e09059e2e3106503353b1b4f7116fa667600ca2ab3fa7591708e645a HttpService4.exe HttpService\n\n13a016b8f502c81e172c09114f25e4d8a8632768aefd56c5f6d147e9b6466216 HttpService4.exe HttpService\n\nea740894227ae1df923997edb7bda3a00f523fbff7cc02d3b5e6b3de19d672fc HttpCallbackService.exe HttpCallbackService\n\n62b692be251feb63af2723a68975976b749cab20014ffaa6488af80f4f03e0a1 dwDrvInst.exe ServerLaunch\n\n41e0c19cd6a66b4c48cc693fd4be96733bc8ccbe91f7d92031d08ed7ff69759a precg2.exe Winscreeny\n\ne9e4a8650094e4de6e5d748f7bc6f605c23090d076338f437a9a70ced4a9382d mslicval.exe Winscreeny\n\nd788ebc7ee98c222f46d7ca2347027643784a78b5954c9a31734ec1b197bc2aa Avar.exe Avar\n\n1155dd06e0b108bde3addcdbd5d1da4dc18ca245c39ce7d967f8971eb0f88dbb SimplePlayout.exe SimplePlayout\n\na25215c9adce51a3ecfe34c802d3e7d865cf410ddbe10101e3b41f6ba11347a4 TSE_90E11.mp4 MP4 video file\n\n4cc21810d786dca94e01d0714d37e3f097ff6e3813bf6e17a9bd86cd9a4ceb2b TSE_90E11.001 WAV file\n\n7ea7b20b87ded3c297ec0890ee8a396427d70caf983b42f479d8fad38629b684 playoutabcpxtveni.bat\n\nbc8de80a28c8ae55415ccdfece270f6548f067fc2a00e799baf0279d4d560807 breakusufjkjdil.bat\n\n197f13580ec249fa84b1e54f978c5cab60f22561a2fab2ff60bdb2d5bfa25512 avapweiguyyyw.bat\n\nefc8f12c53d1730fa8ac00cfa60e63ab43d90f42879ef69d7f6fb9978246f9cb playjfalcfgcdq.bat\n\na2d493c2cb25fc03f5d31cf3023b473d71d38b972eccdb7873f50d2344ea7753 simpleplayout.ini\n\nc305b3cb96a34258a3e702526de6548b2de99449c0839a9aea518accc7c861ab 436748HttpService4.exe.ini\n\n8b74c08c33cd8a0cc1eaf822caeaad6b54bc39e4839e575f3c0ece4bb8992408 436751HttpService4_2.exe.ini\n\n**Forensics artifacts:**\n\n**hash** **name** **description**\n\n0daa0aefdc6d0641eb06e62bc8c92a0696aa8089258cb2d3552ac137d53237ec sec.evtx security event log from\none of the machines\n\na3b9bd57e6b281610e570be87883d907992bdf7be3bcd37885ee2cf97d930cd3 application.evtx applications event log\nfrom one of the machines\n\n067ae6ecfd108a79a32eb1a76a262868d8f3a9a7924b26091f0e2229152bdd9d lastfile2 path to the last file wiped\nand deleted by the wiper\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-18 - EvilPlayout- Attack Against Iran’s State Broadcaster.pdf"
    ],
    "report_names": [
        "2022-02-18 - EvilPlayout- Attack Against Iran’s State Broadcaster.pdf"
    ],
    "threat_actors": [
        {
            "id": "ddb9c4ac-43a2-4100-86c8-1770ac2eeb05",
            "created_at": "2024-03-28T02:00:05.778006Z",
            "updated_at": "2025-03-27T02:00:03.346082Z",
            "deleted_at": null,
            "main_name": "Edalat-e Ali",
            "aliases": [],
            "source_name": "MISPGALAXY:Edalat-e Ali",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "8309f9cf-9abb-4ce3-aa1e-cda7d7f5c1b3",
            "created_at": "2022-10-25T16:07:23.729215Z",
            "updated_at": "2025-03-27T02:02:09.949223Z",
            "deleted_at": null,
            "main_name": "Indra",
            "aliases": [],
            "source_name": "ETDA:Indra",
            "tools": [
                "Stardust"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "219ddb41-2ea8-4121-8b63-8c762f7e15df",
            "created_at": "2023-01-06T13:46:39.384442Z",
            "updated_at": "2025-03-27T02:00:03.07071Z",
            "deleted_at": null,
            "main_name": "Predatory Sparrow",
            "aliases": [
                "Indra",
                "Gonjeshke Darande"
            ],
            "source_name": "MISPGALAXY:Predatory Sparrow",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535944,
    "ts_updated_at": 1743041820,
    "ts_creation_date": 1653759667,
    "ts_modification_date": 1653759667,
    "files": {
        "pdf": "https://archive.orkl.eu/5adba62aca65dfd9d6cb9d979ae3045fd43a7471.pdf",
        "text": "https://archive.orkl.eu/5adba62aca65dfd9d6cb9d979ae3045fd43a7471.txt",
        "img": "https://archive.orkl.eu/5adba62aca65dfd9d6cb9d979ae3045fd43a7471.jpg"
    }
}