{
    "id": "d5761685-f2bc-417f-8920-8bdf7954825d",
    "created_at": "2023-01-12T15:03:35.164156Z",
    "updated_at": "2025-03-27T02:06:14.419614Z",
    "deleted_at": null,
    "sha1_hash": "10f52d66c9e05b6e3e97517dc491d6d6f119f780",
    "title": "2020-03-28 - In-depth analysis of a Cerberus trojan variant",
    "authors": "",
    "file_creation_date": "2022-05-28T04:57:56Z",
    "file_modification_date": "2022-05-28T04:57:56Z",
    "file_size": 2152594,
    "plain_text": "# In-depth analysis of a Cerberus trojan variant\n\n**[insights.oem.avira.com/in-depth-analysis-of-a-cerberus-trojan-variant/](https://insights.oem.avira.com/in-depth-analysis-of-a-cerberus-trojan-variant/)**\n\nMarch 27, 2020\n\nAndroid banking trojans are nothing new, and Cerberus is just the latest in a long line of\n[such malware to hit the headlines. Even the fact that Cerberus is being “rented out” on](https://www.threatfabric.com/blogs/cerberus-a-new-banking-trojan-from-the-underworld.html)\nunderground forums is not unique. Malware “for hire” has become a theme. This trojan uses\npeoples’ worry of COVID-19 to steal financial data such as credit card numbers. It also uses\noverlay attacks to trick victims into providing personal information and can capture twofactor authentication details.\n\n“Corona-Apps.apk” is a variant of the Cerberus banking trojan. They are usually spread via\nphishing campaigns. Corona-Apps.apk uses its connection with the actual virus name to\ntrick users into installing it on their smartphones.\n\n## Dynamic Analysis of Cerberus\n\nBy Bogdan Anghelache, specialist threat researcher, Avira Protection Labs\n\n**Behavior upon installation**\n\nCorona-Apps.apk variant has a very aggressive behavior after installation. A high level\n[overview can be read on Avira’s blog.](https://blog.avira.com/cerberus-flies-under-covid-19-flag/)\n\n**Communication with the C&C server**\n\nAfter installation, network traffic can be seen between the application and the C&C server\n‘botduke1.ug’\n\n\n-----\n\n_Figure 1: The traffic between the app and the C&C server_\n\nThe application has a well defined set of commands such as: “info_device”, “new_device”,\n“saved_data_device” and “pause_attacker”. The “info_device” is requested every few\nseconds. This keeps the C&C server updated with the newest information about the device.\n\n\n-----\n\n_Figure 2: The application sends an “upgrade_n_patch” command which gets as response a_\n_chunk of binary data_\n\n## Static Analysis of Cerberus\n\n**A quick look at the original manifest**\n\nThis sophisticated trojan has a large AndroidManifest file: lots of receivers, activities,\nservices, intent-filters etc.\n\nThe code found in the distributed APK is the same in the majority of classes”. The code is\nheavily obfuscated and has no real purpose other than to waste the analyst’s time.\n\nBesides the heavily obfuscated package name, two activities that caught our attention were:\n\nWhy would such an app want to send and receive text messages, record audio, and\nread the user’s contact list?\n\n\n-----\n\nAnd the fact that, the path to the class names is not found (the root element\n_qugyujzldpxqazyrqtc is not present on the left side, under “Source code”)._\n\n_Figure 3: The permissions: in the red box: the path to the classes not present in the Source_\n_Code_\n\n**Analyzing the payload**\n\nThe payload of this variant is a dex file named RRoj.json. When the payload is decompiled,\nit shows the obfuscated code of the malware. This reveals the class names which have\nbeen referenced in the distributed APK manifest file\n(qugyujzldpxqazyrqtc.uindwdxr.smlelfodpiernkx ).\n\n\n-----\n\n_Figure 4: The path to the classes can be seen in the Source Code view of the dropped_\n_payload_\n\n**String decryption**\n\nTo evade detection, this variant of Cerberus encrypts every constant string it uses: the\nstrings used to log the activity and as function parameters (we’ll later see how this variant\nuses mechanism to dynamically request additional permissions).\n\nThe decryption method is interesting, it consist of 2 stages. Here’s an overview:\n\n1. A base-64 encoded string is passed to the first stage of the decryption method, which\n\noutputs an array of bytes,\n2. The array of bytes is decrypted using the RC4 cipher with one of the two hardcoded\n\nencryption keys\n\n\n-----\n\n_Figure 5: The decryption function, used throughout the program_\n\n### Details of decryption stages:\n\n**Stage one (base-64 decode):**\n\nDecoded base-64 is a string where every 2 characters are processed as a single byte. It\nmeans that the length of the output string is always half of the original one.\n\nThe function takes every 2 consecutive characters and converts them into digits in base 16.\nThe first one is bitwise shifted to the left 4 times. The output byte will be the sum of the 2\ncharacters, as seen below:\n\n_Figure 6: The first stage of the decryption_\n\n**Stage two (RC4 cipher):**\n\nThe output from the previous function is passed to the RC4 cipher. Further, it decrypts it\nusing the hardcoded key.\n\n\n-----\n\n_Figure 7: The “e” and “d” field of the parent class “c” contains the decryption keys_\n\n## Dynamic permission request\n\nThe payload requests some permissions that may be considered dangerous. Because it\ndoesn’t have a manifest it does that by using the API call requestPermissions. As shown,\nthe permission strings are encrypted to avoid detection.\n\n_Figure 8: The “o” field of the class “a” contains the encrypted permission strings_\n\n\n-----\n\n_Figure 9: Decrypted permissions_\n\n## Conclusion\n\nDo not grant permissions to applications that do not state the reason for asking such\npermissions. Download and install applications only from reliable sources—be suspicious of\ngimmicks and untrusted sources.\n\n[Knowledge of the threat landscape and implementation of the right malware detection tools](https://oem.avira.com/en/avira-labs/advanced-threats)\nremains crucial to be able to protect yourself from fraud.\n\nMitigating the mobile malware threat starts with awareness. It requires detection and\nprotection to prevent the malware from being successful.\n\n\n-----\n\nAvira Protection Labs\n\nProtection Lab is the heart of Avira’s threat detection and protection unit. The researchers\nat work in the Labs are some of the most qualified and skilled anti-malware researchers in\nthe security industry. They conduct highly advance research to provide the best detection\nand protection to nearly a billion people world-wide.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-03-28 - In-depth analysis of a Cerberus trojan variant.pdf"
    ],
    "report_names": [
        "2020-03-28 - In-depth analysis of a Cerberus trojan variant.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535815,
    "ts_updated_at": 1743041174,
    "ts_creation_date": 1653713876,
    "ts_modification_date": 1653713876,
    "files": {
        "pdf": "https://archive.orkl.eu/10f52d66c9e05b6e3e97517dc491d6d6f119f780.pdf",
        "text": "https://archive.orkl.eu/10f52d66c9e05b6e3e97517dc491d6d6f119f780.txt",
        "img": "https://archive.orkl.eu/10f52d66c9e05b6e3e97517dc491d6d6f119f780.jpg"
    }
}