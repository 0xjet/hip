{
    "id": "13d7dca1-0ea8-4997-b691-dd0425e1fd30",
    "created_at": "2023-01-12T15:01:09.807908Z",
    "updated_at": "2025-03-27T02:10:08.127664Z",
    "deleted_at": null,
    "sha1_hash": "912a9ce06afea345661439db5dfb1f0fa3190201",
    "title": "2017-01-13 - Finfisher rootkit analysis",
    "authors": "",
    "file_creation_date": "2022-05-27T21:13:46Z",
    "file_modification_date": "2022-05-27T21:13:46Z",
    "file_size": 665695,
    "plain_text": "# Finfisher rootkit analysis\n\n**[artemonsecurity.blogspot.de/2017/01/finfisher-rootkit-analysis.html](https://artemonsecurity.blogspot.de/2017/01/finfisher-rootkit-analysis.html)**\n\nMy previous blog post was dedicated to very interesting malware that is called Wingbird.\nThis malware has been used by NEODYMIUM cyber espionage group and contains rootkit to\nexecute sensitive and important operations for attackers in a system. The first sample used\nrootkit for injection malicious code into Winlogon with removing ESET driver hooks in kernel\nSSDT, while second deploys rootkit for bypassing FS sandbox of several security products.\nBoth droppers analyzed in 32-bit environment, while their behaviour in 64-bit Windows\nversions are interesting too and different from what we have seen in the 32-bit versions.\n\nIn 64-bit system, the dropper doesn't resort to the use of kernel mode rootkit (obviously, due\nto DSE restrictions) for injection malicious code & data into trusted Winlogon process.\nInstead this, it uses special trick for masking its malicious activity and for performing\ninjection. The dropper uses copy of trusted LSASS process (executable file) and forces it to\nload malicious dll with standart name that is imported by LSASS.\n\n64-bit GMER anti-rootkit tool demonstrates injection anomalies into Winlogon and Svchost,\nwhere malicious code is located.\n\n\n-----\n\nThe presence of virtual memory regions into Winlogon with the protection attribute\nPAGE_EXECUTE_READWRITE is an indicator that the process was compromised.\n\nAs I already noted in previous blog post, Wingbird malware shares similarities with another\nmalware that is called Finfisher. For example, in malicious PE-file that was dumped from\nWinlogon memory region, we can see reference to name of Finfisher rootkit\n(mssounddx.sys).\n\nAfter lsass service started, it injects code into winlogon and with help of ProcMon boot\nlogging we can identify first actions that come from malicious code.\n\n\n-----\n\nAfter some preliminary actions, malicious code into Winlogon tries to communicate with hard\ndisk on low level, it requests disk geometry info and sends SCSI control code for reading\ndata. In 32-bit version it uses rootkit to perform this operation.\n\n[It also checks presence of Finfisher files. See details in Symantec blog post here.](https://www.symantec.com/security_response/writeup.jsp?docid=2012-072615-4146-99&tabid=2)\n\nThe following indicators show similarities between Wingbird and Finfisher.\n\n\n-----\n\nI was able to get 32-bit version of mssounddx.sys rootkit. As you can see on screenshot\nbelow, authors masked its file as legitimate Microsoft driver.\n\nLike Wingbird rootkit, Finfisher rootkit is protected from statical analysis. The code from\n_DriverEntry and other functions in mssounddx.sys are representing a loader that decrypts_\ncontent of BIN resource, where 2nd encrypted driver is located.\n\nRootkit code does following actions in DriverEntry.\n1. It is looking for corresponding BIN resource into .rsrc section.\n2. It allocates memory block from kernel pool and copies into it content of BIN resource with\nsize 0xc180 (encrypted driver).\n3. Decrypts data in allocated pool block.\n\n\n-----\n\n4. Prepares PE-file of encrypted driver for work: applies fixups, fills some internal variables\n(ptrs to import functions).\n5. Passes control to DriverEntry of decrypted driver.\n\nSecond driver uses following kernel functions.\n\nCode injection.\n\n\n-----\n\nNext picture demonstrates logic of 2nd driver execution.\n\nStart of shellcode looks like.\n\n\n-----\n\n**Conclusion**\n\nAs you can see from the analysis, we haven't seen something new in Finfisher rootkit. Like\nother drivers that are used by attackers, it is intended only for one purpose - for injection\nmalicious code into Winlogon process. Nevertheless, authors use some anti-analysis tricks,\nincluding, driver encryption and obfuscation some data that driver keeps in kernel memory.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-01-13 - Finfisher rootkit analysis.pdf"
    ],
    "report_names": [
        "2017-01-13 - Finfisher rootkit analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "27485543-d2e7-4053-a660-157489732cbb",
            "created_at": "2022-10-25T16:07:23.895403Z",
            "updated_at": "2025-03-27T02:02:10.018168Z",
            "deleted_at": null,
            "main_name": "Neodymium",
            "aliases": [],
            "source_name": "ETDA:Neodymium",
            "tools": [
                "Wingbird"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "400a3efc-44a1-4d83-a724-cd16818328f9",
            "created_at": "2023-01-06T13:46:38.516115Z",
            "updated_at": "2025-03-27T02:00:02.853085Z",
            "deleted_at": null,
            "main_name": "NEODYMIUM",
            "aliases": [
                "G0055"
            ],
            "source_name": "MISPGALAXY:NEODYMIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c11cbeb5-461f-4bd8-a86b-f57e471a664d",
            "created_at": "2022-10-25T15:50:23.257383Z",
            "updated_at": "2025-03-27T02:00:55.409898Z",
            "deleted_at": null,
            "main_name": "NEODYMIUM",
            "aliases": [
                "NEODYMIUM"
            ],
            "source_name": "MITRE:NEODYMIUM",
            "tools": [
                "Wingbird"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535669,
    "ts_updated_at": 1743041408,
    "ts_creation_date": 1653686026,
    "ts_modification_date": 1653686026,
    "files": {
        "pdf": "https://archive.orkl.eu/912a9ce06afea345661439db5dfb1f0fa3190201.pdf",
        "text": "https://archive.orkl.eu/912a9ce06afea345661439db5dfb1f0fa3190201.txt",
        "img": "https://archive.orkl.eu/912a9ce06afea345661439db5dfb1f0fa3190201.jpg"
    }
}