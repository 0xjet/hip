{
    "id": "c0de3b3c-6e43-4ead-944c-40462df139ff",
    "created_at": "2023-01-12T15:06:10.489237Z",
    "updated_at": "2025-03-27T02:17:02.279187Z",
    "deleted_at": null,
    "sha1_hash": "041aa91cd6399a294a9dbc98c78b3f3325431790",
    "title": "2020-03-05 - ELF_TSCookie - Linux Malware Used by BlackTech",
    "authors": "",
    "file_creation_date": "2022-05-28T23:44:43Z",
    "file_modification_date": "2022-05-28T23:44:43Z",
    "file_size": 653929,
    "plain_text": "# ELF_TSCookie - Linux Malware Used by BlackTech\n\n**blogs.jpcert.or.jp/en/2020/03/elf-tscookie.html**\n\n朝長 [秀誠 (Shusei Tomonaga)](https://blogs.jpcert.or.jp/en/shu_tom/)\n\nMarch 5, 2020\n\n[BlackTech](https://blogs.jpcert.or.jp/en/tags/blacktech/)\n\n[Email](http://10.10.0.46/mailto:?subject=ELF_TSCookie%20-%20Linux%20Malware%20Used%20by%20BlackTech&body=https%3A%2F%2Fblogs.jpcert.or.jp%2Fen%2F2020%2F03%2Felf-tscookie.html)\n\n[In the past blog articles, we have introduced TSCookie,](https://blogs.jpcert.or.jp/en/2018/03/malware-tscooki-7aa0.html) [PLEAD and](https://blogs.jpcert.or.jp/en/2018/06/plead-downloader-used-by-blacktech.html) [IconDown, which are](https://blogs.jpcert.or.jp/en/2019/11/icondown-downloader-used-by-blacktech.html)\nused by BlackTech. It has been identified that this group also uses several other types of\nmalware. While the malware we have already described infects Windows OS, we have also\nconfirmed that there are TSCookie and PLEAD variants that infect Linux OS.\n\nThis article describes TSCookie for Linux, used by BlackTech.\n\n### Difference between TSCookie for Windows and Linux\n\nThe function of the two are mostly the same, as many parts of the code are identical. Figure\n1 shows the comparison of code in TSCookie for Windows and for Linux.\n\nFigure 1: Comparison\n\nof code in TSCookie for Windows and Linux(Left: Windows Right: Linux)\nWhile they are mostly the same in terms of the code, the Linux version operates differently\nwith the following characteristics:\n\n\n-----\n\nLess configuration\nSupports custom communication protocol only\nSeveral functions available by default\n\nThe details are explained in the next sections.\n\n### Less configuration data\n\n[As it was described in the past blog entry (Appendix A: TSCookie Configuration), TSCookie](https://blogs.jpcert.or.jp/en/2019/09/tscookie-loader.html)\nfor Windows has 17 sets of configuration within the 0xB78 data size. On the other hand, it is\nreduced to 5 in the Linux version, and the configuration on proxy communication and others\nhave been excluded. See Appendix A for details.\n\nIn the Windows version, the configuration is RC4-encrypted and hardcoded in the malware.\nFor the Linux version, however, information such as C&C server is copied as a plain text into\na dedicated area in the memory and then RC4-encrypted.It is uncertain why the Linux\nversion malware does not encrypt the configuration with RC4 from the beginning, but it is\npossible that coding some parts did not work when copying the code from the Windows\nversion to the Linux one.\n\nFigure 2: Code for\n\ncreating configuration\n\n### Supports custom communication protocol only\n\nWhile TSCookie for Windows supports several communication protocols (HTTP, HTTPS and\ncustom protocol), the Linux version only supports its custom protocol. Figure 3 shows a part\nof code for communication. It is clear that the code only covers the custom protocol.\n\n\n-----\n\nFigure 3: Comparison\n\nof communication in TSCookie for Windows and Linux(Left: Windows version Right: Linux\nversion)\nThe payload itself is RC4-encrypted in both versions, and the format of the data as well as\nthe commands received in reply remain mostly the same. (See Appendix B for details.)\n\n### Several functions available by default\n\nTSCookie for Windows downloads modules and operates accordingly. The Linux version has\nthe following functions by default, so it conducts malicious activities without downloading\nextra modules. (See Appendix C for details.)\n\nExecute arbitrary shell command\nOperate files (list, delete, move)\nUpload/Download files\n\n### In closing\n\nIt is assumed that the malware is embedded in a Linux server of a victim organisation by an\nattacker after intrusion. If you find any type of malware related to Blacktech in your network,\nit is recommended that you also check your Linux environment. Please see Appendix D for\nthe list of C&C servers.\n\nShusei Tomonaga\n\n(Translated by Yukako Uchida)\n\n**Appendix A: ELF_TSCookie Configuration**\n\nTable A: Configuration\n\nOffset Description Remarks\n\n\n0x000 Destination server and port\nnumber\n\n\nMultiple hosts can be specified by listing with a\nsemicolon \";\"\n\n\n0x400 RC4 key Used for encrypting communication\n\n0x40C Campaign ID\n\n0x44C Communication mode Only supports a custom protocol\n\n0x454 Not used\n\n\n-----\n\n**Appendix B: Data exchanged by ELF_TSCookie**\n\nTable B-1: Format of sent data\n\nOffset Length Contents\n\n0x00 4 Number of received data (begins with 0xFFFFFFFF)\n\n0x04 4 Length of data sent\n\n0x08 4 Packet number (Used to divide data when the data length is larger than\n65440)\n\n0x0C 4 Command (begins with 0x7263BC02)\n\n0x10 4 Whether the data after 0x20 is RC4-encrypted\n\n0x14 4 Not used\n\n0x18 4 0x3001\n\n0x1C 4 RC4 key (random data)\n\n0x20 - Data to be sent (See B-2 for the first communication)\n\nUp to offset 0x1C, the contents are encrypted with the RC4 key and random data in the\nconfiguration.\n\nTable B-2: Format of data sent in the first communication after offset 0x20\n\nOffset Length Contents\n\n0x00 4 0x9A65001F\n\n0x04 4 Process ID\n\n0x08 4 Command (0x7263BC02 at the beginning)\n\n0x0C 4 Not used\n\n0x10 4 Data size after offset 0x14\n\n0x14 - Random data\n\nUp to offset 0x14, the contents are encrypted with RC4 key and random data in the\nconfiguration.\n\nTable B-3: Format of received data\n\nOffset Length Contents\n\n\n-----\n\n0x00 4 Number of received data\n\n0x04 4 Length of received data\n\n0x0C 4 Command\n\n0x10 4 Whether the data after 0x20 is RC4-encrypted\n\n0x1C 4 RC4 key\n\n0x20 - Data\n\nUp to offset 0x1C, the contents are encrypted with RC4 key in the configuration and\nanother key in the received data.\n\n**Appendix C: ELF_TSCookie commands**\n\nTable C: Commands\n\nValue Contents\n\n0x7200AC03 Launch remote shell\n\n0x7200AC04 Send a command to remote shell\n\n0x7200AC05 End remote shell\n\n0x7200AC07 \n0x7200AC0B Returns 0x7263BC06\n\n0x7200AC0C List files\n\n0x7200AC0D Download file\n\n0x7200AC0E Upload file\n\n0x7200AC11 \n0x7200AC13 End bot\n\n0x7200AC16 Delete file\n\n0x7200AC1A Move file\n\n0x7200AC10 Execute command\n\n**Appendix D: C&C servers**\n\napp.dynamicrosoft.com\nhome mwbsys org\n\n\n-----\n\n**Appendix E: Hash**\n\nfc863fbd71e22c99eaa2b1b0eb72d806cedeb536213e600afb03f0fbea9d2bb3\n\n[Email](http://10.10.0.46/mailto:?subject=ELF_TSCookie%20-%20Linux%20Malware%20Used%20by%20BlackTech&body=https%3A%2F%2Fblogs.jpcert.or.jp%2Fen%2F2020%2F03%2Felf-tscookie.html)\n\nAuthor\n\n朝長 [秀誠 (Shusei Tomonaga)](https://blogs.jpcert.or.jp/en/shu_tom/)\n\nSince December 2012, he has been engaged in malware analysis and forensics\ninvestigation, and is especially involved in analyzing incidents of targeted attacks. Prior to\njoining JPCERT/CC, he was engaged in security monitoring and analysis operations at a\nforeign-affiliated IT vendor. He presented at CODE BLUE, BsidesLV, BlackHat USA Arsenal,\nBotconf, PacSec and FIRST Conference. JSAC organizer.\n\nWas this page helpful?\n\n0 people found this content helpful.\n\nIf you wish to make comments or ask questions, please use this form.\n\nThis form is for comments and inquiries. For any questions regarding specific commercial\nproducts, please contact the vendor.\n\nplease change the setting of your browser to set JavaScript valid. Thank you!\n\n## Related articles\n\nAnalysis of HUI Loader\n\n\n-----\n\nAnti-UPX Unpacking Technique\n\nFAQ: Malware that Targets Mobile Devices and How to Protect Them\n\nMalware WinDealer used by LuoYu Attack Group\n\nMalware Gh0stTimes Used by BlackTech\n\n\n[Back](https://blogs.jpcert.or.jp/en/2020/02/malware-lodeinfo-targeting-japan.html)\n[Top](https://blogs.jpcert.or.jp/en/)\n[Next](https://blogs.jpcert.or.jp/en/2020/03/ics-security-conference-2020-report--part1.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-03-05 - ELF_TSCookie - Linux Malware Used by BlackTech.pdf"
    ],
    "report_names": [
        "2020-03-05 - ELF_TSCookie - Linux Malware Used by BlackTech.pdf"
    ],
    "threat_actors": [
        {
            "id": "2646f776-792a-4498-967b-ec0d3498fdf1",
            "created_at": "2022-10-25T15:50:23.475784Z",
            "updated_at": "2025-03-27T02:00:55.479958Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "BlackTech",
                "Palmerworm"
            ],
            "source_name": "MITRE:BlackTech",
            "tools": [
                "Kivars",
                "PsExec",
                "TSCookie",
                "Flagpro",
                "Waterbear"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d3a7123c-f519-49a0-a234-de24a1ef052a",
            "created_at": "2022-10-25T16:47:55.545211Z",
            "updated_at": "2025-03-27T02:05:17.254744Z",
            "deleted_at": null,
            "main_name": "BRONZE CANAL",
            "aliases": [
                "CTG-6177 ",
                "Circuit Panda ",
                "Palmerworm ",
                "Shrouded Crossbow ",
                "BlackTech"
            ],
            "source_name": "Secureworks:BRONZE CANAL",
            "tools": [
                " DRIGO",
                " Flagpro",
                " Gh0stTimes",
                " PLEAD",
                " Spiderpig",
                " Waterbear",
                "Bifrose"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75024aad-424b-449a-b286-352fe9226bcb",
            "created_at": "2023-01-06T13:46:38.962724Z",
            "updated_at": "2025-03-27T02:00:02.964002Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "CIRCUIT PANDA",
                "Temp.Overboard",
                "G0098",
                "Red Djinn",
                "HUAPI",
                "Palmerworm",
                "T-APT-03",
                "Manga Taurus",
                "Earth Hundun"
            ],
            "source_name": "MISPGALAXY:BlackTech",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "efa7c047-b61c-4598-96d5-e00d01dec96b",
            "created_at": "2022-10-25T16:07:23.404442Z",
            "updated_at": "2025-03-27T02:02:09.781478Z",
            "deleted_at": null,
            "main_name": "BlackTech",
            "aliases": [
                "BlackTech",
                "Circuit Panda",
                "Earth Hundun",
                "Manga Taurus",
                "Operation PLEAD",
                "Operation Shrouded Crossbow",
                "Operation Waterbear",
                "Palmerworm",
                "Radio Panda",
                "Red Djinn",
                "T-APT-03",
                "TEMP.Overboard"
            ],
            "source_name": "ETDA:BlackTech",
            "tools": [
                "BIFROST",
                "BUSYICE",
                "BendyBear",
                "Bluether",
                "CAPGELD",
                "DRIGO",
                "Deuterbear",
                "Flagpro",
                "GOODTIMES",
                "Gh0stTimes",
                "IconDown",
                "KIVARS",
                "LOLBAS",
                "LOLBins",
                "Linopid",
                "Living off the Land",
                "TSCookie",
                "Waterbear",
                "XBOW",
                "elf.bifrose"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b72c2616-cc7c-4c47-a83d-6b7866b94746",
            "created_at": "2023-01-06T13:46:39.425297Z",
            "updated_at": "2025-03-27T02:00:03.08718Z",
            "deleted_at": null,
            "main_name": "Red Nue",
            "aliases": [
                "LuoYu"
            ],
            "source_name": "MISPGALAXY:Red Nue",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535970,
    "ts_updated_at": 1743041822,
    "ts_creation_date": 1653781483,
    "ts_modification_date": 1653781483,
    "files": {
        "pdf": "https://archive.orkl.eu/041aa91cd6399a294a9dbc98c78b3f3325431790.pdf",
        "text": "https://archive.orkl.eu/041aa91cd6399a294a9dbc98c78b3f3325431790.txt",
        "img": "https://archive.orkl.eu/041aa91cd6399a294a9dbc98c78b3f3325431790.jpg"
    }
}