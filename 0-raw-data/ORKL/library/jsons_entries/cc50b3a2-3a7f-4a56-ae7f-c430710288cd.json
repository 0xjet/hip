{
    "id": "cc50b3a2-3a7f-4a56-ae7f-c430710288cd",
    "created_at": "2023-04-05T02:09:39.672967Z",
    "updated_at": "2025-03-27T02:08:41.510287Z",
    "deleted_at": null,
    "sha1_hash": "060bfda0c3807cb4b6b3abb7c84b14c9b33a6caf",
    "title": "2023-02-28 - Malvertising Surges to Distribute Malware",
    "authors": "",
    "file_creation_date": "2023-04-03T08:24:25Z",
    "file_modification_date": "2023-04-03T08:24:25Z",
    "file_size": 430334,
    "plain_text": "# Malvertising Surges to Distribute Malware\n\n**[intel471.com/blog/malvertising-surges-to-distribute-malware](https://intel471.com/blog/malvertising-surges-to-distribute-malware)**\n\nMany intrusions and compromises start with the infection of an endpoint with malicious\nsoftware (malware). Malware distribution is often centered around tricking someone into\nopening an executable file that purports to be benign, such as a common software utility, but\nis actually malicious. One of the most common methods for distributing malware is through\nspam, but there are other ways. One long-used technique to land malware on systems saw a\nresurgence in December 2022.\n\n“Malvertising” is a portmanteau of malware and advertising. It involves buying search engine\nadvertisements and placing links in those ads that lead to malicious sites. The technique has\nbeen used by threat actors nearly as long as search-related, pay-per-click (PPC) ads have\nbeen around, but the recent surge was intense and unexpected. Here, Intel 471 explores\nhow malvertising works, some defenses to employ against it and examples of how it was\nrecently leveraged to distribute malware.\n\n**How PPC Works**\n\nGoogle’s PPC Ads platform is the primary medium actors use to distribute malware. Intel 471\nanalysts walked through the process of setting up a Google Ads campaign. The exercise\nrevealed a great deal about how these actors conduct campaigns and some theories about\nhow they obtain top search results for their advertisements.\n\n\n-----\n\nGoogle s PPC Ads management panel has a fairly intuitive design that allows users to view\ntheir advertisement campaign statistics at a glance. Users can view their current\nadvertisements, keywords, recommendations, statistics and total cost for each offer. Users\nmust supply a URL to create an advertisement, display paths for the URL, provide a\ndescription with the offer and craft some headlines for the advertisement. The descriptions,\nheadlines and site are factored into the equation that Google uses to calculate the\nadvertisement ranking.\n\nOnce an advertisement is created, users can set the maximum amount of money to spend\non PPC for an ad. Advertisement space is sold using a blind auction mechanism where\nadvertisers can outbid competitors but cannot see what others bid for advertisement space.\nGoogle’s old advertisement ranking algorithm previously considered how much advertisers\nbid to award advertisement placement rankings, however, the new system calculates a mix\nof advertisement bid price, description, headline and site checking.\n\nOnce users create an advertisement and set a bid price, they can begin using the multiple\ntools available on the Google Ads platform. Device targeting allows advertisers to set how\nmuch they want to bid on advertisements that will be shown only on certain types of devices,\nsuch as tablets or mobile phones.\n\nCustomers can use additional targeting available in the “Audience” tab of the Google Ads\npanel. Users can monitor the demographics for people who click on the advertisements,\ncreate targeted advertisements or exclude certain demographics and target specific types of\npeople, such as those working in financial services or hospitality. The platform also allows\nadvertisers to target customers based on geolocation in addition to audience tracking, or a\nvariety of factors that include cities, states and postcodes.\n\nPpctargeting 2\nA screenshot of the advertiser targeting options for the Google PPC Ads\nplatform Jan. 26, 2023.\n**BokBot**\n\nBokBot, also known as IcedID, is a banking trojan that also doubles as a downloader for\nadditional malware. The actors behind the development of BokBot historically had a\nrelationship with the Conti ransomware group and Trickbot, another type of banking malware\nand botnet used to distribute ransomware. During the past year, initial access brokers (IABs)\nincreasingly used BokBot as gateway malware for attacks in place of the now-defunct\nBazarLoader or Trickbot families. In December 2022 and January 2023, BokBot operators\nbegan experimenting with the Google PPC Ads platform for distribution.\n\nThe traffic distribution system (TDS) of these BokBot campaigns uses victim and bot filtering\non the landing page where the Google Search Ads engine points. This filtering ensures that\na connecting client is not coming from a virtual private network (VPN) IP address, makes\nuser agent checks and follows hypertext transfer protocol (HTTP) \"GET\" header criteria. If a\n\n\n-----\n\nconnection does not meet the criteria, the user is not redirected to the BokBot malicious\nlanding page and instead stays on the advertisement site, which may or may not be related\nto the targeted app or brand. This site typically is unrelated to the campaign. Connections\nthat meet the targeted criteria are redirected to the BokBot malicious landing page and will\nnever see the advertisement site.\n\nA recent BokBot campaign masqueraded as an advertisement for Docker, an operating\nsystem virtualization platform. The malicious advertisements contain typosquatted domains\nand appear higher than the legitimate offer for Docker. Once the user clicks on the ad link,\nBokBot’s first typosquatting domain performs some basic bot filtering to determine whether\nthe viewer of the advertisement is a legitimate victim to target and not a researcher. If the\ncheck fails based on user agent, user agent client hints or geolocation, the Docker campaign\nlanding page will direct the viewer to a fake tutorial on how to set up and use Docker.\n\nDockersearchresults\nA screenshot of a malicious Docker advertisement that appears\nbefore both the legitimate Docker search results and advertisement Jan. 26, 2023.\n**BatLoader and EugenLoader/FakeBat**\n\nMalware loaders, also called “droppers,” are the initial infections on systems which are then\nused by threat actors to download other malicious code. BatLoader, identified in February\n2022, is a type of loader that leverages Microsoft software installers (.msi) and PowerShell.\n\nIntel 471 recently uncovered that two different threat actors are distributing BatLoader\nthrough different command and control (C2) infrastructures. The campaign identified as\n[BatLoader by Mandiant in 2022 involved the execution of .BAT files by the .MSI during](https://www.mandiant.com/resources/blog/seo-poisoning-batloader-atera)\ninstall. A second campaign, however, does not involve the execution of .BAT files. Instead,\nthat malware has an inline PowerShell script that is executed in place of the .BAT file. Due to\nthese differences, Intel 471 analysts have decided to rename the second campaign to\nEugenLoader. It is also known as FakeBat.\n\nAs public reporting and our own reporting blended EugenLoader and BatLoader, it makes it\nhard to identify when EugenLoader first popped up. But it was likely running as of November\nor December 2022. During our investigation into EugenLoader, we found a domain that\nappeared to be used as the download destination for new campaigns. The root of the domain\nwas mistakenly left open and revealed .MSI files for EugenLoader campaigns. As seen\nbelow, the EugenLoader malware had been renamed to impersonate known software such\nas FileZilla, uTorrent and WinRAR, among others.\n\nOpenindex\nThe root directory of a domain for a suspected EugenLoader campaign was left\nopen.\nDuring distribution campaigns, EugenLoader stands up domains that purport to offer\nlegitimate popular software but instead substitute malware for what is promised.\n\n\n-----\n\nOne of the most consistently active malvertising campaigns for EugenLoader masquerades\nas WinRAR, which is a popular software utility for compressing and extracting files. While\nother campaigns seemed to get their advertisement to the top of the search results\nintermittently, the WinRAR campaign has no such limiters. This enables the actors to trick\nvictims into installing EugenLoader continually.\n\nEugenLoader was also distributed via a malvertising campaign that spoofed 7-Zip, which is\nanother popular file archiving software. Using well-crafted Google search advertisements,\nthis campaign is able to place its download links before the official 7-Zip download page as\nobserved in the image below.\n\n7zipsearchresults 2\nTwo PPC ads appear offering 7-Zip but with domains that are not\nrelated to the official project. This screenshot was taken during a Germany-based browsing\nsession Jan. 19, 2023.\n**Analysis**\n\nUntil recently, malvertising was not a preferred initial access vector and seldomly was used\ncompared to traditional vectors such as email spam. However, the operators behind\nEugenLoader were able to purchase advertisements that consistently appeared in the first\nsearch result position on Google. It should be assumed it is a dangerously successful\ntechnique that has the potential to challenge malware spam (malspam) as the go-to vector\nfor criminals.\n\nThere are advantages and disadvantages for malware distributors to place malicious\nadvertisements. First, an advantage: Bad actors capture an audience that is actively seeking\nout a tool to download. Appearing as the first search result means there’s a high probability\nsomeone may click without closely looking at the domain. The subsequent landing page then\nlooks identical to the legitimate one, and people are likely to download and install the tool.\n\nThis has advantages over spam, which may be caught and quarantined by security tools or\nsent to the spam folder, never meeting the eyes of the potential victim. If it does reach the\nvictim, the attacker must trick the person into taking action, such as opening an invoice,\nclicking on a link or running an executable. But malvertising catches people who want to\ndownload something and run it immediately.\n\nMalvertising doesn’t come cheap, however. PPC ads could cost as much as US $2 to US $3\nper click. Because bad actors are bidding for ad space, the actions also raise the costs for\nlegitimate advertisers. It is possible malvertisers are paying for the ads with stolen credit card\ninformation. How bad actors are paying for the ads would be another research avenue to\npursue, which could shed light on groups behind the campaigns.\n\nIn some cases, the success of campaigns could be gauged. Some of the malicious ads\ndirected victims to sites hosted on Bitbucket, which may show the number of downloads.\nOne campaign showed upward of 3,000 downloads. At US $2 a click, those who placed the\n\n\n-----\n\ncampaign may have paid as much as US $6,000, which shows the attackers have financial\nmeans. Other types of malware seen in the campaigns included information stealers such as\nRedLine. The malware often thwarted VirusTotal submission. The file sizes were up to 700\nMB, which is very large compared to the typical size of a dropper or loader. VirusTotal has a\nfile size limit of 32 MB (files [up to 200 MB may be submitted), which meant that malicious](https://developers.virustotal.com/v2.0/reference/file-scan#:~:text=File%20size%20limit%20is%2032MB,file%2Fscan%2Fupload_url%20endpoint.)\nfiles distributed by the campaigns weren’t necessarily turning up later for analysis.\n\nThe malvertising surge, which mostly affected Google, appeared to peak in mid-January\n2023 and has fallen since. The security community has been in touch with Google regarding\nits findings. Several researchers contributed to a spreadsheet that tracked malvertising\ncampaigns and the brands that were impersonated. Between Jan. 19, 2023, and Feb. 22,\n2023, the spreadsheet contained examples of 584 malvertising campaigns. Also,\n[researchers created tools such as this one by](https://github.com/rmceoin/gmalvertising) [Randy McEoin that can perform searches for](https://infosec.exchange/@rmceoin)\n[malvertising and this one by](https://github.com/cyberlibrarian/gmalscan) [Michael McDonnell that also takes screenshots of the](https://cyberlibrarian.ca/)\ncampaigns. Hopefully, awareness has increased and defenses have been raised to minimize\nfuture malvertising campaigns.\n\n**Defensive recommendations**\n\nIntel 471 recommends customers consider deploying advertisement-blocking browser\nextensions such as the “AdBlock,” “Adblock Plus” or “uBlock Origin” supported browser\nextensions. These mitigate the appearance of Google PPC Ads traffic and prevent users\nfrom being duped into attempting to install malware masquerading as a legitimate\napplication. Additional recommendations are to monitor for unauthorized MSIs and the\ninstallation and running of unsigned executables.\n\n[Special thanks to Jérôme Segura, senior director of threat intelligence at Malwarebytes, for](https://www.linkedin.com/in/jeromesegura/)\nhelp with this post.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-02-28 - Malvertising Surges to Distribute Malware.pdf"
    ],
    "report_names": [
        "2023-02-28 - Malvertising Surges to Distribute Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1680660579,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1680510265,
    "ts_modification_date": 1680510265,
    "files": {
        "pdf": "https://archive.orkl.eu/060bfda0c3807cb4b6b3abb7c84b14c9b33a6caf.pdf",
        "text": "https://archive.orkl.eu/060bfda0c3807cb4b6b3abb7c84b14c9b33a6caf.txt",
        "img": "https://archive.orkl.eu/060bfda0c3807cb4b6b3abb7c84b14c9b33a6caf.jpg"
    }
}