{
    "id": "1c188f57-0ddf-4e69-9421-d14e2bdec2a3",
    "created_at": "2022-10-25T16:48:24.80989Z",
    "updated_at": "2025-03-27T02:08:04.813257Z",
    "deleted_at": null,
    "sha1_hash": "d9e41bb3cd7ad22a358930b9eb53495e4409803a",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-05-26T06:32:01Z",
    "file_modification_date": "2020-05-26T06:32:01Z",
    "file_size": 296646,
    "plain_text": "**LEARN MORE**\n\n\n###### facing web applications, specifically those that use Telerik UI for ASP.NET, followed by execution and persistence using\n\n multiple techniques (check out my colleague Jesse Brown’s new blog for details on Blue Mockingbird’s COR_PROFILER\n\n persistence mechanism). During at least one incident, the adversary used proxying so�ware and experimented with\n\n di�erent kinds of reverse shell payloads to connect to external systems. The earliest Blue Mockingbird tools we’ve observed\n\n were created in December 2019.\n\n### Gaining entry\n\n###### In at least two incident response (IR) engagements, Blue Mockingbird has exploited public-facing web applications (T1190:\n\n Exploit Public-Facing Application) that implemented Telerik UI for ASP.NET AJAX. This suite of user interface components\n\n accelerates the web development process, but some versions are susceptible to a deserialization vulnerability, CVE-2019\n\n###### 18935 The exploitation of this CVE is not unique to Blue Mockingbird but it has been a common point of entry\n\n\n-----\n\n###### telemetry, investigators will notice w3wp.exe writing the DLLs to disk and then immediately loading them into memory\n\n a�erward. In some cases, this will cause w3wp.exe to temporarily freeze and fail to successfully serve HTTP responses.\n\n For a diagnostic to determine whether you are potentially a�ected by the Telerik CVE, you can search the IIS access logs for\n\n the string POST Telerik.Web.UI.WebResource.axd. In victim environments, our IR partners found entries similar to\n\n these:\n\n```\n2020-04-29 02:01:24 10.0.0.1 POST\n/Telerik.Web.UI.WebResource.axd type=rau 80 - \nMozilla/5.0+\n\n```\n```\n(Windows+NT+10.0;+Win64;+x64;+rv:54.0)+Gecko/20100101+Firefo\n\n```\n```\n - 200 0 0 625\n2020-04-29 02:01:27 10.0.0.1 POST\n/Telerik.Web.UI.WebResource.axd type=rau 80 - \nMozilla/5.0+\n\n```\n```\n(Windows+NT+10.0;+Win64;+x64;+rv:54.0)+Gecko/20100101+Firefo\n\n```\n```\n - 500 0 0 46\n\n```\n\n###### In the entries, the string 200 refers to HTTP response code 200 where the POST request was successful, and the string 500\n\n refers to HTTP code 500 where the POST request was not processed successfully by the web server. These code 500 entries\n\n happened when the w3wp.exe process loaded the uploaded DLLs into memory and temporarily froze.\n\n Searching the IIS access logs for entries like these is a good idea even if you don’t explicitly know whether you use Telerik\n\n UI, as some web applications require the suite as a dependency behind the scenes.\n\n If you have endpoint detection and response (EDR) or similar tools, you’ll notice cmd.exe or other suspicious processes\n\n spawning from w3wp.exe.\n\n### Execution and evasion\n\n###### The primary payload distributed by Blue Mockingbird is a version of XMRIG packaged as a DLL. XMRIG is a popular, open\n source Monero-mining tool that adversaries can easily compile into custom tooling. During the incidents, we noted three\n\n distinct uses.\n\n The first use was execution with rundll32.exe explicitly calling the DLL export fackaaxv (T1218.011: Rundll32). This\n\n export seems unique to this actor’s payloads and doesn’t seem to happen other places in the wild:\n```\nrundll32.exe dialogex.dll,fackaaxv\n\n```\n\n###### The next use was execution using regsvr32.exe using the /s command-line option (T1218.010: Regsvr32). Supplying the\n```\n/s switch executes the DllRegisterServer export exposed by the DLL payload. This export ultimately passed control of\n\n execution into the function that fackaax exported:\n\n```\n\n-----\n\n###### The final execution path was with the payload configured as a Windows Service DLL (T1569.002: Service Execution). Once\n\n configured, execution of the service invoked the export ServiceMain, which again passed control to fackaaxv.\n\n### Come for the exploit, stay for the mining\n\n###### Blue Mockingbird leveraged multiple techniques for persistence during incidents. The most novel technique was the use of\n\n a COR_PROFILER COM hijack to execute a malicious DLL and restore items removed by defenders (T1559.001: Component\n\n Object Model). To use COR_PROFILER, they used wmic.exe and Windows Registry modifications to set environment\n\n variables and specify a DLL payload.\n\n```\nwmic ENVIRONMENT where \"name='COR_PROFILER'\"\ndelete\nwmic ENVIRONMENT create\nname=\"COR_ENABLE_PROFILING\",username=\"\",VariableValue=\"1\"\nwmic ENVIRONMENT create\nname=\"COR_PROFILER\",username=\"\",VariableValue=\"\"\nREG.EXE ADD\nHKEY_LOCAL_MACHINE\\Software\\Classes\\CLSID\\\\InProcServer32\n /V ThreadingModel /T REG_SZ /D Apartment /F \nREG.EXE ADD\nHKEY_LOCAL_MACHINE\\Software\\Classes\\CLSID\\\\InProcServer32\n /VE /T REG_SZ /D\n\"c:\\windows\\System32\\e0b3489da74f.dll\" /F\n\n```\n\n###### The payload DLL specified as a COR_PROFILER was simple and gathered few antivirus detections. It executed the following\n\n command:\n\n```\ncmd.exe /c sc config wercplsupport start= auto &&\nsc start wercplsupport && copy\nc:\\windows\\System32\\dialogex.dll\nc:\\windows\\System32\\wercplsupporte.dll /y &&\nschtasks /create /tn \"Windows Problems Collection\"\n/tr \"regsvr32.exe /s\nc:\\windows\\System32\\wercplsupporte.dll\" /sc DAILY\n/st 20:02 /F /RU System && start \"\" regsvr32.exe\n/ \\ i d \\S t 32\\di l dll\n\n```\n\n-----\n\n###### Since COR_PROFILER was configured, every process that loaded the Microso� .NET Common Language Runtime would\n\n execute the command above, re-establishing persistence. The command configured the Windows Problem Reports and\n\n Solutions Control Panel Support service to execute automatically at boot (T1543.003: Windows Service). In a separate\n\n command, the actor modified the existing wercplsupport service to use the miner DLL instead of the legitimate one:\n\n```\nreg add\n\n```\n```\n\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\wercpl\n\n```\n```\n /f /v ServiceDll /t REG_EXPAND_SZ /d\n\"c:\\windows\\System32\\wercplsupporte.dll\"\n\n```\n\n###### Note that the actor used the DLL name wercplsupporte.dll as an attempt to masquerade as the legitimate DLL name,\n\n which is wercplsupport.dll (T1036.005: Match Legitimate Name or Location). In addition, more masquerading was\n\n used to make malicious Scheduled Tasks blend in with legitimate ones (T1053.005: Scheduled Task).\n\n In some cases, the actor even created a new service to perform the same actions as the COR_PROFILER payload:\n\n```\nsc create 8995 binPath= \"cmd /c sc config\nwercplsupport start= auto & sc start wercplsupport\n& copy c:\\windows\\System32\\8995.dll\nc:\\windows\\System32\\wercplsupporte.dll /y &\nregsvr32.exe /s c:\\windows\\System32\\8995.dll\"\ntype= share start= auto error= ignore DisplayName=\n8995\n\n```\n\n### Escalating privileges and accessing credentials\n\n###### It’s worth noting that Blue Mockingbird’s initial access does not provide the privileges needed to establish the many\n\n persistence mechanisms used. In one engagement we observed, the adversary using a JuicyPotato exploit to escalate\n\n privileges from an IIS Application Pool Identity virtual account to the NT Authority\\SYSTEM account. JuicyPotato allows\n\n\n-----\n\n###### highest level of privilege on a system (T1068: Exploitation for Privilege Escalation). During this engagement, the attacker\n\n abused a DCOM class and leveraged the IIS Application Pool Identity’s SeImpersonate privilege to perform the escalation:\n\n```\nc:\\programdata\\let.exe -t t -p\nc:\\programdata\\rn.bat -l 1234 -c {8BC3F05E-D86B11D0-A075-00C04FB68820}\n\n```\n\n###### In another engagement, we observed the adversary using Mimikatz (the o�icial signed version) to access credentials for\n\n logon (T1003.001: LSASS Memory).\n\n### Free to move around the network\n\n###### As with other adversaries that mine cryptocurrency opportunistically, Blue Mockingbird likes to move laterally and\n\n distribute mining payloads across an enterprise. We observed Blue Mockingbird move laterally using a combination of the\n\n Remote Desktop Protocol to access privileged systems and Windows Explorer to then distribute payloads to remote\n\n systems (T1021.001 Remote Desktop Protocol, T1021.002 SMB/Windows Admin Shares). In some cases, Scheduled Tasks\n\n were created remotely with schtasks.exe /S to ensure execution.\n\n```\nschtasks /create /tn \"setup service Management\"\n/tr \"c:\\windows\\temp\\rn.bat\" /sc ONCE /st 00:00 /F\n/RU System /S remote_host\n\n```\n\n### A look at command and control\n\n###### A novel aspect of this adversary is that their toolkit does not appear to be fully defined. In at least one engagement, we\n\n observed Blue Mockingbird seemingly experimenting with di�erent tools to create SOCKS proxies (T1090: Proxy) for\n\n pivoting. These tools included a fast reverse proxy (frp), Secure Socket Funneling (SSF), and Venom. In one instance, the\n\n adversary also tinkered with PowerShell reverse TCP shells and a reverse shell in DLL form (T1059.001: PowerShell).\n\n### Take action\n\n\n-----\n\n###### Resource Hijacking). First, the export fackaaxv has been consistently present in the DLLs. Next, each DLL also contains a\n\n PE binary section _RANDOMX. This section appears unique to cryptocurrency-mining payloads because it houses the\n\n RandomX proof of work algorithm that XMRIG may use. The network connections made for mining usually involve a\n```\nnanopool[.]org domain.\n\n We made the assessment that the payload was actually XMRIG based on several pieces of evidence. First, there were\n\n multiple references to “xmrig”, including version numbers, in the binary strings. These were accompanied by cleartext\n\n references to command-line options common to XMRIG:\n\n```\n```\ncoin\n\n```\n```\ndonate-level\n\n```\n```\nmax-cpu-usage\n\n```\n```\ncpu-priority\n\n```\n```\nlog-file\n\n```\n\n###### The final piece of evidence came from a text log written to disk by some versions of the miner DLL. In the text logs,\n\n identifying information for XMRIG was output alongside hardware details for the victim system.\n\n```\n* ABOUT    XMRig/5.3.0 MSVC/2015\n* LIBS    libuv/1.31.0 OpenSSL/1.1.1c\nhwloc/2.1.0\n* HUGE PAGES    unavailable\n\n```\n\n-----\n\n```\n* CPU    Intel(R) Core(TM) i7-4770 CPU @\n3.40GHz (1) x64 AES\n         L2:0.3 MB L3:8.0 MB 1C/1T NUMA:1\n* MEMORY    1.3/4.0 GB (33%)\n* DONATE    0%\n* POOL #1    xmr-au1.nanopool.org:14433 coin\nmonero\n* COMMANDS    'h' hashrate, 'p' pause, 'r'\nresume\n* OPENCL    disabled\n* CUDA    disabled\n[2020-04-16 08:30:26.753] [xmrau1.nanopool.org:14433] DNS error: \"unknown node\nor service\"\n\n```\n\n###### Each payload comes compiled with a standard list of commonly used Monero-mining domains alongside a Monero wallet\n\n address. So far, we’ve identified two wallet addresses used by Blue Mockingbird that are in active circulation. Due to the\n\n private nature of Monero, we cannot see the balance of these wallets to estimate their success. We’ve seen mining payloads\n\n compiled as early as December 2019 and as recently as late April 2020. In each compilation, one of the two wallets has\n\n been embedded into the binary. The wallet addresses could be extracted from the binaries easily in earlier versions using a\n\n simple strings command. In newer versions, the string is obfuscated.\n\n Even with string obfuscation in the binary, you can observe the wallet addresses in network tra�ic. During execution of the\n\n miner DLLs, unique information is passed in cleartext across TCP streams:\n\n We recommend the following analytics:\n\n Process is cmd.exe with command line including sc AND config AND wercplsupporte.dll\n\n Any process where command line includes -t AND -c AND -l with network connections from 127.0.0.1 and to\n```\n   127.0.0.1 on port tcp135 (JuicyPotato)\n\n Process is schtasks.exe with command line including /create AND sc start wercplsupport\n\n Process is rundll32.exe with command line including fackaaxv\n\n Process is regsvr32.exe with command line including /s and having an external network connection\n\n Process is wmic.exe with command line including create AND COR_PROFILER\n\n```\n\n-----\n\n###### techniques used by Blue Mockingbird will bypass whitelisting technologies, so the best route will be to inhibit initial access.\n\n Consider establishing a baseline of Windows Scheduled Tasks in your environment to know what is normal across your\n\n enterprise.\n\n### Let’s collaborate!\n\n###### If you’ve been tracking similar activity, we’d love to hear from you and collaborate. Contact blog@redcanary.com with any\n\n observations or questions.\n\n INDICATORS OF COMPROMISE FOR XMRIG MINER DLLS\n\n\n###### compile\n\n\n###### time imphash\n\n\n###### a9d40d5a22948019ae9c5f1b464\n\n\n###### aed97d3d2b87ab0b55dab3a3ee\n\n\n###### 1614f0ce7b6c11bf8bd8a76885c\n\n\n###### 1614f0ce7b6c11bf8bd8a76885c\n\n\n###### aed97d3d2b87ab0b55dab3a3ee\n\n\n###### aed97d3d2b87ab0b55dab3a3ee\n\n\n###### 1614f0ce7b6c11bf8bd8a76885c\n\n\n###### aed97d3d2b87ab0b55dab3a3ee\n\n|sha256|time|\n|---|---|\n|d388c309a540d4619169a07a4b64707f4c44953511875b57ad7cfa3e097115af|12/19/2019 17:49:20|\n|14e3c16ca940244bea9b6080fa02384ebb4818572cef7092f90d72ae210b330d|1/4/2020 12:00:23|\n|5377c69c05817a0e18f7b0ebbeed420f9ab8d1e81b439f439b42917fbe772dfb|2/6/2020 10:24:29|\n|c957d007824ee8173c67122a1843c979c818614eeed7db03dea3ba7fede43eba|2/6/2020 10:24:29|\n|5d7116f04e10e968de64c4201fc7374fa84b364e90f8e4eba0fbc41afeaf468c|2/19/2020 13:52:10|\n|909495884627e2e74d07d729b5e046f3ae01cabd9f0a5a99c74d46046a677f7c|2/22/2020 14:38:33|\n|ab698a35dc5263f0ca460f09dcbc9f8a4aeb7643365a1e7fa122581ef72c34b6|3/8/2020 16:57:32|\n|60504228b3fc524287bf2a260db933a408639b2f1a29af7538c61b00c4a44c86|3/24/2020 16:15:16|\n\n\n-----\n\n###### compile\n\n\n###### time imphash\n\n\n###### 9ccdf92e630d907101a249f15245\n\n\n###### aed97d3d2b87ab0b55dab3a3ee\n\n\n###### aed97d3d2b87ab0b55dab3a3ee\n\n\n###### aed97d3d2b87ab0b55dab3a3ee\n\n|sha256|time|\n|---|---|\n|1d30d3cafdcc43b2f9a593983ad096c2c3941025fb4e91257e2dcf0919ed24ba|3/24/2020 16:15:44|\n|968b324be2b89f1a8ee4743d946723c1wdca16ccfbbbbb68e5b9f60e0bw4c9|4/9/2020 16:05:45|\n|018a02fd0dbc63e54656b8915d71cd8a2ce4409608ae4dw6ec196wa8743ba1|4/14/2020 19:00:06|\n|b31f7152a547fa41c31f9c96177b2cd7131a93f7c328bf6da360dc1586ba18dc|2020-04-26 14:58:24|\n\n\n###### INDICATORS OF COMPROMISE FOR COR_PROFILER DLLS\n\n\n###### compile\n\n\n###### time imphash\n\n\n###### 8432f0b0e6fbfe4ac5d53400aa09d6\n\n\n###### 8432f0b0e6fbfe4ac5d53400aa09d6\n\n|sha256|time|\n|---|---|\n|9a432ea16e74b36c55ec5faa790937fe752w2561cef83e44856fd1e72398309|2020-02- 16 9:24:30|\n|de6c061aafc5d86e692bec45f69b2ea18639abd540b59c2c281717a054a48dd5|2020-02- 22 14:57:17|\n\n\n###### RELATED\n\n ARTICLES\n\n\n**MAY 7, 2020**\n\n**[DETECTION AND RESPONSE](https://redcanary.com/blog/?topic=detection-response)**\n\n###### Detecting COR_PROFILER manipulation for persistence\n\n\n-----\n\n**APRIL 28, 2020**\n\n**[DETECTION AND RESPONSE](https://redcanary.com/blog/?topic=detection-response)**\n\n###### Lateral Movement with Secure Shell (SSH)\n\n**MARCH 26, 2020**\n\n**[DETECTION AND RESPONSE](https://redcanary.com/blog/?topic=detection-response)**\n\n###### 2020 Threat Detection Report: the conversation continues\n\n**MARCH 18, 2020**\n\n**[DETECTION AND RESPONSE](https://redcanary.com/blog/?topic=detection-response)**\n\n###### Worms shape the narrative in Red Canary’s 2020 Threat Detection Report\n\n\n###### Email Address\n#### Subscribe to our blog\n\n\n**SUBSCRIBE**\n\n\n###### Demo\n\n\n# See what it's like\n\n\n-----\n\n# to have a partner in the fight.\n\n##### Experience the di�erence between a sense of security and actual security.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.05.07_Blue_Mockingbird/Blue%20Mockingbird%20activity%20mines%20Monero%20cryptocurrency.pdf"
    ],
    "report_names": [
        "Blue Mockingbird activity mines Monero cryptocurrency"
    ],
    "threat_actors": [
        {
            "id": "e568e9d7-ae94-4ce5-9039-4fd17c731c1d",
            "created_at": "2022-10-25T15:50:23.491763Z",
            "updated_at": "2025-03-27T02:00:55.483586Z",
            "deleted_at": null,
            "main_name": "Blue Mockingbird",
            "aliases": [
                "Blue Mockingbird"
            ],
            "source_name": "MITRE:Blue Mockingbird",
            "tools": [
                "FRP",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041284,
    "ts_creation_date": 1590474721,
    "ts_modification_date": 1590474721,
    "files": {
        "pdf": "https://archive.orkl.eu/d9e41bb3cd7ad22a358930b9eb53495e4409803a.pdf",
        "text": "https://archive.orkl.eu/d9e41bb3cd7ad22a358930b9eb53495e4409803a.txt",
        "img": "https://archive.orkl.eu/d9e41bb3cd7ad22a358930b9eb53495e4409803a.jpg"
    }
}