{
    "id": "a08e0548-95a9-442f-a3f9-de702ca7ec75",
    "created_at": "2023-01-12T15:04:45.699136Z",
    "updated_at": "2025-03-27T02:05:53.528517Z",
    "deleted_at": null,
    "sha1_hash": "9ebb8de6a2af03cee24b6e927214649dfae3586f",
    "title": "2021-04-05 - TrickBot Crews New CobaltStrike Loader",
    "authors": "",
    "file_creation_date": "2022-05-28T17:58:21Z",
    "file_modification_date": "2022-05-28T17:58:21Z",
    "file_size": 81873,
    "plain_text": "# TrickBot Crews New CobaltStrike Loader\n\n**[medium.com/walmartglobaltech/trickbot-crews-new-cobaltstrike-loader-32c72b78e81c](https://medium.com/walmartglobaltech/trickbot-crews-new-cobaltstrike-loader-32c72b78e81c)**\n\nJason Reaves April 5, 2021\n\n### Jas on\n\n\n### Jason Reaves\n\n Apr 5, 2021\n\n ·\n\n 4 min read\n\n By: Jason Reaves and Joshua Platt\n\n\n-----\n\n### Recently we stumbled upon a new CS loader being leveraged by an actor involved in TrickBots CS and ransom operations.\n\n\n-----\n\n### Ref: Virustotal.com In the screenshot above we can see domains that have been leveraged by TrickBots crew for running their CobaltStrike infections in the past but another sample recently showed up which is a new loader which as we will see later is for delivering CobaltStrike as well but in a new way than their previous deliveries by leveraging GitHub for hosting the encoded data.\n\n## New Loader\n```\nMD5:   5b203929f9e42c6d14b7153c5f11d387SHA1:  \n4e6a42b0da1185a4331e085ee68b64f61e1d9e83SHA256: \n0234f80c6fd3768f9619d6fcd50d775ec686719fcc665007bfd1606bbe787744\n\n### Most of the important strings are obfuscated:\n\n```\n\n-----\n\n### String stored in data\n\n String loaded on stack In both cases the strings are ultimately decoded by XORing with a single byte and subtracting the iterator+1 from the value, in these cases the XOR key is simply 0 however. An example of IDA code for decoding the various strings can be found below:\n```\ndef decode(s,k):\n blob = bytearray(s[5:])\n for i in range(len(blob)):\n  blob[i] ^= k\n  blob[i] = (blob[i] - (i+1)) & 0xff\n return blob\n def tdecode(addr): out = \"\" while GetMnem(addr) == \"mov\" and GetOperandValue(addr,1)\n!= 0: out += chr(GetOperandValue(addr,1)) addr = idc.NextHead(addr) return\ndecode(out,0)\n\n```\n\n-----\n\n### A partial listing of relevant strings can be found below:\n```\nAsderfolkij092/laughingpancake/main/profile.jpgCurlGETraw.githubusercontent.comNtAllocateVirtualMemorywininet.dl\n\n The sample will manually load kernel32.dll and ntdll.dll into memory to resolve some of its functions but will utilize LoadLibraryW for loading wininet.dll. The sample will also utilize VirtualAllocExNuma for loading the DLLs into memory:\n\n After resolving the necessary dependencies the loader will simply attempt to download a file that will be decoded and then executed in memory. As can be seen in the partial listing of strings above this file was being hosted on GitHub at one time:\nraw.githubusercontent.com/Asderfolkij092/laughing-pancake/main/profile.jpg\n\n This account is no longer active and appears to of been deleted possibly eluding to the actors cleaning up after themselves after leveraging their campaigns. We did manage to discover an active account being leveraged however:\n\n```\n\n-----\n\n### Ref: github.com The file that will be used is in the ‘ubiquitous-sniffle’ repository:\n\n\n-----\n\n### Ref: github.com The safety.png file is not an image at all, it is actually just a small binary blob of data:\n```\n00000000: 00b9 e031 3244 200d 1c02 71cc 1058 8486 ...12D ...q..X..00000010: 4023 3018\n22c4 3364 228c 8878 2e0a d488 @#0.\".3d\"..x....00000020: 8746 0c81 353e 7614 5903 630d\n1920 49da .F..5>v.Y.c.. I.00000030: 3038 7186 4822 28f1 d8a8 c132 a110 9031 08q.H\"\n(....2...100000040: 6d60 3c68 13a7 c018 1379 e2c1 7113 cf49 m`<h.....y..q..I00000050:\n8132 764e 242a f046 cc92 3533 1a11 28e4 .2vN$*.F..53..(.00000060: 86c1 2057 0d12 11e8\n52e0 901c 51bb 52c4 .. W....R...Q.R.<...>\n\n After we decode this blob of data we are left with a C-style string of hex bytes which appear at first glance to be shellcode:\n\n```\n\n-----\n\n```\nxFC\\x48\\x83\\xE4\\xF0\\xE8\\xC8\\x00\\x00\\x00\\x41\\x51\\x41\\x50\\x52\\x51\\x56\\x48\\x31\\xD2\\x65\\x48\\x\n <...>\n\n### Converting to bytes:\n<...>\\x82\\xff\\xff\\xff/gifs20210122.dat\\x00\\xb4\\xeb\\xee\\x92?\n\\xfe\\xfc\\x9f\\xce\\x92{\\x14\\xe3P\\xd9\\xef\\x89\\xd5\\x11\\xbcmM\\xd4=L\\xc6\\xf6(\\xbb>\\xfd\\x0e\\xc3w\n \\xf9\\x1f\\xd5W\\xcd\\x14H\\xca\\x97O\\xeb\\xf1\\x1c\\xb6\\x80Z.2WgKhq\\x1f\\x80\\x00Connection:\nKeep-Alive\\r\\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win32; x32; rv:71.0)\nGecko/20100101 Firefox/71.0\\r\\n\\x00ce\\xd6\\xf6W\\xe5\\x03\\xc1C\\x935\\x7f4\\x97|\\x96\\x13\\xf3\\xfe\\x87\\xd1\\xc4q1pdwH\\rQ\\x91{\\x90\\xe7\\xdff\\xbd\\xb9(v\\x18\\x8b\\xfb\\\n g\\xae\\xf4\\x84\\xb4\\x00\\x1f,\\xb1\\x9bOiw\\xfc\\xc0\\x19\\xa6\\x02\\xeb\\xe2c=m\\xb6\\xb4(Q\\x8d?\nY\\x0e\\xda0?\ny\\xe0;\\xd6|\\xf1\\x9dDT\\xd2\\xd5\\x9a#\\xe7b;\\xe7\\x1c\\x9a\\xda\\x8fH\\xfa\\x01\\x00A\\xbe\\xf0\\xb5\\xa\n \\x00\\x00I\\x89\\xf9A\\xba\\x12\\x96\\x89\\xe2\\xff\\xd5H\\x83\\xc4\n\\x85\\xc0t\\xb6f\\x8b\\x07H\\x01\\xc3\\x85\\xc0u\\xd7XXXH\\x05\\x04\\x00\\x00\\x00P\\xc3\\xe8\\x7f\\xfd\\xff\n\n Which will download a 64bit CobaltStrike beacon:\n{  'C2_CHUNK_POST': '0',  'C2_POSTREQ': '[(\\'_HEADER\\', 0, \"bytearray(b\\'Accept:\n*/*\\')\"), (\\'_HEADER\\', 0, \"bytearray(b\\'Content-Type: multipart/form-data; boundary=----------HYUNSJFDCNHWEUFNJ\\')\"), (\\'BUILD\\', (\\'NETBIOS\\',)), (\\'_HEADER\\', 2336,\n\\'bytearray(b\\\\\\' \\\\\\\\t   \\\\\\\\n\\\\\\\\t  \\\\\\\\t  \nmenu\\\\\\\\x00\\\\\\\\x00\\\\\\\\x00\\\\\\\\x01\\\\\\\\x00\\\\\\\\x00\\\\\\\\x00\\\\\\\\xc0\\\\\\\\n----------HYUNSJFDCNHWEUFNJ\\\\\\\\n\\\\\\\\t      Content-Disposition: form-data;\nname=\"pic\"\\\\\\\\n\\\\\\\\t      \\\\\\\\n\\\\\\\\t      dropdown-menu dropdown-menu-swmenu\\\\\\\\n\\\\\\\\t      -----------HYUNSJFDCNHWEUFNJ-\\\\\\\\x00\\\\\\\\x00\\\\\\\\x00\\\\\\\\x04\\\\\\\\x00\\\\\\\\x00\\\\\\\\x00\\\\\\\\x07\\\\\\\\x00\\\\\\\\x00\\\\\\\\x00\\\\\\\\x00\\\\\\\\x\n  'C2_RECOVER': \"b'04000000010000002400000008000000010000008c'\",  'C2_REQUEST':\n'[(\\'_HEADER\\', 0, \"bytearray(b\\'Accept: image/webp,*/*\\')\"), (\\'_HEADER\\', 0,\n\"bytearray(b\\'Accept-Encoding: gzip, deflate, br\\')\"), (\\'_HEADER\\', 0,\n\"bytearray(b\\'Accept-Language: en-US,en;q=0.5\\')\"), (\\'_HEADER\\', 0,\n\"bytearray(b\\'Cache-Control: max-age=0\\')\"), (\\'BUILD\\', (\\'BASE64URL\\',)), (\\'HEADER\\',\n17263, \"bytearray(b\\'ie\\')\")]',  'C2_VERB_GET': 'GET',  'C2_VERB_POST': 'POST',  \n'CRYPTO_sCHEME': '0',  'DOMAINS': 'subs.rainbowmango.info\n,/share/pink,food.rainbowmango.info,/share/pink',  'HostHeader': '',  'ITTER': '55',\n'KillDate': '0',  'MAXGET': '2097468',  'ObfSectionsInfo':\n\"b'c0020072b8030000c00300888504000090040034b0040000c004005ecf04'\",  'PORT': '443',  \n'PROTOCOL': '8',  'PROXY_BEHAVIOR': '2',  'PUBKEY':\n\"b'30819f300d06092a864886f70d010101050003818d0030818902818100a70991d69d816a601ffa80976473\n  'ProcInject_AllocationMethod': '0',  'ProcInject_Execute':\n'\\x01\\x03\\x06\\x10\\x00\\x00\\x00\\x00\\nntdll.dll\\x00\\x00\\x00\\x00\\x13RtlUserThreadStart\\x00\\x0\n \\x00\\x00\\x00\\x00\\rkernel32.dll\\x00\\x00\\x00\\x00\\rLoadLibraryA\\x00\\x04',  \n'ProcInject_MinAllocSize': '16535',  'ProcInject_Prepend_x64': '',  \n'ProcInject_Prepend_x86': '',  'ProcInject_StartRWX': '4',  'ProcInject_Stub':\n\"b'0ce2f55444e4793516b5afe967be9255'\",  'ProcInject_UseRWX': '32',  'SLEEPTIME':\n'6145',  'SPAWNTO': '',  'SPAWNTO_X64': '%windir%\\\\sysnative\\\\gpupdate.exe',  \n'SPAWNTO_X86': '%windir%\\\\syswow64\\\\gpupdate.exe',  'SUBMITURI': '/us',  \n'USERAGENT': 'Mozilla/5.0 (Windows NT 10.0; Win32; x32; rv:74.0) Gecko/2010010101\nFirefox/74.0',  'UsesCookies': '1',  'WATERMARK': '1359593325',  'bCFGCaution':\n'0',  'bStageCleanup': '0',  'textSectEnd': '177872'}\n\n## References\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-05 - TrickBot Crews New CobaltStrike Loader.pdf"
    ],
    "report_names": [
        "2021-04-05 - TrickBot Crews New CobaltStrike Loader.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535885,
    "ts_updated_at": 1743041153,
    "ts_creation_date": 1653760701,
    "ts_modification_date": 1653760701,
    "files": {
        "pdf": "https://archive.orkl.eu/9ebb8de6a2af03cee24b6e927214649dfae3586f.pdf",
        "text": "https://archive.orkl.eu/9ebb8de6a2af03cee24b6e927214649dfae3586f.txt",
        "img": "https://archive.orkl.eu/9ebb8de6a2af03cee24b6e927214649dfae3586f.jpg"
    }
}