{
    "id": "1b6c2b2a-3fc9-40a2-bb74-296a378ecb2b",
    "created_at": "2023-01-12T15:09:28.608266Z",
    "updated_at": "2025-03-27T02:16:34.642989Z",
    "deleted_at": null,
    "sha1_hash": "7b80d30eb4ac1f50d1a974c08d1a12aaade43f89",
    "title": "2021-10-12 - Defining Cobalt Strike Components So You Can BEA-CONfident in Your Analysis",
    "authors": "",
    "file_creation_date": "2022-05-26T02:45:58Z",
    "file_modification_date": "2022-05-26T02:45:58Z",
    "file_size": 1929471,
    "plain_text": "# Defining Cobalt Strike Components So You Can BEA- CONfident in Your Analysis\n\n**[mandiant.com/resources/defining-cobalt-strike-components](https://www.mandiant.com/resources/defining-cobalt-strike-components)**\n\nBlog\n\nAlyssa Rahman\n\nOct 12, 2021\n\n23 mins read\n\nMalware\n\nThreat Research\n\n**Cobalt Strike is a commercial adversary simulation software that is marketed to red**\nteams but is also stolen and actively used by a wide range of threat actors from\nransomware operators to espionage-focused Advanced Persistent Threats (APTs). Many\nnetwork defenders have seen Cobalt Strike payloads used in intrusions, but for those who\nhave not had the opportunity to use Cobalt Strike as an operator, it can be challenging to\nunderstand the many components and features included in this framework.\n\n\n-----\n\nIn this blog post, we will walk through important definitions and concepts to help\ndefenders understand Cobalt Strike and, hopefully, identify new ways to hunt for, respond\nto, and attribute malicious actors using this tool.\n\nThis content is informed by a combination of official documentation, public research, and\nMandiant’s own experience with both performing red team assessments and responding\nto intrusions where threat actors are using Cobalt Strike. Because Cobalt Strike is used\nfor both legitimate testing and for intrusions, in this post we will refer to all Cobalt Strike\nusers, regardless of motivation, as \"operators\" for simplicity.\n\nWhile this blog post is focused on explaining Cobalt Strike and BEACON artifacts to aid\ndefenders’ analysis, we have also included references to several resources to learn more\nabout Cobalt Strike and how to detect common BEACON activity at various stages of the\nattack lifecycle.\n\n## Important Components\n\n### Cobalt Strike, BEACON, Team Server. Oh My!\n\nYou may hear the names Cobalt Strike, BEACON, and even team server used\ninterchangeably, but there are some important distinctions between all of them.\n\n**Cobalt Strike is the command and control (C2) application itself. This has two primary**\ncomponents: the team server and the client. These are both contained in the same Java\nexecutable (JAR file) and the only difference is what arguments an operator uses to\nexecute it.\n\n**Team server is the C2 server portion of Cobalt Strike. It can accept client**\nconnections, BEACON callbacks, and general web requests.\n\nBy default, it accepts client connections on TCP port 50050.\nTeam server only supports being run on Linux systems.\n**Client is how operators connect to a team server.**\n\nClients can run on the same system as a Team server or connect remotely.\nClient can be run on Windows, macOS or Linux systems.\n\n**BEACON is the name for Cobalt Strike’s default malware payload used to create a**\nconnection to the team server. Active callback sessions from a target are also called\n\"beacons\". (This is where the malware family got its name.) There are two types of\nBEACON:\n\nThe Stager is an optional BEACON payload. Operators can \"stage\" their malware\nby sending an initial small BEACON shellcode payload that only does some basic\nchecks and then queries the configured C2 for the fully featured backdoor.\nThe Full **backdoor can either be executed through a BEACON stager, by a “loader”**\nmalware family, or by directly executing the default DLL export “ReflectiveLoader”.\nThis backdoor runs in memory and can establish a connection to the team server\nthrough several methods.\n\n\n-----\n\n**Loaders are not BEACON. BEACON is the backdoor itself and is typically executed with**\nsome other loader, whether it is the staged or full backdoor. Cobalt Strike does come with\ndefault loaders, but operators can also create their own using PowerShell, .NET, C++,\nGoLang, or really anything capable of running shellcode.\n\n### It’s All Connected\n\n**[Listeners are the Cobalt Strike component that payloads, such as BEACON, use to](https://www.cobaltstrike.com/help-listener-management)**\nconnect to a team server. Cobalt Strike supports several protocols and supports a wide\nrange of modifications within each listener type. Some changes to a listener require a\n\"listener restart\" and generating a new payload. Some changes require a full team server\nrestart.\n\n**[HTTP/HTTPS is by far the most common listener type.](https://www.cobaltstrike.com/help-http-beacon)**\n\nWhile Cobalt Strike includes a default TLS certificate, this is well known to\ndefenders and blocked by many enterprise products (“signatured”). Usually\noperators will generate valid certificates, such as with LetsEncrypt, for their C2\ndomains to blend in.\nThanks to Malleable Profiles (discussed later in the post), operators can\nheavily configure how the BEACON network traffic will look and can\nmasquerade as legitimate HTTP connections.\nOperators can provide a list of domains/IPs when configuring a listener, and\nthe team server will accept BEACON connections from all of them (see\n\"Redirectors\"). Operators can also specify Host header values (see \"Domain\nFronting\").\n**Hybrid (DNS+HTTP) is the default and uses DNS for a beacon channel and**\nHTTP for a data channel.\n**Pure DNS can also be enabled to use DNS for both beacon and data**\nchannels. This leverages regular A record requests to avoid using HTTPS and\nprovide a stealthier, though slower method of communication.\n**[SMB is a bind style listener and is most often used for chaining beacons. Bind](https://www.cobaltstrike.com/help-smb-beacon)**\nlisteners open a local port on a targeted system and wait for an incoming\nconnection from an operator. See \"Important Concepts > Chaining Beacons\" for\nmore information.\n**[Raw TCP is a (newer) bind style listener and can also be used for chaining](https://www.cobaltstrike.com/help-tcp-beacon)**\nbeacons. See \"Important Concepts > Chaining Beacons\" for more information.\n\nThe final two listeners are less common, but they provide compatibility with other payload\ntypes.\n\n**[Foreign listeners allow connections from Metasploit’s](https://www.cobaltstrike.com/help-listener-management)** [Meterpreter backdoor to](https://www.offensive-security.com/metasploit-unleashed/about-meterpreter/)\nsimplify passing sessions between the Metasploit framework and the Cobalt Strike\nframework.\n**[External C2 listeners provide a specification that operators can use to connect to a](https://www.cobaltstrike.com/help-externalc2)**\nteam server with a reverse TCP listener. Reverse listeners connect back and\nestablish an external connection to an operator, instead of waiting for an incoming\nconnection such as with “bind” listeners.\n\n\n-----\n\n### It s (Almost) All Customizable\n\n**[Arsenal Kits are available for download, with a valid license, and for use with licensed](https://cobaltstrike.com/scripts)**\n(or cracked) installations only. Arsenal kits are sometimes distributed with cracked copies\nof Cobalt Strike. The full list of kits (as of October 2021) is:\n\n**[Applet/PowerApplet Kit allows operators to modify Cobalt Strike’s built-in Java](https://blog.cobaltstrike.com/2017/10/03/kits-profiles-and-scripts-oh-my/)**\nApplet payloads. This kit was the first to be added to Arsenal and is no longer\nwidely used.\n**[Artifact Kit allows operators to modify the templates for all Cobalt Strike](https://www.cobaltstrike.com/help-artifact-kit)**\nexecutables, DLLs, and shellcode. This kit was added in January 2014 and is still\nused.\n**[Elevate Kit allows operators to integrate their privilege escalation exploits as Cobalt](https://www.cobaltstrike.com/help-elevate)**\nStrike commands. This kit was released in December 2016. Unlike other kits, this is\n[public, and it is essentially just an Aggressor Script to streamline loading your own](https://github.com/rsmudge/ElevateKit)\nPowerShell scripts, binaries, etc. into a BEACON session (see “Aggressor Scripts”).\n**[Mimikatz Kit allows operators to update their version of Mimikatz without waiting for](https://blog.cobaltstrike.com/2021/07/29/introducing-mimikatz-kit/)**\na Cobalt Strike software update. This kit was added in July 2021.\n**[Resource Kit allows operators to modify the script templates Cobalt Strike uses](https://www.cobaltstrike.com/help-resource-kit)**\n(mostly as loaders). This kit was added in May 2017 and is still used.\n\n**[User Defined Reflective Loaders Kit allows operators to customize the reflective](https://www.cobaltstrike.com/help-user-defined-reflective-loader)**\nloader functionality used by BEACON. This kit was added in August 2021.\n\n**[Malleable Profileis the final part of Arsenal Kit, and it allows operators to extensively](https://www.cobaltstrike.com/help-malleable-c2)**\nmodify how their Cobalt Strike installation works. It is the most common way operators\n[customize Cobalt Strike and has thus been heavily](https://blog.zsec.uk/cobalt-strike-profiles/) [documented.](https://posts.specterops.io/a-deep-dive-into-cobalt-strike-malleable-c2-6660e33b0e0b)\n\nChanges to a Malleable Profile require a team server restart and, depending on the\nchange, may require re-generating payloads and re-spawning beacon sessions.\nThere are several robust open-source projects that generate randomized profiles\nwhich can make detection challenging. Still, operators will often reuse profiles (or\nonly slightly modify them) allowing for easier detection and potentially attribution\nclustering.\nWhen analyzing samples, check GitHub and other public sources to see if the\nprofile is open source.\n\n**[Aggressor Scripts are macros that operators can write and load in their client to](https://www.cobaltstrike.com/help-scripting)**\nstreamline their workflow. These are loaded and executed within the client context and\ndon't create new BEACON functionality, so much as automate existing commands. They\nare written in a Perl-based language called \"Sleep\" which Raphael Mudge (the creator of\nCobalt Strike) wrote. For an example, check out the \"An Operator's View\" section.\n\nAggressor scripts are only loaded into an operator's local Client. They are not loaded into\nother operators’ clients, the team server, or BEACON sessions (victim hosts). Theprimary\ndetection opportunity for these scripts is reviewing them for static defaults that can be\nused in detection or hunting rules.\n\n\n-----\n\n**[Execute-Assemblyis a BEACON command that allows operators to run a .NET](https://blog.cobaltstrike.com/2018/04/09/cobalt-strike-3-11-the-snake-that-eats-its-tail/)**\nexecutable in memory on a targeted host. BEACON runs these executables by spawning\na temporary process and injecting the assembly into it. In contrast to Aggressor Scripts,\nexecute-assembly does allow operators to extend BEACON functionality. Assemblies run\nin this way will still be scanned by Microsoft’s [AMSI if it is enabled.](https://docs.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal)\n\n**[Beacon Object Files (BOFs) are a fairly recent Cobalt Strike feature that allows](https://www.cobaltstrike.com/help-beacon-object-files)**\noperators to extend BEACON post-exploitation functionality. BOFs are compiled C\nprograms that are executed in memory on a targeted host. In contrast to Aggressor\nScripts, BOFs are loaded within a BEACON session and can create new BEACON\ncapabilities. Additionally, compared to other BEACON post-exploitation commands like\nexecute-assembly, BOFs are relatively stealthy as they run within a BEACON session\nand do not require a process creation or injection.\n\n### An Operator’s View\n\nFour of the aforementioned components—the Client, Aggressor Scripts, Beacon Object\nFiles, and Malleable Profiles—are the primary ways operators interact with and customize\ntheir team server. An example of each is included here to show these components from\nan operator’s perspective.\n\nAn operator accessing a team server through the Cobalt Strike client would see a view\nlike the following. The top pane shows a list of active beacon sessions with basic\nmetadata including the current user, process ID, internal and external IP addresses, and\nthe last time the host checked in with the team server. The bottom pane includes a tab for\neach session where operators can send commands to the victim hosts and see a log of\npast commands and output. The client interface also allows operators to build payloads,\nexecute plugins, and generate reports.\n\n\n-----\n\n[Figure 1: Cobalt Strike 3.10 client view (source)](https://www.cobaltstrike.com/help-unicode)\n\nWithin the client, operators can import Aggressor Scripts to customize their commands,\nmenu options, and interface. Aggressor Scripts vary in complexity, from adding a new\nmenu shortcut to chaining multiple attack steps. The following is an excerpt\nfrom [credpocalypse.cna, an Aggressor Script that checks active beacon sessions on a](https://github.com/ramen0x3f/AggressorScripts/blob/master/credpocalypse.cna)\nschedule and runs Mimikatz, an open-source credential dumper, if a new user logs in.\n\nNote that this is not adding functionality to Cobalt Strike. In this case, the script uses builtin BEACON functionality to list processes and execute Mimikatz, and it uses Cobalt Strike\nAPIs to run on a schedule. That means existing detections for BEACON’s Mimikatz\nmodule will also detect this.\n\n\n-----\n\n**Beacon Object Files are single file C programs that are run within a BEACON session.**\nBOFs are expected to be small and run for a short time. Since BEACON sessions are\nsingle threaded, BOFs will block any other BEACON commands while they are executing.\n[The following is an example from the Cobalt Strike documentation that uses Dynamic](https://www.cobaltstrike.com/help-beacon-object-files)\nFunction Resolution to look up the current domain.\n\n\n-----\n\nFinally, Malleable Profiles allow operators to customize a wide range of settings when\n[they first launch their team server. The snippet that follows from a public profile is an](https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/amazon.profile)\nexample of how an operator could make BEACON traffic look like it's related to Amazon.\nThe portions in blue (the set uri line and the client block), define how a BEACON payload\nbehaves. Some of these values can be extracted from a BEACON sample. See\n“Interpreting Artifacts > GET and POST Requests” for more information.\n\n## Important Concepts\n\n### Stagers\n\nEarlier, I mentioned there are \"two types of BEACON\", one of them being a stager.\nOperators can have stagers for multiple listener types (e.g. a DNS stager, an SMB stager,\nan HTTPS stager). In those cases, when the stager shellcode is executed, it will pull the\nfinal BEACON payload over the relevant protocol and execute it, establishing a\nconnection using the defined listener method.\n\nAn important note for defenders is that, by default, defenders can download a Cobalt\nStrike HTTP/S stager payload from a team server even if the operator is not using staged\npayloads in their operations. This will allow defenders to 1. confirm something is hosting a\nteam server with a listener on that port and 2. extract additional configuration artifacts\nfrom the payload.\n\nThis works because Cobalt Strike was designed to be compatible with Metasploit's\nMeterpreter payload. Metasploit (and thus Cobalt Strike) will serve an HTTPS stager\nwhen a valid URL request is received. A valid URL is any 4-character alphanumeric value\n[with a valid 8 bit checksum calculated by adding the ASCII values of the 4 characters.](https://github.com/rapid7/metasploit-framework/blob/master/lib/rex/payloads/meterpreter/uri_checksum.rb#L6)\n\n\n-----\n\nOperators can prevent defenders from retrieving stagers by setting the host_stage\nMalleable Profile value to \"false\". More commonly, they may use reverse proxies to filter\nout unwanted traffic like stager requests. As a protection feature, Cobalt Strike will ignore\nweb requests with blacklisted User-Agents, such as curl or wget. Starting in Cobalt Strike\n4.4, operators can also whitelist user agents with the .http-config.allow_useragents\nMalleable Profile option. These caveats are important to remember, since a team server\nmay not always function as expected by scanners that automate stager requests.\n\nAs an operational security note, operators can also detect any web request to a team\nserver, as it will be visible to the operator in their logs. They will also be able to see in the\n\"Web Log\" view if a stager has been pulled, along with all HTTP request details like\nsource IP.\n\n### Trial vs Licensed vs Cracked\n\nCobalt Strike is not legitimately freely available. Copies of the team server/client cannot\nbe downloaded as a trial or licensed copy from Help Systems—the company that owns\nCobalt Strike—unless the operator applies and has been approved. Unfortunately, trials\nand cracked copies (including most, if not all, licensed features) have been and continue\nto be leaked and distributed publicly for nearly all recent versions.\n\n**Trial versions of Cobalt Strike are heavily signatured and include lots of obvious**\ndefaults intended to be caught in a production environment. (For example, it\nembeds the EICAR string in all payloads.) This is to ensure that the operator is\nreally using it as a trial and will eventually pay if using it for professional purposes.\n**Licensed versions of Cobalt Strike include more features (e.g. Arsenal Kits) and**\nfewer embedded artifacts (no more EICAR!). A watermark related to the associated\nCobalt Strike license is still embedded in payloads and can be extracted using most\nBEACON configuration parsers. There are a lot of caveats with that value, so\nplease see \"Interpreting Artifacts > Watermarks\" later in the post.\n\nLicenses can be stolen, however if a license is revoked operators will no\nlonger be able to use it to update an installation. If operators keep the\n\"authorization file\" (See \"Interpreting Artifacts > Watermarks\"), the existing\ninstallation will still work until expiration.\n**Cracked versions of Cobalt Strike are distributed in various forums. Typically, these**\nare the result of someone modifying a trial JAR file to bypass the license check and\nrebuilding the JAR, or by crafting an authorization file with a fake license ID and\ndistributing that with the JAR.\n\nDifferentiating cracked versions of Cobalt Strike from legitimately licensed versions can\nbe difficult. If the watermark was statically defined as part of the cracking process, it may\nbe possible to tie that to a shared/distributed copy. Some cracked copies of Cobalt Strike\nalso contain backdoors to provide third-party access to a team server. In these cases,\nmalware analysts may be able to identify illegitimate copies through static analysis.\n\n### Redirectors\n\n\n-----\n\nInstead of having beacons connect directly to a team server, operators will sometimes\nuse a redirector (or several) that accepts connections and forwards them to the team\nserver. This has several advantages for operators, including being able to:\n\nCycle through multiple domains for a single BEACON connection\nReplace detected/blocked redirectors without having to replace the underlying team\nserver\nUse high(er) reputation domains that help BEACON traffic blend in and avoid\ndetection\n\nOperators can also use redirectors to filter out \"suspicious\" traffic, like scanners or\nhunting tools, to protect their team server, however there are typically still easy wins to\ntrack down team servers and redirectors. See the \"Hunting for Team Servers\" section for\nmore details.\n\n### What About Domain Fronting?\n\nSometimes \"redirectors\" are as simple as a cloud instance with an nginx proxy, but\nanother highly effective redirector method is \"domain fronting\". Domain fronting is a\ntechnique by which an operator may hide the true destination of a network connection by\nredirecting it through the infrastructure of a Content Delivery Network (CDN). The\ntechnique was first documented as a means of bypassing internet censorship and has\n[also been used by threat actors, such as APT 29, to disguise C2 traffic.](https://www.fireeye.com/blog/threat-research/2017/03/apt29_domain_frontin.html)\n\nWhen an HTTPS request is fronted, the connection is established directly with a\nreputable domain hosted by the CDN. This is the “fronted” domain. The encrypted\nrequest will contain a unique identifier, often contained in the HTTP “Host” header, that\nthe CDN uses to route the request to an operator-controlled server. Because domain\nfronted traffic is initially sent to the CDN, it will use the legitimate SSL/TLS certificate of\nthe CDN when observed by a defender.\n\n\n-----\n\n[Figure 2: Domain fronted C2 connection (source)](https://blog.cobaltstrike.com/2017/02/06/high-reputation-redirectors-and-domain-fronting/)\n\nIn this situation, to block traffic to the operator’s domain, a defender would need to\ndecrypt the traffic to discover the true destination within an HTTPS connection, but this is\nnot always practical. In addition to being resource intensive, decrypting the traffic for\n[some CDNs may not be possible. For example, some CDNs enforce certificate pinning on](https://owasp.org/www-community/controls/Certificate_and_Public_Key_Pinning)\ntheir SSL/TLS certificates, to prevent interception and decryption of the traffic using an\norganization-provided trusted root certificate.\n\n### Domain Fronting vs Masquerading\n\n**Masqueraded traffic is designed to look like a legitimate service but is actually a direct**\n**connection to an operator’s server, while fronted traffic is sent to a legitimate service**\n(CDN) and forwarded from there to the operator.\n\nIf the Host header value and destination domain are the same, this is just a normal, direct\n_HTTP connection._\n\nIf the Host header and destination domain are different and the Host header is\n\nA legitimate domain (e.g. in the Alexa Top 1M), then it is likely domain\n_masquerading_\nA domain used for CDN endpoints (e.g. *.azureedge.net), then it may be domain\n_fronting._\n\n[There are multiple public guides to test if a domain is frontable. This repo also includes a](https://github.com/vysecurity/DomainFrontingLists)\npre-compiled list of frontable domains by CDN provider. Please note, public lists may be\nout of date and manual validation will likely still be necessary.\n\n### Chaining Beacons\n\n\n-----\n\nAnother way operators can establish connections is by chaining beacons. Once an\noperator has a single compromised system, for example beaconing back to an HTTPS\nlistener, they can pivot internally to other systems.\n\nThe most common reason an operator will chain beacons is to bypass network\n**segmentation and restrictions. If they target a server that doesn't have outbound internet**\naccess, they can proxy their connection through another beacon with network\nconnectivity to the targeted system and receive the callback on their team server. If the\noperator loses access to the parent system, they will also lose access to chained\nbeacons.\n\nSMB listeners and SMB staged beacons were the original method for chaining. Cobalt\nStrike now also supports a raw TCP listener. In environments where the SMB stager is\ndetected (increasingly common for Endpoint Detection and Response products), an\noperator can use a raw TCP chain over port 445. This will allow them to still leverage the\nfact that SMB is rarely blocked between internal hosts but avoid using the more heavily\nsignatured SMB listener.\n\nIn the screenshot from the \"An Operator's View\" section, the first session’s external IP\nmatches the internal IP for session 2. This indicates it is being chained through the\nsecond session. A double infinity/chain icon next to the IP also shows that it is chained. If\nthe system loses connection to its parent host, that chain icon will be disconnected.\n\nThe following screenshot shows the “Pivot Graph” view from a Cobalt Strike client. In this\ngraphic, each BEACON is represented by a computer icon. Chained sessions are\nidentified by arrows to their child sessions, and the firewall icon represents an external\nconnection to the operator’s C2.\n\n[Figure 3: Client \"graph view\" of chained BEACONs (source)](https://www.cobaltstrike.com/help-smb-beacon)\n\n\n-----\n\nIf responding to an intrusion with SMB or TCP staged BEACON payloads, look for other\ncompromised hosts starting with the IP addresses configured as the “C2” for the staged\npayloads.\n\n## Hunting for Team Servers\n\nMandiant’s Advanced Practices team regularly scans the internet for C2s, including\nCobalt Strike team servers. If an operator does not properly protect their team server,\nanalysts can identify malicious infrastructure without prior knowledge of if or where it is\nbeing used and provide advanced warning and coverage for customers. For more details\non how we identify C2s like Cobalt Strike, check out our blog post, “SCANdalous!\n(External Detection Using Network Scan Data and Automation).”\n\n## Interpreting Artifacts\n\n### Team Server and Client Logs\n\nCobalt Strike logs are invaluable for understanding the activities conducted using a team\nserver. Defenders may not frequently have access to this log data, but in the event that\nlogs are available, it is useful to understand what data can be extracted from them.\n\nCobalt Strike stores logs in two primary formats: full, plaintext beacon logs and Java\n**serialized bins. These are stored in the team server working directory and duplicated in**\nclient working directories when a client is connected to a team server. They are also\nupdated when items change, such as new credentials being captured.\n\nThe cobaltstrike/logs/ directory includes a directory structure of the\nformat [date]/[internal ip of beaconed host]/[beacon id].log. Each file is a plaintext log\nof every beacon command and the associated output. This mirrors what an operator\nwould see in the Cobalt Strike beacon console.\n\nThe cobaltstrike/screenshots/and cobaltstrike/downloads/ folders each respectively\ncontain all screenshots or files an operator has downloaded from beacons.\n\nAn individual operator/client working directory will only contain downloads which\nthat operator synchronized to their local system, and these could be from multiple\nteam server connections.\nA team server working directory, will contain screenshots/downloads from any\noperator on that team server.\n\nUnder each cobaltstrike/logs/[date] directory, there is also an events.log and\na web.log file.\n\nEvents.log is a mirror of the \"events\" console for the team server which, at a\nminimum, will include the date/time of each operator connecting to the server and\neach initial beacon callback.\n\n\n-----\n\nWeb.log will show a log of every web request to the team server, including requests\nfor staged payloads or team server-hosted files.\n\nFiles hosted on a team server and served through the Web feature of Cobalt Strike are\nsaved in the cobaltstrike/uploads/ directory. An individual operator/client working\ndirectory, will only contain files which that operator uploaded.\n\nThe cobaltstrike/data directory includes several .bin files which are serialized Java\nobjects of different data models used by Cobalt Strike to track its state. The data from\n[Cobalt Strike serialized .bin logs can be extracted as CSVs using this script.](https://github.com/ramen0x3f/AggressorScripts/blob/master/parse_cs_bin.py)\n\nFor most analysts, sessions.bin, listeners.bin, and credentials.bin will be of the highest\ninterest. The .bin logs contain the most concentrated and simple to parse data for\nidentifying which systems and users were compromised using a given team server.\n\nSessions.bin lists all active and historical beacon sessions from the given team\nserver along with some basic metadata (e.g. user, internal and external IP,\nhostname, architecture).\nListeners.bin details all active listeners for the given team server.\nCredentials.bin includes any credentials (cleartext, hashed, etc.) that were either\nautomatically dumped with a built-in credential module (such as Mimikatz) or\nmanually added (such as after cracking a password offline).\n\n### Watermarks\n\nCobalt Strike watermarks are a unique value generated from and tied to a given\n\"CobaltStrike.auth\" file. This value is embedded as the last 4 bytes for all BEACON\n[stagers and in the embedded configuration for full backdoor BEACON samples.](https://blog.cobaltstrike.com/2017/09/20/cobalt-strike-3-9-livin-in-a-stagers-paradise/)\n\nThe CobaltStrike.auth file is a config file used by Cobalt Strike to determine license ID\nand expiration. When launched, Cobalt Strike will check that the license is valid and\nunexpired. The CobaltStrike.auth file is required to launch modern versions of Cobalt\nStrike, and it is updated when updating Cobalt Strike and when entering a license\n(whether for the first time or as a re-entry).\n\nA matching watermark means that two payloads came from a team server(s) using the\nsame CobaltStrike.auth file. This does not necessarily mean it came from the same\noperator. Someone can copy the whole Cobalt Strike directory, including the auth file, and\ninstall it on another server which would then have the same watermark until the license\nexpired.\n\n### Public Keys\n\nCobalt Strike uses 4 different types of keystores:\n\n**Listeners can have custom keystores specified in Malleable Profiles.**\n**Code signing can be configured with custom keystores specified in Malleable**\nProfiles.\n\n\n-----\n\n**Client Connections use the cobaltstrike.store file to encrypt client communications.**\n**Beacon Connections use a team server generated keystore to encrypt BEACON**\ndata and handle other security features.\n\nThe BEACON keys and other security features are discussed in the Raphael Mudge’s\n[training “Advanced Threat Tactics: Infrastructure”. These keys are only used in the full](https://www.youtube.com/watch?v=3gBJOJb8Oi0&t=2995s)\nBEACON backdoor, not stagers. As [identified by NCCGroup, these keys are stored in a](https://research.nccgroup.com/2020/06/15/striking-back-at-retired-cobalt-strike-a-look-at-a-legacy-vulnerability/)\nserialized file called “.cobaltstrike.beacon_keys” in the team server working directory.\n\nA matching public key means that two payloads came from a team server(s) using the\nsame .cobaltstrike.beacon_keys keystore. This does NOT NECESSARILY mean it came\nfrom the same team server. Again, someone could copy the whole Cobalt Strike directory,\nincluding the keystore, as is sometimes done with distributed or cracked copies.\n\n### C2 IPs and URLs\n\nBEACON parsers will also typically extract C2 IPs, domains, and URLs from samples.\nSome of these may be legitimate domains, for example if the operator is using domain\nfronting or masquerading.\n\nThere are some gotchas to be aware of when attempting to cluster BEACON activity for\nattribution purposes. For example, the following cases do not necessarily mean you're\nlooking at different team servers.\n\n_Two samples connect to different IPs - This could be the result of changing_\nredirectors or multiple domains/hosts being defined in a listener.\n_Two samples refer to different URL paths - Operators can specify multiple URL_\npaths when defining Malleable Profiles. Each time an operator generates BEACON\nshellcode, Cobalt Strike will select a random value from this list. If two samples\nhave different URLs, it's possible they are still referring to the same server.\n\n### GET and POST Requests\n\nBEACON configurations may include custom HTTP headers, Cookies, etc. for HTTP GET\nand POST requests. Those fields are representations of how an operator has configured\ntheir team server (using Malleable Profile or default values) to construct and disguise the\nBEACON network traffic. This is not a direct 1-to-1 for what will be in a payload.\nMalleable Profiles accept multiple values for several fields, and only one of them may\nappear in a given payload. If the GET or POST requests don't match exactly, that is not\nnecessarily an indication that it's from a different server.\n\n### Spawn To\n\nEach BEACON payload will be configured with two “spawn to” processes, one for 32-bit\ntasks and one for 64-bit tasks. These values are what BEACON will spawn as temporary\nprocesses for various post-exploitation commands. BEACON launches the process,\ninjects into it (with whatever technique the operator has specified), executes the post\n\n-----\n\nexploitation task, and terminates the process. As an example of what commands this may\naffect, check out this older guide: [Opsec Considerations for Beacon Commands. The](https://blog.cobaltstrike.com/2017/06/23/opsec-considerations-for-beacon-commands/)\ndefault spawn to process is rundll32.exe, but this can be modified in two ways.\n\n**Malleable Profile allows operators to modify the default spawn_to processes (if**\nusing a licensed or cracked version). Changing these values will require restarting\nthe team server and regenerating new BEACON payloads to use the new values.\n**Client allows operators to interactively modify the spawn_to processes once a**\nBEACON session is established. These can be changed as many times as desired\nand don't require a restart, although it will only affect the current BEACON session.\n\n### Named Pipes\n\nNamed pipes are a Windows feature used for interprocess communication (IPC). Cobalt\nStrike uses named pipes in several ways:\n\n**Payloads - Used to load the backdoor into memory and are modifiable via**\nMalleable profile and/or Artifact Kit.\n**Post-exploitation Jobs - Used for a variety of Cobalt Strike commands that need**\nto spawn and inject into a process.\n**Staging - Used for SSH/SMB BEACON staging and chaining**\n\n[Raphael Mudge's post, “Learn Pipe Fitting for all of your Offense Projects,“ has some](https://blog.cobaltstrike.com/2021/02/09/learn-pipe-fitting-for-all-of-your-offense-projects/)\nhelpful additional details on this feature.\n\n### Sleep Time\n\nThe \"sleeptime\" value in a BEACON configuration is the base time used for callback\nintervals. BEACON will randomize callbacks within a range determined by the \"jitter\"\npercentage. For example, a sleeptime of 10 seconds and a jitter of 50%, will produce\ncallbacks every 5 to 15 seconds. This value is not constant to make network detection\nmore challenging.\n\nIn Malleable Profile, operators can specify a sleeptime in milliseconds. After a session is\ncreated, operators can interactively change the sleeptime and jitter values, but both must\nbe integers and sleeptime must be defined in seconds.\n\n### Kill Date\n\nThe “killdate” value in a BEACON sample dictates whether it should connect to a team\nserver after a given date. This is used by red team operators to ensure payloads are not\naccidentally executed after an engagement is complete. It can also be used by threat\nactors to limit successful sandbox execution and frustrate retroactive analysis efforts.\n\nThis value is defined by a command line argument when the team server is started, and it\nis not modifiable through Malleable Profile or interactive BEACON commands. By default,\nno killdate is specified.\n\n\n-----\n\n## Conclusion\n\nCobalt Strike continues to be the C2 framework of choice for both legitimate security\ntesters and threat actors alike. Our hope is that with a more thorough understanding of\nthe framework’s capabilities and common usage, defenders will be more equipped to find\nnew ways to hunt, respond to, and attribute malicious actors using this tool.\n\n## References\n\n### Detection Guides\n\n Analysis Resources\n\n Walkthroughs and Examples\n\nThe creator of Cobalt Strike, Raphael Mudge, created a nine-part YouTube course, Red\nTeam Ops with Cobalt Strike, showing how to use Cobalt Strike. This is worth watching to\nsee what the product looks like and how to use the various features discussed in this blog\npost (+ some).\n\n## Acknowledgements\n\nSpecial thanks to Tyler Dean, Jae Young Kim, Matthew Dunwoody, and Chris King for\ntheir technical expertise and review.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-12 - Defining Cobalt Strike Components So You Can BEA-CONfident in Your Analysis.pdf"
    ],
    "report_names": [
        "2021-10-12 - Defining Cobalt Strike Components So You Can BEA-CONfident in Your Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5b748f86-ac32-4715-be9f-6cf25ae48a4e",
            "created_at": "2024-06-04T02:03:07.956135Z",
            "updated_at": "2025-03-27T02:05:17.407352Z",
            "deleted_at": null,
            "main_name": "IRON HEMLOCK",
            "aliases": [
                "ATK7 ",
                "Blue Kitsune ",
                "Cozy Bear ",
                "The Dukes",
                "UNC2452 ",
                "YTTRIUM ",
                "APT29 "
            ],
            "source_name": "Secureworks:IRON HEMLOCK",
            "tools": [
                " CozyCar",
                " CozyDuke",
                " DiefenDuke",
                " FatDuke",
                " HAMMERTOSS",
                " LiteDuke",
                " MiniDuke",
                " OnionDuke",
                " PolyglotDuke",
                " RegDuke",
                " RegDuke Loader",
                " SeaDuke",
                " Sliver",
                "CosmicDuke"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a241a1ca-2bc9-450b-a07b-aae747ee2710",
            "created_at": "2024-06-19T02:03:08.150052Z",
            "updated_at": "2025-03-27T02:05:17.409596Z",
            "deleted_at": null,
            "main_name": "IRON RITUAL",
            "aliases": [
                "Blue Dev 5 ",
                "BlueBravo ",
                "Cloaked Ursa ",
                "CozyLarch ",
                "Dark Halo ",
                "Midnight Blizzard ",
                "NOBELIUM ",
                "StellarParticle ",
                "UNC2452 ",
                "APT29"
            ],
            "source_name": "Secureworks:IRON RITUAL",
            "tools": [
                " Cobalt Strike",
                " EnvyScout",
                " GoldFinder",
                " GoldMax",
                " NativeZone",
                " RAINDROP",
                " SUNBURST",
                " Sibot",
                " TEARDROP",
                " VaporRage",
                "Brute Ratel C4"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46b3c0fc-fa0c-4d63-a38a-b33a524561fb",
            "created_at": "2023-01-06T13:46:38.393409Z",
            "updated_at": "2025-03-27T02:00:02.822155Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "The Dukes",
                "Minidionis",
                "Grizzly Steppe",
                "G0016",
                "Blue Kitsune",
                "BlueBravo",
                "SeaDuke",
                "Cloaked Ursa",
                "YTTRIUM",
                "ATK7",
                "Nobelium",
                "UAC-0029",
                "Group 100",
                "COZY BEAR",
                "IRON HEMLOCK",
                "TA421",
                "ITG11"
            ],
            "source_name": "MISPGALAXY:APT29",
            "tools": [
                "QUARTERRIG",
                "SNOWYAMBER",
                "HALFRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536168,
    "ts_updated_at": 1743041794,
    "ts_creation_date": 1653533158,
    "ts_modification_date": 1653533158,
    "files": {
        "pdf": "https://archive.orkl.eu/7b80d30eb4ac1f50d1a974c08d1a12aaade43f89.pdf",
        "text": "https://archive.orkl.eu/7b80d30eb4ac1f50d1a974c08d1a12aaade43f89.txt",
        "img": "https://archive.orkl.eu/7b80d30eb4ac1f50d1a974c08d1a12aaade43f89.jpg"
    }
}