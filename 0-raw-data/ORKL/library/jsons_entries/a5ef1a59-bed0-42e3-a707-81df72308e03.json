{
    "id": "a5ef1a59-bed0-42e3-a707-81df72308e03",
    "created_at": "2022-10-25T16:48:20.43055Z",
    "updated_at": "2025-03-27T02:16:37.188056Z",
    "deleted_at": null,
    "sha1_hash": "fb7781a1552ee8fcddd13fc560aa1dea9ad4955a",
    "title": "Flash zero-day exploit deployed by the ScarCruft APT Group",
    "authors": "Kaspersky",
    "file_creation_date": "2016-06-17T19:39:10Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 247306,
    "plain_text": "**securelist.com/blog/research/75100/operation-daybreak/**\n\nEarlier this year, we deployed new technologies in Kaspersky Lab products to identify and block zero-day attacks.\nThis technology already proved its effectiveness earlier this year, when it caught an Adobe Flash zero day exploit\n(CVE-2016-1010). Earlier this month, our technology caught another zero-day Adobe Flash Player exploit deployed\nin targeted attacks. We believe the attacks are launched by an APT Group we track under the codename\n“ScarCruft”.\n\nScarCruft is a relatively new APT group; victims have been observed in Russia, Nepal, South Korea, China, India,\nKuwait and Romania. The group has several ongoing operations, utilizing multiple exploits — two for Adobe Flash\nand one for Microsoft Internet Explorer.\n\nOperation Daybreak appears to have been launched by ScarCruft in March 2016 and employs a previously\nunknown (0-day) Adobe Flash Player exploit. It is also possible that the group deployed another zero day exploit,\nCVE-2016-0147, which was patched in April.\n\nThis exploit caught by our technologies highlights a few very interesting evasion methods, some of which we haven’t\nseen before. We describe them below.\n\n## Operation Daybreak general information\n\nOperation Daybreak appears to have been launched by unknown attackers to infect high profile targets through\nspear-phishing e-mails. To date, we have observed more than two dozen victims for these attacks.\n\nAlthough the exact attack vector remains unknown, the targets appear to receive a malicious link which points to a\nhacked website where the exploitation kit is hosted. The hacked web server hosting the exploit kit is associated with\nthe ScarCruft APT and used in another line of attacks. Certain details, such as using the same infrastructure and\ntargeting, make us believe that Operation Daybreak is being done by the ScarCruft APT group.\n\nThe ScarCruft APT group is a relatively new player and managed to stay under the radar for some time. In general,\ntheir work is very professional and focused. Their tools and techniques are well above the average. Prior to the\ndiscovery of Operation Daybreak, we observed the ScarCruft APT launching a series of attacks in Operation\nErebus. Operation Erebus leverages another Flash Player exploit (CVE-2016-4117) through the use of watering hole\nattacks.\n\nIn the case of Operation Daybreak, the hacked website hosting the exploit kit performs a couple of browser checks\nbefore redirecting the visitor to a server controlled by the attackers hosted in Poland.\n\nThe main exploit page script contains a BASE64 decoder, as well as rc4 decryption implemented in JS.\n\n\n-----\n\nThe exploitation process consists of three Flash objects. The Flash object that triggers the vulnerability in Adobe\nFlash Player is located in second SWF delivered to the victim.\n\nAt the end of the exploitation chain, the server sends a legitimate PDF file to user – “china.pdf”. The “china.pdf” file\nshown to the victims in the last stage of the attack seems to be written in Korean:\n\n_Decoy document shown to victims_\n\nThe document text talks about disagreements between China and “The\nNorth” over nuclear programs and demilitarization.\n\n## Vulnerability technical details\n\nThe vulnerability (CVE-2016-4171) is located in the code which parses the\nExecPolicy metadata information.\n\nThis is what the structure looks like:\n\nThis structure also contains an array of item_info structures:\n\nThe documentation says the following about these structures:\n\n_“The item_info entry consists of item_count elements that are interpreted as_\n_key/value pairs of indices into the string table of the constant pool. If the_\n_value of key is zero, this is a keyless entry and only carries a value.”_\n\nIn the exploit used by the ScarCruft group, we have the following\nitem_info structures:\n\n_Item_info array in exploit object_\n\nThe code that triggers the vulnerability parses this structure and,\nfor every key and value members, tries to get the respective\nstring object from string constant pool. The problem relies on the fact that the\n“.key” and “.value” members are used as indexes without any kind of boundary\nchecks. It is easy to understand that if key or value members are larger than\nstring constant pool array, a memory corruption problem appears. It is also\nimportant to mention that this member’s (value, key) are directly read from SWF\nobject, so an attacker can easily use them to implement arbitrary read/write\noperations.\n\n\n-----\n\n_Getting object by index from constant pool without any checks_\n\nUsing this vulnerability, the exploit implements a series of writes at specified addresses to achieve full remote code\nexecution.\n\n## Bypassing security solutions through DDE\n\nThe Operation Daybreak attack employs multiple stages, which are all outstanding in some way. One of them\nattracted our attention because it implements a bypass for security solutions we have never seen before.\n\nIn the first stage of the attack the decrypted shellcode executed by the exploit downloads and executes a special\n\n\n-----\n\n_Second stage DLL internal name and export_\n\nThe code of this module is loaded directly into the exploited application and has several methods of payload\nexecution. One of method uses a very interesting technique of payload execution which is designed mostly to\nbypass modern anti-malware products. This uses an interesting bug in the Windows DDE component. It is not a\nsecret that anti-malware systems trigger on special system functions that are called in the context of potential\nvulnerable applications to make a deeper analysis of API calls such as CreateProcess, WinExec or ShellExecute.\n\nFor instance, such defense technologies trigger if a potentially vulnerable application such as Adobe Flash starts\nother untrusted applications, scripts interpreters or even the command console.\n\nTo make execution of payload invisible for these defense systems, the threat actors used the Windows DDE\ninterface in a very clever way. First, they register a special window for it:\n\nIn the window procedure, they post WM_DDE_EXECUTE messages with commands:\n\n_Sending WM_DDE_EXECUTE message to window_\n\nThe attackers used the following commands:\n\n\n-----\n\nThe main idea here is that if you create a LNK to an executable or command, then use the ShowGroup method, the\nprogram will be executed. This is an undocumented behavior in Microsoft Windows.\n\nIn our case, a malicious VBS was executed, which installs a next stage payload stored in CAB file:\n\n_Malicious VBS used in the attack_\n\nWe have reported this “creative” abuse of DDE to Microsoft’s security team.\n\nThe final payload of the attack is a CAB file with the following MD5:\n\n8844a537e7f533192ca8e81886e70fbc\n\nThe MS CAB file (md5: 8844a537e7f533192ca8e81886e70fbc) contains 4 malicious DLL files:\n\nMD5 Filename\n\n\n-----\n\ne51ce28c2e2d226365bc5315d3e5f83e cldbct.dll\n\n067681b79756156ba26c12bc36bf835c cryptbase.dll\n\nf8a2d4ddf9dc2de750c8b4b7ee45ba3f msfte.dll\n\nThe file cldbct.dll (e51ce28c2e2d226365bc5315d3e5f83e) connects to the following C2:\n\nhXXp://webconncheck.myfw[.]us:8080/8xrss.php\n\nThe modules are signed by an invalid digital certificates listed as “Tencent Technology (Shenzhen) Company\nLimited” with serial numbers, copied from real Tencent certificates:\n\n5d 06 88 f9 04 0a d5 22 87 fc 32 ad ec eb 85 b0\n\n71 70 bd 93 cf 3f 18 9a e6 45 2b 51 4c 49 34 0e\n\n_Invalid digital signature on malware samples_\n\nThe malware deployed in this attack is extremely rare and apparently\nreserved only for high profile victims. Our products detect it as well as\nother malware from ScarCruft as\n**HEUR:Trojan.Win32.ScarCruft.gen.**\n\n## Victims:\n\nAlthough our visibility is rather limited, some of the victims of these\nattacks include:\n\nA law enforcement agency in an Asian country\n\nOne of the largest trading companies in Asia and in the world\n\nA mobile advertising and app monetization company in the USA\n\nIndividuals related to the International Association of Athletics\nFederations\n\nA restaurant located in one of the top malls in Dubai\n\nSome of these were compromised over the last few days, indicating the attackers are still very active.\n\n## Conclusions:\n\nNowadays, in-the-wild Flash Player exploits are becoming rare. This is because in most cases they need to be\ncoupled with a Sandbox bypass exploit, which makes them rather tricky.\n\nAdditionally, Adobe has been doing a great job at implementing new mitigations to make exploitation of Flash Player\nmore and more difficult.\n\nNevertheless, resourceful threat actors such as ScarCruft will probably continue to deploy zero-day exploits against\ntheir high profile targets.\n\nAs usual the best defense against targeted attacks is a multi-layered approach Windows users should combine\n\n\n-----\n\nhave been stopped by four simple defense strategies. While it s impossible to achieve 100% protection, in practice\nand most cases all you have to do is increase your defenses to the point where it becomes too expensive for the\nattacker – who will just give up and move on to other targets.\n\nKaspersky products detect flash exploit as HEUR:Exploit.SWF.Agent.gen also our AEP (Automatic Exploit\nPrevention) component can successfully detect this attack. Payloads are detected with\nHEUR:Trojan.Win32.ScarCruft.gen verdict.\n\n_* More information about the ScarCruft APT group is available to customers of_ _[Kaspersky Intelligent Services.](http://www.kaspersky.com/business-security/entrp/apt)_\n\n## Indicators of compromise:\n\n### Malicious IPs and hostnames:\n\n212.7.217[.]10\n\nreg.flnet[.]org\n\nwebconncheck.myfw[.]us\n\n### MD5s:\n\n3e5ac6bbf108feec97e1cc36560ab0b6\na6f14b547d9a7190a1f9f1c06f906063\ne51ce28c2e2d226365bc5315d3e5f83e\n067681b79756156ba26c12bc36bf835c\nf8a2d4ddf9dc2de750c8b4b7ee45ba3f\n8844a537e7f533192ca8e81886e70fbc\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/0vp77yw58zhqmt9xoez6f7nmicbgkqrw"
    ],
    "report_names": [
        "Kaspersky_ScarCruft-OpDaybreak(06-17-2016)"
    ],
    "threat_actors": [
        {
            "id": "bbe36874-34b7-4bfb-b38b-84a00b07042e",
            "created_at": "2022-10-25T15:50:23.375277Z",
            "updated_at": "2025-03-27T02:00:55.457787Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "APT37",
                "InkySquid",
                "ScarCruft",
                "Group123",
                "TEMP.Reaper",
                "Ricochet Chollima"
            ],
            "source_name": "MITRE:APT37",
            "tools": [
                "BLUELIGHT",
                "CORALDECK",
                "KARAE",
                "SLOWDRIFT",
                "ROKRAT",
                "SHUTTERSPEED",
                "POORAIM",
                "HAPPYWORK",
                "Final1stspy",
                "Cobalt Strike",
                "NavRAT",
                "DOGCALL",
                "WINERACK"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "552ff939-52c3-421b-b6c9-749cbc21a794",
            "created_at": "2023-01-06T13:46:38.742547Z",
            "updated_at": "2025-03-27T02:00:02.906537Z",
            "deleted_at": null,
            "main_name": "APT37",
            "aliases": [
                "ScarCruft",
                "Venus 121",
                "Moldy Pisces",
                "Group 123",
                "APT 37",
                "Group123",
                "Operation Daybreak",
                "Operation Erebus",
                "Red Eyes",
                "TA-RedAnt",
                "InkySquid",
                "Reaper Group",
                "Ricochet Chollima",
                "ATK4",
                "G0067"
            ],
            "source_name": "MISPGALAXY:APT37",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f0bccc3d-ad77-49c4-8dfd-8a8a8d6fba26",
            "created_at": "2024-05-01T02:03:08.134022Z",
            "updated_at": "2025-03-27T02:05:17.415028Z",
            "deleted_at": null,
            "main_name": "NICKEL FOXCROFT",
            "aliases": [
                "Group 123 ",
                "Moldy Pisces ",
                "RICOCHET CHOLLIMA ",
                "Reaper ",
                "ScarCruft ",
                "APT37 "
            ],
            "source_name": "Secureworks:NICKEL FOXCROFT",
            "tools": [
                "ROKRAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c0cedde3-5a9b-430f-9b77-e6568307205e",
            "created_at": "2022-10-25T16:07:23.528994Z",
            "updated_at": "2025-03-27T02:02:09.847683Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "APT-C-06",
                "ATK 52",
                "CTG-1948",
                "Dubnium",
                "Fallout Team",
                "Higaisa",
                "Luder",
                "Operation DarkHotel",
                "Operation Daybreak",
                "Operation Inexsmar",
                "Operation PowerFall",
                "Operation The Gh0st Remains the Same",
                "SIG25",
                "Shadow Crane",
                "T-APT-02",
                "Tungsten Bridge",
                "Zigzag Hail"
            ],
            "source_name": "ETDA:DarkHotel",
            "tools": [
                "Asruex",
                "DarkHotel",
                "DmaUp3.exe",
                "GreezeBackdoor",
                "Karba",
                "Nemain",
                "Nemim",
                "Ramsay",
                "Retro",
                "Tapaoux",
                "Trojan.Win32.Karba.e",
                "Virus.Win32.Pioneer.dx",
                "igfxext.exe",
                "msieckc.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9b02c527-5077-489e-9a80-5d88947fddab",
            "created_at": "2022-10-25T16:07:24.103499Z",
            "updated_at": "2025-03-27T02:02:10.108504Z",
            "deleted_at": null,
            "main_name": "Reaper",
            "aliases": [
                "APT 37",
                "ATK 4",
                "Cerium",
                "Crooked Pisces",
                "Geumseong121",
                "Group 123",
                "ITG10",
                "InkySquid",
                "Moldy Pisces",
                "Opal Sleet",
                "Operation Are You Happy?",
                "Operation Battle Cruiser",
                "Operation Black Banner",
                "Operation Daybreak",
                "Operation Dragon messenger",
                "Operation Erebus",
                "Operation Evil New Year",
                "Operation Evil New Year 2018",
                "Operation Fractured Block",
                "Operation Fractured Statue",
                "Operation FreeMilk",
                "Operation Golden Bird",
                "Operation Golden Time",
                "Operation High Expert",
                "Operation Holiday Wiper",
                "Operation Korean Sword",
                "Operation North Korean Human Right",
                "Operation Onezero",
                "Operation Rocket Man",
                "Operation SHROUDED#SLEEP",
                "Operation STARK#MULE",
                "Operation STIFF#BIZON",
                "Operation Spy Cloud",
                "Operation Star Cruiser",
                "Osmium",
                "Red Eyes",
                "Ricochet Chollima",
                "Ruby Sleet",
                "ScarCruft",
                "TA-RedAnt",
                "TEMP.Reaper",
                "Venus 121"
            ],
            "source_name": "ETDA:Reaper",
            "tools": [
                "Agentemis",
                "BLUELIGHT",
                "Backdoor.APT.POORAIM",
                "CARROTBALL",
                "CARROTBAT",
                "CORALDECK",
                "Cobalt Strike",
                "CobaltStrike",
                "DOGCALL",
                "Erebus",
                "Exploit.APT.RICECURRY",
                "Final1stSpy",
                "Freenki Loader",
                "GELCAPSULE",
                "GOLDBACKDOOR",
                "GreezeBackdoor",
                "HAPPYWORK",
                "JinhoSpy",
                "KARAE",
                "KevDroid",
                "Konni",
                "MILKDROP",
                "N1stAgent",
                "NavRAT",
                "Nokki",
                "Oceansalt",
                "POORAIM",
                "PoohMilk",
                "PoohMilk Loader",
                "RICECURRY",
                "RUHAPPY",
                "RokRAT",
                "SHUTTERSPEED",
                "SLOWDRIFT",
                "SOUNDWAVE",
                "SYSCON",
                "Sanny",
                "ScarCruft",
                "StarCruft",
                "Syscon",
                "VeilShell",
                "WINERACK",
                "ZUMKONG",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716500,
    "ts_updated_at": 1743041797,
    "ts_creation_date": 1466192350,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/fb7781a1552ee8fcddd13fc560aa1dea9ad4955a.pdf",
        "text": "https://archive.orkl.eu/fb7781a1552ee8fcddd13fc560aa1dea9ad4955a.txt",
        "img": "https://archive.orkl.eu/fb7781a1552ee8fcddd13fc560aa1dea9ad4955a.jpg"
    }
}