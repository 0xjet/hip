{
    "id": "f7dfe52c-6d60-4d25-91ef-9e9fdc8692da",
    "created_at": "2023-01-12T15:00:12.668059Z",
    "updated_at": "2025-03-27T02:05:23.476393Z",
    "deleted_at": null,
    "sha1_hash": "c8b3b72f0015e980ae4cfba0c0cc40ac7008e6ba",
    "title": "2022-01-12 - Analysis of njRAT PowerPoint Macros",
    "authors": "",
    "file_creation_date": "2022-05-28T17:50:45Z",
    "file_modification_date": "2022-05-28T17:50:45Z",
    "file_size": 697295,
    "plain_text": "# Analysis of njRAT PowerPoint Macros\n\n**[cyberandramen.net/2022/01/12/analysis-of-njrat-powerpoint-macros/](https://cyberandramen.net/2022/01/12/analysis-of-njrat-powerpoint-macros/)**\n\nJanuary 12, 2022\n\nI wanted to do a quick write-up on an interesting PowerPoint macro document that contains\nnjRAT. njRAT is a .NET trojan first identified in 2013 that has largely targeted countries in the\nMiddle East as well as South America.\n\nThe malicious document can be found via MalwareBazaar:\n\nhttps://bazaar.abuse.ch/sample/edba3ca498110106418658167533034aeb929276fe81de80c\n6de1a6bb95120e0\n\n## Information Gathering\n\nWhen triaging a suspected malicious file, running one of the many scripts from OLETools is a\nmust. The malicious PowerPoint has the extension .ppm, so we will run Olevba and see what\nit outputs.\n\nFigure 1\n\nOlevba output\nOur suspicions are confirmed that this document not only contains macro code (Auto_Open),\nbut also spawns WScript.exe, creates and drops files, communicates with a URL.\n\n\n-----\n\nThe output from Olevba provides a roadmap of where to start our analysis methods. Let s\nfirst take a look at x.vbs:\n\nFigure 2\n\nBefore we dive into the VBS code, I had to start off with the image above in Figure 2. The\ndocument starts with almost 100 lines of colons but has this helpful string identifying a recent\nupdate to the njRAT malware.\n\nMuch of the script is obfuscated, however, this does not prevent us from gaining an\nunderstanding of what the document is capable of.\n\nFigure 3 x.vbs\n\nIn Figure 3, we can clearly make out the word “Startup” reversed at the DiUwd variable. A\nfew lines down, we see some string concatenation, an if-else block, as well as a call to\nWScript.Shell.\n\nForgive me for skipping around, but much of what comes after the code in Figure 3 is more\nconcatenation and reversed letters I would rather not waste time on. Scrolling down further,\nwe finally see some interesting calls to replace and references to PowerShell.\n\n\n-----\n\nFigure 4\nIf you have analyzed malicious macro documents before the above is likely familiar. We have\nBase64 data to decode as well as a few items to replace: the ‘££’ is replaced with ‘A’, and\n‘%HVDiHGRjuC%’ is replaced with an empty string.\n\nAt the very top of the image, we can see that WScript.exe will make a request to\nhxxps://wtools.io/code/raw/b833.\n\nFigure 5: Before replacing characters\n\nFigure 6:\nOnce all characters are replaced and combined, we can throw the Base64 encoded data in\nCyberChef to see what’s behind the curtain (the ‘TVqQ’ maybe a giveaway).\n\n\n-----\n\nFigure 7 Decoded output\nIn figure 7 we can see all the replacing and reversing was done to cloak an executable file.\n\nScrolling down some in CyberChef an additional URL and PDB path are visible in the\nCyberChef output.\n\nFigure 8\nPowershell is once again used to download and convert the text file above into another VBS\nfile.\n\nThe above URL is hxxps://ia904600.us.archive.org/4/items/rumpe-03/Rumpe03.txt.\n\nThe PDB path is\nC:\\Users\\pjoao\\Desktop\\UpCry\\MetodoDF\\CLassLibrary3\\obj\\Release\\ClassLibrary3.pdb\n\n\n-----\n\nViewing a memory dump of the executed malware produces the configuration that includes\nidentifiers that may assist defenders in hunting this remote access trojan.\n\nFigure 9\nRegAsm.exe, the .NET framework Assembly Registration tool makes two DNS requests for\nthe above domain, fidapeste2[.]duckdns[.]org. No additional network traffic to that domain\nwas identified.\n\nThe .NET assembly is loaded utilizing PowerShell’s\n\n[AppDomain]::CurrentDomain.Load() method.\n\nAt the end of the output in figure 9 is a base64 encoded string, ‘TllBTiBDQVQ=, which\ndecodes to NYAN CAT.\nThe 0.7NC signifies the version of njRAT, as well as the identifier for NYAN CAT, ‘NC”.\n\n‘a918117a6dc84b8a’ is utilized as a mutex to prevent a second infection of the victim.\n\nLast but not least, ‘@!#&^%$’ acts as a delimiter for information siphoned to the\nattacker command and control infrastructure.\n\nThis was a pretty quick analysis but served as a great learning experience. I hope to make\nmore quick posts like this in the future. Thanks for reading!\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-12 - Analysis of njRAT PowerPoint Macros.pdf"
    ],
    "report_names": [
        "2022-01-12 - Analysis of njRAT PowerPoint Macros.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535612,
    "ts_updated_at": 1743041123,
    "ts_creation_date": 1653760245,
    "ts_modification_date": 1653760245,
    "files": {
        "pdf": "https://archive.orkl.eu/c8b3b72f0015e980ae4cfba0c0cc40ac7008e6ba.pdf",
        "text": "https://archive.orkl.eu/c8b3b72f0015e980ae4cfba0c0cc40ac7008e6ba.txt",
        "img": "https://archive.orkl.eu/c8b3b72f0015e980ae4cfba0c0cc40ac7008e6ba.jpg"
    }
}