{
    "id": "1e7f00fe-eb7f-41e6-b45e-4718e39b7f85",
    "created_at": "2023-01-12T15:04:21.148623Z",
    "updated_at": "2025-03-27T02:09:58.287171Z",
    "deleted_at": null,
    "sha1_hash": "a5ea54743db4e226180b9338670ec3ac86615c29",
    "title": "2018-09-05 - PowerPool malware exploits ALPC LPE zero‑day vulnerability",
    "authors": "",
    "file_creation_date": "2022-05-28T00:36:50Z",
    "file_modification_date": "2022-05-28T00:36:50Z",
    "file_size": 351602,
    "plain_text": "# PowerPool malware exploits ALPC LPE zero‑day vulnerability\n\n**[welivesecurity.com/2018/09/05/powerpool-malware-exploits-zero-day-vulnerability/](https://www.welivesecurity.com/2018/09/05/powerpool-malware-exploits-zero-day-vulnerability/)**\n\nSeptember 5, 2018\n\nMalware from newly uncovered group PowerPool exploits zero-day vulnerability in the wild,\nonly two days after its disclosure\n\n[Matthieu Faou](https://www.welivesecurity.com/author/mfaou/)\n5 Sep 2018 - 02:57PM\n\n\n-----\n\nMalware from newly uncovered group PowerPool exploits zero-day vulnerability in the wild,\nonly two days after its disclosure\n\n_[Update (11 September 2018): Microsoft has provided a patch for this in today’s Windows](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2018-8440)_\n_Update._\n\nOn August 27, 2018, a so-called zero-day vulnerability affecting Microsoft Windows was\npublished on GitHub and publicized via a rather acerbic tweet.\n\nSource: Twitter\n\nIt seems obvious that this was not part of a coordinated vulnerability disclosure and there\nwas no patch at the time this tweet (since deleted) was published to fix the vulnerability.\n\nIt affects Microsoft Windows OSes from Windows 7 to Windows 10, and in particular the\nAdvanced Local Procedure Call (ALPC) function, and allows a Local Privilege Escalation\n(LPE). LPE allows an executable or process to escalate privileges. In that specific case, it\nallows an executable launched by a restricted user to gain administrative rights.\n\n\n-----\n\nThe tweet linked to a [GitHub repository that contains Proof-of-Concept code for the exploit.](https://github.com/SandboxEscaper/randomrepo/)\nNot only was a compiled version released – the source code was also. Consequently,\nanyone can modify and recompile the exploit, in order to “improve it”, evade detection, or\neven incorporate it into their code.\n\nAs one could have predicted, it took only two days before we first identified the use of this\nexploit in a malicious campaign from a group we have dubbed PowerPool. This group has a\nsmall number of victims and according to both our telemetry and uploads to VirusTotal (we\nonly considered manual uploads from the web interface), the targeted countries include\nChile, Germany, India, the Philippines, Poland, Russia, the United Kingdom, the United\nStates and Ukraine.\n\n## PowerPool arsenal\n\nThis newly isolated group already has quite a range of tools at its disposal. We will provide\nbrief analyses of some of them here.\n\n### ALPC Local Privilege Escalation exploit\n\nThe PowerPool developers did not reuse the binary that was provided by the vulnerability’s\ndiscloser. They modified the source code slightly and recompiled it.\n\nThe exploit has been documented by its original author and has been covered by security\nresearchers and [CERTs.](https://www.kb.cert.org/vuls/id/906424)\n\nFigure 1 – Description of the exploit by its author\n\nThe flaw is in the SchRpcSetSecurity API function, which does not check the user’s\npermissions correctly. Thus, a user can have write permissions on any file in\nC:\\Windows\\Task regardless of its actual permissions. That allows a user with only read\npermissions to replace the content of a write-protected file.\n\nAs any user is able to write in C:\\Windows\\Task, it is possible to create a file in this folder\nthat is a hard link to any target file. Then, by calling the broken function SchRpcSetSecurity,\nit is possible to gain write access to that target file. To create a Local Privilege Escalation,\nthe attacker needs to choose the target file that will be overwritten. This needs to be done\ncarefully: it needs to be a file that is executed automatically with administrative rights. For\nexample, it can be a system file, or the updater of previously installed software that is\n\n\n-----\n\nregularly executed by a task. The final step is to replace the content of this protected target\nfile with malicious code. Thus, at the next automatic execution, the malware will have\nadministrative rights regardless of its original rights.\n\nPowerPool’s developers chose to change the content of the file C:\\Program Files\n(x86)\\Google\\Update\\GoogleUpdate.exe. This is the legitimate updater for Google\napplications and is regularly run under administrative privileges by a Microsoft Windows\ntask.\n\nFigure 2 – Creation of a hardlink to the Google Updater\n\nFigure 3 – Abuse of SchRpcCreateFolder to change the permissions of the Google Updater\n\nexecutable\n\nThe sequence of operations shown in the figure above allows the PowerPool operators to\ngain write access to the executable GoogleUpdate.exe. Then, they overwrite it with a copy\nof their second-stage malware, described below, in order to gain SYSTEM privileges the\nnext time the updater is called.\n\n## Initial compromise\n\nThe PowerPool group uses different approaches to initially compromise a victim. One is to\nsend emails with their first-stage malware as an attachment. It may be too early to say, but\nto date we’ve seen very few occurrences in our telemetry, so we assume that the recipients\nare carefully chosen rather than PowerPool running a massive spam campaign.\n\nOn the other hand, we know that their spams have been spotted in the past. According to a\n[SANS blogpost released in May 2018, they used a trick with Symbolic Link (.slk) files to](https://isc.sans.edu/forums/diary/Malware+Distributed+via+slk+Files/23687)\ndistribute their malware. Microsoft Excel can load these files that update a cell and force\nExcel to execute PowerShell code. These .slk files seem to be distributed in spam\nmessages too. Pivoting from the first file mentioned in the SANS blogpost (SHA-1:\nb2dc703d3af1d015f4d53b6dbbeb624f5ade5553), on VirusTotal, it is possible to find the\nrelated spam sample (SHA-1: e0882e234cba94b5cf3df2c05949e2e228bedd2b):\n\n\n-----\n\nFigure 4 – PowerPool spam message\n\n## Windows backdoors\n\nThe PowerPool group mainly uses two different backdoors: a first-stage backdoor used just\nafter the first compromise and then a second-stage backdoor, probably on the most\ninteresting machines.\n\n### First-stage backdoor\n\nThis is basic malware used for reconnaissance on the machine. It comprises two Windows\nexecutables.\n\nThe first of these is the main backdoor. It establishes persistence through a service. It also\ncreates a mutex named MyDemonMutex%d where %d ranges from 0 to 10. It is able to\ncollect proxy information and the address of the C&C server is hardcoded into this binary. It\ncan execute commands and performs some basic reconnaissance of the machine, which is\nthen exfiltrated to the C&C server.\n\n\n-----\n\nFigure 5 – Gathering of proxy information\n\nThe second of these executables has a single purpose. It takes a screenshot of the victim’s\ndisplay and writes it in MyScreen.jpg. This file can then be exfiltrated by the main backdoor.\n\n### Second-stage backdoor\n\nThis malware is downloaded via the first stage, presumably when the operators believe the\nmachine is interesting enough for them to stay on it for a longer time. However, it is clearly\nnot a state-of-the-art APT backdoor.\n\nAgain, the C&C server address is hardcoded in the binary, and has no mechanism to\nupdate this crucial configuration item. This backdoor seeks commands from http://[C&C\ndomain]/cmdpool and downloads additional files from http://[C&C domain]/upload. These\nadditional files are mainly the lateral-movement tools mentioned below.\n\nThe supported commands are:\n\nExecute a command\nKill a process\nUpload a file\nDownload a file\nList a folder\n\nThey are sent in JSON format. The examples below are instructions to execute a command\nand to list a folder:\n\n\n-----\n\nFigure 6 – Examples of backdoor commands\n\n## Lateral movement tools\n\nOnce the PowerPool operators have persistent access to a machine with the second-stage\nbackdoor, they use several open-source tools, mostly written in PowerShell, to move\nlaterally on the network.\n\n**[PowerDump: This is a Metasploit module that can retrieve usernames and hashes](https://github.com/rapid7/metasploit-framework/blob/master/data/exploits/powershell/powerdump.ps1)**\nfrom the Security Account Manager (SAM).\n**[PowerSploit: This is a post-exploitation framework in PowerShell, à la Metasploit.](https://github.com/PowerShellMafia/PowerSploit)**\n**[SMBExec: A PowerShell tool to perform pass-the-hash SMB connections.](https://github.com/Kevin-Robertson/Invoke-TheHash/blob/master/Invoke-SMBEnum.ps1)**\n**[Quarks PwDump: A Windows executable that can retrieve Windows credentials.](https://blog.quarkslab.com/quarks-pwdump.html)**\n**[FireMaster: A Windows executable that can retrieve stored passwords from Outlook,](https://securityxploded.com/firemaster.php)**\nweb browsers, etc.\n\n## Conclusion\n\nThe disclosure of vulnerabilities outside of a coordinated disclosure process generally puts\nmany users at risk. In this case, even the most up-to-date version of Windows could be\ncompromised as no patch was released when the vulnerability and exploit were published.\n[The CERT-CC provides some mitigations but Microsoft has not officially approved them.](https://www.kb.cert.org/vuls/id/906424)\n\nThis specific campaign targets a limited number of users, but don’t be fooled by that: it\nshows that cybercriminals also follow the news and work on employing exploits as soon as\nthey are publicly available.\n\n_ESET Researchers will continue tracking any malicious usage of this new vulnerability._\n_[Indicators of Compromise can also be found on GitHub. For any inquiries, or to make](https://github.com/eset/malware-ioc/tree/master/powerpool)_\n_sample submissions related to the subject, contact us at threatintel@eset.com._\n\n_[Update (11 September 2018): Microsoft has provided a patch for this in today’s Windows](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2018-8440)_\n_Update._\n\n## Indicators of compromise\n\n### Hashes\n\n**SHA-1** **Type** **Detection name**\n\n\n038f75dcf1e5277565c68d57fa1f4f7b3005f3f3 First stage\nbackdoor\n\n\nWin32/Agent.SZS\n\n\n-----\n\n**SHA-1** **Type** **Detection name**\n\n\n247b542af23ad9c63697428c7b77348681aadc9a First stage\nbackdoor\n\n0423672fe9201c325e33f296595fb70dcd81bcd9 Second\nstage\nbackdoor\n\nb4ec4837d07ff64e34947296e73732171d1c1586 Second\nstage\nbackdoor\n\n9dc173d4d4f74765b5fc1e1c9a2d188d5387beea ALPC LPE\nexploit\n\n**Detection names**\n\nWin32/Agent.SZS\n\nWin32/Agent.TCH\n\nWin32/Agent.TEL\n\nWin32/Agent.THT\n\nWin32/Agent.TDK\n\nWin32/Agent.TIA\n\nWin32/Agent.TID\n\n**C&C servers**\n\nnewsrental[.]net\n\nrosbusiness[.]eu\n\nafishaonline[.]eu\n\nsports-collectors[.]com\n\n27.102.106[.]149\n\n5 Sep 2018 - 02:57PM\n\n\nWin32/Agent.TCH\n\nWin32/Agent.TIA\n\nWin32/Agent.TIA\n\nWin64/Exploit.Agent.H\n\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n\n-----\n\n### Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-09-05 - PowerPool malware exploits ALPC LPE zero‑day vulnerability.pdf"
    ],
    "report_names": [
        "2018-09-05 - PowerPool malware exploits ALPC LPE zero‑day vulnerability.pdf"
    ],
    "threat_actors": [
        {
            "id": "62985c5c-6938-4365-8432-29573e99ecf4",
            "created_at": "2022-10-25T16:07:24.075092Z",
            "updated_at": "2025-03-27T02:02:10.099951Z",
            "deleted_at": null,
            "main_name": "PowerPool",
            "aliases": [],
            "source_name": "ETDA:PowerPool",
            "tools": [
                "ALPC Local PrivEsc",
                "FireMaster",
                "PowerDump",
                "PowerSploit",
                "Quarks PwDump",
                "SMBExec"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "adee5dfb-98d1-488f-969d-48eed28cd7e4",
            "created_at": "2023-01-06T13:46:38.799427Z",
            "updated_at": "2025-03-27T02:00:02.9221Z",
            "deleted_at": null,
            "main_name": "PowerPool",
            "aliases": [
                "IAmTheKing"
            ],
            "source_name": "MISPGALAXY:PowerPool",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "32a223a8-3c79-4146-87c5-8557d38662ae",
            "created_at": "2022-10-25T15:50:23.703698Z",
            "updated_at": "2025-03-27T02:00:55.528031Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Lazarus Group",
                "Labyrinth Chollima",
                "HIDDEN COBRA",
                "Guardians of Peace",
                "NICKEL ACADEMY",
                "Diamond Sleet"
            ],
            "source_name": "MITRE:Lazarus Group",
            "tools": [
                "RawDisk",
                "Proxysvc",
                "BADCALL",
                "FALLCHILL",
                "WannaCry",
                "HOPLIGHT",
                "TYPEFRAME",
                "Dtrack",
                "HotCroissant",
                "HARDRAIN",
                "Dacls",
                "KEYMARBLE",
                "TAINTEDSCRIBE",
                "AuditCred",
                "netsh",
                "ECCENTRICBANDWAGON",
                "AppleJeus",
                "BLINDINGCAN",
                "ThreatNeedle",
                "Volgmer",
                "Cryptoistic",
                "RATANKBA",
                "Bankshot",
                "Torisma",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535861,
    "ts_updated_at": 1743041398,
    "ts_creation_date": 1653698210,
    "ts_modification_date": 1653698210,
    "files": {
        "pdf": "https://archive.orkl.eu/a5ea54743db4e226180b9338670ec3ac86615c29.pdf",
        "text": "https://archive.orkl.eu/a5ea54743db4e226180b9338670ec3ac86615c29.txt",
        "img": "https://archive.orkl.eu/a5ea54743db4e226180b9338670ec3ac86615c29.jpg"
    }
}