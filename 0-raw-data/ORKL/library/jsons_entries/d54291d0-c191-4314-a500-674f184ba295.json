{
    "id": "d54291d0-c191-4314-a500-674f184ba295",
    "created_at": "2023-01-12T14:59:07.966402Z",
    "updated_at": "2025-03-27T02:09:51.148134Z",
    "deleted_at": null,
    "sha1_hash": "d11d7f350bdc1f2e2f8d3a354ef3ebe599a04a10",
    "title": "2021-05-06 - Analysis Report- FiveHands Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-27T22:50:43Z",
    "file_modification_date": "2022-05-27T22:50:43Z",
    "file_size": 569032,
    "plain_text": "# FiveHands Ransomware\n\n**us-cert.cisa.gov/ncas/analysis-reports/ar21-126a**\n\n## Summary\n\n_This Analysis Report uses the MITRE Adversarial Tactics, Techniques, and Common_\n_[Knowledge (ATT&CK®) framework, Version 9. See the ATT&CK for Enterprise framework for](https://attack.mitre.org/versions/v7/matrices/enterprise/)_\n_all referenced threat actor tactics and techniques._\n\nThe Cybersecurity and Infrastructure Security Agency (CISA) is aware of a recent successful\ncyberattack against an organization using a new ransomware variant, which CISA refers to\nas FiveHands. Threat actors used publicly available penetration testing and exploitation\ntools, FiveHands ransomware, and SombRAT remote access trojan (RAT), to steal\ninformation, obfuscate files, and demand a ransom from the victim organization. Additionally,\nthe threat actors used publicly available tools for network discovery and credential access.\n\nThis report provides the tactics, techniques, and procedures the threat actors used in this\nattack as well as indicators of compromise (IOCs). It also includes CISA’s recommended\nmitigations to protect networks from ransomware attacks and to detect—and respond to—\nthese attacks.\n\n[Refer to Malware Analysis Report AR21-126B for full technical details and associated IOCs.](https://us-cert.cisa.gov/ncas/analysis-reports/ar21-126b)\n\nFor a PDF copy of this report, [click here.](https://us-cert.cisa.gov/sites/default/files/publications/AR21-126A_FiveHands_Ransomware.pdf)\n\n**Note: the analysis of FiveHands ransomware is ongoing; CISA will update this report as new**\ninformation becomes available.\n\n## Description\n\n**Initial Access**\n\nThe initial access vector was a zero-day vulnerability in a virtual private network (VPN)\nproduct (Exploit Public-Facing Application [[T1190]).](https://attack.mitre.org/versions/v9/techniques/T1190/)\n\n**Publicly Available Tool: SoftPerfect Network Scanner**\n\nThe cyber actor used SoftPerfect Network Scanner for Discovery [[TA0007] of hostnames and](https://attack.mitre.org/versions/v9/tactics/TA0007/)\nnetwork services (Network Service Scanning [[T1046]).](https://attack.mitre.org/versions/v9/techniques/T1046/)\n\nDetails on the SoftPerfect Network Scanner artifacts are below.\n\n**_netscan.exe_**\n\n\n-----\n\nThe `netscan.exe artifact is a stand-alone version of the SoftPerfect Network Scanner,`\nversion 7.2.9 for 64-bit operating systems. The SoftPerfect website states that the\n\"SoftPerfect Network Scanner can ping computers, scan ports, discover shared folders, and\nretrieve practically any information about network devices, via Windows Management\nInstrumentation (WMI), Simple Network Management Protocol (SNMP), Hypertext Transfer\nProtocol (HTTP), Secure Shell (SSH), and PowerShell. It also scans for remote services,\nregistry, files and performance counters; offers flexible filtering and display options and\nexports NetScan results to a variety of formats from XML to JSON.\"\n\nThe utility can also be used with Nmap for vulnerability scanning. The utility will generate a\nreport of its findings called `netscan.xml .`\n\n**_netscan.xml_**\n\nThe `netscan.xml` artifact is an Extensible Markup Language (XML) document reporting\nscanning results for the SoftPerfect Network Scanner program. The XML document indicates\nthat a random scan was conducted to identify hostnames on a network and to search for:\n\nweb servers,\nfile servers,\ndatabase servers, and\nany open Remote Desktop Protocol (RDP) ports for several subnets of unrouteable\nInternet Protocol (IP) addresses.\n\n**_netscan.lic_**\n\nA license is required to unlock all of the features of the SoftPerfect Network Scanner. The\n```\nnetscan.lic artifact is the Network Scanner license that was included with this\n\n```\nsubmission. The license name is `DeltaFoX .`\n\n**FiveHands Ransomware**\n\n[The malicious cyber actor used PsExec to execute](https://attack.mitre.org/versions/v9/software/S0029/) `ServeManager.exe, which CISA refers`\nto as FiveHands ransomware (Execution [[TA0002], System Services: Service Execution](https://attack.mitre.org/versions/v9/tactics/TA0002/)\n\n[[T1569.002], Impact [TA0040]). FiveHands is a novel ransomware variant that uses a public](https://attack.mitre.org/versions/v9/techniques/T1569/002/)\nkey encryption scheme called `NTRUEncrypt . Note: the NTRUEncrypt public key`\ncryptosystem encryption algorithm (NTRU), is a lattice-based alternative to Rivest-ShamirAdleman, known as RSA, and Elliptic-curve cryptography, or ECC, and is based on the\nshortest vector problem in a lattice.\n\nTo prevent data recovery, FiveHands uses WMI to first enumerate then delete Volume\nShadow copies (Inhibit System Recovery [[T1490]; Windows Management Instrumentation](https://attack.mitre.org/versions/v9/techniques/T1490/)\n\n[[T1047]). The malware also encrypts files in the recovery folder (Data Encrypted for Impact](https://attack.mitre.org/versions/v9/techniques/T1047/)\n\n[[T1486]). After the files are encrypted, the program will write a ransom note to each folder](https://attack.mitre.org/versions/v9/techniques/T1486/)\nand directory on the system.\n\n\n-----\n\nDetails on the ransomware artifacts are below.\n\n**_PsExec.exe_**\n\nThe `PsExec.exe artifact is the legitimate remote administration program. This tool is part of`\nMicrosoft's Sysinternals tool suite. This utility was used to execute the program\n```\nServeManager.exe with the following arguments:\npsexec.exe -d @comps.txt -s -relatime -c ServeManager.exe -key\n\n```\nThe arguments are defined as follows:\n```\n    -d --> Run psexec.exe without any prompts.\n    @ --> Remotely access this list of hostnames/IP addresses.\n    -s --> Run the program with system level privileges.\n    -relatime --> This is a typo. This should be -realtime, or run this process before any\n\n```\nother process.\n```\n    -c --> Copy the program to the remote system before executing.\n\n```\n**ServeManager.exe**\n\nThe `ServeManager.exe artifact is a 32-bit executable file that is executed using the`\nMicrosoft Sysinternals remote administration tool, `PsExec.exe . When the program is`\nexecuted it will attempt to load into memory a large embedded module that is decoded with a\nsupplied key. The module is decoded in memory and checked to verify that it has a portable\nexecutable (PE) header. If the header is verified, the payload is executed.\n\nThe payload is a 32-bit executable file that is used to encrypt files on the victim’s system to\nextort a ransom. When the ransomware is executed, it will enumerate files and folders on the\nsystem and encrypt files with the extensions, `.txt,` `.chm,` `.dat,` `.ocx,` `.js,` `.tlb,`\n```\n.vbs, .sys, .lnk, .xml, .jpg, .log, .zip, .htm, .ini, .gif, .html,\n\n```\n`.css, and others (File and Directory Discovery` [[T1083]). Key system files are not](https://attack.mitre.org/versions/v9/techniques/T1083/)\nencrypted.\n\nTo thwart the recovery of the data, the ransomware uses Windows Management\nInstrumentation (WMI) to enumerate Volume Shadow copies using the command `select *`\n```\nfrom Win32_ShadowCopy and then deletes copies by ID ( Win32_ShadowCopy.ID ). The\n\n```\nmalware will also encrypt files in the recovery folder at `C:\\Recovery . After the files are`\nencrypted the program will write a ransom note to each folder and directory on the system\ncalled `read_me_unlock.txt .`\n\nFigure 1 displays the ransom note (redacted for privacy).\n\n\n-----\n\n_Figure 1: Ransom note_\n\n**Remote Access Trojan: SombRAT**\n\nThe threat actors used batch and text files to execute and invoke PowerShell scripts that\ndecoded a SombRAT loader and enabled PowerShell to bypass the organization’s antimalware program (Command and Scripting Interpreter: Windows Command Shell\n\n[[T1059.003], Command and Scripting Interpreter: PowerShell](https://attack.mitre.org/versions/v9/techniques/T1059/003/) [[T1059.001], Defense Evasion](https://attack.mitre.org/versions/v9/techniques/T1059/001/)\n\n[[TA0005]). SombRAT is a custom remote access Trojan (RAT) used to download and](https://attack.mitre.org/versions/v9/tactics/TA0005/)\n[execute malicious payloads.[1]](https://blogs.blackberry.com/en/2020/11/the-costaricto-campaign-cyber-espionage-outsourced)\n\nThe SombRAT loader recovered in this incident was a 64-bit variant that allowed the\nmalicious actor to remotely download and load executable dynamic-link libraries (DLL)\nplugins on the affected system (Ingress Tool Transfer [[T1105]). The loader used hardcoded](https://attack.mitre.org/versions/v9/techniques/T1105/)\npublic RSA keys for command and control (C2) sessions (Command and Control [[TA0011]).](https://attack.mitre.org/versions/v9/tactics/TA0011/)\nThe C2 communications were encrypted using Advanced Encryption Standard (AES),\nresulting in a Secure Sockets Layer tunnel with the threat actors (Encrypted Channel:\n_Asymmetric Cryptography_ [[T1573.002]).](https://attack.mitre.org/versions/v9/techniques/T1573/002/)\n\nDetails on the SombRAT artifacts are below.\n\n**_WwanSvc.bat_**\n\nThe `WwanSvc.bat artifact is a batch file. When executed, it will invoke PowerShell, which`\ndecodes and executes a base64-encoded PowerShell script called `WwanSvc.txt in the`\npath `C:\\ProgramData\\Microsoft\\WwanSvc\\ (Deobfuscate/Decode Files or Information`\n\n[[T1140], Obfuscated Files or Information](https://attack.mitre.org/versions/v9/techniques/T1140/) [[T1027]).](https://attack.mitre.org/versions/v9/techniques/T1027/)\n\n**_WwanSvc.txt_**\n\n\n-----\n\nThe `WwanSvc.txt artifact is a base64-encoded PowerShell script that is decoded and`\nexecuted by `WwanSvc.bat . The script allows PowerShell to run without system restrictions`\nwhile bypassing the Microsoft anti-malware program. Next, the script decodes the file\n```\nWwanSvc.c using a bitwise Exclusive OR (XOR) with a 256-byte key that is found in\nWwanSvc.a . Both WwanSvc.a and WwanSvc.c are located in\nC:\\ProgramData\\Microsoft\\ . The newly decoded script is then executed using the\nInvokeExpression command.\n\n```\n**_WwanSvc.a_**\n\nThe `WwanSvc.a artifact contains a 256-byte key that is used by the base64-encoded script`\nin `WwanSvc.txt to decode a new PowerShell script in` `WwanSvc.c . The key is also used`\nto decode the reflectively loaded payload in `WwanSvc.b .`\n\n**_WwanSvc.c_**\n\nThe `WwanSvc.c artifact is an XOR-encoded PowerSploit reflective loader program.[2] The`\nprogram is decoded using the 256-byte key found in `WwanSvc.a . The script will decode the`\ncontent of `WwanSvc.b and then check to confirm that it has a valid PE header. The script`\nwill also check the system environment for a 64-bit architecture (System Information\n_Discovery_ [[T1082]). The executable is not written to disk but loaded directly into memory.](https://attack.mitre.org/versions/v9/techniques/T1082/)\n\n**_WwanSvc.b_**\n\nThe `WwanSvc.b artifact, when decoded, is a 64-bit variant of the SombRAT loader. The`\nprimary purpose of the loader is to allow a remote operator to securely download and load\nexecutable plugins on a target system. Given this plugin structure, the author can easily mold\nthe RAT to provide additional functionalities and capabilities. The application contains the\nfollowing two hardcoded public RSA keys, which it will utilize to secure its C2 sessions with\nthe remote operator. Static analysis indicates that the C2 communications will also be\nencrypted using AES resulting in a secure Secure Sockets Layer (SSL) tunnel with the\nremote operator.\n\nThe configuration file `59fb3174bb34e803, located in` `C:\\ProgramData, contains the data`\nthe malware requires at runtime, including the operator-controlled remote C2 address. The\nmalware decrypts this configuration file with the hardcoded AES key\n```\nujnchdyfngtreaycnbjgi837157fncae . See figure 2.\n\n```\n\n-----\n\n_Figure 2: Hardcoded AES key_\n\nThe malware contains numerous encoded strings, including the AES key used to decrypt the\nmalware configuration file. The malware decrypts these strings by first XORing them with the\nfirst byte. The malware then decrypts the rest of the string by XORing it with the single byte\nXOR key `0xDE .`\n\nThis string can be decrypted by XORing the entire string with the value `0x78 and then`\nXORing the result with `0xDE .`\n\nThe RAT provides most of its C2 capabilities to the remote operator by allowing the remote\noperator to securely transfer executable DLL plugins to the target system—via a protected\nSSL session—and load these plugins at will via the embedded plugin framework. The native\nmalware itself does not provide much actual functionality to the operator without the code\nprovided by the plugins. Some of the native functionality that the malware provides without\nthe use of a plugin includes collecting system data—such as computer name, username,\ncurrent process, operating system (OS) version, local system time, and the current process\nthat the malware is masquerading as (System Owner/User Discovery [[T1033], Process](https://attack.mitre.org/versions/v9/techniques/T1033)\n_Discovery_ [[T1057], System Time Discovery](https://attack.mitre.org/versions/v9/techniques/T1057) [[T1124], Masquerading](https://attack.mitre.org/versions/v9/techniques/T1124) [[T1036]). The program](https://attack.mitre.org/versions/v9/techniques/T1036)\nalso contains native C2 capabilities allowing it to communicate with the remote operator\nusing an embedded SOCKS proxy or via domain name system (DNS) tunneling (Proxy\n\n[[T1090]).](https://attack.mitre.org/versions/v9/techniques/T1090)\n\nThe malware does contain hardcoded commands that it uses to evaluate against operatorprovided data. These commands are encoded within the binary, and they are not encoded\nbefore being compared against operator-provided data—indicating the malware expects the\n\n\n-----\n\nremote operator to encode the commands before passing them to the RAT.\n\nThe malware contains an encoded note, presumably designed for malware analysts who\nanalyze the code. See figure 3.\n\n_Figure 3: Encoded note_\n\n**_59fb3174bb34e803_**\n\nThe `59fb3174bb34e803 artifact is an encrypted configuration file that is read by the`\nWwanSvc program. The configuration file contains the hardcoded domain,\n```\nfeticost[.]com . The program attempts DNS queries for this domain prepending a third\n\n```\nlevel domain that consists of seven to nine random hexadecimal characters (e.g.,\n```\nbb95058f1[.]feticost.com ).\n\n```\nThe file `feticost[.]com resolved to the IP address` `51.89.50[.]152 at the time of`\nanalysis.\n\n**Publicly Available Tool: RouterScan.exe**\n\n\n-----\n\nThe `RouterScan.exe artifact is Router Scan v2.60 by Stas M. This utility is used to identify`\nnetwork routers and proxy servers on a network (Discovery [[TA0007]). The latest release of](https://attack.mitre.org/versions/v9/tactics/TA0007/)\nthis program (v2.60) contains a list of common admin names and passwords that can be\nused for a dictionary attack to gain access to a network router (Credential Access [[TA0006],](https://attack.mitre.org/versions/v9/tactics/TA0006/)\n_Brute Force: Password Guessing_ [[T1110.001]). The program also contains code to identify](https://attack.mitre.org/versions/v9/techniques/T1110/001/)\ncommon vulnerabilities and leverage exploits against many popular routers (Active\n_Scanning: Vulnerability Scanning_ [[T1595.002]). The program can be customized to scan any](https://attack.mitre.org/versions/v9/techniques/T1595/002/)\nsubnet and any particular port, or protocol (Network Service Scanning [[T1046]). The latest](https://attack.mitre.org/versions/v9/techniques/T1046/)\nversion also contains software to scan for wireless network access points (System Network\n_Connections Discovery_ [[T1049]).](https://attack.mitre.org/versions/v9/techniques/T1049/)\n\nTo execute this program, two libraries are required: `librouter.dll and` `libeay32.dll .`\nUpon execution, the program will generate several telemetry files that are dropped in the\ncurrent directory. These files are named `RouterScan.log,` `Config.ini,` `filter.txt,`\n```\nexclusions.txt, ports.txt, and ranges.txt .\n\n```\n**Open-Source Tool: grabff.exe**\n\nThe `grabff.exe artifact is a 32-bit .NET executable called grabff and is used for Credential`\n_Access_ [[TA0006]. The program uses a command line interface to extract Firefox stored](https://attack.mitre.org/versions/v9/tactics/TA0006/)\npasswords and authentication information from the user’s profile located at `C:\\Users\\`\n```\n<user>\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles (Command and Scripting\n\n```\n_Interpreter: Windows Command Shell_ [[T1059.003], Credentials from Password Stores:](https://attack.mitre.org/versions/v9/techniques/T1059/003/)\n[Credentials from Web Browsers [T1555.003]). The program will extract the password](https://attack.mitre.org/versions/v9/techniques/T1555/003/)\ndatabases found in `key3.db,` `key4.db, and` `logins.json as well as the SQLite-based`\ncertificate database, `cert9.db . The data can be copied to any designated directory.`\n\n**Open-Source Tool: rclone.exe**\n\nThe `rclone.exe artifact is an open-source cloud content management program called`\nRclone. The program uses a command line interface to manage files in cloud storage. The\nprogram is capable of uploading and downloading files, verifying file integrity, and providing\nfile encryption. The program can use any of the following protocols: SSH File Transfer\nProtocol (SFTP), Web Distributed Authoring and Versioning (WebDAV), File Transfer\nProtocol (FTP), and Digital Living Network Alliance (DLNA).\n\n**s3browser-9-5-3.exe**\n\nThe `s3browser-9-5-3.exe artifact is the free version of the S3 Browser program used to`\nupload and download data from a cloud account. The program can fully configure a cloud\naccount, modify HTTP headers and object tags, enable multiple simultaneous uploads and\ndownloads, and provide server-side encryption (Create Account: Cloud Account\n\n[[T1136.003]). By default, the installed components of the program are stored in the path](https://attack.mitre.org/versions/v9/techniques/T1136/003/)\n\n\n-----\n\n```\nC:\\Program Files\\S3 Browser . Activity logs are created on a daily basis and are stored\n\n```\nin the path `C:\\Users\\<user>\\AppData\\Roaming\\S3Browser\\logs in the format`\n```\ns3browser-win32-YYYY-MM-DD-log.txt .\n\n## Solution\n\n```\nShould your organization be a victim of ransomware, CISA strongly recommends responding\n[by using the Ransomware Response Checklist located in the Joint Ransomware Guide, co-](https://www.cisa.gov/publication/ransomware-guide)\nauthored by CISA and the Multi-State Information Sharing and Analysis Center. The guide\ncontains steps for detection and analysis as well as containment and eradication.\n\nCISA recommends organizations implement the following practices to strengthen the security\nposture of their systems.\n\nMaintain up-to-date antivirus signatures and engines.\nKeep operating system patches up to date.\nDisable file and printer sharing services. If these services are required, use strong\npasswords or Active Directory authentication.\nRestrict users' ability (permissions) to install and run unwanted software applications.\nDo not add users to the local administrators group unless required.\nImplement multi-factor authentication (MFA), particularly on all VPN connections,\nexternal-facing services, and privileged accounts. Where MFA is not implemented,\nenforce a strong password policy and implement regular password changes.\nDecommission unused VPN servers, which may act as a point of entry for attackers.\nMonitor network traffic for unexpected and unapproved protocols, especially outbound\nto the internet (e.g., SSH, SMB, RDP).\nExercise caution when opening email attachments even if the attachment is expected\nand the sender appears to be known.\nEnable a personal firewall on agency workstations, configured to deny unsolicited\nconnection requests.\nDisable unnecessary services on agency workstations and servers.\nScan for—and remove—suspicious e-mail attachments; ensure the scanned\nattachment is its \"true file type\" (i.e., the extension matches the file header).\nMonitor users' web browsing habits; restrict access to sites with unfavorable content.\nExercise caution when using removable media (e.g., USB thumb drives, external\ndrives, CDs).\nScan all software downloaded from the internet prior to executing.\nMaintain situational awareness of the latest threats and implement appropriate access\ncontrol lists (ACLs).\n\n## References\n\n[[1] BlackBerry ThreatVector Blog, The CostaRicto Campaign: Cyber-Espionage Outs…](https://blogs.blackberry.com/en/2020/11/the-costaricto-campaign-cyber-espionage-outsourced)\n\n[[2] MITRE ATT&CK – PowerSploit](https://attack.mitre.org/software/S0194/)\n\n\n-----\n\n## Revisions\n\nMay 6, 2021: Initial Version\n\n[This product is provided subject to this Notification and this](https://us-cert.cisa.gov/privacy/notification) [Privacy & Use policy.](https://www.dhs.gov/privacy-policy)\n\n**Please share your thoughts.**\n\n[We recently updated our anonymous product survey; we'd welcome your feedback.](https://www.surveymonkey.com/r/CISA-cyber-survey?product=https://us-cert.cisa.gov/ncas/analysis-reports/ar21-126a)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-06 - Analysis Report- FiveHands Ransomware.pdf"
    ],
    "report_names": [
        "2021-05-06 - Analysis Report- FiveHands Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "c72c09b8-81ba-4e6e-9094-cd84ee4bda79",
            "created_at": "2022-10-25T15:50:23.667393Z",
            "updated_at": "2025-03-27T02:00:55.517974Z",
            "deleted_at": null,
            "main_name": "CostaRicto",
            "aliases": [
                "CostaRicto"
            ],
            "source_name": "MITRE:CostaRicto",
            "tools": [
                "PowerSploit",
                "SombRAT",
                "PsExec",
                "PS1",
                "CostaBricks"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b77f9b40-dca7-449d-819e-115cd2295b41",
            "created_at": "2022-10-25T16:07:23.502671Z",
            "updated_at": "2025-03-27T02:02:09.834738Z",
            "deleted_at": null,
            "main_name": "CostaRicto",
            "aliases": [],
            "source_name": "ETDA:CostaRicto",
            "tools": [
                "CostaBricks",
                "PowerSploit",
                "PsExec",
                "SombRAT",
                "nmap"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "115cf618-02a8-42b8-8d25-305292eafedb",
            "created_at": "2023-11-21T02:00:07.396534Z",
            "updated_at": "2025-03-27T02:00:03.251048Z",
            "deleted_at": null,
            "main_name": "CostaRicto",
            "aliases": [],
            "source_name": "MISPGALAXY:CostaRicto",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535547,
    "ts_updated_at": 1743041391,
    "ts_creation_date": 1653691843,
    "ts_modification_date": 1653691843,
    "files": {
        "pdf": "https://archive.orkl.eu/d11d7f350bdc1f2e2f8d3a354ef3ebe599a04a10.pdf",
        "text": "https://archive.orkl.eu/d11d7f350bdc1f2e2f8d3a354ef3ebe599a04a10.txt",
        "img": "https://archive.orkl.eu/d11d7f350bdc1f2e2f8d3a354ef3ebe599a04a10.jpg"
    }
}