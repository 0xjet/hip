{
    "id": "7bc4a5ee-be36-49bf-8dcd-4dfaf7a0d16a",
    "created_at": "2022-10-25T16:48:13.341183Z",
    "updated_at": "2025-03-27T02:16:53.020076Z",
    "deleted_at": null,
    "sha1_hash": "3b79c5afc45ef460ee3f6fb2272521f23a38801c",
    "title": "PowerPoint Presentation",
    "authors": "",
    "file_creation_date": "2021-07-05T21:39:19Z",
    "file_modification_date": "2021-07-27T19:53:49Z",
    "file_size": 2036048,
    "plain_text": "##### Anatomy of Native IIS Malware\n\n###### Zuzana Hromcova | Malware Researcher, ESET\n\n\n-----\n\n##### Anatomy of Native IIS Malware\n\n###### C++\n Internet\n libraries\n Information\n Services\n\n\n-----\n\n##### How popular is IIS software?\n\n\n-----\n\n# 4-7%\n\n###### of websites use\n IIS server*\n\n\n-----\n\n###### *Netcraft: May 2021 Web Server Survey\n\n# 4-7%\n\n###### of websites use\n IIS server*\n\n\n-----\n\n###### *W3Techs: Usage statistics of web servers\n\n# 4-7%\n\n###### of websites use\n IIS server*\n\n\n-----\n\n###### Microsoft Exchange\n email servers with\n\n Outlook\n\n## OWA\n\n###### on the web\n\n\n-----\n\n###### Shodan result for public servers with OWA running Microsoft Exchange 2013 or 2016 (query for the IIS banner X-AspNet-Version and Outlook in the title):\n\n Microsoft Exchange\n email servers with\n\n## OWA\n\n\n-----\n\n###### IIS backdoors spreading via ProxyLogon\n\n\n###### Government\n institutions in three countries in\n Southeast Asia\n\n A major telecom\n company in Cambodia\n\n Private companies in Canada, USA, South\n\n\n-----\n\n###### Government Compromised\n SEO fraud\n espionage websites\n Crime schemes to\n Infiltrating government IIS malware serving\n manipulate SERP\n mailboxes malicious content &\n adware\n\n Targeting\n C&C traffic\n e-commerce\n routing\n Stealing credentials &\n Compromised IIS server\n credit card information\n as a malicious proxy\n\n\n-----\n\n###### Known malicious IIS modules:\n\n ISN\n\n IIS v7.0\n\n 2007 2013\n\n\n-----\n\n###### Known malicious IIS modules:\n\n RGDoor\n\n ISN\n\n IIS v7.0\n\n 2007 2013 2018\n\n\n-----\n\n###### Known malicious IIS modules:\n\n RGDoor\n\n ISN\n Native malware\n IIS v7.0\n\n 2007 2013 2018 2019\n\n\n-----\n\n###### Known malicious IIS modules:\n\n Managed malware\n RGDoor\n\n ISN\n Native malware\n IIS v7.0\n\n 2007 2013 2018 2019 2020\n\n\n-----\n\n###### Known malicious IIS modules:\n\n Managed malware\n RGDoor\n\n IIS-Raid\n ISN\n Native malware\n IIS v7.0\n\n 2007 2013 2018 2019 2020 2021\n\n\n-----\n\n###### Known malicious IIS modules:\n\n Managed malware\n RGDoor\n\n IIS-Raid\n ISN\n Native malware\n IIS v7.0\n\n 2007 2013 2018 2019 2020 2021\n\n\n-----\n\n##### Our research\n\n\n-----\n\n###### Our research\n\n Malicious native IIS modules (C++ libraries)\n\n 80+ unique samples from our telemetry and VirusTotal\n\n 14 malware families (10 never documented)\n\n Victim information from our telemetry and internet-wide scans\n\n Detailed information and analyses in the white paper\n\n\n-----\n\n###### Malicious native IIS modules\n\n##### Architecture\n Reversing\n TTPs Defense\n\n\n-----\n\n###### Malicious native IIS modules\n\n##### Architecture\n\n\n-----\n\n###### Internet Information Services (IIS)\n\n • Microsoft web server software\n\n • Modular architecture (since v7.0)\n\n • IIS services configured to run at each system start (World Wide\n Web Publishing Service, Windows Process Activation Service or Application Host Helper Services)\n\n • IIS Worker Process (w3wp.exe)\n\n • Handles inbound requests\n\n • Loads all IIS modules configured in\n```\n       %windir%\\system32\\inetsrv\\config\\ApplicationHost.config\n\n```\n\n-----\n\n###### Request-processing pipeline\n\n\n-----\n\n###### Events Event handlers generate notifications\n handle notifications\n\n Class inheriting from CHttpModule:\n\n Event notification\n\n Post-event notification\n\n\n-----\n\n###### Events generate notifications\n\n\n-----\n\n###### Class inheriting from CHttpModule:\n Module classes implement event handlers\n\n Class inheriting from CGlobalModule:\n\n\n-----\n\n###### Class inheriting from CHttpModule:\n Module classes implement event handlers\n\n Class inheriting from CGlobalModule:\n\n\n-----\n\n###### Class inheriting from CHttpModule:\n Module classes implement event handlers\n\n Class inheriting from CGlobalModule:\n\n\n-----\n\n###### RegisterModule DLL export / module entrypoint\n\n 1. Creates instances of the\n core classes\n\n\n-----\n\n###### RegisterModule DLL export / module entrypoint\n\n 1. Creates instances of the\n core classes\n\n 2. Registers module for\n server events\n\n\n-----\n\n###### RegisterModule DLL export / module entrypoint\n\n 1. Creates instances of the\n core classes\n\n 2. Registers module for\n server events\n\n 3. Sets priority for the\n module\n\n\n-----\n\n###### Malicious native IIS modules\n##### Reverse-engineering\n\n\n-----\n\n###### Import relevant interfaces (implemented in iiscore.dll):\n 1\n```\n     IHttpContext, IHttpModuleRegistrationInfo, IHttpRequest,\n     IHttpResponse, IPreBeginRequestProvider…\n\n```\n\n-----\n\n###### See Group 9 in the paper\n\n Start with RegisterModule export\n 2\n\n • Which handlers are implemented?\n\n • Initialization?\n\n\n-----\n\n###### See Group 7 in the paper\n Identify implemented handlers 3 malicious handler\n\n malicious handler malicious handler\n\n\n-----\n\n###### See Group 12 in the paper\n Identify implemented handlers 3\n malicious handler\n\n benign handler\n\n benign handler\n\n\n-----\n\n###### See Group 12 in the paper\n Identify implemented handlers 3\n malicious handler\n\n benign handler\n\n benign handler\n\n Refer to the Native-Code API Reference for the analysis 4\n\n\n-----\n\n###### Malicious native IIS modules\n##### Understanding the TTPs\n\n\n-----\n\n###### Backdoor commands\n 1 IIS backdoors\n\n • Get system information\n execute backdoor commands on IIS server\n\n • Upload/download files\n\n • Execute files or shell commands\n\n • Create reverse shell\n\n • Create/list/move/rename/delete files and folders\n\n • Map local drives to remote drives\n Special HTTP request with backdoor commands • Exfiltrate collected data\n 1\n\n 2 Attacker HTTP requests\n Command output\n\n • A custom HTTP header present\n\n • An embedded password in the URL, request body, headers (hardcoded password or password hash in the malware)\n\n • A specific format of URL or request body\n\n\n-----\n\n###### Attacker HTTP request example\n\n See Group 7 in the paper\n\n\n-----\n\n###### See Group 5 in the paper\n 2 IIS infostealers intercept traffic and steal data from legitimate visitors\n\n\n-----\n\n#### DEMO\n\n\n-----\n\n###### See Group 12 in the paper\n\n 3 IIS injectors serve malicious content to legitimate visitors\n\n\n-----\n\n###### See Group 9 in the paper\n\n 4 IIS proxies relay traffic between a compromised host and the C&C server\n\n\n-----\n\n###### See Group 13 in the paper\n 5 SEO fraud deceive search engine crawlers\n\n • Manipulates content served to search engine crawlers to boost SEO for selected websites\n\n • Legitimate user requests are ignored by the malware\n\n • Techniques used:\n\n • Keyword stuffing\n\n • Injecting a list of backlinks\n\n • Redirecting the crawlers (turning the compromised website into a doorway page)\n\n • This is not Black Hat SEO\n\n • A third-party website benefits from the manipulation, not the one serving the manipulated content (this is likely sold as a service)\n\n • C&C communication to obtain configuration data\n\n • Other malicious modes present (e.g. backdoor, proxy)\n\n\n-----\n\n|Malware family|Backdoor|Info stealer|Proxy|SEO fraud|Injector|\n|---|---|---|---|---|---|\n|Group 1||||||\n|Group 2||||||\n|Group 3||||||\n|Group 4||||||\n|Group 5||||||\n|Group 6||||||\n|Group 7||||||\n|Group 8||||||\n|Group 9||||||\n|Group 10||||||\n|Group 11||||||\n|Group 12A||||||\n|Group 12B||||||\n|Group 12C||||||\n|Group 13||||||\n\n\n###### Malware Info SEO\n Backdoor Proxy Injector family stealer fraud\n\n Group 1\n\n Group 2\n\n Group 3\n\n Group 4\n\n Group 5\n\n Group 6\n\n Group 7\n Known IIS\n\n Group 8\n malware families\n Group 9\n See the paper for detailed analyses\n\n Group 10\n\n Group 11\n\n Group 12A\n\n Group 12B\n\n Group 12C\n\n Group 13\n\n\n-----\n\n###### Malicious native IIS modules\n##### Detection, mitigation\n and remediation\n\n\n-----\n\n###### Detecting compromised servers\n\n Inspect installed\n modules\n\n\n-----\n\n-----\n\n###### Detecting compromised servers\n\n Inspect installed\n Check IIS logs Scan for known\n the default location is modules\n malware families\n```\n     %SystemDrive%\\inetpub\n via IIS Manager, AppCmd.exe\n \\logs\\LogFiles use IoCs and YARA rules listed\n or inspect the configuration file\n on our GitHub repository\n                      %windir%\\system32\\inetsrv\\\n                     config\\ApplicationHost.config\n\n```\n\n-----\n\n#### DEMO\n\n\n-----\n\n###### Mitigation (of compromise vectors)\n\n Prevent Prevent installing\n malicious (e.g.,\n server exploitation\n trojanized) modules\n\n • keep your OS up-to-date\n\n • only install modules from trusted\n\n • limit services exposed to the internet\n sources\n\n • use strong passwords and 2FA for\n\n • consider using an endpoint\n dedicated administrative accounts\n security solution\n\n\n-----\n\n##### Conclusion\n\n\n-----\n\n###### Black Hat Sound Bytes Anatomy of Native IIS Malware\n\n\n### 1\n\n###### IIS malware: cybercrime AND cyberespionage tool we documented 14 families (10 new);\n\n### 2\n###### consider them in your threat model\n Get the full white paper: for a comprehensive guide on detecting analyzing and\n\n\n### 3\n\n###### Use the IoCs and\n YARA rules for\n detection:\n\n\n###### get them from the ESETresearch GitHub\n https://github.com/eset/malware ioc/tree/master/badiis\n\n\n### 2\n\n\n-----\n\n##### Thanks for watching!\n\n###### www.welivesecurity.com\n Zuzana Hromcova @ESETresearch\n ESET Malware Researcher\n @zuzana_hromcova\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://i.blackhat.com/USA21/Wednesday-Handouts/us-21-Anatomy-Of-Native-Iis-Malware.pdf"
    ],
    "report_names": [
        "us-21-Anatomy-Of-Native-Iis-Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "4b076dcb-516e-42fb-9c8f-f153902cd5e9",
            "created_at": "2022-10-25T16:07:23.708745Z",
            "updated_at": "2025-03-27T02:02:09.935617Z",
            "deleted_at": null,
            "main_name": "Hidden Lynx",
            "aliases": [
                "Aurora Panda",
                "Group 8",
                "Hidden Lynx",
                "Operation SMN"
            ],
            "source_name": "ETDA:Hidden Lynx",
            "tools": [
                "AGENT.ABQMR",
                "AGENT.AQUP.DROPPER",
                "AGENT.BMZA",
                "AGENT.GUNZ",
                "BlackCoffee",
                "HiKit",
                "MCRAT.A",
                "Mdmbot.E",
                "Moudoor",
                "Naid",
                "PNGRAT",
                "Trojan.Naid",
                "ZoxPNG",
                "gresim"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3fad11c6-4336-4b28-a606-f510eca5452e",
            "created_at": "2022-10-25T16:07:24.346573Z",
            "updated_at": "2025-03-27T02:02:10.183211Z",
            "deleted_at": null,
            "main_name": "Turbine Panda",
            "aliases": [
                "APT 26",
                "Black Vine",
                "Bronze Express",
                "Group 13",
                "JerseyMikes",
                "KungFu Kittens",
                "PinkPanther",
                "Shell Crew",
                "Turbine Panda",
                "WebMasters"
            ],
            "source_name": "ETDA:Turbine Panda",
            "tools": [
                "Agent.dhwf",
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "FF-RAT",
                "FormerFirstRAT",
                "Hurix",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mivast",
                "PlugX",
                "RbDoor",
                "RedDelta",
                "RibDoor",
                "Sakula",
                "Sakula RAT",
                "Sakurel",
                "Sogu",
                "StreamEx",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Winnti",
                "Xamtrav",
                "cobeacon",
                "ffrat"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "761d1fb2-60e3-46f0-9f1c-c8a9715967d4",
            "created_at": "2023-01-06T13:46:38.269054Z",
            "updated_at": "2025-03-27T02:00:02.789278Z",
            "deleted_at": null,
            "main_name": "APT3",
            "aliases": [
                "TG-0110",
                "Group 6",
                "Buckeye",
                "Boyusec",
                "BORON",
                "BRONZE MAYFAIR",
                "Red Sylvan",
                "GOTHIC PANDA"
            ],
            "source_name": "MISPGALAXY:APT3",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "cf7fc640-acfe-41c4-9f3d-5515d53a3ffb",
            "created_at": "2023-01-06T13:46:38.228042Z",
            "updated_at": "2025-03-27T02:00:02.775905Z",
            "deleted_at": null,
            "main_name": "APT1",
            "aliases": [
                "GIF89a",
                "G0006",
                "PLA Unit 61398",
                "Group 3",
                "TG-8223",
                "Comment Group",
                "ShadyRAT",
                "COMMENT PANDA",
                "Comment Crew",
                "Byzantine Candor",
                "Brown Fox"
            ],
            "source_name": "MISPGALAXY:APT1",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a7aefdda-98f1-4790-a32d-14cc99de2d60",
            "created_at": "2023-01-06T13:46:38.281844Z",
            "updated_at": "2025-03-27T02:00:02.792526Z",
            "deleted_at": null,
            "main_name": "APT17",
            "aliases": [
                "G0025",
                "AURORA PANDA",
                "Group 72",
                "G0001",
                "HELIUM",
                "Group 8",
                "Hidden Lynx",
                "Tailgater Team",
                "BRONZE KEYSTONE"
            ],
            "source_name": "MISPGALAXY:APT17",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "46a151bd-e4c2-46f9-aee9-ee6942b01098",
            "created_at": "2023-01-06T13:46:38.288168Z",
            "updated_at": "2025-03-27T02:00:02.794118Z",
            "deleted_at": null,
            "main_name": "APT19",
            "aliases": [
                "Black Vine",
                "TEMP.Avengers",
                "PinkPanther",
                "G0073",
                "KungFu Kittens",
                "Group 13",
                "Shell Crew",
                "BRONZE FIRESTONE",
                "G0009",
                "Sunshop Group",
                "DEEP PANDA",
                "Codoso"
            ],
            "source_name": "MISPGALAXY:APT19",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "06f622cb-3a78-49cf-9a4c-a6007a69325f",
            "created_at": "2022-10-25T16:07:23.315239Z",
            "updated_at": "2025-03-27T02:02:09.733197Z",
            "deleted_at": null,
            "main_name": "APT 3",
            "aliases": [
                "APT 3",
                "Bronze Mayfair",
                "Buckeye",
                "Gothic Panda",
                "Group 6",
                "Operation Clandestine Fox",
                "Operation Clandestine Fox, Part Deux",
                "Operation Clandestine Wolf",
                "Operation Double Tap",
                "Red Sylvan",
                "TG-0110",
                "UPS Team"
            ],
            "source_name": "ETDA:APT 3",
            "tools": [
                "APT3 Keylogger",
                "Agent.dhwf",
                "BKDR_HUPIGON",
                "Backdoor.APT.CookieCutter",
                "Badey",
                "Bemstour",
                "CookieCutter",
                "Destroy RAT",
                "DestroyRAT",
                "DoublePulsar",
                "EXL",
                "EternalBlue",
                "HTran",
                "HUC Packet Transmit Tool",
                "Hupigon",
                "Hupigon RAT",
                "Kaba",
                "Korplug",
                "LaZagne",
                "MFC Huner",
                "OSInfo",
                "Pirpi",
                "PlugX",
                "RedDelta",
                "RemoteCMD",
                "SHOTPUT",
                "Sogu",
                "TIGERPLUG",
                "TTCalc",
                "TVT",
                "Thoper",
                "Xamtrav",
                "remotecmd",
                "shareip",
                "w32times"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3aaf0755-5c9b-4612-9f0e-e266ef1bdb4b",
            "created_at": "2022-10-25T16:07:23.480196Z",
            "updated_at": "2025-03-27T02:02:09.826059Z",
            "deleted_at": null,
            "main_name": "Comment Crew",
            "aliases": [
                "APT 1",
                "BrownFox",
                "Byzantine Candor",
                "Byzantine Hades",
                "Comment Crew",
                "Comment Panda",
                "GIF89a",
                "Group 3",
                "Operation Oceansalt",
                "Operation Seasalt",
                "Operation Siesta",
                "Shanghai Group",
                "TG-8223"
            ],
            "source_name": "ETDA:Comment Crew",
            "tools": [
                "Auriga",
                "Cachedump",
                "Chymine",
                "CookieBag",
                "Darkmoon",
                "GDOCUPLOAD",
                "GLOOXMAIL",
                "GREENCAT",
                "Gen:Trojan.Heur.PT",
                "GetMail",
                "Hackfase",
                "Hacksfase",
                "Helauto",
                "Kurton",
                "LETSGO",
                "LIGHTBOLT",
                "LIGHTDART",
                "LOLBAS",
                "LOLBins",
                "LONGRUN",
                "Living off the Land",
                "Lslsass",
                "MAPIget",
                "ManItsMe",
                "Mimikatz",
                "MiniASP",
                "Oceansalt",
                "Pass-The-Hash Toolkit",
                "Poison Ivy",
                "ProcDump",
                "Riodrv",
                "SPIVY",
                "Seasalt",
                "ShadyRAT",
                "StarsyPound",
                "TROJAN.COOKIES",
                "TROJAN.FOXY",
                "TabMsgSQL",
                "Tarsip",
                "Trojan.GTALK",
                "WebC2",
                "WebC2-AdSpace",
                "WebC2-Ausov",
                "WebC2-Bolid",
                "WebC2-Cson",
                "WebC2-DIV",
                "WebC2-GreenCat",
                "WebC2-Head",
                "WebC2-Kt3",
                "WebC2-Qbp",
                "WebC2-Rave",
                "WebC2-Table",
                "WebC2-UGX",
                "WebC2-Yahoo",
                "Wordpress Bruteforcer",
                "bangat",
                "gsecdump",
                "pivy",
                "poisonivy",
                "pwdump",
                "zxdosml"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716493,
    "ts_updated_at": 1743041813,
    "ts_creation_date": 1625521159,
    "ts_modification_date": 1627415629,
    "files": {
        "pdf": "https://archive.orkl.eu/3b79c5afc45ef460ee3f6fb2272521f23a38801c.pdf",
        "text": "https://archive.orkl.eu/3b79c5afc45ef460ee3f6fb2272521f23a38801c.txt",
        "img": "https://archive.orkl.eu/3b79c5afc45ef460ee3f6fb2272521f23a38801c.jpg"
    }
}