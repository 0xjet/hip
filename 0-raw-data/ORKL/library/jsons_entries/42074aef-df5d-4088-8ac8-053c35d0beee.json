{
    "id": "42074aef-df5d-4088-8ac8-053c35d0beee",
    "created_at": "2023-01-12T15:05:56.879924Z",
    "updated_at": "2025-03-27T02:06:02.975924Z",
    "deleted_at": null,
    "sha1_hash": "50fc10c030b502b1f59252b40bfc18e5890f4554",
    "title": "2020-01-08 - Leonardo S.p.A. Data Breach Analysis",
    "authors": "",
    "file_creation_date": "2022-05-28T17:57:26Z",
    "file_modification_date": "2022-05-28T17:57:26Z",
    "file_size": 891931,
    "plain_text": "# Leonardo S.p.A. Data Breach Analysis\n\n**reaqta.com/2021/01/fujinama-analysis-leonardo-spa**\n\nReaQta Threat Intelligence Team identified the malware used in an exfiltration operation\nagainst the defence contractor Leonardo S.p.A. The analysis of the malware, which we\ndubbed Fujinama, highlights its capabilities for data theft and exfiltration while maintaining a\nreasonably low-profile, despite a lack of sophistication, mostly due to the fact that the\nmalicious vector was manually installed by an insider.\n\n**Data Breach**\n\n**Leonardo S.p.A. (formerly Finmeccanica) is the 8th largest defence contractor. Partially**\nowned by the Italian government, the company is widely known, among other things, for their\n_AgustaWestland Helicopters, major contributions to the Eurofighter project, development of_\nnaval artillery, armoured vehicles, underwater systems, implementation of space systems,\nelectronic defence and more.\n\nOn the 5th of December 2020 the CNAIPIC (National Computer Crime Center for Critical\n_Infrastructure Protection), a unit specialized in computer crime, part of the Polizia di Stato_\n[(the Italian Police), reported the arrest of 2 individuals in relation to a data theft operation,](https://www.commissariatodips.it/notizie/articolo/attacco-hacker-a-leonardo-spa-due-arresti/index.html)\nidentified for the first time in January 2017, against Leonardo SpA’s infrastructure. The\nanomalous activity was identified by the company’s security unit and quickly reported to the\nauthorities that started an extensive investigation.\n\n\n-----\n\nThough the company’s initial report identified the leak to be negligible in volume, the\nCNAIPIC’s investigation found the amount to actually be significant, with 100.000 files\nexfiltrated for a total of 10Gb of data from 33 devices in a single location and tracking the\nfinal infection to a total of 94 different devices. The attack was considered an APT by the\nItalian Police, carried out by a single person whom manually installed a custom malware on\neach targeted machine.\n\n**Physical attacks are hard to detect, as any local access to the device can help to mitigate**\non-device detections, this is especially true when the attacker is, like in Leonardo’s case, part\nof the company’s security unit.\n\nA physical attack carried out by a person with high-level access is a worst-case scenario\nfor any company or agency but, as we will see later, things might have taken a different turn\nif the malware involved was actually sophisticated.\n\n**Fujinama First Detection**\n\nIn January 2017, Leonardo’s Cyber Security Unit reported anomalous traffic from a number\nof endpoints operating in the Pomigliano D’Arco (Naples) office, the offending application\nname cftmon.exe was a twist of a well-known Windows component ctfmon.exe. The\napplication was not recognized as malicious by the security solutions in use, but the network\ntraffic was indeed highly anomalous. As we will see in the analysis, while the attacker was\ncertainly persistent, the sophistication was also lacking, in fact the type of traffic generated\nled eventually to the identification of the threat.\n\nUnfortunately the CNAIPIC didn’t release any information on the threat, except for its\nfilename and the C2 address used: www[.]fujinama[.]altervista.org though this was enough to\nthreat hunt in our dataset looking for traces of this malware.\n\n**Hunting Down Fujinama**\n\nThe hunt for Fujinama started shortly after CNAIPIC’s bulletin was published. Our Threat\n_Intelligence team managed to find samples that reached our sensors network from 2018._\nFrom that point, we managed to pivot on a third sample that appears to be related to a\ndifferent operation\n\n\n-----\n\nTwo of the three samples share the same keylogging capabilities but they point at two\ndifferent C2. A third sample, pointing to the Fujinama C2, is in all likelihood an evolution of\nthe previous version that includes screenshots capabilities, exfiltration and remote execution.\nThis specific sample, labeled Sample 2 in the article, will be the focus of our behavioural\nanalysis.\n\n**ReaQta-Hive Analysis**\n\nBehavioural Tree from a running instance on ReaQta-Hive\nFujinama was written in Visual Basic 6 and it tries to mimic an internal Windows tool:\n_cftmon.exe (as mentioned above, a twist on the legitimate ctfmon.exe)._\n\n**Main Flow**\n\nThe sample adopts a very simple sandbox evasion technique, sleeping for 60 seconds\nbefore activating the malicious flow that consists of:\n\n**Every 60 seconds: capturing a screenshot of the Desktop and uploading it to the C2**\nInstalling a keylogger on the victim machine that sends all keystroke to the C2\n\n\n-----\n\n**Every 5 minutes: checking on the C2 for the presence of a command used either to**\n**execute an application or to exfiltrate a specific file**\n\n**Screenshots**\n\nThe Screenshot routine simulates a keypress on the PrtScn button to capture the image of\nthe desktop. The screen content is then saved from the clipboard to a jpg file in a temporary\nfolder. Finally Fujinama uploads the newly created image to its C2, using a http POST\nrequest with content-type multi-part before deleting the file from the victim’s device.\n\nThe entire flow of the screenshot routine: from capture to upload and deletion\n**Keylogger**\n\nThe keylogging routine simply waits for the user input, once a keystroke has been typed it is\nimmediately uploaded to the C2. Surprisingly the keystroke is transferred using a simple\n_GET request, this approach – although ignored by the local antivirus – is both visible and_\nnoisy, most likely this is what gave up the presence of the malware on its first detection.\n\nKeylogger transferring the keystroke via GET\nThe keylogger routine is quite common, as shown in the API list below.\n\n\n-----\n\nWindows APIs used by the keylogger\n**C2 Commands**\n\nAn interesting part of Fujinama is the ability to execute custom commands and custom\nexfiltrations as instructed by the C2. Every 5 minutes a configuration file stored on the C2 for\n**each infected endpoint, is polled. The samples we have analyzed support 2 commands:**\n\n**CMD: contains the commandline to execute on the infected endpoint**\n**SND: exfiltrates a specific file from the endpoint**\n\nBelow we show how it is possible to run custom commands from the C2.\n\nProcess creation after the C2 instructed Fujinama via CMD command\n[Exfiltration is also confirmed using ReaQta-Hive, showing below Fujinama as it captures the](https://reaqta.com/hive)\n_hosts file from the infected endpoint, before delivering it to the C2._\n\nFile read of the hosts file after sending the SND command\nThe RAT’s beaconing is automatically detected and alerted by ReaQta-Hive’s engines.\nBelow is a screenshot of Fujinama phoning home at regular intervals (with minor drifting due\nto other parts of the RAT contacting the C2).\n\n\n-----\n\nFujinama Beaconing\n\n**Variants**\n\nReaQta has so far identified 3 different Fujinama samples, 2 of them certainly used on\nLeonardo’s infrastructure while the third appears to be part of a different project.\n\n_Sample 1: used on Leonardo (Keylog)_\n_Sample 2: used on Leonardo (Keylog, Screenshots, Remote commands)_\n_Sample 3: under investigation (Keylog)_\n\nThe analysis shown above has been run on Sample 2, both Sample 1 and Sample 2 share\nthe same C2 infrastructure. Sample 2 is at all effects an evolution of Sample 1 that acquired\nnew capabilities (Screenshots and Remote command support) that were not present in the\nprevious version.\n\n**(Sample 1) cftmon v3.3** **(Sample 2) cftmon v3.5**\n\nKeylogging Keylogging\n\nScreenshots\n\nRemote Commands\n\nCapabilities for Sample 1 and Sample 2\nWe measured both the code similarity (95%) and behavioral similarity (99%) between\n_Sample 1 and Sample 3, confirming they’re an almost exact match. Sample 3 shares without_\ndoubts the same codebase used for Sample 1, with a few notable differences:\n\n\n-----\n\n_Sample 1 and Sample 2 appear to be compiled on the same machine, Sample 3_\nseems to have been compiled on a different device\n_Sample 1 and Sample 2 and Sample 3 share the same language id (Italian) though at_\nleast one keylogger string has been translated back to english\n_Sample 1 and Sample 2 use the same C2, Sample 3 uses a different one_\n_Sample 1 and Sample 2 share the same original filename: cftmon.exe, Sample 3 uses_\na different one: igfxtray.exe\n\n**(Sample 1) cftmon v3.3** **(Sample 3) dllhost.exe**\n\nfujinama[.]altervista.org xhdyeggeeefeew[.]000webhostapp.com\n\n\n“/copy.php?\nfile=” & var_3C & “&name=”\n\n\n“/XdffCcxuiusSSxvbZz.php?\nZmlsZQo=” & var_3C & “&bmFtZQo=”\n\n\nvar_24 & “[ INVIO ]” var_24 & “[RETURN]”\n\nCode differences between Sample1 and Sample3\nLastly Sample 3 appears to have been compiled quite recently compared to the other\nsamples.\n\n**Sample** **Compilation Time**\n\nSample 1 2015-05-28 08:02:25\n\nSample 2 2015-07-14 12:33:39\n\nSample 3 2018-09-22 23:10:46\n\nCompilation time for the various samples\nGiven the timeline, the third sample could not be used on Leonardo. We haven’t yet found\ntraces of how, or where, the third sample was used but it’s possible that the malware project\nwas shared with a third party that managed to alter a few parts.\n\n**Detection**\n\n\n-----\n\n[ReaQta-Hive natively detects Fujinama, so no actions or updates are required from our](https://reaqta.com/hive)\ncustomers and partners.\n\nWe can’t share the samples yet, although the article provides enough data to allow\nresearchers to find them. Nevertheless given the presence of the third sample and the slim –\nbut not negligible – possibility that someone is still maintaining this project, we would like to\nshare with the community a Yara rule to identify Fujinama variants.\n```\nrule Fujinama {\n  meta:\n    description = \"Fujinama RAT used by Leonardo SpA Insider Threat\"\n    author = \"ReaQta Threat Intelligence Team\"\n    ref1 = \"https://reaqta.com/2021/01/fujinama-analysis-leonardo-spa\"\n    date = \"2021-01-07\"\n    version = \"1\"  \n  strings:\n    $kaylog_1 = \"SELECT\" wide ascii nocase\n    $kaylog_2 = \"RIGHT\" wide ascii nocase\n    $kaylog_3 = \"HELP\" wide ascii nocase\n    $kaylog_4 = \"WINDOWS\" wide ascii nocase\n    $computername = \"computername\" wide ascii nocase\n    $useragent = \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; SV1; .NET\nCLR 2.0.50727)\" wide ascii nocase\n    $pattern = \"'()*+,G-./0123456789:\" wide ascii nocase\n    $function_1 = \"t_save\" wide ascii nocase\n    $cftmon = \"cftmon\" wide ascii nocase\n    $font = \"Tahoma\" wide ascii nocase\n  condition:\n    uint16(0) == 0x5a4d and all of them\n}\n\n```\n**Conclusions**\n\nAs we have just shown, the malware is not particularly sophisticated but it certainly reached\nits goal. Sending data in clear with a simple GET is a major oversight for an actor that,\nsupposedly, wants to remain undetected. The frequent beaconing and the absence of all\nkinds of hiding/evasion mechanisms (with the exception of a basic sandbox evasion\ntechnique) shows either a lack of care, or a lack of structure. One factor that contributed to\nthe success of the attack was that the installation was performed manually, thus not requiring\nsophisticated evasion techniques. At the same time, the level of security expected from a\nmajor defence contractor should have pushed a sophisticated attacker toward a very\ndifferent modus operandi.\n\nIn our view the attack has been built opportunistically over time, with incremental\nenhancements, lacking the structure of a real APT and certainly the sophistication. Unless\nthe attacker could leverage on his position within the company, to make sure he couldn’t be\ndetected, we can’t see any reason why he was expected to otherwise remain hidden. In this\nregard, the code changes only show an increase in exfiltration capabilities, while completely\nneglecting the detection aspect.\n\n\n-----\n\n**Interested to try out ReaQta-Hive? Schedule a free trial** **_[here](http://bit.ly/2XVVSWh)_**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-01-08 - Leonardo S.p.A. Data Breach Analysis.pdf"
    ],
    "report_names": [
        "2020-01-08 - Leonardo S.p.A. Data Breach Analysis.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535956,
    "ts_updated_at": 1743041162,
    "ts_creation_date": 1653760646,
    "ts_modification_date": 1653760646,
    "files": {
        "pdf": "https://archive.orkl.eu/50fc10c030b502b1f59252b40bfc18e5890f4554.pdf",
        "text": "https://archive.orkl.eu/50fc10c030b502b1f59252b40bfc18e5890f4554.txt",
        "img": "https://archive.orkl.eu/50fc10c030b502b1f59252b40bfc18e5890f4554.jpg"
    }
}