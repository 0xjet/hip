{
    "id": "ffe8f11b-a4cd-43cf-87bf-66193f5a15c4",
    "created_at": "2023-01-12T15:03:42.845122Z",
    "updated_at": "2025-03-27T02:05:20.25738Z",
    "deleted_at": null,
    "sha1_hash": "529823ecbe46d4ed75c5f0067cb0e0573bb97d4e",
    "title": "2012-05-28 - The Flame- Questions and Answers",
    "authors": "",
    "file_creation_date": "2022-05-28T01:58:20Z",
    "file_modification_date": "2022-05-28T01:58:20Z",
    "file_size": 595755,
    "plain_text": "# The Flame: Questions and Answers\n\n**[securelist.com/the-flame-questions-and-answers-51/34344/](https://securelist.com/the-flame-questions-and-answers-51/34344/)**\n\nAuthors\n\n[Alexander Gostev](https://securelist.com/author/alexander/)\n\nDuqu and Stuxnet raised the stakes in the cyber battles being fought in the Middle East – but\nnow we’ve found what might be the most sophisticated cyber weapon yet unleashed. The\n‘Flame’ cyber espionage worm came to the attention of our experts at Kaspersky Lab after\nthe UN’s [International Telecommunication Union came to us for help in finding an unknown](http://www.itu.int/)\npiece of malware which was deleting sensitive information across the Middle East. While\nsearching for that code – nicknamed Wiper – we discovered a new malware codenamed\nWorm.Win32.Flame.\n\nFlame shares many characteristics with notorious cyber weapons Duqu and Stuxnet: while\nits features are different, the geography and careful targeting of attacks coupled with the\nusage of specific software vulnerabilities seems to put it alongside those familiar ‘superweapons’ currently deployed in the Middle East by unknown perpetrators. Flame can easily\nbe described as one of the most complex threats ever discovered. It’s big and incredibly\nsophisticated. It pretty much redefines the notion of cyberwar and cyberespionage.\n\nFor the full low-down on this advanced threat, read on…\n\n## General Questions\n\n\n-----\n\n**What exactly is Flame? A worm? A backdoor? What does it do?**\n\nFlame is a sophisticated attack toolkit, which is a lot more complex than Duqu. It is a\nbackdoor, a Trojan, and it has worm-like features, allowing it to replicate in a local network\nand on removable media if it is commanded so by its master.\n\nThe initial point of entry of Flame is unknown – we suspect it is deployed through targeted\nattacks; however, we haven’t seen the original vector of how it spreads. We have some\nsuspicions about possible use of the MS10-033 vulnerability, but we cannot confirm this now.\n\nOnce a system is infected, Flame begins a complex set of operations, including sniffing the\nnetwork traffic, taking screenshots, recording audio conversations, intercepting the keyboard,\nand so on. All this data is available to the operators through the link to Flame’s commandand-control servers.\n\nLater, the operators can choose to upload further modules, which expand Flame’s\nfunctionality. There are about 20 modules in total and the purpose of most of them is still\nbeing investigated.\n\n**How sophisticated is Flame?**\n\nFirst of all, Flame is a huge package of modules comprising almost 20 MB in size when fully\ndeployed. Because of this, it is an extremely difficult piece of malware to analyze. The\nreason why Flame is so big is because it includes many different libraries, such as for\ncompression (zlib, libbz2, ppmd) and database manipulation (sqlite3), together with a Lua\nvirtual machine.\n\n[Lua is a scripting (programming) language, which can very easily be extended and interfaced](http://en.wikipedia.org/wiki/Lua_(programming_language)\nwith C code. Many parts of Flame have high order logic written in Lua – with effective attack\nsubroutines and libraries compiled from C++.\n\nThe effective Lua code part is rather small compared to the overall code. Our estimation of\ndevelopment ‘cost’ in Lua is over 3000 lines of code, which for an average developer should\ntake about a month to create and debug.\n\n\n-----\n\nAlso, there are internally used local databases with nested SQL queries, multiple methods of\nencryption, various compression algorithms, usage of Windows Management\nInstrumentation scripting, batch scripting and more.\n\nRunning and debugging the malware is also not trivial as it’s not a conventional executable\napplication, but several DLL files that are loaded on system boot.\n\nOverall, we can say Flame is one of the most complex threats ever discovered.\n\n**How is this different to or more sophisticated than any other backdoor Trojan? Does it**\n**do specific things that are new?**\n\nFirst of all, usage of Lua in malware is uncommon. The same goes for the rather large size of\nthis attack toolkit. Generally, modern malware is small and written in really compact\nprogramming languages, which make it easy to hide. The practice of concealment through\nlarge amounts of code is one of the specific new features in Flame.\n\nThe recording of audio data from the internal microphone is also rather new. Of course, other\nmalware exists which can record audio, but key here is Flame’s completeness – the ability to\nsteal data in so many different ways.\n\n\n-----\n\nAnother curious feature of Flame is its use of Bluetooth devices. When Bluetooth is available\nand the corresponding option is turned on in the configuration block, it collects information\nabout discoverable devices near the infected machine. Depending on the configuration, it\ncan also turn the infected machine into a beacon, and make it discoverable via Bluetooth and\nprovide general information about the malware status encoded in the device information.\n\n**What are the notable info-stealing features of Flame?**\n\nAlthough we are still analyzing the different modules, Flame appears to be able to record\naudio via the microphone, if one is present. It stores recorded audio in compressed format,\nwhich it does through the use of a public-source library.\n\nRecorded data is sent to the C&C through a covert SSL channel, on a regular schedule. We\nare still analyzing this; more information will be available on our website soon.\n\nThe malware has the ability to regularly take screenshots; what’s more, it takes screenshots\nwhen certain “interesting” applications are run, for instance, IM’s. Screenshots are stored in\ncompressed format and are regularly sent to the C&C server – just like the audio recordings.\n\nWe are still analyzing this component and will post more information when it becomes\navailable.\n\n**When was Flame created?**\n\nThe creators of Flame specially changed the dates of creation of the files in order that any\ninvestigators couldn’t establish the truth re time of creation. The files are dated 1992, 1994,\n1995 and so on, but it’s clear that these are false dates.\n\nWe consider that in the main the Flame project was created no earlier than in 2010, but is\nstill undergoing active development to date. Its creators are constantly introducing changes\ninto different modules, while continuing to use the same architecture and file names. A\nnumber of modules were either created of changed in 2011 and 2012.\n\nAccording to our own data, we see use of Flame in August 2010. What’s more, based on\ncollateral data, we can be sure that Flame was out in the wild as early as in February to\nMarch 2010. It’s possible that before then there existed earlier version, but we don’t have\ndata to confirm this; however, the likelihood is extremely high.\n\n**Why is it called Flame? What is the origin of its name?**\n\nThe Flame malware is a large attack toolkit made up of multiple modules. One of the main\nmodules was named Flame – it’s the module responsible for attacking and infecting\nadditional machines.\n\n\n-----\n\n**Is this a nation-state sponsored attack or is it being carried out by another group such**\n**as cyber criminals or hacktivisits?**\n\nCurrently there are three known classes of players who develop malware and spyware:\nhacktivists, cybercriminals and nation states. Flame is not designed to steal money from\nbank accounts. It is also different from rather simple hack tools and malware used by the\nhacktivists. So by excluding cybercriminals and hacktivists, we come to conclusion that it\nmost likely belongs to the third group. In addition, the geography of the targets (certain states\nare in the Middle East) and also the complexity of the threat leaves no doubt about it being a\nnation state that sponsored the research that went into it.\n\n**Who is responsible?**\n\nThere is no information in the code or otherwise that can tie Flame to any specific nation\nstate. So, just like with Stuxnet and Duqu, its authors remain unknown.\n\n**Why are they doing it?**\n\nTo systematically collect information on the operations of certain nation states in the Middle\nEast, including Iran, Lebanon, Syria, Israel and so on. Here’s a map of the top 7 affected\ncountries:\n\n\n-----\n\n**Is Flame targeted at specific organizations, with the goal of collecting specific**\n**information that could be used for future attacks? What type of data and information**\n**are the attackers looking for?**\n\nFrom the initial analysis, it looks like the creators of Flame are simply looking for any kind of\nintelligence – e-mails, documents, messages, discussions inside sensitive locations, pretty\nmuch everything. We have not seen any specific signs indicating a particular target such as\nthe energy industry – making us believe it’s a complete attack toolkit designed for general\ncyber-espionage purposes.\n\nOf course, like we have seen in the past, such highly flexible malware can be used to deploy\nspecific attack modules, which can target SCADA devices, ICS, critical infrastructure and so\non.\n\n**What industries or organizations is Flame targeting? Are they industrial control**\n**facilities/PLC/SCADA? Who are the targets and how many?**\n\nThere doesn’t seem to be any visible pattern re the kind of organizations targeted by Flame.\nVictims range from individuals to certain state-related organizations or educational\ninstitutions. Of course, collecting information on the victims is difficult because of strict\npersonal data collecting policies designed to protect the identity of our users.\n\n**Based on your analysis, is this just one variation of Flame and there are others?**\n\n\n-----\n\nBased on the intelligence received from the Kaspersky Security Network, we are seeing\nmultiple versions of the malware being in the wild – with different sizes and content. Of\ncourse, assuming the malware has been in development for a couple of years, it is expected\nthat many different versions will be seen in the wild.\n\nAdditionally, Flame consists of many different plug-ins – up to 20 – which have different\nspecific roles. A specific infection with Flame might have a set of seven plugins, while\nanother infection might have 15. It all depends on the kind of information that is sought from\nthe victim, and how long the system was infected with Flame.\n\n**Is the main C&C server still active? Is there more than one primary C&C server? What**\n**happens when an infected machine contacts the C&C server?**\n\nSeveral C&C servers exist, scattered around the world. We have counted about a dozen\ndifferent C&C domains, run on several different servers. There could also be other related\ndomains, which could possibly bring the total to around 80 different domains being used by\nthe malware to contact the C&C. Because of this, it is really difficult to track usage of\ndeployment of C&C servers.\n\n**Was this made by the Duqu/Stuxnet group? Does it share similar source code or have**\n**other things in common?**\n\nIn size, Flame is about 20 times larger than Stuxnet, comprising many different attack and\ncyber-espionage features. Flame has no major similarities with Stuxnet/Duqu.\n\n**For instance, when Duqu was discovered, it was evident to any competent researcher**\n**that it was created by the same people who created Stuxnet on the “Tilded” platform.**\n\nFlame appears to be a project that ran in parallel with Stuxnet/Duqu, not using the Tilded\nplatform. There are however some links which could indicate that the creators of Flame had\naccess to technology used in the Stuxnet project – such as use of the “autorun.inf” infection\nmethod, together with exploitation of the same print spooler vulnerability used by Stuxnet,\nindicating that perhaps the authors of Flame had access to the same exploits as Stuxnet’s\nauthors.\n\nOn the other hand, we can’t exclude that the current variants of Flame were developed after\nthe discovery of Stuxnet. It’s possible that the authors of Flame used public information\nabout the distribution methods of Stuxnet and put it to work in Flame.\n\nIn summary, Flame and Stuxnet/Duqu were probably developed by two separate groups. We\nwould position Flame as a project running parallel to Stuxnet and Duqu.\n\n**You say this was active since March 2010. That is close to the time when Stuxnet was**\n**discovered. Was this being used in tandem with Stuxnet? It is interesting they both**\n**exploit the printer-spooler vulnerability.**\n\n\n-----\n\nOne of the best pieces of advice in any kind of operation is not to put all your eggs in one\nbasket. Knowing that sooner or later Stuxnet and Duqu would be discovered, it would make\nsense to produce other similar projects – but based on a completely different philosophy.\nThis way, if one of the research projects is discovered, the other one can continue\nunhindered.\n\nHence, we believe Flame to be a parallel project, created as a fallback in case some other\nproject is discovered.\n\n**In your analysis of Duqu you mentioned “cousins” of Duqu, or other forms of malware**\n**that could exist. Is this one of them?**\n\nDefinitely not. The “cousins” of Duqu were based on the Tilded platform, also used for\nStuxnet. Flame does not use the Tilded platform.\n\n**This sounds like an info-stealing tool, similar to Duqu. Do you see this as part of an**\n**intelligence-gathering operation to make a bigger cyber-sabotage weapon, similar to**\n**Stuxnet?**\n\nThe intelligence gathering operation behind Duqu was rather small-scale and focused. We\nbelieve there were less than 50 targets worldwide for Duqu – all of them, super-high profile.\n\nFlame appears to be much, much more widespread than Duqu, with probably thousands of\nvictims worldwide.\n\nThe targets are also of a much wider scope, including academia, private companies, specific\nindividuals and so on.\n\nAccording to our observations, the operators of Flame artificially support the quantity of\ninfected systems on a certain constant level. This can be compared with a sequential\nprocessing of fields – they infect several dozen, then conduct analysis of the data of the\nvictim, uninstall Flame from the systems that aren’t interesting, leaving the most important\nones in place. After which they start a new series of infections.\n\n**What is Wiper and does it have any relation to Flame? How is it destructive and was it**\n**located in the same countries?**\n\nThe Wiper malware, which was reported on by several media outlets, remains unknown.\nWhile Flame was discovered during the investigation of a number of Wiper attacks, there is\nno information currently that ties Flame to the Wiper attacks. Of course, given the complexity\nof Flame, a data wiping plugin could easily be deployed at any time; however, we haven’t\nseen any evidence of this so far.\n\n\n-----\n\nAdditionally, systems which have been affected by the Wiper malware are completely\nunrecoverable – the extent of damage is so high that absolutely nothing remains that can be\nused to trace the attack.\n\nThere is information about Wiper incidents only in Iran. Flame was found by us in different\ncountries of the region, not only Iran.\n\n## Functionality/Feature Questions about the Flame Malware\n\n**What are the ways it infects computers? USB Sticks? Was it exploiting vulnerabilities**\n**other than the print-spooler to bypass detection? Any 0-Days?**\n\nFlame appears to have two modules designed for infecting USB sticks, called “Autorun\nInfector” and “Euphoria”. We haven’t seen them in action yet, maybe due to the fact that\nFlame appears to be disabled in the configuration data. Nevertheless, the ability to infect\nUSB sticks exists in the code, and it’s using two methods:\n\n1. Autorun Infector: the “Autorun.inf” method from early Stuxnet, using the “shell32.dll”\n\n“trick”. What’s key here is that the specific method was used only in Stuxnet and was\nnot found in any other malware since.\n2. Euphoria: spread on media using a “junction point” directory that contains malware\n\nmodules and an LNK file that trigger the infection when this directory is opened. Our\nsamples contained the names of the files but did not contain the LNK itself.\n\nIn addition to these, Flame has the ability to replicate through local networks. It does so\nusing the following:\n\n1. The printer vulnerability MS10-061 exploited by Stuxnet – using a special MOF file,\n\nexecuted on the attacked system using WMI.\n2. Remote jobs tasks.\n3. When Flame is executed by a user who has administrative rights to the domain\n\ncontroller, it is also able to attack other machines in the network: it creates backdoor\nuser accounts with a pre-defined password that is then used to copy itself to these\nmachines.\n\n\n-----\n\nAt the moment, we haven’t seen use of any 0-days; however, the worm is known to have\ninfected fully-patched Windows 7 systems through the network, which might indicate the\npresence of a high risk 0-day.\n\n**Can it self-replicate like Stuxnet, or is it done in a more controlled form of spreading,**\n**similar to Duqu?**\n\nThe replication part appears to be operator commanded, like Duqu, and also controlled with\nthe bot configuration file. Most infection routines have counters of executed attacks and are\nlimited to a specific number of allowed attacks.\n\nWhy is the program several MBs of code? What functionality does it have that could make it\nso much larger than Stuxnet? How come it wasn’t detected if it was that big?\n\n\n-----\n\nThe large size of the malware is precisely why it wasn t discovered for so long. In general,\ntoday’s malware is small and focused. It’s easier to hide a small file than a larger module.\nAdditionally, over unreliable networks, downloading 100K has a much higher chance of being\nsuccessful than downloading 6MB.\n\nFlame’s modules together account for over 20MB. Much of these are libraries designed to\nhandle SSL traffic, SSH connections, sniffing, attack, interception of communications and so\non. Consider this: it took us several months to analyze the 500K code of Stuxnet. It will\nprobably take year to fully understand the 20MB of code of Flame.\n\n**Does Flame have a built-in Time-of-Death like Duqu or Stuxnet ?**\n\nThere are many different timers built-in into Flame. They monitor the success of connections\nto the C&C, the frequency of certain data stealing operations, the number of successful\nattacks and so on. Although there is no suicide timer in the malware, the controllers have the\nability to send a specific malware removal module (named “browse32”), which completely\nuninstalls the malware from a system, removing every single trace of its presence.\n\n**What about JPEGs or screen-shots? Is it stealing those too?**\n\nThe malware has the ability to regularly take screenshots. What’s more, it takes screenshots\nwhen certain “interesting” applications are run, for instance, IM’s. Screenshots are stored in\ncompressed format and are regularly sent to the C&C server, just like the audio recordings.\n\nWe are still analyzing this component and will post more information when it becomes\navailable.\n\nWe will share a full list of the files and traces for technical people in a series of blog posts on\nSecurelist during the next weeks.\n\nWhat should I do if I find an infection and am willing to contribute to your research by\nproviding malware samples?\n\nWe would greatly appreciate it if you could contact us by e-mail at the previously created\n[mailbox for Stuxnet/Duqu research: stopduqu@kaspersky.com.](http://10.10.0.46/mailto:stopduqu@kaspersky.com)\n\n**Update 1 (28-May-2012):**\n\nAccording to our analysis, the Flame malware is the same as “SkyWiper”, described by the\n[CrySyS Lab and by Iran Maher CERT group where it is called “Flamer”.](http://www.certcc.ir/index.php?name=news&file=article&sid=1894)\n\n[Backdoor](https://securelist.com/tag/backdoor/)\n[Cyber espionage](https://securelist.com/tag/cyber-espionage/)\n[Cyber weapon](https://securelist.com/tag/cyber-weapon/)\n[Flame](https://securelist.com/tag/flame/)\n[Targeted attacks](https://securelist.com/tag/targeted-attacks/)\n\n\n-----\n\n[Trojan](https://securelist.com/tag/trojan/)\n[Wiper](https://securelist.com/tag/wiper/)\n\nAuthors\n\n[Alexander Gostev](https://securelist.com/author/alexander/)\n\nThe Flame: Questions and Answers\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2012/2012-05-28 - The Flame- Questions and Answers.pdf"
    ],
    "report_names": [
        "2012-05-28 - The Flame- Questions and Answers.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535822,
    "ts_updated_at": 1743041120,
    "ts_creation_date": 1653703100,
    "ts_modification_date": 1653703100,
    "files": {
        "pdf": "https://archive.orkl.eu/529823ecbe46d4ed75c5f0067cb0e0573bb97d4e.pdf",
        "text": "https://archive.orkl.eu/529823ecbe46d4ed75c5f0067cb0e0573bb97d4e.txt",
        "img": "https://archive.orkl.eu/529823ecbe46d4ed75c5f0067cb0e0573bb97d4e.jpg"
    }
}