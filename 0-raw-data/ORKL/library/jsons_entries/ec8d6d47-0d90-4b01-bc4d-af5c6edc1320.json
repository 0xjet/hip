{
    "id": "ec8d6d47-0d90-4b01-bc4d-af5c6edc1320",
    "created_at": "2022-10-25T16:48:10.52552Z",
    "updated_at": "2025-03-27T02:06:01.683291Z",
    "deleted_at": null,
    "sha1_hash": "dd9277ba1bc41ca19594d15bf9e359e01a07388b",
    "title": "",
    "authors": "",
    "file_creation_date": "0001-01-01T00:00:00Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 6463619,
    "plain_text": "# POCKET-SIZED\n\n\n# BADNESS\n##### Why Ransomware Comes as a Plot Twist\n in the Cat-Mouse Game\n\n\n###### Federico 'phretor' Maggi\n Stefano 'raistlin' Zanero\n\n\n-----\n\n##### $ whoami\n\n\n\n###### ● Forward-Looking Threat (FTR) researcher @ Trend Micro\n\n ○ Research on upcoming/future threats and risks\n ○ Cybercrime investigation\n ● Interested in too many things\n ● Formerly Assistant Professor @ POLIMI\n\n ○ ~50 papers published\n ○ ~25 invited talks & lectures\n ○ ~100 students supervised\n ● PC/board member of various conferences/workshops\n\n\n\n###### ○ ACSAC (first week of December, Hollywood)\n ○ AsiaCCS\n ○ DIMVA\n ○ OWASP AppSecEU E S\n\n\n-----\n\n##### AGENDA\n\n\n\n###### ● Quick retrospective on ransomware\n\n ● The humble beginning of mobile ransomware\n\n ● Case studies of mobile ransomware\n\n ● Typical technical features of mobile ransomware\n\n ○ And how to automatically detect them\n\n ● Tool!\n\n ○ How it works\n\n ■ Does it work?\n\n ○ How to get it!\n\n ● Conclusions: An economics perspective on ransomware\n\n\n-----\n\n### FROM CRYPTOVIROLOGY TO MOBILE RANSOMWARE\n\n\n-----\n\n-----\n\n-----\n\n##### 1996 → 2012\n\n\n###### ?!@#$ ?\n\n\n###### - 50+ distinct families (190+ if we count the variants) - state of the art encryption\n\n\n-----\n\n### THE \"LITTLE\" WORLD OF MOBILE RANSOMWARE\n\n\n-----\n\n##### MOBILE TARGETS\n\n\n###### 15x increase (Apr '15–Apr '16)\n\n 10–25% of all malware\n in certain areas (e.g., Australia, Singapore)\n\n\n###### 2014 2015 2016\n\n|DirtyDecrypt CryptoDefense Filecoder CBTLocker TorrentLocker CoinVault|Col2|\n|---|---|\n\n\n###### Simplocker (May '14) Koler (May '14) TkLocker (Jun '14) Pletora (Jun '14) Svpeng/Scarepackage (Jun-Oct '14)\n\n|2015|2016|2016|Col4|Col5|\n|---|---|---|---|---|\n|Cryptvault DMALock Tox|Jigsaw Radamant Hydracrypt Cerber Fusob (Jan'15- Small (Mid '14- Lockscreen (Se|Jigsaw Radama Hydracr Cerbe|nt ypt r||\n|||Fusob (Jan'15- Small (Mid '14- Lockscreen (Se||Apr' 16) Apr' 16) p '16)|\n\n\n###### New Simplocker (Jan '15) New PornDroid (May' 15)\n\n\n-----\n\n### CASE STUDIES OF MOBILE RANSOMWARE\n\n\n-----\n\n##### SLocker (a.k.a. Simplocker, or Simple Locker)\n\n\n**DEVICE**\n**LOCKING**\n\n\n-----\n\n**DEVICE**\n##### SCREEN LOCKING: BASIC TECHNIQUE\n**LOCKING**\n\n\n-----\n\n##### Koler: POLICE-THEMED RANSOMWARE\n\n\n**THREATENING**\n\n**TEXT**\n\n\n-----\n\n-----\n\n**THREATENING**\n\n**TEXT**\n\n\n-----\n\n##### Svpeng: Real encryption\n\n\n**DATA**\n**ENCRYPTION**\n\n\n\n###### ● A good summary of all mobile ransomware techniques\n\n\n-----\n\n**DATA**\n**ENCRYPTION**\n\n\n-----\n\n**ADMIN API**\n##### Device Admin API Abuse (in the manifest)\n\n**ABUSE**\n\n\n-----\n\n##### Lockdroid.E & Google's Prompt Patch in Nougat\n\n\n**ADMIN API**\n\n**ABUSE**\n\n\n\n###### ● Newest family: Sep 2016\n ● Uses\n\n ○ resetPassword(pseudo-random passcode)\n ○ lockNow()\n ● In Nougat, resetPassword() is \"one use\"\n\n ○ If password is set already\n\n ■ resetPassword() can't be called\n ● No backward compatibility\n ● No (benign) apps can automatically change/reset the password\n\n ○ User interaction will always be required\n\n\n-----\n\n#### DETECTION TECHNIQUES\n\n\n-----\n\n##### Analysis & Detection Approach\n\n\n-----\n\n###### THREATENING\n TEXT\n\n\n**DEVICE** **DATA**\n**LOCKING** **ENCRYPTION**\n\n\n**ADMIN API**\n\n**ABUSE**\n\n\n-----\n\n##### Threatening Text: Details\n\n\n**THREATENING**\n\n**TEXT**\n\n\n\n###### ● must be clear, understandable and\n convincing\n\n ● coercion techniques\n\n ○ refer to law codes\n ○ various accusations\n\n ■ copyright violation\n ■ illegal content found\n ■ prohibited sites visited\n\n ● detailed payment instructions\n\n\n-----\n\n##### Threatening Text: Payment Instructions THREATENING\n\n\n**THREATENING**\n\n**TEXT**\n\n\n-----\n\n##### → NLP + ML pipeline\n\n\n**THREATENING**\n\n**TEXT**\n\n|C&C|Col2|Col3|\n|---|---|---|\n||||\n\n\n-----\n\n##### Natural Language Processing Pipeline → ML\n\n\n**THREATENING**\n\n**TEXT**\n\n\n###### 1. Language detection\n\n ○ frequency-based analysis (e.g., English, French) 2. Segmentation = Split into sentences\n\n\n\n###### ○ \"This device has been locked for safety reasons\"\n ○ \"All actions performed are fixed\" 3. Stop-words removal\n\n ○ \"This device has been locked for safety reasons\"\n ○ \"All actions performed are fixed\" 4. Stemming\n\n ○ \"device locked safety reasons\"\n ○ \"actions performed fixed\" 5. Stem vector\n\n\n###### 1 0 0 1 1 0 0 1 0 1 0 1 1 0 0 0 ...\n\n\n-----\n\n##### Machine Learning Classification: Training Set THREATENING\n\n**TEXT**\n\n\n###### T\n\n\n-----\n\n##### Training Set Labelling THREATENING\n\n**TEXT**\n\n\n###### T law\n\n\n-----\n\n##### Scoring new text: x = {c, c, ..., c } THREATENING\n\n###### 1 2 n\n\n\n###### T law\n\n\n-----\n\n##### Scoring and Decision THREATENING\n**TEXT**\n\n\n###### decision thresholds: minimum to detect known ransomware\n\n if (best score in \"money\")\n\n likely ransomware\n\n if (best score in \"accusation\" or \"law\" & ~\"money\")\n\n likely scareware\n\n\n-----\n\n**DATA**\n###### DEVICE ENCRYPTION LOCKING\n\n\n**ADMIN API**\n\n**ABUSE**\n\n\n-----\n\n**DEVICE**\n##### Device Locking\n**LOCKING**\n\n\n\n###### ○ Upcoming fix in Android N (yay!)\n\n\n-----\n\n##### Hijack onKeyUp()/onKeyDown()\n\n\n**DEVICE**\n**LOCKING**\n\n\n\n###### ● Search code for all android.app.Activity (subclasses)\n\n ○ that declare onKeyUp/onKeyDown\n ● Custom Smali simulator\n\n ○ \"Execute\" all statements\n ○ Within the scope of onKeyUp/onKeyDown methods\n ○ Follow function calls\n\n\n-----\n\n**DEVICE**\n**LOCKING**\n\n###### (subclasses)\n\n\n-----\n\n**THREATENING** **DEVICE** **DATA**\n\n**TEXT** **LOCKING** **ENCRYPTION** **ADMIN API**\n\n\n###### ABUSE\n\n\n-----\n\n**ADMIN API**\n##### Device Admin API Abuse\n\n|Device Admin API Abuse|Col2|ADMIN API|\n|---|---|---|\n|||ABUSE|\n||||\n\n\n-----\n\n**ADMIN API**\n##### Looking at the Code\n\n**ABUSE**\n\n\n-----\n\n##### Manifest → Receiver → CFG → Reachability\n\n\n**ADMIN API**\n\n**ABUSE**\n\n\n\n###### ● Start from the Receiver found in the manifest\n ● Obtain app's CFG (via FlowDroid)\n\n ○ soot.jimple.infoflow.cfg.SharedCfg.waitForCfg()\n ● Calculate all entry points (via FlowDroid)\n ● Visit CFG breadth first to find calls to lockNow() & friends\n\n ● If nothing is found, \"resolve\" reflective calls\n\n ○ ...at least, we try to…\n\n ○ We \"connect\" CFG nodes by materializing calls to\n\n java.lang.reflect.Method.invoke(method)\n\n\n-----\n\n##### Dealing with Obfuscated Method Names\n\n\n**ADMIN API**\n\n**ABUSE**\n\n\n###### \"koOpqUTbcVRhwomXlASpvutejuWHJnQxxaoinoermf\"\n\n\n-----\n\n##### How do we Deal With This?\n\n|Col1|5: find decl. 6: reflection 4 2: find method 3 1: find call|\n|---|---|\n\n\n###### 5: find decl. 6: reflection\n\n 4\n\n\n-----\n\n**THREATENING** **DEVICE**\n\n**TEXT** **LOCKING**\n\n\n###### DATA ENCRYPTION\n\n\n-----\n\n**DATA**\n\n##### Recap: Encryption\n\n**ENCRYPTION**\n\n###### ● Sources:\n\n ○ java.io.File: listFiles() or list()\n ○ java.lang.Runtime: exec()\n ● Sinks:\n\n\n###### Ah f UI d!\n\n\n-----\n\n**DATA**\n##### Find Static Encryption Flows → FlowDroid\n**ENCRYPTION**\n\n\n###### file pointer → byte[] byte[] → cipher's update\n\n Not propagated by default, but very efficient to do\n\n\n-----\n\n##### Great! We Have a Pipeline!\n\n\n-----\n\n##### But it Takes Time\n\n\n-----\n\n##### 12 secs. vs. manual RE is OK. But...\n\n\n-----\n\n##### Machine Learning Classification Approach\n\n\n\n###### ○ J48 decision tree\n ○ Random forest\n ○ Decision table\n\n\n-----\n\n##### Features\n\n\n\n###### ● Lot's of research on that\n ● We borrow some features, not the way to use them\n\n ○ Permissions (boolean)\n\n ■ yes/no array of requested Android permissions\n ○ File Statistics (numeric, novel)\n\n ■ File size\n ■ Number of permissions\n ■ Number of services, activities, receivers, avg. class size, number of packages\n ○ Lightweight behavioral features (boolean, novel)\n\n ■ Send SMS or reads phone info onStartup()\n ■ Calls native utils (e.g., ls, grep, root, chmod)\n ■ ...\n ○ Other features (boolean, novel)\n\n\n\n###### ■ is package name composed by a single part?\n ■ does the reversed package name match a real domain name?\n\n\n-----\n\n##### Fast and Precise! ~12 secs → ~1.25 secs\n\n\n-----\n\n-----\n\n## EXPERIMENTS\n\n\n-----\n\n##### Datasets\n\n\n###### Ransomware daily feed ~38,425 (and counting)\n\n\n-----\n\n##### Results\n\n\n\n###### ● False positives (~0.07%)\n\n ○ Corner case: large portions of law- or copyright-related text (EULA)\n ○ 6 benign apps used to extensively modify the UI\n ○ 1 adware app\n\n ● Detection rate (~99%)\n\n ○ 49 samples turned out to be mislabeled\n ○ 4 were actually ransomware, but somewhat disarmed/not working\n ○ 11 language unsupported (Spanish, Russian)\n\n ■ Extended the language classifier right away (30 minutes manual work)\n ○ All the rest was correctly classified\n\n\n-----\n\n## WAIT WAIT… THE TOOL, THE TOOL!\n\n\n-----\n\n##### HelDroid: Source Code Release!\n\n\n-----\n\n###### http://ransom.mobi/scans/\n\n\n-----\n\n-----\n\n-----\n\n-----\n\n-----\n\n##### FROM A SURVEY (run by Trend Micro in UK)\n\n\n###### Before infection Upon infection Recovery\n\n\n-----\n\n##### FROM A SURVEY (run by Trend Micro in UK)\n\n\n###### Before infection Upon infection Recovery\n\n\n###### ~74%\n\n won't\n pay\n\n\n-----\n\n##### FROM A SURVEY (run by Trend Micro in UK)\n\n\n###### Before infection Upon infection Recovery\n\n\n###### ~74%\n\n won't\n pay\n\n\n###### ~65%\n\n paid\n\n\n-----\n\n##### FROM A SURVEY (run by Trend Micro in UK)\n\n\n###### Before infection Upon infection Recovery\n\n\n###### ~74%\n\n won't\n pay\n\n\n###### ~65%\n\n paid\n\n\n###### ~35% no data\n\n\n-----\n\n##### WHY RANSOMWARE IS DIFFERENT\n\n\n-----\n\n##### MORE SURRENDERS → MORE PAYMENTS\n\n\n-----\n\n##### VICIOUS CIRCLE AMPLIFIERS: INSURANCES\n\n\n##### AMPLIFIERS: INSURANCES\n\n###### \"[...] we’ll reimburse [...] up to $1000 per endpoint, or $1,000,000 in protection overall for the company. Guaranteed.\"\n\n Thanks! The crooks are super happy now! All they need to do is target all customers of this vendor, and get to\n ~1000 endpoints, asking $1,000,000 overall\n\n\n-----\n\n##### VICIOUS CIRCLE AMPLIFIERS: INSURANCES\n\n\n###### \"It’s time for security companies to back their technology and provide users with the financial assurance they deserve against ransomware attacks.\"\n\n No seriously? Think for a minute about the global, long-term effect of this idea...\n\n\n-----\n\n## THANK YOU\n###### Why Ransomware Comes as a Plot Twist\n\n\n###### in the Cat-Mouse Game\n\n\n###### Federico 'phretor' Maggi\n ~ @phretor - http://maggi.cc\n\n && Stefano 'raistlin' Zanero\n Nicolò Andronio Nicola della Rocca\n Chengyu Zheng\n\n\n-----\n\n### EXTRA SLIDES\n\n\n-----\n\n-----\n\n###### (source)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://www.blackhat.com/docs/eu-16/materials/eu-16-Maggi-Pocket-Sized-Badness-Why-Ransomware-Comes-As-A-Plot-Twist-In-The-Cat-Mouse-Game.pdf"
    ],
    "report_names": [
        "eu-16-Maggi-Pocket-Sized-Badness-Why-Ransomware-Comes-As-A-Plot-Twist-In-The-Cat-Mouse-Game.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716490,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 0,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/dd9277ba1bc41ca19594d15bf9e359e01a07388b.pdf",
        "text": "https://archive.orkl.eu/dd9277ba1bc41ca19594d15bf9e359e01a07388b.txt",
        "img": "https://archive.orkl.eu/dd9277ba1bc41ca19594d15bf9e359e01a07388b.jpg"
    }
}