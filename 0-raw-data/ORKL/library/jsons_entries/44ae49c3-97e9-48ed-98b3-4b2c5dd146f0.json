{
    "id": "44ae49c3-97e9-48ed-98b3-4b2c5dd146f0",
    "created_at": "2023-01-12T15:08:37.410939Z",
    "updated_at": "2025-03-27T02:13:57.102863Z",
    "deleted_at": null,
    "sha1_hash": "a9a299f44df201ebd3b7156731926f5b4ff4901a",
    "title": "2021-01-18 - Docx Files Template-Injection",
    "authors": "",
    "file_creation_date": "2022-05-27T19:11:17Z",
    "file_modification_date": "2022-05-27T19:11:17Z",
    "file_size": 2451058,
    "plain_text": "# Gamaredon: Docx Template-Injection\n\n**[aaqeel01.wordpress.com/2021/01/18/docx-files-template-injection/](https://aaqeel01.wordpress.com/2021/01/18/docx-files-template-injection/)**\n\nAli Aqeel January 18, 2021\n\n[New APT malware samples have been found by Shadow Chaser Group researchers](https://twitter.com/ShadowChasing1)\nrecently, that points to the same attacker group [Gamaredon. Two different samples in](https://attack.mitre.org/groups/G0047/)\nseparate incidents are being analyzed and presented in this post to show the techniques\nused by the attacker. Also there are interesting findings that have been extracted during\ndynamic analysis and not been found by sandbox engines. Will focus on the extracted\ninformation and techniques and skip the match results.\n\n**Sample One: Downloader**\n\n\n-----\n\n-1- Tweet of sample 1\n_Host-Based IOCs_\n\n**File Name** **MD5 hash**\n\n\nFigure\n\n**File**\n**Size**\n\n\nМои данные.docx fbc037e68f5988df9190cdadf7424752 24.56\nKB\n\ndCiBlGD.dot 7467DBBB6DBEA83256B13FB151A594EF 73\nbytes\n\nindex.dat C6DBAAA421E7CC2A51564EC14EE98372 244\nbytes\n\n\n-----\n\n**File Name** **MD5 hash**\n\n\n**File**\n**Size**\n\n\nsell on office360-expert.online E382A34494F25B9F31F8A3745135970E 62\nbytes\n\nTCD18CC.tmp\\CleanGradient.thmx E9294DCC4C80544EFDDD8BCA7F1FFBE6 57.7\nKB\n\nTable -1- Sample one Files basic properties\nThis malware is a Docx file with (50 4B 03 04) signature that has an embedded xml when\nextracted (word\\_rels\\settings.xml.rels) (Figure -2-), it has a URL, which by the time writing\n_this post the link is still active (Figure -3-)_ [[2]](https://app.any.run/tasks/17575220-f087-4baa-bc96-3d9bdb0f10ed/)\n\nFigure -2- XML file with Suspicious URL\n\nFigure -3- Active links\n\n_Netword-Based IOC_\n\n**URL** **IP** **Port**\n\nhxxp://office360-expert[.]online/sell/dCiBlGD[.]dot 195.161.114.130 80\n\nTable -2- Sample One Connections\nUnlike other malware techniques used in similar procedures, when first running this Docx file\nit’s already too late. As an attack vector, it doesn’t require the victim to Enable Macro in order\nto serve its malicious purpose.\n\n\n-----\n\nFigure -4- Running the document\n\nSince it’s a downloader it only makes sense to find out what is next when running this\nmalware live and infect the computer. Four files been extracted as in (Table -1-) in:\n(C:\\.\\.\\AppData\\Roaming\\Microsoft\\Office\\Recent), and\n(C:\\.\\.\\AppData\\Local\\Temp\\TCD18CC.tmp\\),\n\nThere’re dozens of other xx.TMP directories but been created and deleted during the\nprocess. The DOT file dCiBlGD is nothing but a shortcut linked to the URL shortcut (sell on\n_office360-expert.online) which links to the same URL. The current files are almost useless_\nand there doesn’t appear to be a use for template file or any other files in that matter.\nHowever, presenting in the following section of this post another sample belongs to the same\nattacker group which has the use of dot file as a second stage dropper, but more on that in a\nlittle bit.\n\nThere’s persistent mechanism that might lead to download another files like dot file, or\n[maybe other evasion techniques. What’s missing from VirusTotal behavior [3] is the registry](https://www.virustotal.com/gui/file/499caf4558ca05440875a94d5e06663cc637f9c6acdaa7c1a89f889a025837f3/behavior)\nbelow ‘At least by the time writing this post’. The sample been tested with both MS word\n2010 and 2016.\n\n_HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\16.0\\Common\\Internet\\Server_\n_Cache\\http://office360-expert.online/sell/_\n\n\n-----\n\nFigure -5- RegValue: Office 2010\n\nFigure -6- RegValue: Office 2016\n\nBy the time of live analyzing this sample there’s no threat presented yet! However, as a first\nstage downloader, the attacker successfully made it to place foothold via temp files like dot\nor (Docs Template) which remains in the temp directory unnoticed, and also set the registry\nvalues linking to the suspicious URL.\n\n**Sample Two: Dropper**\n\n\n-----\n\nFigure\n\n-7- Tweet of sample 2\n[In what appears to be an older found sample discovered by the same researchers [1] linked](https://twitter.com/ShadowChasing1)\nto the same attacker group [[4]. A dot file is been statically analyzed in this section, so there’s](https://attack.mitre.org/groups/G0047/)\na chance to take a glance at what a dot file might be used for and what evasion and\npersistent techniques the attacker’s using.\n\n_Host-Based IOCs_\n\n**File Name** **MD5 hash** **File Size**\n\nKzGdWvmSq.dot ddc38e9b53458ee58504a40fdc41df61 216.00 KB\n\nPrintDriver.exe d1ab72db2bedd2f255d35da3da0d4b16 138.50 KB\n\n\n-----\n\nTable -3- Sample two Files basic properties\nWhen the dot file KzGdWvmSq made it to victim machine it establishes connection with a C2\n[sever. And by the time analyzing this sample the C2 servers are not found [5].](https://app.any.run/tasks/26e685f3-9a76-45fa-ad70-dd61cb64812c/)\n\n**URL** **IP** **Port**\n\nhxxp://sufflari[.]online/increase[.]php 188.225.82.216 80\n\nhxxp://188.225.82.216/inspection[.]php 188.225.82.216 80\n\nhttp://sufflari%5B.%5Donline/increase%5B.%5Dphp 188.225.82.216 80\n\n[http://188.225.82.216/inspection%5B.%5Dphp](http://188.225.82.216/inspection%5B.%5Dphp) 188.225.82.216 80\n\n_Table -4- Sample Two Connections_\nThis malware sample is a wrapper and dropper to a PE executable (printdrive.exe) that runs\nas process in victim machine. However, this analysis focus more on the code and interesting\nindicators. Using either oledump.py or olevba.py tools in a Remnux machine is a good way\nto identify VBA streams and extract macros. On this sample it’s clear the macro been\ndetected at the 8th stream.\n\nFigure -8- Oledump streams detected\nThe extracted macro seems to be decoded and almost every line and function has been\nobfuscated. With the help of olevba.py summary table, detection of base64 encoding is\nhelpful.\n\n\n-----\n\nFigure -9- Olevba summary\n\nThe use of Document_Close function in this macro VBA is interesting. According to Microsoft\n[documentation [6] the event only happen after closing the open document.](https://docs.microsoft.com/en-us/office/vba/api/word.document.close(even))\n\n\n-----\n\nFigure -10\nDocument_Close Event\nEven after decoding the code, there’s still heavy usage of swap functions, but at least the\nimportant parts are in clear text as in below IOC snaps. After closing the document, the\nbelow lines are executed and (PirntDrive.exe) is up and running in the process.\n\nFigure -11- Host-Base IOCs\n\n\n-----\n\nFigure -12- Network-Based IOCs\n\nCouple of registry values been altered during runtime. however, the spotted hardcoded ones\n[are as below and more with the same sample/registry section [7] as persistent mechanism.](https://any.run/report/13b780800c94410b3d68060030b5ff62e9a320a71c02963603ae65abbf150d36/26e685f3-9a76-45fa-ad70-dd61cb64812c#registry)\n\n_HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\PrintSoftware_\n\n_HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\ & Application.Version &_\n__”\\Word\\Security\\_\n\nCompared to the rest of the dot file, the ‘Macros/VBA/ThisDocument‘ file is relatively small.\nJust in case to avoid missing any other hidden data back to Figure -8- above. Let’s try make\nuse of pcodedmp.py tool and extracting a possible hidden p-code. There aren’t any hidden,\njust the fact that the 5th stream ‘Data’ that appears to be the image file in the template\nembedded in this section. What get the attention in the also is this little overhead as referral\nto image content.\n\n\n-----\n\nFigure -13- Embedded Image file\n\n**Credits**\n\n[Shadow Chaser Group for discovering both samples](https://twitter.com/ShadowChasing1)\n\n**Update (27 Jan 2021)**\n\n[Contribution work from Nicko on](https://twitter.com/NinjaOperator) [Github](https://github.com/NinjaOperator/Indicators-with-some-juice/blob/main/Gamaredon)\n\n**References**\n\n[[1] Shadow Chaser Group, https://twitter.com/ShadowChasing1](https://twitter.com/ShadowChasing1)\n\n[2] AnyRun – Sample One, https://app.any.run/tasks/17575220-f087-4baa-bc963d9bdb0f10ed/\n\n[3] VirusTotal – Template Injection Malware Sample,\nhttps://www.virustotal.com/gui/file/499caf4558ca05440875a94d5e06663cc637f9c6acdaa7c1\na89f889a025837f3/behavior\n\n[[4] Gamaredon Group by Mitre Att&ck definition, https://attack.mitre.org/groups/G0047/](https://attack.mitre.org/groups/G0047/)\n\n[5] AnyRun – Sample Two, https://app.any.run/tasks/26e685f3-9a76-45fa-ad70dd61cb64812c/\n\n\n-----\n\n[6] Microsoft documentation, https://docs.microsoft.com/enus/office/vba/api/word.document.close(even)\n\n[7] AnyRun – Sample Two Registry Values,\nhttps://any.run/report/13b780800c94410b3d68060030b5ff62e9a320a71c02963603ae65abbf\n150d36/26e685f3-9a76-45fa-ad70-dd61cb64812c#registry\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-18 - Docx Files Template-Injection.pdf"
    ],
    "report_names": [
        "2021-01-18 - Docx Files Template-Injection.pdf"
    ],
    "threat_actors": [
        {
            "id": "81bd7107-6b2d-45c9-9eea-1843d4b9b308",
            "created_at": "2022-10-25T15:50:23.320841Z",
            "updated_at": "2025-03-27T02:00:55.441723Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Gamaredon Group",
                "IRON TILDEN",
                "Primitive Bear",
                "ACTINIUM",
                "Armageddon",
                "Shuckworm",
                "DEV-0157",
                "Aqua Blizzard"
            ],
            "source_name": "MITRE:Gamaredon Group",
            "tools": [
                "QuietSieve",
                "Pteranodon",
                "PowerPunch"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d5156b55-5d7d-4fb2-836f-861d2e868147",
            "created_at": "2023-01-06T13:46:38.557326Z",
            "updated_at": "2025-03-27T02:00:02.861124Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Aqua Blizzard",
                "Actinium",
                "DEV-0157",
                "Blue Otso",
                "G0047",
                "PRIMITIVE BEAR",
                "Shuckworm",
                "Trident Ursa",
                "UAC-0010",
                "Winterflounder",
                "ACTINIUM",
                "BlueAlpha",
                "IRON TILDEN"
            ],
            "source_name": "MISPGALAXY:Gamaredon Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "61940e18-8f90-4ecc-bc06-416c54bc60f9",
            "created_at": "2022-10-25T16:07:23.659529Z",
            "updated_at": "2025-03-27T02:02:09.912404Z",
            "deleted_at": null,
            "main_name": "Gamaredon Group",
            "aliases": [
                "Actinium",
                "Aqua Blizzard",
                "Armageddon",
                "Blue Otso",
                "BlueAlpha",
                "Callisto",
                "DEV-0157",
                "Iron Tilden",
                "Operation STEADY#URSA",
                "Primitive Bear",
                "SectorC08",
                "Shuckworm",
                "Trident Ursa",
                "UAC-0010",
                "Winterflounder"
            ],
            "source_name": "ETDA:Gamaredon Group",
            "tools": [
                "Aversome infector",
                "BoneSpy",
                "DessertDown",
                "DilongTrash",
                "DinoTrain",
                "EvilGnome",
                "FRAUDROP",
                "Gamaredon",
                "GammaDrop",
                "GammaLoad",
                "GammaSteel",
                "Gussdoor",
                "ObfuBerry",
                "ObfuMerry",
                "PlainGnome",
                "PowerPunch",
                "Pteranodon",
                "Pterodo",
                "QuietSieve",
                "Remote Manipulator System",
                "Resetter",
                "RuRAT",
                "SUBTLE-PAWS",
                "UltraVNC"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "236a8303-bf12-4787-b6d0-549b44271a19",
            "created_at": "2024-06-04T02:03:07.966137Z",
            "updated_at": "2025-03-27T02:05:17.410356Z",
            "deleted_at": null,
            "main_name": "IRON TILDEN",
            "aliases": [
                "Aqua Blizzard ",
                "Armageddon",
                "Blue Otso ",
                "BlueAlpha ",
                "Dancing Salome ",
                "Gamaredon",
                "Gamaredon Group",
                "Hive0051 ",
                "Primitive Bear ",
                "Shuckworm ",
                "Trident Ursa ",
                "UAC-0010 ",
                "UNC530 ",
                "WinterFlounder ",
                "ACTINIUM "
            ],
            "source_name": "Secureworks:IRON TILDEN",
            "tools": [
                "Pterodo"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536117,
    "ts_updated_at": 1743041637,
    "ts_creation_date": 1653678677,
    "ts_modification_date": 1653678677,
    "files": {
        "pdf": "https://archive.orkl.eu/a9a299f44df201ebd3b7156731926f5b4ff4901a.pdf",
        "text": "https://archive.orkl.eu/a9a299f44df201ebd3b7156731926f5b4ff4901a.txt",
        "img": "https://archive.orkl.eu/a9a299f44df201ebd3b7156731926f5b4ff4901a.jpg"
    }
}