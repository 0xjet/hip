{
    "id": "18c0f17c-e0c3-4815-91e6-619f56bca5c7",
    "created_at": "2023-01-12T15:07:29.70755Z",
    "updated_at": "2025-03-27T02:06:06.086965Z",
    "deleted_at": null,
    "sha1_hash": "dcc3c015aa504c9328dce8b9eae9162ff0d5bdcc",
    "title": "2020-10-01 - Evasive URLs in Spam- Part 2",
    "authors": "",
    "file_creation_date": "2022-05-28T15:19:24Z",
    "file_modification_date": "2022-05-28T15:19:24Z",
    "file_size": 923671,
    "plain_text": "# Evasive URLs in Spam: Part 2\n\n**[trustwave.com/en-us/resources/blogs/spiderlabs-blog/evasive-urls-in-spam-part-2/](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/evasive-urls-in-spam-part-2/)**\n\nA URL can be completely valid, yet still misleading. In this blog, we will present another\ntechnique with URLs that we observed in a recent malicious spam campaign. This is the\n[continuation of an earlier blog that discussed how valid URL formats can be used in](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/evasive-urls-in-spam/)\nevading detection.\n\nThe spams in this campaign have a PowerPoint Add-in attachment which contains a\nmalicious macro. When the PowerPoint file is closed, it accesses a URL via the Windows\nbinary mshta.exe, and this leads to different malware being installed into the system. This\nroutine is not unusual for macro downloaders. However, we find the obfuscation used on\nthe URL interesting and worthy of further investigation.\n\n\n-----\n\n_Figure 1: The spam containing a PowerPoint Add-in and the PowerPoint’s process tree_\n\n_Figure 2: The PowerPoint attachment and its macro code where the initial malicious URL is_\n_formulated_\n\n\n-----\n\nThe domains associated with this campaign are already known to host malicious files and\nobfuscated malicious data. To trick the email recipient, and avoid being flagged by email\nand AV scanners, the cybercriminals behind this campaign employed a semantic attack on\nthese URLs.\n\n[A URI may have an Authority component and below is its structure. If the Userinfo](https://tools.ietf.org/html/rfc3986#section-3.2)\nsubcomponent is present, it is preceded by two slashes and followed by an “@” character.\n\nauthority = [userinfo@]host[:port]\n\nUserinfo is rarely used, and as such, can be used to try and fool a casual observer. In this\ncampaign, dummy userinfo is incorporated on the URLs. The bad guys are attempting to\n[make the domains unnoticeable yet still conforming with the generic URI syntax.](https://tools.ietf.org/html/rfc3986#section-3)\n\n_Figure 3: The URL flow_\n\nThe initial URL shown in the image above has the domain j[.]mp – a URL shortening service\noffered by Bit.ly, a URL shortener too. To avoid being characterized as a short URL and\neventually evading detection signatures, the string “%909123id” is repeatedly used in the\nuserinfo. Since the URL j[.]mp/kassaasdskdd _(shortened from Figure 3) does not require a_\nuserinfo to gain access to any resources, the userinfo data will be ignored when the URL is\naccessed. The first URL, accessed by the PowerPoint attachment, redirects to an\nobfuscated VBScript hosted on Pastebin.\n\n\n-----\n\n_Figure 4: The obfuscated script on Pastebin and its de-obfuscated data_\n\n_Figure 5: The registry entry created by the VBScript on Figure 4_\n\nThe VBScript, contained in the 2nd URL in Figure 3, is a dropper. It writes a PowerShell\ndownloader into the registry and sets its persistence. The PowerShell downloads and\nprocesses the raw data on two more Pastebin URLs, and then executes the output binaries.\n\nThe third and the fourth URLs are Pastebin URLs too. Both contain dummy userinfo as well\nwhich will be ignored by the Pastebin URLs. The content at the third URL\n_pastebin[.]com/raw/uhMtv3Bk_ _(shortened from Figure 3) contains an obfuscated PowerShell_\n[code. The PowerShell executes 2 DotNet compiled DLLs – the first DLL bypasses the Anti-](https://www.virustotal.com/gui/file/e4d14ba73670184066a00cf5d3361580f6c4fbc5d0862a90278d82e95426faa5/detection)\n[Malware Scan Interface (AMSI) and then loads a DLL injector into the memory. The fourth](https://www.virustotal.com/gui/file/8ed29945294e0ba0ae9d5c94c3871dfb00eb9c32b2c7a7704005b31642977a02/detection)\nURL pastebin[.]com/raw/Nz1mPUdT (shortened from Figure 3) contains an obfuscated\nmalware [Lokibot sample. This will be injected to a legit process notedpad.exe by the DLL](https://www.virustotal.com/gui/file/19f9e641335afc56669566ad979c572f924e2fbb3ab32ecbb9ccfd155c75ef2c/detection)\ninjector mentioned earlier.\n\n## Summary\n\n\n-----\n\nWe found it interesting that the attackers were using URIs in this way, which essentially is\nan attack on the user’s preconceived notion of what a URI should look like. It may also\ndefeat security solutions, which may be expecting URIs in a certain format.\n\n[Trustwave Secure Email Gateway has added protection for this threat for our customers. As](https://www.trustwave.com/en-us/services/technology/secure-email-gateway/)\n[advised by my colleague in the blog, be cautious with URLs received from external emails –](https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/evasive-urls-in-spam/)\ninvestigate links before clicking.\n\n**IOCs**\n\nEmail Attachment\nREQUEST FOR OFFER 08-20-2020.ppt (82944 bytes) SHA1:\n01A3399F8A075137CD4F68A2B247C509FCEAB21F\n\nDLL Injectors\nWindowsFormsApplication68.dll (49664 bytes)\nF8E91A3A407235583058DF06C2C2CCDE73194A03\nGuwav.dll (20480 bytes) SHA1: 70b45d01eea4156610583c8b3dfcab89eeb6f113\n\nObfuscated VBScipt from pastebin[.]com/raw/XZxTT7Xy\n(3346 bytes) SHA1: FC050B623983B10D60ED4557771609C9D10F3C3A\nObfuscated PowerShell from pastebin[.]com/raw/uhMtv3Bk\n(525125 bytes) SHA1: 047D7516EF672AE882B322F1E3E9DF2BDF7F4583\nLokibot deobfuscated from pastebin[.]com/raw/Nz1mPUdT\n(104.0KB) SHA1: A988B692581A76A6220A641037F7AA254C1F293F\nLokibot Setting URL\nhxxp://195[.]69[.]140[.]147/[.]op/cr[.]php/SczbkxCQZQyVr\nLokibot C&Cs\nkbfvzoboss[.]bid/alien/fre[.]php\nalphastand[.]trade/alien/fre[.]php\nalphastand[.]win/alien/fre[.]php\nalphastand[.]top/alien/fre[.]php\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-10-01 - Evasive URLs in Spam- Part 2.pdf"
    ],
    "report_names": [
        "2020-10-01 - Evasive URLs in Spam- Part 2.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536049,
    "ts_updated_at": 1743041166,
    "ts_creation_date": 1653751164,
    "ts_modification_date": 1653751164,
    "files": {
        "pdf": "https://archive.orkl.eu/dcc3c015aa504c9328dce8b9eae9162ff0d5bdcc.pdf",
        "text": "https://archive.orkl.eu/dcc3c015aa504c9328dce8b9eae9162ff0d5bdcc.txt",
        "img": "https://archive.orkl.eu/dcc3c015aa504c9328dce8b9eae9162ff0d5bdcc.jpg"
    }
}