{
    "id": "9d745433-260f-4b45-bc4c-372a71aa8b56",
    "created_at": "2022-10-25T16:48:11.839514Z",
    "updated_at": "2025-03-27T02:16:59.308357Z",
    "deleted_at": null,
    "sha1_hash": "688771ff7a16425f001508bbb46242248d74545e",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-11-30T00:55:09Z",
    "file_modification_date": "2019-11-30T00:55:09Z",
    "file_size": 1627035,
    "plain_text": "# Studying Donot Team\n\n**blog.ptsecurity.com/2019/11/studying-donot-team.html**\n\nAPT group called Donot Team (aka APT-C-35, SectorE02) has been active since at least 2012. The attackers hunt for confidential\ninformation and intellectual property. The hackers' targets include countries in South Asia, in particular, state sector of Pakistan. In\n2019, we noticed their activity in Bangladesh, Thailand, India, Sri Lanka, the Philippines, and outside of Asia, in places like\nArgentina, the United Arab Emirates, and Great Britain.\n\nFor several months, we have been monitoring changes in the code of this group's malicious loaders. In this article, we will review\none of the attack vectors, will talk about the loaders in more detail, and will touch upon the peculiarity of the network infrastructure.\n\n## Attack chain\n\nAt the early stage of infection, the victim receives an MS Word document in Office Open XML format. Even though we do not have\nclear evidence, we are sure that the initial penetration vector is a targeted phishing message with MS Office attachment. The\ndocument itself is not malicious, but it abuses the external elements autoloading capability to launch the next stage document.\n\n\nCommunicating with a linked external object\n\n\nThe loaded fine is an RTF document exploiting vulnerability CVE-2018-0802 in Microsoft Equation. The main shellcode is\npreceded by a chain of intermediate ones, each decrypting the subsequent slice with a single-byte XOR with keys 0x90 and 0xCE.\n\n\n-----\n\nFirst shellcode decrypting the second one\n\n\nSecond shellcode decrypting the third one\n\n\nThird shellcode decrypting the main one\n\n\nThe main shellcode performed the following actions:\n\nUses a single-byte XOR with key 0x79 to decrypt binary data from file %TEMP%\\one.\nCreates executable files C:\\Windows\\Tasks\\Serviceflow.exe and C:\\Windows\\Tasks\\sinter.exe. These are the group's\nmalicious loaders. We will talk more about them later.\nCreates file C:\\Windows\\Tasks\\S_An.dll, containing two bytes 0x90.\nCreates file C:\\Windows\\Tasks\\A64.dll. Depending on the system bit capacity, this is a modified x64-bit or x86-bit version of\n[UACMe utility escalating privileges in the system. In addition to bypassing UAC control, the library creates and launches BAT](https://github.com/hfiref0x/UACME)\nscript %TEMP%\\v.bat. The script will use the following commands to register one of the loaders created earlier as a service:\n\nsc create ServiceTool displayname= \"ServiceFill\" binpath= \"C:\\Windows\\Tasks\\Serviceflow.exe\" start= \"auto\"\nsc start ServiceTool\n\n\n-----\n\nDecrypting BAT scripts in modified UACMe libraries\n\n\nCreates and launches JScript script C:\\Windows\\Tasks\\bin.js. Its task is to launch library A64.dll via RnMod export using\nrundll32.\nCreates shortcut WORDICON.lnk in the startup folder. Its task is to launch loader sinter.exe after system restart.\nCreates shortcut Support.lnk in the startup folder. Its task is to launch bin.js JScript script after system reboot.\n\n\n-----\n\nDecompiled code of the main shellcode\n\n\nSo, at that stage there are two loaders with a firm foothold in the System. We will discuss their operation later on.\n\n## Lo2 loaders\n\nDespite their classification, the trojans have different objectives. For instance, file Serviceflow.exe acts as a watchdog. It collects\nthe following information about the system:\n\nUsername\nComputer name\nContents of \\Program Files\\ and \\Program Files (x86)\\\nOS version\nData about the processor\n\nThe watchdog records the results in file log.txt. It also checks Windows\\Tasks\\ for files A64.dll and sinter.exe. If necessary, it\ndownloads the files from control server skillsnew[.]top and launches them on behalf of the current user. The corresponding token is\nextracted from process winlogon.exe. Trojan sinter.exe lets the attackers know about the infection by sending a request to\nhxxps://mystrylust.pw/confirm.php, and sends the collected information about the system to skillsnew[.]top. Then, if the attackers\nare still interested in the victim's computer, the trojan obtains contents of customer.txt file at hxxp://docs.google.com/uc?\nid=1wUaESzjGT2fSuP_hOJMpqidyzqwu15sz&export=download. The file contains the name for control server\ncar[.]drivethrough.top, with which the trojan communicates further. Downloaded files are placed in folder\n\\AppData\\Roaming\\InStore\\, and launched with task scheduler.\n\n\n-----\n\nDecrypted strings of command fragments and task template\n\n\n[As a result of malicious loaders' activity, components of framework yty are inserted into the system, allowing the attackers to get](https://attack.mitre.org/software/S0248/)\nmore details about their victim, including files with a certain extension, intercepted input strings, list of processes, and screenshots.\nWe will not discuss plugins in this article.\nWhen we studied other similar samples, we found some paths and project names left in the debugging information including the\nfollowing:\n\nD:\\Soft\\DevelopedCode_Last\\BitDefenderTest\\m0\\New_Single_File\\Lo2\\SingleV2\\Release\\BinWork.pdb\nD:\\Soft\\DevelopedCode_Last\\BitDefenderTest\\m0\\New_Single_File\\Lo2\\SingleV2_Task_Layout_NewICON\\Release\\BinWork.pdb\nD:\\Soft\\DevelopedCode_Last\\BitDefenderTest\\m0\\New_Single_File\\Lo2\\SingleV2_Task_Layout_NewICON_N_Lnk\\Release\\BinWork.pdb\nD:\\Soft\\DevelopedCode_Last\\BitDefenderTest\\m0\\New_Single_File\\Lo2\\SingleV3\\Release\\WorkFile.pdb\nD:\\Soft\\DevelopedCode_Last\\BitDefenderTest\\m0\\Off\\Off_New_Api\\Release\\C++\\ConnectLink.pdb\nD:\\Soft\\DevelopedCode_Last\\BitDefenderTest\\m0\\Off\\Off_New_Api\\Release\\C++\\TerBin.pdb\nD:\\Soft\\DevelopedCode_Last\\BitDefenderTest\\m0\\yty 2.0 - With AES Chunks LOC FOR XP Just BitChange_Name\\Release\\TaskTool.pdb\nD:\\Soft\\DevelopedCode_Last\\BitDefenderTest\\yty 2.0 - With AES Chunks OFFS Just Bit\\Release\\C++\\MsBuild.pdb\nD:\\Soft\\DevelopedCode_Last\\yty 2.0\\Release\\C++\\Setup.pdb\n\nIn addition to substring yty 2.0 connecting the trojans with the framework, we also noticed substring Lo2, which may be an\nabbreviation from Loader 2.\n\nIn loaders versions before mid-2018, all used strings were stored in the file in cleartext. In subsequent builds, the attackers started\nencrypting the strings. In different versions, the following changes were made to the algorithm:\n\nSince May 2018: reverse the string and encode with Base64\nSince April 2019: perform the previous actions twice.\n\n\n-----\n\nSince January 2019: encrypt the string with AES in CBC mode and encode with Base64. Sample of Python code for\ndecryption:\n\nimport base64\nfrom Cryptodome.Cipher import AES\n\naeskey = (0x23, 0xd4, 0x67, 0xad, 0x96, 0xc3, 0xd1, 0xa5, 0x23, 0x76, 0xae, 0x4e, 0xdd, 0xca, 0x13, 0x55)\n\ndef aes_decrypt(data, aeskey):\niv = bytes(list(range(0, 16)))\nkey = bytes(aeskey)\naes = AES.new(key, AES.MODE_CBC, iv)\nreturn aes.decrypt(data).decode().strip('\\x00')\n\ndef base64_aes_decrypt(data, aeskey):\ndata = base64.b64decode(data)\ndata = aes_decrypt(data, aeskey)\nreturn data\n\nSince June 2019: perform symbol-by-symbol circular subtraction with the set array of bytes, encode with UTF-8, and encode\nwith Base64. Sample of Python code for decryption:\n\nsubgamma = (0x2d, 0x55, 0xf, 0x59, 0xf, 0xb, 0x60, 0x33, 0x29, 0x4e, 0x19, 0x3e, 0x57, 0x4d, 0x56, 0xf)\n\ndef sub_decrypt(data, subgamma):\no = ''\nlength = len(data)\nsubgamma_length = len(subgamma)\nfor i in range(length):\no += chr((0x100 + ord(data[i]) - subgamma[i%subgamma_length]) & 0xff)\nreturn o\n\ndef base64_utf8_sub_decrypt(data, subgamma):\ndata = base64.b64decode(data)\ndata = data.decode('utf-8')\ndata = sub_decrypt(data, subgamma)\nreturn data\n\nSince October 2019: perform symbol-by-symbol circular modified XOR with the set array of bytes, and encode with Base64\ntwice. The peculiarity of XOR algorithm is that if the string symbol value matches the value of the symbol in the set array of\nbytes, XOR is not required. Sample of Python code for decryption:\n\nxorgamma = (0x56, 0x2d, 0x61, 0x21, 0x16)\n\ndef modxor_decrypt(data, xorgamma):\no = ''\nlength = len(data)\nxorgamma_length = len(xorgamma)\nfor i in range(length):\nc = data[i]\nif c != xorgamma[i%xorgamma_length]:\nc = data[i] ^ xorgamma[i%xorgamma_length]\no += chr(c)\nreturn o\n\ndef base64_modxor_decrypt(data, xorgamma):\ndata = base64.b64decode(data)\ndata = modxor_decrypt(data, xorgamma)\nreturn data\n\n\n-----\n\nWhen we were writing the decryption script, we found that some strings couldn’t be decrypted. But then we found that these lines\ncan still be decrypted with one of the decryption methods mentioned earlier. After we verified that each sample uses only one\ndecryption method, we concluded that the attackers had simply forgotten to delete unused strings or replace them with those\ncorrectly encrypted for the next version of the malware.\n\n\nStrings in one of the loader samples were encrypted with various methods, but only one is used in the executable file.\n\n\nSuch mistakes are always advantageous for the researchers. For instance, the strings left by the attackers often contained the\nattackers' control servers which we did not know about before.\n\n## Network Infrastructure peculiarities\n\nTo complete the picture, we want to point out some typical features which can help you make a connection between the group's\nattacks in the future.\n\nMost of the control servers are rented from DigitalOcean, LLC (ASN 14061), and are located in Amsterdam.\nThe attackers do not use the same servers for different DNS names. They prefer reserving a new allocated host for each\nnew domain name.\nIn most cases, domain owners' registration information is hidden with privacy services. The attackers can use the following\nservices: WhoisGuard, Inc.; Whois Privacy Protection Service, Inc.; Domains By Proxy, LLC; and Whois Privacy Protection\nFoundation. In some cases the data is accessible, and we can see the common approach to filling the fields.\n\n\n-----\n\nWHOIS information about domain burningforests[.]com\n\n\nWHOIS information about domain cloud-storage-service[.]com\n\n\nMost commonly, the attackers use .top, .pw, .space, .live, and .icu TLD.\n\n## Conclusion\n\nDonot Team is known to use their own tools at every stage of the attack. On the one hand, the group uses various techniques to\nmake code analysis more difficult, but on the other hand, it does not attempt to hide or disguise their actions in the system.\n[Multipleattacks on the same targets can be indicative of particular interest in the chosen range of victims. This can also mean that](https://www.netscout.com/blog/asert/donot-team-leverages-new-modular-malware-framework-south-asia)\nthe used tactics and techniques are not very efficient.\n\n**Author: Alexey Vishnyakov, Positive Technologies**\n\n### IOCs\n\n6ce1855cf027d76463bb8d5954fcc7bb — loader in MS Word format\nhxxp://plug.msplugin.icu/MicrosoftSecurityScan/DOCSDOC\n21b7fc61448af8938c09007871486f58 — dropper in MS Word format\n71ab0946b6a72622aef6cdd7907479ec — loader Lo2 in C:\\Windows\\Tasks\\Serviceflow.exe\n22f41b6238290913fc4d196b8423724d — loader Lo2 in C:\\Windows\\Tasks\\sinter.exe\n330a4678fae2662975e850200081a1b1 —modified x86 version of UACMe\n22e7ef7c3c7911b4c08ce82fde76ec72 —modified x64 version of UACMe\nskillsnew[.]top\nhxxps://mystrylust.pw/confirm.php\nhxxp://docs.google.com/uc?id=1wUaESzjGT2fSuP_hOJMpqidyzqwu15sz&export=download\ncar[.]drivethrough.top\nburningforests[.]com\ncloud-storage-service[.]com\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.11.25_Donot_Team/Studying%20Donot%20Team.pdf"
    ],
    "report_names": [
        "Studying Donot Team"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2ac63ef4-a7b8-4a30-96ad-b30ccb2073fc",
            "created_at": "2022-10-25T16:07:23.546262Z",
            "updated_at": "2025-03-27T02:02:09.856624Z",
            "deleted_at": null,
            "main_name": "Donot Team",
            "aliases": [
                "APT-C-35",
                "SectorE02"
            ],
            "source_name": "ETDA:Donot Team",
            "tools": [
                "BackConfig",
                "EHDevel",
                "Jaca",
                "yty"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "cfdd350b-de30-4d29-bbee-28159f26c8c2",
            "created_at": "2023-01-06T13:46:38.433736Z",
            "updated_at": "2025-03-27T02:00:02.832565Z",
            "deleted_at": null,
            "main_name": "VICEROY TIGER",
            "aliases": [
                "OPERATION HANGOVER",
                "Donot Team",
                "APT-C-35",
                "SectorE02",
                "Orange Kala"
            ],
            "source_name": "MISPGALAXY:VICEROY TIGER",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716491,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1575075309,
    "ts_modification_date": 1575075309,
    "files": {
        "pdf": "https://archive.orkl.eu/688771ff7a16425f001508bbb46242248d74545e.pdf",
        "text": "https://archive.orkl.eu/688771ff7a16425f001508bbb46242248d74545e.txt",
        "img": "https://archive.orkl.eu/688771ff7a16425f001508bbb46242248d74545e.jpg"
    }
}