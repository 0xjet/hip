{
    "id": "3a2d8b89-1168-4b6f-ac9e-4359cbbbd623",
    "created_at": "2023-01-12T15:04:10.357145Z",
    "updated_at": "2025-03-27T02:05:21.276331Z",
    "deleted_at": null,
    "sha1_hash": "0ab231c6ce956f5d4bf3dbee0a550614c5faf3e2",
    "title": "2017-07-17 - WMIGhost - Wimmie - WMI malware",
    "authors": "",
    "file_creation_date": "2022-05-28T03:53:15Z",
    "file_modification_date": "2022-05-28T03:53:15Z",
    "file_size": 843815,
    "plain_text": "# WMIGhost / Wimmie - WMI malware\n\n**secrary.com/ReversingMalware/WMIGhost/**\n\n[cd ../reverse_engineering_malware 5 minutes read](https://secrary.com/ReversingMalware)\nWMIGhost / Wimmie sample is from [theZoo](https://github.com/ytisf/theZoo/tree/master/malwares/Binaries/WMIGhost)\n\nSHA256: `a6ff8dfe654da70390cd71626cdca8a6f6a0d7980cd7d82269373737b04fd206`\n\nThe sample has `.dll extension but there are no exports and according to characteristics,`\nit’s not `dll file, I’ve changed the extension to` `.exe`\n\n[We can use the report from hybrid-analysis.](https://www.hybrid-analysis.com/sample/a6ff8dfe654da70390cd71626cdca8a6f6a0d7980cd7d82269373737b04fd206?environmentId=100)\n\nThere is no protection, let’s dive in deep.\n\n\n-----\n\nFrom the beginning, it decrypts text using `XOR with` `0x63 and` `0xE9 :`\n\nDecrypted text:\n\n\n-----\n\nRaw format- [Gist link](https://gist.github.com/secrary/8705c3cf184aec54f370c5704742602d)\n\n[Much more readable: Gist Link](https://gist.github.com/secrary/a67efdd15cdddc5e39fa2ce75fcf16c9)\n\n`NOTE : you can use my script to extract decrypted text from the executable:` [Gist link.](https://gist.github.com/secrary/c4fd3273a24da449795cc47f2e4378ef)\n\nThe malware uses `CoCreateInstance function to get access to` `COM functionality.`\n\nThe Microsoft Component Object Model (COM) is an interface standard that makes it\npossible for different software components to call each other’s code without knowledge of\nspecifics about each other.\n\n\n-----\n\n```\nMS Script Control is provided in msscript.ocx . It is a very handy tool to run\n\n```\nVBScript/JScript without relying on `CScript.exe or` `WScript.exe .`\n\nSeems like malware uses `Script Control via` `COM to execute decrypted function without`\n```\nCScript.exe or WScript.exe .\ncall dword ptr[ecx+20h] calls some function from msscript.ocx, but I have no idea\n\n```\nwhich function, there are no symbols, but I think it chooses `javascript to execute the`\nscript:\n\n[(Click here to view a larger version)](https://user-images.githubusercontent.com/16405698/28249463-6871beac-6a67-11e7-94ad-945a832fa954.png)\n\n\n-----\n\nAfter this at `00401AB7 there is another call to function from` `msscript.ocx :`\n\nI think this function is used to execute the script because it causes creation of new process\n\n```\nscrcons.exe\n\n```\n\nAccording to `TrendMicro ’s great` [paper:](https://www.trendmicro.de/cloud-content/us/pdfs/security-intelligence/white-papers/wp__understanding-wmi-malware.pdf)\n\n\n-----\n\n```\nBased on our analysis of using JS, the application wscript.exe is\nresponsible for executing the malicious code. However, in the case of WMI\nimplementation, such a script is executed by the WMI Standard Event Consumer\n- scripting application, which can be found in the WMI folder in %system32%/\nwbem/scrcons.exe. This makes the script hard to detect since it uses a notso-common WMI application—scrcons.exe—rather than the traditional JS\napplication—wscript.exe.\n\n```\nYes, the sample uses `WMI and executes the script using` `scrcons.exe .`\n\nAfter creation of the new process, it also creates `httpcom.log file and writes infection`\ndate:\n\nBefore exit it tries to delete `instell.exe without success:`\n\nThat’s executable, let’s look at the [script:](https://gist.github.com/secrary/8153a0cb8b4954429e1c430ad4821f96)\n\n\n-----\n\n[(Click here to view a larger version)](https://user-images.githubusercontent.com/16405698/28249667-413e6bba-6a6b-11e7-93a3-d66baabe0716.png)\n\nIt creates instance of `ActiveScriptEventConsumer under` `root\\subscription`\nnamespace, executes `Javascript script every` `0x6e3 milliseconds, you can get the`\nscript from the [Gist or get using WMI Explorer, it’s under](https://gist.github.com/secrary/a67efdd15cdddc5e39fa2ce75fcf16c9) `ROOT\\subscription`\nnamespace, the class is `ActiveScriptEventConsumer, the name of the instance is`\n```\nProbeScriptFint, the script is a value of the ScriptText property.\n\n```\n[(Click here to view a larger version)](https://user-images.githubusercontent.com/16405698/28249657-01e2eb12-6a6b-11e7-8f9b-1d965588f3fd.png)\n\nWMI classes stored in namespace: `subscription allow permanent and general access to`\nWMI services.\n```\nnew MAIN().Fire() causes executing of MAIN routine:\n\n```\n\n-----\n\n```\nCleanObjects terminates execution of the script:\n\n```\nParses URLs from the argument and sends information about infected PC:\n\n\n-----\n\nReceives commands and sends results:\n\n\n-----\n\n-----\n\nIf you prefer you can dive deeper into the script, it s not obfuscated and is easy to analyze.\n\nThat’s all… WMIGhost / Wimmie is a very interesting malware, it uses `WMI to achieve`\npersistence and get system related information, the script is not on the disk.\n\nWe can get information about `WMI Database Entries using` `Autoruns :`\n\nMaybe I overlook something related to `WMIGhost, due to my limited knowledge, if you find`\nsomething interesting please contact me.\n\nI’m new to reversing malware and any kind of feedback is helpful for me.\n\nTwitter: [@_qaz_qaz](https://twitter.com/_qaz_qaz)\n\n**Resources:**\n\n[Understanding WMI Malware](https://www.trendmicro.de/cloud-content/us/pdfs/security-intelligence/white-papers/wp__understanding-wmi-malware.pdf)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-07-17 - WMIGhost - Wimmie - WMI malware.pdf"
    ],
    "report_names": [
        "2017-07-17 - WMIGhost - Wimmie - WMI malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "42a6a29d-6b98-4fd6-a742-a45a0306c7b0",
            "created_at": "2022-10-25T15:50:23.710403Z",
            "updated_at": "2025-03-27T02:00:55.531313Z",
            "deleted_at": null,
            "main_name": "Silence",
            "aliases": [
                "Whisper Spider"
            ],
            "source_name": "MITRE:Silence",
            "tools": [
                "Winexe",
                "SDelete"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "88e53203-891a-46f8-9ced-81d874a271c4",
            "created_at": "2022-10-25T16:07:24.191982Z",
            "updated_at": "2025-03-27T02:02:10.13692Z",
            "deleted_at": null,
            "main_name": "Silence",
            "aliases": [
                "ATK 86",
                "Contract Crew",
                "TAG-CR8",
                "TEMP.TruthTeller",
                "Whisper Spider"
            ],
            "source_name": "ETDA:Silence",
            "tools": [
                "EDA",
                "EmpireDNSAgent",
                "Farse",
                "Ivoke",
                "Kikothac",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Meterpreter",
                "ProxyBot",
                "ReconModule",
                "Silence.Downloader",
                "TiniMet",
                "TinyMet",
                "TrueBot",
                "xfs-disp.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e8ebcbda-e8df-4a38-a2a6-63b2608ee6f3",
            "created_at": "2023-01-06T13:46:38.88051Z",
            "updated_at": "2025-03-27T02:00:02.94193Z",
            "deleted_at": null,
            "main_name": "Silence group",
            "aliases": [
                "WHISPER SPIDER"
            ],
            "source_name": "MISPGALAXY:Silence group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535850,
    "ts_updated_at": 1743041121,
    "ts_creation_date": 1653709995,
    "ts_modification_date": 1653709995,
    "files": {
        "pdf": "https://archive.orkl.eu/0ab231c6ce956f5d4bf3dbee0a550614c5faf3e2.pdf",
        "text": "https://archive.orkl.eu/0ab231c6ce956f5d4bf3dbee0a550614c5faf3e2.txt",
        "img": "https://archive.orkl.eu/0ab231c6ce956f5d4bf3dbee0a550614c5faf3e2.jpg"
    }
}