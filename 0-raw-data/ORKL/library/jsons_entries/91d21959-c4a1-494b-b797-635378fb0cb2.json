{
    "id": "91d21959-c4a1-494b-b797-635378fb0cb2",
    "created_at": "2023-01-12T15:02:46.161677Z",
    "updated_at": "2025-03-27T02:16:14.065764Z",
    "deleted_at": null,
    "sha1_hash": "1fdbefb8b500403796329cee90397f9d2b34dcd4",
    "title": "2022-01-12 - Wading Through Muddy Waters - Recent Activity of an Iranian State-Sponsored Threat Actor",
    "authors": "",
    "file_creation_date": "2022-05-28T00:25:52Z",
    "file_modification_date": "2022-05-28T00:25:52Z",
    "file_size": 869892,
    "plain_text": "# Wading Through Muddy Waters | Recent Activity of an Iranian State-Sponsored Threat Actor\n\n**[sentinelone.com/labs/wading-through-muddy-waters-recent-activity-of-an-iranian-state-sponsored-threat-actor/](https://www.sentinelone.com/labs/wading-through-muddy-waters-recent-activity-of-an-iranian-state-sponsored-threat-actor/)**\n\nAmitai Ben Shushan Ehrlich\n\n## Overview\n\nMuddyWater is commonly considered an Iranian state-sponsored threat actor but no further\ngranularity has previously been available. As of January 12th, 2022, U.S. CyberCommand has\n[attributed this activity to the Iranian Ministry of Intelligence (MOIS). While some cases allow for](https://twitter.com/CNMF_CyberAlert/status/1481341952247349248?s=20)\nattribution hunches, or even fleshed out connections to handles and online personas, attribution\nto a particular government organization is often reserved to the kind of visibility only available to\ngovernments with a well-developed all-source and signals intelligence apparatus.\n\nAs in all cases of public government attribution, we take this as an opportunity to reassess our\nassumptions about a given threat actor all the while recognizing that we can’t independently verify\nthe basis for this claim.\n\nU.S. Cyber Command pointed to multiple malware sets used by MuddyWater. Among those,\nPowGoop correlates with activities we’ve triaged in recent incidents. We hope sharing relevant inthe-wild findings will further bolster our collective defense against this threat.\n\n\n-----\n\n[Iranian MOIS hacker group #MuddyWater is using a suite of malware to conduct espionage](https://twitter.com/hashtag/MuddyWater?src=hash&ref_src=twsrc%5Etfw)\nand malicious activity. If you see two or more of these malware on your network, you may\nhave MuddyWater on it: [https://t.co/xTI6xuQOg3. Attributed through @NCIJTF](https://t.co/xTI6xuQOg3) [@FBI](https://twitter.com/FBI?ref_src=twsrc%5Etfw)\n\n[— USCYBERCOM Cybersecurity Alert (@CNMF_CyberAlert) January 12, 2022](https://twitter.com/CNMF_CyberAlert/status/1481341952247349248?ref_src=twsrc%5Etfw)\n\n## Analysis of New PowGoop Variants\n\n[PowGoop is a malware family first described by Palo Alto which utilizes DLL search order](https://unit42.paloaltonetworks.com/thanos-ransomware/)\nhijacking (T1574.001). The name derives from the usage ‘ GoogleUpdate.exe ‘ to load a\nmalicious modified version of ‘ goopdate.dll ‘, which is used to load a malicious PowerShell\n[script from an external file. Other variants were described by ClearSkySec and](https://www.clearskysec.com/wp-content/uploads/2020/10/Operation-Quicksand.pdf) [Symantec.](https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/seedworm-apt-iran-middle-east)\n\nWe identified newer variants of PowGoop loader that involve significant changes, suggesting the\ngroup continues to use and maintain it even after recent exposures. The new variants reveal that\nthe threat group has expanded its arsenal of legitimate software used to load malicious DLLs.\nAside from ‘ GoogleUpdate.exe ’, three additional benign pieces of software are abused in order\nto sideload malicious DLLs: ‘ Git.exe ’, ‘ FileSyncConfig.exe ’ and ‘ Inno_Updater.exe ’.\n\nEach contains a modified DLL and a renamed authentic DLL. The hijacked DLL contains imports\noriginating from its renamed counterpart, as well as two additional functions written by the\nattackers. The list of hijacked DLLs is presented below:\n\n**Software Name** **Hijacked DLL** **Renamed DLL**\n\nGoogleUpdate.exe goopdate.dll goopdate86.dll\n\ninno_updater.exe vcruntime140.dll vcruntime141.dll\n\nFileSyncConfig.exe vcruntime140.dll vcruntime141.dll\n\ngit.exe libpcre2-8-0.dll libpcre2-8-1.dll\n\nUnlike previous versions, the hijacked DLLs attempt to reflectively load two additional files, one\nnamed ‘ Core.dat ’, which is a shellcode called from the export ‘ DllReg ’ and the other named\n‘ Dore.dat ’, which is a PE file with a ` MZRE ` header, allowing it to execute as a shellcode as\n[well, similarly to the publicly reported techniques, called from the export ‘ DllRege ’.](https://www.cobaltstrike.com/help-malleable-postex)\n\nThose two ‘ .dat ’ files are identical for each of the hijacked DLLs and are both executed using\nrundll32 on their respective export, which reads the file from disk to a virtually allocated buffer,\nfollowed by a call to offset 0 in the read data.\n\nBoth ‘ Dore.dat ’ and ‘ Core.dat ’ search for a file named ‘config.txt’ and run it using\nPowerShell in a fashion similar to older versions ( T1059.001 ). The overlap in functionality\nbetween the two components is not clear; however, it is evident that ‘ Core.dat ’ represents a\nmore mature and evolved version of PowGoop as it is loaded as a shellcode, making it less likely\nto be detected statically.\n\n\n-----\n\nIt is also worth noting that it is not necessary for both components to reside on the infected\nsystem as the malware will execute successfully with either one. Given that, it is possible that one\nor the other could be used as a backup component. The PowerShell payloads within\n‘ config.txt ’ could not be retrieved at the time of writing.\n\nExecution flow of new PowGoop variants\n\n## MuddyWater Tunneling Activity\n\nThe operators behind MuddyWater activities are very fond of tunneling tools, as described in\n[several recent blog posts(T1572). The custom tools used by the group often provide limited](https://www.trendmicro.com/en_us/research/21/c/earth-vetala---muddywater-continues-to-target-organizations-in-t.%20html)\nfunctionality, and are used to drop tunneling tools which enable the operators to conduct a wider\nset of activities. Among the tunneling tools MuddyWater attackers were observed using are\n[Chisel,](https://github.com/jpillora/chisel) [SSF and](https://github.com/securesocketfunneling/ssf) [Ligolo.](https://github.com/sysdream/ligolo)\n\nThe nature of tunneling activities is often confusing. However, analysis of Chisel executions by\nMuddyWater operators on some of the victims helps clarify their usage of such tools. This is an\nexample of a command executed by the attackers on some of the victims:\n```\n SharpChisel.exe client xx.xx.xx.xx:8080 r:8888:127.0.0.1:9999\n\n```\nThe “ r ” flag used in the client execution implies the server is running in “reverse” mode. Setting\nthe `--reverse flag, according to Chisel documentation, “allows clients to specify reverse port`\nforwarding remotes in addition to normal remotes”.\n\nIn this case, the “ SharpChisel.exe ” client runs on the victim machine, connects back to the\nChisel server over port 8080, and specifies to forward anything coming over port 8888 of the\nserver to port 9999 of the client.\n\nThis might look odd at first sight as port 9999 is not normally used on Windows machines and is\nnot bound to any specific service. This is clarified shortly afterwards as the reverse tunnel is\nfollowed by setting up a Chisel SOCKS5 server on the victim, waiting for incoming connections\nover port 9999:\n```\nSharpChisel.exe server -p 9999 --socks5\n\n```\n\n-----\n\nBy setting up both a server and a client instance of Chisel on the machine, the operators enable\nthemselves to tunnel a variety of protocols which are supported over SOCKS5. This actually\ncreates a tunnel within a tunnel. Given that, it is most likely the operator initiated SOCKS traffic to\nthe server over port 8888, tunneling traffic from applications of interest to inner parts of the\nnetwork.\n\nThe usage of Chisel and other tunneling tools effectively enable the threat actor to connect to\nmachines within target environments as if they were inside the operator LAN.\n\nSummary of MuddyWater tunneling using Chisel\n\n## Exchange Exploitation\n\nWhen tracking MuddyWater activity, we came across an interesting subset of activity targeting\nExchange servers of high-profile organizations. This subset of Exchange exploitation activity is\nrather interesting, as without context it would be difficult to attribute it to MuddyWater because the\nactivity relies almost completely on publicly available offensive security tools.\n\nThe attackers attempt to exploit Exchange servers using two different tools:\n\nA publicly available script for exploiting CVE-2020-0688 (T1190)\nRuler – an open source Exchange exploitation framework\n\n## CVE-2020-0688 Exploitation\n\nAnalysis of the activity observed suggests the MuddyWater threat group attempted to exploit\nCVE-2020-0688 on governmental organizations in the Middle East. The exploit enables remote\ncode execution for an authenticated user. The specific exploit MuddyWater operators were\nattempting to run was utilized to drop a webshell.\n\nThe attempted webshell drop was performed using a set of PowerShell commands that write the\nwebshell content into a specific path “ /ecp/HybridLogout.aspx “. The webshell awaits the\nparameter “ cmd ” and runs the commands in it utilizing XSL Script Processing (T1220).\n\n\n-----\n\nA snippet of the webshell MuddyWater attempted to upload to Exchange servers\nThis activity is highly correlated with a CVE-2020-0688 exploitation script from a Github repository\nnamed [fuckchina_v2.py. The script utilizes CVE-2020-0688 to upload an ASPX webshell to the](https://github.com/w4fz5uck5/cve-2020-0688-webshell-upload-technique/blob/master/fuckchina_v2.py)\npath : “ /ecp/HybridLogout.aspx ” (T1505.003). It is also one of the only publicly available\nCVE-2020-0688 implementations that drop a web shell.\n\nA snippet of CVE-2020-0688 exploitation script\n\n## Ruler Exploitation\n\n[Among other activities performed by the threat actors was attempted Ruler exploitation. The](https://github.com/sensepost/ruler)\ninstance identified targeted a telecommunication company in the Middle East. The observed\nactivity suggests the threat actor attempted to create malicious forms, which is one of the most\ncommon usages of Ruler (T1137.003).\n\nUsage of Ruler was previously associated with other Iranian threat actors, most commonly with\n[APT33.](https://www.fireeye.com/blog/threat-research/2018/12/overruled-containing-a-potentially-destructive-adversary.html)\n\n## Summary\n\nAnalysis of MuddyWater activity suggests the group continues to evolve and adapt their\ntechniques. While still relying on publicly available offensive security tools, the group has been\nrefining its custom toolset and utilizing new techniques to avoid detection. This is observed\nthrough the three distinct activities observed and analyzed in this report: The evolution of the\nPowGoop malware family, the usage of tunneling tools, and the targeting of Exchange servers in\nhigh-profile organizations\n\n\n-----\n\nLike many other Iranian threat actors, the group displays less sophistication and technological\ncomplexity compared to other state-sponsored APT groups. Even so, it appears MuddyWater’s\npersistency is a key to their success, and their lack of sophistication does not appear to prevent\nthem from achieving their goals.\n\n## Indicators of Compromise\n\n**PowGoop variants (MD5, SHA1, SHA256)**\n\nGoopdate.dll\n\nA5981C4FA0A3D232CE7F7CE1225D9C7E\n8FED2FF6B739C13BADB14C1A884D738C80CB6F34\nAA48F06EA8BFEBDC0CACE9EA5A2F9CE00C094CE10DF52462C4B9E87FEFE70F94\nLibpcre2-8-0.dll\n\nF8E7FF6895A18CC3D05D024AC7D8BE3E\n97248B6E445D38D48334A30A916E7D9DDA33A9B2\nF1178846036F903C28B4AB752AFE1B38B531196677400C2250AC23377CF44EC3\nVcruntime140.dll\n\nCEC48BCDEDEBC962CE45B63E201C0624\n81F46998C92427032378E5DEAD48BDFC9128B225\nDD7EE54B12A55BCC67DA4CEAED6E636B7BD30D4DB6F6C594E9510E1E605ADE92\nCore.dat\n\nA65696D6B65F7159C9FFCD4119F60195\n570F7272412FF8257ED6868D90727A459E3B179E\nB5B1E26312E0574464DDEF92C51D5F597E07DBA90617C0528EC9F494AF7E8504\nDore.dat\n\n6C084C8F5A61C6BEC5EB5573A2D51FFB\n61608ED1DE56D0E4FE6AF07ECBA0BD0A69D825B8\n7E7545D14DF7B618B3B1BC24321780C164A0A14D3600DBAC0F91AFBCE1A2F9F4\n\n**MITRE ATT&CK**\n\nT1190 – Exploit Public-Facing Application\nT1572 – Protocol Tunneling\nT1574.001 – Hijack Execution Flow: DLL Search Order Hijacking\nT1059.001 – Command and Scripting Interpreter: PowerShell\nT1505.003 – Server Software Component: Web Shell\nT1220 – XSL Script Processing\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-12 - Wading Through Muddy Waters - Recent Activity of an Iranian State-Sponsored Threat Actor.pdf"
    ],
    "report_names": [
        "2022-01-12 - Wading Through Muddy Waters - Recent Activity of an Iranian State-Sponsored Threat Actor.pdf"
    ],
    "threat_actors": [
        {
            "id": "2ed8d590-defa-4873-b2de-b75c9b30931e",
            "created_at": "2023-01-06T13:46:38.730137Z",
            "updated_at": "2025-03-27T02:00:02.903261Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "Boggy Serpens",
                "Mango Sandstorm",
                "TEMP.Zagros",
                "Static Kitten",
                "G0069",
                "TA450",
                "Earth Vetala",
                "Seedworm",
                "COBALT ULSTER",
                "ATK51"
            ],
            "source_name": "MISPGALAXY:MuddyWater",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "452d2d74-e812-45d6-b0fe-b8a6cc4ebd01",
            "created_at": "2022-10-25T16:07:23.562676Z",
            "updated_at": "2025-03-27T02:02:09.865955Z",
            "deleted_at": null,
            "main_name": "Earth Berberoka",
            "aliases": [
                "GamblingPuppet"
            ],
            "source_name": "ETDA:Earth Berberoka",
            "tools": [
                "Agent.dhwf",
                "AngryRebel",
                "AsyncRAT",
                "CinaRAT",
                "Destroy RAT",
                "DestroyRAT",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "Kaba",
                "Korplug",
                "Moudour",
                "Mydoor",
                "PCRat",
                "PlugX",
                "PuppetLoader",
                "Quasar RAT",
                "QuasarRAT",
                "RedDelta",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Trochilus RAT",
                "Xamtrav",
                "Yggdrasil",
                "oRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b23e717c-0b27-47e0-b3c8-4defe6dd857f",
            "created_at": "2023-01-06T13:46:38.367369Z",
            "updated_at": "2025-03-27T02:00:02.815758Z",
            "deleted_at": null,
            "main_name": "APT33",
            "aliases": [
                "ATK35",
                "Peach Sandstorm",
                "TA451",
                "APT 33",
                "Elfin",
                "Refined Kitten",
                "MAGNALLIUM",
                "HOLMIUM",
                "COBALT TRINITY",
                "G0064"
            ],
            "source_name": "MISPGALAXY:APT33",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "31e69945-6c1e-40c3-ba8e-a77e81dd142a",
            "created_at": "2024-05-01T02:03:08.047377Z",
            "updated_at": "2025-03-27T02:05:17.326452Z",
            "deleted_at": null,
            "main_name": "COBALT ULSTER",
            "aliases": [
                "ENT-11 ",
                "ITG17 ",
                "MERCURY ",
                "Mango Sandstorm ",
                "MuddyWater ",
                "STAC 1171 ",
                "Seedworm ",
                "Static Kitten ",
                "TEMP.Zagros ",
                "UNC3313 ",
                "Yellow Nix ",
                "Earth Vetala "
            ],
            "source_name": "Secureworks:COBALT ULSTER",
            "tools": [
                " Canopy",
                " CrackMapExec",
                " CredNinja",
                " Empire",
                " FORELORD",
                " Koadic",
                " LaZagne",
                " Ligolo",
                " MKL64",
                " Metasploit",
                " Mimikatz",
                " MiniDump",
                " Mori",
                " MuddyC2Go",
                " MuddyC3",
                " PhonyC2",
                " Plink",
                " PowGoop",
                " PowerStats",
                " RemoteUtilities",
                " Revsocks",
                " ScreenConnect",
                " SimpleHelp",
                " Small Sieve",
                " Syncro",
                " Venom Proxy",
                " WMIExec",
                "AnyDesk"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "9fe49a5b-f3e6-4fbf-99a1-db15dad460c3",
            "created_at": "2024-05-01T02:03:08.045004Z",
            "updated_at": "2025-03-27T02:05:17.325038Z",
            "deleted_at": null,
            "main_name": "COBALT TRINITY",
            "aliases": [
                "Elfin ",
                "HOLMIUM ",
                "MAGNALIUM ",
                "Peach Sandstorm ",
                "Refined Kitten ",
                "TA451 ",
                "APT33 "
            ],
            "source_name": "Secureworks:COBALT TRINITY",
            "tools": [
                " Cadlotcorg",
                " Dello RAT",
                " Imminent Monitor",
                " KDALogger",
                " Koadic",
                " NanoCore",
                " NetWire",
                " POWERTON",
                " PoshC2",
                " Poylog",
                " PupyRAT",
                " Schoolbag",
                "AutoCore"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "02e1c2df-8abd-49b1-91d1-61bc733cf96b",
            "created_at": "2022-10-25T15:50:23.308924Z",
            "updated_at": "2025-03-27T02:00:55.437268Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "MuddyWater",
                "Earth Vetala",
                "Static Kitten",
                "Seedworm",
                "TEMP.Zagros",
                "Mango Sandstorm",
                "TA450"
            ],
            "source_name": "MITRE:MuddyWater",
            "tools": [
                "STARWHALE",
                "POWERSTATS",
                "Out1",
                "PowerSploit",
                "Small Sieve",
                "Mori",
                "Mimikatz",
                "LaZagne",
                "PowGoop",
                "CrackMapExec",
                "ConnectWise",
                "SHARPSTATS",
                "RemoteUtilities",
                "Koadic"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e5ff825b-0456-4013-b90a-971b93def74a",
            "created_at": "2022-10-25T15:50:23.824058Z",
            "updated_at": "2025-03-27T02:00:55.553346Z",
            "deleted_at": null,
            "main_name": "APT33",
            "aliases": [
                "APT33",
                "HOLMIUM",
                "Elfin",
                "Peach Sandstorm"
            ],
            "source_name": "MITRE:APT33",
            "tools": [
                "PowerSploit",
                "AutoIt backdoor",
                "PoshC2",
                "Mimikatz",
                "NanoCore",
                "DEADWOOD",
                "StoneDrill",
                "POWERTON",
                "LaZagne",
                "TURNEDUP",
                "NETWIRE",
                "Pupy",
                "ftp",
                "Shamoon"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3c430d71-ab2b-4588-820a-42dd6cfc39fb",
            "created_at": "2022-10-25T16:07:23.880522Z",
            "updated_at": "2025-03-27T02:02:10.010443Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "ATK 51",
                "Boggy Serpens",
                "Cobalt Ulster",
                "ITG17",
                "Mango Sandstorm",
                "MuddyWater",
                "Operation BlackWater",
                "Operation Earth Vetala",
                "Operation Quicksand",
                "Seedworm",
                "Static Kitten",
                "T-APT-14",
                "TA450",
                "TEMP.Zagros",
                "Yellow Nix"
            ],
            "source_name": "ETDA:MuddyWater",
            "tools": [
                "Agentemis",
                "BugSleep",
                "CLOUDSTATS",
                "ChromeCookiesView",
                "Cobalt Strike",
                "CobaltStrike",
                "CrackMapExec",
                "DELPHSTATS",
                "EmPyre",
                "EmpireProject",
                "FruityC2",
                "Koadic",
                "LOLBAS",
                "LOLBins",
                "LaZagne",
                "Living off the Land",
                "MZCookiesView",
                "Meterpreter",
                "Mimikatz",
                "MuddyC2Go",
                "MuddyRot",
                "Mudwater",
                "POWERSTATS",
                "PRB-Backdoor",
                "PhonyC2",
                "PowGoop",
                "PowerShell Empire",
                "PowerSploit",
                "Powermud",
                "QUADAGENT",
                "SHARPSTATS",
                "SSF",
                "Secure Socket Funneling",
                "Shootback",
                "Smbmap",
                "Valyria",
                "chrome-passwords",
                "cobeacon",
                "prb_backdoor"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "2664d6f5-f918-4978-87f8-f6afad7402c6",
            "created_at": "2023-01-06T13:46:39.393669Z",
            "updated_at": "2025-03-27T02:00:03.073942Z",
            "deleted_at": null,
            "main_name": "Earth Berberoka",
            "aliases": [
                "GamblingPuppet"
            ],
            "source_name": "MISPGALAXY:Earth Berberoka",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535766,
    "ts_updated_at": 1743041774,
    "ts_creation_date": 1653697552,
    "ts_modification_date": 1653697552,
    "files": {
        "pdf": "https://archive.orkl.eu/1fdbefb8b500403796329cee90397f9d2b34dcd4.pdf",
        "text": "https://archive.orkl.eu/1fdbefb8b500403796329cee90397f9d2b34dcd4.txt",
        "img": "https://archive.orkl.eu/1fdbefb8b500403796329cee90397f9d2b34dcd4.jpg"
    }
}