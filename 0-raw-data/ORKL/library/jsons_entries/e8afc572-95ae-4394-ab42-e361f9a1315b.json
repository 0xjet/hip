{
    "id": "e8afc572-95ae-4394-ab42-e361f9a1315b",
    "created_at": "2023-01-12T15:08:57.441877Z",
    "updated_at": "2025-03-27T02:13:12.216567Z",
    "deleted_at": null,
    "sha1_hash": "0adf7bbf3b024e874629fbb1a903e53bd4f5e1c9",
    "title": "2022-01-08 - Unpacking Hancitor malware",
    "authors": "",
    "file_creation_date": "2022-05-27T18:58:08Z",
    "file_modification_date": "2022-05-27T18:58:08Z",
    "file_size": 1302373,
    "plain_text": "# Unpacking Hancitor malware\n\n**muha2xmad.github.io/unpacking/hancitor/**\n\n### Muhammad Hasan Ali\n\nMalware Analysis learner\n\n1 minute read\n\n**As-salamu Alaykum**\n\n## Introduction\n\n\nJanuary 8, 2022\n\n\nHancitor is an information stealer and malware downloader used by a threat actor\ndesignated as MAN1, Moskalvzapoe or TA511. In a threat brief from 2018, we noted Hancitor\nwas relatively unsophisticated, but it would remain a threat for years to come. Approximately\nthree years later, Hancitor remains a threat and has evolved to use tools like Cobalt Strike. In\nrecent months, this actor began using a network ping tool to help enumerate the Active\nDirectory (AD) environment of infected hosts. This blog illustrates how the threat actor\nbehind Hancitor uses the network ping tool, so security professionals can better identify and\nblock its use. [1](https://unit42.paloaltonetworks.com/hancitor-infections-cobalt-strike/)\n\nMD5: FF9D0327538AB33468A8AD2142EFF416\n\n## Packed indicators\n\n\n-----\n\nIf we open it in `DiE or` `pestudio we will notice that it’s Not packed.`\n\nAnother way to detect packing is to open it in `IDA and if you see less number of functions`\nthen It’s packed.\n\nFigure(1):\n\n## Unpacking process\n\nHow unpacking works? well, packing process depands on the packer. So each packer has\ndifferent unpacking routine.\n\nSo in this sample we will begin by setting two breakpoints in `VirtualAlloc and`\n```\nVirtualProtect . Then run f9 to hit the first breakpoint and then run again to hit the 2nd\n\n```\none which is `VirtualAlloc . Then step over` `f8 to the call of virtualalloc. Then dump`\n\n\n-----\n\nFigure(2):\n\nThen run again to get to virtualalloc to the 2nd time and see what dump has.\n\nFigure(3):\n\nWe keep pressing `run to hit the breakpoint of VirtualAlloc` **7 times. After that we we hit**\n```\nrun again.\n\n```\nFigure(4):\n\nWe will see our unpacked `exe in the dump. Then we` `Follow in Memory map and save`\nto file. And `Image base is` `230000 .`\n\n\n-----\n\nFigure(5):\n\n## Unmap the unpacked file\n\nTo get `improts of the unpacked file. We need to repair the section headers see my article`\n[Here. After unmapping you can see](https://muha2xmad.github.io/malware-analysis/emotet-part-2/#unmap-the-unpacked-file) `Imports and` `libraries .`\n\n## Article quote\n\nوﻣﺎذا ﯾﻬﻢ إذا ﻟﻢ ﺗﻜﻦ اﻟﺤﯿﺎة ﻋﻠﻰ ﻣﺎ ﯾُﺮام؟\n\n## REF\n\n1- [https://unit42.paloaltonetworks.com/hancitor-infections-cobalt-strike/](https://unit42.paloaltonetworks.com/hancitor-infections-cobalt-strike/)\n\n2- [VirtualAlloc](https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc)\n\n3- [VirtualProtect](https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-08 - Unpacking Hancitor malware.pdf"
    ],
    "report_names": [
        "2022-01-08 - Unpacking Hancitor malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1f6ae238-765f-4495-9d54-6a7883d7a319",
            "created_at": "2022-10-25T16:07:24.573456Z",
            "updated_at": "2025-03-27T02:02:10.284644Z",
            "deleted_at": null,
            "main_name": "TA511",
            "aliases": [
                "MAN1",
                "Moskalvzapoe"
            ],
            "source_name": "ETDA:TA511",
            "tools": [
                "Agentemis",
                "Chanitor",
                "Cobalt Strike",
                "CobaltStrike",
                "Ficker Stealer",
                "Hancitor",
                "NetSupport",
                "NetSupport Manager",
                "NetSupport Manager RAT",
                "NetSupport RAT",
                "NetSupportManager RAT",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "542cf9d0-9c68-428c-aff8-81b6f59dc985",
            "created_at": "2023-02-15T02:01:49.554105Z",
            "updated_at": "2025-03-27T02:00:03.110991Z",
            "deleted_at": null,
            "main_name": "Moskalvzapoe",
            "aliases": [
                "MAN1",
                "TA511"
            ],
            "source_name": "MISPGALAXY:Moskalvzapoe",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536137,
    "ts_updated_at": 1743041592,
    "ts_creation_date": 1653677888,
    "ts_modification_date": 1653677888,
    "files": {
        "pdf": "https://archive.orkl.eu/0adf7bbf3b024e874629fbb1a903e53bd4f5e1c9.pdf",
        "text": "https://archive.orkl.eu/0adf7bbf3b024e874629fbb1a903e53bd4f5e1c9.txt",
        "img": "https://archive.orkl.eu/0adf7bbf3b024e874629fbb1a903e53bd4f5e1c9.jpg"
    }
}