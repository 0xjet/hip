{
    "id": "b65602df-c586-4929-b7af-18a994aa2590",
    "created_at": "2022-10-25T16:48:16.795078Z",
    "updated_at": "2025-03-27T02:09:29.518096Z",
    "deleted_at": null,
    "sha1_hash": "712311f4cacd476100c7ef037e3accc740558920",
    "title": "Stuxnet 0.5: The Missing Link",
    "authors": "Symantec",
    "file_creation_date": "2013-02-27T12:35:26Z",
    "file_modification_date": "2013-02-27T12:35:36Z",
    "file_size": 4194917,
    "plain_text": "- Stuxnet 0.5 is the oldest known Stuxnet version to be analyzed, in\nthe wild as early as November 2007 and in development as early\nas November 2005.\n\n- Stuxnet 0.5 was less aggressive than Stuxnet versions 1.x and only\nspread through infected Step 7 projects.\n\n- Stuxnet 0.5 contains an alternative attack strategy, closing valves\nwithin the uranium enrichment facility at Natanz, Iran, which\nwould have caused serious damage to the centrifuges and uranium\nenrichment system as a whole.\n\n\n## Security Response\n\n# Stuxnet 0.5: The Missing Link\n\n##### Geoff McDonald, Liam O Murchu, Stephen Doherty, Eric Chien\n\n###### Version 1.0: February 26, 2013\n\n### Overview\n\n##### Contents\n\nIn 2010, Symantec reported on a new and highly sophisticated worm\n\nOverview............................................................. 1\n\n[called Stuxnet. This worm became known as the first computer](http://www.symantec.com/security_response/writeup.jsp?docid=2010-071400-3123-99)\n\nInstallation and load point................................. 3\n\nsoftware threat that was used as a cyber-weapon. The worm was\n\nReplication.......................................................... 3\n\nspecifically designed to take control over industrial plant machinery\n\nCommand-and-control....................................... 4\n\nand making them operate outside of their safe or normal performance\n\nPayload................................................................ 5\n\nenvelope, causing damage in the process. This was a first in the history\n\nMan-in-the-Middle........................................ 5\n\nof malware.\n\nFingerprinting and building DB8061................. 6\nPLC device attack code................................. 9\n\nClues in the code pointed to other versions of the worm which could\n\nConclusion........................................................ 12\n\npotentially perform different actions leaving an open question about\n\nAppendix A........................................................ 13\n\nStuxnet and how it came to be. The wait for the missing link is now\n\nAppendix B........................................................ 14\n\nover. Symantec have now discovered an older version of Stuxnet that\n\nAppendix C........................................................ 15\n\ncan answer the questions about the evolution of Stuxnet. This newly\n\nAppendix D........................................................ 16\n\ndiscovered variant has been dissected and analyzed in detail and here\n\nResources...........................................................17\n\nis a summary of our key findings:\n\nCommunity credits............................................17\n\n                                 - Stuxnet 0.5 is the oldest known Stuxnet version to be analyzed, in\nthe wild as early as November 2007 and in development as early\nas November 2005.\n\n                                 - Stuxnet 0.5 was less aggressive than Stuxnet versions 1.x and only\nspread through infected Step 7 projects.\n\n\n-----\n\nWhether Stuxnet 0.5 was successful is unclear, but later versions of Stuxnet were developed using a different\ndevelopment framework, became more aggressive, and employed a different attack strategy that changed the\nspeeds of the centrifuges instead instead suggesting Stuxnet 0.5 did not completely fulfill the attacker’s goals.\n\nMore versions of Stuxnet are known to exist, but have never been recovered.\n\nTable 1\n\n### Evolution\n\n##### Evolution of Stuxnet versions\n\nStuxnet 0.5 was submitted to\na malware scanning service in Version Date Description\nNovember 2007 and could have 0.500 November 3, 2005 C&C server registration\nbegan operation as early as\n\n0.500 November 15, 2007 Submit date to a public scanning service\n\nNovember 2005. This version is\ndesigned to stop compromising 0.500 July 4, 2009 Infection stop date\ncomputers on July 4, 2009, and 1.001 June 22, 2009 Main binary compile timestamp\nstop communicating with its 1.100 March 1, 2010 Main binary compile timestamp\ncommand-and-control (C&C)\n\n1.101 April 14, 2010 Main binary compile timestamp\n\nservers on an earlier date of\nJanuary 11 that same year. The 1.x June 24, 2012 Infection stop date\ncompile timestamps found within\nmost of the code appear unreliable\nand generally are in the range of the year 2001.\n\nTable 2\n##### Evolution of Stuxnet exploits\n\n###### Vulnerability 0.500 1.001 1.100 1.101 Description\n\nCVE-2010-3888 X X Task scheduler EOP\n\nCVE-2010-2743 X X LoadKeyboardLayout EOP\n\nCVE-2010-2729 X X X Print spooler RCE\n\nCVE-2008-4250 X X X Windows Server Service RPC RCE\n\nCVE-2012-3015 X X X X Step 7 Insecure Library Loading\n\nCVE-2010-2772 X X X WinCC default password\n\nCVE-2010-2568 X X Shortcut .lnk RCE\n\nMS09-025 X NtUserRegisterClassExWow/NtUserMessageCall EOP\n\nBased on an internal version number Table 3\nthis version of Stuxnet is 0.5, the Evolution of Stuxnet replication\nearliest known version of the Stuxnet\n\n###### Replication Technique 0.500 1.001 1.100 1.101\n\nfamily.\n\nStep 7 project files X X X X\n\nThe only method of replication in USB through Step 7 project files X\nStuxnet 0.5 is through infection of\n\nUSB through Autorun X\n\nSiemens Step 7 project files. Stuxnet\n0.5 does not exploit any Microsoft USB through CVE-2010-2568 X X\nvulnerabilities, unlike versions 1.x Network shares X X X\nwhich came later. Windows Server RPC X X X\n\n|Table 1 Evolution of Stuxnet versions|Col2|Col3|\n|---|---|---|\n|Version 0.500|Date November 3, 2005|Description C&C server registration|\n|0.500|November 15, 2007|Submit date to a public scanning service|\n|0.500|July 4, 2009|Infection stop date|\n|1.001|June 22, 2009|Main binary compile timestamp|\n|1.100|March 1, 2010|Main binary compile timestamp|\n|1.101|April 14, 2010|Main binary compile timestamp|\n|1.x|June 24, 2012|Infection stop date|\n||||\n\n|Table 2 Evolution of Stuxnet exploits|Col2|Col3|Col4|Col5|Col6|\n|---|---|---|---|---|---|\n|Vulnerability CVE-2010-3888|0.500|1.001|1.100 X|1.101 X|Description Task scheduler EOP|\n|CVE-2010-2743|||X|X|LoadKeyboardLayout EOP|\n|CVE-2010-2729||X|X|X|Print spooler RCE|\n|CVE-2008-4250||X|X|X|Windows Server Service RPC RCE|\n|CVE-2012-3015|X|X|X|X|Step 7 Insecure Library Loading|\n|CVE-2010-2772||X|X|X|WinCC default password|\n|CVE-2010-2568|||X|X|Shortcut .lnk RCE|\n|MS09-025||X|||NtUserRegisterClassExWow/NtUserMessageCall EOP|\n\n\nWhether Stuxnet 0.5 was successful is unclear, but later versions of Stuxnet were developed using a different\n\n\nThere are differences in exploited\nvulnerabilities and spreading\nmechanisms between Stuxnet\nversions.\n\n|Table 3 Evolution of Stuxnet replication|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|Replication Technique Step 7 project files|0.500 X|1.001 X|1.100 X|1.101 X|\n|USB through Step 7 project files|X||||\n|USB through Autorun||X|||\n|USB through CVE-2010-2568|||X|X|\n|Network shares||X|X|X|\n|Windows Server RPC||X|X|X|\n|Printer spooler||X|X|X|\n|WinCC servers||X|X|X|\n|Peer-to-peer updating through mailslots|X||||\n\n\nPeer-to-peer updating through RPC X X X\n\n\n-----\n\nStuxnet 0.5 is partly based on the Flamer platform whereas 1.x versions were based primarily on the Tilded\nplatform. Over time, the developers appear to have migrated more towards the Tilded platform. The developers\nactually re-implemented Flamer-platform components using the Tilded platform in later versions.\n\nBoth the Flamer and Tilded platform code bases are different enough to suggest different developers were\ninvolved.\n\nStuxnet 0.5 also contains code to attack the valve systems in a uranium enrichment facility rather than\nmodifying centrifuge speeds, as in versions 1.x of Stuxnet.\n\n### Installation and load point\n\nStuxnet 0.5 arrives as an infected Step 7 project archive containing both the s7hkimdb.dll and XR000001.MDX\n[files. Using the Multiple Siemens SIMATIC Products DLL Loading Arbitrary Code Execution Vulnerability (CVE-](http://www.securityfocus.com/bid/54651)\n2012-3015), the S7hkimdb.dll file is executed, which then decrypts and injects the main XR00001.MDX Stuxnet\nbinary file into the services.exe process. Stuxnet is now executing on the system.\n\nOnce injected into the services.exe process, a copy of the main Stuxnet binary and a companion DLL that\nimplements the payload are saved to disk in encrypted form along with a MRXCLS.SYS load point driver. The\nmain Stuxnet binary refers to itself as outbreak.dll and is saved to disk as oem7a.pnf. The companion DLL that\nimplements the payload refers to itself as installation.dll and saved to disk as oem7w.pnf. When the system is\nbooted, the MRXCLS.SYS load point driver will decrypt configuration data stored in the registry, decrypt the\nmain Stuxnet binary, and inject it into the Explorer and Step 7 processes. The payload DLL will be decrypted as\nwell and injected into the Explorer process. When loading dynamic-link library (DLL) resources, Stuxnet makes\nuse of a module that mimics LoadLibrary rather than calling LoadLibrary itself. This technique is likely\nused to avoid security software and was not seen in versions 1.x of Stuxnet.\n\nA second driver, PCIBUS.SYS, is also created which causes a forced reboot by generating a BSoD (Blue Screen of\nDeath) 20 days after installation.\n\nA third driver, USBACC11.SYS, is then installed. This driver is similar to the MRXCLS.SYS driver, but instead\ndecrypts and injects DLLs for peer-to-peer and C&C communication into the svchost.exe and Internet Explorer\nprocesses.\n\nThe structure and organization as well as resource and export listings of each component is available in\nAppendix D.\n\nStuxnet 0.5 also checks the current date in a variety of code paths and will not continue to spread after July 4,\n2009. Certain modules may also not be created or loaded if security software is present. A list is available in\nAppendix B.\n\nA variety of additional files are created, including log files and configuration files. A list is available in Appendix\nA.\n\n### Replication\n\nStuxnet 0.5 uses one form of replication through Step 7 project archives. When a removable drive is inserted in\nan infected system, Stuxnet 0.5 will infect any Step 7 project archives with a .s7p or .zip file name extension on\nthe drive. In addition, Step 7 project archives on the local disk will also be infected.\n\nTherefore Stuxnet 0.5 spreads to additional machines through removable drives or through human-initiated\nsharing of infected Step 7 project archives, for example through email.\n\n[Stuxnet 0.5 infects Step 7 project archives in the same manner as Stuxnet 1.x versions (as described in W32.](http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/w32_stuxnet_dossier.pdf)\n\n\n-----\n\n[Stuxnet Dossier, Step 7 Project File Infections). The following is an example file listing of an infected Step 7](http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/w32_stuxnet_dossier.pdf)\nproject file.\n\nApiLog/Types – modified to trigger DLL loading vulnerability\nXUTILS/links/S7P00001.DBF – configuration file\nXUTILS/listen/S7000001.MDX – payload DLL (installation.dll)\nXUTILS/listen/XR000000.MDX – main Stuxnet binary (outbreak.dll)\nhOmSave7/subfolder/s7hkimdb.dll - loader\n### Command-and-control\n\nSimilar to Stuxnet 1.x versions, Stuxnet 0.5 has limited command-and-control ability. In particular, Stuxnet\n0.5 does not provide fine grained control to its authors. Instead, Stuxnet 0.5 can only download new code and\nupdate itself. Stuxnet needs to ultimately spread on isolated networks with no Internet access, therefore it has\nbeen designed to be autonomous to reduce the need for robust and fine grained command-and-control. Stuxnet\n0.5 also uses a secondary peer-to-peer mechanism to propagate these code updates to peers on networks\ninaccessible to the broader Internet.\n\nCommand-and-control is implemented by the inetpsp.dll file while peer-to-peer communications are\nimplemented by the netsimp32.dll file. Both files are loaded by the usbacc11.sys driver and then injected into\nthe svchost.exe and iexplore.exe processes.\n\nStuxnet 0.5 has four C&C servers, all of which are now either unavailable or have since been registered by an\nunrelated party:\n\n    - smartclick.org\n\n    - best-advertising.net\n\n    - internetadvertising4u.com\n\n    - ad-marketing.net\n\nInterestingly, Stuxnet 0.5 is programmed to stop contacting the C&C server after January 11, 2009, even though\nthe threat is programmed to only stop spreading after a later date of July 4, 2009.\n\n\nThe C&C server domains were\ncreated in 2005 and all displayed\nthe same front page purporting\nto be an Internet advertising\nagency named Media Suffix\n(figure 1) with the tag line\n“Believe What the Mind Can\nDream”.\n\nThe servers were hosted on\ncommercial hosting providers\nin the United States, Canada,\nFrance, and Thailand. The fact\nthat these domains were in\noperation since 2005, suggests\nthat the Stuxnet project started\nmore than seven years ago.\n\n\nFigure 1\n###### Internet advertising agency homepage for Stuxnet C&C servers\n\n\n-----\n\nThe first request by Stuxnet 0.5 uses the following form:\n\nhttp://<domain>/cgi/link.php?site=xx\n\nThis notifies the C&C server of an active successful infection. Next, Stuxnet 0.5 sends the following request:\n\nhttp://<domain>/cgi/click.php?xite=xx&num=yy&c=1&j=%x&k=%x&l=%x\n\nThis may download and execute a file if an update is available.\n\nThe final target network for Stuxnet 0.5 was likely isolated from the Internet. To allow updates to reach these\nmachines, Stuxnet 0.5 also used a peer-to-peer mechanism. As long as one updated version was introduced into\nthis network—for example through an infected USB key—all the other infected machines on the network could\nreceive updates or new code modules.\n\nStuxnet 0.5 uses Windows mailslots for peer-to-peer communication. Mailslots allow a process to pass a\nmessage to another process on a remote machine. Stuxnet 0.5 enumerates all machines on the network and\nattempts to connect to a mailslot named \\\\[REMOTE MACHINE NAME]\\mailslot\\svchost. It then provides\na callback mailslot name of \\\\[LOCAL MACHINE NAME]\\mailslot\\imnotify.\n\nStuxnet 0.5 uses these mailslots for peer-to-peer communication and to pass code updates. In addition, Stuxnet\n0.5 may configure systems to allow anonymous logins and then provides the following file shares:\n\n    - temp$\n\n    - msagent$\n\n   - SYSADMIN$\n\n    - WebFiles$\n\nThis allows file retrieval by peer infections. Shared files include:\n\n%WinDir%\\msagent\\agentsb.dll\n%WinDir%\\msagent\\intl\\agt0f2e.dll\n%WinDir%\\system32\\complnd.dll\n%WinDir%\\system32\\dllcache\\datacprs.dll\n%WinDir%\\system32\\wbem\\perfnws.dll\n%WinDir%\\Installer\\{6F716D8C-398F-11D3-85E1-005004838609}\\places.dat\n### Payload\n#### Man-in-the-Middle\n\nIn order to both fingerprint the target system and inject malicious Programmable Logic Controller (PLC) code,\nStuxnet 0.5 replaces two Step 7 DLLs in order to hijack communications with a PLC.\n\nThe first DLL, s7otbxdx.dll, is hijacked in order to insert the malicious PLC code. The same technique was used in\n[Stuxnet versions 1.x (as described in W32.Stuxnet Dossier, Modifying PLCs). Stuxnet 0.5 hooks fewer exports and](http://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/w32_stuxnet_dossier.pdf)\nverifies the CPU is a 417 PLC rather than a 315 PLC, otherwise the behavior remains generally the same.\n\nThe second DLL, s7aaapix.dll, is used for fingerprinting the target system and building DB8061, a PLC data block\nneeded to conduct the attack. The export AUTDoVerb is hijacked and the malicious s7otbxdx.dll file can call the\nexport with magic values (0x91E55A3D, 0x996AB716, 0x4A5CBB03) in order to build or provide a previously\nbuilt DB8061 data block for injection. Stuxnet hijacks AUTDoVerb in order to monitor any “DOWNLOAD” verb\nactions, which signifies the fingerprinting and building of DB8061 must occur again in order to ensure the target\nsystem is still correctly configured.\n\n\n-----\n\nTable 4\n\n### Fingerprinting and building DB8061\n\nThe building of the DB8061 block is a complicated and Stuxnet 0.5 hooks fewer exports\nlengthy process. Stuxnet v0.500 Stuxnet v1.xxx\n\nThrough the hijacked export, Stuxnet 0.5 will receive a s7_event s7_event\npointer to the most recently used block (PLC programs s7ag_bub_cycl_read_create\nconsist of code and data blocks). Stuxnet 0.5 will then\n\ns7ag_bub_read_var\n\ntraverse the project structure in order to find the symbols\n\ns7ag_bub_read_var_seg\n\nused by the S7 Program in the active project. Symbols\nare human designated labels representing each device s7ag_bub_write_var\ncontrolled by the PLC. The symbol labels loosely follow the s7ag_bub_write_var_seg\n[ANSI/ISA S5.1 Instrumentation Symbols and Identification](http://www.isa.org/Template.cfm?Section=Standards8&Template=/Ecommerce/ProductDisplay.cfm&ProductID=10768) s7ag_link_in\nstandard used in Piping and Instrumentation Diagrams\n\ns7ag_read_szl s7ag_read_szl\n\n(P&ID).\n\ns7ag_test s7ag_test\n\nStuxnet 0.5 uses these labels for both fingerprinting and s7blk_delete s7blk_delete\ndetermining the addresses of each device in order to modify\n\ns7blk_findfirst s7blk_findfirst\n\nthe behavior of those devices.\n\ns7blk_findnext s7blk_findnext\n\n##### Symbol label parsing s7blk_read s7blk_read\n\ns7blk_write s7blk_write\n\nThe target system must be a SIMATIC 400 Station\n(0x14109A) or SIMATIC H-Station (0x141342), which use s7db_close\n417 PLCs. The symbol labels must match the format: s7db_open s7db_open\n\n<delimiter><FunctionIdentifier><delimiter><C\nascadeModule><delimiter><CascadeNumber><Dev\niceNumber>\n\nA valve in module A21, also in cascade 8, and associated with centrifuge 160, would have the symbol label PVA21-8-160, for example.\n\nEach field is defined as follows:\n\n###### Delimiter\n\nEither space (“ “), hyphen (“-”), underscore (“_”), or not present at all.\n\n###### FunctionIdentifer\n\nA string that matches a set of strings (available in Appendix C) that loosely follows the ANSI/ISA S5.1\nInstrumentation Symbols and Identification standard. If the string is “PIA” (Pressure Indicator Alarm), it is\nexpected to be followed by a one digit number. These strings will represent the device type (a valve, a transducer,\nor a status light, for instance).\n\n###### CascadeModule\n\nMust be the string “A21” to “A28” inclusive. These strings match cascade modules in Natanz, Iran, seen publicly\ndescribed as “A24”, “A26”, and “A28”.\n\n###### CascadeNumber\n\nSingle character that is in the letter range A to R. If it is not in this letter range, it checks to see if it is two digits\nin the decimal range 00 to 18. This two digit number is the number representation of the letter for A to R.\n\n|Table 4 Stuxnet 0.5 hooks fewer exports|Col2|\n|---|---|\n|Stuxnet v0.500 s7_event|Stuxnet v1.xxx s7_event|\n||s7ag_bub_cycl_read_create|\n||s7ag_bub_read_var|\n||s7ag_bub_read_var_seg|\n||s7ag_bub_write_var|\n||s7ag_bub_write_var_seg|\n||s7ag_link_in|\n|s7ag_read_szl|s7ag_read_szl|\n|s7ag_test|s7ag_test|\n|s7blk_delete|s7blk_delete|\n|s7blk_findfirst|s7blk_findfirst|\n|s7blk_findnext|s7blk_findnext|\n|s7blk_read|s7blk_read|\n|s7blk_write|s7blk_write|\n||s7db_close|\n|s7db_open|s7db_open|\n\n\n-----\n\n###### DeviceNumber\n\nThis is parsed in a more complex fashion depending on the device type as determined by the function identifier\nand caters to three possible cascade arrangements. The device type mappings to function identifiers are\navailable in Appendix C.\n\n###### Device type 0\n\nA string of digits: If the length of the digits is less than three, the device type is changed to device type 6. If\nthe length of the digits is greater than or equal to three, the device type is changed to device type 7.\n\n###### Device type 1, 2, 3\n\n“##”: A two digit number in the range 1 to 25.\n\n###### Device type 4, 5, or 7\n\nDevice type 4, 5, or 7 has three different formats:\n\n###### Format 1\n\n“####”: Decoded as two separate two-digit numbers representing the stage number and the centrifuge\nnumber within the stage, respectively. The stage number must be in the decimal range 1 to 15, which\nmatches with the known Natanz configuration. For each of these 15 stages, the maximum number of\nexpected centrifuges in each corresponding stage is looked up in the following array.\n\nTable 5\n##### Stage numbers with expected numbers of centrifuges\n\n###### Stage 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15\n Max # 2 2 4 6 8 10 12 16 20 24 20 16 12 8 4\n\nThis means, for example, stage 3 is expected to have a second two digit number equal to 4 or less. This\nrequirement is consistent with the centrifuge arrangement within a cascade.\n\n###### Format 2\n\n“###”: A three digit number that must be less than 164, which is the number of centrifuges in a cascade.\n\n###### Format 3\n\n“##L”: A two digit number followed by a letter. The letter must be in the range A to D, and the number\nmust be in the decimal range 1 to 43. This arrangement sub-divides each stage into sub-clusters of four.\n\n###### Device type 6\n\n“##”: A two digit number in the range 1 to 30.\n\n###### Device type 8, 9, B, or C\n\n“##”: A two digit number in the range 1 to 3.\n\n|Table 5 Stage numbers with expected numbers of centrifuges|Col2|Col3|Col4|Col5|Col6|Col7|Col8|Col9|Col10|Col11|Col12|Col13|Col14|Col15|Col16|\n|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|\n|Stage|1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|\n|Max #|2|2|4|6|8|10|12|16|20|24|20|16|12|8|4|\n|||||||||||||||||\n\n\n-----\n\n###### Device type A\n\n“##<delimiter><string>”: A two digit number in the range 1 to 3 with an optional string preceded by a\ndelimiter character. The string must start with the letter S and contain the letter P. If the string is present,\nthe device is modified to be device type 0xB instead (Flow Rate Transmitter Controller Output, rather than\ndevice type 0xA which is Flow Rate Transmitter Controller Input).\n\nBased on the symbol fingerprinting, the following table summarizes what devices and labels Stuxnet looks for\nwithin the symbol table.\n\nTable 6\n##### Summary of Stuxnet symbol label parsing\n\n###### Devices per cascade Device type P&ID function identifier\n Min Max\n\nAuxiliary valve {HS, HV, PV, EP}, {ZLO,ZO},{ZLC,ZC} 2 25\n\nCentrifuge valve {MVS, RVS, VS}, {MV,RV,SV,YV} 163 164\n\nStage pressure transducer PT, PCV, PIA#, PIT, PIC, PI, PS 3 30\n\nCentrifuge pressure transducer PT, PCV, PIA#, PIT, PIC, PI, PS 0 164\n\nFlow rate sensor {FIA}, {FIT}, {FITC},FIC,FT,MFC,MFM} 0 3\n\n##### Symbol address parsing\n\nEach symbol label will have two corresponding addresses: -- the address in the process image area and the\ndirect peripheral address of the device represented by the symbol. Modifying the memory at these addresses\nallows the PLC to control and read the behavior of the associated device. For example, the value may be a\nBoolean value turning a switch on or off, or a 16-bit value representing the current temperature of the system.\nAddresses can be either outputs (the PLC sets the value to modify the behavior of the device) or inputs (the PLC\nreads the value to determine the current state of the device).\n\nDevice types 0, 1, 5, and B must be output addresses and device types 2, 3, 4, 5, 6, 7, 8, 9, A, and C must be\ninput addresses.\n\nValues at addresses for device types 0, 1, 2, 3, 4, and 5 must be bit values. Values at addresses for device types\n6, 7, 8, 9, A, B, and C must be 16-bit values.\n\n##### Cascade rating and building DB8061\n\nAfter parsing the symbols and addresses for each cascade, the code inspects the configuration of each cascade.\nDepending on the configuration, a rating is calculated. Certain devices in certain configurations will result in\nhigher ratings. When complete, only the six highest-rated cascades have data written to DB8061.\n\nFinally, a flag is set signifying DB8061 has been built. This flag is reset to 0 every time the “DOWNLOAD” verb is\nexecuted.\n\n|Table 6 Summary of Stuxnet symbol label parsing|Col2|Col3|Col4|\n|---|---|---|---|\n|Device type Auxiliary valve|P&ID function identifier {HS, HV, PV, EP}, {ZLO,ZO},{ZLC,ZC}|Devices per cascade||\n|||Min 2|Max 25|\n|Centrifuge valve|{MVS, RVS, VS}, {MV,RV,SV,YV}|163|164|\n|Stage pressure transducer|PT, PCV, PIA#, PIT, PIC, PI, PS|3|30|\n|Centrifuge pressure transducer|PT, PCV, PIA#, PIT, PIC, PI, PS|0|164|\n|Flow rate sensor|{FIA}, {FIT}, {FITC},FIC,FT,MFC,MFM}|0|3|\n|||||\n\n\n-----\n\n#### PLC device attack code\n\nThe code conducts an attack by closing valves in the six top rated cascades out of the possible 18 cascades. The\nstates of two types of valves are modified:\n\n  - Centrifuge valves – a set of three valves (feed, product, tails) that work in unison per centrifuge to control\nuranium hexafluoride (UF6) flow into each centrifugeStage valves – one per stage to control UF6 flow into each\nstage\n\n  - Auxiliary valves – valves that control UF6 flow into or out of each stage (stage valve) or the cascade as a whole\n\nFigure 2\n###### Example valve configuration showing both valve types in three stages of a cascade\n\nSimilar to version 1.x of Stuxnet, the PLC device attack code consists of a state machine with eight possible\nstates:\n\n**State 0 (Wait): Perform system identification and wait for the enrichment process to reach steady state before**\nattack. This can take approximately 30 days.\n\n**State 1 (Record): Take peripheral snapshots and build fake input blocks for replaying later.**\n\n**State 2 (Attack centrifuge valves): Begin replaying fake input signals. Close valves on most centrifuges.**\n\n**State 3 (Secondary pressure reading): Open both centrifuge and feed stage valves in the final stage of a single**\ncascade to obtain a low pressure reading.\n\n\n-----\n\n**State 4 (Wait for pressure change): Wait for desired pressure change or time limit. This can take up to**\napproximately two hours.\n\n**State 5 (Attack auxiliary valves): Open all auxiliary valves except valves believed to be near the first feed stage**\n(stage 10). Wait for three minutes in this state.\n\n**State 6 (Wait for attack completion): Wait for six minutes while preventing any state changes.**\n\n**State 7 (Finish): Reset and return to state zero.**\n\nFigure 3\n###### State flow diagram of 417 PLC device attack code\n\n**State 0:**\n\nThe code verifies the system has reached steady state by monitoring the state of each auxiliary valve and the\namount of elapsed time.\n\n- The valves must not change state for a period of 300 snapshots. In addition, the code determines if most of the\ncentrifuge valves are in the open or closed position.\n\n- All cascades must be operational for three or more days, or currently be in the down state.\n\n- At least one cascade must have been operating for more than 35 days, or collectively all cascades must have\nbeen operating for more than 297 days.\n\n- Between 3 and 7 of the first 21 auxiliary valves must have been opened in the last 2 days.\n\n\n-----\n\n- Most of the pressure readings associated with the auxiliary valves must be within an expected range.\n\nOnly if these all conditions are met does the code proceed to state 1.\n\n**State 1:**\n\nThere are 21 snapshots of the peripheral I/O values that are taken one second apart. These values are stored for\nreplay during the attack. This prevents systems and technicians from realizing the system is no longer operating as\nexpected.\n\n**State 2:**\n\nFirst, the normal operating pressure is obtained and stored for replay later. For each stage a portion of all the\ncentrifuge valves are closed, except in the feed stage (stage 10). The centrifuge valves in the feed stage remain\ncompletely open, while the centrifuge valves at both the product end and tails end are completely closed.\n\nThe particular centrifuge valves closed per stage are randomly chosen. The code will randomly chose a starting\ncentrifuge valve and then close the next one in order until the last centrifuge valve in the stage. If the total desired\nnumber of valves to close for that stage has not been reached, the code will continue from the first centrifuge valve\nin the stage until the maximum valves to close are reached.\n\nTable 7\n##### Processing stages and valves states\n\n###### Stage 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15\n Centrifuges 2 2 4 6 8 10 12 16 20 24 20 16 12 8 4\n Centrifuge\n2 2 2 4 6 8 10 13 14 0 14 13 10 8 4\n###### valves to close\n Percentage\n100% 100% 50% 67% 75% 80% 83% 81% 70% 0% 70% 81% 83% 100% 100%\n###### closed\n\n**State 3:**\n\nIn state 3, in a single cascade, both centrifuge valves in stage 1 are opened and it is likely the stage valve of stage 1 is\nalso opened. Then, the code obtains a pressure reading at stage 1. The pressure should be relatively low. This value\nis used for replay in later stages. If the normal pressure operating pressure wasn’t obtained properly in state 2, state\n3 is actually skipped and hardcoded default values are used instead.\n\n**State 4:**\n\nState 4 waits for the desired pressure change or other predetermined time limits before proceeding to state 5. If any\nof the following conditions are met, the code will continue to state 5:\n\n- The pressure of the stage 10 or stage 11 transducer (these are likely transducers for or near the feed stage) has an\nabsolute value greater than 280 units above the expected value and greater than five times the expected value.\n\n- 46 minutes after the state of an auxiliary valve has been modified from the original state recorded in state 1, with\nthe exception of auxiliary valve number 17 which is likely a stage valve near the product end.\n\n- 2 hours and 3 minutes after the attack started (since state 2) without any centrifuge valve state changes.\n\n- 2 hours and 3 minutes since at least four centrifuge valve states have been modified from the original state\nrecorded in state 1.\n\n**State 5:**\n\nIn state 5, all the auxiliary valves are opened except valve numbers 17, 18, and 20. Before continuing to state 6, the\n\n|Table 7 Processing stages and valves states|Col2|Col3|Col4|Col5|Col6|Col7|Col8|Col9|Col10|Col11|Col12|Col13|Col14|Col15|Col16|\n|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|\n|Stage|1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|\n|Centrifuges|2|2|4|6|8|10|12|16|20|24|20|16|12|8|4|\n|Centrifuge valves to close|2|2|2|4|6|8|10|13|14|0|14|13|10|8|4|\n|Percentage closed|100%|100%|50%|67%|75%|80%|83%|81%|70%|0%|70%|81%|83%|100%|100%|\n\n\n-----\n\ncode waits for at least 2 minutes and 53 seconds.\n\n**State 6:**\n\nDuring state 6, fake values continue to be replayed and any attempts to change device values are prevented for 6\nminutes and 58 seconds.\n\n**State 7:**\n\nData is reset and the code returns to state 0.\n\nBy closing all valves except the initial feed stage valves, UF6 will continue to flow into the system. This act alone\nmay cause damage to the centrifuges themselves. However, the attack expects the pressure to reach five times the\nnormal operating pressure. At this pressure, significant damage to the uranium enrichment system could occur and\nthe UF6 gas could even revert to a solid.\n\nWhether the attack succeeded in this manner or not remains unclear. Even if the attack did succeed, the attackers\ndecided to move to a different strategy in the Stuxnet 1.x versions, attacking the speed of the centrifuges instead.\n\n### Conclusion\n\nStuxnet 0.5 clarifies the evolution and history of Stuxnet. Stuxnet clearly became more aggressive over time and\nswitched development platforms as it evolved from 0.5 versions to later 1.x versions.\n\nKey parts of the 417 attack code missing from versions 1.x is fully implemented in Stuxnet 0.5. This demonstrates\nthat the 417 attack code was the first attack strategy implemented by Stuxnet. This original 417 attack code\nattempted to modify valve states during the uranium enrichment process at Natanz, Iran, to cause damage to the\ncentrifuges and the system as a whole.\n\n\nFigure 4\n###### Low-enriched uranium production (source ISIS)\n\n\nThe success of Stuxnet 0.5 remains\nunknown. However, the chart\nin figure 4 references uranium\nenrichment production at Natanz\nto key milestones of Stuxnet\ndevelopment. Interesting events\nare dips in feed or production\namounts and lower levels of\nproduction given the same or\ngreater feed amounts (shown as\ngaps between the two lines).\n\nWhile the discovery of Stuxnet\n0.5 helps to deepen our overall\nunderstanding of Stuxnet and\nwhat its goals are, versions remain\nunrecovered. If these are located,\nthey may expose other secrets\nbehind this operation and more\nclues to its origins, but obtaining\nthese other samples may prove to\nbe next to impossible.\n\n\n-----\n\n### Appendix A\n\nThe following registry entries are indicators of compromise:\n\n     - HKEY _ LOCAL _ MACHINE\\SYSTEM\\CurrentControlSet\\Services\\MRxCls\n\n     - HKEY _ LOCAL _ MACHINE\\SYSTEM\\CurrentControlSet\\Services\\usbacc11\n\n     - HKEY _ USERS\\<SID>\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\\nShellRecoveryState\n\nThe following files are indicators of compromise:\n\n    - %WinDir%\\inf\\mdmcpq3.PNF – Encrypted installation.dll\n\n    - %WinDir%\\inf\\mdmeric3.PNF – P2P configuration file\n\n    - %WinDir%\\inf\\oem6C.PNF – Log file\n\n    - %WinDir%\\inf\\oem7A.PNF – Main Stuxnet component (outbreak.dll)\n\n    - %WinDir%\\inf\\oem7F.pnf\n\n    - %WinDir%\\inf\\oem7w.pnf – Encrypted installation.dll\n\n    - %WinDir%\\inf\\~67.tmp – Encrypted installation.dll\n\n    - %System%\\drivers\\mrxcls.sys – Load point driver\n\n    - %System%\\drivers\\usbacc11.sys – Load point driver for C&C server modules\n\n    - %System%\\drivers\\PCIBUS.SYS – Timer driver for generating BSoD\n\n    - %System%\\comuid.dat\n\n    - %System%\\netsimp32.dll – P2P communication\n\n    - %System%\\inetpsp.dll – C&C server communication\n\n    - %System%\\perfg009.dat\n\n    - %WinDir%\\msagent\\agentsb.dll\n\n    - %WinDir%\\msagent\\intl\\agt0f2e.dll\n\n    - %System%\\complnd.dll\n\n    - %System%\\dllcache\\datacprs.dll\n\n    - %System%\\wbem\\perfnws.dll\n\n    - %WinDir%\\Installer\\{6F716D8C-398F-11D3-85E1-005004838609}\\places.dat\n\n    - %System%\\dssbase.dat – Log file\n\n    - %AllUsersProfile%\\Application Data\\Microsoft\\HTML Help\\hhorcslt.dat\n\n   - %Temp%/DF419a.tmp\n\n    - %WinDir%\\help\\winmic.fts – Configuration file for Step 7 infections\n\n\n-----\n\n### Appendix B\n\nProcesses checked for and the assumed security product associated with the process:\n\n    - umxagent, Tiny Personal Firewall\n\n     - cfgintpr, Tiny Personal Firewall\n\n    - umxldra, Tiny Personal Firewall\n\n    - amon, Tiny Activity Monitor\n\n    - UmxCfg, Tiny Personal Firewall\n\n    - UmxPol, Tiny Personal Firewall\n\n    - UmxTray, Tiny Personal Firewall\n\n    - vsmon, ZoneAlarm Personal Firewall\n\n    - zapro, ZoneAlarm Personal Firewall\n\n    - zlclient, ZoneAlarm Personal Firewall\n\n    - tds-3,TDS3 Trojan Defense Suite\n\n    - avp, Kaspersky\n\n    - avpcc, Kaspersky\n\n    - avpm, Kaspersky\n\n    - kavpf, Kaspersky\n\n    - kavi, Kaspersky\n\n    - safensec,SafenSoft\n\n    - snsmcon, SafenSoft\n\n    - filemon, Sysinternals Filemon\n\n    - regmon, Sysinternals Filemon\n\n    - FrameworkService, McAfee\n\n    - UpdaterUI, McAfee\n\n    - shstat, McAfee\n\n    - naPrdMgr, McAfee\n\n    - rapapp.exe, Blackice Firewall\n\n     - blackice.exe, Blackice Firewall\n\n    - blackd.exe, Blackice Firewall\n\n    - rcfgsvc.exe\n\n    - pfwcfgsurrogate.exe, Tiny Personal Firewall\n\n    - pfwadmin.exe, Tiny Personal Firewall\n\n    - persfw.exe, Kerio Personal Firewall\n\n    - agentw.exe, Kerio Personal Firewall\n\n    - agenta.exe, Kerio Personal Firewall\n\n    - msascui.exe, Windows Defender\n\n    - msmpeng.exe, Windows Defender\n\n    - fssm32.exe, F-Secure\n\n    - fsgk32st.exe, F-Secure\n\n    - fsdfwd.exe, F-Secure\n\n    - fsaw.exe, F-Secure\n\n    - fsavgui.exe, F-Secure\n\n    - fsav32.exe, F-Secure\n\n    - fsav.exe, F-Secure\n\n    - fsma32.exe, F-Secure\n\n    - fsm32.exe, F-Secure\n\n    - fsgk32.exe, F-Secure\n\n\n-----\n\n### Appendix C\n\nTable of each allowed function identifier, the corresponding device type, and the assumed device name.\n\n|Table 8 Function identifiers, device types, and assumed device name|Col2|Col3|\n|---|---|---|\n|Function identifier PT|Device type 0|Device name|\n|||Pressure Transmitter|\n|PCV|0|Pressure Control Valve|\n|PIA|0|Pressure Indicator Alarm|\n|PIT|0|Pressure Indicator Transmitter|\n|PIC|0|Pressure Indicator Controller|\n|PI|0|Pressure Indicator|\n|PS|0|Pressure Switch|\n|HS|1|Hand Switch|\n|HV|1|Hand Valve|\n|PV|1|Pressure Valve|\n|EP|1|Voltage (Test) Point|\n|ZLO|2|Light Position Open (Status light)|\n|ZO|2|Position Open|\n|ZLC|3|Light Position Closed|\n|ZC|3|Position Closed|\n|MVS|4|Manual Valve Switch|\n|RVS|4|Relief Valve Switch|\n|VS|4|Valve Switch|\n|SHS|4|High Frequency Switch|\n|MV|5|Manual Valve|\n|RV|5|Relief Valve|\n|SV|5|Frequency Control Valve|\n|YV|5|Valve State Indicator|\n|FIA|8|Flow Rate Indicator Alarm|\n|FITC|A|Flow Rate Indicator Transmitter Controller|\n|FIT|9|Flow Rate Indicator Transmitter|\n|FIC|C|Flow Rate Indicator Controller|\n|FT|C|Flow Rate Transmitter|\n|MFC|C|Mass Flow Controller|\n|MFM|C|Mass Flow Meter|\n\n\n-----\n\n### Appendix D\n\nOrganization of Stuxnet 0.5 components and behavior of each export.\n\nFigure 5\n###### Organization of Stuxnet 0.5 components\n\n|Table 9 Payload exports for Outbreak.dll|Col2|\n|---|---|\n|Payload exports Export 1|Description Infect Step 7 projects on insertion of removable drives|\n|Export 2|Hook Step 7 for Step 7 project infection|\n|Export 4|Uninstall routine|\n|Export 5|Verifies installation|\n|Export 6|Returns version number|\n|Export 7|Loads peer-to-peer communication data file|\n|Export 8, 9, and 10|Updates Stuxnet from infected Step 7 project archives|\n|Export 11|Inject module into services.exe|\n|Export 12|Install routine|\n|Export 13|Call export 1|\n|||\n\n\n-----\n\n### Resources\n\nW32.Duqu\n\n[http://www.symantec.com/security_response/writeup.jsp?docid=2011-101814-1119-99](http://www.symantec.com/security_response/writeup.jsp?docid=2011-101814-1119-99)\n\nW32.Flamer\n\n[http://www.symantec.com/security_response/writeup.jsp?docid=2012-052811-0308-99](http://www.symantec.com/security_response/writeup.jsp?docid=2012-052811-0308-99)\n\nW32.Stuxnet\n\n[http://www.symantec.com/security_response/writeup.jsp?docid=2010-071400-3123-99](http://www.symantec.com/security_response/writeup.jsp?docid=2010-071400-3123-99)\n\nMultiple Siemens SIMATIC Products DLL Loading Arbitrary Code Execution Vulnerability (CVE-2012-3015)\n\n[http://www.securityfocus.com/bid/54651](http://www.securityfocus.com/bid/54651)\n\nStuxnet 0.5: The Missing Link\n\n[http://www.symantec.com/connect/blogs/stuxnet-05-missing-link](http://www.symantec.com/connect/blogs/stuxnet-05-missing-link)\n\nStuxnet 0.5: Disrupting Uranium Processing At Natanz\n\n[http://www.symantec.com/connect/blogs/stuxnet-05-disrupting-uranium-processing-natanz](http://www.symantec.com/connect/blogs/stuxnet-05-disrupting-uranium-processing-natanz)\n\nStuxnet 0.5: How it Evolved\n\n[http://www.symantec.com/connect/blogs/stuxnet-05-how-it-evolved](http://www.symantec.com/connect/blogs/stuxnet-05-how-it-evolved)\n\nStuxnet 0.5: Command-and-Control Capabilities\n\n[http://www.symantec.com/connect/blogs/stuxnet-05-command-and-control-capabilities](http://www.symantec.com/connect/blogs/stuxnet-05-command-and-control-capabilities)\n\n### Community credits\n\n[Symantec would like to thank the Institute for Science and International Security (ISIS) for their continued](http://isis-online.org/)\nassistance in understanding centrifugal uranium enrichment systems.\n\n\n-----\n\n**About Symantec**\nSymantec protects the world’s information,\nand is a global leader in security, backup and\navailability solutions. Our innovative products\nand services protect people and information\nin any environment – from the smallest mobile\ndevice, to the enterprise data center, to cloudbased systems. Our world-renowned expertise\nin protecting data, identities and interactions\n\n**About the authors**\n\ngives our customers confidence in a connected\n\nGeoff McDonald - Threat Analysis Engineer\n\nworld. More information is available at\n\nLiam O Murchu - Development Manager\n\n[www.symantec.com or by connecting with](http://www.symantec.com)\n\nStephen Doherty - Sr Threat Intelligence Analyst\nEric Chien - Distinguished Engineer [Symantec at: go.symantec.com/socialmedia.](http://go.symantec.com/socialmedia)\n\n\nFor specific country offices and contact numbers, please visit our Web site. For product\ninformation in the U.S., call\ntoll-free 1 (800) 745 6054.\n\n\nSymantec Corporation\nWorld Headquarters\n350 Ellis Street\nMountain View, CA 94043 USA\n+1 (650) 527-8000\nwww.symantec.com\n\n\nCopyright © 2013 Symantec Corporation. All rights reserved.\nSymantec and the Symantec logo are trademarks or registered\ntrademarks of Symantec Corporation or its affiliates in the\nU.S. and other countries. Other names may be trademarks of\ntheir respective owners.\n\n\nAny technical information that is made available by Symantec Corporation is the copyrighted work of Symantec Corporation and is owned by Symantec\nCorporation.\n\nNO WARRANTY . The technical information is being delivered to you as is and Symantec Corporation makes no warranty as to its accuracy or use. Any use of the\ntechnical documentation or the information contained herein is at the risk of the user Documentation may include technical or other inaccuracies or typographical\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/jzbxpm7m7kakhubocrrerq0myig6befb",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2013/2013.02.26.Stuxnet_0.5/stuxnet_0_5_the_missing_link.pdf",
        "https://papers.vx-underground.org/papers/ICS SCADA/Stuxnet/Stuxnet 0.5 - The Missing Link v1.0.pdf"
    ],
    "report_names": [
        "stuxnet_0_5_the_missing_link",
        "Stuxnet 0.5 - The Missing Link v1.0.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1361968526,
    "ts_modification_date": 1361968536,
    "files": {
        "pdf": "https://archive.orkl.eu/712311f4cacd476100c7ef037e3accc740558920.pdf",
        "text": "https://archive.orkl.eu/712311f4cacd476100c7ef037e3accc740558920.txt",
        "img": "https://archive.orkl.eu/712311f4cacd476100c7ef037e3accc740558920.jpg"
    }
}