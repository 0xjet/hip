{
    "id": "f83c30ec-bb81-4fa2-a411-e68fe3edc093",
    "created_at": "2023-01-12T15:07:21.302913Z",
    "updated_at": "2025-03-27T02:05:46.836251Z",
    "deleted_at": null,
    "sha1_hash": "7383648efa1d860f35351aa374fc44d4f6f59f87",
    "title": "2021-03-25 - Perkiler malware turns to SMB brute force to spread",
    "authors": "",
    "file_creation_date": "2022-05-28T04:59:37Z",
    "file_modification_date": "2022-05-28T04:59:37Z",
    "file_size": 162729,
    "plain_text": "# Perkiler malware turns to SMB brute force to spread\n\n**[blog.malwarebytes.com/trojans/2021/03/perkiler-malware-turns-to-smb-brute-force-to-spread/](https://blog.malwarebytes.com/trojans/2021/03/perkiler-malware-turns-to-smb-brute-force-to-spread/)**\n\nMalwarebytes Labs March 25, 2021\n\n[Researchers at Guardicore have identified a new infection vector being used by the Perkiler](https://www.guardicore.com/labs/purple-fox-rootkit-now-propagates-as-a-worm/)\nmalware where internet-facing Windows machines are breached through SMB password\nbrute force.\n\nPerkiler is a complex Windows malware with rootkit components that is dropped by the\nPurple Fox exploit kit (EK) and was spread by phishing campaigns.\n\n## What is SMB?\n\nServer Message Block (SMB), aka Common Internet File System (CIFS), is the networkprotocol that enables file exchanges between Microsoft Windows computers. You will find it\nwherever Windows computers are sharing printers, files, and sometimes remote control. By\ndefault, SMB is configured to use the ports 139 and 445.\n\n## SMB vulnerability history\n\n[SMB has a history of being used by malware (coupled with a history of being enabled by](https://blog.malwarebytes.com/101/2018/12/how-threat-actors-are-using-smb-vulnerabilities/)\nmistake and exposed to the Internet by accident). The most famous example of SMBexploiting malware is WannaCry. This [worm-like outbreak spread via an operation that](https://blog.malwarebytes.com/threat-analysis/2017/05/the-worm-that-spreads-wanacrypt0r/)\n\n\n-----\n\n[hunted down vulnerable public facing SMB ports and then used the EternalBlue exploit to get](https://blog.malwarebytes.com/glossary/eternalblue/)\non the network, chained with the DoublePulsar exploit to establish persistence, and allow for\n[the installation of the WannaCry ransomware.](https://blog.malwarebytes.com/detections/ransom-wannacrypt/)\n\n## What are brute force attacks?\n\nA brute-force password attack is a relentless attempt to guess the username and password\nof one or more systems. As it sounds, a brute-force attack relies on force rather than cunning\nor skill: It is the digital equivalent of throwing everything and the kitchen sink at something.\nSome attacks will try endless combinations of usernames and passwords until finding a\ncombination that works, others will try a small number of usernames and passwords on as\nmany systems as possible.\n\nBrute force attacks are usually automated, so they don’t cost the attacker a lot of time or\nenergy. Certainly not as much as individually trying to figure out how to access a remote\nsystem. Based on a port number or another system-specific property, an attacker picks the\ntarget and the method and then sets his brute force application in motion. He can then move\non to the next target and wait to get notified when one of the systems has swallowed the\nhook.\n\n## Not a new infection method\n\nThe fact that the researchers found the Perkiler malware attacking Windows machines\nthrough SMB password brute force came as something of a surprise. Not because of the\nSMB brute force per se. SMB has always been brute forced, but why would you bother when\nyou have:\n\nEternalBlue that allows you to own every single unpatched SMB server without going\nthrough the brute force routine.\n[A few million RDP ports you can brute force with a potentially bigger gain. Remote](https://blog.malwarebytes.com/exploits-and-vulnerabilities/2020/10/brute-force-attacks-increasing/)\ndesktop is exactly what the name implies, an option to remotely control a computer\nsystem. Which is much more interesting to an attacker than just being able to drop a\nfile on an SMB server.\n\nThe answer to this question remains a mystery for now. Maybe they are planning ahead for\n[when the number of vulnerable RDP servers dries up.](https://resources.malwarebytes.com/files/2020/11/Malwarebytes-Brute-Force-Protection-RDP.pdf)\n\n## Using compromised machines\n\nPerkiler uses a large network of compromised servers to host its dropper and the payloads.\nThese servers appear to be compromised Microsoft IIS 7.5 servers. Most of these Windows\nServers are running IIS version 7.5 and Microsoft FTP, which are known to have multiple\nvulnerabilities with varying severity levels.\n\n## The rootkit\n\n\n-----\n\nOnce a machine is infected with the new variant of Perkiler, it reboots to load the rootkit\nthat’s hidden inside the encrypted payload. The purpose of this rootkit is to hide various\nregistry keys and values, files, etc. Ironically enough, the hidden rootkit was developed by a\nsecurity researcher to conduct various malware analysis tasks and to keep the research\ntasks hidden from the malware.\n\n## Infected machines\n\nOnce the machine is restarted, the malware will be executed as well. After its execution, the\nmalware will start its propagation process: the malware will generate IP ranges and start\nscanning them on port 445. When a machine responds to the SMB probe on port 445, it will\ntry to authenticate to SMB by brute-forcing usernames and passwords, or by trying to\nestablish a null session.\n\nOne interesting detail is that the malware will install an IPv6 interface on the infected\nmachine to allow the malware to port scan IPv6 addresses as well as to maximize the\nefficiency of the spread over (usually unmonitored) IPv6 subnets.\n\n## Mitigation\n\nIn theory, brute force password attacks conducted over the Internet can be defeated by even\n[moderately strong passwords (six characters should be enough). However, even the threat](https://www.usenix.org/legacy/events/hotsec07/tech/full_papers/florencio/florencio.pdf)\n[of big-game ransomware using RDP brute force attacks hasn’t been enough to get people](https://blog.malwarebytes.com/malwarebytes-news/2021/02/rdp-the-ransomware-problem-that-wont-go-away/)\nusing stronger passwords. And if the prospect of facing a $50 million ransom isn’t enough\nmotivation, it’s hard to see anything else working.\n\nLuckily there are other, easier ways to blunt brute force attacks. The best defence of all is to\nremove the SMB (or RDP, or anything else) service from the Internet entirely, if possible, or\nto put it behind a VPN protected by two-factor authentication if it isn’t possible.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-25 - Perkiler malware turns to SMB brute force to spread.pdf"
    ],
    "report_names": [
        "2021-03-25 - Perkiler malware turns to SMB brute force to spread.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536041,
    "ts_updated_at": 1743041146,
    "ts_creation_date": 1653713977,
    "ts_modification_date": 1653713977,
    "files": {
        "pdf": "https://archive.orkl.eu/7383648efa1d860f35351aa374fc44d4f6f59f87.pdf",
        "text": "https://archive.orkl.eu/7383648efa1d860f35351aa374fc44d4f6f59f87.txt",
        "img": "https://archive.orkl.eu/7383648efa1d860f35351aa374fc44d4f6f59f87.jpg"
    }
}