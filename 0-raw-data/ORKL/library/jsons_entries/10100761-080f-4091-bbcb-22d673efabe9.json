{
    "id": "10100761-080f-4091-bbcb-22d673efabe9",
    "created_at": "2023-03-03T02:06:24.410503Z",
    "updated_at": "2025-03-27T02:13:12.163842Z",
    "deleted_at": null,
    "sha1_hash": "c9fbf6cbb9f5ab705b5081e1684ca27d4b60fa30",
    "title": "2023-02-03 - Massive ESXiArgs ransomware attack targets VMware ESXi servers worldwide",
    "authors": "",
    "file_creation_date": "2023-03-01T09:13:25Z",
    "file_modification_date": "2023-03-01T09:13:25Z",
    "file_size": 744980,
    "plain_text": "# Massive ESXiArgs ransomware attack targets VMware ESXi servers worldwide\n\n**[bleepingcomputer.com/news/security/massive-esxiargs-ransomware-attack-targets-vmware-esxi-servers-worldwide/](https://www.bleepingcomputer.com/news/security/massive-esxiargs-ransomware-attack-targets-vmware-esxi-servers-worldwide/)**\n\nSergiu Gatlan\n\nBy\n[Sergiu Gatlan](https://www.bleepingcomputer.com/author/sergiu-gatlan/)\n\nFebruary 3, 2023\n02:20 PM\n8\n\n_Article updated on 2/6/23 with additional information and updated statistics._\n\nAdmins, hosting providers, and the French Computer Emergency Response Team (CERTFR) warn that attackers actively target VMware ESXi servers unpatched against a two-yearold remote code execution vulnerability to deploy a new ESXiArgs ransomware.\n\nTracked as [CVE-2021-21974, the security flaw is caused by a heap overflow issue in the](https://www.bleepingcomputer.com/news/security/vmware-fixes-critical-rce-bug-in-all-default-vcenter-installs/)\nOpenSLP service that can be exploited by unauthenticated threat actors in low-complexity\nattacks.\n\n\"As current investigations, these attack campaigns appear to be exploiting the vulnerability\nCVE-2021-21974, for which a patch has been available since 23 February 2021,\" CERT-FR\nsaid.\n\n\"The systems currently targeted would be ESXi hypervisors in version 6 x and prior to 6 7 \"\n\n\n-----\n\nTo block incoming attacks, admins have to disable the vulnerable Service Location Protocol\n(SLP) service on ESXi hypervisors that haven't yet been updated.\n\nCERT-FR strongly recommends applying the patch as soon as possible but adds that\nsystems left unpatched should also be scanned to look for signs of compromise.\n\nCVE-2021-21974 affects the following systems:\n\nESXi versions 7.x prior to ESXi70U1c-17325551\nESXi versions 6.7.x prior to ESXi670-202102401-SG\nESXi versions 6.5.x prior to ESXi650-202102101-SG\n\nâ€‹French cloud provider OVHcloud first published a report linking this massive wave of attacks\ntargeting VMware ESXi servers with the Nevada ransomware operation.\n\n\"According to experts from the ecosystem as well as autorities, they might be related to\nNevada ransomware and are using CVE-2021-21974 as compromission vector. Investigation\n[are still ongoing to confirm those assumptions,\" OVHcloud CISO Julien Levrard said.](https://blog.ovhcloud.com/ransomware-targeting-vmware-esxi/)\n\n\"The attack is primarily targetting ESXi servers in version before 7.0 U3i, apparently through\nthe OpenSLP port (427).\"\n\nHowever, the company backtracked soon after our story was released, saying they attributed\nit to the wrong ransomware operation.\n\nAt the end of the first day of attacks, approximately 120 ESXi servers were encrypted.\n\nHowever, the numbers quickly grew over the weekend, with 2,400 VMware ESXi devices\nworldwide currently detected as compromised in the ransomware campaign, according to\na [Censys search.](https://search.censys.io/search?resource=hosts&sort=RELEVANCE&per_page=25&virtual_hosts=EXCLUDE&q=services.http.response.body%3A+%22How+to+Restore+Your+Files%22+and+services.http.response.html_title%3A%22How+to+Restore+Your+Files%22&ct=1)\n\n\n-----\n\n[In an advisory published on February 6th, VMware confirmed that this attack exploits older](https://www.bleepingcomputer.com/news/security/vmware-warns-admins-to-patch-esxi-servers-disable-openslp-service/)\nESXi flaws and not a zero-day vulnerability.\n\nThe company advises admins to install the latest updates for ESXi servers and disable the\nOpenSLP service, which has been disabled by default since 2021.\n\n[Some admins breached in this attack said they did not have SLP enabled [1,](https://www.bleepingcomputer.com/forums/t/782193/esxi-ransomware-help-and-support-topic-esxiargs-args-extension/page-6#entry5470431) [2], adding](https://www.bleepingcomputer.com/forums/t/782193/esxi-ransomware-help-and-support-topic-esxiargs-args-extension/page-17#entry5470872)\nfurther confusion as to how servers were breached.\n\nOverall, the ransomware campaign has not seen much success considering the large\n[number of encrypted devices, with the Ransomwhere ransom payment tracking](https://ransomwhe.re/)\n[service reporting only four ransom payments for a total of $88,000.](https://twitter.com/ransomwhere_/status/1622726675006988288)\n\n[The lack of ransom payments is likely due to a VMware ESXi recovery guide created by](https://enes.dev/)\nsecurity researcher Enes Sonmez, allowing many admins to rebuild their virtual machines\nand recover their data for free.\n\n## New ESXiArgs ransomware\n\nHowever, from the ransom notes seen in this attack, they do not appear to be related to the\nNevada Ransomware, and appear to be from a new ransomware family.\n\nStarting roughly four hours ago, victims impacted by this campaign have also begun\n[reporting the attacks on BleepingComputer's forum, asking for help and more information on](https://www.bleepingcomputer.com/forums/t/782193/esxi-ransomware-help/)\nhow to recover their data.\n\nThe ransomware encrypts files with the .vmxf, .vmx, .vmdk, .vmsd, and .nvram extensions on\ncompromised ESXi servers and creates a .args file for each encrypted document with\nmetadata (likely needed for decryption).\n\nWhile the threat actors behind this attack claim to have stolen data, one victim reported in\nthe BleepingComputer forums that it was not the case in their incident.\n\n\"Our investigation has determined that data has not been infiltrated. In our case, the attacked\nmachine had over 500 GB of data but typical daily usage of only 2 Mbps. We reviewed traffic\n[stats for the last 90 days and found no evidence of outbound data transfer,\" the admin said.](https://www.bleepingcomputer.com/forums/t/782193/esxi-ransomware-help-and-support-topic-esxiargs-args-extension/page-6#entry5470443)\n\nVictims have also found ransom notes named \"ransom.html\" and \"How to Restore Your\nFiles.html\" on locked systems. Others said that their notes are plaintext files.\n\n\n-----\n\n_ESXiArgs ransom note (BleepingComputer)_\n[ID Ransomware's](https://id-ransomware.malwarehunterteam.com/) [Michael Gillespie is currently tracking the ransomware under the name](https://twitter.com/demonslay335)\n'ESXiArgs,' but told BleepingComputer that until we can find a sample, there is no way to\ndetermine if it has any weaknesses in the encryption.\n\n[BleepingComputer has a dedicated ESXiArgs support topic where people are reporting their](https://www.bleepingcomputer.com/forums/t/782193/esxi-ransomware-help-and-support-topic-esxiargs-args-extension/)\nexperiences with this attack and receiving help recovering machines.\n\n## ESXiArgs technical details\n\nLast night, an admin retrieved a copy of the ESXiArgs encryptor and associated shell script\n[and shared it in the BleepingComputer support topic.](https://www.bleepingcomputer.com/forums/t/782193/esxi-ransomware-help-and-support-topic-esxiargs-args-extension/?p=5470686)\n\nAnalyzing the script and the encryptor has allowed us to understand better how these attacks\nwere conducted.\n\nWhen the server is breached, the following files are stored in the /tmp folder:\n\n**encrypt - The encryptor ELF executable.**\n**encrypt.sh - A shell script that acts as the logic for the attack, performing various tasks**\nbefore executing the encryptor, as described below.\n**public.pem - A public RSA key used to encrypt the key that encrypts a file.**\n\n\n-----\n\n**motd - The ransom note in text form that will be copied to /etc/motd so it is shown on**\nlogin. The server's original file will be copied to /etc/motd1.\n**index.html - The ransom note in HTML form that will replace VMware ESXi's home**\npage. The server's original file will be copied to index1.html in the same folder.\n\nID Ransomware's Michael Gillespie analyzed the encryptor and told BleepingComputer the\nencryption is, unfortunately, secure, meaning no cryptography bugs allow decryption.\n\n\"The public.pem it expects is a public RSA key (my guess is RSA-2048 based on looking at\nencrypted files, but the code technically accepts any valid PEM).,\" Gillespie posted in the\n[forum support topic.](https://www.bleepingcomputer.com/forums/t/782193/esxi-ransomware-help-and-support-topic-esxiargs-args-extension/?p=5470974)\n\n\"For the file to encrypt, it generates 32 bytes using OpenSSL's secure\nCPRNG [RAND_pseudo_bytes, and this key is then used to encrypt the file using](https://www.openssl.org/docs/man1.1.1/man3/RAND_pseudo_bytes.html)\nSosemanuk, a secure stream cipher. The file key is encrypted with RSA\n(OpenSSL's [RSA_public_encrypt), and appended to the end of the file.\"](https://www.openssl.org/docs/man1.1.1/man3/RSA_public_encrypt.html)\n\n\"The use of the Sosemanuk algorithm is rather unique, and is usually only used in\nransomware derived from the Babuk (ESXi variant) source code. This may perhaps be the\ncase, but they modified it to use RSA instead of Babuk's Curve25519 implementation.\"\n\n[This analysis indicates that ESXiArgs is likely based on leaked Babuk source code, which](https://www.bleepingcomputer.com/news/security/babuk-ransomwares-full-source-code-leaked-on-hacker-forum/)\n[has been previously used by other ESXi ransomware campaigns, such as CheersCrypt and](https://www.trendmicro.com/en_us/research/22/e/new-linux-based-ransomware-cheerscrypt-targets-exsi-devices.html)\n[the Quantum/Dagon group's PrideLocker encryptor.](https://www.synacktiv.com/en/publications/pridelocker-a-new-fork-of-babuk-esx-encryptor.html)\n\nWhile the ransom note for ESXiArgs and Cheerscrypt are very similar, the encryption method\nis different, making it unclear if this is a new variant or just a shared Babuk codebase.\n\nFurthermore, this does not appear to be related to the Nevada ransomware, as previously\nmentioned by OVHcloud.\n\nThe encryptor is executed by a shell script file that launches it with various command line\narguments, including the public RSA key file, the file to encrypt, the chunks of data that will\nnot be encrypted, the size of an encryption block, and the file size.\n```\nusage: encrypt <public_key> <file_to_encrypt> [<enc_step>] [<enc_size>] [<file_size>]\n\n    enc_step  -  number of MB to skip while encryption\n\n    enc_size  -  number of MB in encryption block\n\n    file_size -  file size in bytes (for sparse files)\n\n\n```\nThis encryptor is launched using the encrypt.sh shell script that acts as the logic behind the\nattack, which we will briefly describe below.\n\nWhen launched, the script will execute the following command to modify the ESXi virtual\nmachine's configuration files (.vmx) so that the strings '.vmdk' and '.vswp' are changed to\n'1 vmdk' and '1 vswp'\n\n\n-----\n\n**Modifying VMX files**\n\n_Source: BleepingComputer_\nThe script then terminates all running virtual machines by force-terminating (kill -9) all\n[processes containing the string 'vmx' in a similar way to this VMware support article.](https://kb.vmware.com/s/article/1014165#:~:text=Sending%20signals%20on%20ESXi%20to%20power%20off%20the%20virtual%20machine)\n\nThe script will then use the 'esxcli storage filesystem list | grep \"/vmfs/volumes/\"\n```\n| awk -F' ' '{print $2}'' command to get a list of ESXi volumes.\n\n```\nThe script will search these volumes for file's matching the following extensions:\n```\n.vmdk\n\n.vmx\n\n.vmxf\n\n.vmsd\n\n.vmsn\n\n.vswp\n\n.vmss\n\n.nvram\n\n.vmem\n\n```\nFor each found file, the script will create a [file_name].args file in the same folder, which\ncontains the computed size step (shown below), '1', and the size of the file.\n\nFor example, server.vmx will have an associated server.vmx.args file.\n\nThe script will then use the 'encrypt' executable to encrypt the files based on the\ncomputed parameters, as shown in the screenshot below.\n\n\n-----\n\n**Routine to create .args files and encrypt files**\n\n_Source: BleepingComputer_\nAfter the encryption, the script will replace the ESXi index.html file and the server's motd file\nwith the ransom notes, as described above.\n\nFinally, the script performs some cleanup by deleting logs, removing a Python backdoor\ninstalled at /store/packages/vmtools.py [[VirusTotal], and deleting various lines from the](https://www.virustotal.com/gui/file/773d147a031d8ef06ee8ec20b614a4fd9733668efeb2b05aa03e36baaf082878)\nfollowing files:\n```\n/var/spool/cron/crontabs/root\n\n/bin/hostd-probe.sh\n\n/etc/vmware/rhttpproxy/endpoints.conf\n\n/etc/rc.local.d/local.sh\n\n```\n\n-----\n\n**Cleanup of various Linux configuration files and potential backdoor**\n\n_Source: BleepingComputer_\nThe /store/packages/vmtools.py file is the same custom Python backdoor for VMware\nESXi server [discovered by Juniper in December 2022, allowing the threat actors to remotely](https://blogs.juniper.net/en-us/threat-research/a-custom-python-backdoor-for-vmware-esxi-servers)\naccess the device.\n\nAll admins should check for the existence of this vmtools.py file to make sure it was\nremoved. If found, the file should be removed immediately.\n\nFinally, the script executes the /sbin/auto-backup.sh to update the configuration saved in the\n/bootbank/state.tgz file and starts SSH.\n\n_This is a developing story and will be updated with new info as it becomes available ..._\n\n_Update 2/4/23: Added technical details about the attack. - Lawrence Abrams_\n\n_Update 2/5/23: Updated with new number of encrypted ESXi servers and method to_\n_recover virtual machines._\n\n_Update 2/6/23: Added info from VMware and known ransom payments._\n\n### Related Articles:\n\n[New ESXiArgs ransomware version prevents VMware ESXi recovery](https://www.bleepingcomputer.com/news/security/new-esxiargs-ransomware-version-prevents-vmware-esxi-recovery/)\n\n[CISA releases recovery script for ESXiArgs ransomware victims](https://www.bleepingcomputer.com/news/security/cisa-releases-recovery-script-for-esxiargs-ransomware-victims/)\n\n\n-----\n\n[VMware warns admins to patch ESXi servers, disable OpenSLP service](https://www.bleepingcomputer.com/news/security/vmware-warns-admins-to-patch-esxi-servers-disable-openslp-service/)\n\n[New Nevada Ransomware targets Windows and VMware ESXi systems](https://www.bleepingcomputer.com/news/security/new-nevada-ransomware-targets-windows-and-vmware-esxi-systems/)\n\n[Linux version of Royal Ransomware targets VMware ESXi servers](https://www.bleepingcomputer.com/news/security/linux-version-of-royal-ransomware-targets-vmware-esxi-servers/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-02-03 - Massive ESXiArgs ransomware attack targets VMware ESXi servers worldwide.pdf"
    ],
    "report_names": [
        "2023-02-03 - Massive ESXiArgs ransomware attack targets VMware ESXi servers worldwide.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "1f6ae238-765f-4495-9d54-6a7883d7a319",
            "created_at": "2022-10-25T16:07:24.573456Z",
            "updated_at": "2025-03-27T02:02:10.284644Z",
            "deleted_at": null,
            "main_name": "TA511",
            "aliases": [
                "MAN1",
                "Moskalvzapoe"
            ],
            "source_name": "ETDA:TA511",
            "tools": [
                "Agentemis",
                "Chanitor",
                "Cobalt Strike",
                "CobaltStrike",
                "Ficker Stealer",
                "Hancitor",
                "NetSupport",
                "NetSupport Manager",
                "NetSupport Manager RAT",
                "NetSupport RAT",
                "NetSupportManager RAT",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "542cf9d0-9c68-428c-aff8-81b6f59dc985",
            "created_at": "2023-02-15T02:01:49.554105Z",
            "updated_at": "2025-03-27T02:00:03.110991Z",
            "deleted_at": null,
            "main_name": "Moskalvzapoe",
            "aliases": [
                "MAN1",
                "TA511"
            ],
            "source_name": "MISPGALAXY:Moskalvzapoe",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1677809184,
    "ts_updated_at": 1743041592,
    "ts_creation_date": 1677662005,
    "ts_modification_date": 1677662005,
    "files": {
        "pdf": "https://archive.orkl.eu/c9fbf6cbb9f5ab705b5081e1684ca27d4b60fa30.pdf",
        "text": "https://archive.orkl.eu/c9fbf6cbb9f5ab705b5081e1684ca27d4b60fa30.txt",
        "img": "https://archive.orkl.eu/c9fbf6cbb9f5ab705b5081e1684ca27d4b60fa30.jpg"
    }
}