{
    "id": "99390e79-2650-4f15-8fb8-685b4591731c",
    "created_at": "2023-01-12T15:07:32.501797Z",
    "updated_at": "2025-03-27T02:05:18.890245Z",
    "deleted_at": null,
    "sha1_hash": "72de5731fb9723178864be8a3cfefcb213d6ab7b",
    "title": "2022-08-29 - PureCrypter Loader continues to be active and has spread to more than 10 other families",
    "authors": "",
    "file_creation_date": "2022-09-12T12:01:23Z",
    "file_modification_date": "2022-09-12T12:01:23Z",
    "file_size": 3095459,
    "plain_text": "# PureCrypter Loader持续活跃，已经传播了10多个其它家族\n\n**blog.netlab.360.com/purecrypter**\n\nwanghao August 29, 2022\n\n29 August 2022\n/ [loader](https://blog.netlab.360.com/tag/loader/)\n在我们的日常botnet分析工作中，碰到各种loader是常事。跟其它种类的malware相比，loader的特殊之处在\n于它主要用来“推广”，即在被感染机器上下载并运行其它的恶意软件。根据我们的观察，大部分loader是专\n有的，它们和推广的家族之间存在绑定关系。而少数loader家族会将自己做成通用的推广平台，可以传播其\n它任意家族，实现所谓的malware-as-a-service（MaaS）。跟专有loader相比，MaaS类型显然更危险，更\n应该成为我们的首要关注目标。\n\n本文介绍我们前段时间看到的一个MaaS类型的loader，它名为PureCrypter，今年非常活跃，先后推广了10\n[多个其它的家族，使用了上百个C2。因为zscaler已经做过详细的样本分析，本文主要从C2和传播链条角度](https://www.zscaler.com/blogs/security-research/technical-analysis-purecrypter)\n介绍我们看到的PureCrypter传播活动，分析其运作过程。\n\n本文要点如下：\n\nPureCrypter是一款使用C#编写的loader，至少2021年3月便已出现，能传播任意的其它家族。\nPureCrypter今年持续活跃，已经传播了包括Formbook、SnakeKeylogger、AgentTesla、Redline、\nAsyncRAT等在内的10多个恶意家族。\nPureCrypter作者拥有较多的推广资源，我们检测到的C2 域名和IP多达上百个。\nPureCrypter作者喜欢使用图片名后缀结合倒置、压缩和加密等方式躲避网络检测。\nPureCrypter的推广行为传播链条普遍较长，多数会使用前置protector，甚至搭配其它loader，检测难\n度较大。\n\n总的来说，PureCrypter的传播情况可以用下图总结：\n\n下面从样本分析和典型传播案例角度做一介绍。\n\n## 样本分析\n\n\n-----\n\n[PureCrypter使用了package机制，由两个可执行文件组成：downloader和injector，它们都使用C#编写，其](https://www.zscaler.com/blogs/security-research/technical-analysis-purecrypter)\n中downloader负责传播injector，后者释放并运行最终的目标家族二进制文件。实际操作时，攻击者通过\nbuilder生成downloader和injector，然后先设法传播downloader，后者会在目标机器上下载并执行injector，\n再由injector完成其余工作。从代码逻辑上看，downloader模块相对简单，样本混淆程度较低，没有复杂的\n环境检测和持久化等操作，而injector则使用了loader里常见的奇技淫巧，比如2进制混淆、运行环境检测、\n启动傀儡进程等，下面是结合实际的例子简单介绍下downloader和injector。\n\n## downloader模块\n\n该模块直接调用WebClient的DownLoadData方法进行HTTP下载，没有设置单独的HTTP header。\n\ninjector的uri通常也是明文保存，下面是一个下载经过倒置处理的样本的变种的例子，从解析代码能看出来\nHTTP payload做了倒置处理。\n\n在末尾可发现明显的被倒置的PE Header。\n\n最后通过Assembly.Load加载恢复好的injector（.DLL文件），调用明文编码的入口方法，进入下一阶段。\n\n\n-----\n\nPureCrypter对injector下载保护这块相对简单，目前看除了上面提到的倒置（reverse）编码外，还有 gzip压\n缩、对称加密等方式，这种编码是固定的，即builder在生成downloader和injector时就已经确定好编码方\n式，不存在运行动态改变的情况。\n\n下面是使用使用gzip压缩后传输injector的例子，在流量开头可以发现GZip的magic header： `1F 8B 08`\n```\n00 。\n\n```\n我们还碰到过使用AES加密的例子。\n\n除了AES，PureCrypter还支持使用DES、RC4等加密算法。\n\n## injector模块\n\n\n-----\n\n如果分析还原好的injector，会发现普遍做了混淆处理，差别只是混淆程度的大小。下面是 例\nSmartAssembly混淆并且资源部分被加密的injector：\n\n如上图所示，首先通过Reverse + GZip + Protubuf.Deserialize组合拳，获取相关配置信息，之后是根据配置\n检查运行环境、对抗沙箱、创建互斥体、持久化等，最后从资源中获取payload加载运行。该样本没有进入\n任何一个if语句，很快到了最后一个重要函数，该函数主要实现最终payload的注入。根据配置的不同存在4\n种注入方式，傀儡进程（Process Hollowing）是被最多使用的方式。\n\n最终payload存储在资源中，解密后的资源如下图：\n\n\n-----\n\n经过Reverse + GZip解压缩后创建傀儡进程启动最终的payload。\n\n上面最终推广的payload为AgentTesla，其配置信息如下：\n```\nhost: raphaellasia.com\n\nport:587\n\nusername: origin@raphaellasia.com\n\npwd: student@1980\n\nto: origin2022@raphaellasia.com\n\n\n## 意外发现\n\n```\nPureCrypter喜欢将injector伪装成图片供downloader下载，图片名比较随机，具有明显机器生成的特点。下\n面是实际检测到的一些图片名。\n```\n# pattern 1\n\n/dl/0414/net_Gzhsuovx.bmp\n\n/dl/0528/mars2_Hvvpvuns.bmp\n\n/dl/0528/az_Tsrqixjf.bmp\n\n# pattern 2\n\n/040722/azne_Bvaquebo.bmp\n\n/04122022/net_Ygikzmai.bmp\n\n/04122022/azne_Jzoappuq.bmp\n\n/04122022/pm_Dxjlqugu.bmp\n\n/03252022/azne_Rmpsyfmd.bmp\n\n# pattern 3\n\n/Rrgbu_Xruauocq.png\n\n/Gepstl_Mouktkmu.bmp\n\n/Zhyor_Uavuxobp.png\n\n/Xgjbdziy_Kglkvdfb.png\n\n/Ankwgqtwf_Bdevsqnz.bmp\n\n/Osgyjgne_Ymgrebdt.png\n\n/Rrgbu_Xruauocq.png\n\n/Gepstl_Mouktkmu.bmp\n\n/Osgyjgne_Ymgrebdt.png\n\n/Osgyjgne_Ymgrebdt.png\n\n/Zhyor_Uavuxobp.png\n\n\n\n```\n在对多个样本进行分析后，我们发现请求的图片名与downloader的AssmblyName存在对应关系。\n\n\n-----\n\n图片名图片名 **AssmblyNameAssmblyName**\n\nBelcuesth_Ipdtbadv.png Belcuesth\n\nKzzlcne_Prgftuxn.png Kzzlcne\n\nnewminer2_Jrltkmeh.jpg newminer2\n\nBelcuesth_Ipdtbadv.png Belcuesth\n\nNykymad_Bnhmcpqo.bmp Nykymad\n\nmy_ori_Ywenb_Yzueqpjp.bmp my ori Ywenb\n\n下划线后面的内容总是符合正则表达式\n\n[A-Z][a-zA-Z]{7}\n\n基于这个发现可以结合样本和网络请求两个维度的数据确认PureCrypter的下载行为。\n\n## C2和传播分析\n\nPureCrypter今年一直在活跃，我们先后检测到的C2 域名和IP有200多个，传播的家族数10多种。在我们看\n到的案例中，传播链条普遍比较长，PureCrypter的downloader模块经常跟各种其它类型的前置downloader\n配合使用。因为C2太多，这里主要以 `185.215.113.89` 为例从规模和传播手法方面做一个介绍。\n\n## C2分析\n\n这个C2在我们检测到的C2中活跃度比较高，其活跃时间为今年4月中旬到6月初，如下图所示。\n\n其活跃程度可以用我们的图系统直观反映出来。\n\n\n-----\n\n能看到它关联到了比较多的域名和IP，下面是该IP在这段时间的部分域名解析情况。\n\n\n-----\n\n```\n                                        g\n2022-04-21 08:22:03 2022-06-13 09:17:50 15 marnersstyler.ug A\n185.215.113.89\n\n2022-04-17 03:17:41 2022-06-10 04:31:27 2538 qwertzx.ru A 185.215.113.89\n\n2022-04-24 02:16:46 2022-06-09 00:11:24 3 hubvera.ac.ug A 185.215.113.89\n\n2022-04-15 23:47:43 2022-06-08 19:24:59 43 timekeeper.ug A 185.215.113.89\n\n2022-04-15 11:34:35 2022-06-08 19:24:59 35 boundertime.ru A 185.215.113.89\n\n2022-04-14 23:01:50 2022-06-08 15:33:25 24 timebound.ug A 185.215.113.89\n\n2022-04-15 21:58:54 2022-06-08 05:43:21 7 www.rockrock.ug A 185.215.113.89\n\n2022-04-16 20:50:41 2022-06-08 01:44:01 54 beachwood.ug A 185.215.113.89\n\n2022-04-23 16:23:41 2022-06-07 18:30:51 5 asdsadasrdc.ug A 185.215.113.89\n\n2022-05-02 22:35:40 2022-06-07 04:34:12 17 leatherlites.ug A 185.215.113.89\n\n2022-05-29 17:46:00 2022-06-07 03:50:36 3 underdohg.ac.ug A 185.215.113.89\n\n2022-04-15 22:34:53 2022-06-07 03:33:10 18 rockphil.ac.ug A 185.215.113.89\n\n2022-04-15 03:09:13 2022-06-07 03:19:50 14 pdshcjvnv.ug A 185.215.113.89\n\n2022-04-15 03:04:12 2022-06-07 03:12:04 16 mistitis.ug A 185.215.113.89\n\n2022-04-16 03:08:46 2022-06-07 03:08:48 18 nicoslag.ru A 185.215.113.89\n\n2022-04-19 02:33:31 2022-06-07 02:37:08 16 danwisha.ac.ug A 185.215.113.89\n\n2022-05-28 23:56:02 2022-06-05 05:14:50 7 underdohg.ug A 185.215.113.89\n\n2022-05-10 14:44:28 2022-06-02 17:40:12 24 jonescourtney.ac.ug A\n185.215.113.89\n\n2022-06-02 07:44:25 2022-06-02 07:44:25 1 triathlethe.ug A 185.215.113.89\n\n2022-04-24 03:05:38 2022-06-01 16:54:59 2191 qwertasd.ru A 185.215.113.89\n\n2022-04-17 09:34:27 2022-06-01 01:42:07 2 partaususd.ru A 185.215.113.89\n\n2022-04-25 00:08:53 2022-05-31 07:17:00 5 timecheck.ug A 185.215.113.89\n\n2022-04-21 02:36:41 2022-05-31 01:20:37 21 courtneyjones.ac.ug A\n185.215.113.89\n\n2022-04-16 19:09:02 2022-05-31 01:02:02 14 marksidfgs.ug A 185.215.113.89\n\n2022-04-25 03:01:15 2022-05-30 03:04:29 10 mofdold.ug A 185.215.113.89\n\n2022-04-15 02:36:21 2022-05-30 02:32:53 17 check-time.ru A 185.215.113.89\n\n2022-04-18 02:21:26 2022-05-30 02:22:30 17 agenttt.ac.ug A 185.215.113.89\n\n2022-04-17 03:17:46 2022-05-29 03:17:26 15 qd34g34ewdfsf23.ru A\n185.215.113.89\n\n2022-04-19 02:25:06 2022-05-29 02:22:57 14 andres.ug A 185.215.113.89\n\n2022-04-16 02:27:44 2022-05-29 02:22:47 16 asdasgs.ug A 185.215.113.89\n\n```\n第3列为访问量，不同域名访问量有差别，整体评估应该在千级，而这只是我们看到的众多C2中的一个。\n\n通过关联分析，我们发现 `185.215.113.89 经常跟` `62.204.41.69 (3月)和` `45.143.201.4 （6月）这两个`\nC2配合使用，它们关系可以用下图关联。\n\n\n-----\n\n## 传播分析\n\nPureCrypter采用了downloader+injector的双模块机制，前者被传播后再传播后者，相当于在传播链条上增\n加了一环，加上作者惯用图片名后缀、编码传输等手段隐藏injector，这些本身就已足够复杂。而作者在\ndownloader传播这块也下了不少功夫，我们看到的有通过bat2exe捆绑破解软件的方式、使用VBS和\npowershell脚本loader的方式、结合Godzilla前置loader等多种方式，这些操作叠加起来的结果就是\nPureCrypter的传播链条普遍较深较复杂。在5月份我们甚至发现通过PureCrypter传播Raccoon，后者进一步\n传播Azorult、Remcos、PureMiner、PureClipper的案例。\n\n\n-----\n\n下面介绍几个典型传播手法。\n\n这个主要在一些破解软件上有见到，downloader模块通过Bat2Exe捆绑到前者进行传播。实际运行时保存在\n资源中的恶意文件被释放到tmp目录下，通过start.bat来触发运行。释放在tmp目录下的文件形如下图：\n\nstart.bat命令形如：\n\n在我们分析的案例中，.lnk文件被用来启动powershell执行恶意命令。\n\n\n-----\n\nPowershell解码出一个base64编码的VBS loader：\n\nVBS loader进一步释放一个downloader，并通过shellcode运行后者。该downloader的敏感信息都保存在资\n源中，包括进程名和download url，如下图所示。\n\n根据运行后的进程名将该downloader命名为 `Meteorite ，上图中的url就对应PureCrypter的downloader模`\n块，完整的通信过程如下图：\n\n\n-----\n\n最终payload为Mars Stealer，c2: `rockrock.ug/gggate.php ，配置信息如下:`\n\n### 2，“VBS/Powershell + PureCrypter” 传播PureMiner\n\n涉及的C2为 `89.34.27.167 ，入口为一个VBS脚本或者Powershell脚本，下面是VBS脚本的例子。`\n\n网络通信流量如下：\n\nPowershell脚本如下：\n\n\n-----\n\nPowershell脚本下载并运行PureCrypter的downloader模块，后者继续下载injector，这里比较特殊的是使用\nDiscord来分发injector:\n\n最终的payload为PureMiner，C2如下:\n```\n185.157.160.214\n\npwn.oracleservice.top\n\npwn.letmaker.top\n\nport: 8080, 8444\n\n\n### 3，利用未知.NET downloader传播 AgentTesla、RedLine\n\n```\n该downloader家族未知，其运行时同样分为多个阶段，其中stage0模块负责加载资源中的stage1恶意模块：\n\nstage1模块运行后会继续加载下一阶段模块stage2：\n\n\n-----\n\nstage2模块也是一个Crypter(暂未命名)，与PureCrypter不同，他还提供了下载功能，用来下载恶意\nPureCrypter的downloader模块，即图中的 `puty.exe 。`\n\n从资源中异或解密恶意软件，key为 `bnvFGkCKlnhQ ，相关算法如下：`\n\n因此实际传播了两个家族：\n\nstage2的payload为AgentTesla，c2为\n\n```\nhttps[:]//api.telegram.org/bot5421147975:AAGrsGnLOHZfFv7yHuj3hZdQSOVmPodIAVI/sendDocument\n\n```\n\nPureCrypter的payload为RedLine，c2为\n\n\n-----\n\n```\nID: cheat\n\n## 总结\n\n```\nPureCrypter是一个仍在活跃的MaaS类型的botnet，已经传播了10多种影响比较大的其它恶意家族。\nPureCrypter的传播手法普遍比较复杂，其背后应该存在至少一个比较专业的黑产组织，他们拥有较多的技\n术、域名和IP资源，预计今后会继续传播其它的恶意家族。我们对PureCrypter的传播活动一直有较好的检\n测，会第一时间将C2等威胁信息添加到我们的威胁情报库中。后续我们会继续保持关注，及时更新最新的威\n胁信息。\n\n## 联系我们\n\n感兴趣的读者，可以在 **[twitter](https://twitter.com/360Netlab)** 或者通过邮件netlab[at]360.cn联系我们。\n\n## IOC\n\n### MD5\n\n**Family Name** **MD5**\n\nBat2Exe Downloader 424ed5bcaae063a7724c49cdd93138f5\n\nVBS downloader 3f20e08daaf34b563227c797b4574743\n\nPowershell downloader c4c5167dec23b6dd2d565cd091a279e4\n\n未知.NET Downloader 9b70a337824bac612946da1432295e9c\n\n### C2 &URL\n\n\n-----\n\n```\n g g\nandres.ug\n\nasdasgs.ug\n\nasdsadasrdc.ug\n\nbeachwood.ug\n\nboundertime.ru\n\ncheck-time.ru\n\ncourtneyjones.ac.ug\n\ndanwisha.ac.ug\n\nhopeforhealth.com.ph\n\nhubvera.ac.ug\n\njonescourtney.ac.ug\n\nleatherlites.ug\n\nmarksidfgs.ug\n\nmarnersstyler.ug\n\nmistitis.ug\n\nmofdold.ug\n\nmomomolastik.ug\n\nnicoslag.ru\n\npartaususd.ru\n\npdshcjvnv.ug\n\nqd34g34ewdfsf23.ru\n\nqwertasd.ru\n\nqwertzx.ru\n\nraphaellasia.com\n\nrockphil.ac.ug\n\nrockrock.ug\n\ntimebound.ug\n\ntimebounder.ru\n\ntimecheck.ug\n\ntimekeeper.ug\n\ntriathlethe.ug\n\nunderdohg.ac.ug\n\nunderdohg.ug\n\nwww.rockrock.ug\n\n212.192.246.195\n\n37.0.11.164:8080\n\n80.66.75.123\n\n89.34.27.167\n\n91.243.44.142\n\n185.215.113.89\n\n62.204.41.69\n\n45.143.201.4\n\nhttps://cdn.discordapp.com/attachments/994652587494232125/1004377750762704896/ps1-6_Hjuvcier.png\n\n```\n\n-----",
    "language": "ZH",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-29 - PureCrypter Loader continues to be active and has spread to more than 10 other families.pdf"
    ],
    "report_names": [
        "2022-08-29 - PureCrypter Loader continues to be active and has spread to more than 10 other families.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536052,
    "ts_updated_at": 1743041118,
    "ts_creation_date": 1662984083,
    "ts_modification_date": 1662984083,
    "files": {
        "pdf": "https://archive.orkl.eu/72de5731fb9723178864be8a3cfefcb213d6ab7b.pdf",
        "text": "https://archive.orkl.eu/72de5731fb9723178864be8a3cfefcb213d6ab7b.txt",
        "img": "https://archive.orkl.eu/72de5731fb9723178864be8a3cfefcb213d6ab7b.jpg"
    }
}