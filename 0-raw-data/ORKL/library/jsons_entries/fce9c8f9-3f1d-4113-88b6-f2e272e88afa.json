{
    "id": "fce9c8f9-3f1d-4113-88b6-f2e272e88afa",
    "created_at": "2023-01-12T15:02:01.370444Z",
    "updated_at": "2025-03-27T02:09:29.728097Z",
    "deleted_at": null,
    "sha1_hash": "b22c53b23e52fa12590e99fa214cfeb94b5b1548",
    "title": "2020-10-13 - Tracing fresh Ryuk campaigns itw",
    "authors": "",
    "file_creation_date": "2022-05-28T00:39:24Z",
    "file_modification_date": "2022-05-28T00:39:24Z",
    "file_size": 1355186,
    "plain_text": "# Tracing fresh Ryuk campaigns itw\n\n**[blog.virustotal.com/2020/10/tracing-fresh-ryuk-campaigns-itw.html](https://blog.virustotal.com/2020/10/tracing-fresh-ryuk-campaigns-itw.html)**\n\nRyuk is one of the most dangerous Ransomware families. It is (allegedly) run by a\nspecialized cybercrime actor that during the last 2 years mainly focused on targeting\nenterprise environments. The amount of bitcoins demanded in their ransom attacks varies\ndepending on the target. Some of the wallets used by the group to collect the ransom\npayments reached millions of dollars in a few weeks.\n\nProtecting against such attacks is one of the main priorities for any CISO or security team.\nThis is a problem that should be approached from different perspectives, being prevention\n(likely) the most relevant one.\n\nNow, what can be done in terms of prevention? Information is power, the first thing we need\nis understanding how the new campaigns are operating. Is this distributed through phishing\nor exploiting any vulnerabilities? Do they use brute force attacks? Maybe all together?\n\nIn addition to the TTPs described above, we want as many technical details as possible. This\nwill result in very valuable Indicators of Compromise we can use for protecting our\ninfrastructure: deploying networking indicators to disrupt malware communication, making\nsure our Yara rules will detect all the components of the attack, launching regular scans in\nour infrastructure to detect any artefact used in the campaign.\n\nWe need to quickly deploy our fishing nets to catch everything related to fresh new\ncampaigns! And then to keep monitoring for a while to make sure we keep our systems\nupdated as attackers evolve.\n\nIn this blogpost we will describe how we used VirusTotal to detect and monitor new Ryuk\nactivity. However this is a very specific case where we want to show how our IDA plugin can\nsave us a lot of time when dealing with certain samples.\n\nIf you want to learn more about how you can keep your organization safe from ransomware\nand how to easily leverage VirusTotal to monitor ransomware activity, please join us for our\n[next Anti-ransomware workshop - English (Live November 4th, 1pm ET) and Spanish (Live](https://www.brighttalk.com/webcast/18282/446740?utm_source=Google+Cloud+Security&utm_medium=brighttalk&utm_campaign=446740)\nOctober 28th, 17:00 CEST) versions available.\n\n## Starting the investigation\n\n[Two weeks ago new files were uploaded to VirusTotal (1,](https://www.virustotal.com/gui/file/e8a0e80dfc520bf7e76c33a90ed6d286e8729e9defe6bb7da2f38bc2db33f399/detection) [2). According to the](https://www.virustotal.com/gui/file/cfe1678a7f2b949966d9a020faafb46662584f8a6ac4b72583a21fa858f2a2e8/detection) crowdsourced\nYARA rule that identified them, these files looked like Ryuk malware.\n\n\n-----\n\nA closer look revealed that these samples have been probably dumped from memory: the\ndisassembled code showed plenty of memory mapped addresses, the import table was\nmissing and the samples crashed when executed - they were definitively corrupted PE files.\n\nGiven these were fresh samples, we certainly wanted to know more about them, especially if\nthey were part of a bigger campaign. In such cases, one of our best allies is looking for\nsimilar samples that could also be part of the attack. However, when working with memory\ndumps we need to be careful, given that probably some segments and memory mapped\naddresses will be execution specific. If we include any of such specifics in our search, we\nwon't be able to find other samples.\n\n## IDA plugin to the rescue\n\nOne of the options would be to rebuild the samples we found, which is an extremely time\n[consuming process. Instead, we can use the VirusTotal IDA plugin (see original blog post](https://github.com/VirusTotal/vt-ida-plugin)\nannouncement) to help us search for the original sample. Using the \"search for similar code\"\nfunctionality we can create a query that will ignore all the memory mapped addresses, being\na perfect choice for our problem.\n\nTaking a look at the samples with IDA, we can see there are many functions that aren't\nproperly identified by the disassembler engine given the use of anti-disassembly techniques.\nPrecisely for this reason, they are good choices for searching for code similarity.\n\n\n-----\n\nWe just need to select the code, right-button, and search for similar code. The resulting\nquery will take care of ignoring all the memory mapped addresses we wanted to get rid of.\n\n\n-----\n\n[The resulting listing with all the files found shows very close first submission time. Also,](https://www.virustotal.com/gui/search/content%3A%7B66b8eb0531c074fae8%5B178%5Dc745ec67000000689c0100006a008d9550feffff52e8%5B4%5D83c40cc745f000000000c745f800000000eb09%7D/files?utm=vt_ida)\nsome of them report behaviour activity, meaning they executed in the sandboxes without\ncrashing: maybe one of them could be our original sample.\n\nPicking [one of our initial samples and another one with behavioural information, we can see](https://www.virustotal.com/gui/file/cfe1678a7f2b949966d9a020faafb46662584f8a6ac4b72583a21fa858f2a2e8)\nthat:\n\nThey [don't show up as similar when doing a similarity search (as expected).](https://www.virustotal.com/gui/search/similar-to%3Ae72c36dffce4bb998ec1a35da6c57156a08897eb5196dc969d5f8066e5ad5e13/files)\nThey have some long sequences of bytes in common.\n\n## Is this our sample?\n\n\n-----\n\nAt this point we feel confident that the new sample found is the one we were looking for.\nIndeed, starting from this sample and taking a look at the (undetected) function located at\n[0x35008A60, we select a large sequence of instructions with the IDA plugin (as we did](https://www.virustotal.com/gui/file/cfe1678a7f2b949966d9a020faafb46662584f8a6ac4b72583a21fa858f2a2e8/detection)\n[before) for a new search. This results in only 4 files that match the query generated: our two](https://www.virustotal.com/gui/search/content%3A%7B8b85e8feffff8a4801884de48385e8feffff01807de40075e78bbde8feffff8bb5fcfdffff8b95f8fdffff8bcac1e902f3a58bca83e103f3a46a008d85c4fcffff50ff15%5B4%5De9e5fdffff833d%5B4%5D00751b837d080874156a006a006a0068%5B4%5D6a006a00ff15%5B4%5D837d080875316a006a006a0068%5B4%5D6a006a00ff15%5B10%5D33d2b910270000f7f181c250c3000052ff15%5B14%5D83c404c78520fdffff00000000c7851cfdffff00000000c745e800000000eb098b55e883c2018955e8837de85a0f8d880000006a04680010000068b03600006a00ff15%5B4%5D8b4de8c1e1058981280902356a046800100000689a420f006a00ff15%5B4%5D8b55e8c1e20589822c0902356a04680010000068102700006a00ff15%5B4%5D8b4de8c1e1058981300902358b55e8c1e20583ba%5B4%5D00740f8b45e8c1e00583b8%5B4%5D007505e917170000e965ffffff%7D/files?utm=vt_ida)\ninitial samples, another file that's also corrupted, and the previously chosen sample that\ndetonated in our sandboxes. Therefore, this is the second time that we get this file when\nlooking for similar code.\n\nGoing deeper, we'll see that it shares the same PE entry point that our two initial corrupted\nfiles. Furthermore, their WinMain functions are the same. Initially it looks like a quite simple\nfunction, composed of only three blocks of code. But, after overcoming the anti-disassembly\ntrick implemented to confuse IDA, we can compare both function graphs to see the similarity.\nWe conclude that we found the original sample.\n\n\n-----\n\n## What now?\n\nAt the time of this research there isn't any Yara rule detecting the original sample and it has\n28/71 positives. Inside this file we can find encrypted strings that are extremely useful for\npivoting to find additional samples. These strings are included in the corrupted files as well,\nstored in the \".gfids\" segment at the end of the file. In other words, they aren't located in the\n\".data\" segment as seen in the original sample. This new location reveals that probably these\nstrings were initially encrypted and became decrypted after execution, thus they can be seen\nas footprints of the original sample.\n\n[Using the VT-IDA plugin we can search for other files that contain these encrypted strings.](https://www.virustotal.com/gui/search/content%3A%7B506963756f7670687620426273672145737c72776f6a7261726b6b6420537472796a6665732078342e33%7D/files?utm=vt_ida)\nAs expected, the four files found before are listed now, but there are two other samples that\nwere submitted three days prior to our original sample and can also be investigated.\n\nMoreover, all these new strings can be used to improve the original Yara rule that brought us\nhere, or to create a new one! Remember to keep it running as a LiveHunt to make sure you\nkeep track of any new Indicators of Compromise and to detect anything new attackers use in\ntheir campaigns. You can find all the details about the campaign described in this blogpost in\nthe [following VT-Graph.](https://www.virustotal.com/graph/embed/gdaea8314781b48479c5a2aa9fa49a23e7a1d12ac04724a8f9fcbae696a7fbbd1)\n\n_[This post was co-authored by Vicente Diaz.](https://twitter.com/trompi)_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-10-13 - Tracing fresh Ryuk campaigns itw.pdf"
    ],
    "report_names": [
        "2020-10-13 - Tracing fresh Ryuk campaigns itw.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535721,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653698364,
    "ts_modification_date": 1653698364,
    "files": {
        "pdf": "https://archive.orkl.eu/b22c53b23e52fa12590e99fa214cfeb94b5b1548.pdf",
        "text": "https://archive.orkl.eu/b22c53b23e52fa12590e99fa214cfeb94b5b1548.txt",
        "img": "https://archive.orkl.eu/b22c53b23e52fa12590e99fa214cfeb94b5b1548.jpg"
    }
}