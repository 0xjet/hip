{
    "id": "be11ad18-e776-4bbb-aafa-547da6ce96a9",
    "created_at": "2023-01-12T15:01:23.216749Z",
    "updated_at": "2025-03-27T02:09:07.97418Z",
    "deleted_at": null,
    "sha1_hash": "d8e73e943e8578392aab27a83dadf2b445573581",
    "title": "2020-07-13 - Anchor dns malware goes cross platform",
    "authors": "",
    "file_creation_date": "2022-05-28T01:59:39Z",
    "file_modification_date": "2022-05-28T01:59:39Z",
    "file_size": 79646,
    "plain_text": "# Anchor_dns malware goes cross platform\n\n**[medium.com/stage-2-security/anchor-dns-malware-family-goes-cross-platform-d807ba13ca30](https://medium.com/stage-2-security/anchor-dns-malware-family-goes-cross-platform-d807ba13ca30)**\n\nWaylon Grange July 13, 2020\n\nWa\nylon\n\n\n[Waylon Grange](https://medium.com/@waylon.grange?source=post_page-----d807ba13ca30--------------------------------)\n\nJul 13, 2020\n\n\n3 min read\n\nThe actors behind Trickbot, a high profile banking trojan, have recently developed a Linux port\nof their new DNS command and control tool known as Anchor_DNS.\n\nOften delivered as part of a zip, this malware is a lightweight Linux backdoor. Upon execution it\ninstalls itself as a cron job, determines the public ip for the host and then begins to beacon via\nDNS queries to its C2 server.\n\nBecause the DNS channel provides an indirect route for the malware to communicate the\nattackers aren’t provided with the ip address of the victim. To mitigate this the malware utilizes\npublic ip lookup services to determine where the target is located. Upon first run the malware\nwill randomly select one of the following urls to find its external ip.\n\n\n-----\n\nIt then enters its main communication loop where it generates the DNS query and parses the\nresult. The method for generating the DNS query uses a similar format as the windows version\n[described in this article by NTT but with a few changes.](https://hello.global.ntt/zh-cn/insights/blog/trickbot-variant-communicating-over-dns)\n\n\n-----\n\n```\nanchor_dns is instead replaced with anchor_linux and the uname command is utilized to\n\n```\ndetermine the hostname and linux version. The client_id is a 32 byte value hardcoded into the\nbinary. `LVER is the Linux version which is also used as part of the hostname. If my linux`\nversion is `5.6.0 the` `LVER would be` `L560 . Finally, the public ip discovered above along`\nwith the payload is appended to the end. This is all combined as shown above which is then\nXOR’d with `0xb9, hex encoded, and then prepended to the root C2 domain. In this case,`\nbiillpi.com\n\nThe server responds with a number of A records which contain the encoded response in a\nsimilar format to that outlined by NTT.\n\n\n-----\n\nThe malware’s main functionality is to be a simple dropper. It has basic download and execute\ncapabilities and when doing so on the linux host it will drop the payload to\n```\n/tmp/<random_15_chars> and execute via sh .\n\n```\nMore interesting however is it that it also contains support for windows execution via smb\nshares and IPC. The sample also has a Windows version of the malware embedded inside that\nit can install on remote windows shares and then execute as a service. It utilizes the open\nsource libsmb2 project to do this.\n\n\n-----\n\nGiven that the trickbot family has a history of harvesting putty credentials (see\nhttps://blog.trendmicro.com/trendlabs-security-intelligence/trickbot-adds-remote-applicationcredential-grabbing-capabilities-to-its-repertoire/) we see how this can be used to further\npropagate with in the victims network.\n\nThe further development of the anchor family of malware suggests the trickbot family intends to\ncontinue utilizing its new DNS based command and control comms. Given the generally lower\nrate of linux malware detection it is of the utmost importance organization closely monitor their\nnetwork traffic and DNS resolutions.\n\nHashes:\n```\n55754d178d611f17efe2f17c456cb42469fd40ef999e1058f2bfe44a503d877cC721189a2b89cd279e9a033c9\n\n```\n\n-----\n\nDomains:\n```\n*.biillpi.com\n\n```\nIPs:\n```\n23.95.97.59\n\n```\nYara:\n```\nrule anchor_linux_dns{meta: author = \"Stage 2 Security\" description = \"Trickbot\nanchor_linux\"strings: $hdr = {7f 45 4c 46} $x1 = {80 74 0? ?? b9} $x2 = \"anchor_l\" $x3 =\n\"getaddrinfo\" $x4= \"IPC$\" $x5 = {48 ?? 2f 74 6d 70 2f 00 00 00} $x6 = \"test my ip\" $x7 =\n{73 6d 62 32 5f [4–7] 5f 61 73 79 6e 63 20} $x8 = \"Kernel32.dll\" $x9 = \"libcurl\" $x10 =\n\"/1001/\"condition: $hdr at 0 and 7 of ($x*)}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-07-13 - Anchor dns malware goes cross platform.pdf"
    ],
    "report_names": [
        "2020-07-13 - Anchor dns malware goes cross platform.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535683,
    "ts_updated_at": 1743041347,
    "ts_creation_date": 1653703179,
    "ts_modification_date": 1653703179,
    "files": {
        "pdf": "https://archive.orkl.eu/d8e73e943e8578392aab27a83dadf2b445573581.pdf",
        "text": "https://archive.orkl.eu/d8e73e943e8578392aab27a83dadf2b445573581.txt",
        "img": "https://archive.orkl.eu/d8e73e943e8578392aab27a83dadf2b445573581.jpg"
    }
}