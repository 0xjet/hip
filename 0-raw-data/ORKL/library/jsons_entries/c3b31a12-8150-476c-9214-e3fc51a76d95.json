{
    "id": "c3b31a12-8150-476c-9214-e3fc51a76d95",
    "created_at": "2023-01-12T15:06:13.681357Z",
    "updated_at": "2025-03-27T02:05:38.510619Z",
    "deleted_at": null,
    "sha1_hash": "be8028e5fa22638cb78b7e4569a94a53cdd3db5a",
    "title": "2017-01-09 - Second Wave of Shamoon 2 Attacks Identified",
    "authors": "",
    "file_creation_date": "2022-05-28T00:33:55Z",
    "file_modification_date": "2022-05-28T00:33:55Z",
    "file_size": 752679,
    "plain_text": "# Second Wave of Shamoon 2 Attacks Identified\n\n**[unit42.paloaltonetworks.com/unit42-second-wave-shamoon-2-attacks-identified/](https://unit42.paloaltonetworks.com/unit42-second-wave-shamoon-2-attacks-identified/)**\n\nRobert Falcone January 9, 2017\n\nBy [Robert Falcone](https://unit42.paloaltonetworks.com/author/robertfalcone/)\n\nJanuary 9, 2017 at 8:00 PM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [Disttrack Wiper,](https://unit42.paloaltonetworks.com/tag/disttrack-wiper/) [Shamoon 2,](https://unit42.paloaltonetworks.com/tag/shamoon-2/) [threat intelligence](https://unit42.paloaltonetworks.com/tag/threat-intelligence/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/unit42-second-wave-shamoon-2-attacks-identified/)\n\nIn November 2016, we observed the reemergence of destructive attacks associated with the\n2012 Shamoon attack campaign. We covered this attack in detail in our blog titled Shamoon\n2: Return of the Disttrack Wiper, which targeted a single organization in Saudi Arabia and\nwas set to wipe systems on November 17, 2016. Since our previous publication, we have\nfound another, similar but different payload used to target a second organization in Saudi\nArabia that was configured to wipe systems twelve days later on November 29, 2016. This\nlatest attack potentially materially impacts one of the primary countermeasures employed\nagainst wiper attacks: Virtual Desktop Interface snapshots.\n\nThe payload used in this attack was very similar to the November 17, 2016 payload, but\nexhibited slightly different behaviors and contained hardcoded account credentials specific to\nthe newly targeted organization. The hardcoded account credentials met Windows password\n\n\n-----\n\ncomplexity requirements, which suggests that the threat actors obtained the credentials\nthrough a previous, separate attack, similar to the November 17, 2016 attack.\n\nThe most notable thing about this latest sample is that it contains several usernames and\npasswords from official Huawei documentation related to their virtual desktop infrastructure\n(VDI) solutions, such as FusionCloud. VDI solutions can provide some protection against a\ndestructive malware like Disttrack through the ability to load snapshots of wiped systems.\nThe fact that the Shamoon attackers had these usernames and passwords may suggest that\nthey intended on gaining access to these technologies at the targeted organization to\nincrease the impact of their destructive attack. If true, this is a major development and\norganizations should consider adding additional safeguards in protecting the credentials\nrelated to their VDI deployment.\n\nAt this time, we have no details of the attack we believe preceded this Shamoon attack to\nobtain credentials. We also have no details on the delivery method used to deliver the new,\nsimilar, but different Disttrack payload in this attack.\n\n## The Second Shamoon 2 Attack\n\nThis second known attack associated with Shamoon 2 also used the Disttrack payload, albeit\na new, similar but different one from the original Shamoon 2 attack. Specifically, it used a 64bit variant that was configured to begin its destructive activities on November 29, 2016. Like\nthe Disttrack sample used in the first reported Shamoon 2 attack, it including a wiper and\ncommunications module stored in resources within the executable.\n\nTable 1 below shows that the method the Disttrack payload uses to extract and decrypt the\nmodules from resources is the same; however, the resource names changed from “X509”,\n“PKCS7” and “PKCS12” to “LANG”, “MENU” and “ICO”.\n\n\n**Component** **Resource**\n**Name**\n\n\n**Offset** **Size** **Base64 key**\n\n\nWiper LANG 94399-14 = 94385 563712 OWRKbTxrleYfLm…\n\n\nCommunications MENU 218709-14 =\n218695\n\n\n187904 QsCfQA6ze9CoOz…\n\n\nUnknown ICO Unknown Unknown ijX7buB1FIjSn/0D…\n\nOur efforts to decrypt the “ICO” resource have thus far been unsuccessful as the Disttrack\npayload has an associated key but does not contain code that decrypts and extracts this\nresource.\n\n**Propagation Inside Compromised Networks**\n\n\n-----\n\nSimilar to the previous attack, the Disttrack payload in this attack spreads to other systems\non the local network (/24 network specifically) by logging in using legitimate domain account\ncredentials, copying itself to the system and creating a scheduled task that executes the\n[copied payload. While this method is the same as discussed in our previous blog, the](https://blog.paloaltonetworks.com/2016/11/unit42-shamoon-2-return-disttrack-wiper/)\naccount credentials used in this attack were specific to the targeted organization and the file\nnames used when copying the payload to remote systems were different.\n\n**Legitimate User Accounts**\n\nThere were 16 account credentials found hardcoded within the Disttrack payload, appearing\nto be a mixture of individual user accounts and broader administrator accounts. All but one of\nthe passwords met Windows complexity requirements, specifically, containing uppercase and\nlowercase characters, and either a number, symbol, or both. One of the general\nadministrator accounts seen in this payload was also in the Disttrack payload in the first\nShamoon 2 attack from November 17, 2016, which may not be specific to the targeted\norganization and instead used as an attempt to guess the login credentials. Based upon the\nexistence of these credentials, it is highly likely the threat actors had carried out a previous\nattack to obtain these account credentials, as it is unlikely that these passwords were\nguessed or brute forced.\n\nAs noted earlier, a new development with this latest Disttrack payload is that several of the\nusernames and passwords are found within official documentation as administrator accounts\nfor Huawei’s virtualized desktop infrastructure (VDI) products, such as FusionCloud. This\nmay suggest that the targeted organization used these credentials when deploying Huawei\nVDI systems. Shamoon actors may have obtained these credentials from a prior attack;\nhowever, it is also possible that the actors included these default usernames and passwords\nas an attempt to guess the login credentials to the VDI infrastructure.\n\nVDI solutions can provide some protection against a destructive malware like Disttrack\nthrough the ability to load snapshots of wiped systems. Also, since FusionCloud systems run\na Linux operating system, which would not be susceptible to wiping by the Windows-only\nDisttrack malware, this could be seen as a reasonable countermeasure against attacks like\nShamoon. However, if the attacker was able to log into the VDI management interfaces using\nthe account credentials they could manually carry out destructive activities against the VDI\ndeployment, as well as any snapshots. The targeting of VDI solutions with legitimate, stolen\nor default credential represents an escalation in tactics that administrators should be aware\nof and take immediate steps to evaluate and address.\n\n**New Disttrack Names**\n\nThe filenames that the payload copies itself to within the System32 folder of the remote\nsystem differs from the previously reported attack, specifically using “ntertmgr32.exe” for 32bit or “ntertmgr64.exe” for 64-bit systems. The scheduled task executes these files on the\n\n\n-----\n\nremote system, which results in the creation of a Disttrack service named NtertSrv\ncompared to the service name “ntssrv” created by the Disttrack payload used in the\nNovember 17, 2016 attacks. This can be seen in Figure 1.\n\n_Figure 1 Disttrack service created on systems during propagation_\n\n## Command and Control\n\nThe communications module used in this attack is rather hobbled, as it was configured\nwithout an operational command and control (C2) server to communicate with. The lack of\nan operational C2 is much like the November 17, 2016 attack that had the IP address\n“1.1.1.1” within its configuration to use as a C2 server. Unlike the non-operational C2 of\n“1.1.1.1” used in the first Shamoon 2 attack, this communications module completely lacked\nany IP address or domain name for a C2 server within its configuration.\n\nAlso, in this sample, Disttrack did not save its communications module to the system using\nthe filename “netinit.exe” like in the original attack, rather it chose a random name from the\nfollowing list:\n\n\n-----\n\n- caiaw00e.exe\n\n- sbuvideo.exe\n\n- caiaw00i.exe\n\n- olvume.exe\n\n- usinwb2.exe\n\n- briaw005.exe\n\n- fpwwlwf.exe\n\n- epiaw003.exe\n\n- briaw002.exe\n\n- olvsnap.exe\n\n- dmwaudio.exe\n\n- briaw006.exe\n\n- miWApRpl.exe\n\n- caiaw00b.exe\n\n- lxiaw003.exe\n\nLastly, the communications module also uses different file names than the original Shamoon\n2 attack. Instead of setting a custom “kill time” in a file named “usbvideo324.pnf” within the\n“%WINDOWS%\\inf” folder, it uses a file name of “dcT21x400i.pnf”. It also would send the C2\nserver the contents of a file named “vsfnp7_6.pnf” from the folder “%WINDOWS%\\inf”\ninstead of “netimm173.pnf”.\n\n**Destruction**\n\nMuch like the initial attacks, the lack of an operational C2 server suggests that the threat\nactor’s sole intention for carrying out this Shamoon 2 attack was to destroy data and\nsystems. Without an operational C2, the actor would be unable to issue a command to set a\ncustom “kill time” when the Disttrack payload would begin wiping systems, which would force\nthe payload to rely on its hardcoded “kill time”. The hardcoded date suggests that this attack\nwas set to begin wiping systems on November 29, 2016 at 1:30 AM local Saudi Arabia time.\n\nUnlike the previous Shamoon attacks that occurred on a holiday and over a weekend, this kill\ntime occurred during the work week, as November 29, 2016 was a Tuesday. However, it\nappears this attack attempted to maximize its impact by occurring very early in the morning\nbefore the majority of the organization’s staff were on site. This aligns with the Shamoon\nactors conducting their attacks off-hours to increase the efficacy of the attack by increasing\nthe timeframe of detection and response.\n\nWhen Disttrack observes the system clock exceeding the “kill time”, it will save its wiper\ncomponent to the system using one of the following randomly chosen filenames:\n\n- pdwmtphw.exe\n\n- caiaw00a.exe\n\n- sdwprint.exe\n\n\n-----\n\n- caiaw00d.exe\n\n- kyiaw002.exe\n\n- sdwscdrv.exe\n\n- briaw00a.exe\n\n- saiaw002.exe\n\n- _mvscdsc.exe\n\n- hdvmp32.exe\n\n- _s3wcap32.exe\n\n- hpiaw001.exe\n\n- lxiaw004.exe\n\n- cniaw001.exe\n\n- lxiaw006.exe\n\n- caiaw00f.exe\n\n- newtvsc.exe\n\nWhen executed, the wiper component will extract a kernel driver from its resource section\nand decrypt it with a 172-byte XOR key. The wiper saves the kernel driver (SHA256:\n5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a) to the\n“Windows\\System32\\Drivers” folder in a file named “vdsk911.sys”. The wiper then uses this\nfile to create a kernel driver service named “vdsk911”, as seen in Figure 2.\n\n\n-----\n\n_Figure 2 RawDisk kernel driver service created by Disttrack wiper_\n\nThe kernel driver is the 64-bit version of the commercial RawDisk driver by EldoS\nCorporation, which is the exact same file as the “drdisk.sys” driver extracted from the\nDisttrack 64-bit payload in the ‘X509’ resource in the first reported Shamoon 2 attack. The\nDisttrack payload will use this kernel driver to access the master boot record (MBR), partition\ntables and files and folders on the system to overwrite them with the same image of the\ndeceased Syrian boy as in the previous Shamoon 2 attack.\n\nDuring our analysis, we again observed the wiper setting the system time to a random date\nbetween August 1 and August 20, 2012, as seen in Figure 3. As mentioned in our previous\nblog, the reason the wiper sets the system time to this random date in August 2012 is due to\na temporary license key needed to use the RawDisk kernel driver. The temporary license key\nused in this attack is the exact same as the first attack.\n\n\n-----\n\n_Figure 3 Wiper changing the system date to a random date in August 2012_\n\nSince our original blog, we’ve successfully decrypted the license key, which can be seen in\nFigure 4. The expiration date in the temporary license key is an 8-byte field (highlighted by\nthe orange box) that corresponds to Microsoft’s [FILETIME structure, which represents the](https://msdn.microsoft.com/en-us/library/windows/desktop/ms724284(v=vs.85).aspx)\nnumber of 100-nanosecond intervals since January 1, 1601 (UTC). In the temporary license\nkey used in all of the Shamoon related attacks, the expiration date was set to August 30,\n2012 at 8:34:29 UTC, which is the reason the wiper sets the system time to a random day\nbetween August 1 and August 20, 2012. Also, we found that the temporary license key was\nregistered to “binnatova@bsunanotechnology.com”. We are unsure how this email address is\ninvolved with Shamoon, as it was likely compromised back in 2012 and used by the actor to\nobtain the temporary license for RawDisk.\n\n_Figure 4 RawDisk temporary license decrypted showing August 2012 expiration date_\n\n\n-----\n\nAfter the MBR, partition tables and files are overwritten, the wiper issues the command of\n“shutdown -r -f -t 2” to reboot the system, which is the same command as used in the first\nShamoon 2 attack. Figure 5 shows the dialog box that pops up as a result of this command,\nwhich will be followed by a system reboot.\n\n_Figure 5 The shutdown dialog box opened just before reboot of a Windows 7 system wiped_\n_by Disttrack_\n\nThe purpose of rebooting the system remains the same, as the portions of the hard disk and\nfilesystem needed to successfully boot the system were overwritten with a JPEG image, the\nsystem is no longer able to start up. Figure 6 shows the result of this reboot in an analysis\nvirtual machine, as the operating system could no longer be found.\n\n\n-----\n\n_Figure 6 System unable to find its operating system_\n\nThe operating system fails to load as the MBR is overwritten with a JPEG image. As seen in\nFigure 7, sector 0 of the physical hard disk, which normally stores the master boot record\nnow contains the beginning of a JPEG file marked by the “JFIF” magic bytes in the two\norange boxes.\n\n_Figure 7 Hexdump of sector 0 of the physical showing the MBR overwritten with a JPEG file_\n\n## Conclusion\n\nWe analyzed a second Disttrack payload associated with Shamoon 2, which suggests that\nthe threat actors targeted a second Saudi Arabian organization in this attack campaign. The\nactors used the Disttrack payload to spread to other systems on the local network using\nlegitimate credentials. The legitimate credentials were specific to the targeted organization\nand were complex enough to suggest that the threat actors carried out a previous attack to\nobtain the credentials. Also, the actors hardcoded credentials found in Huawei’s official\ndocumentation for its VDI solutions, suggesting that the threat actors may have had access\nto appliances hosting the infrastructure. The Disttrack wiper was set to begin overwriting\nsystems on November 29, 2016 at 1:30 AM, which aligns with the Shamoon actor’s tactic to\nmaximize its impact by attacking at a time when the targeted organization would have less\nstaff and resources available onsite.\n\nPalo Alto Networks customers are protected from the Disttrack payload used in this attack:\n\nWildFire properly classifies Disttrack samples as malicious\nThreat protection AV signature of Virus/Win32.WGeneric.ktoto detects the new\npayload.\n[AutoFocus customers can monitor Disttrack activity using the Disttrack tag](https://autofocus.paloaltonetworks.com/#/tag/Unit42.Disttrack)\n\n## Indicators of Compromise\n\n**Hashes**\n\n\n-----\n\n010d4517c81bcdc438cb36fdf612274498d08db19bba174462ecbede7d9ce6bb (64-bit\nDisttrack)\nefd2f4c3fe4e9f2c9ac680a9c670cca378cef6b8776f2362ed278317bfb1fca8 (Communication)\n113525c6bea55fa2a2c6cf406184092d743f9d099535923a12cdd9b9192009c4 (Wiper)\n5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a (vdsk911.sys)\n\n**Filenames**\n\nntertmgr32.exe\nntertmgr64.exe\nvdsk911.sys\ndcT21x400i.pnf\nvsfnp7_6.pnf\ncaiaw00e.exe\nsbuvideo.exe\ncaiaw00i.exe\nolvume.exe\nusinwb2.exe\nbriaw005.exe\nfpwwlwf.exe\nepiaw003.exe\nbriaw002.exe\nolvsnap.exe\ndmwaudio.exe\nbriaw006.exe\nmiWApRpl.exe\ncaiaw00b.exe\nlxiaw003.exe\npdwmtphw.exe\ncaiaw00a.exe\nsdwprint.exe\ncaiaw00d.exe\nkyiaw002.exe\nsdwscdrv.exe\nbriaw00a.exe\nsaiaw002.exe\n_mvscdsc.exe\nhdvmp32.exe\n_s3wcap32.exe\nhpiaw001.exe\nlxiaw004.exe\ncniaw001.exe\n\n\n-----\n\nlxiaw006.exe\ncaiaw00f.exe\nnewtvsc.exe\n\n**Service Names**\n\nNtertSrv\nvdsk911\n\n**Get updates from**\n**Palo Alto**\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-01-09 - Second Wave of Shamoon 2 Attacks Identified.pdf"
    ],
    "report_names": [
        "2017-01-09 - Second Wave of Shamoon 2 Attacks Identified.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535973,
    "ts_updated_at": 1743041138,
    "ts_creation_date": 1653698035,
    "ts_modification_date": 1653698035,
    "files": {
        "pdf": "https://archive.orkl.eu/be8028e5fa22638cb78b7e4569a94a53cdd3db5a.pdf",
        "text": "https://archive.orkl.eu/be8028e5fa22638cb78b7e4569a94a53cdd3db5a.txt",
        "img": "https://archive.orkl.eu/be8028e5fa22638cb78b7e4569a94a53cdd3db5a.jpg"
    }
}