{
    "id": "51057032-eacf-48e0-9c3c-c0e70defd106",
    "created_at": "2023-01-12T15:05:32.086184Z",
    "updated_at": "2025-03-27T02:05:50.631213Z",
    "deleted_at": null,
    "sha1_hash": "516d551d891f9e76740c80a2002d8de80a4d7af8",
    "title": "2016-03-06 - New OS X Ransomware KeRanger Infected Transmission BitTorrent Client Installer",
    "authors": "",
    "file_creation_date": "2022-05-29T01:33:48Z",
    "file_modification_date": "2022-05-29T01:33:48Z",
    "file_size": 982164,
    "plain_text": "# New OS X Ransomware KeRanger Infected Transmission BitTorrent Client Installer\n\n**researchcenter.paloaltonetworks.com/2016/03/new-os-x-ransomware-keranger-infected-transmission-bittorrent-**\nclient-installer/\n\nClaud Xiao March 6, 2016\n\nBy [Claud Xiao](https://unit42.paloaltonetworks.com/author/claud-xiao/)\n\nMarch 6, 2016 at 11:30 AM\n\n[Category: Ransomware,](https://unit42.paloaltonetworks.com/category/ransomware/) [Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [KeRanger,](https://unit42.paloaltonetworks.com/tag/keranger/) [OS X](https://unit42.paloaltonetworks.com/tag/os-x/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/new-os-x-ransomware-keranger-infected-transmission-bittorrent-client-installer/)\n\nOn March 4, we detected that the Transmission BitTorrent client installer for OS X was\ninfected with ransomware, just a few hours after installers were initially posted. We have\nnamed this Ransomware “KeRanger.” The only previous ransomware for OS X we are aware\nof is [FileCoder, discovered by Kaspersky Lab in 2014. As FileCoder was incomplete at the](https://securelist.com/blog/research/66760/unfinished-ransomware-for-macos-x/)\ntime of its discovery, we believe KeRanger is the first fully functional ransomware seen on\nthe OS X platform.\n\nAttackers infected two installers of Transmission version 2.90 with KeRanger on the morning\nof March 4. When we identified the issue, the infected DMG files were still available for\ndownloading from the Transmission site\n(hxxps://download.transmissionbt.com/files/Transmission-2.90[.]dmg) Transmission is an\nopen source project. It’s possible that Transmission’s official website was compromised and\nthe files were replaced by re-compiled malicious versions, but we can’t confirm how this\ninfection occurred.\n\n\n-----\n\n_Figure 1 KeRanger hosted in Transmission's official website_\n\nThe KeRanger application was signed with a valid Mac app development certificate;\ntherefore, it was able to bypass Apple’s Gatekeeper protection. If a user installs the infected\napps, an embedded executable file is run on the system. KeRanger then waits for for three\ndays before connecting with command and control (C2) servers over the Tor anonymizer\nnetwork. The malware then begins encrypting certain types of document and data files on\nthe system. After completing the encryption process, KeRanger demands that victims pay\none bitcoin (about $400) to a specific address to retrieve their files. Additionally, KeRanger\nappears to still be under active development and it seems the malware is also attempting to\nencrypt Time Machine backup files to prevent victims from recovering their back-up data.\n\nPalo Alto Networks reported the ransomware issue to the Transmission Project and to Apple\non March 4. Apple has since revoked the abused certificate and updated XProtect antivirus\nsignature, and Transmission Project has removed the malicious installers from its website.\nPalo Alto Networks has also updated URL filtering and Threat Prevention to stop KeRanger\nfrom impacting systems.\n\n## Technical Analysis\n\nThe two KeRanger infected Transmission installers were signed with a legitimate certificate\nissued by Apple. The developer listed this certificate is a Turkish company with the\nID Z7276PX673, which was different from the developer ID used to sign previous versions of\nthe Transmission installer. In the code signing information, we found that these installers\nwere generated and signed on the morning of March 4.\n\n\n-----\n\n_Figure 2 Code signing information of KeRanger_\n\nThe KeRanger infected Transmission installers include an extra file named General.rtf in the\nTransmission.app/Contents/Resources directory. It uses an icon that looks like a normal RTF\nfile but is actually a Mach-O format executable file packed with UPX 3.91. When users click\nthese infected apps, their bundle executable\nTransmission.app/Content/MacOS/Transmission will copy this General.rtf file to\n~/Library/kernel_service and execute this “kernel_service” before any user interface\nappearing.\n\n_Figure 3 The malicious executable pretends to be an RTF document_\n\n_Figure 4 KeRanger executes the extra General.rtf file_\n\n\n-----\n\nAfter unpacking the General.rtf with UPX, we determined that its main behavior is to encrypt\nthe user’s files and hold them for ransom.\n\nThe first time it executes, KeRanger will create three files “.kernel_pid”, “.kernel_time” and\n“.kernel_complete” under ~/Library directory and write the current time to “.kernel_time”. It\nwill then sleep for three days. Note that, in a different sample of KeRanger we discovered,\nthe malware also sleeps for three days, but also makes requests to the C2 server every five\nminutes.\n\n_Figure 5 KeRanger sleeps for three days before fully executing_\n\nThe General.rtf will collect infected Mac’s model name and UUID, upload the information to\none of its C2 servers. These servers’ domains are all sub-domains of onion[.]link or\nonion[.]nu, two domains that host servers only accessible over the Tor network.\n\nThe executable will keep trying to connect with the C2 server until it respond with two lines of\nencoded data. After decoding these two lines using Base64, the first line contains an RSA\npublic key and the second line is written to files named “README_FOR_DECRYPT.txt.”\n\n_Figure 6 Connect with C2 server and get instructions_\n\nWhen we were analyzing the samples, the C2 server returned the data for the\nREADME_FOR_DECRYPT.txt shown in following picture. It asks victims to pay exactly one\nbitcoin (currently around $400) through a specific Tor network website to decrypt the files.\n\n\n-----\n\nThe website will then guide victims to buy a bitcoin from somewhere else and transfer to the\nattacker at the address of “1PGAUBqHNcwSHYKnpHgzCrPkyxNxvsmEof”.\n\n_Figure 7 README file ask victim to pay Bitcoin_\n\n_Figure 8 Tor website to transfer bitcoin and get decryption pack_\n\nAfter connecting to the C2 server and retrieving an encryption key, the executable will\ntraverse the “/Users” and “/Volumes” directories, encrypt all files under “/Users”, and encrypt\nall files under “/Volumes” which have certain file extensions.\n\nThere are 300 different extensions specified by the malware, including:\n\nDocuments: .doc, .docx, .docm, .dot, .dotm, .ppt, .pptx, .pptm, .pot, .potx, .potm, .pps,\n.ppsm, .ppsx, .xls, .xlsx, .xlsm, .xlt, .xltm, .xltx, .txt, .csv, .rtf, .tex\nImages: .jpg, .jpeg,\nAudio and video: .mp3, .mp4, .avi, .mpg, .wav, .flac\nArchives: .zip, .rar., .tar, .gzip\nSource code: .cpp, .asp, .csh, .class, .java, .lua\nDatabase: .db, .sql\nEmail: .eml\nCertificate: .pem\n\n\n-----\n\n_Figure 9 Encrypt all files under \"/Users\" and all specific files under \"/Volumes\"_\n\n[KeRanger statically linked an open source encryption library named mbed TLS (formerly](https://tls.mbed.org/)\nPolarSSL).\n\nAs KeRanger encrypts each file (i.e. Test.docx) starts by creating an encrypted version that\nuses the .encrypted extension (i.e. Test.docx.encrypted.) To encrypt each file, KeRanger\nstarts by generating a random number (RN) and encrypts the RN with the RSA key retrieved\nfrom the C2 server using the RSA algorithm. It then stores the encrypted RN at the beginning\nof resulting file. Next, it will generate an Initialization Vector (IV) using the original file’s\ncontents and store the IV inside the resulting file. After that, it will mix the RN and the IV to\ngenerate an AES encryption key. Finally, it will use this AES key to the contents of the\noriginal file and write all encrypted data to the result file.\n\n_Figure 10 Encrypt each file’s content by AES_\n\nIn addition to this behavior, it seems like KeRanger is still under development. There are\nsome apparent functions named “_create_tcp_socket”, “_execute_cmd” and\n“_encrypt_timemachine”. Some of them have been finished but are not used in current\n\n\n-----\n\nsamples. Our analysis suggests the attacker may be trying to develop backdoor functionality\nand encrypt [Time Machine backup files as well. If these backup files are encrypted, victims](https://support.apple.com/en-us/HT201250)\nwould not be able to recover their damaged files using Time Machine.\n\n_Figure 11 Function \"_encrypt_timemachine\" is implemented but not used yet_\n\n## Mitigations\n\nWe reported the issue to the Transmission Project and to Apple immediately after we\nidentified it. Apple has since revoked the abused certificate, and Gatekeeper will now block\nthe malicious installers. Apple has also updated XProtect signatures to cover the family, and\nthe signature has been automatically updated to all Mac computers now. As of March 5,\nTransmission Project has removed the malicious installers from its website.\n\nWe have also updated URL filtering and Threat Prevention to stop KeRanger from impacting\nPalo Alto Networks customers.\n\n## How to Protect Yourself\n\nUsers who have directly downloaded Transmission installer from official website after\n11:00am PST, March 4, 2016 and before 7:00pm PST, March 5, 2016, may be been infected\nby KeRanger. If the Transmission installer was downloaded earlier or downloaded from any\nthird party websites, we also suggest users perform the following security checks. Users of\nolder versions of Transmission do not appear to be affected as of now.\n\nWe suggest users take the following steps to identify and remove KeRanger holds their files\nfor ransom:\n\n1. Using either Terminal or Finder, check whether\n\n/Applications/Transmission.app/Contents/Resources/ General.rtf or\n/Volumes/Transmission/Transmission.app/Contents/Resources/ General.rtf exist. If any\nof these exist, the Transmission application is infected and we suggest deleting this\nversion of Transmission.\n\n\n-----\n\n2. Using Activity Monitor preinstalled in OS X, check whether any process named\n\n“kernel_service” is running. If so, double check the process, choose the “Open Files\nand Ports” and check whether there is a file name like\n“/Users/<username>/Library/kernel_service” (Figure 12). If so, the process is\nKeRanger’s main process. We suggest terminating it with “Quit -> Force Quit”.\n3. After these steps, we also recommend users check whether the files “.kernel_pid”,\n\n“.kernel_time”, “.kernel_complete” or “kernel_service” existing in ~/Library directory. If\nso, you should delete them.\n\n_Figure 12 The malicious \"kernel_service\" process_\n\nSince Apple has revoked the abused certificate and has updated XProtect signatures, if a\nuser tries to open a known infected version of Transmission, a warning dialog will be shown\nthat states “Transmission.app will damage your computer. You should move it to the Trash.”\nOr “Transmission can’t be opened. You should eject the disk image.” In any case if you see\nthese warnings, we suggest to follow Apple’s instruction to avoid being affected.\n\n\n-----\n\n_Figure 13 OS X system prevent user to open the infected installer_\n\n## Acknowledgements\n\nWe greatly thank Yi Ren, Yuchen Zhou, Jack Wang, Jun Wang from Palo Alto Networks for\nhelping to analyze KeRanger and protect our customers in a timely fashion. Thanks to\nRichard Wartell, Ryan Olson and Chad Berndtson from Palo Alto Networks for their\nassistance during the analysis and reporting.\n\n## IOCs\n\n**Samples of Ransomware.OSX.KeRanger**\nd1ac55a4e610380f0ab239fcc1c5f5a42722e8ee1554cba8074bbae4a5f6dbe1 Transmission2.90.dmg\ne3ad733cea9eba29e86610050c1a15592e6c77820927b9edeb77310975393574\nTransmission\n31b6adb633cff2a0f34cefd2a218097f3a9a8176c9363cc70fe41fe02af810b9 General.rtf\nd7d765b1ddd235a57a2d13bd065f293a7469594c7e13ea7700e55501206a09b5\nTransmission\n2.90.dmg\nddc3dbee2a8ea9d8ed93f0843400653a89350612f2914868485476a847c6484a Transmission\n6061a554f5997a43c91f49f8aaf40c80a3f547fc6187bee57cd5573641fcf153 General.rtf\n\n**Domains**\nlclebb6kvohlkcml.onion[.]link\nlclebb6kvohlkcml.onion[.]nu\nbmacyzmea723xyaz.onion[.]link\nbmacyzmea723xyaz.onion[.]nu\nnejdtkok7oz5kjoc.onion[.]link\nnejdtkok7oz5kjoc.onion[.]nu\n\n\n-----\n\n**Get updates from**\n**Palo Alto**\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-03-06 - New OS X Ransomware KeRanger Infected Transmission BitTorrent Client Installer.pdf"
    ],
    "report_names": [
        "2016-03-06 - New OS X Ransomware KeRanger Infected Transmission BitTorrent Client Installer.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535932,
    "ts_updated_at": 1743041150,
    "ts_creation_date": 1653788028,
    "ts_modification_date": 1653788028,
    "files": {
        "pdf": "https://archive.orkl.eu/516d551d891f9e76740c80a2002d8de80a4d7af8.pdf",
        "text": "https://archive.orkl.eu/516d551d891f9e76740c80a2002d8de80a4d7af8.txt",
        "img": "https://archive.orkl.eu/516d551d891f9e76740c80a2002d8de80a4d7af8.jpg"
    }
}