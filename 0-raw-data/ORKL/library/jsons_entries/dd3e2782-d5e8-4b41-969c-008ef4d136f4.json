{
    "id": "dd3e2782-d5e8-4b41-969c-008ef4d136f4",
    "created_at": "2022-10-25T16:48:15.486341Z",
    "updated_at": "2025-03-27T02:17:16.74942Z",
    "deleted_at": null,
    "sha1_hash": "c0708a3efcf32d02cfb5348f87fe140ae6f470e8",
    "title": "Modified Binaries Tor",
    "authors": "Joshua Pitts",
    "file_creation_date": "2014-11-14T14:40:01Z",
    "file_modification_date": "2014-11-14T14:40:01Z",
    "file_size": 379748,
    "plain_text": "## Summary\n\nAfter creating and using a new exitmap module, I found downloaded binaries being patched through a Tor\n\nexit node in Russia. Tor is a wonderful tool for protecting the identity of journalists, their sources, and\n\neven regular users around the world; however, anonymity does not guarantee security.\n\n[At DerbyCon this year I gave a presentation of my binary patching framework, BDF. Many binaries are](http://www.youtube.com/watch?v=LjUN9MACaTs)\n\nhosted without any transport layer security encryption. Some binaries are signed to prevent modification,\n\nbut most are not. During that presentation, I talked about the MITM patching of binaries during\n\n[download, and showed how easy it was using BDFProxy. I also mentioned that similar techniques are](https://github.com/secretsquirrel/BDFProxy)\n\nprobably already in use on the Internet.\n\nI had only circumstantial evidence until recently.\n\n## Circumstantial Evidence\n\n### Microsoft Updates Error\n\nI tested BDFProxy against a number of binaries and update processes, including Microsoft Windows\n\nAutomatic updates. The good news is that if an entity is actively patching Windows PE files for Windows\n\nUpdate, the update verification process detects it, and you will receive error code 0×80200053.\n\n\n-----\n\nThis error code indicates a failed signature verification for the downloaded binary. Windows Update\n\nproduces this error code for three root causes:\n\n1. The file was truncated during download. Very possible.\n\n2. The file was patched during download. Improbable.\n\n3. MS certificate verification is broken. Very improbable.\n\nIf you Google the error code, the official Microsoft response is troublesome.\n\n\n-----\n\n[The first link will bring you to the official Microsoft Answers website. Notice that this question has been](http://answers.microsoft.com/en-us/windows/forum/windows_other-windows_update/error-code-80200053-on-windows-update-in-windows-7/0dafeca5-66ab-47c0-b594-c363f11961f1)\n\nviewed over 34,000 times.\n\n\n-----\n\nexecuting a MS Fixit solution executable.\n\nIf an adversary is currently patching binaries as you download them, these ‘Fixit’ executables will also be\n\npatched. Since the user, not the automatic update process, is initiating these downloads, these files are not\n\nautomatically verified before execution as with Windows Update. In addition, these files need\n\nadministrative privileges to execute, and they will execute the payload that was patched into the binary\n\nduring download with those elevated privileges.\n\nNote: a Windows Home or Enterprise user could configure AppLocker to only run signed binaries.\n\n### Nullsoft Scriptable Install System (NSIS) Error\n\nNSIS provides a form of self-checking that weakly ensures that a binary was not modified after compiling.\n\nIt issues the following error when the self-checking fails:\n\n\n-----\n\n[Looking at Google Trends, this error message is quite common:](https://www.google.com/trends/explore#q=NSIS%20error)\n\nNotice the top countries where this search is originating:\n\n\n-----\n\nA user can receive an error code for any of the following three root causes:\n\n1. The binary was patched. Improbable.\n\n2. The binary was truncated due to a poor Internet connection. Very probable.\n\n3. An actual error with the install program. Very improbable.\n\nThis combined circumstantial evidence left me wondering if there is an individual or group actively\n\npatching binaries on the greater Internet.\n\n## Caught Red-Handed\n\nTo have the best chance of catching modified binaries in transit over the Internet, I needed as many exit\n\n[points in as many countries as possible. Using Tor would give me this access, and thus the greatest chance](https://www.torproject.org/index.html.en)\n\nof finding someone conducting this malicious MITM patching activity.\n\n[After researching the available tools, I settled on exitmap. Exitmap is Python-based and allows one to](https://github.com/NullHypothesis/exitmap)\n\nwrite modules to check exit nodes for various modifications of traffic. Exitmap is the result of a research\n\n[project called Spoiled Onions that was completed by both the PriSec group at Karlstad University and SBA](http://www.cs.kau.se/philwint/spoiled_onions/)\n\nResearch in Austria.\n\n[I wrote a module for exitmap, named patchingCheck.py, and have submitted a pull request to the official](https://github.com/leviathansecurity/exitmap/blob/master/src/modules/patchingCheck.py)\n\n[GitHub repository. See the usage example.](https://github.com/leviathansecurity/exitmap/blob/master/src/modules/patchingCheck.py#L45)\n\nSoon after building my module, I let exitmap run. It did not take long, about an hour, to catch my first\n\n\n-----\n\nDetails from https://check.torproject.org/exit-addresses\n\nExitNode 8361A794DFA231D863E109FC9EEEF21F4CF09DDD\n\nPublished 2014-10-22 01:06:40\n\nLastStatus 2014-10-22 02:02:33\n\nExitAddress 78.24.222.229 2014-10-22 02:08:01\n\nThis exit node was very active.\n\nUpon further inspection, the original binary is wrapped within another binary similar to the technique\n\nmentioned in the research from Flex Grobert, et al, titled “Software Distribution Malware Infection\n\nVector” (2008). However, these malware authors solved the icon issue noted in the paper by keeping the\n\n.rsrc section intact. By using a wrapper for the original binary, the malware authors do not invoke the\n\nNSIS error and bypass simple self-checking mechanisms.\n\nOut of over 1110 exit nodes on the Tor network, this is the only node that I found patching binaries,\n\nalthough this node attempts to patch just about all the binaries that I tested. The node only patched\n\nuncompressed PE files. This does not mean that other nodes on the Tor network are not patching binaries;\n\nI may not have caught them, or they may be waiting to patch only a small set of binaries.\n\nLeviathan has notified the Tor Project of the issue.\n\n## Going Forward\n\nCompanies and developers need to make the conscious decision to host binaries via SSL/TLS, whether or\n\nnot the binaries are signed. All people, but especially those in countries hostile to “Internet freedom,” as\n\nwell as those using Tor anywhere, should be wary of downloading binaries hosted in the clear—and all\n\nusers should have a way of checking hashes and signatures out of band prior to executing the binary.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/nj7stspq3veln8iebra2f5u1203i86eg",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.10.23.Modified_Binaries/Modified_Binaries_Tor.pdf"
    ],
    "report_names": [
        "Modified_Binaries_Tor"
    ],
    "threat_actors": [
        {
            "id": "59be3740-c8c7-47aa-84c8-e80d0cb7ea3a",
            "created_at": "2022-10-25T15:50:23.481057Z",
            "updated_at": "2025-03-27T02:00:55.480695Z",
            "deleted_at": null,
            "main_name": "Leviathan",
            "aliases": [
                "MUDCARP",
                "Kryptonite Panda",
                "Gadolinium",
                "BRONZE MOHAWK",
                "TEMP.Jumper",
                "APT40",
                "TEMP.Periscope",
                "Gingham Typhoon"
            ],
            "source_name": "MITRE:Leviathan",
            "tools": [
                "Windows Credential Editor",
                "BITSAdmin",
                "HOMEFRY",
                "Derusbi",
                "at",
                "BLACKCOFFEE",
                "BADFLICK",
                "gh0st RAT",
                "PowerSploit",
                "MURKYTOP",
                "NanHaiShu",
                "Orz",
                "Cobalt Strike",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b9806584-4d82-4f32-ae97-18a2583e8d11",
            "created_at": "2022-10-25T16:07:23.787833Z",
            "updated_at": "2025-03-27T02:02:09.978883Z",
            "deleted_at": null,
            "main_name": "Leviathan",
            "aliases": [
                "APT 40",
                "ATK 29",
                "Bronze Mohawk",
                "Gadolinium",
                "Gingham Typhoon",
                "ISLANDDREAMS",
                "ITG09",
                "Kryptonite Panda",
                "Mudcarp",
                "Red Ladon",
                "TA423",
                "TEMP.Jumper",
                "TEMP.Periscope"
            ],
            "source_name": "ETDA:Leviathan",
            "tools": [
                "AIRBREAK",
                "Agent.dhwf",
                "Agentemis",
                "AngryRebel",
                "BADFLICK",
                "BlackCoffee",
                "CHINACHOPPER",
                "China Chopper",
                "Cobalt Strike",
                "CobaltStrike",
                "DADJOKE",
                "Dadstache",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "Farfli",
                "GRILLMARK",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEFRY",
                "Hellsing Backdoor",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "LUNCHMONEY",
                "Living off the Land",
                "MURKYTOP",
                "Moudour",
                "Mydoor",
                "NanHaiShu",
                "Orz",
                "PCRat",
                "PNGRAT",
                "PlugX",
                "RedDelta",
                "SeDLL",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "ZoxPNG",
                "cobeacon",
                "gresim",
                "scanbox"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "83025f5e-302e-46b0-baf6-650a4d313dfc",
            "created_at": "2024-05-01T02:03:07.971863Z",
            "updated_at": "2025-03-27T02:05:17.278721Z",
            "deleted_at": null,
            "main_name": "BRONZE MOHAWK",
            "aliases": [
                "Flaccid Rose ",
                "GADOLINIUM ",
                "Kryptonite Panda ",
                "Leviathan ",
                "Nanhaishu ",
                "Pickleworm ",
                "Temp.Jumper ",
                "Temp.Periscope ",
                "APT40 "
            ],
            "source_name": "Secureworks:BRONZE MOHAWK",
            "tools": [
                " BlackCoffee",
                " China Chopper",
                " Cobalt Strike",
                " Derusbi",
                " Derusbi Trojan",
                " FUSIONBLAZE",
                " GreenCrash",
                " HOMEFRY",
                " MURKYTOP",
                " Metasploit",
                " Metasploit / Meterpreter",
                " Nanhaishu",
                " Orz",
                " ScanBox",
                " SeDll",
                "AIRBREAK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1666716495,
    "ts_updated_at": 1743041836,
    "ts_creation_date": 1415976001,
    "ts_modification_date": 1415976001,
    "files": {
        "pdf": "https://archive.orkl.eu/c0708a3efcf32d02cfb5348f87fe140ae6f470e8.pdf",
        "text": "https://archive.orkl.eu/c0708a3efcf32d02cfb5348f87fe140ae6f470e8.txt",
        "img": "https://archive.orkl.eu/c0708a3efcf32d02cfb5348f87fe140ae6f470e8.jpg"
    }
}