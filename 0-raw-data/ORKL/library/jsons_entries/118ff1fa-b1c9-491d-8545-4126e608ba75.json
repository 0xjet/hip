{
    "id": "118ff1fa-b1c9-491d-8545-4126e608ba75",
    "created_at": "2023-01-12T14:59:35.294075Z",
    "updated_at": "2025-03-27T02:17:01.028791Z",
    "deleted_at": null,
    "sha1_hash": "2e968d3bdedefb24e3169a7bb2b4a6ef700c366a",
    "title": "2021-10-08 - Actors Target Huawei Cloud Using Upgraded Linux Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T17:06:28Z",
    "file_modification_date": "2022-05-28T17:06:28Z",
    "file_size": 1820852,
    "plain_text": "# Actors Target Huawei Cloud Using Upgraded Linux Malware\n\n**[trendmicro.com/en_us/research/21/j/actors-target-huawei-cloud-using-upgraded-linux-malware-.html](https://www.trendmicro.com/en_us/research/21/j/actors-target-huawei-cloud-using-upgraded-linux-malware-.html)**\n\nOctober 8, 2021\n\nWe have recently noticed another Linux threat evolution that targets relatively new cloud service providers (CSPs) with cryptocurrency-mining\nmalware and cryptojacking attacks. In this article, we discuss a new Linux malware trend in which malicious actors deploy code that\n[removes applications and services present mainly in Huawei Cloud. Specifically, the malicious code disables the hostguard service, a Huawei](https://support.huaweicloud.com/intl/en-us/hss_faq/hss_01_0245.html)\nCloud Linux agent process that “detects security issues, protects the system, and monitors the agent.” The malicious code also\nincludes cloudResetPwdUpdateAgent, an open-source plugin agent that allows Huawei Cloud users to reset a password to Elastic Cloud\n[Service (ECS) instance, which is installed by default on public images. As threat actors have these two services present in their shell scripts,](https://support.huaweicloud.com/intl/en-us/usermanual-ecs/en-us_topic_0068095385.html)\nwe can assume that they are specifically targeting vulnerable ECS instances inside Huawei Cloud.\n\nFigure 1.\n\nMalicious code that disables hostguard and resets the password to ECS instance using the includes cloudResetPwdUpdateAgent plugin agent\nCampaign evolution\n\nWhile researching this campaign, we stumbled upon older samples involved in a campaign that was previously discussed in\n[a 2020 Tencent blog. The samples from that campaign were targeting container environments. There were two specific routines supporting](https://s.tencent.com/research/report/1177.html)\nthis finding: the first one was that one of the payloads of this attack dropped a network scanner to map other hosts with ports commonly\nused as container APIs. The second was a function that created firewall rules to ensure that those container API ports are going to\nopen. On the newer samples we’ve found, the firewall rule creation is still present as a code that’s left behind. However, it’s\nbeen commented on, so no rule is created. We’ve observed that the newer samples are only targeting cloud environments.\n\nAnother interesting capability that we haven’t seen before is that in this campaign, malicious actors have been searching for specific public\nkeys that would allow them to kill off their competition from the infected system and update their own keys. More than any other\nsamples and campaigns we’ve seen so far, this campaign performs a comprehensive sanitization of the operation system. It looks for both\nsigns of previous infections and for security tools that could stop its malicious routines. Not only that, but it also uses simple but effective\ncommands to clean up after it performs its infection routine.\n\nFigure 2. Code showing SSH keys sanitization\nMost of the sourced samples follow the same routine of declaring several functions in no specific order. At the end of the file calling the\nfunctions, it follows a specific order: It performs initial connectivity checking, ensuring that outgoing connections are allowed, and checking\nif DNS servers are public (8.8.8.8 and 1.1.1.1). Such a routine is commonly done to make sure that when malicious URLs are requested, they\nwill not be detected and that the domain translation denied by a Domain Name System (DNS) Security is implemented.\n\n\n-----\n\no o g t e st co ect ty c ec, t e e t set o u ct o s a e t e ca ed to p epa e t e syste t st e o es a y t aces o ect o s\nmade by competitors to avoid sharing computational resources. This kind of behavior was previously seen and documented, but this specific\ncampaign goes beyond when it pertains to maintaining access in the infected system.\n\nFigure 3. The specific order of function that the campaign’s routine follows in order to avoid detection\nUpon further analysis of this campaign, we came across an interesting observation: the threat actors know their competitors well. They are\naware of the users that their competitors use to maintain access. This is why they make sure to check and remove their\ncompetitors’ users first before creating their own users.\n\n\n-----\n\nFigure 4. Malicious actors check for and remove their\n\ncompetitors’ users in the system\nAfter removing unnecessary users from the system, the next step is creating several users of their own. This is another behavior that\nwe have partially seen in other samples targeting cloud environments. The difference of this campaign, however, is that\nit creates a greater number of users using more generic, inconspicuous names such as “system” and “logger.” Using usernames such as these\ncan fool an inexperienced Linux analyst into thinking that these are legitimate users.\n\nAnother unique behavior is that during the creation of the user, the script adds them to the sudoers list to give them administrative powers over\nthe infected system.\n\n\n-----\n\nFigure 5. The malicious actors create generic users to avoid detection and add them to the sudoers list\nThe hacking team also adds their own ssh-rsa key to enable them to repeatedly log in to the infected system. After conducting system\nmodifications, they add special permissions to prohibit further modifications from being applied to those files. This ensures\nthat the malicious users that they created cannot be removed or modified.\n\n\n-----\n\nFigure 6. The malicious actors add their own ssh-rsa key to enable them to repeatedly log in on the infected system\nAnother interesting aspect of this campaign is that it installs The Onion Router (Tor) proxy service. This will be used later by the\npayloads to anonymize the malicious connections made by the malware.\n\n\n-----\n\ncampaign installs and uses the Tor proxy service to anonymize malicious connections\nCampaign payloads and upgraded functionalities\n\nThe script deploys two executable and linkable format (ELF) binaries — linux64_shell and xlinux.\n\ndiagram that shows the malicious script deploying two ELF binaries, linux64_shell and xlinux\n**linux64_shell**\n\n\nFigure 7. The\n\nFigure 8. A\n\n\nThe binary itself is packed and obfuscated, the Ultimate Packer for Executables (UPX) packer has been used, but then the binary was\ntampered with in order to make the analysis harder and fooling some of the automated toolsets\n\n\n-----\n\nFigure 9. UPX header present in the binary\n\nUpon closer look, we can see that another binary with extra data was appended to the file.\n\nFigure 10. Another binary appended to the file\n\n[The appended binary is a compiled CrossC2 communication library included to be able to interact directly with CobaltStrike’s module using the](https://github.com/gloxec/CrossC2/blob/cs4.1/protocol_demo/c2profile.c)\nfollowing functions:\n\ncc2_rebind_http_get_recv\ncc2_rebind_http_post_send\ncc2_rebind_post_protocol\ncc2_rebind_http_get_send\n\nAfter it is successfully unpacked, the executable continues with its control flow, which is designed to not be easily understood by an\nanalyst and is full of conditional jumps.\n\nFigure 11. Obfuscated control flow full of (conditional) jumps\n\nAt this point, the malware tries to connect to the C&C with an IP address of 45[.]76[.]220[.]46 on port 40443. This provides shell access to the\nattackers.\n\n**xlinux**\n\n[The second binary is a Go-compiled binary implementing several modules from the kunpeng framework. It acts as](https://github.com/opensec-cn/kunpeng)\na vulnerability scanner, exploits weaknesses, and deploys the initial malicious script.\n\n1. The binary notifies malicious actors about the infected machine by sending an HTTP POST request to following\nURL 103[.]209[.]103[.]16:26800/api/postip\n\n2. It copies itself into /tmp/iptablesupdate and drops a persistence script\n\n\n-----\n\nFigure 12. Dropped script makes the Go binary persistent\n\n3. The binary begins with a “security” scan. Once a weakness is found, it exploits it and deploys its payload\n\nFigure 13. An example of an integrated exploit\n\nAn infected system is scanned for the following vulnerabilities and security weaknesses:\n\nSSH weak passwords\nVulnerability in the Oracle WebLogic Server product of Oracle Fusion Middleware (CVE-2020-14882)\nRedis unauthorized access or weak passwords\nPostgreSQL unauthorized access or weak password\nSQLServer weak password\nMongoDB unauthorized access or weak password\nFile transfer protocol (FTP) weak password\n\nConclusion\n\n[Cryptocurrency miners are one of the most deployed payloads in the Linux threat landscape. In recent years, we have observed malicious](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/linux-threat-report-2021-1h-linux-threats-in-the-cloud-and-security-recommendations)\nactors such as [TeamTNT and](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/teamtnt-activities-probed) [Kinsing launch](https://www.trendmicro.com/en_gb/research/20/k/analysis-of-kinsing-malwares-use-of-rootkit.html) [cryptojacking campaigns and cryptocurrency mining malware that competes for the computing](https://www.trendmicro.com/vinfo/ph/security/news/cybercrime-and-digital-threats/cryptojacking-gaining-traction-as-starbucks-and-streaming-users-targeted)\npowers of infected resources.\n\nIn 2020 and 2021 we have seen how these cybercriminal groups consistently targeted cloud environments and added cloud-centric features to\n[their campaigns, including credential harvesting and the removal of cloud security services related to Alibaba Cloud and Tencent Cloud.](https://www.trendmicro.com/en_us/research/21/e/teamtnt-extended-credential-harvester-targets-cloud-services-other-software.html)\n\nCloud service misconfigurations can allow cryptocurrency mining and cryptojacking attacks to happen. Most of the attacks that we’ve\nmonitored occurred because the services running on the cloud had an API or an SSH with\nweak credentials or had very permissive configurations, which attackers can abuse to enable them to infiltrate a system without needing to\nexploit any vulnerabilities. Misconfigurations are a common point of entry in such scenarios, and cloud users should give the same thought and\nattention to misconfigurations as they do to vulnerabilities and malware.\n\nOur team published several blogs and a research paper that shows how malicious actors targeted a specific cloud provider. In this blog, we\nhave seen evidence of cybercriminals targeting other relatively newer CSPs like Huawei Cloud. Since attackers are also migrating to the\ncloud, the availability and scalability of resources are becoming even more precious since most of\ntheir attacks routinely deploy cryptojacking malware among other malicious routines.\n\nWe have reached out to Huawei Media Team through their email address listed on their Contact Us page with our findings prior to the\npublication of this blog, and we are currently awaiting their acknowledgment or reply.\n\nCloud security recommendations\n\nMalicious actors and hacking groups continue to upgrade their malware’s capabilities to make the most of their attacks. To keep cloud\nenvironments secure, organizations must not rely solely on malware scanning and vulnerability checking tools. Checking and studying the\nresponsibility model of their CSPs can help them define the best policies to put into place when publishing their cloud services.\n\nMITRE ATT&CK Tactics and Techniques\n\n\n-----\n\nIndicators of compromise\n\nSHA-256\n\n3e38c51510f95643b04a9ba0f884a445f09372721073601abcbf8f12f663bf90\n\n\nfczyo Coinminer.Linux.XANTHE.B\n\n\nFile\n\n\nDetection Names\n\n\n6a5a0bcb60944597d61d5311a4590f1850c2ba7fc44bbcde4a81b2dd1effe57c fczyo\n\n\nCoinminer.Linux.XANTHE.A\n\n\n71f578d122252c7fa67ca343cd29d65ac42d6f7c45bf91f146a1cd04b0446c23 fczyo Coinminer.Linux.XANTHE.B\n\n9849c66d8b6c444904259cda7f3e34ac2c60b00a945d3d5b911b5e290eb2888d fczyo Coinminer.Linux.XANTHE.B\n\nd092b4cbf655d02ad8eae1a66db98e67cf95fa9e0b7c327c4bca33815696bf68 ff.sh Trojan.SH.CVE20205902.B\n\ne8503d6697c61c2c51ca90742b0634ce93710d6fdfb0965e35977e6cab4d039b xlinux Coinminer.Linux.PROCEAN.A\n\nf36d3996245dba06af770d1faf3bc0615e1124fa179ecf2429162abd9df8bbf8 Linux64-shell Trojan.Linux.COBEACON.A\n\nfc614fb4bda24ae8ca2c44e812d12c0fab6dd7a097472a35dd12ded053ab8474 ff.sh Trojan.SH.CVE20205902.B\n\n**Keys**\n\nAAAAB3NzaC1yc2EAAAADAQABAAABAQDLVZNrAJ1uzR7d2bm1iUQPAgjuBlyLQQNaEHVmACWtGwwiOKMPiFBfBjuNJIyZFnGkkFgJP5fi8v1eq\nlinux@linux.com\" >>/opt/autoupdater/.ssh/authorized_keys\n\n**C&C Servers**\n\n103[.]209[.]103[.]16\n45[.]76[.]220[.]46\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-08 - Actors Target Huawei Cloud Using Upgraded Linux Malware.pdf"
    ],
    "report_names": [
        "2021-10-08 - Actors Target Huawei Cloud Using Upgraded Linux Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "81dde5cc-c29f-430d-8c6e-e5e92d5015e7",
            "created_at": "2022-10-25T16:07:23.704358Z",
            "updated_at": "2025-03-27T02:02:09.932453Z",
            "deleted_at": null,
            "main_name": "Harvester",
            "aliases": [],
            "source_name": "ETDA:Harvester",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "Graphon",
                "Metasploit",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a3687241-9876-477b-aa13-a7c368ffda58",
            "created_at": "2022-10-25T16:07:24.496902Z",
            "updated_at": "2025-03-27T02:02:10.256629Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "ETDA:Hacking Team",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f809bfcb-b200-4988-80a8-be78ef6a52ef",
            "created_at": "2023-01-06T13:46:39.186988Z",
            "updated_at": "2025-03-27T02:00:03.016358Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "Adept Libra"
            ],
            "source_name": "MISPGALAXY:TeamTNT",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e90c06e4-e3e0-4f46-a3b5-17b84b31da62",
            "created_at": "2023-01-06T13:46:39.018236Z",
            "updated_at": "2025-03-27T02:00:02.978356Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "MISPGALAXY:Hacking Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c3ca592f-0669-49bd-ab5c-310007ab2fb4",
            "created_at": "2022-10-25T15:50:23.334495Z",
            "updated_at": "2025-03-27T02:00:55.445098Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "TeamTNT"
            ],
            "source_name": "MITRE:TeamTNT",
            "tools": [
                "Peirates",
                "MimiPenguin",
                "LaZagne",
                "Hildegard"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a6c351ea-01f1-4c9b-af75-cfbb3b269ed3",
            "created_at": "2023-01-06T13:46:39.390649Z",
            "updated_at": "2025-03-27T02:00:03.072899Z",
            "deleted_at": null,
            "main_name": "Kinsing",
            "aliases": [
                "Money Libra"
            ],
            "source_name": "MISPGALAXY:Kinsing",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535575,
    "ts_updated_at": 1743041821,
    "ts_creation_date": 1653757588,
    "ts_modification_date": 1653757588,
    "files": {
        "pdf": "https://archive.orkl.eu/2e968d3bdedefb24e3169a7bb2b4a6ef700c366a.pdf",
        "text": "https://archive.orkl.eu/2e968d3bdedefb24e3169a7bb2b4a6ef700c366a.txt",
        "img": "https://archive.orkl.eu/2e968d3bdedefb24e3169a7bb2b4a6ef700c366a.jpg"
    }
}