{
    "id": "2c8b827d-d876-4d82-922c-85a504b3786a",
    "created_at": "2023-01-12T15:01:56.675007Z",
    "updated_at": "2025-03-27T02:05:47.653689Z",
    "deleted_at": null,
    "sha1_hash": "0edc921ca80c5d18a54aaebb486e5718a3c4f111",
    "title": "2022-01-24 - How BRATA is monitoring your bank account",
    "authors": "",
    "file_creation_date": "2022-05-27T22:52:00Z",
    "file_modification_date": "2022-05-27T22:52:00Z",
    "file_size": 6691516,
    "plain_text": "# How BRATA is monitoring your bank account\n\n**[cleafy.com/cleafy-labs/how-brata-is-monitoring-your-bank-account](https://www.cleafy.com/cleafy-labs/how-brata-is-monitoring-your-bank-account)**\n\nFederico Valentini, Francesco Iubatti\n\n## Download your PDF guide to TeaBot \n\nGet your free copy to your inbox now\n\nDownload PDF Version\n\n## Introduction\n\n[In our previous article “Mobile banking fraud: BRATA strikes again” we’ve described how](https://www.cleafy.com/cleafy-labs/mobile-banking-fraud-brata-strikes-again)\nthreat actors (TAs) leverage the Android banking trojan BRATA to perpetrate fraud via\nunauthorized wire transfers.\n\nIn this article, we are presenting further insights, on how BRATA is evolving in terms of both\nnew targets and new features, such as:\n\nCapability to perform the device factory reset: it appears that TAs are leveraging this\nfeature to erase any trace, right after an unauthorized wire transfer attempt.\n**GPS tracking capability**\nCapability to use multiple communication channels (HTTP and TCP) between the\ndevice and the C2 server to keep a persistent connection.\nCapability to continuously monitor the victim's bank application through VNC and\n**keylogging** **techniques.**\n\n\n-----\n\nA new BRATA variant started circulating last December. Our research shows that it has been\ndistributed through a downloader to avoid being detected by antivirus solutions.\n\nThe target list now contains further banks and financial institutions in the UK (new), Poland\n(new), Italy, and LATAM.\n\nFigure 1 – The upward trend of BRATA during the last month\n\n## Evolution of BRATA malware\n\nOur [previous article analyzed multiple BRATA samples from different campaigns targeting](https://www.cleafy.com/cleafy-labs/mobile-banking-fraud-brata-strikes-again)\ncustomers of one of the most prominent Italian retail banks. However, during the last months,\nour telemetry noticed two new waves of the BRATA samples. The first wave started in\nNovember 2021, and the second around mid-December 2021. During the second wave, TAs\nbegan to deliver a few new tailored variants of BRATA in different countries, in particular\nagainst banking customers of the UK (NEW), Poland (NEW), Italy, and LATAM (but we also\nspotted some samples containing Spanish and Chinese strings).\n\nFigure 2 – Some of the most common BRATA’s icon app\n\n\n-----\n\nFigure 3 – The main three variants of BRATA\nAt the time of writing, we intercepted the primary variants of **BRATA (variant A,** **B, C), as**\nshown in Figure 3.\n\n**BRATA.A is the most used during the past months. During December, TAs added mainly two**\nnew features: the GPS tracking of the victim device, which appears to be still under\ndevelopment, and the capability to execute a factory reset of the infected device, as\ndescribed in the following chapters.\n\n**BRATA.B has almost the same capabilities and features. However, the main differences**\nfound are the partial obfuscation of the code and the use of tailored overlay pages used to\nsteal the security number (or PIN) of the targeted banking application, as shown in Figure 4.\n\nFurthermore, in this variant, the HTTP communications between the malicious app and the\nC2 appear to be in clear text, while in BRATA.A were compressed with the zlib library.\n\n\n-----\n\nFigure 4 - Example of BRATA overlay used to steal the security number of the victim\n**BRATA.C is composed of an initial dropper used to download and execute the “real”**\nmalicious app later. [As already shown, TAs are continually modifying the malware to avoid](https://www.cleafy.com/cleafy-labs/mobile-banking-fraud-brata-strikes-again)\nbeing detected by antivirus solutions using unconventional techniques. Although the majority\n\n\n-----\n\nof Android banking trojans try to obfuscate/encrypt the malware core in an external file (eg.\n_.dex or .jar), BRATA uses a minimal app to download in a second step the core BRATA app_\n(.apk).\n\nFigure 5 – The BRATA downloader is almost not detected by any antivirus solution\n\nFigure 6 – Permissions declared inside the AndroidManifest of the last variant of BRATA\n\nFigure 7 – Installation phases of the new variant of BRATA\nIn Figure 7, we summarize the installation phases of the BRATA.C. After the victim installs\nthe downloader app, it requires accepting just one permission to download and install the\nmalicious application from an untrusted source. When the victim clicks on the install button,\nthe downloader app sends a GET request to the C2 server to download the malicious .apk.\nAt this point, the victim has two malicious apps installed on their device.\n\n\n-----\n\n## Bank Account Monitoring\n\nLike other leading Android banking trojans, BRATA has its own custom methods to monitor\nbank accounts and other victims’ actions performed on its mobile device. Through BRATA,\nTAs will obtain Accessibility Service permissions during the installation phases to observe the\nactivity performed by the victim and/or use the VNC module to retrieve private information\nshown in the device’s screen (e.g bank account balance, transaction history, etc.).\n\nAs soon as TAs send the command “get_screen” from the C2 server, BRATA starts to take\nscreenshots of the victim’s device and send it back to the C2 server through the HTTP\nchannel, as shown in Figure 9.\n\nFigure 8 – BRATA receives the “get_screen” from the C2 server\n\nFigure 9 – Example of screenshot sent to the C2 server\nAn additional functionality that was observed is keylogging. BRATA.B monitors all users’\nkeystrokes when visiting the targeted bank application. Let’s consider a common scenario,\nlike the one shown in Figure 10, where a victim opens up his bank application and starts\ntyping into the two visible fields, Agencia and Conta. If the keylogging functionality is\nenabled, the two numbers provided by the victim will be sent to the C2 server for further\nprocessing.\n\n\n-----\n\nFigure 10 – Hooking of cuenta and agencia fields of the targeted bank\n\n## GPS Tracking\n\nBy analyzing the application’s manifest, it has been possible to discover the GPS permission\nthat is intended to be used by the application. As far as we know, this feature is actually\nrequested at installation; however, no evidence in the code is actually used. For this reason,\nwe could just guess that malware developers are requesting this permission for future\ndevelopment, most likely to target people that belong to specific countries or to enable other\ncash-out mechanisms (e.g. cardless ATMs).\n\nIt's worth mentioning that a GPS signal could be easily disguised by third party applications\nand, because of that, it is possible that the development phase has been currently stopped.\n\n\n-----\n\nFigure 11 – GPS permission requests by BRATA\n\n## Factory Reset\n\n\n-----\n\nAccording to the analysis performed on new BRATA samples, it was found that a factory\nreset feature has been implemented. More precisely, according to the information retrieved,\nthis mechanism represents a kill switch for this malware. In fact, it was also observed that\nthis function is executed in two cases:\n\nA bank fraud has been completed successfully. In this way, the victim is going to lose\neven more time before understanding that a malicious action happened.\nThe application is installed in a virtual environment. BRATA tries to prevent dynamic\nanalysis through the execution of this feature.\n\nThese statements are confirmed from the keyword SendMsg_formatdevice within the\n_eventname structure, which is actually used each time an action is performed._\n\nFigure 12 – List of commands used by a new sample of BRATA\n__wsh_formatthisdevice is the function in charge of performing the mobile phone reset. As_\nshown in Figure 13, it is a standard procedure that checks if the admin manager variable is\nset, then initializes the reflection class and retrieves the Device Manager (dm) to run the\n_[wipeData[1] method.](https://developer.android.com/reference/android/app/admin/DevicePolicyManager)_\n\nFigure 13 – Factory reset function\n\n\n-----\n\nFigure 14 – “device admin” permission requested by BRATA\n\n[1] [https://developer.android.com/reference/android/app/admin/DevicePolicyManager](https://developer.android.com/reference/android/app/admin/DevicePolicyManager)\n\n## Communication Channels\n\n\n-----\n\nIt has been observed that BRATA and its C2 are using multiple channels to communicate\nwith each other. More specifically, the first communications are made by the application\ntowards the C2 through the HTTP protocol, and then, if the server is online, it is forced to\nswitch the connection towards the WebSocket protocol (Figure 15).\n\nDuring these HTTP exchanges, BRATA verifies and removes any antivirus apps installed on\nthe infected device (Figure 16) and subsequently receives its configuration file from the C2\nserver.\n\nFigure 15 – Starting communication\n\n\n-----\n\nFigure 16 – List of antivirus app that BRATA is able to remove\nThis switch of channels could be justified by the fact that WebSocket is an event-driven\nprotocol, which means that it is suitable for real time communication. Moreover:\n\nWebSockets keeps a single, persistent connection open while eliminating latency\nproblems that arise with HTTP request/response-based methods.\nWebSockets generally do not use XMLHttpRequest, and as such, headers are not sent\nevery-time we need to get more information from the server. This, in turn, reduces the\nexpensive data loads being sent to the server.\n\nReducing the amount of data transferred from the C2 and its application is, then, crucial,\nespecially when you want to exfiltrate data in a network that could be under a continuous\ntraffic monitoring system.\n\n\n-----\n\nAs shown in Figure 17, WebSocket protocol is used by the C2 that sends specific commands\nthat need to be executed on the phone (e.g, whoami, byebye_format, screen_capture, etc.).\nAs far as we know, the malware (on connection perspective) is in a waiting **state most of the**\ntime, until the C2 issues commands instructing the app for the next step.\n\nFigure 17 - factory reset command sent\n\n## Final Considerations\n\nThis research aims to show how BRATA is trying to reach out to new targets and to develop\n[new features. Since its discovery made by Karspesky in 2019, we were able to collect](https://securelist.com/spying-android-rat-from-brazil-brata/92775/)\nevidence and monitor how TAs are leveraging this banking trojan for performing frauds,\ntypically through unauthorized wire transfer (e.g. SEPA) or through Instant Payments, using a\nwide network of money mules accounts in multiple European countries.\n\nAccording to our findings, we can expect BRATA to keep staying undetected and to keep\ndeveloping new features.\n\nAppendix 1: IOCs\n\n**IoC** **Description**\n\n220ec1e3effb6f4a4a3acb6b3b3d2e90 BRATA.A\n\ne664bd7951d45d0a33529913cfbcbac0 BRATA.B\n\n2dfdce36a367b89b0de1a2ffc1052e24 BRATA.C (downloader)\n\n5[.]39[.]217[.]241 C2 server\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-24 - How BRATA is monitoring your bank account.pdf"
    ],
    "report_names": [
        "2022-01-24 - How BRATA is monitoring your bank account.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535716,
    "ts_updated_at": 1743041147,
    "ts_creation_date": 1653691920,
    "ts_modification_date": 1653691920,
    "files": {
        "pdf": "https://archive.orkl.eu/0edc921ca80c5d18a54aaebb486e5718a3c4f111.pdf",
        "text": "https://archive.orkl.eu/0edc921ca80c5d18a54aaebb486e5718a3c4f111.txt",
        "img": "https://archive.orkl.eu/0edc921ca80c5d18a54aaebb486e5718a3c4f111.jpg"
    }
}