{
    "id": "7f2d074f-8817-4c43-80ad-b7d668625c7f",
    "created_at": "2023-01-12T15:09:58.215188Z",
    "updated_at": "2025-03-27T02:05:52.828394Z",
    "deleted_at": null,
    "sha1_hash": "e12122efa88e4215a2ee003f328c811382760ac8",
    "title": "2022-03-09 - Set up Splunk for Incident Response in GCP in 15 minutes..",
    "authors": "",
    "file_creation_date": "2022-05-28T18:21:19Z",
    "file_modification_date": "2022-05-28T18:21:19Z",
    "file_size": 270649,
    "plain_text": "# Set up Splunk for Incident Response in GCP in 15 minutes..\n\n**[invictus-ir.medium.com/set-up-splunk-for-incident-response-in-gcp-in-15-minutes-52eebc7e5a91](https://invictus-ir.medium.com/set-up-splunk-for-incident-response-in-gcp-in-15-minutes-52eebc7e5a91)**\n\nInvictus Incident Response March 9, 2022\n\n[Invictus Incident Response](https://invictus-ir.medium.com/?source=post_page-----52eebc7e5a91--------------------------------)\n\nMar 9\n\n\n6 min read\n\nSplunk dashboard\n\nOften as part of an incident response engagement you will find yourself looking at logs for\nanalysis purposes. We really like Splunk for ad-hoc log analysis, it has a really powerful\nquery language and lots of support for logs. And if you‚Äôre reading this and you‚Äôre thinking, but\n[I don‚Äôt have a Splunk license, don‚Äôt worry there is something called Splunk Free. It can be](https://docs.splunk.com/Documentation/Splunk/8.2.5/Admin/MoreaboutSplunkFree)\nuseful for some basic testing and daily ingestion of 500MB worth of logs. If you‚Äôre planning to\nuse Splunk in your enterprise environment a free license is not advised, because its features\nare limited.\n\nNow back to the promise, set up your log analysis environment in 15 minutes. We‚Äôll show\nyou how in this blog post that covers:\n\nConfigure a Windows virtual machine in Google Cloud with Splunk\nUpload your evidence to your Splunk machine for further processing and analysis\n\n\n-----\n\n(Optional) Connect your instance to a custom domain and install a certificate with\nLetsencrypt\n\n## Step 1 ‚Äî Install Windows and Splunk\n\nThe reason for picking Windows as the base operating system is that it is required for the\nanalysis of local Windows Event Logs.\n\nThe Splunk universal forwarder or Splunk Enterprise instance must run on Windows.\nSee [Install on Windows in the Installation Manual.](http://docs.splunk.com/Documentation/Splunk/8.2.5/Installation/InstallonWindows)\n\nFirst we login on GCP ()\nIn the menu on the left-hand side select and next\nConfigure machine type, for basic ad-hoc workloads select\nConfigure boot disk, select Windows Server with one of the recent versions with the\nenabled. Configuring Splunk without the GUI in this setup can be a pain.\nSetup an external IP address for your Splunk machine.\n\n**Virtual machine configuration The configuration depends on personal preference, budget**\nand how you want to use the machine. The idea is that you only need to perform short adhoc tasks with some basic compute power. If you need high-performance you can make\ndifferent choice such as a SSD disk or more CPUs.\n\nNow that we have a Windows server up and running it‚Äôs time to install Splunk.\n\nConnect to the server, this is out of scope for this blog, but we trust you‚Äôll be able to\nsuccessfully connect through RDP to the machine.\nOpen a browser and go to\nAfter logging in, select Windows and then the .MSI file for Windows\nInstall the executable and open up Splunk\n\nThe above steps are pretty straightforward you should know have Splunk running on a\nWindows server in GCP ready to use. We‚Äôll do some additional configuration:\n\nEnable HTTPS on Splunk on port 443\nAllow incoming traffic on port 443 in the Windows Firewall\n\nNow we‚Äôre able to connect to our public IP and access Splunk. At this stage there is no valid\ncertificate so you‚Äôll get a lot of warnings, but it works. In the last part of this blog we will take\ncare of that problem.\n\n## Step 2 ‚Äî Upload evidence for analysis\n\n\n-----\n\nNow that we have a Splunk instance running we can transfer evidence to the machine for\nfurther analysis. In most of the incident response cases we see, we acquire or receive data\nfrom the client and manually transfer it into our analysis environment. Let‚Äôs assume we have\na local directory with evidence containing some Windows Event Log files (.evtx) files that we\nwant to analyse. To get the logs into Splunk you need to follow the below steps:\n\nInstall the Google Cloud CLI environment on your local system, you can follow the\nofficial documentation from .\nCreate a Cloud Storage bucket or identify an existing bucket that you want to use to\ntransfer files. In the example below we‚Äôve created a bucket with the name\nblog_evidence. Important you have to add your project id and geographical location of\nthe storage bucket.\n\ngsutil mb -p insert_project_id -l insert_location -b on gs://blog_evidence\n\nNext from your workstation, upload the eventlog to the storage bucket.\n\ngsutil cp eventlog.evtx gs://blog_evidence\n\nConnect to your VM using RDP.\nOn your VM, download files from the bucket. You can do this by opening the Google\nCloud Shell SDK, from the shortcut on your desktop and use the following command to\ndownload the files to a local directory called ‚Äòevidence‚Äô.\n\ngsutil cp gs://blog_evidence/eventlog.evtx C:\\Users\\korstiaan\\Desktop\\evidence\\\n\nAlternatively you can use other methods for data transfer see the below table from Google‚Äôs\n[documentation.](https://cloud.google.com/compute/docs/instances/transfer-files#transfergcloud_)\n\nAnother possibility it to use Google Storage Buckets/S3 buckets or setup a live connection to\na system for data ingestion. If this is interesting for you, please let us know and we might\nwrite a new blog on that topic.\n\nLast but not least we create an inputs file in Splunk that points to the evidence directory and\ngrabs all the .evtx files. An example config is shown below:\n\n[monitor://C:\\Users\\korstiaan\\Desktop\\evidence\\*.evtx]\n\nindex=main\n\nsourcetype=preprocess-winevt\n\n\n-----\n\nNow we have the logs in our Splunk cloud instance and can start our analysis.\n\nYou can stop here if this is enough for you, but we suggest securing your traffic and\nenvironment a bit further by adding in a certificate and running it on a custom domain.\n\n## Step 3 ‚Äî (Optional) Setup SSL on a custom domain name\n\nTo get your own certificate and point your newly created Splunk environment to a custom\ndomain, we need to perform a few additional steps:\n\nInstall A record on Google domains (or where you host your domain)\nInstall Letsencrypt on the Splunk instance\nConfigure Splunk with the new certificate\n\n**Install A recordIn the first step we need to setup an A record on your DNS server to point**\nyour public IP-address from your Splunk machine to a hostname. In this example Google\nDomains was used for the configuration.\n\nGo to domains.google.com select your domain and in the menu select\nSelect after setting the hostname make sure the Type is set to A and add in the public\nIP of your Splunk instance and hit\n\nNow you can use the hostname splunk-blog.invivctus-ir.com to access your Splunk\ninstance.\n\n**Install and configure Letsencrypt on your Splunk machineNext it‚Äôs time to move over to**\nour Splunk server and download Letsencrypt for Windows. The tool that will help us\nautomatically generate and renew certificates is Certbot and we can download it from\n[GitHub.](https://github.com/certbot/certbot/releases/tag/v1.24.0)\n\n\n-----\n\nAfter installing Certbot with the default configuration open up an elevate command prompt\nand run the following command:\n\ncertbot certonly ‚Äî standalone -d splunk-blog.invictus-ir.com\n\nChange the domain to match your custom domain that you created in your DNS.\n\n**Configure Splunk with the new certificateWith the newly created certificate we need to**\ncopy the certificate and private key and point Splunk to those files.\n\nCreate a new directory to store the files\n\nmkdir ‚ÄúC:\\Program Files\\Splunk\\etc\\auth\\splunk-blog‚Äù\n\nCopy the certificate and private key from the Certbot directory to the new directory.\n\ncopy C:\\Certbot\\live\\splunk-blog.invictus-ir.com\\fullchain.pem ‚ÄúC:\\Program\nFiles\\Splunk\\etc\\auth\\splunk-blog\\‚Äù\n\ncopy C:\\Certbot\\live\\splunk-blog.invictus-ir.com\\privkey.pem ‚ÄúC:\\Program\nFiles\\Splunk\\etc\\auth\\splunk-blog\\‚Äù\n\nNext we configure Splunk to use these files, create the following file in ‚ÄúC:\\Program\nFiles\\Splunk\\etc\\system\\local\\web.conf‚Äù\nAdd the following information to the file\n\n[settings]\nenableSplunkWebSSL = 1\nprivKeyPath = C:\\Program Files\\Splunk\\etc\\auth\\splunk-blog/privkey.pem\ncaCertPath = C:\\Program Files\\Splunk\\etc\\auth\\splunk-blog/fullchain.pem\n\nRestart Splunk and look at this‚Ä¶\n\n\n-----\n\n## Conclusion\n\nWe hope you find this useful and before you start to scream, but what about Docker!!\nWorking with Docker and external file locations containing evidence can be a pain. Also if\nyou want to run it on a more continuous base a virtual server might be more suitable. Not too\nmention that with this setup you can easily add more resources to increase performance.\n\n## About Invictus Incident Response\n\nWe are an incident response company specialised in supporting organisations facing a cyber\nattack. We help our clients stay undefeated!\n\n[üÜò Incident Response support reach out to cert@invictus-ir.com or go to](https://emojikeyboard.org/copy/SOS_Sign_Emoji_%F0%9F%86%98)\n[https://www.invictus-ir.com/247](https://www.invictus-ir.com/247)\n\n[üìß Questions or suggestions contact us at info@invictus-ir.com](https://emojikeyboard.org/copy/E-Mail_Symbol_Emoji_%F0%9F%93%A7)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-09 - Set up Splunk for Incident Response in GCP in 15 minutes...pdf"
    ],
    "report_names": [
        "2022-03-09 - Set up Splunk for Incident Response in GCP in 15 minutes...pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536198,
    "ts_updated_at": 1743041152,
    "ts_creation_date": 1653762079,
    "ts_modification_date": 1653762079,
    "files": {
        "pdf": "https://archive.orkl.eu/e12122efa88e4215a2ee003f328c811382760ac8.pdf",
        "text": "https://archive.orkl.eu/e12122efa88e4215a2ee003f328c811382760ac8.txt",
        "img": "https://archive.orkl.eu/e12122efa88e4215a2ee003f328c811382760ac8.jpg"
    }
}