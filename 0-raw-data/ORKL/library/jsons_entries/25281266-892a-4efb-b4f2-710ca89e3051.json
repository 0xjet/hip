{
    "id": "25281266-892a-4efb-b4f2-710ca89e3051",
    "created_at": "2022-10-25T16:48:24.548368Z",
    "updated_at": "2025-03-27T02:05:56.781299Z",
    "deleted_at": null,
    "sha1_hash": "fdfff8084e578e20f5dd8528b04aa144e87b4719",
    "title": "Black DDoS - Securelist",
    "authors": "",
    "file_creation_date": "2016-01-29T10:23:02Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 1032531,
    "plain_text": "# 5\n\n\n# 0\n\n\n**Google**\n\n\n**Cybercriminals use a variety of bots to conduct DDoS attacks on Internet servers. One of the most**\n\n**popular tools is called Black Energy. To date, Kaspersky Lab has identified and implemented detection**\n\n**for over 4,000 modifications of this malicious program. In mid-2008 malware writers made significant**\n\n**modifications to the original version, creating Black Energy 2 (which Kaspersky Lab detects as**\n\n**Backdoor.Win32.Blakken). This malicious program is the subject of this article.**\n\n**The bot has several main functions: it hides the malware code from antivirus products, infects system**\n\n**processes and, finally, offers flexible options for conducting a range of malicious activities on an**\n\n**infected computer when commands are received from the botnet command-and-control (C&C) center.**\n\n**Each task is performed by a different component of the malicious program.**\n\n\n-----\n\n**Figure 1. A step-by-step guide to how Black Energy 2 works**\n\n**Like most other malicious programs, Black Energy 2 has a protective layer that hides the malicious**\n\n**payload from antivirus products. This includes encryption and code compression; anti-emulation**\n\n**techniques can also be used.**\n\n**Once the Black Energy 2 executable is launched on a computer, the malicious application allocates**\n\n**virtual memory, copies its decryptor code to the memory allocated and then passes control to the**\n\n**decryptor.**\n\n**Execution of the decryptor code results in code with dropper functionality being placed in memory.**\n\n**Once the dropper code is executed, a decryptor driver with a random name, e.g. “EIBCRDZB.SYS”, is**\n\n**created in system32drivers. A service (which also has a random name) associated with the driver is**\n\n**then created and started:**\n\n\n-----\n\n**Figure 2. The launch of the malicious decryptor driver**\n\n**Like the original executable, this driver is, in effect, a ‘wrapper’ that hides the most interesting part of**\n\n**the malware.**\n\n**The code of the decryptor driver contains a block of encrypted and packed data:**\n\n\n-----\n\n**Figure 3. Encrypted data within the decryptor driver**\n\n**The data block has the following structure:**\n\n**Figure 4. Encrypted data structure**\n\n**The key from this block is used to create another key, 100h bytes in size, which is used to decrypt the**\n\n**archive. The encryption is based on the well-known RC4 algorithm. If the archive size is equal to the**\n\n**data size, it means that the data is not packed. However, if the two do not coincide, the encrypted**\n\n**archive has to be unpacked.**\n\n**The decrypted data is an infector driver which will inject a DLL into the svchost.exe user-mode process.**\n\n**In order to launch the infector driver, the decryptor driver allocates memory, copies the decrypted code**\n\n**to that memory area, remaps address offset fixups and passes control to it. The malicious DLL is**\n\n**stored in the .bdata section of the infector driver. This data block has the same structure as that**\n\n**described above. The infector driver locates the svchost.exe process and allocates memory in its**\n\n**address space. The malicious DLL is then copied to this memory area and address offsets are**\n\n**remapped according to the relocation table. The injected library’s code is then launched from kernel**\n\n**mode as shown below:**\n\n\n-----\n\n**Figure 5. Launching the DLL injected into svchost.exe**\n\n**This method uses APC queue processing. First, an APC with the address of the DllEntry function for the**\n\n**library injected is initialized, then the APC is queued using KeInsertQueueApc APC. As soon as**\n\n**svchost.exe is ready to process the APC queue (which is almost immediately), a thread from the**\n\n**DllEntry address is launched in its context.**\n\n**The DLL which is injected into svchost.exe is the main controlling factor in launching a DDoS attack**\n\n**from an infected computer. Like the infector driver, the DLL has a .bdata section; this includes a block**\n\n**of encrypted data, which has the same structure as that shown above. The data makes up an xml**\n\n**document that defines the bot’s initial configuration. This screenshot gives an example:**\n\n**Figure 6. The bot’s initial settings**\n\n**The address of the botnet’s C&C is of course the most important information In this case two**\n\n\n-----\n\n**the bot can attempt to connect to its owner using the backup address.**\n\n**The bot sends a preformed http request to the C&C address; this is a string containing data which**\n\n**identifies the infected machine. A sample string is shown below:**\n\n**id=xCOMPUTERNAME_62CF4DEF&ln=ru&cn=RU&nt=2600&bid=3**\n\n**The id parameter, which is the infected machine’s identifier, includes the computer name and the serial**\n\n**number of the hard disk on which the C: drive is located. This is followed by operating system data:**\n\n**system language, OS installation country and system build number. The build identifier for the bot (**\n\n**‘build_id’ in the initial configuration options xml document) completes the string.**\n\n**The format of the request string is used as confirmation that the request actually comes from the bot. In**\n\n**addition, the C&C center also uses the user-agent header of the http request as a password of sorts.**\n\n**If the C&C accepts the request, it responds with a bot configuration file which is also an encrypted xml**\n\n**document. RC4 is also used to encrypt this file, with the infected machine’s identifier (the id parameter**\n\n**of the request string, in the example above – xCOMPUTERNAME_62CF4DEF) serving as a key.**\n\n**Here is an example of such instructions:**\n\n\n-----\n\n**Figure 7. Configuration file – instructions from the C&C**\n\n**The section tells the bot which modules are available on the owner’s server to set up a DDoS attack. If**\n\n**the bot does not have a particular module or if a newer version is available on the server, the bot will**\n\n**send a plug-in download request to the server, e.g.:**\n\n**getp=http&id=xCOMPUTERNAME_62CF4DEF &ln=ru&cn=RU&nt=2600&bid=3**\n\n**A plug-in is a DLL library, which is sent to the bot in an encrypted form. If the key used to encrypt a**\n\n**plugin differs from the value of the id parameter, it will be specified in the field of the configuration file.**\n\n**Once the plug-in DLL has been received and decrypted, it will be placed in the memory area allocated.**\n\n**It is then ready to begin a DDoS attack as soon as the appropriate command is received.**\n\n**Plug-ins will be regularly downloaded to infected machines: as soon as the malware writer updates**\n\n**their attack methods, the Black Energy 2 bot will download the latest version of the relevant plugin.**\n\n\n-----\n\n**Str.sys is encrypted, with the id parameter being used as the key. Prior to encryption, the str.sys data**\n\n**looks like this:**\n\n**Figure 8. Unencrypted contents of str.sys: plug-in storage**\n\n**Each plug-in has an exported function, DispatchCommand, which is called by the main module – the**\n\n**DLL injected into the svchost.exe process. A parameter (one of the commands from the section in the**\n\n**bot configuration file) is passed to the DispatchCommand function. The plug-in then executes the**\n\n**command.**\n\n**The main plug-ins for Black Energy 2 are ddos, syn and http. A brief description of each is given below.**\n\n**The server address, protocol and port to be used in an attack are the input for the ddos plug-in. The**\n\n**plug-in initiates mass connections to the server, using the port and protocol specified. Once a**\n\n**connection is established, a random data packet is sent to the server. The following protocols are**\n\n**supported: tcp, udp, icmp and http.**\n\n\n-----\n\n**Figure 9. Creating a socket, UDP protocol**\n\n**Figure 10-1. Sending data: sendto and the stack**\n\n**Figure 10-2. Sending data: sendto and the stack**\n\n\n-----\n\n**When the http protocol is specified in the command, the ddos plugin uses the socket, connect and send**\n\n**functions to send a GET request to the server.**\n\n**Unlike the other plug-ins described in this article, the syn plugin includes a network driver. When the**\n\n**plugin’s DllEntry function is called, the driver is installed to system32drivers folder as synsenddrv.sys.**\n\n**The driver sends all the network packets. As can be easily guessed, the DispatchCommand function**\n\n**waits for the main DLL to send it the following parameter: “syn_start ” or “syn_stop “. If the former**\n\n**parameter is received, the plugin begins an attack, if the latter is received, the attack is stopped. An**\n\n**attack in this case consists of numerous connection requests being made to the server, followed by so-**\n\n**called ‘handshakes’, i.e. the opening of network sessions.**\n\n**Figure 11. SYN attack: SYN->ACK->RST**\n\n**Naturally, if numerous requests are made from a large number of infected computers, this creates a**\n\n**noticeable load on the server.**\n\n**The DDoS attack methods described above are often combated by using redirects: a server with online**\n\n**resources is hidden behind a gateway that is visible to the outside world, with the gateway redirecting**\n\n**requests to the server hosting the resources. The gateway can use a variety of techniques to fend off**\n\n**DDoS attacks and taking it down is not easy. Since the ddos and syn plugins target IP addresses and**\n\n**have no features which allow them to recognize traffic redirects, they can only attack the gateway.**\n\n**Hence, the network flooding that they generate simply does not reach the server hosting Internet**\n\n**resources. This is where the http plugin comes in.**\n\n**Having received the http start command the http plugin creates a COM object named “Internet**\n\n\n-----\n\n**command with the parameter, resulting in the Internet Explorer(Ver 1.0) object navigating to the URL**\n\n**specified. The Busy method is then used by the malicious program which waits until the request is**\n\n**completed.**\n\n**Figure 12-1. Creating a COM object**\n\n**Figure 12-2. Pointer to CLSID**\n\n**Figure 12-3. Pointer to the interface ID**\n\n**Figure 13. Calling the Navigate method**\n\n\n-----\n\n**Figure 14. Calling the Busy method**\n\n**Using these steps, the malicious program imitates an ordinary user visiting a particular page. The only**\n\n**difference is that, unlike a user, the malicious program makes many ‘visits’ to the same address within a**\n\n**short period of time. Even if a redirecting gateway is used, the http request is redirected to the**\n\n**protected server hosting web resources, thus creating a significant load on the server.**\n\n**In addition to downloading plug-ins and executing plug-in commands, Black Energy 2 ‘understands’ a**\n\n**number of general commands that can be sent by the C&C server:**\n\n**rexec – download and execute a remote file;**\n\n**lexec – execute a local file on the infected computer;**\n\n**die – terminate bot execution;**\n\n**upd – update the bot;**\n\n**setfreq – set the frequency with which the bot will contact the C&C server;**\n\n**http – send http request to the specified web page.**\n\n**Initially, the Black Energy bot was created with the aim of conducting DDoS attacks, but with the**\n\n**implementation of plugins in the bot’s second version, the potential of this malware family has become**\n\n**virtually unlimited. (However, so far cybercriminals have mostly used it as a DDoS tool). Plugins can be**\n\n**installed, e.g. to send spam, grab user credentials, set up a proxy server etc. The upd command can be**\n\n**used to update the bot, e.g. with a version that has been encrypted using a different encryption method.**\n\n**Regular updates make it possible for the bot to evade a number of antivirus products, any of which**\n\n**might be installed on the infected computer, for a long time.**\n\n**This malicious tool has high potential, which naturally makes it quite a threat. Luckily, since there are no**\n\n\n-----\n\n**have shows that cybercriminals have already used Black Energy 2 to construct large botnets, and**\n\n**these have already been involved in successful DDoS attacks.**\n\n**It is difficult to predict how botnet masters will use their botnets in the future. It’s not hard for malware**\n\n**writers to create a plug-in and get it downloaded to infected user machines. Furthermore, any plug-in**\n\n**code is only present in an infected computer’s memory; in all other instances the malicious modules**\n\n**are encrypted, whether this is during transmission or when stored on a hard drive.**\n\n**In addition, Black Energy 2 plugins are not executable (.exe) files. Plugins are loaded directly onto an**\n\n**infected machine, which means that they will not be distributed using mass propagation techniques and**\n\n**antivirus vendors may not come across new plugins for extended periods of time. However, it is the**\n\n**plug-ins that ultimately meet the cybercriminals’ goal, i.e. delivering the malicious payload which is the**\n\n**ultimate aim of infecting victim machines with the Black Energy 2 bot.**\n\n**Consequently, it’s essential to track the plug-ins. Kaspersky Lab monitors which Black Energy 2 plugins**\n\n**are available for download to track the evolution of this malicious program. We’ll keep you posted.**\n\n**55** **41** **0** **0** **219** **51** **0** **2**\n\n**72** **231** **0** **1**\n\n**Your email address will not be published. Required fields are marked ***\n\n\n**55** **41** **0** **0**\n\n\n**219** **51** **0** **2**\n\n\n**Enter your comment here**\n\n\n**72** **231** **0** **1**\n\n\n**Name ***\n\n\n-----\n\n**Website**\n\n**I'm not a robot**\n\n**Notify me of follow-up comments by email.**\n\n**Notify me of new posts by email.**\n\n\n**I'm not a robot**\n\n**reCAPTCHA**\n\n\n-----\n\n**24** **31**\n\n\n**39** **41** **_0_**\n\n\n-----\n\n# Search\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2016/2016.01.28.BlackEnergy_APT/reference/black-ddos.pdf"
    ],
    "report_names": [
        "black-ddos"
    ],
    "threat_actors": [
        {
            "id": "1dadf04e-d725-426f-9f6c-08c5be7da159",
            "created_at": "2022-10-25T15:50:23.624538Z",
            "updated_at": "2025-03-27T02:00:55.508759Z",
            "deleted_at": null,
            "main_name": "Darkhotel",
            "aliases": [
                "Darkhotel",
                "DUBNIUM",
                "Zigzag Hail"
            ],
            "source_name": "MITRE:Darkhotel",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b13c19d6-247d-47ba-86ba-15a94accc179",
            "created_at": "2024-05-01T02:03:08.149923Z",
            "updated_at": "2025-03-27T02:05:17.422065Z",
            "deleted_at": null,
            "main_name": "TUNGSTEN BRIDGE",
            "aliases": [
                "DUBNIUM ",
                "DarkHotel ",
                "CTG-1948 "
            ],
            "source_name": "Secureworks:TUNGSTEN BRIDGE",
            "tools": [
                "Nemim"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2b4eec94-7672-4bee-acb2-b857d0d26d12",
            "created_at": "2023-01-06T13:46:38.272109Z",
            "updated_at": "2025-03-27T02:00:02.790029Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "DUBNIUM",
                "Fallout Team",
                "Luder",
                "Tapaoux",
                "Shadow Crane",
                "APT-C-06",
                "SIG25",
                "Karba",
                "Nemim",
                "Nemin",
                "G0012",
                "ATK52",
                "T-APT-02",
                "TUNGSTEN BRIDGE",
                "Zigzag Hail"
            ],
            "source_name": "MISPGALAXY:DarkHotel",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c0cedde3-5a9b-430f-9b77-e6568307205e",
            "created_at": "2022-10-25T16:07:23.528994Z",
            "updated_at": "2025-03-27T02:02:09.847683Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "APT-C-06",
                "ATK 52",
                "CTG-1948",
                "Dubnium",
                "Fallout Team",
                "Higaisa",
                "Luder",
                "Operation DarkHotel",
                "Operation Daybreak",
                "Operation Inexsmar",
                "Operation PowerFall",
                "Operation The Gh0st Remains the Same",
                "SIG25",
                "Shadow Crane",
                "T-APT-02",
                "Tungsten Bridge",
                "Zigzag Hail"
            ],
            "source_name": "ETDA:DarkHotel",
            "tools": [
                "Asruex",
                "DarkHotel",
                "DmaUp3.exe",
                "GreezeBackdoor",
                "Karba",
                "Nemain",
                "Nemim",
                "Ramsay",
                "Retro",
                "Tapaoux",
                "Trojan.Win32.Karba.e",
                "Virus.Win32.Pioneer.dx",
                "igfxext.exe",
                "msieckc.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716504,
    "ts_updated_at": 1743041156,
    "ts_creation_date": 1454062982,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/fdfff8084e578e20f5dd8528b04aa144e87b4719.pdf",
        "text": "https://archive.orkl.eu/fdfff8084e578e20f5dd8528b04aa144e87b4719.txt",
        "img": "https://archive.orkl.eu/fdfff8084e578e20f5dd8528b04aa144e87b4719.jpg"
    }
}