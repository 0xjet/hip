{
    "id": "7e27cecd-3307-4194-986e-92effb7df13e",
    "created_at": "2022-10-25T16:48:16.987045Z",
    "updated_at": "2025-03-27T02:17:11.621913Z",
    "deleted_at": null,
    "sha1_hash": "98985054ab8d3b6c232132f1957fefc4ba01c7a6",
    "title": "Visiting The Bear Den A Journey in the Land of (Cyber-)Espionage",
    "authors": "ESET",
    "file_creation_date": "2016-06-16T14:00:56Z",
    "file_modification_date": "2016-06-16T14:00:56Z",
    "file_size": 3445185,
    "plain_text": "## Visiting The Bear Den\n###### A Journey in the Land of (Cyber-)Espionage\n\n##### Joan Calvet Jessy Campos Thomas Dupuy\n\n\n-----\n\n## Sednit Group\n\n##### • Also know as APT28, Fancy Bear, Sofacy,\n STRONTIUM, Tsar Team\n • Group of attackers doing targeted attacks\n since 2006\n • Mainly interested into geopolitics\n\n\n-----\n\n## Plan\n\n##### • Context\n\n • The Week Serge Met The Bear\n\n • The Mysterious DOWNDELPH\n\n • Speculative Mumblings\n\n\n-----\n\n###### What kind of group is Sednit?\n\n### CONTEXT\n\n\n-----\n\n## Who Is The Bear After? (1)\n\n#### • We found a list of targets for Sednit\n phishing campaigns:\n\n##### – Operators used Bitly and “forgot” to set the\n profile private \n\n###### (feature now removed from Bitly)\n\n##### – Around 4,000 shortened URLs during 6\n months in 2015\n\n\n-----\n\n## Who Is The Bear After? (2)\n\n\n##### http://login.accoounts-google.com/url/?continue= cGFyZXBreWl2QGdtYWlsLmNvbQ==&df=UGFraXN0 YW4rRW1iYXNzeStLeWl2&tel=1\n\n\n-----\n\n## Who Is The Bear After? (2)\n\n###### parepkyiv@gmail.com\n\n\n-----\n\n## Who Is The Bear After? (2)\n\n###### parepkyiv@gmail.com\n\n##### http://login.accoounts-google.com/url/?continue= cGFyZXBreWl2QGdtYWlsLmNvbQ==&df=UGFraXN0 YW4rRW1iYXNzeStLeWl2&tel=1\n\n###### Pakistan+Embassy+Kyiv\n\n\n-----\n\n## Who Is The Bear After? (2)\n\n###### parepkyiv@gmail.com\n\n\n-----\n\n## Who Is The Bear After? (3)\n\n###### • Embassies and ministries of more than 40 countries\n\n • NATO and EU institutions\n\n • “Who’s who” of individuals involved in Eastern Europe\n politics:\n – Politicians – Activists – Journalists – Academics – Militaries – …\n\n\n-----\n\n## The Bear Has Money\n\n##### • A bag full of 0-day exploits:\n\n\n###### CVE-2015-3043 (Flash) CVE-2015-1701 (Windows LPE)\n\n\n###### CVE-2015-2590 (Java)  CVE-2015-4902 (Java click-to-play bypass)\n\n CVE-2015-7645 (Flash) \n\nAug Sep Oct\n\n###### CVE-2015-2424 (Office RCE)\n\n\nApr May Jun Jul Aug Sep Oct\n\n\n###### 2015\n\n\n-----\n\n## The Bear Can Code\n\n##### • Tens of custom-made software used since 2006:\n\n###### – Droppers – Downloaders – Reconnaissance tools – Long-term spying backdoors  – Encryption proxy tool – USB C&C channel – Many helper tools – …\n\n\n-----\n\n## Disclaimers\n\n###### • Over the last two years we tracked Sednit closely,\n but of course our visibility is not exhaustive\n • How do we know it is ONE group?\n – We don’t – Our Sednit “definition” is based on their toolkit and the\n related infrastructure\n • We do not do attribution (but we point out hints that may\n be used for that)\n\n\n-----\n\n### THE WEEK SERGE MET THE BEAR\n\n\n-----\n\n## Who Is Serge?\n\n###### • Code name for an imaginary Sednit target\n\n • Serge is a government employee with access to\n sensitive information\n • The chain of events in Serge’s attack matches\n several real cases we investigated\n • We use it as a textbook case to present (a part of)\n the Sednit toolkit\n\n\n-----\n\n# Monday, 9:30AM\n\n\n-----\n\n## Serge Opens an Email\n\n\n-----\n\n## Legitimate URL Mimicking\n\n\n-----\n\n## Legitimate URL Mimicking\n\n\n-----\n\n## Legitimate URL Mimicking\n\n\n-----\n\n## Legitimate URL Mimicking\n\n\n-----\n\n## Serge clicks on the URL, and…\n\n\n-----\n\n## …Serge Meets SEDKIT\n\n###### • Exploit-kit for targeted attacks\n\n • Entry-point URLs mimic legitimate URLs\n • Usually propagated by targeted phishing emails\n (also seen with hacked website + iframe)\n • Period of activity: September 2014 - Now\n\n\n-----\n\n###### Reconnaissance Report Building\n\n\n-----\n\n###### Reconnaissance Report Building\n\n\n-----\n\n###### Reconnaissance Report Building\n\n\n-----\n\n-----\n\n## Crawling Sedkit\n\n\n-----\n\n## Serge is selected to be exploited…\n\n\n-----\n\n### … and Visits Sednit Exploits Factory\n\n|Vulnerability|Targeted Application|Note|\n|---|---|---|\n|CVE-2013-1347|Internet Explorer 8||\n|CVE-2013-3897|Internet Explorer 8||\n|CVE-2014-1510 + CVE-2014-1511|Firefox||\n|CVE-2014-1776|Internet Explorer 11||\n|CVE-2014-6332|Internet Explorer|Several versions|\n|N/A|MacKeeper||\n|CVE-2015-2590 + CVE-2015-4902|Java|0-day*|\n|CVE-2015-3043|Adobe Flash|0-day*|\n|CVE-2015-5119|Adobe Flash|Hacking Team gift|\n|CVE-2015-7645|Adobe Flash|0-day*|\n\n\n-----\n\n### … and Visits Sednit Exploits Factory\n\n|Vulnerability|Targeted Application|Note|\n|---|---|---|\n|CVE-2013-1347|Internet Explorer 8||\n|CVE-2013-3897|Internet Explorer 8||\n|CVE-2014-1510 + CVE-2014-1511|Firefox||\n|CVE-2014-1776|Internet Explorer 11||\n|CVE-2014-6332|Internet Explorer|Several versions|\n|N/A|MacKeeper||\n|CVE-2015-2590 + CVE-2015-4902|Java|0-day*|\n|CVE-2015-3043|Adobe Flash|0-day*|\n|CVE-2015-5119|Adobe Flash|Hacking Team gift|\n|CVE-2015-7645|Adobe Flash|0-day*|\n\n\n-----\n\n### … and Visits Sednit Exploits Factory\n\n|Vulnerability|Targeted Application|Note|\n|---|---|---|\n|CVE-2013-1347|Internet Explorer 8||\n|CVE-2013-3897|Internet Explorer 8||\n|CVE-2014-1510 + CVE-2014-1511|Firefox||\n|CVE-2014-1776|Internet Explorer 11||\n|CVE-2014-6332|Internet Explorer|Several versions|\n|N/A|MacKeeper||\n|CVE-2015-2590 + CVE-2015-4902|Java|0-day*|\n|CVE-2015-3043|Adobe Flash|0-day*|\n|CVE-2015-5119|Adobe Flash|Hacking Team gift|\n|CVE-2015-7645|Adobe Flash|0-day*|\n\n\n-----\n\n### … and Visits Sednit Exploits Factory\n\n|Vulnerability|Targeted Application|Note|\n|---|---|---|\n|CVE-2013-1347|Internet Explorer 8||\n|CVE-2013-3897|Internet Explorer 8||\n|CVE-2014-1510 + CVE-2014-1511|Firefox||\n|CVE-2014-1776|Internet Explorer 11||\n|CVE-2014-6332|Internet Explorer|Several versions|\n|N/A|MacKeeper||\n|CVE-2015-2590 + CVE-2015-4902|Java|0-day*|\n|CVE-2015-3043|Adobe Flash|0-day*|\n|CVE-2015-5119|Adobe Flash|Hacking Team gift|\n|CVE-2015-7645|Adobe Flash|0-day*|\n\n\n-----\n\n### Revamping CVE-2014-6332 \n\n###### (a.k.a. IE “Unicorn bug”)\n\n##### • October 2015:\n\n###### – Re-use of public PoC to disable VBScript “SafeMode” – Next stage binary downloaded by PowerShell\n\n\n-----\n\n### Revamping CVE-2014-6332\n\n###### (a.k.a. IE “Unicorn bug”)\n\n##### • October 2015:\n\n###### – Re-use of public PoC to disable VBScript “SafeMode” – Next stage binary downloaded by PowerShell\n\n##### • February 2016:\n\n###### – No more “SafeMode” disabling, direct ROP-based\n shellcode execution – Around 400 lines of VBScript, mostly custom\n\n\n-----\n\n-----\n\n-----\n\n## VBScript Framework\n\n###### • Functions:\n – addToROP() – getROPstringAddress () – Code_section_explorer_7 () – Code_section_explorer_XP() – getNeddedAddresses () – addrToHex () – …\n\n\n-----\n\n## VBScript Framework\n\n###### • Functions:\n – addToROP() – getROPstringAddress () – Code_section_explorer_7 () – Code_section_explorer_XP() – getNeddedAddresses () – addrToHex () – …\n\n Have you ever seen this somewhere?\n (cuz we don’t)\n\n\n-----\n\n## Exploit downloads a payload and…\n\n\n-----\n\n### Serge Meets SEDUPLOADER\n\n###### (a.k.a. JHUHUGIT, JKEYSKW)\n\n##### • Downloaded by SEDKIT\n\n • Two binaries: the dropper and its embedded\n payload\n • Deployed as a first-stage component\n\n • Period of activity: March 2015 - Now\n\n\n-----\n\n### SEDUPLOADER DROPPER \n\n###### Workflow\n\n\n###### Payload Persistence\n\n\n###### Anti- Analysis\n\n\n###### Escalating\n Privileges\n\n\n###### Payload  Dropping\n\n\n-----\n\n### SEDUPLOADER DROPPER \n\n###### Workflow\n\n\n###### Anti- Analysis\n\n\n-----\n\n-----\n\n-----\n\n-----\n\n-----\n\n-----\n\n-----\n\n### SEDUPLOADER DROPPER \n\n###### Workflow\n\n\n###### Payload  Dropping\n\n\n-----\n\n### SEDUPLOADER DROPPER \n\n###### Workflow\n\n Anti- Payload  Escalating Payload Analysis Dropping Privileges Persistence\n\n##### • CVE-2015-1701 (0-day)\n • CVE-2015-2387 (     )\n\n\n###### Escalating\n Privileges\n\n\n-----\n\n### SEDUPLOADER DROPPER \n\n###### Workflow\n\n Anti- Payload  Escalating Payload Analysis Dropping Privileges Persistence\n\n • Windows COM object hijacking\n • Shell Icon Overlay COM object\n • Registry key UserInitMprLogonScript\n • JavaScript code executed within rundll32.exe\n • Scheduled tasks, Windows service,…\n\n\n###### Payload Persistence\n\n\n-----\n\n### SEDUPLOADER DROPPER \n\n###### Workflow\n\n Anti- Payload  Escalating Payload Analysis Dropping Privileges Persistence\n\n • Windows COM object hijacking\n • Shell Icon Overlay COM object\n • Registry key UserInitMprLogonScript\n • JavaScript code executed within rundll32.exe\n • Scheduled tasks, Windows service,…\n\n\n###### Payload Persistence\n\n\n-----\n\n### SEDUPLOADER DROPPER \n\n###### Workflow\n\n Anti- Payload  Escalating Payload Analysis Dropping Privileges Persistence\n\n • Windows COM object hijacking  Win32/COMpfun\n • Shell Icon Overlay COM object\n • Registry key UserInitMprLogonScript\n • JavaScript code executed within rundll32.exe Win32/Poweliks\n • Scheduled tasks, Windows service,…\n\n\n###### Payload Persistence\n\n\n-----\n\n### SEDUPLOADER PAYLOAD\n\n###### Workflow\n\n\n###### Network Link Establishment\n\n\n###### Parsing C&C\n Orders\n\n\n###### Parsing C&C\n Orders\n\n\n-----\n\n### SEDUPLOADER PAYLOAD\n\n###### Workflow\n\n\n###### Network Link Establishment\n\n\n-----\n\n### SEDUPLOADER PAYLOAD\n\n###### Workflow\n\n\n###### Direct Connection\n\n\n###### Network Link Establishment\n\n\n-----\n\n### SEDUPLOADER PAYLOAD\n\n###### Workflow\n\n\n###### Direct Connection\n\n\n###### Network Link Establishment\n\n\n-----\n\n### SEDUPLOADER PAYLOAD\n\n###### Workflow\n\n\n###### Direct Connection\n\n\n###### Network Link Establishment\n\n\n###### C&C Successfully\n\n\n-----\n\n### SEDUPLOADER PAYLOAD\n\n###### Workflow\n\n\n###### Direct Connection\n\n\n###### Network Link Establishment\n\n\n###### C&C Successfully\n\n\n-----\n\n### SEDUPLOADER PAYLOAD\n\n###### Workflow\n\n\n###### Direct Connection\n\n\n###### Via Proxy\n\n\n###### Network Link Establishment\n\n\n-----\n\n### SEDUPLOADER PAYLOAD\n\n###### Workflow\n\n\n###### Direct Connection\n\n\n###### Via Proxy\n\n\n###### Network Link Establishment\n\n\n-----\n\n### SEDUPLOADER PAYLOAD\n\n###### Workflow\n\n\n###### First Stage\n Report\n\n\n-----\n\n### SEDUPLOADER PAYLOAD\n\n###### Workflow\n\n\n###### Parsing C&C\n Orders\n\n\n-----\n\n### East Side Story\n\n###### printf debugging\n\n\n-----\n\n## Chain of Events\n\n###### Serge opens an email leading to SEDKIT, and then SEDUPLOADER\n 9:30AM\n\n\n###### Mon Tue Wed Thu Fri\n\n\n-----\n\n# Monday, 10:00AM\n\n\n-----\n\n## …Serge meets SEDRECO\n\n##### • Downloaded by SEDUPLOADER\n\n • Backdoor with the ability to load external\n plugins\n • Usually deployed as a second stage backdoor\n to spy on the infected computer\n • Period of activity : 2012 - Now\n\n\n-----\n\n## Dropper\n\n##### • Drops encrypted configuration\n\n###### – In a file (“msd”) – In the Windows Registry\n\n##### • No configuration linked to the payload\n\n\n-----\n\n## Configuration Overview\n\n\n-----\n\n## Configuration Overview\n\n\n###### XOR KEY\n\n\n-----\n\n## Configuration Overview\n\n###### XOR KEY FIELD SIZES\n\n\n-----\n\n### Configuration Overview (Decrypted)\n\n\n-----\n\n### Configuration Overview (Decrypted)\n```\n('600000', '600000', ‘SERGE-PC…', 'kenlynton.com',\n'softwaresupportsv.com', 'mtcf', '10000', '600000', '1',\n 'updmanager.com', '', '', '', '', '', '', '', '', '', '')\n\n```\n\n-----\n\n### Configuration Overview (Decrypted)\n\n###### Various timeouts\n```\n('600000', '600000', ‘SERGE-PC…', 'kenlynton.com',\n'softwaresupportsv.com', 'mtcf', '10000', '600000', '1',\n 'updmanager.com', '', '', '', '', '', '', '', '', '', '')\n\n```\n\n-----\n\n### Configuration Overview (Decrypted)\n\n###### Computer name\n```\n('600000', '600000', ‘SERGE-PC…', 'kenlynton.com',\n'softwaresupportsv.com', 'mtcf', '10000', '600000', '1',\n 'updmanager.com', '', '', '', '', '', '', '', '', '', '')\n\n```\n\n-----\n\n### Configuration Overview (Decrypted)\n\n###### Keylogger enabled\n```\n('600000', '600000', ‘SERGE-PC…', 'kenlynton.com',\n'softwaresupportsv.com', 'mtcf', '10000', '600000', '1',\n 'updmanager.com', '', '', '', '', '', '', '', '', '', '')\n\n```\n\n-----\n\n### Configuration Overview (Decrypted)\n```\n('600000', '600000', ‘SERGE-PC…', 'kenlynton.com',\n'softwaresupportsv.com', 'mtcf', '10000', '600000', '1',\n 'updmanager.com', '', '', '', '', '', '', '', '', '', '')\n\n###### C&C servers\n\n```\n|softwaresupportsv.com'|Col2|Col3|\n|---|---|---|\n||'updmanager.com'|, '',|\n\n\n-----\n\n### Configuration Overview (Decrypted)\n```\n('600000', '600000', ‘SERGE-PC…', 'kenlynton.com',\n'softwaresupportsv.com', 'mtcf', '10000', '600000', '1',\n 'updmanager.com', '', '', '', '', '', '', '', '', '', '')\n\n###### Operation name\n\n```\n\n-----\n\n### Configuration Overview (Decrypted)\n```\n('600000', '600000', ‘SERGE-PC…', 'kenlynton.com',\n'softwaresupportsv.com', 'mtcf', '10000', '600000', '1',\n 'updmanager.com', '', '', '', '', '', '', '', '', '', '')\n\n```\n\n-----\n\n## Payload\n\n\n-----\n\n## Payload\n\n\n-----\n\n## Payload\n\n\n-----\n\n## Payload\n\n\n-----\n\n## Payload\n\n\n-----\n\n## Payload\n\n\n-----\n\n## Payload\n\n\n-----\n\n## Payload\n\n\n-----\n\n## Payload\n\n\n-----\n\n## Extending The Core (1)\n\n##### • Plugins are DLLs loaded in the same address\n space\n • Plugins receive arguments from the core:\n\n\n-----\n\n## Extending The Core (1)\n\n##### • Plugins are DLLs loaded in the same address\n space\n • Plugins receive arguments from the core:\n\n\n-----\n\n## Extending The Core (1)\n\n##### • Plugins are DLLs loaded in the same address\n space\n • Plugins receive arguments from the core:\n\n\n-----\n\n## Extending The Core (2)\n\n\n-----\n\n## Extending The Core (2)\n\n\n###### New command\n\n\n-----\n\n## Chain of Events\n\n###### Serge opens an email leading to SEDKIT, and then SEDUPLOADER\n 9:30AM\n\n Tue Wed Thu\n\n SEDRECO deployment 10:00AM\n\n\n###### Mon Tue Wed Thu Fri\n\n\n-----\n\n# Monday, 2:00PM\n\n\n-----\n\n### Serge Meets XAGENT\n\n###### (a.k.a SPLM, CHOPSTICK)\n\n • Downloaded by SEDUPLOADER\n\n • Modular backdoor developed in C++ with Windows,\n Linux and iOS versions\n • Deployed in most Sednit operations, usually after the\n reconnaissance phase\n • Period of activity: November 2012 - Now\n\n\n-----\n\n-----\n\n-----\n\n###### • Linux XAGENT, compiled in July 2015\n\n\n-----\n\n###### • Linux XAGENT, compiled in July 2015\n\n • ~ 18,000 lines of code in 59 classes\n\n\n-----\n\n###### • Linux XAGENT, compiled in July 2015\n\n • ~ 18,000 lines of code in 59 classes\n\n • Derives from Windows version:\n\n\n-----\n\n###### • Linux XAGENT, compiled in July 2015\n\n • ~ 18,000 lines of code in 59 classes\n\n • Derives from Windows version:\n\n • XAGENT major version 2, but matches the\n logic of currently distributed binaries (version 3)\n\n\n-----\n\n## Such Comments\n\n\n###### <- That’s a lot\n\n\n-----\n\n-----\n\n-----\n\n-----\n\n-----\n\n-----\n\n-----\n\n## Communication Workflow\n\n###### XAGENT INFECTED COMPUTER\n\n\n###### C&C SERVER\n\n```\n AgentKernel::run()\n\n###### Translates messages\n from modules for\n the C&C server\n\n Translates messages\n from the C&C server for modules\n\n```\n\n###### Channel Controller\n\n\n###### AgentKernel\n\n\n###### AgentKernel\n\n\n###### FSModule\n\n\n###### Keylogger\n\n\n###### Unencrypted messages Encrypted messages\n\n\n###### Channel Controller\n\n\n###### RemoteShell\n\n\n###### FSModule\n\n\n-----\n\n## Communication Workflow\n\n###### XAGENT INFECTED COMPUTER\n\n\n###### C&C SERVER\n\n```\n AgentKernel::run()\n\n###### Translates messages\n from modules for\n the C&C server\n\n Translates messages\n from the C&C server for modules\n\n```\n\n###### Channel Controller\n\n\n###### AgentKernel\n\n\n###### AgentKernel\n\n\n###### FSModule\n\n\n###### Keylogger\n\n\n###### Unencrypted messages Encrypted messages\n\n\n###### Channel Controller\n\n\n###### RemoteShell\n\n\n###### FSModule\n\n\n-----\n\n## Communication Workflow\n\n###### XAGENT INFECTED COMPUTER\n\n\n###### C&C SERVER\n\n```\n AgentKernel::run()\n\n###### Translates messages\n from modules for\n the C&C server\n\n Translates messages\n from the C&C server for modules\n\n```\n\n###### Channel Controller\n\n\n###### AgentKernel\n\n\n###### AgentKernel\n\n\n###### FSModule\n\n\n###### Keylogger\n\n\n###### Unencrypted messages Encrypted messages\n\n\n###### Channel Controller\n\n\n###### RemoteShell\n\n\n###### FSModule\n\n\n-----\n\n## Communication Workflow\n\n###### XAGENT INFECTED COMPUTER\n\n\n###### C&C SERVER\n\n```\n AgentKernel::run()\n\n###### Translates messages\n from modules for\n the C&C server\n\n Translates messages\n from the C&C server for modules\n\n```\n\n###### Channel Controller\n\n\n###### AgentKernel\n\n\n###### AgentKernel\n\n\n###### FSModule\n\n\n###### Keylogger\n\n\n###### Unencrypted messages Encrypted messages\n\n\n###### Channel Controller\n\n\n###### RemoteShell\n\n\n###### FSModule\n\n\n-----\n\n## Communication Workflow\n\n###### XAGENT INFECTED COMPUTER\n\n\n###### C&C SERVER\n\n```\n AgentKernel::run()\n\n###### Translates messages\n from modules for\n the C&C server\n\n Translates messages\n from the C&C server for modules\n\n```\n\n###### Channel Controller\n\n\n###### AgentKernel\n\n\n###### AgentKernel\n\n\n###### FSModule\n\n\n###### Keylogger\n\n\n###### Unencrypted messages Encrypted messages\n\n\n###### Channel Controller\n\n\n###### RemoteShell\n\n\n###### FSModule\n\n\n-----\n\n## Communication Workflow\n\n###### XAGENT INFECTED COMPUTER\n\n\n###### C&C SERVER\n\n```\n AgentKernel::run()\n\n###### Translates messages\n from modules for\n the C&C server\n\n Translates messages\n from the C&C server for modules\n\n```\n\n###### Channel Controller\n\n\n###### AgentKernel\n\n\n###### AgentKernel\n\n\n###### FSModule\n\n\n###### Keylogger\n\n\n###### Unencrypted messages Encrypted messages\n\n\n###### Channel Controller\n\n\n###### RemoteShell\n\n\n###### FSModule\n\n\n-----\n\n## Communication Workflow\n\n###### XAGENT INFECTED COMPUTER\n\n\n###### C&C SERVER\n\n```\n AgentKernel::run()\n\n###### Translates messages\n from modules for\n the C&C server\n\n Translates messages\n from the C&C server for modules\n\n```\n\n###### Channel Controller\n\n\n###### AgentKernel\n\n\n###### AgentKernel\n\n\n###### FSModule\n\n\n###### Keylogger\n\n\n###### Unencrypted messages Encrypted messages\n\n\n###### Channel Controller\n\n\n###### RemoteShell\n\n\n###### FSModule\n\n\n-----\n\n## Communication Workflow\n\n###### XAGENT INFECTED COMPUTER\n\n\n###### C&C SERVER\n\n```\n AgentKernel::run()\n\n###### Translates messages\n from modules for\n the C&C server\n\n Translates messages\n from the C&C server for modules\n\n```\n\n###### Channel Controller\n\n\n###### AgentKernel\n\n\n###### AgentKernel\n\n\n###### FSModule\n\n\n###### Keylogger\n\n\n###### Unencrypted messages Encrypted messages\n\n\n###### Channel Controller\n\n\n###### RemoteShell\n\n\n###### FSModule\n\n\n###### Channel (HTTP or emails)\n\n\n###### RemoteShell\n\n\n-----\n\n### Emails Channel (1)\n\n###### Workflow\n\n exfil@gmail.com\n\n orders@gmail.com XAGENT INFECTED\n COMPUTER USING MailChannel\n\n\n###### C&C SERVER\n\n\n-----\n\n### Emails Channel (1)\n\n###### Workflow\n\n exfil@gmail.com\n\n SMTPS\n\n orders@gmail.com XAGENT INFECTED\n COMPUTER USING MailChannel\n\n\n###### C&C SERVER\n\n\n-----\n\n### Emails Channel (1)\n\n###### Workflow\n\n exfil@gmail.com\n\n SMTPS POP3S\n\n orders@gmail.com XAGENT INFECTED\n COMPUTER USING MailChannel\n\n\n###### C&C SERVER\n\n\n-----\n\n### Emails Channel (1)\n\n###### Workflow\n\n exfil@gmail.com\n\n SMTPS POP3S\n\n SMTPS\n\n orders@gmail.com XAGENT INFECTED\n COMPUTER USING MailChannel\n\n\n###### C&C SERVER\n\n\n-----\n\n### Emails Channel (1)\n\n###### Workflow\n\n exfil@gmail.com\n\n\n###### SMTPS\n\n POP3S\n orders@gmail.com XAGENT INFECTED\n COMPUTER USING MailChannel\n\n\n###### POP3S\n\n SMTPS\n\n\n###### C&C SERVER\n\n\n-----\n\n### Emails Channel (1)\n\n###### Workflow\n\n exfil@gmail.com\n\n\n###### SMTPS\n\n POP3S\n orders@gmail.com XAGENT INFECTED\n COMPUTER USING MailChannel\n\n\n###### POP3S\n\n SMTPS\n\n\n###### C&C SERVER\n\n\n###### An email-based C&C protocol needs to provide: 1. A way to distinguish C&C emails from unrelated emails 2 A way to bypass spam filters\n\n\n-----\n\n### Email Channel (2)\n###### P2Scheme, a.k.a “Level 2 Protocol”\n\n\n-----\n\n### Email Channel (2)\n###### P2Scheme, a.k.a “Level 2 Protocol”\n\n base64\n\n KEY SUBJ_TOKEN ^ KEY XAGENT_ID ^ KEY\n```\n   0 5 12 16\n\n```\n|KEY|SUBJ_TOKEN ^ KEY|XAGENT_ID ^ KEY|\n|---|---|---|\n\n\n###### base64\n\n\n-----\n\n### Email Channel (2)\n###### P2Scheme, a.k.a “Level 2 Protocol”\n\n base64\n\n KEY SUBJ_TOKEN ^ KEY XAGENT_ID ^ KEY\n```\n   0 5 12 16\n\n```\n|KEY|SUBJ_TOKEN ^ KEY|XAGENT_ID ^ KEY|\n|---|---|---|\n\n\n###### base64\n\n\n-----\n\n### Email Channel (3)\n\n###### Georgian Protocol\n\n\n-----\n\n### Email Channel (3)\n\n###### Georgian Protocol\n\n\n###### Georgian national ID number \n\n\n-----\n\n### Email Channel (3)\n\n###### Georgian Protocol\n\n\n###### Georgian national ID number \n\n “Hello”\n\n\n-----\n\n### Email Channel (3)\n\n###### Georgian Protocol\n\n Georgian national ID number \n\n “Hello”\n\n “detailed” + timestamp\n\n\n###### Georgian national ID number \n\n “Hello”\n\n\n-----\n\n## Bonus: XAGENT C&C Infrastructure\n\n\n-----\n\n## Bonus: XAGENT C&C Infrastructure\n\n###### Thank you, Google search engine\n\n\n-----\n\n## XAGENT Proxy Server\n\n###### • Python code used between April and June\n 2015\n\n\n-----\n\n## XAGENT Proxy Server\n\n###### • Python code used between April and June\n 2015\n • ~ 12,200 lines of code\n\n\n-----\n\n## XAGENT Proxy Server\n\n###### • Python code used between April and June\n 2015\n • ~ 12,200 lines of code\n\n • Translates email protocol from XAGENT\n into a HTTP protocol for the C&C server:\n\n P2Protocol\n\n P3Protocol\n\n\n###### INBOX\n\n\n###### (over HTTP)\n\n\n###### XAGENT PROXY BACKEND\n\n\n-----\n\n## Chain of Events\n\n###### XAGENT deployment 02:00PM\n\n Serge opens an email leading to SEDKIT, and then SEDUPLOADER\n 9:30AM\n\n Tue Wed Thu\n\n SEDRECO deployment 10:00AM\n\n\n###### Mon Tue Wed Thu Fri\n\n\n-----\n\n# Next three days…\n\n\n-----\n\n### Serge Meets  Passwords Extractors\n\n##### • SecurityXploded tools (grand classic of Sednit)\n\n###### – Cons: usually detected by AV software\n\n##### • Custom tools, in particular a Windows Live\n Mail passwords extractor compiled for Serge:\n\n\n-----\n\n### Serge Meets  Windows Passwords Extractors\n\n##### • From registry hives\n\n###### – Deployed with LPE for CVE-2014-4076\n\n##### • Good ol’ Mimikatz (“pi.log”)\n\n###### – Deployed with LPE for CVE-2015-1701\n\n\n-----\n\n## Serge Meets Screenshoter\n\n##### • Custom tool to take screenshots each time the\n mouse moves\n\n\n-----\n\n## And… Serge Meets XTUNNEL\n\n##### • Network proxy tool to contact machines\n normally unreachable from Internet\n • Period of activity: May 2013 - Now\n\n\n-----\n\n##### Initial Situation\n\n\n###### INTERNET\n\n INTERNAL NETWORK\n\n\n###### C&C SERVER\n\n SERGE’S COMPUTER\n\n\n###### (XTUNNEL COMPUTER A INFECTED)\n (CLEAN)\n\n\n###### COMPUTER B\n\n\n-----\n\n##### Encryption Handshake\n\n\n###### INTERNET\n\n INTERNAL NETWORK\n\n COMPUTER A\n (CLEAN)\n\n\n###### C&C SERVER\n\n SERGE’S COMPUTER\n (XTUNNEL INFECTED)\n\n\n###### COMPUTER B\n\n\n-----\n\n##### Encryption Handshake\n\n```\n80 BE 7B 25.8E E6 FC F2\nCD 5D 7F 3A.73 1D 59 A5\n2D 35 77 F3.B2 1B DF 7D\nEE 1D 1C F1.AB 91 87 87\n…\n\n```\n\n###### INTERNET\n\n INTERNAL NETWORK\n\n COMPUTER A\n (CLEAN)\n\n\n###### C&C SERVER\n\n SERGE’S COMPUTER\n (XTUNNEL INFECTED)\n\n```\nD5 47 A4 A4.3F 60 6A 0F\n3B 36 04 1C.44 4A C8 BD\n80 BE 7B 25.8E E6 FC F2\nCD 5D 7F 3A.73 1D 59 A5\n2D 35 77 F3.B2 1B DF 7D\nEE 1D 1C F1.AB 91 87 87\n…\n\n```\n\n#### T\n\n T\n\n\n###### COMPUTER B\n\n\n-----\n\n##### Encryption Handshake\n\n\n#### T\n\n```\n80 BE 7B 25.8E E6 FC F2\nCD 5D 7F 3A.73 1D 59 A5\n2D 35 77 F3.B2 1B DF 7D\nEE 1D 1C F1.AB 91 87 87\n…\n\n```\n```\nCD 5D 7F 3A.73 1D 59 A5\n2D 35 77 F3.B2 1B DF 7D\n\n#### T\nEE 1D 1C F1.AB 91 87 87\n###### RC4 key\n\n COMPUTER B\n\n```\n\n###### INTERNET\n\n INTERNAL NETWORK\n\n COMPUTER A\n (CLEAN)\n\n\n###### C&C SERVER\n\n SERGE’S COMPUTER\n (XTUNNEL INFECTED)\n\n\n###### O\n\n\n-----\n\n##### Encryption Handshake\n\n\n###### C&C SERVER\n\n```\n80 BE 7B 25.8E E6 FC F2\nCD 5D 7F 3A.73 1D 59 A5\n2D 35 77 F3.B2 1B DF 7D\nEE 1D 1C F1.AB 91 87 87\n…\n\n```\n\n#### T\n\n T\n\n\n###### INTERNET\n\n INTERNAL NETWORK\n\n COMPUTER A\n (CLEAN)\n\n\n\n######  Offset O in T\n  Proof of knowledge of T\n\n O D5 47 A4 A4.3F 60 6A 0F\n```\n            3B 36 04 1C.44 4A C8 BD\n            80 BE 7B 25.8E E6 FC F2\n            CD 5D 7F 3A.73 1D 59 A5\n            2D 35 77 F3.B2 1B DF 7D\n            EE 1D 1C F1.AB 91 87 87\n\n … RC4 key\n\n SERGE’S COMPUTER\n (XTUNNEL INFECTED)\n\n COMPUTER B\n\n```\n\n-----\n\n##### Encryption Handshake\n\n\n#### T\n\n T\n\n```\n80 BE 7B 25.8E E6 FC F2\nCD 5D 7F 3A.73 1D 59 A5\n2D 35 77 F3.B2 1B DF 7D\nEE 1D 1C F1.AB 91 87 87\n\n###### … RC4 Key\n\n```\n\n###### RC4 key\n\n COMPUTER B\n\n\n###### INTERNET\n\n INTERNAL NETWORK\n\n COMPUTER A\n (CLEAN)\n\n\n###### C&C SERVER\n\n “OK”\n\n O\n\n SERGE’S COMPUTER\n (XTUNNEL INFECTED)\n\n\n-----\n\n##### Encryption Handshake\n\n\n###### RC4-encrypted link\n\n COMPUTER B\n\n\n###### INTERNET\n\n INTERNAL NETWORK\n\n COMPUTER A\n (CLEAN)\n\n\n###### C&C SERVER\n\n SERGE’S COMPUTER\n (XTUNNEL INFECTED)\n\n\n-----\n\n##### Encryption Handshake\n\n\n###### TLS encapsulation\n (added in 2014)\n\n COMPUTER B\n\n\n###### INTERNET\n\n INTERNAL NETWORK\n\n COMPUTER A\n (CLEAN)\n\n\n###### C&C SERVER\n\n SERGE’S COMPUTER\n (XTUNNEL INFECTED)\n\n\n-----\n\n##### Tunnels Opening\n\n\n###### INTERNET\n\n INTERNAL NETWORK\n\n COMPUTER A\n (CLEAN)\n\n\n###### C&C SERVER\n\n SERGE’S COMPUTER\n (XTUNNEL INFECTED)\n\n\n###### COMPUTER B\n\n\n-----\n\n##### Tunnels Opening\n\n\n###### INTERNET\n\n INTERNAL NETWORK\n\n COMPUTER A\n (CLEAN)\n\n\n###### C&C SERVER\n\n SERGE’S COMPUTER\n (XTUNNEL INFECTED)\n\n\n###### COMPUTER B\n\n\n-----\n\n##### Tunnels Opening\n\n\n###### Any kind of TCP-based  traffic can be tunneled!\n (PsExec)\n\n COMPUTER B\n\n\n###### INTERNET\n\n INTERNAL NETWORK\n\n COMPUTER A\n (CLEAN)\n\n\n###### C&C SERVER\n\n SERGE’S COMPUTER\n (XTUNNEL INFECTED)\n\n\n-----\n\n##### Tunnels Opening\n\n\n###### C&C SERVER\n\n\n###### INTERNET\n\n INTERNAL NETWORK\n\n COMPUTER A\n (CLEAN)\n\n\n###### Any kind of TCP-based  traffic can be tunneled!\n (PsExec)\n\n COMPUTER B\n\n\n-----\n\n## Code Obfuscation (1)\n\n##### • Starting in July 2015 XTUNNEL code was\n obfuscated\n###### (which is two months after the Sednit attack against the German parliament, where XTUNNEL was used)\n\n\n-----\n\n## Code Obfuscation (1)\n\n##### • Starting in July 2015 XTUNNEL code was\n obfuscated\n###### (which is two months after the Sednit attack against the German parliament, where XTUNNEL was used)\n\n##### • The obfuscation is a mix of classic syntactic\n techniques, like insertion of junk code and opaque predicates\n\n\n-----\n\n## Code Obfuscation (2)\n\n###### BEFORE AFTER\n\n\n-----\n\n## Code Obfuscation (2)\n\n###### BEFORE AFTER\n\n Good toy example for automatic\n desobfuscation magic?\n\n\n-----\n\n## Chain of Events\n\n###### XAGENT deployment 02:00PM\n\n Serge opens an email leading to SEDKIT, and then SEDUPLOADER\n 9:30AM\n\n\n###### Mon Tue Wed Thu Fri\n\n\n###### SEDRECO deployment 10:00AM\n\n\n###### Information exfiltration and lateral movements\n\n\n-----\n\n# Friday, 11:00AM\n\n\n-----\n\n## Long Term Persistence (1)\n\n##### • Special XAGENT copied in Office folder under\n the name “msi.dll”\n\n\n-----\n\n## Long Term Persistence (2)\n\n##### • system32\\msi.dll is a legitimate Windows\n DLL needed by Office applications \n\n\n-----\n\n## Long Term Persistence (2)\n\n##### • system32\\msi.dll is a legitimate Windows\n DLL needed by Office applications \n • XAGENT msi.dll exports the same function\n names as the legitimate msi.dll:\n\n\n-----\n\n## Long Term Persistence (3)\n\n##### • Each time Serge starts Office, XAGENT\n```\n msi.dll is loaded (search-order hijacking):\n\n###### – Loads real msi.dll from system32 – Fills its export table with the addresses of the real\n  msi.dll functions\n\n – Starts XAGENT malicious logic\n\n```\n\n-----\n\n## Long Term Persistence (3)\n\n##### • Each time Serge starts Office, XAGENT\n```\n msi.dll is loaded (search-order hijacking):\n\n###### – Loads real msi.dll from system32 – Fills its export table with the addresses of the real\n  msi.dll functions\n\n – Starts XAGENT malicious logic\n\n##### • Same technique also seen with\n LINKINFO.dll dropped in C:\\WINDOWS\n\n```\n\n-----\n\n## Chain of Events\n\n###### XAGENT deployment 02:00PM\n\n Serge opens an email leading to SEDKIT, and then SEDUPLOADER\n 9:30AM\n\n\n###### Long-term persistence method deployment\n 11:00AM\n\n\n###### Mon Tue Wed Thu Fri\n\n\n###### SEDRECO deployment 10:00AM\n\n\n###### Information exfiltration and lateral movements\n\n\n-----\n\n###### What the hell is going on here ?!\n\n### THE MYSTERIOUS DOWNDELPH\n\n\n-----\n\n### Discovery\n###### September 2015\n\n##### • Classic Sednit dropper\n • Shows a decoy document\n\n\n-----\n\n## What Is In This Dropper?\n\n\n-----\n\n### The Ultimate Boring Component\n\n##### • Delphi downloader, we named it DOWNDELPH\n (slow clap)\n • Simple workflow:\n\n###### – Downloads a config (.INI file) – Based on the config, downloads a payload – Executes payload\n\n##### • Persistence method: Run registry key\n\n\n-----\n\n### The Ultimate Boring Component\n\n##### • Delphi downloader, we named it DOWNDELPH\n (slow clap)\n • Simple workflow:\n\n###### – Downloads a config (.INI file) – Based on the config, downloads a payload – Executes payload\n\n##### • Persistence method: Run registry key\n\n\n-----\n\n### Let The Hunt Begins\n##### 2013 DOWNDELPH Sample\n\n\n###### Dropper\n\n\n###### DOWNDELPH\n\n\n-----\n\n### Let The Hunt Begins\n##### 2013 DOWNDELPH Sample\n\n|He|lper|\n|---|---|\n\n\n###### Dropper\n\n\n###### DOWNDELPH\n\n\n\n###### • Infects BIOS-based systems\n • Tested on Windows XP/7, 32bit/64bit\n\n\n###### Bootkit Installer\n\n\n-----\n\n## Not So Boring Component\n\n\n-----\n\n## Bootkit Installation\n\n```\n1[ST] sector\n\n```\n|MBR|Legitimate data|\n|---|---|\n\n\n-----\n\n## Bootkit Installation\n```\n1[ST] sector 2[ND] sector\n\n```\n|Malicious MBR|Original MBR (1-byte XOR)|Hooks (1-byte XOR)|Driver (1-byte XOR + RC4)|Legitimate Data|\n|---|---|---|---|---|\n\n\n###### Malicious Original MBR Hooks Driver\n MBR (1-byte XOR) (1-byte XOR) (1-byte XOR + RC4) [Legitimate Data ]\n\n\n-----\n\n### Normal Boot Process\n\n###### Windows 7 x64\n\n|BOO|TMGR|\n|---|---|\n\n\n###### Original MBR BOOTMGR Winload.exe\n\n Real Mode\n\n … Kernel Init\n\n Protected Mode\n\n\n-----\n\n### Infected Boot Process\n\n###### Windows 7 x64\n\n|BOO|TMGR|\n|---|---|\n\n\n###### Infected MBR BOOTMGR Winload.exe\n\n Original MBR\n\n Real Mode\n\n … Kernel Init\n\n Protected Mode\n\n\n-----\n\n### Infected Boot Process\n\n###### Windows 7 x64\n\n|BOO|TMGR|\n|---|---|\n\n\n###### Infected MBR BOOTMGR Winload.exe\n\n Original MBR\n\n Real Mode\n\n … Kernel Init\n\n Protected Mode\n\n\n-----\n\n## Malicious MBR\n\n###### • Hooks INT 13h handler (low-level read/write\n operations) \n\n\n-----\n\n## Malicious MBR\n\n###### • Hooks INT 13h handler (low-level read/write\n operations) \n • Patches BOOTMGR in memory\n\n\n-----\n\n## Bootkit Workflow\n\n|BOO|TMGR|\n|---|---|\n\n\n###### Infected MBR BOOTMGR Winload.exe\n\n Original MBR\n\n Real Mode\n\n … Kernel Init\n\n Protected Mode\n\n\n-----\n\n## Bootkit Workflow\n\n|BOO|TMGR|\n|---|---|\n|Hook||\n\n|BOO Hook|TMGR|\n|---|---|\n\n\n###### Infected MBR BOOTMGR Winload.exe\n Hook\n\n Original MBR\n\n Real Mode\n\n … Kernel Init\n\n Protected Mode\n\n\n-----\n\n## BOOTMGR Hook\n\n##### • Searches OslArchTransferToKernel() in\n winload.exe to patch it\n\n###### Before:\n\n After:\n\n\n-----\n\n## Bootkit Workflow\n\n|BOO|TMGR|\n|---|---|\n|Hook||\n\n\n###### Infected MBR BOOTMGR Winload.exe\n Hook\n\n Original MBR\n\n Real Mode\n\n … Kernel Init\n\n Protected Mode\n\n\n-----\n\n## Bootkit Workflow\n\n|BOO|TMGR|\n|---|---|\n|Hook||\n\n\n###### Infected MBR BOOTMGR Winload.exe\n Hook Hook\n\n Original MBR\n\n Real Mode\n\n … Kernel Init\n\n Protected Mode\n\n\n-----\n\n## Winload.exe Hook\n\n##### • Locates MmMapIoSpace\n\n • Saves some code in ACPI.sys resources section  (and makes the section executable)\n • Hooks ACPI!GsDriverEntry \n\n\n-----\n\n## Saving Important Information\n\n###### Bootkit physical address\n```\n0: kd> db rbx $$ kernel header address\n 4d 5a 90 00 03 00 00 00-04 00 00 00 ff ff 00 00 MZ..............\n b8 00 00 00 00 00 00 00-40 00 00 00 00 00 00 00 ........@.......\n 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00 ................\n 00 00 00 00 00 00 00 00-00 00 00 00 f8 00 00 00 ................\n 00 74 09 00 00 b4 09 cd-21 b8 01 4c cd 21 54 68 .t......!..L.!Th\n 69 73 20 70 72 6f 67 72-61 6d 20 63 61 6e 6e 6f is program canno\n 74 20 62 65 20 72 75 6e-20 69 6e 20 44 4f 53 20 t be run in DOS \n 6d 6f 64 65 2e 0d 0d 0a-24 00 00 00 00 00 00 00 mode....$.......\n 8a 4a 9e 90 ce 2b f0 c3-ce 2b f0 c3 ce 2b f0 c3 .J...+...+...+..\n c7 53 73 c3 aa 2b f0 c3-c7 53 63 c3 c5 2b f0 c3 .Ss..+...Sc..+..\n ce 2b f1 c3 a2 2b c0 97-8f 00 00 f8 ff ff 30 fc .+...+........0.\n 04 00 f2 0f 00 00 48 83-ec 28 4c c3 d4 2b f0 c3 ......H..(L..+..\n c7 53 62 c3 cf 2b f0 c3-c7 53 64 c3 cf 2b f0 c3 .Sb..+...Sd..+..\n c7 53 61 c3 20 cd a2 02-00 f8 ff ff ce 2b f0 c3 .Sa. ........+..\n 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00 ................\n 00 00 00 00 00 00 00 00-50 45 00 00 64 86 18 00 ........PE..d...\n\n```\n\n###### ACPI!GsDriverEntry original\n\n\n-----\n\n## Bootkit Workflow\n\n|BOO|TMGR|\n|---|---|\n|Hook||\n\n\n###### Infected MBR BOOTMGR Winload.exe\n Hook Hook\n\n Original MBR\n ACPI.sys\n\n Real Mode\n\n …\n\n Kernel Init\n\n Protected Mode\n\n\n-----\n\n## Bootkit Workflow\n\n|BOO|TMGR|\n|---|---|\n|Hook||\n\n\n###### Infected MBR BOOTMGR Winload.exe\n Hook Hook\n\n Original MBR\n ACPI.sys\n Hook\n Real Mode\n\n …\n\n Kernel Init\n\n Protected Mode\n\n\n-----\n\n## ACPI.sys Hook\n\n##### • Restores ACPI!GsDriverEntry\n\n • Maps the bootkit physical address into virtual\n address space by calling MmMapIoSpace\n • Decrypts hidden driver\n\n\n-----\n\n## Bootkit Workflow\n\n|BOO|TMGR|\n|---|---|\n|Hook||\n\n\n###### Infected MBR BOOTMGR Winload.exe\n Hook Hook\n\n Original MBR\n ACPI.sys\n Hook\n Real Mode\n\n “Bootkit DOWNDELPH user-mode Bootkit Driver component”\n\n Kernel Init\n\n Protected Mode\n\n\n-----\n\n## Bootkit Workflow\n\n|BOO|TMGR|\n|---|---|\n|Hook||\n\n|Col1|Winload.exe Hook|\n|---|---|\n||ACPI.sys Hook|\n|“Bootkit DOWNDELPH user-mode component”|Bootkit Driver|\n||Kernel Init|\n\n\n###### Infected MBR BOOTMGR Winload.exe\n Hook Hook\n\n Original MBR\n ACPI.sys\n Hook\n Real Mode\n\n “Bootkit DOWNDELPH user-mode Bootkit Driver component”\n\n Kernel Init\n\n Protected Mode\n\n\n-----\n\n## Bootkit Workflow\n\n|BOO|TMGR|\n|---|---|\n|Hook||\n\n|Col1|Winload.exe Hook|\n|---|---|\n||ACPI.sys Hook|\n|“Bootkit DOWNDELPH user-mode component”|Bootkit Driver|\n||Kernel Init|\n\n\n###### Infected MBR BOOTMGR Winload.exe\n Hook Hook\n\n Original MBR\n ACPI.sys\n Hook\n Real Mode\n\n “Bootkit DOWNDELPH user-mode Bootkit Driver component”\n\n Kernel Init\n\n Protected Mode\n\n\n-----\n\n## Bootkit Workflow\n\n|BOO|TMGR|\n|---|---|\n|Hook||\n\n|Col1|Winload.exe Hook|\n|---|---|\n||ACPI.sys Hook|\n|“Bootkit DOWNDELPH user-mode component”|Bootkit Driver|\n||Kernel Init|\n\n\n###### Infected MBR BOOTMGR Winload.exe\n Hook Hook\n\n Original MBR\n ACPI.sys\n Hook\n Real Mode\n\n “Bootkit DOWNDELPH user-mode Bootkit Driver component”\n\n Kernel Init\n Why a DLL to load another DLL ?\n Protected Mode\n\n\n-----\n\n## Who Are You Bootkit?\n\n##### • Missing exported variable in DOWNDELPH\n\n\n-----\n\n## Who Are You Bootkit?\n\n##### • Missing exported variable in DOWNDELPH\n • Code sharing with BlackEnergy\n\n###### – Relocations fixing – DLL injection calling three exports (“Entry”,\n “ep_data” and “Dummy”) – …\n\n\n-----\n\n### But It s Not The End of The Story\n\n##### 2014 DOWNDELPH Samples\n\n\n###### Dropper\n\n\n###### DOWNDELPH\n\n\n-----\n\n## Not So Boring Component++\n\n\n-----\n\n## Kernel Mode Rootkit (1)\n\n##### • Registered as a Windows service\n • Injects DOWNDELPH into explorer.exe (APC)\n • Hides files, folders and registry keys\n • Relies on a set of rules:\n\n\n###### HIDEDRV: >>>>>>>>Hide rules>>>>>>>> rules  HIDEDRV: File rules: \\Device\\[…]\\dnscli1.dll HIDEDRV: File rules: \\Device\\[…]\\FsFlt.sys HIDEDRV: Registry rules: \\REGISTRY\\[…]\\FsFlt HIDEDRV: Registry rules: \\REGISTRY\\[…]\\FsFlt HIDEDRV: Registry rules: \\REGISTRY\\[…]\\FsFlt HIDEDRV: Inject dll: C:\\Windows\\system32\\mypathcom\\dnscli1.dll HIDEDRV: Folder rules: \\Device\\HarddiskVolume1\\Windows\\system32\\mypathcom HIDEDRV: <<<<<<<<XXXXX<<<<<<<< rules\n\n\n-----\n\n### Kernel Mode Rootkit (2)\n\n###### How It Works\n\n##### • Two implementations of the hiding ability:\n\n###### – SSDT hooking – Minifilter driver\n\n\n-----\n\n## Implementation Minifilter\n\n\n-----\n\n## Implementation Minifilter\n\n\n-----\n\n## Implementation Minifilter\n\n\n-----\n\n## Implementation Minifilter\n\n\n-----\n\n## Who Are You Rootkit?\n\n##### • Never documented (to the best of our\n knowledge)\n • PDB paths:\n\n\n###### d:\\!work\\etc\\hi\\Bin\\Debug\\win7\\x86\\fsflt.pdb d:\\!work\\etc\\hideinstaller_kis2013\\Bin\\Debug\\win7\\x64\\fsflt.pdb d:\\new\\hideinstaller\\Bin\\Debug\\wxp\\x86\\fsflt.pdb\n\n\n-----\n\n## Who Are You Rootkit?\n\n##### • Never documented (to the best of our\n knowledge)\n • PDB paths:\n\n\n-----\n\n## Who Are You Rootkit?\n\n##### • Never documented (to the best of our\n knowledge)\n • PDB paths:\n\n\n-----\n\n## To Summarize\n\n###### • Seven different samples (!) of DOWNDELPH over\n the past three years\n • One C&C server was up for two years\n • Persistence methods:\n – Bootkit able to infect from Windows XP to Windows 7 – Rootkit\n • So, WHY such advanced persistence methods for\n such a simple component?\n • DOWNDELPH downloaded SEDRECO + XAGENT in\n a few cases, so SEDNIT related for sure\n\n\n-----\n\n### SPECULATIVE MUMBLINGS\n\n\n-----\n\n## Call For Speculation\n\n##### • The diversity of Sednit software is impressive\n (DOWNDELPH, bootkit, XAGENT, SEDKIT…)\n • Diversity is good for their operations, as it\n makes detection and tracking harder\n • How did they created this software ecosystem? \n\n\n-----\n\n### Sednit Development Process (1)\n\n###### Developers Role\n\n##### • Binaries are often compiled specifically for a\n target, after it has been infected\n\n###### XAGENT SMTP logins/passwords\n\n\n-----\n\n### Sednit Development Process (1)\n\n###### Developers Role\n\n##### • Binaries are often compiled specifically for a\n target, after it has been infected\n\n###### XAGENT SMTP logins/passwords\n\n##### • Main software evolve regularly (XTUNNEL,\n###### SEDUPLOADER, XAGENT…)\n\n\n-----\n\n### Sednit Development Process (1)\n\n###### Developers Role\n\n##### • Binaries are often compiled specifically for a\n target, after it has been infected\n\n###### XAGENT SMTP logins/passwords\n\n##### • Main software evolve regularly (XTUNNEL,\n###### SEDUPLOADER, XAGENT…)\n\n\n###### Developers are part of the team,  not outsiders paid for a one-time job\n\n\n-----\n\n### Sednit Development Process (2)\n\n###### Software Design\n\n##### • Different Sednit software share some techniques:\n\n###### – RC4 keys built as concatenation of a hardcoded\n value and a randomly generated value\n (XAGENT, DOWNDELPH, SEDUPLOADER) – Hardcoded “tokens” in network messages\n (XAGENT, SEDUPLOADER, SEDRECO)\n\n\n-----\n\n### Sednit Development Process (2)\n\n###### Software Design\n\n##### • Different Sednit software share some techniques:\n\n###### – RC4 keys built as concatenation of a hardcoded\n value and a randomly generated value\n (XAGENT, DOWNDELPH, SEDUPLOADER) – Hardcoded “tokens” in network messages\n (XAGENT, SEDUPLOADER, SEDRECO)\n\n\n###### The same developers may be behind this variety of software\n\n\n-----\n\n### Sednit Development Process (3)\n\n###### Programming Errors\n\n Linux XAGENT Communications termination\n\n\n-----\n\n### Sednit Development Process (3)\n\n###### Programming Errors\n\n Linux XAGENT Communications termination\n\n\n-----\n\n### Sednit Development Process (3)\n\n###### Programming Errors\n\n Linux XAGENT Communications termination\n\n\n-----\n\n### Sednit Development Process (3)\n\n###### Programming Errors\n\n Linux XAGENT Communications termination\n\n\n-----\n\n### Sednit Development Process (3)\n\n###### Programming Errors\n\n XTUNNEL report message\n\n\n-----\n\n### Sednit Development Process (3)\n\n###### Programming Errors\n\n XTUNNEL report message\n\n\n###### Developers do not have a code review process (“hackish” feeling)\n\n\n-----\n\n### Sednit Development Process (4)\n\n###### Seeking Inspiration\n\n##### • SEDUPLOADER employed novel persistence\n methods also found in crimeware, and shares code with Carberp\n\n • DOWNDELPH bootkit code bears some similarities with BlackEnergy code\n\n\n-----\n\n### Sednit Development Process (4)\n\n###### Seeking Inspiration\n\n##### • SEDUPLOADER employed novel persistence\n methods also found in crimeware, and shares code with Carberp\n\n • DOWNDELPH bootkit code bears some similarities with BlackEnergy code\n\n\n###### Developers have ties with the\n crimeware underground\n\n\n-----\n\n### Sednit Development Process (5)\n\n###### Having Fun\n\n\n-----\n\n### Sednit Development Process (5)\n\n###### Having Fun\n\n\n###### Developers are not working in a\n formal environment\n\n\n-----\n\n## Mumblings Summary\n\n##### Sednit has some in-house skilled developers, working with little supervision, and those guys have ties with crimeware underground\n\n\n-----\n\n## Conclusion\n\n##### • Sednit activity increased a lot during the last\n two years (targeted attacks with a LOT of targets)\n\n###### – Heard about the DNC hack last week?\n\n##### • Sednit toolkit in constant evolution, moar fun\n to come!\n\n\n-----\n\n## That’s All Folks!\n\n##### • Feel free to poke us:\n###### {calvet,campos,dupuy} .at. esetlabs.com\n\n##### • Whitepaper coming soon!...  (“dans deux mois”)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/ifsplrz92ssuo3mhgwadkgoc19e5y56e",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2016/2016.06.21.visiting_the_bear_den_recon_2016_calvet_campos_dupuy/visiting_the_bear_den_recon_2016_calvet_campos_dupuy-1.pdf"
    ],
    "report_names": [
        "ESET-Visiting_The_Bear_Den(6-21-2016)",
        "visiting_the_bear_den_recon_2016_calvet_campos_dupuy-1"
    ],
    "threat_actors": [
        {
            "id": "a3687241-9876-477b-aa13-a7c368ffda58",
            "created_at": "2022-10-25T16:07:24.496902Z",
            "updated_at": "2025-03-27T02:02:10.256629Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "ETDA:Hacking Team",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e90c06e4-e3e0-4f46-a3b5-17b84b31da62",
            "created_at": "2023-01-06T13:46:39.018236Z",
            "updated_at": "2025-03-27T02:00:02.978356Z",
            "deleted_at": null,
            "main_name": "Hacking Team",
            "aliases": [],
            "source_name": "MISPGALAXY:Hacking Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1466085656,
    "ts_modification_date": 1466085656,
    "files": {
        "pdf": "https://archive.orkl.eu/98985054ab8d3b6c232132f1957fefc4ba01c7a6.pdf",
        "text": "https://archive.orkl.eu/98985054ab8d3b6c232132f1957fefc4ba01c7a6.txt",
        "img": "https://archive.orkl.eu/98985054ab8d3b6c232132f1957fefc4ba01c7a6.jpg"
    }
}