{
    "id": "494d616a-4b07-4c55-b3d2-a4e9eeafecd1",
    "created_at": "2023-01-12T15:05:54.972723Z",
    "updated_at": "2025-03-27T02:15:55.382254Z",
    "deleted_at": null,
    "sha1_hash": "475d235b7ed8a7bb83f2096cafc6fe4b428122a1",
    "title": "2020-08-17 - WellMess malware- analysis of its Command and Control (C2) server",
    "authors": "",
    "file_creation_date": "2022-05-29T00:58:04Z",
    "file_modification_date": "2022-05-29T00:58:04Z",
    "file_size": 137829,
    "plain_text": "# WellMess malware: analysis of its Command and Control (C2) server\n\n**[pwc.co.uk/issues/cyber-security-services/insights/wellmess-analysis-command-control.html](https://www.pwc.co.uk/issues/cyber-security-services/insights/wellmess-analysis-command-control.html)**\n\nCopy link\n\n17/08/20\n\nIn July, the National Cyber Security Centre reported that threat actors had been using malware\nknown as WellMess to target organisations involved in COVID-19 vaccine development.\n\n[We previously published analysis of the WellMess malware, including details of its capability and](https://www.pwc.co.uk/issues/cyber-security-services/insights/cleaning-up-after-wellmess.html)\nfunctionality. During our investigations, we identified another binary from shared Program Database\n(PDB) paths, which is highly likely a first stage Command and Control (C2) server used to pass data\nto a second stage C2. This analysis details the capabilities and limitations of the first stage WellMess\n[controller, with a more in-depth report available from our private intelligence reporting services.](https://www.pwc.co.uk/issues/cyber-security-services/cyber-threat-intelligence.html)\n\n## WellMess C2 analysis\n\nWhile investigating the WellMess malware family, we identified that most samples contained PDB\npaths beginning with:\n```\nC:/Server/BotUI/App_Data/Temp/\n\n```\nPivoting on this string returned an additional file that was not in our previous reporting or the July\n2020 NCSC advisory on WellMess.\n\n\n-----\n\n**Filename** mwdg.sh\n\n**Filetype** ELF 64-bit\n\n**SHA-256** b10fa150e9f022838347115d39fa672440c740a014913947b79464b68dcc2d55\n\n**First seen** 2020-05-04 03:20:12\n\n**Go version** 1.8\n\nThis file contains functionality to communicate with the WellMess malware via HTTP and HTTPS\ncommunication methods, receiving the initial beacons and then handling and responding to the rc\n[command detailed in our previous article. This file also contains code to handle additional](https://www.pwc.co.uk/issues/cyber-security-services/insights/cleaning-up-after-wellmess.html)\ncommands that have previously not been seen in the WellMess malware and are likely commands\nsent from infrastructure controlled by the threat actor.\n\nWe assess this file is likely to be used as an intermediate C2 server that the WellMess malware\ncommunicates with before having data passed on to a second stage C2. It is likely that there are\ndifferent variants of this first stage C2 software that also support the DNS protocol of WellMess.\n\n### WellMess server\n\nThe WellMess server is written in Go and imports two packages, lumberjack and garhttp, that are not\npart of the standard Go packages. The lumberjack package is an open source logging module,\n[which is available on github. The garhttp package is not available in open source and contains the](https://github.com/natefinch/lumberjack)\nfunctionality used to communicate between the server and WellMess binaries.\n\nThe WellMess server uses the lumberjack package to create a development.log file in the current\ndirectory. This file is used to store information about all the connections made to the C2 and what\nports and actions were taken. In addition, if the server encounters any errors then the log file will\ncontain the Go error type and related call history that led to it. An example log file with errors is\nshown in Figure 1.\n\nFigure 1 - Error log contents\n\nThe server uses folders in the current directory to store information sent and received from\nWellMess backdoors and the folder layout is shown in Figure 2. Additionally, the server uses a\nprivate key and certificate located in the current working directory during mutual TLS connections.\n\nFigure 2 - Server directory contents\n\nBased on strings in the binary, the folder names likely stand for Answers, Garbage, Questions and\nSecure. When the server receives communications from a WellMess backdoor in HTTP mode it will\nuse the A folder to store the data received from the malware. It uses the Q folder to store questions\n\n\n-----\n\nor queries that it is ready to send to the WellMess malware and optionally moves the files from the A\nand Q folders to the G folder once the data has been sent.\n\nThe S folder contains another set of the A, G and Q folders that are used when the server receives\nand sends data via the HTTPS communication protocol.\n\nWhen receiving HTTP commands, the WellMess server is setup to receive POST requests that\ncontain RC6 encrypted cookies. The server decrypts the cookies using a hardcoded RC6 key and\nexpects the decrypted data to contain no more than four tags. As the RC6 key is hardcoded and the\nserver does not have any functionality to modify it at runtime, it is unlikely that the threat actor behind\nWellMess would change the WellMess malware’s RC6 key after initial access as that would also\nrequire changing the server software.\n\nThe four tags correspond with the format previously reported on in the WellMess backdoor with\npossible tag names being:\n\nhead;\ntitle;\nservice; and,\nbody.\n\nIf there are three or four received cookie tags and they all match the regular expression below, then\nthe title tag is checked to see what type of communication is being received with the options detailed\nin Table 1.\n```\n[^;]*?);>(?P[^\n\n```\n**Table 1 - Title tag details**\n\n**Tag regular**\n**expression** **Description**\n\na:\\d{1,}_\\d{1,} Saves the received data into the A folder as a .tmp file\n\nq:\\d{1,}_\\d{1,} Saves the received data into the Q folder as a .tmp file\n\nrc Checks the Q folder for .tmp files to respond with\n\nrcc Checks a folder specified in the service tag for .tmp files to respond\nwith\n\nrs Checks the A folder for .tmp files to respond with\n\nrsc Checks a folder specified in the service tag for .tmp files to respond\nwith\n\n\n-----\n\ndel Deletes a file specified by a relative or absolute filepath in the service\ntag\n\nThe WellMess backdoor supports the a:\\d{1,}_\\d{1,} and rc commands, as the initial beacons use the\ntitle tags a:1_0 and a:1_1 and the request for a command from the server is sent using the rc\ncommand. The other values do not appear to be used by the WellMess backdoor and, based on the\nfunctionality, are likely used to manage the operation of this intermediate C2 server.\n\nWhen the server receives a a:\\d{1,}_\\d{1,} tag, it creates a folder with the path (relative or absolute)\nin the head tag. It stores the received information in a file called tmp1_0.tmp with the numbers in the\nfilename being taken from the numbers in the title tag.\n\nAs an example, if the initial beacon had a cookie of:\n```\nMD5_hash/pa:1_0p\n\n```\nThen the title tag would be used to name the file as tmp1_0.tmp and the head tag of MD5_hash/p\nwould be used to create the directories to store the received data.\n\nThe information stored in this file contains newline separated information of the RC6 encrypted and\nbase64 encoded cookie, the IP address and port combination that the POST request came from, the\nMD5 hash of the received encrypted POST data and the received encrypted POST data. An\nexample is shown in Figure 3.\n\nFigure 3 – Stored initial beacon\n\nOn receipt of a message with rc in the title tag it will check the Q folder to see if there is a folder with\nthe same name as the hash that is in the head tag of the rc message. If there is, then it expects\nthere to be a subfolder which contains an arbitrary amount of *.tmp files.\n\nThe *.tmp files are expected to have contents with newline separated data of:\n\nA base64 encrypted cookie; and,\nAn obfuscated string to be sent as the content of the 200 OK response.\n\nThe obfuscated string has the same format of character replacement and splitting into space\nseparated chunks as described in our previous reporting[5] and is either random data or AES\nencrypted data depending on the command specified in the cookie.\n\nIf there is only one *.tmp file in the Q subfolder, then the server will send it with the command\nspecified in the encrypted first line as the Set-Cookie content and the data in the second line to be\nsent as the body of the POST request. If there are multiple files in the subfolder, then the server will\ninstead send the files as part of a chunked C command.\n\nThe rs command checks the A folder to see if there are any directories containing .tmp files and if it\nfinds any then sends all the .tmp files in the first folder found. It uses the first line of the found file as\nthe Set-Cookie data as in the rc command but also RC6 encrypts and obfuscates the file path of the\n\n\n-----\n\nfile that is being sent and puts it at the start of the content of the POST request, along with the\nremaining lines of the file to be sent.\n\nThe rsc and rcc commands do the same operations as the rs and rc commands respectively, but\nthey also allow the service tag to specify the file path that is to be used to read data from.\n\nThe del command takes a file path in the service tag as the location on the server of a file to delete.\nIf after deleting the file, the folder it was in is empty, then the folder is also deleted.\n\nIn HTTPS mode the server has a hardcoded Certificate Authority (CA) certificate that it uses to verify\nany certificates that connect to the server. In practice, the certificates of both the server and anyone\ncommunicating with it will need to be signed by the same CA. This is due to the fact that the\nembedded CA certificate in this sample has details, described in Table 2, that match the CA\ncertificate details used in the WellMess backdoors.\n\n**Table 2 - CA details**\n\n\nSHA256\nFingerprint\n\n\n163C405D87B632EA4E3D79210EAB2417C042CC3B2D8989A1D8ADF2B9A0F39CAF\n\n\nIssuer *, IT, Tunis\n\nSubject *, IT, Tunis\n\nThumbprint E80641E4B2661873CBEEDDE46CCDF04A720529C9\n\nWhen receiving HTTPS commands, the server has a subset of commands available to it. The rcc\nand rsc commands are not supported and the commands for sending files to be stored in the Q and\nA folders have tags of just q and a rather than the regular expression as in the HTTP commands.\n\nWhen data is saved into the A and Q folders in HTTPS mode, the server creates two files –\nfileBody.tmp and filemd.tmp – rather than one. The fileBody.tmp file has the contents of the POST\nrequest placed into it verbatim and the filemd.tmp file contains the encoded cookie and IP/port\ncombination of the backdoor the message came from.\n\nThe rs command also has slightly different functionality, as it moves the first pair of files in the A\nfolder into the G folder and then sends the data back to the requestor. The response from the server\ncontains two Set-Cookie headers with the first having a name of Cookie1 and the second having a\nname of Cookie2. The first cookie contains a base64 encoded string of the command received in the\nPOST request for this file and the second cookie contains the metadata of where the file is located in\nthe server, along with an MD5 hash of the POST request contents and the IP and port that the\nrequest came from.\n\nMultiple rs commands will continuously return the data in the G folder if present and only return new\nfiles if the G folder has had its contents removed.\n\n\n-----\n\n### Security considerations\n\nThe threat actor behind this tool has made choices during development that increase the security of\nthis server software.\n\nThe inclusion of mutual TLS in HTTPS communications with a self-signed CA means that there is no\nopportunity to carry out person-in-the-middle attacks on traffic between the server and the WellMess\nbackdoor, as the server and WellMess backdoor would drop any connections that did not provide a\ncorrectly signed certificate.\n\nIn HTTP mode, the server software has no capability to decrypt or encrypt any of the RSA and AES\nencrypted data that is sent from the WellMess backdoor and so anyone that recovers files from this\nserver without the corresponding encryption keys would not be able to decrypt the contents of the\ncommunications between the WellMess backdoor and this server.\n\n### Attribution\n\nThe NCSC has publicly attributed WellMess to the threat actor we track as Blue Kitsune (a.k.a.\nAPT29). Although we cannot definitively tie the WellMess malware to a particular threat actor based\non current information, the WellMess backdoor does share some design similarities with a previous\nBlue Kitsune tool called Seaduke.[1][2]\n\nThe operation of this WellMess server as an intermediate C2 fits the Seaduke model of using\ncompromised third-party websites or infrastructure to host C2 servers that act as a staging\nenvironment to store commands and responses between the threat actor and the backdoor. The\nimplementation details of Seaduke also have some similarities to WellMess, as both use encrypted\ncookies to transfer metadata about the data being sent and use obfuscated base64 data in HTTP\nrequests as the contents of communications. These techniques are not unique to Blue Kitsune but\nprovide an interesting correlation between the WellMess backdoor and Blue Kitsune tools used since\n2015.\n\n## Conclusion\n\nThe WellMess backdoor, along with this C2 software, enables the threat actor to interact with victims\nin an offline manner and with a level of abstraction between the threat actor and the malicious\nsoftware. The staging C2 detailed in this report can continuously collect information about any\nvictims and store the results ready for the threat actor to review at a later date. Similarly, should any\nvictims go offline for a period of time, then this C2 software can store the commands that it wishes to\nrun until the victim comes back online.\n\nThe C2 has limited functionality to relay information between itself, the WellMess backdoor and\npresumably a further threat actor-controlled machine. It lacks the ability to inspect any of the content\nthat is passed through it and relies on either some other local tool or remote commands to manage\nthe transfer of files.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-17 - WellMess malware- analysis of its Command and Control (C2) server.pdf"
    ],
    "report_names": [
        "2020-08-17 - WellMess malware- analysis of its Command and Control (C2) server.pdf"
    ],
    "threat_actors": [
        {
            "id": "5b748f86-ac32-4715-be9f-6cf25ae48a4e",
            "created_at": "2024-06-04T02:03:07.956135Z",
            "updated_at": "2025-03-27T02:05:17.407352Z",
            "deleted_at": null,
            "main_name": "IRON HEMLOCK",
            "aliases": [
                "ATK7 ",
                "Blue Kitsune ",
                "Cozy Bear ",
                "The Dukes",
                "UNC2452 ",
                "YTTRIUM ",
                "APT29 "
            ],
            "source_name": "Secureworks:IRON HEMLOCK",
            "tools": [
                " CozyCar",
                " CozyDuke",
                " DiefenDuke",
                " FatDuke",
                " HAMMERTOSS",
                " LiteDuke",
                " MiniDuke",
                " OnionDuke",
                " PolyglotDuke",
                " RegDuke",
                " RegDuke Loader",
                " SeaDuke",
                " Sliver",
                "CosmicDuke"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a241a1ca-2bc9-450b-a07b-aae747ee2710",
            "created_at": "2024-06-19T02:03:08.150052Z",
            "updated_at": "2025-03-27T02:05:17.409596Z",
            "deleted_at": null,
            "main_name": "IRON RITUAL",
            "aliases": [
                "Blue Dev 5 ",
                "BlueBravo ",
                "Cloaked Ursa ",
                "CozyLarch ",
                "Dark Halo ",
                "Midnight Blizzard ",
                "NOBELIUM ",
                "StellarParticle ",
                "UNC2452 ",
                "APT29"
            ],
            "source_name": "Secureworks:IRON RITUAL",
            "tools": [
                " Cobalt Strike",
                " EnvyScout",
                " GoldFinder",
                " GoldMax",
                " NativeZone",
                " RAINDROP",
                " SUNBURST",
                " Sibot",
                " TEARDROP",
                " VaporRage",
                "Brute Ratel C4"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46b3c0fc-fa0c-4d63-a38a-b33a524561fb",
            "created_at": "2023-01-06T13:46:38.393409Z",
            "updated_at": "2025-03-27T02:00:02.822155Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "The Dukes",
                "Minidionis",
                "Grizzly Steppe",
                "G0016",
                "Blue Kitsune",
                "BlueBravo",
                "SeaDuke",
                "Cloaked Ursa",
                "YTTRIUM",
                "ATK7",
                "Nobelium",
                "UAC-0029",
                "Group 100",
                "COZY BEAR",
                "IRON HEMLOCK",
                "TA421",
                "ITG11"
            ],
            "source_name": "MISPGALAXY:APT29",
            "tools": [
                "QUARTERRIG",
                "SNOWYAMBER",
                "HALFRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535954,
    "ts_updated_at": 1743041755,
    "ts_creation_date": 1653785884,
    "ts_modification_date": 1653785884,
    "files": {
        "pdf": "https://archive.orkl.eu/475d235b7ed8a7bb83f2096cafc6fe4b428122a1.pdf",
        "text": "https://archive.orkl.eu/475d235b7ed8a7bb83f2096cafc6fe4b428122a1.txt",
        "img": "https://archive.orkl.eu/475d235b7ed8a7bb83f2096cafc6fe4b428122a1.jpg"
    }
}