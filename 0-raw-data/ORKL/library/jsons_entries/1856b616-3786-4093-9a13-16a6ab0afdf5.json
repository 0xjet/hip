{
    "id": "1856b616-3786-4093-9a13-16a6ab0afdf5",
    "created_at": "2023-01-12T15:07:23.39788Z",
    "updated_at": "2025-03-27T02:08:41.204866Z",
    "deleted_at": null,
    "sha1_hash": "744b1a3dace03588edf48feaba0f8ad6ce699440",
    "title": "2017-10-27 - The big difference with Bad Rabbit",
    "authors": "",
    "file_creation_date": "2022-05-28T01:54:09Z",
    "file_modification_date": "2022-05-28T01:54:09Z",
    "file_size": 1196056,
    "plain_text": "# The big difference with Bad Rabbit\n\n**[labsblog.f-secure.com/2017/10/27/the-big-difference-with-bad-rabbit/](https://labsblog.f-secure.com/2017/10/27/the-big-difference-with-bad-rabbit/)**\n\nOctober 27, 2017\n\nBad Rabbit is the new bunny on the ransomware scene. While the security community has\nconcentrated mainly on the similarities between Bad Rabbit and EternalPetya, there’s one\nnotable difference which has not yet gotten too much attention. The difference is that Bad\nRabbit’s disk encryption works.\n\nEternalPetya re-used the custom disk encryption method from the original Petya. Although it\ndidn’t implement the actual ECDH key delivery mechanism, it installed the Petya boot loader,\nand effectively just rendered the machine useless.\n\nPetya’s disk encryption had one specific weakness: it only encrypted some parts of the key\nfile system structures, not the whole disk. This design obviously lead to speculations about\nwhether it is possible to recover the disk using a known clear-text attack, and in fact\n[researchers have made significant progress in investigating this recovery technique.](https://www.crowdstrike.com/blog/decrypting-notpetya-tools-for-recovering-your-mft-after-an-attack/)\n\nAt least on the surface, things look quite different with Bad Rabbit. Instead of using a custom\nencryption mechanism, it follows the current trend in the ransomware community of\nleveraging known legitimate encryption tools.\n\n[Bad Rabbit uses DiskCryptor, a full disk partition encryption software for locking the user](https://diskcryptor.net/wiki/Main_Page)\ndisk. The ransomware ships with an unmodified DiskCryptor driver (borrowed from ReactOS)\nand implements relevant parts of the DiskCryptor user-mode code for communicating with\n\n\n-----\n\nthe driver. The ReactOS driver is a signed, valid driver, so it gets loaded by the Windows\ncleanly with the elevated privileges required by Bad Rabbit’s fake Flash installer dropper.\n\n## Key generation\n\nBad Rabbit uses Windows’ crypto API to generate random key data for the disk encryption.\nThis key data is converted to a human-readable encryption key, which is a 32-bytes long\n[ASCII encoded string, presenting around 165 bits of entropy for the stream cipher AES used](https://en.wikipedia.org/wiki/Password_strength)\nby DiskCryptor.\n\nThe following screenshot represents the random disk encryption key as it is being generated\nby the malware:\n\nRunning dispci.exe under user-mode debugger\n\nAlong with the random key, Bad Rabbit packages some other information like the victim\ncomputer name and domain, then forms the so-called installation key that will be presented\nafter the reboot. In Petya, this code was relatively short code that was protected by the public\nEC key. In Bad Rabbit, it is a much longer blob of data that is protected by the RSA public\nkey shipped with the malware installer.\n\n\n-----\n\nAfter packaging the installation key, the random key data is just discarded. The installation\nkey is written to the disk so that the Bad Rabbit boot loader can present it on the boot\nscreen:\n\nBad Rabbit’s boot loader\n\nThe user is expected to grab the installation key from the boot screen, paste it to the\nattacker’s TOR site, which then will use its own private RSA key to extract the 32-bytes\npassword (typed in the screenshot above).\n\n## After the boot screen\n\nBecause the disk encryption software used is pretty much similar to any other disk\nencryption used by businesses around the globe, like TrueCrypt or Microsoft [BitLocker, the](https://en.wikipedia.org/wiki/BitLocker)\ndisk is in fact *still* encrypted, although it has been mounted by the DiskCryptor driver\ntransparently.\n\nSo if the user now reboots the machine, the same password prompt will be presented as\nlong as the disk decryption routine is initiated. The DECRYPT tool referenced by the boot\nloader is actually just a shortcut to the dispci.exe tool dropped by the malware. This tool\nborrows code from legit DiskCryptor sources for implementing the relevant parts of the code\nfor communicating with the disk encryption driver.\n\n\n-----\n\nEven though all this is quite apparent by just looking at the code, we wanted to demonstrate\nthe encryption scheme by catching the password inline, at the time it was generated by Bad\nRabbit. When this password is used for unlocking the machine, it is possible to install the real\nDiskCryptor GUI tool and initiate the disk decryption process.\n\nUsing DiskCryptor to verify encrypted volume\n\nDiskCryptor identifies the disk presented by the virtual machine (QEMU HARDDISK in the\nabove screenshot) as an AES-encrypted volume, and accepts the random password.\n\n## It works now\n\nWe have speculated before that the flawed disk encryption in EternalPetya was due to\nproblems in the malware development process. Or it may be that they just didn’t care.\nPeople will pay anyways, right?\n\nWhatever was the reason, they have now fixed this issue (if they are the same group of\nmalware developers, which seems to be the consensus in the research community).\n\nAt least the developers of Bad Rabbit have noted the recent developments in research on\nPetya’s disk encryption weaknesses and decided to use something different.\n\n## Recovery considerations\n\n\n-----\n\nAs we have demonstrated in this blog post, Bad Rabbit seems to use a sound principle in its\ndisk encryption, a full disk encryption scheme familiar to all businesses.\n\nWe don’t yet have the full details of this scheme, so there might be bugs in the\nimplementation. But at least its design enables a strong mechanism for locking the machine\nuntil the correct password is really typed to the boot screen.\n\n## Disclaimer\n\nFor screenshots used in this blog post, we DID NOT go to the attacker TOR site and pay for\nthe recovery key.\n\nThe procedures presented in this text DO NOT mean there’s an easy way to unlock the disk\nprotected by the Bad Rabbit. We just present them as proof of the encryption scheme.\nCatching the password inline to the encryption process is not practical in a general sense,\nbecause it requires software that is aware of the exact password generation mechanism\n**prior to the infection. It is used here just for a relatively easily reproducible proof-of-**\nconcept.\n\nCategories\n\n[Threats & Research](https://blog.f-secure.com/category/threats-research/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-10-27 - The big difference with Bad Rabbit.pdf"
    ],
    "report_names": [
        "2017-10-27 - The big difference with Bad Rabbit.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "32a223a8-3c79-4146-87c5-8557d38662ae",
            "created_at": "2022-10-25T15:50:23.703698Z",
            "updated_at": "2025-03-27T02:00:55.528031Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Lazarus Group",
                "Labyrinth Chollima",
                "HIDDEN COBRA",
                "Guardians of Peace",
                "NICKEL ACADEMY",
                "Diamond Sleet"
            ],
            "source_name": "MITRE:Lazarus Group",
            "tools": [
                "RawDisk",
                "Proxysvc",
                "BADCALL",
                "FALLCHILL",
                "WannaCry",
                "HOPLIGHT",
                "TYPEFRAME",
                "Dtrack",
                "HotCroissant",
                "HARDRAIN",
                "Dacls",
                "KEYMARBLE",
                "TAINTEDSCRIBE",
                "AuditCred",
                "netsh",
                "ECCENTRICBANDWAGON",
                "AppleJeus",
                "BLINDINGCAN",
                "ThreatNeedle",
                "Volgmer",
                "Cryptoistic",
                "RATANKBA",
                "Bankshot",
                "Torisma",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536043,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1653702849,
    "ts_modification_date": 1653702849,
    "files": {
        "pdf": "https://archive.orkl.eu/744b1a3dace03588edf48feaba0f8ad6ce699440.pdf",
        "text": "https://archive.orkl.eu/744b1a3dace03588edf48feaba0f8ad6ce699440.txt",
        "img": "https://archive.orkl.eu/744b1a3dace03588edf48feaba0f8ad6ce699440.jpg"
    }
}