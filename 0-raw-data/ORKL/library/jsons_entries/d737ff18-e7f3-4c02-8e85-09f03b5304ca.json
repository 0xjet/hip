{
    "id": "d737ff18-e7f3-4c02-8e85-09f03b5304ca",
    "created_at": "2023-01-12T15:02:09.506105Z",
    "updated_at": "2025-03-27T02:05:55.270137Z",
    "deleted_at": null,
    "sha1_hash": "47e1ce92b4a51d46fd273c6e5ca76949f64e5dad",
    "title": "2020-10-13 - Attackers Abuse MobileIron’s RCE to deliver Kaiten",
    "authors": "",
    "file_creation_date": "2022-05-28T15:56:58Z",
    "file_modification_date": "2022-05-28T15:56:58Z",
    "file_size": 3255510,
    "plain_text": "# Attackers Abuse MobileIron’s RCE to deliver Kaiten\n\n**[blackarrow.net/attackers-abuse-mobileirons-rce-to-deliver-kaiten/](https://www.blackarrow.net/attackers-abuse-mobileirons-rce-to-deliver-kaiten/)**\n\nOctober 13, 2020\n\n13 - Oct - 2020 - Borja Merino\n\nIn September this year the security researcher Orange Tsai [published various vulnerabilities](https://blog.orange.tw/2020/09/how-i-hacked-facebook-again-mobileiron-mdm-rce.html)\nand P0Cs related to the MobileIron’s mobile Device Management (MDM) solution.\n\nThe [Tarlogic Blue Team has identified the use of CVE-2020-15505 by a certain group of](https://www.tarlogic.com/blue-team/)\nattackers to download and run Kaiten\n\n## Kaiten (aka Tsunami)\n\n\n-----\n\nThrough the [JNDI injection related to said CVE, the attackers are downloading the well-](https://www.tarlogic.com/blog/log4shell-vulnerability-cve-2021-44228/)\nknown Kaiten. This family of malware has been used by multiple actors for more than 15\nyears (its beginnings date back to 2002) mainly as an offensive tool to generate DoS attacks\nand, currently, for the mining of cryptocurrencies.\n\n[There are dozens of variants associated with this malicious code; possibly as a result of the](https://malpedia.caad.fkie.fraunhofer.de/details/elf.tsunami)\n[publication of its source code. In February 2016, a variant of Kaiten was distributed by a](https://securelist.com/beware-of-backdoored-linux-mint-isos/73893/)\ngroup of cybercriminals through malicious ISO images after compromising an instance of\nLinux Mint WordPress and modify its download URLs. Another variant, dubbed Amnesia in\n[April 2017 by PaloAlto, was related to the infection of multiple CCTV-DVR systems around](https://unit42.paloaltonetworks.com/unit42-new-iotlinux-malware-targets-dvrs-forms-botnet/)\nthe world by taking advantage of a certain RCE vulnerability that affected more than 70\nvendors.\n\nIn April 2018, [Netlab 360 researchers identified a botnet (nicknamed Muhstik) also linked to](https://threatpost.com/muhstik-botnet-exploits-highly-critical-drupal-bug/131360/)\nthis malicious code that used a certain Drupal vulnerability as the input vector.\n\nThe capabilities of this malware are mainly focused on denial of service attacks by\nimplementing various functions to do TCP/UDP flooding to the victims; all instructed by\nmeans of the IRC protocol. Attackers also have the ability to execute commands and\ndownload files.\n\n## Malware characteristics:\n\nThe binary identified in one of our clients corresponds to\n[969013b23e440fe31be70daac6d7edb2. Its download originates from a certain dropper](https://www.virustotal.com/gui/file/0c27c64fc118ef56048b7d994162c4a0d008b4582c5eeb6923949a286f45ec52/detection)\ndeveloped in bash whose goal is, in the first place, to kill multiple processes related to miners\nand services that require a high level of CPU.\n\n\n-----\n\nFigure 1. bot_kill function\nOnce these processes are finished, the script downloads, via “curl”, the Kaiten malware from\nthe URL https://lib.pygensim.com/gensim in the directory defined by the INSTALL variable\n(/var/tmp/systemd-private-c15c0d5284bd838c15fd0d6c5c2b50bb-systemd-resolved.service_xCkB12/jf2fa44a/aPs52s/jKal2d), it sets execution permissions and finally runs it under the_\nname of “kworker”.\n\n\n-----\n\nFigure 2. Tsunami execution\nThe signature of the harmful code is as follows:\n```\nMD5: 969013b23e440fe31be70daac6d7edb2\nSHA1: 5369a0122fd3b75ffdd110cc86ccc2d8ae2fa130\nSHA256: 0c27c64fc118ef56048b7d994162c4a0d008b4582c5eeb6923949a286f45ec52\n\n```\nThe file is an elf x64 binary compiled with GCC (Alpine 9.3.0). The following image shows its\nstatic properties from the information of its headers.\n\nFigure 3. ELF information: kworker\nBy analyzing the strings embedded within the binary it can be quickly inferred that the\nsample corresponds to Kaiten. In the following image you can see the strings associated with\nthe help menu where some of the IRC NOTICE messages that will be used to report the\nstatus and actions of the bot are shown.\n\n\n-----\n\nFigure 4. Strings binary vs source code Kaiten\nBy reverse engineering it, we can confirm that the malware author compiled the publicly\navailable sources without hardly modifying the logic of their functions:\n\nFigure 5. Function structure\nThe binary, after executing, makes a fork() call and later tries to establish communication\nwith the control server using the IRC protocol. To do this, it generates a random\nnickname/user and connects to certain channel waiting to receive the instructions from their\noperators.\n\nFigure 6. Fork y C&C connection\nThe code implements various functions to carry out different types of denial of service\nattacks (SYN / UDP flooding, etc.). The following image shows the logic to execute one of\nthem, specifically, the so-called Tsunami attack. The operators will instruct the bots to\n\n\n-----\n\nexecute, for a certain time (set in seconds), a DOS TCP attack playing with various flags of\nthis protocol.\n\nFigure 7. Tsunami (DOS)\nThe malicious code also has the ability to execute commands on the victim via the “SH”\ncommand. To do this, first, it adds the command to execute in the $PATH env variable and\nthen makes use of popen() to run it.\n\nFigure 8. Command execution\nAnother Kaiten’s features is downloading files via HTTP. The following image shows the\nfunction responsible for this logic. Observe the strings associated to the GET request (with\nthe “hardcoded” headers) with which the bot requests to download files to the system.\n\n\n-----\n\nFigure 9. Command execution\n\n## Communications\n\nKaiten’s dropper as well as the IRC control server share the same malicious domain:\n_lib.pygensim.com_\n\nThis was created on October 2, 2020 (a few days before the incident) and currently resolves\n[to the address 198.98.56.111 (belonging to the bulletproof host “FranTech solutions”).](https://www.difesaesicurezza.com/en/cyber-in/cybercrime-mass-phishing-campaigns-to-spread-10-malware/)\n\nFigure 10. Whois domain: pygensim.com\n\n\n-----\n\n[According to the information indexed by Shodan the server corresponds to a Debian 10 with](https://www.shodan.io/host/198.98.56.111)\nports 22 (SSH) and 443 exposed to Internet. Note that Shodan correctly identifies the IRC\nserver running on socket 443.\n\nFigure 11. Shodan information\nThe following image shows the bot’s connection to the IRC server (UnrealIRCd 5.0.6) and\nthe entry to the #internet channel (with the password “:key_of_channel”). The creation date\nof this server was October 4 at 6:12 PM PDT.\n\nFigure 12. IRC server connection\nIt should be noted that the IRC server was active during the sample analysis and had about\n300 bots.\n\n\n-----\n\nFigura 13. Active bots\nIn the previous output you can see the “Network Administrator” of this server under the\nnickname “magician”.\n\nFigura 14. Magician (Network Administrator)\nThe number of bots by country that were found at the time of analysis is listed below:\n\n70 US, United States\n30 DE, Germany\n22 GB, United Kingdom\n19 HK, Hong Kong\n12 NL, Netherlands\n12 IT, Italy\n11 RU, Russian Federation\n10 SK, Slovakia\n10 FR, France\n10 CN, China\n10 AU, Australia\n\n\n-----\n\n9 TR, Turkey\n9 IE, Ireland\n8 AT, Austria\n7 MY, Malaysia\n6 SG, Singapore\n6 GL, Greenland\n5 TW, Taiwan\n\n5 CH, Switzerland\n4 MX, Mexico\n4 KR, Korea, Republic of\n4 JP, Japan\n4 CZ, Czech Republic\n4 CA, Canada\n4 AR, Argentina\n3 BE, Belgium\n2 SE, Sweden\n2 RS, Serbia\n2 RO, Romania\n2 PR, Puerto Rico\n2 LU, Luxembourg\n2 ID, Indonesia\n2 HU, Hungary\n2 DO, Dominican Republic\n1 ES, Spain\n1 BR, Brazil\n\n## Indicators of compromise\n\nYara rule:\n\n\n-----\n\n```\nrule Tsunami {\n  meta:\n    author = \"BlackArrow Unit (Tarlogic)\"\n    description = \"Detection of Tsunami/Kaiten sample based on embeded strings\"\n    md5 = \"969013b23e440fe31be70daac6d7edb2\"\n    sha1 = \"5369a0122fd3b75ffdd110cc86ccc2d8ae2fa130\"\n  strings:\n    $elf = { 7f 45 4c 46 }\n    $x1 = \"= Kills the client\"\n    $x2 = \"Kaiten wa goraku\"\n    $x3 = \"syn flooder that will kill most\"\n    $x4 = \"NOTICE %s :Killing pid\"    \n    $x5 = \":Removed all spoofs\"\n    $x6 = \"TSUNAMI <target>\"\n    $x7 = \"Do something like: 169.40\"\n    $x8 = \":Spoofs: %d.%d.%d.%d\"\n    $x9 = \"NOTICE %s :UDP <target>\"      \n    $x10 = \"NOTICE %s :GET <http address> \"      \n    $x11 = \"NOTICE %s :NICK <nick>\" \n    $x12 = \"NOTICE %s :UNKNOWN <target>\"\n    $x13 = \"NOTICE %s :KILLALL\" \n    $x14 = \"GETSPOOFS\" \n  condition:\n    $elf in (0..4) and 6 of ($x*) and filesize < 120KB\n}\n\n```\nIt is recommended to filter the domain linked to the C&C (lib.pygensim.com) and establish\nrules in the corresponding networking devices (firewalls, IDS / IPS) to identify outgoing IRC\ntraffic as this is a protocol rarely used in business environments. In the case of using\nSNORT, consider the detection rules listed at: https://www.snort.org/search?\n_query=irc&submit_search=_\n\n### Leave a comment\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-10-13 - Attackers Abuse MobileIron’s RCE to deliver Kaiten.pdf"
    ],
    "report_names": [
        "2020-10-13 - Attackers Abuse MobileIron’s RCE to deliver Kaiten.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535729,
    "ts_updated_at": 1743041155,
    "ts_creation_date": 1653753418,
    "ts_modification_date": 1653753418,
    "files": {
        "pdf": "https://archive.orkl.eu/47e1ce92b4a51d46fd273c6e5ca76949f64e5dad.pdf",
        "text": "https://archive.orkl.eu/47e1ce92b4a51d46fd273c6e5ca76949f64e5dad.txt",
        "img": "https://archive.orkl.eu/47e1ce92b4a51d46fd273c6e5ca76949f64e5dad.jpg"
    }
}