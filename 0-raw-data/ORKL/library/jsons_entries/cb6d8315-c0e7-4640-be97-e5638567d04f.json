{
    "id": "cb6d8315-c0e7-4640-be97-e5638567d04f",
    "created_at": "2022-10-25T16:48:22.090818Z",
    "updated_at": "2025-03-27T02:05:31.288614Z",
    "deleted_at": null,
    "sha1_hash": "ad4a25b8d51c674cc7cc87ce0a38d119214203aa",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-11-05T06:20:08Z",
    "file_modification_date": "2020-11-05T06:20:08Z",
    "file_size": 1984597,
    "plain_text": "# A new APT uses DLL side-loads to “KilllSomeOne”\n\n**[news.sophos.com/en-us/2020/11/04/a-new-apt-uses-dll-side-loads-to-killlsomeone](https://news.sophos.com/en-us/2020/11/04/a-new-apt-uses-dll-side-loads-to-killlsomeone/)**\n\nGabor Szappanos November 4, 2020\n\nRecently, we’ve observed several cases where DLL side-loading was used to execute the\nmalicious code. Side-loading is the use of a malicious DLL spoofing a legitimate one, relying\non legitimate Windows executables to load and execute the malicious code.\n\n[While the technique is far from new—we first saw it used by (mostly Chinese) APT groups as](https://news-sophos.go-vip.net/wp-content/uploads/sites/2/2013/05/sophosszappanosplugxmalwarefactoryversion6-rev3.pdf)\n[early as 2013, before cybercrime groups started to add it to their arsenal—this particular](https://news.sophos.com/en-us/2020/06/09/kingminer-report/)\npayload was not one we’ve seen before. It stands out because the threat actors used several\nplaintext strings written in poor English with politically inspired messages in their samples.\n\nThe cases are connected by a common artifact: the program database (PDB) path. All\nsamples share a similar PDB path, with several of them containing the folder name\n“KilllSomeOne.”\n\nBased on the targeting of the attacks—against non-governmental organizations and other\norganizations in Myanmar— and other characteristics of the malware involved, we have\nreason to believe that the actors involved are a Chinese APT group.\n\n## Shell game\n\nWe have identified four different side-loading scenarios that were used by the same threat\nactor. Two of these delivered a payload carrying a simple shell, while the other two carried a\nmore complex set of malware Combinations from both of these sets were used in the same\n\n\n-----\n\nattacks.\n\n## Scenario 1\n\n**Components**\n\nAug.exe clean loader (originally MsMpEng.exe, a Microsoft antivirus component\n\nmpsvc.dll malicious loader\n\nGroza_1.dat encrypted payload\n\nThe main code of the attack is in mpsvc.dll ‘s exported function ServiceCrtMain. That\nfunction loads and decrypts the final payload, stored in the file Groza_1.dat:\n\n\n-----\n\nThe encryption is simple XOR algorithm, where the key is the following string: Hapenexx\n**is very bad**\n\nWhile analyzing the binary for the loader used in this attack type, we found the following\nPDB path:\n```\nC:\\Users\\guss\\Desktop\\Recent Work\\U\\U_P\\KilllSomeOne\\0.1\\msvcp\\Release\\mpsvc.pdb\n\n## Scenario 2\n\n```\n**Components**\n\nAUG.exe clean loader (renamed Microsoft DISM.EXE)\n\n\n-----\n\ndismcore.dll malicious loader\n\nGroza_1.dat encrypted payload\n\nThe loader has the following PDB path:\n```\nC:\\Users\\guss\\Desktop\\Recent Work\\U\\U_P\\KilllSomeOne\\0.1\\msvcp\\Release\\DismCore.pdb\n\n```\nThe main code is in the exported function DllGetClassObject.\n\nIt uses the same payload name (Groza_1.dat) and password (Hapenexx is very bad) as the\nfirst case, only this time both the file name and the decryption key are themselves encrypted\nwith a one-byte XOR algorithm.\n\n\n-----\n\nIn both of these cases, the payload is stored in the file named Groza_1.dat. The content of\nthat file is a PE loader shellcode, which decrypts the final payload, loads into memory and\nexecutes it. The first layer of the loader code contains unused string: AmericanUSA.\n\n\n-----\n\nIt has a PE loader shellcode, that decrypts the final payload, loads it into memory and\nexecutes it.The final payload is a DLL file that has the PDB path:\n\nC:\\Users\\guss\\Desktop\\Recent Work\\UDP SHELL\\0.7\nDLL\\UDPDLL\\Release\\UDPDLL.pdb\n\n\n-----\n\nThe DLL is a simple remote command shell, connecting back to a server with the IP address\n160.20.147.254 on port 9999. The code contains a string that is used to generate a key to\ndecrypt the content of data received from the command and control server: “Happiness is\n**a way station between too much and too little.”**\n\n## More ways to KillSomeone\n\nThe other two observed types of KillSomeOne DLL side-loading deliver a fairly sophisticated\ninstaller for the simple shell—one that establishes persistence and does the housekeeping\nrequired to conceal the malware and prepare file space for collecting data. While they carry\ndifferent payload files (adobe.dat in one case, and x32bridge.dat in the other), the\nexecutables derived from these two files are essentially the same; both have the PDB path:\n```\nC:\\Users\\guss\\Desktop\\Recent\nWork\\U\\U_P\\KilllSomeOne\\0.1\\Function_hex\\hex\\Release\\hex.pdb\n\n```\n\n-----\n\n## Scenario 3\n\n**Components**\n\nSafeGuard.exe clean loader (Adobe component)\n\nhex.dll malicious loader\n\nadobe.dat encrypted payload\n\nThe malicious loader loads the payload from the file named adobe.dat, and uses a similar\nXOR decryption to that used in Scenario 1. The only significant difference is the encryption\nkey, which in this case is the string HELLO_USA_PRISIDENT.\n\n\n-----\n\n**Scenario 4 Components**\n\nMediae.exe clean loader\n\nx32dbg.exe clean loader\n\nmsvcp120.dll clean DLL (dependency of x32dbg)\n\nmsvcr120.dll clean DLL (dependency of x32dbg)\n\nx32bridge.dll malicious loader\n\nx32bridge.dat payload\n\n\n-----\n\nIn Scenario 4, the PDB path of the loader is changed to:\n```\nC:\\Users\\B\\Desktop\\0.1\\major\\UP_1\\Release\\functionhex.pdb\n\n```\nThe main code is in the exported function BridgeInit.\n\nThe payload is stored in the file x32bridge.dat, and it is encoded with a XOR algorithm, the\nkey is the same as in case 3—HELLO_USA_PRISIDENT.\n\n## I think I smell a rat\n\n\n-----\n\nThe initial stage extracted from the two payload files in both these scenarios is the installer,\nwhich is loaded into memory from the .dat file by the initial malicious DLL. When loaded, it\ndrops all components for another DLL side-loading cases to several directories:\n\nC:\\ProgramData\\UsersData\\Windows_NT\\Windows\\User\\Desktop\nC:\\Users\\All Users\\UsersData\\Windows_NT\\Windows\\User\\Desktop\n%PROFILE%\\Users\nC:\\Users\\Public\\Public Media\n\nThe installer also assigns the files the “hidden” and “system” attributes to conceal them from\nusers.\n\nSome of the components dropped by the KillSomeOne installer payload.\n\nThe installer then closes the executable used in the initial stage of the attack, and starts a new\ninstance of explorer.exe to side-load the dropped DLL component. This is an effort to\nconceal the execution, since the targeted system’s process list will only show another\nexplorer.exe process (and not the renamed clean executable, which might stand out upon\nexamination).\n\nThe installer also looks for a running process with a name starting with “AAM,” then kills the\nprocess and deletes the file associated with it in C:\\ProgramData and C:\\Users\\All Users.\nThis is likely because earlier PlugX side-loading scenarios used the clean files name “AAM\nUpdates.exe”, and this mechanism removes earlier infections. It also takes several steps to\nensure persistence, including the creation of a task that executes the side-loading executable\nthat began the deployment:\n```\nschtasks /create /sc minute /mo 5 /tn LKUFORYOU_1 /tr\n\n```\n\n-----\n\nAdditionally, it creates a registry auto-run key that does the same thing:\n```\nSoftware\\Microsoft\\Windows\\CurrentVersion\\Run\\SafeGuard\n\n```\nThe side loaded DLL uses an event name to identify itself when running—LKU_Test_0.1 if\nrunning from C:\\ProgramData, or LKU_Test_0.2 if running from %USERHOME%.\n\nThe installer also configures the system for data exfiltration. On removable and non-system\ndrives, it creates a desktop.ini file with settings to create a folder to the “Recycle Bin” type):\n```\n[.ShellClassInfo]\nCLSID={645FF040-5081-101B-9F08-00AA002F954E}\nIconResource=%systemroot%\\system32\\SHELL32.dll,7\n\n```\nIt then copies files to the Recycle Bin on the drive in the subfolder ‘files,’ and also collects\nsystem information, including volume names and free disk space. And lastly, it copies all the\n.dat files dropped—including those used in the other side-loading scenarios—into the\ninstallation directories, Then the installer loads akm.dat, the file containing the next payload\n—the loader.\n\nThe loader is a simple DLL file, which, unlike the rest of the payloads, is not encrypted. It is a\nplain Windows PE file with a single export name, Start— the main function in the DLL,\nwhich builds a command line with the location of AUG.exe (the renamed Microsoft\nDISM.EXE):\n\nc:\\programdata\\usersdate\\windows_nt\\windows\\user\\desktop\\AUG.exe\n\n\n-----\n\nThen in executes the command line, which would invoke side-loading scenario 1 or 2.\n\n\n-----\n\n## Mixed signals\n\nThe types of perpetrators behind targeted attacks in general are not a homogeneous pool.\nThey come with very different skill sets and capabilities. Some of them are highly skilled,\nwhile others don’t have skills that exceed the level of average cybercriminals.\n\nThe group responsible for the attacks we investigated in this report don’t clearly fall on either\nend of the spectrum. They moved to more simple implementations in coding—especially in\nencrypting the payload—and the messages hidden in their samples are on the level of script\nkiddies. On the other hand, the targeting and deployment is that of a serious APT group.\n\nBased on our analysis, it’s not clear whether this group will go back to more traditional\nimplants like PlugX or keep going with their own code. We will continue to monitor their\nactivity to track their further evolution.\n\n**SophosLabs would like to acknowledge the contributions of Mark Loman and Vikas**\n**Singh to this report.**\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.11.04.KilllSomeOne_DLL_APT/A%20new%20APT%20uses%20DLL%20side-loads%20to%20%E2%80%9CKilllSomeOne%E2%80%9D%20%E2%80%93%20Sophos%20News.pdf"
    ],
    "report_names": [
        "A new APT uses DLL side-loads to “KilllSomeOne” – Sophos News"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041131,
    "ts_creation_date": 1604557208,
    "ts_modification_date": 1604557208,
    "files": {
        "pdf": "https://archive.orkl.eu/ad4a25b8d51c674cc7cc87ce0a38d119214203aa.pdf",
        "text": "https://archive.orkl.eu/ad4a25b8d51c674cc7cc87ce0a38d119214203aa.txt",
        "img": "https://archive.orkl.eu/ad4a25b8d51c674cc7cc87ce0a38d119214203aa.jpg"
    }
}