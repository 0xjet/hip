{
    "id": "21456b8f-fbef-4568-8fe8-c60876891599",
    "created_at": "2023-01-12T15:03:08.808523Z",
    "updated_at": "2025-03-27T02:12:44.21539Z",
    "deleted_at": null,
    "sha1_hash": "ed4f1ff971eba519d967cc0a367308bcc4cadd47",
    "title": "2017-08-15 - A Quick Look at a New KONNI RAT Variant",
    "authors": "",
    "file_creation_date": "2022-05-28T15:38:58Z",
    "file_modification_date": "2022-05-28T15:38:58Z",
    "file_size": 554143,
    "plain_text": "# A Quick Look at a New KONNI RAT Variant\n\n**[blog.fortinet.com/2017/08/15/a-quick-look-at-a-new-konni-rat-variant](https://blog.fortinet.com/2017/08/15/a-quick-look-at-a-new-konni-rat-variant)**\n\nThreat Research\n\n\nAugust 15, 2017\n\n\nBy [Jasper Manuel | August 15, 2017](https://blog.fortinet.com/blog/search?author=Jasper+Manuel)\nKONNI is a remote access Trojan (RAT) that was first reported in May of 2017, but is\nbelieved to have been in use for over 3 years. As Part of our daily threat monitoring,\nFortiGuard Labs came across a new variant of the KONNI RAT and decided to take a deeper\nlook.\n\nKONNI is known to be distributed via campaigns that are believed to be targeting North\nKorea. This new variant isn’t different from previous variants, as it is dropped by a DOC file\ncontaining text that was drawn from a CNN article entitled 12 things Trump should know\n_about North Korea. The article was published on August 9, 2017, which indicates that this_\nmight be the latest campaign. Although KONNI campaigns use decoy documents containing\narticles about North Korea, it is hard to tell if the targets have something to do with matters\ninvolving North Korea.\n\n\n-----\n\n_Decoy document used to trick the user into thinking that the file is benign_\n\nThe malicious DOC file contains a VB macro code that drops and executes the KONNI\ninstaller in the %temp% folder as stify.exe:\n\n_VB Macro Document_Open() Sub_\n\nThe dropped file was packed with a known packer Aspack 2.12, as seen below:\n\n_PEID: Packed with ASPack 2.12_\n\n\n-----\n\nAccording to its compilation time stamp in the IMAGE_FILE_HEADER of the file, this variant\nwas compiled on August 8, 2017 (if that file was not modified.)\n\n_Compilation time (Installer)_\n\nThe installer contains 2 KONNI DLL files in the resource section. One is for the 32-bit version\nand the other is for the 64-bit version of Windows OS. According to their compilation time\nstamp, these DLL files were compiled on July 11, 2017.\n\n_Compilation time (KONNI DLLs)_\n\nThe KONNI DLL is dropped in the %LocalAppData%\\MFAData\\event folder as errorevent.dll.\nThe installer creates auto-start registry entries to run the DLL on the next system reboot\nusing rundll32.exe.\n\n_Installation routine_\n\nDoing a bit diffing allows us to see that this hasn’t changed from the variants reported on\nAugust 8, 2017. It still has the same capabilities based on the following command and\ncontrol server commands:\n\n‘0’ : Upload a specific file to the C&C.\n\n‘1’ : Get system information such as computer IP address, computer name, username, drive\ninformation, product name, system type (32 or 64 bit), start menu programs, and installed\nproducts and upload to the C&C.\n\n‘2’ : Take screen shot and upload to the C&C.\n\n\n-----\n\n3 : Find files in specific directory and subdirectories.\n\n‘4’ : Find files in specific directory but not in subdirectories.\n\n‘5’ : Delete a specific file.\n\n‘6’ : Execute a specific file.\n\n‘7’ : Download a file.\n\n_Commands from C&C Server_\n\nIt also has keylogging and clipboard grabbing capabilities. The log file is saved as\n%LocalAppdata%\\Packages\\microsoft\\debug.tmp.\n\nHowever, contrary to the previous report, it doesn’t look like this variant uses the simple XOR\nusing a two-byte key for encryption when communicating to its command and control server.\nThough the server did not respond with commands when we did the analysis, we confirmed\n\n\n-----\n\nthat the initial response from the C&C is not encrypted or encoded. It is just delimited with\nthe string “xzxzxz”.\n\n_“xzxzx” as the delimiter_\n\nWhen sending data to its C&C server, this variant uses the following HTTP query string\nformat:\n\n_Query string_\n\nIn this version, id is the generated machine ID computed from OS InstallDate,\n\n_title is the name of the file with extension where the raw data is saved, and passwd is_\nactually the encoded exfiltrated data.\n\n\n-----\n\n_Example of actual query string_\n\nBefore sending its data to the C&C server, it is first compressed using ZIP format, encrypted\nwith RC4 using the key “123qweasd/*-+p[;’p”, and encoded using Base64.\n\n_Data is zipped, rc4 encrypted, and base64 encoded before sending to the C&C server_\n\nConclusion:\n\nKONNI is not a complicated malware. It doesn’t employ much obfuscation. By simply\nperforming a quick diffing we can see the changes made to new variants. For now, it seems\nthat the only change is how the dropper installs the KONNI DLL, but based on what we have\nseen over the previous months we expect that it will continue to evolve.\n\nFortinet covers detection of this threat as W32/Noki.A!tr and the MSOffice VB Macro dropper\nas WM/MacroDropper.A!tr.\n\n[C&C and download URLs were also blocked by Fortinet’s Web Filter.](https://fortiguard.com/iprep?data=109.228.49.213)\n\n-= FortiGuard Lion Team =\n\n-----\n\n**IOCs:**\n\nSample Hashes:\n\n834d3b0ce76b3f62ff87b7d6f2f9cc9b (DOC)\n\n0914ef43125114162082a11722c4cfc3 (EXE)\n\n38ead1e8ffd5b357e879d7cb8f467508 (DLL)\n\n**URLs:**\n\ndonkeydancehome[.]freeiz.com/weget/upload[.]php (C&C)\n\nseesionerrorwebmailattach[.]uphero[.]com/attach/download.php?\nfile=12%20things%20Trump%20should%20know%20about%20North%20Korea.doc (DOC\ndownload URL)\n\n_[Sign up for weekly Fortinet FortiGuard Labs Threat Intelligence Briefs and stay on top of the](http://ftnt.net/2iT7Mcp%C2%A0)_\n_newest emerging threats._\n\n## Related Posts\n\nCopyright © 2022 Fortinet, Inc. All Rights Reserved\n\n[Terms of ServicesPrivacy Policy](https://www.fortinet.com/corporate/about-us/legal.html)\n| Cookie Settings\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-08-15 - A Quick Look at a New KONNI RAT Variant.pdf"
    ],
    "report_names": [
        "2017-08-15 - A Quick Look at a New KONNI RAT Variant.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43c8747-c898-448a-88a9-76bff88e91b5",
            "created_at": "2024-02-02T02:00:04.058535Z",
            "updated_at": "2025-03-27T02:00:03.302832Z",
            "deleted_at": null,
            "main_name": "Opal Sleet",
            "aliases": [
                "OSMIUM",
                "Konni",
                "Vedalia"
            ],
            "source_name": "MISPGALAXY:Opal Sleet",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b9458777-d970-4e89-b2d2-e532140a390f",
            "created_at": "2024-05-01T02:03:08.140328Z",
            "updated_at": "2025-03-27T02:05:17.41728Z",
            "deleted_at": null,
            "main_name": "NICKEL JUNIPER",
            "aliases": [
                "OSMIUM ",
                "Opal Sleet ",
                "Konni"
            ],
            "source_name": "Secureworks:NICKEL JUNIPER",
            "tools": [
                "KONNI"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535788,
    "ts_updated_at": 1743041564,
    "ts_creation_date": 1653752338,
    "ts_modification_date": 1653752338,
    "files": {
        "pdf": "https://archive.orkl.eu/ed4f1ff971eba519d967cc0a367308bcc4cadd47.pdf",
        "text": "https://archive.orkl.eu/ed4f1ff971eba519d967cc0a367308bcc4cadd47.txt",
        "img": "https://archive.orkl.eu/ed4f1ff971eba519d967cc0a367308bcc4cadd47.jpg"
    }
}