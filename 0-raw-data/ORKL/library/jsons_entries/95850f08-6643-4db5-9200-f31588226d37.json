{
    "id": "95850f08-6643-4db5-9200-f31588226d37",
    "created_at": "2023-01-12T15:01:47.993067Z",
    "updated_at": "2025-03-27T02:05:44.317543Z",
    "deleted_at": null,
    "sha1_hash": "c505ad83d82cb5d407e1ce6776e994f22c3a1a8a",
    "title": "2019-02-26 - The Arsenal Behind the Australian Parliament Hack",
    "authors": "",
    "file_creation_date": "2022-05-29T10:48:54Z",
    "file_modification_date": "2022-05-29T10:48:54Z",
    "file_size": 599436,
    "plain_text": "# The Arsenal Behind the Australian Parliament Hack\n\n**blog.yoroi.company/research/the-arsenal-behind-the-australian-parliament-hack/**\n\n02/26/2019\n\n## Introduction\n\n\nFebruary 26, 2019\n\n\n[In the past days, an infamous cyber attack targeted an high profile target on the APAC area: the Australian Parliament House. As reported](https://www.bbc.com/news/world-australia-47166590)\nby the Australian prime minister there was no evidence of any information theft and the attack has been promptly isolated and contained\nby the [Australian Cyber Security Centre (ACSC), however the attackers gained access the ruling Liberal and National coalition parties](https://cyber.gov.au/government/news/parliament-house-network-compromise/)\nnetworks as well as the opposition Labor Party, just few months before the federal election. The first technical insight points to sophisticate\nstate sponsored threat actors operating in the Pacific region, but no official statement has been been published and the speculation that\nChina was behind the attack is not confirmed in any way.\n\nContextually to the cyber incident disclosure to the public, the ACSC declassified some of the samples involved in the parliament hack, so\nthe Cybaze-Yoroi ZLab team decided to investigate these artifacts to have an insight of Tools and Capabilities of part of this APT cyber\narsenal.\n\n## Technical analysis\n\nAll the analyzed files seem to be related to a post-exploitation phase, where the attacker leveraged them to conduct data exfiltration and\nlateral movements. All the modules don’t belong to an open-source post-exploitation framework, like Metasploit or Empire, but they seem\nto be written from scratch using the high-level language C# on top of the .NET Framework.\n\n### The LazyCat DLL\n\nThe firstly analyzed sample is known in the InfoSec community. The malware is named LazyCat, mainly derived by the famous Mimikatz\npentest tool.\n\n**Hash** Sha256: 1c113dce265e4d744245a7c55dadc80199ae972a9e0ecbd0c5ced57067cf755b\n\n**Threat** LazyCat\n\n**Description** LazyCat DLL to perform local privilege escalation\n\n**Ssdeep** 1536:kxnT6jqsSwI1ChVKt5QtkJBDbFw+IPpUuOE7qBp69bfeL:kxCpSz1CyIGrbgKuNS69bA\n\nTable 1: Information about LazyCat sample.\n\nA first static analysis shows the library is written in .NET, with no heavy obfuscation, and therefore easily revertable to its source-code like\nrepresentation.\n\nFigure 1: Static info about LazyCat sample.\nFigure 2: Part of malware’s code.\nAn interesting function spotted in the code reveal its capability to inspect and gather the contests of an arbitrary process memory, through\nthe usage of the MiniDumpWriteDump function belonging to DbgHelp library. The function’s result will be stored in a file just created using\n“Output” string parameter as name (Figure 3).\n\n\n-----\n\nFigure 3: DumpMemory function.\nMoreover, the malware is able to start a “TcpRelay” service, probably with the intent of create a route between the attacker’s network and\nthe victim’s one and then to make the lateral movements easier.\n\nFigure 4: StartTcpRelay function.\nExploring source code, a particular module named “RottenPotato” emerges. It contains some interesting functions, such as\n“findNTLMBytes” and “HandleMessageAuth”, related to the post-exploitation phase in MS Windows environments. After a quick search, it\n[is possible to discover it is an open source tool publicly available on GitHub at https://github.com/foxglovesec/RottenPotato.](https://github.com/foxglovesec/RottenPotato)\n\nFigure 5: findNTLMBytes function.\nMaking a diff analysis between the Github source code and the malware’s one, emerges that some functions included into malware’s\n_RottenPoteto are not present into public source code. This indicates that the cyber attacker has further weaponized the code to make it_\nmore effective for the malicious goal. At the same time, the usage of code publicly available and open source tools makes more difficult a\npunctual attribution of the weapons to a particular cyber group.\n\nThe LazyCat sample owns a specific module clerks to cover tracks, named “LogEraser”.\n\nFigure 6: LazyCat.LogEraser module.\nThe main function of the module is “RemoveETWLog” which has the purpose of delete the ETW (Event Tracing for Windows) files related\nto the malicious actions the attacker has done.\n\nFigure 7: Code to delete Windows log events.\nAs shown in the above figure, the malware scans all the records belonging to the Windows Log and, if the record ID is equal to the given\nID, it will be deleted.\n\nAt time of analysis, the sample had a middle-low detection rate, probably due to the customization of open source code-snippets; the\nresult of VirusTotal analysis is visible in the following figure:\n\nFigure 8: LazyCat detection.\n\n### The Powerkatz DLL\n\n**Hash** Sha256: 08a85f5fe8714b4842180c12c4d192bd186500af01ee39825f6d5100a2019ebc\n\n**Threat** Generic\n\n**Description** powerkatz DLL\n\n**Ssdeep** 192:RPmh9ncu5qqTz3XQUOsnoGWX4L4Lzn066HVV1GfzacScaz/69ek4VUAVc:ucuqqTz3gUOsnoGWoL4Lz0661V1PcS5V\n\nTable 2: key information about powerkatz (sample 2)\n\n**Hash** Sha256: a95c9fe29a8ae0f618536fdf4874ede5412281e8dfb380bf1370a8d8794f787a\n\n**Threat** Generic\n\n**Description** powerkatz DLL\n\n**Ssdeep** 192:BPmh9ncu5qqTz3XQUOsnoGWX4L4Lan066HVV1GfzacScazu69ek4VUf:ecuqqTz3gUOsnoGWoL4L00661V1PcS57\n\nTable 3: key information about powerkatz (sample 3)\n\nDespite the different hashes, the malicious functionalities within the DLL are the substantially the same, the attacker simply modified some\nstrings and variables names, probably to evade av detection. The similarity between the samples is shown in Figure 9, where is possible\nto see the differences are minimal and they don’t impact the overall behavior.\n\nFigure 9: Diff analysis between the samples.\nThe decompiled source code of the main class also confirms this similarity, i.e. inside the  AsyncTask class in Figure 10. For this reason\nwe will reference a single sample in the following paragraphs.\n\nFigure 10: Comparison between AsyncTask class of both samples.\nThe sample is composed by few classes and functions, one of them seems a good starting point for our analysis: the “StartNew”. As\nintended by its name, it is able to start a new asynchronous task on the victim’s machine, executing the task object passed as _app\nparameter. Once the task is started, the function waits its completion using repeated 1-sec sleeps cycle, and then it returns a valid code\nstatus to the function caller. Probably this module can be used in conjunction with some other functions, belonging to other pieces of the\nimplant, to perform malicious actions in background, making all more stealth.\n\n\n-----\n\nFigure 11: Source code of the StartNew function.\n[The name of this sample, Powerkatz, reminds to a tool available on GitHub ( https://github.com/digipenguin/powerkatz) but even if the](https://github.com/digipenguin/powerkatz)\nname is the same, the code is different. As the previous sample, also the detection rate of this sample, 28 of 70, is not high, as shown in\nFigure 11.\n\nFigure 12: Samples detection rate.\n\n### The Recon Module\n\n**Hash** Sha256: b63ae455f3deaca297b616dd3356063112cfda6e6c5434c407781461ae69361f\n\n**Threat** generic\n\n**Description** port scanner DLL\n\n**Ssdeep** 192:P4NjWnNsFM+5Ic8l5OG/i1/5gK0kbhdeODo3:P4NWnuf5Ic8l21iK0IhDS\n\nTable 4: key information about port scanner sample\n\nLike other samples, it is written C# programming language too. It has two main classes named “PortScanner” and “ReconCommonFuncs”,\nproviding a direct clue of the actions enabled by this part of the implant.\n\nFigure 13: Sample’s classes.\nReading the first one’s code, in fact, the “portScan” contains an Integer array listing few of the well-known network ports, covering major\nlocal network services such as HTTP, TELNET, RDP, POP, IMAP, SSH, SQL .. .\n\nFigure 14: Array containing the port numbers to scan.\nFor each declared port, the function is able to perform a TCP scan, trying to connect to it. If there is an available service behind the port, it\nresponds with its own service banner, which will be stored into a “StringBuilder” object. The malware concatenates the responses from all\nthe scanned ports and finally it writes the results in a file using the “ReconCommonFuncs” class.\n\nFigure 15: Code to perform port scan.\nFigure 16: Usage of TcpClient C# class to perform scan.\nThe “ReconCommonFuncs” class, instead, provides some utility functions, such as “Append” or “GZipAndBase64”, which are selfexplanatory.\n\nFigure 17: Functions belonging to ReconCommonFuncs class.\n\n### The Powershell Agent\n\n**Hash** Sha256: 1087a214ebe61ded9f61de81999868f399a1105188467e4e44182c02ee264a19\n\n**Threat** generic\n\n**Description** OfficeCommu DLL\n\n**Ssdeep** 3072:JbMNa4pc+32UhnsZFM7iCHF6aZ4oFlSAsBycrxAqSPWy3it5r2py2jYN/IroVbpm:JbWa4xmZcl9fFlSBtuZWQ6qp8DrhFJ\n\nTable 5: key information about the sample\n\nThe last sample analyzed by Yoroi ZLab - Cybaze is called “OfficeCommu.dll”, probably with the intent of being confused with the legit\nOffice Communication module available on most Windows machines.\n\nAlso this sample is a sort of utility, probably used in the post-exploitation phase, with the purpose of creating a “PowershellAgent”, a\nstager component of the implant able to parse and execute Powershell commands.\n\nFigure 18: PowershellAgent’s main function.\n\n## Conclusion\n\nThe analyzed samples show the attackers choose a multi-modular approach for the development of their cyber-arsenal, realizing a\ncomplex implant leveraging an ecosystem of libraries providing proper functionalities to conduct advanced, and offensive, cyber\noperations.\n\nDespite these functions and libraries does not appear to contain any zero-day exploit or techniques, the detection of these modules within\na high value perimeter such as the Australian Parliament provides important indication on cyber arsenal development strategies of this\nthreat actor, revealing the abuse and the customization of open-source PenTest tools and proof of concept is one of the preferred way the\n\n\n-----\n\nattackers used to build their arsenal, possibly due to the lower the time to market and resources required to write it, without impacting its\neffectiveness and dangerousness.\n\nShowing also, how these supposedly “known” techniques and tools can be easily repackaged in evasive and silent implants, capable to\nbypass the traditional kinds of security boundaries.\n\n## Indicator of Compromise\n\nHashes\n```\n1c113dce265e4d744245a7c55dadc80199ae972a9e0ecbd0c5ced57067cf755b\n08a85f5fe8714b4842180c12c4d192bd186500af01ee39825f6d5100a2019ebc\na95c9fe29a8ae0f618536fdf4874ede5412281e8dfb380bf1370a8d8794f787a\nb63ae455f3deaca297b616dd3356063112cfda6e6c5434c407781461ae69361f\n1087a214ebe61ded9f61de81999868f399a1105188467e4e44182c02ee264a19\n\n### Yara Rules\n\n```\n\n-----\n\n```\nrule LazyCat_22_02_2019{\n     meta:\n     description = \"Yara Rule for LazyCat\"\n     author = \"Cybaze Zlab_Yoroi\"\n     last_updated = \"2019_02_22\"\n     tlp = \"white\"\n     category = \"informational\"\n     strings:\n          $a = \"LazyCat\"\n          $b = {48 74 74 70 53 65 72 76 65 72 4C 6F}\n          $c = {0A 58 73 9E 00 00 0A 2A 0F 00 28 B0}\n          $d = {80 A1 4E CD 13 56 80 9F}\n     condition:\n          pe.number_of_sections == 3 and pe.machine == pe.MACHINE_I386 and (($b and $c and $d) or ($a))\n}\nimport \"pe\"\nrule Powerkatz_22_02_2019{\n     meta:\n     description = \"Yara Rule for Powerkatz\"\n     author = \"Cybaze Zlab_Yoroi\"\n     last_updated = \"2019_02_22\"\n     tlp = \"white\"\n     category = \"informational\"\n     strings:\n          $a1 = {C7 E8 3F}\n          $b1 = {7C 43 3D}\n          $a2 = {A4 58 24 8A 3A 36 8D 4B 89 15 15 33 CE 1D 1D F2}\n          $b2 = {A9 B5 2D 2A 00 47 AC 44 97 7A F5 D0 04 09 75 13}\n     condition:\n          pe.number_of_sections == 3 and pe.machine == pe.MACHINE_I386 and (($a1 or $b1) and ($a2 or $b2))\n}\nimport \"pe\"\nrule Office_Commu_22_02_2019{\n     meta:\n     description = \"Yara Rule for Office_Commu\"\n     author = \"Cybaze Zlab_Yoroi\"\n     last_updated = \"2019_02_22\"\n     tlp = \"white\"\n     category = \"informational\"\n     strings:\n          $a = {61 E0 4B A1 1D C6 2F A7}\n          $b = {8F D2 A9 E3 70 5A B4 D9 92 1D BA}\n          $c = \"Kill\"\n          $d = {DB 71 F5 4C B0 29 27 20 B8}\n          $e = \"get_IsAlive\"\n     condition:\n          pe.number_of_sections == 3 and all of them\n}\nimport \"pe\"\nrule eba_sample_22_02_2019{\n     meta:\n     description = \"Yara Rule for 1eba_sample\"\n     author = \"Cybaze Zlab_Yoroi\"\n     last_updated = \"2019_02_22\"\n     tlp = \"white\"\n     category = \"informational\"\n     strings:\n          $a = {4A 02 73 29 00 00 0A 7D}\n          $b = {F8 01 7A 00 1B 00 54 28}\n          $c = \"portScan\"\n          $d = {C9 45 99 B9 AA AD C7 46}\n          $e = \"parseHost\"\n     condition:\n\n```\n\n-----\n\n```\n}\n\n```\n_This blog post was authored by Davide Testa, Antonio Farina and Luca Mella of Cybaze-Yoroi Z-LAB_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-02-26 - The Arsenal Behind the Australian Parliament Hack.pdf"
    ],
    "report_names": [
        "2019-02-26 - The Arsenal Behind the Australian Parliament Hack.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535707,
    "ts_updated_at": 1743041144,
    "ts_creation_date": 1653821334,
    "ts_modification_date": 1653821334,
    "files": {
        "pdf": "https://archive.orkl.eu/c505ad83d82cb5d407e1ce6776e994f22c3a1a8a.pdf",
        "text": "https://archive.orkl.eu/c505ad83d82cb5d407e1ce6776e994f22c3a1a8a.txt",
        "img": "https://archive.orkl.eu/c505ad83d82cb5d407e1ce6776e994f22c3a1a8a.jpg"
    }
}