{
    "id": "8e9cf21b-d95b-4b12-a17e-5d2bdc6eb71c",
    "created_at": "2023-01-12T15:10:35.208283Z",
    "updated_at": "2025-03-27T02:06:14.63346Z",
    "deleted_at": null,
    "sha1_hash": "e758b5ff6a6a5bef70c8cf565a490fdcb718d656",
    "title": "2021-01-21 - Vadokrist- A wolf in sheep’s clothing",
    "authors": "",
    "file_creation_date": "2022-05-28T18:10:25Z",
    "file_modification_date": "2022-05-28T18:10:25Z",
    "file_size": 608474,
    "plain_text": "# Vadokrist: A wolf in sheep’s clothing\n\n**welivesecurity.com/2021/01/21/vadokrist-wolf-sheeps-clothing/**\n\nAnother in our occasional series demystifying Latin American banking trojans\n\n[ESET Research](https://www.welivesecurity.com/author/esetresearch/)\n21 Jan 2021 - 11:30AM\n\nAnother in our occasional series demystifying Latin American banking trojans\n\n\nJanuary 21, 2021\n\n\nVadokrist is a Latin American banking trojan that ESET has been tracking since 2018 and that is active\nalmost exclusively in Brazil. In this installment of our series, we examine its main features and some\nconnections to other Latin American banking trojan families.\n\n\n-----\n\nVadokrist shares several important features with families we have described earlier in the series, namely\n[Amavaldo,](https://www.welivesecurity.com/2019/08/01/banking-trojans-amavaldo/) [Casbaneiro,](https://www.welivesecurity.com/2019/10/03/casbaneiro-trojan-dangerous-cooking/) [Grandoreiro and](https://www.welivesecurity.com/2020/04/28/grandoreiro-how-engorged-can-exe-get/) [Mekotio. We recently published a white paper dedicated to](https://www.welivesecurity.com/2020/08/13/mekotio-these-arent-the-security-updates-youre-looking-for/)\ndocumenting the similarities between Latin American banking trojans, whereas this blogpost series focuses\nmore on the detailed analysis of one family at a time.\n\n## Characteristics\n\nVadokrist is written in Delphi. One of the most notable characteristics is the unusually large amount of\nunused code in the binaries. After further examination, we believe this is an attempt to evade detection and\ndissuade or slow analysis. We were able to link some of the code to existing Delphi projects, such as\n[QuickReport.](https://www.quickreport.co.uk/product-information/)\n\nVadokrist stores strings inside string tables. It used to contain an implementation of a string table identical to\nCasbaneiro (illustrated in Figure 1); however, some recent versions of this banking trojan switched to using\nmultiple string tables, each for a different purpose (list of targets, general configuration, backdoor command\nnames, etc.).\n\n\n-----\n\n_Figure 1. String table implementation in earlier Vadokrist binaries_\n\nThe vast majority of Latin American banking trojans collect information about the victim machine (typically\ncomputer name and version of the Windows OS) when first run. The only information Vadokrist collects is\nthe victim’s username and it does so only after initiating an attack on a targeted financial institution, not,\nunlike most other Latin American banking trojans, at install time.\n\nTo ensure persistence, Vadokrist utilizes either a Run key or it creates a LNK file in the startup folder.\n\nIts backdoor capabilities are typical for this type of threat, being able to manipulate the mouse and simulate\nkeyboard input, log keystrokes, take screenshots, and restart the machine. It is also able to prevent access\nto some websites, which it does in a rather clumsy way by killing the browser process when the victim\nattempts to visit such websites. We believe this technique is used to prevent the victims from accessing\ntheir online bank accounts once the attackers have compromised it, aiding them in retaining control.\n\n## Cryptography\n\n\n-----\n\nThe majority of Vadokrist binaries implement a cryptographic algorithm we have seen in other Latin\nAmerican banking trojans (namely Amavaldo and Casbaneiro) that we have dubbed TripleKey. Vadokrist\nuses this algorithm to protect its strings, and occasionally payloads and remote configurations as well (we\ndig deeper into this topic later). For clarity, we have implemented the algorithm in Python, as seen in Figure\n2.\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n\ndef decrypt_payload(data_enc, key1, key2, key3):\n\ndata_dec = str()\n\nfor c in data_enc:\n\nx = data_enc[i] ^ (key3 >> 8) & 0xFF\n\ndata_dec += chr(x)\n\nkey3 = ((x + key3) & 0xFF) * key1 + key2\n\nreturn data_dec\n\ndef decrypt_string(data_enc, key1, key2, key3):\n\ndata_dec = str()\n\nfor c in data_enc:\n\nx = data_enc[i] ^ (key3 >> 8) & 0xFF\n\ndata_dec += chr(x)\n\nkey3 = ((data_enc[i] + key3) & 0xFFFF) * key1 + key2\n\nreturn data_dec\n\n\n_Figure 2. TripleKey encryption scheme used by Vadokrist to protect strings, payloads and remote_\n_configurations_\n\nBesides that, we have seen Vadokrist using RC4 in some of its recent binaries and, in the past, TwoFish as\nwell. This is quite rare among Latin American banking trojans as most of them never use generally known\ncryptographic algorithms.\n\n## Distribution\n\n### MSI overload\n\n\n-----\n\nRecent spam emails distributing Vadokrist contain two nested ZIP archives that contain two files – an MSI\ninstaller and a CAB archive. If a victim executes the MSI installer, it locates the CAB archive and extracts its\ncontents (an MSI loader) to disk. It then executes an embedded JavaScript file that adds a Run key entry,\nmaking sure the MSI loader is executed on system startup. Finally, the script restarts the machine. On\nstartup, the MSI loader executes an embedded DLL – the Vadokrist banking trojan. The whole process is\nillustrated in Figure 3. Notice that no actual downloader is in place; the banking trojan is distributed directly\nby these spam emails.\n\n\n-----\n\n_Figure 3. Execution chain recently used by Vadokrist_\n\nThe JavaScript file is worth mentioning because of its obfuscation. It leverages how the comma operator (,)\nworks in JavaScript and abuses it to greatly reduce readability and possibly to bypass emulation. It\nobfuscates conditions using the logical AND operator (&&) in a similar manner. See an example in Figure 4.\n\n\n-----\n\n_Figure 4. JavaScript installer used by Vadokrist. The bottom part shows the script with transformed operators for_\n\n_better readability._\n\n### Older distribution & execution techniques\n\nWe observed Vadokrist, like most other Latin American banking trojans, using several implementations of\nthe typical distribution chain. We won’t cover all of them, but two are worth mentioning. We have seen\nVadokrist sharing a Delphi downloader with Grandoreiro and a whole distribution chain with Mekotio – in\n[fact, the one marked as Chain 1 in our blogpost about Mekotio.](https://www.welivesecurity.com/2020/08/13/mekotio-these-arent-the-security-updates-youre-looking-for/)\n\nVadokrist occasionally relies on DLL side-loading with a specific injector to decrypt and execute the banking\ntrojan. This injector is identical to the one used by Amavaldo and implements the aforementioned TripleKey\nalgorithm for data decryption.\n\n## Remote configuration\n\n\n-----\n\nVadokrist utilizes remote configuration both in downloaders and the actual banking trojan, usually hosted on\npublic storage services such as GitHub.\n\nThe configuration file is usually encrypted, either by TripleKey or RC4. In Figure 5, you can see that in both\ncases the data can be decrypted without any additional knowledge – in the case of the TripleKey method,\nwe can extract all three keys from the end of the string and in the case of RC4, we can derive the key from\nthe password. In the case of the latter, the encrypted data is further encoded by base64.\n\nThe delimiter also changes from time to time. So far, we have seen three different characters used: “|”, “!”\nand “/”.\n\n_Figure 5. Encrypted remote configuration files used by Vadokrist_\n\nNow that we know how to decrypt the configuration file, let’s examine its contents. In the case of the\nbanking trojan, the result is easy to understand, as it is the IP address of a C&C server. For downloaders,\nthe format is a bit more complex, as illustrated in Figure 6.\n\n\n-----\n\n_Figure 6. Different formats of remote configuration used by Vadokrist downloaders_\n\nTo simplify, we recognize a configuration with an optional ID and six fields:\n\n[mandatory] The URL to download the banking trojan from\n\n[optional] Special folder (first part of the installation path)\n\n[optional] Installation flag (described below)\n\n[optional] Path (second part of the installation path)\n\n[optional] Filename (third and final part of the installation path)\n\n[mandatory] Notification URL\n\nTwo of these fields may require further explanation. If the installation flag is set to “T”, all three parts of the\ninstallation path will be used; otherwise the first one will be ignored. The only thing that is sent to the\n_notification URL is whether an application Core.exe is running – a check familiar from other Latin American_\nbanking trojans that try to detect the presence of anti-fraud software Warsaw GAS Tecnologia.\n\n\n-----\n\nYou can see that the first variant uses all the fields, the second one does not use the ID, and the third one\nonly uses the two mandatory URL fields. The delimiter usage here is a bit more complex, as one delimiter is\nused to separate different entries and a different one to separate fields of an entry. Additionally, you can see\nthat the delimiters change here as well.\n\nThe dynamically changing format of the configuration file indicates Vadokrist is under active and continuous\ndevelopment.\n\n## Conclusion\n\nIn this blogpost, we have dissected Vadokrist, a Latin American banking trojan that is focused on Brazil. We\nhave shown that it has typical characteristics of a Latin American banking trojan – it is written in Delphi,\noffers backdoor functionality and targets financial institutions. Its main deviation from the typical\nimplementation is that it does not collect information about victims right after successfully compromising\ntheir machines.\n\nWe have covered its encryption schemes, distribution and execution methods and remote configuration\nformats. Vadokrist seems to be connected to Amavaldo, Casbaneiro, Grandoreiro and Mekotio, other Latin\nAmerican banking trojans described earlier in our series.\n\n_For any inquiries, contact us at threatintel@eset.com. Indicators of Compromise can also be found in our_\n_GitHub repository._\n\n## Indicators of Compromise (IoCs)\n\n### Hashes\n\n**Campaign “MSI overload”**\n\n**SHA-1** **Description** **ESET detection name**\n\nD8C6DDACC42645DF0F760489C5A4C3AA686998A1 MSI installer JS/TrojanDownloader.Banload.ABD\n\n01ECACF490F303891118893242F5600EF9154184 MSI loader Win32/Spy.Vadokrist.T\n\n\nF81A58C11AF26BDAFAC1EB2DD1D468C5A80F8F28 Vadokrist\nbanking\ntrojan\n\n**Other**\n\n\nWin32/Spy.Vadokrist.T\n\n\n**SHA-1** **Description** **ESET detection name**\n\n\n8D7E133530E4CCECE9CD4FD8C544E0913D26FE4B Vadokrist\nbanking\ntrojan\n\nAD4289E61642A4A724C9F44356540DF76A35B741 Vadokrist\nbanking\ntrojan\n\n\nWin32/Spy.Vadokrist.AF\n\nWin32/Spy.Vadokrist.T\n\n\n-----\n\n**SHA-1** **Description** **ESET detection name**\n\n\nBD71A9D09F7E445BE5ACDF412657C8CFCE0F717D Vadokrist\nbanking\ntrojan\n\n06C0A039DEDBEF4B9013F8A35AACD7F33CD47524 Downloader\n(MSI/JS)\n\nFADA4C27B78DDE798F1E917F82226B983C5B74D8 Downloader\n(Delphi)\n\n525FCAA13E3867B58E442B4B1B612664AFB5A5C0 Injector\nshared with\nAmavaldo\n\n### Recent C&C servers\n\n104.41.26[.]216\n104.41.41[.]216\n104.41.47[.]53\n191.232.212[.]242\n191.232.243[.]100\n191.235.78[.]249\n191.237.255[.]155\n191.239.244[.]141\n191.239.245[.]87\n191.239.255[.]102\n\n## MITRE ATT&CK techniques\n\n\nWin32/Spy.Vadokrist.AD\n\nJS/TrojanDownloader.Banload.AAO\n\nWin32/Spy.Vadokrist.Y\n\nWin32/Spy.Amavaldo.L\n\n\n_[Note: This table was built using version 8 of the MITRE ATT&CK framework.](https://attack.mitre.org/resources/versions/)_\n\n**Tactic** **ID** **Name** **Description**\n\n\nResource\nDevelopment\n\n\n[T1583.001](https://attack.mitre.org/versions/v8/techniques/T1583/001/) Acquire Infrastructure:\nDomains\n\n\n[T1587.001](https://attack.mitre.org/versions/v8/techniques/T1587/001/) Develop Capabilities:\nMalware\n\n\nVadokrist is operated by the\nsame group that develops it.\n\n\nVadokrist registers its own\ndomains to be used as C&C\nservers.\n\nVadokrist is distributed as a spam\nattachment.\n\nVadokrist uses PowerShell in\nsome distribution chains.\n\n\nInitial Access [T1566.001](https://attack.mitre.org/versions/v8/techniques/T1566/001/) Phishing: Spearphishing\nAttachment\n\nExecution [T1059.001](https://attack.mitre.org/versions/v8/techniques/T1059/001/) Command and Scripting\nInterpreter: PowerShell\n\n\n[T1059.005](https://attack.mitre.org/versions/v8/techniques/T1059/005/) Command and\nScripting Interpreter:\nVisual Basic\n\n[T1059.007](https://attack.mitre.org/versions/v8/techniques/T1059/007/) Command and\nScripting Interpreter:\nJavaScript/JScript\n\n\nVadokrist uses VBScript in\nsome distribution chains.\n\nVadokrist uses JavaScript in\nits recent distribution\nchains.\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\n\n[T1204.002](https://attack.mitre.org/versions/v8/techniques/T1204/002/) User Execution:\nMalicious File\n\n\nVadokrist relies on the user\nto execute the malicious\nbinary.\n\n\nPersistence [T1547.001](https://attack.mitre.org/versions/v8/techniques/T1547/001/) Boot or Logon Autostart\nExecution: Registry Run\nKeys / Startup Folder\n\n\nDefense\nEvasion\n\n\n[T1140](https://attack.mitre.org/versions/v8/techniques/T1140/) Deobfuscate/Decode Files\nor Information\n\n\nVadokrist ensures persistence via\nRun key or LNK file in the startup\nfolder.\n\nVadokrist is often distributed\nencrypted and encrypts its remote\nconfiguration.\n\n\n[T1574.002](https://attack.mitre.org/versions/v8/techniques/T1574/002/) Hijack Execution\nFlow: DLL SideLoading\n\n[T1036.005](https://attack.mitre.org/versions/v8/techniques/T1036/005/) Masquerading: Match\nLegitimate Name or\nLocation\n\n[T1218.007](https://attack.mitre.org/versions/v8/techniques/T1218/007/) Signed Binary Proxy\nExecution: Msiexec\n\n\nVadokrist is sometimes\nexecuted by this technique.\n\nVadokrist masquerades as\nlegitimate software.\n\nVadokrist uses the MSI\nformat for execution.\n\n\nCredential\nAccess\n\n\n[T1056.001](https://attack.mitre.org/versions/v8/techniques/T1056/001/) Input Capture: Keylogging Vadokrist can capture keystrokes.\n\n\nDiscovery [T1010](https://attack.mitre.org/versions/v8/techniques/T1010/) Application Window\nDiscovery\n\n[T1057](https://attack.mitre.org/versions/v8/techniques/T1057/) Process Discovery Vadokrist tries to discover\nanti-fraud software by\nprocess name.\n\n\n[T1082](https://attack.mitre.org/versions/v8/techniques/T1082/) System Information\nDiscovery\n\n\nVadokrist discovers victim’s\nusername.\n\n\nVadokrist looks for bank-related\nwindows based on their names.\n\nVadokrist communicates via a\ncustom protocol encrypted with the\nTripleKey algorithm.\n\nVadokrist exfiltrates data via C&C\nserver.\n\n\n[T1113](https://attack.mitre.org/versions/v8/techniques/T1113/) Screen Capture Vadokrist can take\nscreenshots.\n\n\nCommand\nand Control\n\n\n[T1132.002](https://attack.mitre.org/versions/v8/techniques/T1132/002/) Data Encoding: NonStandard Encoding\n\n\nExfiltration [T1041](https://attack.mitre.org/versions/v8/techniques/T1041/) Exfiltration Over C2\nChannel\n\n21 Jan 2021 - 11:30AM\n\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n\n-----\n\n### Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-21 - Vadokrist- A wolf in sheep’s clothing.pdf"
    ],
    "report_names": [
        "2021-01-21 - Vadokrist- A wolf in sheep’s clothing.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536235,
    "ts_updated_at": 1743041174,
    "ts_creation_date": 1653761425,
    "ts_modification_date": 1653761425,
    "files": {
        "pdf": "https://archive.orkl.eu/e758b5ff6a6a5bef70c8cf565a490fdcb718d656.pdf",
        "text": "https://archive.orkl.eu/e758b5ff6a6a5bef70c8cf565a490fdcb718d656.txt",
        "img": "https://archive.orkl.eu/e758b5ff6a6a5bef70c8cf565a490fdcb718d656.jpg"
    }
}