{
    "id": "dd57e464-1e66-41f6-83f2-149d5b1f4721",
    "created_at": "2023-01-12T15:07:33.858701Z",
    "updated_at": "2025-03-27T02:05:23.759265Z",
    "deleted_at": null,
    "sha1_hash": "e6091ea483e609170963fa6995ca587618381355",
    "title": "2021-03-11 - AutoHotKey Leveraged by Metamorfo-Mekotio Banking Trojan",
    "authors": "",
    "file_creation_date": "2022-05-28T02:36:48Z",
    "file_modification_date": "2022-05-28T02:36:48Z",
    "file_size": 1551053,
    "plain_text": "# AutoHotKey Leveraged by Metamorfo/Mekotio Banking Trojan\n\n**cofense.com/blog/autohotkey-banking-trojan/**\n\nBy Cofense March 11, 2021\n\n## Phish Found in Environments Protected by SEGs\n\n**Proofpoint**\n\n**FireEye ETP**\n\n**Microsoft EOP**\n\n**Trend Micro**\n\nBy Elmer Hernandez, Cofense Phishing Defense Center\n\n\n-----\n\nThe Cofense Phishing Defense Center (PDC) has observed banking Trojans abusing\nAutoHotKey (AHK) and the AHK compiler to evade detection and steal users’ information. In\nthis post we take a brief look at the case of Mekotio, also known as Metamorfo, a banking\nTrojan with Latin American origins that is now expanding its reach to victims across Europe.\n\n**Phishing Email**\n\nFigures 1 and 2 are two example emails sent as the campaign’s first step, both targeting\nSpanish users. Figure 2 is a simple request to download a password-protected file and is\ndevoid of context. While Figure 1 is a more elaborate spoofed notification about pending\nlegal documents, with a link that downloads a ZIP file.\n\n_Figure 1 – Email 1_\n\n\n-----\n\n_Figure 2 – Email 2_\n\n**Delivery: Malicious MSI and Finger Commands**\n\nThe PDC encountered two main mechanisms delivering the payload. In the first instance\nthere is a ZIP file containing an MSI file that includes a malicious domain harboring 32 and\n64-bit versions of a second ZIP file (Figure 3).\n\n_Figure 3 – Payload Domain_\n\nThe Custom Actions table of these MSI files confirms the malicious intent. This table enables\nthe incorporation of custom code to the installation package and is often abused by\nattackers. Figure 4 shows an action titled “dqidwlCTIewiuap” containing obfuscated\nJavaScript. The JavaScript is responsible for downloading the correct version of the ZIP file\nfrom the payload site, unzipping its contents, renaming and placing it into a new randomly\nnamed folder.\n\n\n-----\n\n_Figure 4 – Custom Actions Table_\n\n_Figure 5 – Obfuscated JavaScript_\n\nIn the second scenario the original ZIP file drops an LNK or shortcut file containing a\nmalicious Finger command. Finger.exe is a native Windows command that allows the\nretrieval of information about a remote user.\n\nFigure 6 shows the malicious Finger query. The command contacts a server at\n89[.]44[.]9[.]254 and displays the contents of a hosted file in a command shell. The file in\nquestion is a PowerShell script that will run in this shell.\n\n_Figure 6 – Finger Command_\n\nFigures 7 and 8 show the TCP stream with the Finger server and the PowerShell script sent\nby it. The script carries out similar actions to the MSI: it downloads a ZIP file, renames it,\ncopies it to a newly created folder and unzips it there.\n\n\n-----\n\n_Figure 7 – TCP Stream_\n\n_Figure 8 – PowerShell Script_\n\nThe PDC also saw both tactics combined in at least one case, by incorporating the malicious\nFinger command directly into the MSI Custom Actions table (Figure 9).\n\n_Figure 9 – Finger Command Within MSI_\n\n**AutoHotKey and Mekotio**\n\nThis second ZIP file contains three files: the legitimate AHK compiler executable (.exe), a\nmalicious AHK script (.ahk) and the Mekotio banking Trojan (.dll). AHK is a scripting\nlanguage for Windows originally developed to create keyboard shortcuts (i.e. hot keys). In\nthe example below (Figure 10), all files were dropped in C:\\\\ProgramData\\{random name}.\n\n_Figure 10 – Dropped Files_\n\n\n-----\n\nThe execution chain can be summarized in the following way: before exiting, the MSI or\nPowerShell script will run the AHK compiler, the AHK compiler will execute the AHK script\nand the AHK script will load Mekotio into the AHK compiler memory. We can verify this by\ntaking a look at the loaded modules in Figure 11.\n\n\n-----\n\n_Figure 11 – Mekotio Loaded_\n\n\n-----\n\nMekotio will then operate from within the AHK compiler process, using the signed binary as a\nfront to make detection more difficult for endpoint solutions.\n\nFor persistence it drops copies of all three files in a new folder. It will then use a run key to\ninitiate the execution chain every time the system restarts by executing the renamed copy of\nthe AHK compiler.\n\n_Figure 12 – Run Key for AHK Compiler Copy “gur.exe”_\n\nMekotio monitors browser activity looking for targeted banks. Figure 13 displays some of the\ntargeted institutions in the form of strings in the AHK compiler process memory. We can see\nbanks not only from Latin American, but from Spain, France and Portugal. Once it identifies a\ntarget, Mekotio is known to present the user with a fake version of the webpage.\n\n\n-----\n\n_Figure 13 – Memory Strings_\n\nMekotio disables specific registry browser values associated with password and form\nsuggestions and autocompletion (Figure 14). This forces the user to type in sensitive\ninformation, even if they have it saved in their browser history, allowing the malware to\ncapture credentials with its keylogging capabilities.\n\n_Figure 14 – Registry Values_\n\n\n-----\n\nThe Trojan can also monitor Bitcoin addresses copied to the clipboard and replace them with\none belonging to the attackers. Figures 15a to 15c show this process. As of this writing, this\nspecific attacker address had a balance of 0.01957271 BTC, approximately USD $800\n(Figure 16).\n\n_Figure 15a – Copying Example BTC Address_\n\n_Figure 15b – Pasting Example BTC Address_\n\n_Figure 15c – BTC Address is replaced_\n\n\n-----\n\n_Figure 16 – BTC Balance_\n\nThe above functionalities are neither exhaustive nor exclusive to Mekotio. The main\ntakeaway is that legitimate binaries can be leveraged as a façade for malicious activity.\nVigilance is key. If a file or process is not meant to be there, it’s best to check.\n\n**Indicators of Compromise**\n\n**Infection Domain** **IP**\n\nhxxp://priyadarsiniculturalsociety[.]com//images/?hash=%email% 51[.]81[.]75[.]131\n\nhxxp://hothiphopbeats[.]com//images/?hash=%email% 209[.]40[.]193[.]208\n\nhXXp://www3[.]santoandre[.]sp[.]gov[.]br/assistencia/wp-folha/TGR 189[.]1[.]163[.]21\n\n**Payload Domain** **IP**\n\nhxxp://critichotshot[.]com/loc/ 162[.]255[.]118[.]194\n\nhxxps://thaipoliticstoday[.]com/saudi-news-tq1vh/ 172[.]67[.]181[.]248\n\nhXXp://web[.]groupe-convergence[.]com/ 213[.]186[.]33[.]69\n\n\nhXXp://www[.]aralimp[.]com[.]br/wpcontent/upgrade/TGR/SII_000492106006B8[.]zip\n\n\n177[.]12[.]164[.]108\n\n\nhXXp://umc24[.]club//wp-content/gallery/ 217[.]160[.]0[.]235\n\n\nhXXps://leopard-hunt[.]com//wpcontent/userr/20AVW5RSJKV8948[.]zip\n\n\n104[.]21[.]63[.]133\n172[.]67[.]145[.]198\n\n\n-----\n\n– 89[.]44[.]9[.]254\n\n– 104[.]214[.]107[.]176\n\n**C2** **IP**\n\nes[.]sslhermanos[.]com 45[.]147[.]229[.]128\n45[.]147[.]231[.]119\n\nhxxp://40[.]112[.]173[.]53/again/?oriudfjdfij88 40[.]112[.]173[.]53\n\n**_All third-party trademarks referenced by Cofense whether in logo form, name form or product_**\n**_form, or otherwise, remain the property of their respective holders, and use of these trademarks in_**\n**_no way indicates any relationship between Cofense and the holders of the trademarks. Any_**\n**_observations contained in this blog regarding circumvention of end point protections are based on_**\n**_observations at a point in time based on a specific set of system configurations. Subsequent_**\n**_updates or different configurations may be effective at stopping these or similar threats. Past_**\n**_performance is not indicative of future results._**\n\n**_The Cofense® and PhishMe® names and logos, as well as any other Cofense product or service_**\n**_names or logos displayed on this blog are registered trademarks or trademarks of Cofense Inc._**\n\nDon't miss out on any of our phishing updates! Subscribe to our blog.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-11 - AutoHotKey Leveraged by Metamorfo-Mekotio Banking Trojan.pdf"
    ],
    "report_names": [
        "2021-03-11 - AutoHotKey Leveraged by Metamorfo-Mekotio Banking Trojan.pdf"
    ],
    "threat_actors": [
        {
            "id": "67fbc7d7-ba8e-4258-b53c-9a5d755e1960",
            "created_at": "2022-10-25T16:07:24.077859Z",
            "updated_at": "2025-03-27T02:02:10.101173Z",
            "deleted_at": null,
            "main_name": "Promethium",
            "aliases": [
                "APT-C-41",
                "Promethium",
                "StrongPity"
            ],
            "source_name": "ETDA:Promethium",
            "tools": [
                "StrongPity",
                "StrongPity2",
                "StrongPity3",
                "Truvasys"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "cbede712-4cc3-47c6-bf78-92fd9f1beac6",
            "created_at": "2022-10-25T15:50:23.777222Z",
            "updated_at": "2025-03-27T02:00:55.544919Z",
            "deleted_at": null,
            "main_name": "PROMETHIUM",
            "aliases": [
                "PROMETHIUM",
                "StrongPity"
            ],
            "source_name": "MITRE:PROMETHIUM",
            "tools": [
                "Truvasys",
                "StrongPity"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4660477f-333f-4a18-b49b-0b4d7c66d482",
            "created_at": "2023-01-06T13:46:38.511962Z",
            "updated_at": "2025-03-27T02:00:02.852307Z",
            "deleted_at": null,
            "main_name": "PROMETHIUM",
            "aliases": [
                "StrongPity",
                "G0056"
            ],
            "source_name": "MISPGALAXY:PROMETHIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536053,
    "ts_updated_at": 1743041123,
    "ts_creation_date": 1653705408,
    "ts_modification_date": 1653705408,
    "files": {
        "pdf": "https://archive.orkl.eu/e6091ea483e609170963fa6995ca587618381355.pdf",
        "text": "https://archive.orkl.eu/e6091ea483e609170963fa6995ca587618381355.txt",
        "img": "https://archive.orkl.eu/e6091ea483e609170963fa6995ca587618381355.jpg"
    }
}