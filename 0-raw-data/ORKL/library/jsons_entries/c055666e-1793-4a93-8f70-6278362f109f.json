{
    "id": "c055666e-1793-4a93-8f70-6278362f109f",
    "created_at": "2023-01-12T15:04:53.837858Z",
    "updated_at": "2025-03-27T02:06:04.680644Z",
    "deleted_at": null,
    "sha1_hash": "1af3614d0873165280062ee423e91b103e2ff1eb",
    "title": "2022-01-20 - Return of Pseudo Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-27T21:28:02Z",
    "file_modification_date": "2022-05-27T21:28:02Z",
    "file_size": 3709427,
    "plain_text": "# Return of Pseudo Ransomware\n\n**[trellix.com/en-us/about/newsroom/stories/threat-labs/return-of-pseudo-ransomware.html](https://www.trellix.com/en-us/about/newsroom/stories/threat-labs/return-of-pseudo-ransomware.html)**\n\nBy [Christiaan Beek,](https://www.trellix.com/en-us/about/newsroom/stories/contributors/christiaan-beek.html) [Max Kersten and](https://www.trellix.com/en-us/about/newsroom/stories/contributors/max-kersten.html) [Raj Samani · January 20, 2022](https://www.trellix.com/en-us/about/newsroom/stories/contributors/raj-samani.html)\n\n[Arnab Roy,](https://www.trellix.com/en-us/about/newsroom/stories/contributors/arnab-roy.html) [Filippo Sitzia and](https://www.trellix.com/en-us/about/newsroom/stories/contributors/filippo-sitziahtml) [Mo Cashman contributed to the research supporting this blog](https://www.trellix.com/en-us/about/newsroom/stories/contributors/mo-cashman.html)\n\nRecent news reports of a “ransomware” campaign targeting Ukraine has resulted in significant press\ncoverage regarding not only attribution but also possible motive. Unlike traditional ransomware\ncampaigns where the motive is obvious, this particular campaign is believed to be pseudo in nature .1\nIn other words, its intention is likely to cause destruction of infected systems since the wiper at Stage\n4 simply overwrites data on the victim’s system, meaning no decryption is possible. Whilst the\ncampaign is targeting largely one country, the [Trellix Advanced Threat Research team have published](https://www.trellix.com/)\nan MVISION Insights campaign to track the threat which highlights what indicators have been found in\n[other countries. (Additional details)](https://www.cisa.gov/sites/default/files/publications/CISA_Insights-Implement_Cybersecurity_Measures_Now_to_Protect_Against_Critical_Threats_508C.pdf)\n\n\n-----\n\nSource: [Insights Preview](https://www.mcafee.com/enterprise/en-us/lp/insights-preview.html)\n\nSubsequently we would strongly recommend organizations ensure that their security posture has the\nnecessary controls to protect and detect against the threat. Indicators of Compromise for active\nhunting are available within the preview, and we have incorporated all known indicators into our\nproducts. Furthermore, work continues to ensure that we can identify any new elements to this attack\nas they arise.\n\nCampaign details\n\nFirst samples and indicators were reported on Thursday the 13rd of January in the late evening UTC\ntime, which is around 1AM in the morning and onwards in the Ukraine.\n\nThe attack consists of three stages, as can be seen below.\n\n\n-----\n\n**Figure 1: Attack Flow**\nStage 1: Overwrites the MBR and destroys all partitions Initial files that were discovered were:\n\nFilename Stage1.exe\n\nCompile time 01-10-2022 10:37:18\n\nSHA1 189166d382c73c242ba45889d57980548d4ba37e\n\nSHA256 a196c6b8ffcb97ffb276d04f354696e2391311db3841ae16c8c9f56f36a38e92\n\nMD5 5d5c99a08a7d927346ca2dafa7973fc1\n\nStage 2: Downloads Stage 3 via CDN hosted by discord\n\nFilename Stage2.exe (originally named Tbopbh.exe)\n\nCompile time 01-10-2022 14:39:54\n\nSHA1 16525cb2fd86dce842107eb1ba6174b23f188537\n\nSHA256 dcbbae5a1c61dbbbb7dcd6dc5dd1eb1169f5329958d38b58c3fd9384081c9b78\n\nMD5 14c8482f302b5e81e3fa1b18a509289d\n\nStage 3: Executes the file wiper\n\nFilename Frkmlkdkdubkznbkmcf.dll\n\n\n-----\n\nSHA1 82d29b52e35e7938e7ee610c04ea9daaf5e08e90\n\nSHA256 9ef7dbd3da51332a78eff19146d21c82957821e464e8133e9594a07d716d892d\n\nMD5 e61518ae9454a563b8f842286bbdb87b\n\nThe file path of both executables was “C:\\”. All jokes aside, the files were actually named like this.\n\nBoth files have a destructive character as we observed during our analysis of the samples.\n\n**Stage 1 – The Master Boot Record rewrite**\n\nWhen starting with the first stage, “Stage1.exe”, it imposes itself as ransomware after execution,\nwhere it overwrites the Master Boot Record (MBR). After running the malware in a VM and rebooting\nthe machine, the following note appears:\n\nAs with most ransomware notes, the usual language is in there: a notification that the device has been\nencrypted, and that files are being held hostage, together with a payment address to send the\ndemanded amount to, in the requested currency. In this case, which is rare, a TOX ID is included.\nTOX is used to chat end-to-end encrypted via peer-to-peer connections.\n\nAlthough different variants were analyzed, the amount and BTC address stayed the same, which in\nmost Ransomware-as-a-Service operations changes, using bit mixers to obfuscate transactions.\n\nAnalysing the code, no code was observed to delete volume shadow copies or block the recovery\nmode boot process, which is often used to remove malware and/or restore operations. These steps\nare very common in most ransomware samples.\n\nIn this below snippet of code, we observe the malware accessing the physical drive, which is where\nthe MBR resides, after which it will overwrite said MBR.\n\n\n-----\n\n**Stage 2 – The Discord Downloader**\n\n[The ‘Stage2’ file is using an icon that resembles the icon of the proxy client “Proxifier”. The authors](https://www.proxifier.com/)\ntried to evade detection by signing the sample with a certificate and mimicking itself as a Microsoft\nbinary belonging to the operating system. The meta-data in that is attached to the file is Russian, as\ncan be seen in the screenshot below. The assembly description and title both equal “Проводник” (or\n“Conductor” in English), as can be seen in line 24 and 25 in the screenshot below.\n\nWhen executed, stage2 executes an encoded PowerShell command, which is given below.\n\npowershell.exe\" -enc UwB0AGEAcgB0AC0AUwBsAGUAZQBwACAALQBzACAAMQAwAA==\n\nOnce the base64 encoded command is decoded, the actual command appears: a ten second sleep to\ndelay the execution:\n\nPowershell.exe Start-Sleep -s 10\n\nThe malware then moves on to download a file, named “Tbopbh.jpg” from a Discord CDN server.\n\nhxxps://cdn[.]discordapp[.]com/attachments/928503440139771947/930108637681184768/Tbopbh[.]jpg\n\nFilename Tbobph.jpg\n\nSHA1 b2d863fc444b99c479859ad7f012b840f896172e\n\n\n-----\n\nSHA256 923eb77b3c9e11d6c56052318c119c1a22d11ab71675e6b95d05eeb73d1accd6\n\nMD5 b3370eb3c5ef6c536195b3bea0120929\n\nThis file is not an image, but rather a reversed PE file. Prior to its invocation, the data is reversed in\norder. The file is a DotNet Framework based DLL, where the starting point of stage 3 is reflectively\ninvoked, as can be seen in the snippet below.\n\nThe static function in the third stage is named “Ylfwdwgmpilzyaph” and resides in\n“ClassLibrary1.Main” as a namespace and class respectively. The function takes no arguments, nor\ndoes it return any value.\n\n**Stage 3 – A re-used loader**\n\nFilename Frkmlkdkdubkznbkmcf.dll\n\nSHA1 82d29b52e35e7938e7ee610c04ea9daaf5e08e90\n\nSHA256 9ef7dbd3da51332a78eff19146d21c82957821e464e8133e9594a07d716d892d\n\nMD5 e61518ae9454a563b8f842286bbdb87b\n\nThis stage is also a DotNet Framework binary, as can be derived from the reflective invocation in the\nprevious step. The used loader is more common, and is generally used to spread commodity\n[malware. As described in this recent Twitter thread, the xClient RAT was also distributed via this](https://twitter.com/Libranalysis/status/1483128221956808704)\nloader family.\n\nThis loader starts several processes during its execution, after which it uses process hollowing to\ninject and run stage 4. At first, the loader ensures it has administrative privileges. If not, the process is\nstarted again while requesting said privileges.\n\nThe first process it starts, is a file it drops to “%temp%\\Nmddfrqqrbyjeygggda.vbs”. The content of this\nfile is rather small, as can be seen below.\n\nCreateObject(\"WScript.Shell\").Run \"powershell Set-MpPreference -ExclusionPath 'C:\\'\", 0, False\n\nThis excludes “C:\\” from Windows Defender’s prying eyes. As stated above, the first two stages were\nboth located in this exact location, meaning their stay will not be detected by Defender’s scans once\nthe exclusion is in-place.\n\nThe two processes that are started after that, utilise the same tool to execute commands:\n[AdvancedRun by Nir Sofer. The used version (1.2.2.6, signed on Monday the third of August 2020, at](https://www.nirsoft.net/utils/nirext.html)\n5:45:51 AM by Nir Sofer), is a legitimate executable that is abused by this malware.\n\nThe first execution of AdvancedRun is used to stop Defender, using an invisible window.\n\n\n-----\n\n%temp%\\AdvancedRun.exe /EXEFilename \"C:\\Windows\\System32\\sc.exe\" /WindowState 0\n/CommandLine \"stop WinDefend\" /StartDirectory \"\" /RunAs 8 /Run\n\nThe second execution of AdvancedRun is used to completely remove the files of Defender from the\nsystem.\n\n%temp%\\AdvancedRun.exe /EXEFilename\n\"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" /WindowState 0 /CommandLine\n\"rmdir 'C:\\ProgramData\\Microsoft\\Windows Defender' -Recurse\" /StartDirectory \"\" /RunAs 8 /Run\n\nThe loader then uses the interoperability functionality within the DotNet Framework to execute\nunmanaged code from a managed context. The list of functions below shows which unmanaged\nfunctions were used, in no apparent order. The names of these files are base64 encoded in the\nloader.\n\nResumeThread\nWow64SetThreadContext\nSetThreadContext\nGetThreadContext\nVirtualAllocEx\nWriteProcessMemory\nZwUnmapViewOfSection\nCreateProcessA\nCloseHandle\nReadProcessMemory\n\nThese function calls indicate the usage of process injection. Based on this, the fourth stage can be\ndumped, of which the analysis can be found below.\n\n**Stage 4 – The wiper**\n\nFilename \nSHA1 8be3c66aecd425f1f123aadc95830de49d1851b5\n\nSHA256 191ca4833351e2e82cb080a42c4848cfbc4b1f3e97250f2700eff4e97cf72019\n\nMD5 343fcded2aaf874342c557d3d5e5870d\n\nThe wiper is written in C, and does not contain symbols nor other debug information. The main\nfunction is given below, together with some notes.\n\n\n-----\n\nThe malware iterates over all drives, where it wipes all files that match any of the following 191\nextensions.\n\n.HTML, .HTM, .SHTML, .XHTML, .PHTML, .PHP, .JSP, .ASP, .PHPS, .PHP5, .ASPX, .PHP4,\n.PHP6, .PHP7, .PHP3, .DOC, .DOCX, .XLS, .XLSX, .PPT, PPTX, .PST, .OST, .MSG, .EML, .VSD,\n.VSDX, .TXT, .CSV, .RTF, .WKS, .WK1, .PDF, .DWG, .ONETOC2, .SNT, .JPEG, .JPG, .DOCB,\n.DOCM, .DOT, .DOTM, .DOTX, .XLSM, .XLSB, .XLW, .XLT, .XLM, .XLC, .XLTX, .XLTM, .PPTM,\n.POT, .PPS, .PPSM, .PPSX, .PPAM, .POTM, .EDB, .HWP, .602, .SXI, .STI, .SLDX, .SLDM, .BMP,\n.PNG, .GIF, .RAW, .CGM, .SLN, .TIF, .TIFF, .NEF, .PSD, .AI, .SVG, .DJVU, .SH, .CLASS, .JAR,\n.BRD, .SCH, .DCH, .DIP, .PL, .VB, .VBS, .PS1, .BAT, .CMD, .JS, .ASM, .H, .PAS, .CPP, .C, .CS,\n.SUO, .ASC, .LAY6, .LAY, .MML, .SXM, .OTG, .ODG, .UOP, .STD, .SXD, .OTP, .ODP, .WB2, .SLK,\n.DIF, .STC, .SXC, .OTS, .ODS, .3DM, .MAX, .3DS, .UOT, .STW, .SXW, .OTT, .ODT, .PEM, .P12,\n.CSR, .CRT, .KEY, .PFX, .DER, .OGG, .RB, .GO, .JAVA, .INC, .WAR, .PY, .KDBX, .INI, .YML, .PPK,\n.LOG, .VDI, .VMDK, .VHD, .HDD, .NVRAM, .VMSD, .VMSN, .VMSS, .VMTM, .VMX, .VMXF,\n.VSWP, .VMTX, .VMEM, .MDF, .IBD, .MYI, .MYD, .FRM, .SAV, .ODB, .DBF, .DB, .MDB, .ACCDB,\n.SQL, .SQLITEDB, .SQLITE3, .LDF, .SQ3, .ARC, .PAQ, .BZ2, .TBK, .BAK, .TAR, .TGZ, .GZ, .7Z,\n.RAR, .ZIP, .BACKUP, .ISO, .VCD, .BZ, .CONFIG\n\nThe wiping process is shown in the diagram below.\n\n\n-----\n\nThe name exclusion list contains the following file names: “.”, “..”, “$RECYCLE.BIN”, or the value of\nthe environment variable named “HOMEDRIVE”.\n\nFiles names which are too long cannot be handled properly using the disk designator, which is why a\ndifferent approach must be taken there. Microsoft’s [documentation describes all scenarios clearly,](https://docs.microsoft.com/en-us/windows/win32/fileio/naming-a-file)\nincluding the how and why.\n\nOnce the wiping has finished, the second function within the main function is called, which ensures\nthe asynchronous execution of the given command and the termination of its own process will lead to\nthe deletion of the wiper’s file, which is not in use anymore at that point in time. The code is given\nbelow.\n\nThe module name is copied into the command, which runs a minimalised window where a ping\nrequest is issued 5 times to “111.111.111.111”, with a 10 millisecond wait time between each request.\nThe output of the command is sent to “Nul”, ensuring the output is hidden. Additionally, the path to the\n\n\n-----\n\nwiper is used as an argument to be deleted forcefully and quietly from the disk. This would fail if the\nprogram was still running, which is why the ping command is executed first. The function in the\nscreenshot below executes the given command, and closes all handles.\n\nAt last, ExitWindowsEx is called, using EWX_SHUTDOWN as the flag, which ensures that all file\nbuffers have been flushed to the disk. The given shutdown reason is network connectivity related.\n\nMITRE Techniques\n\nT1059.001 PowerShell Usage of PowerShell to download file from Discord and\nexecute.\n\nT1485 Data Destruction MBR wiping and/or file overwriting to corrupt them\n\nT1059.005 Visual Basic Stage3 is running vbs with Wscript init.\n\n\nT1562.004 Disable or Modify\nSystem firewall\n\n\nStage3 is disabling the Defender\n\n\nT1112 Modify Registry Registry settings changed to disable tooling\n\nT1105 Ingress Tool Transfer Files like Stage1.exe and stage2.exe were transferred into\nand through the network.\n\n_Defensive Guidance_\n\n_Threat Intelligence_\n\nMVISION Insights provides early visibility into the IOC’s related to this campaign and the associated\ndetections if any in your environment\n\n\n-----\n\nMVISION Insights also provides signs of prevalence within your environment by matching the ENS\ndetections with the campaign and also providing the process trace information to show the flow of\nexecution\n\nEnsure your ENS AMCore definitions are upto date and GTI and real protect is enabled\n\n\n-----\n\n**Figure 2: Following are the triggered ENS detections for stage1 and 2**\nMVISION EDR provides complete visibility into the execution of the processes as follows:\n\nHere we can see the communication flow for the second stage payloads and the intent of the\npowershell script executions\n\nCreating an investigation from the threat detections we can see the use of dual intel tools such as\npowershell, cmd to execute os commands and make changes to the system and download additional\npayloads.\n\n\n-----\n\n1 [https://www.helpnetsecurity.com/2017/08/14/pseudo-ransomware/](https://www.helpnetsecurity.com/2017/08/14/pseudo-ransomware/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-20 - Return of Pseudo Ransomware.pdf"
    ],
    "report_names": [
        "2022-01-20 - Return of Pseudo Ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535893,
    "ts_updated_at": 1743041164,
    "ts_creation_date": 1653686882,
    "ts_modification_date": 1653686882,
    "files": {
        "pdf": "https://archive.orkl.eu/1af3614d0873165280062ee423e91b103e2ff1eb.pdf",
        "text": "https://archive.orkl.eu/1af3614d0873165280062ee423e91b103e2ff1eb.txt",
        "img": "https://archive.orkl.eu/1af3614d0873165280062ee423e91b103e2ff1eb.jpg"
    }
}