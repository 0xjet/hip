{
    "id": "83653a19-543c-4f0d-aeaf-e8965005a374",
    "created_at": "2023-01-12T15:06:56.884327Z",
    "updated_at": "2025-03-27T02:16:34.997853Z",
    "deleted_at": null,
    "sha1_hash": "65efa610d7a084ec8f3bce17b32610b591b6b3b8",
    "title": "2022-02-20 - Detecting Cobalt Strike Beacons",
    "authors": "",
    "file_creation_date": "2022-05-28T19:43:20Z",
    "file_modification_date": "2022-05-28T19:43:20Z",
    "file_size": 1460585,
    "plain_text": "# Detecting Cobalt Strike Beacons\n\n**[socfortress.medium.com/detecting-cobalt-strike-beacons-3f8c9fdcb654](https://socfortress.medium.com/detecting-cobalt-strike-beacons-3f8c9fdcb654)**\n\nSOCFortress February 20, 2022\n\n[SOCFortress](https://socfortress.medium.com/?source=post_page-----3f8c9fdcb654--------------------------------)\n\nFeb 20\n\n\n6 min read\n\n## Introduction\n\nCobalt Strike is a commercial tool for adversary simulation.\n\nCreated by Raphael Mudge in 2012, Cobalt Strike was one of the first public red team\ncommand and control frameworks.\n\nIt’s also used by threat actors and the first activity detected for malicious purposes dates\nback to 2016.\n\nThe main components of Cobalt Strike are a C2 server and a beacon installed on\ncompromised machines.\n\nThe Cobalt Strike beacon comes with a number of capabilities, including a command-line\ninterface. The beacon allows the execution of scripts, or commands native to the machine’s\n**operating system.**\n\nCobalt strike for malicious purposes is known to be used by more than 50 threat actor\ngroups. Its use is very common in ransomware attacks.\n\nIn terms of beacon types and methods used for connecting to the C2 servers the most\ncommon are HTTP (~67%), HTTPS (~29%) and DNS (~3%). Including JITTER in the beacon\ntrying to avoid detection has been detected in roughly 15% of all the beacons analysed.\n\nWhen it comes to spawning, around 90% of all beacons analysed were spawning\n**rundll32.exe as the main process for lateral movement.**\n\nSophisticated attacks using Cobalt strike beacons, like Nobelium usage of Cobalt strike\nlinked to the SolarWinds campaign, try to evade detection by fine-tuning many of the\nconfigurable options.\n\n\n-----\n\n## PREVENTION, DETECTION AND RESPONSE TOOLS\n\nStatic File Hash analysis: .\nEndpoint Telemetry: (Sysinternals).\nEDR agent and SIEM: .\nThreat Intel platform:\n\n## PREVENTION.\n\nMany of the Cobalt Strike beacons in the wild and additional payloads downloaded as part of\nthe attack chain are going to be flagged and removed by Windows Defender via local file\nanalysis (file hash) or its real time analysis engine.\n\nFrom a prevention point of view some key points are:\n\nCollecting, reviewing and alerting on Windows Defender Settings not matching\nminimum criteria (Real Time, Enabled, Exclusion extensions, Excluded folders,\nremovable media, etc.). Deploy an inventory collection script (more info ) and alert on\ninadequate settings.\n\nWindows Defender Settings\n\nEnsuring that the antimalware platform is running and in a healthy state\n\n\n-----\n\nInformation level events — Process running and in healthy state\n\nEnsuring that Windows Defender is successfully downloading and updating the latest\nfile signatures\n\nInformation level events — Signatures Updated\n\nEnsuring that periodic scans are run in all agents and completed successfully.\n\n\n-----\n\nInformation level events — Periodic scans\n\n## DETECTION.\n\n Network Activity\n\nCommunication to C2 Server:\n\nSuspicious processes (“winlogon.exe”, “rundll32.exe”, etc.) opening network\nconnections to public IP addresses.\n\nKeep track and alert on unusual processes (least seen) opening network connections.\nSpecial attention to HTTP, HTTPS and DNS outbound connections. Sysmon (event ID 3)\nprovides all the required telemetry:\n\nNetwork Activity — Least Seen Processes\n\n\n-----\n\n**Visualisations such as network maps linking Process — DST IP — Connection port can**\nhelp to quickly identify anomalies:\n\nNetwork Activity — Process Map\nKeep track of downloaded payloads (.js files, .gif files, etc.). Sysmon (Event ID 15) provides\nthis telemetry.\n\nNetwork Activity — Sysmon Event 15\nSend relevant observables (DNS requests, Destination IPs, files hashes of downloaded files)\nto security feeds/threat intel platform to identify IoCs related to these observables. More info\n[here.](https://github.com/juaromu/wazuh-misp)\n\n## Process Activity.\n\nUsed in Lateral Movement by Cobalt Strike beacons: rundll32.exe being spawned by another\nprocess(es) and its process execution included no arguments.\n\nKeep track and alert on unusual processes spawning rundll32.exe\n\n\n-----\n\nProcesses Spawning Rundll32.exe\nUsed in Post Exploitation in Cobalt strike related attacks: rundll32.exe spawning processes\nlike Adfind.exe, Net.exe, or any other Windows processes used for systems, services or\nnetwork discovery.\n\n## Parent Process Spoofing:\n\nParent process spoofing is a common technique used by Cobalt Strike beacons. With this\ntechnique the beacon tries to evade common detection methods such as processes related\nto the Office suite launching unusual child processes.\n\nCobalt strike beacons often spoof processes like “word.exe”, or “excel.exe” to “explorer.exe”\nso that when the child process is launched the telemetry reported by the EDR agent makes\nthe detection of unusual process chains difficult.\n\nKeep track on unique file hashes (process image) and their mapping to file process image\nname and location. Spoofed processes will have same process name but different file hash\nand possibly executed from an unusual location.\n\n\n-----\n\nUNIQUE RELATIONSHIP PROCESS FILE HASH — PROCESS EXECUTED\nSend relevant observables (file hash of the executed file image) to security feeds/threat intel\n[platform to identify IoCs related to these observables. More info here.](https://github.com/juaromu/wazuh-misp)\n\n## Powershell execution (and command line arguments).\n\nSuspicious command line arguments used:\n\nnop, hidden, encodedcommand, nologo, noprofile\n\nThe “encodedcommand” (base64) can be extracted and its literal content further analysed,\nlooking for commands like “Net.Webclient”, “Invoke-WebRequest”, etc., commonly used for\nlateral movement on the source machine.\n\nOn the destination machine, a common detection is spotting powershell executions where\nthe parent process = “wsmprovhost.exe” and with a command line = “-Version 5.1 -s nologo -noprofile”\n\nDetection rule to spot powershell executions with the encodedcommand command line and\ndecode the content of the base64 string to “clear text”. Include the decoded command as an\nadditional alert in Wazuh manager.\n\n## Memory artifacts / Process Injection.\n\nDownloaded payloads try to be executed under the memory space of “Rundll32.exe”.\n\nKeep track and alert on unsigned DLLs or with no valid certificate loaded into memory.\nSysmon (Event ID 7) provides this telemetry:\n\nUnsigned DLLs loaded in memory.\nVisualisations such as DLL side loading maps linking Process —DLL — DLL vendor can\nhelp to quickly identify anomalies:\n\n\n-----\n\nProcess and DLL side loading map.\nSend relevant observables (DLL file hash) to security feeds/threat intel platform to identify\n[IoCs related to these observables. More info here.](https://github.com/juaromu/wazuh-misp)\n\n## Lateral Movement.\n\n**PSEXEC is one of the most common processes used by Cobalt strike beacons for lateral**\nmovement.\n\nPSEXEC is used to drop a payload in a shared folder (normally ADMIN$) and then to start a\nnew service on the target machine that executes that payload. The payload will spawn\nanother process and finally the remote service is removed.\n\nDetection rules based on frequency alerting on service creation/modification/deletion\nactivity:\n\nSystem Services Activity and Telemetry.\nKeep track and alert on unusual executables launched by services.exe.\n\n\n-----\n\nSend relevant observables (process file hash) to security feeds/threat intel platform to\n[identify IoCs related to these observables. More info here.](https://github.com/juaromu/wazuh-misp)\n\n**Need Help?**\n\nThe functionality discussed in this post, and so much more, are available via the\nSOCFortress platform. Let SOCFortress help you and your team keep your infrastructure\nsecure.\n\nWebsite: [https://www.socfortress.co/](https://www.socfortress.co/)\n\nPlatform Demo: [https://www.socfortress.co/demo_access.html](https://www.socfortress.co/demo_access.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-20 - Detecting Cobalt Strike Beacons.pdf"
    ],
    "report_names": [
        "2022-02-20 - Detecting Cobalt Strike Beacons.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "70872c3a-e788-4b55-a7d6-b2df52001ad0",
            "created_at": "2023-01-06T13:46:39.18401Z",
            "updated_at": "2025-03-27T02:00:03.01553Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "DarkHalo",
                "StellarParticle",
                "NOBELIUM",
                "Solar Phoenix",
                "Midnight Blizzard"
            ],
            "source_name": "MISPGALAXY:UNC2452",
            "tools": [
                "SNOWYAMBER",
                "HALFRIG",
                "QUARTERRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1d3f9dec-b033-48a5-8b1e-f67a29429e89",
            "created_at": "2022-10-25T15:50:23.739197Z",
            "updated_at": "2025-03-27T02:00:55.536417Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "UNC2452",
                "NOBELIUM",
                "StellarParticle",
                "Dark Halo"
            ],
            "source_name": "MITRE:UNC2452",
            "tools": [
                "Sibot",
                "Mimikatz",
                "Cobalt Strike",
                "AdFind",
                "GoldMax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "a241a1ca-2bc9-450b-a07b-aae747ee2710",
            "created_at": "2024-06-19T02:03:08.150052Z",
            "updated_at": "2025-03-27T02:05:17.409596Z",
            "deleted_at": null,
            "main_name": "IRON RITUAL",
            "aliases": [
                "Blue Dev 5 ",
                "BlueBravo ",
                "Cloaked Ursa ",
                "CozyLarch ",
                "Dark Halo ",
                "Midnight Blizzard ",
                "NOBELIUM ",
                "StellarParticle ",
                "UNC2452 ",
                "APT29"
            ],
            "source_name": "Secureworks:IRON RITUAL",
            "tools": [
                " Cobalt Strike",
                " EnvyScout",
                " GoldFinder",
                " GoldMax",
                " NativeZone",
                " RAINDROP",
                " SUNBURST",
                " Sibot",
                " TEARDROP",
                " VaporRage",
                "Brute Ratel C4"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46b3c0fc-fa0c-4d63-a38a-b33a524561fb",
            "created_at": "2023-01-06T13:46:38.393409Z",
            "updated_at": "2025-03-27T02:00:02.822155Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "The Dukes",
                "Minidionis",
                "Grizzly Steppe",
                "G0016",
                "Blue Kitsune",
                "BlueBravo",
                "SeaDuke",
                "Cloaked Ursa",
                "YTTRIUM",
                "ATK7",
                "Nobelium",
                "UAC-0029",
                "Group 100",
                "COZY BEAR",
                "IRON HEMLOCK",
                "TA421",
                "ITG11"
            ],
            "source_name": "MISPGALAXY:APT29",
            "tools": [
                "QUARTERRIG",
                "SNOWYAMBER",
                "HALFRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d9b39228-0d9d-4c1e-8e39-2de986120060",
            "created_at": "2023-01-06T13:46:39.293127Z",
            "updated_at": "2025-03-27T02:00:03.042341Z",
            "deleted_at": null,
            "main_name": "BelialDemon",
            "aliases": [
                "Matanbuchus"
            ],
            "source_name": "MISPGALAXY:BelialDemon",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536016,
    "ts_updated_at": 1743041794,
    "ts_creation_date": 1653767000,
    "ts_modification_date": 1653767000,
    "files": {
        "pdf": "https://archive.orkl.eu/65efa610d7a084ec8f3bce17b32610b591b6b3b8.pdf",
        "text": "https://archive.orkl.eu/65efa610d7a084ec8f3bce17b32610b591b6b3b8.txt",
        "img": "https://archive.orkl.eu/65efa610d7a084ec8f3bce17b32610b591b6b3b8.jpg"
    }
}