{
    "id": "e40af847-d844-447b-9ec3-3f192f2a9e45",
    "created_at": "2022-10-25T16:48:12.146194Z",
    "updated_at": "2025-03-27T02:06:10.756758Z",
    "deleted_at": null,
    "sha1_hash": "c5a4051be573ef0482b7fb01dc3697847489b882",
    "title": "",
    "authors": "",
    "file_creation_date": "2018-05-23T10:46:57Z",
    "file_modification_date": "2018-05-23T10:46:57Z",
    "file_size": 603068,
    "plain_text": "## G DATA Whitepaper 2018 – paper 3\n\n\n## Analysis of\n\n# MSIL.Backdoor.SocketPlayer.A\n\n##### Analysis by: https://twitter.com/RansomBleed\n\n G DATA Software AG | Malware analysis | May 2018\n\n\n-----\n\n**G Data Whitepaper 2018 – paper 3: Description for SocketPlayer**\n\n### Contents\n\n1\n\n**1.** **Introduction ................................................................................................................ 3**\n\n**2.** **Initial routine of SocketPlayer ........................................................................................ 3**\n\n**3.** **Commands .................................................................................................................. 3**\n\n**4.** **AvName() function ........................................................................................................ 4**\n\n**5.** **SocketPlayer downloader .............................................................................................. 5**\n\n**6.** **Variant 1 ..................................................................................................................................... 5**\n\n**7.** **Variant 2 ..................................................................................................................................... 5**\n\n**8.** **Procedure of the latest SocketPlayer infection routine ...................................................... 6**\n\n**9.** **Bkdr.exe ...................................................................................................................... 6**\n\n**10.** **Changes to SocketPlayer ............................................................................................... 6**\n\n**11.** **Spreading .................................................................................................................... 7**\n\n**12.** **File hashes and resources .............................................................................................. 7**\n\n\n-----\n\n**G Data Whitepaper 2018 – paper 3: Description for SocketPlayer**\n\n### 1. Introduction\n\n[The twitter user @struppigel brought my attention to a post of @sudosev who found a RAT[1] on](https://twitter.com/struppigel)\nvirustotal which looks like a new malware family. The RAT is written in .NET and the source-code\ncan therefore be inspected easily. The RAT uses socket.io for communication which is not that\ntypical for malware hence it captured my attention.\n\n### 2. Initial routine of SocketPlayer\n\nFirstly, the actual socket connection is created with the code line Socket.socket = IO.Socket(URL).\n\nAfter that, the program checks whether the directory C:\\Users\\USERNAME\\Music\\Player exists. If it\ndoesn’t, it will create that folder. Next it creates a registry key to the\n_SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run path. Proceeding the autostart entry, the_\nprogram copies itself to the location C:\\Users\\USERNAME\\Music\\Player\\Player.exe\n\nLastly the actual socket connection is made with the socket.Emit function which passes the\nfollowing information to the c2: the username, the current date, the antivirus product name\n(information about how this is achieved later) and the machine name. Some information like the\nusername is sent twice and the machine name is even sent thrice – no idea why the author did that.\n\n### 3. Commands\n\n**Command** **Functionality**\n\nfdrive Iterates through all drives that are ready and returns the name,\nthe total size and again, the name. If a drive isn’t ready, only the\nname is returned.\n\nfdir If the specified directory isn’t on the system, false is returned.\nOtherwise the path of the subdirectories, the creation date of\nthose, all files within the current directory, the file size and the\ncreation date of those is returned.\n\nmfdir Returns the filename, file size, creation time and the full name of\nall the extensions that were specified recursively using the sndflesi\nmethod.\n\nf1 If the specified parameter is longer than 3 and contains “:\\\\” it will\nreturn “f1|drive”. Otherwise it will return the name of the parent\ndirectory.\n\nstrtsgnl Returns the uid of the current running program.\n\n\n-----\n\n**G Data Whitepaper 2018 – paper 3: Description for SocketPlayer**\n\nfdowl Using the sndfle function, a file is uploaded to the c2 using the\npath /cl/upld/.\n\nfexc Executes a file if it exists.\n\nfdel Deletes a directory or file if it exists.\n\nprocs Returns information about currently running processes like the\nprocess name, whether the process responds, the window title\nand the process id.\n\nprockil Kills a running process by id. After that the same information as in\n_procs is returned(to check if the process is terminated)._\n\nGtscreen A screenshot is made and returned.\n\nupld A specified file from the /uploads/ folder of the c2 is downloaded\nand stored to the temporary directory. After that it’s executed.\n\nupldex Similar to upld but with specified location in the temporary\ndirectory and an autostart entry for it as well.\n\nkylgs Reads the contents of the file “klsetup.txt” in the temporary\ndirectory and returns them.\n\ndestt Kills the active socket connection, removes the autostart key,\nremoves the created file and the path from the initial routine and\nexits itself.\n\nThe command kylgs is possibly intended to serve as a keylogging feature as the name and the\npartial functionality suggests it. However, no actual keylogging functionality has been\nimplemented and therefore the command is useless for now.\n\n### 4. AvName() function\n\nThe function AvName() uses the ManagementObjectSearcher class in order to enumerate the\ncurrently installed antivirus product with the SQL query “SELECT * FROM AntivirusProduct”. As\nmultiple values are returned, the program targets the property value displayName as this value\ncontains the name of the antivirus product. The displayName value is returned. This function is\nused in 2. Initial routine.\n\n\n-----\n\n**G Data Whitepaper 2018 – paper 3: Description for SocketPlayer**\n\n### 5. SocketPlayer downloader\n\nAt the current time of writing there are two variants of the SocketPlayer downloader out there. The\nfirst variant is a ~100KB file which does exactly what a typical downloader does - downloading a file\nand executing it. The second one is a little bit more complex and is described in 7. variant 2.\n\n### 6. Variant 1\n\nAccording to virustotal version 1a[2] of the first variant was submitted on 2018-03-28. The variant\n1b[3], which was submitted on 2018-03-31, is 5.5KB bigger. This is because the variant 1b contains\nHTML file within its resources. Below is a screenshot of the displayed file.\n\n_Figure 2. HTML file from variant 1b[3] resources._\n\nThis image indicates that the author is planning to launch a phishing attack to club members.\nHowever, no email functionality is used in the sample and the HTML file makes therefore not much\nsense for now. The submission dates on virustotal indicate that the version 1a is an older and\nversion 1b is the newer version of the downloader. The addition of the HTML file reinforces this\nassumption.\n\n### 7. Variant 2\n\nSame as variant 1, there is also an old version[4] and a new version[5].\n\nBoth versions have a similar initial routine as in 2. Initial routine. The old version only uses the\n_C:\\Users\\USERNAME\\Music path and downloads the data from_\n_hxxp://173.249.39.7:1337/uploads/excutbls/ with the filename specified via socket.io from the_\nserver.\n\nThe new version checks if the file hxxp://93.104.208.17:1337/uploads/excutbls/h/one/Player.exe\nexists and then opens a socket connection. If the directory C:\\Users\\USERNAME\\Music\\Audio Player\ndoesn’t exist, it will be created. If the file C:\\Users\\USERNAME\\Music\\Audio Player\\Audio.exe doesn’t\nexist, an autostart key with the value “Audio Player” is created and the file copies itself to that\npath.\n\nAfter that it does the same routine again for a different path. It checks if the directory\n_C:\\Users\\USERNAME\\Music\\Music Player exists. If it doesn’t, the directory will be created. If the file_\n\n\n-----\n\n**G Data Whitepaper 2018 – paper 3: Description for SocketPlayer**\n\n_C:\\Users\\USERNAME\\Music\\Music Player\\Music.exe doesn’t exist, it will create an autostart key with_\nthe value “Music Player”. Next it will download the file\n_hxxp://93.104.208.17:1337/uploads/executbls/h/two/Music.exe and save it to the path_\n_C:\\Users\\USERNAME\\Music\\Music Player\\Music.exe._\n\nLastly the machine name is sent twice, the username is also sent twice and the date is sent to the\nc2.\n\n### 8. Procedure of the latest SocketPlayer infection routine\n\nThe downloader[6] creates a connection to the host hxxp://asdkajkjsdnaskjndjansdka.com. This\nconnection is made to detect sandboxed systems. Most sandboxed systems return true for any\nDNS query. So if this connection “succeeds” the malware stops itself. If the check has passed, the\ndownloader downloads hxxp://93.104.208.17:5156/uploads/executbls/h/Audio.exe, decrypts that\nexecutable with the hardcoded string “!##&aAwPs1337” and uses the Invoke method to run the\ndecrypted program[7] in memory.\n\nThe invoked program creates a socket connection to the host hxxp://93.104.208.17:5156/socket.io\nand creates the registry key HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run “Audio\nPlayer” with the command C:\\Users\\USERNAME\\Music\\Audio.exe and copies itself to the commands\nlocation. If the file C:\\Users\\USERNAME\\AppData\\Roaming\\Process Handler\\Handler.exe exists, it\nchecks if the directory C:\\Users\\USERNAME\\AppData\\Roaming\\Process Handler exists. If the\ndirectory doesn’t exist, it will be created. Furthermore, an autostart key with the value “Handler” to\nthe above executable path is created. It then downloads the file\n_hxxp://93.104.208.17:5156/uploads/excutbls/h/Bkdr.exe and saves it to the location above._\n\n[It also downloads and executes the file http://93.104.208.17:5156/uploads/excutbls/h/Cntrl.exe. The](http://93.104.208.17:5156/uploads/excutbls/h/Cntrl.exe)\nCntrl.exe[8] downloads Player.exe(SocketPlayer)[9], decrypts it[10] and runs the file in memory.\n\n### 9. Bkdr.exe\n\nThe file Bkdr.exe[11] (possibly means backdoor.exe) just downloads the file\nhxxp://93.104.208.17:5156/uploads/excutbls/h/MAudio.exe[12], saves the file to the temporary\ndirectory and executes it. The executed file downloads the file\nhxxp://93.104.208.17:5156/uploads/excutbls/h/Audio.exe(Unfortunately no hash available at this\npoint), decrypts it with the hardcoded key “!##&aAwPs1337” and invokes it in memory. The\ninvoked file is similar to variant 2 of the SocketPlayer downloader.\n\n### 10. Changes to SocketPlayer\n\nAt the beginning of this report we had looked at the commands of the file[1]. With the latest\nsample[10] some things changed which are listed below.\n\n  - The c2 port has changed from 3000 to 7218\n\n  - The file location changed from C:\\Users\\USERNAME\\Music\\Player\\Player.exe to\nC:\\Users\\USERNAME\\Music\\Media Player\\Player.exe\n\n\n-----\n\n**G Data Whitepaper 2018 – paper 3: Description for SocketPlayer**\n\n  - The information that is sent in the initial routine changed a bit. In the old version[1] the\nauthor sends the string “,1.1,1” to the c2. In the new version the program sends “,1.2,1”,\ntelling the c2 that the new version runs on the machine.\n\n  - To the commands Fdrive,fdir,smfdir,procs,prockil,gtscreen and kylgs the variable susrid is\nadded to be sent to the server. This is done to identify the infected systems better.\n\n  - The functionality stscrnpercnt is added. This feature assists the gtscreen function to set the\nquality of the image.\n\n  - The gtscreen function additionally to the susrid also sends the computer name with the\npicture.\n\n  - The storage location of upldex is changed to\n_C:\\Users\\User\\AppData\\Roaming\\Microsoft\\Windows\\Templates. An autostart key to the_\nregistry is added. The downloaded file is also executed.\n\n  - The kylgs function also switched to use the above path to read the file klsetup.txt.\n\n  - The destt function additionally checks if the following path and files are available. If so, it\ndeletes them. C:\\Users\\USERNAME\\AppData\\Roaming\\Process Handler\n_C:\\Users\\USERNAME\\AppData\\Roaming\\Process Handler\\Handler.exe,_\nC:\\Users\\User\\AppData\\Roaming\\Microsoft\\Windows\\Templates\\Image.exe and\nC:\\Users\\User\\AppData\\Roaming\\Microsoft\\Windows\\Templates\\Media.exe.\n\n### 11. Spreading\n\n[It appears that the website https://bsf.[gov].in which is the border security force of India has been](https://bsf.[gov].in/)\nused to spread malware including SocketPlayer downloader as you can see from figure 2 Below.\nCurrently the website does not seem to spread malware again.\n\n_Figure 2. Virustotal URL detection_\n\n### 12. File hashes and resources\n\n[1] de38e74b2cd493d0f014fc6ca5d2834cea213778c2e056a7c84e9547fe275889\n\n[2] 0136b20b48cb3178fad12c1bd8d5d2779f3932f2c98de09e08eeddb3a84b4176\n\n[3] 1cf67c25274473724a6cf614d45217edc16edbccebb3fa212f7b17e127362ea7\n\n[4] 8b158aaf7215aea9766843219c2749d7ecb44986262107b38e234756738b3e7c\n\n[5] 1fd13875bf3df273acc893c6a0fe0144a05d5534624471baaa48f014757301ef\n\n\n-----\n\n**G Data Whitepaper 2018 – paper 3: Description for SocketPlayer**\n\n[6] c446cd91b2f5e0ca77716ec361e75da03c8d4c1cbf4d83fe927ec04bb1c78a83\n\n[7] 8c7f9824580ea6c2286604c2677e1d27b95c4b3f9b2151b17a463f94bb68aa66\n\n[8] d38292508697e7cd8b38d8e0d159e6e67e7191305f883aec94aeb95887748b2f\n\n[9] ac1d717e345a831766f7d00c22db54121c502c9de5723bcc95bff8bb040157c8\n\n[10] 3d0e90b82c57abfb22ed76c020ab34449efbcfb1c3e20ae2a3874a4ab2cc1743\n\n[11] 4f21bb54b372a932fa3d13c9dcfaee06fc7e691a9dd86af3a4e47d6d003e020f\n\n[12] ace5a17702239cebf4ebc9ae034f3b2878e471978b895d3f461ef38fce7b1a40\n\nIf you want to stay updated about malware, be sure to follow these accounts:\n\n[RansomBleed - My personal twitter account about the latest malware reports.](https://twitter.com/RansomBleed)\n\n[GDataSoftwareAG – G DATAs twitter company account.](https://twitter.com/GDataSoftwareAG)\n\n[Blog – The G DATA blog about all kinds of security-related news.](https://www.gdata.de/blog/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        }
    ],
    "references": [
        "https://file.gdatasoftware.com/web/en/documents/whitepaper/G_DATA_SocketPlayer_Analysis.pdf"
    ],
    "report_names": [
        "G_DATA_SocketPlayer_Analysis.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716492,
    "ts_updated_at": 1743041170,
    "ts_creation_date": 1527072417,
    "ts_modification_date": 1527072417,
    "files": {
        "pdf": "https://archive.orkl.eu/c5a4051be573ef0482b7fb01dc3697847489b882.pdf",
        "text": "https://archive.orkl.eu/c5a4051be573ef0482b7fb01dc3697847489b882.txt",
        "img": "https://archive.orkl.eu/c5a4051be573ef0482b7fb01dc3697847489b882.jpg"
    }
}