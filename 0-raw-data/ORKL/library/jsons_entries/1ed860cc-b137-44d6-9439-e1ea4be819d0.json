{
    "id": "1ed860cc-b137-44d6-9439-e1ea4be819d0",
    "created_at": "2023-01-12T15:02:22.028971Z",
    "updated_at": "2025-03-27T02:06:10.97444Z",
    "deleted_at": null,
    "sha1_hash": "627d8e57244a30fb4ccffffc4bf09f271e51315b",
    "title": "2018-06-05 - The Evolution of GandCrab Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-27T21:39:57Z",
    "file_modification_date": "2022-05-27T21:39:57Z",
    "file_size": 4414885,
    "plain_text": "# The Evolution of GandCrab Ransomware\n\n**[vmray.com/cyber-security-blog/gandcrab-ransomware-evolution-analysis/](http://www.vmray.com/cyber-security-blog/gandcrab-ransomware-evolution-analysis/)**\n\n_[Editor‚Äôs Note: This post was updated on July 9th, 2018 with analysis of Gandcrab v4]_\n\nLike legitimate commercial software, commercial malware also needs a viable business\nmodel. For ransomware, the most popular business model is now Ransomware-as-a-Service\n(RaaS). RaaS focuses on selling ransomware as an easy-to-use service, opening up a\nbroader market of non-technical attackers. Many ransomware developers now focus on\ndeveloping and maintaining a service which allows their affiliates (customers) to start attacks\nwith just a few clicks.\n\nIn the past few months, the RaaS-space was dominated by a relatively new malware family:\nGandCrab.\n\n## Gandcrab‚Äôs Distribution Methods\n\nWe‚Äôve seen Gandcrab being distributed using two primary methods:\n\nJavascript and Doc downloaders attached to e-mails\nDrive-by download using exploit kits\n\n### Javascript Droppers\n\n**Javascript Dropper #1**\n\n[View the VMRay Analyzer Report](https://www.vmray.com/analyses/javascript-dropper-gandcrab-analysis-1/report/overview.html)\n\n\n-----\n\nA common distribution method is zipped Javascript droppers attached to emails.\n\nAfter deobfuscating itself the javascript executes a Powershell one-liner to download and\nexecute a file, Gandcrab v2 (internal version 1.2.0).\n\nDropper: `b4b6f6c2588001e5b95eed79faf99a92b9d9224f65af6a92e055ddfb145a1ecc`\n\nDropped Gandcrab v1.2.0:\n\n```\n063cf82cd52acb6a0539a6ff59f72fb5de473293a06c470a92c6d35a151b73e9\n\n```\n\nUnpacked DLL:\n\n```\ned8875c88bf061f45601629fbb3faa9f5b9ea4a076ba5a7accd566dc40862072\n\n```\n\n### Javascript Dropper #2\n\n[View the VMRay Analyzer Report](https://www.vmray.com/analyses/javascript-dropper-gandcrab-analysis-2/report/overview.html)\n\nJavascript Dropper #2 doesn‚Äôt use PowerShell. Instead, it downloads the file and executes it\ndirectly. The payload is Gandcrab v3 (internal version 3.3.0).\n\nDropper: `e7851a1b3e93968e7f6b92a1a3f59d250402be15a5bcb3262acff1e0a27b912c`\n\nDropped Gandcrab v3.0.0:\n\n```\n6a8d922e34de35ac074b7de54d71227fb1a1ed92b9cfbc4daf8d64a9c5bc46b8\n\n```\n\nUnpacked DLL:\n\n```\n67c50459db7f0042d7e1a96ce113e60f0179978dfe810bdb0f5320a092ce3b71\n\n```\n\n### Doc Droppers\n\n**Doc Dropper**\n\n[View the VMRay Analyzer Report](https://www.vmray.com/analyses/doc-dropper-gandcrab-analysis/report/overview.html)\n\n\n-----\n\nDoc Droppers use the same logic as the Javascript Droppers, but implemented in VBA. This\nsample contains an 800 line VBA script like this snippet:\n\nThe end result is another PowerShell one-liner, which downloads an EXE to a temporary\ndirectory, and executes it.\n\nDropper: `99eb1d90eb5f0d012f35fcc2a7dedd2229312794354843637ebb7f40b74d0809`\nDropped Gandcrab v2.3.1:\n```\n846ad2d7e1e133ae4bc2decbc22ae686a44cccaffbee15b4d9b23143f6aa8d3f\n\n```\nUnpacked DLL:\n\n```\nf93379f495ce3c025b8f2ad59779d2de28f00a25b6206572522a71028f925f01\n\n```\n\n**Encrypted Doc Dropper**\n[View the VMRay Analyzer Report](http://www.vmray.com/analyses/encrypted-doc-gandcrab-3-0-1-analysis/report/overview.html)\nA more recent spam campaign used encrypted doc files, with the emails containing the\npassword to open the doc: 123123. This dropper executed the sample (Gandcrab v3.0.1)\ndirectly with VBA, without Powershell.\n\n\n-----\n\nE-mail: `b4d0b03ca50f013b4f0f9efc2ecd822bfc13325356100f2f4d36eaf217d9077b`\nDropper: `be54bb05adbda29316ba03d61b3365d8a03e1121a39ae492078787aff4f1248f`\nDropped Gandcrab v3.0.1:\n```\n589e188602c4a24c68bc095c1105894a5e97e1df6218eaead89b7ab9a4e88eac\n\n```\nUnpacked DLL:\n\n```\n229275aa89ea8d39b3cc721d45d51d50707339b64afddde99119ebdf50ef6770\n\n```\n\n### Exploit Kits\n\nAttackers also used multiple exploit kits: Grandsoft, RIG and Magnitude.\n\nUsing a browser exploit kit is a tradeoff from the attacker‚Äôs point-of-view. If the victim has an\nunpatched version of browser or flash player, they only need to click a link to get infected. It\nis much easier for the attacker to get someone to click a link than to get them to download\nand execute a file ‚Äî but the attack won‚Äôt work if the potential victim has even roughly up-todate software.\n\n### RIG EK\n\n[View the VMRay Analyzer Report](https://www.vmray.com/analyses/rig-exploit-kit-gandcrab-3-0-1-analysis/report/overview.html)\n\nRIG is a popular exploit kit, which has recently been updated with a newer Flash exploit\n[(CVE-2018-4878). It used the new exploit for dropping Gandcrab, observed on April 9 by](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-4878)\n[@nao_sec.](https://twitter.com/nao_sec)\n\n\n-----\n\nAs visible on the sandbox report and the packet capture, this attack vector exploited Adobe\nFlash Player, downloaded and executed Gandcrab v3.0.1.\n\nRIG used the Flash exploit for CVE-2018-4878. This happened before a new exploit for an\nInternet Explorer vulnerability (CVE-2018-8174) was implemented in RIG.\n\nCVE-2018-4878 is also a relatively new vulnerability ‚Äì on February 1st Adobe released a\nbulletin, informing users that a Flash player zero-day is being used in the wild, and followed\nup with a patch on February 6th. The exploit uses a use-after-free bug in Flash Player‚Äôs DRM\nimplementation. The downloaded SWF file is partly obfuscated, but it contains some debug\nsymbols, making some key parts of the exploit easy to spot, like the class `UAFGenerator .`\n\n\n-----\n\nThe payload of the exploit is visible in the sandbox report ‚Äì cmd.exe is called to drop and\nexecute a javascript downloader.\n\nEven after a little bit of deobfuscation, the downloader activity becomes clear:\n\n\n-----\n\nThe downloaded file is dropped in the %TEMP% directory with the name b**.exe, where ** is\na number in the [0, 56] range. At the end the dropper executes the downloaded Gandcrab\nv3.0.1 payload.\n\nExploit (swf):\n\n```\nad5dbe133677c987f95fc890ab37a48d9d2f9324a53356affd078e26d3cbb8fc\n\n```\n\nDownloader (js):\n\n```\n7fab866ce5474e690a06ca556c76e63a3c3c184ae493fce03bb2a839ef7ef725\n\n```\n\nDropped GandCrab v3.0.1:\n\n```\nc0db3c329592294a81f23c37e701a189110913c17d1371bc625a3eae97f37a94\n\n```\n\nUnpacked DLL:\n\n```\n243cafdc3582a750537fb7a4ba4e9640f4142f385478c106514bae0d736f462e\n\n```\n\n### Grandsoft EK\n\n[View the VMRay Analyzer Report](https://www.vmray.com/analyses/grandsoft-exploit-kit-gandcrab-analysis/report/overview.html)\n\nGrandsoft is an exploit kit which is used far less frequently, it made a comeback with\ndropping GandCrab, spotted on January 30 by\n\n[@kafeine.](https://twitter.com/kafeine)\n\n\n-----\n\n[Hello again GrandSoft EK. Dropping ‚Ä¶ GandCrab pic.twitter.com/yfjzju16KG](https://t.co/yfjzju16KG)\n\n[‚Äî Kafeine (@kafeine) 30 January 2018](https://twitter.com/kafeine/status/958298409944920064?ref_src=twsrc%5Etfw)\n\nThe attack is visible in the VMRay Analyzer Report:\n\nFor an old Internet Explorer version, the exploit kit served CVE-2016-0189, an exploit of a\nmemory corruption vulnerability in Internet Explorer‚Äôs vbscript.dll. This is an old vulnerability,\npatched in May 2016, which allows running arbitrary vbscript code on unpatched systems.\n\nThe VBS exploit code is obfuscated, but still readable. The downloader is in the fire()\nfunction. It first downloads the file (See Figure below):\n\nIt then executes the downloaded file, depending on its extension:\n\n\n-----\n\nThe full control flow shows the exploited Internet Explorer process downloaded an exe file\n(Gandcrab v2.1, internal version 3.0.0), and executed it with cmd.exe. The Process Graph\nshows the Gandcrab packer injected its DLL payload into svchost.exe.\n\nExploit: `a67a98047097f2249eba7a31138efde45f3c02a3f7f46d3a9de85d630da7cd94`\n\nDropped file:\n```\n6fafe7bb56fd2696f2243fc305fe0c38f550dffcfc5fca04f70398880570ffff\n\n```\nInjected dll: `469961813372d2a3645cf9927c983f5d661e2a60589425d9259e7658de63a181`\n\n### Packer\n\nGandcrab uses its own packer, which has only changed a little through all the versions.\n\n**Sandbox Evasion: API hammering**\n\nEven the first versions of Gandcrab used API hammering, a very simple sandbox evasion\ntechnique. The technique calls an API function in a loop, hoping the analysis will time out\nbefore reaching any malicious behavior. This can be effective against sandboxes which\nhandle the loop slowly ‚Äì the slower a sandbox is, the more dramatic are the effects of API\nhammering.\n\nGandcrab‚Äôs packer often mixes the technique with one of the two following techniques:\n\n\n-----\n\n1. Doing something in the loop that s necessary for the execution to continue. This\n\nensures that the loop can‚Äôt simply be detected as unnecessary and skipped\nautomatically.\n2. Loop cycles where no APIs are called.\n\nEach version of the Gandcrab packer uses different API functions, and iteration numbers, but\nthe principle is the same.\n\nIn this v1.0 sample the loop is repeated 200 million times, but only one of its iterations is\nuseful:\n\n_Sample_\n_SHA256: 69f55139df165bea1fcada0b0174d01240bc40bc21aac4b42992f2e0a0c2ea1d_\n\nIn this v3.0.0 sample the loop gets the temp path and allocates memory, but takes 5 million\nloops to do it:\n\n\n-----\n\n_Sample_\n_SHA256: 6a8d922e34de35ac074b7de54d71227fb1a1ed92b9cfbc4daf8d64a9c5bc46b8_\n\n### Reflective Loader\n\nGandcrab v2‚Äôs (internal version v.1.0.0r), main functionality is moved to a DLL. The DLL‚Äôs\nname is ‚Äúencryption.dll‚Äù, and only exports the entry point, and a function named\nReflectiveLoader()\n\n.\n\nThe packer calls the ReflectiveLoader function, loads the DLL and starts the malicious\nactivity which is in DLLMain.\n\nThe DLL is loaded in the same process for most samples, but with Gandcrab 3.0.0 it was\nobserved injecting the DLL into a newly spawned svchost process.\n\n\n-----\n\n_Sample SHA256: 6fafe7bb56fd2696f2243fc305fe0c38f550dffcfc5fca04f70398880570ffff_\n\n### String Obfuscation Method\n\nThe packer and the payload use the same method to obfuscate strings used as API\nparameters for many calls: simply moving them to the stack in 4-byte blocks before the\ncalling a function which uses them as a parameter. [@hasherezade made a deobfuscator IDA](https://twitter.com/hasherezade?ref_src=twsrc%5Etfw&ref_url=https%3A%2F%2Ftwitter.com%2Fhasherezade%2Fstatus%2F985999130559381507)\nplugin for this technique.\n\n[#GandCrab string deobfuscator (a script for](https://twitter.com/hashtag/GandCrab?src=hash&ref_src=twsrc%5Etfw) [#IDA):](https://twitter.com/hashtag/IDA?src=hash&ref_src=twsrc%5Etfw) [https://t.co/jzLl1SOLSR](https://t.co/jzLl1SOLSR)\n[pic.twitter.com/A5tk3uKnch](https://t.co/A5tk3uKnch)\n\n[‚Äî hasherezade (@hasherezade) 16 April 2018](https://twitter.com/hasherezade/status/985999130559381507?ref_src=twsrc%5Etfw)\n\nFunction resolution within the packer.\n\nObfuscated string in the payload.\n\n\n-----\n\n### Easter Eggs for Researchers\n\nThe packer and payload also contain messages to researchers who made a public impact on\nGandcrab, or ransomware in general.\n\n[If a file exists in the C:\\MalwarebytesLabs directory, a message to Marcelo Rivero pops up.](https://twitter.com/MarceloRivero)\n\nHello, [#GandCrab](https://twitter.com/hashtag/GandCrab?src=hash&ref_src=twsrc%5Etfw) üôÇ [pic.twitter.com/ICHixxoIkI](https://t.co/ICHixxoIkI)\n\n[‚Äî Marcelo Rivero (@MarceloRivero) 17 April 2018](https://twitter.com/MarceloRivero/status/986045072272691201?ref_src=twsrc%5Etfw)\n\nFabian Wosar‚Äôs name is used as a placeholder string multiple times per sample.\n\nCommunication with the C&C is encrypted with a hardcoded key. Since the release of\nGandcrab v2, this key is computed using the string ‚Äúeuropol‚Äù ‚Äì the name of the agency partly\nresponsible for creating a decryptor for v1.\n\n\n-----\n\n### Gandcrab v4 Packer\n\nVersion 4.0 of Gandcrab rewrites large parts of the ransomware with many previously\nimplemented features missing. The removed features include parts of the packer.\n\nThe packer doesn‚Äôt use the reflective DLL loading method anymore, and reverts to simply\nreplacing parts of its own process in memory.\n\nBesides the removal of the DLL loading technique, a new obfuscation technique was added\nto the beginning of the packer. The technique starts by moving the obfuscated code to the\nstack in 4-byte blocks, like the string obfuscation method from previous versions. After this,\nthe packer proceeds to use subtractions and additions to deobfuscate the code on the stack.\n\n\n-----\n\nThe first samples of v4.1 we‚Äôve seen were unpacked, but later samples were packed with the\nsame packer as v4.0.\n\n### Gandcrab Payload History\n\n**Gandcrab v1**\n\nThe GandCrab payload exhibits stereotypical ransomware behavior: it encrypts user files\nwith a key unique to the victim, and drops ransom notes with instructions to pay the ransom\nin exchange for the key.\n\nGandcrab was first publicly discovered by security researcher David Montenegro in late\nJanuary 2018. In one month the family had over 50,000 victims. Unusually, the ransom\nneeded to be payed in the crypto-currency DASH, now they also accept bitcoin. We\n[analyzed GandCrab v1 in our January Malware Analysis recap blog.](https://www.vmray.com/blog/vmray-malware-analysis-report-recap-january-2018/)\n\nAt the end of February, a decryptor was published for GandCrab v1 in a joint effort by the\nRomanian Police (IGPR), Bitdefender and Europol.\n\n**Gandcrab v2**\n\n\n-----\n\nOn March 5th, just a week after the decryptor was released, a new Gandcrab version was\nspotted by [@MalwareHunterTeam. The decryptor from the previous week doesn‚Äôt work with](https://twitter.com/malwrhunterteam)\nthe newer version. It also uses a new extension (.CRAB), has different hardcoded domains,\nand moves the code to a DLL. It also looks for kernel-mode components of Antivirus\nsoftware.\n\n[GandCrab2 (‚Äúversion=1.0.0r‚Äù) sample: https://t.co/et7XM5DuzK](https://t.co/et7XM5DuzK)\n[If someone didn‚Äôt understand the previous thread (https://t.co/8iuXk9Phwa), these are](https://t.co/8iuXk9Phwa)\n[from this.@BleepinComputer](https://twitter.com/BleepinComputer?ref_src=twsrc%5Etfw) [@demonslay335](https://twitter.com/demonslay335?ref_src=twsrc%5Etfw)\ncc [@MarceloRivero](https://twitter.com/MarceloRivero?ref_src=twsrc%5Etfw)\n\n[‚Äî MalwareHunterTeam (@malwrhunterteam) 5 March 2018](https://twitter.com/malwrhunterteam/status/970757444241707008?ref_src=twsrc%5Etfw)\n\n**Internal Version and Ransom Note**\nGandcrab‚Äôs ransom notes contain a version number, and the payload contains another,\n‚Äúinternal‚Äù version number, which is sent over the network when connecting to the C&C. Most\noften these two version numbers don‚Äôt match (see example below where the ransom note\nindicates version 2.1).\n\n_Sample SHA256:_\n_846ad2d7e1e133ae4bc2decbc22ae686a44cccaffbee15b4d9b23143f6aa8d3f)._\n\nInternal version number reported to the C&C for the same sample is 2.3.2.\n\n**Gandcrab v3**\n\n[A Gandcrab sample with internal version 3.0.0 was spotted on Apr 23 by @nao_sec, later](https://twitter.com/nao_sec/status/988451194573017088?ref_src=twsrc%5Etfw)\n[followed by v3.0.1 first published by @zsawei on May 9th. Version 3.0.0 added support for](https://twitter.com/zsawei/status/994454718406578176)\nchanging the wallpaper.\n\n\n-----\n\n**Discrepancies Between v3.0.0 Samples**\n\nIt was observed that two samples with the same internal version number (3.0.0) had different\n[capabilities: one of the samples injects its payload into a new svchost process while another](https://www.vmray.com/analyses/grandsoft-exploit-kit-gandcrab-analysis/report/overview.html)\none doesn‚Äôt start a new process, but can now change the wallpaper.\n\n**Gandcrab v3.0.1**\n\n[View the VMRay Analyzer Report](https://www.vmray.com/analyses/gandcrab-ransomware-3-0-1-analysis/report/overview.html)\n\nPacked sample:\n\n```\n8a1e66b4834499dacc24abb27733c387733d919070fc504b14ee865678952559\n\n```\n\nUnpacked DLL:\n\n```\ne9bfa9691b48a75fa917a37290cb32b02ded3ae60dab4bcd625e8f390fd345a1\n\n```\n\nUsually the single difference between v3.0.0 payloads and v3.0.1 payloads is the user agent,\nand everything else is the same.\n\n\n-----\n\nOld User Agent: `Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36`\n```\n(KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36\n\n```\nThe new User Agent: `Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0)`\n```\nlike Gecko\n\n```\nEverything else is the same.\n\n\n-----\n\n**Discrepancies Between v3.0.1 Samples**\n\n[The sample discovered by @zsawei was very different ‚Äî it was compiled without certain](https://twitter.com/zsawei/status/994454718406578176)\nfunctions, which have been there in previous versions: wallpaper changing, autorun, search\nfor kernel-mode antivirus.\n\nMissing functions:\n\n\n-----\n\nPacked sample:\n```\n5ab28933afa89bd0924ed45538b753cd260d0a6cec76eeca30d040476cf6d363\n\n```\nUnpacked DLL:\n\n\n-----\n\n```\n03b73dfe73dc7f9191e0c3a34801dd0e906b3ba8c77de76681a23a7c34cb5133\n\n```\n**Gandcrab v4**\n\n[Gandcrab Version 4.0 appeared in the wild on July 1st, 2018. On July 5th, we found an](https://www.vmray.com/analyses/gandcrab-ransomware-4-0-analysis/report/overview.html)\nupdated v4.1 version.\n\n[[#Malware Analysis] New](https://twitter.com/hashtag/Malware?src=hash&ref_src=twsrc%5Etfw) [#Gandcrab sample, internal version 4.1 contacts 36 hosts](https://twitter.com/hashtag/Gandcrab?src=hash&ref_src=twsrc%5Etfw)\n[https://t.co/SmYaMz4h7W](https://t.co/SmYaMz4h7W) [pic.twitter.com/MTPIBF0rsL](https://t.co/MTPIBF0rsL)\n\n‚Äî VMRay (@vmray) [5 July 2018](https://twitter.com/vmray/status/1014872871531962369?ref_src=twsrc%5Etfw)\n\nGandcrab v4 has brought many changes from previous versions including modifications\nreplacing most of the code and a focus on quickly encrypting, then disappearing from the\nsystem. Below are the changes in v4 from previous versions.\n\nThe new extension of encrypted files is KRAB, and the ransom note is named KRABDECRYPT.txt\nThe ransom note contains a private and a public key.\nThe keys are also written to the registry in\n‚ÄúHKEY_CURRENT_USER\\SOFTWARE\\keys_data\\data‚Äù\nA new encryption algorithm is used.\nThe ransomware now also looks for network shares in a separate thread.\nHidden .lock files are dropped into the folders before encrypting contents of the folder\n\nGandcrab v4.0 doesn‚Äôt connect a C&C. The ransomware still collects the same data it\ndid on previous versions, (except for the external IP address), and it also creates the\nstring which it would upload to the server, it just doesn‚Äôt send it.\nIn v4.1 the C&C connection is back, and it has a URL generation algorithm, replacing\nthe hardcoded URLs seen in v3\n\n\n-----\n\n-----\n\n-----\n\nThe encryption happens on a different thread than the C&C communication, and the\nfiles are encrypted even if the C&C could not be connected.\nGandcrab removes itself after it‚Äôs done.\n\nRemoved Features:\n\nThere is no autorun. Gandcrab runs once, then deletes itself.\nThe wallpaper isn‚Äôt changed\nThe mutex is not created\nNo kernel-mode AV checking\nDoesn‚Äôt query the machine‚Äôs public IP address from\nipv4bot.whatismyipaddress.com\n\n### Payload Control Flow\n\nMost of Gandcrab‚Äôs activity is constant through the versions. The screenshots below show\nGandcrab v3‚Äôs control flow:\n\n**Data collection and preparation**\n\nGandcrab first collects data about the system and generates private and public keys.\n\n**Domain**\n\nQueries the domain the system belongs to.\n\n**Processor Name**\n\nQueries the processor name and type.\n\n\n-----\n\n**Mutex**\n\nGenerates the ransom ID and creates a mutex. This step is skipped in Gandcrab v4.\n\n**Kernel-Mode AV**\n\nIn v2 and v3, Gandcrab starts a thread to look for kernel-mode antivirus components.\n\nList of detected kernel-mode AV-components:\n\nklif.sys (Kaspersky)\nkl1.sys (Kaspersky)\nfsdfw.sys (F-Secure)\nsrtsp.sys (Symantec)\nsrtsp64.sys (Symantec)\nNavEx15.sys (Symantec)\nNavEng.sys (Symantec)\n\n\n-----\n\n**Closing Processes**\nSamples contain a list of hardcoded process names, which are terminated before encryption\nstarts. Otherwise the processes could have open handles to important files, and the\nransomware wouldn‚Äôt be able to encrypt them.\n\nList of closed processes, constant through versions:\n\nmsftesql.exe\nsqlagent.exe\nsqlbrowser.exe\nsqlservr exe\n\n\n-----\n\nsqlwriter.exe\noracle.exe\nocssd.exe\ndbsnmp.exe\nsynctime.exe\nmydesktopqos.exe\nagntsvc.exeisqlplussvc.exe\nxfssvccon.exe\nmydesktopservice.exe\nocautoupds.exe\nagntsvc.exeagntsvc.exe\nagntsvc.exeencsvc.exe\nfirefoxconfig.exe\ntbirdconfig.exe\nocomm.exe\nmysqld.exe\nmysqld-nt.exe\nmysqld-opt.exe\ndbeng50.exe\nsqbcoreservice.exe\nexcel.exe\ninfopath.exe\nmsaccess.exe\nmspub.exe\nonenote.exe\noutlook.exe\npowerpnt.exe\nsteam.exe\nsqlservr.exe\nthebat.exe\nthebat64.exe\nthunderbird.exe\nvisio.exe\nwinword.exe\nwordpad.exe\n\n**Autorun**\nIn v2 and v3, Gandcrab adds itself to autorun via a registry key.\n\n\n-----\n\n**Key Generation**\nA private and public key is generated.\n\n**Keyboard Layout**\n\nThe sample queries the keyboard layout, but only stores if it is Russian or not.\n\n**Windows Product Name**\n\nQueries the Windows product name.\n\n**Processor Architecture:**\n\nQueries processor architecture.\n\n**Collects Running Antivirus Processes:**\n\nCompares running processes with a hardcoded list of antivirus process names.\n\nList of detected antivirus processes, constant through all versions:\n\nAVP.EXE\nekrn.exe\navgnt.exe\n\n\n-----\n\nashDisp.exe\nNortonAntiBot.exe\nMcshield.exe\navengine.exe\ncmdagent.exe\nsmc.exe\npersfw.exe\npccpfw.exe\nfsguiexe.exe\ncfp.exe\nmsmpeng.exe\n\n**Iterate Through all Drives**\nThe malware iterates through all letters, to check which drives exist.\n\nIf the drive exists, it queries and stores free and used disk space.\n\n**IP Address**\n\nThe malware uses whatismyipaddress.com to query the machine‚Äôs IP before v4.\n\n\n-----\n\n**C&C Check-ins**\nBefore v4 the samples have their C&C server names hardcoded, and use the `.bit`\nTLD. Since .bit addresses cannot be resolved by most DNS servers, Gandcrab uses\nnslookup to resolve the IP addresses. The hardcoded C&C servers and DNS names change\nfrom version-to-version.\n\nIn v4.0 there is no C&C communication at all, and in v4.1 the URLs are generated by the\nmalware, instead of being completely hardcoded.\n\nThe data collected in the previous steps is encrypted with a hardcoded key, and then POSTed to the C&C server. The sent data also contains the internal version of the ransomware.\n\nThe server responds, and encryption starts. After the encryption the sample does another\ncheck-in to notify the C&C about the successful encryption.\n\n**Encryption**\n\nA new thread iterates the drive using FindFirstFile ‚Äì FindNextFile and encrypts the files\nwhich have the right extension.\n\n\n-----\n\n**Shadow Copy Removal**\n\nAfter encryption, the sample removes shadow copies, using wmic on Vista and later, and\nvssadmin on XP and earlier.\n\n\n-----\n\n**Wallpaper**\n\nWallpaper changing was a new feature in v3, which was later removed in v4.\n\n\n-----\n\nThe wallpaper is not hardcoded inside the sample, it‚Äôs drawn at runtime using the DrawText\nfunction.\n\nThe wallpaper file is dropped in the temp folder, and the wallpaper is then changed with\nSystemParametersInfo.\n\n**Reboot**\n\nFinally, the sample sets a reboot in 60 seconds and opens the download page for the Tor\nbrowser.\n\nThe reboot and browser opening is removed from Gandcrab v4. Since v4, the malware\ninstead removes itself after it‚Äôs done.\n\n\n-----\n\n## Conclusion\n\nAlthough GandCrab is not a sophisticated piece of malware, it is used in widespread and\nfrequent campaigns via different distribution methods. The family reacts quickly to changes\nlike the decryptor for the v1 version, and adds new features often, making it one of the most\nprevalent malware families in 2018.\n\n### Samples\n\n**Gandcrab v1.0**\n\n[January Malware Analysis recap blog](https://www.vmray.com/blog/vmray-malware-analysis-report-recap-january-2018/)\n\nGandcrab sample:\n69f55139df165bea1fcada0b0174d01240bc40bc21aac4b42992f2e0a0c2ea1d\n\nUnpacked: 0c0def0788b5f946bb2d1a83d883d474550353c98eaffb4456d651cb4bcc3bd9\n\n**JS dropping v1.2.0**\n\n[VMRay Analyzer Report](https://www.vmray.com/analyses/javascript-dropper-gandcrab-analysis-1/report/overview.html)\n\nDropper: b4b6f6c2588001e5b95eed79faf99a92b9d9224f65af6a92e055ddfb145a1ecc\n\nDropped Gandcrab sample:\n063cf82cd52acb6a0539a6ff59f72fb5de473293a06c470a92c6d35a151b73e9\n\nUnpacked DLL: ed8875c88bf061f45601629fbb3faa9f5b9ea4a076ba5a7accd566dc40862072\n\n**DOC dropping v2.3.1**\n\n[VMRay Analyzer Report](https://www.vmray.com/analyses/doc-dropper-gandcrab-analysis/report/overview.html)\n\nDropper: 99eb1d90eb5f0d012f35fcc2a7dedd2229312794354843637ebb7f40b74d0809\n\nDropped Gandcrab sample:\n846ad2d7e1e133ae4bc2decbc22ae686a44cccaffbee15b4d9b23143f6aa8d3f\n\nUnpacked DLL: f93379f495ce3c025b8f2ad59779d2de28f00a25b6206572522a71028f925f01\n\n**JS dropping v3.0.0**\n\n[VMRay Analyzer Report](https://www.vmray.com/analyses/javascript-dropper-gandcrab-analysis-2/report/overview.html)\n\nDropper: e7851a1b3e93968e7f6b92a1a3f59d250402be15a5bcb3262acff1e0a27b912c\n\nDropped Gandcrab sample:\n6a8d922e34de35ac074b7de54d71227fb1a1ed92b9cfbc4daf8d64a9c5bc46b8\n\nUnpacked DLL:\n67c50459db7f0042d7e1a96ce113e60f0179978dfe810bdb0f5320a092ce3b71\n\n**Grandsoft EK dropping v3.0.0**\n\n[VMRay Analyzer Report](https://www.vmray.com/analyses/grandsoft-exploit-kit-gandcrab-analysis/report/overview.html)\n\nExploit: a67a98047097f2249eba7a31138efde45f3c02a3f7f46d3a9de85d630da7cd94\n\nDropped Gandcrab sample:\n6fafe7bb56fd2696f2243fc305fe0c38f550dffcfc5fca04f70398880570ffff\n\n\n-----\n\nInjected DLL: 469961813372d2a3645cf9927c983f5d661e2a60589425d9259e7658de63a181\n**RIG EK dropping v3.0.1**\n[VMRay Analyzer Report](https://www.vmray.com/analyses/rig-exploit-kit-gandcrab-3-0-1-analysis/report/overview.html)\nExploit (swf): ad5dbe133677c987f95fc890ab37a48d9d2f9324a53356affd078e26d3cbb8fc\nDownloader (js):\n7fab866ce5474e690a06ca556c76e63a3c3c184ae493fce03bb2a839ef7ef725\nDropped Gandcrab sample:\nc0db3c329592294a81f23c37e701a189110913c17d1371bc625a3eae97f37a94\nUnpacked DLL:\n243cafdc3582a750537fb7a4ba4e9640f4142f385478c106514bae0d736f462e\n**Regular Gandcrab v3.0.1 payload**\n[VMRay Analyzer Report](https://www.vmray.com/analyses/gandcrab-ransomware-3-0-1-analysis/report/overview.html)\nGandcrab sample:\n8a1e66b4834499dacc24abb27733c387733d919070fc504b14ee865678952559\nUnpacked DLL:\ne9bfa9691b48a75fa917a37290cb32b02ded3ae60dab4bcd625e8f390fd345a1\n**Gandcrab v3.0.1 payload with missing features**\n[VMRay Analyzer Report](https://www.vmray.com/analyses/gandcrab-3-0-1-payload-missing-features-analysis/report/overview.html)\nGandcrab sample:\n5ab28933afa89bd0924ed45538b753cd260d0a6cec76eeca30d040476cf6d363\nUnpacked DLL:\n03b73dfe73dc7f9191e0c3a34801dd0e906b3ba8c77de76681a23a7c34cb5133\n**Encrypted doc dropping Gandcrab v3.0.1**\n[VMRay Analyzer Report](https://www.vmray.com/analyses/encrypted-doc-gandcrab-3-0-1-analysis/report/overview.html)\nE-mail: b4d0b03ca50f013b4f0f9efc2ecd822bfc13325356100f2f4d36eaf217d9077b\nDropper (password 123123):\nbe54bb05adbda29316ba03d61b3365d8a03e1121a39ae492078787aff4f1248f\nGandcrab sample:\n589e188602c4a24c68bc095c1105894a5e97e1df6218eaead89b7ab9a4e88eac\nUnpacked DLL:\n229275aa89ea8d39b3cc721d45d51d50707339b64afddde99119ebdf50ef6770\n**Gandcrab v4.0**\n[VMRay Analyzer Report](https://www.vmray.com/analyses/gandcrab-ransomware-4-0-analysis/report/overview.html)\nGandcrab sample:\nef7b107c93e6d605a618fee82d5aeb2b32e3265999f332f624920911aabe1f23\nUnpacked: 786e3c693fcdf55466fd6e5446de7cfeb58a4311442e0bc99ce0b0985c77b45d\n**Gandcrab v4.1**\n[VMRay Analyzer Report](https://www.vmray.com/analyses/gandcrab-ransomware-4-1-analysis/report/overview.html)\nFirst public samples (unpacked):\n8ecbfe6f52ae98b5c9e406459804c4ba7f110e71716ebf05015a3a99c995baa1\ne454123d852e6a40eed1f2552e1a1ad3c00991541d812fbf24b70611bd1ec40a\n6987fd73457ac0b5c245886532b1bdf5d58cb43890e04b706ebba44727403311\n\n\n-----\n\n**Later v4.1 Sample**\nPacked: 06ee45a770fa1a88b62d28059c2c44310f7ff56edbdaf35a0b9c44f2a4e57536\nUnpacked: f5e74d939a5b329dddc94b75bd770d11c8f9cc3a640dccd8dff765b6997809f2\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-06-05 - The Evolution of GandCrab Ransomware.pdf"
    ],
    "report_names": [
        "2018-06-05 - The Evolution of GandCrab Ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535742,
    "ts_updated_at": 1743041170,
    "ts_creation_date": 1653687597,
    "ts_modification_date": 1653687597,
    "files": {
        "pdf": "https://archive.orkl.eu/627d8e57244a30fb4ccffffc4bf09f271e51315b.pdf",
        "text": "https://archive.orkl.eu/627d8e57244a30fb4ccffffc4bf09f271e51315b.txt",
        "img": "https://archive.orkl.eu/627d8e57244a30fb4ccffffc4bf09f271e51315b.jpg"
    }
}