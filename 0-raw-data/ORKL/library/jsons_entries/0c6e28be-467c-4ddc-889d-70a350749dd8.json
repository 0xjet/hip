{
    "id": "0c6e28be-467c-4ddc-889d-70a350749dd8",
    "created_at": "2024-01-18T02:07:18.55582Z",
    "updated_at": "2025-03-27T02:16:41.183894Z",
    "deleted_at": null,
    "sha1_hash": "82ee4569cb8a05b5be997fe23a28184b47c39ce4",
    "title": "NoJustice Wiper",
    "authors": "",
    "file_creation_date": "2024-01-04T17:59:57Z",
    "file_modification_date": "2024-01-04T17:59:57Z",
    "file_size": 2189908,
    "plain_text": "# Wiper attack on Albania by Iranian APT\n\n\n4/1/24\n\nVer 1.0\n\n\n-----\n\n# “Homeland Justice” targets Albanian organizations with wiper\n\n\n## Executive Summary\n\nOn December 24[th], 2023, Iranian psychological operation group “Homeland Justice” posted a video in\n\nAlbanian to its Telegram channel, saying it is again destroying “terrorist supporters”. This group has\n\nbeen operating since July 2022, focusing on ransomware and destructive campaigns targeting Albania.\n\nOn the next day, the actor announced on its Telegram channel and official site that it has breached,\n\ncompletely took over, and wiped the following Albanian infrastructure and government organizations’\ncomputing systems and websites:\n\nOne.al – ONE Albania – an Albanian telecom company.\n\nEagleMobile.al – Eagle Mobile Albania, an Albanian telecom company that had merged with\n\nALBtelecom, that in turn had merged with OneAlbania on March 2023. The domain redirects\nto One.al.\n\nAirAlbania.com.al – Air Albania, Albanian airlines.\n\nParlament.al – the Albanian parliament, following the publication of an image showing\nAlbanian parliament members together with Mariam Rajavi, president of Mojahedin-e Khalq.\n\nThe present campaign runs under hashtag #DestroyDurresMilitaryCamp (DDMC). Durrës is an Albanian\ncity located on the Adriatic coast and hosting Iranian dissidents belonging to the Mojahedin-e Khalq\nopposition organization.\n\nClearSky estimates that this Iranian destruction (wiping) campaign may threaten other countries.\n\nA video posted by the threat actor featured segments of PowerShell code used to target the Albanian\nparliament. ClearSky detected a PowerShell file matching the displayed code segments completely,\n\nincluding a matching reference to a file named NACL[.]exe.\n\nThe PowerShell and executable files were detected compressed together in a ZIP archive uploaded\nfrom Albania. This unique PowerShell file was also detected compressed in a different ZIP archive,\nuploaded from Albania by the same user, alongside the publicly available Plink (previously used by\nIranian threat actors), W2K Res Kit, and RevSocks tools. Thus, ClearSky estimates that the additional\n\ntools were used in the current attack with medium confidence.\n\nThis blog post will elaborate on the group’s background and provide an in-depth analysis of the tools\n\nused in the current attack, including reverse engineering the NACL executable – dubbed\n“No-Justice Wiper”.\n\n**2 | P a g e**\n\n\n-----\n\n## “Homeland Justice” Group Background\n\nOn September 23[rd], 2022, the Federal Bureau of Investigation (FBI) and the Cybersecurity and\nInfrastructure Security Agency (CISA) jointly released an advisory analyzing a wave of cyber-attacks\ntargeting the Government of Albania. The group, identifying as 'HomeLand Justice,' was attributed as\nan Iranian state threat actor[1].\n\nHomeland Justice launched its first campaign on July 15[th], 2022, targeting Albanian e-government\nsystems right before a planned conference of Iranian opposition group Mojahedin-e Khalq (Persian:\nقلخ ِنیدهاجم), also known as MEK - a well-known Iranian group seeking to replace the current regime in\nIran. The conference was cancelled following the attack. In September 2022, the actor launched a\nsecond campaign targeting Albanian border crossings. On December 24[th], 2023, the actor publicized\nthe current campaign, described in this blog, targeting Albanian infrastructure and government\norganizations. It is interesting to note that an MEK camp was raided by police in June 2023:\n\nThe actor’s logo is not randomly designed. It uses the logo of threat actor PredatorySparrow (Persian\nGonjeshk-e Darrande هدنرد کشجنگ), whose last attack, on December 18[th], 2023, targeted Iranian fuel\ninfrastructure. The group previously claimed attacks on Iranian steel factories. Homeland Justice’s\n\nlogo depicts an eagle attacking a bird identical to the one on PredatorySparrow’s logo, confined in a\n\nStar of David:\n\nLeft: PredatorySparrow logo, Right: Homeland Justice logo\n\n1 cisa.gov/news-events/cybersecurity-advisories/aa22-264a\n\n**3 | P a g e**\n\n\n-----\n\nThe group logo was presented alongside the text: “why should our taxes be spent on terrorists of\nDurres?”:\n\nDurres is the second most populous city of the Republic of Albania, and the “terrorists” the group refers\nto are the mentioned MEK group (Mujahedin-e Khalq) residing there.\n\nOn November 20[th], 2023, leading up to the current attack, Homeland Justice posted using their\ntelegram channel, stating that they are back due to “widespread corruption in or country” (typing error\non their part):\n\n**4 | P a g e**\n\n\n-----\n\nSeveral posts mentioning an Albanian tele communication company, as well as Air Albania and the\nAlbanian Parliament, followed:\n\n## Technical Analysis of the Tools Used in the Campaign\nDuring our research, we detected two main tools used in the campaign – the wiper and the\nPowerShell. We assume both files were deployed simultaneously, the PowerShell intended to copy\nand propagate the wiper to other machines in the organizational network prior to its activation.\n\nWhile investigating the posts made by “Homeland Justice”, we noticed the use of a PowerShell named\n“p”, referring to an executable named “NACL”:\n\n**5 | P a g e**\n\n\n-----\n\nWe detected an identical p[.]ps1 file compressed in a ZIP archive named “zip[.]zip”, uploaded from\nAlbania to a threat intelligence platform, alongside an executable named NACL[.]exe:\n\nWiper Analysis of No-Justice wiper\n\nThe NACL[.]exe file itself was also scanned on the VirusTotal platform, and at the time of discovery was\nonly flagged as malicious by two anti-virus engines:\n\nBACKGROUND\nDate: 28.12.2023\nHostname: File Name: Ptable.exe\nFile Location: Notification Vector:\n\nSTATIC ANALYSIS\nFile Hash: 36cc72c55f572fe02836f25516d18fed1de768e7f29af7bdf469b52a3fe2531f\nFile Size (bytes): 220.34 KB\nFile Type: Win32 EXE\nImport Hash: 6b09fb33bfe9c9cb20cb08d2f1aadb89\nSigned?: Signed file\nPacker/Compiler PE32  Compiler: EP:Microsoft Visual C/C++ (2017 v.15.5-6) [EXE32]  Compiler:\nInfo: Microsoft Visual C/C++ (2019 v.16.10 or 16.11)  Compiler: Microsoft Visual\n\n**6 | P a g e**\n\n|BACKGROUND|Col2|\n|---|---|\n|Date:|28.12.2023|\n|Hostname:|-|\n|File Name:|Ptable.exe|\n|File Location:|-|\n|Notification Vector:|-|\n|STATIC ANALYSIS||\n|File Hash:|36cc72c55f572fe02836f25516d18fed1de768e7f29af7bdf469b52a3fe2531f|\n|File Size (bytes):|220.34 KB|\n|File Type:|Win32 EXE|\n|Import Hash:|6b09fb33bfe9c9cb20cb08d2f1aadb89|\n|Signed?:|Signed file|\n|Packer/Compiler Info:|PE32 Compiler: EP:Microsoft Visual C/C++ (2017 v.15.5-6) [EXE32] Compiler: Microsoft Visual C/C++ (2019 v.16.10 or 16.11) Compiler: Microsoft Visual|\n\n\n-----\n\nC/C++ (19.28.30038) [LTCG/C++]  Linker: Microsoft Linker (14.28.30038)  Tool:\nVisual Studio (2019 version 16.9-16.10)  Sign tool: Windows Authenticode\n(2.0) [PKCS #7]\nCompile Time: 2022-02-19 11:49:36 UTC\nFile Properties: Description, version, file header characteristics\nCopyright\nCopyright (C) 2023 Attest\nProduct\nPtable\nDescription\ntable primmer\nOriginal Name\nPtable.exe\nInternal Name\nPtable.exe\nFile Version\n3.0.1.1\nDate signed\n2023-12-23 09:59:00 UTC\nEntropy: File and sections\n5.364\nOpen Source Research: Virus Total detections, search engine output, free sandbox results\n26/72\n\nStatic Analysis\n\nThe file has a unique Icon and a still-valid digital signature by company “Attest Inspection Limited”:\n\n**7 | P a g e**\n\n|Col1|C/C++ (19.28.30038) [LTCG/C++] Linker: Microsoft Linker (14.28.30038) Tool: Visual Studio (2019 version 16.9-16.10) Sign tool: Windows Authenticode (2.0) [PKCS #7]|\n|---|---|\n|Compile Time:|2022-02-19 11:49:36 UTC|\n|File Properties: Description, version, file header characteristics||\n|Copyright Copyright (C) 2023 Attest Product Ptable Description table primmer Original Name Ptable.exe Internal Name Ptable.exe File Version 3.0.1.1 Date signed 2023-12-23 09:59:00 UTC||\n|Entropy: File and sections||\n|5.364||\n|Open Source Research: Virus Total detections, search engine output, free sandbox results||\n|26/72||\n\n\n-----\n\nThe company’s website provides the following description:\n\n“AJA Europe’s 20 years’ experience led to the creation of ACT. Inspections, conformity assessments and\ncertifications worldwide.”\n\nAttest Inspection Limited website\n\nThe icon from the website gattestor[.]com matches the Icon used in the Homeland Justice Wiper seen\nin VirusTotal:\n\n**8 | P a g e**\n\n\n-----\n\nThe next screenshot shows the pdb path created when compiling the file. It is apparent that the folder\nname is loweraser – a suitable name for a wiper (eraser) file:\n\nIt is worth noting that in the first Homeland Justice attack, the No-Justice wiper had a valid digital\nsignature by “Kuwait Telecommunications Company KSC”, indicating a consistent method to give\nfiles an appearance of legitimacy.\n\nDynamic Analysis\n\nDuring ClearSky’s dynamic analysis in a laboratory environment, the file crashed the station on which\nit ran (bluescreen) and manipulated the operating system so that it won’t load when attempting to\nturn the machine on. It should be noted that the file requires elevated (admin) privileges to wipe the\ncomputer.\n\nThe drives on the computer before running the malware:\n\nThe drives on the computer immediately (1-2 seconds) after running the malware:\n\n**9 | P a g e**\n\n\n-----\n\nThe computer screen when malware execution is completed:\n\nReverse Engineering\n\nThe screenshot on the next page shows the file’s main function. The function is relatively simple and\nsmall. ClearSky’s team used Ida Pro to analyze the malware code.\n\nThe file’s main function\n\nThe next screenshot shows the file’s main function written in pseudo code, that provides a more\n\ncomprehensible presentation of the malware’s functionality. The malware performs several actions\n\n**10 | P a g e**\n\n\n-----\n\nwhile running, including loading a library, receiving addresses for API functions, and ultimately wiping\n\nthe computer.\n\nThe file’s main function written in pseudo code\n\nMain function explained in detail:\n\n  - Initially, we may observe a call for function LoadLibraryW, that loads DLL file kernel32.dll\nwhile running. The function returns a handle for the loaded library. The handle is saved in\nregister ebx.\n\n  - Following these steps, the function GetProcAddress is called, returning the address of the\nfunction DeviceIoControl.\n\n  - Function GetProcAddress is called again, this time returning the address of function\nCreateFileW.\n\n  - At this point function sub_D10C0 is called (calling vswprintf_s). Below is a screenshot of the\nfunction:\n\n`o` The function receives several arguments, including buffer, format and arglist.\n\n`o` The function sets the buffer in accordance with the received format and arglist and\n\nreturns the buffer length.\n\n**11 | P a g e**\n\n\n-----\n\n`o` The function enters the value of arglist (the letter C) into the buffer in the received\n\nformat (\\\\\\\\.\\\\%c:) and returns its length (6).\n\n`o` Following is an image with the buffer value.\n\n  - Then the function CreateFileW is called. It returns a handle for the device received in the buffer\n\n(\\\\.\\C:). (The other parameters indicate privileges and specific access permissions).\n\n  - At this point the function GetProcAddress is called. It returns the offset of function CloseHandle\n\n(in kernel32.dll module). The handle received from calling CreateFileW is checked for validity.\nThis check ensures that the user has elevated privileges.\n\n  - If they do, function DeciveIoControl is called, with the handle for the device and control code\n0x7c100, that removes the boot signature from the Master Boot Record, so the disk would be\nformatted from sector zero to the end of the disk. The partition details are not stored in sector\nzero anymore (which would crash the operating system and prevent rebooting). Then the\nhandle closes and the function ends.\n\n  - If they do not, the function ends.\n\nThe following screenshot shows an explanation of the control code (0x7c100) that the function\nDeviceIoControl receives as a parameter.\n\nThe wiper’s primary actions:\n\n1. Sets a string of the device name to be acted upon (\\\\.\\C:) by function sub_D10C0.\n\n2. Creates a handle for the device with the function CreateFileW.\n\n3. Calls the function DeviceIoControl with the handle for the device and control code 0x7c100\n\nand removes the boot signature from the Master Boot Record, so the disk is formatted from\n\nsector zero to the end of the disk.\n\n4. Crashes the operating system in a way that it cannot be rebooted.\n\n**12 | P a g e**\n\n\n-----\n\nIn-depth explanation of the code:\n\n\nBeginning of main function.\n\nCalling function LoadLibraryW that loads kernel32.dll\nwhile running. The function returns a handle for the\nloaded library.\n\n\nThe address of function GetProcAddress is saved in\nedi (calling edi is calling function GetProcAddress).\n\nThe handle to library kernel32.dll is saved in ebx.\n\nCalling function GetProcAddress with parameters –\nhandle for library kernel32.dll and “DeviceIoControl\"\n\n- returns the address of function DeviceIoControl.\n\n\nCalling function GetProcAddress with parameters\n– handle for library kernel32.dll and \"CreateFileW\"\n\n- returns the address of function CreateFileW.\n\nThe address of function DeviceIoControl is saved\nin [ebp+var_210].\n\n\nCalling function sub_D10C0 with parameters – ‘C’,\nFormat, and Buffer - returns the buffer length.\n\nThe address of function CreateFileW is saved in esi.\n\n\n**13 | P a g e**\n\n\n-----\n\nCalling esi (function CreateFileW) with\nparameters – lpFileName, dwDesiredAccess,\ndwShareMode, lpSecurityAttributes,\ndwCreationDisposition,\ndwFlagsAndAttributes, hTemplateFileFile returns the handle for the device received in\nbuffer (\\\\.\\C:).\n\nThe other parameters indicate privileges and\nspecific access permissions.\n\n\nCalling function GetProcAddress with parameters\n\n- handle for library kernel32.dll and\n\"CloseHandle” - returns the address of function\nCloseHandle saved in edi.\n\nThe received handle is checked for validity.\n\n\nCalling [ebp+var_210] (function\nDeviceIoControl) with parameters handle for the device and control code\n0x7c100.\n\nThe function removes the boot\nsignature from the Master Boot Record,\nso the disk is formatted from sector zero\nto the end of the disk. The partition\ndetails are no longer stored in sector\nzero (which crashes the operating\nsystem with no possibility of rebooting\nagain).\n\n\nFinally, edi (CloseHandle) is called with\nthe buffer (device name). End of main function\n\n**14 | P a g e**\n\n|Col1|Col2|Col3|\n|---|---|---|\n||End of main function||\n\n\n-----\n\nAccompanying Files\n\nPowerShell Analysis\n\nParameters:\n$TargetsFile: Path of a file containing target machine names.\n$SourcePath: Path of the file to be pushed.\n$DestPath: Path of the file on the target machine.\n$Argument: Argument for the executable file (optional).\n$Action: Copy or run. \"Copy\" only copies the executable; \"run\" copies and executes it (default: copy).\n$Mode: Two modes - \"normal\" or \"force\". \"Normal\" tries to connect to machines with WinRM\nenabled, while \"force\" attempts to enable WinRM on target machines (default: normal).\n$UserName & $Password: Credentials for connecting to target machines. If not provided, it tries to\nconnect using the current access.\n\nFunctions:\nTestConnection: Checks if a machine is reachable.\nTestWSManEnabled: Tests if WinRM is enabled on a machine.\nTryToEnableWinRM: Attempts to enable WinRM on a target machine.\nCreateSession: Creates a PowerShell session for a target machine.\nActionOnOpenMachine: Copies and optionally executes a file on a target machine.\nRun-parallel: Runs PowerShell scripts in parallel on multiple machines.\n\nScript Execution:\nReads a list of target machines from a file ($TargetsFile).\nFor each machine, it checks its online status and WinRM state.\nDepending on the WinRM state, it either runs a parallel script (Run-parallel) to copy and execute the\nfile or attempts to enable WinRM on the target machine before doing so.\nIf the machine is not available or offline, the computer name is written to a file called $machine[.]txt\nwith the following text message:\n\nIt appears that the file $machine[.]txt is used as a diagnostic log.\n\nWe assess that the PowerShell runs from the DC server using admin privileges, as indicated from the\ncode:\n\nThe PowerShell file p[.]ps1 was not present on VirusTotal at the time of the discovery.\n\n**15 | P a g e**\n\n\n-----\n\nUtilities Analysis\n\nThe user that uploaded the wiper NACL[.]exe to VirusTotal from Albania also uploaded files:\nstaging[.]exe – a version of the tool RevSocks, 1[.]exe - a version of the tool Plink, and local[.]exe - a\nversion of the tool W2K Res Kit. All four files were uploaded in a timeframe of one and a half hours:\n\nSince these tools were uploaded to VirusTotal by the same user that uploaded the wiper in a short\ntimeframe, we attribute them with medium confidence to the same threat actor, and we estimate that\nthey were used by Homeland Justice in its attack. Another contributing factor for this estimation was\nthe detection of a ZIP archive named tools[.]zip, uploaded to a threat intelligence platform a day after\nthe previously mentioned zip[.]zip archive. This second ZIP archive contained the unique p[.]ps1 file,\nthe staging[.]exe RevSocks file, the 1[.]exe Plink file, and the local[.]exe W2K Res Kit tool file:\n\n**16 | P a g e**\n\n\n-----\n\n1[.]exe - Plink\n\n\"Plink\" is a command-line tool commonly associated with the PuTTY suite, which is a collection of\nsoftware utilities for network communication. Specifically, \"plink.exe\" is a component of PuTTY that\nserves as a command-line interface to connect to remote systems using the SSH (Secure Shell)\nprotocol.\n\nThis tool was used by several Iranian threat actors in past attacks for lateral movement purposes.\n\nStaging[.]exe – RevSocks\n\nRevSocks is a tool that enables threat actors to establish a connection with a server via SOCKS proxy.\nThis can be employed by attackers for data exfiltration, command and control, or for maintaining\npersistent access in a compromised network.\n\nlocal[.]exe - W2K Res Kit tool\n\nA tool that would enumerate local admins on all network computers.\n\nIoCs:\n\nSha1 Filename Description\nbe70fc2d12433899f273dad8c580c96e62c6904b Zip[.]zip Zip File\n720c467046514f7376473b11271ebcb8d0a7e439 NACL[.]exe Justice Wiper\na973e19aafa2de9ae63964e1fa06a8671eec91e7 P[.]ps1 PowerShell\nffa757edc725a21bb27c09cffe371a7892698c1b Tools[.]zip Zip File\n4e265736eaa201e270d851074878dfa60259e806 1[.]exe Plink Tool\n4b80478091b204e76ecdfffa275637bb1b98d103 Local[.]exe W2K Res Kit tool Tool\nc5d38822b42a848a500ccf7cede470f5baa92253 Staging[.]exe RevSocks Tool\n\n**17 | P a g e**\n\n|IoCs:|Col2|Col3|\n|---|---|---|\n|Sha1|Filename|Description|\n|be70fc2d12433899f273dad8c580c96e62c6904b|Zip[.]zip|Zip File|\n|720c467046514f7376473b11271ebcb8d0a7e439|NACL[.]exe|Justice Wiper|\n|a973e19aafa2de9ae63964e1fa06a8671eec91e7|P[.]ps1|PowerShell|\n|ffa757edc725a21bb27c09cffe371a7892698c1b|Tools[.]zip|Zip File|\n|4e265736eaa201e270d851074878dfa60259e806|1[.]exe|Plink Tool|\n|4b80478091b204e76ecdfffa275637bb1b98d103|Local[.]exe|W2K Res Kit tool Tool|\n|c5d38822b42a848a500ccf7cede470f5baa92253|Staging[.]exe|RevSocks Tool|\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.clearskysec.com/wp-content/uploads/2024/01/No-Justice-Wiper.pdf"
    ],
    "report_names": [
        "No-Justice-Wiper.pdf"
    ],
    "threat_actors": [
        {
            "id": "20c759c2-cd02-45bb-85c6-41bde9e6a7cf",
            "created_at": "2024-01-18T02:02:34.189827Z",
            "updated_at": "2025-03-27T02:02:09.937024Z",
            "deleted_at": null,
            "main_name": "HomeLand Justice",
            "aliases": [
                "Karma",
                "Storm-842",
                "Void Manticore"
            ],
            "source_name": "ETDA:HomeLand Justice",
            "tools": [
                "BABYWIPER",
                "BiBi Wiper",
                "BiBi-Linux Wiper",
                "BiBi-Windows Wiper",
                "Cl Wiper",
                "LowEraser",
                "No-Justice Wiper",
                "Plink",
                "PuTTY Link",
                "RevSocks",
                "W2K Res Kit"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7f25e108-e694-49b6-a494-c8458b33eb3f",
            "created_at": "2024-01-09T02:00:04.199217Z",
            "updated_at": "2025-03-27T02:00:03.278805Z",
            "deleted_at": null,
            "main_name": "HomeLand Justice",
            "aliases": [],
            "source_name": "MISPGALAXY:HomeLand Justice",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6fbff48b-7a3e-4e54-ac22-b10f11e32337",
            "created_at": "2022-10-25T16:07:23.318008Z",
            "updated_at": "2025-03-27T02:02:09.734465Z",
            "deleted_at": null,
            "main_name": "APT 4",
            "aliases": [
                "APT 4",
                "Bronze Edison",
                "Maverick Panda",
                "Salmon Typhoo",
                "Sodium",
                "Sykipot",
                "TG-0623",
                "Wisp Team"
            ],
            "source_name": "ETDA:APT 4",
            "tools": [
                "Getkys",
                "Sykipot",
                "Wkysol",
                "XMRig"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1705543638,
    "ts_updated_at": 1743041801,
    "ts_creation_date": 1704391197,
    "ts_modification_date": 1704391197,
    "files": {
        "pdf": "https://archive.orkl.eu/82ee4569cb8a05b5be997fe23a28184b47c39ce4.pdf",
        "text": "https://archive.orkl.eu/82ee4569cb8a05b5be997fe23a28184b47c39ce4.txt",
        "img": "https://archive.orkl.eu/82ee4569cb8a05b5be997fe23a28184b47c39ce4.jpg"
    }
}