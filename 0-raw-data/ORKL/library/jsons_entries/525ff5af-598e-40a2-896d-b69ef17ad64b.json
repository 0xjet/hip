{
    "id": "525ff5af-598e-40a2-896d-b69ef17ad64b",
    "created_at": "2023-01-12T15:05:08.860461Z",
    "updated_at": "2025-03-27T02:16:50.936116Z",
    "deleted_at": null,
    "sha1_hash": "59920372a3627c6cb4f634f72e8fc012759c9ae0",
    "title": "2019-03-12 - New Ursnif Variant targets Japan packed with new Features",
    "authors": "",
    "file_creation_date": "2022-05-27T23:10:09Z",
    "file_modification_date": "2022-05-27T23:10:09Z",
    "file_size": 2499571,
    "plain_text": "# New Ursnif Variant Targets Japan Packed with New Features\n\n**[cybereason.com/blog/new-ursnif-variant-targets-japan-packed-with-new-features](https://www.cybereason.com/blog/new-ursnif-variant-targets-japan-packed-with-new-features)**\n\nWritten By\nCybereason Nocturnus\n\nMarch 12, 2019 | 10 minute read\n\n**Research by: Assaf Dahan**\n\n[The Ursnif trojan (also known as Gozi ISFB) is one of the most prolific information stealing](https://www.cybereason.com/blog/labs-using-behavioral-analysis-to-detect-the-ursnif-banking-trojan)\n[Trojans in the cybercrime landscape. Since its reappearance in early 2013, it has been](https://journal.cecyf.fr/ojs/index.php/cybin/article/view/15)\nconstantly evolving. In 2015, its source code was leaked and made publicly available on\nGithub, which led to further development of the code by different threat actors who improved\nit and added new features.\n\n[Over the past few years, Japan has been among the top countries targeted by Ursnif’s](https://unit42.paloaltonetworks.com/unit42-banking-trojans-ursnif-global-distribution-networks-identified/)\noperators. In 2018, [Cybereason as well as other security companies reported about attacks](https://twitter.com/CybereasonJPSOC/status/971063140497604609)\n[where Ursnif (mainly the Dreambot variant) and Bebloh (also known as URLZone and](https://www.fortinet.com/blog/threat-research/dreambot-2017-vs-isfb-2013.html)\nShiotob) were operating in conjunction. In these joint campaigns, Bebloh is used as a\n\n\n-----\n\ndownloader that runs a series of tests to evaluate whether it is running in a hostile\nenvironment (for example, it checks to see if it is running on a research VM). Once the coast\nis clear, it downloads Ursnif, which carries out its core information stealing functions.\n\nThe newly discovered Ursnif variant comes with enhanced stealing modules focused on\nstealing data from mail clients and email credentials stored in browsers. The revamping and\nintroduction of new mail stealer modules puts an emphasis on the risk that trojans can pose\nto enterprises if corporate accounts are compromised. With more and more banking\ncustomers shifting to mobile banking and the continuous hardening of financial systems, it is\nnot surprising that trojans are focusing more than ever before on harvesting other types of\ndata that can also be monetized and exploited by the threat actors, including mail user\naccounts, contents of email inboxes and digital wallets.\n\nCurious about the future of security?\n\n## Contents of this Research:\n\n[1. OLD -NEW TRICKS, NEW VARIANT](https://www.cybereason.com/blog/new-ursnif-variant-targets-japan-packed-with-new-features#old-new-tricks)\n[2. STAGE ONE: PHISHING VIA OFFICE DOCUMENTS](https://www.cybereason.com/blog/new-ursnif-variant-targets-japan-packed-with-new-features#stage-one)\n\nMODIFIED VBA MACRO TARGETS JAPANESE USERS\n\nOLD VBA COUNTRY CHECK\nNEW VBA COUNTRY CHECKS\n[3. STAGE TWO: PARANOID POWERSHELL DOWNLOADER](https://www.cybereason.com/blog/new-ursnif-variant-targets-japan-packed-with-new-features#stage-two)\n\nNEW LANGUAGE SETTING TEST\nGEO-IP LOCATION CHECK\nUSAGE OF STEGANOGRAPHY TO HIDE THE PAYLOAD IN PLAIN SIGHT\nPOWERSPLOIT REFLECTIVELY LOADS BEBLOH\n[4. STAGE THREE: URSNIF'S LOADER](https://www.cybereason.com/blog/new-ursnif-variant-targets-japan-packed-with-new-features#stage-three)\n[5. STAGE FOUR: URSNIF CORE PAYLOAD CLIENT.DLL](https://www.cybereason.com/blog/new-ursnif-variant-targets-japan-packed-with-new-features#stage-four)\n[6. NOTABLE CHANGES IN CORE FUNCTIONALITY](https://www.cybereason.com/blog/new-ursnif-variant-targets-japan-packed-with-new-features#notable-changes)\n\nNEW STEALTHY PERSISTENCE MECHANISM\nDETAILED PERSISTENCE CREATION LOGIC\nDETAILED PERSISTENCE REMOVAL LOGIC\nCHANGES IN THE INFORMATION STEALING MODULES\nCHANGES IN THE MAIL STEALER FUNCTIONS\nCRYPTOCURRENCY AND ENCRYPTED DRIVES STEALER\n[7. THWARTING SECURITY PRODUCTS MODULES](https://www.cybereason.com/blog/new-ursnif-variant-targets-japan-packed-with-new-features#thwarting)\n\nANTI-PHISHWALL MODULE\nANTI-RAPPORT MODULE\n[8. CONCLUSION](https://www.cybereason.com/blog/new-ursnif-variant-targets-japan-packed-with-new-features#conclusion)\n\n[9. INDICATORS OF COMPROMISE](https://www.cybereason.com/blog/new-ursnif-variant-targets-japan-packed-with-new-features#indicators-of-compromise)\n\n\n-----\n\n## Old-New Tricks, New Variant\n\nSince the beginning of 2019, Cybereason researchers have observed a campaign that\nspecifically targets Japanese users across multiple customer environments. This campaign\nintroduced a new Ursnif variant as well as improved targeted delivery methods through\nBebloh.\n\nUrsnif’s new variant main changes:\n\n1. A new, stealthy persistence mechanism (“last minute persistence”).\n2. New, revamped stealing modules (“#IESTEALER#”, “#OLSTEALER#”,\n\n_“#TBSTEALER#”)._\n[3. Cryptocurrency and disk encryption software module (e.g Bitcoin, TrueCrypt).](https://www.cybereason.com/blog/blog-bitcoin-exchanges-in-south-korea-hacked-and-north-korea-is-prime-suspect)\n\n[4. An Anti-PhishWall module to counteract PhishWall, a Japanese security product.](https://www.securebrain.co.jp/eng/phishwall/)\n\nEnhanced country-targeted delivery methods to ensure the delivery of Bebloh include:\n\n1. Modified VBA code that specifically checks Japanese settings on the infected machine.\n2. PowerShell that compiles a .NET DLL to check language settings (Japanese).\n\n3. An added IP geolocation check to determine whether the infected machine is in Japan.\n\nThe following chart demonstrates the infection chain observed in the latest campaign:\n\n\n-----\n\n_Infection chain as seen in the Cybereason Defense Platform._\n\n## Stage One: Phishing via Office Documents\n\nThe first stage of the attack starts with a weaponized Microsoft Office document attached to\na phishing email:\n\n\n-----\n\nWhen the user opens the document, the Japanese text instructs the unsuspecting user to\nclick on the Enable Content button. They expect to see a preview of a document, but instead\nit will execute the embedded macro code:\n\n\n-----\n\n_Weaponized Excel document that encourages the user to click on Enable Content._\n\n### Modified VBA Macro Targets Japanese Users\n\nThe macro code is obfuscated and results in the execution of several PowerShell\ncommands. However, before the PowerShell commands are decrypted and executed, the\nVBA macro checks if the victim machine has Japanese country settings. This technique was\npreviously seen in 2018, but the attackers modified the code in this version to make it less\nobvious and harder to detect.\n\n**Old VBA Country Check**\n\n\n-----\n\n[The previous check, documented by Nao_Sec, consisted of comparing the country setting to](https://gist.github.com/koike/692fb8a20c8aa3b77246be3497355670#file-1-vb)\n[the value of ‘81’ for Japan, using the function xlCountrySetting. If the machine doesn’t have](https://docs.microsoft.com/en-us/office/vba/api/excel.application.international)\nJapanese settings, the macro code exits.\n\n**New VBA Country Checks**\n\nThe new country check function in this variant makes it less obvious to understand which\ncountry is being targeted, however it can still be easily inferred with a bit of basic calculation.\nThe new code checks the country setting, adds ‘960’ to it, and stores the new value in a\nparameter. In this case, the parameter is opa (81 + 960 = 1041):\n\nThe SensitiveLine() function checks if the value of “opa” is greater than ‘1039.93’, in which\ncase, the macro code will continue. If not, the code will exit. The calculation is the following:\n\n[The value of xlBinsTypeBinSize (‘3’) * 347 - 1.07 = 1,039.93](https://docs.microsoft.com/en-us/office/vba/api/Excel.xlbinstype)\n\n[Note: Similar techniques were implemented in a campaign that targeted Italian users, which](https://www.tfun.org/2019/02/11/ursnif-long-live-the-steganography/)\ndelivered a different Ursnif variant.\n\n## Stage Two: Paranoid PowerShell Downloader\n\n\n-----\n\n_The malicious cmd.exe spawned from an excel process and seen executing two children_\n_processes depicted within the Cybereason Defense Platform._\n\nOnce the macro code ensures that the machine is Japanese, it decrypts the PowerShell\npayload, sets it as environment variables, and executes the code:\n\n\n-----\n\n_PowerShell code hidden in environment variables._\n\n_Snipped PowerShell code._\n\nThe code is heavily obfuscated and contains a set of additional tests to ensure that the\ntargeted machine not only has Japanese settings, but is also physically located in Japan\nprior to downloading Bebloh’s payload.\n\n### New Language Setting Test\n\n\n-----\n\n_The malicious PowerShell process is identified within the Cybereason Defense Platform with_\n_parent and child processes._\n\nBefore downloading the payload, the PowerShell code runs a final language check to ensure\nthe target is indeed Japanese. It matches the result of the Omk() function against ‘j’, for\nJapanese:\n\nThe file is compiled and dropped in the %temp% folder:\n\n\n-----\n\n[The decompiled code shows the Omk() function that checks the CultureInfo.CurrentCulture](https://www.google.com/url?q=https://docs.microsoft.com/en-us/dotnet/api/system.globalization.cultureinfo.currentculture?view%3Dnetframework-4.7.2%23System_Globalization_CultureInfo_CurrentCulture&sa=D&ust=1552313856031000)\nproperty:\n\n### Geo-IP Location Check\n\n[The downloader’s last test is a geolocation test using the ipinfo.io API to verify that the IP](https://ipinfo.io/)\naddress is Japanese:\n\n_Detecting country by IP geolocation._\n\n\n-----\n\n### Usage of Steganography to Hide the Payload in Plain Sight\n\nOnce all the checks are done, the PowerShell code downloads an image file hosted on an\n[image sharing websites such as Imgur or](https://imgur.com/) [postimage.cc: hxxps://i.imgur[.]com/96vV0YR[.]png](https://postimages.org/)\n\n_Even the images have Japanese theme. ^_^_\n\nThe embedded content is decrypted by the following PowerShell code, which is based on the\n[Invoke-PSImage steganography project:](https://github.com/peewpw/Invoke-PSImage)\n\n### PowerSploit Reflectively Loads Bebloh\n\n[The decrypted PowerShell code embedded in the image is based on the PowerSploit](https://github.com/PowerShellMafia/PowerSploit)\n[framework that uses the reflective PE injection module Invoke-ReflectivePEInjection to load](https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1)\nand execute Bebloh’s code to memory:\n\n\n-----\n\n_Excerpt from decrypted content hidden in the downloaded image._\n\nThe unpacked payload dumped from the injected explorer.exe [indicates that the payload is in](https://webcache.googleusercontent.com/search?q=cache:GZss7aPxSqgJ:https://asert.arbornetworks.com/an-update-on-the-urlzone-banker/+&cd=1&hl=en&ct=clnk&gl=jp)\nfact Bebloh:\n\nOnce Bebloh is injected to explorer.exe, it downloads Ursnif’s loader payload from the C2\nserver:\n\n\n-----\n\n_Bebloh drops Ursnif depicted through a malicious PowerShell process and child processes_\n_shown in the Cybereason Defense Platform._\n\n## Stage Three: Ursnif’s Loader\n\n_The malicious gyehtuegg.exe (Ursnif Loader) spawns an instance of_\n_explorer.exe, depicted in the Cybereason Defense Platform._\n\nUrsnif’s loader unpacks the main payload (client.dll / client64.dll), which is embedded in the\nloader’s PE resource section (RT_RCDATA):\n\n\n-----\n\n_32-bit and 64-bit version of client.dll._\n\nPrior to its decryption, the loader conducts a series of tests to determine whether the loader\nis running in a hostile environment, namely, whether it is being debugged or run in a sandbox\nor virtual machine. For example, Bebloh runs the following checks:\n\nA Xeon CPU check to determine whether it is running on a server, laptop, or PC.\nA virtualization vendor check to determine whether it is running in vbox, qemu, vmware\nor on a virtual hd.\n\nA timing check (RDTSC with CPUID to force a VM exit and to thwart debuggers and\nsandboxes).\n\n[The following is an example of virtualization checks using the SetupDiGetClassDevsA() and](https://docs.microsoft.com/en-us/windows/desktop/api/setupapi/nf-setupapi-setupdigetclassdevsw)\n[SetupDiGetDeviceRegistryPropertyA() APIs to query hardware information stored in the](https://docs.microsoft.com/en-us/windows/desktop/api/setupapi/nf-setupapi-setupdigetdeviceregistrypropertya)\nWindows registry:\n\n\n-----\n\nIf any of the above tests returns positive, the loader displays an error message and terminate\nthe process:\n\n_Error message displayed upon VM detection._\n\nIf all the tests check out, it will proceed and inject Ursnif’s core DLL to the main explorer.exe\nprocess.\n\n## Stage Four: Ursnif Core Payload client.dll\n\n\n-----\n\nThe injected DLL payload includes an interesting PDB path of client64.dll, suggesting that it\n[is Gozi ISFB version 3:](https://github.com/gbrindisi/malware/tree/667b44f64edcd1c5e8c42489b8e767813a589158/windows/gozi-isfb)\n\n_PDB path: c:\\isfb3\\x64\\Release\\client.pdb._\n\nIts build number (version number) extracted from memory indicates that its version\n“300035”:\n\nThe compilation date is 22/02/2019, which also suggests that it was compiled recently:\n\nWe have found an earlier sample of the same variant in the wild with a compilation\ntimestamp that dates to July 2018, suggesting that the variant first emerged in 2018:\n\n## Notable Changes in Core Functionality\n\nThroughout the years, Ursnif’s code original code has changed to introduce different strains\nand new features. For a detailed analysis of Ursnif’s previous versions and functionality,\n[please see the following write-ups by Vitali Kremez,](https://www.vkremez.com/2018/08/lets-learn-in-depth-reversing-of-recent.html) [Mamoru Saito and](https://www.iij.ad.jp/en/dev/iir/pdf/iir_vol34_EN.pdf) [Maciej Kotowicz.](https://journal.cecyf.fr/ojs/index.php/cybin/article/view/15)\n\n\n-----\n\nBased on our code analysis, the newly observed variant bears great resemblance to the\n[Dreambot variant. However, it lacks some commonly observed built-in features like the Tor](https://www.proofpoint.com/us/threat-insight/post/ursnif-variant-dreambot-adds-tor-functionality)\nclient and VNC module. The new variant exhibits several new or revamped features, such\nas:\n\nA new persistence mechanism (last minute persistence that resembles Dridex’s\npersistence).\nRevamped and new stealer modules (IE Stealer, Outlook Stealer, Thunderbird Stealer).\nA cryptocurrency and disk encryption software module.\nAn Anti-PhishWall module to counteract PhishWall, a Japanese security product.\n\n### New Stealthy Persistence Mechanism\n\nOne of the most noticeable changes observed in this new variant is the implementation of a\nnew persistence mechanism designed to evade detection.\n\nThe newly observed persistence mechanism is based on the \"last minute persistence\"\nmodel. This model creates its persistence at the very last moment before the system shuts\ndown. Once the system is rebooted and the loader injects the core DLL to explorer.exe, it\nimmediately deletes its registry autorun key along with the files stored in %appdata%. Similar\n[implementations have been used by Dridex and](https://www.cyberbit.com/wp-content/uploads/2016/09/Analysis-of-Dridex-AnD-for-IT.pdf) [Bebloh banking trojans in the past.](https://www.fireeye.com/blog/threat-research/2016/01/urlzone_zones_inon.html)\n\nit is interesting to mention that the above mention persistence is different than the fileless\n[persistence mechanism reported by Cisco and other researchers between December 2018](https://blog.yoroi.company/research/dissecting-the-latest-ursnif-dhl-themed-campaign/)\nand February 2019. The previous technique relied on a PowerShell script stored in the\nregistry. Upon boot, it dynamically loads and injects the core DLL to explorer.exe using the\n[QueueUserAPC injection technique.](https://resources.infosecinstitute.com/code-injection-techniques/#gref)\n\nThe following is a chart that demonstrates the “last minute persistence” creation and removal\nlogic on an infected machine:\n\n\n-----\n\n**Detailed Persistence Creation Logic**\n\nThe malware creates an invisible window used for internal communication between the\ntrojan’s different components:\n\nUrsnif uses this window among other things in order to catch the\n[WM_QUERYENDSESSION message. This message is typically sent when the system](https://docs.microsoft.com/en-us/windows/desktop/shutdown/wm-queryendsession)\nis about to shut down, thus alerting the malware of an imminent shutdown:\n\n\n-----\n\nOnce Ursnif is made aware of the shutdown message, it creates an autorun registry\nkey along with files in the %appdata% folder, based on information found in the Install\nkey found in - HKCU\\Software\\AppDataLow\\Software\\Microsoft\\{GUID}\\Install\n\nBooting the machine in Safe Mode, can reveal the created persistence, as it prevents any\nprogram from running automatically when the user logs on:\n\n_.lnk and .exe file in %appdata% created before the system shuts down._\n\n_Registry Autorun key created before the system shuts down._\n\n**Detailed Persistence Removal Logic**\n\nOnce the system boots and the user is logged on, the loader runs and injects the core DLL to\nexplorer.exe. Once the trojan’s code runs:\n\n\n-----\n\nIt checks for the existence of the ProgMan window, indicating that the explorer.exe\nprocess is running:\n\nIt checks whether the malware code is running from the same process (explorer.exe),\nlikely as an anti-debugging measure:\n\nIt deletes registry keys and the %appdata% folder where the .lnk and .exe files exist\nbased on the on the Install key in HKCU\\Software\\AppDataLow\\Software\\Microsoft\\\n{GUID}.\n\n### Changes in the Information Stealing Modules\n\nThe new variant (V3) exhibits changes in the code of its stealer modules in comparison with:\n\nDreambot (unpacked client.dll - 2bcb80182ed4ca4701ab0bcd750d5aacac83d77)\n\nGozi ISFB 2.16 / 2.17 (unpacked client.dll 74e7453b33119de1862294e03bf86cc7623d558b)\n\n**Changes in the Mail Stealer Functions**\n\nThe new variant’s mail stealing functionality seems to have undergone a major update that\nincludes enhancements and some new functionality, like: a Microsoft Outlook stealer, an\nInternet Explorer stealer, and a Mozilla ThunderBird stealer.\n\n\n-----\n\n_Excerpt of the mail stealer’s main function._\n\nThe following comparative chart demonstrates the changes to the main mail stealing\nfunctions between recent variants:\n\n**#OLSTEALER# - the Revamped Outlook Stealer**\n\nThe new OLSTEALER module enumerates stored Microsoft Outlook accounts on the\ninfected machine:\n\n\n-----\n\nThis new variant adds support for multiple Microsoft Outlook versions, as opposed to\nprevious versions that typically support one or two versions:\n\nIn addition, it adds the capability to locate Microsoft Outlook’s .PST and .OST file\nextensions:\n\n**#TBSTEALER# - Mozilla ThunderBird Stealer**\n\nThis variant adds the capability to steal data from the Mozilla ThunderBird mail client, stored\nin:\n\nThunderbird Stored Credentials (logins.json)\nThunderBird Personal Address Book (abook.mab)\n\n\n-----\n\n_Extracting ThunderBird user credentials._\n\n**#IESTEALER# - Internet Explorer Stealer**\n\nThe newly added, built-in module steals data stored in Internet Explorer, such as:\n\nHKCU\\Software\\Microsoft\\Internet Explorer\\TypedURLs (Autocomplete typed URLs)\nHKCU\\Software\\Microsoft\\Internet Explorer\\IntelliForms\\Storage2 (AutoComplete Data,\nincluding stored credentials)\nCLSID_CUrlHistory (Browsing History)\n\n### CryptoCurrency and Encrypted Drives Stealer\n\nThe new variants seems to add the ability to steal data from cryptocurrency wallets as well\nas disk encryption software:\n\nDigital currency wallets:\n\n[Electrum Bitcoin wallet,](https://electrum.org/#home) [Bitcoin wallet,](https://bitcoin.org/en/download) [Multibit-hd (a deprecated Bitcoin wallet), Bither](https://multibit.org/)\n[Bitcoin wallet, mSigna Bitcoin wallet,](https://ciphrex.com/products/) [Jaxx multi-currency digital wallet, and Bitcoin](https://jaxx.io/)\nArmory wallet.\n\nDisk Encryption Tools:\n\n[VeraCrypt disk encryption software, TrueCrypt disk encryption utility (a discontinued](https://www.veracrypt.fr/en/Home.html)\nutility)\n\n\n-----\n\n## Thwarting Security Products Modules\n\n**Anti-PhishWall Module**\n\n[The new variant adds a built-in anti-PhishWall module to its capabilities. PhishWall is an anti-](https://www.securebrain.co.jp/eng/phishwall/)\nphishing and anti-MITB (Man-in-the-Browser) product created by Japanese cybersecurity\ncompany [Securebrain. The product is quite popular in Japan and is even recommended by](https://www.securebrain.co.jp/)\n[several banks and financial institutions as a protection against banking trojans, and more](https://www.chibabank.co.jp/safety/prevention/netbank/netbank02/)\nspecifically, Gozi.\n\nIn light of the product’s popularity in Japan, it is not surprising that the new Ursnif variant\n[added an Anti-PhishWall module similar to other trojans in the past such as Shifu and](https://www.virusbulletin.com/virusbulletin/2015/11/shifu-rise-self-destructive-banking-trojan)\n[Bebloh.](https://www.hybrid-analysis.com/sample/a91cc0ef59dee1229644bd70f7744bd94d2af6dae19a1cbae685ed06fce707ea?environmentId=1)\n\nThis module runs extensive tests to detect and disable the PhishWall product and browser\nplugin:\n\n1. It checks the registry for if the PhishWall key is present. If it is present, it locates the\nsbpwu.exe process and terminates it.\n\n2. It checks for a second process (“PhishWall5.1.exe”) and attempts to terminate it.\n\n\n-----\n\n3. It enumerates Firefox’s browser extensions for the PhishWall extension\n“\\extensions\\info.asia@securebrain.co.jp.xpi”. If it finds it, it will attempt to terminate Firefox.\n\n4. Lastly, it attempts to locate the following CLSID in the registry, which are associated with\nPhishWall:\n\n\n-----\n\n[8CA7E745-EF75-4E7B-BB86-8065C0CE29CA](https://www.systemlookup.com/CLSID/34080-sbpw32_dll.html)\n\n[BB62FFF4-41CB-4AFC-BB8C-2A4D4B42BBDC](http://toolbarcollection.com/toolbar_detail.php?toolbar_id=8101&name=PhishWall)\n\nImportant note: The author of this article did not test the Anti-PhishWall code and cannot\nattest to its validity or quality.\n\n**Anti-Rapport Module**\n\n[While Ursnif’s alleged Anti-Rapport module is not new, it is quite rare to see this module](https://www.vkremez.com/2018/08/lets-learn-in-depth-reversing-of-recent.html)\namong the variants that hit Japan recently. [Rapport is an endpoint protection product by](https://www.ibm.com/us-en/marketplace/phishing-and-malware-protection)\n[IBM’s Trusteer. Over the years, there have been several types of malware that claimed to](https://www.ibm.com/security/fraud-protection/trusteer)\nbypass or disable Rapport.\n\nThis Ursnif variant comes with an Anti-Rapport module which seems heavily based, on\n[Carberp’s Anti-Rapport code. This code was leaked in 2013 and is publicly available on](https://krebsonsecurity.com/2013/06/carberp-code-leak-stokes-copycat-fears/)\nGithub.\n\n\n-----\n\nExcerpt from the Anti-Rapport code found in the new variant:\n\nThe variant’s code shows great resemblance to Carberp’s [code on Github:](https://github.com/hzeroo/Carberp/blob/master/source%20-%20absource/pro/all%20source/anti_rapport/antirapport.cpp)\n\nImportant note: The author of this article did not test the Anti-Rapport code and cannot attest\nto its validity or quality.\n\n## Conclusion\n\nUrsnif and Bebloh continue to be among the most common information stealing trojans that\ntarget Japanese users. The development cycle and the introduction of targeted delivery\ntechniques and variants observed in Japan is quite frequent. It changes tactics every one to\ntwo months, in an attempt to evade detection by traditional security products and some\nsandbox solutions.\n\nWhat stands out in these campaigns is the great effort made by threat actors to target\nJapanese users, using multiple checks to verify that the targeted users are Japanese. These\nmultiple tests prove to be quite effective not only in targeting the right crowd, but also in\nevading security products such as sandboxes, since the malicious code will not run unless\n\n\n-----\n\nthe country/language settings are properly configured. We assess that this new wave of\ncountry-based targeted delivery is likely to become more and more popular in future\ncampaigns.\n\nLastly, our research demonstrates that the new variant seems to be quite unique and\ncustomized for Japan. It comes with robust information stealing features that focus on mail\ndata, new evasive persistence mechanism and a module to bypass a Japanese security\nproduct. Some of the new features of this variant seem to draw inspiration from other trojans\nthat are popular in Japan, such as Bebloh and Shifu. According to Cybereason's telemetry,\nthis variant has been spotted only in Japan so far. It is interesting to see whether this new\nstrain of Ursnif will emerge in other geographical regions.\n\nWe have an on-demand webinar all about this research online.\n\n## Indicators of Compromise\n\nExcel Document (Macro)\n\nDA85A7DE0B48881EF09179B800D033F27E8F6A01\n\n6BEF7B72A0D314393FAE5F7915A5440DF2ABCF5F\n\nA1CC4B824A35B5E1A016AA9AC0FAC0866C66BFFC\n\n12E6EEA2EC60AC530CB6F683619ED4F571558C3F\n\nF23EDE071D9F0274430D06E2C6E33FF1B1803C5F\n\nB4707DA9396F1BBD3179A10F58815F1E58AC02FA\n\n.NET language checker\n\nEttivyph.dll - 14181A8F9ACF8B3C55076BEF21217EAF83062B5A\n\nUrsnif Loader (1st Stage):\n\ngyehtuegg.exe - 2B21C3237105DEE871C252633AE65125E78AC23E\n\nEwwhuptgfq.exe - 99882D848ADF3818AD758B951303F12649967247\n\nEhuwowstsg.exe - 6EABB986CBA048EE1B81BD884F6ABDD38B7CB5DA\n\nIiwrghesya.exe - F1F6E136EEAC66278359EB6DAF406FD8504107DB\n\nBthcan32.exe - C8488A58B5ECE9104AEFBBBB0334199E2E3C3D56\n\n\n-----\n\nAwerwyae.exe - 610B9128E56D488C7C2C700BD6C45A0250312129\n\nWinklogon.exe - 1D78AA605450C5C02D23BD065996A028A59DE365\n\nFEWPSQUUST.EXE - 8BB7240A38534881FDE3ADD2179EF9E908A09BE8\n\n1770BE655DB3AC9B6561F2CC91DD9CD5DEA3D69B\n\n0147FCC93C78A823BE94191FAE8A105549390C03\n\nUnpacked Loader (dumped from memory)\n\n1BB1BDA50D3C7BAD92872C4FE334203FB706E7C3\n\nClient64.dll (dumped from memory)\n\n8F6536397DC5E0D7699A1B2FDE87220C5D364A20\n\nB6CB96E57951C123B9A5F5D6E75455AFF9648BCB\n\nClient.dll (dumped from memory)\n\n35F7AD2300690E0EB95F6F327ACA57354D8103FF\n\nDomains\n\nbaderson[.]com\n\nMopscat[.]com\n\nGorsedog[.]com\n\nPintodoc[.]com\n\nRopitana[.]com\n\nPirenaso[.]com\n\nPapirosn[.]com\n\ndelcapen[.]com\n\nSteganography URLs\n\nhxxps://i.imgur[.]com/96vV0YR[.]png\n\nhxxp://oi65[.]tinypic[.]com/2z8thcz[.]jp\n\n\n-----\n\nAbout the Author\n\n**Cybereason Nocturnus**\n\nThe Cybereason Nocturnus Team has brought the world’s brightest minds from the military,\ngovernment intelligence, and enterprise security to uncover emerging threats across the\nglobe. They specialize in analyzing new attack methodologies, reverse-engineering malware,\nand exposing unknown system vulnerabilities. The Cybereason Nocturnus Team was the first\nto release a vaccination for the 2017 NotPetya and Bad Rabbit cyberattacks.\n\n[All Posts by Cybereason Nocturnus](https://www.cybereason.com/blog/authors/cybereason-nocturnus)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-03-12 - New Ursnif Variant targets Japan packed with new Features.pdf"
    ],
    "report_names": [
        "2019-03-12 - New Ursnif Variant targets Japan packed with new Features.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "adfbe698-24b2-41fc-a701-781fef330b16",
            "created_at": "2024-01-09T02:00:04.17648Z",
            "updated_at": "2025-03-27T02:00:03.274931Z",
            "deleted_at": null,
            "main_name": "GREF",
            "aliases": [],
            "source_name": "MISPGALAXY:GREF",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "0a03e7f0-2f75-4153-9c4f-c46d12d3962e",
            "created_at": "2022-10-25T15:50:23.453824Z",
            "updated_at": "2025-03-27T02:00:55.473216Z",
            "deleted_at": null,
            "main_name": "Ke3chang",
            "aliases": [
                "Ke3chang",
                "APT15",
                "Vixen Panda",
                "GREF",
                "Playful Dragon",
                "RoyalAPT",
                "Nylon Typhoon"
            ],
            "source_name": "MITRE:Ke3chang",
            "tools": [
                "Okrum",
                "Systeminfo",
                "netstat",
                "spwebmember",
                "Mimikatz",
                "Tasklist",
                "MirageFox",
                "Neoichor",
                "ipconfig"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "17b1b76b-16da-4c4f-8b32-f6fede3eda8c",
            "created_at": "2022-10-25T16:07:23.750796Z",
            "updated_at": "2025-03-27T02:02:09.961401Z",
            "deleted_at": null,
            "main_name": "Ke3chang",
            "aliases": [
                "APT 15",
                "BackdoorDiplomacy",
                "Bronze Davenport",
                "Bronze Idlewood",
                "Bronze Palace",
                "CTG-9246",
                "GREF",
                "Ke3chang",
                "Metushy",
                "Nylon Typhoon",
                "Operation Ke3chang",
                "Operation MirageFox",
                "Playful Dragon",
                "Playful Taurus",
                "Red Vulture",
                "Royal APT",
                "Social Network Team",
                "Vixen Panda"
            ],
            "source_name": "ETDA:Ke3chang",
            "tools": [
                "Agentemis",
                "Anserin",
                "BS2005",
                "BleDoor",
                "CarbonSteal",
                "Cobalt Strike",
                "CobaltStrike",
                "DarthPusher",
                "DoubleAgent",
                "EternalBlue",
                "GoldenEagle",
                "Graphican",
                "HenBox",
                "HighNoon",
                "IRAFAU",
                "Ketrican",
                "Ketrum",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "MS Exchange Tool",
                "Mebroot",
                "Mimikatz",
                "MirageFox",
                "NBTscan",
                "Okrum",
                "PluginPhantom",
                "PortQry",
                "ProcDump",
                "PsList",
                "Quarian",
                "RbDoor",
                "RibDoor",
                "Royal DNS",
                "RoyalCli",
                "RoyalDNS",
                "SAMRID",
                "SMBTouch",
                "SilkBean",
                "Sinowal",
                "SpyWaller",
                "Theola",
                "TidePool",
                "Torpig",
                "Turian",
                "Winnti",
                "XSLCmd",
                "cobeacon",
                "nbtscan",
                "netcat",
                "spwebmember"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535908,
    "ts_updated_at": 1743041810,
    "ts_creation_date": 1653693009,
    "ts_modification_date": 1653693009,
    "files": {
        "pdf": "https://archive.orkl.eu/59920372a3627c6cb4f634f72e8fc012759c9ae0.pdf",
        "text": "https://archive.orkl.eu/59920372a3627c6cb4f634f72e8fc012759c9ae0.txt",
        "img": "https://archive.orkl.eu/59920372a3627c6cb4f634f72e8fc012759c9ae0.jpg"
    }
}