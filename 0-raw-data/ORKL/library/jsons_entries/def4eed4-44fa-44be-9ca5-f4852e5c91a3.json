{
    "id": "def4eed4-44fa-44be-9ca5-f4852e5c91a3",
    "created_at": "2023-01-12T15:04:53.947025Z",
    "updated_at": "2025-03-27T02:05:26.663135Z",
    "deleted_at": null,
    "sha1_hash": "7aeb88d26a31abe96e32a1526349923e03af94a9",
    "title": "2020-07-01 - Threat Spotlight- Valak Slithers Its Way Into Manufacturing and Transportation Networks",
    "authors": "",
    "file_creation_date": "2022-05-27T21:31:58Z",
    "file_modification_date": "2022-05-27T21:31:58Z",
    "file_size": 1479406,
    "plain_text": "# Threat Spotlight: Valak Slithers Its Way Into Manufacturing and Transportation Networks\n\n**blog.talosintelligence.com/2020/07/valak-emerges.html**\n\n## Threat summary\n\n\n-----\n\nAttackers are actively distributing the Valak malware family around the globe, with\nenterprises, in particular, being targeted.\nThese campaigns make use of existing email threads from compromised accounts to\ngreatly increase success.\nThe additional use of password-protected ZIP files can create a blind spot in security\nprotections.\nThe overwhelming majority of campaigns occurred over the last couple of months and\ntargeted organizations in the financial, manufacturing, health care and insurance\nverticals.\n\n## Executive summary\n\nValak is a modular information-stealer that attackers have deployed to various countries\nsince early-to-mid 2019. While Valak features a robust feature set, it is often observed\n[alongside secondary malware payloads, including Gozi/Ursnif and](https://blog.talosintelligence.com/2018/03/gozi-isfb-remains-active-in-2018.html) [IcedID. This malware is](https://blog.talosintelligence.com/2018/04/icedid-banking-trojan.html)\ntypically delivered via malicious spam email campaigns that leverage password-protected\nZIP archives to evade detection by email security solutions that may inspect the contents of\n[emails entering corporate networks. While previous analysis focused on campaigns targeting](https://www.cybereason.com/blog/valak-more-than-meets-the-eye)\nthe United States and Germany, Cisco Talos has observed ongoing campaigns targeting\nother geographic regions including countries in North America, South America, Europe and\nlikely others. The email campaigns distributing downloaders associated with Valak also\nappear to be leveraging existing email threads to lend credibility to the emails and increase\nthe likelihood that victims will open file attachments and initiate the Valak infection process.\n\n### What's new?\n\nValak is a relatively new stealer that has greatly increased its distribution over the last\nseveral months. By using stolen email threads and password-protected ZIP files, Valak has\nenjoyed success compromising enterprises. Research shows that organizations are targeted\nrepeatedly by Valak in hopes of monetary gain.\n\n### How did it work?\n\nValak is spread through malspam campaigns. What makes this threat unique is its repeated\nuse of stolen email threads. By replying to existing conversations with their targets, the\nactors behind Valak greatly increased their success rate. Finally, the email attachments are\npassword-protected, preventing content analysis and inspection prior to reaching a user's\ndesktop.\n\n### So what?\n\n\n-----\n\nThe campaigns we analyzed have targeted major organizations in verticals such as energy,\nhealth care, finance, manufacturing and insurance. These targets need to be aware that\nexisting email threads are being hijacked with success and organizations will need to decide\nhow to address emails with password-protected attachments, if they accept them at all. As\nwe continue to get better at detecting and blocking spam messages adversaries will continue\nto move to novel approaches, like email thread hijacking.\n\n## Malspam campaigns\n\nIn most of the email campaigns observed, the emails consist of a reply message within an\nexisting email thread. In some cases, the previous messages in the email threads were\nseveral years old. The emails reference an attached ZIP archive and provide a password\nthat can be used to extract the contents of the archive.\n\nIn our analysis, we've identified a couple of patterns to highlight. One of the most important\nfindings is how this group appears to be targeting its victims. During our research, we found\nValak targeting financial, manufacturing, insurance and transportation organizations. This\nincluded multiple attempts to deliver malspam from different sources. Please note that due to\nthe use of stolen email threads, the emails are heavily redacted to protect the privacy of all\nparties involved.\n\n\n-----\n\n### Financials targeted\n\nIn this example, we will walk through emails observed over the course of a week directed at\na single financial institution. The modus operandi for this group is to use stolen/hijacked\nemail threads to send reply emails to target organizations. Below is the first example we saw\ndirected at the financial institution in question.\n\nThis email arrived early in the morning and was a response to an email from a couple of\nmonths earlier, in late February. Note the basic body, with a password-protected ZIP file. As\nis also common with these attacks, email signatures are also present. A few hours later,\nseveral other emails arrived — all from the same compromised email account. Each of these\nemails is addressed to a single unique recipient. This is something else we commonly saw\n— if there was an email thread with many participants, the actors chose to send a single\nemail message to each user instead of replying to all or sending a single email to multiple\ntargets.\n\n\n-----\n\nThe second email is similar to the first with one notable exception. This is a response from\nan email sent more than two years ago, in late March 2018. This was the first indicator that\nthese actors are hunting through the email accounts they have compromised looking for\nways to effectively target potential victims. Throughout the day, the emails would continue\nfrom this one email account.\n\n\n-----\n\nThe third email received was associated with an email thread from December 2017, but\nagain is a response to an existing email thread that this particular email account had with the\ntarget.\n\nThis final email from this account was a reply dating back to March 2018. The compromised\naccount in question was associated with a real estate company, so the emails ranged from\ninformation about properties and financing to showings and general friendly emails between\nassociates. This highlights why these campaigns can have a high success rate: They are\nsent from existing email threads between colleagues or acquaintances. This simple change\nwill greatly increase the likelihood of success. This combined with password-protected ZIP\nfiles can defeat a lot of email security and increase the likelihood of the email hitting the\ntarget's inbox.\n\nHowever, this particular email account was not the only one attempting to compromise this\nbank. We found several other examples that were received later that same day. This second\nbatch of requests shows a group that isn't looking for the best quality email threads to reply\nto.\n\n\n-----\n\nIn the case above, the adversaries hijacked an automated email sent by LinkedIn after two\nusers connect. Where the previous examples were tied to more robust email threads, this is\nan example of a less sophisticated attempt to compromise the same financial institution.\n\nIn this next example, on that same date, another email account was used to try and lure the\nvictim to infect themselves with Valak. This particular thread was personal and associated\nwith raffle prize winnings, again not necessarily the most effective avenue of attack, but\nthese actors are opportunistic and appear to be willing to try multiple lures against a target\norganization, regardless of the sophistication or relevance to the intended recipient.\n\nThese actors were not done trying to compromise this particular organization. Later in the\nweek, we observed another attempt, this time originating from the account of an IT\nconsultant.\n\n\n-----\n\nThis final example was in reference to an ongoing IT project the consultant was involved in,\nas you can imagine this could be an increasingly effective lure.\n\nOver the course of our investigation, we found 14 unique emails sent over a period of 10\ndays. These emails were associated with eight different compromised email accounts and\naddressed a wide variety of topics, again reiterating the actors' use of all emails they can find\nassociated with a specific target, in this case, a financial institution.\n\n### Insurer targeted\n\nFinancial institutions weren't the only organizations we observed being targeted by Valak\ncampaigns. We also observed large insurance companies being targeted as well. In this\nexample, an insurer was targeted using a variety of different avenues. These included\nresponses to affidavit email threads from compromised email accounts at law firms, as\nshown below.\n\n\n-----\n\nThis is a response to an email that was generated by a state court system. By abusing a\nlawyer's email account, the attackers are again increasing the likelihood of success as\nlawyers will commonly send documents to clients, co-workers, and other colleagues.\n\nOther examples of lures sent to the insurer include personal threads related to religious\nactivities around the holidays and even individual users emailing about their respective\npolicies with their insurance agents, an example of which is shown below. In the case of the\ninsurer, we found more than 20 emails sent over a period of several weeks from eight\ndifferent email accounts. This again reinforces how organizations are being targeted by\nthese Valak campaigns.\n\n\n-----\n\nThese are just a handful of the email messages that we saw being abused by these actors.\nOne thing to note about the law firm mentioned above is that during our research we found\nthat several of the email accounts at that firm were being used to target a variety of\norganizations, including other law firms. This does indicate that at least some of these emails\nmay be associated with larger longer-term compromises.\n\n### Password protected attachment usage\n\nOne commonality to all the observed Valak campaigns is the use of password-protected\nattachments. There is an obvious tradeoff for the adversary in using these methods. By\npassword protecting the ZIP file they will bypass a lot of detection technologies, but it may\nalso decrease effectiveness. During our investigation we were able to find examples of these\nmalspam messages being forwarded around an organization and, in some cases to internal\nIT support personnel, to try and determine how to extract the contents. This really illustrates\ntwo points. The first is that it was able to bypass what email security, if any, was present at\nthe enterprises in question. Additionally, it shows that not all users are savvy enough to open\npassword-protected attachments and it may limit users, who would otherwise be susceptible\nto this attack, from being able to infect themselves.\n\n\n-----\n\nDuring the investigation, we observed that the same passwords were often leveraged across\nmultiple targets and malspam campaigns and did not appear to be specific to any individual\norganization.\n\n### Languages targeted\n\nIn the examples to this point, we focused on the English-language campaigns we uncovered.\nHowever, English was not the only language we found attackers leveraging. We also\nidentified several other campaigns, including campaigns in German, like one targeting a\ntransportation organization. An email associated with this German campaign is shown below.\n\nOne interesting note related to the campaign in German, many of the threads they were\nleveraging were in English, but the malicious reply message was always in German,\nsomething that would likely stand out to potential victims.\n\nIn addition to German campaigns, we also found some targeting email threads in Spanish. In\nthis case, the threads were in Spanish, but the malspam responses were in English, an\nexample of which you can find below. Please note that I have left the salutations in the\nemails to denote the use of Spanish, as the majority of the text needs to be redacted.\n\n\n-----\n\n### Evidence of consumer targeting\n\nWhile the majority of the emails we have observed distributing Valak are tied to enterprises,\nthey are not the only targets. During our investigation, we found examples of attempts being\nmade against personal email accounts, and in some cases, the adversaries made some poor\nchoices as to which emails to respond to. This shows a divergent approach from what we\nsaw in some of the more targeted emails, including accurate signature blocks and replying to\nrelevant threads.\n\nAs an example of one of these failures, we show here the actors responding to what is\nobviously dating spam, trying to entice the user to send an email to a third email account for\nfurther compromise. The Valak distributors still tried to respond as if it were a legitimate\nemail, showing that the automation they are using has its faults.\n\n\n-----\n\nIn another email mistake, the actors actually responded to what is clearly pharmaceutical\nspam and is not even a remotely legitimate email thread.\n\nThere were a handful of other obvious spam messages that these actors replied to, during\nthese campaigns. It is worth noting that these messages make up a much smaller\npercentage than those we saw targeting larger enterprises.\n\n\n-----\n\nHowever, it does point to two separate campaigns that may be ongoing. One that is targeting\nspecific organizations with an array of email messages from multiple different accounts and\nanother that appears to be responding to a wide array of emails directed at end-users,\nwithout much consideration for what thread the reply originated from.\n\n## Initial infection process\n\nAs previously mentioned, the emails associated with these distribution campaigns feature the\nuse of password-protected ZIP archives. By encrypting the contents of the email\nattachments, the attackers can ensure that content inspection and detection capabilities are\nunable to properly evaluate them. This also allows them to evade some automated analysis\nenvironments like sandboxes, as user interaction is required to decrypt the ZIP archives.\n\nMicrosoft Word documents inside these ZIP archives are used to initiate the Valak infection.\nMost of the documents analyzed feature the use of similar decoy images as the document in\nthe example below, however, they were localized with different language sets being used to\ndisplay a message to potential victims, instructing them to enable macros.\n\nWhen enabled, the embedded VBA macros function as a downloader and handle retrieving\nand executing the DLL associated with Valak.\n\n\n-----\n\nThe URL used to retrieve the malicious DLL has been obfuscated.\n\nThe previous series of arrays contain the URL hosting the malicious DLL as well as the local\nstorage location where the DLL will be stored:\n\nThe DLL is then retrieved from an attacker-controlled web server using UrlDownloadToFileA.\n\nThe DLL is then registered using regsvr32.exe, which initiates the Valak infection process.\n[The infection process has been covered extensively here and](https://labs.sentinelone.com/valak-malware-and-the-connection-to-gozi-loader-confcrew/) [here. Valak is a continuously](https://www.cybereason.com/blog/valak-more-than-meets-the-eye)\nevolving, modular malware family that features robust capabilities and is successful at\ninfecting systems across the various geographic regions targeted by these attackers. Over\nthe past few weeks, Cisco Talos observed multiple changes to the way in which Valak is\nretrieved, as well as an increase in the level of obfuscation in the configuration file used by\nthe malware's later stages. Recently, it appears that Valak is also leveraging compromised\nCMS servers to distribute the initial Valak DLL, an example of which is below:\n```\nhttp://digifish3[.]com/blog/wp-content/themes/busify/_eWTFIH4ngoi2PJUl.php?\nx=MDAwMSBskYeC02Ql3VG8Ae9TVFHu6uY34q-zd5ISLrA1LlMNJ88yi_SVZUlkWiyyC9gmFThkFMVkHIlaIDSlZPLLzSuvVgZWgWuujIh-VCBWg50AL-jKfRnl38NNw89_MLBalU19J9qyusiuA_X0pqC\n\n```\n\n-----\n\nAs previous analysis focused on the infection process itself, we will focus on analyzing the\ncharacteristics associated with the distribution and C2 infrastructure associated with this\nthreat.\n\n## Campaign analysis\n\n### Spam volume and victimology\n\nTalos was able to track the campaigns back to early 2020, with a couple of samples from\nearly in the year. However, the activity really appeared to explode over the last several\nmonths. As you can see below the activity in May and early June accounted for more 95% of\nthe overall Valak activity.\n\n\n-----\n\nThe Valak campaigns aren't marked with huge amounts of emails but given that they are\ncurating the emails they are sending from existing email threads, it makes logical sense. This\nuse of stolen email threads and password-protected ZIPs has been successful for the group\ndelivering Valak, so the likelihood of imposters is relatively high.\n\n### Valak distribution servers\n\nDuring the analysis of Valak distribution infrastructure, we observed DNS updates being\nmade frequently as new campaigns were launched by attackers. To track the movement of\nmalicious domains across the attacker infrastructure, Passive DNS data was used to track\nthe servers being used to deliver the initial Valak DLL to victims.\n\n\n-----\n\nWe discovered that a large portion of the infrastructure used to deliver the initial DLL was\nhosted across a relatively small number of hosting providers with servers primarily located in\nRussia and Ukraine.\n\n### Valak C2 servers\n\nIn addition to the infrastructure being used for the initial distribution of the DLL associated\nwith Valak, infected systems also communicate with C2 servers to transfer information and\nattempt to obtain additional modules and instructions to perform. In analyzing the C2\ninfrastructure associated with various Valak campaigns, we observed the same infrastructure\nassociated with a myriad of other malicious activities. Additionally, in multiple instances,\npassive DNS telemetry indicates that some of the systems used for C2 may have also been\n[leveraged as part of the MyKings and](https://blog.talosintelligence.com/2020/06/tor2mine-is-up-to-their-old-tricks-and_11.html) [Dark Cloud botnets, however, this may be coincidental](https://blog.talosintelligence.com/2018/03/gozi-isfb-remains-active-in-2018.html)\nand not intentional on the part of the attackers.\n\nWhile the majority of the servers used to distribute the initial Valak DLL files were hosted in a\nrelatively small number of different geographic regions, the C2 servers used to administer the\nbotnet were spread out across a larger number of regions. Many of the servers were hosted\nin the United States. Below is a high-level overview of the geographic region of the servers\nused for C2.\n\n\n-----\n\nThe campaigns associated with Valak appear to be relatively successful, likely because of\nperimeter security controls being unable to scan the initial attachments being sent to\npotential victims. Below is a graph showing the DNS activity from systems likely infected with\nValak attempting to communicate with one of the Valak C2 servers. As soon as the\ndistribution campaigns that leveraged this domain became active, infected systems\nimmediately began beaconing. Due to the way that C2 has been implemented, infected\nsystems are continuously establishing connections to malicious infrastructure, creating a\nconsistent amount of DNS-related traffic.\n\n## Conclusion\n\nIn a world where malspam is constantly being created and sent, the goal is to get to inboxes.\nWe as an industry are always getting better at detecting malspam and adversaries are\nalways going to be looking for ways to move ahead. We've seen with Emotet before and now\n\n\n-----\n\nwith Valak that stolen email is an effective way to increase not only the likelihood of getting to\na user's inbox but the user is going to be receptive of the malspam.\n\nOnce you combine that with the use of password-protected ZIP files, the effect can be quite\nsuccessful. As we've shown throughout this blog these Valak campaigns have proceeded\nand the resulting command and control traffic indicates, it's been productive. This puts\norganizations in a tough position. The use of stolen email threads means that the emails are\nunlikely to be blocked based on content and the use of password-protected ZIPs, prevents\nmost scanning. Organizations need to make a decision on whether or not they want to allow\npassword-protected files to be sent via email. Depending on the vertical and the\norganization, this may or may not be a valid option for mitigation.\n\nBy allowing password-protected files to be sent via email, endpoint security largely becomes\nthe final bastion before a compromise occurs. This key technology is only getting more\nimportant as encryption on the wire and sophisticated evasion become standard. Enterprises\nneed to also be adjusting hunting activities to look at what appears to be legitimate email\nthreads and potentially isolating all unscannable files received via email or through other\nmeans.\n\n## Coverage\n\nWays our customers can detect and block this threat are listed below.\n\n[Advanced Malware Protection (AMP) is ideally suited to prevent the execution of the](https://www.cisco.com/c/en/us/products/security/advanced-malware-protection)\nmalware used by these threat actors. Exploit Prevention present within AMP is designed to\nprotect customers from unknown attacks such as this automatically.\n\n\n-----\n\n[Cisco Cloud Web Security (CWS) or Web Security Appliance (WSA) web scanning prevents](https://www.cisco.com/c/en/us/products/security/cloud-web-security/index.html)\naccess to malicious websites and detects malware used in these attacks.\n\nCisco AMP users can use Orbital Advanced Search to run complex OSqueries to see if their\nendpoints are infected with this specific threat. For specific OSqueries on this threat, click\n[here.](https://github.com/Cisco-Talos/osquery_queries/blob/master/win_malware/malware_valak_registry.yaml)\n\n[Email Security can block malicious emails sent by threat actors as part of their campaign.](https://www.cisco.com/c/en/us/products/security/email-security-appliance/index.html)\n\n[Network Security appliances such as Next-Generation Firewall (NGFW), Next-Generation](https://www.cisco.com/c/en/us/products/security/firewalls/index.html)\n[Intrusion Prevention System (NGIPS), Cisco ISR, and Meraki MX.](https://www.cisco.com/c/en/us/products/security/intrusion-prevention-system-ips/index.html)\n\n[AMP Threat Grid helps identify malicious binaries and build protection into all Cisco Security](https://www.cisco.com/c/en/us/solutions/enterprise-networks/amp-threat-grid/index.html)\nproducts.\n\n[Umbrella, our secure internet gateway (SIG), blocks users from connecting to malicious](https://umbrella.cisco.com/)\ndomains, IPs, and URLs, whether users are on or off the corporate network.\n\nOpen Source Snort Subscriber Rule Set customers can stay up to date by downloading the\n[latest rule pack available for purchase on Snort.org. The following SIDs have been released](https://www.snort.org/products)\nto detect this threat: 54401-54404.\n\n## Indicators of Compromise (IOCs)\n\nThe following indicators of compromise have been observed as being associated with Valak.\n\n### Hashes\n\nA list of file hashes (SHA256) that have been observed as being associated with Valak can\nbe found [here.](https://storage.googleapis.com/blogs-images/ciscoblogs/1/2020/07/hashes-final.txt)\n\n### Domains\n\n[A list of domains that have been observed as being associated with Valak can be found here.](https://storage.googleapis.com/blogs-images/ciscoblogs/1/2020/07/domains-final.txt)\n\n### IP Addresses\n\nA list of IP addresses that have been observed as being associated with Valak can be found\n[here.](https://storage.googleapis.com/blogs-images/ciscoblogs/1/2020/07/ips-final.txt)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-07-01 - Threat Spotlight- Valak Slithers Its Way Into Manufacturing and Transportation Networks.pdf"
    ],
    "report_names": [
        "2020-07-01 - Threat Spotlight- Valak Slithers Its Way Into Manufacturing and Transportation Networks.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535893,
    "ts_updated_at": 1743041126,
    "ts_creation_date": 1653687118,
    "ts_modification_date": 1653687118,
    "files": {
        "pdf": "https://archive.orkl.eu/7aeb88d26a31abe96e32a1526349923e03af94a9.pdf",
        "text": "https://archive.orkl.eu/7aeb88d26a31abe96e32a1526349923e03af94a9.txt",
        "img": "https://archive.orkl.eu/7aeb88d26a31abe96e32a1526349923e03af94a9.jpg"
    }
}