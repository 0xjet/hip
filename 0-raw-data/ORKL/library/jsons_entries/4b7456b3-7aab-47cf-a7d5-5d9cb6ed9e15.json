{
    "id": "4b7456b3-7aab-47cf-a7d5-5d9cb6ed9e15",
    "created_at": "2022-12-27T17:06:19.386603Z",
    "updated_at": "2025-03-27T02:08:23.109597Z",
    "deleted_at": null,
    "sha1_hash": "f7fdd43eaa809b0db95d3c6ccfc9806ccd9bfb77",
    "title": "Iranian Government-Sponsored APT Actors Compromise Federal Network, Deploy Crypto Miner, Credential Harvester",
    "authors": "CISA, FBI",
    "file_creation_date": "2022-11-25T10:56:17Z",
    "file_modification_date": "2022-11-25T10:56:17Z",
    "file_size": 555642,
    "plain_text": "Co-Authored by:\n\nTLP:CLEAR\n\nProduct ID: AA22-320A\nNovember 16, 2022\n\nIranian Government-Sponsored APT Actors\nCompromise Federal Network, Deploy Crypto\nMiner, Credential Harvester\nSUMMARY\nFrom mid-June through mid-July 2022, CISA conducted an incident response engagement at a\nFederal Civilian Executive Branch (FCEB) organization where CISA observed suspected advanced\npersistent threat (APT) activity. In the course of incident response activities, CISA determined that\ncyber threat actors exploited the Log4Shell vulnerability in an unpatched VMware Horizon server,\ninstalled XMRig crypto mining software, moved laterally to the domain controller (DC), compromised\ncredentials, and then implanted Ngrok reverse proxies on several hosts to maintain persistence. CISA\nand the Federal Bureau of Investigation (FBI) assess that the FCEB network was compromised by\nIranian government-sponsored APT actors.\nCISA and FBI are releasing this Cybersecurity Advisory (CSA) providing the suspected Iranian\ngovernment-sponsored actors’ tactics, techniques, and procedures (TTPs) and indicators of\ncompromise (IOCs) to help network defenders detect and protect against related compromises.\nCISA and FBI encourage all organizations with affected VMware systems that did not immediately\napply available patches or workarounds to assume compromise and initiate threat hunting activities. If\nsuspected initial access or compromise is detected based on IOCs or TTPs described in this CSA,\nCISA and FBI encourage organizations to assume lateral movement by threat actors, investigate\nconnected systems (including the DC), and audit privileged accounts. All organizations, regardless of\nidentified evidence of compromise, should apply the recommendations in the Mitigations section of\nthis CSA to protect against similar malicious cyber activity.\nFor more information on Iranian government-sponsored Iranian malicious cyber activity, see CISA’s\nIran Cyber Threat Overview and Advisories webpage and FBI’s Iran Threats webpage.\nFor a downloadable copy of IOCs, see: AA22-320A.stix, 155 mb.\nTo report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local\nFBI field office or CISA’s 24/7 Operations Center at Report@cisa.gov or (888) 282- 0870. When available, please include\nthe following information regarding the incident: date, time, and location of the incident; type of activity; number of people\naffected; type of equipment used for the activity; the name of the submitting company or organization; and a designated\npoint of contact.\nThis document is marked TLP:CLEAR. Disclosure is not limited. Sources may use TLP:CLEAR when information carries\nminimal or no foreseeable risk of misuse, in accordance with applicable rules and procedures for public release. Subject to\nstandard copyright rules, TLP:CLEAR information may be distributed without restriction.\nFor more information on the Traffic Light Protocol, see cisa.gov/tlp/.\n\nTLP: CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\n\nTECHNICAL DETAILS\n\n``\n\nNote: This advisory uses the MITRE ATT&CK for Enterprise framework, version 12. See the MITRE\nATT&CK Tactics and Techniques section for a table of the threat actors’ activity mapped to MITRE\nATT&CK® tactics and techniques with corresponding mitigation and/or detection recommendations.\n\nOverview\nIn April 2022, CISA conducted retrospective analysis using EINSTEIN—an FCEB-wide intrusion\ndetection system (IDS) operated and monitored by CISA—and identified suspected APT activity on\nan FCEB organization’s network. CISA observed bi-directional traffic between the network and a\nknown malicious IP address associated with exploitation of the Log4Shell vulnerability (CVE-202144228) in VMware Horizon servers. In coordination with the FCEB organization, CISA initiated threat\nhunting incident response activities; however, prior to deploying an incident response team, CISA\nobserved additional suspected APT activity. Specifically, CISA observed HTTPS activity from IP\naddress 51.89.181[.]64 to the organization’s VMware server. Based on trusted third-party\nreporting, 51.89.181[.]64 is a Lightweight Directory Access Protocol (LDAP) server associated with\nthreat actors exploiting Log4Shell. Following HTTPS activity, CISA observed a suspected LDAP\ncallback on port 443 to this IP address. CISA also observed a DNS query for us‐nation‐ny[.]cf\nthat resolved back to 51.89.181[.]64 when the victim server was returning this Log4Shell LDAP\ncallback to the actors’ server.\nCISA assessed that this traffic indicated a confirmed compromise based on the successful callback to\nthe indicator and informed the organization of these findings; the organization investigated the activity\nand found signs of compromise. As trusted-third party reporting associated Log4Shell activity from\n51.89.181[.]64 with lateral movement and targeting of DCs, CISA suspected the threat actors had\nmoved laterally and compromised the organization’s DC.\nFrom mid-June through mid-July 2022, CISA conducted an onsite incident response engagement and\ndetermined that the organization was compromised as early as February 2022, by likely Iranian\ngovernment-sponsored APT actors who installed XMRig crypto mining software. The threat actors\nalso moved laterally to the domain controller, compromised credentials, and implanted Ngrok reverse\nproxies.\n\nThreat Actor Activity\nIn February 2022, the threat actors exploited Log4Shell [T1190] for initial access [TA0001] to the\norganization’s unpatched VMware Horizon server. As part of their initial exploitation, CISA observed a\nconnection to known malicious IP address 182.54.217[.]2 lasting 17.6 seconds.\nThe actors’ exploit payload ran the following PowerShell command [T1059.001] that added an\nexclusion tool to Windows Defender [T1562.001]:\npowershell try{Add-MpPreference -ExclusionPath 'C:\\'; Write-Host 'addedexclusion'} catch {Write-Host 'adding-exclusion-failed' }; powershell -enc\n\"$BASE64 encoded payload to download next stage and execute it\"\n\nPage 2 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\n``\nThe exclusion tool allowlisted the entire c:\\drive, enabling threat actors to download tools to the\nc:\\drive without virus scans. The exploit payload then downloaded mdeploy.text from\n182.54.217[.]2/mdepoy.txt to C:\\users\\public\\mde.ps1 [T1105]. When executed, mde.ps1\ndownloaded file.zip from 182.54.217[.]2 and removed mde.ps1 from the disk [T1070.004].\nfile.zip contained XMRig cryptocurrency mining software and associated configuration files.\n●\n\nWinRing0x64.sys – XMRig Miner driver\n\n●\n\nwuacltservice.exe – XMRig Miner\n\n●\n\nconfig.json – XMRig miner configuration\n\n●\n\nRuntimeBroker.exe – Associated file. This file can create a local user account [T1136.001]\nand tests for internet connectivity by pinging 8.8.8.8 [T1016.001]. The exploit payload\ncreated a Scheduled Task [T1053.005] that executed RuntimeBroker.exe daily as SYSTEM.\nNote: By exploiting Log4Shell, the actors gained access to a VMware service account with\nadministrator and system level access. The Scheduled Task was named\nRuntimeBrokerService.exe to masquerade as a legitimate Windows task.\n\nSee MAR 10387061-1.v1 for additional information, including IOCs, on these four files.\nAfter obtaining initial access and installing XMRig on the VMWare Horizon server, the actors used\nRDP [T1021.001] and the built-in Windows user account DefaultAccount [T1078.001] to move\nlaterally [TA0008] to a VMware VDI-KMS host. Once the threat actor established themselves on the\nVDI-KMS host, CISA observed the actors download around 30 megabytes of files from\ntransfer[.]sh server associated with 144.76.136[.]153. The actors downloaded the following\ntools:\n•\n•\n•\n\nPsExec – a Microsoft signed tool for system administrators.\nMimikatz – a credential theft tool.\nNgrok – a reverse proxy tool for proxying an internal service out onto an Ngrok domain, which\nthe user can then access at a randomly generated subdomain at *.ngrok[.]io. CISA has\nobserved this tool in use by some commercial products for benign purposes; however, this\nprocess bypasses typical firewall controls and may be a potentially unwanted application in\nproduction environments. Ngrok is known to be used for malicious purposes.[1]\n\nThe threat actors then executed Mimikatz on VDI-KMS to harvest credentials and created a rogue\ndomain administrator account [T1136.002]. Using the newly created account, the actors leveraged\nRDP to propagate to several hosts within the network. Upon logging into each host, the actors\nmanually disabled Windows Defender via the Graphical User Interface (GUI) and implanted Ngrok\nexecutables and configuration files. The threat actors were able to implant Ngrok on multiple hosts to\nensure Ngrok’s persistence should they lose access to a machine during a routine reboot. The actors\nwere able to proxy [T1090] RDP sessions, which were only observable on the local network as\noutgoing HTTPS port 443 connections to tunnel.us.ngrok[.]com and korgn.su.lennut[.]com\n\nPage 3 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\n\n``\n(the prior domain in reverse). It is possible, but was not observed, that the threat actors configured a\ncustom domain, or used other Ngrok tunnel domains, wildcarded here as *.ngrok[.]com,\n*.ngrok[.]io, ngrok.*.tunnel[.]com, or korgn.*.lennut[.]com.\nOnce the threat actors established a deep foothold in the network and moved laterally to the domain\ncontroller, they executed the following PowerShell command on the Active Directory to obtain a list of\nall machines attached to the domain [T1018]:\nPowershell.exe get-adcomputer -filter * -properties * | select\nname,operatingsystem,ipv4address &gt;\nThe threat actors also changed the password for the local administrator account [T1098] on several\nhosts as a backup should the rogue domain administrator account get detected and terminated.\nAdditionally, the threat actor was observed attempting to dump the Local Security Authority\nSubsystem Service (LSASS) process [T1003.001] with task manager but this was stopped by\nadditional anti-virus the FCEB organization had installed.\n\nMITRE ATT&CK TACTICS AND TECHNIQUES\nSee table 1 for all referenced threat actor tactics and techniques in this advisory, as well as\ncorresponding detection and/or mitigation recommendations. For additional mitigations, see the\nMitigations section.\nTable 1: Cyber Threat Actors ATT&CK Techniques for Enterprise\nInitial Access\nTechnique Title\n\nID\n\nExploit PublicFacing Application\n\nT1190\n\nUse\n\nRecommendations\n\nThe actors exploited\nLog4Shell for initial\naccess to the\norganization’s VMware\nHorizon server.\n\nMitigation/Detection: Use a firewall\nor web-application firewall and\nenable logging to prevent and detect\npotential Log4Shell exploitation\nattempts [M1050].\nMitigation: Perform regular\nvulnerability scanning to detect\nLog4J vulnerabilities and update\nLog4J software using vendor\nprovided patches [M1016],[M1051].\n\nPage 4 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\n``\nExecution\nTechnique Title\n\nID\n\nUse\n\nRecommendation\n\nCommand and\nScripting Interpreter:\nPowerShell\n\nT1059.001\n\nThe actors ran\nPowerShell commands\nthat added an\nexclusion tool to\nWindows Defender.\n\nMitigation: Disable or remove\nPowerShell for non-administrative\nusers [M1042],[M1026] or enable\ncode-signing to execute only signed\nscripts [M1045].\n\nThe actors executed\nPowerShell on the AD\nto obtain a list of\nmachines on the\ndomain.\n\nMitigation: Employ anti-malware to\nautomatically detect and quarantine\nmalicious scripts [M1049].\n\nPersistence\nTechnique Title\nAccount\nManipulation\n\nCreate Account:\nLocal Account\n\nID\nT1098\n\nT1136.001\n\nUse\n\nRecommendations\n\nThe actors changed\nthe password for the\nlocal administrator\naccount on several\nhosts.\n\nMitigation: Use multifactor\nauthentication for user and\nprivileged accounts [M1032].\n\nThe actors’ malware\ncan create local user\naccounts.\n\nMitigation: Configure access\ncontrols and firewalls to limit access\nto domain controllers and systems\nused to create and manage\naccounts.\n\nDetection: Monitor events for\nchanges to account objects and/or\npermissions on systems and the\ndomain, such as event IDs 4738,\n4728, and 4670. Monitor for\nmodification of accounts in\ncorrelation with other suspicious\nactivity [DS0002].\n\nDetection: Monitor executed\ncommands and arguments for\nactions that are associated with\nlocal account creation, such as net\n\nPage 5 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\n``\n\nuser /add , useradd, and dscl create [DS0017].\nDetection: Enable logging for new\nuser creation [DS0002].\nCreate Account:\nDomain Account\n\nT1136.002\n\nThe actors used\nMimikatz to create a\nrogue domain\nadministrator account.\n\nMitigation: Configure access\ncontrols and firewalls to limit access\nto domain controllers and systems\nused to create and manage\naccounts.\nDetection: Enable logging for new\nuser creation, especially domain\nadministrator accounts [DS0002].\n\nScheduled\nTask/Job:\nScheduled Task\n\nT1053.005\n\nThe actors’ exploit\npayload created\nScheduled Task\nRuntimeBrokerServic\ne.exe, which executed\nRuntimeBroker.exe\ndaily as SYSTEM.\n\nMitigation: Configure settings for\nscheduled tasks to force tasks to\nrun under the context of the\nauthenticated account instead of\nallowing them to run as SYSTEM\n[M1028].\nDetection: Monitor for newly\nconstructed processes and/or\ncommand-lines that execute from\nthe svchost.exe in Windows 10\nand the Windows Task Scheduler\ntaskeng.exe for older versions of\nWindows [DS0009]\nDetection: Monitor for newly\nconstructed scheduled jobs by\nenabling the Microsoft-WindowsTaskScheduler/Operational\nsetting within the event logging\nservice [DS0003].\n\nValid Accounts:\nDefault Accounts\n\nT1078.001\n\nThe actors used built-in\nWindows user account\nDefaultAccount.\n\nMitigation: Change default\nusernames and passwords\nimmediately after the installation\nand before deployment to a\nproduction environment [M1027].\n\nPage 6 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\n``\n\nDetection: Develop rules to monitor\nlogon behavior across default\naccounts that have been activated\nor logged into [DS0028].\nDefense Evasion\nTechnique Title\nImpair Defenses:\nDisable or Modify\nTools\n\nID\n\nUse\n\nRecommendations\n\nT1562.001\n\nThe actors added an\nexclusion tool to\nWindows Defender.\nThe tool allowlisted the\nentire c:\\drive,\nenabling the actors to\nbypass virus scans for\ntools they downloaded\nto the c:\\drive.\n\nMitigation: Ensure proper user\npermissions are in place to prevent\nadversaries from disabling or\ninterfering with security services.\n[M1018].\n\nThe actors manually\ndisabled Windows\nDefender via the GUI.\n\nDetection: Monitor for changes\nmade to Windows Registry keys\nand/or values related to services\nand startup programs that\ncorrespond to security tools such as\nHKLM:\\SOFTWARE\\Policies\\Micro\nsoft\\Windows Defender [DS0024].\nDetection: Monitor for telemetry\nthat provides context for\nmodification or deletion of\ninformation related to security\nsoftware processes or services such\nas Windows Defender definition files\nin Windows and System log files in\nLinux [DS0013].\nDetection: Monitor processes for\nunexpected termination related to\nsecurity tools/services [DS0009].\n\nIndicator Removal\non Host: File\nDeletion\n\nT1070.004\n\nThe actors removed\nmalicious file mde.ps1\nfrom the dis.\n\nDetection: Monitor executed\ncommands and arguments for\nactions that could be utilized to\nunlink, rename, or delete files\n[DS0017].\n\nPage 7 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\n``\n\nDetection: Monitor for unexpected\ndeletion of files from the system\n[DS0022].\nCredential Access\nTechnique Title\n\nID\n\nOS Credential\nDumping: LSASS\nMemory\n\nT1003.001\n\nUse\n\nRecommendations\n\nThe actors were\nobserved trying to\ndump LSASS process.\n\nMitigation: With Windows 10,\nMicrosoft implemented new\nprotections called Credential Guard\nto protect the LSA secrets that can\nbe used to obtain credentials\nthrough forms of credential dumping\n[M1043]\nMitigation: On Windows 10, enable\nAttack Surface Reduction (ASR)\nrules to secure LSASS and prevent\ncredential stealing [M1040].\nMitigation: Ensure that local\nadministrator accounts have\ncomplex, unique passwords across\nall systems on the network [M1027].\nDetection: Monitor for unexpected\nprocesses interacting with\nLSASS.exe. Common credential\ndumpers such as Mimikatz access\nLSASS.exe by opening the process,\nlocating the LSA secrets key, and\ndecrypting the sections in memory\nwhere credential details are stored.\n[DS0009].\nDetection: Monitor executed\ncommands and arguments that may\nattempt to access credential\nmaterial stored in the process\nmemory of the LSASS [DS0017].\n\nPage 8 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\n``\nCredentials from\nPassword Stores\n\nT1555\n\nThe actors used\nMimikatz to harvest\ncredentials.\n\nMitigation: Organizations may\nconsider weighing the risk of storing\ncredentials in password stores and\nweb browsers. If system, software,\nor web browser credential\ndisclosure is a significant concern,\ntechnical controls, policy, and user\ntraining may be used to prevent\nstorage of credentials in improper\nlocations [M1027].\nDetection: Monitor for processes\nbeing accessed that may search for\ncommon password storage\nlocations to obtain user credentials\n[DS0009].\nDetection: Monitor executed\ncommands and arguments that may\nsearch for common password\nstorage locations to obtain user\ncredentials [DS0017].\n\nDiscovery\nTechnique Title\nRemote System\nDiscovery\n\nID\nT1018\n\nUse\n\nRecommendations\n\nThe actors executed a\nPowerShell command\non the AD to obtain a\nlist of all machines\nattached to the domain.\n\nDetection: Monitor executed\ncommands and arguments that may\nattempt to get a listing of other\nsystems by IP address, hostname,\nor other logical identifier on a\nnetwork that may be used for lateral\nmovement [DS0017].\nDetection: Monitor for newly\nconstructed network connections\nassociated with pings/scans that\nmay attempt to get a listing of other\nsystems by IP address, hostname,\nor other logical identifier on a\nnetwork that may be used for lateral\nmovement [DS0029].\n\nPage 9 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\n``\nDetection: Monitor for newly\nexecuted processes that can be\nused to discover remote systems,\nsuch as ping.exe and tracert.exe,\nespecially when executed in quick\nsuccession [DS0009].\nSystem Network\nConfiguration\nDiscovery: Internet\nConnection\nDiscovery\n\nT1016.001\n\nThe actors’ malware\ntests for internet\nconnectivity by pinging\n8.8.8.8.\n\nMitigation: Monitor executed\ncommands, arguments [DS0017]\nand executed processes (e.g.,\ntracert or ping) [DS0009] that\nmay check for internet connectivity\non compromised systems.\n\nLateral Movement\nTechnique Title\n\nID\n\nUse\n\nRemote Services:\nRemote Desktop\nProtocol\n\nT1021.001\n\nThe actors used RDP\nto move laterally to\nmultiple hosts on the\nnetwork.\n\nRecommendations\nMitigation: Use MFA for remote\nlogins [M1032].\nMitigation: Disable the RDP service\nif it is unnecessary [M1042].\nMitigation: Do not leave RDP\naccessible from the internet. Enable\nfirewall rules to block RDP traffic\nbetween network security zones\nwithin a network [M1030].\nMitigation: Consider removing the\nlocal Administrators group from the\nlist of groups allowed to log in\nthrough RDP [M1026].\nDetection: Monitor for user\naccounts logged into systems\nassociated with RDP (ex: Windows\nEID 4624 Logon Type 10). Other\nfactors, such as access patterns\n(ex: multiple systems over a\nrelatively short period of time) and\nactivity that occurs after a remote\nlogin, may indicate suspicious or\n\nPage 10 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\n``\nmalicious behavior with RDP\n[DS0028].\nCommand and Control\nTechnique Title\nProxy\n\nID\nT1090\n\nUse\nThe actors used Ngrok\nto proxy RDP\nconnections and to\nperform command and\ncontrol.\n\nRecommendations\nMitigation: Traffic to known\nanonymity networks and C2\ninfrastructure can be blocked\nthrough the use of network allow\nand block lists [M1037].\nDetection: Monitor and analyze\ntraffic patterns and packet\ninspection associated to protocol(s)\nthat do not follow the expected\nprotocol standards and traffic flows\n(e.g., extraneous packets that do\nnot belong to established flows,\ngratuitous or anomalous traffic\npatterns, anomalous syntax, or\nstructure) [DS0029].\n\nIngress Tool\nTransfer\n\nT1105\n\nThe actors downloaded\nmalware and multiple\ntools to the network,\nincluding PsExec,\nMimikatz, and Ngrok.\n\nMitigation: Employ anti-malware to\nautomatically detect and quarantine\nmalicious scripts [M1049].\n\nINCIDENT RESPONSE\nIf suspected initial access or compromise is detected based on IOCs or TTPs in this CSA, CISA\nencourages organizations to assume lateral movement by threat actors and investigate connected\nsystems and the DC.\nCISA recommends organizations apply the following steps before applying any mitigations, including\npatching.\n1. Immediately isolate affected systems.\n2. Collect and review relevant logs, data, and artifacts. Take a memory capture of the device(s)\nand a forensic image capture for detailed analysis.\n\nPage 11 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\n\n``\n3. Consider soliciting support from a third-party incident response organization that can provide\nsubject matter expertise to ensure the actor is eradicated from the network and to avoid\nresidual issues that could enable follow-on exploitation.\n4. Report incidents to CISA via CISA’s 24/7 Operations Center (report@cisa.gov or 888-2820870) or your local FBI field office or FBI’s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or\nby e-mail at CyWatch@fbi.gov.\n\nMITIGATIONS\nCISA and FBI recommend implementing the mitigations below and in table 1 to improve your\norganization's cybersecurity posture on the basis of threat actor behaviors.\n•\n\nInstall updated builds to ensure affected VMware Horizon and UAG systems are\nupdated to the latest version.\no If updates or workarounds were not promptly applied following VMware’s release of\nupdates for Log4Shell in December 2021, treat those VMware Horizon systems as\ncompromised. Follow the pro-active incident response procedures outlined above prior\nto applying updates. If no compromise is detected, apply these updates as soon as\npossible.\n See VMware Security Advisory VMSA-2021-0028.13 and VMware Knowledge\nBase (KB) 87073 to determine which VMware Horizon components are\nvulnerable.\n Note: Until the update is fully implemented, consider removing vulnerable\ncomponents from the internet to limit the scope of traffic. While installing the\nupdates, ensure network perimeter access controls are as restrictive as\npossible.\n If upgrading is not immediately feasible, see KB87073 and KB87092 for\nvendor-provided temporary workarounds. Implement temporary solutions using\nan account with administrative privileges. Note that these temporary solutions\nshould not be treated as permanent fixes; vulnerable components should be\nupgraded to the latest build as soon as possible.\n Prior to implementing any temporary solution, ensure appropriate backups\nhave been completed.\n Verify successful implementation of mitigations by executing the vendor\nsupplied script Horizon_Windows_Log4j_Mitigations.zip without\nparameters to ensure that no vulnerabilities remain. See KB87073 for details.\n\n•\n•\n\nKeep all software up to date and prioritize patching known exploited vulnerabilities (KEVs).\nMinimize the internet-facing attack surface by hosting essential services on a segregated\nDMZ, ensuring strict network perimeter access controls, and not hosting internet-facing\nservices that are not essential to business operations. Where possible, implement regularly\nupdated web application firewalls (WAF) in front of public-facing services. WAFs can protect\nagainst web-based exploitation using signatures and heuristics that are likely to block or alert\non malicious traffic.\n\nPage 12 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\n•\n\n``\nUse best practices for identity and access management (IAM) by implementing phishing\nresistant MFA, enforcing use of strong passwords, regularly auditing administrator accounts\nand permissions, and limiting user access through the principle of least privilege. Disable\ninactive accounts uniformly across the AD, MFA systems, etc.\no If using Windows 10 version 1607 or Windows Server 2016 or later, monitor or disable\nWindows DefaultAccount, also known as the Default System Managed Account\n(DSMA).\n\n•\n\nAudit domain controllers to log successful Kerberos Ticket Granting Service (TGS)\nrequests and ensure the events are monitored for anomalous activity.\no Secure accounts.\no Enforce the principle of least privilege. Administrator accounts should have the\nminimum permission necessary to complete their tasks.\no Ensure there are unique and distinct administrative accounts for each set of\nadministrative tasks.\no Create non-privileged accounts for privileged users and ensure they use the nonprivileged accounts for all non-privileged access (e.g., web browsing, email access).\n\n•\n\nCreate a deny list of known compromised credentials and prevent users from using\nknown-compromised passwords.\nSecure credentials by restricting where accounts and credentials can be used and by\nusing local device credential protection features.\no Use virtualizing solutions on modern hardware and software to ensure credentials are\nsecurely stored.\no Ensure storage of clear text passwords in LSASS memory is disabled. Note: For\nWindows 8, this is enabled by default. For more information see Microsoft Security\nAdvisory Update to Improve Credentials Protection and Management.\no Consider disabling or limiting NTLM and WDigest Authentication.\no Implement Credential Guard for Windows 10 and Server 2016 (refer to Microsoft:\nManage Windows Defender Credential Guard for more information). For Windows\nServer 2012R2, enable Protected Process Light for Local Security Authority (LSA).\no Minimize the AD attack surface to reduce malicious ticket-granting activity. Malicious\nactivity such as “Kerberoasting” takes advantage of Kerberos’ TGS and can be used to\nobtain hashed credentials that threat actors attempt to crack.\n\n•\n\nVALIDATE SECURITY CONTROLS\nIn addition to applying mitigations, CISA and FBI recommend exercising, testing, and validating your\norganization's security program against the threat behaviors mapped to the MITRE ATT&CK for\nEnterprise framework in this advisory. CISA and FBI recommend testing your existing security\ncontrols inventory to assess how they perform against the ATT&CK techniques described in this\nadvisory.\n\nPage 13 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR\n\nCISA | FBI\n\nTLP:CLEAR\nTo get started:\n\n``\n\n1.\n2.\n3.\n4.\n5.\n\nSelect an ATT&CK technique described in this advisory (see table 1).\nAlign your security technologies against the technique.\nTest your technologies against the technique.\nAnalyze your detection and prevention technologies performance.\nRepeat the process for all security technologies to obtain a set of comprehensive performance\ndata.\n6. Tune your security program, including people, processes, and technologies, based on the\ndata generated by this process.\nCISA and FBI recommend continually testing your security program, at scale, in a production\nenvironment to ensure optimal performance against the MITRE ATT&CK techniques identified in this\nadvisory.\n\nREFERENCES\n[1] MITRE ATT&CK Version 12: Software – Ngrok\n\nPage 14 of 14 | Product ID: AA22-320A\n\nTLP:CLEAR",
    "language": "EN",
    "sources": [
        {
            "id": "4e039bf8-7239-4999-8ec0-eb202d1465af",
            "created_at": "2022-12-04T11:19:36.52593Z",
            "updated_at": "2022-12-04T11:19:36.52593Z",
            "deleted_at": null,
            "name": "ORKL",
            "url": "https://github.com/ORKL/library",
            "description": "ORKL Community Contributed Content",
            "reports": null
        }
    ],
    "references": [
        "https://www.cisa.gov/uscert/ncas/alerts/aa22-320a",
        "https://www.cisa.gov/uscert/sites/default/files/publications/aa22-320a_joint_csa_iranian_government-sponsored_apt_actors_compromise_federal%20network_deploy_crypto%20miner_credential_harvester.pdf"
    ],
    "report_names": [
        "aa22-320a_joint_csa_iranian_government-sponsored_apt_actors_compromise_federal network_deploy_crypto miner_credential_harvester.pdf"
    ],
    "threat_actors": [
        {
            "id": "81dde5cc-c29f-430d-8c6e-e5e92d5015e7",
            "created_at": "2022-10-25T16:07:23.704358Z",
            "updated_at": "2025-03-27T02:02:09.932453Z",
            "deleted_at": null,
            "main_name": "Harvester",
            "aliases": [],
            "source_name": "ETDA:Harvester",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "Graphon",
                "Metasploit",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1672160779,
    "ts_updated_at": 1743041303,
    "ts_creation_date": 1669373777,
    "ts_modification_date": 1669373777,
    "files": {
        "pdf": "https://archive.orkl.eu/f7fdd43eaa809b0db95d3c6ccfc9806ccd9bfb77.pdf",
        "text": "https://archive.orkl.eu/f7fdd43eaa809b0db95d3c6ccfc9806ccd9bfb77.txt",
        "img": "https://archive.orkl.eu/f7fdd43eaa809b0db95d3c6ccfc9806ccd9bfb77.jpg"
    }
}