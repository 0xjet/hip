{
    "id": "36a4d772-7e25-471d-a902-8e9ec4fa22fd",
    "created_at": "2023-01-12T15:01:54.996428Z",
    "updated_at": "2025-03-27T02:15:06.187777Z",
    "deleted_at": null,
    "sha1_hash": "838d9a3ba0d973b3b680b48984db3b83c4b290d3",
    "title": "2021-08-17 - Confucius Uses Pegasus Spyware-related Lures to Target Pakistani Military",
    "authors": "",
    "file_creation_date": "2022-05-28T15:22:01Z",
    "file_modification_date": "2022-05-28T15:22:01Z",
    "file_size": 866767,
    "plain_text": "# Confucius Uses Pegasus Spyware-related Lures to Target Pakistani Military\n\n**[trendmicro.com/en_us/research/21/h/confucius-uses-pegasus-spyware-related-lures-to-target-pakistani.html](https://www.trendmicro.com/en_us/research/21/h/confucius-uses-pegasus-spyware-related-lures-to-target-pakistani.html)**\n\nAugust 17, 2021\n\nFigure 1. Spear-phishing email from early August. Notice the insertion of logos from the Pakistani Army, Air Force,\nNavy, and PR department.\nIf the target clicks on either the link or on the “unsubscribe” link, it will download a Word document from the\ndomain parinari[.]xyz.\n\nThe emails are sent either from an ExpressVPN exit node in Pakistan, or from a mail server under the attacker’s\ncontrol.\n\n## Examining the encrypted document containing macros\n\nAfter entering the password mentioned in the message, a document containing macros is displayed on screen.\n\n\n-----\n\nFigure 2. Malicious document containing macros\nIf the victim enables macros, the malicious code will be loaded. If the victim enters any phone number and clicks\n“SUBMIT,” the text field will be replaced by the message “Phone Number Not Found.”\n\nBehind the scenes, a .NET DLL file named skfk.txt, which is filled with content found inside the “Comments”\nproperty of the document, is created in the temporary directory. The file is then loaded in memory via PowerShell.\n\nStage 1 is a simple download & execute program. It downloads an ASCII file from the same domain and converts\nit into binary before loading it on to the memory and jump to a dynamic function.\n\nStage 2 is also .NET DLL file that downloads a third file from parinari[.]xyz, converts it from ASCII to binary, and\nthen creates a scheduled task to load it.\n\nStage 3 is similar to stage 1, with the only change being the URL to retrieve the next stage.\n\nStage 4 is the final payload (analyzed in the next section) it is never written in clear text to the file disk\n\n\n-----\n\nFigure 3. File stealer loading scheme\nIt should be noted that most of the compilation timestamps of these DLL files have been modified by the attacker\nto a year in the far future (2060, 2099 …), and the server IP addresses are often hidden behind CloudFlare.\n\n## Analysis of the file stealer\n\nThe final payload is a .NET DLL file designed to steal documents and images with the following extensions:\n\nFile extension Description\n\nTXT Text file\n\nPDF PDF file\n\nPNG Image file in PNG format\n\nJPG Image file in JPG format\n\nDOC Word document\n\nXLS Excel document\n\nXLM Excel document with macros\n\nODP OpenDocument Presentation\n\nODS OpenDocument Sheet\n\n\n-----\n\nODT OpenDocument Text\n\nRTF Rich Text Format file\n\nPPT PowerPoint document\n\nXLSX Excel document\n\nXLSM Excel document with macros\n\nDOCX Word document\n\nPPTX PowerPoint document\n\nJPEG Image file in JPEG format\n\nThe “Documents,” “Downloads,” “Desktop,” and “Pictures” folders of every user are checked. The DLL file also\nexamines drives other than C:.\n\n\n-----\n\nFigure 4. Code showing the main function of the file stealer\nWhen a file matching one of the listed extensions is found, its MD5 hash is calculated and compared to an\nexclusion list retrieved from the command-and-control (C&C) server pirnaram[.]xyz.\n\nIf the hash is not listed, the file is sent via the C&C to a directory named after the concatenation of the machine\nname and the username. The exclusion list is different for every machine name-username string.\n\n## Other campaigns\n\nDuring our monitoring of Confucius, we came across a campaign delivering the same payload, using a different\n[lure. In this instance, the campaign impersonated the Pakistani Defense Housing Authority. Again, this threat](https://en.wikipedia.org/wiki/Defence_Housing_Authority)\nactor’s interest in military personnel is obvious.\n\n\n-----\n\nFigure 5. Spear-phishing email from early August\nThe lures used in an older campaign from April 2021 impersonated the Federal Board of Revenue. There were\nminor differences in tools, tactics, and procedures: the malicious document was directly attached to the spear\nphishing email — still encrypted — and the decryption password was sent in a different email. The first stage was\nalso hidden in the “Comments” section. However, the second stage contained the final payload, which was once\nagain a file stealer with the exact same structure (a .NET DLL). Instead of exfiltrating the files through PHP scripts,\nthey were done via FTP server.\n\nIt should be noted that in some occasions, the threat actor sent spear-phishing emails from the domain name\n[mailerservice[.]directory which we attributed to the Patchwork threat actor in previous research. We disclosed](https://documents.trendmicro.com/assets/tech-brief-untangling-the-patchwork-cyberespionage-group.pdf)\n[multiple](https://www.trendmicro.com/en_us/research/18/h/the-urpage-connection-to-bahamut-confucius-and-patchwork.html) [links between Patchwork and Confucius threat actors in the past, so this came as no surprise to us.](https://www.first.org/resources/papers/tallinn2019/Linking_South_Asian_cyber_espionnage_groups-to-publish.pdf)\n\n## The creative use of social engineering lures and how to defend against them\n\n\n-----\n\nIn our [previous research, we already found Confucius, which is known for targeting Pakistan military for espionage](https://documents.trendmicro.com/assets/research-deciphering-confucius-cyberespionage-operations.pdf)\npurposes, employing multiple file stealers. While the code quality of its payloads is not of the highest standard, this\nthreat actor uses innovative techniques when crafting its malicious documents, such as hiding malicious code in\nthe comments section, or using encrypted documents to prevent automatic analysis. Therefore, it’s highly likely\nthat Confucius will continue to experiment and try out different kinds of social engineering lures in future\ncampaigns.\n\nDespite the variety of lures used by the threat actor, best security practices still apply to these attacks. Users\nshould always be wary and avoid clicking on any link or downloading any file from unsolicited emails or suspicious\nsources. Red flags such as unusual sender domains or grammatical and spelling errors are also a sign that the\nemail is malicious in nature, or at the very least, should be approached with proper security protocols in mind.\n\nThe following security solutions can also protect users from email-based attacks:\n\n**[Trend Micro™ Cloud App Security– Enhances the security of Microsoft Office 365 and other cloud](https://www.trendmicro.com/en_us/business/products/user-protection/sps/email-and-collaboration/cloud-app-security.html)**\nservices via computer vision and real-time scanning. It also protects organizations from email-based threats.\n**[Trend Micro™ Deep Discovery™ Email Inspector– Defends users through a combination of real-time](https://www.trendmicro.com/en_us/business/products/user-protection/sps/email-and-collaboration/email-inspector.html)**\nscanning and advanced analysis techniques for known and unknown attacks.\n\n## Indicators of Compromise\n\n Hashes of the malicious encrypted documents:\n\nSHA256 Detection name\n\ndacf7868a71440a7d7d8797caca1aa29b7780801e6f3b3bc33123f16989354b2 Trojan.W97M.CONFUCIUS.A\n\n0f6bcbdf4d192f8273887f9858819dd4690397a92fb28a60bb731c873c438e07 Trojan.W97M.CONFUCIUS.B\n\n508bcc1f3906f5641116cde26b830b43f38f9c68a32b67e03a3e7e3f920b1f4a Trojan.W97M.CONFUCIUS.B\n\n654c7021a4482da21e149ded58643b279ffbce66badf1a0a7fc3551acd607312 Trojan.W97M.CONFUCIUS.C\n\n712172b5b1895bbfcced961a83baa448e26e93e301be407e6b9dc8cb6526277f Trojan.Win32.DLOADR.TIOIBELQ\n\nURLs/Domains/IP Addresses\n\n**Server hosting malicious documents**\n\nparinari[.]xyz\n\n**Server used for file exfiltration**\n\npirnaram[.]xyz\n\n**Domain names linked to other campaigns**\n\n\n-----\n\npemra[.]email\n\nispr[.]email\n\nfbr[.]news\n\ndefencepk[.]email\n\npakistanarmy[.]email\n\npmogovpk[.]email\n\nmailerservice[.]directory\n\nfile-dnld[.]com\n\nfuntifu[.]live\n\ncnic-update[.]com\n\ncnic-ferify[.]live\n\nfbr-update[.]com\n\ndownload.fbr[.]tax\n\nsupport-team[.]tech\n\napi.priveetalk[.]com\n\nSender email addresses\n\nlatest_info@fbr.news\n\nnotice@fbr.news\n\nalert@fbr.news\n\nthenewsinernational@mailerservice.directory\n\nAPT & Targeted Attacks\n\nWhile investigating the Confucius threat actor, we found a recent spear phishing campaign that utilizes Pegasus\nspyware-related lures to entice victims into opening a malicious document downloading a file stealer.\n\n\n-----\n\nBy: Daniel Lunghi August 17, 2021 Read time: ( words)\n\nContent added to Folio\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-17 - Confucius Uses Pegasus Spyware-related Lures to Target Pakistani Military.pdf"
    ],
    "report_names": [
        "2021-08-17 - Confucius Uses Pegasus Spyware-related Lures to Target Pakistani Military.pdf"
    ],
    "threat_actors": [
        {
            "id": "caf95a6f-2705-4293-9ee1-6b7ed9d9eb4c",
            "created_at": "2022-10-25T15:50:23.472432Z",
            "updated_at": "2025-03-27T02:00:55.479021Z",
            "deleted_at": null,
            "main_name": "Confucius",
            "aliases": [
                "Confucius",
                "Confucius APT"
            ],
            "source_name": "MITRE:Confucius",
            "tools": [
                "WarzoneRAT"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "732bfd4b-8c15-42a5-ac4b-14a9a4b902e9",
            "created_at": "2022-10-25T16:07:23.38079Z",
            "updated_at": "2025-03-27T02:02:09.771357Z",
            "deleted_at": null,
            "main_name": "Bahamut",
            "aliases": [],
            "source_name": "ETDA:Bahamut",
            "tools": [
                "Bahamut",
                "DownPaper"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "37714790-40c0-4b6b-8e49-1c8f45a0463f",
            "created_at": "2022-10-25T16:07:24.37091Z",
            "updated_at": "2025-03-27T02:02:10.196909Z",
            "deleted_at": null,
            "main_name": "Urpage",
            "aliases": [],
            "source_name": "ETDA:Urpage",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f99641e0-2688-47b0-97bc-7410659d49a0",
            "created_at": "2023-01-06T13:46:38.802141Z",
            "updated_at": "2025-03-27T02:00:02.922907Z",
            "deleted_at": null,
            "main_name": "Bahamut",
            "aliases": [],
            "source_name": "MISPGALAXY:Bahamut",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ada9e5d3-1cb2-4b70-a3c8-96808c304ac8",
            "created_at": "2022-10-25T15:50:23.6515Z",
            "updated_at": "2025-03-27T02:00:55.513513Z",
            "deleted_at": null,
            "main_name": "Windshift",
            "aliases": [
                "Windshift",
                "Bahamut"
            ],
            "source_name": "MITRE:Windshift",
            "tools": [
                "WindTail"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7a8dbc5e-51a8-437a-8540-7dcb1cc110b8",
            "created_at": "2022-10-25T16:07:23.482856Z",
            "updated_at": "2025-03-27T02:02:09.827887Z",
            "deleted_at": null,
            "main_name": "Confucius",
            "aliases": [],
            "source_name": "ETDA:Confucius",
            "tools": [
                "ApacheStealer",
                "ByeByeShell",
                "ChatSpy",
                "Confucius",
                "MY24",
                "Sneepy",
                "remote-access-c3",
                "sctrls",
                "sip_telephone",
                "swissknife2"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8fddd571-37dc-4bb2-84b4-e41ac6fd11f5",
            "created_at": "2024-02-08T02:00:04.32487Z",
            "updated_at": "2025-03-27T02:00:03.329395Z",
            "deleted_at": null,
            "main_name": "Urpage",
            "aliases": [],
            "source_name": "MISPGALAXY:Urpage",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "7ea1e0de-53b9-4059-802f-485884180701",
            "created_at": "2022-10-25T16:07:24.04846Z",
            "updated_at": "2025-03-27T02:02:10.090459Z",
            "deleted_at": null,
            "main_name": "Patchwork",
            "aliases": [
                "APT-C-09",
                "ATK 11",
                "Capricorn Organisation",
                "Chinastrats",
                "Dropping Elephant",
                "Maha Grass",
                "Quilted Tiger",
                "TG-4410",
                "Thirsty Gemini",
                "Zinc Emerson"
            ],
            "source_name": "ETDA:Patchwork",
            "tools": [
                "AndroRAT",
                "Artra Downloader",
                "ArtraDownloader",
                "AutoIt backdoor",
                "BADNEWS",
                "BIRDDOG",
                "Bahamut",
                "Bozok",
                "Bozok RAT",
                "Brute Ratel",
                "Brute Ratel C4",
                "CinaRAT",
                "Crypta",
                "ForeIT",
                "JakyllHyde",
                "Loki",
                "Loki.Rat",
                "LokiBot",
                "LokiPWS",
                "NDiskMonitor",
                "Nadrac",
                "PGoShell",
                "PowerSploit",
                "PubFantacy",
                "Quasar RAT",
                "QuasarRAT",
                "Ragnatela",
                "Ragnatela RAT",
                "SocksBot",
                "TINYTYPHON",
                "Unknown Logger",
                "WSCSPL",
                "Yggdrasil"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9c884c88-2c9f-49c5-856a-2383ad1d8ef8",
            "created_at": "2024-05-01T02:03:08.152Z",
            "updated_at": "2025-03-27T02:05:17.422887Z",
            "deleted_at": null,
            "main_name": "ZINC EMERSON",
            "aliases": [
                "Dropping Elephant ",
                "EHDevel ",
                "Manul ",
                "Monsoon ",
                "Operation Hangover ",
                "Patchwork ",
                "TG-4410 ",
                "Viceroy Tiger ",
                "Confucius "
            ],
            "source_name": "Secureworks:ZINC EMERSON",
            "tools": [
                " Hanove",
                " Mac OS X KitM Spyware",
                " Proyecto2",
                " YTY Backdoor",
                "Enlighten Infostealer"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c81067e0-9dcb-4e3f-abb0-80126519c5b6",
            "created_at": "2022-10-25T15:50:23.285448Z",
            "updated_at": "2025-03-27T02:00:55.42906Z",
            "deleted_at": null,
            "main_name": "Patchwork",
            "aliases": [
                "Hangover Group",
                "Dropping Elephant",
                "Chinastrats",
                "Operation Hangover"
            ],
            "source_name": "MITRE:Patchwork",
            "tools": [
                "NDiskMonitor",
                "QuasarRAT",
                "BackConfig",
                "TINYTYPHON",
                "AutoIt backdoor",
                "PowerSploit",
                "BADNEWS",
                "Unknown Logger",
                "Socksbot"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535714,
    "ts_updated_at": 1743041706,
    "ts_creation_date": 1653751321,
    "ts_modification_date": 1653751321,
    "files": {
        "pdf": "https://archive.orkl.eu/838d9a3ba0d973b3b680b48984db3b83c4b290d3.pdf",
        "text": "https://archive.orkl.eu/838d9a3ba0d973b3b680b48984db3b83c4b290d3.txt",
        "img": "https://archive.orkl.eu/838d9a3ba0d973b3b680b48984db3b83c4b290d3.jpg"
    }
}