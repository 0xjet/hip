{
    "id": "27f8686a-71a5-4d11-bf75-e081cd8edbc1",
    "created_at": "2023-01-12T15:05:16.951763Z",
    "updated_at": "2025-03-27T02:06:03.956297Z",
    "deleted_at": null,
    "sha1_hash": "8b76a9e38ada368578a7e7cb42ef41dc1958f686",
    "title": "2022-11-02 - Could Threat Actors Be Downgrading Their Malware to Evade Detection-",
    "authors": "",
    "file_creation_date": "2022-11-28T18:59:02Z",
    "file_modification_date": "2022-11-28T18:59:02Z",
    "file_size": 1780437,
    "plain_text": "# Could Threat Actors Be Downgrading Their Malware to Evade Detection?\n\n**[nozominetworks.com/blog/could-threat-actors-be-downgrading-their-malware-to-evade-detection/](https://www.nozominetworks.com/blog/could-threat-actors-be-downgrading-their-malware-to-evade-detection/)**\n\nby Nozomi Networks Labs November 2, 2022\n\nThreat actors are known to modify their malware to evade detection and make additional\nprofits. They do this by changing the file name and IP address, along with other features.\nThis gives them an advantage, as it makes detection more difficult and helps them stay\nunder the radar. The modifications are so common that we noticed not only upgraded but\nalso downgraded versions of the same malware, which could be part of a broader threat\nactor strategy.\n\nThese upgraded/downgraded versions may suggest the existence of modular malware\ncapabilities, with customers who pay extra getting access to additional and/or unique\nfeatures. This may also suggest that threat actors are tailoring payloads for each campaign\nto avoid revealing all of a malware’s functionality to researchers at once. After analyzing\nseveral malware types, we decided to focus on the Gafgyt malware family, which is known to\ntarget IoT devices, such as routers, to launch Denial of Service (DoS) attacks.\n\nIt requires a certain effort for security researchers stay on top of the latest botnet\ndevelopments and their changes. That’s why Nozomi Networks focuses on detecting\nmalicious servers across the internet, in order to better understand malware behavior and\nenhance the protection of our customers. In this blog, we introduce the first and second\nstage of the Gafgyt malware, its variants/modifications, and provide Indicators of\nCompromise (IoC)s for detecting malicious activity.\n\n\n-----\n\nThe number of botnet-related malware families has increased significantly.\n\n## First Stage – Initial Access\n\nOne of the most prevalent initial access techniques that Nozomi Networks Labs researchers\ntrack is the misuse of valid accounts. Malware attempts to perform credential access by\nbrute forcing SSH and telnet credentials. If successful, the attacker can achieve code\nexecution and deploy the first stage of malware to the vulnerable devices. Our chain of\nhoneypots was able to capture the top credentials misused by attackers in the last week of\nSeptember 2022 (Figure 1):\n\n\n-----\n\n**Figure**\n\n**1. Top credentials misused by attackers within the last week of September 2022**\nMost of these entries (e.g. admin:admin, root:root, admin:1234, etc.) are the default\nusernames and passwords used to access various Internet of Things (IoT) devices. These\ncredentials are used by multiple botnets; some are even accessible in the publicly available\nsource code of Mirai malware. The top entries change over time, so the results may vary\nfrom month to month. You can find a chart of top credentials our honeypots captured in the\nfirst half of 2022 in our [OT/IoT Security Report.](http://www.nozominetworks.com/ot-iot-security-report-august-2022/)\n\nOnce the malicious actors have gained access to the device, they then execute a bash script\nthat allows them to deliver and execute the second-stage payload. The classic approach\ninvolves iteratively downloading several Executable and Linkable Format (ELF) payloads\ntailored to different architectures (usually using standard tools like curl or wget). The most\ncommon computer architectures are x86, ARM, MIPS/MIPSEL, PowerPC, SH-4, SPARC and\nm68k, so it will vary depending on the device. The threat actor will then attempt to execute\neach of them on the victim’s device.\n\n**Figure 2. An example of the**\n\nfirst stage bash script\n\n\n-----\n\nNow, let s focus on the binary payloads delivered in the second stage and the type of\ninformation that can be used to aid researchers in attribution and clusterization.\n\n## Second Stage Payload\n\nTraditionally, the first stage of a brute force attack is initiated by other compromised devices,\nwhile malicious Command-and-Control (C2) servers are used to deliver second stage\npayloads and issue commands to bots. To further complicate this attack, a different filename\nis usually associated with each C2 server. Due to the large number of different IPs used to\ncarry out these attacks, the detection rate for malicious IPs on Virus Total is quite low. In the\nfollowing example (Figure 3), Nozomi Networks is one of only eight vendors, out of a total of\n94, that can detect malicious indicators that have been modified.\n\n**Figure 3. Low number of malicious C2 detections**\nThere are several types of second-stage payloads:\n\nnot packed samples\nsamples packed with public versions of Ultimate Packer for Executables (UPX)\nsamples packed with unreleased versions of UPX\nsamples packed with any version of UPX and corrupted afterwards\n\nIf you are interested in the exact distribution of packers used, you can learn more in one of\n[our previous blogs dedicated to anti-reverse engineering techniques. Regarding the UPX](https://www.nozominetworks.com/blog/how-iot-botnets-evade-detection-and-analysis/)\n[corruption, Nozomi Networks Labs recently released an open-source tool that automatically](https://www.nozominetworks.com/blog/automatic-restoration-of-corrupted-upx-packed-samples/)\nrestores these modifications.\n\n## Gafgyt (aka Qbot) Malware Samples\n\n\n-----\n\nNow let s dissect the Gafgyt malware and its variants. The Gafgyt source code was\npublished more than five years ago and is publicly available on GitHub for everyone to reuse. Therefore, many of the analyzed samples implement one or more of Gafgyt capabilities.\nAt first, the analyzed files may seem to belong to the same family, but they contain certain\ndifferences in capabilities and main functionality.\n\n### Common Sample\n\nThe common objective of the Gafgyt malware is to generate DDoS attacks via one of the few\nsupported protocols. Figure 4 shows how the corresponding commands look inside the\nmalware:\n\n**Figure 4. A routine check of**\n\nwhich supported commands were issued\nThese commands allow threat actors to perform DDoS attacks by using several protocols\nand methods (e.g., UDP, TCP, ICMP and HTTP).\n\nIn this case we see the usage of:\n\nUDP flood\nICMP flood\nTCP SYN flood\nTCP ACK flood\nTCP raw flood\nHTTP flood\n\nOther common functionalities enable the malicious actors to verify the status of the bot,\nexecute arbitrary commands on it, or kill the malicious process. Additional functionality used\nby one of the analyzed samples includes:\n\n\n-----\n\n1. scanning and searching for other devices on demand and attempt to penetrate them\n\n(Figure 5)\n2. using a hardcoded list of credentials (similar to the one used by Mirai botnet)\n\nThis capability is also present on the Gafgyt source code on GitHub:\n```\nchar *usernames[] = {\"root\\0\", \"\\0\", \"admin\\0\", \"user\\0\", \"login\\0\",\n\"guest\\0\"};\nchar *passwords[] = {\"root\\0\", \"\\0\", \"toor\\0\", \"admin\\0\", \"user\\0\",\n\"guest\\0\", \"login\\0\", \"changeme\\0\", \"1234\\0\", \"12345\\0\", \"123456\\0\",\n\"default\\0\", \"pass\\0\", \"password\\0\"}\n\n```\nHowever, in the analyzed samples, the list of credentials has been extended to include some\n[credentials listed in Mirai source code.](https://github.com/jgamblin/Mirai-Source-Code/blob/master/mirai/bot/scanner.c)\n\n**Figure 5. Credentials used by the scanner**\n\nin the analyzed sample\n\n### Unique Sample\n\n\n-----\n\nThe Gafgyt sample we analyzed uses a few defensive evasion techniques to conceal\nthemselves and prolongate the infection. Here are some of the most common unique\nfunctionalities:\n\n**Monitoring processes running on the system: One of the techniques used by this**\nmalicious sample is to list and continuously monitor all the processes running on the\nmachine and to kill any running process that is not stored on a specific path.\n\nFor each process, the sample obtains the path of the executables resolving the symlink\nin `/proc/PID/exe . When obtained, the file path checks if it contains the substrings`\n```\n   bin/ or lib/ .\n\n```\nInterestingly, this feature corresponds to the command “ stop ” in the extended\nsample, while in the lightweight sample it is always executed.\n**Hiding the process name: At the very beginning of the execution and just after setting**\nup a socket listening for incoming commands from the C2 server, the malware renames\nits process (e.g., to /bin/bash). To achieve this, it uses `prctl syscall with an`\nargument `PR_SET_NAME, which allows it to set the name of the calling process to the`\nvalues passed as a second argument.\n\n**Figure 6. Malware using** `prctl` to change its\n\nprocess name\n\n**Active use of forks: To be able to segregate its functionality, malware will execute**\nparts of the code in many separate forks, which can complicate the debugging. As\nshown in Figure 7, one of them creates 15 different instances\n\n**Figure 7. Active use of forks in IoT**\n\nmalware\n\n\n-----\n\n### Lightweight Sample\n\nWhile conducting our analysis, we discovered a Gafgyt sample with minimal amounts of\nGafgyt capabilities. It supports only three commands, whereas the previously described\nsamples have 12 different functionalities.\n\nOne of the basic features of this sample is for the C2 server to be able to check if the bot is\nalive. The C2 sends the command “ PING ” to the bot, and the bot will answer with “ PONG ” if\nit is up and running, as shown here:\n\n```\nif (!strcmp(argv[0], \"PING\"))\n\n```\n```\n {\n\n```\n```\nsockprintf(mainCommSock, \"PONG!\");\n\n```\n```\nreturn;\n\n```\n```\n}\n\n```\n\nFigure 8 shows the second and third functionalities in the function called\n```\nbotkill_and_udp_flood .\n\n```\n**Figure 8. Three capabilities**\n\ninside the lightweight version of Gafgyt: ping, botkill and UDP flood attack.\nThe botkill feature allows the C2 to send a command to kill the malicious process on the\ninfected device, same as in the feature-rich sample described above. If the bot receives the\ncommand “ botkill ” it simply exits.\n\n**Figure 9. Botkill functionality**\n\nAnother way this functionality is implemented is by issuing a `kill -9 PID command, as`\nshown in Figure 10:\n\n**Figure 10. Another implementation of botkill command**\n\nThe UDP flood attack, exactly like in the other sample’s code, contains an infinite loop that\ncalls `sys_sendto which keeps sending UDP packets until this malicious program is killed.`\n\n\n-----\n\n**Figure 11. UDP flood attack**\n\ninside the malicious sample code\n\n## Conclusion\n\nAccording to this research, threat actors may have various upgraded and downgraded\nvariants of their malwares. This could mean that they’re changing their tactics and evading\ndetection, or it could be a part of a dark web cyber crime scheme to make additional profits\nby modulating the malware; additional features being added à la carte. Modifications include\nusing different file names and IPs to evade detection and increase the longevity of an attack.\n\nAt Nozomi Networks, we distinguish between static and changing functionality to create\nrobust detections that can help you keep track of different campaigns. To protect your\nnetwork and systems, it is necessary to monitor these changes and incorporate tactics that\ncounter these attacks into your defense strategy. Below are indicators associated with the\nmalicious botnet discussed in this blog:\n\n### IoCs\n\n62.197.136.231\n80.76.51.244\n2b1cc052f78141d91e1bc40db25418359a05c4ad28d2cd55f6e503e4f78c1010\n05e586d03dfb2c4a79372d46f2f4a8a91bf24d303017a0ce9f223263b28752a5\n\n**Related Links:**\n\nBlog: [How IoT Botnets Evade Detection and Analysis](https://www.nozominetworks.com/blog/how-iot-botnets-evade-detection-and-analysis/)\nBlog: [Reverse Engineering Obfuscated Firmware for Vulnerability Analysis](https://www.nozominetworks.com/blog/reverse-engineering-obfuscated-firmware-for-vulnerability-analysis/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-11-02 - Could Threat Actors Be Downgrading Their Malware to Evade Detection-.pdf"
    ],
    "report_names": [
        "2022-11-02 - Could Threat Actors Be Downgrading Their Malware to Evade Detection-.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535916,
    "ts_updated_at": 1743041163,
    "ts_creation_date": 1669661942,
    "ts_modification_date": 1669661942,
    "files": {
        "pdf": "https://archive.orkl.eu/8b76a9e38ada368578a7e7cb42ef41dc1958f686.pdf",
        "text": "https://archive.orkl.eu/8b76a9e38ada368578a7e7cb42ef41dc1958f686.txt",
        "img": "https://archive.orkl.eu/8b76a9e38ada368578a7e7cb42ef41dc1958f686.jpg"
    }
}