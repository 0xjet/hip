{
    "id": "2041dd35-441f-46f9-8738-9bd76975ded1",
    "created_at": "2023-01-12T14:59:03.59533Z",
    "updated_at": "2025-03-27T02:14:39.34041Z",
    "deleted_at": null,
    "sha1_hash": "06c038d45ae4baea5c813e410459022d9da9cd13",
    "title": "2017-07-04 - Analysis of TeleBots’ cunning backdoor",
    "authors": "",
    "file_creation_date": "2022-05-27T22:35:41Z",
    "file_modification_date": "2022-05-27T22:35:41Z",
    "file_size": 307886,
    "plain_text": "# Analysis of TeleBots’ cunning backdoor\n\n**[welivesecurity.com/2017/07/04/analysis-of-telebots-cunning-backdoor/](https://www.welivesecurity.com/2017/07/04/analysis-of-telebots-cunning-backdoor/)**\n\nJuly 4, 2017\n\nThis article reveals details about the initial infection vector that was used during the\nDiskCoder.C outbreak.\n\n[Anton Cherepanov](https://www.welivesecurity.com/author/acherepanov/)\n4 Jul 2017 - 10:00AM\n\nThis article reveals details about the initial infection vector that was used during the\nDiskCoder.C outbreak.\n\nOn the 27th of June 2017, a [new cyberattack hit many computer systems in Ukraine, as](https://www.welivesecurity.com/2017/06/27/new-ransomware-attack-hits-ukraine/)\nwell as in other countries. That attack was spearheaded by the malware ESET products\ndetect as [Diskcoder.C (aka ExPetr, PetrWrap, Petya, or NotPetya). This malware](http://www.virusradar.com/en/Win32_Diskcoder.C/description)\n\n\n-----\n\nmasquerades as typical ransomware: it encrypts the data on the computer and demands\n$300 in bitcoins for recovery. In fact, the malware authors’ intention was to cause damage,\nso they did all that they could to make data decryption very unlikely.\n\nIn [our previous blogpost, we attributed this attack to the TeleBots group and uncovered](https://www.welivesecurity.com/2017/06/30/telebots-back-supply-chain-attacks-against-ukraine/)\ndetails about other similar supply chain attacks against Ukraine. This article reveals details\nabout the initial distribution vector that was used during the DiskCoder.C outbreak.\n\n## Tale of a malicious update\n\n[The Cyberpolice Department of Ukraine’s National Police stated, on its Facebook account,](https://www.facebook.com/cyberpoliceua/posts/536947343096100)\nas did ESET and other information security companies, that the legitimate Ukrainian\naccounting software M.E.Doc was used by the attackers to push DiskCoder.C malware in\nthe initial phase of the attack. However, until now, no details were provided as to exactly\nhow it was accomplished.\n\nDuring our research, we identified a very stealthy and cunning backdoor that was injected\nby attackers into one of M.E.Doc’s legitimate modules. It seems very unlikely that attackers\ncould do this without access to M.E.Doc’s source code.\n\nThe backdoored module has the filename ZvitPublishedObjects.dll. This was written using\nthe .NET Framework. It is a 5MB file and contains a lot of legitimate code that can be called\nby other components, including the main M.E.Doc executable ezvit.exe.\n\nWe examined all M.E.Doc updates that were released during 2017, and found that there are\nat least three updates that contained the backdoored module:\n\n10.01.175-10.01.176, released on April 14th 2017\n10.01.180-10.01.181, released on May 15th 2017\n10.01.188-10.01.189, released on June 22nd 2017\n\n[The incident with Win32/Filecoder.AESNI.C happened three days after the 10.01.180-](https://www.welivesecurity.com/2017/05/23/xdata-ransomware-making-rounds-amid-global-wannacryptor-scare/)\n10.01.181 update and the DiskCoder.C outbreak happened five days after the 10.01.18810.01.189 update. Interestingly, four updates from April 24th 2017, through to May 10th\n2017, and seven software updates from May 17th 2017, through to June 21st 2017, didn’t\ncontain the backdoored module.\n\nSince the May 15th update did contain the backdoored module and the May 17th update\ndidn’t, here is a hypothesis that could explain the low infection Win32/Filecoder.AESNI.C\nratio: the release of the May 17th update was an unexpected event for the attackers. They\npushed the ransomware on May 18th, but the majority of M.E.Doc users no longer had the\nbackdoored module as they had updated already.\n\nThe PE compilation stamps of analyzed files suggest that these files were compiled on the\nsame date as the update or the day before.\n\n\n-----\n\nFigure 1 – Compilation timestamp of the backdoored module pushed in May 15th update.\n\nFigure 2 shows the differences between the list of classes of backdoored and nonbackdoored versions of the ZvitPublishedObjects.dll module, using the ILSpy .NET\nDecompiler:\n\nFigure 2 – List of classes in backdoored module (at left) and non-backdoored (at right).\n\nThe main backdoor class is named MeCom and it is located in the\nZvitPublishedObjects.Server namespace as shown in Figure 3.\n\n\n-----\n\nFigure 3 – The MeCom class with malicious code, as shown in ILSpy .NET Decompiler.\n\nThe methods of the MeCom class are invoked by the IsNewUpdate method of UpdaterUtils\nin the ZvitPublishedObjects.Server namespace. The IsNewUpdate method is called\nperiodically in order to check whether a new update is available. The backdoored module\nfrom May 15th is implemented in a slightly different way and has fewer features than the\none from June 22nd.\n\nEach organization that does business in Ukraine has a unique legal entity identifier called\n[the EDRPOU number (Код ЄДРПОУ). This is extremely important for the attackers: having](https://uk.wikipedia.org/wiki/%D0%9A%D0%BE%D0%B4_%D0%84%D0%94%D0%A0%D0%9F%D0%9E%D0%A3)\nthe EDRPOU number, they could identify the exact organization that is now using the\nbackdoored M.E.Doc. Once such an organization is identified, attackers could then use\nvarious tactics against the computer network of the organization, depending on the\nattackers’ goal(s).\n\n\n-----\n\nSince M.E.Doc is accounting software commonly used in Ukraine, the EDRPOU values\ncould be expected to be found in application data on machines using this software. Hence,\nthe code that was injected in the IsNewUpdate method collects all EDRPOU values from\napplication data: one M.E.Doc instance could be used to perform accounting operations for\nmultiple organizations, so the backdoored code collects all possible EDRPOU numbers.\n\nFigure 4 – Code that collects EDRPOU numbers.\n\nAlong with the EDRPOU numbers, the backdoor collects proxy and email settings, including\nusernames and passwords, from the M.E.Doc application.\n\n**Warning! We recommend changing passwords for proxies, and for email accounts**\n**for all users of M.E.Doc software.**\n\nThe malicious code writes the information collected into the Windows registry under the\nHKEY_CURRENT_USER\\SOFTWARE\\WC key using Cred and Prx value names. So if\nthese values exist on a computer, it is highly likely that the backdoored module did, in fact,\nrun on that computer.\n\nAnd here is the most cunning part! The backdoored module does not use any external\nservers as C&Cs: it uses the M.E.Doc software’s regular update check requests to the\nofficial M.E.Doc server upd.me-doc.com[.]ua. The only difference from a legitimate request\nis that the backdoored code sends the collected information in cookies.\n\n\n-----\n\nFigure 5 – HTTP request of backdoored module that contains EDRPOU number in cookies.\n\nWe have not performed forensic analysis on the M.E.Doc server. However, as we noted in\n[our previous blogpost, there are signs that the server was compromised. So we can](https://www.welivesecurity.com/2017/06/30/telebots-back-supply-chain-attacks-against-ukraine/)\nspeculate that the attackers deployed server software that allows them to differentiate\nbetween requests from compromised and non-compromised machines.\n\nFigure 6 – Code of backdoor that adds cookies to the request.\n\nAnd, of course, the attackers added the ability to control the infected machine. The code\nreceives a binary blob official M.E.Doc server, decrypts it using the Triple DES algorithm,\nand, afterwards, decompresses it using GZip. The result is an XML file that could contain\nseveral commands at once. This remote control feature makes the backdoor a fully-featured\ncyberespionage and cybersabotage platform at the same time.\n\n\n-----\n\nFigure 7 – Code of backdoor that decrypts incoming malware operators’ commands.\n\nThe following table shows possible commands:\n\n**Command** **Purpose**\n\n0 – RunCmd Executes supplied shell command\n\n\n1 –\nDumpData\n\n\nDecodes supplied Base64 data and saves it to a file\n\n\n2 – MinInfo Collects information about OS version, bitness (32 or 64), current\nprivileges, UAC settings, proxy settings, email settings including login and\npassword\n\n3 – GetFile Collects file from the infected computer\n\n4 – Payload Decodes supplied Base64 data, saves it to an executable file\n\n\n5 –\nAutoPayload\n\n\nSame as previous but the supplied file should be a DLL and it will be\ndropped and executed from the Windows folder using rundll32.exe. In\naddition, once executed, it attempts to overwrite that dropped DLL and\ndelete it.\n\n\nIt should be noted that command number 5, named by malware authors as AutoPayload,\nperfectly matches the way in which DiskCoder.C was initially executed on “patient zero”\nmachines.\n\n\n-----\n\nFigure 8 – AutoPayload method that was used to execute DiskCoder.C malware.\n\n## Conclusions\n\nAs our analysis shows, this is a thoroughly well-planned and well-executed operation. We\nassume that the attackers had access to the M.E.Doc application source code. They had\ntime to learn the code and incorporate a very stealthy and cunning backdoor. The size of\nthe full M.E.Doc installation is about 1.5GB, and we have no way at this time to verify that\nthere are no other injected backdoors.\n\nThere are still questions to answer. How long has this backdoor been in use? What\ncommands and malware other than DiskCoder.C or Win32/Filecoder.AESNI.C have been\npushed via this channel? What other software update supply chains might the gang behind\n\n\n-----\n\nthis attack have already compromised but are yet to weaponize?\n\n_Special thanks to my colleagues Frédéric Vachon and Thomas Dupuy for their help in this_\n_research._\n\n## Indicators of Compromise (IoC)\n\n**ESET detection names:**\n\nMSIL/TeleDoor.A\n\n**Legitimate servers abused by malware authors:**\n\nupd.me-doc.com[.]ua\n\n**SHA-1 hashes:**\n\n7B051E7E7A82F07873FA360958ACC6492E4385DD\n\n7F3B1C56C180369AE7891483675BEC61F3182F27\n\n3567434E2E49358E8210674641A20B147E0BD23C\n\n4 Jul 2017 - 10:00AM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-07-04 - Analysis of TeleBots’ cunning backdoor.pdf"
    ],
    "report_names": [
        "2017-07-04 - Analysis of TeleBots’ cunning backdoor.pdf"
    ],
    "threat_actors": [
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "39842197-944a-49fd-9bec-eafa1807e0ea",
            "created_at": "2022-10-25T16:07:24.310589Z",
            "updated_at": "2025-03-27T02:02:10.167471Z",
            "deleted_at": null,
            "main_name": "TeleBots",
            "aliases": [],
            "source_name": "ETDA:TeleBots",
            "tools": [
                "BadRabbit",
                "Black Energy",
                "BlackEnergy",
                "CredRaptor",
                "Diskcoder.C",
                "EternalPetya",
                "ExPetr",
                "Exaramel",
                "FakeTC",
                "Felixroot",
                "GreyEnergy",
                "GreyEnergy mini",
                "KillDisk",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "NonPetya",
                "NotPetya",
                "Nyetya",
                "Petna",
                "Petrwrap",
                "Pnyetya",
                "TeleBot",
                "TeleDoor",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "nPetya"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535543,
    "ts_updated_at": 1743041679,
    "ts_creation_date": 1653690941,
    "ts_modification_date": 1653690941,
    "files": {
        "pdf": "https://archive.orkl.eu/06c038d45ae4baea5c813e410459022d9da9cd13.pdf",
        "text": "https://archive.orkl.eu/06c038d45ae4baea5c813e410459022d9da9cd13.txt",
        "img": "https://archive.orkl.eu/06c038d45ae4baea5c813e410459022d9da9cd13.jpg"
    }
}