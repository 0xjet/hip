{
    "id": "26ae412c-49fa-429f-bfc7-f3539052d2be",
    "created_at": "2023-01-12T15:08:22.939287Z",
    "updated_at": "2025-03-27T02:12:11.130436Z",
    "deleted_at": null,
    "sha1_hash": "42496d3d4e95f069d9453f50bc4d8ce43d2fa25b",
    "title": "2021-01-07 - Malware using new Ezuri memory loader",
    "authors": "",
    "file_creation_date": "2022-05-27T22:17:08Z",
    "file_modification_date": "2022-05-27T22:17:08Z",
    "file_size": 2351363,
    "plain_text": "# Malware using new Ezuri memory loader\n\n**[cybersecurity.att.com/blogs/labs-research/malware-using-new-ezuri-memory-loader](https://cybersecurity.att.com/blogs/labs-research/malware-using-new-ezuri-memory-loader)**\n\n_This blog was written by Ofer Caspi and Fernando Martinez of AT&T Alien Labs_\n\nMultiple threat actors have recently started using a Go language (Golang) tool to act as a packer and\navoid Antivirus detection. Additionally, the Ezuri memory loader tool acts as a malware loader and\nexecutes its payload in memory, without writing the file to disk. While this technique is known and\ncommonly used by Windows malware, it is less popular in Linux environments.\n\n[The loader decrypts the malicious malware and executes it using memfd create (as described in this blog](https://web.archive.org/web/20201107225502/https:/blog.fbkcs.ru/elf-in-memory-execution/)\nin 2018). When creating a process, the system returns a file descriptor to an anonymous file in\n'/proc/PID/fd/' which is visible only in the filesystem.\n\nFigure 1 shows a code snippet from the loader, containing the information it uses in order to decrypt the\npayload using the AES algorithm.\n\nFigure 1. Loader code snippet via Alien Labs analysis.\n\n[The loader, written in Golang, is taken from the \"Ezuri\" code on GitHub via the user guitmz. This user](https://web.archive.org/web/20201101055326/https:/github.com/guitmz/ezuri)\n[originally created the ELF loader around March 2019, when he wrote a blog about the technique to run](https://web.archive.org/web/20200903104802/https:/www.guitmz.com/running-elf-from-memory/)\nELF executables from memory and shared the loader on his github. Additionally, a similar user ‘TMZ’\n(presumably associated with the previously mentioned ‘guitmz’) posted this same code in late August, on\n[a small forum where malware samples are shared.](https://web.archive.org/web/20201106145814/https:/evilop.codes/showthread.php?tid=71)\n\nThe guitmz user even ran tests against VirusTotal to prove the efficiency of the code, uploading a\ndetected Linux.Cephei sample\n[(35308b8b770d2d4f78299262f595a0769e55152cb432d0efc42292db01609a18) with 30/61 AV detections](https://www.virustotal.com/gui/file/35308b8b770d2d4f78299262f595a0769e55152cb432d0efc42292db01609a18/detection)\nin VirusTotal, compared to the zero AV detections by the same sample hidden with the Ezuri code\n[(ddbb714157f2ef91c1ec350cdf1d1f545290967f61491404c81b4e6e52f5c41f)](https://www.virustotal.com/gui/file/ddbb714157f2ef91c1ec350cdf1d1f545290967f61491404c81b4e6e52f5c41f/detection)\n\n\n-----\n\nThe execution flow of the loader is to first decrypt the payload and then execute it from memory (figure 2):\n\nFigure 2. Execution flow, retrieved from Alien Labs analysis.\n\nGuitmz gave this sample the name Ezuri, probably after the card with the same name from the card game\n“Magic: The Gathering.” This card has the capability to “Regenerate another target Elf,” reflecting the\nmalware’s capability of loading and executing an ELF file in memory.\n\n## Code review\n\nAT&T Alien Labs team accessed Guitmz’s upload of code for analysis. The tool is written in Golang and is\nintuitive to use. When executing, it first asks the path for the payload to be encrypted, along with the\npassword to be used for AES encryption. If no password is given, the tool generates one, which is used to\nhide the malware within the loader. After the user's input, the packer compiles the loader with the payload\nencrypted within it, so it can be decrypted and executed in memory once it is placed in the victim’s\nsystem.\n\nFigure 4 shows the main function of the executable, where the file is first decrypted by “aesDec” to then\nbe run in memory by “runFromMemory”.\n\n\n-----\n\nFigure 3 shows Ezuri main function, retrieved from Alien Labs analysis.\n\nFigure 4 shows the “runFromMemory” function used to execute the payload in memory without placing the\ndetectable malware on disk.\n\nFigure 4 shows Ezuri runFromMemory function, retrieved from Alien Labs analysis.\n\nTo use the tool, the user will be requested to enter the file to be hidden, with a target process name as\nwell as an optional AES key for encryption (figure 5):\n\n\n-----\n\nFigure 5 shows Ezuri execution, retrieved from Alien Labs analysis.\n\n## TeamTNT\n\nAT&T Alien Labs has identified several malware authors leveraging the Ezuri loader in the last few\n[months, including TeamTNT, which was the first identified. TeamTNT is a cybercrime group that has been](https://otx.alienvault.com/browse/global?section=All&q=TeamTNT&include_inactive=0&sort=-modified&page=1&indicatorsSearch=modified:%22%22%20TeamTNT)\n[active since at least April 2020, when the security firm Trend Micro first reported on them. The main focus](https://web.archive.org/web/*/https:/www.trendmicro.com/vinfo/hk-en/security/news/virtualization-and-cloud/coinminer-ddos-bot-attack-docker-daemon-ports)\nof the group is to target Docker systems with misconfigurations, as well as unprotected and exposed\nmanagement APIs, to later install DDoS bots and cryptominers in the infected systems.\n\n[A few months after the Trend Micro report, in August 2020, Cado Security found new developments in the](https://web.archive.org/web/20201110163424/https:/www.cadosecurity.com/post/team-tnt-the-first-crypto-mining-worm-to-steal-aws-credentials)\nTeamTNT group. In October 2020, [Palo Alto Networks Unit42 identified new variants of the cryptomining](https://web.archive.org/web/20201101092236/https:/unit42.paloaltonetworks.com/black-t-cryptojacking-variant/)\nmalware used by TeamTNT named “Black-T.” This sample first installs three network scanners, and then\ninspects memory in an attempt to retrieve any type of credentials located in the memory. Additionally,\nUnit42 identified several German-language strings in some of the TNT scripts.\n\nThe last sample identified by Palo Alto Networks Unit42 is actually an Ezuri loader. The decrypted payload\nis an ELF file packed with UPX, which is a known sample from TeamTNT, first seen in June 2020\n[(e15550481e89dbd154b875ce50cc5af4b49f9ff7b837d9ac5b5594e5d63966a3).](https://otx.alienvault.com/indicator/file/e15550481e89dbd154b875ce50cc5af4b49f9ff7b837d9ac5b5594e5d63966a3)\n\nThe techniques and code similarities between the original tool, named Ezuri, and the one recently used by\nTeamTNT are vast. The most evident one being the 'ezuri' string in the compiled binary (figure 6):\n\nFigure 6 shows Ezuri string in TeamTNT sample retrieved from Alien Labs analysis.\n\nUsing this packer, the antivirus (AV) detection drops dramatically. Looking at the TeamTNT malware\ndetections before using Ezuri packer\n[(b494ca3b7bae2ab9a5197b81e928baae5b8eac77dfdc7fe1223fee8f27024772), we see 28/62 AV](https://www.virustotal.com/gui/file/b494ca3b7bae2ab9a5197b81e928baae5b8eac77dfdc7fe1223fee8f27024772/detection)\ndetections of the malware, while the Ezuri packed version\n[(751014e0154d219dea8c2e999714c32fd98f817782588cd7af355d2488eb1c80) drops to only 3/64 AV](https://www.virustotal.com/gui/file/751014e0154d219dea8c2e999714c32fd98f817782588cd7af355d2488eb1c80/detection)\ndetections.\n\n\n-----\n\nIn addition to TeamTNT, there were several Gafgyt samples observed (popular IoT device malware with\nDDoS attacks purposes).\n\n## Conclusion\n\nSeveral malware authors have been using an open source Golang tool to act as a malware loader, using\na known technique to load the ELF binaries into memory and avoid using easy-to-detect files on disk. The\nauthors use the open source tool Ezuri, to load its previously seen payloads and avoid antivirus detections\non the file.\n\n## Detection Methods\n\nThe following associated detection methods are in use by Alien Labs. They can be used by readers to\ntune or deploy detections in their own environments or for aiding additional research.\n\n\nYARA RULES\n\n```\nrule EzuriLoader : LinuxMalware {\n  meta:\n    author = \"AT&T Alien Labs\"\n    type = \"malware\"\n    description = \"Detects Ezuri Golang\nloader.\"\n    copyright = \"AT&T Cybersecurity 2020\"\n    reference =\n\"283e0172063d1a23c20c6bca1ed0d2bb\"\n  strings:\n    $a1 = \"ezuri/stub/main.go\"\n    $a2 = \"main.runFromMemory\"\n    $a3 = \"main.aesDec\"\n  condition:\n    uint32(0) == 0x464c457f and\n    filesize < 20MB and all of ($a*)\n}\n\n```\n\n-----\n\n```\nrule EzuriLoaderOSX : OSXMalware {\n  meta:\n    author = \"AT&T Alien Labs\"\n    type = \"malware\"\n    description = \"Detects Ezuri Golang\nloader.\"\n    copyright = \"AT&T Cybersecurity 2020\"\n    reference =\n\"da5ae0f2a4b6a52d483fb006bc9e9128\"\n  strings:\n    $a1 = \"ezuri/stub/main.go\"\n    $a2 = \"main.runFromMemory\"\n    $a3 = \"main.aesDec\"\n    $Go = \"go.buildid\"\n  condition:\n    (uint32(0) == 0xfeedface or  \n    uint32(0) == 0xcefaedfe or  \n    uint32(0) == 0xfeedfacf or\n    uint32(0) == 0xcffaedfe or  \n    uint32(0) == 0xcafebabe or  \n    uint32(0) == 0xbebafeca)\n    and $Go and filesize < 5MB and all of\n($a*)\n}\n\n```\n\n## Associated Indicators (IOCs)\n\nThe following technical indicators are associated with the reported intelligence. A list of indicators is also\n[available in the OTX Pulse. Please note, the pulse may include other activities related but out of the scope](https://otx.alienvault.com/pulse/5f9998c11f06f964ffb44cf1)\nof the report.\n\nTYPE INDICATOR DESCRIPTION\n\nSHA256 0a569366eeec52380b4462b455cacc9a788c2a7883b0a9965d20f0422dfc44df ELF Golang\ndropper\n\n\n-----\n\nSHA256 e1836676700121695569b220874886723abff36bbf78a0ec41cce73f72c52085 OSX Golang\ndropper\n\nSHA256 e15550481e89dbd154b875ce50cc5af4b49f9ff7b837d9ac5b5594e5d63966a3 TeamTNT\npacked\npayload\n\nSHA256 0a569366eeec52380b4462b455cacc9a788c2a7883b0a9965d20f0422dfc44df ELF Golang\ndropper\n\nSHA256 35308b8b770d2d4f78299262f595a0769e55152cb432d0efc42292db01609a18 Linux Cephei\n\nSHA256 ddbb714157f2ef91c1ec350cdf1d1f545290967f61491404c81b4e6e52f5c41f Ezuri packed\nLinux Cephei\n\nSHA256 b494ca3b7bae2ab9a5197b81e928baae5b8eac77dfdc7fe1223fee8f27024772 TeamTNT\npayload before\nEzuri\n\nSHA256 751014e0154d219dea8c2e999714c32fd98f817782588cd7af355d2488eb1c80 Ezuri packed\nTeamTNT\npayload\n\n## References\n\nThe following list of sources was used by the report authors during the collection and analysis process\nassociated with this intelligence report.\n\n1. https://web.archive.org/web/*/https://www.trendmicro.com/vinfo/hk-en/security/news/virtualization\nand-cloud/coinminer-ddos-bot-attack-docker-daemon-ports\n2. https://web.archive.org/web/20201110163424/https://www.cadosecurity.com/post/team-tnt-the-first\ncrypto-mining-worm-to-steal-aws-credentials\n3. https://web.archive.org/web/20201101092236/https://unit42.paloaltonetworks.com/black-t\ncryptojacking-variant/\n4. https://web.archive.org/web/20201101055326/https://github.com/guitmz/ezuri\n5. https://web.archive.org/web/20200903104802/https://www.guitmz.com/running-elf-from-memory/\n6. https://web.archive.org/web/20201106145814/https://evilop.codes/showthread.php?tid=71\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-07 - Malware using new Ezuri memory loader.pdf"
    ],
    "report_names": [
        "2021-01-07 - Malware using new Ezuri memory loader.pdf"
    ],
    "threat_actors": [
        {
            "id": "f809bfcb-b200-4988-80a8-be78ef6a52ef",
            "created_at": "2023-01-06T13:46:39.186988Z",
            "updated_at": "2025-03-27T02:00:03.016358Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "Adept Libra"
            ],
            "source_name": "MISPGALAXY:TeamTNT",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c3ca592f-0669-49bd-ab5c-310007ab2fb4",
            "created_at": "2022-10-25T15:50:23.334495Z",
            "updated_at": "2025-03-27T02:00:55.445098Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "TeamTNT"
            ],
            "source_name": "MITRE:TeamTNT",
            "tools": [
                "Peirates",
                "MimiPenguin",
                "LaZagne",
                "Hildegard"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536102,
    "ts_updated_at": 1743041531,
    "ts_creation_date": 1653689828,
    "ts_modification_date": 1653689828,
    "files": {
        "pdf": "https://archive.orkl.eu/42496d3d4e95f069d9453f50bc4d8ce43d2fa25b.pdf",
        "text": "https://archive.orkl.eu/42496d3d4e95f069d9453f50bc4d8ce43d2fa25b.txt",
        "img": "https://archive.orkl.eu/42496d3d4e95f069d9453f50bc4d8ce43d2fa25b.jpg"
    }
}