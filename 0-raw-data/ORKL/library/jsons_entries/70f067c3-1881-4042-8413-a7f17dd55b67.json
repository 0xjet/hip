{
    "id": "70f067c3-1881-4042-8413-a7f17dd55b67",
    "created_at": "2023-01-12T15:03:04.748949Z",
    "updated_at": "2025-03-27T02:06:11.965906Z",
    "deleted_at": null,
    "sha1_hash": "680e9d35c6c15046311c475fbbe1f45ec4cb55f4",
    "title": "2020-11-11 - Targeted ransomware- it’s not just about encrypting your data! Part 1 - “Old and New Friends”",
    "authors": "",
    "file_creation_date": "2022-05-27T21:29:58Z",
    "file_modification_date": "2022-05-27T21:29:58Z",
    "file_size": 2194111,
    "plain_text": "# Targeted ransomware: it’s not just about encrypting your data!\n\n**[securelist.com/targeted-ransomware-encrypting-data/99255/](https://securelist.com/targeted-ransomware-encrypting-data/99255/)**\n\nAuthors\n\n[Dmitry Bestuzhev](https://securelist.com/author/dimitrybestuzhev/)\n\nFedor Sinitsyn\n\n## Part 1 - “Old and New Friends”\n\nWhen we talk about ransomware, we need to draw a line between what it used to be and\nwhat it currently is. Why? Because nowadays ransomware is not just about encrypting data –\nit’s primarily about data exfiltration. After that, it’s about data encryption and leaving\nconvincing proof that the attacker was in the network, and finally, it’s extortion. And again, it’s\nnot about the data loss itself but about publishing stolen data on the internet. Let’s call it\n“Ransomware 2.0”.\n\n\n-----\n\nWhy is it so important to state this? Because many organizations still believe that it s all\nabout malware, and if your anti-malware protection is good enough, you’ll be OK. As long as\npeople think this way, the ransomware threat actors will continue to succeed again and\nagain.\n\nIn most cases, the initial vector of attack is exploiting some already known vulnerabilities in\ncommercial VPN software. Other cases involve abusing RDP-enabled machines exposed to\nthe internet. Then there’s the exploitation of the vulnerable router firmware. As you can see,\nit’s not necessarily about malware but also bad practices, a lack of patching cycles, and\ngeneral security procedures.\n\nSometimes ransomware threat actors may rely on traditional malware like botnet implants\npreviously dropped by other cybercriminal groups. And finally, if we recall the [Tesla story, the](https://www.wired.com/story/tesla-ransomware-insider-hack-attempt/)\nattempt to infect that factory was through someone working at the company. That means\nphysical human access is also a vector. It is complex.\n\nIn all cases, the original entry point is to start network reconnaissance, then lateral\nmovement, then data exfiltration. Once it is done, it finally comes to the “coup de grace” – the\nransomware. By the time ransomware is deployed, the anti-malware product might be\nalready deleted or disabled by the threat actor because they already had full control over the\ndomain network and could operate as legitimate administrators. So it is about a full red team\noperation that relies on different hacking techniques, including those to disable anti-malware\nsolutions mostly through legitimate tools and misc scripts. That way, the threat actor doesn’t\nbother if the ransomware itself will be detected or not.\n\nDifferent ransomware groups use different TTPs and different encryption techniques. Today\nwe want to talk about two of them: Ragnar Locker and Egregor – a veteran and a newbie.\nBoth singular and distant at the same time.\n\n## Ragnar Locker\n\nEarly variants of this malware were discovered in 2019; however, Ragnar Locker gained\nnotoriety in the first half of 2020 when it started to attack large organizations.\n\nRagnar Locker is highly targeted, to the extent that each individual sample is specifically\ntailored for the organization the actors are attacking. The group behind it loves to abuse\nRDP, while their preferred payment method is bitcoins.\n\nThis group owns three .onion domains available on Tor and one Surface Web domain\nregistered on June 16, 2020.\n\nIf the victims refuse to pay, their stolen data is published in a so-called Wall of Shame\nsection.\n\n\n-----\n\n**_Screenshot of the Wall of Shame where stolen data is exposed_**\n\nCuriously, this group is positioning itself as a bug bounty hunting group. They claim the\npayment is their bounty for discovering vulnerabilities that were exploited and to provide\ndecryption for the files and OpSec training for the victim; and, finally, for not publishing the\nstolen data. Of course, if the victim refuses to pay, the data goes public. Besides that, if the\nvictim chats with the Ragnar Locker threat actor and fails to pay, then the chat is exposed\nalong with the stolen data.\n\nIn July 2020, Ragnar Locker made a public announcement that they had joined so-called\n“Maze Cartel” distraction concept. It means to say that the groups cooperated, exchanging\ninformation stolen from victims and publishing it on their websites.\n\n**_Example of a victim allegedly provided by Maze and published on the Ragnar Locker_**\n**_Wall of Shame page_**\n\n[You can read more about Maze Ransomware here.](https://securelist.com/maze-ransomware/99137/)\n\nBased on the list of victims who refused to pay, the main target of Ragnar Locker are US\nbased companies, while the type of industry varies.\n\n_[Geography of Ragnar Locker victims (download)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2020/11/06143514/01-en-targeted-ransomware-maze.png)_\n\n\n-----\n\n_[Ragnar Locker victims by industry (download)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2020/11/06143635/02-en-targeted-ransomware-maze.png)_\n\n### Technical description\n\nFor our analysis we chose a recently encountered sample of the malware:\n1195d0d18be9362fb8dd9e1738404c9d\n\nWhen started, Ragnar Locker checks the system locale of the machine it is executing on. If\ndetermines that it is the locale of one of the countries listed in the screenshot below, it will\ncease operation and exit without doing anything else.\n\nFor countries not on the above list, it will proceed to stop services with names containing any\nof the substrings hardcoded in the malware sample and obfuscated by RC4:\n\nAfterwards, Rangar Locker will terminate running processes according to another substring\nlist contained inside the Trojan body:\n\nFinally, when all the preparation is done, the Trojan will search for available drives and\nencrypt the victim’s files.\n\nFor file encryption RagnarLocker uses a custom stream cipher based on the Salsa20 cipher.\nInstead of the standard initialization ‘magic’ constants sigma = “expand 32-byte k” and tau =\n“expand 16-byte k” normally used in Salsa20, the Trojan generates new random values for\neach processed file. This is an unnecessary step which makes the cipher incompatible with\nthe standard Salsa20, but doesn’t in fact enhance its security.\n\nThe key and nonce values are also uniquely generated for each file, and will be encrypted\nalong with the constants described above by RSA using the public 2048-bit key hardcoded in\nthe Trojan’s body.\n\n\n-----\n\nThe RNG is based on the MS CryptoAPI function CryptGenRandom, which is considered\nsecure, and the SHA-256 hash algorithm. The RNG implementation looks a bit awkward, but\nwe haven’t found any critical flaws in it.\n\n**_The RNG procedure pseudocode used by a recent Ragnar Locker variant_**\n\nAfter encrypting the content of each of the victim’s files, Ragnar Locker will append the\nencrypted key, nonce and initialization constants to the encrypted file, and finalize by adding\nthe marker “!@#_®agna®_#@!”\n\n\n-----\n\n**_Trailing bytes of a file encrypted by Ragnar Locker_**\n\nThe ransom notes dropped by the Trojan contain the name of the victim organization which\nclearly indicates that the criminals utilize a targeted approach, identify their victim and\ncarefully prepare the attack.\n\nThe ransom note also attempts to further scare the victim into paying by emphasizing that\nthe threat actors have stolen confidential data in addition to the file encryption performed by\nthe Trojan.\n\n\n-----\n\n## Egregor\n\nEgregor ransomware is a new strain that was discovered in September 2020, and after the\ninitial analysis we noticed code similarities between this new threat and Sekhmet\nransomware, as well as the notorious Maze ransomware, which announced on November\n1, 2020 that they shut down.st\n\nEgregor keeps at least one .onion domain and two Surface Web domains. The first Surface\nWeb domain was registered on September 6, 2020 and the second one on October 19,\n2020. At the time of writing, both Surface Web domains were intermittent. That is probably\nwhy on the main page of the Onion domain, there is a big disclaimer with this notice:\n\nThe Egregor ransomware is typically distributed by the criminals following a network breach.\nThe malware sample is a DLL file that needs to be launched with the correct password given\nas a command line argument. The DLL is usually dropped from the Internet. On occasions,\nthe domains used to spread it exploit names or words used in the victim’s industry.\n\nEgregor is probably the most aggressive Ransomware family in terms of negotiation with the\nvictims. It gives only 72 hours to contact the threat actor. Otherwise, the victim’s data is\nprocessed for publishing.\n\nThe ransomware payment is negotiated and agreed upon via a special chat assigned to\neach victim. The payment is received in BTC.\n\n**_Example of a chat negotiating to pay the ransom_**\n\n### Technical description\n\n\n-----\n\nb21930306869a3cdb85ca0d073a738c5\n\nAs mentioned above, the malware sample only works if a correct password is provided\nduring launch. The packer of the malware will use this password to decrypt the payload\nbinary. A missing or incorrect argument will result in an incorrect decryption of the payload,\nwhich will be unable to execute and will crash instead.\n\nThis technique is intended to hinder both automatic analysis in sandbox-type systems, and\nmanual analysis by researchers: without the correct password it is impossible to unpack and\nanalyze the payload binary.\n\nAfter unpacking two layers of the malicious packer, we end up with an obfuscated binary\nwhich is still not suitable for static analysis. The obfuscation techniques used in Egregor\nstrongly resemble those in Maze and Sekhmet: the code is ‘torn apart’ by control flow\nobfuscation using conditional and unconditional jumps, PUSH+JMP instead of RETN, and so\non.\n\n**_Control flow obfuscation example_**\n\nWhen the payload starts executing, first of all, it will check the system and user language of\nthe OS to avoid encrypting machines having one of the following languages installed:\n\nArmenian (Armenia)\n\nAzerbaijani (Cyrillic, Azerbaijan)\n\nAzerbaijani (Latin, Azerbaijan)\n\nBelarusian (Belarus)\n\nGeorgian (Georgia)\n\nKazakh (Kazakhstan)\n\nKyrgyz (Kyrgyzstan)\n\nRomanian (Moldova)\n\n\n-----\n\nRussian (Moldova)\n\nRussian (Russia)\n\nTajik (Cyrillic, Tajikistan)\n\nTatar (Russia)\n\nTurkmen (Turkmenistan)\n\nUkrainian (Ukraine)\n\nUzbek (Latin, Uzbekistan)\n\nThen it will attempt to terminate the following processes:\n\nThis is intended to make writable potentially valuable files such as documents or databases\nthat may have been in use at the moment of infection. In addition, some programs typically\nused by researchers, e.g., procmon or dumpcap, are also listed for termination to further\nhinder dynamic analysis.\n\nEgregor uses a hybrid file encryption scheme based on the stream cipher ChaCha and the\nasymmetric cipher RSA.\n\nThe RSA-2048 master public key of the criminals is embedded in the trojan’s body.\n\nWhen executing on a victim’s machine, Egregor generates a new unique pair of session RSA\nkeys. The session private RSA key is exported and encrypted by ChaCha with a uniquely\ngenerated key + nonce, then the key and nonce are encrypted by the master public RSA key.\nThe results are saved in a binary file (in our case it’s named C:\\ProgramData\\dtb.dat), as well\nas a base64-encoded string in the ransom notes.\n\n\n-----\n\nFor each data file Egregor processes, it generates a new 256-bit ChaCha key and 64-bit\nnonce, encrypts the file content by ChaCha, then encrypts them using the session public\nRSA key, and saves them along with some auxiliary information in the end of the encrypted\nfile.\n\nThe last 16 bytes of each encrypted file are comprised of a dynamic marker: a random\nDWORD and this same DWORD xor’ed with the value 0xB16B00B5 which equals\n‘BIGBOOBS’ in so-called leet speak, originally used by “hackers, crackers and script\nkiddies”, according to Wikipedia.\n\n\n-----\n\n**_Part of the file encryption procedure pseudocode_**\n\nThe main page of the data leak website contains news about recently attacked companies\nalong with some sarcastic remarks written by the ransomware group.\n\n\n-----\n\nThe archive section of the site lists the victims of the extortionists and the links to download\nthe stolen data.\n\nBased on the information of those victims who refused to pay, the geographic reach of\nEgregor is way more extensive than that of Ragnar Locker:\n\n_[Geography of Egregor victims (download)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2020/11/06143728/03-en-targeted-ransomware-maze.png)_\n\nThe same is true for the number of attacked industries:\n\n_[Egregor victims by industry (download)](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2020/11/06143807/04-en-targeted-ransomware-maze.png)_\n\n## Conclusions\n\nUnfortunately, Ransomware 2.0 is here to stay. When we talk about 2.0, we mean targeted\nransomware with data exfiltration. The whole extortion process is primarily about the victims’\ndata not being published on the internet and only then about decryption. Why is it so\nimportant for the victims that their data is not published? Because possible lawsuits and fines\ndue to violations of regulations like HIPAA, PIC or GDPR can result in immense financial\nlosses, reputational damage and potential bankruptcy.\n\nAs long as companies see ransomware threat actors as typical malware threats, they will\nalso fail. It is not about just endpoint protection; it is about red teaming, business analysts\nworking with exfiltrated documents evaluating the ransom to pay. It is also about data theft,\nof course, and public shaming, leading to all sorts of problems in the end.\n\nOur next chapter will cover something else – a perfect umbrella for different threat actors with\ndifferent motivations operating under the aegis of Ransomware 2.0.\n\n\n-----\n\n## How to protect yourself\n\nTo keep your company protected against these types of ransomware attacks, Kaspersky\nexperts recommend:\n\n1. Do not expose remote desktop services (such as RDP) to public networks unless\n\nabsolutely necessary and always use strong passwords for them.\n2. Promptly install available patches for commercial VPN solutions providing access for\n\nremote employees and acting as gateways in your network.\n3. Always keep software updated on all the devices you use to prevent ransomware from\n\nexploiting vulnerabilities\n4. Focus your defense strategy in detecting lateral movements and data exfiltration to the\n\nInternet. Pay a special attention to the outgoing traffic to detect cybercriminals\nconnections. Back up data regularly. Make sure you can quickly access it in an\nemergency when needed.\n[5. Use solutions like Kaspersky Endpoint Detection and Response and](https://www.kaspersky.com/enterprise-security/endpoint-detection-response-edr) Kaspersky\n\nManaged Detection and Response service which help to identify and stop the attack on\nearly stages, before attackers reach their final goals.\n6. To protect the corporate environment, educate your employees. Dedicated training\n\ncourses can help, such as the ones provided in the Kaspersky Automated Security\nAwareness Platform. A free lesson on how to protect from ransomware attacks is\n[available here.](https://ransomware.k-asap.com/)\n7. Use reliable endpoint security solution, such as Kaspersky Endpoint Security for\n\nBusiness that is powered by exploit prevention, behavior detection and a remediation\nengine that is able to roll back malicious actions. KESB also has self-defense\nmechanisms which can prevent its removal by cybercriminals.\n\n[Cybercrime](https://securelist.com/tag/cybercrime/)\n[Data Encryption](https://securelist.com/tag/data-encryption/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[Malware Statistics](https://securelist.com/tag/malware-statistics/)\n[Malware Technologies](https://securelist.com/tag/malware-technologies/)\n[Ransomware](https://securelist.com/tag/ransomware/)\n[RDP](https://securelist.com/tag/rdp/)\n[Trojan](https://securelist.com/tag/trojan/)\n\nAuthors\n\n[Dmitry Bestuzhev](https://securelist.com/author/dimitrybestuzhev/)\n\nFedor Sinitsyn\n\n\n-----\n\nTargeted ransomware: it s not just about encrypting your data!\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-11-11 - Targeted ransomware- it’s not just about encrypting your data! Part 1 - “Old and New Friends”.pdf"
    ],
    "report_names": [
        "2020-11-11 - Targeted ransomware- it’s not just about encrypting your data! Part 1 - “Old and New Friends”.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535784,
    "ts_updated_at": 1743041171,
    "ts_creation_date": 1653686998,
    "ts_modification_date": 1653686998,
    "files": {
        "pdf": "https://archive.orkl.eu/680e9d35c6c15046311c475fbbe1f45ec4cb55f4.pdf",
        "text": "https://archive.orkl.eu/680e9d35c6c15046311c475fbbe1f45ec4cb55f4.txt",
        "img": "https://archive.orkl.eu/680e9d35c6c15046311c475fbbe1f45ec4cb55f4.jpg"
    }
}