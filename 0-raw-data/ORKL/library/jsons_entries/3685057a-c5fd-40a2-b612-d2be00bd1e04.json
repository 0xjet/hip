{
    "id": "3685057a-c5fd-40a2-b612-d2be00bd1e04",
    "created_at": "2023-01-12T14:59:57.993117Z",
    "updated_at": "2025-03-27T02:16:14.293841Z",
    "deleted_at": null,
    "sha1_hash": "9d7553acb584b7d18eff4b8c70bde7faf0123ad0",
    "title": "2022-03-28 - New Conversation Hijacking Campaign Delivering IcedID",
    "authors": "",
    "file_creation_date": "2022-05-28T03:49:45Z",
    "file_modification_date": "2022-05-28T03:49:45Z",
    "file_size": 2404314,
    "plain_text": "# New Conversation Hijacking Campaign Delivering IcedID\n\n**[intezer.com/blog/research/conversation-hijacking-campaign-delivering-icedid/](https://www.intezer.com/blog/research/conversation-hijacking-campaign-delivering-icedid/)**\n\nMarch 28, 2022\n\nWritten by [Joakim Kennedy and](https://www.intezer.com/author/jkennedy/) [Ryan Robinson - 28 March 2022](https://www.intezer.com/author/ryanrobinson/)\n\n### Get Free Account\n\nJoin Now\n\n_This post describes the technical analysis of a new campaign detected by Intezer’s_\n_research team, which initiates attacks with a phishing email that uses conversation hijacking_\n_to deliver IcedID._\n\nThe underground economy is constantly evolving with threat actors specializing in specific\nfields. One field that has bloomed in the last few years is initial access brokers. Initial\naccess brokers specialize in gaining an initial beachhead access to organizations and once\nachieved, sell the access to other threat actors that monetize it further.\n\nSome of the customers to initial access brokers buy the access to deploy ransomware.\n[Proofpoint has identified ten access brokers that sell access to ransomware groups. These](https://www.proofpoint.com/uk/blog/threat-insight/first-step-initial-access-leads-ransomware)\naccess brokers largely infect their victims with banking trojans that are later used to deploy\nanother malware at the “purchaser’s request.”\n\n[One of these banking trojans that have been used to deploy ransomware is IcedID](https://www.mandiant.com/resources/melting-unc2198-icedid-to-ransomware-operations)\n[(BokBot). IcedID was first reported on by IBM X-Force in November 2017 and the malware](https://securityintelligence.com/new-banking-trojan-icedid-discovered-by-ibm-x-force-research/)\n[shared some code with Pony While initially designed to steal banking credentials like](https://www.intezer.com/blog/research/icedid-banking-trojan-shares-code-pony-2-0-trojan/)\n\n\n-----\n\nmany other banking trojans, the malware has been repurposed for deploying other malware\non the infected machines.\n\n[One way IcedID infects machines is via phishing emails. The infection chain that commonly](https://unit42.paloaltonetworks.com/ta551-shathak-icedid/)\nhas been used is an email with an attached password protected “zip” archive. Inside the\narchive is a macro enabled office document that executes the IcedID installer. Some\nphishing emails reuse previously stolen emails to make the lure more convincing.\n\n**In the new IcedID campaign we have discovered a further evolution of the threat**\n**actors’ technique. The threat actor now uses compromised Microsoft Exchange servers to**\nsend the phishing emails from the account that they stole from. The payload has also\nmoved away from using office documents to the use of ISO files with a Windows LNK file\n[and a DLL file. The use of ISO files allows the threat actor to bypass the Mark-of-the-Web](https://attack.mitre.org/techniques/T1553/005/)\ncontrols, resulting in execution of the malware without warning to the user. With regards to\n**targeting, we have seen organizations within energy, healthcare, law, and**\n**pharmaceutical sectors.**\n\n## Infection Chain\n\nThe attack-chain starts with a phishing email. The email includes a message about some\nimportant document and has a password protected “zip” archive file attached. The\npassword to the archive is given in the email body, as can be seen in the screenshot below.\nWhat makes the phishing email more convincing is that it’s using conversation hijacking\n(thread hijacking). A forged reply to a previous stolen email is being used. Additionally,\nthe email has also been sent from the email account from whom the email was stolen from.\n\n\n-----\n\nThe content of the zip archive is shown in the screenshot below. It includes a single “ISO”\nfile with the same filename as the zip archive. It can also be seen that the file was created\nnot that long before the email was sent.\n\nThe ISO file includes two files, a LNK file named “document” and a DLL file named “main.”\nFrom the timestamps it can be concluded that the DLL file was prepared the day before\nwhile the LNK file was prepared about a week before. It is possible that the LNK file has\nbeen used in earlier phishing emails.\n\nThe LNK file has been made to look like a document file via its embedded icon file. As can\nbe seen in the screenshot below, when a user double clicks the link file, it uses “regsvr32”\nto execute the DLL file.\n\n\n-----\n\nThe use of [regsvr32 allows for proxy execution of malicious code in main.dll for defense](https://attack.mitre.org/techniques/T1218/010/)\nevasion. The DLL file is a loader for the IcedID payload. It contains a number of exports,\nmost of which consist of junk code.\n\n\n-----\n\nThe loader will locate the encrypted payload, stored in the resource section of the binary. It\ndoes this through the technique API hashing. A decompilation of the simple hashing\nfunction is shown below.\n\nThe resulting hash is then compared with a hardcoded hash, locating the call for\n**FindResourceA. The function is dynamically called to fetch the payload.**\n\n\n-----\n\nMemory is allocated using VirtualAlloc to hold the decrypted payload.\n\n\n-----\n\nThe IcedID “Gziploader” payload is decoded and placed in memory and then executed.\nGZiploader fingerprints the machine and sends a beacon to the command and control\nserver with information about the infected host. The information is smuggled through the\ncookies header via an HTTP GET request.\n\nThe C2 is located at yourgroceries[.]top. The C2 can respond with a further stage to be\ndropped and executed. The C2 did not respond with a payload during our analysis.\n\n## Conversation Hijacking as a Phishing Technique\n\n\n-----\n\nThe technique of hijacking an already existing conversation over email to spread malware is\nsomething threat actors have been using for a while. Normally email messages are stolen\nduring an infection and used in future attacks to make the phishing email appear more\nlegitimate. In the last six months, threat actors have evolved the technique further to make it\neven more convincing. Instead of sending the stolen conversation to the victim with a\n“spoofed” email address, threat actors are now using the email address of the victim that\nthey stole the original email from to make the phishing email even more convincing.\n\n[Kevin Beaumont reported on this conversation hijacking technique back in November 2021](https://twitter.com/GossiTheDog/status/1455204386834206729)\nbeing used to distribute Qakbot. Through the investigation, he confirmed that the Microsoft\nExchange servers where the emails originated from had evidence of being exploited by\nProxyShell.\n\n## New Campaign Discovered in March 2022\n\nIn the current mid-March campaign, we have discovered reuse of the same stolen\nconversation now being sent from the email address that received the latest email. Back in\nJanuary when this conversation was also used, the “FROM” address was\n“webmaster@[REDACTED].com” with the name of the recipient of the last email in the\nconversation. By using this approach, the email appears more legitimate and is transported\nthrough the normal channels which can also include security products.\n\nThe majority of the originating Exchange servers we have observed appear to also be\nunpatched and publicly exposed, making the ProxyShell vector a good theory. While the\nmajority of the Exchange servers used to send the phishing emails can be accessed by\nanyone over the Internet, we have also seen a phishing email sent internally on what\nappears to be an “internal” Exchange server.\n\nThe code snippet below shows a small part of the email header. The IP address of the\nExchange server is a local IP address (172.29.0.12) with a top-level domain name of “local”.\nWe can also see a header added by Exchange marking it as an internal email. The\nexchange server also has added a header of the original client (172.29.5.131 which also is\n[a local IP address) that connected to the Exchange server over MAPI.](https://social.technet.microsoft.com/Forums/lync/en-US/4775f066-4734-4ccd-a998-0ea43fad7069/xmsexchangeorganizationauthmechanism-possible-values?forum=exchangesvrsecuremessaging)\n\n\n-----\n\n```\nReceived: from ExchSrv01.[REDACTED].local (172.29.0.12) by\n ExchSrv01.[REDACTED].local (172.29.0.12) with Microsoft SMTP Server\n (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.2.464.5\n via Mailbox Transport; Thu, 10 Mar 2022 14:34:29 +0100\nReceived: from ExchSrv01.[REDACTED].local (172.29.0.12) by\n ExchSrv01.[REDACTED].local (172.29.0.12) with Microsoft SMTP Server\n (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.2.464.5;\n Thu, 10 Mar 2022 14:34:29 +0100\nReceived: from ExchSrv01.[REDACTED].local ([fe80::b148:8e7:61f8:61b4]) by\n ExchSrv01.[REDACTED].local ([fe80::b148:8e7:61f8:61b4%6]) with mapi id\n 15.02.0464.005; Thu, 10 Mar 2022 14:34:29 +0100\n…\nX-MS-Exchange-Organization-AuthAs: Internal\nX-MS-Exchange-Organization-AuthMechanism: 04\nX-MS-Exchange-Organization-AuthSource: ExchSrv01.[REDACTED].local\nX-MS-Has-Attach: yes\nX-MS-Exchange-Organization-SCL: -1\nX-MS-Exchange-Organization-RecordReviewCfmType: 0\nx-ms-exchange-organization-originalclientipaddress: 172.29.5.131\nx-ms-exchange-organization-originalserveripaddress: fe80::b148:8e7:61f8:61b4%6\n\n```\nWe didn’t manage to find a corresponding public IP address for this Exchange server and it\nis not known to us how it was accessed by the threat actor. The only thing we managed to\n[find was a roundcube webmail instance. The login page is shown in the screenshot below.](https://roundcube.net/)\n\nOne of the headers in the snippet above reported that the client connected to the server via\nMAPI. [MAPI is a protocol used (for example, by Outlook) to access the mailbox on an](https://docs.microsoft.com/en-us/exchange/clients/mapi-mailbox-access?view=exchserver-2019)\nExchange server. This suggests that the threat actor used an Exchange client instead of\nusing SMTP to send the email. We have also seen the header “X-Mailer: Microsoft Outlook\n16.0” in multiple phishing emails. In other phishing emails a “X-Originating-IP” header can\nbe found. This is a header added by the Exchange server when the web interface is used.\nThe IP address in the header is that of the client that connected to the server. We have\nobserved both hosting providers and non-commercial IP addresses for the client IP.\n\n## Attribution\n\n\n-----\n\n[In June 2021, Proofpoint released a report on different access brokers that facilitates](https://www.proofpoint.com/uk/blog/threat-insight/first-step-initial-access-leads-ransomware)\naccess for ransomware groups. Of the different threat actors, according to Proofpoint, two\nof them (TA577 and TA551) used IcedID as their malware. The techniques used by TA551\n[include conversation hijacking and](https://www.proofpoint.com/us/blog/security-briefs/ta551-uses-sliver-red-team-tool-new-activity) [password](https://www.mandiant.com/resources/melting-unc2198-icedid-to-ransomware-operations) [protected](https://unit42.paloaltonetworks.com/ta551-shathak-icedid/) [zip files. The group is also known to](https://unit42.paloaltonetworks.com/ta551-shathak-icedid/)\nuse regsvr32.exe for signed binary proxy execution for malicious DLLs.\n\n## Summary\n\nThe use of conversation hijacking is a powerful social engineering technique that can\nincrease the rate of a successful phishing attempt. The payload has been moved away from\noffice documents to the use of ISO files, employing the use of commodity packers and\nmultiple stages to hide activity. It is important to be able to detect malicious files in memory\n[to detect this type of attack. We recommend you use an endpoint scanner.](https://support.intezer.com/hc/en-us/articles/360021350340-Conduct-Live-Endpoint-Analysis)\n\n## IoCs\n```\nISO File:\n3542d5179100a7644e0a747139d775dbc8d914245292209bc9038ad2413b3213\nLoader DLL:\n698a0348c4bb8fffc806a1f915592b20193229568647807e88a39d2ab81cb4c2\nLNK File:\na17e32b43f96c8db69c979865a8732f3784c7c42714197091866473bcfac8250\nIcedID GZiploader Network:\nyourgroceries[.]top\n\n```\n**Joakim Kennedy**\n\n\n-----\n\nDr. Joakim Kennedy is a Security Researcher analyzing malware and tracking threat actors\non a daily basis. For the last few years, Joakim has been researching malware written in\nGo. To make the analysis easier he has written the Go Reverse Engineering Toolkit\n(github.com/goretk), an open-source toolkit for analysis of Go binaries.\n\n**Ryan Robinson**\nRyan is a security researcher analyzing malware and scripts. Formerly, he was a researcher\non Anomali's Threat Research Team.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-28 - New Conversation Hijacking Campaign Delivering IcedID.pdf"
    ],
    "report_names": [
        "2022-03-28 - New Conversation Hijacking Campaign Delivering IcedID.pdf"
    ],
    "threat_actors": [
        {
            "id": "26a04131-2b8c-4e5d-8f38-5c58b86f5e7f",
            "created_at": "2022-10-25T15:50:23.579601Z",
            "updated_at": "2025-03-27T02:00:55.50292Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "TA551",
                "GOLD CABIN",
                "Shathak"
            ],
            "source_name": "MITRE:TA551",
            "tools": [
                "QakBot",
                "IcedID",
                "Valak",
                "Ursnif"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "04e34cab-3ee4-4f06-a6f6-5cdd7eccfd68",
            "created_at": "2022-10-25T16:07:24.578896Z",
            "updated_at": "2025-03-27T02:02:10.286803Z",
            "deleted_at": null,
            "main_name": "TA551",
            "aliases": [
                "Gold Cabin",
                "Monster Libra",
                "Shathak",
                "TA551"
            ],
            "source_name": "ETDA:TA551",
            "tools": [
                "BokBot",
                "CRM",
                "Gozi",
                "Gozi CRM",
                "IceID",
                "IcedID",
                "Papras",
                "Snifula",
                "Ursnif",
                "Valak",
                "Valek"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c3c864b3-fac9-4d56-8500-7c06c829fbf8",
            "created_at": "2023-01-06T13:46:39.071873Z",
            "updated_at": "2025-03-27T02:00:02.990045Z",
            "deleted_at": null,
            "main_name": "TA2101",
            "aliases": [
                "Storm-0216",
                "DEV-0216",
                "UNC2198",
                "Maze Team",
                "TWISTED SPIDER",
                "GOLD VILLAGE"
            ],
            "source_name": "MISPGALAXY:TA2101",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "90f216f2-4897-46fc-bb76-3acae9d112ca",
            "created_at": "2023-01-06T13:46:39.248936Z",
            "updated_at": "2025-03-27T02:00:03.031127Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "Shakthak",
                "TA551",
                "ATK236",
                "G0127",
                "Monster Libra"
            ],
            "source_name": "MISPGALAXY:GOLD CABIN",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b4f83fef-38ee-4228-9d27-dde8afece1cb",
            "created_at": "2023-02-15T02:01:49.569611Z",
            "updated_at": "2025-03-27T02:00:03.114739Z",
            "deleted_at": null,
            "main_name": "TA577",
            "aliases": [
                "Hive0118"
            ],
            "source_name": "MISPGALAXY:TA577",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "40b623c7-b621-48db-b55b-dd4f6746fbc6",
            "created_at": "2024-06-19T02:03:08.017681Z",
            "updated_at": "2025-03-27T02:05:17.342829Z",
            "deleted_at": null,
            "main_name": "GOLD CABIN",
            "aliases": [
                "TA551 ",
                "Shathak"
            ],
            "source_name": "Secureworks:GOLD CABIN",
            "tools": [
                ""
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "e3676dfe-3d40-4b3a-bfbd-4fc1f8c896f4",
            "created_at": "2022-10-25T15:50:23.808974Z",
            "updated_at": "2025-03-27T02:00:55.550912Z",
            "deleted_at": null,
            "main_name": "Magic Hound",
            "aliases": [
                "Magic Hound",
                "TA453",
                "COBALT ILLUSION",
                "Charming Kitten",
                "ITG18",
                "Phosphorus",
                "APT35",
                "Mint Sandstorm"
            ],
            "source_name": "MITRE:Magic Hound",
            "tools": [
                "Impacket",
                "CharmPower",
                "FRP",
                "Mimikatz",
                "Systeminfo",
                "ipconfig",
                "netsh",
                "PowerLess",
                "Pupy",
                "DownPaper",
                "PsExec",
                "Havij",
                "sqlmap"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "1699fb41-b83f-42ff-a6ec-984ae4a1031f",
            "created_at": "2022-10-25T16:07:23.83826Z",
            "updated_at": "2025-03-27T02:02:09.995863Z",
            "deleted_at": null,
            "main_name": "Magic Hound",
            "aliases": [
                "APT 35",
                "Ballistic Bobcat",
                "Charming Kitten",
                "CharmingCypress",
                "Cobalt Illusion",
                "Cobalt Mirage",
                "Educated Manticore",
                "Magic Hound",
                "Mint Sandstorm",
                "Operation BadBlood",
                "Operation Sponsoring Access",
                "Operation SpoofedScholars",
                "Operation Thamar Reservoir",
                "Phosphorus",
                "TA453",
                "TEMP.Beanie",
                "Tarh Andishan",
                "Timberworm",
                "TunnelVision",
                "UNC788",
                "Yellow Garuda"
            ],
            "source_name": "ETDA:Magic Hound",
            "tools": [
                "7-Zip",
                "AnvilEcho",
                "BASICSTAR",
                "CORRUPT KITTEN",
                "CWoolger",
                "CharmPower",
                "ChromeHistoryView",
                "CommandCam",
                "DistTrack",
                "DownPaper",
                "FRP",
                "Fast Reverse Proxy",
                "FireMalv",
                "Ghambar",
                "GoProxy",
                "GorjolEcho",
                "HYPERSCRAPE",
                "Havij",
                "MPK",
                "MPKBot",
                "Matryoshka",
                "Matryoshka RAT",
                "MediaPl",
                "Mimikatz",
                "MischiefTut",
                "NETWoolger",
                "NOKNOK",
                "PINEFLOWER",
                "POWERSTAR",
                "PowerLess Backdoor",
                "PsList",
                "Pupy",
                "PupyRAT",
                "SNAILPROXY",
                "Shamoon",
                "TDTESS",
                "WinRAR",
                "WoolenLogger",
                "Woolger",
                "pupy",
                "sqlmap"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "22d450bb-fc7a-42af-9430-08887f0abf9f",
            "created_at": "2024-11-01T02:00:52.560354Z",
            "updated_at": "2025-03-27T02:00:55.425961Z",
            "deleted_at": null,
            "main_name": "TA577",
            "aliases": [
                "TA577"
            ],
            "source_name": "MITRE:TA577",
            "tools": [
                "Pikabot",
                "QakBot",
                "Latrodectus"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535597,
    "ts_updated_at": 1743041774,
    "ts_creation_date": 1653709785,
    "ts_modification_date": 1653709785,
    "files": {
        "pdf": "https://archive.orkl.eu/9d7553acb584b7d18eff4b8c70bde7faf0123ad0.pdf",
        "text": "https://archive.orkl.eu/9d7553acb584b7d18eff4b8c70bde7faf0123ad0.txt",
        "img": "https://archive.orkl.eu/9d7553acb584b7d18eff4b8c70bde7faf0123ad0.jpg"
    }
}