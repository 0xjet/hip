{
    "id": "cd2b6f8e-a82d-4820-9c8c-d3ca64b78348",
    "created_at": "2023-01-12T15:03:11.861995Z",
    "updated_at": "2025-03-27T02:09:17.823924Z",
    "deleted_at": null,
    "sha1_hash": "9ebd838542347eebb682a21b8bca5da537d6b524",
    "title": "2022-02-24 - New Wave of Emotet – When Project X Turns Into Y",
    "authors": "",
    "file_creation_date": "2022-05-28T15:37:11Z",
    "file_modification_date": "2022-05-28T15:37:11Z",
    "file_size": 2975180,
    "plain_text": "# New Wave of Emotet – When Project X Turns Into Y\n\n**[cynet.com/attack-techniques-hands-on/new-wave-of-emotet-when-project-x-turns-into-y/](https://www.cynet.com/attack-techniques-hands-on/new-wave-of-emotet-when-project-x-turns-into-y/)**\n\n**By: Max Malyutin – Orion Threat Research and Intelligence Team Leader**\n\n## Prologue\n\n[Emotet first appeared in June 2014 as a banking trojan and has mainly been used since to](https://attack.mitre.org/software/S0367/)\ntarget the financial sector. In 2021, Emotet was classified as the most widely seen malware\nby law enforcement and judicial authorities. Back in January 2021, law enforcement and\njudicial authorities took down the Emotet botnet. On November 15, 2021, Emotet\nreturned as [reported by the Cryptolaemus team.](https://twitter.com/Cryptolaemus1/status/1460302706954981385)\n\nCynet Orion Threat Research and Intelligence Team are closely tracking Emotet TTPs\n(tactics, techniques, and procedures) on a daily basis, and have seen some rapid and\ndrastic changes since its return. On February 21, 2022, we observed a new Emotet\ncampaign where it utilizes new attack methods and TTPs. We have detected a mass\n**malicious email distribution and a high volume of traffic on two main botnets Epoch 4**\nand Epoch 5.\n\nWhile investigating, we found the use of a new artifact which did not exist in previous\ncampaigns, “Y.dll”. In the previous Emotet campaign, on November 15, the malware was\n[branded “Project X” – an alias given due to the internal use of the name X.dll. Likewise, we](https://www.advintel.io/post/corporate-loader-emotet-history-of-x-project-return-for-ransomware)\ndecided to name the new Emotet variant “Project Y”.\n\n\n-----\n\nEmotet campaigns start with a malspam email and in most cases, it utilizes a thread\nhijacking method to deceive users into trusting the email. Thread hijacking is a method in\nwhich the email’s subject title begins with “RE:”, pretending to be a legitimate email reply.\nThis email’s contents are stolen from previous Emotet infections. In some cases, Emotet\nmalspam campaigns contain attachments in the form of Word or Excel documents. We\nhave also observed password-protected zip archives being sent as attachment in such\nmalspam emails.\n\n### A Brief History of Emotet:\n\nEmotet threat group members collaborated in the past with Trickbot’s operators by\ndeploying each other’s payloads during infections. Before the takedown, the Emotet killchain flow consisted of dropping Trickbot’s payload which led to ransomware infection by\nRyuk (CONTI). The first indication of the return of Emotet on Nov 15, 2021, was discovered\nby cyber security researchers that noticed that Trickbot payloads are dropping Emotet’s\nloader. After a month, on [December 15, we discovered that Emotet started deploying Cobalt](https://www.bleepingcomputer.com/news/security/emotet-starts-dropping-cobalt-strike-again-for-faster-attacks/)\nStrike beacons on the compromised hosts. This is new behavior of Emotet might indicate\nthat additional new capabilities and strategies might be used as well.\n\n### Summary\n\nSince the return, Emotet struck with a diverse arsenal of TTPs, such as malicious\ndocuments, in both Word and Excel formats, that contain either VBA or XLM macros.\nLikewise, we also observed different LOLBins abused by Emotet such as mshta,\nPowerShell, wscript, rundll32, and more. We will cover the changes (TTPs) Emotet\nunderwent since its return in November 15 in a separate article. In the current article, we\nwill review the recent (February 21, 2022) Emotet campaign’s infection activity which\nconsists of new TTPs and the new Y.dll payload.\n\n### Initial Access and Execution Flow:\n\n[Initial access was delivered via malspam email with an attachment of password-protected](https://attack.mitre.org/techniques/T1566/001/)\nzip that contains an Excel malicious document. We have observed two types of Excel\ndocuments, one has protected VBA macro and the second has XLM version 4.0 macros. In\nboth cases, the user needs to enable macros to start the infection. Shown in figure 1-2:\n\n### The document with the XLM macros:\n\n\n-----\n\nFigure 1: Shows the Emotet malicious document XLM macro, hidden sheets and AutoOpen\nfunction\n\nFigure 1.1: Shows XLM macro code that utilizes native API functions to download and\nexecute Emotet payload\n\n### The document with the VBA macros:\n\n\n-----\n\nFigure 2: Shows the Emotet malicious document with a new fake message that deceives\nthe user to enable the VBA macros\n\nFigure 2.1: Shows the protected malicious VBA macro code\n\n\n-----\n\nFigure 2.2: Shows obfuscated VBA macro code from the Workbook_Open function\n[After the user enables the macros to run (User Execution, T1204), the infection continues](https://attack.mitre.org/techniques/T1204/002/)\nwith the execution by abusing LOLBins. Same as before, each document has its unique\nflow as explained below:\n\n### The document with the XLM macros:\n\nAs shown in figure 3, the execution continues with the abuse of the LOLBin (Living Off the\nLand Binaries), regsvr32:\n\nFigure 3: Execution flow of the XLM macros document\nWe observed a repeated pattern in the regsvr32 command lines in all the samples that we\nanalyzed.\n\nIn case the document is not opened with an Administrator privilege, as part of the\nexecution, the payload is copied and executed from the %LOCALAPPDATA% directory:\n\nregsvr32.exe /s ..\\{random_payload_name}.ocx\n\n└── regsvr32.exe /s “C:\\Users\\{user_name}\\AppData\\Local\\{random_directory}\\\n{random_payload_name}.{random_extension}”\n\nIn case the document is opened with an Administrator privilege, as part of the execution,\nthe payload is copied and executed from the SysWoW64 directory in %WINDIR%:\n\n\n-----\n\nregsvr32.exe /s ..\\{random_payload_name}.ocx\n└── regsvr32.exe /s “regsvr32.exe /s C:\\Windows\\SysWOW64\\{random_directory}\\\n{random_payload_name}.{random_extension}”\n\nAll the patterns above can be used for both threat hunting and detection purposes.\n\n### The document with the VBA macros:\n\nAs shown in figure 3, the execution continues with the abuse of the various LOLBins:\n\nFigure 4: Execution flow of the VBA macros document\nAlso here, we observed a repeated pattern in the command lines of the LOLBins that take\npart in the execution flow.\n\nwscript c:\\programdata\\{random_payload_name}.vbs\n\n├── powershell.exe -command …\n\n└── cmd.exe /c start /B c:\\windows\\syswow64\\regsvr32.exe /s c:\\programdata\\\n{random_payload_name}.dll\n\n———-└── regsvr32.exe /s c:\\programdata\\{random_payload_name}.dll\n\n———————└── regsvr32.exe /s “C:\\Users\\{user_name}\\AppData\\Local\\\n{random_directory}\\{random_payload_name}.{random_extension}”\n\nThe VBScript code, which is executed by wscript, and the PowerShell command are shown\nin figures 5 and 6:\n\n\n-----\n\nFigure 5: Shows the VBS (Visual Basic Script) file contents that are is obfuscated by the\nreplace method and concatenation. This is the code that eventually executes the\nPowerShell command\n\nFigure 6: Shows the PowerShell command that executed as a one-liner via the PowerShell\nprocess\nThe above PowerShell command is responsible for both downloading the Emotet payload\nfrom a list of compromised URLs. The execution of the Emotet payload is performed by the\nCMD process.\n\n## Persistence and Privilege Escalation\n\nAfter the Emotet payload is copied to a new location (%WINDIR%/SysWoW64 or\n%APPDATALOCAL%), it attempts to create persistence on the compromised host. The\npayload utilizes different persistence techniques and the differences between them is based\non the user privilege.\n\nIn the unprivileged case, the payload achieves persistence by creating a Run key in the\n[Registry (Boot or Logon Autostart Execution: Registry Run Keys, T1547.001), as shown in](https://attack.mitre.org/techniques/T1547/001/)\nfigures 7.1 and 7.2:\n\n\n-----\n\nFigure 7.1: Shows the Registry Run key with the payload execution command\n\nFigure 7.2: Shows the Emotet payload in the %APPDATALOCAL% path\nIn the Administrator-privileged case, the payload achieves persistence by creating a service\n[(Create or Modify System Process: Windows Service, T1543.003), as shown in figures 8.1](https://attack.mitre.org/techniques/T1543/003/)\nand 8.2:\n\n\n-----\n\nFigure 8.1: Shows the service’s key in the Registry which contains the payload execution\ncommand\n\nFigure 8.2: Shows the Emotet payload in the SysWoW64 path\n\n## Differences between Project X and Project Y\n\nIn the previous campaign, Emotet’s core module was named X.dll. In the new campaign\n(February 21, 2022) We have observed a different name for the core module, Y.dll. The\ncore module comes with the export function DllRegisterServer. This naming convention\ncould be an indicator for new Emotet variants. We are still investigating this assumption.\n\nBoth X.dll and Y.dll core modules are unpacked inside regsvr32 memory and can be\nextracted from it, as shown in the figure below:\n\n\n-----\n\nFigure 9: Shows the unpacked Emotet payload inside the memory\n\nWe have compared both core modules, X.dll and Y.dll, and found some differences, as\nshown in figures 10-11:\n\nFigure 10: Shows X.dll with the time stamp 31.01.2022\n\n\n-----\n\nFigure 11: Shows the Y.dll with the time stamp 21.02.2022\nAs can be seen in figures 12-13, both core modules are exporting the DllRegisterServer\nfunction, which is executed by the regsvr32 as part of the execution flow:\n\nFigure 12: Shows the DllRegisterServer export function inside X.dll\n\n\n-----\n\nFigure 13: Shows the DllRegisterServer export function inside Y.dll\n\n## MITRE Techniques\n\nSpearphishing Attachment – T1566.001\n\nWindows Command Shell – T1059.003\n\nPowerShell – T1059.001\n\nVisual Basic – T1059.005\n\nDynamic Data Exchange – T1559.002\n\nNative API – T1106\n\nMalicious File – T1204.002\n\nRegistry Run Keys / Startup Folder – T1547.001\n\nWindows Service – T1543.003\n\nService Execution – T1569.002\n\nRegsvr32 – T1218.010\n\n## Indicators of Compromise\n\n\n-----\n\n**MD5 hash** **Type**\n\n\n57595f82e73bed372c669e907d4db642\n4af61ef4287eb683eb2869e1fba61fd9\n\nf5e7d2c7e4568efb55d999bfd3e5e0ac\n\n3a3bfc5e4f8573b0ef10ac5693d76d78\n\na7f7aef892b99248f072d55802e657a5\n\n464618b1bb56d13bd7d4c703ec9d3c1f\n\n4014333649b5c8a189ec8308cfdb54d9\n\n492ebe377b5974b4a9f47e9831cc6555\n824f883a79f90cc31272bed6f56f2c7d\n\n8ba05c5653ab14ae48058c70e401fbd3\n\ne397e14490f1d0d71aa7d6c9f2b5331b\n\n45e49c0baa32799b15259b3367e58770\n\ncf99fabd8a930ede37f007139d4370f2\n\n6df575e25cc88a6e3a9306dbf2efe39c\n\n\nDLL\n\nXLS\n\n\n7baad56cc483132b8b9cb7a14722c3b1 VBS\n\n**Distribution URLs**\n\nhttp://explorationit[.]com/screwing/AxLm/\n\nhttp://www[.]beholdpublications[.]com/home/BABxyyWZx8Vu/\n\nhttp://myclassroomtime[.]com/mongery/ZlPsROtQiXIujmJmAA/\n\nhttp://www[.]ajaxmatters[.]com/c7g8t/zbBYgukXYxzAF2hZc/\n\nhttp://animalsandusfujairah[.]com/wp-admin/JWO58zeUOwSI/\n\nhttp://vipwatchpay[.]com/Isoetales/5wy8L0TQ1xCZEr/\n\nhttps://duvarkagitlarimodelleri[.]com/42hhp/gZXakh7/\n\nhttps://havuzkaydiraklari[.]com/wp-includes/YqYdLFA/\n\nhttps://dalgahavuzu[.]com/pwkfky/LF0WU/\n\nhttps://kinetekturk[.]com/e2ea69p/9U52O7jTobF8J/\n\n**Emotet C2 servers**\n\n\n-----\n\n150.95.20[.]209\n213.190.4[.]223\n\n135.148.121[.]246\n\n103.96.220[.]147\n\n134.209.156[.]68\n\n79.143.181[.]160\n\n50.30.40[.]196\n\n156.67.219[.]84\n\n175.107.196[.]192\n\n103.134.85[.]85\n\n207.38.84[.]195\n\n46.41.130[.]218\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-24 - New Wave of Emotet – When Project X Turns Into Y.pdf"
    ],
    "report_names": [
        "2022-02-24 - New Wave of Emotet – When Project X Turns Into Y.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535791,
    "ts_updated_at": 1743041357,
    "ts_creation_date": 1653752231,
    "ts_modification_date": 1653752231,
    "files": {
        "pdf": "https://archive.orkl.eu/9ebd838542347eebb682a21b8bca5da537d6b524.pdf",
        "text": "https://archive.orkl.eu/9ebd838542347eebb682a21b8bca5da537d6b524.txt",
        "img": "https://archive.orkl.eu/9ebd838542347eebb682a21b8bca5da537d6b524.jpg"
    }
}