{
    "id": "099db78c-eadf-4aea-a961-a575fd3c776d",
    "created_at": "2023-01-12T15:04:44.58404Z",
    "updated_at": "2025-03-27T02:16:59.190344Z",
    "deleted_at": null,
    "sha1_hash": "b333758c4a7b3b88e9d2256494d08ac92b51fec4",
    "title": "2022-09-15 - Threat Alert- New Malware in the Cloud By TeamTNT",
    "authors": "",
    "file_creation_date": "2022-10-02T12:12:26Z",
    "file_modification_date": "2022-10-02T12:12:26Z",
    "file_size": 867332,
    "plain_text": "# Threat Alert: New Malware in the Cloud By TeamTNT\n\n**blog.aquasec.com/new-malware-in-the-cloud-by-teamtnt**\n\nAssaf Morag\n\nAssaf Morag\n\nSeptember 15, 2022\nOver the past week we observed three different attacks on our honeypots. The scripts and\nmalware that were used bear a striking resemblance to none other than the threat actor\nTeamTNT. Eleven months ago they posted a farewell note on Twitter. Since then, we have\n\n\n-----\n\nonly seen legacy attacks which automatically run on past infrastructure. Could it be that\nTeamTNT is back with new tricks? In this blog we analyze these attacks and their possible\nconnection to TeamTNT.\n\n## A Brief History of TeamTNT\n\nIn the beginning of 2020, TeamTNT emerged as a threat actor mainly targeting cloud\nenvironments including misconfigured Kubernetes clusters, Docker APIs, Kubernetes UI\ntools, Redis servers, and more.\n\nSince that first attack, this threat actor was highly productive and innovative, introducing new\ntechniques against cloud environments that hadn’t been seen before. There had been many\nreports over the years about the threat actor’s campaigns and toolbox.\n\nOn November 6th, 2021, TeamTNT communicated via Twitter a farewell note. In reality, their\ninfrastructure continued to automatically infect new victims with old malware as their tools\nincluded various worms that could scan and infect new targets. Once a target is acquired, a\nnew scan and infection sequence begins. Thus, as of today, their old campaigns continues\nworking. Still, over the past eleven months we haven’t seen any new campaigns or tools\ncoming from TeamTNT. This has led the entire community to assume that TeamTNT had\nindeed stopped their activity.\n\nTweet by TeamTNT saying farewell on November 6th, 2021\n\nBut, are they back?\n\n\n-----\n\nIn the first week of September, our honeypots identified at least three different attacks\nbearing various signatures and tools which are associated with TeamTNT. Based on these,\nwe are quite certain that this vibrant threat actor has renewed its malicious activity.\nWith these new attacks, should we expect further innovation and cunning from TeamTNT?\n\n### The Kangaroo Attack\n\nBy far, this may be their simplest and most dramatic attack. What we discovered is that\nTeamTNT has been scanning for a misconfigured Docker Daemon and deploying alpine, a\nvanilla container image, with a command line to download a shell script (k.sh) to a C2 server\n(domain: whatwill[.]be on IP 93[.]95[.]229[.]203).\n\nKangaroo attack flow\n\n\n-----\n\n_The file k.sh that was dropped and executed on the attacked server_\nThe shell script is cloning a GitHub project from what seems to be a TeamTNT account. The\nproject was a bit of a conundrum at first, specifying that this is a fork of “Pollard's kangaroo\n[for SECPK1”. We consulted Jonathan S., a cryptographic expert, to better understand this](https://www.youtube.com/johnnytime)\ntechnique. Additionally, we conducted further research to shed light on what we observed.\n[We tracked this topic within a Bitcoin talk forum as well as several academic papers, “A New](https://bitcointalk.org/index.php?topic=5244940.0)\nMethod for Solving the Elliptic Curve Discrete Logarithm Problem”, “How Would Quantum\n[Computing Impact the Security of Bitcoin by Enhancing Our Ability to Solve the Elliptic Curve](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3232101)\nDiscrete Logarithm Problem?” and the best explanation about Pollard’s Kangaroo for WIF\nsolving. In addition, we consulted with a cryptographic expert to better understand this topic.\n\nSince these articles are a challenging read, we‘ve worked here to summarize them for you to\nhighlight the most essential information. The Elliptic Curve Discrete Logarithm Problem\n(ECDLP) is considered an irreversible function. It is the foundation for secure cryptography in\nprivate and public keys encryption which is the bedrock of secure internet communication\n(SSH, SSL etc).\n\nThe Pollard’s Kangaroo interval ECDLP solver algorithm appears to be an attempt to break\nthe SECP256K1 encryption which is used by Bitcoin to implement its public key\ncryptography. This is interesting because TeamTNT is using the high (and free or illegal)\ncomputational power of their targets to run the ECDLP solver. It is designed to run in a\ndistributed fashion since the algorithm breaks the key into chunks and distributes them to\nvarious nodes (attacked servers), collecting the results which are then written locally to a text\nfile.\n\nBreaking the cryptographic encryption is considered “Mission: Impossible”. If you actually\nsucceed doing that, you potentially have the keys to almost everything that is connected\nonline, which could have a devastating effect on the entire internet.\n\n### The Cronb Attack\n\n\n-----\n\nThis name had been used in the past by TeamTNT in previous attacks and, thus, thought to\nhave been associated with an old attack. However, it turns out that this script is novel,\npointing to new C2 servers (on 93[.]95[.]229[.]203 and 205[.]185[.]118[.]246). In this attack,\nthough, we see all the old tricks TeamTNT has used over the years including rootkits to hide\ntheir activity, cron jobs to gain persistence, cryptominers to hijack resources, ssh and keys\ntheft to conduct lateral movement in the local and external network, and many other\ntechniques seen in the past.\n\nCronb.sh shell file:\n\nFirst, the C2 server (93[.]95[.]229[.]203) is defined as a variable. The file is designed to\n“initiate” the environments and contains 14 functions as follows:\n\n1. check_exist:\n\n1. Checks if netstat, which is a Linux network utility that displays network\n\nconnections information, is present.\n2. If netstats exists, the function also checks for cryptominers presence.\n2. m_command: This function scans for various applications like wget on the host and\n\nsets them as environment variables if they exist. In past campaigns, TeamTNT\ncommonly used this technique mostly to avoid detection and circumvent network\ncontrols.\n3. ins_package: Installs various applications on Ubuntu, Alpine, and Debian distributions\n\nby using apk, apt, or yum commands based on the OS distribution.\n4. SetupNameServers: Setting up a name server to circumvent network defense. In past\n\ncampaigns, TeamTNT commonly used this technique.\n5. download_f: Downloading a Monero cryptominer and its configuration file and\n\nexecuting a cryptojacking attack.\n6. setup_s: Deleting the content of md service and installing a new service of\n\ncryptomining to be run by systemd.\n7. makesshaxx: Inserts TeamTNT’s SSH key to the host.\n8. clean_monitor: Deletes history and stops and deletes security tools such as SElinux,\n\nwatchdog, gcloud of GCP, and aegis of Alibaba cloud.\n9. clean_cron: Very straightforward - deletes all cron scheduled jobs.\n10. lock_cron: Locking the cron jobs.\n\n11. exec_hide: Makes sure that Diamorphine rootkit is deployed and calls exec_f. If\n\nDiamorphine isn’t deployed, the hide_f function is called.\n\n[1. hide_f: Extracts a contained encoded (base64) tar file of Diamorphine rootkit,](https://blog.aquasec.com/linux-syscall-hooking-using-tracee)\n\nextracts, compiles, and checks that it was deployed successfully.\n2. exec_f: Hides the malicious processes of masscan and md service executed.\n[12. exec_hide2: Deploys prochider rootkit that hides itself, explained here.](https://blog.aquasec.com/cryptojacking-cloud-network-bandwidth)\n13. clmo: Stops and deletes security tools of Alibaba cloud.\n\n\n-----\n\n14. exe_remo: Checks if this server has /var/tmp/.kalaf which may indicate that TeamTNT\n\nbotnet has already attacked this server. If not, executes the localgo function,\ndownloads and runs s.sh shell file and cleans history.\n\n1. localgo: Deletes logs such as wtmp which documents ssh access to the server\n\nand uses known hosts and ssh keys (if exists) to access other servers on the\nnetwork, infecting them by deploying and running the script b.sh (ronb.sh\nrenamed) on them. In past campaigns TeamTNT commonly used this technique.\n\ns.sh shell file:\n\nThis file also uses the C2 server (93[.]95[.]229[.]203) and another C2 server\n(205[.]185[.]118[.]246). The file is designed to “support” the attack and contains one function\nand various snippets as follows:\n\n1. m_command: Similar to the one in cronb.sh file as described above.\n2. The rest of the script is not as organized as the cronb.sh script. It contains several\n\nsnippets:\n\n1. Designed to download various applications.\n2. Downloads zgrab, masscan, pnscan which are scanning applications.\n3. Downloads the shell scripts c.sh and d.sh.\n\n4. Deleting the content of md service and installing a new service of cryptomining to\n\nbe run by systemd.\n\nb.sh shell file:\n\nIdentical to the cronb.sh script.\n\nc.sh shell file:\n\nThis script seems to be designed to deploy a cryptomining attack on vulnerable and\nmisconfigured Redis services and contains the following snippets:\n\n1. Changing iptables to allow scanning for Redis servers.\n2. Creating the payload which is a .dat file that writes to cron, downloads, and runs the\n\nb.sh shell script.\n3. Scanning locally and on the internet for exposed Redis services and running the .dat\n\nfile.\n\n\n-----\n\nThe file c.sh is designed to detect and attack exposed Redis server. In the past, TeamTNT\n\n[massively attacked Redis servers to mine cryptocurrency. Read more about it here](https://blog.aquasec.com/container-attacks-on-redis-servers)\n\n### The “What Will Be” Attack\n\nThis is the third attack by TeamTNT that that we observed this week on our honeypots.\nInitially, the threat actor exploited a misconfigured Docker API to run the vanilla container\nimage alpine with a malicious command that was designed to download and run the shell file\ndc.sh.\n\n\n-----\n\ndc.sh shell file:\nThis file contains two very interesting functions designed to exploit the release_agent\nvulnerability in order to escape to the host from the container. You can further read about it\n[here iin a previous blog from our team.](https://blog.aquasec.com/threat-alert-container-escape)\n\n\n-----\n\nAs can be seen in the two screenshots below, in both functions the threat actor is\ndownloading and running further shell scripts.\n\n_The first function from the shell file dc.sh_\n\n_The second function from the shell file dc.sh_\n\nThe first function (dock1) and the second one (dock2) download the shell scripts en.sh,\nwhich is designed to optimize cryptomining by using ‘wrmsr’ and meant to write to model a\nspecific register. It allows writing to CPU machine specific registers. As can be seen below,\nthe attackers appear to be trying to address the specific registers to optimize CPU for\ncryptomining based on the microarchitecture.\n\nApparently, TeamTNT has added some new tricks since this technique did not appear to be\nused in the past by the group.\n\n\n-----\n\nIn the first function (dock1) d.sh is downloaded and run. It is identical to the one used in the\ncronb attack described above. We could see that a download and execution of a “syslog”\nbinary from the C2 server is commented out. That binary is available for download from the\nC2 server and is actually a Tsunami malware (MD5: 1ded4ed94ab31f1a3bba3a50cfa7238f,\n[32 detections in VT), commonly used in the past by TeamTNT. It could be that their](https://www.virustotal.com/gui/file/8a04585157033b86cb2c104f441d236bc3255b46127355f8342b75ab40eb3e35)\ninfrastructure is not fully online and thus it wasn’t used in this attack.\n\nIn the second function (dock2), there are two comments that are supposed to open a\nbackdoor. This technique is also new since it wasn’t seen by the group in the past.\nAdditionally, Tsunami malware (syslog) and ent.sh shell file (en.sh renamed) downloads are\nkept as a comment as well.\n\n### Iterating back to the GitHub Account\n\n\n-----\n\nIn the Kangaroo attack analyzed above, we mentioned that the GitHub account used to host\nthe repository of the Kangaroo project is most likely utilized by TeamTNT. The name of the\n[account is ‘wafferz’ which means armory in German. In the past, there were many indications](https://github.com/wafferz)\nin TeamTNT’s code, repositories, websites, servers, and Twitter account that have a German\norigin. In this attack it is no different. In the code, their “sense of humor\" is apparent in the\ncomments and prints to logs.\n\nIn the project Dock in the GitHub account, you can see a further link to TeamTNT since most\nof the code is strikingly similar to the attacks described here. The shell script scan.sh is\nparticularly interesting and designed to search for misconfigured Docker environments and\ndeploy malware. In a comment we found a link to the main server TeamTNT used in the past,\nteamtnt[.]red. It looks like the server is offline.\n\nInterestingly this account also contains the fork of an argo workflows project. Could it be that\nTeamTNT is planning something in the future to exploit this application?\n\n### Final Thoughts\n\nTeamTNT was highly active between 2020 and 2021. They had used many tools and\ntechniques in their campaigns and had launched them frequently. Some of these tools had\nbeen designed to escape from container environments, steal tokens and credentials, scan\nand attack local and external networks, hide activities with rootkits, and more.\n\nNow TeamTNT appears to be back with new tricks. We are still assessing if these three\nattacks are a sign that they have resumed their campaigns against cloud native\nenvironments or not.\nRegardless of the question if TeamTNT is back or not, we strongly encourage organizations\nto empower their security teams with Cloud Native Application Protection Platform (CNAPP)\nsolutions that cover various stages of the cloud development pipeline and enable greater\nvisibility and context.\n\nThis blog was co-authored by:\n\n\n-----\n\n[Asaf Eitani](https://blog.aquasec.com/author/asaf-eitani)\n\nAsaf is a Security Researcher at Aqua Nautilus research team. He focuses on researching\nLinux malware, developing forensics tools, and analyzing new attack vectors in cloud native\nenvironments. In his spare time, he likes painting, playing beach volleyball, and carving wood\nsculptures.\n\n**Assaf Morag**\n\nAssaf is a Lead Data Analyst at Aqua Nautilus research team, he focuses on supporting the\ndata needs of the team, obtaining threat intelligence and helping Aqua and the industry stay\non the forefront of new threats and methodologies for protection. His work has been\npublished in leading info security publications and journals across the globe, and most\nrecently he contributed to the new MITRE ATT&CK Container Framework.\n\n[Advanced Threat Mitigation,](https://blog.aquasec.com/topic/advanced-threat-mitigation) [Malware Attacks](https://blog.aquasec.com/topic/malware-attacks)\n\n[Tweet](https://twitter.com/share)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-09-15 - Threat Alert- New Malware in the Cloud By TeamTNT.pdf"
    ],
    "report_names": [
        "2022-09-15 - Threat Alert- New Malware in the Cloud By TeamTNT.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f809bfcb-b200-4988-80a8-be78ef6a52ef",
            "created_at": "2023-01-06T13:46:39.186988Z",
            "updated_at": "2025-03-27T02:00:03.016358Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "Adept Libra"
            ],
            "source_name": "MISPGALAXY:TeamTNT",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c3ca592f-0669-49bd-ab5c-310007ab2fb4",
            "created_at": "2022-10-25T15:50:23.334495Z",
            "updated_at": "2025-03-27T02:00:55.445098Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "TeamTNT"
            ],
            "source_name": "MITRE:TeamTNT",
            "tools": [
                "Peirates",
                "MimiPenguin",
                "LaZagne",
                "Hildegard"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535884,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1664712746,
    "ts_modification_date": 1664712746,
    "files": {
        "pdf": "https://archive.orkl.eu/b333758c4a7b3b88e9d2256494d08ac92b51fec4.pdf",
        "text": "https://archive.orkl.eu/b333758c4a7b3b88e9d2256494d08ac92b51fec4.txt",
        "img": "https://archive.orkl.eu/b333758c4a7b3b88e9d2256494d08ac92b51fec4.jpg"
    }
}