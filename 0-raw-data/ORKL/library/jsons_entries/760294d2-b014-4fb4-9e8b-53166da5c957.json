{
    "id": "760294d2-b014-4fb4-9e8b-53166da5c957",
    "created_at": "2023-01-12T15:08:08.959513Z",
    "updated_at": "2025-03-27T02:10:49.419117Z",
    "deleted_at": null,
    "sha1_hash": "e3d79d0302959eda6bd5abf31fd8626afd4be4bc",
    "title": "2020-11-25 - CSP, the Right Solution for the Web-Skimming Pandemic-",
    "authors": "",
    "file_creation_date": "2022-05-27T22:55:25Z",
    "file_modification_date": "2022-05-27T22:55:25Z",
    "file_size": 257881,
    "plain_text": "# CSP, the right solution for Magecart?\n\n**[medium.com/reflectiz/csp-the-right-solution-for-the-web-skimming-pandemic-acb7a4414218](https://medium.com/reflectiz/csp-the-right-solution-for-the-web-skimming-pandemic-acb7a4414218)**\n\nIdan Cohen November 29, 2020\n\n[Idan Cohen](https://medium.com/@idan-cohen?source=post_page-----acb7a4414218--------------------------------)\n\nNov 25, 2020\n\n\n6 min read\n\n## CSP, the Right Solution for the Web-Skimming Pandemic?\n\n I’ve been asked a lot about Content Security Policy (CSP) as a possible solution for Magecart and other web-skimming attacks lately. Companies, mostly eCommerce sites, are actively looking for a way to handle this emerging threat. CSP, which is not a costly solution, has become an integral part of many security-toolboxes.\n\n But is it the solution you really need to fight Magecart?\n\n The Third-Party App Challenge\n\nModern eCommerce websites and business platforms are using dozens of external thirdparty apps to enhance their user engagement, site performance and conversion metrics.\nThird-party applications for analytics, heat-maps, ads, and chats are good examples.\n\nUnfortunately, it’s not a bed of roses. These external applications are loaded remotely and\ncan create additional entry points for an attacker, which are not protected by any of the\ntraditional security controls such as WAF or IPS. Risks can escalate fast, as the modern\neCommerce business has to deal with cybercrime, supply-chain attacks, breaches, financial\ndamages, accountability, reputational damage, compliance, and safety audits.\n\nEspecially since the rise of the new Magecart threat. Magecart essentially involves hacking\ngroups that specialize in gaining unauthorized access to websites and injecting malicious\ncode into checkout pages.And how do they gain access? By exploiting third-party\napplications, a common phenomenon in the eCommerce space.\n\n\n-----\n\nMany Magecart attacks have been exposed in recent years. For example, over 10,000 online\nshoppers were attacked during September 2020, in what was identified as a zero-day\nMagento exploit (sold in the dark web markets). Almost 2,000 eCommerce websites (mainly\ncheckout pages) were targeted with a payment-card skimmer.\n\nThis methodology is basically a malicious JavaScript (JS) code that detects sensitive user\nactivity, such as typing of credit-card numbers, passwords or any kind of Personally\nIdentifiable Information (PII). Shopping cart checkouts are the most desired target due to the\ninvolvement of payment details and personal information.\n\nThese attacks are evolving at a rapid pace. It’s an armed battle between the evolving\nmalicious attacks and defenders trying to block them with tools like CSP.\n\n## Content Security Policy (CSP)\n\nContent Security Policy (CSP) is a computer security standard introduced in 2004 to combat\nmalicious activity such as cross-site scripting (XSS), clickjacking, and other client-side code\ninjections resulting from the execution of malicious code in trusted webpages.\n\nPutting CSP into action requires the addition of a Content-Security-Policy HTTP header into\nthe webpage and assigning the required values to fully control the resources end-users can\nload and the destinations they can go to. These elements can be scripts, pictures, videos,\nforms and more. By doing so, it makes it harder to pull off Magecart attacks.\n\n\n-----\n\nIn theory, if the attacker wants to load a malicious script from www.malicious.com and the\nCSP has been configured not to load external resource scripts, the attack will be fully\nblocked. However, its required to write a well planned policy to make CSP work effectively.\nThese are a predetermined set of directives that determine what resources (fonts, images,\nmultimedia and most importantly scripts) will be needed and used for a safe and secure\n[browsing environment. Please visit Manisha Sangwan’s article for additional details.](https://medium.com/@manishasangwan/what-is-csp-189c43642efa)\n\nCSP has fought many online battles since its inception back in 2004, when it was referred to\nas Content Restriction. CSP was created to combat the very commonly executed XSS\nattacks. I won’t elaborate on XSS in this article, but please check MRunal’s “What is CrossSite Scripting” article to learn more.\n\nUnfortunately, due to the rise of these risks, CSP might not be the stand-alone solution\neveryone is looking for. As we’ll see in the next section, Magecart and other web-skimming\nattacks are now gaining the upper hand.\n\n## Why is CSP Not Enough?\n\nFor starters, having a Content Security Policy is a good thing. If you have the resources to\nmanage it, go for it. However, like any security solution, the results may vary. The best case\nscenario is that you may gain only partial Magecart protection, but with multiple shortcomings\nto deal with on a daily basis.\n\n## The Blacklist/Whitelist Approach\n\nThe first problem with CSP is that, by whitelisting a trusted domain or an app, you are\nwhitelisting everything inside the domain, regardless of its actual behavior. That’s the main\nproblem with the blacklist / whitelist approach. You are not approving the actions and data,\nyou are just whitelisting everything.\n\n\n-----\n\n**This issue can create three different types of attack vectors:**\n\n1. A third-party app breach won’t be blocked by CSP. This is because the site owner has\n\nalready approved the third-party domain. If the attacker can access the third-party\ndomain, the CSP will let it run without any interference. I agree that a good CSP\ndirectives might create additional effort for an attacker in order to extract the data\noutside to a second unauthorized domain, but the attack will still take place leaving the\nattacker with enough playground to bypass it and complete the attack, as\ndemonstrated Bhavesh Thakur’s about CSP Bypass Techniques.\n2. Breach the on site servers. Most of the famous Magecart attacks targeted internal\n\nunsecured servers and scripts in the organization and injected malicious code there.\nIt’s a common practice to allow scripts to be loaded from the website internal domains\nand bypass the entire idea of CSP. It’s almost impossible to manage all the local scripts\nusing CSP.\n3. Use a common global service to extract personal data. For example, this shows that\n\nthe Google Analytics API could be used to hack into eCommerce websites, and other\nonline businesses. As Google Analytics can collect any data defined in the control\npanel, the attackers can just inject their own “Google Analytics” scripts to the website. It\nwill be whitelisted by CSP, and the data will be leaked. Good luck with tracking all of the\ninputs being collected by dozens of third-parties using CSP.\n\n## CSP: A High maintenance solution\n\n\n-----\n\nYou might be thinking now — Well, if CSP won t help it all, why bother? Yes, even with\nCSP, attackers can still leak data from internal and external breaches, or just exploit some\nonline service. But I’m not saying it won’t help. CSP is a strong solution that may help block\nattacks or make attackers work harder, which is a good thing! Do it.\n\nBut the second problem is maybe the trickier one.\n\nCSP is a high maintenance solution. As stated above, you need to define a whitelist and\nblacklist policy for the specific domain or scripts. It requires hands-on management and\nmaintenance to achieve satisfactory results.\n\nLet’s say you have 50 third-parties on a given website each uses several scripts and\ndomains. Now what? You will find yourself working hard to keep it all updated and running.\nSome companies might have the required resources for it, but for most this is an\noverwhelming task. Either way, it will create a big headache, as every script change will be\n\n\n-----\n\nblocked in production and secure your site, but the same may apply to important actions\nneeded by the digital or marketing team. If we go beyond, CSP can also hurt the website’s\ndaily performance.\n\nAn average eCommerce website uses 50 to 60 third-party apps. Can security teams handle\nthe risks each third-party creates continuously?\n\n## Final thoughts\n\nCSP is still an effective weapon, but it’s hard to recommend it as a stand-alone solution. It\nshould ideally be combined with additional measures, such as discovery tools, validation\ntests and strict script policy to ensure reasonable resource cost .\n\nAnother interesting solution that might work better than CSP against these kinds of attacks is\n[Subresource Integrity (SRI). It might be a better value-cost solution to battle Magecart, if](https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity)\ndone right. We will talk more about SRI in my next article. In the meanwhile, let’s keep\nwebsites safe!\n\nAbout me, I’m the CEO and co-founder of [Reflectiz, a cybersecurity company. Reflectiz is the](https://www.reflectiz.com/)\nfirst website-sandbox solution that mitigates the risk of third-party apps.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-11-25 - CSP, the Right Solution for the Web-Skimming Pandemic-.pdf"
    ],
    "report_names": [
        "2020-11-25 - CSP, the Right Solution for the Web-Skimming Pandemic-.pdf"
    ],
    "threat_actors": [
        {
            "id": "77b28afd-8187-4917-a453-1d5a279cb5e4",
            "created_at": "2022-10-25T15:50:23.768278Z",
            "updated_at": "2025-03-27T02:00:55.5423Z",
            "deleted_at": null,
            "main_name": "Inception",
            "aliases": [
                "Inception Framework",
                "Cloud Atlas"
            ],
            "source_name": "MITRE:Inception",
            "tools": [
                "PowerShower",
                "VBShower",
                "LaZagne"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "5a0483f5-09b3-4673-bb5a-56d41eaf91ed",
            "created_at": "2023-01-06T13:46:38.814104Z",
            "updated_at": "2025-03-27T02:00:02.925972Z",
            "deleted_at": null,
            "main_name": "MageCart",
            "aliases": [],
            "source_name": "MISPGALAXY:MageCart",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536088,
    "ts_updated_at": 1743041449,
    "ts_creation_date": 1653692125,
    "ts_modification_date": 1653692125,
    "files": {
        "pdf": "https://archive.orkl.eu/e3d79d0302959eda6bd5abf31fd8626afd4be4bc.pdf",
        "text": "https://archive.orkl.eu/e3d79d0302959eda6bd5abf31fd8626afd4be4bc.txt",
        "img": "https://archive.orkl.eu/e3d79d0302959eda6bd5abf31fd8626afd4be4bc.jpg"
    }
}