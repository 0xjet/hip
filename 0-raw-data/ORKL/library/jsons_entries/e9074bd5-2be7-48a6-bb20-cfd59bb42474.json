{
    "id": "e9074bd5-2be7-48a6-bb20-cfd59bb42474",
    "created_at": "2023-01-12T15:03:42.565544Z",
    "updated_at": "2025-03-27T02:08:51.343134Z",
    "deleted_at": null,
    "sha1_hash": "0cd2963ca63e2070df9570e2ce1c9e03109e4cf0",
    "title": "2019-07-10 - New FinSpy iOS and Android implants revealed ITW",
    "authors": "",
    "file_creation_date": "2022-05-28T02:04:11Z",
    "file_modification_date": "2022-05-28T02:04:11Z",
    "file_size": 977925,
    "plain_text": "# New FinSpy iOS and Android implants revealed ITW\n\n**[securelist.com/new-finspy-ios-and-android-implants-revealed-itw/91685/](https://securelist.com/new-finspy-ios-and-android-implants-revealed-itw/91685/)**\n\nAuthors\n\nGReAT\n\nAMR\n\n**Updated: 23.07.2019**\n\nAfter publication of this article, we received a letter from a representative of Gamma Group\nInternational Ltd. stating that they disposed of all interests in FinFisher (FinSpy) in 2013. This\narticle has been corrected in accordance with this new information.\n\n[According to information on its official website, FinFisher, among other tools and services,](https://finfisher.com/FinFisher/index.html)\nprovides a “strategic wide-scale interception and monitoring solution”. This software (also\nknown as FinSpy) is used to collect a variety of private user information on various platforms.\nIts implants for desktop devices were first described in 2011 [by Wikileaks and mobile](https://wikileaks.org/spyfiles/docs/gamma/291_remote-monitoring-and-infection-solutions-finspy-mobile.html)\nimplants were discovered in 2012. Since then Kaspersky has continuously monitored the\ndevelopment of this malware and the emergence of new versions in the wild According to\n\n\n-----\n\nour telemetry, several dozen unique mobile devices have been infected over the past year,\nwith recent activity recorded in Myanmar in June 2019. Late in 2018, experts at Kaspersky\nlooked at the functionally latest versions of FinSpy implants for iOS and Android, built in mid2018. Mobile implants for iOS and Android have almost the same functionality. They are\ncapable of collecting personal information such as contacts, SMS/MMS messages, emails,\ncalendars, GPS location, photos, files in memory, phone call recordings and data from the\nmost popular messengers.\n\n## Malware features\n\n### iOS\n\nFinSpy for iOS is able to monitor almost all device activities, including record VoIP calls via\nexternal apps such as Skype or WhatsApp. The targeted applications include secure\nmessengers such as Threema, Signal and Telegram. However, functionality is achieved by\nleveraging Cydia Substrate’s hooking functionality, so this implant can only be installed on\njailbroken devices (iPhone or iPad; iPod has not been confirmed) compatible with iOS 11 and\nbelow (newer versions are not confirmed as at the time of the research and implants for iOS\n12 has not been observed yet). After the deployment process, the implant provides the\nattacker with almost unlimited monitoring of the device’s activities.\n\nThe analyzed implant contained binary files for two different CPU architectures: ARMv7 and\nARM64. Taking into account that iOS 11 is the first iOS version that does not support ARMv7\nany more, we presumed that the 64-bit version was made to support iOS 11+ targets.\n\nIt looks like FinSpy for iOS does not provide infection exploits for its customers, because it\nseems to be fine-tuned to clean traces of publicly available jailbreaking tools. Therefore, an\nattacker using the main infection vector will need physical access in order to jailbreak it. For\njailbroken devices, there are at least three possible infection vectors:\n\nSMS message\nEmail\nWAP Push\n\nAny of those can be sent from the FinSpy Agent operator’s terminal.\n\nThe installation process involves several steps. First, a shell script checks the OS version\nand executes the corresponding Mach-O binary: “install64” (64-bit version) is used for iOS\n11+, otherwise “install7” (32-bit version) is used. When started, the installer binary performs\nenvironmental checks, including a Cydia Subtrate availability check; and if it isn’t available,\nthe installer downloads the required packages from the Cydia repository and installs them\nusing the “dpkg” tool. After that the installer does some path preparations and package\nunpacking, randomly selects names for the framework and the app from a hardcoded list,\n\n\n-----\n\ndeploys components on the target system and sets the necessary permissions. After the\ndeployment process is done, the daemon is started and all temporary installation files are\ndeleted.\n\nThe persistence of the implant is achieved by adding “plist” with starting instructions to the\n/Library/LaunchDaemons path.\n\nAll sensitive parameters of the configuration (such as C2 server address, C2 telephone\nnumbers and so on) are stored in the file “84C.dat” or in “PkgConf”, located in a bundle path\nof the main module. They can be rewritten using operator commands. This filename was\nused in previous FinSpy versions for different platforms, including Android.\n\nThe following list describes all the modules of the analyzed FinSpy version:\n\nName Format Functionality\n\nnetwd app Framework, launcher of the core module – FilePrep\n\nFilePrep app Core module\n\nMediaEnhancer dylib Audio recordings\n\n.vpext dylib VoIP calls hooking\n\n.hdutils dylib Hiding utilities\n\nkeys dylib Keylogger\n\nSBUtils dylib SpringBoardHooker utilities\n\n.chext dylib Messenger tracking\n\nhdjm unknown Not observed in detected versions, possibly some type of\nmodule for hiding traces of a jailbreak\n\nAll the internal strings in the modules, including the installer, are encrypted with a simple xorbased algorithm using the following strings as keys: “NSString”, “NSArray”, “NSDictionary”,\n“ExtAudioFileRef”.\n\nThe core implant module (“FilePrep”) contains 7,828 functions. It controls all the others\nmodules, takes care of HTTP and SMS heartbeats and other service functions.\nCommunication between components is implemented in two ways. The first uses the\nsystem’s CPDistributedMessagingCenter, the second is a local HTTP server that receives\ndata requests.\n\n\n-----\n\nThe module “.hdutils” is designed to cover up the tracks of the implant activities on the\ndevice. First of all, it configures the processing of all incoming SMS messages. It parses the\ntext looking for specific content and will hide notifications for such messages. Then it sends\nthem to the core module via CPDistributedMessagingCenter (a wrapper over the existing\nmessaging facilities in the operating system, which provides server-client communication\nbetween different processes using simple messages and dictionaries). Another hiding\nfeature is to hook the “CLCopyAppsUsingLocation” function in order to remove the core\nimplant module from the displayed list of applications used in Settings geolocation services.\n\nThe module “.chext” targets messenger applications and hooks their functions to exfiltrate\nalmost all accessible data: message content, photos, geolocation, contacts, group names\nand so on. The following messenger applications are targeted:\n\nFacebook Messenger (com.facebook.Messenger);\n\n\n-----\n\nWechat (com.tencent.xin);\nSkype (com.skype.skype/com.skype.SkypeForiPad);\nThreema (ch.threema.iapp / ch.threema.iapp.ThreemaShareExtension);\nInMessage (com.futurebits.instamessage.free);\nBlackBerry Messenger (com.blackberry.bbm1);\nSignal (org.whispersystems.signal).\n\nThe collected data is submitted to the local server deployed by the main module.\n\nThe “keys” module focuses on a different kind of keylogging activity, with multiple hooks that\nintercept every typed symbol. There are several hooks to intercept the typed unlock\npassword as well as during the change password process. The intercepted password is\nsubmitted to the “keys.html” page on the local server, similar to the “.chext” module.\n\nThe module “MediaEnhancer” is designed to hook system functions in the “mediaserverd”\ndaemon related to call processing, in order to record calls. The module starts a local HTTP\nserver instance on port 8889 upon initialization, implementing VoIPHTTPConnection as a\ncustom connection class. This class contains a handler for requests to localhost/voip.html\nthat could be made by other components.\n\nThe module “.vpext” implements more than 50 hooks used for VoIP calls processed by\nexternal messaging apps including:\n\nWhatsApp;\nLINE;\nSkype (that includes independent Skype for iPad version);\nViber;\nWeChat;\nKakaoTalk;\nBlackBerry Messenger;\nSignal.\n\nThese hooks modify functions that process VoIP calls in order to record them. To achieve\nthis, they send a post request with the call’s meta information to the HTTP server previously\ndeployed by the MediaEnhancer component that starts recording.\n\n### Android\n\nThe Android implant has similar functionality to the iOS version, but it is also capable of\ngaining root privileges on an unrooted device by abusing the DirtyCow exploit, which is\ncontained in the malware. FinSpy Android samples have been known for a few years now.\nBased on the certificate data of the last version found, the sample was deployed in June\n2018.\n\n\n-----\n\nThe Android implant’s functionality is unlikely to change much, based on the fact that most of\nthe configuration parameters are the same in the old and new versions. The variety of\navailable settings makes it possible to tailor the behavior of the implant for every victim. For\nexample, operators can choose the preferred communication channels or automatically\ndisable data transfers while the victim is in roaming mode. All the configuration data for an\ninfected Android device (including the location of the control server) is embedded in the\nimplant and used afterwards, but some of the parameters can be changed remotely by the\noperator. The configuration data is stored in compressed format, split into a set of files in the\nassets directory of the implant apk. After extracting all pieces of data and building the\nconfiguration file, it’s possible to get all the configuration values. Each value in the\nconfiguration file is stored after the little-endian value of its size, and the setting type is stored\nas a hash.\n\nFor example, the following interesting settings found in the configuration file of the developer\nbuild of the implant can be marked: mobile target ID, proxy ip-address, proxy port, phone\nnumber for remote SMS control, unique identifier of the installed implant.\n\n\n-----\n\nAs in the case of the iOS implant, the Android version can be installed manually if the\nattacker has physical access to the device, and by remote infection vectors: SMS messages,\nemails and WAP Push. After successful installation, the implant tries to gain root privileges\nby checking for the presence of known rooting modules SuperSU and Magisk and running\nthem. If no utilities are present, the implant decrypts and executes the DirtyCow exploit,\nwhich is located inside the malware; and if it successfully manages to get root access, the\nimplant registers a custom SELinux policy to get full access to the device and maintain root\naccess. If it used SuperSU, the implant modifies SuperSU preferences in order to silence it,\ndisables its expiry and configures it to autorun during boot. It also deletes all possible logs\nincluding SuperSU logs.\n\nThe implant provides access to information such as contacts, SMS/MMS messages,\ncalendars, GPS location, pictures, files in memory and phone call recordings. All the\nexfiltrated data is transferred to the attacker via SMS messages or via the internet (the C2\nserver location is stored in the configuration file). Personal data, including contacts,\nmessages, audios and videos, can be exfiltrated from most popular messengers. Each of the\ntargeted messengers has its own unified handling module, which makes it easy to add new\nhandlers if needed.\n\nThe full hardcoded list of supported messengers is shown below:\n\n**Package name** **Application name**\n\ncom.bbm BBM (BlackBerry Messenger)\n\ncom.facebook.orca Facebook Messenger\n\ncom.futurebits.instamesssage.free InstaMessage\n\njp.naver.line.android Line Messenger\n\norg.thoughtcrime.securesms Signal\n\ncom.skype.raider Skype\n\norg.telegram.messenger Telegram\n\nch.threema.app Threema\n\ncom.viber.voip Viber\n\ncom.whatsapp WhatsApp\n\nAt first, the implant checks that the targeted messenger is installed on the device (using a\nhardcoded package name) and that root access is granted. After that, the messenger\ndatabase is prepared for data exfiltration. If necessary, it can be decrypted with the private\nkey stored in its private directory, and any required information can be simply queried:\n\n\n-----\n\nAll media files and information about the user are exfiltrated as well.\n\n## Infrastructure\n\n\n-----\n\nFinSpy implants are controlled by the FinSpy Agent (operator terminal). By default, all\nimplants are connected to FinSpy anonymizing proxies (also referred to as FinSpy Relays)\nprovided by the spyware vendor. This is done to hide the real location of the FinSpy Master.\nAs soon as the infected target system appears online, it sends a heartbeat to the FinSpy\nProxy. The FinSpy Proxy forwards connections between targets and a master server. The\nFinSpy Master server manages all targets and agents and stores the data. Based on\ndecrypted configuration files, our experts were able to find the different relays used by the\nvictims and their geographical location. Most of the relays we found are concentrated in\nEurope, with some in South East Asia and the USA.\n\n## Conclusion\n\nFinSpy mobile implants are advanced malicious spy tools with diverse functionality. Various\nconfiguration capabilities provided by the spyware vendor in their product enable the FinSpy\nterminal (FinSpy Agent) operators to tailor the behavior of each implant for a particular victim\nand effectively conduct surveillance, exfiltrating sensitive data such as GPS location,\ncontacts, calls and other data from various instant messengers and the device itself.\n\nThe Android implant has functionality to gain root privileges on an unrooted device by\nabusing known vulnerabilities. As for the iOS version, it seems that this spyware solution\ndoesn’t provide infection exploits for its customers, as their product seems to be fine-tuned to\n\n\n-----\n\nclean traces of publicly available jailbreaking tools. That might imply physical access to the\nvictim in cases where devices are not already jailbroken. At the same time, multiple features\nthat we haven’t observed before in malware designed for this platform are implemented.\n\nSince the leak in 2014, the FinSpy developers has recreated significant parts of its implants,\nextended supported functionality (for example, the list of supported instant messengers has\nbeen significantly expanded) and at the same time improved encryption and obfuscation\n(making it harder to analyze and detect implants), which made it possible to retain its position\nin the market.\n\nOverall, during the research, up-to-date versions of these implants used in the wild were\ndetected in almost 20 countries, although the total number could be higher.\n\nFinSpy developers are constatly working on the updates for their malware. At the time of\npublication, Kaspersky researchers have found another version of the threat and are\ncurrently investigating this case.\n\nA full set of IOCs, including YARA rules, is available to customers of the Kaspersky\n[Intelligence Reporting service. For more information, contact intelreports@kaspersky.com](http://10.10.0.46/mailto:intelreports@kaspersky.com)\n\n[Apple iOS](https://securelist.com/tag/apple-ios/)\n[Data theft](https://securelist.com/tag/data-theft/)\n[Google Android](https://securelist.com/tag/google-android/)\n[Instant Messengers](https://securelist.com/tag/instant-messengers/)\n[Mobile Malware](https://securelist.com/tag/mobile-malware/)\n[Mobile security](https://securelist.com/tag/mobile-security/)\n\nAuthors\n\nGReAT\n\nAMR\n\nNew FinSpy iOS and Android implants revealed ITW\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-07-10 - New FinSpy iOS and Android implants revealed ITW.pdf"
    ],
    "report_names": [
        "2019-07-10 - New FinSpy iOS and Android implants revealed ITW.pdf"
    ],
    "threat_actors": [
        {
            "id": "42a6a29d-6b98-4fd6-a742-a45a0306c7b0",
            "created_at": "2022-10-25T15:50:23.710403Z",
            "updated_at": "2025-03-27T02:00:55.531313Z",
            "deleted_at": null,
            "main_name": "Silence",
            "aliases": [
                "Whisper Spider"
            ],
            "source_name": "MITRE:Silence",
            "tools": [
                "Winexe",
                "SDelete"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "88e53203-891a-46f8-9ced-81d874a271c4",
            "created_at": "2022-10-25T16:07:24.191982Z",
            "updated_at": "2025-03-27T02:02:10.13692Z",
            "deleted_at": null,
            "main_name": "Silence",
            "aliases": [
                "ATK 86",
                "Contract Crew",
                "TAG-CR8",
                "TEMP.TruthTeller",
                "Whisper Spider"
            ],
            "source_name": "ETDA:Silence",
            "tools": [
                "EDA",
                "EmpireDNSAgent",
                "Farse",
                "Ivoke",
                "Kikothac",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Meterpreter",
                "ProxyBot",
                "ReconModule",
                "Silence.Downloader",
                "TiniMet",
                "TinyMet",
                "TrueBot",
                "xfs-disp.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535822,
    "ts_updated_at": 1743041331,
    "ts_creation_date": 1653703451,
    "ts_modification_date": 1653703451,
    "files": {
        "pdf": "https://archive.orkl.eu/0cd2963ca63e2070df9570e2ce1c9e03109e4cf0.pdf",
        "text": "https://archive.orkl.eu/0cd2963ca63e2070df9570e2ce1c9e03109e4cf0.txt",
        "img": "https://archive.orkl.eu/0cd2963ca63e2070df9570e2ce1c9e03109e4cf0.jpg"
    }
}