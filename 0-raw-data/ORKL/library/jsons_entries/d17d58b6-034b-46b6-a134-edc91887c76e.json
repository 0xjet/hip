{
    "id": "d17d58b6-034b-46b6-a134-edc91887c76e",
    "created_at": "2023-01-12T15:00:12.735451Z",
    "updated_at": "2025-03-27T02:14:34.131325Z",
    "deleted_at": null,
    "sha1_hash": "8a2e86eda5acaafd7023cea65ee3df87049d27cc",
    "title": "2022-05-20 - New 'pymafka' malicious package drops Cobalt Strike on macOS, Windows, Linux",
    "authors": "",
    "file_creation_date": "2022-05-28T19:28:12Z",
    "file_modification_date": "2022-05-28T19:28:12Z",
    "file_size": 1053254,
    "plain_text": "# New 'pymafka' malicious package drops Cobalt Strike on macOS, Windows, Linux\n\n**[blog.sonatype.com/new-pymafka-malicious-package-drops-cobalt-strike-on-macos-windows-linux](https://blog.sonatype.com/new-pymafka-malicious-package-drops-cobalt-strike-on-macos-windows-linux)**\n\nThis week, Sonatype's automated malware detection bots have discovered malicious Python\npackage 'pymafka' in the PyPI registry.\n\n[The package appears to typosquat a legitimate popular library PyKafka, a programmer-](https://pypi.org/project/pykafka/#description)\nfriendly Apache Kafka client for Python. The development follows our discovery of another\n[typosquat targeting the Apache Kafka project from earlier this month.](https://blog.sonatype.com/this-week-in-malware-apache-kafka-typosquats-shorthand-data-exfiltration)\n\n\n-----\n\nPyKafka includes Python implementations of Kafka producers and consumers, and has been\n[retrieved over 4,240,305 times by user-initiated downloads and mirrors/bots alike. By](https://pepy.tech/project/pykafka)\n[contrast, malicious 'pymafka' shows a download count of around 300 as Sonatype timely](https://pepy.tech/project/pymafka)\nreported the finding to PyPI.\n\n## PyMafka drops Cobalt Strike on Windows, macOS\n\nOn May 17th, a mysterious 'pymafka' package appeared on the PyPI registry. The package\nwas shortly flagged by the Sonatype [Nexus platform's automated malware detection](https://www.sonatype.com/products/firewall)\ncapabilities.\n\nThe package, 'pymafka' may sound identical to the popular PyKafka, but its insides reveal a\ndifferent story.\n\nThe 'setup.py' Python script inside 'pymafka' first detects your platform. Depending on\nwhether you are running Windows, macOS, or Linux, an appropriate malicious trojan is\ndownloaded and executed on the infected system.\n\nThe trojan in question is a Cobalt Strike (CS) beacon. Cobalt Strike is a pen-testing software\ntool typically used by red teams and ethical hackers for simulating real-world cyberattacks,\nespecially during security assessments.\n\n[But, time and time again attackers, including ransomware groups like LockBit, have abused](https://www.bleepingcomputer.com/news/security/the-week-in-ransomware-april-29th-2022-new-operations-emerge/)\nCobalt Strike to infect victims.\n\n\n-----\n\nInterestingly, as evident from the code below, on Windows systems, the Python script\nattempts to drop the Cobalt Strike beacon at 'C:\\Users\\Public\\iexplorer.exe'. Note, this\n[misspelling stands out as the legitimate Microsoft Internet Explorer process is typically called](https://answers.microsoft.com/en-us/ie/forum/all/what-is-iexploreexe-and-should-it-be-on-my/bfecb92d-b728-4593-8c25-699a11df8b61)\n\"iexplore.exe\" (no 'r' at the end) and isn't present in the C:\\Users\\Public directory.\n\n[The malicious executables being downloaded are 'win.exe' [VirusTotal], and 'MacOS'](https://www.virustotal.com/gui/file/137edba65b32868fbf557c07469888e7104d44911cd589190f53f6900d1f3dfb/details)\n\n[[VirusTotal], with their names corresponding to their target operating systems. Both of these](https://www.virustotal.com/gui/file/b117f042fe9bac7c7d39eab98891c2465ef45612f5355beea8d3c4ebd0665b45/detection)\nare downloaded from the IP address 141.164.58[.]147, commissioned by the cloud hosting\nprovider, Vultr.\n\nThese executables attempt to contact China-based IP 39.106.227[.]92, which is assigned to\nAlisoft (Alibaba).\n\nLess than a third of antivirus engines detected the samples as malicious at the time of our\n[submission to VirusTotal, although that's still a better detection rate than zero-detections](https://blog.sonatype.com/npm-malware-xpc.js)\nseen in some of our earlier discoveries.\n\n\n-----\n\nOn Windows, we observed the payload also kept persistently surveying the '/updates.rss'\nendpoint and sending encrypted cookie values in requests, a behavior consistent with Cobalt\nStrike beacons.\n\nGET /updates.rss HTTP/1.1\nAccept: */*\nCookie: mZoD7LYrA/...\nUser-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows Phone OS 7.5; Trident/5.0;\nIEMobile/9.0; LG; LG-E906)Host: 39.106.227.92:8445\nConnection: Keep-Alive\nCache-Control: no-cache\n\nFor Linux systems, the Python script attempts to download and run an \"env\" executable from\nthe IP address 39.107.154[.]72 (also Alibaba-owned), which at the time of analysis was\ndown.\n\nWe reported these findings to the PyPI registry shortly after catching and analyzing the\npackage and the malicious package was taken down yesterday, just before reaching ~300\ndownloads.\n\nFile IOCs:\n\nThe indicators of compromise (IOCs) associated with this campaign are given below.\n\n\n-----\n\nwin.exe: 137edba65b32868fbf557c07469888e7104d44911cd589190f53f6900d1f3dfb\n\nMacOS: b117f042fe9bac7c7d39eab98891c2465ef45612f5355beea8d3c4ebd0665b45\n\nPython package 'pymafka-3.0.tar.gz':\n4de4f47b7f30ae31585636afd0d25416918d244fcc9dfe50967a47f68bb79ce1\n\n## Nexus Firewall users remain protected\n\nIt's been a busy start to the month already.\n\nDue to the heavy influx of malicious packages lately, we have launched This Week in\n_Malware digests, published every Friday, and delivered automatically to blog subscribers._\n\nEarlier this month, Sonatype reported attackers typosquatting the popular npm library\n'colors', and [not for the first time either. Last week, we came across even more 'colors'](https://blog.sonatype.com/remember-npm-library-colors-theres-no-such-thing-as-colors-2.0)\n[typosquats and a malicious Rust package 'rustdecimal' that uses elusive XOR encryption to](https://blog.sonatype.com/this-week-in-malware-may-13th-edition)\ndrop malware.\n\nWe further analyzed a different [Apache Kafka typosquat and reported several dependency](https://blog.sonatype.com/this-week-in-malware-apache-kafka-typosquats-shorthand-data-exfiltration)\nconfusion packages to both npm and PyPI registries, thereby keeping the open source\ncommunity and our customers safe.\n\nAnd as predicted, the attacks on open source registries are continuing to surge as the\ncybersecurity community from across the world is focused on battling the ongoing\ninternational crisis.\n\nBetween March & April, we reported on a sharp uptick in open source attacks after\ndiscovering a ['fix-crash' info-stealer and 500+ malicious npm packages. That was on top of](https://blog.sonatype.com/this-week-in-malware-a-fix-crash-info-stealer-and-500-malicious-npm-packages)\nthe [400+ packages targeting Azure, Airbnb, and Uber developers discovered recently.](https://blog.sonatype.com/this-week-in-malware-400-npm-packages-target-azure-uber-airbnb-developers)\n\nUsers of [Nexus Firewall can rest easy knowing that such malicious packages would](https://www.sonatype.com/products/firewall)\nautomatically be blocked from reaching their development builds.\n\n\n-----\n\n**Nexus Firewall instances will automatically quarantine any suspicious components detected**\nby our automated malware detection bots while a manual review by a researcher is in the\nworks, thereby keeping your software supply chain protected from the start.\n\nSonatypeâ€™s world-class security research data, combined with our automated malware\ndetection technology safeguards your developers, customers, and software supply chain\nfrom infections.\n\nTags: [vulnerabilities,](https://blog.sonatype.com/topic/vulnerabilities) [Nexus Firewall,](https://blog.sonatype.com/topic/nexus-firewall) [PyPI,](https://blog.sonatype.com/topic/pypi) [malware prevention,](https://blog.sonatype.com/topic/malware-prevention) [pypi vulnerability,](https://blog.sonatype.com/topic/pypi-vulnerability) [DevZone](https://blog.sonatype.com/topic/devzone)\n\n\n-----\n\n### Written by Ax Sharma\n\nAx is a Security Researcher at Sonatype and Engineer who holds a passion for perpetual\nlearning. His works and expert analyses have frequently been featured by leading media\noutlets. Ax's expertise lies in security vulnerability research, reverse engineering, and\nsoftware development. In his spare time, he loves exploiting vulnerabilities ethically and\neducating a wide range of audiences.\n\nFollow me on:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-05-20 - New 'pymafka' malicious package drops Cobalt Strike on macOS, Windows, Linux.pdf"
    ],
    "report_names": [
        "2022-05-20 - New 'pymafka' malicious package drops Cobalt Strike on macOS, Windows, Linux.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535612,
    "ts_updated_at": 1743041674,
    "ts_creation_date": 1653766092,
    "ts_modification_date": 1653766092,
    "files": {
        "pdf": "https://archive.orkl.eu/8a2e86eda5acaafd7023cea65ee3df87049d27cc.pdf",
        "text": "https://archive.orkl.eu/8a2e86eda5acaafd7023cea65ee3df87049d27cc.txt",
        "img": "https://archive.orkl.eu/8a2e86eda5acaafd7023cea65ee3df87049d27cc.jpg"
    }
}