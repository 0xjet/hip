{
    "id": "7df52847-5481-4a66-9ad5-7d5f2b6abf24",
    "created_at": "2023-01-12T14:59:34.486864Z",
    "updated_at": "2025-03-27T02:05:20.994613Z",
    "deleted_at": null,
    "sha1_hash": "0951e70e4473bcb2ec46137f33f28a29bf16f515",
    "title": "2015-10-09 - Latest TeslaCrypt Ransomware Borrows Code From Carberp Trojan",
    "authors": "",
    "file_creation_date": "2022-05-28T02:12:35Z",
    "file_modification_date": "2022-05-28T02:12:35Z",
    "file_size": 310795,
    "plain_text": "# Latest TeslaCrypt Ransomware Borrows Code From Carberp Trojan\n\n**[researchcenter.paloaltonetworks.com/2015/10/latest-teslacrypt-ransomware-borrows-code-from-carberp-trojan/](https://researchcenter.paloaltonetworks.com/2015/10/latest-teslacrypt-ransomware-borrows-code-from-carberp-trojan/)**\n\nJosh Grunzweig October 9, 2015\n\nBy [Josh Grunzweig](https://unit42.paloaltonetworks.com/author/joshgruznweig/)\n\nOctober 9, 2015 at 5:00 AM\n\n[Category: Malware,](https://unit42.paloaltonetworks.com/category/malware-2/) [Ransomware,](https://unit42.paloaltonetworks.com/category/ransomware/) [Threat Prevention,](https://unit42.paloaltonetworks.com/category/threat-prevention-2/) [Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [AutoFocus,](https://unit42.paloaltonetworks.com/tag/autofocus/) [Carberp,](https://unit42.paloaltonetworks.com/tag/carberp/) [CryptoLocker,](https://unit42.paloaltonetworks.com/tag/cryptolocker/) [CryptoWall,](https://unit42.paloaltonetworks.com/tag/cryptowall/) [TeslaCrypt,](https://unit42.paloaltonetworks.com/tag/teslacrypt/) [Trojan,](https://unit42.paloaltonetworks.com/tag/trojan/) [WildFire](https://unit42.paloaltonetworks.com/tag/wildfire/)\n\nIn recent weeks, we have noticed changes in the TeslaCrypt ransomware malware family’s\ncode base. [OpenDNS recently discussed some of these changes regarding the encryption](https://labs.opendns.com/2015/09/29/teslacrypt-revisited/)\ntechniques in this newest variant. While reverse engineering the underlying code of these\nsamples we discovered that the author of of TeslaCrypt borrowed code from the Carberp\nmalware family in order to obfuscate strings and dynamically load libraries/functions.\n\nTeslaCrypt was discovered in February 2015, and has been actively developed since its\ninitial release. The TeslaCrypt family is known as ransomware—a type of malware that\nencrypts a victim’s files then demands a form of payment in exchange for the decryption key.\nRansomware has been very lucrative for attackers, and an ongoing challenge for consumers\nand businesses alike. Malware like TeslaCrypt is often delivered via spam emails or exploit\nkits. A recent [takedown of multiple domains used by the popular Angler exploit kit estimated](http://blogs.cisco.com/security/talos/angler-exposed)\nthat as much as $60 million in revenue was generated annually by ransomware alone.\n\nTeslaCrypt has historically been known to borrow code or other features from various\nransomware families. Older variants used a notification screen that looked nearly identical to\nthe one used by the CryptoLocker malware family.\n\n\n-----\n\nFigure 1. Locker notification for old variants of TeslaCrypt\n\nThe latest versions of TeslaCrypt attempt to mimic the popular CryptoWall malware family.\n\n\n-----\n\nFigure 2. Locker notification for new variants of TeslaCrypt\n\nAs we can see from the figures, the author of TeslaCrypt has no reservations about re-using\ncode where possible. Starting in late September, the newest version of TeslaCrypt was\nintroduced and it included multiple updates. One of these updates involved modifications to\n[how the victims’ files were encrypted, which was discussed by OpenDNS in their blog post.](https://labs.opendns.com/2015/09/29/teslacrypt-revisited/)\n\nHowever, when looking at the underlying code, a number of other changes caught our eye,\nincluding string obfuscation previously unseen in TelsaCrypt.\n\n\n-----\n\nFigure 3. TeslaCrypt string obfuscation\n\nUpon further review, we discovered that these strings are encrypted using the RC2\ncryptographic algorithm, using a static key of ‘sdflk35jghs’. The initialization vector is\ngenerated by removing the first and last 4 characters, not counting the base64 padding\ncharacters. This process is shown below.\n\nFigure 4. TeslaCrypt IV and data parsing\n\n[While examining the Carberp source code, we discovered this exact code. Carberp was a](http://www.microsoft.com/security/portal/threat/encyclopedia/entry.aspx?Name=Win32%2fCarberp#tab=2)\npopular banking Trojan discovered in late 2011. Its main functionality included stealing online\nbanking credentials, keystroke logging, and capturing data from various applications.\n\n[In mid-2013, the source code to Carberp was posted for sale on an underground Russian](https://securityintelligence.com/carberp-source-code-sale-free-bootkit-included/)\n[forum. A number of weeks following this posting, the source code was leaked to the general](https://threatpost.com/carberp-source-code-leaked/101070/)\npublic. This allowed any individual to modify or copy the source code to this banking Trojan,\nwhich the author of TeslaCrypt appears to have done.\n\n\n-----\n\nFigure 5. Carberp string parsing prior to decryption\n\nLooking further into the underlying code of TeslaCrypt, we found that the author has also\nimplemented dynamic library and function loading.\n\nFigure 6. Dynamic function loading in TeslaCrypt\n\n\n-----\n\nSure enough, this code was also copied from Carberp s source code. Hashes used to\nidentify function are generated via the following algorithm:\n\nFigure 7. Hashing algorithm\n\nIn order to assist analysts and reverse-engineers working on the latest version of TeslaCrypt,\nplease refer to the [script shown in Figure 8 that will attempt to automatically convert API](https://github.com/pan-unit42/public_tools/tree/master/teslacrypt)\nhashes to their actual function names.\n\nFigure 8. Results of running IDAPython script\n\nOverall, it appears that the author of TeslaCrypt has continued their history of re-using code\nand functionality from other malware families. By using the string obfuscation and dynamic\nAPI loading functionality from Carberp, it makes reverse-engineering and simple static\nanalysis slightly more difficult. However, as the Carberp source code is so widely known by\nthe security community, the author may have inadvertently made detection of these samples\neasier. This is the tradeoff of re-using code from other malware families. It’s certainly quicker\nand easier to do, but may result in easier detection by security software.\n\n\n-----\n\nAll new variants of the TeslaCrypt malware family samples are properly classified as\n[malicious by Palo Alto Networks WildFire.](https://www.paloaltonetworks.com/products/technologies/wildfire.html) [AutoFocus users can find more information on](https://www.paloaltonetworks.com/company/press/2015/palo-alto-networks-autofocus-threat-intelligence-service-now-globally-available.html)\n[samples and indicators related to this attack by viewing the TeslaCrypt tag.](https://autofocus.paloaltonetworks.com/#/tag/Unit42.TeslaCrypt)\n\n**Get updates from**\n**Palo Alto**\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2015/2015-10-09 - Latest TeslaCrypt Ransomware Borrows Code From Carberp Trojan.pdf"
    ],
    "report_names": [
        "2015-10-09 - Latest TeslaCrypt Ransomware Borrows Code From Carberp Trojan.pdf"
    ],
    "threat_actors": [
        {
            "id": "2ed8d590-defa-4873-b2de-b75c9b30931e",
            "created_at": "2023-01-06T13:46:38.730137Z",
            "updated_at": "2025-03-27T02:00:02.903261Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "Boggy Serpens",
                "Mango Sandstorm",
                "TEMP.Zagros",
                "Static Kitten",
                "G0069",
                "TA450",
                "Earth Vetala",
                "Seedworm",
                "COBALT ULSTER",
                "ATK51"
            ],
            "source_name": "MISPGALAXY:MuddyWater",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "02e1c2df-8abd-49b1-91d1-61bc733cf96b",
            "created_at": "2022-10-25T15:50:23.308924Z",
            "updated_at": "2025-03-27T02:00:55.437268Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "MuddyWater",
                "Earth Vetala",
                "Static Kitten",
                "Seedworm",
                "TEMP.Zagros",
                "Mango Sandstorm",
                "TA450"
            ],
            "source_name": "MITRE:MuddyWater",
            "tools": [
                "STARWHALE",
                "POWERSTATS",
                "Out1",
                "PowerSploit",
                "Small Sieve",
                "Mori",
                "Mimikatz",
                "LaZagne",
                "PowGoop",
                "CrackMapExec",
                "ConnectWise",
                "SHARPSTATS",
                "RemoteUtilities",
                "Koadic"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3c430d71-ab2b-4588-820a-42dd6cfc39fb",
            "created_at": "2022-10-25T16:07:23.880522Z",
            "updated_at": "2025-03-27T02:02:10.010443Z",
            "deleted_at": null,
            "main_name": "MuddyWater",
            "aliases": [
                "ATK 51",
                "Boggy Serpens",
                "Cobalt Ulster",
                "ITG17",
                "Mango Sandstorm",
                "MuddyWater",
                "Operation BlackWater",
                "Operation Earth Vetala",
                "Operation Quicksand",
                "Seedworm",
                "Static Kitten",
                "T-APT-14",
                "TA450",
                "TEMP.Zagros",
                "Yellow Nix"
            ],
            "source_name": "ETDA:MuddyWater",
            "tools": [
                "Agentemis",
                "BugSleep",
                "CLOUDSTATS",
                "ChromeCookiesView",
                "Cobalt Strike",
                "CobaltStrike",
                "CrackMapExec",
                "DELPHSTATS",
                "EmPyre",
                "EmpireProject",
                "FruityC2",
                "Koadic",
                "LOLBAS",
                "LOLBins",
                "LaZagne",
                "Living off the Land",
                "MZCookiesView",
                "Meterpreter",
                "Mimikatz",
                "MuddyC2Go",
                "MuddyRot",
                "Mudwater",
                "POWERSTATS",
                "PRB-Backdoor",
                "PhonyC2",
                "PowGoop",
                "PowerShell Empire",
                "PowerSploit",
                "Powermud",
                "QUADAGENT",
                "SHARPSTATS",
                "SSF",
                "Secure Socket Funneling",
                "Shootback",
                "Smbmap",
                "Valyria",
                "chrome-passwords",
                "cobeacon",
                "prb_backdoor"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535574,
    "ts_updated_at": 1743041120,
    "ts_creation_date": 1653703955,
    "ts_modification_date": 1653703955,
    "files": {
        "pdf": "https://archive.orkl.eu/0951e70e4473bcb2ec46137f33f28a29bf16f515.pdf",
        "text": "https://archive.orkl.eu/0951e70e4473bcb2ec46137f33f28a29bf16f515.txt",
        "img": "https://archive.orkl.eu/0951e70e4473bcb2ec46137f33f28a29bf16f515.jpg"
    }
}