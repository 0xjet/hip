{
    "id": "36634651-6a74-4382-a7e7-7225e3c06027",
    "created_at": "2023-01-12T15:06:18.306736Z",
    "updated_at": "2025-03-27T02:16:59.159456Z",
    "deleted_at": null,
    "sha1_hash": "51dfa6836fd73212906cbfc6242a4c8266fe346d",
    "title": "2021-05-13 - Threat Actors Use MSBuild to Deliver RATs Filelessly",
    "authors": "",
    "file_creation_date": "2022-05-28T01:58:31Z",
    "file_modification_date": "2022-05-28T01:58:31Z",
    "file_size": 2873278,
    "plain_text": "# Threat Actors Use MSBuild to Deliver RATs Filelessly\n\n**anomali.com/blog/threat-actors-use-msbuild-to-deliver-rats-filelessly**\n\nResearch | May 13, 2021\n\nby Anomali Threat Research\n\n_Authored by: Tara Gould and Gage Mele_\n\n### Key Findings\n\n\n-----\n\nAnomali Threat Research identified a campaign in which threat actors used Microsoft Build Engine (MSBuild) to filelessly deliver\nRemcos remote access tool (RAT) and password-stealing malware commonly known as RedLine Stealer\nThis campaign, which has low or zero detections on antivirus tools, appears to have begun in April 2021 and was still ongoing as of May\n11, 2021.\nWe were unable to determine how the .proj files were distributed, and are unable to make a confident assessment on attribution\nbecause both RemcosRAT and RedLine Stealer are commodity malware.\n\n## Overview\n\nAnomali Threat Research discovered a campaign in which threat actors used MSBuild - a tool used for building apps and gives users an XML\nschema “that controls how the build platform processes and builds software” - to filelessly deliver RemcosRAT, and RedLine stealer using\ncallbacks.[1] The malicious MSBuild files we observed in this campaign contained encoded executables and shellcode, with some, hosted on\nRussian image-hosting site, “joxi[.]net.” While we were unable to determine the distribution method of the .proj files, the objective of these files\nwas to execute either Remcos or RedLine Stealer. The majority of the samples we analyzed deliver Remcos as the final payload.\n\n**_Figure 1 - Infection chain_**\n\n## Technical Analysis\n\n### MSBuild\n\nMSBuild is a development tool used for building applications, especially where Visual Studio is not installed.[2] MSBuild uses XML project files\nthat contain the specifications to compile the project and, within the configuration file, the “UsingTask” element defines the task that will be\ncompiled by MSBuild. In addition, MSBuild has an inline task feature that enables code to be specified and compiled by MSBuild and\nexecuted in memory. This ability for code to be executed in memory is what enables threat actors to use MSBuild in fileless attacks.\n\nA fileless attack is a technique used by threat actors to compromise a machine while limiting the chances of being detected.[3] Fileless\nmalware typically uses a legitimate application to load the malware into memory, therefore leaving no traces of infection on the machine and\nmaking it difficult to detect. An analysis by network security vendor WatchGuard released in 2021 showed a 888% increase in fileless attacks\nfrom 2019 to 2020, illustrating the massive growth in the use of this attack technique, which is likely related to threat actor confidence that\nsuch attacks will be successful.[4]\n\n\n### MSBuild Project File (.proj) Analysis\n\n**Analyzed File – imaadp32.proj**\n\n**MD5 – 45c94900f312b2002c9c445bd8a59ae6**\n\nThe file we analyzed is called “imaadp32.proj,” and as shown in Figure 2 below, is an MSBuild project file (.proj). For persistence, mshta is\nused to execute a vbscript that runs the project file, with a shortcut file (.lnk) added to the startup folder (Figure 3).\n\n\n-----\n\n**_Figure 2 - MSBuild Project Schema for immadp32.proj_**\n\n**_Figure 3 - .lnk File Created in Startup Folder_**\n\nFollowing the creation of persistence, two large arrays of decimal bytes were decoded by the function shown in Figure 4.\n\n**_Figure 4 - Decoding Function_**\n\nPorting the decoding function to Python, we created a script (Figure 5 below). By using the variable “dec_list” to contain the decimal to be\nconverted, and the variable “key” representing the string found at the end of decimal, we decoded the function.\n```\ndef decode_array(dec_list, key):\n  key_array = []\n  position_array = []\nfor position in list(range(256)):\n    key_array.append(key[position % len(key)])\n    position_array.append(position)\n    xxZmgLbpuJ = 0\nfor position in list(range(256)):\n    xxZmgLbpuJ = (xxZmgLbpuJ + position_array[position] + ord(key_array[position])) % 256\n    YAFIh = position_array[position]\n    position_array[position] = position_array[xxZmgLbpuJ]\n    position_array[xxZmgLbpuJ] = YAFIh\n    DmqRsaOvxUH = 0\n    xxZmgLbpuJ = 0\n    new_array = []\nfor position in list(range(len(dec_list))):\n    DmqRsaOvxUH += 1\n    DmqRsaOvxUH %= 256\n    xxZmgLbpuJ += position_array[DmqRsaOvxUH]\n    xxZmgLbpuJ %= 256\n    YAFIh = position_array[DmqRsaOvxUH]\n    position_array[DmqRsaOvxUH] = position_array[xxZmgLbpuJ]\n    position_array[xxZmgLbpuJ] = YAFIh\n    new_array.append(dec_list[position] ^ position_array[((position_array[DmqRsaOvxUH] + position_array[xxZmgLbpuJ]) % 256)])\n  return new_array\n\n```\n**_Figure 5 - Python Script to Decode_**\n\nThe output decimal list from this function was then converted from bytes, resulting in an executable for the first block and shellcode for the\nsecond block.\n\n## Shellcode\n\nThe malware and shellcode were allocated memory in the process space using VirtualAlloc. After being copied into memory, the shellcode\nwas executed using the callback function pointer in CallWindowProc, shown in Figure 6 below. Other samples leverage the function\nDelegate.DynamicInvoke instead.\n\n\n-----\n\n**_Figure 6 - Shellcode and Payload Being Loaded Into Memory_**\n\n**_Figure 7 - Encoded shellcode in Project File_**\n\nThe shellcode (encoded shown in Figure 7 above) calls, shown in Figure 8 below, were mainly: LoadLibraryW, VirtualAlloc,\nCreateProccessW, and ZwUnmapViewOfSection. LoadLibraryW loads the module, VirtualAlloc allocates the memory, CreateProcessW\ncreated a process, and ZwUnmapViewOfSection is used to unmap memory from a virtual space. These were used to inject the payload into\nprocess memory.\n\n\n-----\n\n**_Figure 8 - Calls made by the shellcode_**\n\n## Payloads\n\n### RemcosRAT\n\n**Analyzed File –**\n\n**MD5 – 04fc0ca4062dd014d64dcb2fe8dbc966**\n\n\n-----\n\ne pay oad o t e p oject es as a e ote access too ( ) ca ed e cos e cos s a co e c a so t a e c eated by ea g\nSecurity that, according to their user manual, can be used for remote control, remote admin, remote anti-theft, remote support and pentesting.\n\n[5] However, Remcos has often been used by threat actors for malicious purposes. The software, written in C++, enables full access to the\ninfected machine with features including, but not limited to:\n\nAnti-AV\nCredential harvesting\nGathering system information\nKeylogging\nPersistence\nScreen capture\nScript execution\n\nThe themes used by actors to distribute Remcos have varied, including changes designed to adapt to themes or timeframes. For example,\nrecent Remcos campaigns were observed utilizing Tax Day lures.[6] The version used in this campaign was 2.6.0, which was released in July\n2020 (Figure 9). Additional functions Remcos has been known to utilize are shown in Table 1 below. The persistence technique is simply\nadding a run registry key for persistence (Figure 11). Remcos has also been observed using its “Watchdog” feature to restart the RAT if it is\nterminated (Figure 12).\n\n**_Figure 9 - Remcos Version 2.6.0 Being Used_**\n\n**_Figure 10 - connecting to C2_**\n\n**_Figure 11 - Adds Run Registry Key for Persistence_**\n\n**_Figure 12 - Watchdog Module_**\n\nFigure 12 shows the “Watchdog” module which restarts Remcos in the event the program is terminated.\n\n**_Table 1 - Remcos 2.6.0 Features_**\n\nRemote Scripting Notifications\n\nWebcam Capture Remote Command Line\n\nClear Logins Remote Chat\n\nFile Manager Remote Input\n\nMicrophone Capture SOCKS Proxy\n\nKeylogger Login Cleaner\n\nScreen Logger Local Utilities\n\nBrowser History Registry Editor\n\nPassword Recovery Visibility mode\n\n### RedLine Stealer\n\n**Analyzed File – rehoboams.exe**\n\n**MD5 – 6d3e8a2802848d259a3baaaa78701b97**\n\n|Remote Scripting|Notifications|\n|---|---|\n|Webcam Capture|Remote Command Line|\n|Clear Logins|Remote Chat|\n|File Manager|Remote Input|\n|Microphone Capture|SOCKS Proxy|\n|Keylogger|Login Cleaner|\n|Screen Logger|Local Utilities|\n|Browser History|Registry Editor|\n|Password Recovery|Visibility mode|\n\n\n-----\n\na s a S u d p oject e to t e e cos d opp g p oj e, e ou d a ot e p oject e a ed o e e ed e Stea e\nwas dropped instead of Remcos, shown in Figure 13 below. RedLine Stealer is written in .NET and has been observed stealing multiple types\nof data (full list shown in Table 2 below), including: :\n\nCookies\nCredentials (chat clients, VPNs, crypto wallets, browser )\nCrypto wallet\nNordVPN (existence of and credentials)\nStored web browser information (credit card, username, and password)\nSystem Information\n\nRedLine will search for the existence of multiple products that include cryptocurrency software, messaging apps, VPNs, and web browsers\n(full list shown in Table 2 below).\n\n**_Figure 13 - RedLine .NET Information Stealer_**\n\n\n-----\n\n**_Figure 14 - RedLine Functions_**\n\n\n-----\n\n**_Figure 15 - Checks for NordVPN Installation_**\n\nFigure 15 above shows RedLine checking for NordVPN on the machine. If the path exists, the next function of this malware is to check for the\nuser config to steal the credentials. This function also enables RedLine to steal credentials for additional installed applications.\n\n**_Table 2 - Installs RedLine Scans for_**\n\nChrome GameLauncher for Steam\n\nFilezilla Guarda\n\nGecko Jaxx\n\nArmory Metamask\n\nAtomic Monero\n\nCoinom OpenVPN\n\nDesktopMessenger for Telegram NordVPN\n\nDiscord ProtonVPN\n\nElectrum Tronlink\n\nEthereum Yoroi\n\n## Conclusion\n\nThe threat actors behind this campaign used fileless delivery as a way to bypass security measures, and this technique is used by actors for\na variety of objectives and motivations. This campaign highlights that reliance on antivirus software alone is insufficient for cyber defense, and\nthe use of legitimate code to hide malware from antivirus technology is effective and growing exponentially. Focusing on cybersecurity training\nand hygiene, as well as a defense-in-depth strategy, are some recommended courses of action for countering this threat.\n\n## Endnotes\n\n[1] “MSBuild,” Microsoft Visual Studio Docs, accessed May 3, 2021, published November 4, 2016, https://docs.microsoft.com/en\nus/visualstudio/msbuild/msbuild?view=vs-2019.\n\n|Chrome|GameLauncher for Steam|\n|---|---|\n|Filezilla|Guarda|\n|Gecko|Jaxx|\n|Armory|Metamask|\n|Atomic|Monero|\n|Coinom|OpenVPN|\n|DesktopMessenger for Telegram|NordVPN|\n|Discord|ProtonVPN|\n|Electrum|Tronlink|\n|Ethereum|Yoroi|\n\n\n\n[2] Ibid.\n\n[3] “What Is Fileless Malware?,” McAfee, accessed May 3, 2021, https://www.mcafee.com/enterprise/en-gb/security\nawareness/ransomware/what-is-fileless-malware.html.\n\n\n\n[4] “Internet Security Report – Q4 2020,” WatchGuard, accessed May 4, 2021, published March 30, 2021,\n\nhttps://www.watchguard.com/uk/wgrd-resource-center/security-report-q4-2020, 3.\n\n\n-----\n\ne cos st uct o s a ua, ea g Secu ty, accessed ay, 0, pub s ed Ju y 0 8, ttps //b ea g secu ty et/ p\ncontent/uploads/dlm_uploads/2018/07/Remcos-Instructions-Manual-rev19.pdf, 15-16.\n\n[6] Daniel Frank, “Cybereason Exposes Campaign Targeting US Taxpayers with NetWire and Remcos Malware,” Cybereason, accessed May\n\n4, 2021, published March 18, 2021, https://www.cybereason.com/blog/cybereason-exposes-malware-targeting-us-taxpayers.\n\n## Appendix A\n\n### IOCs\n\n**Project File** **Payload** **C2** **Details**\n\n\n135.181.170.169:50845\n\n\nhttp://dl4.joxi.net/drive/2021/04/1\n\n\nhttp://dl4.joxi.net/drive/2021/04/1\n\n\n37.1.206.16:7575\n\n\n[http://joxi.net/52ap4j7tkJER7m.p](https://www.virustotal.com/gui/url/db5c6f82f2b27fa9a03c87b37bb41292989d06847272099be02a535de19582c4)\n\n|Project File|Payload|C2|\n|---|---|---|\n|45c94900f312b2002c9c445bd8a59ae6|Remcos 04fc0ca4062dd014d64dcb2fe8dbc966|135.181.170.169:50845|\n|d8a57534382a07cc0487b96350bca761|Remcos eb8b1d64429e00f2b3b49f886ee3b0b4||\n|d52d6bad3d11e9a72998608ccca572f5|Remcos 41c0bb6e89ad89af8eef7bec40d4acbb||\n|d66740b3ed3884c31d40e3747684411e|RedLine 302207c3248257d4d9badf4bc4b75483|svhost-system- update.net:80|\n|43660f882cc5971ab83a810398487317|RedLine 6d3e8a2802848d259a3baaaa78701b97|37.1.206.16:7575|\n|192b8ee95537dda7927ba3b45183e6a4|Remcos b8e9ce084d9d49f565f850c59b003bcf||\n|1ae425ac2890283ddcf11946e7e8f6ae|QuasarRat 723f5e75239b66e3d08b83a131c7b66c||\n|20621960888a6299123ce5a2df5eabba|Remcos f174c03d177a04e81677e9c9a9eae0c8||\n|27b62f7b4b285b880b8c81960aa60b15|Remcos cf45b793bc9ec86bfedfa165c01ede15||\n|2d15a4c9184878e25bdf108bd58290b8|Remcos de2ff99ca086a8ad0f9b8027aef696ba||\n|37bbbbc44c80ff4fe770ce78f6a37ebd|Remcos 73790d28f4f8f0f4c402da66c8dc393f||\n|603b1cc2d5488dcd8bb0a3b14429c88b|Remcos 23c5bc4a2e69c3f171561b524ceb4098||\n|62c8efb35b3b9c10e965ec5a236fed2d|Remcos 4def35aedc86a946c13118e14127e0e9||\n|a948e8d3222b9fa8ccbd091230098b78|Remcos 85c700ff566161c77a03f282fa48a246||\n|ecdb2860af9ce2754d178c80e3303080|QuasarRat 7870a7c7e355d1fbf357c846d8bf2aea||\n|fe84ead033bfeaee70f84d8733b51e08|RedLine 4023e57ffbc87aa93621a7c2a6f0b425||\n\n\n## Appendix B\n\n### MITRE ATT&CK TTPs Matrix\n\n|Technique|ID|Name|\n|---|---|---|\n|Execution|T1059.003|Windows Command Shell|\n|T1059.006|Python||\n|Persistence|T1547.009|Shortcut Modification|\n|T1547.001|Registry Run Keys / Startup Folder||\n\n\n-----\n\n|Privilege Escalation|T1548.002|Abuse Elevation Control: Bypass User Account Control|\n|---|---|---|\n|T1055|Process Injection||\n|T1055.012|Process Hollowing||\n|Defense Evasion|T1140|Deobfuscate/Decode Files or Information|\n|T1112|Modify Registry||\n|T1027|Obfuscated Files or Information||\n|T1055|Process Injection||\n|T1055.002|Portable Executable Injection||\n|T1055.012|Process Hollowing||\n|T1127|Trusted Developer Utilities Proxy||\n|T1127.001|MSBuild||\n|T1497.001|System Checks||\n|T1218.005|Signed Binary Proxy Execution: Mshta||\n|Credential Access|T1555|Credentials from Password Stores|\n|T1555.003|Credentials from Web Browsers||\n|T1539|Steal Web Session Cookie||\n|T1056|Input Capture||\n|T1056.001|Keylogging||\n|Discovery|T1087|Account Discovery|\n|T1083|File and Directory Discovery||\n|T1518|Software Discovery||\n|T1518.001|Security Software Discovery||\n|T1082|System Information Discovery||\n|T1614|System Location Discovery||\n|T1033|System Owner/User Discovery||\n|T1124|System Time Discovery||\n|Collection|T1123|Audio Capture|\n|T1115|Clipboard Data||\n|T1113|Screen Capture||\n|T1125|Video Capture||\n|Command and Control|T1105|Ingress Tool Transfer|\n|T1090|Proxy||\n|Exfiltration|T1041|Exfiltration Over C2 Channel|\n\n\n## Appendix C\n\nZero Detection on VirusTotal\n\n\n-----\n\n-----\n\nop cs esea c\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-13 - Threat Actors Use MSBuild to Deliver RATs Filelessly.pdf"
    ],
    "report_names": [
        "2021-05-13 - Threat Actors Use MSBuild to Deliver RATs Filelessly.pdf"
    ],
    "threat_actors": [
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535978,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1653703111,
    "ts_modification_date": 1653703111,
    "files": {
        "pdf": "https://archive.orkl.eu/51dfa6836fd73212906cbfc6242a4c8266fe346d.pdf",
        "text": "https://archive.orkl.eu/51dfa6836fd73212906cbfc6242a4c8266fe346d.txt",
        "img": "https://archive.orkl.eu/51dfa6836fd73212906cbfc6242a4c8266fe346d.jpg"
    }
}