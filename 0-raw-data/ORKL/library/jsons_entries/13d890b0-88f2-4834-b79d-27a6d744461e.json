{
    "id": "13d890b0-88f2-4834-b79d-27a6d744461e",
    "created_at": "2023-01-12T15:07:51.550506Z",
    "updated_at": "2025-03-27T02:12:03.895636Z",
    "deleted_at": null,
    "sha1_hash": "b6f7ba63489009d33d733b356e0c85aa89f32a7a",
    "title": "2021-03-09 - Microsoft Exchange Server Vulnerabilities Mitigations – updated March 9, 2021",
    "authors": "",
    "file_creation_date": "2022-05-28T23:10:12Z",
    "file_modification_date": "2022-05-28T23:10:12Z",
    "file_size": 113277,
    "plain_text": "# Microsoft Exchange Server Vulnerabilities Mitigations – updated March 15, 2021\n\n**[msrc-blog.microsoft.com/2021/03/05/microsoft-exchange-server-vulnerabilities-mitigations-march-2021](https://msrc-blog.microsoft.com/2021/03/05/microsoft-exchange-server-vulnerabilities-mitigations-march-2021)**\n\n**Update March 15, 2021:** _If you have not yet patched, and have not applied the mitigations_\n_[referenced below, a one-click tool, the Exchange On-premises Mitigation Tool is now our](https://msrc-blog.microsoft.com/2021/03/15/one-click-microsoft-exchange-on-premises-mitigation-tool-march-2021/)_\n_recommended path to mitigate until you can patch._\n\n[Microsoft previously blogged our strong recommendation that customers upgrade their](https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/)\n**on-premises Exchange environments to the latest supported version. For customers**\nthat are not able to quickly apply updates, we are providing the following alternative\nmitigation techniques to help Microsoft Exchange customers who need more time to patch\ntheir deployments and are willing to make risk and service function trade-offs.\n\n**These mitigations are not a remediation if your Exchange servers have already been**\n**compromised, nor are they full protection against attack. We strongly recommend**\n[investigating your Exchange deployments using the hunting recommendations here to](https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/#scan-log)\nensure that they have not been compromised. We recommend initiating an investigation in\nparallel with or after applying one of the following mitigation strategies. All the scripts and\n**tools mentioned in this blog, along with guidance on using them can be found here:**\n[https://github.com/microsoft/CSS-Exchange/blob/main/Security/](https://github.com/microsoft/CSS-Exchange/blob/main/Security/)\n\nCustomers should choose one of the following mitigation strategies based on your\norganization’s priorities:\n\n**Recommended solution: Install the security patch**\n\nThis method is the only complete mitigation and has no impact to functionality.\nThe following has details on how to install the security update:\nhttps://techcommunity.microsoft.com/t5/exchange-team-blog/released-march-2021exchange-server-security-updates/ba-p/2175901\nThis will not evict an adversary who has already compromised a server.\n\n**Interim mitigations if unable to patch Exchange Server 2013, 2016, and 2019:**\n\nImplement an IIS Re-Write Rule to filter malicious https requests\nDisable Unified Messaging (UM)\nDisable Exchange Control Panel (ECP) VDir\nDisable Offline Address Book (OAB) VDir\n\n\n-----\n\n[These mitigations can be applied or rolled back using the ExchangeMitigations.ps1 script](https://github.com/microsoft/CSS-Exchange/blob/main/Security/)\ndescribed below and have some known impact to Exchange Server functionality. The\nmitigations are effective against the attacks we have seen so far in the wild but are not\nguaranteed to be complete mitigations for all possible exploitation of these vulnerabilities.\nThis will not evict an adversary who has already compromised a server. This should only\n**_be used as a temporary mitigation until Exchange servers can be fully patched, and_**\n**_we recommend applying all of the mitigations at once._**\n\n## ExchangeMitigations.ps1\n\n**Overview**\n\nThis script contains mitigations to help address the following vulnerabilities:\n\n[CVE-2021-26855](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855)\n[CVE-2021-26857](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26857)\n[CVE-2021-27065](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065)\n[CVE-2021-26858](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26858)\n\nThis script is to be executed via an elevated Exchange PowerShell Session or elevated\nExchange Management Shell. Details for mitigations are below and additional information is\n[on the aforementioned GitHub.](https://github.com/microsoft/CSS-Exchange/blob/main/Security/)\n\n**Backend Cookie Mitigation**\n\n**Applies To:** [CVE-2021-26855](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855)\n\n**Description: This mitigation will filter https requests that contain malicious X-AnonResource-**\nBackend and malformed X-BEResource cookies which were found to be used in the SSRF\nattacks in the wild. This will help with defense against the known patterns observed but not\nthe SSRF as a whole.\n\n**Note: The IIS Rewrite rules will be removed after Exchange is upgraded and the mitigation**\nwill need to be reapplied if the security patch has not been installed.\n\n**Requirements: URL Rewrite Module**\n\nFor IIS 10 and higher URL Rewrite Module 2.1 is recommended, version 2.1 (x86 and\nx64) can be downloaded here:\n\n[https://www.iis.net/downloads/microsoft/url-rewrite](https://www.iis.net/downloads/microsoft/url-rewrite)\nFor IIS 8.5 and lower Rewrite Module 2.0 is recommended, version 2.0 can be\ndownloaded here:\n\nx86 – [https://www.microsoft.com/en-us/download/details.aspx?id=5747](https://www.microsoft.com/en-us/download/details.aspx?id=5747)\nx64 – [https://www.microsoft.com/en-us/download/details.aspx?id=7435](https://www.microsoft.com/en-us/download/details.aspx?id=7435)\n\n\n-----\n\n**Impact: No known impact to Exchange functionality if URL Rewrite module is installed as**\nrecommended.\n\nInstalling URL Rewrite version 2.1 on IIS versions 8.5 and lower may cause IIS and\nExchange to become unstable. If there is a mismatch between the URL Rewrite module and\nIIS version, ExchangeMitigations.ps1 will not apply the mitigation for CVE-2021-26855. You\nmust uninstall the URL Rewrite module and reinstall the correct version.\n\n**Unified Messaging Mitigation**\n\n**Applies To:** [CVE-2021-26857](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26857)\n\n**Description: This mitigation will disable the Unified Message services in Exchange.**\nMicrosoft Exchange Managed Availability services are also disabled to prevent mitigation\nregression.\n\n**Impact: Unified Messaging/Voicemail outage when these services are disabled. The**\nadvanced monitoring capabilities of Exchange are also disabled, due to disabling Microsoft\nExchange Managed Availability services.\n\n**ECP Application Pool Mitigation**\n\n**Applies To:** [CVE-2021-27065 &](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065) [CVE-2021-26858](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26858)\n\n**Description: This mitigation will disable the Exchange Control Panel (ECP) Virtual Directory.**\nMicrosoft Exchange Managed Availability services are also disabled to prevent mitigation\nregression.\n\n**Impact: The Exchange Control Panel will no longer be available. All Exchange**\nAdministration can be done via Remote PowerShell while the Exchange Control Panel is\ndisabled. The advanced monitoring capabilities of Exchange are also disabled, due to\ndisabling Microsoft Exchange Managed Availability services.\n\n**OAB Application Pool Mitigation**\n\n**Applies To:** [CVE-2021-27065 &](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-27065) [CVE-2021-26858](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26858)\n\n**Description: This mitigation disables the Offline Address Book (OAB) Application Pool and**\nAPI. Microsoft Exchange Managed Availability services are also disabled to prevent\nmitigation regression.\n\n**Impact: OAB will be unavailable, including downloads of the Offline Address Book by**\nOutlook clients. This may result in stale address book results in some scenarios and\nconfigurations. The advanced monitoring capabilities of Exchange are also disabled, due to\ndisabling Microsoft Exchange Managed Availability services.\n\n## Additional hunting and investigation techniques\n\n\n-----\n\n**Nmap Script To Scan For CVE-2021-26855**\n\n**Description: Detects whether the specified URL is vulnerable to the Exchange Server SSRF**\nVulnerability (CVE-2021-26855). This can be used to validate patch and mitigation state of\nexposed servers.\n\n**Test-ProxyLogon.Ps1**\n\n**Description:**\n\nThis script checks targeted exchange servers for signs of the proxy logon compromise.\nProxy logon vulnerabilities are described in CVE-2021-26855, 26858, 26857, and 27065.\nThis script is intended to be run via an elevated Exchange Management Shell.\n\n## Microsoft Support Emergency Response Tool (MSERT) to scan Microsoft Exchange Server\n\nMicrosoft Defender has included security intelligence updates to the latest version of the\n[Microsoft Safety Scanner (MSERT.EXE) to detect and remediate the latest threats known to](https://docs.microsoft.com/en-us/windows/security/threat-protection/intelligence/safety-scanner-download)\nabuse the [Exchange Server vulnerabilities disclosed on March 2, 2021. Administrators can](https://msrc-blog.microsoft.com/2021/03/05/microsoft-exchange-server-vulnerabilities-mitigations-march-2021/)\nuse this tool for servers not protected by Microsoft Defender for Endpoint or where\nexclusions are configured for the recommended folders below.\n\nTo use the Microsoft Support Emergency Response Tool (MSERT) to scan the Microsoft\nExchange Server locations for known indicators from adversaries:\n\n1. Download MSERT from [Microsoft Safety Scanner Download – Windows security. Note:](https://docs.microsoft.com/en-us/windows/security/threat-protection/intelligence/safety-scanner-download)\n\nIn case you need to troubleshoot it, see How to troubleshoot an error when you run the\nMicrosoft Safety Scanner.\n2. Read and accept the End user license agreement, then click Next.\n3. Read the Microsoft Safety Scanner Privacy Statement, then click Next.\n4. Select whether you want to do full scan, or customized scan.\n\n**Full scan – The most effective way to thoroughly scan every file on the device. It is the**\nmost effective option although it might take a long time to complete depending on the\ndirectory size of your server.\n**Customized scan – This can be configured to scan the following file paths where**\nmalicious files from the threat actor have been observed:\n_%IIS installation path%\\aspnet_client\\*_\n_%IIS installation path%\\aspnet_client\\system_web\\*_\n_%Exchange Server installation path%\\FrontEnd\\HttpProxy\\owa\\auth\\*_\n_Configured temporary ASP.NET files path_\n_%Exchange Server Installation%\\FrontEnd\\HttpProxy\\ecp\\auth\\*_\n\n\n-----\n\nThese remediation steps are effective against known attack patterns but are not guaranteed\n**as complete mitigation for all possible exploitation of these vulnerabilities. Microsoft**\nDefender will continue to monitor and provide the latest security updates.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-09 - Microsoft Exchange Server Vulnerabilities Mitigations – updated March 9, 2021.pdf"
    ],
    "report_names": [
        "2021-03-09 - Microsoft Exchange Server Vulnerabilities Mitigations – updated March 9, 2021.pdf"
    ],
    "threat_actors": [
        {
            "id": "529c1ae9-4579-4245-86a6-20f4563a695d",
            "created_at": "2022-10-25T16:07:23.702006Z",
            "updated_at": "2025-03-27T02:02:09.93109Z",
            "deleted_at": null,
            "main_name": "Hafnium",
            "aliases": [
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "ETDA:Hafnium",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7c969685-459b-4c93-a788-74108eab6f47",
            "created_at": "2023-01-06T13:46:39.189751Z",
            "updated_at": "2025-03-27T02:00:03.017103Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "ATK233",
                "G0125",
                "Operation Exchange Marauder",
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "MISPGALAXY:HAFNIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2704d770-43b4-4bc4-8a5a-05df87416848",
            "created_at": "2022-10-25T15:50:23.306305Z",
            "updated_at": "2025-03-27T02:00:55.43633Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "HAFNIUM",
                "Operation Exchange Marauder",
                "Silk Typhoon"
            ],
            "source_name": "MITRE:HAFNIUM",
            "tools": [
                "Tarrask",
                "ASPXSpy",
                "Impacket",
                "PsExec",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536071,
    "ts_updated_at": 1743041523,
    "ts_creation_date": 1653779412,
    "ts_modification_date": 1653779412,
    "files": {
        "pdf": "https://archive.orkl.eu/b6f7ba63489009d33d733b356e0c85aa89f32a7a.pdf",
        "text": "https://archive.orkl.eu/b6f7ba63489009d33d733b356e0c85aa89f32a7a.txt",
        "img": "https://archive.orkl.eu/b6f7ba63489009d33d733b356e0c85aa89f32a7a.jpg"
    }
}