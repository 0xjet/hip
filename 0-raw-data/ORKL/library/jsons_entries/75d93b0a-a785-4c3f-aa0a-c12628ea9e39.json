{
    "id": "75d93b0a-a785-4c3f-aa0a-c12628ea9e39",
    "created_at": "2023-01-12T15:09:45.084315Z",
    "updated_at": "2025-03-27T02:05:37.709211Z",
    "deleted_at": null,
    "sha1_hash": "676d69d7d110e2df1710222c87a325f338caee27",
    "title": "2013-07-30 - Versatile and infectious- Win64-Expiro is a cross‑platform file infector",
    "authors": "",
    "file_creation_date": "2022-05-29T01:26:33Z",
    "file_modification_date": "2022-05-29T01:26:33Z",
    "file_size": 638558,
    "plain_text": "# Versatile and infectious: Win64/Expiro is a cross‑platform file infector\n\n**[welivesecurity.com/2013/07/30/versatile-and-infectious-win64expiro-is-a-cross-platform-file-infector/](https://www.welivesecurity.com/2013/07/30/versatile-and-infectious-win64expiro-is-a-cross-platform-file-infector/)**\n\nJuly 30, 2013\n\nRecently, our anti-virus laboratory discovered an interesting new modification of a file virus\nknown as Expiro which targets 64-bit files for infection. File-infecting viruses are well known\nand have been studied comprehensively over the years, but malicious code of this type\nalmost invariably aimed to modify 32-bit files. One such family of file viruses, called\n\n30 Jul 2013 - 07:06AM\n\nRecently, our anti-virus laboratory discovered an interesting new modification of a file virus\nknown as Expiro which targets 64-bit files for infection. File-infecting viruses are well known\nand have been studied comprehensively over the years, but malicious code of this type\nalmost invariably aimed to modify 32-bit files. One such family of file viruses, called\n\nRecently, our anti-virus laboratory discovered an interesting new modification of a file virus\nknown as Expiro which targets 64-bit files for infection. File-infecting viruses are well known\nand have been studied comprehensively over the years, but malicious code of this type\nalmost invariably aimed to modify 32-bit files. One such family of file viruses, called Expiro\n\n\n-----\n\n(Xpiro), was discovered a long time ago and it s not surprising to see it today. However, the\nbody of this versatile new modification is surprising because it’s fully cross-platform, able to\ninfect 32-bit and 64-bit files (also, 64-bit files can be infected by an infected 32-bit file).\n[According to our naming system the virus is called Win64/Expiro.A (aka W64.Xpiro or](http://www.virusradar.com/en/Win64_Expiro.A/description)\nW64/Expiro-A). In the case of infected 32-bit files, this modification is detected as\nWin32/Expiro.NBF.\n\nThe virus aims to maximize profit and infects executable files on local, removable and\nnetwork drives. As for the payload, this malware installs extensions for the Google Chrome\nand Mozilla Firefox browsers. The malware also steals stored certificates and passwords\nfrom Internet Explorer, Microsoft Outlook, and from the FTP client FileZilla. Browser\nextensions are used to redirect the user to a malicious URL, as well as to hijack confidential\ninformation, such as account credentials or information about online banking. The virus\ndisables some services on the compromised computer, including Windows Defender and\nSecurity Center (Windows Security Center), and can also terminate processes. Our\n[colleagues from Symantec have also written about the most recent Expiro modification.](http://www.symantec.com/connect/blogs/first-widespread-virus-cross-infection)\n[TrendMicro also reported attacks using this virus.](http://blog.trendmicro.com/trendlabs-security-intelligence/file-infector-expiro-hits-us-steals-ftp-credentials/)\n\n## The Win64/Expiro infector\n\nThe body of the virus in a 64-bit infected file is added to the end of the new section of the\nexecutable file, called .vmp0 with a size of 512,000 bytes (on disk). To transfer control to the\nmain body (.vmp0), the virus inserts 1,269 bytes of malicious startup code in place of the\nentry point. Before modifying the entry point code, the virus copies the original bytes to the\nbeginning of the .vmp0 section. This startup code performs unpacking of the virus code into\nthe .vmp0 section. In the screenshot below we show the template for the startup code to be\nwritten during infection to the entry point of the 64-bit file.\n\n\n-----\n\nDuring the infection process, the virus will prepare this startup code for insertion into the\nspecified file and some of these instructions will be overwritten, thus ensuring the\nuniqueness of the .vmp0 section contents (polymorphism). In this case, the following types\nof instruction are subject to change: add, mov, or lea (Load Effective Address), instructions\nthat involve direct offsets (immediate). At the end of the code, the virus adds a jump\ninstruction which leads to the code unpacked into the .vmp0 section. The screenshot below\nshows the startup code pattern (on the left) and startup code which was written into the\ninfected file (on the right).\n\nSimilar startup code for 32-bit files is also located in the section .vmp0 as presented below.\n\n\n-----\n\nThis code in x32 disassembler looks like usual code (infected file).\n\nThe size of the startup code in the case of a 64-bit file is equal to 1,269 bytes, and for an\nx32 file is 711 bytes.\n\nThe virus infects executable files, passing through the directories recursively, infecting\nexecutable file by creating a special .vir file in which the malicious code creates new file\ncontents, and then writes it to the specified file in blocks of 64K. If the virus can’t open the\nfile with read/write access, it tries to change the security descriptor of the file and\ninformation about its owner.\n\nThe virus also infects signed executable files. After infection files are no longer signed, as\nthe virus writes its body after the last section, where the overlay with a digital signature is\nlocated. In addition, the virus adjusts the value of the field Security Directory in the Data\nDirectory by setting the fields RVA and Size to 0. Accordingly, such a file can also be\nexecuted subsequently without reference to any information about digital signatures. The\nfigure below shows the differences between the original/unmodified and the infected 64-bit\n\n\n-----\n\nfile, where the original is equipped with a digital signature. On the left, in the modified\nversion, we can see that the place where the overlay shown on the right was\nformerly located is now the beginning of section .vmp0.\n\nFrom the point of view of process termination, Expiro is not innovative and uses an\napproach based on retrieving a list of processes, using API CreateToolhelp32Snapshot, and\nsubsequent termination via OpenProcess / TerminateProcess. Expiro targets the following\nprocesses for termination: «MSASCui.exe», «msseces.exe» and «Tcpview.exe».\n\nWhen first installed on a system, Expiro creates two mutexes named «gazavat».\n\n\n-----\n\nIn addition, the presence of the infector process can be identified in the system by the large\nnumbers of I/O operations and high volumes of read/written bytes. Since the virus needs to\nsee all files on the system, the infection process can take a long time, which is also a\nsymptom of the presence of suspicious code in the system. The screenshot below shows\nthe statistics relating to the infector process at work.\n\nThe virus code uses obfuscation during the transfer of offsets and other variables into the\nAPI. For example, the following code uses arithmetic obfuscation while passing an\nargument SERVICE_CONTROL_STOP (0x1) to advapi32!ControlService, using it to\ndisable the service.\n\n\n-----\n\nWith this code Expiro tries to disable the following services: wscsvc (Windows Security\nCenter), windefend (Windows Defender Service), MsMpSvc (Microsoft Antimalware\nService, part of Microsoft Security Essentials), and NisSrv (Network Inspection Service\nused by MSE).\n\n## Win64/Expiro payload\n\nAs the payload, the virus installs a browser extension for Google Chrome and Mozilla\nFirefox. The manifest file for the installed Chrome extension looks like this:\n\nIn the Chrome extensions directory, the directory with malicious content will be called\ndlddmedljhmbgdhapibnagaanenmajcm. The malicious extension uses two JavaScript\nscripts for it work: background.js and content.js. After deobfuscation, the code pattern of\nbackground.js looks like this.\n\n\n-----\n\nThe variable HID is used for storing the OS version string and Product ID. The variable\nSLST is used to store a list of domains that are used to redirect the user to malicious\nresources.\n\nThe manifest file for the Firefox extension looks like this:\n\n\n-----\n\nIn the screenshot below you can see part of the code of content.js which performs parsing\nof form-elements on the web-page. Such an operation will help malicious code to retrieve\ndata that has been entered by the user into forms, and may include confidential information.\n\n\n-----\n\nAs a bot, the malware can perform the following actions:\n\nchange control server URLs;\nexecute a shell command – passes it as param to cmd.exe and returns result to\nserver;\ndownload and execute plugins from internet;\ndownload a file from internet and save it as %commonapddata%\\%variable%.exe;\nimplement a TCP flood DoS attack;\nenumerate files matching mask \\b*.dll in the %commonappdata% folder, loading each\none as a library, calling export «I» from it, and loading exports «B» and «C» from it;\ncall plugin functions «B» and «C» from the loaded plugin;\nstart proxy server (SOCKS, HTTP);\nset port forwarding for TCP on the local router (SOAP).\n\nExpiro tries to steal FTP credentials from the FileZilla tool by loading info from\n%appdata%\\FileZilla\\sitemanager.xml. Internet Explorer is also affected by Expiro which\nuses a COM object to control and steal data. If a credit card form is present on a loaded\nweb page, malware will try to steal data from it. The malicious code checks form input data\nfor matches to «VISA» / «MasterCard» card number format and shows a fake window with\nmessage:\n\n_“Unable to authorize.\\n %s processing center is unable to authorize your card %s.\\nMake_\n_corrections and try again.”_\n\nThis malware can also steal stored certificates with associated private keys (certificate store\n«MY»).\n\n## Implications of Win64/Expiro\n\nInfecting executable files is a very efficient vector for the propagation of malicious code.\n\nThe Expiro modification described here represents a valid threat both to home users and to\ncompany employees. Because the virus infects files on local disks, removable devices and\nnetwork drives, it may grow to similar proportions as the Conficker worm, which is still\nreported on daily basis. In the case of Expiro the situation is getting worse, because if a\nsystem is left with at least one infected file on it which is executed, the process of total\nreinfection of the entire disk will begin again.\n\nIn terms of delivery of the payload, the file infector is also an attractive option for cyber\ncrime, because viral malicious code can spread very fast. And of course, a cross-platform\ninfection mechanism makes the range of potential victims almost universal.\n\n_Big hat tip to Miroslav Babis for the additional analysis of this threat._\n\n**Artem Baranov, Malware Researcher ESET Russia**\n\n\n-----\n\nSHA1 hashes for analyzed samples:\n\n1 Win64/Expiro.A - 469fcc15b70cae06f245cec8fcbf50f7c55dcc4b\n\n1 Win32/Expiro.NBF - 9818d4079b9cb6b8a3208edae0ac7ad61a85d178\n\n1\n\n30 Jul 2013 - 07:06AM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2013/2013-07-30 - Versatile and infectious- Win64-Expiro is a cross‑platform file infector.pdf"
    ],
    "report_names": [
        "2013-07-30 - Versatile and infectious- Win64-Expiro is a cross‑platform file infector.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536185,
    "ts_updated_at": 1743041137,
    "ts_creation_date": 1653787593,
    "ts_modification_date": 1653787593,
    "files": {
        "pdf": "https://archive.orkl.eu/676d69d7d110e2df1710222c87a325f338caee27.pdf",
        "text": "https://archive.orkl.eu/676d69d7d110e2df1710222c87a325f338caee27.txt",
        "img": "https://archive.orkl.eu/676d69d7d110e2df1710222c87a325f338caee27.jpg"
    }
}