{
    "id": "a946a259-1d3c-4821-b5f1-b9de70752ef4",
    "created_at": "2023-01-12T14:59:46.153628Z",
    "updated_at": "2025-03-27T02:05:41.689121Z",
    "deleted_at": null,
    "sha1_hash": "c26478a70a46c99110636aed35e8cc3968d209ba",
    "title": "2021-11-29 - Unpatched Exchange Servers distribute Phishing Links (SquirrelWaffle)",
    "authors": "",
    "file_creation_date": "2022-05-29T01:18:56Z",
    "file_modification_date": "2022-05-29T01:18:56Z",
    "file_size": 430187,
    "plain_text": "# Unpatched Exchange servers distribute phishing links (squirrelwaffle)\n\n**[certitude.consulting/blog/en/unpatched-exchange-servers-distribute-phishing-links-squirrelwaffle/](https://certitude.consulting/blog/en/unpatched-exchange-servers-distribute-phishing-links-squirrelwaffle/)**\n\nPeter Wagner 29.11.2021\n\nBeginning of November a customer reached out to us. Internal and external users reported\nsuspicious mails sent from their mail accounts, which included suspicious links. These mails\nwere sent as replies to messages already sent in the past, which made them appear\nlegitimate.\n\nFirst it was confirmed in the mail headers that the mail originated from the customers\nExchange and was not spoofed from external sources. While further investigating the root\ncause it turned out that the on-premise MS Exchange server had not received updates for\nseveral months. Thus, it was affected by multiple vulnerabilities, e.g. “ProxyShell” (CVE2021-34473, CVE-2021-34523, CVE-2021-31207) and “ProxyLogon” (CVE-2021-26855).\n\nThe IIS logs showed that special crafted server-side request forgery (SSRF) requests were\nused to exploit CVE-2021-26855, directed at the Exchange Web Services API endpoint. This\nallowed the attacker to perform unauthorized actions on behalf of legitimate users.\n\nThe corresponding IIS log lines looked like this:\n\n\n-----\n\n```\n2021-11-01 19:50:59 xxx.xxx.xxx.xxx POST /autodiscover/autodiscover.json\na=a@edu.edu/autodiscover/autodiscover.xml?=&Email=autodiscover/autodiscover.json?\na=a@edu.edu&CorrelationID=<empty>;&cafeReqId=1b241d99-89e8-4cfa-8b3c-f96c1ef40cf0;\n443 - xxx.xxx.xxx.xxx Mozilla/5.0+(Windows+NT+10.0;+WOW64)+AppleWebKit/537.36+\n(KHTML,+like+Gecko)+Chrome/92.0.4515.131+Safari/537.36. - 200 0 0 345\n\n```\nOne thing that was also noticeable in the Exchange Logs is that the “ItemClass” of all mails\ncreated by the attacker was set to “IPM.Blabla”.\n\nThis allowed us to filter these mails in Outlook. However, this only worked for mailboxes of\nusers who received these suspicious emails. We did not find emails in the “sent” folders of\naffected users. The pictures below show two mail accounts.\n\nThe format of the censored URLs conformed to the following regex pattern: `[a-z]+\\.[a-`\n```\nz0-9]+\\.com\\/[a-z]+\\/[a-z]+-[0-9]+\n\n```\nExample: `sdf.wwkwe.com/tatamua/uzaro-3381926`\n\n\n-----\n\nNo malware could be identified on the Exchange server in the course of a quick analysis.\nOther forensic investigations came to a similar conclusion [1]. However, no full forensic\nanalysis was conducted during this investigation.\n\nLater it turned out that other organizations [1] were affected by similar attacks, seemingly\nrelated to an attack campaign titled “squirrelwaffle” [2].\n\nWe recommend everyone to update internet-facing applications in short cycles and apply\npatches as soon as possible after their release. Due to the high attack surface of the\nMicrosoft Exchange product (multiple critical vulnerabilities have been published this year), it\nis also recommended to block access to the web interface from the internet and use a VPN if\naccess from the internet is required.\n\nRelated URLs:\n\n[1] https://www.trendmicro.com/en_us/research/21/k/Squirrelwaffle-Exploits-ProxyShell-andProxyLogon-to-Hijack-Email-Chains.html\n\n[2] [https://blog.talosintelligence.com/2021/10/squirrelwaffle-emerges.html](https://blog.talosintelligence.com/2021/10/squirrelwaffle-emerges.html)\n\nPhoto by [Maksim Goncharenok from](https://www.pexels.com/@maksgelatin?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) [Pexels.](https://www.pexels.com/photo/gold-letter-y-on-black-background-5605061/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-29 - Unpatched Exchange Servers distribute Phishing Links (SquirrelWaffle).pdf"
    ],
    "report_names": [
        "2021-11-29 - Unpatched Exchange Servers distribute Phishing Links (SquirrelWaffle).pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535586,
    "ts_updated_at": 1743041141,
    "ts_creation_date": 1653787136,
    "ts_modification_date": 1653787136,
    "files": {
        "pdf": "https://archive.orkl.eu/c26478a70a46c99110636aed35e8cc3968d209ba.pdf",
        "text": "https://archive.orkl.eu/c26478a70a46c99110636aed35e8cc3968d209ba.txt",
        "img": "https://archive.orkl.eu/c26478a70a46c99110636aed35e8cc3968d209ba.jpg"
    }
}