{
    "id": "48d5629f-ffc6-4323-bf3d-f145675fa0b6",
    "created_at": "2023-01-12T15:04:05.357879Z",
    "updated_at": "2025-03-27T02:05:38.678586Z",
    "deleted_at": null,
    "sha1_hash": "3fd16db8717c283069b9462b7123460475508530",
    "title": "2016-09-16 - iSpy Keylogger",
    "authors": "",
    "file_creation_date": "2022-05-28T19:33:44Z",
    "file_modification_date": "2022-05-28T19:33:44Z",
    "file_size": 2083796,
    "plain_text": "# iSpy Keylogger\n\n**zscaler.com/blogs/research/ispy-keylogger**\n\nKeyloggers have always been present in attackers’ toolkits. They give attackers the power\nto record every keystroke from a victim’s machine and steal sensitive information. Zscaler\nThreatLabZ recently came across a signed keylogger campaign in our cloud sandbox. In\nthis blog, we will provide an analysis of this malicious commercial keylogger, known as iSpy.\nWritten in .Net 2.0, iSpy is configured for keylogging, stealing passwords and screenshots,\nand monitoring webcams and clipboards. It is being sold on underground forums via\nmultiple subscription packages as shown in Figure 1.\n\n\n-----\n\n**_Figure 1: iSpy keylogger subscription packages_**\n\n**iSpy keylogger infection**\niSpy is delivered via spam email that has malicious JavaScript or Document as an\nattachment, which then downloads the keylogger payload. The main iSpy payload is usually\ncompressed using a custom packer. So far, we have seen packers written in Visual Basic\n6.0, AutoIt, and .Net. We have also seen a campaign of signed .NET crypter where iSpy\nwas served. This crypter uses different digital certificates (mostly invalid certificates) and\ndrops different malware samples, as shown in Table 1 below\n\n**_Figure 2: Certificate used by .Net Crypter_**\n\nTable 1: Different malware samples dropped by .NET crypter\n\n**MD5** **Email used in certificate** **Malware**\n\nb99491b53faabb559adf42d6156d9dad [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) iSpy\n\n2b8e2d23c88b11bbcf59928d5d440bdb [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\n73dcbece89a474bccfb76f022e5e81a4 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Skypoot\n\n\n-----\n\nc1838d9542e6860cd44d706883b49a73 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Skypoot\n\n2aac4e7b7a1ab407039e12b53a4af942 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\n398680cbdd017f7b99e9add1477939a8 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\n2368102c5e12b0c881bc09256546d255 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Skypoot\n\n92a342a6ce4b0accfb20c61fd657104b [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\n1ffadc9cde4d4a1d794362c9179a0ec9 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\nc17cddb6f63d9797583167a30c5711c1 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\nde7db381733f3c5a479865120f58a8c1 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\n58334fb57165350ccb06c1949459a65c [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Skypoot\n\n5e6114b726b1b8a52331890054157969 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Skypoot\n\n12f4de75e2e299e6d444a58fff78d83d [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\n92eaac8b2266fb2514e66a8e2cf98f13 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Kasidet\n\na9867d69c3d7d716339dd10ac4b29216 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\nedaf8ce53d4919c52e422c7ce7242738 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\n2b478db2af56153a2cee33f71213cc2f [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Hawkeye\n\n214280b4e09fe4c4cc46aebef533e07e [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\nba8c47e679eba575c4e8605da97f4e77 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\nd151378aeae384e85ab10f5bb19ef254 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Phorpiex\n\n881e968ddf34c38943a56651a3870174 [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Subti\n\n0e565eb881a25180993539f34e88ec3d [[email protected]](https://www.zscaler.com/cdn-cgi/l/email-protection) Bladabindi\n\n**Installation**\nThe malware sample we analyzed was packed with a VB6 (native) custom packer. The\npacker uses the XOR-based method to decrypt the payload and contains obfuscated\nzombie code between instructions to slow down analysis. Figure 3 shows the installation\nand functionality overview of iSpy.\n\n\n-----\n\n**_Figure 3: Installation workflow and functionality overview of iSpy_**\n\nThe second layer of packing contains multiple anti-VM and anti-analysis tricks, some of\nwhich include:\n\nChecks PEB flags for debugger presence\nChecks for sandbox and debugger using GetTickCount and Sleep\n\n\n-----\n\nLoops until cursor movement is detected\nChecks if screen resolution is 800 x 600 or more\n\nFinally, it decrypts the payload file and injects the decrypted file into another instance of the\nsame process using process hollowing technique as seen below:\n\n**_Figure 4: Spawns process in Suspended mode for injection_**\n\nThe decrypted file is a loader file that contains a DLL and .NET binary in its resource\nsection. It first loads the DLL file that further loads the final iSpy payload (.NET binary) using\nLoadDotNetPE export function.\n\nThe malware checks configuration settings to select the folder for dropping the executable.\nBased on the configuration, it drops itself into one of the following locations:\n\n%APPDATA%\n%LOCALAPPDATA%\n%USERPROFILE%\\Documents\n%TEMP%\n\n\n-----\n\n**_Figure 5: Installation function_**\n\nAfter copying itself into any of the above mentioned locations, it deletes “Zone.Identifier”\nflag from Alternate Data Stream (ADS) to disable the security warning message that is\ndisplayed every time the malware file is executed.\n\n**Persistence**\n\nIt creates an entry in “SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run” key under\nHKLM or HKCU, based on configuration settings, to execute the malware on system\nstartup.\n\n**Configuration**\n\niSpy has many customizable features (Figure 6) including the functionality to record\nkeystrokes, recover passwords, and retrieve serial keys from various software, then\n\n\n-----\n\nsending the stolen data over SMTP, HTTP, or FTP. It also has a web panel that helps the\nattacker to monitor the activity of iSpy infections.\n\n**_Figure 6: iSpy configuration class_**\n\nAs mentioned earlier, depending on the configuration, it can send stolen data via three\ndifferent methods: HTTP, SMTP, or FTP. FTP and SMTP credentials, directly encoded in the\nfile, are encrypted using a custom encryption method. Function decrypt, in the class\n\n\n-----\n\nStringCipher, is used for the decryption of credentials as well as other strings. MUTEX value\nfrom the configuration is used as the key for decryption. For the HTTP method, iSpy uses\nthe PHP_KEY authentication to upload data to C&C server.\n\n**Data stealing**\nThe current sample, discussed in this blog, uses FTP for sending the stolen data to\nattacker. The FTP account – ftp://ftp[.]bhika[.]comxa[.]com –was active at the time of\nanalysis and the ftp credentials are embedded in the file itself. The website resolves to IP\naddress “31.170.160.209” which belongs to comxa.com, which is owned by 000webhost\nNetwork, a provider of free hosting. We have notified comxa.com of the offending account.\n\nAfter successful installation, iSpy collects computer information such as username,\nWindows version, and installed program details (AV, firewall, browser, etc.), and sends this\ninformation along with install notification (Figure 7) to a C&C server.\n\n**_Figure 7: Installation notification contents_**\n\nKeylogging code is the main component of this malware. It logs timestamped key presses\nand sends them to the attacker. It also contains code to steal the license keys of application\nsoftware, such as Adobe Photoshop, Microsoft Office, and others. It also collects saved\npasswords from web browsers, email clients (such as Outlook), FTP clients (like FileZilla\nand CoreFTP), and games like Minecraft.\n\n\n-----\n\n**KillAV**\niSpy has the functionality to disable antivirus programs by creating a sub-key of the\nprogram name under registry key, “Software\\\\Microsoft\\\\Windows\nNT\\\\CurrentVersion\\\\Image File Execution Options\\\\” and then setting “rundll32.exe” as the\nvalue of “Debugger” under that key. It also disables access to that newly created registry\nkey by setting all RegistryRights to deny so it cannot be easily removed. After this change in\nregistry, Windows will load “rundll32.exe” when the targeted process is started. As a result,\nthe given AV process will not start. Below is the list of AV processes that iSpy targets:\n\"rstrui.exe\", \"AvastSvc.exe\", \"avconfig.exe\", \"AvastUI.exe\", \"avscan.exe\", \"instup.exe\",\n\"mbam.exe\", \"mbamgui.exe\", \"mbampt.exe\", \"mbamscheduler.exe\", \"mbamservice.exe\",\n\"hijackthis.exe\", \"spybotsd.exe\", \"ccuac.exe\", \"avcenter.exe\", \"avguard.exe\", \"avgnt.exe\",\n\"avgui.exe\", \"avgcsrvx.exe\", \"avgidsagent.exe\", \"avgrsx.exe\", \"avgwdsvc.exe\", \"egui.exe\",\n\"zlclient.exe\", \"bdagent.exe\", \"keyscrambler.exe\", \"avp.exe\", \"wireshark.exe\",\n\"ComboFix.exe\", \"MSASCui.exe\", \"MpCmdRun.exe\", \"msseces.exe\", \"MsMpEng.exe\"\n\n**WebCam Snapshot & Screen grabber**\nIf the webcam logger is configured, it will capture snapshots using the victim’s webcam. It\nsaves the snapshot in %TEMP% folder with the prefix “snapshot” with the .PNG extension.\nIt can then uploads the snapshot to “http://uploads.im/api?upload” (a legitimate image\nhosting website). It logs the URL path of uploaded snapshot and uploads the log’s data on a\nC&C server using the configured method.\n\nSimilarly, iSpy takes screen shots using .NET API CopyFromScreen and saves them to a\nfile with the name “img.png” under the %TEMP% folder. Saved images are uploaded to the\nwebsite mentioned above and a log of URL paths of uploaded files is sent to attacker.\n\n**Other features of iSpy:**\n\nWebsite blocking (based on host file modification)\nFile downloading\nBot killer\nFake message (it displays this message every time malware starts execution)\nDisabler (Taskmgr, Regedit, CMD)\nRunescape PinLogger(RuneScape is a fantasy MMORPG developed and published\nby Jagex, A Bank PIN is a security feature provided in game that players can use to\nprotect their, virtual in game, banks.)\nRun Bind file (file to run along with malware)\n\n**Web panel interface**\nThe current version of iSpy has a web panel where the attacker can monitor the infected\nsystem.\n\n\n-----\n\n**_Figure 8: iSpy web panel_**\n\n**Conclusion**\n\nCommercial keyloggers are general-purpose data stealing tools used by criminals to collect\nas much data as possible about a victim. There are many commercially available\nkeyloggers in the underground market and, unfortunately, using them is fairly easy, requiring\nlittle technical knowledge. In spite of the increased use of specialized tools, the keylogger\nremains a common, and quite potentially damaging, tool. Zscaler ThreatLabZ will continue\nto monitor keyloggers and provide coverage for customers who may be targeted.\n\n**Indicators of compromise:**\n\nURL serving iSpy sample- gratja[.]top/gff/trf.exe\n\nMD5 - ca66771aaaf3e6b4be57f09d9cfabcc1\n\nTable 2: Other iSpy Samples seen in the wild\n\n**MD5** **Packer** **Upload Method**\n\n3f0b2fead12d62bcd7d8ca3b2673ed7f VB6(Native) SMTP\n\n7a9af64a04cf9577bfc76865ae190349 .NET Crypter FTP\n\n\n-----\n\n08abb6dc71fe3076f9f149c849de737a AutoIT FTP\n\n9373eb008dd45458d424ce928b8d4475 .NET Crypter HTTP\n\n51981d91472c00a78a6358cc2d5ff47f .NET Crypter HTTP\n\n931512db9f969726a051737ce8579497 VB6(Native) FTP\n\n153185846e8fb4edb9e9ec9c3ea73e75 AutoIT SMTP\n\nc17dad76326700c24daef882e8550be4 AutoIT FTP\n\nca66771aaaf3e6b4be57f09d9cfabcc1 VB6(Native) FTP\n\ncb077968a96f497a994010b55771be2e AutoIT FTP\n\nb99491b53faabb559adf42d6156d9dad .NET Crypter SMTP\n\nc8dabc7680e8b7ed344994eb39599296 VB6(P-Code) FTP\n\nBlog by: Atinderpal Singh, Nirmal Singh\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-09-16 - iSpy Keylogger.pdf"
    ],
    "report_names": [
        "2016-09-16 - iSpy Keylogger.pdf"
    ],
    "threat_actors": [
        {
            "id": "ce10c1bd-4467-45f9-af83-28fc88e35ca4",
            "created_at": "2022-10-25T15:50:23.458833Z",
            "updated_at": "2025-03-27T02:00:55.475188Z",
            "deleted_at": null,
            "main_name": "APT34",
            "aliases": null,
            "source_name": "MITRE:APT34",
            "tools": [
                "netstat",
                "Systeminfo",
                "PsExec",
                "SEASHARPEE",
                "Tasklist",
                "Mimikatz",
                "POWRUNER",
                "certutil"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "cffb3c01-038f-4527-9cfd-57ad5a035c22",
            "created_at": "2022-10-25T15:50:23.38055Z",
            "updated_at": "2025-03-27T02:00:55.459558Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "COBALT GYPSY",
                "IRN2",
                "APT34",
                "Helix Kitten",
                "Evasive Serpens",
                "Hazel Sandstorm",
                "EUROPIUM",
                "ITG13"
            ],
            "source_name": "MITRE:OilRig",
            "tools": [
                "ISMInjector",
                "RDAT",
                "Systeminfo",
                "QUADAGENT",
                "OopsIE",
                "Tasklist",
                "certutil",
                "ZeroCleare",
                "POWRUNER",
                "netstat",
                "ipconfig",
                "LaZagne",
                "BONDUPDATER",
                "SideTwist",
                "PsExec",
                "SEASHARPEE",
                "Mimikatz",
                "RGDoor",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67709937-2186-4a32-b64c-a5693d40ac77",
            "created_at": "2023-01-06T13:46:38.495593Z",
            "updated_at": "2025-03-27T02:00:02.848206Z",
            "deleted_at": null,
            "main_name": "OilRig",
            "aliases": [
                "IRN2",
                "Hazel Sandstorm",
                "EUROPIUM",
                "TA452",
                "Earth Simnavaz",
                "Cobalt Gypsy",
                "Crambus",
                "Helix Kitten",
                "APT 34",
                "APT34",
                "ATK40",
                "G0049",
                "Evasive Serpens",
                "Twisted Kitten"
            ],
            "source_name": "MISPGALAXY:OilRig",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535845,
    "ts_updated_at": 1743041138,
    "ts_creation_date": 1653766424,
    "ts_modification_date": 1653766424,
    "files": {
        "pdf": "https://archive.orkl.eu/3fd16db8717c283069b9462b7123460475508530.pdf",
        "text": "https://archive.orkl.eu/3fd16db8717c283069b9462b7123460475508530.txt",
        "img": "https://archive.orkl.eu/3fd16db8717c283069b9462b7123460475508530.jpg"
    }
}