{
    "id": "99bcebdf-f9ad-4816-87d4-fbcde74cd1a5",
    "created_at": "2022-10-25T16:48:18.148955Z",
    "updated_at": "2025-03-27T02:13:25.954351Z",
    "deleted_at": null,
    "sha1_hash": "c0d85dfff9ce55913cea8ed1d04b0a7e17336636",
    "title": "Fidelis Threat Advisory 1008 - Darkseoul-Jokra Analysis and Recovery",
    "authors": "",
    "file_creation_date": "2013-03-22T04:07:14Z",
    "file_modification_date": "2013-03-22T04:07:14Z",
    "file_size": 288816,
    "plain_text": "### www.fidelissecurity.com\n www.threatgeek.com\n @FidSecSys +1800.652.4020\n```\n         Fidelis Threat Advisory #1008\n    Darkseoul/Jokra Analysis And Recovery\n              March 21, 2013\n              Document Status: FINAL\n               Last Revised: 2013-03-21\n\n```\nA recent cyber-attack reported within the South Korean broadcasting and banking infrastructure\nreportedly brought down over 35,000 systems. This attack has drawn comparisons in intent and\nmethod to the recent wiping attack against Saudi Aramco by the Shamoon malware. Shamoon\nhas been covered extensively by the community, and was covered in Fidelis Threat Advisory\n#1007. Naturally our curiosity was peaked and we acquired samples of the malware and started\nanalysis.\n\nThe initial analysis has been posted on the Fidelis Threat Geek blog and will be expanded upon\nin this advisory. This write-up will focus on the wiper malware used and the recovery techniques\nthat are possible.\n\nFrom preliminary analysis it is known that the malware will overwrite the Master Boot Record\n(MBR) and Volume Boot Record (VBR). The records and files overwritten by the malware so far\nhave been wiped with patterns of 'HASTATI' or 'PR!NCPES’.\n\nThe malware samples that have been analyzed by our team are different in code and function\nfrom the Shamoon malware. However, by using the same recovery methods found in advisory\n#1007 the files and data are indeed recoverable.\n```\nWiper Malware Overview\n\n```\nTwo malware samples obtained were used in the analysis. The malware has been named\n'DarkSeoul' and 'Jokra' by the community.\n\nOur samples have been touched on in our blog entry and other samples have been covered in\nblogs around the community.\n\n239ed75323.exe: 5fcd6e1dace6b0599429d913850f0364\nmb_join.exe: 0a8032cd6b4a710b1771a080fa09fb87\n\nUsers are granted permission to copy and/or distribute this document in its original electronic form and print copies for personal use. This\ndocument cannot be modified or converted to any other electronic or machine-readable form in whole or in part without prior written\napproval of Fidelis Security Systems, Inc.\n\nWhile we have done our best to ensure that the material found in this document is accurate, Fidelis Security Systems, Inc. makes no\nguarantee that the information contained herein is error free.\n\nCopyright © 2013 General Dynamics Fidelis Cybersecurity Systems Rev. 2013-02-21\nThreat Advisory #1008 Page 1 of 5 **_Darkseoul/Jokra Analysis And Recovery_**\n\n\n-----\n\n### www.fidelissecurity.com\n www.threatgeek.com\n @FidSecSys +1800.652.4020\n\nThe malware gains disk access by opening the physical drive as a file.\n\n**Disk Access (Func 00401d55):**\nsprintf(filename_str, \"\\\\.\\PhysicalDrive%d\", 0)\nhFile = CreateFileA(filename_str, GENERIC_READ | GENERIC_WRITE,\nFILE_SHARE_READ | FILE_SHARE_WRITE, NULL,\nOPEN_EXISTING, NULL)\n\nExample of the wiper opening the drive as a file.\n\nThe first section that the malware overwrites is located at 0x7000. This is sector 56 and is\nnormally the VBR location of a Windows XP system. It continues the pattern of 'HASTATI' or\n'PR!NCPES’' for 102,400d bytes.\n\n**Wiper Selection (Func 00402079):**\nand [local.1], 0    ;(local.1->\"PR!NCPES\")\nmov esi,[arg.2]  ;arg.2 = 0x38 on first call\neax=0\nshld eax,esi,9\nmov edi,[arg.1]\nmov [arg.2], eax\nlea eax, [arg.2]\nshl esi,9\n\nSetFilePointer(hFile, esi, eax, FILE_BEGIN) // on first call -- 0x009efab8:0x00007000\nWriteFile(hFile, &arg.3, 512, &local.1, NULL)\n\nExample of how the wiper selected the location to overwrite on the first call.\n\nIf this is hardcoded for 0x7000 then it will not wipe the VBR of any systems after and including\nVista, as those VBR locations are in different areas.\n\nDuring testing both malware samples were executed in a Windows 7 VM. Neither wiped the MBR\nor the VBR—they only overwrote files within the file system—but the system wasn't prevented\nfrom starting up.\n\nThe malware writes a 512-byte pattern to the disk in XP and a 1023 byte pattern in Windows 7.\n\nExample of the loop responsible for overwriting the disk and files.\n\nAs observed during a debugging session the following screenshot shows one of the 512-byte\npatterns it writes to disk:\n\nCopyright © 2013 General Dynamics Fidelis Cybersecurity Systems Rev 2013-02-21\n\n\n-----\n\n### www.fidelissecurity.com\n www.threatgeek.com\n @FidSecSys +1800.652.4020\n\nExample of overwritten disk\n\nThe malware will create new threads for each physical drive found on the affected system. It\nenumerates and tries to find PhysicalDrive[0-9]. The malware makes distinctions based on what\ntype of drive is detected, such as fixed or removable devices. As long as the drive is fixed a new\nthread is created.\n\n**Thread 1 (Func 00401aa0):**\n\ncall func_00401d55\nstrcpy(drive_path, \"B:\\\")\n...\nif (GetDriveType(drive_path) == DRIVE_FIXED)\nCreateThread(NULL, 0, 00401B7A, 0040247C, 0, &tid)\n...\n\nExample of the wiper finds fixed drives and create new thread for each drive.\n\nThe following commands have previously been reported in the community:\n\n“taskkill /F /IM pasvc.exe”\n\n“taskkill /F /IM Clisvc.exe”\n\n\"shutdown -r -t 0\"\n\nExample of commands run by the malware.\n\nThe first command, “taskkill /F /IM pasvc.exe”, will try to kill a process named “pasvc.exe”. This\nprocess is associated with the AhnLab Policy Agent process.\n\nCopyright © 2013 General Dynamics Fidelis Cybersecurity Systems Rev 2013-02-21\n\n\n-----\n\n### www.fidelissecurity.com\n www.threatgeek.com\n @FidSecSys +1800.652.4020\n\nThe second command, “taskkill /F /IM Clisvc.exe”, will try to kill a process named “Clisvc.exe”.\nThis process is associated with the ViRobot ISMS security tool from HAURI Inc.\nThe third command, “shutdown -r -t 0”, instructs the malware to shutdown and reboot the system.\n\nThe malware shuts the system down quickly after initial execution, it was found to finish wiping in\nten to fifteen minutes in our tests. Due to the speed of the wiping it was very easy to find that the\nmalware did not actually wipe all the data on the computer. It wiped just enough to make the\nmachine unusable after the operation was complete. This is notable and can be seen in the\noperation of the malware as it makes sure to overwrite the VBR first then continue overwriting the\nMBR and other files.\n\n**Note: The sample Fidelis Security Systems researchers had available looked very similar to that**\n_detailed in community write-ups. However, as of the date of this post, researchers were still_\n_analyzing the available sample. Therefore, differences between the available sample and others_\n_available to the community may become apparent in the future._\n```\nFile System Recovery\n\n```\nThe following is the view of the wiped disk for each of the operating systems that we tested:\n\nExample of wiped MBR by the Malware.\n\nThe malware never actually overwrote the backup VBR. It was found that the same techniques\nutilized to recover data from Shamoon could be applied here. The recovery methods were\ncovered in depth in Fidelis Threat Advisory #1007 so we will not show them here. What will be\nshown are the results of the recovery.\n\nWhen the backup VBR is found within EnCase (v6.19.6) it was possible to add a manual NTFS\npartition into the system to recover the file system and data within.\n\nCopyright © 2013 General Dynamics Fidelis Cybersecurity Systems Rev 2013-02-21\n\n\n-----\n\n### www.fidelissecurity.com\n www.threatgeek.com\n @FidSecSys +1800.652.4020\n\nExample of a file system recovered\n\nOnce the logical file system is recovered relevant forensic artifacts can be located. It will be\nimportant to note that a lot of files will be recoverable and a lot of system files are left untouched.\nThe wiper corrupts file systems very quickly, but the expense of this is leaving more files\nuntouched and recoverable.\n\n**Note:** _When multiple partitions are suspected then it will be likely the recovery will need to be_\n_done manually with a hex editor. The method for this was also covered in advisory #1007._\n\nUsing a hex editor it is possible to repair an image with the backup VBR and build a new MBR to\nboot the affected computer. This comes with a warning, just being able to boot the machine and\naccessing the data within doesn't mean that system will operate properly. The system still has\nfiles that were corrupted by the malware, and some of those files will affect the user experience.\nHowever, in our testing we were able to rebuild the MBR and recover the VBR to boot the\naffected system.\n\nOur repaired system was missing the start button and a few of the shortcuts to executables on\nthe desktop were no longer functioning. The XP system when repaired always asked to complete\na chkdisk cycle, and on the whole didn’t operate normally. The Windows 7 systems that were\naffected by the two malware samples did not experience these issues, and appeared to operate\nnormally. Attempts to repair the XP system with the windows recovery CD always ended in a\nbluescreen error before the operation finished any repairing.\n```\nThe Fidelis Take\n\n```\nFidelis XPS sensors detect the DarkSeoul/Jokra malware as it enters the network as\n\"Trojan.Win32.EraseMBR.b\". Fidelis XPS is capable of detecting this threat regardless of delivery\nmethod employed by the Threat Actors responsible. Fidelis XPS can detect and alert on\nexecutables such as the DarkSeoul malware multiple layers deep inside of zip files, or even\nXOR'ed inside of a weaponized MS Office document or Adobe PDF File. The Fidelis Threat\nResearch and Network Forensics and Incident Response teams will continue to actively monitor\nthe ever-evolving threat landscape for the latest threats to our customers network security.\n\nCopyright © 2013 General Dynamics Fidelis Cybersecurity Systems Rev 2013-02-21\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2013/2013.03.21.Darkseoul/FTA%201008%20-%20Darkseoul-Jokra%20Analysis%20and%20Recovery.pdf"
    ],
    "report_names": [
        "FTA 1008 - Darkseoul-Jokra Analysis and Recovery"
    ],
    "threat_actors": [
        {
            "id": "68cc6e37-f16d-4995-a75b-5e8e2a6cbb3d",
            "created_at": "2024-05-01T02:03:07.943593Z",
            "updated_at": "2025-03-27T02:05:17.259709Z",
            "deleted_at": null,
            "main_name": "BRONZE EDISON",
            "aliases": [
                "DarkSeoul",
                "Maverick Panda ",
                "Sykipot ",
                "TG-0623 ",
                "getkys",
                "APT4 "
            ],
            "source_name": "Secureworks:BRONZE EDISON",
            "tools": [
                " Wkysol",
                " ZxPortMap",
                "Gh0st RAT"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716498,
    "ts_updated_at": 1743041605,
    "ts_creation_date": 1363925234,
    "ts_modification_date": 1363925234,
    "files": {
        "pdf": "https://archive.orkl.eu/c0d85dfff9ce55913cea8ed1d04b0a7e17336636.pdf",
        "text": "https://archive.orkl.eu/c0d85dfff9ce55913cea8ed1d04b0a7e17336636.txt",
        "img": "https://archive.orkl.eu/c0d85dfff9ce55913cea8ed1d04b0a7e17336636.jpg"
    }
}