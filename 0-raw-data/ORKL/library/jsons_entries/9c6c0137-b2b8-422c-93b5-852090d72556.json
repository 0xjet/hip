{
    "id": "9c6c0137-b2b8-422c-93b5-852090d72556",
    "created_at": "2022-10-25T16:48:12.253638Z",
    "updated_at": "2025-03-27T02:17:05.533038Z",
    "deleted_at": null,
    "sha1_hash": "81e52f31beb2457b5d84afb6886b6aa3ea43d6b2",
    "title": "",
    "authors": "",
    "file_creation_date": "2015-11-03T23:38:24Z",
    "file_modification_date": "2015-11-03T23:38:24Z",
    "file_size": 1176710,
    "plain_text": "# Malicious Application Compatibility Shims\n\n## Table of Contents\nIntroduction .................................................................................................................................................. 2\n\nBackground ................................................................................................................................................... 2\n\nHow the Windows Image Loader works with the Shim Engine .................................................................... 6\n\nPrior Work ..................................................................................................................................................... 7\n\nIn the wild ..................................................................................................................................................... 9\n\nOther Offensive Uses .................................................................................................................................. 13\n\nTools ............................................................................................................................................................ 14\n\nCurrent Analysis Tools............................................................................................................................. 14\n\nDefense Tools .......................................................................................................................................... 15\n\nForensics Tools ........................................................................................................................................ 16\n\nPenetration Testing Tools ....................................................................................................................... 16\n\nDefenses ...................................................................................................................................................... 17\n\nMoving Forward ...................................................................................................................................... 18\n\nConclusion ................................................................................................................................................... 18\n\nBibliography ................................................................................................................................................ 19\n\nPage | 1\n\n\n-----\n\n## Introduction\nOne of the many reasons why Microsoft has dominated the personal computer market\nis because they have gone to extraordinary lengths to ensure backwards compatibility in\n(most) of their products, and many third party products. This is currently implemented by the\nApplication Compatibility Framework (ACF) which holds a position of considerable tactical\nvalue on modern computer systems because, by design, the ACF is capable of intercepting\napplication API calls and manipulating the Portable Executable (PE) file loading process.\nActors in the wild have been observed leveraging a few of the simple components of the\nACF and it is expected that the number of exploitations will rise and grow in sophistication.\nSome of these more advanced malicious techniques will be demonstrated and I will be\nreleasing the source code of several new tools that help mitigate this new threat.\n\n## Background\nRaymond Chen is a developer on the Windows Team at Microsoft and maintains a blog\ncalled ‘The Old New Thing’ in which he describes many fascinating stories and deep\ntechnical insights into the history of Windows. On August 24[th] 2005 he wrote:\n\n_“During the development of Windows 95, application compatibility was of course a very high_\n_priority. To make sure that coverage was as broad as possible, the development manager_\n_for Windows 95 took his pick-up truck, drove down to the local Egghead Software store_\n_(back when Egghead still existed), and bought one copy of every single PC program in_\n**_the store..._** _In exchange for taking responsibility for ensuring that Windows 95 was_\n_compatible with your adopted programs, you [the developer] got to keep them [the_\n_applications] after Windows 95 shipped.” (Chen, 2005)_\n\nIn any given Windows 7 machine one can find hard coded\nreferences to ‘3DFrogFrenzy’, ‘Acrobat5’, ‘WordPerfect8’,\n‘Works99’ and many other applications dating back to the\nearly 1990’s. These programs do not correctly function on\nmodern Windows machines, so in an effort to compensate\nfor poor coding (on all sides), Microsoft has sacrificed\nsecurity for developer convenience by allowing anyone to\ncreate and install Shim database (sdb) files. These\ndatabase files contain the specific details on how\nWindows should manipulate (in other words ‘shim’) a\ntarget program with predefined ‘Fixes’. The Application\nCompatibility Toolkit (ACT) contains hundreds of\nconfigurations for thousands of programs (like those listed\nabove) primarily contained within the file\n%WINDIR%\\AppPatch\\sysmain.sdb. Microsoft provides a\nfree tool called the Application Compatibility Administrator\nwhich allows users to create and apply specific Fixes\nsuch as ‘DisableNX’, ‘ModifyShellLinkPath’, ‘VirtualRegistry’,\n‘DisableAdvancedRPCClientHardening’, ‘ForceAdminAccess’, ‘InjectDll’ (my favorite),\n‘DisableSeh’, ‘ShellExecuteXP’ and many others.\n\nPage | 2\n\n\n-----\n\n_Figure 1. The Application Compatibility Toolkit (ACT) – Compatibility Administrator_\n\nThe Application Compatibility Toolkit can be used to create and install a shim by guiding the\nuser through a Wizard which first asks for a path to the target executable. The ACT will then\nanalyze the file for criteria to filter on such as file name, file size, link date, PE checksum,\netc. Then the user will be presented with a list of ‘Modes’ where each ‘Mode’ is effectively a\nbundle of individual Fixes that can be applied to a process and its children (A ‘Mode’ or\n‘Compatibility Mode’ are sometimes referred to as a ‘Layer’). An example of a Mode would\nbe ‘VistaSP1VersionLie’ as opposed to a Fix such as, ‘Emulate Cursor’. After the Mode\nscreen, the wizard will show a list of Fixes. By default the 32-bit Compatibility Administrator\nwill show a list of 367 Fixes, however if the Compatibility Administrator is executed from the\ncommand line with the ‘/x’ parameter the list of Fixes will increase to 811 to include\nundocumented Fixes. After finishing the wizard, a user can save the sdb file, and then\ninstall it by right clicking on the database icon and clicking ‘Install’. The installer simply\nexecutes the command line sdb installer called sdbinst.exe.\n\n_The Application Compatibility Toolkit (ACT) – Compatibility Administrator_\n\nPage | 3\n\n\n-----\n\nThe installer will create a GUID, copy the sdb file into\n%SystemRoot%\\AppPatch\\Custom\\<GUID>.sdb then add a registry key using an internal\ndatabase name in the format of HKLM\\SOFTWARE\\Microsoft\\Windows\nNT\\CurrentVersion\\AppCompatFlags\\Custom\\<GUID>.sdb and \\InstalledSDB\\<GUID>.sdb.\nIf everything is successful, the installer will add an entry to the Add/Remove programs list.\nObviously if a user has administrative access, they could simply add the keys to the registry\ndirectly.\nRegistry keys:\n\n  - `HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom`\n\n  - `HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB`\n\n_Figure 2 Install Registry Keys (1)_\n\n_Figure 3. Install Registry Keys (2)_\n\nDefault Install File Locations\n\n  - `%WINDIR%\\AppPatch\\Custom\\`\n\n  - `%WINDIR%\\AppPatch\\Custom\\Custom64\\`\n\n_Figure 4 - Default Install Path. Note: The sdb file can be put anywhere accessible. Even a UNC path_\n\nAfter the sdb file installation is complete all processes launched after that point will be\nsubjected to the file matching rules of this shim database. For efficiency reasons, Windows\ncaches metadata for each executed file and stores that data in the Application Compatibility\nCache. In effect, the cache is a record of all executed processes since the computer was\nlast rebooted. The forensic value from this data is used by some tools such as Mandiant’s\n\nPage | 4\n\n\n-----\n\nShim Cache Parser ® and was the subject of the MS15-001 elevation of privilege\nvulnerability in January 2015.\n\nSeven months prior to the MS15-001 patch, a forensics expert named Chris Graham\npublished a blog post titled, ‘Shimming Your way Past UAC’. In this entry he provided a\ndetailed walk through (including source code) on how to generate and install an sdb file that\nwould use the ‘RedirectEXE’ Fix to redirect the execution (while retaining the privileges) of a\ntarget executable (Graham, 2014). The processes that are targeted by this method rely on\nthe fact that these executables are signed by Microsoft and have a manifest file property of\n```\n<autoElevate>true</autoElevate> such as SndVol.exe. The MS15-001 did nothing to\n\n```\nprevent this UAC bypass technique and as a result it is still being exploited in the wild.\nHowever, in April 2015 Microsoft did push out an optional update (KB3045645) which\nremoved the auto-elevating manifest property from sdbinst.exe (the system sdb installer).\nMore details can be found in the Defenses section.\n\nShims are heavily integrated into Windows for normal operations, such as auto elevating\nany executable matching the filename *instal*. Microsoft also uses shims to test and fix their\nown products such as Outlook and Word rather than updating/patching them the traditional\nway. When evaluating compatibility issues with Windows Vista, the ACT was used to collect\ndata via shimming exeplorer.exe and other system processes (Hancke, 2009). Primarily\nMicrosoft uses shims to implement most of the functionality in products such as the\nEnhanced Mitigation Experience Toolkit (EMET) and Windows Fixit patches which are used\nto mitigate critical vulnerabilities as a stopgap measure between patch cycles.\n\nShim strengths from an attacker’s point of view are:\n\n  - Nearly every process is vulnerable. The shim engine (shimeng.dll) will not shim\ncertain hard coded modules such as:\n\n`o` NT Symbolic Debugger (NTSD)\n`o` WinDbg\n`o` Software License Service (slsvc.exe) for Windows Vista (Ionescu, 2007)\n\n  - The shim engine (shimeng.dll) will intercept GetProcAddress() in the event an\napplication attempts to dynamically call a function that the shim engine has\nmanipulated.\n\n  - There are many ways to apply native fixes maliciously.\n\n  - There are little to no defensive measures from malicious shims (until now).\n\n  - They are not considered executable even though they can contain shellcode.\n\n  - Custom fixes can be defined in the form of a user supplied DLL file. This is useful\nbecause the ‘InjectDll’ is not a predefined Fix for 64-bit shims.\n\n  - With a few exceptions, all modern Windows OS versions support shims and natively\nship with the auto-elevated shim database installer sdbinst.exe. The native installer\nwill add an entry in the Add/Remove programs list but this can be bypassed by\ndirectly adding to the appropriate keys.\n\nShim weaknesses from an attacker’s pointer of view:\n\n  - An attacker needs administrative rights to execute the shim database installer and/or\nwrite to the necessary registry keys.\n\nPage | 5\n\n\n-----\n\n  - Programs only need to change their names to avoid being shimmed. There are no\ncurrently available tools that allow wildcards in file names, but the functionality does\nexist as seen in the native shim databases such as sysmain.sdb.\n\n  - Shims only run in user-mode so they cannot manipulate kernel-mode modules.\n\n## How the Windows Image Loader works with the Shim Engine\nWhen a new process needs to be created, a program will use one of the functions in\nntdll.dll, such as CreateProcess(). To determine if the new process needs to be shimmed,\napphelp.dll is loaded and two registry keys might be opened or queried:\n\n  - `HKCM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers`\n\n  - `HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers`\n\nIf the application needs to be shimmed an undocumented __ COMPAT_LAYER\nenvironment variable will be set in the new child process. The kernel creates the various\ndata structures, sets up the process space then loads ntdll.dll into that new process space.\nIn that space, the kernel will set the context struct to begin executing the ntdll.dll function\ncalled LdrInitializedThunk(). This function effectively sets up everything the process will\nneed such as:\n\n  - Initialize the heap\n\n  - Maps and initializes the appropriate DLL’s\n\n  - Initializes Tread Local Storage (TLS)\n\n  - Fiber Local Storage (FLS)\n\n  - Import Address Tables (IAT’s)\n\n  - Export Address Tables (EAT’s)\n\n  - Process the Manifest files (Which might also have compatibility settings)\n\n  - Read the application compatibility database and loading the shim engine\n\nAfter all the initialization is done, the kernel will reset the threat’s context to the ntdll.dll\nfunction RtlUserThreatStart() which will in turn begin executing the actual original entry point\nfor the executable that was specified with CreateProcess(). If the child process needs to be\nshimmed, both the parent and child processes will load apphelp.dll and verify the sdb file:\n\n_Figure 5 Confusing procmon log output of a program named 'LaunchWithoutShim.exe' executing a program called,_\n_'HelloWorldShimmed.exe'. Procmon is a part of SysInternals by Mark Russinovich_\n\nPage | 6\n\n\n-----\n\nIf the sdb file cannot be found or opened the Application Event Log will record, ‘Unable to\nopen shim database version registry key’. Assuming the sdb file is found and loaded without\nerror, it is then parsed to further verify that the file should indeed be shimmed by checking\nthe sdb file for more name filters and other file criteria; there is always at least one filter, but\nby default it is a match-all wildcard character: *. The loaded sdb file will be further parsed to\nfind the specific Fix (or Fixes) that will be applied along with a reference to a DLL where that\nFix is implemented. The specified DLL is then loaded into the suspended process, and\nallowed to execute DllMain() following the initialization of the other system DLLs. If the Fix\ndoes not reference a DLL then the native system shim database(s) are loaded in order find\nthe appropriate DLL where that particular fix is implemented. Most of the predefined Fixes\nare found in %WINDIR%\\AppPatch\\sysmain.sdb and most of those fixes are implemented\nin %WINDIR%\\AppPatch\\AcGeneral.dll.\n\nIf the Fix is not predefined in sysmain.sdb it is called a Custom Fix. Anyone can create a\ncustom fix by creating a DLL which exports the following functions:\n\n  - `GetHookAPIs(char *,ushort *,ulong *)`\n\n  - `NotifyShims(char *, unsigned __int16 *, unsigned __int32 *)`\n\nThe DLL containing the Fix is typically hooks the IAT of the target to intercept specific\nfunctions. For example the VirtualRegistry Fix will hook all registry related calls and\nmanipulate them accordingly. GetProcAddress() is also hooked to anticipate dynamic calls\nto the would-be hooked functions. Sdb files have undocumented features such as hot\npatching which is currently only used by Microsoft to implement the functionality in Fixit\npatches (discussed later). After ntdll.dll loads the AppInit DLLs in the child process, it then\nloads the shim engine which implemented with apphelp.dll. This shim engine will clear the\nenvironment variable __COMPAT_LAYER then apply the Fixes and patches (if any) to the\ntarget module. It is possible to have more than one sdb apply Fixes to the same process but\nthis leads to undefined behavior due to the uncertain order in which the shims are applied.\n\n## Prior Work\nThe earliest mention of shims relating to security was in 2007 when a software engineer\nnamed Alex Ionescu started to publish a number of blog posts titled, ‘Secrets of the\nApplication Compatilibity Database (SDB)’. This was planned to be a 7 part series but\nunfortunately Ionescu stopped after the fourth post. In the years preceding and following, a\nsmall number of disparate bloggers posted various technical details and mentions of shims,\nbut typically with the focus of application compatibility. Below is a general timeline of major\nshim references:\n\n1. June 2005. A Microsoft Employee named Chris Jackson’s started an MSDN blog\n\ncalled, ‘The App Compat Guy’. Around January 2007 he began posting information\nabout the ACT and blogging about shims.\n[http://blogs.msdn.com/b/cjacks/](http://blogs.msdn.com/b/cjacks/)\n2. May 2007. Ionescu ‘Secrets of the Application Compatilibity Database (SDB)’\n\n[www.alex-ionescu.com/?p=39](http://www.alex-ionescu.com/?p=39)\n\nPage | 7\n\n\n-----\n\n3. August 2008. A blogger with the handle ‘wedday’ posted some technical details\n\nabout how the shim engine worked based on the shim engine’s debug output.\n[http://wedday.blogspot.co.uk/2008/08/shimeng.html](http://wedday.blogspot.co.uk/2008/08/shimeng.html)\n4. July 2009. Another Microsoft Employee named ‘Maarten van de Bospoort’ wrote a\n\nblog post titled ‘Disabling a Shim’. However his solution was to disable the shim\nengine via group policy which is not advised because Windows relies on the shim\nengine for EMET and Fixit patches (discussed later). (Bospoort, 2009)\n[http://blogs.msdn.com/b/maartenb/archive/2009/07/24/disabling-a-shim.aspx](http://blogs.msdn.com/b/maartenb/archive/2009/07/24/disabling-a-shim.aspx)\n5. February 2010. A developer who goes by the name, ‘Jochen Kalmbach’ posted a\n\ntool that will display the shims that would be activated by a particular file.\n[http://blog.kalmbach-software.de/2010/02/22/the-shim-database/](http://blog.kalmbach-software.de/2010/02/22/the-shim-database/)\n6. April 2012. A company named ‘Recx’ posted a compilation of research notes titled\n\n‘Windows AppCompat Research Notes’ where deep technical insight and control\nflow of the shim engine was discussed. (Ollie, 2012)\n[http://recxltd.blogspot.co.uk/2012/04/windows-appcompat-research-notes-part-](http://recxltd.blogspot.co.uk/2012/04/windows-appcompat-research-notes-part-1.html)\n1.html\n7. May 2012. Microsoft updated its Application Compatibility Toolkit (ACT) Technical\n\nReference where background information is given on the ACT along with details of\nindividual fixes. This article also links to the AppHelp.dll documentation.\n[https://technet.microsoft.com/en-us/library/hh825181.aspx](https://technet.microsoft.com/en-us/library/hh825181.aspx)\n8. May 2012. “Shim: A New Method of Injection” by the Journal of Computer Hooligans\n\n[ftp://os2.fannet.ru/fileechoes/programming/XA_159.PDF](ftp://os2.fannet.ru/fileechoes/programming/XA_159.PDF)\n9. October 2013. Mark Baggett gave a talk at DerbyCon titled, ‘Windows – Own3d by\n\nDefault’. He is the first to discuss the use of shims in a post exploitation context.\n[http://www.irongeek.com/i.php?page=videos/derbycon3/4206-windows-0wn3d-by-](http://www.irongeek.com/i.php?page=videos/derbycon3/4206-windows-0wn3d-by-default-mark-baggett)\n[default-mark-baggett](http://www.irongeek.com/i.php?page=videos/derbycon3/4206-windows-0wn3d-by-default-mark-baggett)\n10. March 2014. Jon Erickson presented at Black Hat Asia ‘Persist-It – Using and\n\nAbusing Microsoft Fix It Patches’ where he describes how Fixit patches work and\nhow his tool can be used to analyze them. (Erickson, 2014)\n[https://www.blackhat.com/docs/asia-14/materials/Erickson/Asia-14-Erickson-Persist-](https://www.blackhat.com/docs/asia-14/materials/Erickson/Asia-14-Erickson-Persist-It-Using-And-Abusing-Microsofts-Fix-It-Patches.pdf)\n[It-Using-And-Abusing-Microsofts-Fix-It-Patches.pdf](https://www.blackhat.com/docs/asia-14/materials/Erickson/Asia-14-Erickson-Persist-It-Using-And-Abusing-Microsofts-Fix-It-Patches.pdf)\n[https://www.blackhat.com/docs/asia-14/materials/Erickson/WP-Asia-14-Erickson-](https://www.blackhat.com/docs/asia-14/materials/Erickson/WP-Asia-14-Erickson-Persist-It-Using-And-Abusing-Microsofts-Fix-It-Patches.pdf)\n[Persist-It-Using-And-Abusing-Microsofts-Fix-It-Patches.pdf](https://www.blackhat.com/docs/asia-14/materials/Erickson/WP-Asia-14-Erickson-Persist-It-Using-And-Abusing-Microsofts-Fix-It-Patches.pdf)\n11. May 2014. Graham Posts ‘Shimming your Way Past UAC’ (Graham, 2014). This\n\nprovided the first public source code reference for how the ACT can be used to\nbypass a UAC prompt.\n[http://blog.ddifrontline.com/4#more-4](http://blog.ddifrontline.com/4#more-4)\n12. December 2014. Jon Erickson presents ‘The active use and exploitation of\n\nMicrosoft's Application Compatibility Framework’ at SysScan 360 and CodeBlue in\nJapan.\n[http://sdb.io/erickson-codeblue.pdf](http://sdb.io/erickson-codeblue.pdf)\n13. Jan 2015. Sean Pierce (me) Shmoocon Epilogue “Forensic Analysis of Advanced\n\nPersistence through the Application Compatibility Toolkit”\n\nPage | 8\n\n\n-----\n\n## In the wild\nThe frame of reference for leveraging malicious shims is centered around post exploitation\nwhere it is assumed the attacker has administrative privileges in order to write the\nnecessary registry keys to install shims on a system wide basis. Listed below are numerous\nexamples of malicious shims being used in cyber-espionage and cyber-crime activities.\nWhile the ACT offers many avenues to perform arbitrary code execution, attackers routinely\nuse only a few of the basic Fixes:\n\n**BlackEnergy: There are variants of this malware that have been used in cyber-**\ncrime & cyber-espionage and has been under continuous development since\nJune 2007. Modern variations support components such as rootkits and 64-bit\nplugins. In April 2013 the authors responsible for BlackEnergy added the UAC\nbypass ‘RedirectEXE’ Fix making BlackEnergy the first publically known\nmalicious use of the ACT. They also used the ‘DisableNXShowUI’ Fix to\ndisable Data Execution Prevention (DEP) in its host process. (F-Secure, 2015)\n(Aquilino, 2014) (Cherepanov R. L., 2014)\nBlackEnergy 2 hash: 26b9816b3f9e2f350cc92ef4c30a097c6fec7798\nBlackEnergy 3 hash: 78636f7bbd52ea80d79b4e2a7882403092bbb02d\n\n**GootKit: This is a backdoor that was initially observed in April of 2014 and is**\npurportedly created by the actor ‘MzH’ (hFireF0X, 2015). It used the UAC\nbypassing ‘RedirectEXE’ Fix to target the auto-elevated ‘cliconfg.exe’ (SQL\nServer Client Network Utility). In March 2015, the malware author(s) leveraged\nthe in-memory patching as discussed by Jon Erickson at his talks at BlackHat\nAsia in August 2014. The authors of Gootkit most likely used Erickson’s\npublically available sample code to generate the sdb files (23 in all), but for\nunknown reasons the Gootkit authors did not use Erickson’s stealth installation\ntechnique (they still use the traditional native sdb installer, sdbinst.exe).\n(Pernet, 2015) (Dr. WEB, 2014) (Erickson, 2014)\nGootKit: f9772fcfbcaac9c4873989a1759a5c654eec440e\n\n**Roaming Tiger: This is a cyber-espionage group outed by Eset’s Anton**\nCherepanov at ZeroNights 2014. Cherepanov observed Roaming Tiger\ntargeting countries belonging to the Russia and Commonwealth of Independent\nStates (CIS) with phishing documents to get initial code execution which then\nused the ACT UAC bypass technique and then installed ACT enabled\npersistence. What makes this case unique is that Roaming Tiger registered\nspecially crafted 32-bit and 64-bit shim databases for ‘explorer.exe’ and two\nother processes. These sdb files described custom Fixes named\n‘AcProtect_Apps’ and specified that those Fixes were contained within the\nlibrary ‘AcProtect.dll’ as seen in Figure 6. As a result the AcProtect.dll was\ninjected into every target process that matched the sdb criteria.\n(Cherepanov A., 2014)\n\nPage | 9\n\n\n-----\n\n_Figure 6 sdb-explorer showing the shim (Fix) name and DLL reference (bottom two boxes), and the DLL file_\n_reference (top)_\n\n**Search Protect** **by Conduit: This has been classified by multiple anti-virus**\nvenders as a Potentially Unwanted Program (PUP) starting in August 2013. In\nJanuary of 2015 Search Protect was observed using the ACT for targeted\npersistence by creating a 32-bit shim layer named ‘VC32Ldr♦☻’ which applies\nthe ‘InjectDll’ Fix to ‘chrome.exe’, ‘firefox.exe’, ‘iexplorer.exe’,\n‘software_remove_tool.exe’, and ‘software_reporter_tool.exe’. For the 64-bit\nprocesses, a custom Fix named, ‘VC64Shim’ was defined as being in the\n‘VCLdr64.dll’; similar to Roaming Tiger. This resulted in that DLL being injected\ninto ‘iexplore.exe’, ‘chrome.exe’, and ‘explorer.zza’. The custom fix was most\nlikely used because there is no predefined ‘InjectDll’ Fix for 64-bit processes.\n\nBy using the sdb-explorer.exe tool developed by Jon Erickson of iSIGHT\nPartners, the output below will show that the Fix injected\n\\\\.\\globalroot\\systemroot\\apppatch\\nbin\\vc32loader.dll into every process that\nmatched one of the target filenames listed above.\nSearch Protect shim: 175abbeaf62f08716f7975190e550b95\n\nPage | 10\n\n\n-----\n\n_Figure 7 sdb-explorer output for Search Protect shim_\n\n**Upatre: This was first observed in August 2013 (msft-mmpc, 2013) and acts as**\na downloader for other malware such as Zbot, Dyre, and Dridex. As early as\nFebruary 2015 Upatre started installing other malware with administrative\nprivileges by using Graham’s UAC bypass technique (Inocencio, 2014) (Author,\n2015).\nUpatre hash: 1d38c362198ad67329fdf58b4743165e\n\n**DRIDEX: This is the successor to CRIDEX, both of which focus on stealing**\npersonal and banking information. This latest variant was upgraded to use\nwebinjects, more evasion techniques and relies on spam or Upatre for delivery.\nAt the same time Upatre implemented Graham’s code, Dridex also started\nusing it but in a slightly different manner: Unlike Upatre, Dridex targeted\n‘iscsicli.exe’ and used the ‘RedirectEXE’ Fix to execute a batch script to simply\nopen up a port in the Window’s Firewall. After that, the batch script uninstalled\nthe shim and destroyed all evidence of there being a shim (Drapeau, 2015).\nThis is most likely due to the fact that Graham’s technique used the native\n‘sdbinst.exe’ installer, which adds an entry into the add/remove programs’ list.\nThe commands used are:\n\nPage | 11\n\n\n-----\n\n```\n \"C:\\Windows\\system32\\sdbinst.exe\" /q\n \"C:\\Users\\%USERNAME%\\AppData\\Local\\Temp\\\\..\\..\\LocalLow\\com.%USERNAME%.\n sdb\"\n\n```\nThe batch script:\n```\n start C:\\Users\\user_name\\AppData\\Local\\edg3FAC.exe\n C:\\Users\\user_name\\Desktop\\malware.exe\n sdbinst.exe /q /u \"C:\\Users\\user_name\\AppData\\LocalLow\\$$$.sdb\"\n reg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows\n NT\\CurrentVersion\\AppCompatFlags\\Custom\\iscsicli.exe\" /f\n reg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows\n NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB\\{f48a0c57-7c48-461c-9957 ab255ddc986e}\" /f\n del C:\\Windows\\AppPatch\\Custom\\{f48a0c57-7c48-461c-9957 ab255ddc986e}.sdb\n del %LOCALAPPDATA%Low\\$$$.sdb\n del %LOCALAPPDATA%Low\\$$$.bat\n\n```\nDridex hash: 2dcf82bfc86397969059e118f3feab10\n\nPage | 12\n\n\n-----\n\n## Other Offensive Uses\nAttackers have been observed using the ACT predominantly as a UAC bypass, as a\npersistence mechanism, and only recently has one family (GootKit) used the in-memory\npatching capability. However there are still over 800 more ‘Fixes’ and ‘Modes’ that can be\nused for an array of offensive purposes, the examples listed below will be demonstrated\nduring the talk. Incident Responders and Malware Analysts need to be aware of how shims\ncan modify a process before and during execution, because malicious shims are capable of\nleveraging many rootkit-like functions:\n\n  - _Evasion, and System Integrity Subversion: The autoruns.exe utility (part of the_\nSysInternals Suite) is a tool created by Mark Russinovich which displays many of the\ncommon auto-start locations for executables in Windows. Autoruns does not detect\nshims as having any kind of auto-start capability and furthermore can be shimmed to\nhide auto-start locations such as registry keys with the ‘VirtualRegistry’ Fix. This type\nof tool subversion is not unheard of but what makes the ACT uniquely powerful is\nthat the malicious shim could be developed in as little as 30 seconds. The same\nprocess can be reapplied for both 64-bit and 32-bit versions of regedit.exe (the\nnative Windows registry editor).\n\n  - _Manipulating a Process with Redirections: Fixes such as ‘VirtualRegistry’,_\n‘CorrectFilePaths’, ’VirtualizeDeleteFile’, ‘RedirectShortcut’ and ‘APILogger’.\nDepending on the application, these fixes could be used to intercept and manipulate\nsensitive information such as credentials, and debugging logs. The primary example\nbeing web browsers.\n\n  - _Persistence & Trojanizing: Almost any process can be a host for malicious activity_\nwith ‘InjectDll’, ‘LoadLibraryRedirect’, ‘RedirectShortcut’, ‘RedirectEXE’,\n‘ShimViaEAT’, ‘LoadLibraryfromCWD’ and much more can be accomplished with inmemory patching.\n\n  - _Denial of Service: The “TerminateExe” Fix is the most trait forward way to prevent_\nprocesses from running, however many of the fixes can be used to achieve the\nsame goals such as ‘IgnoreLoadLibrary’, ‘RedirectEXE’, and\n‘DeprecatedServiceShim’. The last shim will allow the denial or redirection of any\nservice that the process was attempting to start.\n\n  - _Disabling Defenses: Shims can also incorporate simple Fixes such as_\n‘DisableWindowsDefender’, ‘DisableASLR’, 'DisableAdvancedRPCClientHardening',\n‘DisableSeh’, and ‘DisableNX’ which would be useful when executing malware or\nattempting to exploit a vulnerability. This is especially powerful when one considers\nthat vulnerabilities like MS08-067 can simply be restored as Mark Baggett mentioned\nin his 2013 DerbyCon talk (Baggett, 2013).\n\n  - _Malware Obfuscation: As a malware analyst this section has been divided into three_\ncategories based on the target/host executable:\n\n`o` Benign Executables – The shimmed executable can be a generic program\nthat has been signed and/or whitelisted. The classic ‘InjectDll’ and\n‘LoadLibraryRedirect’ Fixes could be leveraged via a UNC path but patching\nin new code and/or utilizing existing code akin to ROP (Return Oriented\nProgramming) chains would be a much stealthier and would be very difficult\nto analyze.\n`o` Dependently Malicious Executables – The target executable is purposefully\nbuilt to work in tandem with its shim for malicious functionally. As a result the\ntarget would fail to display any malicious behaviors without the malicious shim\n\nPage | 13\n\n\n-----\n\nto interfere. A classic example would be a subtle ‘kill switch’ being disabled\nvia a shim like the ‘IgnoreException’ Fix. Another example would be hot\npatching instructions to redirect program flow to malicious code existing\nelsewhere in the binary.\n`o` Obfuscated Executable – The target executable will fail completely without\nthe shim. This can be done with code injection and/or hot patching. Such an\nexecutable could be partially or completely encrypted.\n\n  - _In-Memory Patching. This can offer the most wide array of stealth, defense and_\ngeneral anti-analysis capabilities:\n\n`o` Hooking any function\n`o` Add/Remove/Edit Instructions\n`o` Inserting strings/data where needed\n\n          - Changing destination IP’s/hostnames\n\n          - Changing/Randomizing Indicators\n`o` Early detection of debugging and/or other analysis tools.\n\nOne can learn more about what each documented Fix does here:\n[https://technet.microsoft.com/en-us/library/cc765984(v=ws.10).aspx](https://technet.microsoft.com/en-us/library/cc765984(v=ws.10).aspx)\n\n## Tools\n\n### Current Analysis Tools\nThere are a number of publicly available tools that are indispensable when analyzing a\nsuspicious sdb file. Below is an inventory of the major ones:\n\n  - _Compatibility Administrator: The free tool by Microsoft to aid customers in creating,_\ntesting, and installing shim database files as mentioned above. It is the only tool with\na graphical user interface (GUI) and uses that to display sdb files in a logical\nmanner. However it fails to open most custom made sdb files (such as those made\nwith sdb-explorer) and fails to display most of the technical details or even the\nexistence of in-memory patches and custom Fixes.\n[Link: http://www.microsoft.com/en-us/download/details.aspx?id=7352](http://www.microsoft.com/en-us/download/details.aspx?id=7352)\n\n  - _sdbinst.exe: The native installer that the Compatibility Administrator uses to install_\nsdb files.\n[Link: https://support.microsoft.com/en-us/kb/308235](https://support.microsoft.com/en-us/kb/308235)\n\n  - _sdb-explorer.exe: Created by Jon Erickson and for his BlackHat Asia talk ‘Using and_\nAbusing Microsoft’s Fix It Patches’ in March 2014. Unlike the Compatibility\nAdministrator sdb-explorer displays tremendous amounts of technical information for\na given shim database including disassembling the shims patch code for x86. sdbexplorer can also create in-memory patch code and stealthily install a shim by\nmanually adding the required registry keys. This technique bypasses the sdbinst\nsafe guard of creating an entry in the Add/Remove Programs list.\n[Link: https://github.com/evil-e/sdb-explorer](https://github.com/evil-e/sdb-explorer)\n\n  - _sdb2xml.exe: - Created by Heath Stewart of Microsoft in November 2007 extracts_\nsome data as XML from a shim database. (Stewart, 2007)\n[Link: http://blogs.msdn.com/b/heaths/archive/2007/11/02/sdb2xml.aspx](http://blogs.msdn.com/b/heaths/archive/2007/11/02/sdb2xml.aspx)\n\nPage | 14\n\n\n-----\n\n  - _shims.exe: - The only non-free application on this list. Created by David Tomczak in_\nMarch 2015, this tool similarly displays information about shim database files, shim\nstatistics, and patch information in a much prettier format than the other tools, but\ndoes not automatically disassemble the patched bytes.\n[Link: https://tzworks.net/prototype_page.php?proto_id=33](https://tzworks.net/prototype_page.php?proto_id=33)\n\n  - _python-sdb: - A python sdb file parser. Created by William Ballenthin in July 2015,_\nthis tool similarly displays information about shim database files.\n[Link: https://github.com/williballenthin/python-sdb](https://github.com/williballenthin/python-sdb)\n\n### Defense Tools\n\nTargeted persistence is currently not detected as a form of persistence by any analysis\ntools (notably SysInternals’ autoruns). As a result, the code that is being released attempts\nto uninstall malicious shims whenever they are detected. Some tools even have built-in\nshim-defenses as proof of concept code for developers. The following are several examples\nof these tools:\n\n_Shim-Process-Scanner: This scanner checks the memory of every running process for_\nApplication Compatibility Flags. Features:\n\n  - Will search other processes for shim flags\n\n  - WMI event trigger on install registries\n\n_Shim-Detector-Lite: Shims have total control of file redirection and Registry re-mapping for_\nthe target executable so this tool checks in-memory data structures for undocumented\nApplication Compatibility Flags. Features:\n\n  - Will detect and alert on installation of a custom shim database (sdb)\n\n_Shim-Guard-Service: This tools starts as a service when Windows starts up and monitors_\nthe registry for any shim installations, then promptly uninstalls them. Features:\n\n  - Runs as a service\n\n  - Detects and alerts on newly installed shims\n\n  - Uninstalls detected shims\n\n_Shim-Guard-Lite_\n\n  - Flexible WMI based script\n\n  - Alerts on newly installed shims\n\n  - Uninstalls detected shims\n\n_Shim-File-Scanner_\n\n  - Scans Files/Folders for non-default shims and analyzes them\n\n  - Checks registry for installed shims\n\n  - Tests a file to see if any shim can be applied to them\n\n  - Future:\n\n`o` Shell Extension for file/folder scanner\n\nPage | 15\n\n\n-----\n\n### Forensics Tools\n\nThe tools listed below focus on a forensic perspective for which I have created two plugins\nthat will assist with both the live and dead analysis of a system afflicted by malicious shims:\n\n_shimScanner: Attempts to find evidence for active sdb files in-memory via the open source_\nmemory analysis framework Volatility. Features:\n\n  - Searches the Registry for installed sdb files\n\n  - Searches each process for shim flags\n\n  - Future:\n\n`o` Pull request for Volatility autoruns plugin\n`o` Add analyzing ability\n\n_sdbFileIngestModule: Is a File Ingest Module that detects and analyzes sdb files for the_\nopen source digital forensics tool Autopsy which is a graphical interface for the Sleuth Kit\ntools. Features:\n\n  - Searches disk image for sdb files\n\n  - Parses Registry for installed sdb files\n\n  - Uses results from sdb-explorer (windows only tool)\n\n### Penetration Testing Tools\n\nRun Self as Admin\n\n  - Builds an shim database, installs it, bypasses UAC\n\nSubversion-Shims\n\n  - Hides auto run keys from autoruns\n\n  - Hides auto run keys from regedit\n\n  - Prevents SysInternals tools from launching\n\nStealth-Shim\n\n  - Hot patching code that will conceal flags that the above tools search for\n\n  - Unload custom App Comp DLL Helper with FreeLibraryAndExitThread()\n\nPuttyRider-Shim\n\n  - Injects the putty rider DLL into Putty\n\nDuring the course of this research it became obvious that to ensure compatibility, Microsoft\nbuilt Windows to effectively lie to all non-native code. Therefore 32-bit and 64-bit versions\nare available but will only work in their native code environment. All tools have been tested\nprimarily on 64-bit Windows 7 Professional and should work on x86/x64 on Windows XP,\nVista, Win7, and Win 8 depending on certain compatibility issues (joke).\n\nPage | 16\n\n\n-----\n\n## Defenses\nAside from using the given tools above, the only other technical defense from a malicious\nshim is by disabling the Shim Engine via Group Policy. However, that is not recommended\nbecause shims are heavily integrated into Windows for normal operations; such as auto\nelevating any executable matching the filename *instal*.\n\nIn late April 2015, Microsoft released an optional update named KB3045645 for Windows 7\nand above which, according to their description will “force a UAC prompt when a\ncustomized .sdb file is created in Windows” (Microsoft Support, 2015). Contrary to the\nofficial description, this patch effectively removes the <autoElevate>true</autoElevate>\nproperty from the sdbinst.exe file and does not present a UAC prompt when a customized\nsdb files are created or applied to a process. This prevents the traditional UAC bypass\nmethod used by GootKit and other malware families. However the update is classified as\nOptional so it will not install by default and sdbinst.exe was merely the official installer for\nsdb files, so a UAC bypass is still possible by manually adding the necessary registry keys.\n\n_Figure 8. Optional Patch which will disable sdbinst.exe auto-elevation_\n\nPrior to KB3045645 malware relied on sdbinst.exe auto-elevating to install a ‘RedirectEXE’\nfix in order to bypass a UAC prompt. Barring the use of that patch, some system\nadministrators may choose to increase the UAC security setting to “Always notify” but this\nwill of course annoy users into allowing everything especially over long periods of time.\nNote: one particularly annoying part of Dridex is that the UAC prompt will appear in an\ninfinite loop until the user clicks ‘Yes’.\n\nPage | 17\n\n\n-----\n\n_Figure 9 More details see http://support.microsoft.com/en-us/kb/975787_\n\n### Moving Forward\nI would recommend that Microsoft treat sdb files as they do any other executable file and\nenable and enforce code signing. I also recommend Windows Defender and other security\nsoftware vendors to scan sdb files for suspicious attributes such as, ‘RedirectEXE’ for autoelevated apps, ‘TerminateExe’ for security apps, and ‘InjectDll’ for any app. Currently only\nthe security venders GData and Kaspersky appear to be aware of malicious shims and will\nsometimes detect sdb files that are dropped by malware or sdb files attempting a UAC\nbypass. In February 2015 a malware analyst named Takahio Haruyama created a generic\nIndicator of Compromise (IOC) for the for the Volatility plugin openioc_scan to trigger on the\nUAC bypass used by Dridex. (Haruyama, 2015)\n\nAwareness of malicious shims capabilities combined with the tools described above, are\ngood but it is expected that in the near future more sophisticated ACT enabled in-memory\npatching and malware obfuscation techniques will become more prevalent and beyond that\nI hypothesize more advanced attacks will include insertion of malicious sdb configurations\ninto the native system sdb files, and the use of wildcards in file names (but this would\nrequire much more reverse engineering). This will likewise require defenders to continue to\nadapt and innovate to better defend their environments.\n\n## Conclusion\nDefenders such as Incident Responders and Malware Analysts should be aware of how\nshim databases can be used to leverage rootkit-like functionality from the features found in\nthe Application Compatibility Toolkit. Malicious shim database files have been observed in\nthe wild with increasing frequency and complexity. Given the features and ease-of-use\nfound in the ACT, attackers will soon start utilizing the more advanced methods\ndemonstrated here, which has prompted me to create and distribute the tools necessary to\nprevent, detect, and combat this new avenue of post-exploitation.\n\nPage | 18\n\n\n-----\n\n## Bibliography\nAquilino, B. (2014, 6 30). Beware BlackEnergy If Involved In Europe/Ukraine Diplomacy. Retrieved from\n\nF-Secure: https://www.f-secure.com/weblog/archives/00002721.html\n\nAuthor. (2015, 2 8). Upatre downloader malware using AppCompat for automatic UAC elevation.\n\nRetrieved from Bleen. All the integers between 6 and 7:\nhttp://lupwa.org/bleen/2015/02/08/upatre-downloader-malware-using-appcompat-forautomatic-uac-elevation/\n\nBospoort, M. v. (2009, 7 23). Disabling a Shim. Retrieved from Maarten's blog:\n\nhttp://blogs.msdn.com/b/maartenb/archive/2009/07/24/disabling-a-shim.aspx\n\nChen, R. (2005, 8 24). Buying an entire Egghead Software store. Retrieved from The Old New Thing \nMSDN Blogs: http://blogs.msdn.com/b/oldnewthing/archive/2005/08/24/455557.aspx\n\nCherepanov, A. (2014). Roaming tiger. Zeronights 2014 (p. 20). Moscow:\n\nhttp://2014.zeronights.org/assets/files/slides/roaming_tiger_zeronights_2014.pdf.\n\nCherepanov, R. L. (2014, 1 25). Last-minute paper: Back in BlackEnergy: 2014 targeted attacks in the\n\n_Ukraine and Poland. Retrieved from Virus Bulletin:_\nhttps://www.virusbtn.com/conference/vb2014/abstracts/LM3-LipovskyCherepanov.xml\n\n_Dr. WEB. (2014, 4 9). Retrieved from BackDoor.Gootkit.112—a new multi-purpose backdoor:_\n\nhttps://news.drweb.com/show/?i=4338&lng=en\n\nDrapeau, P. (2015, 1 16). Firewall Rule Changes and Compatibility Trickery. Retrieved from Kill Chain. The\n\nConfer Blog: http://www.confer.net/kill-chain-the-confer-blog/80-firewall-rule-changes-andcompatibility-trickery\n\nErickson, J. (2014). Persist It: Using and Abusing Microsoft Fix It Patches. BlackHat Asia (p. 14).\n\nSingapore: https://www.blackhat.com/docs/asia-14/materials/Erickson/WP-Asia-14-EricksonPersist-It-Using-And-Abusing-Microsofts-Fix-It-Patches.pdf.\n\nF-Secure. (2015). BLACKENERGY & QUEDAGH. Retrieved from f-secure.com: https://www.f\nsecure.com/documents/996508/1030745/blackenergy_whitepaper.pdf\n\nGraham, C. (2014, 5 27). Shimming Your Way Past UAC. Retrieved from Digital Defense Incorporated:\n\nhttp://blog.ddifrontline.com/4#more-4\n\nHancke, P. (2009). The Windows 7 App Compat Story. Retrieved from Microsoft Tech-ed Afraca 2009:\n\nhttp://download.microsoft.com/download/6/7/3/673B71D0-6D4F-4591-9940D33DF9135487/WCL304_Win7_app_compat_story_Hancke.pptx\n\nHaruyama, T. (2015, 2 26). Github. Retrieved from TakahiroHaruyama / openioc_scan:\n\nhttps://github.com/TakahiroHaruyama/openioc_scan/blob/master/IOCs/generic/cdcd5fdbfcd3-4947-8c76-d2fbdc1b5f82_UAC_COM.ioc\n\nhFireF0X. (2015, 1 9). FireF0X. Retrieved from Twitter:\n\nhttps://twitter.com/hfiref0x/status/553777371682443264\n\nPage | 19\n\n\n-----\n\nInocencio, R. (2014, 11 5). Banking Trojan DRIDEX Uses Macros for Infection. Retrieved from Security\n\nIntelligence Blog: http://blog.trendmicro.com/trendlabs-security-intelligence/banking-trojandridex-uses-macros-for-infection/\n\nMicrosoft. (2009, 10 29). Deploy an Application Compatibility Database by Using SDBInst. Retrieved from\n\nTechNet: https://technet.microsoft.com/en-us/library/ee732408(v=WS.10).aspx\n\n_Microsoft Support . (2015, 4 29). Retrieved from Update to force a UAC prompt when a customized .sdb_\n\nfile is created in Windows: https://support.microsoft.com/en-us/kb/3045645\n\nmsft-mmpc. (2013, 10 31). Upatre: Emerging Up(d)at(er) in the wild. Retrieved from Microsoft Malware\n\nProtect Center: http://blogs.technet.com/b/mmpc/archive/2013/10/31/upatre-emerging-up-dat-er-in-the-wild.aspx\n\nOllie. (2012, 4 28). Windows AppCompat Research Notes - Part 1. Retrieved from Research, Develop,\n\nAssess, Consult & Educate: http://recxltd.blogspot.co.uk/2012/04/windows-appcompatresearch-notes-part-1.html\n\nPernet, C. (2015, 3 30). Fake Judicial Spam Leads to Backdoor with Fake Certificate Authority. Retrieved\n\nfrom TrendLabs Security Intelligence Blog: http://blog.trendmicro.com/trendlabs-securityintelligence/fake-judicial-spam-leads-to-backdoor-with-fake-certificate-authority/\n\nSS_TSS@mail.ru. (2012, May). Journal of Computer Hooligans. Retrieved from\n\nftp://os2.fannet.ru/fileechoes/programming/XA_159.PDF\n\nStewart, H. (2007, 11 3). Shim Database to XML. Retrieved from Setup & Install by Heath Stewart:\n\nhttp://blogs.msdn.com/b/heaths/archive/2007/11/02/sdb2xml.aspx\n\n_Baggett, M. (2013, February 23). 2013 Posts and Publications. Retrieved October 23, 2013, from In_\n\n_Depth Defense: http://www.indepthdefense.com/2013/02/2013-posts-and-publications.html_\n\n_Ionescu, A. (2007, May 20). Secrets of the Application Compatilibity Database (SDB) – Part 1. Retrieved_\n\n_April 15, 2015, from Alex Ionescu's Blog: http://www.alex-ionescu.com/?p=39_\n\n_Ionescu, A. (2007, May 21). Secrets of the Application Compatilibity Database (SDB) – Part 2. Retrieved_\n\n_April 15, 2015, from Alex Ionescu's Blog: http://www.alex-ionescu.com/?p=40_\n\n_Ionescu, A. (2007, May 26). Secrets of the Application Compatilibity Database (SDB) – Part 3. Retrieved_\n\n_April 15, 2015, from Alex Ionescu’s Blog: http://www.alex-ionescu.com/?p=41_\n\n_Mark Russinovich, B. C. (2013, August 1). Autoruns for Windows v11.70. Retrieved September 5, 2013,_\n\n_from Windows Sysinternals: http://technet.microsoft.com/en-us/sysinternals/bb963902.aspx_\n\n_Microsoft. (2013, September 6). !chkimg. Retrieved October 2, 2013, from Dev Center:_\n\n_http://msdn.microsoft.com/en-us/library/windows/hardware/ff562217%28v=vs.85%29.aspx_\n\n_Microsoft. (2013, October 1). Application Compatibility Database. Retrieved October 23, 2013, from_\n\n_Microsoft Developer Network:http://msdn.microsoft.com/library/bb432182.aspx_\n\n_Microsoft. (2013). Fix it Solution Center. Retrieved 2013 24-October from Microsoft Support:_\n\n_http://support.microsoft.com/fixit/_\n\nPage | 20\n\n\n-----\n\n_Microsoft. (2012, October 1). Microsoft Security Advisory: Vulnerability in Microsoft XML Core Services_\n\n_could allow remote code execution. Retrieved September 5, 2013, from Microsoft Support:_\n_http://support.microsoft.com/kb/2719615_\n\n_Microsoft. (2012, December 7). Shim Database Types. Retrieved September 5, 2013, from Microsoft_\n\n_Developer Network: http://msdn.microsoft.com/en-us/library/bb432483%28v=vs.85%29.aspx_\n\n_Sikka, N. (2013, September 17). CVE-2013-3893: Fix it workaround available. Retrieved October 02,_\n\n_2013, from Security Research & Defense:_\n\n_http://blogs.technet.com/b/srd/archive/2013/09/17/cve-2013-3893-fix-it-workaround-available.aspx_\n\n_Stewart, H. (2007, November 3). Shim Database to XML. Retrieved September 5, 2013, from Setup &_\n\n_Install by Heath Stewart: http://blogs.msdn.com/b/heaths/archive/2007/11/02/sdb2xml.aspx_\n\nPage | 21\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://www.blackhat.com/docs/eu-15/materials/eu-15-Pierce-Defending-Against-Malicious-Application-Compatibility-Shims-wp.pdf"
    ],
    "report_names": [
        "eu-15-Pierce-Defending-Against-Malicious-Application-Compatibility-Shims-wp.pdf"
    ],
    "threat_actors": [
        {
            "id": "5afe7b81-e99a-4c24-8fcc-250fb0cf40a3",
            "created_at": "2023-01-06T13:46:38.324616Z",
            "updated_at": "2025-03-27T02:00:02.805194Z",
            "deleted_at": null,
            "main_name": "Roaming Tiger",
            "aliases": [
                "BRONZE WOODLAND",
                "Rotten Tomato"
            ],
            "source_name": "MISPGALAXY:Roaming Tiger",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "2864e40a-f233-4618-ac61-b03760a41cbb",
            "created_at": "2023-12-01T02:02:34.272108Z",
            "updated_at": "2025-03-27T02:02:10.209072Z",
            "deleted_at": null,
            "main_name": "WildCard",
            "aliases": [],
            "source_name": "ETDA:WildCard",
            "tools": [
                "RustDown",
                "SysJoker"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "866c0c21-8de3-4ad5-9887-cecd44feb788",
            "created_at": "2022-10-25T16:07:24.130298Z",
            "updated_at": "2025-03-27T02:02:10.117603Z",
            "deleted_at": null,
            "main_name": "Roaming Tiger",
            "aliases": [
                "Bronze Woodland",
                "CTG-7273",
                "Rotten Tomato"
            ],
            "source_name": "ETDA:Roaming Tiger",
            "tools": [
                "Agent.dhwf",
                "AngryRebel",
                "BBSRAT",
                "Destroy RAT",
                "DestroyRAT",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "Kaba",
                "Korplug",
                "Moudour",
                "Mydoor",
                "PCRat",
                "PlugX",
                "RedDelta",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Xamtrav"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9bf42584-ca17-47de-a902-3dd63d90b2f8",
            "created_at": "2024-05-01T02:03:08.005172Z",
            "updated_at": "2025-03-27T02:05:17.300423Z",
            "deleted_at": null,
            "main_name": "BRONZE WOODLAND",
            "aliases": [
                "Roaming Tiger ",
                "Rotten Tomato ",
                "CTG-7273 "
            ],
            "source_name": "Secureworks:BRONZE WOODLAND",
            "tools": [
                " PlugX",
                " Zbot",
                "Appat"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "256a6a2d-e8a2-4497-b399-628a7fad4b3e",
            "created_at": "2023-11-30T02:00:07.299845Z",
            "updated_at": "2025-03-27T02:00:03.257794Z",
            "deleted_at": null,
            "main_name": "WildCard",
            "aliases": [],
            "source_name": "MISPGALAXY:WildCard",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "7bd810cb-d674-4763-86eb-2cc182d24ea0",
            "created_at": "2022-10-25T16:07:24.1537Z",
            "updated_at": "2025-03-27T02:02:10.126127Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "APT 44",
                "ATK 14",
                "BE2",
                "Blue Echidna",
                "CTG-7263",
                "FROZENBARENTS",
                "IRIDIUM",
                "Iron Viking",
                "Quedagh",
                "Sandworm",
                "Sandworm Team",
                "Seashell Blizzard",
                "TEMP.Noble",
                "UAC-0082",
                "UAC-0113",
                "UAC-0125",
                "UAC-0133",
                "Voodoo Bear"
            ],
            "source_name": "ETDA:Sandworm Team",
            "tools": [
                "AWFULSHRED",
                "ArguePatch",
                "BIASBOAT",
                "Black Energy",
                "BlackEnergy",
                "CaddyWiper",
                "Colibri Loader",
                "Cyclops Blink",
                "CyclopsBlink",
                "DCRat",
                "DarkCrystal RAT",
                "Fobushell",
                "GOSSIPFLOW",
                "Gcat",
                "IcyWell",
                "Industroyer2",
                "JaguarBlade",
                "JuicyPotato",
                "Kapeka",
                "KillDisk.NCX",
                "LOADGRIP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "ORCSHRED",
                "P.A.S.",
                "PassKillDisk",
                "Pitvotnacci",
                "PsList",
                "QUEUESEED",
                "RansomBoggs",
                "RottenPotato",
                "SOLOSHRED",
                "SwiftSlicer",
                "VPNFilter",
                "Warzone",
                "Warzone RAT",
                "Weevly"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716492,
    "ts_updated_at": 1743041825,
    "ts_creation_date": 1446593904,
    "ts_modification_date": 1446593904,
    "files": {
        "pdf": "https://archive.orkl.eu/81e52f31beb2457b5d84afb6886b6aa3ea43d6b2.pdf",
        "text": "https://archive.orkl.eu/81e52f31beb2457b5d84afb6886b6aa3ea43d6b2.txt",
        "img": "https://archive.orkl.eu/81e52f31beb2457b5d84afb6886b6aa3ea43d6b2.jpg"
    }
}