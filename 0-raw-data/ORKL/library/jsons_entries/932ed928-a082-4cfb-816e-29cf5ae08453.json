{
    "id": "932ed928-a082-4cfb-816e-29cf5ae08453",
    "created_at": "2023-01-12T15:02:06.759099Z",
    "updated_at": "2025-03-27T02:05:59.069464Z",
    "deleted_at": null,
    "sha1_hash": "23b508a1b501e37a6478031e4d9c9f09e4013628",
    "title": "2020-08-31 - In the wild QNAP NAS attacks",
    "authors": "",
    "file_creation_date": "2022-05-28T15:24:35Z",
    "file_modification_date": "2022-05-28T15:24:35Z",
    "file_size": 103989,
    "plain_text": "# In the wild QNAP NAS attacks\n\n**blog.netlab.360.com/in-the-wild-qnap-nas-attacks-en/**\n\nGenshen Ye August 31, 2020\n\n### 31 August 2020 / QNAP Author:Yanlong Ma, Genshen Ye, Ye Jin\n\n From April 21, 2020, 360Netlab Anglerfish honeypot started to see a new QNAP NAS vulnerability being used to launch attack against QNAP NAS equipment. We noticed that this vulnerability has not been announced on the Internet, and the attacker is cautious in the process of exploiting it.\n\n## Vulnerability analysis\n\n### Vulnerability type: Unauthorized remote command execution vulnerability\n\n When we enter the sample into the 360 FirmwareTotal system, we found that this vulnerability appeared in the CGI program /httpd/cgi-bin/authLogout.cgi . This CGI is used when user logout, and it select the corresponding logout function based on the field name in the Cookie. The problem is QPS_SID, QMS_SID and QMMS_SID does not filter special characters and directly calls the snprintf function to splice curl command string and calls the system function to run the string, thus making command injection possible.\n\n Vulnerability fix: We contacted the vendor and shared the PoC on May/13, and on Aug 12, QNAP PSIRT replied and indicated the vulnerability had been fixed in previous update but there still are devices on the network that have not been patched. We looked into the vendorsâ€™ firmwares and discovered that on July 21, 2017, QNAP released firmware version 4.3.3 and this version included the fix for this vulnerability. This release replaced the\n```\nsystem function with qnap_exec, and the qnap_exec function is defined in the\n/usr/lib/libuLinux_Util.so.0 . By using the execv to execute custom command,\n\n command injection has been avoided.\n\n## Attacker behavior analysis\n\n### We captured two attackers IP 219.85.109.140 and 103.209.253.252, both use the same Payload, after successful exploits, the device will wget\nhttp://165.227.39.105:8096/aaa file.\n\n```\n\n-----\n\n### So far the attacker has not implanted bot programs like regular Botnets, and the entire attack process does not seem to be fully automated. we still do not know the true purpose of the attacker yet.\n\n On 165.227.39.105:8096, we found two other text .sl and rv . The .sl file contains 2 lines.\n```\nIvHVFqkpELqvuN@WK\nIvHVFqkpJEqr|DNWLr\nrv, this file is a bash reverse shell script, the control address is 165.227.39.105, and the\n\n port is TCP/1234 .\n\n When we fingerprint this host, we see that 165.227.39.105 has SSH, Metasploit, Apache httpd and other services running.\nDiscovered open port 9393/tcp on 165.227.39.105 //SSH\nDiscovered open port 5678/tcp on 165.227.39.105 //Unknown\nDiscovered open port 3790/tcp on 165.227.39.105 //Metasploit\nDiscovered open port 80/tcp on 165.227.39.105  //Apache httpd\n\n## Timeline\nOn May 13, 2020, we emailed the QNAP vendor and reported the details of the\nvulnerability and shared the PoC.\nOn August 12, 2020, QNAP PSIRT replied that the vulnerability had been fixed in early\nupdates, but such attacks still exist in the network.\n\n List of known affected firmware\n\n```\n\n-----\n\n```\nHS 210_20160304 4.2.0\nHS-251_20160304-4.2.0\nSS-439_20160304-4.2.0\nSS-2479U_20160130-4.2.0\nTS-119_20160304-4.2.0\nTS-210_20160304-4.2.0\nTS-219_20160304-4.2.0\nTS-221_20160304-4.2.0\nTS-239H_20160304-4.2.0\nTS-239PROII_20160304-4.2.0\nTS-239_20160304-4.2.0\nTS-269_20160304-4.2.0\nTS-410U_20160304-4.2.0\nTS-410_20160304-4.2.0\nTS-412U_20160304-4.2.0\nTS-419P_20160304-4.2.0\nTS-419U_20160304-4.2.0\nTS-420U_20160304-4.2.0\nTS-421U_20160304-4.2.0\nTS-439PROII_20160119-4.2.0\nTS-439PROII_20160304-4.2.0\nTS-439_20160304-4.2.0\nTS-459U_20160119-4.2.0\nTS-459U_20160304-4.2.0\nTS-459_20160304-4.2.0\nTS-469U_20160304-4.2.0\nTS-509_20160304-4.2.0\nTS-559_20160304-4.2.0\nTS-563_20160130-4.2.0\nTS-659_20140927-4.1.1\nTS-659_20160304-4.2.0\nTS-669_20160304-4.2.0\nTS-809_20160304-4.2.0\nTS-859U_20160304-4.2.0\nTS-869_20160304-4.2.0\nTS-870U_20160119-4.2.0\nTS-870U_20160304-4.2.0\nTS-870_20160130-4.2.0\nTS-879_20160130-4.2.0\nTS-1079_20160119-4.2.0\nTS-1269U_20160304-4.2.0\nTS-1270U_20160304-4.2.0\nTS-1679U_20160304-4.2.0\nTS-X51U_20160304-4.2.0\nTS-X51_20160304-4.2.0\nTS-X53U_20160304-4.2.0\nTS-X53U_20161028-4.2.2\nTS-X53U_20161102-4.2.2\nTS-X53U_20161214-4.2.2\nTS-X53U_20170313-4.2.4\nTS-X53_20160304-4.2.0\nTS-X63U_20161102-4.2.2\nTS-X63U_20170313-4.2.4\nTS-X80U_20160304-4.2.0\nTS-X80_20160130-4.2.0\n\n```\n\n-----\n\n```\nTS X80_20160304 4.2.0\nTS-X80_20161102-4.2.2\nTS-X82_20161208-4.2.2\nTS-X82_20170313-4.2.4\nTVS-X63_20160130-4.2.0\nTVS-X63_20160304-4.2.0\nTVS-X63_20160823-4.2.2\nTVS-X63_20160901-4.2.2\nTVS-X63_20161028-4.2.2\nTVS-X63_20161102-4.2.2\nTVS-X63_20170121-4.2.3\nTVS-X63_20170213-4.2.3\nTVS-X63_20170313-4.2.4\nTVS-X71U_20161208-4.2.2\nTVS-X71_20160130-4.2.0\nTVS-X71_20160304-4.2.0\nTVS-X71_20161214-4.2.2\nTVS-X71_20170313-4.2.4\n\n## Suggestions\n\n### We recommend that QNAP NAS users check and update their firmwares in a timely manner and also check for abnormal processes and network connections.\n\n We recommend the following IoCs to be monitored and blocked on the networks where it is applicable.\n\n## Contact us\n\n### Readers are always welcomed to reach us on twitter, or emial to netlab at 360 dot cn.\n\n## IoC\n\n### Scanner IP\n219.85.109.140    Taiwan        ASN18182       Sony Network\nTaiwan Limited\n103.209.253.252    United States     ASN33438       Highwinds\nNetwork Group, Inc.\n\n Downloader IP\n165.227.39.105    Canada        ASN14061       DigitalOcean,\nLLC\n\n URL\nhttp://165.227.39.105:8096/.sl\nhttp://165.227.39.105:8096/rv\nhttp://165.227.39.105:8096/aaa\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-31 - In the wild QNAP NAS attacks.pdf"
    ],
    "report_names": [
        "2020-08-31 - In the wild QNAP NAS attacks.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535726,
    "ts_updated_at": 1743041159,
    "ts_creation_date": 1653751475,
    "ts_modification_date": 1653751475,
    "files": {
        "pdf": "https://archive.orkl.eu/23b508a1b501e37a6478031e4d9c9f09e4013628.pdf",
        "text": "https://archive.orkl.eu/23b508a1b501e37a6478031e4d9c9f09e4013628.txt",
        "img": "https://archive.orkl.eu/23b508a1b501e37a6478031e4d9c9f09e4013628.jpg"
    }
}