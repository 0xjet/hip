{
    "id": "f655bfae-c34b-4cdc-88bb-e283f8ab0a60",
    "created_at": "2023-01-12T15:00:26.608506Z",
    "updated_at": "2025-03-27T02:10:19.868847Z",
    "deleted_at": null,
    "sha1_hash": "ee88fa0b47089f39d85550666ef3360f666d50d2",
    "title": "2022-06-03 - Attack Graph Response to US CERT AA22-152A- Karakurt Data Extortion Group",
    "authors": "",
    "file_creation_date": "2022-07-02T23:12:27Z",
    "file_modification_date": "2022-07-02T23:12:27Z",
    "file_size": 1084505,
    "plain_text": "# Attack Graph Response to US CERT AA22-152A: Karakurt Data Extortion Group\n\n**[attackiq.com/2022/06/03/attack-graph-response-to-us-cert-aa22-152a-karakurt-data-extortion-group/](https://attackiq.com/2022/06/03/attack-graph-response-to-us-cert-aa22-152a-karakurt-data-extortion-group/)**\n\nJune 3, 2022\n\n[Earlier this week we published a blog post on the release of a new AttackIQ assessment](https://attackiq.com/2022/06/02/response-to-us-cert-alert-aa22-152a-karakurt-data-extortion-group/)\naddressing the ingress of tools and malware associated with the Karakurt Data Extortion\nGroup [recently highlighted by US-CERT Alert AA22-152A. Today we are following up with](https://www.cisa.gov/uscert/ncas/alerts/aa22-152a)\nthe release of an in-depth attack graph that fully emulates their tactics, techniques, and\nprocedures.\n\nKarakurt is a financially motivated adversary focused on data extortion that have already\naffected more than 40 organizations across multiple industries and regions. Based on\navailable intelligence, we have observed that the adversary is primarily focused on data theft\nfor subsequent extortion, and not on traditional ransomware encryption or destructive\nattacks.\n\nValidating your security program performance against this type of attack is paramount in\nreducing risk. By using this new attack graph in the AttackIQ Security Optimization Platform,\nsecurity teams will be able to:\n\n\n-----\n\n1. Evaluate security control performance against common persistence, discovery, and\n\ndata exfiltration techniques.\n2. Assess security posture for the techniques used by an actor focused on data theft and\n\nthe extortion of victims with threats to publicly release data.\n3. Continuously validate detection and prevention pipelines against actor activity that may\n\nhave variable initial access methods but a common hands-on keyboard approach.\n\n**Attack Graph Emulation of Karakurt Techniques**\n\nThe Karakurt threat actors are cybercriminals who typically gain access to victim networks\nfrom various initial access brokers using stolen credentials or through the exploitation of\ncommon vulnerabilities like Log4Shell or Zerologon. Our attack graph emulation starts after\nthat initial access has already been achieved.\n\nOnce inside their target of opportunity, they focus on establishing persistence via Cobalt\nStrike and establishing a network connection with their command and control infrastructure.\n\n**[Ingress Tool Transfer (T1105): Download and save samples of the actor’s phishing](https://attack.mitre.org/techniques/T1105/)**\ndocuments and Cobalt Strike malware.\n\n**[Application Layer Protocol (T1071) and Fallback Channels (T1008): Emulate command](https://attack.mitre.org/techniques/T1071/)**\nand control connectivity with failover options for HTTPS, HTTP, and DNS protocols.\n\n**[Windows Service (T1543.003), Registry Run Keys (T1547.001), and Windows](https://attack.mitre.org/techniques/T1543/003/)**\n**[Management Instrumentation (T1047): Cobalt Strike has a plethora of persistence options;](https://attack.mitre.org/techniques/T1047/)**\nour attack graph will try a subset of these methods to find a successful foothold.\n\nNow that persistence has been established, Karakurt focuses on gathering additional\ncredentials that can be leveraged to move laterally to other systems or access remote\nexternal servers.\n\n\n-----\n\n**[Account Discovery (T1087): Use living off the land commands like net user to obtain a list](https://attack.mitre.org/techniques/T1087/)**\nof additional accounts known to the infected host.\n\n**[OS Credential Dumping (T1003): Karakurt has been observed using Mimikatz to dump](https://attack.mitre.org/techniques/T1003/)**\npasswords and hashes for Windows accounts.\n\nArmed with their new credentials the actor is going to start the discovery phase of their attack\nto find connectable hosts, files and folders of interest, which will guide their lateral movement\nusing native operating system functionality like Remote Desktop.\n\n**[System Network Connections Discovery (T1049): Continue to leverage living off the land](https://attack.mitre.org/techniques/T1049/)**\ncommands like “netstat” and “net use” to find other systems remotely connected to the initial\nfoothold host.\n\n**[File and Directory Discovery (T1083): Karakurt will be looking at the local host and remote](https://attack.mitre.org/techniques/T1083/)**\nshares to find sensitive files that can be stolen and held as ransom. Generating file and\ndirectory lists to identify data files to speed up their assessment.\n\n**[Remote Desktop Protocol (T1021.001): Combining the dumped credentials and the](https://attack.mitre.org/techniques/T1021/001/)**\ndiscovered remote hosts, the actor will attempt to move laterally to another host and repeat\ntheir discovery process until they have collected enough data to exfiltrate.\n\nOnce their discovery and lateral movement actions are completed, it’s time for Karakurt to\nbegin staging the stolen data and exfiltrate it to actor owned external resources. They will\nattempt to use cloud providers or SFTP for bulk exfiltration. If all else fails, they can fall back\nto Cobalt Strike for data exfiltration over HTTP.\n\n**[Local Data Staging (T1074.001): This actor prefers to conduct bulk exfiltration operations,](https://attack.mitre.org/techniques/T1074/001/)**\nso collecting and staging data in a single place assists with this method.\n\n**[Exfiltration to Cloud Storage (T1567.002): Karakurt has been observed downloading and](https://attack.mitre.org/techniques/T1567/002/)**\n[using command-line tool Rclone](https://rclone.org/) [to exfiltrate files to ‘Mega io’ or other cloud providers](https://www.accenture.com/us-en/blogs/cyber-defense/karakurt-threat-mitigation)\n\n\n-----\n\n**[Exfiltration Over Asymmetric Encrypted Non-C2 Protocol (T1048.002): Additionally, the](https://attack.mitre.org/techniques/T1048/002/)**\nactor has been observed bringing FileZilla into the environment to exfiltrate data over SFTP.\n\n**[Exfiltration Over C2 Channel (T1041) and Exfiltration Over Unencrypted Non-C2](https://attack.mitre.org/techniques/T1041/)**\n**[Protocol (T1048.003): If the bulk exfiltration attempts are thwarted, the actors have the](https://attack.mitre.org/techniques/T1048/003/)**\noption of using their Cobalt Strike backdoor to exfiltrate over an HTTP connection.\n\n**Opportunities for Extending the Attack Graph**\n\nIn addition to what’s already covered in the attack graph, there are two additional techniques\nemployed by this threat actor that are also part of the AttackIQ platform. Security teams can\neasily extend this Attack Graph with a simple clone operation followed by the addition of\nthese scenarios, or they can create new assessments if their environments meet the\nscenario requirements:\n\n[1. Dump Active Directory Databases (T1003.003): One high value objective for cyber](https://attack.mitre.org/techniques/T1003/003/)\n\nthreat actors is to obtain a copy of the Active Directory database so that it may be\nattacked offline. Karakurt has been observed dumping the NTDS.dit database from a\ndomain controller once administrative access has been achieved. This scenario must\nbe executed on a domain controller asset.\n2. Exfiltrate Files over SFTP (T1048.002): Attackers, including Karakurt, commonly use\n\ncovert data exfiltration methods to avoid detection. Adding this SFTP exfiltration\nscenario is recommended to assist in detection and prevention of this technique. This\nscenario requires an accessible server that supports Secure Shell and the valid\ncredentials to access the remote resource.\n\n**Detection and Mitigation Opportunities**\n\nWith so many different techniques being utilized by threat actors, it can be difficult to know\nwhich to prioritize for prevention and detection opportunities. AttackIQ recommends first\nfocusing on the following techniques emulated in our scenarios before moving on to the\nremaining techniques.\n\n**[1. Ingress Tool Transfer (T1105)](https://attack.mitre.org/techniques/T1105/)**\n\nStopping or identifying when the threat actor is bringing down their toolset after the initial\ncompromise will help prevent follow-up actions those tools facilitate. Once a malicious actor\nhas compromised an endpoint, they may attempt to transfer tools or malware onto the device\nusing applications like PowerShell, certutil, Bitsadmin, and Curl.\n\n**_1a. Detection Process_**\n\nThe following Sigma rules can help identify when suspicious file downloads are being\nconducted:\n\n\n-----\n\n**PowerShell Example:**\n```\nProcess Name == (Cmd.exe OR Powershell.exe)\n\nCommand Line CONTAINS ((“IWR” OR “Invoke-WebRequest\") AND “DownloadData” AND\n“Hidden”)\n\n```\n**certutil Example:**\n```\nProcess Name == Certutil.exe\n\nCommand Line Contains (“-urlcache” AND “-f” AND “http”)\n\n```\n**Bitsadmin Example:**\n```\nProcess Name == Bitsadmin.exe\n\nCommand Line CONTAINS (“/transfer” AND “http”)\n\n```\n**Curl Example:**\n```\nProcess Name == Curl.exe\n\nCommand Line CONTAINS (“http” AND “-o”)\n\n```\n**_1b. Mitigation Policies_**\n\nMITRE recommends the following mitigations:\n\n[M1031](https://attack.mitre.org/mitigations/M1031/)\n\n**[2. Windows Service (T1543.003), Registry Run Keys (T1547.001), and Windows](https://attack.mitre.org/techniques/T1543/003/)**\n**[Management Instrumentation (T1047):](https://attack.mitre.org/techniques/T1047/)**\n\nPersistence is a key inflection point in an actor’s attack lifecycle. Concerned about their\npotential loss of access, they are going to take steps to ensure they will remain on the\ninfected host after reboots or partial remediation efforts. Disrupting their ability to maintain\ntheir foothold will help prevent their immediate return.\n\n**_2a. Detection Process_**\n\nThe following rules can help identify when those persistence mechanisms are being set.\n```\nService Creation:\nProcess Name == (Cmd.exe OR Powershell.exe)\n\nCommand Line CONTAINS (‘sc’ AND ‘create’ AND ‘start= “auto”’)\nRegistry Run Keys:\nProcess Name == powershell.exe\n\nCommand Line CONTAINS (\"Set-ItemProperty\" AND (“HKLM” OR “HKCU”) AND\n“Software\\Microsoft\\Windows\\CurrentVersion” AND (“run” OR “runonce”))\n\nProcess Name == (“cmd.exe” OR “powershell.exe”)\n\nCommand Line CONTAINS “reg.exe” AND \"add\" AND (“HKLM” OR “HKCU”) AND\n“Software\\Microsoft\\Windows\\CurrentVersion” AND (“run” OR “runonce”))\n\n```\n\n-----\n\n**Windows Management Instrumentation:**\n```\nSource == \"WinEventLog:Microsoft-Windows-WMI-Activity/Operational\" \n\nEventCode == (“5859” OR (\"5861\" AND (\"ActiveScriptEventConsumer\" OR\n\"CommandLineEventConsumer\" OR \"CommandLineTemplate\"))\n\nProvider != \"SCM Event Provider\" \n\nQuery != \"select * from MSFT_SCMEventLogEvent\"\n\nUser != \"S-1-5-32-544\"\n\nPossibleCause != \"Permanent”\n\n```\n**_2b. Mitigation Policies_**\n\nEnsure that Group Policy enforces only authorized users or administrators are able to use\ntools such as cmd.exe, powershell.exe, sc.exe and reg.exe. Limiting these administrative\ntools to only authorized personnel will greatly limit the chance of these attacks being carried\nout on lower privileged users.\n\n[MITRE recommends the following mitigations for T1543.003:](https://attack.mitre.org/techniques/T1543/003/)\n\n[3. OS Credential Dumping (T1003)](https://attack.mitre.org/techniques/T1003/)\n\nActors like Karakurt will almost always require additional usernames and passwords beyond\nthose they started with in order to move laterally to other hosts and to find additional\nsensitive data. Mimikatz is an open-source tool with regular version updates that evade\nmany antivirus solutions. Focusing on the command line arguments and subsequent\nbehavior is a solid foundation to limit the actor’s ability to spread.\n\n**_3a. Detection Process_**\n```\nProcess Name == powershell.exe\n\nCommand Line CONTAINS ((“DownloadString” OR “DownloadFile”) AND “http” AND “.ps1” AND\n(“IEX” OR “Invoke-Expression”) AND “Invoke-Mimikatz”)\n\n```\n**_3b. Mitigation Policies_**\n\n[MITRE recommends the following mitigations for T1003:](https://attack.mitre.org/techniques/T1003/)\n\n**[4. Exfiltration Over Unencrypted Non-C2 Protocol (T1048.003)](https://attack.mitre.org/techniques/T1048/003/)**\n\nThe last possible prevention opportunity for this intrusion is when they attempt to exfiltrate\ncollected victim data. Preventing an actor from establishing those connections to untrusted\nsites or identifying when legitimate services are being abused is crucial to stopping a data\nbreach. A determined actor like Karakurt is not going to give up when one avenue fails; they\nwill be persistent and leverage their exfil fallback options. Therefore it is key to be aggressive\nin responding when these alerts are triggered.\n\n**_4a. Detection Process_**\n\n\n-----\n\nDetecting exfiltration is well suited for IDS/IPS and DLP solutions. These products should be\nconfigured to identify sensitive files. If sensitive files, or a large amount of web traffic is sent\nto a rare external IP, it should be detected or prevented depending on security policies for the\nsecurity control. Historical NetFlow data logging can also bubble up hosts that are\nexperience uncommon peaks in outgoing traffic.\n\n**_4b. Mitigation Policies_**\n\n[MITRE recommends the following mitigations for T1048.003:](https://attack.mitre.org/techniques/T1048/003/)\n\n[M1057](https://attack.mitre.org/mitigations/M1057/)\n[M1037](https://attack.mitre.org/mitigations/M1037/)\n[M1031](https://attack.mitre.org/mitigations/M1031/)\n[M1030](https://attack.mitre.org/mitigations/M1030/)\n\n**Conclusion**\n\nIn summary, this attack graph will evaluate security and incident response processes and\nsupport the improvement of your security control posture against an actor with focused\noperations to find and exfiltrate sensitive data. With data generated from continuous testing\nand use of this attack graph, you can focus your teams on achieving key security outcomes,\nadjust your security controls, and work to elevate your total security program effectiveness\nagainst a known and dangerous threat.\n\nAttackIQ stands at the ready to help security teams implement this attack graph and other\naspects of the AttackIQ Security Optimization Platform, including through our co-managed\n[security service, AttackIQ Vanguard.](https://attackiq.com/platform/attackiq-vanguard/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-06-03 - Attack Graph Response to US CERT AA22-152A- Karakurt Data Extortion Group.pdf"
    ],
    "report_names": [
        "2022-06-03 - Attack Graph Response to US CERT AA22-152A- Karakurt Data Extortion Group.pdf"
    ],
    "threat_actors": [
        {
            "id": "6ad410c7-e291-4327-a54b-281c23f0d4fa",
            "created_at": "2022-10-25T16:07:24.501468Z",
            "updated_at": "2025-03-27T02:02:10.26052Z",
            "deleted_at": null,
            "main_name": "Karakurt",
            "aliases": [],
            "source_name": "ETDA:Karakurt",
            "tools": [
                "7-Zip",
                "Agentemis",
                "AnyDesk",
                "Cobalt Strike",
                "CobaltStrike",
                "FileZilla",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "WinZip",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "2af9bea3-b43e-4a6d-8dc6-46dad6e3ff24",
            "created_at": "2022-10-25T16:47:55.853415Z",
            "updated_at": "2025-03-27T02:05:17.401138Z",
            "deleted_at": null,
            "main_name": "GOLD TOMAHAWK",
            "aliases": [
                "Karakurt Lair",
                "Karakurt Team",
                "Karakurt"
            ],
            "source_name": "Secureworks:GOLD TOMAHAWK",
            "tools": [
                " AnyDesk",
                " MEGA",
                " QuickPacket",
                " Rclone",
                " SendGB",
                "7-ZIP"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "079e3d6e-24ef-42b0-b555-75c288f9efd8",
            "created_at": "2023-03-04T02:01:54.105946Z",
            "updated_at": "2025-03-27T02:00:03.122936Z",
            "deleted_at": null,
            "main_name": "Karakurt",
            "aliases": [
                "Karakurt Lair"
            ],
            "source_name": "MISPGALAXY:Karakurt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535626,
    "ts_updated_at": 1743041419,
    "ts_creation_date": 1656803547,
    "ts_modification_date": 1656803547,
    "files": {
        "pdf": "https://archive.orkl.eu/ee88fa0b47089f39d85550666ef3360f666d50d2.pdf",
        "text": "https://archive.orkl.eu/ee88fa0b47089f39d85550666ef3360f666d50d2.txt",
        "img": "https://archive.orkl.eu/ee88fa0b47089f39d85550666ef3360f666d50d2.jpg"
    }
}