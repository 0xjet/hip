{
    "id": "7c81639c-eb3e-4f7e-abdf-d034209774dc",
    "created_at": "2023-01-12T15:00:01.217331Z",
    "updated_at": "2025-03-27T02:14:34.120889Z",
    "deleted_at": null,
    "sha1_hash": "a9eb4f426c1444a754c0bbb2cd4218ff3f4f4496",
    "title": "2021-11-02 - New Malware “Gameloader” in Discord Malspam Campaign Identified by GoSecure Titan Labs",
    "authors": "",
    "file_creation_date": "2022-05-27T22:31:57Z",
    "file_modification_date": "2022-05-27T22:31:57Z",
    "file_size": 1871981,
    "plain_text": "# New Malware “Gameloader” in Discord Malspam Campaign Identified by GoSecure Titan Labs\n\n**gosecure.net/blog/2021/11/02/new-malware-gameloader-in-discord-malspam-campaign-identified-by-gosecure-titan-**\nlabs/\n\nGoSecure Titan Labs November 2, 2021\n\nThe expert investigators at GoSecure Titan\nLabs have found, analyzed and created\nsignatures to detect a new malware that they\ncall Gameloader – since it and its variants\ncontain numerous strings that attempt to\ndisguise themselves as video games. The file\nTitan Labs used for their research was a Rich\nText Format (RTF) file entitled New Purchase\nOrder from Alibaba.doc provided by the\nGoSecure Titan Inbox Detection and Response\n(IDR) team. The RTF file downloads a 32-bit\n.NET loader, which loads FormBook Stealer.\nThe following is an in-depth analysis of the Gameloader.\n\n## Analysis\n\n**Infection Chain**\n\nThe initial infection vector is via malspam containing links to cdn.discord.com. Using\nDiscord’s content delivery network (CDN) as a malware distribution system continues to grow\nin popularity among threat actors. The email (51875bd4157c2755a6af3ce92218ea03),\nshown in Figure 1, purports to be from Alibaba, stating that the user’s purchasing order has\nbeen received and that they can download it by clicking the link labelled DOWNLOAD\n_PURCHASE ORDER, which downloads a malicious RTF file_\n(dd59a0508d8c8327a0a326a8e50bc508) from hxxps://cdn[.]discordapp[.]com/attachments/\n882541551555846144/882541673186484224/New_Purchase_Order.doc.\n\n\n-----\n\nFigure 1: Malspam\n\n_Figure 2 compares a standard RTF file, shown on the left, to New_Purchase_Order.doc,_\nshown on the right. A standard RTF file consists of RTF control words whereas\n_New_Purchase_Order.doc clearly does not, indicating that it is heavily obfuscated._\n\n_Figure 2: Standard RTF vs. Obfuscated RTF_\n\nAs depicted in Figure 3, the tool rtfdump.py displays the streams contained in\n_New_Purchase_Order.doc, their nesting level, and also the amount of hexadecimal_\ncharacters in each one. We can see that streams 1, 2, and 3 have a high number of\nhexadecimal characters, which warrants a closer examination.\n\n\n-----\n\nFigure 3: rtfdump Output\n\nAs displayed in Figure 4, by using the s flag to investigate specific streams and the H flag to\ndecode the hexadecimal characters, we find that stream 3 contains the string equATION.3,\nwhich invokes Equation Editor. By exploiting CVE-2017-11882, a buffer overflow vulnerability\nin Microsoft Equation Editor, the RTF file downloads GameLoader\n(e3488000bfab3d82a4fd31206ba01954) from hxxp://lg-tv[.]tk/bankzx.exe. Note that we also\nused rtfdump.py’s _S flag to shift the hexadecimal bytes by one nibble. Due to the_\nimplementation of the RTF parser, it is possible to make the parser ignore a nibble of a byte,\nwhich has the effect of shifting the starting point of hex-encoded data by one nibble, which is\nexactly what the threat actor did in this case to further obfuscate the file.\n\n_Figure 4: Stream 3, hex-decoded_\n\n**GameLoader**\n\n_Figure 5 depicts the functionality of GameLoader’s first stage. Line 105 begins with a call to_\nfunction fDangNhap.X0203, which decrypts the second-stage loader. fDangNhap.X0203\nreceives two parameters, Desc.String1, which is a string in GameLoader’s resource section\nthat contains the encrypted second-stage loader, and the string Z7FE68C5, which is the\ndecryption key. We can see that function fDangNhap.X0203’s implementation, beginning at\nline 136, iterates through both the encrypted string and the decryption key, subtracting the\ninteger value of the current character in the key from the integer value of the current\ncharacter in the encrypted string. It then converts the resulting value back to a character and\nappends it to a string. The resulting string is a base64-encoded, 32-bit .NET DLL, which gets\npassed to Convert.FromBase64String, back on line 105. The decoded DLL\n(36fa916ea33da29b017dc9b363834024), GameLoader’s second stage loader, is then\npassed to the function this.X0204, the implementation of which begins at line 129. It uses\nAssembly.Load to reflectively load the DLL into the application domain of GameLoader. It\n\n\n-----\n\nthen gets the Type object Meshomatic.Ms3dLoader from the newly loaded assembly and\nstores it in this.Linear. The function this.X0202 is then called on line 106. As shown in its\nimplementation, on line 152, this.X0202 calls the Activator.CreateInstance method to create\nan instance of Meshomatic.Ms3dLoader, essentially executing the second-stage loader.\n_Activator.CreateInstance accepts two parameters: the object type to instantiate and an array_\nof arguments to be passed to the instantiated object. In the bottom of Figure 5, where local\nvariables are shown, we can see that the array contains 3 strings:\n_4950726F6475636572436F6E73756D6572436F6C6C65637469, 6A7067, and Tetris._\n\n_Figure 5: GameLoader’s First Stage Loader_\n\nFollowing the execution of the instantiated object, we can step inside the second-stage DLL,\ninternally named ColladaLoader, and see that the first method executed in\n_Meshomatic.Ms3dLoader is Ms3dLoader.SelectorX, which is passed the 3 aforementioned_\narguments. Figure 6 illustrates that besides sleeping for a random amount of time,\n_Ms3dLoader.SelectorX calls Ms3dLoader.XeH on line 48. Ms3dLoader.XeH simply converts_\nthe hexadecimal string stored in ugz1 to the ascii string IProducerConsumerCollecti. This\nstring, along with the variable projname, which stores the string Tetris, is then passed to\n_Ms3dLoader.xyz._\n\n\n-----\n\n_Figure 6: ColladaLoader’s Injection Function_\n\nAs shown in Figure 7, Ms3dLoader.xyz retrieves the bitmap image\n_IProducerConsumerCollecti from Tetris.Properties.Resources._\n\n_Figure 7: Ms3dLoader.xyz_\n\nThe bitmap image, depicted in Figure 8, does not display an image of any kind, only\nseemingly randomized pixels.\n\n\n-----\n\n_Figure 8: Bitmap Image Containing An Encrypted DLL_\n\nBack on line 48, in Figure 6, the bitmap image gets stored in a variable that is passed to\n_Ms3dLoader.cba on line 49. Ms3dLoader.cba iterates through the bitmap image, converting_\nthe Argb value of each pixel into bytes and storing them in an array. It then creates a second\narray, using the first 4 bytes of the first array as the size of the second. Starting from the fifth\nbyte, it copies the bytes in the first array to the second array until the second array is fully\npopulated. This byte array is then passed to Ms3dLoader.fgh, which is responsible for\ndecrypting the array. The return value from Ms3dLoader.XeH, which is the string jpg, is also\npassed to Ms3dLoader.fgh. Once inside Ms3dLoader.fgh, shown in Figure 9, the string jpg is\nconverted to a byte array, stored in the variable bytes, and used as the decryption key. The\narray is decrypted by XORing each of its bytes with a key byte, and also with the value\nstored in the variable num, which is 0x9d. This value was created by XORing the length of\nthe encrypted array minus one with 112. The decrypted array is GameLoader’s third-stage\nloader, a 32-bit .NET assembly internally named CF_Secretaria\n(d8e57e7bf8dfe611427511dcc5ae2ec8). Once again, Assembly.Load is used to reflectively\nload the DLL. Next, ColladaLoader calls Assembly.GetTypes, which returns an array of all\nthe types defined in the loaded assembly, and stores the twenty-first type in a variable. It\nthen uses Type.GetMethods to return an array of the all methods defined for the specified\ntype, and stores the sixth method in a variable, which it then executes with a call to\n_MethodInfo.Invoke._\n\n\n-----\n\n_Figure 9: ColladaLoader’s Decryption Function_\n\nAgain, we follow the execution to step inside the invoked method. However, CF_Secretaria is\nprotected with .NET Reactor, a code obfuscation tool designed to protect intellectual\nproperty, which greatly hinders analysis. To overcome this, we save CF_Secretaria to disk,\nthen use the .NET deobfuscator de4dot to improve the readability of the code. The executed\nmethod belongs to a class named FrmIntegrante. Figure 10 displays the method responsible\nfor initializing the class’s fields. The method Class6.smethod_0 retrieves the byte array zdljr\nfrom CF_Secretaria’s resource section. The byte array is passed, along with the string\n_YgSqwuwwJHlcE, to Class6.smethod_5, which is a decryption function that is exactly the_\nsame as ColladaLoader’s decryption function, shown above in Figure 9. Of course, the string\n_YgSqwuwwJHlcE is the decryption key. The decrypted array is then passed to_\nClass6.smethod_4, which removes the first 16 bytes, before being stored in\n_FrmIntegrante.byte_0. The resulting array is a 32-bit executable, FormBook Stealer_\n(4c1f6f8f4bf9678c49d6ea74baca3576).\n\n\n-----\n\n_Figure 10: FrmIntegrante’s Initialization_\n\nAlso depicted in Figure 10 are a set of Windows API functions and their corresponding\nlibraries that are commonly used for process hollowing, a technique where a payload is\ninjected and executed in the context of a selected process. Each API function is passed to\n_FrmIntegrante.smethod_7, which is stored in FrmIntegrante.delegate{number}_0. From_\nFigure 11, which displays FrmIntegrante.smethod_7’s implementation, we see that the first\nparameter, a library name, is passed to FrmIntegrante.LoadLibraryA, a pointer to the\nimported function kernel32.LoadLibraryA, which returns a handle to the specified library. The\nhandle is passed, along with a function name stored in FrmIntegrante.smethod_7’s second\nparameter, to FrmIntegrante.GetProcAddress, a pointer to kernel32.GetProcAddress, which\nreturns the address of the specified function. This is then converted to a delegate and\nreturned. Therefore, FrmIntegrante.delegate{number}_0 is a reference to a specified\nWindows API function.\n\n_Figure 11: API Delegate-Building Function_\n\n_CF_Secretaria implements a switch statement, displayed in Figure 12, to determine into_\nwhich process to inject its payload, which is FormBook in this instance. Case zero returns\n_string_10, which is the path of the currently executing assembly, GameLoader, while cases_\n_1, 2, and 3 return the paths of MSBuild.exe, vbc.exe, and RegSvcs.exe, respectively. In this_\ninstance, case 0 is selected and GameLoader proceeds to inject the payload into its own\nprocess. The case that is selected is determined by the parameter int_12, which is set by the\nthreat actor in CF_Secretaria’s configuration.\n\n\n-----\n\n_Figure 12: Process Injection Options_\n\n_Figures 13 and 14 display the function responsible for the process injection. For readability,_\nwe have added the API call that each delegate refers to. The function begins by calling\n_kernel32.CreateProcessA. The first parameter, which specifies the process to create, is_\n_string_10, the result from the aforementioned switch statement. The sixth parameter,_\ncontaining 134217732U, specifies flags used to set the properties of the created process.\n_134217732U (0x08000004) sets the flags CREATE_SUSPENDED and_\n_CREATE_NO_WINDOW to true. Thus, the process will be created in suspended mode and_\nwill be executed without a console window. Next, either kernel32.GetThreadContext or\n_kernel32.Wow64GetThreadContext will be called, depending on whether the process is 32-_\nbit or 64-bit, and a CONTEXT structure of the process’s main thread will be retrieved. The\nbase address of the process is parsed out of the CONTEXT structure and passed to\n_kernel32.ReadProcessMemory, which is used to retrieve the base virtual address of the_\nprocess’s view. The base virtual address is then passed to ntdll.ZwUnmapViewOfSection,\nwhich unmaps, or hollows, the entire view from the process’s virtual address space. The\nvirtual address space is no longer reserved and is now available to map other views. Next, it\nallocates space within the process’s virtual address space by calling kernel32.VirtualAllocEx,\nthen calls kernel32.WriteProcessMemory to inject the payload into the newly allocated\nmemory. Either kernel32.SetThreadContext or kernel32.Wow64SetThreadContext is called\nto change the process’s thread context so that it will now point to the injected payload.\nFinally, kernel32.ResumeThread is called to resume the thread and thus, execute the\ninjected payload.\n\n\n-----\n\nFigure 13: Process Injection Function\n\n\n-----\n\n_Figure 14: Process Injection Function Continued_\n\n## Conclusion\n\nGameLoader is a multi-stage, steganographic loader that has been observed loading various\ntypes of commodity malware, including AgentTesla, LokiBot, and Snake Keylogger. At the\ntime of writing, over 1000 GameLoader samples have been uploaded to VirusTotal.\n\nThe signatures to detect the emerging threats discussed in this report were developed\nthrough the close monitoring, analysis and reverse engineering conducted by GoSecure\nTitan Labs, as part of the GoSecure Titan Managed Detection and Response (MDR)\nsolution, which includes GoSecure Titan Inbox Detection and Response (IDR) tools for users\nto share suspicious emails in real-time with our professional threat hunting team.\n\n_Malware Analyst: Sean Mahoney_\n\n## Indicators of Compromise\n\n\n-----\n\n```\n+ +\n----------------------------+---------------------------+\n| Type |                        Indicator          \n|    Description    |\n+------+--------------------------------------------------------------------------------------------------------+---------------------------+\n| md5 | 51875bd4157c2755a6af3ce92218ea03                      \n| Malspam Email       |\n| md5 | dd59a0508d8c8327a0a326a8e50bc508                      \n| RTF File         |\n| md5 | e3488000bfab3d82a4fd31206ba01954                      \n| GameLoader        |\n| md5 | 36fa916ea33da29b017dc9b363834024                      \n| GameLoader's Second Stage |\n| md5 | d8e57e7bf8dfe611427511dcc5ae2ec8                      \n| GameLoader's Third Stage |\n| url |\nhxxps://cdn[.]discordapp[.]com/attachments/882541551555846144/882541673186484224/New_P\n | GameLoader Download URL  |\n| url | hxxp://lg-tv[.]tk/bankzx.exe                        \n| RTF File Download URL   |\n+------+--------------------------------------------------------------------------------------------------------+---------------------------+\n\n## Detection\n\n```\n\n-----\n\n```\nrule other_rtf_obfuscated_0 {\n  meta:\n    author   = \"Titan Labs\"\n    company   = \"GoSecure\"\n    description = \"Obfuscated RTF File\"\n    created   = \"2021-09-28\"\n    hash    = \"dd59a0508d8c8327a0a326a8e50bc508\"\n    os     = \"windows\"\n    type    = \"other\"\n    tlp     = \"white\"\n    id     = 1\n  strings:\n    $magic  = \"{\\\\rtf\" \n    $ansi  = \"ansi\"\n    $deflang = \"deflang\"\n    $windows = \"windows\"\n    $deff  = \"deff\"\n  condition:\n    $magic at 0 and\n    filesize < 1MB and\n    not $ansi in (5..20) and \n    not $deflang in (5..20) and\n    not $windows in (5..20) and\n    not $deff in (5..20)\n}\nrule malware_game_loader_0 {\n  meta:\n    author   = \"Titan Labs\"\n    company   = \"GoSecure\"\n    description = \"GameLoader\"\n    hash    = \"e3488000bfab3d82a4fd31206ba01954\"\n    created   = \"2021-09-28\"\n    os     = \"windows\"\n    type    = \"malware.loader\"\n    tlp     = \"white\"\n    rev     = 1\n  strings:\n    $decryptyion_routine = {\n      00 02 07 28 ?? ?? ?? ?? 28 ?? ?? ?? ?? 03 07 03\n      6F ?? ?? ?? ?? 5D 17 58 28 ?? ?? ?? ?? 28 ?? ??\n      ?? ?? 59 0C 06 08 28 ?? ?? ?? ?? 0D 12 ?? 28 ??\n      ?? ?? ?? 28 ?? ?? ?? ?? 0A 00 07 17 58 0B 07 02\n      6F ?? ?? ?? ?? FE 02 16 FE 01 13 ?? 11 ?? 2D ??\n      }\n  condition:\n    uint16(0) == 0x5a4d and\n    uint32(uint32(0x3c)) == 0x00004550 and\n    $decryptyion_routine\n}\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-02 - New Malware “Gameloader” in Discord Malspam Campaign Identified by GoSecure Titan Labs.pdf"
    ],
    "report_names": [
        "2021-11-02 - New Malware “Gameloader” in Discord Malspam Campaign Identified by GoSecure Titan Labs.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535601,
    "ts_updated_at": 1743041674,
    "ts_creation_date": 1653690717,
    "ts_modification_date": 1653690717,
    "files": {
        "pdf": "https://archive.orkl.eu/a9eb4f426c1444a754c0bbb2cd4218ff3f4f4496.pdf",
        "text": "https://archive.orkl.eu/a9eb4f426c1444a754c0bbb2cd4218ff3f4f4496.txt",
        "img": "https://archive.orkl.eu/a9eb4f426c1444a754c0bbb2cd4218ff3f4f4496.jpg"
    }
}