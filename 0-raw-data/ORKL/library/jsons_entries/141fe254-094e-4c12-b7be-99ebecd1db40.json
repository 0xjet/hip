{
    "id": "141fe254-094e-4c12-b7be-99ebecd1db40",
    "created_at": "2022-10-25T16:48:19.548312Z",
    "updated_at": "2025-03-27T02:14:48.618546Z",
    "deleted_at": null,
    "sha1_hash": "cde02057689886c29438815cbeed8ebe860a0ab2",
    "title": "Evolution Of Sophisticated Spyware: From Agent.Btz To Comrat",
    "authors": "Gdata",
    "file_creation_date": "2015-01-15T15:51:43Z",
    "file_modification_date": "2015-01-15T15:51:43Z",
    "file_size": 208370,
    "plain_text": "**In November 2014, the experts of the G DATA SecurityLabs published an article about**\n\n**ComRAT, the Agent.BTZ successor. We explained that this case is linked to the Uroburos**\n\n**rootkit. We assume that the actor behind these campaigns uses several different malware**\n\n**strains is order to compromise the targeted infrastructure: Uroburos, a rootkit;**\n\n**Agent.BTZ/ComRAT, remote administration tools or Linux malware and maybe even more.**\n\nWe decided to have an even closer look at Agent.BTZ and ComRAT and therefore analyzed the evolution\n\nof this RAT, covering seven years of development. Here is a table with the minimal information about 46\n\ndifferent samples:\n\n|MD5|Version|Compilation Date|\n|---|---|---|\n|b41fbdd02e4d54b4bc28eda99a8c1502|Ch 1.0|Wed Jun 13 07:31:32 2007 UTC|\n|93827a6c77e84ffdd9c793d485d3df6e|Ch 1.0|Wed Jun 13 07:31:32 2007 UTC|\n|3e9c7ef54ea3d55d5b53abab4c3e2385|Ch 1.0|Wed Jun 13 07:31:32 2007 UTC|\n|b9ed8876ef5a05ba364a9cdbdf4f184d|Ch 1.0|Tue Jun 19 12:41:21 2007 UTC|\n|d8f98f64687b05a62c81ce9e52dd808d|Ch 1.1|Tue Jun 26 08:46:11 2007 UTC|\n|2cf64ff9dad8d64ee9322e390d4f7283|Ch 1.1|Tue Jun 26 08:46:11 2007 UTC|\n|24e679155697bd31b34036a44d4346a7|Ch 1.2wcc|Tue Jul 24 12:57:37 2007 UTC|\n|53b8b9f779b1d1d298884d1c21313ab3|Ch 1.2wcc|Tue Jul 24 12:57:37 2007 UTC|\n|69ae46fedf3c18ff36fc850e0baa9365|Ch 1.2wcc|Tue Jul 24 12:57:37 2007 UTC|\n|e05511a84eb345954b94f1e05c78bf22|Ch 1.2|Thu Jul 26 07:20:17 2007 UTC|\n|f93ce76f6580d68a95260198b2d6feaa|Ch 1.3|Mon Dec 3 14:15:58 2007 UTC|\n|db5d1583704b0fb6d1cff0b62a512a7d|Ch 1.4|Tue Dec 11 17:36:03 2007 UTC|\n|2b348c225985679f62e50b28bdb74ac9|Ch 1.4|Tue Dec 11 17:36:03 2007 UTC|\n|af3f0efbd69905123f7df958cc88dff9|Ch 1.4|Tue Dec 11 17:36:03 2007 UTC|\n|e825c4961293ad45883cd52f38695283|Ch 1.5|Thu Mar 27 14:58:15 2008 UTC|\n|2a67b53b7ef7b70763658ca7f60e7005|Ch 1.5|Thu Mar 27 14:58:15 2008 UTC|\n|bbf569176ec7ec611d8a000b50cdb754|Ch 1.5|Thu Mar 27 14:58:15 2008 UTC|\n|e5c76e67128e48cb0f003c2beee47d1f|Ch 1.5|Thu Mar 27 14:58:15 2008 UTC|\n|8e5da63369d20e1d2c530bf806996285|Ch 2.02|Mon May 5 11:27:48 2008 UTC|\n|78d3f074b70788897ae7e20e5137bf47|Ch 2.03|Mon May 12 11:52:31 2008 UTC|\n|986f263ca2c529d5d28bce3c62f858ea|Ch 2.03|Thu May 22 10:24:55 2008 UTC|\n|4f732099caf5d21729572cec229f7614|Ch 2.04|Mon Jun 9 17:23:56 2008 UTC|\n|5336c24a3399f522f8e19d9c54a069c6|Ch 2.04|Mon Jun 9 17:23:56 2008 UTC|\n|dc1c54751f94b6fdf0b6ecdd64e67701|Ch 2.04|Mon Jun 9 17:23:56 2008 UTC|\n|40335fca60acd05f1428b13a9a3c1228|Ch 2.04|Mon Jun 9 17:23:56 2008 UTC|\n|72663ee9d3efaff959bff4ce25bd37a6|Ch 2.04|Mon Jun 9 17:23:56 2008 UTC|\n\n\n-----\n\n|331eca9c7d9fd9cbe7cd192af09880a3|Ch 2.05|Thu Nov 6 13:21:45 2008 UTC|\n|---|---|---|\n|db1156b072d58acdac1aeab9af2160a2|Ch 2.05|Thu Nov 6 13:21:45 2008 UTC|\n|74dbea70bfb15db31bb9f757ed4bb1a0|Ch 2.07|Mon Dec 29 11:37:17 2008 UTC|\n|eb928bca5675722c7e9e2b09eec1158a|Ch 2.07|Mon Dec 29 11:37:17 2008 UTC|\n|162f415abad9708aa61db8e03bcf2f3c|Ch 2.11|Mon Sep 14 13:22:57 2009 UTC|\n|448524fd62dec1151c75b55b86587784|Ch 2.11|Mon Sep 14 15:28:07 2009 UTC|\n|29bb70a40689e9e665d15716519bacfd|Ch 2.12|Tue Sep 29 10:28:40 2009 UTC|\n|38d6719d6a266c6cefb8626c57378927|Ch 2.13|Mon Dec 7 14:25:12 2009 UTC|\n|02eda1effde92bdf8462abcf40c4f776|Ch 2.13|Mon Dec 7 14:27:53 2009 UTC|\n|5121ce1f96d74076df1c39748e019f42|Ch 2.14.1|Wed Feb 17 15:14:20 2010 UTC|\n|28dc1ca683d6a14d0d1794a68c477604|Ch 3.00|Tue Jan 31 16:12:25 2012 UTC|\n|40bd7846553550f38e458b8493824cb4|Ch 3.00|Tue Feb 14 10:28:06 2012 UTC|\n|ba0c777317461ed57a85ffae277044dc|Ch 3.02|Wed Apr 4 16:23:44 2012 UTC|\n|b86137fa5a232c614ec5405be4d13b37|Ch 3.10|Tue Dec 18 08:22:43 2012 UTC|\n|7872c1d88fe21d8a85f160a6666c76e8|Ch 3.20|Fri Jun 28 12:16:40 2013 UTC|\n|83a48760e92bf30961b4a943d3095b0a|Ch 3.20|Fri Jun 28 12:16:58 2013 UTC|\n|3d65c18d09f47547f85c631ebeeda482|Ch 3.20|Mon Jun 24 10:51:01 2013 UTC|\n|ec7e3cfaeaac0401316d66e964be684e|Ch 3.25|Thu Feb 6 12:37:44 2014 UTC|\n|b407b6e5b4046da226d6e189a67f62ca|Ch 3.26|Thu Jan 3 18:03:46 2013 UTC|\n\n\nThanks to the versioning, we can deduce that the compilation dates we saw and currently see actually\n\nseem to be legit – except for the last known version, in which the author modified the compilation date in\n\norder to make the analysis more complex. We can see that this malware was really active in 2007 and\n\n2008. New versions declined in frequency in 2009 and only one new sample was identified in 2010. We\n\ndid not encounter any new sample from 2011, but the malware appeared back in 2012, with a new major\n\nversion.\n\n\n-----\n\n## The RAT’s evolution described in ten steps\n\nTo describe the evolution of the development, we decided to compare ten major versions:\n\nVersion Ch 1.0 (2007-06) to Ch 1.5 (2008-03)\n\nVersion Ch 1.5 (2008-03) to Ch 2.03 (2008-05)\n\nVersion Ch 2.03 (2008-05) to Ch 2.11 (2009-09)\n\nVersion Ch 2.11 (2009-09) to Ch 2.14.1 (2010-02)\n\nVersion Ch 2.14.1 (2010-02) to Ch 3.00 (2012-01)\n\nVersion Ch 3.00 (2012-01) to Ch 3.10 (2012-12)\n\nVersion Ch 3.10 (2012-12) to Ch 3.20 (2013-06)\n\nVersion Ch 3.20 (2013-06) to Ch 3.25 (2014-02)\n\nVersion Ch 3.25 (2014-02) to Ch 3.26 (2013-01; date has been modified)\n\nThe following chapter will present the main differences between the versions mentioned above. Here is\n\nthe resemblance ratio for each version, comparing direct neighbor versions only, created using BinDiff:\n\n\n-----\n\nThe biggest code update has occurred between version 2.14.1 and version 3.00. The gap matches the\n\nabsence of samples during two years and this fundamental modification is what we call the death of\n\nAgent.BTZ and the birth of ComRAT.\n\n### Differences between version Ch 1.0 (2007-06) to Ch 1.5 (2008-03)\n\nThe analyzed samples are:\n\nCh 1.0: b41fbdd02e4d54b4bc28eda99a8c1502\n\nCh 1.5: bbf569176ec7ec611d8a000b50cdb754\n\nCode similarity: 90%\n\nWe did not identify strong modification between the two samples. However, we can notice the following:\n\nThe configuration file (XML) in version 1.5 is stored in Unicode and not in ASCII anymore;\n\nThe two versions implement a mechanism to infect new media connected to the infected system.\n\nThe implementation is not exactly the same nor is the log of media infection;\n\nVersion 1.5 creates a new event: “wowmgr_is_load”. This event has then been used for years.\n\n### Differences between version Ch 1.5 (2008-03) and Ch 2.03 (2008-05)\n\nThe analyzed samples are:\n\nCh 1.5: bbf569176ec7ec611d8a000b50cdb754\n\nCh 2.03: 78d3f074b70788897ae7e20e5137bf47\n\nCode similarity: 83%\n\nIn version 2.03 of Agent.BTZ, the authors changed the following:\n\n\n-----\n\nThe communication protocol was modified in order to include the flag <CHCMD>\n\nwe assume that “CH” has the same meaning than “Ch” before the version number and “CMD” is the\n\nabbreviation for command;\n\nFrom now on, the malware supports “runas” in order to execute commands as administrator. This\n\ncommand was implemented by Microsoft in Windows Vista in 2007. We assume that the author\n\nimplemented this feature because several targets switched to this version of Windows in 2008.\n\n[According to an article, version 1.5 was used against the US Pentagon. We assume that the string](http://blog.threatexpert.com/2008/11/agentbtz-threat-that-hit-pentagon.html)\n\nobfuscation was performed in order to bypass security measures being capable of detecting an intrusion.\n\n### Differences between version Ch 2.03 (2008-05) and Ch 2.11 (2009-09)\n\nThe analyzed samples are:\n\nCh 2.03: 78d3f074b70788897ae7e20e5137bf47\n\nCh 2.11: 162f415abad9708aa61db8e03bcf2f3c\n\nCode similarity: 96%\n\nThe codes of these two versions are extremely similar to each other, we can only notice small changes:\n\nThe author changed the name of several registry keys (probably to avoid detection by well-known\n\nIOC);\n\nThe name of two exported functions were modified, too: InstallM() becomes AddAtomT() and\n\nInstallS() becomes AddAtomS(),probably for the same reason than above.\n\n### Differences between version Ch 2.11 (2009-09) and Ch 2.14.1 (2010-02)\n\nThe analyzed samples are:\n\nCh 2.11: 162f415abad9708aa61db8e03bcf2f3c\n\nCh 2.14.1: 5121ce1f96d74076df1c39748e019f42\n\nCode similarity: 98%\n\nThese codes are really similar to each other, too. We can notice only two changes:\n\nThe author patched several bugs;\n\nFour new exports appear: DllCanUnLoadNow(), DllGetClassObject(), DllRegisterServer(),\n\nDllUnregisterServer().\n\nThe four exported libraries show that the malware has started to support the OLE Component Object\n\n\n-----\n\nfunctions are empty. The fourth one executes the malware.\n\n### Differences between version 2.14.1 (2010-02) and Ch 3.00 (2012-01)\n\nThe analyzed samples are:\n\nCh 2.14.1: 5121ce1f96d74076df1c39748e019f42\n\nCh 3.00: 28dc1ca683d6a14d0d1794a68c477604\n\nCode similarity: 60%\n\nThese codes really differ from each other, even if some parts of version 2.14.1 were retained. Moreover, the\n\ndevelopers changed the compiler; they switched from Visual Studio 6.0 to Visual Studio 9.0/10.0, which\n\nis a strong indicator for the huge differences.Version 3.00 is what the G DATA SecurityLabs experts call\n\nComRAT. We can say that version 2.14.1 is the last version of Agent.BTZ. Here are the main differences\n\nbetween Agent.BTZ and ComRAT:\n\nThe new malware collects more information about the infected system (such as drive information,\n\nvolume information…).\n\nThe media stick infection mechanism has definitely been removed. We assume this happened due to\n\nthe fact that Microsoft has disabled AutoRun for external media. For the attackers, this infection\n\nvector is not interesting anymore.\n\nThe malware is injected into every process of the infected machine and the main payload is executed\n\n[in “explorer.exe” as we explained in our article;](https://blog.gdatasoftware.com/blog/article/the-uroburos-case-new-sophisticated-rat-identified.html)\n\nThe communication channel to the command and control is not the same anymore. In this new\n\nversion, the malware uses POST requests with the following pattern:\n\nAs the malware is injected into every process of the infected system, it creates named pipe in order\n\nto handle inter-processes communication.\n\nOn several 3.00 samples, the author forgot to remove the compilation path, here are some examples:\n\n\n-----\n\nc:\\projects\\ChinckSkx64\\Release\\libadcodec.pdb\n\nC:\\projects\\ChinckSkx64\\x64\\Release\\libadcodec.pdb\n\nE:\\old_comp\\_Chinch\\Chinch\\trunk\\Debug\\Chinch.pdb\n\nc:\\projects\\ChinchSk\\Release\\libadcodec.pdb\n\nThanks to these compilation paths, we assume that the original name of the RAT is “Chinch”, which leads\n\nus to the assumption that the “CH” characters in the version name and in the flag “<CHCMD>” stands for\n\n[“Chinch”. In English, chinch is the word for a small North American bug, Blissus leucopterus. This word is](http://en.wikipedia.org/wiki/Blissus_leucopterus)\n\nderived from the Spanish word chinche, meaning pest.\n\n### Differences between version 3.00 (2012-01) and Ch 3.10 (2012-12)\n\nThe analyzed samples are:\n\nCh 3.00: 28dc1ca683d6a14d0d1794a68c477604\n\nCh 3.10: b86137fa5a232c614ec5405be4d13b37\n\nCode similarity: 90%\n\nThe codes are similar to each other, but the authors added several features:\n\nThe malware generates more logs;\n\nThe malware has a Mutex handle;\n\nThe 3.10 version supports multiple command and control servers.\n\nThe last new feature is really interesting: if the compromised targets block a specific command and control\n\nserver, the malware will continue to work, thanks to two alternative command and control servers.\n\n### Differences between version 3.10 (2012-12) and Ch 3.20 (2013-06)\n\nThe analyzed samples are:\n\nCh 3.10: b86137fa5a232c614ec5405be4d13b37\n\nCh 3.20: 7872c1d88fe21d8a85f160a6666c76e8\n\nCode similarity: 93%\n\nThe major new feature in the version is the new exports function called InstallW(). This exported function\n\nis used by the dropper to add persistence in the registry and to drop a second file (as explained in our\n\nprevious article). Version 3.20 uses the following CLSID in order to hijack COM object: B196B286-BAB4\n101A-B69C-00AA00341D07. This object is the IConnectionPoint interface. The CLSID was only used in\n\nthis version We assume that the performed COM object hijacking generates some trouble on the infected\n\n\n-----\n\nstored in plain text within the sample.\n\n### Differences between version Ch 3.20 (2013-06) and Ch 3.25 (2014-02)\n\nThe analyzed samples are:\n\nCh 3.20: 7872c1d88fe21d8a85f160a6666c76e8\n\nCh 3.25: ec7e3cfaeaac0401316d66e964be684e\n\nCode similarity: 91%\n\nIn the 3.25 version, the author switched to the CLSID: 42aedc87-2188-41fd-b9a3-0c966feabec1 as\n\n[described in our article. Furthermore, the strings in the sample are obfuscated. The main new feature is](https://blog.gdatasoftware.com/blog/article/the-uroburos-case-new-sophisticated-rat-identified.html)\n\nthe obfuscation – almost all strings are obfuscated and the XML pattern is not written in plain text\n\nanymore.\n\n### Differences between version Ch 3.25 (2014-02) and Ch 3.26 (2013-01; date has been modified)\n\nThe analyzed samples are:\n\nCh 3.25: ec7e3cfaeaac0401316d66e964be684e\n\nCh 3.26: b407b6e5b4046da226d6e189a67f62ca\n\nCode similarity: 95%\n\nThe version 3.26 is the latest known version. In this version:\n\nThe authors removed the familiar XOR key used by Agent.BTZ and Uroburos. We assume that due\n\nto the G DATA publication in February 2014, the author decided to remove as many links as possible\n\nbetween Uroburos and Agent.BTZ/ComRAT/Chinch;\n\nThe authors do not generate logs anymore;\n\nThe compilation date has been modified, in order to make the analysis and timeline creation more\n\ncomplex.\n\n## Conclusion\n\nThis analysis shows us seven years of the evolution of a Remote Administration Tool, used by a group\n\n[which targeted extremely sensitive entities, such as the US Pentagon in 2008 or the Belgium Ministry of](http://en.wikipedia.org/wiki/2008_cyberattack_on_United_States)\n\n[Foreign Affairs in 2014 as well as the Finnish Ministry of Foreign Affairs.](http://www.hs.fi/kotimaa/a1411735620888)\n\nExcept for version 3.00, the modifications made are rather marginal. We can see that the authors adapted\n\n\n-----\n\nperformed to version 3.00, after two years of silence. Visibly, this RAT was used alongside the Uroburos\n\nrootkit. Nevertheless, it is not entirely clear how and when the attackers choose to use the RAT or the\n\nrootkit or whether both are used in parallel.\n\nTaking everything into consideration, G DATA SecurityLabs experts are sure that the group behind\n\nUroburos/Agent.BTZ/ComRAT/Linux tool/… will remain an active player in the malware and APT field.\n\nThe newest revelations made and connections drawn let us believe that there is even more to come.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/gqksdtk0gogqzzzbg2w6b4y7fej6f26t",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2015/2015.01.15.Evolution_of_Agent.BTZ_to_ComRAT/Agent.BTZ_to_ComRAT.pdf"
    ],
    "report_names": [
        "Agent.BTZ_to_ComRAT"
    ],
    "threat_actors": [
        {
            "id": "42a6a29d-6b98-4fd6-a742-a45a0306c7b0",
            "created_at": "2022-10-25T15:50:23.710403Z",
            "updated_at": "2025-03-27T02:00:55.531313Z",
            "deleted_at": null,
            "main_name": "Silence",
            "aliases": [
                "Whisper Spider"
            ],
            "source_name": "MITRE:Silence",
            "tools": [
                "Winexe",
                "SDelete"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "88e53203-891a-46f8-9ced-81d874a271c4",
            "created_at": "2022-10-25T16:07:24.191982Z",
            "updated_at": "2025-03-27T02:02:10.13692Z",
            "deleted_at": null,
            "main_name": "Silence",
            "aliases": [
                "ATK 86",
                "Contract Crew",
                "TAG-CR8",
                "TEMP.TruthTeller",
                "Whisper Spider"
            ],
            "source_name": "ETDA:Silence",
            "tools": [
                "EDA",
                "EmpireDNSAgent",
                "Farse",
                "Ivoke",
                "Kikothac",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Meterpreter",
                "ProxyBot",
                "ReconModule",
                "Silence.Downloader",
                "TiniMet",
                "TinyMet",
                "TrueBot",
                "xfs-disp.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a97fee0d-af4b-4661-ae17-858925438fc4",
            "created_at": "2023-01-06T13:46:38.396415Z",
            "updated_at": "2025-03-27T02:00:02.823045Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Uroburos",
                "Hippo Team",
                "Pacifier APT",
                "MAKERSMARK",
                "ATK13",
                "UAC-0003",
                "IRON HUNTER",
                "Waterbug",
                "TAG_0530",
                "KRYPTON",
                "Popeye",
                "SIG23",
                "UAC-0144",
                "G0010",
                "Blue Python",
                "VENOMOUS Bear",
                "Group 88",
                "Pfinet",
                "ITG12",
                "UNC4210",
                "Secret Blizzard",
                "UAC-0024"
            ],
            "source_name": "MISPGALAXY:Turla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041688,
    "ts_creation_date": 1421337103,
    "ts_modification_date": 1421337103,
    "files": {
        "pdf": "https://archive.orkl.eu/cde02057689886c29438815cbeed8ebe860a0ab2.pdf",
        "text": "https://archive.orkl.eu/cde02057689886c29438815cbeed8ebe860a0ab2.txt",
        "img": "https://archive.orkl.eu/cde02057689886c29438815cbeed8ebe860a0ab2.jpg"
    }
}