{
    "id": "2008e7f4-36a3-45ab-9d46-9082e11e9f7e",
    "created_at": "2023-01-12T15:08:01.95357Z",
    "updated_at": "2025-03-27T02:05:42.120256Z",
    "deleted_at": null,
    "sha1_hash": "8076a9a0b57231d9b5e74813343806a199235ca7",
    "title": "2022-07-13 - Targeted Attack on Government Agencies",
    "authors": "",
    "file_creation_date": "2022-07-18T18:24:53Z",
    "file_modification_date": "2022-07-18T18:24:53Z",
    "file_size": 736036,
    "plain_text": "## Targeted Attack on Government Agencies\n\n**[trellix.com/en-us/about/newsroom/stories/threat-labs/targeted-attack-on-government-agencies.html](https://www.trellix.com/en-us/about/newsroom/stories/threat-labs/targeted-attack-on-government-agencies.html)**\n\n### Stories\n\nThe latest cybersecurity trends, best practices,\n\nsecurity vulnerabilities, and more\n\nBy **[Sushant Kumar Arya,](https://www.trellix.com/en-us/about/newsroom/stories/contributors/sushant-kumar-arya.html)** **[Mohsin Dalla · July 13, 2022](https://www.trellix.com/en-us/about/newsroom/stories/contributors/mohsin-dalla.html)**\n\n### Executive summary\n\nThe Trellix Email Security Research Team has discovered a malicious campaign targeting\ngovernment agencies of Afghanistan, India, Italy, Poland, and the United States since 2021.\nThe attack starts with a spear phishing email with a geo-political theme. The spear phishing\nemails were themed around India Afghanistan relationship. Attacker used politics as a lure to\ntrick users into clicking on a malicious link. The email used for this phishing attack contains an\nattachment or a weaponized URL that delivers an Excel sheet. Upon opening the Excel sheet,\nExcel executes an embedded malicious macro which then decrypts and installs a Remote\nAccess Trojan (AysncRAT & LimeRAT) and maintains persistence. Once the Remote Access\nTrojan is installed on the victim machine, it establishes communication with a Command-andControl server used to exfiltrate victim data. The Remote Access Trojan is capable of taking\nscreenshots, capturing keystrokes, recording credentials/confidential information, and adding\ninfected systems to botnets. It can also perform network discovery and move laterally to other\nsystems in the affected organization. The email used in this attack originated from the South\nAsia region which suggests the involvement of a South Asian threat actor. Trellix Email\nSecurity has detection coverage for this malicious campaign.\n\n\n-----\n\n**Figure 1. Target countries**\n\n### Threat landscape\n\nThe Trellix Email Security product can follow the entire attack chain and analyze the final\npayload. In this scenario, it followed the chain: EMAIL -> URL -> ZIP -> XLS -> Macro. Finally,\nour threat database was able to detect the malicious macro performing decryption, creating an\nexecutable object, performing process injection, and utilizing other malicious techniques. Trellix\nEmail Security has detection for the malicious Excel sheet with name **FE_APT_Dropper_Macro_DoubleHide_1.**\n\n**Figure 2. Attack timeline**\n\n### Attack timeline\n\nAs seen in Figure 2, the attack was active for over a year. The attacker sent emails for a short\ninterval and then went back into hiding. This was followed by subsequent similar waves. The\nfirst wave of attack was noticed during March-April 2021, followed by another in July 2021,\n\n\n-----\n\nthen again in December 2021, and most recently during end of March 2022.\n\n### Email details\n\nThe attackers used the free mail service Gmail to send the spear phishing emails. Based on\nemail header analysis, it was evident that the emails originated from Google servers and were\nsent from the South Asia region. The time zone of the email sender (+0500 UTC) further\nsuggests the involvement of South Asian threat actors.\n\n**Figure 3. Email headers**\n\nThe spear phishing email was themed around geopolitical news related to India like \"Indian\n**Nationals ( who were hidden in Kabul ) Killing in Kabul Tonight\" and “Indian workers**\n**missing from the dam project.” More recently, the email used a COVID theme with the**\nsubject - \"31 Covid Deaths In 24 Hours: Information campaign by NDTV\". The email had a\nGoogle drive link serving a malicious ZIP file. In some cases, the malicious ZIP was sent as an\nemail attachment. The ZIP contains an Office document which is used to drop a RAT (Remote\nAccess Trojan).\n\n\n-----\n\n**Figure 4. Email sample**\n\n**Figure 5. Attack chain**\n\n### Technical details\n\nThe document file (DOC/XLS) acts as a dropper, which drops and executes a file named\n\"msword.exe\". The Excel sheet contains a VBA macro which is enabled when the document\nfile is opened. The malicious executable code is stored in the document file itself (within a form\ntext field) in the base64 encoded format. The VBA macro reads the base64 content, decodes\nit, and then decrypts the decoded content with a hardcoded XOR key. Multiple levels of base64\ndecoding and XOR decryption are used to obfuscate the malicious executable file.\n\n\n-----\n\n**Figure 6. XLS with macro**\n\n**Figure 7. Macro code: Workbook Open**\n\n**Figure 8. Macro code: Main function which is called inside Workbook Open event**\n\n\n-----\n\nXOR Key :\n\"MxjnbvbX%$#@c%%!@#$C%^&*\n(K(*&K0^%$W$@!&@#$C%EGGGxcel^MicrosoLKHGFD^%$W@2017!&^%$#lx^&%$0\"\n\n**Figure 9. Macro code: XOR function**\n“msword.exe” is an SFX archive executable, which contains multiple malicious executable files\nas shown in Figure 10.\n\n**Figure 10. msword.exe contents**\n\n**File name** **File info**\n\n3_5 LimeRAT [Runtime: .Net Framework 2.0]\n\n4 AsyncRAT [Runtime: .Net Framework 4]\n\n4_5 AsyncRAT [Runtime: .Net Framework 4.5]\n\n4_5_1 AsyncRAT [Runtime: .Net Framework 4.5.1]\n\n\n-----\n\n4_5_2 AsyncRAT [Runtime: .Net Framework 4.5.2]\n\n4_6 AsyncRAT [Runtime: .Net Framework 4.6]\n\n4_6_1 AsyncRAT [Runtime: .Net Framework 4.6.1]\n\n4_7 AsyncRAT [Runtime: .Net Framework 4.7\n\n4_7_2 AsyncRAT [Runtime: .Net Framework 4.7.2]\n\nigfx.exe Delphi compiled file installs RAT file according to available .Net version\n\nUpon execution, \"msword.exe\" drops the RAT files shown in the table above. These RAT\nexecutables are obfuscated using “Crypto Obfuscator For .Net”. “msword.exe” then starts the\nprocess “igfx.exe” which performs the following actions:\n\nChecks the .NET version in the registry; based on the installed version, renames the\ncompatible RAT file to “excel.exe”\nChecks the registry keys to determine the .NET version in the order listed below. If found,\na version of the runtime file (AsyncRAT) is picked corresponding to the .NET version. If\nnone of the registry keys are found, the file “3_5” (LimeRAT) is used.\n\nHKLM\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4\nHKLM\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4.5\nHKLM\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4.5.1\nHKLM\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4.5.2\nHKLM\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4.6\nHKLM\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4.6.1\nHKLM\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4.7\nHKLM\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\\v4.7.2\nSets the file attributes of “excel.exe” to hidden and read-only.\nAdds a “Run” registry entry for persistence.\nDeletes the unused RAT executable files.\nStarts the “excel.exe” process.\n\n**Figure 11. Process chain**\n\n**Figure 12. Run registry entries**\n\nBoth [AsyncRAT and](https://github.com/NYAN-x-CAT/AsyncRAT-C-Sharp) [LimeRAT source code are publicly available.](https://github.com/NYAN-x-CAT/Lime-RAT)\n\n\n-----\n\n### Async rat settings configuration\n\nPorts = \"6606”\nHosts = \"107.173.143.111\"\nVersion = \"2.5.7b\"\nInstall = \"false\"\nInstallFolder = \"AppData\"\nInstallFile = \"msexcl.exe\"\nKey = \"MZ-RX\nMTX = \"%MTX%\";\nCertificate = \"%Certificate%\"\nServersignature = \"%Serversignature%\"\nX509Certificate2 ServerCertificate;\nAnti = \"false\";\nAes256 aes256 = new Aes256(Key);\nPastebin = \"null\";\nBDOS = \"false\";\nDelay = \"24\";\nGroup = \"Debug\";\n\n### Async rat commands\n\n**Server Commands**\n\npong Get interval from client\n\nplugin Run/Load plugin file\n\nsaveplugin Save and Run plugin file\n\n**Client Commands:**\n\nclientinfo Send system info to server\n\nping Ping server\n\nsendplugin Get plugin from server\n\n### Lime rat settings configuration\n\n_Pastebin = \"https://pastebin.com/raw/DDTVwwbu\"_\n_HOST = \"107.173.143.111\"_\n_PORT = \"8989\"_\n\n\n-----\n\n_EncryptionKey = MZRX_\n_ENDOF = \"|'N'|\"_\n_SPL = \"|'L'|\"_\n_EXE = \"CLIENT.exe\"_\n_USB = \"false\"_\n_PIN = \"false\"_\n_ANTI = \"false\"_\n_DROP = \"false\"_\n_PATH1 = \"Temp\"_\n_PATH2 = \"\\Lime\\\"_\n_fullpath = Environ(PATH1) & PATH2 & EXE_\n_BTC_ADDR = \"THIS IS YOUR BTC 1234567890\" 'Bitcoin address_\n_DWN_CHK = \"true\"_\n_DWN_LINK = \"\"_\n_Delay = \"3\"_\n\n### Lime rat commands\n\n**Server Commands**\n\nIPSend Run timer\n\nIP Stop timer\n\nICAP Capture screen Thumbnail\n\nCPL Check if plugin is installed\n\nIPL Save plugin and then load it (server send plugin)\n\nIPLM Load plugin without saving it (server send plugin)\n\n**Client Commands**\n\nINFO Sends system info\n\nIP Ping to server\n\nIPStart Timer started\n\n#CAP Sending Thumbnail\n\nGPL Get plugin from server\n\nMSG Send Message\n\n\n-----\n\nThese RATs can extend their capabilities using existing or user-defined plugins. At the time of\nanalysis both AsyncRAT and LimeRAT were not getting responses from the C2 server\n“107.173.143.111”\n\n**Detections and Indicators**\n\nFE_APT_Dropper_Macro_DoubleHide_1\n\n**MITRE ATT&CK Techniques**\n\n\nT1071 Application Layer\nProtocol\n\n\nHTTP/DNS requests are used in the C&C traffic\n\n\nT1036 Masquerading The registered task/service pretends to be benign by\nname\n\nT1056 Input Capture Keylogging capabilities\n\nT1113 Screen Capture Can capture the screen of the victim\n\nT1115 Clipboard Data Collect data stored in the clipboard from users copying\ninformation within or between applications.\n\n\nT1049 System Network\nConnections Discovery\n\nT1547 Boot or Logon\nAutostart Execution\n\n\nPerforms network discover for lateral movement into\nnetwork\n\nRun entry is made when persisting via the registry\n\n\nT1204 User Execution Opening malicious xls to execute macro\n\n\nT1041 Exfiltration Over C2\nChannel\n\nT1137 Office Template\nMacros\n\n**IOCs:**\n\n**File Name** **SHA256**\n\n\nSend stolen data using CNC channel\n\nExecute malicious code upon macro execution\n\n\n3_5 7a6b87a7ba79160232579157b8ebcaea7660392d98cb6b8b3d562a383a0894bc\n\n4 5e44f769aa9a745ade82589bbbd17c3687f2fb7c08b1043d8c5c44d28eaa20a9\n\n4_5 fe1c8b01f5abc62551b0a3f59fe1675c66dd506d158f5de495a5d22d7445e6e9\n\n4_5_1 fa9cb5608841f023052379818a9186496526039bc47cac05a6866f5fb0e70fc5\n\n4_5_2 080fcc70c11248eaf34bd30c0dc9800b0b1742fe92c96c9995a1c73c0adf2336\n\n\n-----\n\n4_6 465a59b7a97364bc933703a8fda715090c6a927f814bc22a0057e6a7134cb69f\n\n4_6_1 5e082d1c85e591aebb380d7d7af56000ac0ef5fc32e216cb5fe7027bb9861743\n\n4_7 f59dc209ee236e5ed78f83117865164e57a223f742c75f57c20d3da4cbe179e0\n\n4_7_2 f32b0d71274ea93f27527079371e5e926e8d6a6f29d84ac602e48da0332c9f4c\n\nigfx.exe 8248432bcba6e8bb8731c0b8f2fbe4aae2e2d0fee2157477c83343743c39c1a8\n\nmsword.exe 06064b3b0158efbfa9d849c853a9783c7e9d07c5924275d0d33c6ac74c78eec7\n\nUnknown.xls 886c5883113d279d97caaca2714860dfceb421c7297dbb3ee04a00b7d50b821b\n\nUnknown.ZIP b9584cf67e73a759d6c412962d4a9d7471c703f72e056cd24742a4b78c68ff2d\n\n**URL:hxxps://drive.Google.com/u/0/uc?id=1nU6-**\njGVnOKeZofflu8hfx2t83lAB9TPI&export=download\n\n**CnC:107.173.143.111**\n\n**Email Subjects:**\n\n9th Herat Security Dialogue (HSD- IX) & Chabahar port Update\n\nfeb212021_kabul.contact@gmail.com\n\nInformation & Guidance\n\nFwd: Combined MoFA Recruitment Approval\n\nGuests List - Media Release (Personal & Confidential)\n\nIndian workers missing from the dam project\n\nIndian Nationals ( who were hidden in Kabul ) Killing in Kabul Tonight\n\n11 Indian Nationals found dead in Kabul\n\nCircular\n\nIndian Nationals Killing in Kabul\n\n31 Covid Deaths In 24 Hours: Information campaign by NDTV\n\n**Email Senders:**\n\nkabul.contact@gmail.com\n\nmashrefhaideri@gmail.com\n\n\n-----\n\nlatifmahmood66666@gmail.com\n\nfscon.kab@gmail.com\n\nadmn.kabul@gmail.com\n\nravish49.ndtv@gmail.com\n\nPERSPECTIVES\n\n#### Our CEO On Living Security\n\n\n### Featured Content\n\n\nBy [Bryan Palma · January 19, 2022](https://www.trellix.com/en-us/about/newsroom/stories/contributors/bryan-palma.html)\n\nTrellix CEO, Bryan Palma, explains the critical need for security that’s always learning.\n\n[Read More](https://www.trellix.com/en-us/about/newsroom/stories/perspectives/our-ceo-on-living-security.html)\n\nXDR\n\n#### Time to Drive Change by Challenging the Challengers\n\nBy [Trellix · January 19, 2022](https://www.trellix.com/en-us/about/newsroom/stories/contributors/about-trellix.html)\n\nDynamic threats call for dynamic security – the path to resiliency lies in XDR.\n\n[Read More](https://www.trellix.com/en-us/about/newsroom/stories/xdr/time-to-drive-change-by-challenging-the-challengers.html)\n\nTHREAT LABS\n\n#### 2022 Threat Predictions\n\nBy [Trellix · January 19, 2022](https://www.trellix.com/en-us/about/newsroom/stories/contributors/about-trellix.html)\n\nWhat cyber security threats should enterprises look out for in 2022?\n\n[Read More](https://www.trellix.com/en-us/about/newsroom/stories/threat-labs/2022-threat-predictions.html)\n\n# Get the latest\n\n\n-----\n\nWe’re no strangers to cybersecurity. But we are a new company.\n\nStay up to date as we evolve.\n\nPlease enter a valid email address.\n\nZero spam. Unsubscribe at any time.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-13 - Targeted Attack on Government Agencies.pdf"
    ],
    "report_names": [
        "2022-07-13 - Targeted Attack on Government Agencies.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536081,
    "ts_updated_at": 1743041142,
    "ts_creation_date": 1658168693,
    "ts_modification_date": 1658168693,
    "files": {
        "pdf": "https://archive.orkl.eu/8076a9a0b57231d9b5e74813343806a199235ca7.pdf",
        "text": "https://archive.orkl.eu/8076a9a0b57231d9b5e74813343806a199235ca7.txt",
        "img": "https://archive.orkl.eu/8076a9a0b57231d9b5e74813343806a199235ca7.jpg"
    }
}