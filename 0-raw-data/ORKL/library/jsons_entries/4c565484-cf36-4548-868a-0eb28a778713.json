{
    "id": "4c565484-cf36-4548-868a-0eb28a778713",
    "created_at": "2023-01-12T14:59:51.766963Z",
    "updated_at": "2025-03-27T02:09:30.161609Z",
    "deleted_at": null,
    "sha1_hash": "3e4d9af746c6918284b6931b35e6123e8f8c0ade",
    "title": "2022-11-30 - Identifying and Defending Against QakBot's Evolving TTPs",
    "authors": "",
    "file_creation_date": "2022-12-29T00:20:59Z",
    "file_modification_date": "2022-12-29T00:20:59Z",
    "file_size": 1372019,
    "plain_text": "# Identifying and Defending Against QakBot's Evolving TTPs\n\n**[tidalcyber.com/blog/identifying-and-defending-against-qakbots-evolving-ttps](https://www.tidalcyber.com/blog/identifying-and-defending-against-qakbots-evolving-ttps)**\n\nScott Small\n\nNovember 30, 2022\n\nScott Small\n[Scott Small](https://www.tidalcyber.com/blog/author/scott-small)\nIf you’re an information security practitioner, or just keep up with cybersecurity reporting, you\nhave almost certainly seen QakBot mentioned in your news feeds recently. And if you’re\nkeeping tabs on the Tidal blog, you recently read about how adversaries are evolving their\ntactics, techniques, and procedures (“TTPs”) at alarming rates. In this blog, we will discuss\nwhy most organizations should care about QakBot, and how it represents a clear example of\nadversary TTP evolution (and the importance of threat-informed defense). We’ll also show\nhow Tidal’s free Community Edition can help identify the latest TTPs associated with threats\nlike QakBot, and give practical, actionable guidance for defending against these adversary\n[behaviors. Explore the Community Edition here, and don’t forget to create an account to](https://app.tidalcyber.com/)\nsave and customize the QakBot Technique Sets shared below and to engage others in the\nthreat-informed defense space in our Community Slack!\n\n## What is QakBot, and Why is it a Concern?\n\n\n-----\n\nIn our view, most organizations should include QakBot in their threat profile, a register of the\nmost notable cyber threats relevant to the organization and its industry. [QakBot (also known](https://app.tidalcyber.com/software/9050b418-5ffd-481a-a30d-f9059b0871ea-QakBot)\nas QBot and Pinkslipbot) is a prolific malware tied to a large number of attacks since its\ndebut in 2007. Historically, QakBot operators have executed intense campaigns (individual\nvendors can see 1,000+ detections per month), followed by lulls in activity. QakBot has\n[attacked victims in virtually every major industry.](https://www.cisa.gov/sites/default/files/publications/202010221030_QakBot%20TLPWHITE.pdf)\n\nQakBot was originally designed as a banking Trojan, a type of malware built to steal financial\ninformation, but it now includes many “modules” that broaden its functionality. Notably, in\nrecent years, security teams have observed QakBot being used in association with malware\ndesigned for a range of other purposes, including pre- and post-infection activities. These\ninclude other prolific malware responsible for attacks on victims in very many industries, such\nas [Cobalt Strike, Emotet, and Brute Ratel. Security teams typically use factors like these to](https://www.trendmicro.com/en_us/research/22/j/black-basta-infiltrates-networks-via-qakbot-brute-ratel-and-coba.html)\nfurther elevate a threat’s priority level within their threat profile.\n\n## QakBot: A Case Study in TTP Evolution\n\n[As we highlighted in our last blog, adversaries are increasingly demonstrating the ability to](https://www.tidalcyber.com/blog/adversary-ttp-evolution-and-the-value-of-ttp-intelligence)\nmodify their behaviors, in some cases with incredible speed. QakBot represents a clear\nexample of this trend. After a lull in activity last summer, QakBot operators resumed attacks\nin September 2021. QakBot infections at the time [relied heavily on malicious Excel email](https://www.microsoft.com/en-us/security/blog/2021/12/09/a-closer-look-at-qakbots-latest-building-blocks-and-how-to-knock-them-down/)\nattachments containing macros, which serve as efficient means of automating malicious\ncommand execution built into common file types. In direct response to frequent macro abuse\nby QakBot and other threats, Microsoft [announced in February 2022 that it would begin to](https://techcommunity.microsoft.com/t5/microsoft-365-blog/helping-users-stay-safe-blocking-internet-macros-by-default-in/ba-p/3071805)\nblock macro execution in popular Microsoft Office file types when those files were\ndownloaded from the Internet, which includes files attached to or linked within spam emails\n\n\n-----\n\nlike those frequently delivered during QakBot campaigns. This new security measure is\nachieved by assigning a hidden value, known as Mark of the Web (“MotW”), to files\noriginating from the Internet.\n\nQakBot operators appeared to adapt to this significant new security measure and began to\nimplement alternative infection techniques to bypass these MotW protections for Office files\n[almost immediately. Researchers from Hornetsecurity began to observe QakBot spam](https://www.hornetsecurity.com/en/threat-research/email-threat-review-july-2022/)\n[emails now containing HTML attachments, which provide a stealthy means of downloading](https://outflank.nl/blog/2018/08/14/html-smuggling-explained/)\nadditional files (in this case ZIP files) that contained multiple other file types (ISOs, LNKs,\nand DLLs), which were accessed sequentially to ultimately run the main QakBot executable.\nThe Hornetsecurity researchers witnessed a major drop in the rate of Excel email\n[attachments, from 22% of all malicious attachments in March to just 4% in](https://www.hornetsecurity.com/en/threat-research/email-threat-review-march-2022/) [September, while](https://www.hornetsecurity.com/en/threat-research/email-threat-review-september-2022/)\n[Proofpoint researchers observed a dramatic rise in the prevalence of ISO email attachments](https://www.proofpoint.com/us/blog/threat-insight/how-threat-actors-are-adapting-post-macro-world)\nand campaigns involving LNK files beginning in March and February, respectively (as well as\na large drop in macro-enabled email attachments starting in March).\n\nWith the November 8 Patch Tuesday updates, Microsoft took further steps to address some\n[of these techniques, announcing that MotW security features would propagate to relevant](https://twitter.com/BillDemirkapi/status/1590062146486140928)\n[files contained within ISO files, among other relevant fixes. However, just six days after this](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-41049)\nannouncement, QakBot appeared to evolve its technique set once again, as security teams\n[observed QakBot infections involving files crafted to bypass some of these latest protections.](https://www.cybereason.com/blog/threat-alert-aggressive-qakbot-campaign-and-the-black-basta-ransomware-group-targeting-u.s.-companies)\nInterestingly, QakBot operators may have adopted this latest defense evasion method from\n[other threat actors, as the infection vector was recently observed in a campaign involving](https://threatresearch.ext.hp.com/magniber-ransomware-switches-to-javascript-targeting-home-users-with-fake-software-updates/)\nMagniber ransomware.\n\n## Defending Against QakBot’s Evolving TTPs\n\nQakBot’s repeated TTP evolution over the past year alone highlights why a threat-informed\napproach to defense is absolutely necessary; without intelligence around QakBot’s current\ntechniques, you could be focusing defensive resources on techniques that are now less\nrelevant (an especially impactful issue if QakBot is one of the top-priority adversaries in your\nthreat profile). Let’s now take a look at how Tidal’s free Community Edition can help identify\ntechniques – and, importantly, relevant defensive capabilities – associated with QakBot’s\nrecent TTP evolutions.\n\nFor a historical baseline, we can begin by loading the set of techniques associated with\nQakBot from the MITRE ATT&CK® knowledge base into Tidal’s matrix view. This set covers\n[64 techniques linked with QakBot based on nine public reports from June 2020 to September](https://app.tidalcyber.com/software/9050b418-5ffd-481a-a30d-f9059b0871ea-QakBot)\n2021:\n\n\n-----\n\nNext, let’s examine the body of more recent public threat intelligence around QakBot. For\n[these examples, I compiled custom Tidal Technique Sets based on 16 reports that I could](https://www.tidalcyber.com/blog/making-it-easier-to-navigate-layers-with-technique-sets-and-matrices)\nquickly surface online and which had readily identifiable technique details – certainly not the\nfull body of QakBot reporting since last year, but a good amount to show depth within the\n[technique data. Overlaying the custom technique set, which also comprised 64 techniques,](https://app.tidalcyber.com/share/f12a3c04-8857-4c5d-89ff-eeb03e8a53d1)\nonto the ATT&CK knowledge base set revealed 37 techniques which were exclusively\nreferenced in the most recent QakBot intelligence reporting (October 2021-October 2022).\nThe darker shades of red represent references in more reports in the recent dataset, with a\nrange of one to eight reports:\n\n\n-----\n\nThis [final view rearranges the same technique datasets discussed above into three sets of](https://app.tidalcyber.com/share/124cf65a-cf7d-4a7d-81d0-22371e923b02)\ntechniques organized by time period: the ATT&CK knowledge base, which covers June\n2020-September 2021 reporting (yellow), October 2021-March 2022 (orange), and April\n2022-October 2022 (red). This visual helped surface techniques that were newly reported\nduring each of the recent phases of QakBot’s TTP evolution (prior to the current activity\nwaves starting last fall, and before and after the period around the macro-blocking\nannouncement this year), to more accurately see where technique use shifted:\n\n\n-----\n\nThe following graphic summarizes the key techniques newly reported during each time\nperiod:\n\n\n-----\n\nThe Community Edition enables intuitive pivoting and overlays of defensive capabilities\naligned with the same adversary techniques described in threat intelligence reporting. Our\ntop guidance around the key techniques discussed in this blog (and covered in the linked\nQakBot Technique Sets) includes:\n\n**Delivery: Most QakBot infections begin with malicious file delivery via phishing,**\n[including spearphishing attachments and](https://app.tidalcyber.com/tactics/586a5b49-c566-4a57-beb4-e7c667f9c34c-Initial%20Access/technique/ba553ad4-5699-4458-ae4e-76e1faa43291-Spearphishing%20Attachment) [spearphishing links. Robust email security](https://app.tidalcyber.com/tactics/586a5b49-c566-4a57-beb4-e7c667f9c34c-Initial%20Access/technique/d08a9977-9fc2-46bb-84f9-dbb5187c426d-Spearphishing%20Link)\nand anti-phishing capabilities are recommended to mitigate these first stages of most\nQakBot attacks. User training and awareness around current phishing techniques is\nalso highly encouraged. In an effort to further trick victims, QakBot is known to hijack\nlegitimate email threads for initial malware delivery, either by compromising legitimate\n[accounts, and recently by hijacking external/third-party email threads.](https://duo.com/decipher/qakbot-attack-uses-email-threads-hijacked-from-proxylogon-compromises)\n**User Execution: Macro-based techniques observed during the first phase of QakBot’s**\nrecent activity typically relied on users manually clicking to enable macros, while later\nattacks used email content themes that lured users into downloading attachments and\nopening one or even multiple downloaded files. Mitigations around user interaction and\n[execution of suspicious files and links, including blocking of certain executables not](https://app.tidalcyber.com/tactics/dad2337d-6d35-410a-acc5-da36ff83ee44-Execution/technique/b84435ab-2ff4-4b6f-ba71-b4b815474872-User%20Execution)\ntypically seen in the environment and user training and awareness, are highly\nrecommended.\n**Initial Footholds: While writing detections for all possible variations of HTML**\nSmuggling may be challenging, Microsoft suggests policies around automatic\n[Javascript code execution and other mitigations here. Red Canary published an](https://www.microsoft.com/en-us/security/blog/2021/11/11/html-smuggling-surges-highly-evasive-loader-technique-increasingly-used-in-banking-malware-targeted-attacks/)\n[excellent explainer and defensive guidance around attacks leveraging ISO files to](https://redcanary.com/blog/iso-files/)\n[bypass MotW protections, and Huntress recently shared an approach to disable ISO](https://support.huntress.io/hc/en-us/articles/11477430445587-How-to-disable-ISO-mounting)\n[mounting by default entirely. We were only able to identify a limited amount of](https://blog.0patch.com/2022/10/free-micropatches-for-bypassing-motw.html)\ndefensive guidance around the latest, yet-unpatched MotW bypass technique involving\nfiles with “malformed” signatures. Keep in mind too that, despite new macro-related\nsafeguards, threat actors [have not entirely abandoned Excel and other macro-](https://www.hornetsecurity.com/en/threat-research/email-threat-review-october-2022/)\nsupported documents as malicious email attachments. Security teams should use this\nknowledge to inform hunting and detection prioritization.\n\n**Regsvr32: The Regsvr32 technique had the highest overall reference count (eight) in**\nthe October 2021-October 2022 Technique Set discussed above, seven of which\nappeared in the recent April-October 2022 period. Adversaries abuse regsvr32.exe to\n[proxy execution of malicious code. See the Regsvr32 Technique Details page to pivot](https://app.tidalcyber.com/technique/b1da2b02-9ade-45e0-a795-ec1b19e5316a-Regsvr32)\nto five Products with capabilities mapped to this technique, as well as 16 open-source\nAnalytics. Red Canary’s recent [Intelligence Insights also provides a good strategy for](https://redcanary.com/blog/intelligence-insights-october-2022/)\ndetecting a recent, specific QakBot implementation of this technique.\n\n\n-----\n\n**Other Post-Exploit Techniques: Detection opportunities and other defensive**\ncapabilities exist around many of the other techniques not yet discussed here.\nCommunity Edition users can use the Technique Details pages to easily pivot to\n[Products and](https://app.tidalcyber.com/vendors) [Analytics aligned with adversary techniques. Readers are encouraged to](https://app.tidalcyber.com/analytics/)\nfocus especially on techniques most recently observed in association with QakBot, like\nthose highlighted in the list in the graphic above. A few other recently observed post[exploit techniques include: Rundll32,](https://app.tidalcyber.com/technique/5652575d-cdb9-44ef-9c32-fff038f15444-Rundll32) [Process Injection,](https://app.tidalcyber.com/technique/7a6208ac-c75e-4e73-8969-0aaf6085cb6e-Process%20Injection) [Scheduled Task,](https://app.tidalcyber.com/technique/723c6d51-91db-4658-9ee0-eafb953c2d82-Scheduled%20Task) System\nBinary Proxy Execution, [File Deletion, and](https://app.tidalcyber.com/technique/d36695d0-e4ab-4b8a-9c65-bab3cc34ef2c-File%20Deletion) [Impair Defenses. A set of Sigma analytics](https://app.tidalcyber.com/technique/e3be3d76-0a36-4060-8003-3b39c557f728-Impair%20Defenses)\nwritten directly around recent QakBot technique implementations, including DLL\nexecution & loading, process injection, and scheduled tasks, can be found in Micah\nBabinski’s GitHub repository.\n**Logging & Data Sources: The Technique Details pages can also be used to pivot to**\nrelevant Data Sources that, if logged, can provide visibility into instances of adversary\ntechnique use (you can also view the full list of ATT&CK Data Sources [here and add](https://app.tidalcyber.com/datasources)\nthem to your own matrix views).\n**Branching Out: The Technique Details pages enable quick pivoting to relevant**\ncapabilities and analytics, saving time when trying to surface detections or capabilities\nthat align directly with QakBot technique implementations (Procedures). They can also\nprovide a springboard for testing and strengthening detections around other\nimplementations of the same techniques. This is especially important as we consider\n_how often and how quickly QakBot has evolved its technique set in recent times._\nBeyond just the Procedures observed in recent QakBot reporting, considering atomic\ntesting, simulation, or emulation around variations on these technique implementations\nin an effort to proactively address possible TTP shifts by QakBot (and other actors and\nmalware).\n\n_*Note: The_ _[Mark-of-the-Web Bypass technique was not explicitly mentioned in any of the](https://app.tidalcyber.com/technique/7ee64e42-6d3b-47f8-a2a9-55263537bd51-Mark-of-the-Web%20Bypass)_\n_source reporting we reviewed. Reported incident investigations may not have determined (or_\n_may not have disclosed) whether certain files possessed or did not possess MotW_\n_signatures. However, given the suspected use of ISO files to help bypass MotW safeguards,_\n_we are highlighting the technique here to represent the three reports in our sample that_\n_described QakBot infections involving ISO files._\n\nFree Guide\n\n### How to increase your Facebook reach by over 200% with this simple trick\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros\nelementum tristique.\n\n\n-----\n\n[Download Guide](https://484997.hs-sites.com/lively/contact)\n\n### Subscribe to our newsletter\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-11-30 - Identifying and Defending Against QakBot's Evolving TTPs.pdf"
    ],
    "report_names": [
        "2022-11-30 - Identifying and Defending Against QakBot's Evolving TTPs.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535591,
    "ts_updated_at": 1743041370,
    "ts_creation_date": 1672273259,
    "ts_modification_date": 1672273259,
    "files": {
        "pdf": "https://archive.orkl.eu/3e4d9af746c6918284b6931b35e6123e8f8c0ade.pdf",
        "text": "https://archive.orkl.eu/3e4d9af746c6918284b6931b35e6123e8f8c0ade.txt",
        "img": "https://archive.orkl.eu/3e4d9af746c6918284b6931b35e6123e8f8c0ade.jpg"
    }
}