{
    "id": "bb1ca091-fc54-4fbf-896c-5a938b150eb9",
    "created_at": "2022-10-25T16:48:22.500664Z",
    "updated_at": "2025-03-27T02:15:26.155474Z",
    "deleted_at": null,
    "sha1_hash": "a5ae4b957e4871ae1978d30bbfd71bf12d0daf02",
    "title": "",
    "authors": "",
    "file_creation_date": "2022-04-07T10:52:36Z",
    "file_modification_date": "2022-04-07T10:52:45Z",
    "file_size": 1518514,
    "plain_text": "# A Bad Luck BlackCat\n\n## GReAT\n\n\n-----\n\nIn early December 2021, a new ransomware actor started advertising its services on a Russian underground\nforum. They presented themselves as ALPHV, a new generation Ransomware-as-a-Service (RaaS) group.\nShortly afterwards, they dialed up their activity, infecting numerous corporate victims around the world.\nThe group is also known as BlackCat.\n\nOne of the biggest differences from other ransomware actors is that BlackCat malware is written in Rust,\nwhich is unusual for malware developers. Their infrastructure websites are also developed differently from\nother ransomware groups. Due to Rust’s advanced cross-compilation capabilities, both Windows and Linux\nsamples appear in the wild. In other words, BlackCat has introduced incremental advances and a shift in\n**technologies to address the challenges of ransomware development.**\n\nThe actor portrays itself as a successor to notorious ransomware groups like BlackMatter and REvil. The\ncybercriminals claim they have addressed all the mistakes and problems in ransomware development and\ncreated the perfect product in terms of coding and infrastructure. However, some researchers see the\ngroup not only as the successors to the BlackMatter and REvil groups, but as a complete rebranding. Our\ntelemetry suggests that at least some members of the new BlackCat group have links to the BlackMatter\ngroup, because they modified and reused a custom exfiltration tool we call Fendr and which has only been\nobserved in BlackMatter activity.\n\nThis use of a modified Fendr, also known as ExMatter, represents a new data point connecting BlackCat\nwith past BlackMatter activity. The group attempted to deploy the malware extensively within organizations in December 2021 and January 2022. BlackMatter prioritized collection of sensitive information with\nFendr to successfully support their scheme of two-pronged coercion. In addition, the modification of this\nreused tool demonstrates a more sophisticated planning and development regimen for adapting requirements to target environments, characteristic of a maturing criminal enterprise.\n\n\n-----\n\n## Two incidents of special interest\n\n**Two recent BlackCat incidents stand out as particularly interesting. One demonstrates the risk presented by**\nshared cloud hosting resources, and the other demonstrates an agile approach to customized malware re-use\nacross BlackMatter and BlackCat activity.\n\nIn the first case, it appears the ransomware group penetrated a vulnerable ERP provider in the Middle East\nhosting multiple sites. The attackers delivered two different executables simultaneously to the same physical\nserver, targeting two different organizations virtually hosted there. The initial access was mistaken by the\nattackers for two different physical systems and drives to infect and encrypt. The kill chain was triggered prior\nto the “pre-encryption” activity, but the real point of interest here lies in the shared vulnerabilities and thedemonstrable risk of shared assets across cloud resources. At the same time, the group also delivered a Mimikatz\nbatch file along with executables and Nirsoft network password recovery utilities. In a similar incident dating\nback to 2019, REvil, a predecessor of BlackMatter, appears to have penetrated a cloud service supporting a\nlarge number of dental offices in the US. Perhaps this same affiliate has reverted to some old tactics.\n\nThe second case involves an oil, gas, mining and construction company in South America. This related\nincident further connects BlackMatter ransomware activity with BlackCat. Not only did the affiliate behind\nthis ransomware incident attempt to deliver BlackCat ransomware within the target network, but approximately\n1 hour 40 minutes before its delivery they installed a modified custom exfiltration utility that we call Fendr. Also\nknown as ExMatter, this utility had previously been used exclusively in BlackMatter ransomware activity.\n\nHere, we can see that the BlackCat group increased the number of file extensions for automatic collection and\nexfiltration by the tool:\n\nFendr file extensions (17146b91dfe7f3760107f8bc35f4fd71)\n\n.doc .docx .xls .xlsx .xlsm .pdf\n\n.msg .ppt .pptx .sda .sdm .sdw\n\n.zip .json .config .ts .cs .sqlite\n\n.aspx .pst .rdp .accdb .catpart .catproduct\n\n.catdrawing .3ds .dwt .dxf .csv\n\nThese additional file extensions are used in industrial design applications, like CAD drawings and some databases,\nas well as RDP configuration settings, making the tool more customized towards the industrial environments\nthat we see being targeted by this group. And, if we believe the PE header timestamp, the group compiled\nthis Fendr modification just a few hours before its initial use. One of the organizations targeted with the Fendr\nexfiltration tool has branches all over the world, resulting in a surprising mix of locations. Not all of the systems\nreceived a ransomware executable.\n\n|Fendr file extensions (17146b91dfe7f3760107f8bc35f4fd71)|Col2|Col3|Col4|Col5|Col6|\n|---|---|---|---|---|---|\n|.doc|.docx|.xls|.xlsx|.xlsm|.pdf|\n|.msg|.ppt|.pptx|.sda|.sdm|.sdw|\n|.zip|.json|.config|.ts|.cs|.sqlite|\n|.aspx|.pst|.rdp|.accdb|.catpart|.catproduct|\n|.catdrawing|.3ds|.dwt|.dxf|.csv||\n\n\n-----\n\n## Technical details\n\n**MD5** B6B9D449C9416ABF96D21B356A41A28E\n\n**SHA1** 38fa2979382615bbee32d1f58295447c33ca4316\n\n**SHA256** be8c5d07ab6e39db28c40db20a32f47a97b7ec9f26c9003f9101a154a5a98486\n\n**Compiler** Rust\n\n**Filesize** 2.94 MB\n\nThe analyzed BlackCat ransomware file “<xxx>_alpha_x86_32_windows_encrypt_app.exe” is a 32-bit Windows\nexecutable file that was coded in Rust. The resulting Rust compiled binaries use the Rust standard library with\na lot of safety checks, memory allocations, string processing, and other operations. They also include various\nexternal crates with libraries for required functionality, like Base64, AES encryption, etc. This particular language,\nand its compilation overhead, makes disassembly analysis more complicated. However, with the proper approach and Rust STD function signatures applied in IDA (or your disassembler of choice, for example Ghidra), it‘s\npossible to understand the full malware capabilities with static analysis. Additional Rust library usage can be\nobtained from strings in clear form as no obfuscation is whatsoever used by the malware:\n\nExternal cargo is used in malware\n\nRust is a cross-compilation language, so a number of BlackCat Linux samples quickly appeared in the wild shortly\nafter their Windows counterparts.\n\nThis BlackCat sample is a command line application. After execution, it checks the command line arguments\nprovided:\n\nCommand line arguments for malware\n\n|MD5|B6B9D449C9416ABF96D21B356A41A28E|\n|---|---|\n|SHA1|38fa2979382615bbee32d1f58295447c33ca4316|\n|SHA256|be8c5d07ab6e39db28c40db20a32f47a97b7ec9f26c9003f9101a154a5a98486|\n|Compiler|Rust|\n|Filesize|2.94 MB|\n\n\n-----\n\np, p, g,\nprobably cash-out. Anyone who already has access to compromised environments can use BlackCat’s samples\n**to infect a target. And a little help with ransomware execution is likely to come in handy.**\n\nThe command line arguments are pretty self-explanatory. Some are related to VM’s, such as wiping or not wiping\nVM snapshots or stopping VM on ESXi. Also, it‘s possible to select specific file folders to process or execute\nmalware as a child process.\n\nShortly after execution, the malware gets the “MachineGuid” from the corresponding Windows registry key:\n\nObtaining machine GUID\n\nThis GUID will be used later in the encryption key generation process.\n\nThe malware then gets a unique machine identifier (UUID) using a WMIC query executed as a separate command\nby creating a new cmd.exe process:\n\nObtaining UUID\n\nThis UUID is used together with the “--access-token” command-line argument to generate a unique ACCESS_KEY\nfor victim identification.\n\nBlackCat ransomware uses Windows named pipes for inter-process communication. For example, data returned\nby the cmd.exe process will be written into named pipes and later processed by malware:\n\nPipe creation\n\n\n-----\n\nThe names of the pipes are not unique and are hard coded into malicious samples.\n\nThe malware checks which version of the Windows operating system it‘s being executed under. That is done\nusing the fairly standard technique of getting this information from the Process Environment Block structure:\n\nObtaining OS version\n\nThe operating system version is required to implement a proper Privilege Escalation technique such as:\n\n- Simple process token impersonation\n\n- COM elevation moniker UAC Bypass\n\nCOM object initialization\n\n[The malware uses a previously known technique, used by LockBit ransomware, for example, to exploit an undo-](https://gist.github.com/api0cradle/d4aaef39db0d845627d819b2b6b30512)\ncumented COM object (3E5FC7F9-9A51-4367-9063-A120244FBEC7). It is vulnerable to the CMSTPLUA UAC\nbypass.\n\nUsing “cmd.exe” malware executes a special command:\n\n\nfsutil behavior set SymlinkEvaluation R2L:1\n\n\nThis command adjusts the behavior of the Windows file system symlinks. It allows the malware to follow shortcuts\nwith remote paths.\n\nAnother command executed as part of pre-encryption is:\n\n\nvssadmin.exe delete shadows /all /quiet\n\n\n-----\n\nThis is almost standard for any ransomware and deletes all Windows shadow copy backups. Then the malware\ngets a list of services to be killed, as well as files and folders to be excluded from the encryption process, kills\nprocesses and starts encryption using separate working threads:\n\nEmbedded process list to kill\n\nThis particular sample was observed to be run with “--access-token xxx --no-prop-servers \\\\xxx --propagated”\ncommand line parameters. In addition to the activity detailed above, the malware will attempt to propagate, but\nwill not re-infect the server that it is attempting to run on. It will perform a hard stop on any IIS services hosted\non the system with „iisreset.exe /stop”, check the local area network for immediately reachable systems with\n“arp -a”, and increase the upper limit on the number of concurrent commands that can be outstanding between\na client and a server by increasing the MaxMpxCt to the maximum allowed with:\n\n\ncmd /c reg add\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters /v\nMaxMpxCt /d 65535 /t REG_DWORD /f\n\n\nAlso, it is notable that the group uses a compressed version of PsExec to spread laterally within an organization,\nas was observed with the remote execution of this sample.\n\nThe malware appends an extension to the encrypted files, but the exact extension varies from sample to sample.\nThe extension can be found hard-coded in the malware’s JSON formatted configuration file.\n\nFor encryption, the malware used the standard “BCryptGenRandom” Windows API function to generate encryption keys. AES or CHACHA20 algorithms are used for file encryption. The global public key that is used to\nencrypt local keys is extracted from the configuration file.\n\nMost of these executables maintain a hard-coded set of username/password combinations that were stolen\nearlier from the victim organization for use during propagation and privilege escalation. There often appears\nto be almost half a dozen accounts, and a combination of domain administrative and service level credentials.\nThis means the individual executable is compiled specifically for the target organization, containing sensitive\n**information about the organization.**\n\nAfter the encryption process, the malware drops a ransomware note with details on how to contact the BlackCat\nransomware operators.\n\n\n-----\n\n## Conclusion\n\nAfter the REvil and BlackMatter groups shut down their operations, it was only a matter of time before another\nransomware group took over the niche. Knowledge of malware development, a new written-from-scratch sample\nin an unusual programming language, and experience in maintaining infrastructure is turning the BlackCat group\ninto a major player on the ransomware market.\n\n\nHere we present a new data point connecting BlackCat with past BlackMatter activity - the reuse of the exfiltration malware Fendr. The group modified the malware for a new set of victims collected from data stores\ncommonly seen in industrial network environments. BlackCat attempted to deploy the malware extensively\nwithin at least two organizations in December 2021 and January 2022. In the past, BlackMatter prioritized collection of sensitive information with Fendr to successfully support their two-pronged coercion scheme, just as\nBlackCat is now doing, and it demonstrates a practical but brazen example of malware re-use to execute their\nmulti-layered blackmail. The modification of this reused tool demonstrates a more sophisticated planning and\ndevelopment regimen for adapting requirements to target environments, characteristic of a more effective and\nexperienced criminal program.\n\n[Cyber Threats News: https://securelist.com/](https://securelist.com/)\n[IT-Sicherheitsnachrichten: kaspersky.de/blog/b2b/](https://www.kaspersky.de/blog/category/business/)\n[IT-Sicherheit für KMUs: kaspersky.de/business](http://kaspersky.de/business)\n[IT-Sicherheit für Großunternehmen: kaspersky.de/enterprise](http://kaspersky.de/enterprise )\n\n\n**[kaspersky.de](http://www.kaspersky.de/)**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://go.kaspersky.com/rs/802-IJN-240/images/TR_BlackCat_Report.pdf"
    ],
    "report_names": [
        "TR_BlackCat_Report.pdf"
    ],
    "threat_actors": [
        {
            "id": "6e23ce43-e1ab-46e3-9f80-76fccf77682b",
            "created_at": "2022-10-25T16:07:23.303713Z",
            "updated_at": "2025-03-27T02:02:09.727245Z",
            "deleted_at": null,
            "main_name": "ALPHV",
            "aliases": [
                "ALPHV",
                "ALPHVM",
                "BlackCat Gang",
                "UNC4466"
            ],
            "source_name": "ETDA:ALPHV",
            "tools": [
                "ALPHV",
                "ALPHVM",
                "BlackCat",
                "GO Simple Tunnel",
                "GOST",
                "Impacket",
                "LaZagne",
                "MEGAsync",
                "Mimikatz",
                "Munchkin",
                "Noberus",
                "PsExec",
                "Remcom",
                "RemoteCommandExecution",
                "WebBrowserPassView"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716502,
    "ts_updated_at": 1743041726,
    "ts_creation_date": 1649328756,
    "ts_modification_date": 1649328765,
    "files": {
        "pdf": "https://archive.orkl.eu/a5ae4b957e4871ae1978d30bbfd71bf12d0daf02.pdf",
        "text": "https://archive.orkl.eu/a5ae4b957e4871ae1978d30bbfd71bf12d0daf02.txt",
        "img": "https://archive.orkl.eu/a5ae4b957e4871ae1978d30bbfd71bf12d0daf02.jpg"
    }
}