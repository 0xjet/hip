{
    "id": "64492cd0-2439-4828-8e34-fb1f44ff2cf2",
    "created_at": "2023-01-12T14:58:52.134213Z",
    "updated_at": "2025-03-27T02:14:34.164201Z",
    "deleted_at": null,
    "sha1_hash": "45ca1bdf11162f0351094e8a57d391342f1fc6e6",
    "title": "2019-07-24 - Watching the WatchBog- New BlueKeep Scanner and Linux Exploits",
    "authors": "",
    "file_creation_date": "2022-05-28T15:16:44Z",
    "file_modification_date": "2022-05-28T15:16:44Z",
    "file_size": 1881611,
    "plain_text": "# Watching the WatchBog: New BlueKeep Scanner and Linux Exploits\n\n**[intezer.com/blog/linux/watching-the-watchbog-new-bluekeep-scanner-and-linux-exploits/](https://intezer.com/blog/linux/watching-the-watchbog-new-bluekeep-scanner-and-linux-exploits/)**\n\nJuly 24, 2019\n\nWritten by [Paul Litvak and](https://www.intezer.com/author/paullitvak/) [Ignacio Sanmillan - 24 July 2019](https://www.intezer.com/author/nacho/)\n\n## Get Free Account\n\nJoin Now\n\n**Overview**\n\nWe have discovered a new version of WatchBog—a cryptocurrency-mining botnet\noperational since late 2018—that we suspect has compromised more than 4,500\nLinux machines in newer campaigns taking place since early June.\nAmong the new Linux exploits, this version of WatchBog implements a BlueKeep RDP\nprotocol [vulnerability scanner module, which suggests that WatchBog is preparing a](https://www.intezer.com/blog/linux/hiddenwasp-malware-targeting-linux-systems/)\nlist of vulnerable systems to target in the future or to sell to third party vendors for\nprofit.\nThe malware is currently undetected by all security vendors.\nIn this blog post we provide prevention and response recommendations for Windows\nand Linux users, in addition to a YARA signature for detecting this and future threats\nthat share the same malicious code.\n\n**Introduction**\n\n\n-----\n\nWatchBog is a cryptocurrency-mining botnet that was spotted as early as November 2018.\nThe group is known to be exploiting known vulnerabilities to compromise Linux servers. The\n[group was documented in the past by the Alibaba Cloud Security department.](https://www.alibabacloud.com/blog/return-of-watchbog-exploiting-jenkins-cve-2018-1000861_594798)\n\nSince the last publication regarding this group, it has upgraded its implants by implementing\na new spreading module in order to improve the coverage of vulnerable servers. We have\ndetected a new version of WatchBog, which incorporates recently published exploits—\namong them being Jira’s CVE-2019-11581 (added 12 days after the release of the exploit),\nExim’s CVE-2019-10149, and Solr’s CVE-2019-0192.\n\nWe also found that this spreader module incorporated a BlueKeep scanner.\n\n[BlueKeep, also known as CVE–2019-0708, is a Windows-based kernel vulnerability, which](https://en.wikipedia.org/wiki/Common_Vulnerabilities_and_Exposures_(identifier))\nallows an attacker to gain RCE over a vulnerable system. The vulnerability is present in\nunpatched Windows versions ranging from Windows 2000 to Windows Server 2008 and\nWindows 7. There is no known public PoC available for achieving RCE with this\nvulnerability, and no attack has been spotted in the wild yet. The incorporation of this\nscanner module suggests that WatchBog is preparing a list of vulnerable systems for future\ndevelopments with regards to BlueKeep.\n\nThe Jira, Solr and BlueKeep scanner modules were all added in the time frame of 13 days.\nWatchBog seems to be accelerating the incorporation of new functionalities as of late.\n\nThe spreader binary is currently undetected by security vendors:\n\n[VirusTotal](https://www.virustotal.com/gui/file/b17829d758e8689143456240ebd79b420f963722707246f5dc9b085a411f7b5e/detection)\n\nAfter uploading this file to Intezer Analyze we can immediately see that it shares code with\nWatchBog, before even beginning to reverse engineer the file:\n\n\n-----\n\n[Intezer Analyze analysis](https://analyze.intezer.com/#/files/b17829d758e8689143456240ebd79b420f963722707246f5dc9b085a411f7b5e)\n\nWhile investigating this new spreader module, we discovered a flaw with its design that\nallowed us to stage a ‘man-in-the-middle’ attack, to help us analyze the binary. We provide\nan analysis of this module in the technical analysis below.\n**Technical Analysis**\n\nThe WatchBog threat actor group runs an initial deployment script when infecting a target.\nThis script sets up persistence via crontab and downloads further Monero miner modules\nfrom Pastebin, as has been previously documented by Alibaba Cloud.\n\nThe interesting addition to this script is the following part in the end of the script:\n\nAs per the WatchBog’s script’s typical way of operating, the script downloads another\nbase64-encoded payload from Pastebin, which further downloads another module and then\nexecutes it:\n\nHowever, this is not another miner module. Rather, it is the new spreader module.\n\nFrom a quick view this is a plain dynamically linked ELF executable. However, once we\nstarted analyzing the executable, we were surprised to see that this was actually a Cythoncompiled executable requiring us to expand our analysis efforts.\n\n\n-----\n\nCython-compiled binary\n\nAs stated by [this Medium article about Cython:](https://medium.com/@xpl/protecting-python-sources-using-cython-dcd940bb188e)\n\n[“MeetCython, an optimizing static compiler that takes your .py modules and translates](http://cython.org/?source=post_page---------------------------)\nthem to high-performant C files. Resulting C files can be compiled into native binary\nlibraries with no effort. When the compilation is done there’s no way to reverse compiled\nlibraries back to readable Python source code!”.\n\nThe compiled binary does, however, include some hints to the original Python module:\n\n**Initialization**\n\nInitially, the binary creates a file at /tmp/.gooobb in which it writes its pid as a footprint of the\nmalware execution. Consequent attempts to launch the spreader will fail while this file\nexists.\n\nThe binary then retrieves its C2 servers from Pastebin:\n\n\n-----\n\nAn .onion C2 server address is also hardcoded in the binary and is used as a fallback.\n\nWe can estimate the number of victims infected based on the number of visits to the\nPastebin links:\n\nAs seen above, we suspect around 4,500 endpoints were infected with the use of these\nspecific Pastebin links. As WatchBog is known to have been active before June 5—which is\nthe upload date of these Pastebins—we believe additional machines may have been\ninfected with the use of older Pastebin links.\n\nThe binary first attempts to connect to one of the available static C2 servers.\n\nWe observed that the onion C2 server had an expired certificate.\n\nNormally, HTTPS clients check the validation of the SSL certificate that they are interacting\nwith. However, this was not the case with WatchBog’s implants. This led us to assume that\nthe WatchBog client did not verify the certificate when using HTTPS, otherwise it would\nreject it and refuse to communicate with the C2.\n\nThis flaw allowed us to setup a transparent HTTPS proxy with our own certificate and stage\na ‘man-in-the-middle’ attack to analyze WatchBog SSL/TLS traffic:\n\n\n-----\n\nThe binary then generates a unique key for the infected victim and sends an initial message\nto the C2 under this key. The following images include a sample request and response\npayloads from the SSL/TLS decrypted traffic:\n\nThese packets were encoded to obfuscate its content. During the analysis, we were able to\ndetermine the encoding algorithm used. The following script decodes the payload:\n\n\n-----\n\n```\nfinal \narr = input()\nfor a in arr:\n      stri = \"begin 666 \\n{0}\\n \\nend\\n\".format(a) \\\n      .decode(\"uu\").strip('\\x00') \\\n      .decode(\"hex\") \\\n      .decode(\"base64\")\n     final += chr(int(stri))\nprint(final[::-1])\n\n```\nThe initial message contains the compromised system information:\n\nThis information will be merged and hashed to build the route of WatchBog’s API hosted in\nits CNCs. The server replies with a “task” for the bot to perform on a list of targets:\n\n**BlueKeep Scanner**\n\nIn this newer version of WatchBog it seems that the group has integrated an RDP scanner\n[in order to find vulnerable Windows machines to the BlueKeep vulnerability. This scanner is](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708)\n[a Python port from zerosum0x0’s scanner hosted in Github. We can make this](https://github.com/zerosum0x0/CVE-2019-0708)\nassessment based on function name similarities:\n\nThe scanner will then attempt to find vulnerable RDP servers from the IP list provided by\nthe CNC:\n\n\n-----\n\nWatchBog scanning RDP ports\n\nThe default Windows service port for RDP is TCP 3389, and can easily be identified in the\npackets with “Cookie: mstshash=”.\n\nWe can observe the use of the string ‘watchbog’ as the username of the RDP mstshash\nfield.\n\n\n-----\n\nAmong some of the IP lists we found being supplied for RDP scanning, we spotted that\n[some of the IP addresses belonged to Vodafone Australia and](https://db-ip.com/all/120.19.72) Tencent Computer\nSystems infrastructure.\n\nAfter the scanning stage, the WatchBog client returns an RC4 encrypted list of vulnerable IP\naddresses encoded as a hexadecimal string:\n\nEncrypted scanned IP addresses\n\nThe threat actors behind WatchBog may be gathering a list of vulnerable BlueKeep\nWindows endpoints for future use, or perhaps to sell to a third party to make a profit.\n\n**Spreading**\n\nThe WatchBog client includes five exploits for the following CVEs:\n\nAvailable “pwn” modules\n\n\n-----\n\nFurthermore, two modules for bruteforcing CouchDB and Redis instances exist together\nalong with code to achieve RCE.\n\nAll of the exploited “pwn” modules allow an attacker to achieve remote code execution.\n\nOnce a vulnerable service is discovered to which exists an exploit module, the binary\nspreads itself by invoking the right exploit and installing a malicious bash script hosted on\nPastebin.\n\nWe were able to find an early test version of the spreader module uploaded to\n[HybridAnalysis, including an exploit to Solr CVE-2019-0192, an exploit to ActiveMQ CVE-](https://www.hybrid-analysis.com/sample/cdf11a1fa7e551fe6be1f170ba9dedee80401396adf7e39ccde5df635c1117a9?environmentId=300)\n2016-3088, and a module utilizing a technique to gain code execution over cracked Redis\ninstances:\n\nSolr exploit as it appears in the test version\n\n**Conclusion**\n\nWe presented our findings regarding the high pace of adaptation that WatchBog is\nmaintaining by integrating recently published exploits and updating its implants with more\nup-to-date offensive technologies.\n\nIt is important to highlight that Python malware can become harder to analyze if it is\ndeployed natively with engines such as Cython. That is in contrast to other Python native\nframeworks such as pyinstaller, where Python code can not be recovered.\n\nThe incorporation of the BlueKeep scanner by a Linux botnet may indicate WatchBog is\nbeginning to explore financial opportunities on a different platform. Currently, no known\npublic RCE BlueKeep PoCs exist and it will be interesting to monitor this group once a PoC\nis published.\n\n**Prevention and Response**\n\n\n-----\n\nWe recommend to update your relevant software to its latest version:\n\nWe suggest Windows users refer to Microsoft’s [customer guidance in order to](https://support.microsoft.com/en-us/help/4500705/customer-guidance-for-cve-2019-0708)\nmitigate the BlueKeep vulnerability.\nWe suggest Linux users, who use Exim, Jira, Solr, Jenkins or Nexus Repository\nManager 3, to update to the latest versions.\nWe suggest Linux users, who use Redis or CouchDB, to ensure that there are\nno open ports that are exposed outside of trusted networks.\nWe recommend Linux users who suspect that they are infected with WatchBog to\ncheck for the existence of the “/tmp/.tmplassstgggzzzqpppppp12233333” file or the\n“/tmp/.gooobb” file.\n[We have also created a customYARA rule based on WatchBog’s malicious code for](https://github.com/intezer/yara-rules/blob/master/WatchBog.yar)\ndetecting this threat.\n\n**Genetic Analysis**\n\nWatchBog is indexed in Intezer’s genetic database. If you have a suspicious file that you\nsuspect to be WatchBog, you can upload it to Intezer Analyze in order to detect code reuse\n[to this malware family. You are welcome to try it in our free community edition.](https://analyze.intezer.com/#/)\n\n**IOCs**\n\nb17829d758e8689143456240ebd79b420f963722707246f5dc9b085a411f7b5e\n\n26ebeac4492616baf977903bb8deb7803bd5a22d8a005f02398c188b0375dfa4\ncdf11a1fa7e551fe6be1f170ba9dedee80401396adf7e39ccde5df635c1117a9\n\nhttps://9d842cb6.ngrok[.]io\n\nhttps://7dc5fb4e.ngrok[.]io\n\nhttps://z5r6anrjbcasuikp.onion[.]to\n\nhttps://pastebin[.]com/raw/Dj3JTtnj\n\nhttps://pastebin[.]com/raw/p3mGdbpq\n\nhttps://pastebin[.]com/raw/UeynzXEr\n\nhttps://pastebin[.]com/raw/MMCFQMH9\n\n3.14.212[.]173\n\n3.14.202[.]129\n\n\n-----\n\n3.17.202[.]129\n3.19.3[.]150\n18.188.14[.]65\n\n**Paul Litvak**\nPaul is a malware analyst and reverse engineer at Intezer. He previously served as a\ndeveloper in the Israel Defense Force (IDF) Intelligence Corps for three years.\n\n**Ignacio Sanmillan**\nNacho is a security researcher specializing in reverse engineering and malware analysis.\nNacho plays a key role in Intezer\\'s malware hunting and investigation operations, analyzing\nand documenting new undetected threats. Some of his latest research involves detecting\nnew Linux malware and finding links between different threat actors. Nacho is an adept ELF\nresearcher, having written numerous papers and conducting projects implementing state-ofthe-art obfuscation and anti-analysis techniques in the ELF file format.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-07-24 - Watching the WatchBog- New BlueKeep Scanner and Linux Exploits.pdf"
    ],
    "report_names": [
        "2019-07-24 - Watching the WatchBog- New BlueKeep Scanner and Linux Exploits.pdf"
    ],
    "threat_actors": [
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535532,
    "ts_updated_at": 1743041674,
    "ts_creation_date": 1653751004,
    "ts_modification_date": 1653751004,
    "files": {
        "pdf": "https://archive.orkl.eu/45ca1bdf11162f0351094e8a57d391342f1fc6e6.pdf",
        "text": "https://archive.orkl.eu/45ca1bdf11162f0351094e8a57d391342f1fc6e6.txt",
        "img": "https://archive.orkl.eu/45ca1bdf11162f0351094e8a57d391342f1fc6e6.jpg"
    }
}