{
    "id": "b923427c-568b-4a54-ac84-e684edcd8959",
    "created_at": "2022-10-25T16:48:21.472692Z",
    "updated_at": "2025-03-27T02:17:02.2625Z",
    "deleted_at": null,
    "sha1_hash": "528b71b279d14c7544623df379dffe626cfcebb0",
    "title": "PowerPoint 簡報",
    "authors": "",
    "file_creation_date": "2022-01-27T06:34:55Z",
    "file_modification_date": "2022-01-27T06:34:55Z",
    "file_size": 3322967,
    "plain_text": "## LuoYu: Continuous Espionage Activities Targeting Japan with\n the new version of WinDealer\n in 2021\n\n###### Leon Chang, Yusuke Niwa, Suguru Ishimaru\n\n\n-----\n\n## Speakers’ Bio\n\n###### Leon Chang Yusuke Niwa Suguru Ishimaru\n\n\n###### Malware Researcher\n @ TeamT5\n\n His major areas of research include APT campaign tracking, malware analysis.\n\n\n###### Cybersecurity Researcher\n @ ITOCHU Corporation\n\n He tracks threat trends including malspam, APT, and CyberCrime.\n\n\n###### Malware Researcher\n @ Kaspersky Lab\n\n He conducts research of the latest threat trends including APT at a global level.\n\n\n-----\n\n## AGENDA\n\n###### 01 Summary of LuoYu campaign in 2021\n\n 02 Anatomy of WinDealer\n\n 03 Case Studies\n\n 04 Conclusions\n\n\n-----\n\n## AGENDA\n\n###### 01 Summary of LuoYu campaign in 2021\n\n 02 Anatomy of WinDealer\n\n 03 Case Studies\n\n 04 Conclusions\n\n\n-----\n\n#### Summary of LuoYu campaign in 2021\n\n######  The LuoYu Threat Group Overview\n\n  Motivation: Why do we research LuoYu activity? \n\n  Timeline of LuoYu campaign in 2021\n\n  Target regions and industries\n\n Subsidiaries of Japanese organizations in China\n\n The users of private Chinese bank\n\n\n-----\n\n#### The LuoYu Threat Group Overview\n\n\n-----\n\n## The name: 蠃魚(LuoYu)\n\n 蠃魚(LuoYu) a Chinese mythological creature\n\n 蠃魚，魚身而鳥翼，音如鴛鴦，見則其邑大水。\n\n Translation: Fish with a pair of wings; When it\n\n###### appears, floods always follow.\n\n\n-----\n\n#### LuoYu\n\n\n###### Malware\n\n\n###### Target Industry\n\n\n###### ReverseWindow\n\n WinDealer Technology Media Education\n SpyDealer\n\n\n###### XDealer\n\n ShadowPad\n\n\n###### PlugX Financial MOFA Military Telecom Logistics\n Origin\n New updates New updates\n China\n\n\n###### Target Areas\n\n\n###### New updates\n\n\n-----\n\n## Goal\n\n\n###### Collecting information from dissidents\n\n Chinese branches of Japanese company\n\n\n-----\n\n#### Timeline of LuoYu Campaign in 2021\n\n\n-----\n\n#### Timeline of LuoYu campaign in 2021\n\n###### Case1 Case2\n\n\n###### The users of Identify new cross-platform private Chinese bank backdoor “XDealer”\n\n\n###### Dropper of ReveseWindow & ShadowPad\n\n\n-----\n\n## AGENDA\n\n###### 01 Summary of LuoYu campaign in 2021\n\n 02 Anatomy of WinDealer\n\n 03 Case Studies\n\n 04 Conclusions\n\n\n-----\n\n##### Malware profile: WinDealer\n\n###### Category\n\n Type Modular backdoor\n\n Naming string prefix “Deal” in its export function\n\n First seen 2008\n\n function Getting victim label from\n\n - C2 config C2\n - IP address generation algorithm (IPGA)\n\n Linked APT LuoYu\n\n|Category|Description|\n|---|---|\n|Type|Modular backdoor|\n|Naming|string prefix “Deal” in its export function|\n|First seen|2008|\n|function|Getting victim label from non-exist URL or non-exist domain|\n|C2|- C2 config - IP address generation algorithm (IPGA) NEW|\n\n\n-----\n\n##### Hardcoded version of WinDealer\n\n The hardcoded version of WinDealer probably comes from the built date.\n\n Version format: {Main_version}.{year}.{month+day}\n\n We observed four versions from collected samples:\n\n 16.18.1030\n\n 17.19.0505\n\n 18.19.0628\n\n 18.20.1225 NEW\n\n\n-----\n\n##### Hardcoded version of WinDealer\n\n Before 2016, WinDealer used hardcoded development timestamp string as\n\n###### mutex string\n\n We use the mutex string prefix to distinguish the backdoor version\n\n WORK_20080729400351362402 →WinDealer 2008\n\n MANAGE_20130831175600761943 →WinDealer 2013\n\n\n-----\n\n#### Evolution of WinDealer\n\n\n-----\n\n##### Evolution of WinDealer\n\n\n###### WinDealer 2008\n\n WinDealer 2013\n\n WinDealer 16.18.1030\n\n WinDealer 17.19.0505\n\n WinDealer 18.19.0628\n\n WinDealer 18.20.1225\n\n\n###### At first, the malware is designed to collect the sensitive data from popular messaging application in China. (support 15 command)\n\n In 2013, it supported more spying function. (support 26 command) The non-exist URL: \"http://www.360.cn/status/getsign.asp\"\n\n Since 2016, There’s hardcode version in WinDealer which contains the feature to steal shadowsocks profile.\n\n The non-exist URL was changed to \"http://www.360.cn/status/getonefile.asp\"\n\n The non-exist URL was changed to non-exist domain: http://www.microsoftcom/status/getsign.asp, 48 command\n\n The latest version of WinDealer\n\n\n-----\n\n#### In-Depth Analysis of WinDealer\n\n\n-----\n\n#### In-Depth Analysis of WinDealer\n\n######  Steganography Technique\n\n  Embedded DLL\n\n  Collecting host information\n\n  C2 communications\n\n  WinDealer Related Component\n\n\n-----\n\n## Steganography Technique\n\n######  The malware contains an additional module in the resource “Bitmap”\n using steganography technique to evade security products.\n\n The encrypted DLL in res ID:129\n\n###### Md5:76ba5272a17fdab7521ea21a57d23591\n\n\n-----\n\n## Decrypt the embedded DLL\n\n\n###### Embedded DLL\n\n\n###### XOR (10 bytes key)\n AES (16 bytes key)\n\n\n-----\n\n## How to find BLOB and decrypt\n\n The search method is to add 0x3000 bytes from the beginning of the\n\n###### image, then advances 1 byte at a time and compares the magic hex pattern to find the desired location.\n\n\n-----\n\n#### The functionality of embedded DLL\n\n|Export function name|Description|\n|---|---|\n|partInitOpt|Mapping embedded functions on VFT for using from main module as initialization|\n|GetConfigInfo|Mapping embedded malware configuration data from the DLL|\n|AutoGetSystemInfo|Creating many threads to get infected device information|\n\n\n-----\n\n#### Generated victim ID set in a reg key\n\n The victim ID format: MD5(“<MAC address><Physical_Drive_info><username>”)\n\n The malware creates a specific registry key to store the generated victim ID to use\n\n###### in the next execution.\n\n As a unique hidden trick, the victim ID is not stored raw data, the malware\n\n###### converts the 4 bytes victim ID to an IP address style\n\n\n-----\n\n##### Collecting host information\n\n Computer name\n\n Username\n\n CPU info\n\n OS version\n\n Network interface\n\n External IP address\n\n User account\n\n Screenshots\n\n\n-----\n\n#### C2 communications\n\n Before sending the victim data, the malware will add a custom header to the\n\n###### data\n\n Interesting features:\n\n Getting victim label from non-exist domain or non-exist URL based on WinDealer version\n\n http://www.360[.]cn/status/getsign.asp\n\n http://www.360[.]cn/status/getonefile.asp\n\n\n NXDOMAIN: http://www[.]microsoftcom/status/getsign.asp\n\n C2 anti-tracking mechanism\n\n\n###### NEW\n\n\n IP address generation algorithm (IPGA)\n\n\n###### NEW\n\n\n-----\n\n#### Getting victim label from NXDOMAIN\n\n\n-----\n\n#### C2 anti-tracking mechanism\n\n Use IPGA (IP Generation Algorithm) to generate a random C2 IP address\n\n###### when backdoor does not have C2 config\n\n The randomly generated IP will exist within specific IP address ranges\n\n Ex: 113.62.0.0 - 113.63.255.255 or 111.120.0.0 - 111.123.255.255\n\n This mechanism will prevent researchers from tracking down the real C2 IP\n\n\n-----\n\n#### C2 communications\n\n###### Custom header RSA encrypted Generated AES Key\n\n TCP/UDP socket\n\n WinDealer\n Custom header AES encrypted Victim data C2 Server\n\n\n-----\n\n###### Data format of c2 communications (first connection)\n\n|Offset|Description|Example(hex)|\n|---|---|---|\n|0x00|Magic header|06 81 DA 91 CE C7 9F 43|\n|0x08|Generated Victim ID||\n|0x0C|Victim label|00 or 01 or 02|\n|0x0D|Connection type or Backdoor command ID|00 = initial connection 01 = after initial connection Others = backdoor command ID|\n|0x0E|Unknown static value|11 or 14|\n|0x0F|Unknown static value|00|\n\n\n-----\n\n##### y y encrypt C2 communication\n\n\n-----\n\n#### Sending AES key crypted RSA\n\n\n-----\n\n##### C2 communication encrypted by AES\n\n\n-----\n\n##### 1 byte command in custom header+0xD\n\n\n-----\n\n###### Divided backdoor in EXE and Embedded DLL\n\n\n-----\n\n#### WinDealer Related Component\n\n We have found the downloader of WinDealer in the wild since 2013.\n\n In addition, we found old Windows kernel module downloader (2015 ~ 2017)\n\n PDB string: “Z:¥O¥植入相关¥本地溢出¥downexecdriver¥bin¥FAT32.pdb”\n\n\n-----\n\n#### WinDealer Related Component\n\n We discovered a WinDealer downloader which contains a legitimate domain but the URL path\n\n###### is non-existing. (DNS hijacking or network hijacking)\n\n User-agent is an unique \"BBB,\" which also appears in WinDealer RAT\n\n###### WinDealer\n\n\n-----\n\n#### WinDealer Related Component\n\n There’re multiple dropper/loader samples related to WinDealer.\n\n The malware resource “AAA” contains an encrypted payload\n\n The encrypted payload in res ID:103\n\n Ex. The malware uses XOR to decrypt the payload, then loads the decrypted payload\n\n###### (WinDealer) in-memory.\n\n decrypt and load WinDealer\n\n\n-----\n\n## AGENDA\n\n###### 01 Summary of LuoYu campaign in 2021\n\n 02 Anatomy of WinDealer\n\n 03 Case Studies\n\n 04 Conclusions\n\n\n-----\n\n#### Case Study 1: Fake site and app\n\n Phishing site and trojanized installer impersonate private Chinese online\n\n###### banking app\n\n Download Connect\n\n\n###### Phishing site ReverseWindow\n Trojanized installer\n (mirrored the bank’s (Windows, Android)\n of the banking app\n legitimate webpage)\n\n\n###### C2 Server\n\n\n-----\n\n#### Case Study 2: Drop error image for distraction\n\n\n###### Connect\n\n\n###### C2 Server\n\n\n###### Drop & Execute\n\n\n###### ReverseWindow version: 2.2.2006131\n\n Bash Script (C:¥ProgramData¥u.bat)\n\n\n###### The dropper of ReverseWindow\n (.error.exe)\n\n\n###### Drop & Open Directory\n\n\n###### Decoy (.¥Error.jpg)\n\n\n###### Deceive &\n Distract\n\n\n-----\n\n#### Case Study 2:\n###### Combine use of both proprietary and shared backdoors\n\n Recently, We found that LuoYu is using Shadowpad to attack unknown targets\n\n###### ReverseWindow version: 2.2.2006131\n\n\n###### C2 Server\n\n\n###### Unknown\n target\n\n\n###### ShadowPad\n\n\n-----\n\n#### Case Study 3\n\n###### Ver. 18.20.1225\n\n TIM.exe WinDealer (qbupd.exe)\n\n Victim Host LuoYu\n\n TIM ( a legitimate communication tool) tried to download the WinDealer, qbupd.exe somehow even though accessing a legitimate destination of updater.\n\n C:¥Users¥<UserName>¥AppData¥Roaming¥Microsoft¥Windows ¥Start Menu¥Programs¥Startup¥qbupd.exe\n\n After created WinDealer on the startup folder, once victim user logged in this host, WinDealer is executed and sends stolen data over 6999/UDP to backbone router.\n\n\n-----\n\n#### Case Study 4\n\n###### Ver. 18.19.0628\n\n YoudaoDict.exe WinDealer (version.dll)\n\n LuoYu Victim Host\n\n YoudaoDict(legitimate tool) tried to download the WinDealer, version.dll, then dll- sideloading it and executed embedded dll at the end of June 2021.\n\n AV has detected this version’s WinDealer several times though, due to the replacement of AV in this organization, the victim host resulted in compromised.\n\n\n###### Victim Host\n\n\n-----\n\n#### Public info research (Chinese BBS )\n\n###### Chinese blog post from Feb 2019 describes a WinDealer-related infection and involving an executable with the same file name (pptv(pplive)_forap_1084_9993.exe) which we’ve observed.\n\n\n-----\n\n#### Details of Infection flow\n\n Legitimate EXE\n\n###### downloads a WinDealer in the specific conditions.\n\n\n-----\n\n##### WinDealer’s Initial Vector & Communication Flow\n\n###### Legitimate Apps\n\n\n###### Initial Vector\n\n\n###### Victim Host with a legitimate tool\n And its updater\n\n\n###### Backbone Router(CN)\n\n\n###### WinDealer or Dropper\n\n\n###### Step1: query a non-exist domain for labeling victims Step2: send victim data to backbone router by IPGA\n\n\n###### Legitimate Update Server\n\n Malware hosted Server\n\n\n###### LuoYu\n\n\n###### Post\n\n Exploitation\n\n\n###### Infected victim host\n with WinDealer\n\n\n###### Invisible Area\n\n LuoYu‘s C2\n\n\n-----\n\n## AGENDA\n\n###### 01 Summary of LuoYu campaign in 2021\n\n 02 Anatomy of WinDealer\n\n 03 Case Studies\n\n 04 Conclusions\n\n\n-----\n\n###### ADVERSARY CAPABILITY\n\n LuoYu: Chinese-speaking actor\n\n\n\n- SIGINT Technique (N/A)\n\n- Manipulating a legitimate software\n\n- Update mechanism\n\n- Leverage IPGA\n\n- Usage of DLL-Sideloading\n\n- Send stolen data with UDP protocol\n\n###### TARGET\n\n - Target area: Wide range, mainly East Asia\n\n###### (including Chinese branches of Japanese companies)\n\n - Target industries: Wide range\n\n\n Possible collaboration with the other Chinese APT\n###### group\n\n INFRASTRUCTURE\n\n CHINANET-BACKBONE\n###### 113.62.0.0/15 or 111.120.0.0/14 (random IP addresses)\n\n\n###### group\n\n\n-----\n\n###### MITRE ATT&CK Mapping\n\n|Tactics|Techniques|Col3|\n|---|---|---|\n|Initial Access|T1199|Trusted Relationship: Leverage SIGINT to tamper with traffic at the ISP level|\n|Execution|T1059.003|Command and Scripting Interpreter: Windows Command Shell WinDealer creates a pipe with cmd.exe|\n|Persistence|T1547.001|Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder WinDealer sets a value in the registry “HKEY_CURRENT_USER¥Software¥Microsoft¥Windows¥Currentversion¥Run” for startup. WinDealer has been created on startup folder below. C:¥Users¥<UserName>¥AppData¥Roaming¥Microsoft¥Windows¥Start Menu¥Programs¥Startup¥qbupd.exe|\n||T1027.002|Obfuscated Files or Information: Software Packing WinDealer’s functions are divided between the EXE and DLL. The DLL is implemented in its own resource with encryption. Hardcoded strings / data are obfuscated in some WinDealer samples. Gathered data is XORed using a one-byte key “Y”.|\n\n\n###### Hijack Execution Flow: DLL Side Loading:\n\n\n-----\n\n###### MITRE ATT&CK Mapping\n\n|MITRE|ATT&CK Mapping|Col3|\n|---|---|---|\n|Tactics|Techniques||\n||T1012|Query Registry: WinDealer lists installed applications and stores configuration information in the registry.|\n||T1016|System Network Configuration Discovery: WinDealer lists networks adapters and their addresses|\n||T1016.001|System Network Configuration Discovery: Internet Connection Discovery WinDealer gets the public IP via “http://icanhazip.com/”.|\n||T1049|System Network Connections Discovery: WinDealer scans the hosts in the LAN using ICMP.|\n||T1057|Process Discovery: WinDealer gets the process list.|\n||T1082|System Information Discovery: WinDealer gets hostname, CPU info, OS version, mac address and username. The backdoor command 0xD obtains the keyboard layout.|\n||T1083|File and Directory Discovery: WinDealer gets a file list and metadata of specified files.|\n||T1120|Peripheral Device Discovery: WinDealer gets system disk information and USB drive information.|\n\n\n###### S ft Di Wi D l li t i t ll d li ti Wi D l t fi ti fil\n\n\n-----\n\n###### MITRE ATT&CK Mapping\n\n|Tactics|Techniques|Col3|\n|---|---|---|\n|Collection|T1113|Screen Capture: WinDealer can take screen captures.|\n|Command and Control|T1568|Dynamic Resolution: WinDealer dynamically generates C2 IP using IPGA.|\n||T1573.001|Encrypted Channel: Symmetric Cryptography Further communications are encrypted by AES-128 in ECB mode.|\n||T1573.002|Encrypted Channel: Asymmetric Cryptography WinDealer uses RSA-2048 during its key exchange phase.|\n|Exfiltration|T1041|Exfiltration Over C2 Channel: WinDealer exfiltrates the gathered data over C2 channels.|\n\n\n-----\n\n#### Countermeasures against this campaign\n\n######  Cyber Hygiene Matters!\n  Check before clicking links and downloading files\n\n  While preventing malware downloads with SIGINT is very difficult,\n detecting and dealing with them is relatively easy.\n\n  Deployment of AV and continuous its alert monitoring\n\n  Firewall implicit denial setting, and in the case of WFH, Windows\n Firewall setting is recommended on the host side as well.\n\n\n-----\n\n### Conclusions\n\n######  LuoYu is increasing its attack scope to companies and users in East\n Asia, including Japan (and their branches in China).\n\n  Notable TTPs\n  Arsenals having capabilities to attack multiple platforms\n  Utilization of popular shared tools (i.e., ShadowPad, PlugX)\n  Various attack vector such as SIGINT, watering hole attacks, etc.\n\n  LuoYu’s evolution throughout 2021 indicates its potential in\n developing into a more sophisticated group in the future\n\n\n-----\n\n## Reference\n\n https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_301_shui-leon_en.pdf\n\n https://www.fortinet.com/blog/threat-research/chinese-targeted-trojan-analysis\n\n https://blogs.jpcert.or.jp/ja/2021/10/windealer.html\n\n https://www.shuzhiduo.com/A/8Bz8k3Pxdx/\n\n https://bbs.kafan.cn/thread-2157062-1-1.html\n\n\n-----\n\n#### IoCs\n\n|No|Malware Type|Version|File Name|MD5|\n|---|---|---|---|---|\n|1|WinDealer|18.19.0628|version.dll|6102f77c85541d00b4c3bc95f100febc|\n|2||18.20.1225|qbupd.exe|D9A6725B6A2B38F96974518EC9E361AB|\n|3||18.20.1225|NewsClientPlugin.exe|76ba5272a17fdab7521ea21a57d23591|\n|4||18.20.1225|RuntimeBroker.exe|cc7207f09a6fe41c71626ad4d3f127ce|\n\n|C2|Domain/IP|Remarks|\n|---|---|---|\n|WinDealer|113.62.0.0/15 111.120.0.0/14|Using 55556/TCP, 6999/UDP|\n||221.195.68.71/32||\n||122.112.245.55/32||\n\n\n-----\n\n# THANK YOU! Any Questions?\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "6fc23d14-23a6-4870-8fad-b291b182596f",
            "created_at": "2022-10-25T16:07:18.480113Z",
            "updated_at": "2022-10-25T16:07:18.480113Z",
            "deleted_at": null,
            "name": "ETDA",
            "url": "https://apt.etda.or.th",
            "description": "Threat Group Cards: A Threat Actor Encyclopedia",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_7_leon-niwa-ishimaru_en.pdf"
    ],
    "report_names": [
        "JSAC2022_7_leon-niwa-ishimaru_en.pdf"
    ],
    "threat_actors": [
        {
            "id": "b72c2616-cc7c-4c47-a83d-6b7866b94746",
            "created_at": "2023-01-06T13:46:39.425297Z",
            "updated_at": "2025-03-27T02:00:03.08718Z",
            "deleted_at": null,
            "main_name": "Red Nue",
            "aliases": [
                "LuoYu"
            ],
            "source_name": "MISPGALAXY:Red Nue",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041822,
    "ts_creation_date": 1643265295,
    "ts_modification_date": 1643265295,
    "files": {
        "pdf": "https://archive.orkl.eu/528b71b279d14c7544623df379dffe626cfcebb0.pdf",
        "text": "https://archive.orkl.eu/528b71b279d14c7544623df379dffe626cfcebb0.txt",
        "img": "https://archive.orkl.eu/528b71b279d14c7544623df379dffe626cfcebb0.jpg"
    }
}