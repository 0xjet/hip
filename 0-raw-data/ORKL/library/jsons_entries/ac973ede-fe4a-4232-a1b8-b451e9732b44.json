{
    "id": "ac973ede-fe4a-4232-a1b8-b451e9732b44",
    "created_at": "2023-01-12T15:05:57.260756Z",
    "updated_at": "2025-03-27T02:13:50.33747Z",
    "deleted_at": null,
    "sha1_hash": "8b1e8d3cdcd1dd87dd0224aca0205cf8adba0c20",
    "title": "2019-05-28 - Threat Research- New Rocke Variant Ready to Box Any Mining Challengers",
    "authors": "",
    "file_creation_date": "2022-05-28T19:02:55Z",
    "file_modification_date": "2022-05-28T19:02:55Z",
    "file_size": 1482794,
    "plain_text": "# New Rocke Variant Ready to Box Any Mining Challengers\n\n**[fortinet.com/blog/threat-research/rocke-variant-ready-to-box-mining-challengers.html](https://www.fortinet.com/blog/threat-research/rocke-variant-ready-to-box-mining-challengers.html)**\n\nMay 28, 2019\n\n**_FortiGuard Labs Breaking Threat Research_**\n\n[FortiGuard Labs has been monitoring a Linux coin mining campaign from “Rocke” – a](https://security.web.cern.ch/security/advisories/rocke_group/rocke_group.shtml)\nmalware threat group specializing in cryptomining. Over the past month we have seen new\nfeatures constantly being added to the malware. For instance, in their latest major update,\nthey have added a function that exploits systems running the software development\n[automation server Jenkins to increase their chance of infecting more systems, thereby](https://jenkins.io/)\ngenerating more profits. In addition, they have also evolved their malware by adding new\nattack stages, as well as new redundancies in its multi-component execution to make it more\ndynamic and flexible.\n\nThis post will go through the general behaviour of the malware as well as the new features\nwe have documented having been added during our monitoring.\n\n\n-----\n\n**Figure 1: Basic Execution Flow**\n\n## Stage1 and Stage2\n\n[The malicious bash script components of the malware are hosted in Pastebin, with the profile](https://pastebin.com/)\nname “SYSTEMTEN”, which is very similar to previous names used by the “Rocke” threat\ngroup. It’s worth noting that most of the time there can be several paste links that point to the\nsame script. Presumably, the redundancy is for operational continuity in case, for some\nreason, other links are removed. The paste links for the scripts seem to change every few\ndays so that manually monitoring the threat can be tedious. Similar redundancies can also\nbe found in other parts of this malware’s behavior.\n\n**Figure 2: Pastebin Profile Hosting the Scripts**\n\nIn a nutshell, the infection begins after the execution of the Stage1 script, which may be\ninstalled to a system through various means, including manual intrusions, lateral movement\nfrom previous infections inside the network, from classic automated internet vulnerability\nscanning, service login brute-forcing, and exploitations.\n\nThe sole purpose of the Stage1 script is simply to download the Stage2 script via either wget\nor curl command and then execute it.\n\n**Figure 3: Stage1 Script**\n\nThe Stage2 portion of the attack then performs the following:\n\nAdds a CRON job that downloads and executes the Stage1 script periodically. In this\ncase, * * * * * means the script will execute every minute.\n\n**Figure 4: Adding CRON Job for Stage1**\n\nMaximizes usage of the system’s processing power by terminating processes related to\nother miners.\n\n**Figure 5: Terminating Existing Miners**\n\nDownloads the main payload binary appropriate to the system’s architecture (x32/x64).\nTwo different download URLs are assigned to each architecture just in case either of\nthem is inaccessible. It is also interesting to note that there is often a link that contains\na timestamp suggesting its upload or compile time.\n\n**Figure 6: Downloading Main Payload**\n\nIn older variants, the download links would all lead straight to the binary payload—until just a\nfew days ago, when they decided to add a new loader stage before the actual execution of\nthe payload. In the case of this recent version, some of the links are now serving large\n\n\n-----\n\npython scripts embedded with the base64-encoded ELF binary, which then decompresses\nand executes the main binary payload.\n\n**Figure 7: New Loader Binary for the Main Payload**\n\nThe malware is spread laterally by executing the Stage1 script and accessing the SSH\n_known_hosts file, which contains SSH hosts that the victim’s system had previously_\nconnected to. A second test is performed to verify that public key authentication is\npossible.\n\n**Figure 8: Propagating Through SSH known_hosts**\n\n## Main Payload\n\nThe main binary acts as a manager to the malware’s operation in the system. It ensures that\nthe components are regularly updated, persistent, and hidden from the user. And ultimately,\nit executes the cryptominer.\n\n**Compression**\n\nThe main payload is coded in Go Language (GoLang), and at first had been packed with a\nsimple UPX. However, in March of this year, they switched to a “custom” UPX compression\nsimply by changing the packed binaries’ section names to “LSD!”. It is a simple trick, but it\ncan be very effective in evading file-based detection due to the fact that in most cases,\nengines can only decompress UPX-compressed files with proper headers.\n\n**Figure 9: Malware Switches to Custom UPX**\n\n**Persistence and Stealth Mechanisms**\n\nThis malware employs multiple persistence and stealth mechanisms to ensure its mining\noperation in an infected system.\n\nIt adds the service netdns to ensure that the payload binary, /usr/sbin/kerberods, executes\non boot up.\n\n**Figure 10: Init Scripts for the Malware Service**\n\nSeveral CRON jobs have also been added that regularly download and execute the Stage1\nscript. This keeps the components updated to new developments from the threat developers.\nIn older versions, these Pastebin URLs were all straightforward and hardcoded in the binary.\nIn more recent variants, however, the Pastebin IDs have become more dynamic. Another\nstage was also added in the form of a new Pastebin URL where the IDs can be obtained. In\ncase this URL is inaccessible, however, a hardcoded ID is still available for the malware to\nuse.\n\n\n-----\n\n**Figure 11: Added CRON Jobs Pointing to the Stage1 Script**\n\nTo hide its mining operation, a hooking library (usr/local/lib/<filename>.so) is installed for\ndynamic library preloading. It does this by adding the library’s path to ld.preload.so. In effect,\nthe library is loaded to all new processes.\n\nThe library’s filename is obtained by randomly choosing from a list of hardcoded strings in\nthe binary, contrary to the older variants that simply used one hardcoded filename. The\nimage below shows just a few of the filenames that it can use.\n\n**Figure 12: Snippet of filename List**\n\nIn a nutshell, the malware’s library component hooks functions so that any application trying\nto access information related to the malware will be presented with a fake result. These\nfunctions are related to the listing of files, network activities, processes, and CPU usage\ninformation.\n\n**Figure 13: Library with Hooked Functions Highlighted**\n\nFor instance, if an application is trying to list a directory where a component of the malware\nresides, the library ensures that the malicious file will not be included in the result. To achieve\nthis, the malware hooks the fopen API. The same principle applies to the other artifacts\nrelated to it, adding difficulty for victims to discover and remove the malware.\n\n**Figure 14: Hook Function For fopen**\n\n**Figure 15: Hidden Library Function**\n\nIn the case of concealing actual CPU statistics, if an application attempts to read the\n_/proc/stat file, the function force_proc_cpu is called to return a hardcoded statistic showing a_\n0% CPU usage.\n\n**Figure 16: Function that Returns the Fake proc/stat**\n\n**Figure 17: top Tool Display Before and After the Malicious Library is Preloaded**\n\n**Propagation**\n\nIn earlier versions deployed in this campaign, this malware spread through a classic\ncredential brute-force method targeting SSH (port 22) and Redis (port 6379) services.\nBasically, it scanned every IP address in the network and attempted to establish a session to\nthese services using a long hardcoded list of credentials.\n\nHowever, around a month ago, the threat actors started targeting systems that run Jenkins\n[by attempting to exploit CVE-2018-1000861 and](https://jenkins.io/security/advisory/2018-12-05/) [CVE-2019-1003000.](https://jenkins.io/security/advisory/2019-01-08/#SECURITY-1266)\n\n**Figure 18: Propagate via CVE-2019-1003000**\n\n\n-----\n\n**Figure 19: Propagate via CVE-2018-1000861**\n\n**Miner**\n\n[This campaign uses the open-source XMRig CPU miner. In older versions, a separate](https://github.com/xmrig/xmrig)\nconfiguration file was dropped to the system with all the information included, including the\nwallet address of the threat actors and the mining pool that they use.\n\n**Figure 20: Miner Config from Older Versions**\n\nIn these latest versions, the configuration is now embedded in the binary. The malware now\n[uses a proxy server systemten.org:51640, (most probably running an xmrig-proxy service)](https://github.com/xmrig/xmrig-proxy)\nfor the mining traffic, where the wallet address and mining pool are configured. This means\nthe infected host miners are not required to have the parameters, thereby effectively hiding\nthe details for further investigation. Note that the port may change depending on the variant.\n\n**Figure 21: Embedded Miner Configuration with the Mining Pool Proxy**\n\n## Conclusion\n\nThrough constant monitoring, we have observed that this is a very active campaign, often\npushing multiple updates in a single day to add more features to their cryptomining scheme.\n\nBy utilizing a hook library, it is more complicated for users to manually detect and remove the\ninfection from their systems, giving the threat actors more time to generate profit. We have\nalso observed that they have started to add features to expand their infection by targeting\nsystem vulnerabilities, and given the recent rate of development, it’s likely that they will be\nadding more of these in the near future.\n\nAs always, FortiGuard Labs will be on the lookout for this campaign.\n\n-= FortiGuard Lion Team =\n## Solutions\n\nFortinet customers are protected by the following solutions:\n\nThe Jenkins exploits are detected by our IPS signature\n_Jenkins.Script.Plugin.Authenticated.Remote.Command.Execution_\nThe traffic to the xmrig-proxy can be blocked using the application control signature\n_Bitcoin.Cryptocurrency.Miner_\nAll malicious samples are detected as Linux/Agent.BQ!tr\nThe miner’s proxy server is blocked by FortiGuard Web Filtering Service.\n\n## IOCs\n\n\n-----\n\n**_Files_**\n\nfbbb28ed10c792b4a29748795cba26f78d28cf13d8b7b042d6de4f3ea1401399\n3a6271a90d0f6cc8a2d31d45d931e8401f13f7377932ba07d871dc42f252b9ca\n63c7f944bf8b9f4db9a8cf6d47a6d4026bba776478c1315c2888ecff603d73a1\n1608899ff3bd9983df375fd836464500f160f6305fcc35cfb64abbe94643c962\nf6712249b3c27772daf815d459577c2c88a3aef6b66dfd0986ac9277a8bb35e1\nea682b4aa3885657fe15f76cc3f97322547ca21f347069cd3c78b152a0155781\n5eda73b869c22f92c78547995acbba5ff794ea24f5da72af2d653600411d6c97\n3f8683fa08a5ae5964f4ee4962465b16c12075480e24a269d151ce1130c77d8c\nb383d0fdfa5036ccfa5d9c2b43cbfd814bce8778978873057b86678e5295fc61\n\n**_URLs_**\n\nsystemten.org\nhttps://pastebin[.]com/raw/Xu86DLj0\nhttps://pastebin[.]com/raw/0DqEa3Gn\nhttps://pastebin[.]com/raw/Ei4z3RQ7\nhTTps://pastebin[.]com/raw/XiUrwYe9\nhttps://pastebin[.]com/raw/rPB8eDpu\nhttps://pastebin[.]com/raw/HWBVXK6H\n\n_[Learn more about FortiGuard Labs and the FortiGuard Security Services portfolio.](https://www.fortinet.com/fortiguard/threat-intelligence/threat-research.html?utm_source=nreleaseblog&utm_campaign=2018-q2-fortiguardlabs-cta)_ _Sign_\n_up for our weekly FortiGuard Threat Brief._\n\n_[Read about the FortiGuard Security Rating Service, which provides security audits and best](https://www.fortinet.com/support-and-training/support-services/fortiguard-security-subscriptions/security-rating.html?utm_source=blog&utm_campaign=2018-blog-security-rating-service)_\n_practices._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-28 - Threat Research- New Rocke Variant Ready to Box Any Mining Challengers.pdf"
    ],
    "report_names": [
        "2019-05-28 - Threat Research- New Rocke Variant Ready to Box Any Mining Challengers.pdf"
    ],
    "threat_actors": [
        {
            "id": "7c053836-8f50-4d40-bc5c-7088967e1b57",
            "created_at": "2022-10-25T16:07:24.549525Z",
            "updated_at": "2025-03-27T02:02:10.278474Z",
            "deleted_at": null,
            "main_name": "Rocke",
            "aliases": [
                "Aged Libra",
                "Iron Group",
                "Rocke"
            ],
            "source_name": "ETDA:Rocke",
            "tools": [
                "Godlua",
                "Kerberods",
                "LSD",
                "Pro-Ocean",
                "Xbash"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "3a0cfbbc-2acf-4cc8-afe1-1859679c522c",
            "created_at": "2022-10-25T16:07:24.373716Z",
            "updated_at": "2025-03-27T02:02:10.198532Z",
            "deleted_at": null,
            "main_name": "Vendetta",
            "aliases": [
                "TA2719"
            ],
            "source_name": "ETDA:Vendetta",
            "tools": [
                "AsyncRAT",
                "Atros2.CKPN",
                "Nancrat",
                "NanoCore",
                "NanoCore RAT",
                "ReZer0",
                "Remcos",
                "RemcosRAT",
                "Remvio",
                "RoboSki",
                "Socmer",
                "Zurten"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "905eabd9-2b7f-483d-86bd-0c72f96b4162",
            "created_at": "2023-01-06T13:46:39.02749Z",
            "updated_at": "2025-03-27T02:00:02.980813Z",
            "deleted_at": null,
            "main_name": "Rocke",
            "aliases": [
                "Aged Libra"
            ],
            "source_name": "MISPGALAXY:Rocke",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "0b02af5f-2027-42b7-a6f2-51e2fd49ba7f",
            "created_at": "2022-10-25T15:50:23.360509Z",
            "updated_at": "2025-03-27T02:00:55.45329Z",
            "deleted_at": null,
            "main_name": "Rocke",
            "aliases": [
                "Rocke"
            ],
            "source_name": "MITRE:Rocke",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535957,
    "ts_updated_at": 1743041630,
    "ts_creation_date": 1653764575,
    "ts_modification_date": 1653764575,
    "files": {
        "pdf": "https://archive.orkl.eu/8b1e8d3cdcd1dd87dd0224aca0205cf8adba0c20.pdf",
        "text": "https://archive.orkl.eu/8b1e8d3cdcd1dd87dd0224aca0205cf8adba0c20.txt",
        "img": "https://archive.orkl.eu/8b1e8d3cdcd1dd87dd0224aca0205cf8adba0c20.jpg"
    }
}