{
    "id": "3f47aca9-0aed-4720-8455-e9988a7308e2",
    "created_at": "2023-01-12T15:08:01.596658Z",
    "updated_at": "2025-03-27T02:05:25.112586Z",
    "deleted_at": null,
    "sha1_hash": "7b72c44d2520b918bdf4e0d0e3229ac373af51a4",
    "title": "2018-01-17 - Reviewing the spam filters- Malspam pushing Gozi-ISFB",
    "authors": "",
    "file_creation_date": "2022-05-27T21:50:01Z",
    "file_modification_date": "2022-05-27T21:50:01Z",
    "file_size": 2578912,
    "plain_text": "# SANS ISC: Reviewing the spam filters: Malspam pushing Gozi-ISFB - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training SANS ISC InfoSec Forums\n\n**[isc.sans.edu/forums/diary/Reviewing+the+spam+filters+Malspam+pushing+GoziISFB/23245](https://isc.sans.edu/forums/diary/Reviewing+the+spam+filters+Malspam+pushing+GoziISFB/23245)**\n\nReviewing the spam filters: Malspam pushing Gozi-ISFB\n\n\n**_Introduction_**\n\nResearchers should review their spam filters to see what malware is getting\ncaught. Security professionals should be aware of current practices used by\ncriminals pushing malware, even if it has little chance of infecting anyone in\ntheir organizations. Reviewing the spam filters keeps provides a clearer\npicture of our cyber-threat landscape.\n\nIn today's trip through the spam filters, I found two emails with malicious\nattachments. These attachments are Word documents with malicious macros\ndesigned to infect a vulnerable Windows host with Gozi-ISFB.\n\n\nBrad\n\n433 Posts\n\nISC Handler\nJan 17th 2018\n\n\n-----\n\n_Shown above: Never a good sign when the document asks you to enable_\n_macros._\n\nUnfortunately, I cannot share the emails. Both emails appear to contain\nlegitimate correspondence. They each include a chain of previous messages,\nand I could not easily redact the information like I normally do with other\nexamples of malicious spam.\n\nTherefore, this diary will focus on the attachments, follow-up malware, and\nnetwork traffic.\n\n**_What is Gozi-ISFB?_**\n\nGozi-ISFB is a variant of Ursnif, and today's traffic looked like an example\nshared by [@DynamicAnalysis in a blog post on malwarebreakdown.com.](https://twitter.com/DynamicAnalysis)\n\nI generated two infections using each of the Word documents. In today's\nactivity, about 8 to 10 minutes after the initial infection, the infected Windows\nhost downloaded follow-up malware. Here's what I saw:\n\n1st Word document --> Gozi-ISFB --> Nymaim Trojan\n2nd Word document --> Gozi-ISFB --> unknown malware\n\nThe first infection followed-up with the Nymaim Trojan, and I've documented\nNymaim traffic back in [November and](http://www.malware-traffic-analysis.net/2017/11/03/index2.html) [December of 2017.](http://www.malware-traffic-analysis.net/2017/12/06/index4.html)\n\n\n-----\n\n_Shown above: Traffic from the 1st infection filtered in Wireshark._\n\nSince I've covered Nymaim before, I'm far more insterested in the second\ninfection where I couldn't identify the follow-up malware.\n\n**_The second infection_**\n\nThe second infection follows the same patterns as the first. However, this time\nthe follow-up malware is different. I saw encrypted traffic with no associated\nDNS requests or domains. Two of the IP addresses had interesting certificate\ndata as shown in the images below.\n\n\n-----\n\n_Shown above: Traffic from the 2nd infection filtered in Wireshark._\n\n_Shown above: One example of certificate data from the encrypted post-_\n_infection traffic._\n\n\n-----\n\n_Shown above: Another example of certificate data from the encrypted post-_\n_infection traffic._\n\nBased on the network traffic and post-infection artifacts, I could not identify the\nfollow-up malware. The follow-up malware is a malicious DLL named\n**_winmm.dll that's loaded by a legitimate Windows system file named_**\n**_presentationsettings.exe. Both were found in a newly-created directory_**\nunder the infected user's AppData\\Roaming folder. See the indicators section\nbelow for details.\n\n**_Indicators_**\n\nArtifacts from the 1st infection:\n\nSHA256 hash:\n[febb37762a92bedad337d0489ac482e356e2787533d65a757c3375fb147ff0a8](https://www.virustotal.com/#/file/febb37762a92bedad337d0489ac482e356e2787533d65a757c3375fb147ff0a8/detection)\n\nFile size: 55,248 bytes\nFile name: Request.doc\nFile description: Word document with malicious macro\n\nSHA256 hash:\n[14284152d53c119ad04c986a2a115485ae480d8012603679bf28ec27e3869929](https://www.virustotal.com/#/file/14284152d53c119ad04c986a2a115485ae480d8012603679bf28ec27e3869929/detection)\n\nFile size: 1,101,824 bytes\nFile location: C:\\Users\\[username]\\AppData\\Roaming\\52a8081a.exe\nFile location: C:\\Users\\\n\n[username]\\AppData\\Roaming\\Microsoft\\Adsnsdmo\\CRPPport.exe\nAssociated Registry key:\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\nValue name: adprvmgr\nValue type: REG_SZ\nValue data: C:\\Users\\\n\n[username]\\AppData\\Roaming\\Microsoft\\Adsnsdmo\\CRPPport.exe\nFile description: Gozi-ISFB (an Ursnif variant)\n\nSHA256 hash:\n[d254e82bdbfd16aa9f0037e2c536c3b9dddd6ec559d26a5af005d3a1f8199d59](https://www.virustotal.com/#/file/d254e82bdbfd16aa9f0037e2c536c3b9dddd6ec559d26a5af005d3a1f8199d59/detection)\n\nFile size: 580,864 bytes\n\n\n-----\n\nFile location: C:\\Users\\[username]\\AppData\\Local\\molarity 24\\molarity\n12.exe\nAssociated Registry key:\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\nValue name: molarity-96\nValue type: REG_SZ\nValue data: C:\\Users\\[username]\\AppData\\Local\\molarity-24\\molarity12.exe -s0\nFile description: Probable Nymaim Trojan\n\nSHA256 hash:\n[f1c9544e8f1de92f60f13e29403fc459811b93a7a316d957cb30c1b4a61ba61d](https://www.virustotal.com/#/file/f1c9544e8f1de92f60f13e29403fc459811b93a7a316d957cb30c1b4a61ba61d/detection)\n\nFile size: 656,896 bytes\nFile location: C:\\ProgramData\\wedge-46\\wedge-6.exe\nAssociated Registry key:\nHKCU\\Software\\Microsoft\\WindowsNT\\CurrentVersion\\Winlogon\nValue name: shell\nValue type: REG_SZ\nValue data: C:\\ProgramData\\wedge-46\\wedge-6.exe -46,explorer.exe\nFile description: Probable Nymaim Trojan\n\nSHA256 hash:\n[6e5faf4c3eb47a5218f173564fc1e5a8afc65a8126ff7f602e8dbfe98a2ba695](https://www.virustotal.com/#/file/6e5faf4c3eb47a5218f173564fc1e5a8afc65a8126ff7f602e8dbfe98a2ba695/detection)\n\nFile size: 651,776 bytes\nFile location: C:\\Users\\[username]\\AppData\\Roaming\\aliasing40\\aliasing-2.exe\nFile description: Probable Nymaim Trojan\n\nArtifacts from the 2nd infection:\n\nSHA256 hash:\n[044e86936bfc30cd0c07186b6e270650f896f6a42e9b8015abc184d161880090](https://www.virustotal.com/#/file/044e86936bfc30cd0c07186b6e270650f896f6a42e9b8015abc184d161880090/detection)\n\nFile size: 55,012 bytes\nFile name: NBS_Request.doc\nFile description: Word document with malicious macro\n\nSHA256 hash:\n[f8bdb65d54ccab04a506e84f14bdbeef15f6266a7bd6e4e7dfde69de424dd10a](https://www.virustotal.com/#/file/f8bdb65d54ccab04a506e84f14bdbeef15f6266a7bd6e4e7dfde69de424dd10a/detection)\n\nFile size: 1,010,688 bytes\nFile location: C:\\Users\\[username]\\AppData\\Roaming\\6d9be056.exe\nFile location: C:\\Users\\\n\n[username]\\AppData\\Roaming\\Microsoft\\Bitsxapi\\efsuvoas.exe\nAssociated Registry key:\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\nValue name: dmusdBth\nValue type: REG_SZ\nValue data: C:\\Users\\\n\n[username]\\AppData\\Roaming\\Microsoft\\Bitsxapi\\efsuvoas.exe\nFile description: Gozi-ISFB (an Ursnif variant)\n\n\n-----\n\nSHA256 hash:\n[208b94fd66a6ce266c3195f87029a41a0622fff47f2a5112552cb087adbb1258](https://www.virustotal.com/#/file/208b94fd66a6ce266c3195f87029a41a0622fff47f2a5112552cb087adbb1258/detection)\n(not malware)\n\nFile size: 176,640 bytes\nFile location: C:\\Users\\\n\n[username]\\AppData\\Roaming\\XPIALj1\\PresentationSettings.exe\nAssociated Registry key:\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\nValue name: Ehlho\nValue type: REG_SZ\nValue data: \"C:\\Users\\\n\n[username]\\AppData\\Roaming\\XPIALj1\\PresentationSettings.exe\"\nStart menu shortcut: C:\\Users\\\n\n[username]\\AppData\\Roaming\\Microsoft\\Windows\\Start\nMenu\\Programs\\Startup\\Ehlho\nFile description: Legitimate system file that loads any DLL named\n**_winmm.dll in the same directory._**\n\nSHA256 hash:\n[018084df00799387be61c5f849af8fce093aab8f73420a2ece7b47d0f45fa07e](https://www.virustotal.com/#/file/018084df00799387be61c5f849af8fce093aab8f73420a2ece7b47d0f45fa07e/detection)\n\nFile size: 176,640 bytes\nFile location: C:\\Users\\\n\n[username]\\AppData\\Roaming\\XPIALj1\\WINMM.dll\nFile description: Malicious component called by PresentationSettings.exe\nFile description: Malware DLL loaded by legitimate system file\n**_PresentationSettings.exe in the same directory_**\n\n1st run infection traffic:\n\n188.25.175.38 port 80 - ijqdjqnwiduqujqiuezxc.com - GET\n/NU/sof.php?utma=baw\n188.25.175.38 port 80 - ijqdjqnwiduqujqiuezxc.com - GET /NU/baw.pfx\n188.25.175.38 port 80 - ijqdjqnwiduqujqiuezxc.com - GET /s.php?\nid=baw\n109.166.237.170 port 80 - adistributedmean.net - GET /images/[long\n_string].gif_\n109.166.237.170 port 80 - adistributedmean.net - POST /images/[long\n_string].bmp_\n212.98.131.181 port 80 - adistributedmean.net - GET /images/[long\n_string].gif_\n212.98.131.181 port 80 - adistributedmean.net - POST /images/[long\n_string].bmp_\n86.120.77.221 port 80 - adistributedmean.net - GET /images/[long\n_string].gif_\n86.120.77.221 port 80 - adistributedmean.net - GET /images/[long\n_string].jpeg_\n86.120.77.221 port 80 - adistributedmean.net - POST /images/[long\n_string].bmp_\n80.80.165.93 port 80 - adistributedmean.net - GET /images/[long\n_string].gif_\n80.80.165.93 port 80 - adistributedmean.net - POST /images/[long\n_string].bmp_\n\n\n-----\n\n186.73.245.226 port 80 adistributedmean.net GET /images/[long\n_string].gif_\n188.237.190.24 port 80 - adistributedmean.net - GET /images/[long\n_string].gif_\n184.168.187.1 port 80 - fyibc.com - GET /vvv.bin\n184.168.187.1 port 80 - fyibc.com - GET /nori3.bin\n184.168.187.1 port 80 - fyibc.com - GET /nori6.bin\nDNS queries (using Google DNS) for dtybgsb.com\n86.120.168.154 port 80 - zepter.com - POST /5lpomdt9j/index.php\n203.91.116.53 port 80 - zepter.com - POST /5lpomdt9j/index.php\n155.133.93.30 port 80 - zepter.com - POST /5lpomdt9j/index.php\n85.105.167.110 port 80 - carfax.com - POST /\n85.105.167.110 port 80 - zepter.com - POST /\nNOTE: carfax.com and zepter.com are legitimate domains and not\ncompromised. They just resolve to bad IP addresses for dtybgsb.com\ndue to the nature of this Nymaim infection.\n\n2nd run infection traffic:\n\n84.54.187.24 port 80 - fortrunernaskdneazxd.com - GET /NA/sof.php?\nutma=kur\n84.54.187.24 port 80 - fortrunernaskdneazxd.com - GET /NA/kur.pfx\n84.54.187.24 port 80 - fortrunernaskdneazxd.com - GET /s.php?id=kur\n213.6.121.106 port 80 - bithedistributedlicense.net - POST\n/images/[long string].bmp\n85.105.167.110 port 80 - bithedistributedlicense.net - POST\n/images/[long string].bmp\n85.105.167.110 port 80 - bithedistributedlicense.net - GET\n/images/[long string].gif\n90.180.1.23 port 80 - bithedistributedlicense.net - GET /images/[long\n_string].gif_\n184.168.187.1 port 80 - fyicreative.ca - GET /dih.bin\n184.168.187.1 port 80 - fyicreative.ca - GET /nori3.bin\n184.168.187.1 port 80 - fyicreative.ca - GET /nori6.bin\n41.193.159.41 port 443 - Encrypted traffic both with and without cerificate\ndata\n69.90.132.196 port 443 - Encrypted traffic both with cerificate data\n69.75.114.66 port 443 - Encrypted traffic (no certificate data)\n74.50.133.9 port 443 - Encrypted traffic (no certificate data)\n41.193.159.41 port 444 - attempted TCP connections, but no response\nfrom the server\n95.150.74.40 port 443 - attempted TCP connections, but no response\nfrom the server\n179.108.87.11 port 443 - attempted TCP connections, but no response\nfrom the server\n190.208.42.36 port 443 - attempted TCP connections, but no response\nfrom the server\n\nOf note, during the first infection, I rebooted the infected Windows host 3 or 4\ntimes, which might account for multiple copies of what I assume are Nymaim.\nIf you review the pcaps, the reboots are indicated any place you see an HTTP\nrequest to www.msftncsi.com.\n\n**_Malicious domains_**\n\n\n-----\n\nIndicators are not a block list. If you feel the need to block web traffic based on\nthis diary, I suggest the following domains:\n\nijqdjqnwiduqujqiuezxc.com\nadistributedmean.net\nfyibc.com\nfortrunernaskdneazxd.com\nbithedistributedlicense.net\nfyicreative.ca\n\n**_Final words_**\n\n[Pcaps and malware for today's diary can be found here.](http://www.malware-traffic-analysis.net/2018/01/17/index.html)\n\nGood spam filtering, proper Windows administration, and best security\npractices will ensure most people never see this malware. However, criminals\nare constantly tweaking their methods in an attempt to slip past our defenses.\nIt pays to be aware of current malware indicators, so we're prepared if any ever\nmake it into our network.\n\n--Brad Duncan\nbrad [at] malware-traffic-analysis.net\n\n[Thread locked Subscribe](https://isc.sans.edu/forums/diary/subscribe/23245/) Jan 17th 2018\n\n4 years ago\n\n\nUnfortunately this sometimes can be tricky to update filters to block\npreemptively in some organizations do not want to miss out on mail especially\nfalse positives. Many times security researchers are subjected to only\nemploying filters reactively and specific to the malspam. These filters generally\nare very specific and only come after the fact of discovery which usually means\nsomeone opened the email and attachment. In todays business landscape\nbusinesses need to stand strong with their security policies and do due\ndiligence to ensure that if false positives are caught, they have a process in\nplace to allow audit of these emails and releasing of them. All to often the\nreaction is to turn off the filters because the emails get held up and impacts\nsales. Unfortunately this happens at the cost of security. Just my 2 cents.\n\n\nShadowITGroup\n\n1 Posts\n\n\n[Quote](https://isc.sans.edu/forums/diary/quote/40797) Jan 17th 2018\n\n4 years ago\n\nSo how did the malware get attached to legitimate emails? SasK\n\n12 Posts\n\n[Quote](https://isc.sans.edu/forums/diary/quote/40799) Jan 18th 2018\n\n4 years ago\n\n\n-----\n\n_[Quoting SasK:So how did the malware get attached to legitimate emails?](https://isc.sans.edu/forums/diary/Reviewing+the+spam+filters+Malspam+pushing+GoziISFB/23245/1#40799)_\n\nThat's a very good question. If they are in fact legitimate emails, this implies a\nhost used by the other email account (or perhaps the email account itself)\ncommunicating the with recipient is compromised. It's possible an infected host\nis using a local cache of an email client to send these messages.\nUnfortunately, without having access to the host at the other end of the\nconversation, I don't know how this is being done.\n\nIt's also possible these long email chains are completely fake, but what little\nI've seen indicates they are not. For example, signature blocks used by the\nrecipient in previous correspondence from the email chain make me think\nthese are legitimate conversations, and the host at the other end is somehow\ncompromised. How this happened? I don't know.\n\n\nBrad\n\n433 Posts\n\nISC Handler\n\n\n[Quote](https://isc.sans.edu/forums/diary/quote/40803) Jan 18th 2018\n\n4 years ago\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-01-17 - Reviewing the spam filters- Malspam pushing Gozi-ISFB.pdf"
    ],
    "report_names": [
        "2018-01-17 - Reviewing the spam filters- Malspam pushing Gozi-ISFB.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536081,
    "ts_updated_at": 1743041125,
    "ts_creation_date": 1653688201,
    "ts_modification_date": 1653688201,
    "files": {
        "pdf": "https://archive.orkl.eu/7b72c44d2520b918bdf4e0d0e3229ac373af51a4.pdf",
        "text": "https://archive.orkl.eu/7b72c44d2520b918bdf4e0d0e3229ac373af51a4.txt",
        "img": "https://archive.orkl.eu/7b72c44d2520b918bdf4e0d0e3229ac373af51a4.jpg"
    }
}