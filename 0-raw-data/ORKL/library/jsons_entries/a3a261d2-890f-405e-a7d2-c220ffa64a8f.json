{
    "id": "a3a261d2-890f-405e-a7d2-c220ffa64a8f",
    "created_at": "2023-01-12T15:03:37.004794Z",
    "updated_at": "2025-03-27T02:09:42.998227Z",
    "deleted_at": null,
    "sha1_hash": "070077d11f05159899e6650389c7be0cb5ff29d9",
    "title": "2022-02-02 - White Rabbit Continued- Sardonic and F5",
    "authors": "",
    "file_creation_date": "2022-05-27T23:14:43Z",
    "file_modification_date": "2022-05-27T23:14:43Z",
    "file_size": 814087,
    "plain_text": "# White Rabbit Continued: Sardonic and F5\n\n**[lodestone.com/insight/white-rabbit-continued-sardonic-and-f5/](https://lodestone.com/insight/white-rabbit-continued-sardonic-and-f5/)**\n\n[By Jason Daza](https://lodestone.com/bio/jason-daza/)\n\nKey Contributors: [Manoj Khatiwada,](https://lodestone.com/bio/manoj-khatiwada/) [Paul Brunney,](https://lodestone.com/bio/paul-brunney/) [Michael Wirtz, and](https://lodestone.com/bio/mike-wirtz/) [Group-IB](https://www.group-ib.com/)\n\n\nFebruary 1, 2022\n\n\nIn December 2021, Lodestone published an article linking a previously unknown ransomware\ngroup, White Rabbit, to the threat actor group FIN8 after observing striking similarities\nbetween the two during an investigation. The subsequent efforts by the cybersecurity\ncommunity have brought together experts from around the world to “follow the White Rabbit,”\nso to speak, and gain more insight into an emerging threat.\n\nSince the time the last article was published, Lodestone has observed evidence that a new\nversion of FIN8’s BadHatch backdoor malware, Sardonic, has been deployed and seen in\nuse by White Rabbit. Lodestone experts have identified strong overlap between Sardonic\nand this new backdoor malware, dubbed F5 and encountered as part of the investigation that\ninitially resulted in the discovery of the White Rabbit group.\n\n## Sardonic vs F5\n\n\n-----\n\nOverall, the functionality of the Sardonic .NET assembly ( MDAC.dll ) and the F5 assembly\n(“Default.dll”) have strong similarities. They both contain Rivest Cipher 4 (RC4) encrypted\nshellcode, with the decryption key contained in the DLL, and both are compressed using\nGzip. In the samples recovered by Lodestone, the decryption key for the “MDAC.dll”\nshellcode was 802d8B9Fe13f576163DEab429754cA0C, while the key for “Default.dll” was\n15e280Ea9d63270Fb89763514cDCABf4. As reflected in the screen snippets below, the\ndecryption algorithms remained essentially unchanged.\n\n_Sardonic Shellcode Decryption Routine_\n\nF5 Shellcode Decryption Routine\nAlthough the F5 and Sardonic backdoors appear to function nearly identically to each other,\nsome features of the PowerShell script and the .NET DLL mentioned in the Bitdefender\npaper appear to have been removed; the PowerShell script no longer has an option to kill an\nexisting process, and the “4BMARC2WKL” marker prepending the shellcode in “MDAC.dll”\ndoes not exist in “Default.dll”. Since these were minor features of the malware, Lodestone\ncould not determine why they may have been explicitly removed by the author.\n\n\n-----\n\nSardonic PowerShell Script with Process Killing Functionality\n\nF5 PowerShell Script without Process Killing Functionaliity\nAnother observation Lodestone made during the investigation was a change in the method\nname executed by the PowerShell script. In Sardonic, the method used was\n“MSDAC.PerfOSChecker::StartCheck”; however, in F5, the name was changed to\n“o5518470.kfC09272::p65E1a71”. Lodestone did not observe evidence of threat actors\ncreating a new Windows Management Instrumentation (WMI) consumer for the F5\nPowerShell script. It is possible that efforts to configure F5 to establish this persistence were\nabandoned once a decision was made deploy ransomware.\n\n\n-----\n\nProgram Database PDB\n\nPaths for MDAC.dll and Default.dll\nLodestone encountered some difficulties in the analysis of “Default.dll” which hampered\nprogress. What Lodestone has determined thus far, however, is that, like the shellcode in\n“MDAC.dll”, the “Default.dll” shellcode first checks the name of its parent process. If the\nparent process is “powershell.exe”, the shellcode will open “lsass.exe” with\nSeDebugPrivilege and copies its system token. Then, it creates a child process,\n“WmiPrvSE.exe”, with system privileges to enable it to inject its own code and run with\nelevated privileges. The malware then generates a 32-byte hardware ID based on the\ncomputer name and C volume serial number. The system time and hardware ID are then\nencrypted with a custom algorithm and placed into a 64-byte buffer before an attempt is\nmade to connect to the C2 server. If the malware is unable to reach the C2 server after five\nattempts, it will terminate itself.\n\nUnsuccessful attempts to reach the C2 server\n\n## Evidence of a Human Operator\n\nInterestingly, Lodestone may have found evidence supporting Bitdefender’s belief that the\nSardonic or F5 loader is copied to the victim’s machine via a manual process instead of\nautomation. The logs Lodestone analyzed during the course of its investigation show that the\nfilename of the URL hosting the malware was always a random, 6-character alphanumeric\nstring that changed nearly every time the command was run. In one of the events, however,\nLodestone noticed that the filename contained seven characters. The PowerShell log in the\nimage below shows a command to download a file from hxxps://104-168-20126.sslip[.]io/36d851e. Roughly one minute later, another command was run to download a\n\n\n-----\n\nfile from hxxps://104-168-201-26.sslip[.]io/6d851e. Lodestone believes that the command\nwas likely tasked or ran interactively; following the failure, the command was likely re-tasked\nto fit the aforementioned 6-character URL target.\n\nPowerShell with a Typo\n\nPowerShell with the Typo Corrected\n\n## White Rabbit\n\nWhen Lodestone first acquired a sample of the ransomware, its experts observed that it was\nhighly obfuscated, had strange file extensions (.physiat and .uderro), and used an invalid\ndigital certificate. Additionally, Lodestone determined that the malware checked the\ncommand line arguments using “-f”, “-l”, “-p”, and “-t” flags.\n\n\n-----\n\nManually Decrypted Ransomware Strings\nLodestone’s theory that the “-p” flag was for the password used to decrypt the payload was\nconfirmed by a Trend Micro article on White Rabbit, as Lodestone’s sample used the same\npassphrase as the sample analyzed by Trend Micro. The other flags allow an operator to\nspecify which files (-f) to encrypt, an output (-l) for a log file, and a start time (-t) to begin\nencryption (if no time is specified the ransomware executes immediately). Once the malware\ncompletes its encryption function it executes a self-deletion function using the command:\n\ncmd /c choice /t 9 /d y & attrib -h \\”[fname]\\” & del \\”[fname]\\”\n\nCertificate Used by White Rabbit\n\n\n-----\n\nLodestone continues to monitor the situation for any further developments and would like to\nthank its partners at Group-IB for their contributions to this investigation. To learn more about\n[Group-IB, visit the following link: https://www.group-ib.com/.](https://www.group-ib.com/)\n\n## Indicators of Compromise\n\n IP Addresses\n\n64.44.131[.]34\n91.90.194[.]30\n104.168.132[.]128\n170.130.55[.]120\n\n## Domains\n\n91-90-194-30.sslip[.]io\n104-168.132[.]128.nip[.]io\n\n## URLs\n\n Filenames\n\n“default.dll”\n“l.exe”\n“z.exe”\n\n## Hash Values\n\n655c3c304a2fe76d178f7878d6748439 (“default.dll”)\n6ffa106ac8d923ca32bc6162374f488b (Sardonic PowerShell script)\nfb3de0512d1ee5f615edee5ef3206a95 (Sardonic x86 DLL)\n4a03238e31e3e90b38870ffc0a3ceb3b (Sardonic x64 DLL)\nBeffdd959b1f7e11e1c2b31af2804a07 (F5 PowerShell script)\nd9f5a846726f11ae2f785f55842c630f (F5 x86 DLL)\n087f82581b65e3d4af6f74c8400be00e (F5 x64 DLL)\ne49fe89435297f1bca1377053eaa6ded (White Rabbit ransomware)\n\n## YARA Rules\n\nrule fin8_powershell_dll_loader\n\n{\n\n\n-----\n\nmeta:\n\nauthor = “Dmitry Kupin”\n\ncompany = “Group-IB”\n\ndate = “2021-12-28\n\ndescription = “Powershell .NET DLL Loader”\n\nsample_private =\n“adac9106216e6d2eb2a6d1a0a01d7286dddd6bafdab9eb1cd182dd49924663a2”\n\nstrings:\n\n/* if([IntPtr]::size -eq 4){ */\n\n$s0 = { 3D 69 66 28 5B 49 6E 74 50 74 72 5D 3A 3A 73 69 7A 65 20 2D 65 71 20 34 29 7B\n}\n\n/* [System.Reflection.Assembly]::Load([System.Convert]::FromBase64String( */\n\n$s1 = { 5B 53 79 73 74 65 6D 2E 52 65 66 6C 65 63 74 69\n\n6F 6E 2E 41 73 73 65 6D 62 6C 79 5D 3A 3A 4C 6F\n\n61 64 28 5B 53 79 73 74 65 6D 2E 43 6F 6E 76 65\n\n72 74 5D 3A 3A 46 72 6F 6D 42 61 73 65 36 34 53\n\n74 72 69 6E 67 28 }\n\ncondition:\n\nall of them\n\n}\n\nrule fin8_dotnet_shellcode_loader\n\n{\n\nmeta:\n\nauthor = “Dmitry Kupin”\n\ncompany = “Group-IB”\n\ndate = “2021-12-28\n\n\n-----\n\ndescription = Sardonic Shellcode Loader\n\nsample = “03e8b29ad5055f1dda1b0e9353dc2c1421974eb3d0a115d0bb35c7d76f50de20” /*\nDefault.dll (x86) */\n\nsample = “4ee21b5fd8597e494ae9510f440a1d5bbcdb01bc653226e938df4610ee691f3a” /*\nDefault.dll (x64) */\n\nstrings:\n\n$pdb1 = “C:\\\\Users\\\\dev_win10_00\\\\Documents\\\\f5\\\\F5Utility\\\\LoaderAssembly\\\\obj\\\\ ” nocase\nascii\n\n$s0 = “Default.dll” fullword wide\n\n$s1 = “12F9333185494642C1587A546D2287C1A4C01A2A” fullword ascii\n\n$s2 = “05F6DF120FF54415A6B75A4B1894A83C6D865030” fullword ascii\n\n$s3 = “78893E31FF10BDE2CBCB8A51664788D7DC0FC194” fullword ascii\n\n$s4 = “15e280Ea9d63270Fb89763514cDCABf4” fullword ascii\n\ncondition:\n\n2 of them\n\n}\n\nrule fin8_shellcode_memory\n\n{\n\nmeta:\n\nauthor = “Dmitry Kupin”\n\ncompany = “Group-IB”\n\ndate = “2021-12-28\n\ndescription = “Sardonic Shellcode(in the memory)”\n\nstrings:\n\n$h_x86 = { E8 00 00 00 00 5F B9 [2] 00 00 [2] 30 ?? 0F 17 00 00 00 02 ?? 0F 17 00 00 00\nE2 F0 }\n\n\n-----\n\n/\n\n*a1 = ((*a1 ^ (*a1 << 6)) >> 13) ^ (*a1 << 18) & 0xFFF80000;\n\n*a2 = (4 * *a2) & 0xFFFFFFE0 ^ (((4 * *a2) ^ *a2) >> 27);\n\n*a3 = ((*a3 ^ (*a3 << 13)) >> 21) ^ (*a3 << 7) & 0xFFFFF800;\n\nv4 = (*a4 << 13) & 0xFFF00000 ^ ((*a4 ^ (8 * *a4)) >> 12);\n\n*/\n\n$chunk_x86 = { 89 3A 8B 03 8D 3C 85 ?? ?? ?? ?? 31 F8 83 E7 E0\n\nC1 E8 1B 31 F8 89 03 8B 39 89 F8 C1 E0 0D 31 F8\n\nC1 E7 07 C1 E8 15 81 E7 00 F8 FF FF 31 C7 89 39\n\n8B 3E 8D 04 FD ?? ?? ?? ?? 31 F8 C1 E7 0D 81 E7\n\n00 00 F0 FF C1 E8 0C 31 F8 }\n\n$h_x64 = { 41 [2] 48 C7 C1 [2] 00 00 4C 8D [2] 00 00 00 45 30 }\n\n/*\n\n*a1 = (*a1 << 18) & 0xFFF80000 ^ ((*a1 ^ (*a1 << 6)) >> 13);\n\n*a2 = (4 * *a2) & 0xFFFFFFE0 ^ (((4 * *a2) ^ *a2) >> 27);\n\n*a3 = (*a3 << 7) & 0xFFFFF800 ^ ((*a3 ^ (*a3 << 13)) >> 21);\n\nv4 = (*a4 << 13) & 0xFFF00000 ^ ((*a4 ^ (8 * *a4)) >> 12);\n\n*/\n\n$chunk_x64 = { 89 01 8B 02 44 8D 14 85 ?? ?? ?? ?? 44 31 D0 41\n\n83 E2 E0 C1 E8 1B 44 31 D0 89 02 45 8B 10 44 89\n\nD0 C1 E0 0D 44 31 D0 41 C1 E2 07 41 81 E2 00 F8\n\nFF FF C1 E8 15 44 31 D0 41 89 00 45 8B 11 42 8D\n\n04 D5 ?? ?? ?? ?? 44 31 D0 41 C1 E2 0D C1 E8 0C\n\n41 81 E2 00 00 F0 FF 44 31 D0 }\n\ncondition:\n\n\n-----\n\nany of them\n\n}\n\n## Additional Information and References\n\nMichael Gillespie’s White Rabbit announcement on Twitter:\n\n[https://twitter.com/demonslay335/status/1470823608725475334](https://twitter.com/demonslay335/status/1470823608725475334)\n\n[DOWNLOAD PDF](https://lodestone.com/wp-content/uploads/2022/02/White-Rabbit-Continued-Sardonic-and-F5-copy.pdf)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-02 - White Rabbit Continued- Sardonic and F5.pdf"
    ],
    "report_names": [
        "2022-02-02 - White Rabbit Continued- Sardonic and F5.pdf"
    ],
    "threat_actors": [
        {
            "id": "72d09c17-e33e-4c2f-95db-f204848cc797",
            "created_at": "2022-10-25T15:50:23.832551Z",
            "updated_at": "2025-03-27T02:00:55.554841Z",
            "deleted_at": null,
            "main_name": "FIN8",
            "aliases": [
                "FIN8",
                "Syssphinx"
            ],
            "source_name": "MITRE:FIN8",
            "tools": [
                "BADHATCH",
                "PUNCHBUGGY",
                "Ragnar Locker",
                "PUNCHTRACK",
                "dsquery",
                "Nltest",
                "Sardonic",
                "PsExec",
                "Impacket"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "fc80a724-e567-457c-82bb-70147435e129",
            "created_at": "2022-10-25T16:07:23.624289Z",
            "updated_at": "2025-03-27T02:02:09.892602Z",
            "deleted_at": null,
            "main_name": "FIN8",
            "aliases": [
                "ATK 113",
                "Syssphinx"
            ],
            "source_name": "ETDA:FIN8",
            "tools": [
                "ALPHV",
                "ALPHVM",
                "BadHatch",
                "BlackCat",
                "Noberus",
                "PSVC",
                "PUNCHTRACK",
                "PoSlurp",
                "Powersniff",
                "PunchBuggy",
                "Ragnar Locker",
                "RagnarLocker",
                "Sardonic",
                "ShellTea"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "5bdde906-0416-42ee-9100-5ebd95dda77a",
            "created_at": "2023-01-06T13:46:38.601977Z",
            "updated_at": "2025-03-27T02:00:02.870694Z",
            "deleted_at": null,
            "main_name": "FIN8",
            "aliases": [
                "ATK113",
                "G0061"
            ],
            "source_name": "MISPGALAXY:FIN8",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535817,
    "ts_updated_at": 1743041382,
    "ts_creation_date": 1653693283,
    "ts_modification_date": 1653693283,
    "files": {
        "pdf": "https://archive.orkl.eu/070077d11f05159899e6650389c7be0cb5ff29d9.pdf",
        "text": "https://archive.orkl.eu/070077d11f05159899e6650389c7be0cb5ff29d9.txt",
        "img": "https://archive.orkl.eu/070077d11f05159899e6650389c7be0cb5ff29d9.jpg"
    }
}