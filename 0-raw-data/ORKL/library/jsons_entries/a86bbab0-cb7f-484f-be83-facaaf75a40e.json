{
    "id": "a86bbab0-cb7f-484f-be83-facaaf75a40e",
    "created_at": "2023-01-12T15:07:18.804462Z",
    "updated_at": "2025-03-27T02:05:33.798413Z",
    "deleted_at": null,
    "sha1_hash": "5ae45be6da68f48baac4ac747bb2d75609d88f1a",
    "title": "2019-05-03 - “MegaCortex” ransomware wants to be The One",
    "authors": "",
    "file_creation_date": "2022-05-27T21:51:07Z",
    "file_modification_date": "2022-05-27T21:51:07Z",
    "file_size": 1298634,
    "plain_text": "# “MegaCortex” ransomware wants to be The One\n\n**[news.sophos.com/en-us/2019/05/03/megacortex-ransomware-wants-to-be-the-one/](https://news.sophos.com/en-us/2019/05/03/megacortex-ransomware-wants-to-be-the-one/)**\n\nAndrew Brandt May 3, 2019\n\n_Editor’s note, 8 May 2019: This is a quickly evolving story and, in order to remain accurate,_\n_we have removed some confusing data posted with the original story, below._ _We have_\n_published an update here._\n\nA new ransomware that calls itself MegaCortex got a jolt of life on Wednesday as we\ndetected a spike in the number of attacks against Sophos customers around the world,\nincluding in Italy, the United States, Canada, the Netherlands, and other countries. The\nattackers delivering this new malware campaign employed sophisticated techiques in the\nattempt to infect victims.\n\nThe convoluted infection methodology MegaCortex employs leverages both automated and\nmanual components, and appears to involve a high amount of automation to infect a greater\nnumber of victims. In attacks we’ve investigated, the attackers used a common red-team\nattack tool script to invoke a meterpreter reverse shell in the victim’s environment. From the\nreverse shell, the infection chain uses PowerShell scripts, batch files from remote servers,\nand commands that only trigger the malware to drop encrypted secondary executable\npayloads (that had been embedded in the initial dropped malware) on specified machines.\n\nThe attack was triggered, in at least one victim’s environment, from a domain controller\ninside an enterprise network whose administrative credentials the attacker seems to have\nobtained, in what appears to be a hands-on break in.\n\nThe malware’s name is a misspelled homage to the faceless, bureaucratic corporation where\nthe character Neo worked in the first Matrix movie. The ransom note reads like it was written\nin the voice and cadence of Lawrence Fishburne’s character Morpheus\n\n\n-----\n\nThe cryptographic certificate used to\n\nsign MegaCortex\nThe ransom note’s cinematic fanboyism is not its sole reference to the past. The digitallysigned executable payload used to perform the encryption has been signed by a certificate\nwith an identical Common Name (CN) as signed executables we’ve found that date back to\nNovember, 2018 though we’re still looking to see if they’re anything like the more recent\nsamples. Searching on this CN, we’ve found several more samples in our repository that\nappear to be related to this same attacker.\n\nThe malware also employs the use of a long batch file to terminate running programs and kill\na large number of services, many of which appear to be related to security or protection,\nwhich is becoming a common theme among current-generation ransomware families.\n\nLooking back into malware repositories, we found a sample uploaded to VirusTotal from the\nCzech Republic on January 22. This appears to be the earliest known sample submitted to a\npublic malware sharing service, but we’ve found files in our own repository with identical\nCommon Name values. We first saw reports of the malware triggering alerts from customers\ndating back to February, but no major infections, and reports came only in dribs and drabs\nuntil the big spike on May 1st.\n\nThere have been multiple confirmed attacks, stopped by Intercept X, since May 1. Each\nattack targeted an enterprise network and may have involved hundreds of machines.\n\n\n-----\n\nWhile the attacker is attempting to spread the malware, alerts like this one with Event ID\n**10028, indicating the file can’t be transmitted to some machines, may appear in the**\nadministrator’s console.\nWhile the ransom note doesn’t mention a price the criminals are demanding, they do offer\nthe victims “a consultation on how to improve your companies (sic) cyber security” and “a\nguarantee that your company will never be inconvenienced by us” — you know, in the future,\nafter this really big inconveniencing they’re engaged in is all through.\n\nWith the numbers of attempted infections rising, we assembled a team of malware analysts\nand support staff to tackle the initial analysis of the attack and its aftermath.\n\n## How MegaCortex strikes\n\nRight now, we can’t say for certain whether the MegaCortex attacks are being aided and\nabetted by the Emotet malware, but so far in our investigation (which is still ongoing as this\npost goes live), there seems to be a correlation between the MegaCortex attacks and the\npresence on the same network of both Emotet and Qbot (aka Qakbot) malware.\n\nBoth of these malware families have the ability to serve as a delivery vehicle for other\nmalware payloads, with Emotet closely associated with the Trickbot credential stealing\nmalware, which also can download and install additional malware payloads to infected\ncomputers. We’ve seen no direct evidence that either Emotet or Qbot are the source.\n\n\n-----\n\nInstead, victims report the attack was initiated from a compromised domain controller.\n\nThe attacker, using stolen admin creds, executed a PowerShell script that was heavily\nobfuscated.\n\nThe initial\n\ntriggering command that started the infection\nStripping back three layers of obfuscation reveals a series of commands that decodes a blob\nof base64-encoded data. The blob appears to be a Cobalt Strike script that opens a\nMeterpreter reverse shell into the victim’s network.\n\nDecoded PowerShell commands\nThe attacker issues commands via the compromised domain controller (DC), which the\nattacker is remotely accessing using the reverse shell.\n\nThe DC uses WMI to push the malware — a copy of PsExec renamed rstwg.exe, the main\nmalware executable, and a batch file — to the rest of the computers on the network that it\ncan reach and then runs the batch file remotely via PsExec\n\n\n-----\n\nThe batch file appears to be just a long list of commands to kill 44 processes, issue stop\ncommands to 189 different services, and switch the Startup Type for 194 different services to\nDisabled, which prevents them from starting up again.\n\nThe attackers target a lot of security software, including some Sophos services, to stop them\nand try to set them to Disabled, but a properly configured installation won’t allow this.\n\n\n-----\n\nThe final step of\n\nthe batch file is to launch the previously-downloaded executable, winnit.exe. The batch file\nexecutes winnit with a command flag that is a chunk of base64-encoded data.\n\nThis command invokes winnit.exe to drop and execute a DLL payload with an eight-randomalphabetic character filename that performs the hostile encryption. There are also indications\nthe attackers use other batch files, named with the numbers 1.bat through 6.bat, that are\nbeing used to issue commands to distribute the winnit.exe and the “trigger” batch file around\nthe victim’s network.\n\nThe attacker’s killchain as visualized in Sophos Intercept X\n\n## The ransom demand\n\n\n-----\n\nIn typical fashion, the ransom notification appears on the root of the victim s hard drive as a\nplain text file. We’ve displayed it in an inverted color scheme to go with the mood the\nattacker sets by making Matrix movie references.\n\nThe ransomware generates a file with a .tsv file extension and the same eight-random**letter filename as the malicious DLL, and drops it to the hard drive. The ransom demand**\nasks that a victim submit this file with their request to pay the ransom, sent to either of two\nfree mail.com email addresses.\n\nWe’ll have more on this ransomware and its attack characteristics as our researchers\ncontinue to work on the case.\n\n## Recommended protection for MegaCortex\n\nWe’re still trying to develop a clearer picture of the infection process, but for now, it appears\nthat there’s a strong correlation between the presence of MegaCortex, and a pre-existing,\nongoing infection on the victims’ networks with both Emotet and Qbot. If you are seeing\nalerts about Emotet or Qbot infections, those should take a high priority. Both of those bots\ncan be used to distribute other malware, and it’s possible that’s how the MegaCortex\ninfections got their start.\n\nWe have not seen any indication so far that Remote Desktop Protocol (RDP) has been\nabused to break into the customer networks, but we know that holes in enterprise firewalls\nthat allow people to connect to RDP remain relatively common. We strongly discourage this\npractice and suggest that any IT admin who wishes to do this put the RDP machine behind a\nVPN.\n\n\n-----\n\nAs the attack seems to indicate that an administrative password was abused by the\ncriminals, we also recommend the widespread adoption of two-factor authentication for\neverything that currently requires just a password, and can use 2FA.\n\nKeeping regular backups of your most important and current data on an offline storage\ndevice is the best way to avoid having to pay a ransom altogether.\n\nAnd please remember, while it can be ill-advised to take security recommendations from a\ncriminal in the act of holding your data hostage, the criminals who have broken into a\nnetwork and attempted to encrypt hundreds of endpoints promise that they’ll never, ever do it\nagain, pinky swear, if you just pay the ransom. I’m not so sure I believe them, but if you’re a\nvictim, you may not have any other choice.\n\nSophos Antivirus detects these samples as Bat/Agent-BBIY, Troj/Agent-BBIZ, Troj/Agent**BAWS, and Troj/Ransom-FJQ. Sophos’ Intercept X protects customers from the attack.**\n\n_Research for this report was contributed by SophosLabs and Sophos Support team_\n_members Anand Ajjan, Sergio Bestulic, Faizul Fahim, Sean Kowalenko, Savio Lau, Andrew_\n_Ludgate, Peter Mackenzie, Chee Hui. Tan, and Michael Wood._\n\n## IoCs\n\n### IP address/domains\n\nMeterpreter’s reverse shell C2 address\n\n89.105.198.28\n\n### File hashes\n\nBatch script:\n\n37b4496e650b3994312c838435013560b3ca8571\n\nPE EXE:\n\n478dc5a5f934c62a9246f7d1fc275868f568bc07\n\nSecondary DLL memory injector:\n\n2f40abbb4f78e77745f0e657a19903fc953cc664\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-05-03 - “MegaCortex” ransomware wants to be The One.pdf"
    ],
    "report_names": [
        "2019-05-03 - “MegaCortex” ransomware wants to be The One.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536038,
    "ts_updated_at": 1743041133,
    "ts_creation_date": 1653688267,
    "ts_modification_date": 1653688267,
    "files": {
        "pdf": "https://archive.orkl.eu/5ae45be6da68f48baac4ac747bb2d75609d88f1a.pdf",
        "text": "https://archive.orkl.eu/5ae45be6da68f48baac4ac747bb2d75609d88f1a.txt",
        "img": "https://archive.orkl.eu/5ae45be6da68f48baac4ac747bb2d75609d88f1a.jpg"
    }
}