{
    "id": "1d7a1f34-9921-4960-80f0-58a3e5064fb0",
    "created_at": "2023-05-06T02:08:26.323768Z",
    "updated_at": "2025-03-27T02:05:50.502863Z",
    "deleted_at": null,
    "sha1_hash": "47be04c6a12835f3016d745ee710d9fa336d8bee",
    "title": "2023-03-30 - Developing Story- Information on Attacks Involving 3CX Desktop App",
    "authors": "",
    "file_creation_date": "2023-05-05T01:44:45Z",
    "file_modification_date": "2023-05-05T01:44:45Z",
    "file_size": 772287,
    "plain_text": "# Information on Attacks Involving 3CX Desktop App\n\n**[trendmicro.com/en_us/research/23/c/information-on-attacks-involving-3cx-desktop-app.html](https://www.trendmicro.com/en_us/research/23/c/information-on-attacks-involving-3cx-desktop-app.html)**\n\n\nMarch 30, 2023\n\n\n-----\n\nFigure 1. The detailed execution flow and Trend Micro detections of the malicious files. The MSI installer contains the .exe and two .dll files.\nThe main source of the detection in the MSI installer is \"ffmpeg.dll,\" which is the trojanized DLL.\n**_Updated on:_**\n\n_April 5, 2:39 a.m. EDT: We added Windows, Mac, and network commands to the Trend Micro Vision One™️ guide in the linked PDF._\n_April 4, 3:29 a.m. EDT: We added Trend Micro XDR filters to the solutions._\n_April 3, 2:33 a.m. EDT: We added details on d3dcompiler_47.dll's abuse of CVE-2013-3900 to make it appear legitimately signed._\n_April 1, 1:50 a.m. EDT: We added a guide on how Vision One can be used to search for potential threats associated with the 3CX_\n_desktop app._\n_March 31, 11:07 p.m. EDT: We added technical details, an analysis of the info-stealer payload, and information on Trend Micro XDR_\n_capabilities for investigating and mitigating risks associated with the 3CX desktop app._\n_March 31, 3:00 a.m. EDT: We added the execution flow diagram, a link to Trend Micro support page, and a list of Mac IOCs and_\n_detection names._\n\nIn late March 2023, security researchers revealed that threat actors abused a popular business communication software from 3CX — in\nparticular, [the](https://www.sentinelone.com/blog/smoothoperator-ongoing-campaign-trojanizes-3cx-software-in-software-supply-chain-attack/) [reports mention that a version of the 3CX VoIP (Voice over Internet Protocol) desktop client was being employed to target 3CX's](https://www.crowdstrike.com/blog/crowdstrike-detects-and-prevents-active-intrusion-campaign-targeting-3cxdesktopapp-customers/)\ncustomers as part of an attack.\n\nOn its forums, 3CX has [posted an update that recommends uninstalling the desktop app and using the Progressive Web App (PWA) client](https://www.3cx.com/community/threads/3cx-desktopapp-security-alert.119951/)\ninstead. The company also mentioned that they are working on an update to the desktop app.\n\nFor a more comprehensive scope of protection against possible attacks associated with the 3CX Desktop App, the Trend Micro XDR platform\ncan help organizations mitigate the impact by collecting and analyzing extensive activity data from various sources. By applying XDR analytics\nto the data gathered from its native products, Trend Micro XDR generates correlated and actionable alerts.\n\nTrend Micro customers can also take advantage of Trend Micro Vision One™ to search for and monitor potential threats associated with the\n3CX Desktop App, and to better understand observed attack vectors. For more information on how to utilize Trend Micro Vision One features,\n[you may download the PDF guide here.](https://documents.trendmicro.com/assets/guides/Vision-One-Guide-3CX-Desktop-App.pdf)\n\n[Additional guidance for Trend Micro customers including help with protection and detection can be found on our support page.](https://success.trendmicro.com/dcx/s/solution/000292711?language=en_US)\n\n## What is the compromised application?\n\nThe 3CX app is a private automatic branch exchange (PABX) software that provides several communication functions for its users, including\nvideo conferencing, live chat, and call management. The app is available on most major operating systems, including Windows, macOS, and\nLinux. Additionally, the client is available as a mobile application for both Android and iOS devices, while a Chrome extension and the PWA\nversion of the client allow users to access the software through their browsers.\n\nThe issue was said to be limited to the Electron (non-web versions) of their Windows package (versions 18.12.407 and 18.12.416) and macOS\nclients (versions 18.11.1213, 18.12.402, 18.12.407 and 18.12.416).\n\nAccording to the company’s website, more than 600,000 businesses and over 12 million daily users around the world use 3CX's VoIP IPBX\nsoftware.\n\nHow does the attack work?\n\nThe attack is reportedly a multi-stage chain in which the initial step involves a compromised version of the 3CX desktop app. Based on initial\nanalysis, the MSI package (detected by Trend Micro as Trojan.Win64.DEEFFACE.A and Trojan.Win64.DEEFFACE.SMA) is the one that is\ncompromised with possible trojanized DLLs, since the .exe file has the same name.\n\nThe infection chain begins with 3CXDesktopApp.exe loading ffmpeg.dll (detected as Trojan.Win64.DEEFFACE.A\nandTrojan.Win64.DEEFFACE.SMA). Next, ffmpeg.dll reads and decrypts the encrypted code from d3dcompiler_47.dll (detected as\nTrojan.Win64.DEEFFACE.A and Trojan.Wind64.DEEFACE.SMD3D).\n\nThe decrypted code seems to be the backdoor payload that tries to access the IconStorages GiHub page to access an ICO file (detected as\nTrojan.Win32.DEEFFACE.ICO) containing the encrypted C&C server that the backdoor connects to in order to retrieve the possible final\n[payload. In addition, d3dcompiler_47.dll also abuses CVE-2013-3900 to make it appear that it is legitimately signed.](https://nvd.nist.gov/vuln/detail/CVE-2013-3900)\n\nAs part of its attack routine, it contacts the servers noted in the list of indicators of compromise (IOCs) at the end of this blog entry. These\ndomains are blocked by the Trend Micro Web Reputation Services (WRS).\n\n\n-----\n\necut o o\n\nUpon execution, the MSI package installer will drop the following files that are related to malicious behavior. Trend Micro Smart Scan Pattern\n(cloud-based) TBL 21474.300.40 can detect these files as Trojan.Win64.DEEFFACE.A.\n\n**_3CXDesktopApp.exe: A normal file that is abused to load the trojanized DLL_**\n**_ffmpeg.dll: A trojanized DLL used to read, load, and execute a malicious shellcode from d3dcompiler_47.dll_**\n**_d3dcompiler_47.dll: A DLL appended with an encrypted shellcode after the fe ed fa ce hex string_**\n\nSome conditions are necessary for execution. For example, the sleep timestamp varies depending on the following conditions: First, it checks\nif the manifest file is present, as well as if it is using a specified date. If the file is not present or if it is using the specified date, the timestamp\nwill generate a random number and use the formula rand() % 1800000 + current date + 604800 (604,800 is seven days). After the date is\ncomputed, the malware will continue its routine.\n\nUpon execution of 3CXDesktopApp.exe, ffmpeg.dll, which seems to be a trojanized or patched DLL, will be loaded. It will still contain its normal\nfunctionalities, but it will have an added malicious function that reads d3dcompiler_47.dll to locate an encrypted shellcode after the fe ed fa\n_ce hex strings._\n\nFigure 2. Reading \"d3dcompiler_47.dll\" and locating the “fe ed fa ce” hex string\n\nUpon decryption of the malicious shellcode using RC4 with the key, 3jB(2bsG#@c7, the shellcode will then try to access the GitHub repository\nthat houses the ICO files containing the encrypted C&C strings that use Base64 encoding and AES + GCM encryption at the end of the image.\n\nThese B64 strings seem to be C&C domains that the shellcode tries to connect to for downloading other possible payloads. However, we were\nunable to confirm the exact nature of these payloads since the GitHub repository (raw.githubusercontent[.]com/IconStorages/images/main/)\nhad already been taken down at the time of this writing. Note that the process exits when the page is inaccessible.\n\nFigure 3. Code snippet showing the hard-coded GitHub repository\n\nFigure 4. An ICO file from the GitHub\n\nrepository\nThe above description applies to the Windows version. The behaviour of the Mac version is broadly similar, although it only uses a subset of\nthe Windows C&C domains.\n\n\n-----\n\no stea e pay oad a a ys s\n\nBased on our ongoing analysis of attacks on 3CX and the behaviors observed, the following section details what we know so far about the\npayload’s attack vector.\n\nPayloads in investigated 3CX attacks are detected as TrojanSpy.Win64.ICONICSTEALER.THCCABC. Upon analysis of the payload named\nICONIC Stealer, we discovered that if it is executed using regsvr32.exe as the DLL loader, it will display the following system error:\n\nFigure 5. Error displayed upon executing the sample using \"regsvr32.exe\"\n\nMeanwhile, if rundll32.exe is used as the DLL loader, it encounters a WerFault error and displays the following pop-up message:\n\nFigure 6. Error displayed if \"rundll32.exe\" is used as the DLL loader\n\nThis indicates that the sample must be loaded by a specific application to proceed to its malicious routine.\n\nICONIC Stealer then checks for a file named config.json under the folder \"3CXDesktopApp.\"\n\nFigure 7. Checking for \"config.json\"\n\nICONIC Stealer was then observed to steal the following system information:\n\nHostName\nDomainName\nOsVersion\n\nThe gathered data will then be converted into a text-string format.\n\nFigure 8. Converting gathered data into a text-string\n\nformat\nICONIC Stealer then proceeds to its last behavior, which steals browser data. It uses the function shown in Figure 9 to traverse the infected\nsystem using predefined directories related to the browser’s history and other browser-related information.\n\n\n-----\n\nThe following figure shows a list of predefined strings:\n\n\nFigure 9. Function for traversing the infected system\n\nFigure 10. List of predefined strings\n\n\nThe system directories on the following list compose the targets identified in the partial analysis of the ICONIC Stealer’s behavior. More\ninformation will be provided as this blog is updated.\n\nAppData\\Local\\Google\\Chrome\\User Data\nAppData\\Local\\Microsoft\\Edge\\User Data\nAppData\\Local\\BraveSoftware\\Brave-Browser\\User Data\nAppData\\Roaming\\Mozilla\\Firefox\\Profiles\n\n**Browser** **Target information**\n\nChrome History\n\nEdge History\n\nBrave History\n\nFirefox _places.sqlite_\n\nTable 1. The targeted section of each browser. Note that \"places.sqlite\" stores the annotations, bookmarks, favorite icons, input history, keywords, and the browsing history of visited pages forMozilla Firefox.\n\nICONIC Stealer was also found with the capability to limit the retrieved data to the first five hundred entries to ensure that the most recent\nbrowser activity is the data that is retrieved:\n\nFigure 11. Limiting data to the first 500 entries\n\n\"UTF-16LE\", 'SELECT url, title FROM urls ORDER BY id DESC LIMIT\n\n\"UTF-16LE\", '500',0\n\n\n-----\n\nU 6, S C u, t t e O o _p aces O d SC\n\n\"UTF-16LE\", 'LIMIT 500',0\n\nFigure 12. Retrieved results stored on an allocated\n\nbuffer\nThe gathered data will be passed to the main loader module to POST then back to the C&C server embedded in the main module.\n\nWhat is its potential impact?\n\nDue to its widespread use and its importance in an organization’s communication system, threat actors can cause major damage (for example,\nby monitoring or rerouting both internal and external communication) to businesses that use this software.\n\nWhat can organizations do about it?\n\nOrganizations that are potentially affected should stop using the vulnerable version if possible and apply the patches or mitigation workarounds\nif these are available. IT and security teams should also scan for confirmed compromised binaries and builds and monitor for anomalous\nbehavior in 3CX processes, with a particular focus on C&C traffic.\n\nMeanwhile, enabling behavioral monitoring in security products can help detect the presence of the attack within the system.\n\n**Indicators of Compromise (IOCs)**\n\n\n**SHA256**\n\ndde03348075512796241389dfea5560c20a3d2a2eac95c894e7bbed5e85a0acc\n\nInstaller: aa124a4b4df12b34e74ee7f6c683b2ebec4ce9a8edcf9be345823b4fdcf5d868\n\nfad482ded2e25ce9e1dd3d3ecc3227af714bdfbbde04347dbc1b21d6a3670405\n\nInstaller: 59e1edf4d82fae4978e97512b0331b7eb21dd4b838b850ba46794d9c7a2c0983\n\n\n**File name /**\n**details** **Detection name**\n\n\n3cxdesktopapp18.12.407.msi\n(Windows)\n\n\nTrojan.Win64.DEEFFACE.A\n\n\n(Windows) Trojan.Win64.DEEFFACE.A\n\n\nc485674ee63ec8d4e8fde9800788175a8b02d3f9416d0e763360fff7f8eb4e02 ffmpeg.dll Trojan.Win64.DEEFFACE.A\n\n\n7986bbaee8940da11ce089383521ab420c443ab7b15ed42aed91fd31ce833896\n\n\nffmpeg.dll Trojan.Win64.DEEFFACE.A\n\n\n11be1803e2e307b647a8a7e02d128335c448ff741bf06bf52b332e0bbf423b03 d3dcompiler.dll Trojan.Win64.DEEFFACE.A\n\n4e08e4ffc699e0a1de4a5225a0b4920933fbb9cf123cde33e1674fde6d61444f Trojan.Win32.DEEFFACE.ICO\n\n8ab3a5eaaf8c296080fadf56b265194681d7da5da7c02562953a4cb60e147423 Stealer\n\nTrojanSpy.Win64.ICONICSTEALER.\n\nHere is the list of IOCs for Mac users:\n\n**SHA256** **File name** **Detection name**\n\n\n5a017652531eebfcef7011c37a04f11621d89084f8f9507201f071ce359bea3f 3CX Desktop Appdarwin-x6418.11.1213.zip\n\n5407cda7d3a75e7b1e030b1f33337a56f293578ffa8b3ae19c671051ed314290 3CXDesktopApp18.11.1213.dmg\n\n\nfee4f9dabc094df24d83ec1a8c4e4ff573e5d9973caa676f58086c99561382d7\n\n\nlibffmpeg.dylib\n\n\n5009c7d1590c1f8c05827122172583ddf924c53b55a46826abf66da46725505a child macho file of\nlibffmpeg.dylib\n\n\nTrojan.MacOS.FAKE3L3CTRON.A\n\nTrojan.MacOS.FAKE3L3CTRON.A\n\nTrojan.MacOS.FAKE3L3CTRON.A\n\nTrojan.MacOS.FAKE3L3CTRON.A\n\nTrojan.MacOS.FAKE3L3CTRON.A\n\n\ne6bbc33815b9f20b0cf832d7401dd893fbc467c800728b5891336706da0dbcec\n\na64fa9f1c76457ecc58402142a8728ce34ccba378c17318b3340083eeb7acc67\n\n\n3CXDesktopApp18.12.416.dmg\n\n\nlibffmpeg.dylib Trojan.MacOS.FAKE3L3CTRON.A\n\n\n-----\n\n87c5d0c93b80acf61d24e7aaf0faae231ab507ca45483ad3d441b5d1acebc43c\n\n\nchild macho file of\nlibffmpeg.dylib\n\n\nTrojan.MacOS.FAKE3L3CTRON.A\n\n\nThe following domains are blocked by Trend Micro Web Reputation Services (WRS)\n\n**akamaicontainer[.]com**\n**akamaitechcloudservices[.]com**\n**azuredeploystore[.]com**\n**azureonlinecloud[.]com**\n**azureonlinestorage[.]com**\n**dunamistrd[.]com**\n**glcloudservice[.]com**\n**journalide[.]org**\n**msedgepackageinfo[.]com**\n**msstorageazure[.]com**\n**msstorageboxes[.]com**\n**officeaddons[.]com**\n**officestoragebox[.]com**\n**pbxcloudeservices[.]com**\n**pbxphonenetwork[.]com**\n**pbxsources[.]com**\n**qwepoi123098[.]com**\n**sbmsa[.]wiki**\n**sourceslabs[.]com**\n**visualstudiofactory[.]com**\n**zacharryblogs[.]com**\n\nTrend Micro XDR uses the following filters to protect customers from 3CX-related attacks:\n\n**Filter** **ID** **OS**\n\nCompromised 3CX Application File Indicators F6669 macOS, Windows\n\nDLL Sideloading of 3CX Application F6668 Windows\n\nWeb Reputation Services Detection for Compromised 3CX Application F6670 macOS, Windows\n\nSuspicious Web Access of Possible Compromised 3CX Application F6673 Windows\n\nSuspicious DNS Query of Possible Compromised 3CX Application F6672 Windows\n\n**Trend Micro Malware Detection Patterns for Endpoint, Servers (Apex One, Worry-Free Business Security Services, Worry-Free**\n**Business Security Standard/Advanced, Deep Security with anti-malware, among others), Mail, and Gateway (Cloud App Security,**\n**ScanMail for Exchange, IMSVA):**\n\nStarting with Trend Micro Smart Scan Pattern (cloud-based) TBL 21474.200.40, known trojanized versions of this application are being\ndetected as Trojan Win64.DEEFFACE.A.\nThe Mac version of this threat is detected as Trojan.MacOS.FAKE3L3CTRON.A.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-03-30 - Developing Story- Information on Attacks Involving 3CX Desktop App.pdf"
    ],
    "report_names": [
        "2023-03-30 - Developing Story- Information on Attacks Involving 3CX Desktop App.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1683338906,
    "ts_updated_at": 1743041150,
    "ts_creation_date": 1683251085,
    "ts_modification_date": 1683251085,
    "files": {
        "pdf": "https://archive.orkl.eu/47be04c6a12835f3016d745ee710d9fa336d8bee.pdf",
        "text": "https://archive.orkl.eu/47be04c6a12835f3016d745ee710d9fa336d8bee.txt",
        "img": "https://archive.orkl.eu/47be04c6a12835f3016d745ee710d9fa336d8bee.jpg"
    }
}