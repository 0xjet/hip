{
    "id": "b6b49a92-bf4d-411d-8c19-48173f74cd7b",
    "created_at": "2023-01-12T15:05:58.469193Z",
    "updated_at": "2025-03-27T02:05:42.403944Z",
    "deleted_at": null,
    "sha1_hash": "36858d2f81996b8a9728f30b3056771e69dcb702",
    "title": "2022-03-28 - Spoofed Invoice Used to Drop IcedID",
    "authors": "",
    "file_creation_date": "2022-05-28T19:38:47Z",
    "file_modification_date": "2022-05-28T19:38:47Z",
    "file_size": 294566,
    "plain_text": "# Spoofed Invoice Used to Drop IcedID\n\n**[fortinet.com/blog/threat-research/spoofed-invoice-drops-iced-id](https://www.fortinet.com/blog/threat-research/spoofed-invoice-drops-iced-id)**\n\nMarch 28, 2022\n\nSpearphishing crafted with industry-specific terms derived from intelligence gathering techniques\nto trick a recipient into opening a file is especially difficult to identify. This is especially true when\nan adversary has knowledge of how a business works and the processes that underpin it. Using\nthis knowledge, a lure can be crafted that takes advantage of these day-to-day processes – for\nexample, settling the cost of a fuel transaction.\n\nFortiGuard Labs recently encountered such a scenario, where a fuel company in Kyiv, Ukraine\nreceived a spearphishing e-mail that contained an attached invoice—seemingly from another\nfuel provider—that was spoofed. The attachment is a zip file that contains the IcedID Trojan.\n\nIcedID has been observed as far back as 2017. Its primary function is to steal banking\ncredentials and personal information. It is also capable of deploying additional malware from the\nsame group or partner organizations.\n\n\n-----\n\nThis instance also uses an interesting deployment method. It uses the ISO format, which is\nmounted automatically as a disk in Windows. ISO files can also be used to create bootable CDROMs or install an operating system or virtual machine. It also contains a LNK (shortcut file)\nused to launch a DLL (Dynamic-link Library).\n\nThis blog details the infection process and subsequent malware deployment by the threat actors\nbehind IcedID.\n\n**Affected Platforms: Windows**\n**Impacted Users: Windows users**\n**Impact: Compromised machines are under the control of the threat actor**\n**Severity Level: Medium**\n\n## The Phishing E-mail\n\nThe e-mail originated from an IP address in Belize, at 179[.]60[.]150[.]96. It spoofs the\noriginating e-mail address to appear to have been sent from another fuel provider in Ukraine.\nThe e-mail contains both English and Ukrainian elements and looks realistic given the mention\nof extra security measures regarding the attachment.\n\nFigure 1. Phishing e-mail.\n\nAttached to the e-mail is a file named “invoice_15.zip”. Extracting the Zip file will drop\n“invoice_15.iso” and begin the first phase of infection.\n\n## ISO\n\nWindows is capable of mounting iso files as external disks. Doing so will present the user with a\nshortcut called “document.” In most cases, the file extension will be hidden from the user,\nmaking it appear as an actual document.\n\nFigure 2. ISO file with contents hidden.\n\nWhen the full contents of the iso container are revealed, a DLL file can also be seen.\n\nFigure 3. Full contents of the ISO file.\n\n## LNK\n\nFigure 4. Shortcut details.\n\nAs seen in Figure 4, the shortcut file was created some time prior to the sending of the phishing\ne-mail. Additionally, the highlighted area shows what will occur should the shortcut be clicked on\nby a user.\n\nIn this case, Regsvr32 is used to register “main.dll” with the Windows registry and launch the\ncode contained within. This action begins the next phase of infection.\n\n\n-----\n\n## Dropper\n\n“main.dll” acts as a dropper for IcedID. Static analysis of the file reveals an interesting point.\n\nFigure 5. Example of strings embedded in “main.dll”\n\nWhat at appears at first glance to be an easy win for IOCs (Indicators of Compromise) because\nit contains a domain and IP address, turns out to be slightly more complicated.\n\nFigure 6. Code represented in IDA Pro showing the information from Figure 5.\n\nIn comparing the area of code where the strings in Figure 5 are stored, we find that this area is\nnot called by any functions within “main.dll”. To illustrate this, the right-hand side of the very first\nline in Figure 6 contains “Data XREF:”. This indicates that it is referenced elsewhere in the code.\nThe strings from Figure 5, however, do not include this information, indicating they are not.\n\nBy investigating further, the story becomes even more interesting. This code appears in a\nStackOverflow question from approximately 10 years ago concerning an issue about\ndownloading an image over HTTP (https://stackoverflow.com/questions/9389183/downloading-apicture-with-http-get-only-downloads-a-small-part-of-it). It should be noted that there is no\nmalicious intent with the content of that posting.\n\nThat it is now part of “main.dll” indicates it is a decoy for analysts in the hope the actual\nindicators won’t be blocked.\n\nFigure 7. Information gathering by IcedID.\n\nAs can be seen in Figure 7, once running, the malware uses several Windows command-line\ntools to obtain information about the local environment. These include capturing the local IP\naddress (ipconfig), enumerating domain trusts (nltest), and capturing a list of domain\nadministrators (net group), among others.\n\nThe sample then tries to communicate outbound to a command and control (C2) server. There\nare multiple addresses the malware can connect to in the event one of the destinations becomes\nunavailable.\n\nFigure 8. Network communication.\n\nFigure 9. HTTP GET request.\n\nIf a connection to a C2 server has been made, the malware then moves to ensure persistence. It\ninstalls a copy of itself in the user’s temp directory, “%APPDATA%\\local\\temp”.\n\nFigure 10. Dropping “Arur.exe” into the Temp directory.\n\n## Conclusion\n\n\n-----\n\nThreat actors that are knowledgeable of their targets are able to increase their chances of\ninstalling an implant within an organization. Based on our observations, the efforts used in this\nIcedID attack highlight the groups methodical effort, as evidenced by their research of Ukraine's\nretail fuel industry. Additionally, the use of uncommon deployment methods (zipped ISO file) to\nestablish a foothold—and ultimately gain persistence within an organization—reveals how crafty\nthe threat actors are able to be to obtain unauthorized access.\n\n## Fortinet Protections\n\nAll IcedID samples mentioned in this blog are detected by the following (AV) signatures:\n\nW32/Kryptik.HOTN!tr\n\nW64/Kryptik.CXY!tr\n\nW64/Kryptik.CXY!tr\n\nW64/Kryptik.CXY!tr\n\nLNK/IceID.AW!tr\n\nW64/Kryptik.CXY!tr\n\nAll network based URI’s are blocked by the WebFiltering client.\n\nFortinet has multiple solutions designed to help train users to understand and detect phishing\nthreats:\n\nThe [FortiPhish Phishing Simulation Service uses real-world simulations to help organizations](https://www.fortinet.com/products/phishing-simulation)\ntest user awareness and vigilance to phishing threats and to train and reinforce proper practices\nwhen users encounter targeted phishing attacks.\n\nIn addition to these protections, we suggest that organizations also have their end users go\nthrough our FREE [NSE training:](https://training.fortinet.com/?utm_source=blog&utm_campaign=nse-institute) [NSE 1 – Information Security Awareness. It includes a module](https://training.fortinet.com/local/staticpage/view.php?page=nse_1&utm_source=blog&utm_campaign=nse-1)\non Internet threats that is designed to help end users learn how to identify and protect\nthemselves from various types of phishing attacks.\n\n## IOCs\n\nFilename SHA256\n\ninvoice_15.zip 83bd20009107e1f60479016046b80d473436d3883ad6989e5d42bc08e142b5bb\n\ninvoice_15.iso 3542d5179100a7644e0a747139d775dbc8d914245292209bc9038ad2413b3213\n\ndocument.lnk a17e32b43f96c8db69c979865a8732f3784c7c42714197091866473bcfac8250\n\nmain.dll 698a0348c4bb8fffc806a1f915592b20193229568647807e88a39d2ab81cb4c2\n\n\n-----\n\nArur.exe 283d5eea1f9fc34e351deacc25006fc1997566932fae44db4597c84f1f1f3a30\n\n## Network IOCs:\n\n160[.]153[.]32[.]99\n\n160[.]90[.]198[.]40\n\nyourgroceries[.]top\n\nssddds1ssd2[.]com\n\nip-160-153-32-99[.]ip[.]secureserver[.]net\n\n_Thanks to Val Saengphaibul and Fred Gutierrez who helped contribute to this blog._\n\n_Learn more about Fortinet’s_ _[FortiGuard Labs threat research and intelligence organization and](https://www.fortinet.com/fortiguard/labs?utm_source=blog&utm_campaign=fortiguard-labs)_\n_[the FortiGuard Security Subscriptions and Services portfolio.](https://www.fortinet.com/fortiguard/labs?tab=security-bundles&utm_source=blog&utm_campaign=security-bundles)_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-28 - Spoofed Invoice Used to Drop IcedID.pdf"
    ],
    "report_names": [
        "2022-03-28 - Spoofed Invoice Used to Drop IcedID.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535958,
    "ts_updated_at": 1743041142,
    "ts_creation_date": 1653766727,
    "ts_modification_date": 1653766727,
    "files": {
        "pdf": "https://archive.orkl.eu/36858d2f81996b8a9728f30b3056771e69dcb702.pdf",
        "text": "https://archive.orkl.eu/36858d2f81996b8a9728f30b3056771e69dcb702.txt",
        "img": "https://archive.orkl.eu/36858d2f81996b8a9728f30b3056771e69dcb702.jpg"
    }
}