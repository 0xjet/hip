{
    "id": "25232812-80dd-431b-8208-3d34cb9571da",
    "created_at": "2023-01-12T14:59:49.587197Z",
    "updated_at": "2025-03-27T02:06:05.191684Z",
    "deleted_at": null,
    "sha1_hash": "91497da45db8a115cee013c589670b9f61ec1650",
    "title": "2022-02-03 - Analysis of Attack Against National Games of China Systems",
    "authors": "",
    "file_creation_date": "2022-05-28T17:44:42Z",
    "file_modification_date": "2022-05-28T17:44:42Z",
    "file_size": 906893,
    "plain_text": "# Analysis of Attack Against National Games of China Systems\n\n**[decoded.avast.io/janneduchal/analysis-of-attack-against-national-games-of-china-systems/](https://decoded.avast.io/janneduchal/analysis-of-attack-against-national-games-of-china-systems/)**\n\nFebruary 3, 2022\n\nby [David Álvarez Pérez and Jan NeduchalFebruary 3, 20229 min read](https://decoded.avast.io/janneduchal/analysis-of-attack-against-national-games-of-china-systems/)\n\n## Introduction\n\nOn `September 15, 2021 the` [National Games of China began in the](https://en.wikipedia.org/wiki/National_Games_of_China(opens%20in%20a%20new%20tab)) `Chinese city of` `Shaanxi . It is`\nan event similar if not identical to the Olympics, but only hosts athletes from China. Earlier in\n[September, our colleague David Álvarez found a malware sample with a suspicious file extension of a](http://10.10.0.46/mailto:david.alvarez@avast.com)\npicture and decided to investigate where it came from. Later, he also found a report of the incident from\nthe `National Games IT team on` `VirusTotal stating that the attack occurred before the Games`\nstarted. Attached to the report were access logs from the web-server and `SQL database. By analyzing`\nthese logs, we gathered initial information about the attack. These logs only include request path, and\nsadly do not reveal content of `POST requests much needed to fully understand what commands`\nattackers sent to their web shells, but even with this limited information we were able to outline the\nattack and determine the initial point of intrusion with moderate confidence.\n\nIn this posting, we are sharing our own research on the incident, the samples and the exploits used by\nthe attackers, detailing what appears to be a successful breach of systems hosting content for the\n```\n National Games prior to the event. We based our research on publicly accessible information about\n\n```\nthe incident. The analyzed samples were already present on `VirusTotal .`\n\nBased on the initial information from the report and our own findings, it appears the breach was\nsuccessfully resolved prior to the start of the games. We are unable to detail what actions the attackers\nmay have taken against the broader network. We also are unable to make any conclusive attribution of\nthe attackers, though have reason to believe they are either native `Chinese-language speakers or`\nshow high fluency in Chinese.\n\n## Gaining access\n\nThe evidence indicates that the attackers gained initial code execution at around `10:00AM local time`\non `September 3, 2021 and installed their first reverse shell executing scripts`\ncalled runscript.lua . We suspect that the way this happened is via an arbitrary file-read exploit\ntargeting either `route.lua which, according to the` `API (Application User Interface) extracted`\nfrom various `JavaScript files, is a` `LUA script containing a lot of functionality from handling login`\n\n\n-----\n\nauthentication to manipulation of files or `index.lua in combination with` `index.lua?a=upload API`\nthat was not used by anyone else in the rest of the network log. It’s also worth noting that\n```\nrunscript.lua was not mentioned in the report or included in the attacker uploaded files.\n\n```\nAfter gaining initial access the attackers uploaded several other reverse shells such as `conf.lua,`\n```\nmiss1.php or admin2.php (see table 2 for source code) to gain a more permanent foothold in the\n\n```\nnetwork in case one of the shells got discovered. These reverse shells get commands via a `POST`\nrequest, thus the data is not present in the logs attached with the report as they only contain the `URL`\n```\npath .\n\n```\nIn the screenshot we can see that the attackers were getting a lot of data returned to them from the\nbackdoors ( highlighted )\n\nEven more so the logs in the report don’t contain full information about the network traffic such that we\ncould with certainty determine how and when the attackers gained their first web shell. We estimated\nour findings by looking for a point in time from which they uploaded and interacted with the first custom\nweb shell we can find.\n\n## What they did there\n\nThe attackers started doing some tests on what they were able to upload to the server. From `August`\n```\n26, 2021 to September 9, 2021 the attackers tried submitting files with different file-types and also\n\n```\nfile extensions. For instance, they submitted the same legitimate image (\n```\n7775b6a45da80c1a8a0f8e044c34be823693537a0635327b967cc8bff3cb349a ) with different file\n\n```\nextensions: `ico,` `lua,` `js,` `luac,` `txt,` `html and` `rar .`\n\nAfter gaining knowledge on blocked and allowed file types, they tried to submit executable code. Of\ncourse, they started submitting `PoCs instead of directly executing a webshell because submitting`\n```\nPoCs is more stealthy and also allows one to gain knowledge on what the malicious code is allowed to\n\n```\ndo. For instance, one of the files uploaded was this Lua script camouflaged as an image ( 20210903```\n160250-168571-ab1c20.jpg ):\n\n```\n```\nos.execute(\"touch\",\"/tmp/test.miss\")\n\n```\n\n-----\n\nTaking advantage of the Lua `io.popen function, which executes a command and returns process`\noutput, the attackers used variants of the following command camouflaged as images to test different\nwebshells:\n\n```\nio.popen(\"echo 'Base64EncodedWebshell' |base64 -d > ../mod/remote/miss.php\")\n\n```\n\n[They tested different Chinese webshells (i.e. Godzilla webshell), but this information is not enough to](https://www.geekby.site/2021/03/webshell%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/)\nconfidently attribute the attack to any threat actor.\n\nThe attackers decided to reconfigure the web server by uploading their own `www.conf file`\ncamouflaged as a `PNG file consisting of a default configuration but allowing the` `.lua extension to be`\nexecuted. We suspect that the server was configured to execute new threads in a thread pool which\ndidn’t work for [Rebeyond Behinder (a powerful Chinese webshell) they wanted to execute. They were](https://github.com/rebeyond/Behinder/releases)\nnot able to successfully reconfigure the server to execute it. So, as final payload, they uploaded and ran\n[an entire Tomcat server properly configured and weaponized with Rebeyond Behinder.](https://github.com/rebeyond/Behinder/releases)\n\n[It is important to mention that they were able to upload some tools (dnscrypt-proxy,](https://github.com/DNSCrypt/dnscrypt-proxy) [fscan,](https://github.com/shadow1ng/fscan/releases) mssqlcommand-tool, [behinder) to the server and execute a network scanner ( fscan ) and a custom one-](https://github.com/rebeyond/Behinder/releases)\nclick exploitation framework that we want to discuss below in more detail.\n\nThe aforementioned Chinese scanner and exploitation framework is written in `Go programming`\nlanguage and distributed as a single binary, which allows to execute all the steps of exploitation by\nsimply feeding it with an `IP or a range of IPs (those can be passed as arguments to the program or`\nusing a text file) which makes of it an excellent tool to quickly hack computer systems belonging a\nnetwork environment.\n\nThe tool is well organized. It is structured with plugins that allow it to perform all the necessary steps to\nautonomously hack other devices within the same network.\n\n1. Plugins/Web/Finger: Performs a fingerprint to recognize services. Currently, it supports the\n\nfollowing fingerprints: IBM, Jboss, shiro, BIG-IP, RuiJie, Tomcat, Weaver, jeecms, seeyon, shterm,\n_tongda, zentao, Ueditor, ioffice, outlook, yongyou, Coremail, easysite, FCKeditor, Fortigate,_\n_FineReport, SangforEDR, Springboot, thinkphp_1, thinkphp_2, thinkphp_3, thinkphp_4,_\n_easyConnect and weblogic_async._\n2. Plugins/Service: Attacks services in order to get access to it. Currently, it supports the following\n\nservices: ssh, smb, redis, mysql, mssql, ms17010 (EternalBlue SMB exploit) and ftp.\n3. Plugins/PwdTxt: Lists of both, username and password, short dictionaries for each service in\n\nPlugins/Service allowing to perform a brief brute force attack on the service.\n4. Plugins/Web/Poc: Modules to exploit common web applications. Currently, it supports the\n\nfollowing exploits: Jeecms_SSRF1, yongyou_rce1, RuiJie_RCE1, outlook_ews, thinkphp_RCE1,\n_thinkphp_RCE2, thinkphp_RCE3, thinkphp_RCE4, thinkphp_RCE5, thinkphp_RCE6,_\n_RuiJie_Upload1, Weaver_Upload1, yongyou_upload1, weblogic_console, phpstudy_backdoor,_\n_yongyou_readFile1, Jboss_unAuthConsole, Jboss_CVE_2017_12149,_\n_weblogic_CVE_2019_2618._\n\nAn example of a Plugin is `plugins/Web/Poc/Weblogic_CVE_2019_2618 .`\n\nIn the left side of the following screenshot you can see a scan executed in our lab, targeting a `Python`\nserver (terminal in the right side of the screenshot) with the exploit payload request highlighted in a red\nrectangle.\n\n\n-----\n\nFor more information on the payloads, please, refer to IoCs, Table 2.\n\n## Conclusion\n\nThe procedure followed by the attackers hacking the `14th National Games of China is not new at`\nall. They gained access to the system by exploiting a vulnerability in the web server. This shows the\nneed for updating software, configuring it properly and also being aware of possible new vulnerabilities\nin applications by using vulnerability scanners.\n\nThe most fundamental security countermeasure for defenders consists in keeping the infrastructure upto-date in terms of patching. Especially for the Internet facing infrastructure.\n\nPrevention should be the first priority for both internal and Internet facing infrastructure.\n\nWebshells are a post exploitation tool that can be very difficult to detect. Some webshells don’t even\ntouch the filesystem residing only in memory; this can make it even harder to detect and identify. After\nimplanting, webshells are mostly identified via unusual network traffic or anomalous network traffic\nindicators.\n\nTo protect against this kind of attack, it is important to deploy more layers of protection (i.e. `SELinux,`\n```\nEndpoint Detection and Response solutions and so on) such that you can detect and quickly act\n\n```\nwhen a successful intrusion happens.\n\nAfter gaining access, the attackers tried to move through the network using exploits and bruteforcing\nservices in an automated way. Since getting to this point is very possible for attackers, defenders must\nbe prepared. Real Time monitoring of computer systems and networks is the right way to do that.\n\nFinally, the attackers used an exploitation framework written in the Go programming language to move\nthrough the network. Go is a programming language becoming more and more popular which can be\ncompiled for multiple operating systems and architectures, in a single binary self-containing all\ndependencies. So we expect to see malware and grey tools written in this language in future attacks,\nespecially in IoT attacks where a broad variety of devices leveraging different kinds of processor\narchitectures are involved.\n\n\n-----\n\n## IoCs\n\nSHA + original filename Description\n\n```\n 0c6ae9de10bee6568ec3ad24918c829b7e5132cc0dd1665d4bbf1c3fe84451b6\n\n```\n20210902-104211-659035-88486d.zip\n```\n 0d1504a9ae319bdc320f938d2cdf72cba18277b3f2b311abf0bacad2517dabc0\n\n```\n20210903-163606-280628-0a82f3.txt\n```\n cac30cc2f4646979d0be8b4d5f3a1f87351b3bb77f22e5064bd034cec9e119bb\n\n```\n20210903-170452-952751-b9106e.txt\n```\n 0aeb963b4566dc2224d34b4885336c666198db2ac64c810586ce3b17ef3da59f\n\n```\n20210903-171141-909389-0f6e83.txt\n```\n dffa7e31797339f3ce7ec453161b60010eda3dd2e52aa9f147ab4389672c3536\n\n```\n20210903-194355-378055-c6cb9c.txt\n```\n bdd4d0bb36d07ae6b97ffbcd386c54e1b15fefe65329ff0389dfd5739cd3cff2\n\n```\n20210904-122732-780555-5c07b2.rar\n```\n 3a8dc7e730a1f82f65f1731cb31e05e2f749a9e89ab8529168a082d24680d2dd\n\n```\n20210904-153039-541730-a843fe.zip\n```\n ec8aef085d3cc57a4e92a613e128f2d9c7b5f03b8e017dd80d89bfeada228639\n\n```\n20210904-160830-117786-b5cab7.rar\n20210904-161031-883832-c50992.rar\n```\n 2cab3b0391bf3ace689fc697f522b3c86411e059ab8c1f4f5b7357b484b93035\n\n```\n20210904-164301-268472-915428.zip\n```\n d033756a57d8a2758de40895849e2146d571b3b44f3089eb68c31483784586cd\n\n```\n20210904-112719-261644-c9c5eb.jpg\n\nTable 1\n\nProof of concept Payload\n\nYongyou_upload1 Request GET /aim/equipmap/accept.jsp\n\n\nEncrypted ZIP file\n\nShellcode dropper\n\nSingle line\nshellcode\n\nRebeyond\nshellcode dropper\n\nShellcode dropper\n\nUPX compressed\nMssql Toolkit\n\n[FScan for Linux](https://github.com/shadow1ng/fscan/releases)\n\nCustom\nexploitation\nframework\n\nRebeyond\nBehinder webshell\n\nUPX Compressed\nDNS Proxy for\nLinux\n\n\nThinkPHP_RCE4 Request POST /index.php?s=/Index/\\\\think\\\\app/invokefunction\n\nData function=call_user_func_array&vars[0]=base64_encode&vars[1]\n\n[]=123456\n\nThinkPHP_RCE5 Request POST /index.php?s=/Index/\\\\think\\\\app/invokefunction\n\nData function=call_user_func_array&vars[0]=base64_encode&vars[1]\n\n[]=123456\n\nThinkPHP_RCE6 Request POST /public/?s=captcha/MTIzNDU2\n\nData _method=__construct&filter[]=print_r&method=GET&s=1\n\nyongyou_rce1 Request GET /service/monitorservlet\n\n\n-----\n\nRuiJie_Upload1 Request GET /ddi/server/fileupload.php\n\nWeaver_Upload1 Request GET /page/exportImport/uploadOperation.jsp\n\nphpstudy backdoor Request GET /\n\nHeaders User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64)\nAppleWebKit/537.36 (KHTML, like Gecko)\nChrome/55.0.2883.75 Safari/537.36\nAccept-Encoding: gzip,deflate\n\nThinkPHP_RCE2 Request GET /index.php?s=index/think\\\\request/input?\ndata=123456&filter=base64_encode\n\nyongyou_readFile1 Request GET /NCFindWeb?service=&filename=\n\nweblogic_CVE_2019_2618 Request GET /bea_wls_deployment_internal/DeploymentService\n\n\nOutlook ews (Interface\nblasting)\n\n\nRequest GET /ews\n\n\nThinkPHP_RCE1 Request GET /index.php?s=index/\\\\think\\\\app/invokefunction&function=\ncall_user_func_array&vars[0]=base64_encode&vars[1]\n\n[]=123456\n\nThinkPHP_RCE3 Request GET /index.php?\ns=index/\\\\think\\\\Container/invokefunction&function=\ncall_user_func_array&vars[0]=base64_encode&vars[1]\n\n[]=123456\n\n[CVE_2020_14882](https://www.cnblogs.com/cn-gov/p/13903278.html) Request GET /console/\n\n\nJboss JMXInvokerServlet\n(Deserialization)\n\nJboss (Unauthorized\naccess to the console)\n\nJboss JMXInvokerServlet\n(Deserialization)\n\n\nRequest GET /index.php?\ns=index/\\\\think\\\\Container/invokefunction&function=\ncall_user_func_array&vars[0]=base64_encode&vars[1]\n\n[]=123456\n\nRequest GET /jmx-console/index.jsp\n\nRequest GET /index.php?\ns=index/\\\\think\\\\Container/invokefunction&function=\ncall_user_func_array&vars[0]=base64_encode&vars[1]\n\n[]=123456\n\n\njeecms SSRF to Upload Request GET /ueditor/getRemoteImage.jspx?\nupfile=http://127.0.0.1:80/1.png\n\nRuiJie_RCE1 Request GET /guest_auth/guestIsUp.php\n\nTable 2\n\n## Files\n\n```\nadmin2.php\n\n```\n\n-----\n\n## IoC repository\n\n[Files and IoCs are in our IoC repository](https://github.com/avast/ioc/tree/master/NationalGamesOfChina)\n\n[Tagged asanalysis,](https://decoded.avast.io/tag/analysis/) [backdoor,](https://decoded.avast.io/tag/backdoor/) [malware,](https://decoded.avast.io/tag/malware/) [reversing](https://decoded.avast.io/tag/reversing/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-03 - Analysis of Attack Against National Games of China Systems.pdf"
    ],
    "report_names": [
        "2022-02-03 - Analysis of Attack Against National Games of China Systems.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535589,
    "ts_updated_at": 1743041165,
    "ts_creation_date": 1653759882,
    "ts_modification_date": 1653759882,
    "files": {
        "pdf": "https://archive.orkl.eu/91497da45db8a115cee013c589670b9f61ec1650.pdf",
        "text": "https://archive.orkl.eu/91497da45db8a115cee013c589670b9f61ec1650.txt",
        "img": "https://archive.orkl.eu/91497da45db8a115cee013c589670b9f61ec1650.jpg"
    }
}