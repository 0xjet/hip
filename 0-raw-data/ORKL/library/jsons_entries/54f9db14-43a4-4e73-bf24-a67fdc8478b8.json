{
    "id": "54f9db14-43a4-4e73-bf24-a67fdc8478b8",
    "created_at": "2023-01-12T15:00:03.165103Z",
    "updated_at": "2025-03-27T02:05:54.639064Z",
    "deleted_at": null,
    "sha1_hash": "19052e598a163257646c53a1afd42b1faafed983",
    "title": "2018-06-06 - Banking Trojans Under Development",
    "authors": "",
    "file_creation_date": "2022-05-28T18:06:21Z",
    "file_modification_date": "2022-05-28T18:06:21Z",
    "file_size": 1145325,
    "plain_text": "# Banking Trojans Under Development\n\n**research.checkpoint.com/banking-trojans-development/**\n\nJune 6, 2018\n\nJune 6, 2018\nAlthough banks themselves have taken measures to strengthen the security of their\nauthentication processes, Banker Trojans, however, are still a popular tool for stealing user’s\nfinancial details and draining bank accounts.\n\nThe Check Point Research team recently came across one such banking Trojan under\ndevelopment and already being distributed through the RIG Exploit Kit. Dubbed ‘Karius’, the\nTrojan aims to carry out web injects to add additional fields into a bank’s legitimate login\npage and send the inputted information to the attacker.\n\nWhile Karius is not yet in full infection mode, initial tests have already been made and our\nresearch below shows the evolution of how such malware takes place. Our analysis also\nshows how banking trojans such as Karius are put together and makes use of code from\nother well-known bankers such as Ramnit, Vawtrak and TrickBot.\n\n**Malware Analysis**\n\n\n-----\n\nKarius works in a rather traditional fashion to other banking malware and consists of three\ncomponents:\n\ninjector32\\64.exe\nproxy32\\64.dll\nmod32\\64.dll\n\nThese components essentially work together to deploy webinjects in several browsers, thus\nintercepting the user’s communication to the internet.\n\nNormally, the content sought in the intercepted traffic would be a specific banking website\nthat the victim has visited. This site would then be modified so as to trick the user to enter his\ncredentials which are then sent to the attacker. However, it seems that this malware is still in\na development and possibly in testing stages, which is why the webinjects don’t yet target\nany financial institutions in particular.\n\nThe initial component that will be executed is injector32.exe (or injector64.exe, its\nequivalent for 64 bit systems). This component is responsible for several actions, namely:\n\nModifying several registry keys, for the purpose of disabling protection mechanisms in\nInternet Explorer.These include:\n\n1. HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\Zones\\3\\2500 =\n\nDWORD:3\n2. HKCU \\Software\\Microsoft\\Internet Explorer\\Main\\TabProcGrowth = DWORD:0\n3. HKCU \\Software\\Microsoft\\Internet Explorer\\Main\\NoProtectedModeBanner =\n\nDWORD:1\n\nCopying itself to the startup directory with the name TEMP APPLICATION.lnk as a\nmeans of persistence, as well as creating a duplicate under the name\n%USERPROFILE%/music/temp.exe.\nWriting a batch script to disk which will delete the original file.\nContacting the Command and Control (C&C) server for registering the bot using a\nmessage with the following json structure:\n\n{“id”: “<computer_name_hash><digital_product_id_hash>”\n\n“action”: “register”\n\n“os”: “<os_version>”\n\n“lang”: “<lang>”\n\n“integrity”: “None”\n\n“admin”: “admin”\n\n\n-----\n\ngroup : group\n\n}\n\nAfter contacting the C&C server, the malware would then send a message with a similar id\nand a “ping” action, which is then responded to by the server with one of two commands –\n\n**Update – sends a binary with a new version of the malware.**\n\n**Config – issues a webinjects configuration payload, saved to a file named “temp.bin”.**\n\nAll the traffic to the C&C server will then be encrypted with RC4 using a key hardcoded in a\nconfiguration struct that resides within the .cfg section of this module’s binary.\n\ncfg section:\n\n**_Figure 1: The .cfg section of the configuration module’s library._**\n\n– Creating the named pipe “\\\\.\\pipe\\form” in order to communicate with other modules, which\nin turn use it to forward stolen credentials to it. This data will then be sent to the C&C\nperiodically (upon an interval predefined in the internal configuration section), using the\nfollowing message format:\n\n{“id”: “<computer_name_hash><digital_product_id_hash>”\n\n“action”: “report”\n\n“url”: “<url_of_stolen_credentials>”\n\n\n-----\n\nbrowser : UNK\n\n“Data”: “<data_of_stolen_credentials>”\n\n}\n\n– Decompressing the subsequent components (proxy32.dll and proxy64.dll) using aPLib and\ninjecting the one corresponding to the system’s architecture to the “explorer.exe” process.\n\nThe dll component injected to “explorer.exe” is used to hook the CreateProcessInternalW\nAPI function, which is invoked upon initiation of processes under Explorer. The hook\nfunction, in this case, will look for one of several browsers and would inject it with yet another\ndecompressed DLL named mod32.dll (or mod64.dll for 64 bit systems). These browsers\ninclude: Internet Explorer, Chrome, Firefox and Edge.\n\nThis final DLL payload, which will execute in the context of one or more of the\naforementioned browsers, is the component that will implement the webinjects mechanism\nby applying some hooks, as done by many other banking malwares. The hooked functions\ncan be found below.\n\n**_Figure 2: Table of hooked functions per browser._**\n\nAs mentioned previously, the webinjects reside within the “temp.bin” file, and have the\nfollowing format:\n\nhost: <url_of_host>\n\npath: <path_in_url>\n\n\n-----\n\ndata:\n\ninject: <data_to_inject>\n\nbefore: <what is before the injected data>\n\nafter: <what is after the injected data>\n\nThe credentials stolen by applying the webinjects will then be sent using the named pipe to\nthe injector component, and subsequently forwarded to the C&C.\n\nA figure that illustrates all aforementioned actions can be seen below:\n\n**_Figure 3: Diagram of Karius’ processes._**\n\n**Similarity to Known Banking Trojans**\n\nAs seen in the previous section, the malware’s internal workings are quite standard for the\nBanking Trojans. What’s more interesting, though, is the fact that major parts of the malware\nare heavily based on well-known bankers that can be found in the wild. For instance, the\nusage of aPLib compression to store both 32 and 64 bit modules one after the other in the\nfile was used previously in Vawtrak.\n\n\n-----\n\nAlso, in one of the malware s inspected samples we were able to track hardcoded\nwebinjects, which to our surprise were used previously by Ramnit.\n\nWebinjects similarity:\n\n**_Figure 4: Comparison of code used in Karius and Ramnit’s webinjects._**\n\nBut probably the most significant resemblance we were able to spot is to the widely\ndistributed TrickBot banker. In particular, we saw a very high similarity in binary code\nbetween the two malwares. The functionalities of injection and hooking methods showed\nvery similar code elements.\n\nIt might be not so surprising for the injection functionality, since both used the reflective\n[loading injection method, which has an online open source implementation, found here.](https://github.com/stephenfewer/ReflectiveDLLInjection)\n\nHowever, it is not clear whether the inline hooking implementation was taken from any\nparticular known source code.\n\n\n-----\n\n**_Figure 5: The Hooking_Method function._**\n\n**_Figure 6: The InternetWriteFile_Hook_Function._**\n\nIt’s interesting to note that in one of the similar hooking functions observed in Karius, we\ncould spot a call to the OutputDebugString function, which contains a string that hints on the\nfunction’s name. This may suggest that the author of Karius was in possession of the source\ncode used to implement the hooking mechanism of TrickBot, and added this line for\ndebugging purposes. It also hints that this malware is still undergoing some development\nand that more versions of it are yet to be released.\n\nHttpSendRequestA_Hook_Function\n\n\n-----\n\n**_Figure 7: The HttpSendRequestA_Hook function._**\n\n**An Evolving Malware**\n\nThroughout the research of this malware, we observed two main versions which outline a\ncertain evolution in its development. The first version seemed to be very buggy, and possibly\nused only for testing purposes, while the second, while more functional, is still not fully\ncomplete. This can be seen in the presence of various “placeholder” strings such as the one\nbelow:\n\n**_Figure 8: An incomplete “placeholder” string._**\n\nThe major changes between the two versions are outlined in the following table:\n\n**_Figure 9: Table of development changes between the two versions of the malware._**\n\nIOCs:\n\nMd5 hashes:\n\n728911a915d9ec3b6defa430d24bc0d5\n\n857430b8c9dc78ce4eabbe57cb3ae134\n\nDomains:\n\n[https://proxyservice.site/updates/gateway.php](https://proxyservice.site/updates/gateway.php)\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-06-06 - Banking Trojans Under Development.pdf"
    ],
    "report_names": [
        "2018-06-06 - Banking Trojans Under Development.pdf"
    ],
    "threat_actors": [
        {
            "id": "93542ae8-73cb-482b-90a3-445a20663f15",
            "created_at": "2022-10-25T16:07:24.058412Z",
            "updated_at": "2025-03-27T02:02:10.093621Z",
            "deleted_at": null,
            "main_name": "PKPLUG",
            "aliases": [
                "Stately Taurus"
            ],
            "source_name": "ETDA:PKPLUG",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535603,
    "ts_updated_at": 1743041154,
    "ts_creation_date": 1653761181,
    "ts_modification_date": 1653761181,
    "files": {
        "pdf": "https://archive.orkl.eu/19052e598a163257646c53a1afd42b1faafed983.pdf",
        "text": "https://archive.orkl.eu/19052e598a163257646c53a1afd42b1faafed983.txt",
        "img": "https://archive.orkl.eu/19052e598a163257646c53a1afd42b1faafed983.jpg"
    }
}