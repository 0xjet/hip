{
    "id": "e64554bb-92ec-43fe-90cd-f3ff65aca091",
    "created_at": "2023-01-12T14:58:59.168797Z",
    "updated_at": "2025-03-27T02:09:18.710053Z",
    "deleted_at": null,
    "sha1_hash": "99b440abd9038b02bdb337a7ec15bd108657f338",
    "title": "2022-02-18 - A Tale of Two Shells",
    "authors": "",
    "file_creation_date": "2022-05-28T17:50:48Z",
    "file_modification_date": "2022-05-28T17:50:48Z",
    "file_size": 2069861,
    "plain_text": "# A Tale of Two Shells\n\n**cyberandramen.net/2022/02/18/a-tale-of-two-shells/**\n\nFebruary 18, 2022\n\nAlthough not utilized in attacks for initial access, web shells remain a go-to for all sorts of\nattackers, from cyber criminals to APT’s when it comes to post-exploitation.\n\nThe server-side component of a web shell can be as short as one line of code, commonly in\nPHP. The China Chopper web shell has long been utilized post exploit to blend in network\ntraffic, providing the attacker full command prompt access to move around the network.\n\nNot knowing much about web shells or their functions, I decided to dig into a few possibly\nlesser-known web shells that may well overtake China Chopper someday in popularity.\n\nEach program discussed in this post was downloaded and run in my home lab against a\nWindows Server 2019 running an IIS server.\n\nIn no particular order, the web shells discussed below:\n\nRebeyond Behinder Web Shell v3.0.11\nrebeyond-Mode v.3.2.7\n\nRecent Sightings\n\nRecently, Avast identified an unknown threat actor uploaded the Behinder Web Shell\n(discussed more below) in an intrusion against computer systems belonging to the National\nGames of China.\n\nMandiant and Palo Alto’s Unit42 have also reported on Behinder and Godzilla web shells\ndeployed upon initial access in high-profile intrusions such as SonicWall, and ProxyShell.\n\nRebeyond Behinder Web Shell\n\nAlso referred to as Ice Scorpion, Behinder is publicly available and maintained by GitHub\nuser rebeyond.\n\nBehinder is compatible with Windows, Linux, and MacOS operating systems.\n\nUpon running the shell, a similar client is opened with a few options to get started. Figure 1\nshows the Behinder GUI with a successfully connected web shell listed.\n\n\n-----\n\nFigure 1: Behinder GUI with one successful victim connection\nWritten in Java, the above client comes in a JAR file alongside multiple shells written in JSP,\nC#, PHP, ASP, and ASPX.\n\nFigure 2: PHP shell, Behinder (left), Avast GitHub (right)\nIn Avast’s reporting, the attackers utilized the default PHP web shell in their attack. Figure 2\ncompares both the Behinder PHP shell (left) and the PHP shell provided by Avast (right).\n\nBehinder utilizes a hardcoded key for encrypted communications, consisting of the first 16\ncharacters of the MD5 hash of the word rebeyond.\n\nThe key can be changed as needed before deploying the shell, but as seen above\nsometimes the default settings are good enough.\n\nCapabilities\n\nOnce the shell is connected, a second window opens providng the attacker with a range of\ncommands and plugins\n\n\n-----\n\nBehinder provides:\n\nvirtual terminal for command execution\nfile manger (upload/download and deletion)\ncustom shells for additional persistence\nsupport for Meterpeter and Cobalt Strike\nin-memory web shell injection\n\nFigure 3: Basic PHP Info\n\n\n-----\n\nFigure 4: Support for Meterpreter & Cobalt Strike\n\n\n-----\n\nFigure 5: File Manager\nThe Code Behind The Shell\n\nI could spend this whole post on the capabilities and options present in the GUI, but that isn’t\nmuch fun or informative.\n\nWhat caught my eye was the in-memory web shell referred to as MemShell (Figure 6), as\nwell as an exciting variable seen throughout the code named “antiAgent.”\n\n\n-----\n\nFigure 6: MemShell injection window\nStarting from the title of the window in Figure 6, the MemShell option translates (thanks to\nGoogle Translate) to “Inject Memory Horse”.\n\nWorking down the window, the options are as follows:\n\ninjection type\ninjection path\nAnti-detection\n\nThis memory horse injection method was added to Behinder in an April 2021 update.\n\nThe red text warns the attacker that utilizing anti-detection will require a container restart\nbefore attempting injection again (if there is a more precise translation of the above, please\nreach out).\n\n\n-----\n\nFigure 7: Shellcode and in memory functions\nThe try block in Figure 7 implements MemShell utilizing similar classes and methods to those\nidentified for the standard Behinder component. The multiple calls to java.lang.reflect allow\nthe code to obtain classes in memory that would otherwise not be available.\n\nFigure 8: Inject MemShell and antiAgent\n\n\n-----\n\nFigure 9: More antiAgent\nOther than the above two images, we do not see the antiAgent parameter utilized until\n(Figure 9).\n\nFigure 10: doAgentShell method\nStarting at line 741, the code loops through operating systems and versions, and if it is\ndeemed the target is a Linux system and the antiAgent option is set, the file\n/tmp/.jav_pid[CurrentPID] is deleted.\n\nRunning the web shell on a *nix system results in error. The Java error is a known issue that\nhas been open since June 2021. The anti-detection feature was first introduced in version 2\nand may represent dead code the developer forgot to remove.\n\nNetwork Traffic\n\nCapturing the network traffic in my home lab enables a unique view of typical Behinder\ntraffic, albeit from a much less noisy environment.\n\nThe encoded text seen in Figure 12 consists of the base64 encoded and AES encrypted\n(with the key “rebeyond”).\n\nFigure 11: Packet capture of POST requests over port 80\n\n\n-----\n\nFigure 12: Behinder HTTP POST request with encoded data in HTTP body\n\nFigure 13: Response from target\n\n## Rebeyond-Mode\n\nRebeyond-Mode, or “Modified Rebeyond” is precisely what the title states. Actively\nmaintained by GitHub user angels520, much of this modified web shell is an exact copy of\nthe Behinder web shell, offering a few bells and whistles.\n\n\n-----\n\nFigure 14: rebeyond-Mode GitHub page\nAs you can see from Figure 14, except for some highlighting, the client GUI looks very\nsimilar to Behinder. The server-side payloads are also the same, even using the rebeyond\nhardcoded key.\n\n\n-----\n\nUnlike Behinder, rebeyond-Mode provides the attacker with options to add a default page\nreferred to as a profile if a defender or anyone else were to navigate to the web shell (Figure\n15).\n\nAdditional obfuscation of the commands can also be toggled between True and False.\n\nFigure 15: rebeyond-Mode’s default profiles\n\n\n-----\n\nFigure 16: Default GitHub profile\nYou may have missed it in Figure 16, but near the middle left of the page, is the text\n“##payload##”.\n\nrebeyond-Mode also offers the MemShell option for JSP and ASPX, however I did not test\nthe functionality.\n\nPacket captures for rebeyond-Mode were purposefully left out as the network traffic is very\nsimilar to Behinder.\n\n## Conclusion\n\nBoth Behinder and rebeyond-Mode may not be as famous as China Chopper, TwoFace, or\nGodzilla; however, their frequent updates to extend functionality could soon see them\nsurpassing the aforementioned post-exploitation tools.\n\nIf you made it this far, thank you for reading. I hope to create a part two of this article\nidentifying possible detection ideas for both Behinder and rebeyond-Mode.\n\n## References\n\n[1] [https://github.com/rebeyond/Behinder](https://github.com/rebeyond/Behinder)\n\n[2] [https://github.com/angels520/rebeyond-Mode](https://github.com/angels520/rebeyond-Mode)\n\n\n-----\n\n[3] https://decoded.avast.io/janneduchal/analysis-of-attack-against-national-games-of-chinasystems/\n\n[4] https://www.mandiant.com/resources/zero-day-exploits-in-sonicwall-email-security-leadto-compromise\n\n[5] https://www.cyber.gov.au/sites/default/files/2020-12/ACSC-Advisory-2020-008-CopyPaste-Compromises.pdf\n\n[6] [https://www.sangfor.com/en/info-center/blog-center/cyber-security/Behinder-v3-0-Analysis](https://www.sangfor.com/en/info-center/blog-center/cyber-security/Behinder-v3-0-Analysis)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-18 - A Tale of Two Shells.pdf"
    ],
    "report_names": [
        "2022-02-18 - A Tale of Two Shells.pdf"
    ],
    "threat_actors": [
        {
            "id": "82b92285-4588-48c9-8578-bb39f903cf62",
            "created_at": "2022-10-25T15:50:23.850506Z",
            "updated_at": "2025-03-27T02:00:55.501372Z",
            "deleted_at": null,
            "main_name": "Charming Kitten",
            "aliases": [
                "Charming Kitten"
            ],
            "source_name": "MITRE:Charming Kitten",
            "tools": [
                "DownPaper"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d8af157e-741b-4933-bb4a-b78490951d97",
            "created_at": "2023-01-06T13:46:38.748929Z",
            "updated_at": "2025-03-27T02:00:02.908256Z",
            "deleted_at": null,
            "main_name": "APT35",
            "aliases": [
                "Newscaster Team",
                "Magic Hound",
                "G0059",
                "Phosphorus",
                "Mint Sandstorm",
                "TunnelVision",
                "COBALT MIRAGE"
            ],
            "source_name": "MISPGALAXY:APT35",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "08c8f238-1df5-4e75-b4d8-276ebead502d",
            "created_at": "2023-01-06T13:46:39.344081Z",
            "updated_at": "2025-03-27T02:00:03.056208Z",
            "deleted_at": null,
            "main_name": "Copy-Paste",
            "aliases": [],
            "source_name": "MISPGALAXY:Copy-Paste",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "029625d2-9734-44f9-9e10-b894b4f57f08",
            "created_at": "2023-01-06T13:46:38.364105Z",
            "updated_at": "2025-03-27T02:00:02.815023Z",
            "deleted_at": null,
            "main_name": "Charming Kitten",
            "aliases": [
                "Parastoo",
                "iKittens",
                "Group 83",
                "NewsBeef",
                "G0058",
                "CharmingCypress"
            ],
            "source_name": "MISPGALAXY:Charming Kitten",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e3676dfe-3d40-4b3a-bfbd-4fc1f8c896f4",
            "created_at": "2022-10-25T15:50:23.808974Z",
            "updated_at": "2025-03-27T02:00:55.550912Z",
            "deleted_at": null,
            "main_name": "Magic Hound",
            "aliases": [
                "Magic Hound",
                "TA453",
                "COBALT ILLUSION",
                "Charming Kitten",
                "ITG18",
                "Phosphorus",
                "APT35",
                "Mint Sandstorm"
            ],
            "source_name": "MITRE:Magic Hound",
            "tools": [
                "Impacket",
                "CharmPower",
                "FRP",
                "Mimikatz",
                "Systeminfo",
                "ipconfig",
                "netsh",
                "PowerLess",
                "Pupy",
                "DownPaper",
                "PsExec",
                "Havij",
                "sqlmap"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "1699fb41-b83f-42ff-a6ec-984ae4a1031f",
            "created_at": "2022-10-25T16:07:23.83826Z",
            "updated_at": "2025-03-27T02:02:09.995863Z",
            "deleted_at": null,
            "main_name": "Magic Hound",
            "aliases": [
                "APT 35",
                "Ballistic Bobcat",
                "Charming Kitten",
                "CharmingCypress",
                "Cobalt Illusion",
                "Cobalt Mirage",
                "Educated Manticore",
                "Magic Hound",
                "Mint Sandstorm",
                "Operation BadBlood",
                "Operation Sponsoring Access",
                "Operation SpoofedScholars",
                "Operation Thamar Reservoir",
                "Phosphorus",
                "TA453",
                "TEMP.Beanie",
                "Tarh Andishan",
                "Timberworm",
                "TunnelVision",
                "UNC788",
                "Yellow Garuda"
            ],
            "source_name": "ETDA:Magic Hound",
            "tools": [
                "7-Zip",
                "AnvilEcho",
                "BASICSTAR",
                "CORRUPT KITTEN",
                "CWoolger",
                "CharmPower",
                "ChromeHistoryView",
                "CommandCam",
                "DistTrack",
                "DownPaper",
                "FRP",
                "Fast Reverse Proxy",
                "FireMalv",
                "Ghambar",
                "GoProxy",
                "GorjolEcho",
                "HYPERSCRAPE",
                "Havij",
                "MPK",
                "MPKBot",
                "Matryoshka",
                "Matryoshka RAT",
                "MediaPl",
                "Mimikatz",
                "MischiefTut",
                "NETWoolger",
                "NOKNOK",
                "PINEFLOWER",
                "POWERSTAR",
                "PowerLess Backdoor",
                "PsList",
                "Pupy",
                "PupyRAT",
                "SNAILPROXY",
                "Shamoon",
                "TDTESS",
                "WinRAR",
                "WoolenLogger",
                "Woolger",
                "pupy",
                "sqlmap"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535539,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653760248,
    "ts_modification_date": 1653760248,
    "files": {
        "pdf": "https://archive.orkl.eu/99b440abd9038b02bdb337a7ec15bd108657f338.pdf",
        "text": "https://archive.orkl.eu/99b440abd9038b02bdb337a7ec15bd108657f338.txt",
        "img": "https://archive.orkl.eu/99b440abd9038b02bdb337a7ec15bd108657f338.jpg"
    }
}