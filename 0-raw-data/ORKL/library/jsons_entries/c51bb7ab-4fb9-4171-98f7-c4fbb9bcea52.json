{
    "id": "c51bb7ab-4fb9-4171-98f7-c4fbb9bcea52",
    "created_at": "2023-01-12T15:01:46.081568Z",
    "updated_at": "2025-03-27T02:15:45.371225Z",
    "deleted_at": null,
    "sha1_hash": "e7f37fc4c918063a08bb7ca9044ea6bc13dc036a",
    "title": "2022-09-06 - Worok- The big picture",
    "authors": "",
    "file_creation_date": "2022-09-12T12:04:27Z",
    "file_modification_date": "2022-09-12T12:04:27Z",
    "file_size": 796997,
    "plain_text": "# Worok: The big picture\n\n**welivesecurity.com/2022/09/06/worok-big-picture/**\n\nSeptember 6, 2022\n\nFocused mostly on Asia, this new cyberespionage group uses undocumented tools, including steganographically\nextracting PowerShell payloads from PNG files\n\n[Thibaut Passilly](https://www.welivesecurity.com/author/tpassilly/)\n6 Sep 2022 - 11:30AM\n\nFocused mostly on Asia, this new cyberespionage group uses undocumented tools, including steganographically\nextracting PowerShell payloads from PNG files\n\nESET researchers recently found targeted attacks that used undocumented tools against various high-profile\ncompanies and local governments mostly in Asia. These attacks were conducted by a previously unknown espionage\ngroup that we have named Worok and that has been active since at least 2020. Worok’s toolset includes a C++ loader\nCLRLoad, a PowerShell backdoor PowHeartBeat, and a C# loader PNGLoad that uses steganography to extract hidden\nmalicious payloads from PNG files.\n\n## Who is Worok?\n\n[During the ProxyShell (CVE-2021-34523) vulnerability disclosure in early 2021, we observed activity from various APT](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-34523)\n[groups. One exhibited characteristics common with TA428:](https://www.welivesecurity.com/2020/12/10/luckymouse-ta428-compromise-able-desktop/)\n\nActivity times\nTargeted verticals\n\n\n-----\n\nUsage of ShadowPad\n\n[The rest of the toolset is very different: for example, TA428 took part in the Able Desktop compromise in 2020. We](https://www.welivesecurity.com/2020/12/10/luckymouse-ta428-compromise-able-desktop/)\nconsider that the links are not strong enough to consider Worok to be the same group as TA428, but the two groups\nmight share tools and have common interests. We decided to create a cluster and named it Worok. The name was\nchosen after a mutex in a loader used by the group. Further activity with variants of the same tools was then linked to\nthis group. According to ESET’s telemetry, Worok has been active since late 2020 and continues to be active as of this\nwriting.\n\nBack in late 2020, Worok was targeting governments and companies in multiple countries, specifically:\n\nA telecommunications company in East Asia\nA bank in Central Asia\nA maritime industry company in Southeast Asia\nA government entity in The Middle East\nA private company in southern Africa\n\nThere was a significant break in observed operations from 2021-05 to 2022-01, but Worok activity returned in 2022-02,\ntargeting:\n\nAn energy company in Central Asia\nA public sector entity in Southeast Asia\n\nFigure 1 presents a visual heatmap of the targeted regions and verticals.\n\n_Figure 1. Map of the targeted regions and verticals_\n\nConsidering the targets’ profiles and the tools we’ve seen deployed against these victims, we think Worok’s main\nobjective is to steal information.\n\n## Technical analysis\n\nWhile the majority of initial accesses are unknown, in some cases through 2021 and 2022 we have seen exploits used\nagainst the ProxyShell vulnerabilities. In such cases, typically webshells have been uploaded after exploiting these\nvulnerabilities, in order to provide persistence in the victim’s network. Then the operators used various implants to gain\nfurther capabilities.\n\n\n-----\n\nOnce access had been acquired, the operators deployed multiple, publicly available tools for reconnaissance, including\n[Mimikatz,](https://blog.gentilkiwi.com/mimikatz) [EarthWorm,](https://rootkiter.com/EarthWorm/en/index.html) [ReGeorg, and](https://github.com/sensepost/reGeorg) [NBTscan, and then deployed their custom implants: a first-stage loader, followed](https://github.com/charlesroelli/nbtscan)\nby a second stage .NET loader (PNGLoad). Unfortunately, we have not been able to retrieve any of the final payloads.\nIn 2021, the first-stage loader was a CLR assembly (CLRLoad), while in 2022 it has been replaced, in most cases, by a\nfull-featured PowerShell backdoor (PowHeartBeat) – both execution chains are depicted in Figure 2. These three tools\nare described in detail in the following subsections.\n\n_Figure 2. Worok compromise chains_\n\n### CLRLoad: CLR assembly loader\n\nCLRLoad is a generic Windows PE that we have seen in both 32-and 64-bit versions. It is a loader written in C++ that\n[loads the next stage (PNGLoad), which must be a Common Language Runtime (CLR) assembly DLL file. That code is](https://docs.microsoft.com/en-us/dotnet/standard/clr)\nloaded from a file located on disk in a legitimate directory, presumably to mislead victims or incident responders into\nthinking it is legitimate software.\n\nSome CLRLoad samples start by decoding the full path of the file whose content they will load as the next stage. These\nfile paths are encoded with a single-byte XOR, with a different key in every sample. Decoded or cleartext, these file\npaths are absolute, with the following being those we have encountered:\n\nC:\\Program Files\\VMware\\VMware Tools\\VMware VGAuth\\xsec_1_5.dll\nC:\\Program Files\\UltraViewer\\msvbvm80.dll\nC:\\Program Files\\Internet Explorer\\Jsprofile.dll\nC:\\Program Files\\WinRar\\RarExtMgt.dll\nC:\\Program Files (x86)\\Foxit Software\\Foxit Reader\\lucenelib.dll\n\nNext, a mutex is created and we’ve seen a different name in every sample. The loader checks for this mutex; if found, it\nexits, because the loader is already running. In one of the samples, the mutex Wo0r0KGWhYGO was encountered,\nwhich gave the group its name of Worok.\n\nCLRLoad then loads a CLR assembly from the possibly decoded file path. As unmanaged code, CLRLoad achieves this\nvia CorBindToRuntimeEx Windows API calls in 32-bit variants, or CLRCreateInstance calls in 64-bit variants.\n\n### PowHeartBeat: PowerShell backdoor\n\nPowHeartBeat is a full-featured backdoor written in PowerShell, obfuscated using various techniques such as\ncompression, encoding, and encryption. Based on ESET telemetry, we believe PowHeartBeat replaced CLRLoad in\nmore recent Worok campaigns as the tool used to launch PNGLoad.\n\n\n-----\n\nThe first layer of the backdoor code consists of multiple chunks of base64 encoded PowerShell code. Once the payload\nis reconstructed, it is executed via IEX. Once decoded, another layer of obfuscated code is executed, which we can see\nin Figure 3.\n\n_Figure 3. Excerpt of the decoded main function of the second layer of PowHeartBeat_\n\nThe second layer of the backdoor first base64 decodes the next layer of its code, which is then decrypted with Triple\n[DES (CBC mode). After decryption, this code is decompressed using the gzip algorithm, thus giving the third layer of](https://en.wikipedia.org/wiki/Gzip)\nPowerShell code, which is the actual backdoor. It is divided into two main parts: configuration, and handling backdoor\ncommands.\n\nThe main layer of backdoor code is also written in PowerShell and uses HTTP or ICMP to communicate with the C&C\nserver. It works as depicted in Figure 4.\n\n_Figure 4. PowHeartBeat’s functioning_\n\n**Configuration**\n\nThe configuration contains multiple fields, including version number, optional proxy configuration, and C&C address.\nTable 1 describes the meanings of the configuration fields in the different versions we have observed.\n\n_Table 1. Configuration field meanings_\n\n**Field name** **Description**\n\n\nnouse /\nikuyrtydyfg\n\n(other samples)\n\n\nUnused.\n\n\nClientId Client identifier, used for the following purposes:\n\n          - As a value when constructing the Cookie header for C&C communications.\n\n           - As a cryptographic artifact for sent data encryption.\n\nVersion Version number of PowHeartBeat.\n\n\n-----\n\n**Field name** **Description**\n\nExecTimes Number of allowed execution attempts when issuing a RunCmd (command running) command.\n\nUserAgent User agent used for C&C communications.\n\nReferer Referer header used for C&C communications.\n\nAcceptEncoding Unused.\n\n\nCookieClientId\n\nCookieTaskId\n\nCookieTerminalId\n\n\nValues used to construct the Cookie header for C&C communications.\n\n\nUrlHttps Protocol to use for C&C communications.\n\n\nUrlDomain\n\nIPAddress\n\nDomains\n\n\nURL, domain(s), or IP address used as the C&C server. If Domains is not empty, it is chosen\ninstead of IPAddress. In other cases, IPAddress is taken.\n\n\nUrlSendHeartBeat URL path used when the backdoor asks the C&C server for commands.\n\nUrlSendResult URL path used when the backdoor sends the results of the command back to the C&C server.\n\nGetUrl Complete URL, used by PowHeartBeat to request commands from the C&C server. It is the\nconcatenation of the URL elements above.\n\nPutUrl Same as GetUrl but used to send the results of the command back to the C&C server.\n\ncurrentPath Unused.\n\nProxyEnableFlag Flag indicating whether the backdoor must use a proxy or not in order to communicate with the\nC&C server.\n\nProxymsg Address of the proxy to use if ProxyEnableFlag is set to $true.\n\nInterval Time in seconds that the script sleeps for between GET requests.\n\nBasicConfigPath Path to an optional configuration file containing UpTime, DownTime, DefaultInterval, and\nDomains. Those values will be overridden if the file is present.\n\nUpTime Time of day from which the backdoor starts operating, meaning it starts making GET requests to\nthe C&C server.\n\nDownTime Time of day until which the backdoor can operate, meaning the time when it stops making\nrequests to the C&C server.\n\nDomainIndex Index of the current domain name to use for communications with the C&C server. In case a\nrequest returns an error message different from 304 (“Not modified”), DomainIndex is increased.\n\nSecretKey Key used to decrypt/encrypt the configuration. Configuration is encrypted with multiple-byte\nXOR.\n\nIfLog Unused.\n\nIfLogFilePath Flag indicating whether logging is enabled.\n\nlogpath Path of the log file.\n\nProxyFile File path of the optional proxy configuration. If it is empty or not found in the file system, the\nbackdoor retrieves the user’s proxy settings from the registry value\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ProxyServer .\n\nIfConfig Flag indicating whether to use a configuration file.\n\nFigure 5 shows an example of the configuration extracted from a PowHeartBeat sample (SHA-1:\n757ABA12D04FD1167528FDD107A441D11CD8C427).\n\n\n-----\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n11\n\n12\n\n13\n\n14\n\n15\n\n16\n\n17\n\n18\n\n19\n\n20\n\n21\n\n22\n\n23\n\n24\n\n25\n\n26\n\n27\n\n28\n\n29\n\n30\n\n31\n\n32\n\n33\n\n34\n\n\n$Script:nouse = 100;\n\nif(Test-Path $MyInvocation.MyCommand.Path){Remove-item $MyInvocation.MyCommand.Path -Force;}\n\n$Script:ClientId = \"83\";\n\n$Script:Version = \"2.1.3.0003\";\n\n$Script:ExecTimes = 10;\n\n$Script:UserAgent = \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko)\nChrome/69.0.3487.100 Safari/537.36\";\n\n$Script:Referer = \"www.adobe.com\";\n\n$Script:AcceptEncoding = \"text/html,app1ication/xhtml+xml,app1ication/xml;q=0.9,*/*;q=0.8\";\n\n$Script:CookieClientId = \"s_ecid\";\n\n$Script:CookieTaskId = \"aam_uuid\";\n\n$Script:CookieTerminalId = \"AAMC_adobe_0\";\n\n$Script:UrlHttps = \"http://\";\n\n$Script:UrlDomain= \" 118.193.78[.]22:443\";\n\n$Script:UrlSendHeartBeat = \"/latest/AdobeMessagingClient.js\";\n\n$Script:UrlSendResult = \"/content/dam/offers-homepage/homepage.jpg\";\n\n$Script:GetUrl = $Script:UrlHttps + $Script:UrlDomain + $Script:UrlSendHeartBeat;\n\n$Script:PutUrl = $Script:UrlHttps + $Script:UrlDomain + $Script:UrlSendResult;\n\n$Script:currentPath = Split-Path -Parent $MyInvocation.MyCommand.Definition;\n\n$Script:ProxyEnableFlag = $false;\n\n$Script:Proxymsg;\n\n$Script:Interval = 10 ;\n\n$Script:BasicConfigPath = \"C:\\ProgramData\\unins.dat\";\n\n$Script:UpTime = 0;\n\n$Script:DownTime = 24;\n\n$Script:Domains;\n\n$Script:DomainIndex;\n\n$Script:SecretKey = \"###ConfigKey###\";\n\n#$Script:IfLog = $true;\n\n$Script:IfLogFilePath = \"C:\\ProgramData\\tpncp.dat\";\n\n$Script:logpath = \"C:\\ProgramData\\unins000.dat\";\n\n$Script:ProxyFile = \"C:\\ProgramData\\hwrenalm.dat\";\n\n$Script:IfConfig = $false;\n\n\n-----\n\n_Figure 5. Configuration example_\n\n**Data encryption**\n\nPowHeartBeat encrypts logs and additional configuration file content.\n\nLog file content is encrypted though multiple-byte XOR with a key specified in cleartext in the sample. Interestingly,\nclientId is used as a salt for the index into the key array. The key is a 256-byte array, which was identical in every\nsample that we encountered. Additional configuration file content is encrypted through multiple-byte XOR with the value\nfrom SecretKey as its key.\n\n**C&C communications**\n\nPowHeartBeat used HTTP for C&C communications until version 2.4, and then switched to ICMP. In both case the\ncommunication is not encrypted.\n\n**_HTTP_**\n\nIn an infinite loop, the backdoor sends a GET request to the C&C server, asking for a command to issue. The encrypted\nanswer is decrypted by the backdoor, which processes the command, and writes the command output to a file whose\ncontent is then sent to the C&C server via a POST request.\n\nThe format of the GET requests is the following:\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n\nGET <UrlSendHeartBeat> HTTP/1.1\n\nUser-Agent: <UserAgent>\n\nReferer: <Referer>\n\nHost: <Domain>\n\nCookie: <CookieClientId>=<ClientId>\n\nConnection: close\n\n\nNote that the request is constructed using the eponymous configuration fields.\n\nIn the response from the C&C server, the third byte of the content is the command identifier that indicates the command\nto be processed by the backdoor. We’ll call it command_id. The remaining content of the response will be passed as an\nargument to the command that is processed. This content is encrypted with the algorithm shown in Figure 6, taskId\nbeing the value of the cookie named after CookieTaskId‘s value from the configuration.\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n6\n\n7\n\n8\n\n9\n\n10\n\n\no[int] $pos = $taskId % 256;\n\nfor ($i = 0; $i -lt $tmpBytes.Value.Length; $i++)\n\n{\n\n$pos = $pos + $clientId;\n\nif ($pos -ge 256)\n\n{\n\n$pos = $pos % 256;\n\n}\n\n$tmpBytes.Value[$i] = [byte]($tmpBytes.Value[$i] -bxor $hexEnc[$pos]);\n\n}\n\n\n-----\n\n_Figure 6. Requests content data encryption algorithm_\n\nThe response from the C&C server also contains another cookie, whose name is specified by the backdoor’s\nCookieTerminalId configuration variable. The value of this cookie is repeated in the POST request from the backdoor,\nand it must not be empty. After executing the backdoor command, PowHeartBeat sends the result as a POST request to\nthe C&C server. The result is sent as a file whose name is <command_id>.png.\n\n**ICMP**\n\nStarting from version 2.4 of PowHeartBeat, HTTP was replaced by ICMP, sent packets having a timeout of six seconds\n[and being unfragmented. Communication through ICMP is most likely a way to evade detection.](https://docs.microsoft.com/en-us/dotnet/api/system.net.networkinformation.pingoptions.dontfragment?view=net-6.0)\n\nThere is no major change in versions 2.4 and later, but we noticed some modifications in the code:\n\nPowHeartBeat sends a heartbeat packet at each loop that contains the string abcdefghijklmnopqrstuvwxyz, before\nrequesting a command. This informs the C&C server that the backdoor is ready to receive commands.\nRequests to get commands performed by the backdoor contain the string abcdefghijklmnop.\n\nHeartbeat packets have the format described in Figure 7.\n\n_Figure 7. Heartbeat packet layout_\n\nThe difference between client ID and client flag is that client ID differs in every sample whereas client flag is the same in\nevery sample that uses ICMP. heartbeat flag indicates that the backdoor is sending a heartbeat. The response from the\nC&C server has the format described in Figure 8.\n\n_Figure 8. C&C server response layout_\n\nflag here indicates whether there is a command to issue to the backdoor. Requests to get commands have the format\ndescribed in Figure 9.\n\n_Figure 9. Layout for requests to get commands_\n\nNote that the backdoor’s ICMP mode allows receiving an unlimited amount of data, divided into chunks, and the\nvariables data length, current position and total length are used to keep track of the transmitted data. Responses to\nthese requests have the format described in Figure 10.\n\n_Figure 10. Layout of responses to requests for getting commands_\n\nAs in HTTP responses, the command identifier is the third byte of data.\n\nAfter seven consecutive ICMP replies with empty or inconsistently formatted content, transfers between the backdoor\nand C&C server are considered finished.\n\n\n-----\n\nConcerning the requests to send the result of the issued command to the C&C server, server mode is changed for post\nmode, and the final string (abcdefghijklmnop) is changed for the result data.\n\n### Backdoor commands\n\nPowHeartBeat has various capabilities, including command/process execution and file manipulation. Table 2 lists all\ncommands supported by the various analyzed samples.\n\n_Table 2. PowHeartBeat command descriptions_\n\n\n**Name**\n\n\n**Command**\n**Identifier** **Description**\n\n\n**Cmd** 0x02 Execute a PowerShell command.\n\n**Exe** 0x04 Execute a command as a process.\n\n**FileUpload** 0x06 Upload a file to the victim machine. File content is gzip-compressed.\n\n**FileDownLoad** 0x08 Download a file from the victim machine, and return file path, file length, creation time,\naccess times, and file content to the C&C server.\n\n**FileView** 0x0A Get file information of a specific directory, in particular:\n\n               - Filenames\n\n                   - File attributes\n\n                 - Last write times\n\n                 - File contents\n\n**FileDelete** 0x0C Delete a file.\n\n**FileRename** 0x0E Rename or move a file.\n\n**ChangeDir** 0x10 Change the current working location of the backdoor.\n\n**Info** 0x12 Get a category of information according to the specified argument:\n\n                 - “Basic information”: ClientId, Version, host name, IP addresses, explorer.exe version\nand size information, OS (architecture and flag indicating if the machine is a server),\nInterval, current directory, drive information (name, type, free space and total size),\ncurrent time\n\n                 - “Time-Interval information”: Interval and current time\n\n                 - “Domain information”: decrypted configuration file content\n\n**Config** 0x14 Update the configuration file content and reload the configuration.\n\nN/A 0x63 Backdoor exit.\n\nIn case of errors on the backdoor side, the backdoor uses a specific command identifier 0x00 in the POST request to\nthe C&C server, thus indicating an error occurred.\n\nNote that before sending the information back to the C&C server, the data is gzip-compressed.\n\n### PNGLoad: Steganographic loader\n\nPNGLoad is the second-stage payload deployed by Worok on compromised systems and, according to ESET telemetry,\nloaded either by CLRLoad or PowHeartBeat. While we don’t see any code in PowHeartBeat that directly loads\nPNGLoad, the backdoor has the capabilities to download and execute additional payloads from the C&C server, which\nis likely how the attackers have deployed PNGLoad on systems compromised with PowHeartBeat. PNGLoad is a loader\nthat uses bytes from PNG files to create a payload to execute. It is a 64-bit .NET executable – obfuscated with .NET\nReactor – that masquerades as legitimate software. For example, Figure 11 shows the CLR headers of a sample\nmasquerading as a WinRAR DLL.\n\n\n-----\n\n_Figure 11. Example of a fake WinRAR DLL_\n\nOnce deobfuscated, only one class is present. In this class, there is a MainPath attribute containing the directory path\nthe backdoor searches, including its subdirectories, for files with a .png extension, as shown in Figure 12.\n\n_Figure 12. .png file listing_\n\nEach .png file located by this search of MainPath is then checked for steganographically embedded content. First, the\nleast-significant bit of each pixel’s R (red), G (green), B (blue), and A (alpha) values are fetched and assembled into a\nbuffer. Should the first eight bytes of that buffer match the magic number seen in Figure 13 and the next eight-byte\nvalue, control, be non-null, the file passes PNGLoad’s steganographic content check. For such files, processing\ncontinues with the remainder of the buffer decrypted with a multiple-byte XOR, using the key stored in PNGLoad’s\nSecretKeyBytes attribute, and then the decrypted buffer is gzip-decompressed. The result is expected to be a\nPowerShell script, which is run immediately.\n\n_Figure 13. Format of buffer PNGLoad creates from processing .png files_\n\n\n-----\n\nInterestingly, operations performed by PNGLoad are logged in a file whose path is stored in the variable LogFilePath.\nOperations are only logged if a file is present whose path is specified by the internal variable IfLogFilePath.\n\nWe have not been able to obtain a sample .png file used along with PNGLoad, but the way PNGLoad operates\nsuggests that it should work with valid PNG files. To hide the malicious payload, Worok uses Bitmap objects in C#,\nwhich only take pixel information from files, not the file metadata. This means that Worok can hide its malicious\npayloads in valid, innocuous-looking PNG images and thus hide in plain sight.\n\n## Conclusion\n\nWorok is a cyberespionage group that develops its own tools, as well as leveraging existing tools, to compromise its\ntargets. Stealing information from their victims is what we believe the operators are after because they focus on highprofile entities in Asia and Africa, targeting various sectors, both private and public, but with a specific emphasis on\ngovernment entities. Activity times and toolset indicate possible ties with TA428, but we make this assessment with low\nconfidence. Their custom toolset includes two loaders – one in C++ and one in C# .NET – and one PowerShell\nbackdoor. While our visibility is limited, we hope that shedding light on this group will encourage other researchers to\nshare information about this group.\n\n_For any inquiries about our research published on WeLiveSecurity, please contact us at_ _[threatintel@eset.com.](mailto:threatintel@eset.com)_\n_ESET Research now also offers private APT intelligence reports and data feeds. For any inquiries about this service,_\n_visit the_ _[ESET Threat Intelligence page.](https://www.eset.com/int/business/services/threat-intelligence/)_\n\n## IOCs\n\n### Files\n\n**SHA-1** **Filename** **ESET Detection name** **Comment**\n\n3A47185D0735CDECF4C7C2299EB18401BFB328D5 script PowerShell/PowHeartBeat.B PowHeartBeat\n2.4.3.0003.\n\n27ABB54A858AD1C1FF2863913BDA698D184E180D script PowerShell/PowHeartBeat.A PowHeartBeat\n2.4.3.0003.\n\n678A131A9E932B9436241402D9727AA7D06A87E3 script PowerShell/PowHeartBeat.B PowHeartBeat\n2.4.3.0003.\n\n757ABA12D04FD1167528FDD107A441D11CD8C427 script PowerShell/PowHeartBeat.B PowHeartBeat\n2.1.3.0003.\n\n54700A48D934676FC698675B4CA5F712C0373188 script PowerShell/PowHeartBeat.A PowHeartBeat\n1.1.3.0002.\n\nC2F53C138CB1B87D8FC9253A7088DB30B25389AF script PowerShell/PowHeartBeat.A PowHeartBeat\n1.1.3.0002.\n\nC2F1954DE11F72A46A4E823DE767210A3743B205 tmp.ps1 PowerShell/PowHeartBeat.B PowHeartBeat\n2.4.3.0004.\n\nCE430A27DF87A6952D732B4562A7C23BEF4602D1 tmp.ps1 PowerShell/PowHeartBeat.A PowHeartBeat\n2.1.3.0004.\n\nEDE5AB2B94BA85F28D5EE22656958E4ECD77B6FF script PowerShell/PowHeartBeat.A PowHeartBeat\n2.4.3.0003.\n\n4721EEBA13535D1EE98654EFCE6B43B778F13126 vix64.dll MSIL/PNGLoader.A PNGLoader.\n\n728A6CB7A150141B4250659CF853F39BFDB7A46C RarExtMgt.dll MSIL/PNGLoader.A PNGLoader.\n\n864E55749D28036704B6EA66555A86527E02AF4A Jsprofile.dll MSIL/PNGLoader.A PNGLoader.\n\n\n-----\n\n**SHA-1** **Filename** **ESET Detection name** **Comment**\n\n8DA6387F30C584B5FD3694A99EC066784209CA4C vssxml.dll MSIL/PNGLoader.A PNGLoader.\n\nAA60FB4293530FBFF00D200C0D44EEB1A17B1C76 xsec_1_5.dll MSIL/PNGLoader.A PNGLoader.\n\nB2EAEC695DD8BB518C7E24C4F37A08344D6975BE msvbvm80.dll MSIL/PNGLoader.A PNGLoader.\n\nCDB6B1CAFEE098615508F107814179DEAED1EBCF lucenelib.dll MSIL/PNGLoader.A PNGLoader.\n\n4F9A43E6CF37FF20AE96E564C93898FDA6787F7D vsstrace.dll Win64/CLRLoad.C CLRLoad.\n\nF181E87B0CD6AA4575FD51B9F868CA7B27240610 ncrypt.dll Win32/CLRLoad.A CLRLoad.\n\n4CCF0386BDE80C339EFE0CC734CB497E0B08049C ncrypt.dll Win32/CLRLoad.A CLRLoad.\n\n5CFC0D776AF023DCFE8EDED5CADA03C6D7F9C244 wlbsctrl.dll Win64/CLRLoad.E CLRLoad.\n\n05F19EBF6D46576144276090CC113C6AB8CCEC08 wlbsctrl.dll Win32/CLRLoad.A CLRLoad.\n\nA5D548543D3C3037DA67DC0DA47214B2C2B15864 secur32.dll Win64/CLRLoad.H CLRLoad.\n\nCBF42DCAF579AF7E6055237E524C0F30507090F3 dbghelp.dll Win64/CLRLoad.C CLRLoad.\n\n### File Paths\n\nSome of the MainPath, LogFilePath and IfLogFilePath values that we encountered in PNGLoad samples:\n\n**MainPath** **LogFilePath** **IfLogFilePath**\n\n\nC:\\Program\nFiles\\VMware\\VMware\nTools\\\n\nC:\\Program\nFiles\\WinRar\\\n\nC:\\Program\nFiles\\UltraViewer\\\n\n### Network\n\n\nC:\\Program Files\\VMware\\VMware\nTools\\VMware VGAuth\\readme.txt\n\n\nC:\\Program Files\\VMware\\VMware\nTools\\VMware VGAuth\\VMWSU_V1_1.dll\n\n\nC:\\Program Files\\WinRar\\rarinstall.log C:\\Program Files\\WinRar\\des.dat\n\n\nC:\\Program\nFiles\\UltraViewer\\‌CopyRights.dat\n\n\nC:\\Program Files\\UltraViewer\\uvcr.dll\n\n\n**Domain** **IP**\n\nNone 118.193.78[.]22\n\nNone 118.193.78[.]57\n\nairplane.travel-commercials[.]agency 5.183.101[.]9\n\ncentral.suhypercloud[.]org 45.77.36[.]243\n\n### Mutexes\n\nIn CLRLoad samples, the mutex names that we encountered are:\n\naB82UduGX0EX\n\nad8TbUIZl5Ga\n\nMr2PJVxbIBD4\n\noERiQtKLgPgK\n\nU37uxsCsA4Xm\n\nWo0r0KGWhYGO\n\n\n-----\n\nxBUjQR2vxYTz\nzYCLBWekRX3t\n\n3c3401ad-e77d-4142-8db5-8eb5483d7e41\n\n9xvzMsaWqxMy\n\n_[A comprehensive list of Indicators of Compromise (IoCs) and samples can be found in our GitHub repository.](https://github.com/eset/malware-ioc/tree/master/worok)_\n\n## MITRE ATT&CK techniques\n\n_[This table was built using version 11 of the MITRE ATT&CK framework.](https://attack.mitre.org/resources/versions/)_\n\n**Tactic** **ID** **Name** **Description**\n\n\n**Reconnaissance** [T1592.002](https://attack.mitre.org/versions/v11/techniques/T1592/002) Gather Victim Host Information:\nSoftware\n\n\nPowHeartBeat gathers explorer.exe's\ninformation.\n\n\n[T1592.001](https://attack.mitre.org/versions/v11/techniques/T1592/001) Gather Victim\nHost\nInformation:\nHardware\n\n[T1590.005](https://attack.mitre.org/versions/v11/techniques/T1590/005) Gather Victim\nNetwork\nInformation: IP\nAddresses\n\n\nPowHeartBeat gathers information\nabout drives.\n\nPowHeartBeat gathers IP\naddresses of the compromised\ncomputer.\n\n\n**Resource**\n**Development**\n\n\n[T1583.004](https://attack.mitre.org/versions/v11/techniques/T1583/004) Acquire Infrastructure: Server Worok uses its own C&C servers.\n\n\n[T1588.002](https://attack.mitre.org/techniques/T1588/002/) Obtain\nCapabilities:\nTool\n\n[T1583.001](https://attack.mitre.org/versions/v11/techniques/T1583/001) Acquire\nInfrastructure:\nDomains\n\n[T1588.005](https://attack.mitre.org/versions/v11/techniques/T1588/005) Obtain\nCapabilities:\nExploits\n\n[T1587.001](https://attack.mitre.org/versions/v11/techniques/T1587/001) Develop\nCapabilities:\nMalware\n\n[T1587.003](https://attack.mitre.org/versions/v11/techniques/T1587/003) Develop\nCapabilities:\nDigital\nCertificates\n\n\nWorok deployed multiple publicly\navailable tools on the compromised\nmachines.\n\nWorok has registered domains to\nfacilitate C&C communication and\nstaging.\n\nWorok has used the ProxyShell\nvulnerability.\n\nWorok has developed its own\nmalware: CLRLoad, PNGLoad,\nPowHeartBeat.\n\nWorok has created Let’s Encrypt\nSSL certificates in order to enable\nmutual TLS authentication for\nmalware.\n\n\n**Execution** [T1059.001](https://attack.mitre.org/versions/v11/techniques/T1059/001) Command and Scripting\nInterpreter: PowerShell\n\n**Persistence** [T1505.003](https://attack.mitre.org/versions/v11/techniques/T1505/003) Server Software Component: Web\nShell\n\n\nPowHeartBeat is written in PowerShell.\n\nWorok uses the webshell ReGeorg.\n\nWorok uses various custom XOR-based\nschemes to encrypt strings and logs in\nPowHeartBeat, PNGLoad, and\nCLRLoad.\n\n\n**Defense**\n**Evasion**\n\n\n[T1140](https://attack.mitre.org/versions/v11/techniques/T1140) Deobfuscate/Decode Files or\nInformation\n\n\n-----\n\n**Tactic** **ID** **Name** **Description**\n\n\n[T1036.005](https://attack.mitre.org/versions/v11/techniques/T1036/005) Masquerading:\nMatch\nLegitimate\nName or\nLocation\n\n\nPNGLoad samples are deployed in\nlegitimate-looking VMWare\ndirectories.\n\n\n**Credential**\n**Access**\n\n\n[T1003.001](https://attack.mitre.org/versions/v11/techniques/T1003/001) OS Credential Dumping: LSASS\nMemory\n\n\nWorok uses Mimikatz to dump\ncredentials from LSASS memory.\n\n\n**Discovery** [T1082](https://attack.mitre.org/versions/v11/techniques/T1082) System Information Discovery PowHeartBeat gathers OS information.\n\n\n[T1083](https://attack.mitre.org/versions/v11/techniques/T1083) File and\nDirectory\nDiscovery\n\n[T1046](https://attack.mitre.org/versions/v11/techniques/T1046) Network\nService\nDiscovery\n\n[T1124](https://attack.mitre.org/versions/v11/techniques/T1124) System Time\nDiscovery\n\n\nPowHeartBeat can list files and\ndirectories.\n\nWorok uses NbtScan to obtain\nnetwork information on\ncompromised machines.\n\nPowHeartBeat gathers the victim’s\ntime information.\n\n\n**Collection** [T1005](https://attack.mitre.org/versions/v11/techniques/T1005) Data from Local System PowHeartBeat gathers data from the\nlocal system.\n\n\n[T1560.002](https://attack.mitre.org/versions/v11/techniques/T1560/002) Archive\nCollected Data:\nArchive via\nLibrary\n\n\nPowHeartBeat gzip-compresses\ndata before sending it to the C&C\nserver.\n\n\n**Command and**\n**Control**\n\n\n[T1071.001](https://attack.mitre.org/versions/v11/techniques/T1071/001) Application Layer Protocol: Web\nProtocols\n\n\nSome PowHeartBeat variants use HTTP\nas the communication protocol with the\nC&C server.\n\n\n[T1090.001](https://attack.mitre.org/versions/v11/techniques/T1090/001) Proxy: Internal\nProxy\n\n[T1001.002](https://attack.mitre.org/versions/v11/techniques/T1001/002) Data\nObfuscation:\nSteganography\n\n[T1573.002](https://attack.mitre.org/versions/v11/techniques/T1573/002) Encrypted\nChannel:\nAsymmetric\nCryptography\n\n[T1095](https://attack.mitre.org/versions/v11/techniques/T1095) Non-Application\nLayer Protocol\n\n[T1132.001](https://attack.mitre.org/versions/v11/techniques/T1132/001) Data Encoding:\nStandard\nEncoding\n\n[T1132.002](https://attack.mitre.org/versions/v11/techniques/T1132/002) Data Encoding:\nNon-Standard\nEncoding\n\n\nPowHeartBeat handles proxy\nconfiguration on the victim’s\nmachine.\n\nPNGLoad extracts pixel values\nfrom .png files to reconstruct\npayloads.\n\nPowHeartBeat handles HTTPS\ncommunications with the C&C\nserver.\n\nSome PowHeartBeat variants use\nICMP as the communication\nprotocol with the C&C server.\n\nWorok uses XOR encoding in\nPowHeartBeat, and PNGLoad.\n\nWorok uses XOR encoding\nalgorithms that make use of an\nadditional salt.\n\n\n**Exfiltration** [T1041](https://attack.mitre.org/versions/v11/techniques/T1041) Exfiltration Over C2 Channel PowHeartBeat uses its C&C\ncommunication channel to exfiltrate\ninformation.\n\n\n-----\n\n6 Sep 2022 - 11:30AM\n\n### Sign up to receive an email update whenever a new article is published in our Ukraine Crisis – Digital Security Resource Center\n\n Newsletter\n\n Discussion\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-09-06 - Worok- The big picture.pdf"
    ],
    "report_names": [
        "2022-09-06 - Worok- The big picture.pdf"
    ],
    "threat_actors": [
        {
            "id": "a7e5d6c0-5f7e-4d1c-87fa-bbf65b4e65b9",
            "created_at": "2022-10-25T16:07:24.42571Z",
            "updated_at": "2025-03-27T02:02:10.217844Z",
            "deleted_at": null,
            "main_name": "Worok",
            "aliases": [],
            "source_name": "ETDA:Worok",
            "tools": [
                "CLRLoad",
                "Mimikatz",
                "NBTscan",
                "PNGLoad",
                "PowHeartBeat",
                "SAMRID",
                "nbtscan",
                "reGeorg"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "a4aca3ca-9e04-42d1-b037-f7fb3fbab0b1",
            "created_at": "2023-01-06T13:46:39.042499Z",
            "updated_at": "2025-03-27T02:00:02.984002Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Colourful Panda",
                "BRONZE DUDLEY"
            ],
            "source_name": "MISPGALAXY:TA428",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e294737b-6aa7-480e-841d-cbed102c356c",
            "created_at": "2023-07-20T02:00:08.787855Z",
            "updated_at": "2025-03-27T02:00:03.135455Z",
            "deleted_at": null,
            "main_name": "Worok",
            "aliases": [],
            "source_name": "MISPGALAXY:Worok",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2f07a03f-eb1f-47c8-a8e9-a1a00f2ec253",
            "created_at": "2022-10-25T16:07:24.277669Z",
            "updated_at": "2025-03-27T02:02:10.157972Z",
            "deleted_at": null,
            "main_name": "TA428",
            "aliases": [
                "Operation LagTime IT",
                "Operation StealthyTrident",
                "ThunderCats"
            ],
            "source_name": "ETDA:TA428",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Agent.dhwf",
                "Albaniiutas",
                "BlueTraveller",
                "Chymine",
                "Cotx RAT",
                "CoughingDown",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Gen:Trojan.Heur.PT",
                "Kaba",
                "Korplug",
                "LuckyBack",
                "PhantomNet",
                "PlugX",
                "Poison Ivy",
                "RedDelta",
                "RoyalRoad",
                "SManager",
                "SPIVY",
                "Sogu",
                "TIGERPLUG",
                "TManger",
                "TVT",
                "Thoper",
                "Xamtrav",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e3492534-85a6-4c87-a754-5ae4a56d7c8c",
            "created_at": "2022-10-25T15:50:23.819113Z",
            "updated_at": "2025-03-27T02:00:55.552554Z",
            "deleted_at": null,
            "main_name": "Threat Group-3390",
            "aliases": [
                "Threat Group-3390",
                "Earth Smilodon",
                "TG-3390",
                "Emissary Panda",
                "BRONZE UNION",
                "APT27",
                "Iron Tiger",
                "LuckyMouse"
            ],
            "source_name": "MITRE:Threat Group-3390",
            "tools": [
                "Systeminfo",
                "gsecdump",
                "PlugX",
                "ASPXSpy",
                "Cobalt Strike",
                "Mimikatz",
                "Impacket",
                "gh0st RAT",
                "certutil",
                "China Chopper",
                "HTTPBrowser",
                "Tasklist",
                "netstat",
                "SysUpdate",
                "HyperBro",
                "ZxShell",
                "RCSession",
                "ipconfig",
                "Clambling",
                "pwdump",
                "NBTscan",
                "Pandora",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "c416260c-7ff6-4a74-a5ba-a15f40d3543f",
            "created_at": "2024-05-01T02:03:07.939268Z",
            "updated_at": "2025-03-27T02:05:17.25652Z",
            "deleted_at": null,
            "main_name": "BRONZE DUDLEY",
            "aliases": [
                "Temp.Hex ",
                "Vicious Panda ",
                "TA428 "
            ],
            "source_name": "Secureworks:BRONZE DUDLEY",
            "tools": [
                "PoisonIvy"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "5c13338b-eaed-429a-9437-f5015aa98276",
            "created_at": "2022-10-25T16:07:23.582715Z",
            "updated_at": "2025-03-27T02:02:09.875151Z",
            "deleted_at": null,
            "main_name": "Emissary Panda",
            "aliases": [
                "APT 27",
                "ATK 15",
                "Bronze Union",
                "Budworm",
                "Earth Smilodon",
                "Emissary Panda",
                "Group 35",
                "Iron Taurus",
                "Iron Tiger",
                "LuckyMouse",
                "Operation DRBControl",
                "Operation Iron Tiger",
                "Operation PZChao",
                "Operation SpoiledLegacy",
                "Operation StealthyTrident",
                "Red Phoenix",
                "TEMP.Hippo",
                "TG-3390",
                "ZipToken"
            ],
            "source_name": "ETDA:Emissary Panda",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agent.dhwf",
                "AngryRebel",
                "Antak",
                "CHINACHOPPER",
                "China Chopper",
                "Destroy RAT",
                "DestroyRAT",
                "FOCUSFJORD",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HTTPBrowser",
                "HTran",
                "HUC Packet Transmit Tool",
                "HighShell",
                "HttpBrowser RAT",
                "HttpDump",
                "HyperBro",
                "HyperSSL",
                "HyperShell",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "Nishang",
                "OwaAuth",
                "PCRat",
                "PlugX",
                "ProcDump",
                "PsExec",
                "RedDelta",
                "SEASHARPEE",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "SysUpdate",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Token Control",
                "TokenControl",
                "TwoFace",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "gsecdump",
                "luckyowa"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535706,
    "ts_updated_at": 1743041745,
    "ts_creation_date": 1662984267,
    "ts_modification_date": 1662984267,
    "files": {
        "pdf": "https://archive.orkl.eu/e7f37fc4c918063a08bb7ca9044ea6bc13dc036a.pdf",
        "text": "https://archive.orkl.eu/e7f37fc4c918063a08bb7ca9044ea6bc13dc036a.txt",
        "img": "https://archive.orkl.eu/e7f37fc4c918063a08bb7ca9044ea6bc13dc036a.jpg"
    }
}