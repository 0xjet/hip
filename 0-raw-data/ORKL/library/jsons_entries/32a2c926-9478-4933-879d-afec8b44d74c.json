{
    "id": "32a2c926-9478-4933-879d-afec8b44d74c",
    "created_at": "2023-01-12T15:04:50.892905Z",
    "updated_at": "2025-03-27T02:17:11.229326Z",
    "deleted_at": null,
    "sha1_hash": "cea164850c2026d27eabf414835325a3a9c4ff3b",
    "title": "2016-06-14 - New Sofacy Attacks Against US Government Agency",
    "authors": "",
    "file_creation_date": "2022-05-28T00:33:38Z",
    "file_modification_date": "2022-05-28T00:33:38Z",
    "file_size": 333964,
    "plain_text": "# New Sofacy Attacks Against US Government Agency\n\n**[researchcenter.paloaltonetworks.com/2016/06/unit42-new-sofacy-attacks-against-us-government-agency/](https://researchcenter.paloaltonetworks.com/2016/06/unit42-new-sofacy-attacks-against-us-government-agency/)**\n\nRobert Falcone, Bryan Lee June 14, 2016\n\nBy [Robert Falcone and](https://unit42.paloaltonetworks.com/author/robertfalcone/) [Bryan Lee](https://unit42.paloaltonetworks.com/author/bryanlee/)\n\nJune 14, 2016 at 5:00 AM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit42/)\n\nTags: [APT28,](https://unit42.paloaltonetworks.com/tag/apt28/) [Carberp,](https://unit42.paloaltonetworks.com/tag/carberp/) [Ministry of Foreign Affairs,](https://unit42.paloaltonetworks.com/tag/ministry-of-foreign-affairs/) [Sofacy,](https://unit42.paloaltonetworks.com/tag/sofacy/) [Trojan](https://unit42.paloaltonetworks.com/tag/trojan/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/unit42-new-sofacy-attacks-against-us-government-agency/)\n\nThe Sofacy group, also known as APT28, is a well-known threat group that frequently conducts\ncyber espionage campaigns. Recently, Unit 42 identified a spear phishing e-mail from the\nSofacy group that targeted the United States government. The e-mail was sent from a\npotentially compromised account belonging to the Ministry of Foreign Affairs of another\ngovernment entity and carried the Carberp variant of the Sofacy Trojan. The developer\nimplemented a clever persistence mechanism in the Trojan, one which had not been observed\nin previous attacks. The focus of this blog will be on the attacks and the infrastructure\nassociated with Sofacy using the new persistence mechanism as a correlation point.\n\n## The Delivery\n\nOn May 28, 2016, attackers sent a spear-phishing e-mail to a U.S. government entity using an\nemail address belonging to the Ministry of Foreign Affairs of another country. Analysis of the\nattack revealed a high likelihood that the sender’s email address was not spoofed and is\ninstead a result of a compromised host or account belonging to that Ministry.\n\nThe targeted email had a subject of “FW: Exercise Noble Partner 2016”, which is a reference to\na joint NATO training effort between the United States and Georgia. The email contained an\nRTF file as an attachment, with the filename \"Exercise_Noble_Partner_16.rtf,” reflecting the\nsame training exercise. We have also seen related delivery documents with filenames that have\na Russian military theme (Putin_Is_Being_Pushed_to_Prepare_for_War.rtf and Russian antiNato troops.rtf), purportedly targeting organizations in Poland according to a blog published by\n[Prevenity.](http://malware.prevenity.com/2016/05/analiza-ataku-z-maja-2016-na-instytucje.html)\n\nThe RTF file is a weaponized document that attempts to exploit CVE-2015-1641 to drop two\nfiles to the system, specifically, \"btecache.dll\" and \"svchost.dll\". The “btecache.dll” file is a\nTrojan that loads and executes “svchost.dll”, which is a Carberp variant the Sofacy Trojan.\n\n\n-----\n\nSurprisingly, unlike many other espionage actors who display decoy documents after successful\nexploitation, this RTF document does not drop or open a decoy document after exploiting the\nvulnerability.\n\nIn the installation process, we observed the delivery document creating a very interesting\nregistry key that it uses for persistence to run the Trojan. The path to the \"btecache.dll\" file is\nadded to the following registry key:\n\n_Software\\Microsoft\\Office test\\Special\\Perf\\: \"C:\\Users\\_\n\n_[username]\\AppData\\Roaming\\btecache.dll\"_\n\nThis registry key is interesting, because unlike traditional methods of maintaining persistence, it\ndoes not automatically run the “btecache.dll” file at system start up. Instead, this registry key will\ncause the DLL to load only when the user opens any Microsoft Office application, such as Word\nor Excel. This is the first time Unit 42 has seen the Sofacy group, or any other threat\n**group for that matter, use this tactic for persistence purposes. An added benefit for the**\nthreat actor to using this specific tactic for persistence is that it requires user interaction to load\nand execute the malicious payload, which can cause challenges for detection in automated\nsandboxes.\n\n## The Carberp variant of Sofacy\n\nThe \"btecache.dll\" file is the loader Trojan that is responsible for loading the \"svchost.dll\" DLL\nand executing it. Both the \"btecache.dll\" and \"svchost.dll\" files contain code from the leaked\nCarberp source code, specifically the API resolution functions, as well as the RC2 key. The\nSofacy group has used the Carberp source code in the past, specifically discussed in a blog by\nF-Secure, which is the reason we call this Trojan the Carberp variant.\n\nThe \"svchost.dll\" file contains the bulk of the functionality of this Trojan, which at a high level is\na downloader that allows the threat actors to gain an initial foothold on the system. The Trojan\nsends network beacons to its command and control (C2) serverallowing the threat actors to\nidentify targets of interest. The threat actors can then respond to these network beacons to\ndownload and execute additional secondary payloads on the system.\n\nThe Trojan delivered in this attack contains two network locations that it will send network\nbeacons to, specifically “google.com” and “191.101.31.6”. These beacons are sent to the\nlegitimate website google.com as an attempt to hide the true C2 beacons sent to the actual C2\nserver hosted at 191.101.31.6. The network beacons are sent using HTTP POST requests with\nURLs created largely with random characters. There are two exceptions where random\ncharacters are not used to construct the URL, specifically the file extension that is randomly\nchosen from .xml, .pdf, .htm or .zip and the base64 encoded value at the end of the URL. The\nbase64 encoded data is a string (\"J04aLsxVhHBkr19CYr0”) hardcoded within the Trojan that it\nwill then encrypt using a custom algorithm. Figure 1 shows an example beacon sent from the\nTrojan to the C2 server during analysis.\n\n\n-----\n\n_Figure 1 Network Beacon Sent from Carberp variant of Sofacy_\n\nThe POST data seen in the beacon in Figure 1 is base64 encoded and encrypted using the\nsame custom algorithm used to encrypt the data in the beacon URL. We decrypted the data to\ndetermine its purpose and found the cleartext seen in Figure 2.\n\n_,^Bid=I,;<&w@[System Process]_\n_System_\n_smss.exe_\n_csrss.exe_\n_wininit.exe_\n_csrss.exe_\n_winlogon.exe_\n_services.exe_\n_lsass.exe_\n_lsm.exe_\n_svchost.exe_\n_svchost.exe_\n_svchost.exe_\n_svchost.exe_\n_svchost.exe_\n_svchost.exe_\n_svchost.exe_\n_spoolsv.exe_\n_svchost.exe_\n_taskhost.exe_\n_userinit.exe_\n_dwm.exe_\n_explorer.exe_\n\n\n-----\n\n_svchost.exe_\n_cmd.exe_\n_conhost.exe_\n_reader_sl.exe_\n_svchost.exe_\n_cmd.exe_\n_conhost.exe_\n_SearchIndexer.exe_\n_SearchProtocolHost.exe_\n_SearchFilterHost.exe_\n_SearchProtocolHost.exe_\n_explorer.exe_\n_svchost.exe_\n_svchost.exe_\n_disk=IDE\\DiskMAXTOR_HARDDISK_________________________2.2.1___\\5&2770a7af&0&0.0.0_\n_build=0x7caa0e19_\n\n_Figure 2 Decrypted HTTP POST Data Shows System Information_\n\nThe clear text of the data sent in the network beacons contains information regarding the\ncompromised system, as well as malware-specific information. The data is comprised of the\nfollowing fields of data:\n\n**id = The serial number of the storage device**\n\n**w = This parameter (whose name ‘w’ could change to any character between samples) begins**\nwith a one byte value denoting the OS version followed by a one byte value for the CPU\narchitecture. These values are immediately followed by a new line delimited list of running\nprocesses on the system.\n\n**disk = The name of the system's hard drive, obtained from the registry key**\n\"SYSTEM\\CurrentControlSet\\Services\\Disk\\Enum\\0\"\n\n**build = The hardcoded build identifier for the Trojan version**\n\n**inject = (Optional, not displayed in Figure 2) If the Trojan injected its code into other processes**\nto interact with the C2 server\n\nThis callback data allows the threat actors to determine if the infected machine is a target of\ninterest, as the beacon contains a list of running processes and the name of the storage device\nthat could be used to filter out analysis systems or researchers. If the actors believe the system\nis of interest, they will respond to these network beacons to download and execute additional\nsecondary payloads on the system. The Trojan parses the response to the beacons for two\nactions \"Execute\" and \"Delete\" between the tags \"[file]\" and \"[/file]\", as well as settings labeled\n\n\n-----\n\nFileName, PathToSave, Rundll and IP between the tags [settings] and [/settings] . This\nallows the threat actors to download additional files to the system, execute both executables\nand DLLs and delete files.\n\n## The Infrastructure\n\nThe initial analyzed sample in this attack only contained a single malicious command and\ncontrol location, 191.101.31.6. We have not observed this IP address used by the Sofacy group\nin any previous attack campaigns, and examining passive DNS data showed no other\ncorrelations to potentially related attacks. The sample also seen by Prevenity appeared to only\nhave a single primary C2 domain, servicecdp[.]com. This domain also appears to be newly\ncreated for this specific attack campaign, with no strong links to any previous attacks.\n\nPivoting off the unique registry key used for persistence revealed links to a previously observed\nSofacy campaign, from mid-2015. Two additional payloads with recent compile dates of March\n7, 2016, were discovered using the same persistence mechanism, and analysis of those\npayloads revealed one primary C2 domain, munimonoce[.]com, and three secondary C2\ndomains, www.wscapi[.]com, www.tabsync[.]net, and storsvc[.]org. The secondary C2 domains\n[may appear familiar, as they were widely publicized in a report from iSight Partners in July 2015](https://www.isightpartners.com/2015/07/microsoft-office-zero-day-cve-2015-2424-leveraged-by-tsar-team/)\nas C2 domains related to the Sofacy group aka Tsar Team.\n\nIn addition, the primary C2 domain munimonoce[.]com previously had resolved to the IP\n66.172.11.207, which was previously identified as a primary C2 IP for a Sofacy payload with a\ncompile timestamp of June 11, 2015. This particular sample also happened to use the exact\nsame secondary C2 domains of www.wscapi[.]com, www.tabsync[.]net, and storsvc[.]org, but\nlacked the newly discovered persistence mechanism.\n\nThe Sofacy group often re-uses infrastructure components across multiple attack campaigns,\nwhether to speed the flow of attacks, for a lack of available resources committed, or out of\nsheer laziness. In this case, the newer attack campaign appears to use newly created\ninfrastructure, but still maintains some overlap with previous Sofacy-related C2s. We believe\nthis overlap could possibly be due to an oversight when adapting a previous code base with the\nnew persistence method discussed in this blog for the new attack campaign.\n\n\n-----\n\nThe threat appears to be moving toward deployment of one-off infrastructure that can make\nanalysis of attack campaigns and correlation more challenging. This shift stresses the\nimportance of analysts and researchers being able to pivot on all artifacts of a given attack, not\nsimply relying on network indicators. In this case, we were able use AutoFocus to pivot on a\ncommon registry key unique to this attack campaign to quickly identify where it correlates with\ncharacteristics of previous attacks.\n\n## Conclusion\n\nThe Sofacy group continues its attack campaigns on government organizations, specifically the\nU.S. government in this latest spear-phishing example. The threat group added a new\npersistence mechanism that requires user interaction by loading its payload into Microsoft\nOffice applications when opened, which may help the actors to evade detection. The use of this\nnew persistence method shows the continued development of tactics and techniques employed\nby this threat group, often times in clever ways as we observed in this instance.\n\nPalo Alto Networks customers are protected from the new Sofacy Carberp variant and can\ngather additional information using the following tools:\n\nWildFire detection of all known samples as malicious\nAll known C2s are classified as malicious in PAN-DB\n[AutoFocus tags have been created SofacyCarberp](https://autofocus.paloaltonetworks.com/#/tag/Unit42.SofacyCarberp)\n\n## Indicators\n\n**Delivery Documents**\n\n03cb76bdc619fac422d2b954adfa511e7ecabc106adce804b1834581b5913bca\n(Exercise_Noble_Partner_16.rtf)\n\n12572c2fc2b0298ffd4305ca532317dc8b97ddfd0a05671066fe594997ec38f5\n(Putin_Is_Being_Pushed_to_Prepare_for_War.rtf and Russian anti-Nato troops.rtf)\n\n**Loader Trojans**\n\nc2551c4e6521ac72982cb952503a2e6f016356e02ee31dea36c713141d4f3785 (btecache.dll)\n\nbe1cfa10fcf2668ae01b98579b345ebe87dab77b6b1581c368d1aba9fd2f10a0 (bitsprex3.dll)\n\nfbd5c2cf1c1f17402cc313fe3266b097a46e08f48b971570ef4667fbfd6b7301 (amdcache.dll)\n\n**Payloads**\n\n69940a20ab9abb31a03fcefe6de92a16ed474bbdff3288498851afc12a834261 (svchost.dll)\n\naeeab3272a2ed2157ebf67f74c00fafc787a2b9bbaa17a03be1e23d4cb273632 (clconfg.dll)\n\ndfa8a85e26c07a348a854130c652dcc6d29b203ee230ce0603c83d9f11bbcacc (iprpp.dll)\n\n57d230ddaf92e2d0504e5bb12abf52062114fb8980c5ecc413116b1d6ffedf1b (clconfg.dll)\n\n**Command and Control**\n\n\n-----\n\n191.101.31.6\nmunimonoce[.]com\nwscapi[.]com\ntabsync[.]net\nstorsvc[.]org\nservicecdp[.]com\n\n**Get updates from**\n**Palo Alto**\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-06-14 - New Sofacy Attacks Against US Government Agency.pdf"
    ],
    "report_names": [
        "2016-06-14 - New Sofacy Attacks Against US Government Agency.pdf"
    ],
    "threat_actors": [
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "d2516b8e-e74f-490d-8a15-43ad6763c7ab",
            "created_at": "2022-10-25T16:07:24.212584Z",
            "updated_at": "2025-03-27T02:02:10.141001Z",
            "deleted_at": null,
            "main_name": "Sofacy",
            "aliases": [
                "APT 28",
                "ATK 5",
                "Blue Athena",
                "BlueDelta",
                "FROZENLAKE",
                "Fancy Bear",
                "Fighting Ursa",
                "Forest Blizzard",
                "Grey-Cloud",
                "Grizzly Steppe",
                "Group 74",
                "GruesomeLarch",
                "ITG05",
                "Iron Twilight",
                "Operation DealersChoice",
                "Operation Dear Joohn",
                "Operation Komplex",
                "Operation Pawn Storm",
                "Operation Russian Doll",
                "Operation Steal-It",
                "Pawn Storm",
                "SIG40",
                "Sednit",
                "Snakemackerel",
                "Sofacy",
                "Strontium",
                "T-APT-12",
                "TA422",
                "TAG-0700",
                "TAG-110",
                "TG-4127",
                "Tsar Team",
                "UAC-0028",
                "UAC-0063"
            ],
            "source_name": "ETDA:Sofacy",
            "tools": [
                "ADVSTORESHELL",
                "AZZY",
                "Backdoor.SofacyX",
                "CHERRYSPY",
                "CORESHELL",
                "Carberp",
                "Computrace",
                "DealersChoice",
                "Delphacy",
                "Downdelph",
                "Downrage",
                "Drovorub",
                "EVILTOSS",
                "Foozer",
                "GAMEFISH",
                "GooseEgg",
                "Graphite",
                "HATVIBE",
                "HIDEDRV",
                "Headlace",
                "Impacket",
                "JHUHUGIT",
                "JKEYSKW",
                "Koadic",
                "Komplex",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "LoJack",
                "LoJax",
                "MASEPIE",
                "Mimikatz",
                "NETUI",
                "Nimcy",
                "OCEANMAP",
                "OLDBAIT",
                "PocoDown",
                "PocoDownloader",
                "Popr-d30",
                "ProcDump",
                "PythocyDbg",
                "SMBExec",
                "SOURFACE",
                "SPLM",
                "STEELHOOK",
                "Sasfis",
                "Sedkit",
                "Sednit",
                "Sedreco",
                "Seduploader",
                "Shunnael",
                "SkinnyBoy",
                "Sofacy",
                "SofacyCarberp",
                "SpiderLabs Responder",
                "Trojan.Shunnael",
                "Trojan.Sofacy",
                "USB Stealer",
                "USBStealer",
                "VPNFilter",
                "Win32/USBStealer",
                "WinIDS",
                "Winexe",
                "X-Agent",
                "X-Tunnel",
                "XAPS",
                "XTunnel",
                "Xagent",
                "Zebrocy",
                "Zekapab",
                "carberplike",
                "certutil",
                "certutil.exe",
                "fysbis",
                "webhp"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535890,
    "ts_updated_at": 1743041831,
    "ts_creation_date": 1653698018,
    "ts_modification_date": 1653698018,
    "files": {
        "pdf": "https://archive.orkl.eu/cea164850c2026d27eabf414835325a3a9c4ff3b.pdf",
        "text": "https://archive.orkl.eu/cea164850c2026d27eabf414835325a3a9c4ff3b.txt",
        "img": "https://archive.orkl.eu/cea164850c2026d27eabf414835325a3a9c4ff3b.jpg"
    }
}