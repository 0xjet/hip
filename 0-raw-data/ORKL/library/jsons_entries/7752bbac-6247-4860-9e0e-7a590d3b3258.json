{
    "id": "7752bbac-6247-4860-9e0e-7a590d3b3258",
    "created_at": "2022-10-25T16:48:20.174889Z",
    "updated_at": "2025-03-27T02:05:45.589979Z",
    "deleted_at": null,
    "sha1_hash": "c50a95070633ecc76898b9f16ded848414747156",
    "title": "Onionduke: Apt Attacks Via The Tor Network - F-Secure Weblog : News From The Lab",
    "authors": "F-Secure",
    "file_creation_date": "2014-11-14T14:37:35Z",
    "file_modification_date": "2014-11-14T14:37:35Z",
    "file_size": 350752,
    "plain_text": "# News from the Lab\n\n[Recently, research was published identifying a Tor exit node, located in Russia, that was consistently and](http://www.leviathansecurity.com/blog/the-case-of-the-modified-binaries/)\n\nmaliciously modifying any uncompressed Windows executables downloaded through it. Naturally this\n\npiqued our interest, so we decided to peer down the rabbit hole. Suffice to say, the hole was a lot deeper\n\nthan we expected! In fact, it went all the way back to the notorious Russian APT family MiniDuke, known\n\nto have been used in targeted attacks against NATO and European government agencies. The malware\n\nused in this case is, however, not a version of MiniDuke. It is instead a separate, distinct family of malware\n\nthat we have since taken to calling OnionDuke. But lets start from the beginning.\n\nWhen a user attempts to download an executable via the malicious Tor exit node, what they actually\n\nreceive is an executable \"wrapper\" that embeds both the original executable and a second, malicious\n\nexecutable. By using a separate wrapper, the malicious actors are able to bypass any integrity checks the\n\noriginal binary might contain. Upon execution, the wrapper will proceed to write to disk and execute the\n\noriginal executable, thereby tricking the user into believing that everything went fine. However, the\n\nwrapper will also write to disk and execute the second executable. In all the cases we have observed, this\n\nmalicious executable has been the same binary (SHA1: a75995f94854dea8799650a2f4a97980b71199d2,\n\ndetected as Trojan-Dropper:W32/OnionDuke.A). This executable is a dropper containing a PE\n\nresource that pretends to be an embedded GIF image file. In reality, the resource is actually an encrypted\n\ndynamically linked library (DLL) file. The dropper will proceed to decrypt this DLL, write it to disk and\n\nexecute it.\n\n\n-----\n\n_A flowchart of the infection process_\n\nOnce executed, the DLL file (SHA1: b491c14d8cfb48636f6095b7b16555e9a575d57f, detected as\n\n**Backdoor:W32/OnionDuke.B) will decrypt an embedded configuration (shown below) and attempt to**\n\nconnect to hardcoded C&C URLs specified in the configuration data. From these C&Cs the malware may\n\nreceive instructions to download and execute additional malicious components. It should be noted, that\n\nwe believe all five domains contacted by the malware are innocent websites compromised by the malware\n\noperators, not dedicated malicious servers.\n\n\n-----\n\nThrough our research, we have also been able to identify multiple other components of the OnionDuke\n\nmalware family. We have, for instance, observed components dedicated to stealing login credentials from\n\nthe victim machine and components dedicated to gathering further information on the compromised\n\nsystem like the presence of antivirus software or a firewall. Some of these components have been observed\n\nbeing downloaded and executed by the original backdoor process but for other components, we have yet to\n\nidentify the infection vector. Most of these components don't embed their own C&C information but\n\nrather communicate with their controllers through the original backdoor process.\n\nOne component, however, is an interesting exception. This DLL file (SHA1\n\n_d433f281cf56015941a1c2cb87066ca62ea1db37, detected as Backdoor:W32/OnionDuke.A) contains_\n\namong its configuration data a different hardcoded C&C domain, overpict.com and also evidence\n\nsuggesting that this component may abuse Twitter as an additional C&C channel. What makes the\n\n_overpict.com domain interesting, is it was originally registered in 2011 with the alias of \"John Kasai\"._\n\nWithin a two-week window, \"John Kasai\" also registered the following domains: airtravelabroad.com,\n\n_beijingnewsblog.net, grouptumbler.com, leveldelta.com, nasdaqblog.net, natureinhome.com,_\n\n_nestedmail.com, nostressjob.com, nytunion.com, oilnewsblog.com, sixsquare.net and ustradecomp.com._\n\nThis is significant because the domains leveldelta.com and grouptumbler.com have previously been\n\nidentified as C&C domains used by MiniDuke. This strongly suggests that although OnionDuke and\n\nMiniDuke are two separate families of malware, the actors behind them are connected through the use of\n\nshared infrastructure.\n\n\n-----\n\n_A visualization of the infrastructure shared between OnionDuke and MiniDuke_\n\nBased on compilation timestamps and discovery dates of samples we have observed, we believe the\n\nOnionDuke operators have been infecting downloaded executables at least since the end of October 2013.\n\nWe also have evidence suggesting that, at least since February of 2014, OnionDuke has not only been\n\nspread by modifying downloaded executables but also by infecting executables in .torrent files containing\n\npirated software. However, it would seem that the OnionDuke family is much older, both based on older\n\ncompilation timestamps and also on the fact that some of the embedded configuration data make\n\nreference to an apparent version number of 4 suggesting that at least three earlier versions of the family\n\nexist.\n\nDuring our research, we have also uncovered strong evidence suggesting that OnionDuke has been used in\n\ntargeted attacks against European government agencies, although we have so far been unable to identify\n\nthe infection vector(s). Interestingly, this would suggest two very different targeting strategies. On one\n\nhand is the \"shooting a fly with a cannon\" mass-infection strategy through modified binaries and, on the\n\nother, the more surgical targeting traditionally associated with APT operations.\n\nIn any case, although much is still shrouded in mystery and speculation, one thing is certain. While using\n\nTor may help you stay anonymous, it does at the same time paint a huge target on your back. It's never a\n\ngood idea to download binaries via Tor (or anything else) without encryption The problem with Tor is\n\n\n-----\n\n[(such as our Freedome VPN) will encrypt your connection all the way through the Tor network, so the](http://www.f-secure.com/en/web/home_global/freedome)\n\nmaintainers of Tor exit nodes will not see your traffic and can't tamper with it.\n\nSamples:\n\n- a75995f94854dea8799650a2f4a97980b71199d2\n\n- b491c14d8cfb48636f6095b7b16555e9a575d57f\n\n- d433f281cf56015941a1c2cb87066ca62ea1db37\n\nDetected as: Trojan-Dropper:W32/OnionDuke.A, Backdoor:W32/OnionDuke.A, and\n\n**Backdoor:W32/OnionDuke.B.**\n\n[Post by â€” Artturi (@lehtior2)](https://www.twitter.com/lehtior2)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/vpr6m62odv8f7tz59xisqrba9khg4rhi",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.11.14.OnionDuke/OnionDuke_Tor.pdf"
    ],
    "report_names": [
        "OnionDuke_Tor"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716500,
    "ts_updated_at": 1743041145,
    "ts_creation_date": 1415975855,
    "ts_modification_date": 1415975855,
    "files": {
        "pdf": "https://archive.orkl.eu/c50a95070633ecc76898b9f16ded848414747156.pdf",
        "text": "https://archive.orkl.eu/c50a95070633ecc76898b9f16ded848414747156.txt",
        "img": "https://archive.orkl.eu/c50a95070633ecc76898b9f16ded848414747156.jpg"
    }
}