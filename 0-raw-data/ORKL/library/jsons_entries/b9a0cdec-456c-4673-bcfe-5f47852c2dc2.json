{
    "id": "b9a0cdec-456c-4673-bcfe-5f47852c2dc2",
    "created_at": "2023-01-12T15:10:11.235491Z",
    "updated_at": "2025-03-27T02:09:29.45497Z",
    "deleted_at": null,
    "sha1_hash": "2986043fb4b567c78870b1fdb99e0f3de169f8b5",
    "title": "2020-05-14 - ATT&CKing ProLock Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T19:37:56Z",
    "file_modification_date": "2022-05-28T19:37:56Z",
    "file_size": 558399,
    "plain_text": "# ATT&CKing ProLock Ransomware\n\n**group-ib.com/blog/prolock**\n\n14.05.2020\n\nOleg Skulkin\n\nSenior Digital Forensics Analyst at Group-IB\n\nThe success of enterprise ransomware attacks has motivated more and more threat actors\nto join the game.\n\nOne of these new players is ProLock ransomware.\n\n\n-----\n\nThe locker emerged in March 2020 as the successor of PwndLocker, which began operating\nin late 2019 and was responsible for the attack on Illinois' Lasalle County earlier this year.\nTheir ransoms were always in the six-figure range, and it seems that ProLock operators are\ncontinuing that trend.\n\nDespite not being around long, ProLock has already made its mark, targeting financial,\n[healthcare, government, and retail organizations. The group's first big attack – that we know](https://krebsonsecurity.com/2020/05/ransomware-hit-atm-giant-diebold-nixdorf/)\nof, at least – happened at the end of April, when they successfully attacked Diebold Nixdorf one of the major ATM providers.\n\nIn this post I'll tell you all you need to know about the new player's main tactics, techniques\nand procedures (TTPs). After, I give a complete outline of the MITRE ATT&CK mapping as it\npertains to ProLock.\nInitial Access\n\nProLock operators used two main vectors of initial access: QakBot (Qbot) and unprotected\nRemote Desktop Protocol (RDP)-servers with weak credentials.\n\nThe latter is a fairly common technique among ransomware operators. This kind of access is\nusually bought from a third party but may be obtained by group members as well.\n\nThe more interesting initial access vector is QakBot, a trojan that was at one point affiliated\nwith the MegaCortex ransomware family.\n\nTypically, QakBot is distributed via phishing campaigns. Phishing emails may contain\nattachments of weaponized Microsoft Office documents or just links to such documents that\nare located on cloud storage – Microsoft OneDrive, for example.\n\nQakBot is also known to be loaded by Emotet, a trojan notorious for its connection with Ryuk\noperators.\n\nExecution\n\nOnce weaponized document is downloaded and opened by the victim, malicious macros is\nenabled, PowerShell is launched and used to download and run QakBot payload from the C2\nserver.\n\nIt's important to note here that the same can be said about ProLock: the payload is extracted\nfrom a BMP or JPG file, and is loaded into memory with PowerShell. In some cases, a\nscheduled task is used to run PowerShell:\n```\nschtasks.exe /CREATE /XML C:\\Programdata\\WinMgr.xml /tn WinMgr\nschtasks.exe /RUN /tn WinMgr\ndel C:\\Programdata\\WinMgr.xml\ndel C:\\Programdata\\run.bat\n\n```\n_Figure 1: Batch script_\n\n\n-----\n\nPersistence\n\nIn case of RDP access, valid accounts are used to gain persistence in the network. QakBot,\non the other hand, uses multiple persistence mechanisms – most often Run keys and\nscheduled tasks:\n\n_Figure 2: Qakbot gained persistence via Run key_\n\nIn some cases, startup folders are also used: a shortcut is placed in the folder that points to\nthe loader.\n\nDefense Evasion\n\nQBot has a neat trick that lets it avoid detection: it checks for the newest version of itself, and\nreplaces the current version with the new one. Executable files are signed with a stolen or\nfake signature. The initial payload, downloaded by PowerShell, is stored on the server with a\nPNG extension. What's more, is that it's replaced with the legitimate file calc.exe after\nexecution.\n\nTo evade detection, QakBot also uses explorer.exe to execute a process injection\ntechnique.\n\nAs already mentioned, the ProLock payload is hidden inside a BMP or JPG file and may be\nconsidered a defense evasion technique as well.\n\nCredential Access\n\nQakBot has keylogging capabilities but is also able to download and run additional scripts\nlike Invoke-Mimikatz, a PowerShell version of the notorious Mimikatz. This enables the\nadversary to employ the credential dumping technique.\n\nDiscovery\n\nOnce privileged credentials are obtained, ProLock operators start network discovery\nactivities. They include, but are not limited to, port scanning and Active Directory\nreconnaissance.\n\nIn addition to a wide variety of scripts, attackers use AdFind – another popular tool used by\nmany ransomware groups – to query Active Directory.\n\nLateral Movement\n\n\n-----\n\nMany adversaries favor RDP to move laterally across networks, and ProLock is no\nexception. Attackers even have batch scripts in their arsenals to enable RDP access on the\ntarget hosts:\n```\nreg add \"HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\" /v\n\"fDenyTSConnections\" /t REG_DWORD /d 0 /f\nnetsh advfirewall firewall set rule group=\"Remote Desktop\" new enable=yes\nreg add \"HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\"\n/v \"UserAuthentication\" /t REG_DWORD /d 0 /f\n\n```\n_Figure 3: A batch script for enabling RDP_\n\nFor remote script execution, ProLock operators use PsExec from Sysinternals Suite, another\ncommon tool.\n\nTo run ProLock on hosts, attackers used WMIC – a command line interface for Windows\nManagement Instrumentation – which is also becoming increasingly popular among\nransomware operators.\n\nCollection\n\nJust like many other groups, ProLock operators collect data from compromised networks to\nimprove their chances of fulfilling their ransom demands. Prior to exfiltration, collected data is\narchived with 7Zip.\n\nExfiltration\n\nFor exfiltration, ProLock operators use Rclone, a command line tool capable of synching\nfiles to and from different cloud storage providers, such as OneDrive, Google Drive, Mega,\netc. The executable is always renamed to resemble legitimate system binaries.\n\nUnlike their peers, though, ProLock operators still don't have a website where they publish\nexfiltrated data from companies that refuse to pay the ransom.\n\nImpact\n\nOnce the data is exfiltrated, the group deploys ProLock enterprise-wide. PowerShell is used\nto extract the binary from a PNG or a JPG file and inject it into the memory:\n\n\n-----\n\n_Figure 4: PowerShell script_\n\nFirst, ProLock kills processes from embedded list (what's interesting is that it uses only six\nletters from the process name, like \"winwor\") and stops services, including security-related\nones like CSFalconService (CrowdStrike Falcon), via the net stop command.\n\nThen, like many other ransomware families, it uses vssadmin to remove Volume Shadow\nCopies and limit their size, so no new copies are created:\n```\nvssadmin.exe delete shadows /all /quiet\nvssadmin.exe resize shadowstorage /for=C: /on=C: /maxsize=401MB\nvssadmin.exe resize shadowstorage /for=C: /on=C: /maxsize=unbounded\n\n```\n_Figure 5: Removing Volume Shadow Copies_\n\nProLock adds .proLock, .pr0Lock or .proL0ck extension to each encrypted file, and drops\n\n[HOW TO RECOVER FILES].TXT to each folder – a file with instructions on how to decrypt\nfiles, including the link to the website, where the victim should enter the unique ID and get\npayment information:\n\n\n-----\n\n_Figure 6: ProLock Ransom Note_\n\nEach ProLock sample has an embedded ransom amount – in this case it was 35 Bitcoin, or\napproximately $312 000.\n\nSummary\n\nAs you can see, ProLock uses many similar techniques as other ransomware operators to\nachieve their goals. At the same time, however, the group does have its own unique\napproach. With more and more cybercrime groups showing interest in enterprise\nransomware deployment campaigns, some operators may be involved in deploying different\nransomware families, so we'll likely see more overlaps in tactics, techniques and procedures.\n\nMITRE ATT&CK Mapping\n\nThe global pandemic has forced many people to work from home. Transitioning employees\nto remote work creates additional cybersecurity risks. Many cybercriminals are exploiting the\ncrisis and ransomeware operators are not an exception. INTERPOL's Cybercrime team\ntracked a surge in ransomware attacks amid COVID19. Group-IB DFIR experts prepared 10\n[Recommendations for preventing ransomware attacks accessible here](https://www.group-ib.com/landing/stay-safe.html#10-Recommendations)\n\n\n-----\n\n**Be confident in the security of your company**\n\nFor more than 17 years Group-IB's DFIR Lab has investigated cybercrimes around the world.\nDuring this time, we've clocked in more than 60,000 hours of incident response to the most\ncomplex cyberattacks.\n\nIf our experience has taught us anything, it's that a professional response to ransomware is\nextremely important. Just as important as having a proactive approach to responding to\npotential threats.\n\nGroup-IB's Incident Response Retainer allows your company to meet these challenges and\nmaintain peace of mind.\n\nLearn more\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-05-14 - ATT&CKing ProLock Ransomware.pdf"
    ],
    "report_names": [
        "2020-05-14 - ATT&CKing ProLock Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "254f2fab-5834-4d90-9205-d80e63d6d867",
            "created_at": "2023-01-06T13:46:38.31544Z",
            "updated_at": "2025-03-27T02:00:02.802896Z",
            "deleted_at": null,
            "main_name": "APT21",
            "aliases": [
                "HAMMER PANDA",
                "TEMP.Zhenbao",
                "NetTraveler"
            ],
            "source_name": "MISPGALAXY:APT21",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536211,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653766676,
    "ts_modification_date": 1653766676,
    "files": {
        "pdf": "https://archive.orkl.eu/2986043fb4b567c78870b1fdb99e0f3de169f8b5.pdf",
        "text": "https://archive.orkl.eu/2986043fb4b567c78870b1fdb99e0f3de169f8b5.txt",
        "img": "https://archive.orkl.eu/2986043fb4b567c78870b1fdb99e0f3de169f8b5.jpg"
    }
}