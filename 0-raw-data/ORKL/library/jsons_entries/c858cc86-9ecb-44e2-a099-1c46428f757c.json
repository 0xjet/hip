{
    "id": "c858cc86-9ecb-44e2-a099-1c46428f757c",
    "created_at": "2023-01-12T15:06:27.181591Z",
    "updated_at": "2025-03-27T02:08:40.98596Z",
    "deleted_at": null,
    "sha1_hash": "9b606d70f6999360d8344424bde0068675b8ff92",
    "title": "2017-11-06 - Mitigating and eliminating info-stealing Qakbot and Emotet in corporate networks",
    "authors": "",
    "file_creation_date": "2022-05-28T21:55:35Z",
    "file_modification_date": "2022-05-28T21:55:35Z",
    "file_size": 664719,
    "plain_text": "# Mitigating and eliminating info-stealing Qakbot and Emotet in corporate networks\n\n**[cloudblogs.microsoft.com/microsoftsecure/2017/11/06/mitigating-and-eliminating-info-stealing-qakbot-and-emotet-in-corporate-networks/](https://cloudblogs.microsoft.com/microsoftsecure/2017/11/06/mitigating-and-eliminating-info-stealing-qakbot-and-emotet-in-corporate-networks/?source=mmpc)**\n\nNovember 6, 2017\n\nThe threat to sensitive financial information is greater than ever. Data breaches, phishing attacks, and other\nforms of information theft are all too common in today’s threat landscape. Point-of-sale systems and ATMs have\nbeen targeted by hackers. Information-stealing trojans pose a risk to data and can lead to significant financial\nloss.\n\n[Qakbot and](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Backdoor:Win32/Qakbot.T) [Emotet are information stealers that have been showing renewed activity in recent months. These](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?name=Win32/Emotet)\nmalware families are technically different, but they share many similarities in behavior. They both have the\nultimate goal of stealing online banking credentials that malware operators can then use to steal money from\nonline banking accounts. They can also steal other sensitive information using techniques like keylogging.\n\n_Figure 1. Qakbot and Emotet monthly machine encounters show an upward trend. This data doesn’t include_\n_Qakbot and Emotet variants blocked by automation and cloud rules._\n\nEven though these malware families are typically known to target individual online banking users, more and more\nenterprises, small and medium businesses, and other organizations have been affected by indiscriminate\ninfections.\n\n\n-----\n\n_Figure 2. Breakdown of Qakbot and Emotet machine encounters_\n\nRecent variants of these malware families have spreading capabilities, which can increase the chances of\nmultiple infections in corporate networks. They can also be spread by other malware during the lateral movement\nstage of a cyberattack.\n\n## Typical Qakbot and Emotet kill chain\n\nOver the years, the cybercriminals behind Qakbot and Emotet have improved the code behind their malware.\nThey have evolved to evade detection, stay under the radar longer, and increase the chances of spreading to\nother potential victims.\n\nWe mapped some of the common behaviors we’ve seen in Qakbot and Emotet variants and see a lot of\nsimilarities.\n\n\n-----\n\n_Figure 3. Qakbot and Emotet attack kill chain. Note that some Qakbot and Emotet variants might not exhibit all of_\n_the behaviors above and might be capable of unique routines._\n\nBecause of similarities in behavior, Qakbot and Emotet can be mitigated by similar security measures.\n\n## Steps to mitigate Qakbot and Emotet\n\nBased on our experience helping organizations get rid of Qakbot and Emotet, the following steps mitigate\ninfection and ultimately remove the said malware from corporate networks:\n\n\n-----\n\n1. Stop the spread of malware and cut off communication with its command and control\n\n### server\n\nCut off Internet access or disconnect the affected machines from the network until they have been\n[cleaned. Windows Defender Advanced Threat Protection customers can](https://www.microsoft.com/en-us/windowsforbusiness/windows-atp?ocid=cx-blog-mmpc) [isolate affected machines](https://docs.microsoft.com/en-us/windows/threat-protection/windows-defender-atp/respond-machine-alerts-windows-defender-advanced-threat-protection)\nwith one click. You can also block infected machines at the edge firewall, unplug machines from the\n[network, or create rules on Windows Defender Advanced Firewall (and push these out via Group](https://docs.microsoft.com/en-us/windows/access-protection/windows-firewall/windows-firewall-with-advanced-security-deployment-guide)\nPolicy Objects (GPO)).\nStop sharing folders that show signs of infection or set shared folders to read-only. Removing admin\nshares is an option that should only be used as a last resort as this can cause other issues and hinder\nmanagement\nPractice credential hygiene. Remove unnecessary privileges, or disable privileged accounts that have\nbeen observed to spread malware using SMB.\n\n2. Look for new service creations and scheduled tasks\n\nLook for new service creations by tracking event ID 7045 in the system log. We’ve observed this\nthreat to create services with randomly generated number strings as the name and .exe name, but\ncleans them up after.\nYou can look for new scheduled tasks using even ID 106 in the task schedule log or 7045 to track\ndown machines.\n\n3. Remove Qakbot, Emotet, and other related malware\n\nObtain and submit samples to your antivirus vendor. Malware samples can be obtained by following\nthe scheduled tasks and reviewing the target binaries. For Microsoft customers, use the Windows\nDefender Security Intelligence submission portal.\nDeploy updated definitions as soon as your antivirus vendor has tested and released them. Enable\ncloud-delivered protection to get the latest protection in real-time. Do a full scan on all affected\n[machines. For Windows Defender Antivirus customers, learn how to](https://www.microsoft.com/en-us/windows/windows-defender) [manage updates.](https://docs.microsoft.com/en-us/windows/threat-protection/windows-defender-antivirus/manage-updates-baselines-windows-defender-antivirus)\nUncover undetected variants by inspecting infected systems for scheduled tasks and their target\n[binaries. The Sysinternals Autoruns tool can be your friend here. Windows Defender ATP customers](https://docs.microsoft.com/en-us/sysinternals/downloads/autoruns)\ncan [review the timeline of known affected machines to find undetected malware components.](https://docs.microsoft.com/en-us/windows/threat-protection/windows-defender-atp/investigate-machines-windows-defender-advanced-threat-protection)\n[Additional affected machines can be identified by reviewing the incident graph for the relevant alert or](https://docs.microsoft.com/en-us/windows/threat-protection/windows-defender-atp/investigate-alerts-windows-defender-advanced-threat-protection#incident-graph)\nby searching for threat known artifacts, such as file SHA1s, IP addresses, and URLs.\n\n4. Monitor the network for possible reinfection\n\n[Determine and address the initial attack vector. Use security solutions like Windows Defender ATP,](https://www.microsoft.com/en-us/windowsforbusiness/windows-atp?ocid=cx-blog-mmpc)\nwhich provides detailed timelines and other contextual information to understand the nature of attacks\nand take response actions.\nSlowly reintroduce network connectivity to the subset of the machines that have been cleaned.\nMonitor them for reinfection.\nReintroduce network connectivity to all affected machines that are believed to be clean.\nTurn on real-time protection in your antivirus. In Microsoft Security Essentials and Windows Defender\n[Antivirus for Windows 10, enable cloud-based protection and automatic sample submission. With](https://docs.microsoft.com/en-us/windows/threat-protection/windows-defender-antivirus/enable-cloud-protection-windows-defender-antivirus)\n[these features enabled, Windows Defender Antivirus provides advanced real-time protection against](https://blogs.technet.microsoft.com/mmpc/2017/07/18/windows-defender-antivirus-cloud-protection-service-advanced-real-time-defense-against-never-before-seen-malware/)\nnever-before-seen threats.\n\n## Preventing Qakbot and Emotet infections with Windows 10\n\n\n-----\n\nWhile the steps above can rid networks of Qakbot and Emotet, preventing infection eliminates opportunities for\nthese threats to steal info. [Windows 10 S is a streamlined platform with Microsoft-verified security. It blocks](https://www.microsoft.com/en-us/windows/windows-10-s)\nmalware like Qakbot and Emotet and other malicious programs by working exclusively with apps from the\nWindows Store, ensuring that only apps that went through the Store onboarding, vetting, and signing process are\nallowed to run.\n\nAdditionally, Windows 10 has a comprehensive defense stack that can help block and detect malware like\nQakbot and Emotet.\n\nUse [Microsoft Edge to block Qakbot and Emotet infections from the web. Microsoft Edge opens pages within low](https://docs.microsoft.com/en-us/microsoft-edge/deploy/index)\nprivilege app containers and uses reputation-based blocking of malicious downloads. Its click-to-run feature for\n[Flash can stop malware infections that begin with exploit kits. With Windows Defender Application Guard,](https://blogs.technet.microsoft.com/mmpc/2017/10/23/making-microsoft-edge-the-most-secure-browser-with-windows-defender-application-guard/)\n[Microsoft Edge has an additional hardware isolation-level capability on top of its exploit mitigation and](https://blogs.windows.com/msedgedev/2017/02/23/mitigating-arbitrary-native-code-execution?ocid=cx-blog-mmpc) sandbox\nfeatures.\n\nBlock malicious emails carrying trojan droppers that install Qakbot and Emotet using Microsoft Exchange Online\nProtection (EOP), which has built-in anti-spam filtering capabilities that help protect Office 365 customers. Secure\n[mailboxes against email attacks with Office 365 Advanced Threat Protection, which blocks unsafe attachments,](https://products.office.com/en-us/exchange/online-email-threat-protection)\nmalicious links, and linked-to files leveraging time-of-click protection. Outlook.com anti-spam filters also provide\nprotection against malicious emails.\n\n[Enable Windows Defender Exploit Guard to block malicious documents (such as those that use macro code to](https://blogs.technet.microsoft.com/mmpc/2017/10/23/windows-defender-exploit-guard-reduce-the-attack-surface-against-next-generation-malware/)\n[install Qakbot and Emotet, or the more recent DDEDownloader that install other malware) and scripts. The Attack](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Exploit:O97M/DDEDownloader.A&ocid=cx-blog-mmpc)\nSurface Reduction (ASR) feature in Windows Defender Exploit Guard uses a set of built-in intelligence that can\nblock malicious behaviors observed in malicious documents. ASR rules can also be turned on to block malicious\nattachments from being run or launched from Microsoft Outlook or webmail (such as Gmail, Hotmail, or Yahoo).\n\nUse [Credential Guard to protect domain credentials and help stop malware from spreading using compromised](https://docs.microsoft.com/en-us/windows/device-security/device-guard/introduction-to-device-guard-virtualization-based-security-and-code-integrity-policies)\ncredentials.\n\nUse [Local Administrator Password Solution (LAPS) to manage local account passwords and domain joined](https://www.microsoft.com/en-us/download/details.aspx?id=46899)\ncomputers.\n\n[Enable Windows Defender AV to detect Qakbot and Emotet variants, as well as all related malware such as](https://www.microsoft.com/en-us/windows/windows-defender)\ndroppers and downloaders. Windows Defender AV uses precise machine learning models as well as generic and\nheuristic techniques and enhanced behavior analysis to detect common and complex malware code. It provides\nadvanced real-time protection against new and unknown files using the Windows Defender AV cloud protection\nservice.\n\nUse [Windows Defender Advanced Threat Protection to flag Qakbot or Emotet infections and to enable security](https://www.microsoft.com/en-us/windowsforbusiness/windows-atp?ocid=cx-blog-mmpc)\noperations personnel to stop the spread of these threats in the network. Windows Defender ATP’s enhanced\nbehavioral and machine learning detection libraries flag malicious behavior across the malware infection process,\nfrom delivery and installation, to persistence mechanisms, command-and-control communication, and lateral\nmovement. The new process tree visualization and improvements in machine isolation further help security\noperations to investigate and respond to attacks.\n\nTo test how Windows Defender ATP can help your organization detect, investigate, and respond to advanced\nattacks, **[sign up for a free trial.](https://www.microsoft.com/en-us/windowsforbusiness/windows-atp?ocid=cx-blog-mmpc)**\n\n\n-----\n\n_Figure 4. Machine learning-based alert in Windows Defender ATP showing suspicious memory injections and_\n_registry modifications_\n\nThese end-to-end security features in Windows 10 help defend against increasingly complex malware attacks. At\nMicrosoft, we continue to harden Windows 10 against attacks. With Fall Creators Update, we shipped several\nnew and enhanced security features that make Windows 10 the most secure version of Windows yet. Learn more\nabout these features:\n\nIt is also important for organizations to augment these security technologies with a security-aware workforce.\nEducating employees on social engineering attacks and internet safety, and training them to report suspicious\nemails or websites can go a long way in protecting networks against cyberattacks.\n\n**_Keith Abluton, Windows Escalation Services_**\n\n**_Rodel Finones, Windows Defender Research_**\n\n## Indicators of compromise\n\nThe following are IOCs for recent Qakbot and Emotet variants:\n\n### Qakbot\n\nQakbot malware (SHA256):\n\nda00823090dae3dae452ddc8a4c2a3c087389b4aacf1f0c12d13c83c9fcaef9c\n\nca2d536b91b15e7fc44ec93bbed1f0f46ae65c723b8a4823253a2a91b8241f9a\n\nFilenames:\n\n%APPDATA%\\Microsoft\\<random folder name>\\<random file name>, for example:\n\n%APPDATA%\\Microsoft\\Cexpalgxx\\Cexpalgxx.exe\n\n%APPDATA%\\Microsoft\\Cexpalgxx\\Cexpalgxx32.dll (configuration file)\n\nRegistry modifications:\n\n\n-----\n\nIn subkey: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\n\nSets value: <random value name>\n\nWith data: “%APPDATA%\\Microsoft\\<random folder name>\\<random file name>”\n\nIn subkey: HKLM\\SYSTEM\\CurrentControlSet\\services\\<random service name>\n\nSets value: ImagePath\n\nWith data: “%APPDATA%\\Microsoft\\<random folder name>\\<random file name> /D”\n\nSets value: Type\n\nWith data: dword:00000010\n\nSets value: “Start”\n\nWith data: dword:00000002\n\nSets value: “DisplayName”\n\nWith data: “Remote Procedure Call (RPC) Service”\n\nSets value: “ErrorControl”\n\nWith data: dword:00000000\n\nSets value: “DependOnService”\n\nWith data: “Dnscache”\n\nSets value: “ObjectName”\n\nWith data: “LocalSystem”\n\nIn subkey: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\n\nSets value: ctfmon.exe\n\nWith data: “%APPDATA%\\Microsoft\\<random folder name>\\<random file name>” /c “%System\nFolder%\\ctfmon.exe”\n\nCommand-and-control servers:\n\n64.183.173.170:995\n\n67.213.243.228:993\n\n96.67.244.225:443\n\n173.25.234.18:443\n\n24.123.151.58:443\n\n76.164.161.46:995\n\n68.115.254.146:443\n\n\n-----\n\n198.57.88.73:443\n\n47.21.79.34:443\n\n174.51.185.121:465\n\n71.3.55.80:993\n\n88.244.177.127:443\n\n180.93.148.41:443\n\n101.51.40.175:443\n\n73.166.94.110:443\n\n71.88.202.122:443\n\n74.5.136.50:990\n\n89.43.179.209:443\n\n211.27.18.233:995\n\n96.82.91.67:443\n\n98.194.132.179:443\n\n98.113.137.220:443\n\n24.184.200.177:2222\n\n105.224.247.34:443\n\n### Emotet\n\nEmotet downloader (SHA256):\n\n4ce5366c7eef1fff1260d5d7a0aec72c1246621838bf8df07f4a6ab3e5369d96\n\nEmotet malware (SHA256):\n\nffcb204da3ff72d268c8ac065c2e7cce5c65fafc2f549d92d0c280c6099bd440\n\n59639027a7fd487295bad10db896528ea223684e6595cae4ce9a0bec8d809087\n\nFilenames:\n\n%appdata%\\roaming\\microsoft\\windows\\start menu\\programs\\startup\\[random].lnk\n\n%Appdata%\\local\\[random]\\[random].exe\n\n%localappdata%\\microsoft\\windows ex: C:\\Windows\\System32\\netshedule.exe\n\nRegistry modifications:\n\nIn subkey: ‘HKLM\\SYSTEM\\ControlSet001\\services\\netshedule’ <Bug: 5667568 Type & Size>\n\nSets value: ‘Type’\n\n\n-----\n\nWith data: 0x00000010\n\nIn subkey: ‘HKLM\\SYSTEM\\ControlSet001\\services\\netshedule’ <Bug: 5667568 Type & Size>\n\nSets value: ‘Start’\n\nWith data: ‘0x00000002’\n\nIn subkey: ‘HKLM\\SYSTEM\\ControlSet001\\services\\netshedule’ <Bug: 5667568 Type & Size>\n\nSets value: ‘ErrorControl’\n\nWith data: ‘0x00000000’\n\nIn subkey: ‘HKLM\\SYSTEM\\ControlSet001\\services\\netshedule’ <Bug: 5667568 Type & Size>\n\nSets value: ‘ImagePath’\n\nWith data: ‘C:\\Windows\\system32\\netshedule.exe’\n\nIn subkey: ‘HKLM\\SYSTEM\\ControlSet001\\services\\netshedule’ <Bug: 5667568 Type & Size>\n\nSets value: ‘DisplayName’\n\nWith data: ‘netshedule’\n\nCommand-and-control servers:\n\n104.236.252.178\n\n162.243.159.58\n\n45.33.55.157\n\n77.244.245.37\n\n192.81.212.79\n\n173.212.192.45\n\n103.16.131.20\n\n195.78.33.200\n\n50.116.54.16\n\n212.83.166.45\n\n137.74.254.64\n\n104.227.137.34\n\n188.165.220.214\n\n85.143.221.180\n\n119.82.27.246\n\n194.88.246.7\n\n\n-----\n\n206.214.220.79\n\n173.230.136.67\n\n173.224.218.25\n\n**Talk to us**\n\n[Questions, concerns, or insights on this story? Join discussions at the Microsoft community and](https://answers.microsoft.com/en-us/protect) Windows\nDefender Security Intelligence.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-11-06 - Mitigating and eliminating info-stealing Qakbot and Emotet in corporate networks.pdf"
    ],
    "report_names": [
        "2017-11-06 - Mitigating and eliminating info-stealing Qakbot and Emotet in corporate networks.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535987,
    "ts_updated_at": 1743041320,
    "ts_creation_date": 1653774935,
    "ts_modification_date": 1653774935,
    "files": {
        "pdf": "https://archive.orkl.eu/9b606d70f6999360d8344424bde0068675b8ff92.pdf",
        "text": "https://archive.orkl.eu/9b606d70f6999360d8344424bde0068675b8ff92.txt",
        "img": "https://archive.orkl.eu/9b606d70f6999360d8344424bde0068675b8ff92.jpg"
    }
}