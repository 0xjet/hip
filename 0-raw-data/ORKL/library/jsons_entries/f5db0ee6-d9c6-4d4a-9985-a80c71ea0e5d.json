{
    "id": "f5db0ee6-d9c6-4d4a-9985-a80c71ea0e5d",
    "created_at": "2023-01-12T15:06:37.669817Z",
    "updated_at": "2025-03-27T02:09:58.761472Z",
    "deleted_at": null,
    "sha1_hash": "db0be12b0d71dab187d5ae987324fc15fd33edfa",
    "title": "2019-02-12 - GreyEnergy Malware Research Paper- Maldoc to Backdoor",
    "authors": "",
    "file_creation_date": "2022-05-28T17:38:46Z",
    "file_modification_date": "2022-05-28T17:38:46Z",
    "file_size": 2620523,
    "plain_text": "# GreyEnergy Malware Research Paper: Maldoc to Backdoor\n\n**[nozominetworks.com/2019/02/12/blog/greyenergy-malware-research-paper-maldoc-to-backdoor/](https://www.nozominetworks.com/2019/02/12/blog/greyenergy-malware-research-paper-maldoc-to-backdoor/)**\n\nBy February 12, 2019\n\nAs a security researcher I believe it’s important for those defending critical and industrial\ninfrastructure to share knowledge and stay up-to-date on malware tradecraft.\n\nSo, when the GreyEnergy Advanced Persistent Threat (APT) was unveiled by ESET last\nyear, I put my reverse engineering skills to work to analyze one of the malware’s infection\ntechniques. This was the phishing email containing a malicious Microsoft Word document\n(maldoc) that lead to the installation of the malware (backdoor) on a victim’s network.\n\nToday I am publishing a Research Paper that provides a comprehensive analysis of how the\nmalware works, from the maldoc, to the custom packer and the final dropper (backdoor).\n[This investigation is a more detailed analysis than what I put forward in a blog article in](https://www.nozominetworks.com///2018/11/20/blog/analyzing-the-greyenergy-malware-from-maldoc-to-backdoor/)\nNovember 2018. And, the deepest analysis is done on the packer, an executable that\ndecrypts and decompresses another executable inside itself.\n\nThis article provides a summary of the techniques used by the packer to conceal its true\nfunctionality and provides a link to download my full Research Paper, GreyEnergy:\n_Dissecting the Malware from Maldoc to Backdoor, Comprehensive Reverse Engineering_\n_Analysis._\n\n\n-----\n\nOnce the GreyEnergy malware infects a system, it does a very good job of using anti-analysis\n\ntechniques to conceal its true functionality.\n\n**GreyEnergy Anti-Analysis Techniques Conceal its Suspected “Packer” Executable**\n\nWhen someone opens the Word document contained in the GreyEnergy phishing email, and\nclicks on “Enable Content”, malicious code is downloaded from a remote location.\n\nThe downloaded file is an executable which I suspected was a “packer”, i.e. an executable\nwhich contains one or more executables that are compressed and encrypted. While\nsometimes used legitimately to protect intellectual property, packers are also used by threat\nactors to hide malware.\n\nAs I investigated the suspected packer executable, I found it was built using several antianalysis techniques:\n\n**Junk code – unnecessary code that has no impact on the suspected packer’s code, and**\nwhose purpose is to confuse the reverse engineer. I determined that GreyEnergy contains a\nmassive amount of junk code.\n\n**Overlapping instructions – GreyEnergy uses JMP instructions that function as overlapping**\ninstructions, where the same sequence of bytes can be interpreted as different instructions,\ndepending on the exact byte in which execution starts.\n\n\n-----\n\n**JMP-based execution code – the execution flow of the suspected GreyEnergy packer is**\nalmost completely based on the use of JMP instructions, instead of sequential instructions.\nThis makes it very hard to identify the true executable, hidden in a sea of junk code.\n\nFurthermore, the binary file of the suspected packer appeared to have overlay data. This is\ndata appended at the end of the file that includes an additional executable component, and is\ndecrypted during run-time.\n\n**Entropy – this is an assessment of a file’s randomness. Using one measure of entropy, with**\na scale of 0 to 8, where results of 7 or more indicate encryption, GreyEnergy has a score of\n7.994. This is a strong indicator that the overlay data is encrypted.\n\n**Dynamic Analysis Reveals the Malware**\n\nAfter assessing the above aspects of the malware, I had a strong suspicion that I was\ndealing with a packer, but lacked solid proof. I decided to switch to a dynamic analysis\napproach to order to speed up the investigation. I then discovered several interesting\nattributes of the suspected packer file:\n\n**Hardcoded imports – the WinAPIs called by the suspected packer are not contained in the**\nPE import table, but loaded at runtime and pushed ono the stack using a mov instruction,\nwithout any kind of obfuscation technique.\n\n**String overwrite – the suspected packer overwrites all strings with zeros, after the strings**\nhave been loaded into memory.\n\nBy now, there are multiple indicators that strongly suggest that the binary is a packer:\n\nApparently encrypted overlay\nAnti-analysis techniques\nAPIs manually resolved by parsing the PE header\nStrings hardcoded inside the code and overwritten with 0x00s after use\n\n**Accessing the overlay – the malware uses a series of steps to identify where the overlay**\nstarts and the exact size of its own executable, and allocates space for itself inside the\nmemory. My analysis reveals exactly how the malware identifies the right offset for the\noverlay.\n\n**Decryption algorithm – the malware uses a custom algorithm to hide its malicious**\ncomponents. When the decryption algorithm is applied, it is clear the data contains an\nexecutable. However, there are several unexpected bytes between the recognized patterns,\nindicating that the data is not yet complete. I suspected that the data is compressed\nsomehow.\n\n\n-----\n\n**Decompression algorithm – my suspicion is quickly confirmed, and after decompression,**\nthe new buffer contains a valid PE header.\n\n**The original entry point (OEP) – next the packer points to the uncompressed buffer, parses**\nthe PE header and iterates all sections again. Once it accesses the overlay data, a second\nPE header is revealed, which is the real malicious component (backdoor), waiting to be\ninstalled inside the victim’s systems.\n\nIt’s now possible to identify two specific components from the unpacked data – the dropper\nand the backdoor.\n\nThe suspected packer executes the dropper in-memory without storing it inside the\nfilesystem. This step confirms that the binary is a packer, because it has just demonstrated\nall the primary characteristics of packers.\n\nThe flow executed by the Packer includes decryption and decompression of the Dropper and\n\nBackdoor. (Click to enlarge)\n\n**GreyEnergy – A Stealthy Infection Requiring Proactive Defenses**\n\nOnce complete, my analysis showed that the GreyEnergy packer is robust and capable of\nsignificantly slowing down the reverse engineering process. The techniques used are not\nnew, but both the tools and the tactics employed were cleverly selected. The threat actors’\nbroad use of anti-forensic techniques underlines their attempt to be stealthy and ensure that\nthe infection would go unnoticed.\n\nI urge you to download my full Research Paper, containing all the details related to reverse\nengineering the packer, as well as my analysis of the malicious Word document and the\ndropper.\n\nBased on how well the malware disguises itself once it infects a system, the best way for\nindustrial organizations to protect themselves from the GreyEnergy APT is to train\nemployees on the dangers of email phishing campaigns, including how to recognize\nmalicious emails and attachments.\n\n\n-----\n\nIn addition, critical infrastructure networks should always be monitored with dedicated cyber\nsecurity systems to proactively detect threats present on the network.\n\n**Free Tools to Help the Security Community Defend Against GreyEnergy**\n\nAs a direct outcome of this analysis, I developed tools to help analysts dissect this piece of\nmalware. The **_[GreyEnergy Yara Module, is high-performing code for compiling with the](https://github.com/NozomiNetworks/greyenergy-unpacker)_**\nYara engine. It adds a new keyword that determines whether a file processed by Yara is the\nGreyEnergy packer or not.\n\n[This tool, combined with the previously published GreyEnergy Unpacker (a Python script](https://github.com/NozomiNetworks/greyenergy-unpacker)\nthat automatically unpacks both the dropper and the backdoor, extracting them onto a disk),\nsaves other security analysts the reverse engineering work explained in this paper.\n\nI hope that these tools, along with my findings, facilitate further GreyEnergy analysis and\nhelp the security community better defend critical infrastructure systems in the future.\n\n**Related Content to Download**\n\nRESEARCH PAPER\n\n**GreyEnergy: Dissecting the Malware from Maldoc to Backdoor**\n**_Comprehensive Reverse Engineering Analysis_**\n\n\n-----\n\n**Read this paper to learn:**\n\nThe high-level flow of the GreyEnergy phishing campaign\nHow the malware disguises itself and its functionality\nHow each stage of the malware works:\n\nStage 0 – Malicious Word Document\nStage 1 – Packer\nStage 2 – Dropper\nAbout two new tools for further GreyEnergy analysis\n\n[DOWNLOAD](http://info.nozominetworks.com/white-paper-greyenergy-lp-)\n\n\n-----\n\n[Alessandro Di Pinto](https://www.nozominetworks.com/author/alessandro-dipinto/)\n**Security Research Manager, Nozomi Networks**\n**[@adipinto](https://twitter.com/adipinto)**\n\nAlessandro Di Pinto is an Offensive Security Certified Professional (OSCP) with an extensive\nbackground in malware analysis, ICS/SCADA security, penetration testing and incident\nresponse. He holds GIAC Reverse Engineering Malware (GREM) and GIAC Cyber Threat\nIntelligence (GCTI) certifications. Alessandro co-authored the research paper “TRITON: The\nFirst ICS Cyber Attack on Safety Instrument Systems” and “Analyzing the GreyEnergy\nMalware: from Maldoc to Backdoor”.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-02-12 - GreyEnergy Malware Research Paper- Maldoc to Backdoor.pdf"
    ],
    "report_names": [
        "2019-02-12 - GreyEnergy Malware Research Paper- Maldoc to Backdoor.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4d9cdc7f-72d6-4e17-89d8-f6323bfcaebb",
            "created_at": "2023-01-06T13:46:38.82716Z",
            "updated_at": "2025-03-27T02:00:02.928984Z",
            "deleted_at": null,
            "main_name": "GreyEnergy",
            "aliases": [],
            "source_name": "MISPGALAXY:GreyEnergy",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535997,
    "ts_updated_at": 1743041398,
    "ts_creation_date": 1653759526,
    "ts_modification_date": 1653759526,
    "files": {
        "pdf": "https://archive.orkl.eu/db0be12b0d71dab187d5ae987324fc15fd33edfa.pdf",
        "text": "https://archive.orkl.eu/db0be12b0d71dab187d5ae987324fc15fd33edfa.txt",
        "img": "https://archive.orkl.eu/db0be12b0d71dab187d5ae987324fc15fd33edfa.jpg"
    }
}