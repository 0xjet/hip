{
    "id": "452373f7-ad72-4325-a99d-4d2a99e6c1d0",
    "created_at": "2023-01-12T15:02:56.655232Z",
    "updated_at": "2025-03-27T02:08:33.342069Z",
    "deleted_at": null,
    "sha1_hash": "38b585018b85ed120ebffce41ee81c80ea833e40",
    "title": "2022-08-21 - Behind the Attack- Remcos RAT",
    "authors": "",
    "file_creation_date": "2022-10-02T12:20:36Z",
    "file_modification_date": "2022-10-02T12:20:36Z",
    "file_size": 2123244,
    "plain_text": "# Behind the Attack: Remcos RAT\n\n**perception-point.io/behind-the-attack-remcos-rat/**\n\nAugust 21, 2022\n\nRemcos RAT is a [malware classified as a](https://perception-point.io/how-to-prevent-malware-attacks/) [Remote Access Trojan. This means that it is](https://www.techtarget.com/searchsecurity/definition/RAT-remote-access-Trojan)\nusually used by threat actors to control infected PCs remotely or spy on users by capturing\nkeystrokes, watching them through their webcam, or even listening to their microphone.\n\nThrough Remcos RAT, threat actors can remotely execute malicious tasks on a user’s\ncomputer and steal any sensitive data that is available to them.\n\nRead on to learn about Remcos RAT’s attack chain and the deeper implications of this\nmalware’s capabilities.\n\n## The Phishing Email\n\n[Like most attacks these days, Remcos RAT’s payload is delivered via email, the number one](https://perception-point.io/channel-coverage/email-security/)\nattack vector for cyberattacks.\n\nThe user receives an email, posing as an urgent invoice request. In the text of the message,\nthe sender urges the recipient to open the attached invoice, which is actually an embedded\nURL in a picture. Once the user clicks on the attachment, they are redirected to a OneDrive\nautomated download which triggers the initial payload.\n\n\n-----\n\nThere are several warning signs within the email to indicate that it may be malicious: 1) the\nsubject line is generic, 2) the sender originates from a Gmail address, indicating it is not\naffiliated with an official company, 3) the message itself is concise with the clear goal of\nprompting the reader to click on the attachments.\n\nFigure 1: The email with the fake invoice attachments, requesting an invoice (Slovenian).\n\n## The Remcos RAT Attack Flow\n\nNow, let’s review the components of the attack, breaking it down step by step. Below, you\ncan see a visual map of the steps involved in the attack:\n\n\n-----\n\nFigure 2: The attack flow\n\nStage 1: Once the user clicks on the OneDrive URL, an ace type archive is automatically\ndownloaded; inside of it we can find Faktura 9382022.vbs.\n\nStage 2: While Faktura 9382022.vbs is being executed, it downloads an additional payload\nlocated on one of the threat actor servers (GH2.jpg).\n\nStage 3: GH2.jpg (a JavaScript file) is then executed, containing inside of it and evoking an\n[embedded PowerShell script.](https://en.wikipedia.org/wiki/PowerShell)\n\nStage 4: The PowerShell script creates an alias for IEX (set to the char: “P”) and downloads\nan additional payload located on the same server from Stage 2 (GH1.jpg).\n\nStage 5: GH1.jpg (a PowerShell file) contains two embedded files: Sneaky.dll and archived\nRemcos. During the execution process of the script, the dll is invoked.\n\nStage 6: Next, Sneaky.dll loads the archived Remcos malware, unpacks it from the archive,\nand injects it into RegAsm.exe (a legitimate Microsoft .NET executable).\n\nStage 7: The injected Remcos RAT connects with the threat actor’s C2 server and waits for\nC&C instructions.\n\nKeep reading for a detailed analysis of the files and commands used throughout the attack.\n\n\n-----\n\n## Initial Access\n\nThe initial VBScript, “Faktura 9382022.vbs”, is heavily obfuscated, containing several\nreplacement functions and some “clean bytes” in order to pass static analysis engines (such\nas VirusTotal):\n\nFigure 3: Faktura 9382022.vbs\n\nAfter cleaning the script we can see that the script has two main functions. The first is\ncopying itself to the startup folder of the user’s computer (in order to maintain persistence):\n\nFigure 4: Function 1\n\nThe second thing that the script does is create a MSXML document. By using the load\nmethod within, the script executes an additional payload located on a remote server\n(hxxps[://]solutionias[.]com/bin/GH2[.]jpg):\n\n\n-----\n\nFigure 5: Function 2\n\n## Unwrapping the Obfuscations\n\nIf we manually navigate to the threat actor’s server, we can see that this is not a picture but\nrather an xsl file containing JavaScript script:\n\nFigure 6: JavaScript script\n\nWithin the script, you can see a large string passed to a certain function. When you look at\nthe string itself, you can see that the script has a [HEX-type string structure:](https://dencode.com/en/string/hex#:~:text=Hex%20string%20is%20the%20binary,Bin%20string)\n\nFigure 7: HEX string\n\n[We input this string to CyberChef and applied the “From HEX” recipe to give us a brand new](https://gchq.github.io/CyberChef/)\nobfuscated PowerShell command:\n\n\n-----\n\nFigure 8: The new PowerShell command\n\nWhen analyzing the PowerShell script further, the threat actor does something unique: he\ncreates a new alias for the IEX (Invoke-Expression) command. By doing this he can call the\nIEX command without writing down IEX, which can help the attack bypass static AV\ndetection:\n\nFigure 9: The new alias for the IEX command\n\nAs we’ve already seen, this PowerShell script also contains a variable with a binary-type\nstring. When you take this string to CyberChef and apply “From Binary” (delimiter: comma,\nByte Length: 8), the output gives us a new obfuscated PowerShell script:\n\n\n-----\n\nFigure 10: the new obfuscated PowerShell script\n\nOnce we cleaned up the script, we noticed three main things occurring:\n\nThe script sets up the security protocol to be TLS 1.2.\nIt alerts Google to ensure that the protocol configuration works.\nIt creates a WebClient object to download and invoke the additional payload located on\nthe same remote server as we previously observed\n(hxxps[://]solutionias[.]com/bin/GH1[.]jpg).\n\nFigure 11: The three actions\n\n## DLL Loading & Process Hollowing\n\nThe payload that was downloaded also has a jpg extension. By navigating back again to the\nthreat actor’s remote server, we can see that the threat actor uses the method of trying to\nhide the real file extension by changing it to a jpg:\n\nFigure 12: Hiding the file extension as a jpg\n\n\n-----\n\nThe downloaded script is actually another PowerShell script that contains two big variables –\n$MNB and $fbOd:\n\n$hoDNhAI – unpacks the $MNB variable using an embedded function (Sneaky.dll)\n$fbOd – Archived Remcos agent\n\nThere is also the $ayy variable which is responsible for loading the dll (stored on $hoDNhAI):\n\nFigure 13: $ayy variable\n\nWe can see in the figure above that when Sneaky.dll is loaded, the script invokes a method\ncalled: “Black”. This method is located under the “toooyou” class in the “Sneaky” namespace:\n\nFigure 14: “Sneaky” namespace\n\n[Since the dll is heavily obfuscated, we used De4Dot to deobfuscate it and make the dll a bit](https://github.com/de4dot/de4dot)\nmore readable. We can see that the method that was invoked receives two arguments:\n\n1. String tt\n2. Byte[] ukk\n\nThese arguments are passed in the PowerShell script; the string that is passed is\n“RegAsm.exe”; the byte array is the archived Remcos.\n\nFollowing the flow of the “Black” method, we can see that a new array object is declared,\ncontaining the string that was passed. The result of the method is “GLPFPGLLRRR”, which\nreceives the archived Remcos as argument):\n\n\n-----\n\nFigure 15: GLPFGLLRRRR\n\nThis function is responsible for unpacking the Remcos agent out of the gzip archive. After\nthat, the dll starts the hollowing process by spawning the legitimate RegAsm.exe process in\nsuspended mode and inject the unpacked Remcos agent:\n\nFigure 16: Unpacking the Remcos agent\n\nFigure 17: The hollowing process\n\nFinally, the RegAsm.exe process runs on the user’s system with the injected Remcos RAT\ninside of it. The RAT will begin to harvest information, creating mutex and persistence files.\n\n## Extracting Remcos Configurations\n\nOnce we unpacked the Remcos agent, we extracted the configurations set by the author\ncompletely statically by following the next steps:\n\n\n-----\n\nOpen up the Remcos agent in CFFExplorer.\nNavigate to Resource Editor -> RCData -> SETTINGS.\nThe first byte of the resource indicates the key length (the data is encrypted with RC4\nencryption and marked in blue in the picture below).\nWhat follows are the next key_length bytes, which is the actual RC4 key (marked in\norange).\nThe rest of the remaining bytes are the encrypted data (marked in red).\n\nFigure 18: Remcos configurations\n\nIf you enter the key and the data to CyberChef, you can easily decrypt the data and see the\nconfigurations of this Remcos agent (make sure to put key format to HEX and also to input\nformat to HEX):\n\n\n-----\n\nFigure 19: Decrypted Remcos configurations\n\nExtracted Configuration:\n\nHost:port:password – menz.ddns.net:9001:1\n\nAssigned name – AUG\n\nCopy file – vlc.exe\n\nCopy folder – vlc\n\nStartup value – Remcos\n\nMutex – Grace-JFMZCP\n\n## Recommendations\n\nRemcos RAT malware can cause major damage to an organization when deployed on a\n[device of a highly valued employee. It is usually delivered via phishing email, targeting the](https://perception-point.io/how-to-prevent-phishing-attacks/)\nspecific person (known as spear phishing or whale phishing). There isn’t much that the user\nhas to do in order to initiate the attack; it takes just one click – one human error – and this\nmassive attack chain can be easily executed.\n\nTo avoid becoming the next Remcos RAT victim, we recommend taking the following steps to\nmitigate your risk:\n\n\n-----\n\n1. Educate employees on the need for email security and the risk of opening suspicious\n\nemails and attachments.\n2. Run email security drills every few months to ensure that employees know what to look\n\nfor in a suspicious email.\n3. Create a process for employees to follow when they receive a suspicious email or link.\n4. Do not open files with strange links or attachments.\n5. Always double check the identity of the sender.\n6. Deploy an advanced email security solution that prevents these malicious emails from\n\nreaching users’ inboxes.\n\n[Interested in protecting your organization from malware? Learn more here.](https://perception-point.io/malware-detection/)\n\nIOCs\n\nDomains:\n\nsolutionias.com\n\nmenz.ddns.net\n\nURLs:\n\nhxxps[://]solutionias[.]com/bin/GH1[.]jpg\n\nhxxps[://]solutionias[.]com/bin/GH2[.]jpg\n\nSamples SHA-256:\n\nFaktura 9382022.vbs –\n0f1f455812da4f4169d34b3c953c28d9e64681a1968251799f625874f272928b\n\nGH2.jpg – 6f7d778233adbdebe66d157f655cb21d4bdf7aab69a9503d60e226231fcb28b1\n\nGH1.jpg – 01265bac08e6f515eb0f51f71ba02d1c529bc6728758a92c92b50fa25cb196f6\n\nSneaky.dll – 5a0698525d8be66696cc4a7be1a93efb16d8ef11c48bc7319c57435c4acfebc8\n\nPacked Remcos.zip –\n01b80319017fc7145f5bac41a773500720a8bd0380bc4821aabb0468f3daeea5\n\nUnpacked Remcos.exe –\n945b5bfb70e33c495f39f731fd7b9772eafd27d1d8512eb5f08872229074c47b\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-21 - Behind the Attack- Remcos RAT.pdf"
    ],
    "report_names": [
        "2022-08-21 - Behind the Attack- Remcos RAT.pdf"
    ],
    "threat_actors": [
        {
            "id": "5d2bd376-fcdc-4c6a-bc2c-17ebbb5b81a4",
            "created_at": "2022-10-25T16:07:23.667223Z",
            "updated_at": "2025-03-27T02:02:09.916086Z",
            "deleted_at": null,
            "main_name": "GCHQ",
            "aliases": [
                "Government Communications Headquarters",
                "Operation Socialist"
            ],
            "source_name": "ETDA:GCHQ",
            "tools": [
                "Prax",
                "Regin",
                "WarriorPride"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535776,
    "ts_updated_at": 1743041313,
    "ts_creation_date": 1664713236,
    "ts_modification_date": 1664713236,
    "files": {
        "pdf": "https://archive.orkl.eu/38b585018b85ed120ebffce41ee81c80ea833e40.pdf",
        "text": "https://archive.orkl.eu/38b585018b85ed120ebffce41ee81c80ea833e40.txt",
        "img": "https://archive.orkl.eu/38b585018b85ed120ebffce41ee81c80ea833e40.jpg"
    }
}