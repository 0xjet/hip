{
    "id": "149faf37-507e-45d7-a06b-3336d22cde6c",
    "created_at": "2023-01-12T15:04:39.23984Z",
    "updated_at": "2025-03-27T02:17:01.079362Z",
    "deleted_at": null,
    "sha1_hash": "6be938a17ffc04b412ca94eeaedd85c7d246b557",
    "title": "2022-09-08 - How Malicious Actors Abuse Native Linux Tools in Attacks",
    "authors": "",
    "file_creation_date": "2022-10-02T12:13:29Z",
    "file_modification_date": "2022-10-02T12:13:29Z",
    "file_size": 1449015,
    "plain_text": "# How Malicious Actors Abuse Native Linux Tools in Their Attacks\n\n**[trendmicro.com/en_us/research/22/i/how-malicious-actors-abuse-native-linux-tools-in-their-attacks.html](https://www.trendmicro.com/en_us/research/22/i/how-malicious-actors-abuse-native-linux-tools-in-their-attacks.html)**\n\nSeptember 8, 2022\n\nCloud\n\n## How Malicious Actors Abuse Native Linux Tools in Attacks\n\nThrough our honeypots and telemetry, we were able to observe instances in which malicious\nactors abused native Linux tools to launch attacks on Linux environments. In this blog entry,\nwe discuss how these utilities were used and provide recommendations on how to minimize\ntheir impact.\n\nBy: Nitesh Surana, David Fiser, Alfredo Oliveira\nSeptember 08, 2022\nRead time: ( words)\n\n## Introduction\n\n[Container adoption has become mainstream, with usage having risen across organizations](https://www.trendmicro.com/vinfo/us/security/definition/container#:~:text=A%20container%20is%20a%20unit,%2C%20infrastructure%2C%20or%20cloud%20environment.)\n[globally. Based on a survey from CNCF, 93% of respondents are currently using or planning](https://www.cncf.io/reports/cncf-annual-survey-2021/#:~:text=Container%20Adoption%20and%20Kubernetes%20have%20truly%20gone%20mainstream%20%E2%80%93%20usage%20has%20risen%20across%20organizations%20globally%2C%20particularly%20in%20large%20businesses.)\nto use containers in their production. Container orchestration projects like Kubernetes and\n\n\n-----\n\nother tools available in the cloud and across the internet has led to a wave of transformations\nin how organizations operate, from monolithic architectures to the creation of distributed\nsystems consisting of microservices.\n\nHowever, these changes have also resulted in the expansion of the attack surface,\nparticularly through security misconfigurations or vulnerabilities introduced in the\n[deployments. Cloud security is further complicated by the fact that patch management can](https://www.trendmicro.com/vinfo/us/security/news/virtualization-and-cloud/cloud-security-key-concepts-threats-and-solutions)\noften be an enormous undertaking for organizations, which means that updates are not\nalways implemented in a timely manner.\n\nWhen it comes to public-facing web applications, we have been observing critical\nvulnerabilities arising from a wide range of sources, ranging from vulnerable open-source\n[libraries (Log4Shell and](https://www.trendmicro.com/en_us/research/21/l/patch-now-apache-log4j-vulnerability-called-log4shell-being-acti.html) [Spring4Shell) to frameworks (Apache Struts and](https://www.trendmicro.com/en_no/research/22/d/cve-2022-22965-analyzing-the-exploitation-of-spring4shell-vulner.html) [Drupal), and even](https://www.trendmicro.com/en_us/devops/21/g/safeguarding-against-cryptomining-attacks.html)\n[applications such as Atlassian Confluence,](https://www.trendmicro.com/en_my/research/21/j/tracking-cve-2021-26084-and-other-server-vulnerability-exploits.html) [Oracle WebLogic Server, and](https://www.trendmicro.com/en_my/research/21/j/tracking-cve-2021-26084-and-other-server-vulnerability-exploits.html) Apache HTTP\nServer. Once proof-of-concepts (POCs) for vulnerabilities are disclosed, attackers can\nexploit them to perform malicious tasks from mining cryptocurrency to, at times, deploying\n[ransomware.](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/a-look-at-linux-threats-risks-and-recommendations#:~:text=the%20Linux%20ecosystem.-,Ransomware,-Ransomware%20needs%20no)\n\nFrom the perspective of a defender, the ideal outcome would be to prevent the attacker from\neven gaining an initial foothold. However, this isn’t what always the case. If an attacker does\nmanage to enter the system, it is the defender’s job to make it more difficult for attackers to\nsuccessfully pull off their routines by [using defense-in-depth strategies.](https://www.trendmicro.com/en_us/research/20/k/defense-in-depth-layered-security-in-the-cloud.html)\n\nThrough our network of honeypots and verbose telemetry, we were able to observe some\ninteresting characteristics for most of the successful exploit attempts, particularly, how\nattackers use native Linux tools in their routines.\n\n## Examining attacks using legitimate utilities and tools on Linux environments\n\nAn attack on a Linux-based system typically follows a standard exploitation chain. First, an\n[attacker exploits a vulnerability (or a chain of vulnerabilities) to gain initial access into the](https://attack.mitre.org/tactics/TA0001)\nenvironment (which we can now consider as compromised). From there, an attacker may\ntake different paths to move further inside the compromised environment:\n\n[1. Enumerating the context of the current environment (Discovery)](https://attack.mitre.org/tactics/TA0007)\n[2. Exfiltrating sensitive data from the environment (Exfiltration,](https://attack.mitre.org/tactics/TA0010) [Impact)](https://attack.mitre.org/tactics/TA0040)\n[3. Performing a denial-of-service attack by removing the application (Impact)](https://attack.mitre.org/tactics/TA0040)\n[4. Mining cryptocurrency by downloading miners (Impact)](https://attack.mitre.org/tactics/TA0040)\n[5. Attempting other techniques (Privilege Escalation,](https://attack.mitre.org/tactics/TA0004) [Lateral Movement,](https://attack.mitre.org/tactics/TA0008) [Persistence, or](https://attack.mitre.org/tactics/TA0003)\n\n[Credential Access)](https://attack.mitre.org/tactics/TA0006)\n\n\n-----\n\nFigure 1. How an attacker can pivot further within a compromised environment\nBased on real-world attacks and our honeypots, we observed that malicious actors use a\nvariety of enabled tools that come bundled with Linux distributions, such as curl, wget,\nchmod, chattr, ssh, base64, chroot, crontab, ps, and pkill, that are abused by attackers for\n\n\n-----\n\nnefarious purposes.\n\nWe have seen malicious actors abusing these tools in the wild. The presence of these\nutilities, especially inside container environments, should be at least considered, since they\nprovide additional avenues for attackers.\n\nLet’s examine some real-world attacks and instances of abuse that we observed via Trend\nMicro Cloud One™ and Vision One.\n\nFigure 2. Using base64 to decode the payload for later execution\nThe base64 tool is a Linux utility that decodes strings encoded in base64 format. Attackers\noften obfuscate their payloads and commands using base64 encoding to evade detection\n[(T1027), a technique we describe in detail in our previous article The Evolution of Malicious](https://attack.mitre.org/techniques/T1027/)\nShell Scripts.\n\n\n-----\n\nFigure 3. Using the “cat” process to view the .bash_history for all users\nThe .bash history file, which is stored in the user’s home directory, logs the commands\nexecuted by users on their bash shell. Attackers have been known to extract information\nfrom these files to understand the context of the current environment, as we previously\ndetailed in another article — Misconfigured Docker Daemon API Ports Attacked for Kinsing\nMalware Campaign.\n\nFigure 4. Using the “cat” process to view '/etc/passwd'\n\n\n-----\n\nAs a part of the enumeration step, the attacker accesses the /etc/passwd file, which contains\na list of the registered users within the environment and shows whether a given user has an\nassociated shell with their login. This information helps the attacker understand the\n[environment and pinpoint users of value. (T1003.008)](https://attack.mitre.org/techniques/T1003/008)\n\nFigure 5. Using “chattr”` to modify the /etc/crontab file to be mutable\nThe chattr utility is used to alter file and folder attributes to control sudden operations like the\ndeletion and modification of files. The example in Figure 4 shows that the attributes of the\n_/etc/crontab file has been altered, making the file unsecure. This utility has previously been_\nobserved to be abused by TeamTNT, as discussed in our white paper, Tracking the Activities\nof TeamTNT.\n\nFigure 6. Using “chmod” to make a file executable\n\n\n-----\n\nThe chmod tool is used to change the file mode and granularize access per user or group.\nIt’s required to execute newly downloaded executables, and, in this case, we see the agettyd\nfile at the path /tmp being set with the executable bit.\n\nFigure 7. Using “crontab” to remove all existing cron jobs\nA cron job is a utility used to schedule tasks (or jobs). Attackers have been known to abuse\ncron jobs and modify the ‘crontab’ to perform execution, persistence, and, at times, privilege\n[escalation techniques (T1053.003). The example in Figure 7 shows the removal of existing](https://attack.mitre.org/techniques/T1053/003/)\ncron jobs. This is a common occurrence where cryptocurrency miners compete against each\nother by removing traces of other miners to hijack the maximum amount of resources\npossible. Our blog entry, [War of Linux Cryptocurrency Miners: A Battle for Resources,](https://www.trendmicro.com/en_in/research/20/i/war-of-linux-cryptocurrency-miners-a-battle-for-resources.html)\ndiscusses these activities in-depth.\n\n\n-----\n\nFigure 8. Using “curl” to exfiltrate system information to the attacker\nThe curl, or cURL, utility is used to transfer data across different protocols, such as HTTP,\nHTTPS, and File Transfer Protocol (FTP). The example in Figure 8 shows that system\ninformation such as the OS version and release version is sent as a POST request to the\nattacker’s infrastructure.\n\nFigure 9. Using “curl” to download xmrig binaries from GitHub\n\n\n-----\n\nIn this case, curl is used to download binaries of the XMRig miner from Github. Attackers\nhave been known to abuse legitimate platforms like Github and Netlify to serve crypto-mining\ntools, as we explain in our previous blog: Vulnerabilities Exploited for Monero Mining\nMalware Delivered via GitHub, Netlify.\n\nFigure 10. Using “pkill” to kill competing processes/coinminers\nThe kill suite utility is used to send signals to processes and, as illustrated in the example in\nFigure 10, it sends the SIGKILL signal to the process named “kdevtmpfsi”. We have been\nobserving cryptocurrency miners named kdevtmpfsi as early as 2020. Our blog entry,\n[Analysis of Kinsing Malware's Use of Rootkit, shows another example of a competing miner](https://www.trendmicro.com/en_in/research/20/k/analysis-of-kinsing-malwares-use-of-rootkit.html)\nbeing terminated.\n\n\n-----\n\nFigure 11. Using “ps” to view running processes\nThe ps utility is used to view the status of a process. Figure 11 shows the ps aux command\nfetching verbose information about the processes, such as currently running processes,\nprocess IDs, and process privileges, on the system. This information can aid attackers in\n[performing discovery-related techniques (T1057 – Process Discovery) and gaining](https://attack.mitre.org/techniques/T1057/)\ninformation about the environment they’re in.\n\n\n-----\n\nFigure\n\n12. Using “rm” to remove hidden files from /tmp directory\nIn Figure 11, we see the rm tool being used to delete the hidden files and folders under the\n_/tmp directory. Attackers can create hidden directories to evade detection by adding “.”_\n[before the file or folder name (Hide Artifacts: Hidden Files and Directories - T1564.001).](https://attack.mitre.org/techniques/T1564/001/)\n\nFigure 13. Using\n\n“ssh” to infect underlying host with XMR miners\n\n\n-----\n\nThe ssh utility is the remote client used for accessing systems over Secure Shell (SSH) in a\nworm-like fashion. In Figure 13, the attacker tries to download the Monero miner (using\nwget/curl) and infect the remote machine in which the SSH is being attempted (127.0.0.1).\nOnce attackers mount the underlying host’s file system due to unsecure configuration (for\nexample, privileged containers) of containers, they create new pairs of SSH keys, use it to\n[establish an “ssh” session, and infect the underlying host with cryptocurrency miners.](https://www.trendmicro.com/en_in/research/19/l/why-running-a-privileged-container-in-docker-is-a-bad-idea.html)\n\nFigure 14. Using “wget”, “curl”, “chmod” to download and execute Mirai malware\nIn this example, we see the combined use of different Linux utilities wherein the binary is\ndownloaded, permissions are modified, and then later executed. The executable named\n“runnable” is a Mirai sample delivered after the exploitation of the Log4shell vulnerability\n[tracked under CVE-2021-44228.](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2021-44228)\n\n\n-----\n\nFigure 15. Using\n\n“whoami” to view current user context\n\nFigure 16. Workbench showing an attacker using “chroot” and “base64”\nUsing the Vision One workbench, we see the chroot and base64 utilities being used by an\nattacker. Note that chroot is used to change the root to the directory supplied (in this case,\n_/host), where the underlying host’s file system is mounted within the container. We explore_\nthe weakness posed by this function when granted to a container in our article, Why A\nPrivileged Container in Docker is a Bad Idea,\n\n## Best practices for protecting Linux systems from utility abuse\n\n Using distroless images\n\n\n-----\n\nBy observing the techniques discussed in the previous section, we see that the attackers can\nuse a set of tools that come bundled with a full-scale operating system. As defenders, it\nwould be safer to have container images that contain only the tools we require, and remove\nthe tools that aren’t needed.\n\nThis approach to security can help mitigate risk to a great extent, even against critical\nvulnerabilities such as Log4Shell. Reducing the number of tools needed for applications to\nrun also reduces the attack surface introduced by the dependency vulnerabilities in opensource libraries and tools. Here enters the concept of distroless images, which are described\nas images that contain only the application and its runtime dependencies, doing away with\nthe programs you would expect to find in a typical Linux distribution such as package\nmanagers and shells.\n\n## Cloud One Workload Security – Application Control\n\nFrom a defender's perspective, the focus should be on disabling, or rather, disarming the\nattacker via [defense-in-depth strategies. While making changes to the system to minimize or](https://www.trendmicro.com/en_us/research/20/k/defense-in-depth-layered-security-in-the-cloud.html)\neven prevent abuse would help, a multilayered approach that leverages multiple security\nmeasures would provide the strongest level of security, ideally by combining best practices\nwith effective defense technologies.\n\nFor non-containerized environments, Cloud One Workload Security provides the Application\nControl module, which monitors software changes and allows or blocks them based on the\nset configuration. It creates a baseline of the existing applications and applies the rules to the\nnew applications that are downloaded and installed. It works based on the SHA256 hash for\na binary.\n\nIt provides options for users to do the following:\n\n1. Block unrecognized software until explicitly allowed\n2. Allow unrecognized software until explicitly blocked\n\nWe download a pre-compiled binary of the nmap network enumeration tool from GitHub\nusing wget on an Ubuntu 20.04 long-term support (LTS ) server. The server was then\nconfigured with the Cloud One Workload Security agent running with the Application Control\nmodule set to ‘Block’ mode for unrecognized software. As shown in the Figure 17, the\nexecution was prevented by Application Control.\n\n\n-----\n\nFigure 17. Prevention the execution of the “nmap” binary using the Application Control\nmodule from Cloud One Workload Security\n\nFigure 18. The corresponding event on\n\nCloud One Workload Security, where we see that the “nmap” binary was blocked from being\nexecuted\n\n## Conclusion\n\nWith attackers making use of legitimate tools and utilities that are built into the operating\nsystem, defenders will need to prioritize how they can set up controls during the different\nphases of an attack. Minimizing the attack surface by using distroless images in containers\nand applying preventive controls like Cloud One Workload Security’s Application Control go a\nlong way in slowing down attackers targeting cloud environments. In cases where\norganizations cannot go with a distroless implementation, “slimmed-down” versions of the\nsame images can also be used to reduce the attack surface and strengthen the security of\ncloud deployments.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-09-08 - How Malicious Actors Abuse Native Linux Tools in Attacks.pdf"
    ],
    "report_names": [
        "2022-09-08 - How Malicious Actors Abuse Native Linux Tools in Attacks.pdf"
    ],
    "threat_actors": [
        {
            "id": "eb3f4e4d-2573-494d-9739-1be5141cf7b2",
            "created_at": "2022-10-25T16:07:24.471018Z",
            "updated_at": "2025-03-27T02:02:10.24394Z",
            "deleted_at": null,
            "main_name": "Cron",
            "aliases": [],
            "source_name": "ETDA:Cron",
            "tools": [
                "Catelites",
                "Catelites Bot",
                "CronBot",
                "TinyZBot"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f809bfcb-b200-4988-80a8-be78ef6a52ef",
            "created_at": "2023-01-06T13:46:39.186988Z",
            "updated_at": "2025-03-27T02:00:03.016358Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "Adept Libra"
            ],
            "source_name": "MISPGALAXY:TeamTNT",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c3ca592f-0669-49bd-ab5c-310007ab2fb4",
            "created_at": "2022-10-25T15:50:23.334495Z",
            "updated_at": "2025-03-27T02:00:55.445098Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "TeamTNT"
            ],
            "source_name": "MITRE:TeamTNT",
            "tools": [
                "Peirates",
                "MimiPenguin",
                "LaZagne",
                "Hildegard"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "a6c351ea-01f1-4c9b-af75-cfbb3b269ed3",
            "created_at": "2023-01-06T13:46:39.390649Z",
            "updated_at": "2025-03-27T02:00:03.072899Z",
            "deleted_at": null,
            "main_name": "Kinsing",
            "aliases": [
                "Money Libra"
            ],
            "source_name": "MISPGALAXY:Kinsing",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535879,
    "ts_updated_at": 1743041821,
    "ts_creation_date": 1664712809,
    "ts_modification_date": 1664712809,
    "files": {
        "pdf": "https://archive.orkl.eu/6be938a17ffc04b412ca94eeaedd85c7d246b557.pdf",
        "text": "https://archive.orkl.eu/6be938a17ffc04b412ca94eeaedd85c7d246b557.txt",
        "img": "https://archive.orkl.eu/6be938a17ffc04b412ca94eeaedd85c7d246b557.jpg"
    }
}