{
    "id": "62776393-2507-4fa7-ab33-4be619442adb",
    "created_at": "2023-01-12T15:02:48.085568Z",
    "updated_at": "2025-03-27T02:16:25.93588Z",
    "deleted_at": null,
    "sha1_hash": "d89301418f7e148d73ca8f7ccd20cf40f2e9a218",
    "title": "2019-10-21 - New Variant of Remcos RAT Observed In the Wild",
    "authors": "",
    "file_creation_date": "2022-05-29T10:46:10Z",
    "file_modification_date": "2022-05-29T10:46:10Z",
    "file_size": 184978,
    "plain_text": "# New Variant of Remcos RAT Observed In the Wild\n\n**[fortinet.com/blog/threat-research/new-variant-of-remcos-rat-observed-in-the-wild.html](https://www.fortinet.com/blog/threat-research/new-variant-of-remcos-rat-observed-in-the-wild.html)**\n\n_FortiGuard Labs Breaking Threat Analysis_\n\n\nOctober 21, 2019\n\n\nRecently, our LoneWolf Spampot Monitoring Systemcaptured several new spam samples.\nAfter a quick analysis, we identified it is a Remcos RAT campaign. The analysis in this blog\nfocuses on the latest phishing email received by our system. However, we will include all\nIoCs related to this campaign at the end of this post.\n\nRemcos RAT is a lightweight, fast and highly customizable Remote Administration Tool with\na wide array of functionalities. In past years, it had been observed to act as an information\ncollector, [keylogger on a victim’s device. Back to May 2018, we analyzed a variant of it, click](https://www.fortinet.com/resources/cyberglossary/what-is-keyloggers.html%20?utm_source=blog&utm_campaign=keylogger)\nhere for more details.\n\nFrom an online search, we can see that Remcos is being sold on a website. Figure 1 is a\nscreenshot of that page.\n\nFigure 1. REMCOS online order page\n\nIn this analysis, we would like to take you to an infected victim’s device, where Remcos was\ndownloaded, installed and executed, to see what this variant does.\n\n**Phishing Spam Sample Overview**\n\nThe originating message spoofs the email address to appear coming from a valid domain.\nThe attacker also performs a Social-Engineering attempt in the shape of a payment advisory\nemail to persuade users to open the attached ZIP file with the included password.\n\nFigure 2. Spam sample\n\n\n-----\n\nThe attached file is, in reality, a Windows Shortcut (.LNK). The malware author provided the\n“.TXT” extension as an attempt to obscure the real file extension once the file is extracted\nand viewed in the user’s folder.\n\nFigure 3. ZIP file asking for a password\n\nWhen the user provides the given password and executes the attached file, it fetches a\nPowerShell script from an Internet address and executes it.\n\n**1 Stage Launcher & Downloader (payment-advice.txt.lnk)st**\n\nOnce the “payment-advice.txt.lnk” is executed by the victim user, it invokes the PowerShell\ninterpreter (powershell.exe) with parameters that temporarily bypass the current PowerShell\nexecution policy and then hides its window to ensure proper execution and hide its presence.\nThe following picture shows the command argument passed to the PowerShell interpreter.\n\n**2nd Stage – Dropper (achremittance.ps1)**\n\nThe downloaded PowerShell script “achremittance.ps1” is composed of six functions. The\nfollowing table contains each function name along with its purpose.\n\nOnce the PowerShell script gets to execute, it performs the following actions (in sequential\norder):\n\n1.   Stores the string “.exe” in a variable encoded in base64, which is eventually decoded\nand stored in a variable\n\n2.   Generates the absolute path to the newly generated executable (C:\\Users\\Public\\\n<random_name>.exe) by concatenating the previously received parameter (“.exe” file\nextension), the system’s public (%PUBLIC%) folder and a random string generated for the\nfile name.\n\n3.   Decodes a base64 encoded executable file stored in a variable and then writes all bytes\ninto the executable file\n\n4.   Performs a file extension check (either .exe OR .dll). This script targets the “.exe” file\nextension.\n\n5.   Starts the dropped file by calling the “Start-Process” PowerShell cmdlet\n\nFigure 4. Base64 encoded Executable file\n\n**Executing the Dropped Remcos**\n\nOnce the dropped EXE file executes, it first sleeps for a while (20 seconds) to confront\nsandboxing. Next, it relocates the EXE file to the %LocalAppdata% folder and renames it as\n“sysclient exe” at the first run It finally starts “sysclient exe” after exiting the process\n\n\n-----\n\nThe sysclient.exe starts a child process of itself with suspended state and then overwrites\nits code with extracted malicious code from the parent process. Finally, the malicious code\nexecutes in the child process, which is called process hollowing.\n\nThe figure below shows the process tree when first running the dropped Remcos, where the\ndropped EXE file is “etyq.exe”.\n\nFigure 5. Process tree when first running the dropped Remcos\n\nThe “sysclient.exe” file was written in .NET Framework language, and the code was fully\nobfuscated, which creates a big challenge for analysts. It adds itself into the Auto-Start group\nof the system registry. In this way, Remcos can start automatically when the victim’s device\nrestarts.\n\nFigure 6 is a screenshot of when Remcos calls the function to write into the system registry.\n\nFigure 6. Addition into Auto-Start group of system registry\n\n**Analysis of the Child Process**\n\nAccording to our analysis, the version of this variant is “2.5.0 Pro”, which is hardcoded in the\nmalicious code, which just came out on September 20, 2019.\n\nLike other previous versions, Remcos contains an encrypted resource named “SETTINGS”.\nAfter decrypting it, the data looks like Figure 7. It is an array where each item is split by\nhexadecimal “1E” that is highlighted with a red underscore.\n\nFigure 7. Decrypted resource “SETTINGS”\n\nThis is the entire configuration data for Remcos. It contains many value fields, for example:\nC&C server host, license number, encryption seed for encrypting data, many RAT features’\ndefault switch (“0” disable, “1” enable), and its home key name in system registry and so on.\n\nEach value of the array could be fetched by calling a function with an index whenever it’s\nneeded.\n\nRemcos starts a keylogger by starting three threads. The log data is saved in a local file at\n“%Appdata%\\remcos\\logs.dat”. In previous version, the logs.dat file was encrypted.\nHowever, in this version, the logs.dat is not encrypted. The records are similar as the\nprevious version, which is shown in Figure 8. When we opened Chrome, then entered a\nwebsite and tested credential, you can see it recorded everything in Figure 8.\n\nFigure 8. Example Keylogger logs.dat file content\n\n**Communicating with the C&C Server**\n\n\n-----\n\nThe communication between Remcos and its C&C server is encrypted. Remcos uses RC4 to\nencrypt and decrypt traffic, as mentioned above that there is an encryption seed in the\n“SETTINGS” that is “Alibaba123” for this version, with which it can generate RC4 Key for\ntraffic encryption and decryption.\n\nIt obtains the C&C server host from the decrypted “SETTINGS” array, whose index is 0. In\nFigure 7, you can see the host is “Sub[.]winkcaffe[.]waw[.]pl:10005”. Remcos puts all\ncollected information from the victim’s device together in a buffer, which then gets encrypted\nand sent to the C&C server.\n\nFigure 9. All collected data from victim’s device\n\nFigure 9 is a screenshot taken when the buffer is about to be passed to the encryption\nfunction.\n\nThe entire data in the buffer is an array; each item is split by string “|cmd|”. This is the first\npacket sent to the C&C server, the buffer starts at memory address 0x1845959 and the\nbuffer size is 0x253. The four-bytes at offset 0x0F is “4B 00 00 00” (0x4B for short), which is\na control command number. In this packet, Remcos collected important information from the\nvictim’s device, such as victim’s user name, location, Windows version, physical memory\ncapacity, Remcos home name and version, keylogger log file full path, victim’s device\nrunning time, Remcos’s path, CPU information and so on.\n\nThe C&C server replied to this packet with the command control number “01 00 00 00” or\n0x01 for short, which asks the client to collect the victim's topmost program title information\nand send back to the server.\n\nThe decrypted response packet is shown below:\n\nThe data structure is same as the one shown in Figure 9.\n\n**Control Commands that Remcos Supports**\n\nBesides the control command number 0x01 we detailed in the last section, Remcos supports\nmany control commands to ask Remcos to perform various tasks on victim’s device.\nBecause the attacker does not enable all the commands at server side, we find most of\nthese command sub procedures in a control-command-handler function, which is a very\nlarge function. We manually and statically analyzed this function.\n\nIn this section, we show most of the control command numbers in a table as well as the\nfeatures provided by them.\n\n\n**Cmd**\n**Number**\n**(hex)**\n\n\n**Description**\n\n\n-----\n\n01 Obtain victim's topmost program title. GetForegroundWindow(),\nGetWindowTextW(), GetTickCount()\n\n03 Collect all installed software information, including \"Publisher\",\n\"DisplayVersion\", \"InstallLocation\", \"InstallDate\", \"UninstallString\".\n\n04 Download an executable file from given URL and run. URLDownloadToFileW(),\nShellExecuteW()\n\n05 Save data from packet into a local file and execute. WriteFile(),\nShellExecuteW()\n\n06 Collect all running processes information from infected device.\nCreateToolhelp32Snapshot(), GetModuleFileNameExW()\n\n07 Kill a running process by given PID. TerminateProcess()\n\n08 Enum all window and obtain titles. GetWindowTextW()\n\n09 Close a window by given window handle. CloseWindow()\n\n\n0A, 0B,\nAD\n\n\nShow/hide a window by given window handle. ShowWindow()\n\n\n0C Obtain PID by given window handle. GetWindowThreadProcessId()\n\n0D Executes a given commandline command. _wsystem()\n\n10 Could be handling jpeg stream and communicate with C&C server.\nSHCreateMemStream(), GdipSaveImageToStream()\n\n11 Close socket used in command number 10. closesocket()\n\n12 Collect the keyboard information. GetKeyboardLayoutName()\n\n13 Start Online Keylogger.\n\n14 Stop Online Keylogger.\n\n\n-----\n\n15, 16 Read local file by given file path and send to C&C server. (for example the\nkeylogger logs.dat file)\n\n17 Delete a given file or directory. DeleteFileW(), RemoveDirectoryW()\n\n18 Every five seconds, clear browser history like IE, Firefox, Chrome. To force\nvictim enter when using browser, so that keylogger can record.\n\n1B Communicate with given C&C server to control victim's camera working.\n\n1C Close victime's camera. CloseCamera()\n\n1D Record victim's voice from audio input and send to C&C server. waveInOpen(),\nwaveInStart()\n\n1E Stop recording victim's voice. waveInStop()\n\n20 Delete a given file. DeleteFileW()\n\n21 Exit Remcos process. exit()\n\n22 Uninstall Remcos. It removes all Remcos files registry keys that Remcos\ncreated.\n\n23 Execute a vbs script \"restart.vbs\" to restart Remcos. ShellExecuteW()\n\n24, 25 Update Remcos. It downloads a file from given URL and exeutes it in a vbs\nscript update.vbs. URLDownloadToFileW(), ShellExecuteW()\n\n26 Show victim a warning message. MessageBoxW()\n\n27 Log off the interactive user, shut down the system, or restarts the victim's\nsystem. ExitWindowsEx()\n\n28 Obtain victim's system clipboard data. GetClipboardData()\n\n29, 2A Empty victim's system clipboard. EmptyClipboard()\n\n\n-----\n\n2B Create a share memory in Remcos address space and put data on it.\nCreateFileMappingA(), MapViewOfFileEx()\n\n2C Download data from a given URL and create a share memory in Remcos\naddress space and put the download data on it. InternetReadFile(),\nCreateFileMappingA(), MapViewOfFileEx()\n\n30 Connect to a given server and communicate with it. DisplayMessage(),\nGetMessage(), CloseChat()\n\n31 Save a name value under its home key (\"HKCU\\Software\\Remcos-CN7LIG\\\") in\nthe system registry.\n\n34 Perform service control (change service config, pause, stop, start) to specified\nservice, and tell status to C&C server. ChangeServiceConfigW(),\nControlService(), StartServiceW()\n\n8F Enumerate given directory file and send file names to C&C server.\n\n92 Ues given file to set victim's desktop wallpaper style.\n\n94 Modify window text by given window handle. SetWindowTextW()\n\n95 Obtain real-time physical memory status, and report to C&C server.\nGlobalMemoryStatusEx()\n\n98 Upload/download file to/from specified C&C server.\n\n9E, A2 Play an alarm sound at victim's device.\n\nA3 Control victim's device to play, stop audio.\n\nAB Elevate privilege is victim's logon user is not an administrator and tell C&C\nserver of the result.\n\nAC Could show a pop menu to victim. TrackPopupMenu(),Shell_NotifyIconA()\n\n\n-----\n\nRemcos supports starting a daemon program to protect itself from being killed. In previous\nversion, it started a “svchost.exe” to do so. However, the attacker of this campaign did not\nenable the daemon program whose flag is set as “0” the in “SETTINGS” configuration.\n\n**Solution**\n\nThe original downloading URL in the link file is rated as “Malicious Websites“ by the\nFortiGuard Web Filtering service.\n\nThe Shortcut (.lnk) file, downloaded PowerShell file and extracted exe file are all detected\nand blocked by the FortiGuard Antivirus service.\n\n**IOCs:**\n\n**URLs**\n\n[C&C server]\n\nSub[.]winkcaffe[.]waw[.]pl:10005\n\nTop[.]subaroone[.]waw[.]pl:5050\n\n[URL of the PowerShell file]\n\nhxxp[:]//globalpaymentportal[.]co/Admin/Logs/achremittance.ps1\n\nhxxp[:]//transactionportal[.]co/Admin/Logs/transmission.ps1\n\n**Sample SHA-256**\n\n[Shortcut .lnk file]\n\n914F19697F03015BB10AB5FBF96A8BC49F2F8D3C036235233B7CBB0F0E7A902C\n\n0F47E91D77397032192F04FA35980793E400B3589BFAC2919ACC411340B903DE\n\nDA2304FA78FAC37F2F093699BE418553A294FA9F394C1730482B3DDE66DE4CD5\n\n3D03E32E7459ECFC94CA170CC07C54A87C75BACBCD92E5FA15657C46D474B59D\n\n5626AC76C089BA66CC6B6294289A2BD04584F94F35D45198AA65F90E5F6E3EBB\n\n[Downloaded PowerShell file]\n\n55F4B78339A5172A24CA68FFB1D27EE1A791A6AA3821D6D5481B4B02BAED9B48\n\nDF5DA147BCE2A9EDC6226E2EC6F4151AE1CF18C08EDF2C1568FBDD3099CE074A\n\n\n-----\n\n[Extracted/Dropped EXE file]\n\n55F4B78339A5172A24CA68FFB1D27EE1A791A6AA3821D6D5481B4B02BAED9B48\n\n29FD2DD80F63AA43B34CD7EA2F7AEB9EA5259775233F29CB2205E0279495602D\n\n_[Learn more about FortiGuard Labs and the FortiGuard Security Services portfolio.](https://www.fortinet.com/fortiguard/threat-intelligence/threat-research.html?utm_source=nreleaseblog&utm_campaign=2018-q2-fortiguardlabs-cta)_\n\n_[Read about the FortiGuard Security Rating Service, which provides security audits and best](https://www.fortinet.com/support-and-training/support-services/fortiguard-security-subscriptions/security-rating.html?utm_source=blog&utm_campaign=2018-blog-security-rating-service)_\n_practices._\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-10-21 - New Variant of Remcos RAT Observed In the Wild.pdf"
    ],
    "report_names": [
        "2019-10-21 - New Variant of Remcos RAT Observed In the Wild.pdf"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535768,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653821170,
    "ts_modification_date": 1653821170,
    "files": {
        "pdf": "https://archive.orkl.eu/d89301418f7e148d73ca8f7ccd20cf40f2e9a218.pdf",
        "text": "https://archive.orkl.eu/d89301418f7e148d73ca8f7ccd20cf40f2e9a218.txt",
        "img": "https://archive.orkl.eu/d89301418f7e148d73ca8f7ccd20cf40f2e9a218.jpg"
    }
}