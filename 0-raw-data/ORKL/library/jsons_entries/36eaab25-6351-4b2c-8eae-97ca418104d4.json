{
    "id": "36eaab25-6351-4b2c-8eae-97ca418104d4",
    "created_at": "2023-01-12T15:01:14.903933Z",
    "updated_at": "2025-03-27T02:17:05.548607Z",
    "deleted_at": null,
    "sha1_hash": "abd18754ed0d38c359d340d503c1154716bb048b",
    "title": "2022-08-11 - CopperStealer Distributes Malicious Chromium-based Browser Extension to Steal Cryptocurrencies",
    "authors": "",
    "file_creation_date": "2022-08-18T04:01:57Z",
    "file_modification_date": "2022-08-18T04:01:57Z",
    "file_size": 344215,
    "plain_text": "# CopperStealer Distributes Malicious Chromium-based Browser Extension to Steal Cryptocurrencies\n\n**trendmicro.com/en_us/research/22/h/copperstealer-distributes-malicious-chromium-browser-extension-steal-**\ncryptocurrencies.html\n\nAugust 11, 2022\n\nMalware\n\nWe tracked the latest deployment of the group behind CopperStealer, this time stealing\ncryptocurrencies and users’ wallet account information via a malicious Chromium-based\nbrowser extension.\n\nBy: Jaromir Horejsi, Joseph C Chen\nAugust 11, 2022\nRead time: ( words)\n\nWe published our analyses on CopperStealer distributing malware by abusing various\n[components such as browser stealer,](https://www.trendmicro.com/en_us/research/22/f/websites-hosting-fake-cracks-spread-updated-copperstealer.html) [adware browser extension, or remote desktop.](https://www.trendmicro.com/en_us/research/21/c/websites-hosting-cracks-spread-malware-adware.html)\nTracking the cybercriminal group’s latest activities, we found a malicious browser extension\ncapable of creating and stealing API keys from infected machines when the victim is logged\nin to a major cryptocurrency exchange website. These API keys allow the extension to\nperform transactions and send cryptocurrencies from victims’ wallets to the attackers’\nwallets.\n\nSimilar to previous routines, this new component is spread via fake crack (also known as\nwarez) websites. The component is usually distributed in one dropper together with a\nbrowser stealer and bundled with other unrelated pieces of malware. This bundle is\ncompressed into a password-protected archive and has been distributed in the wild since\nJuly.\n\nDropper/Extension installer\n\n[This component uses the same cryptor described in previous posts in the first stage,](https://www.trendmicro.com/en_us/research/22/f/websites-hosting-fake-cracks-spread-updated-copperstealer.html)\nfollowed by the second stage wherein the decrypted DLL is Ultimate Packer Executables(UPX) packed. After decrypting and unpacking, we noticed a resource directory named CRX\ncontaining a 7-Zip archive. Malicious Chrome browser extensions are usually packaged this\nway.\n\nFigure\n\n1. Extension installer called CRX containing a 7-Zip archive\n\n\n-----\n\nThe archive contains a JSON file with settings and another 7-Zip archive with the code of the\nextension installer itself.\n\nFigure 2. Unpacked content of CRX\n\nThe extension installer first modifies the files Preferences and Secure Preferences in the\nChromium-based browser‘s User Data directory. The file, named Preferences, is in JSON\nformat and contains individual user settings. The extension installer switches off browser\nnotifications.\n\nMeanwhile, the file named Secure Preferences is also in JSON format and contains the\ninstalled extension’s settings. For a newly installed extension, the content of crx.json file is\ninserted into this Secure Preferences settings file. A newly installed extension is also added\nto the extension installation allow list located in the registry.\n\nThe files from the crx.7z archive are then extracted into the extension’s directory located in\n<User Data\\Default\\Extension>. Finally, the browser restarts so the newly installed extension\nbecomes active. We analyzed that the targeted browsers are Chromium-based and include:\n\nChrome\nChromium\nEdge\nBrave\nOpera\nCốc Cốc\nCentBrowser\nIridium\nVivaldi\nEpic\nCoowon\nAvast Secure Browser\nOrbitum\nComodo Dragon\n\nWe also noted that the extension was installed to the victims’ browsers with two different\nextension IDs, and neither can be found on the official Chrome Web Store:\n\ncbnmkphohlaaeiknkhpacmmnlljnaedp\njikoemlnjnpmecljncdgigogcnhlbfkc\n\nAnalysis of the extension\n\nAfter the extension’s installation, we also noticed the following newly installed extension in\n_chrome://extensions/._\n\n\n-----\n\nFigure 3. Installed malicious\n\nextension\nThe extension manifest defines two Java Scripts. The background script is named\n_background.js and runs inside the extension itself in only one instance. Meanwhile, the_\ncontent script is called content.js and runs in the context of coinbase.com, as shown in\nsnippet from the extension manifest.\n\nFigure 4. Settings of the\n\ncontent script as specified in the extension manifest\n**Script obfuscation**\n\nBoth Javascript files are heavily obfuscated. In the first obfuscation step, all strings are split\ninto substrings, stored in a single array, and access to the array is achieved by calling\nmultiple hexadecimal-named functions with five hexadecimal integer parameters.\n\nFigure 5. The first layer of\nobfuscation\nLooking at the second obfuscation step, all the strings, logic operators (+, -, *, /), function\ncalls, among others are inserted into an array of objects. Each object has a random string as\na name, and either another string or function as a value. In the example we analyzed,\n__0x1f27e3['PFPYr'] corresponds to string “set”, and _0x1f27e3['LYLfc'](0,1) corresponds to_\nthe logic expression 0!=1.\n\nFigure 6. The second\n\nlayer of obfuscation\nBoth obfuscation steps can be deobfuscated by using custom automation scripts.\n\n**Background script analysis**\n\n\n-----\n\nAnalyzing the scripts, this section breaks down how the cybercriminals are able to steal the\naccount information of legitimate cryptocurrency wallet users. When the extension starts, the\nbackground script makes two queries. The first one is a GET request to http://<C&C\n_server>/traffic/chrome, likely for statistical purposes. The second query is a POST request to_\n_http:// <C&C server>/traffic/domain, wherein the data contains the domains of_\ncryptocurrency-related websites based on the cookies found in the machine:\n\nblockchain.com\ncoinbase.com\nbinance.com\nftx.com\nokex.com\nhuobi.com\nkraken.com\npoloniex.com\ncrypto.com\nbithumb.com\nbitfinex.com\nkucoin.com\ngate.io\ntokocrypto.com\ntabtrader.com\nmexc.com\nlbank.info\nhotbit.io\nbit2me.com\netoro.com\nnicehash.com\nprobit.com\n\nThen the extension defines an array of the threat actor’s addresses for various\ncryptocurrencies and tokens for:\n\nTether (USDT, specifically in Ethereum ERC20 and TRON TRC20)\nEthereum (ETH)\nBitcoin (BTC)\nLitecoin (LTC)\nBinance coin (BNB)\nRipple (XRP)\nSolana (SOL)\nBitcoin Cash (BCH)\nZcash (ZEC)\nStellar Lumens (XLM)\n\n\n-----\n\nDogecoin (DOGE)\nTezos (XTZ)\nAlgorand (ALGO)\nDash (DASH)\nCosmos (ATOM)\n\nFor ETH addresses, the script hardcodes about 170 additional ERC20-based tokens.\n[Afterward, the extension starts onMessage listener to listen for messages sent from either an](https://developer.chrome.com/docs/extensions/reference/runtime/#event-onMessage)\nextension process or a content script. The message is in JSON format, with one of the\nname-value pair called method. The background script listens for the following methods:\n\nMethod “homeStart”\n\nThis method tries to obtain the API key (apiKey) and API secret (apiSecret) from Chrome’s\n[local storage if these key-secret pairs were previously obtained and saved. These](https://developer.chrome.com/docs/extensions/reference/storage/)\nparameters are needed for the following steps:\n\nUses the API to get information about wallets, addresses, and balances by requesting\n_/api/v2/accounts. The result of this request is also exfiltrated to http://<C&C_\n_server>/traffic/step._\nIf the request is successful, the API sends “okApi” message to content script and starts\nparsing for wallet information. If the wallet balance is non-zero, it attempts to send 85%\nof the available funds to the attacker-controlled wallet.\n\nFigure\n\n7. Looking for wallets with non-zero balance\n\nFigure 8. Stealing 85% of\n\navailable funds\nThe result of the transaction request is also exfiltrated to http://<C&C server>/traffic/step.\n\nIf not successful, the API sends a “errorApi” message to the content script. The\n[“errorApi” message contains a CSRF token from https://www.coinbase.com/settings/api](https://www.coinbase.com/settings/api)\nas one parameter, and a response to the new API key creation request.\n\n\n-----\n\nMethod createApi\n\nThis message is received from the content script and contains a two-factor authentication\n(2FA) code as one of the parameters. This code is used for opening a new modal window for\ncreating API keys. Typically, when you click on “+New API Key” in the Coinbase API settings,\na 2FA code is requested and if the code is correct, the modal window appears.\n\nIn the second step of the new API creation, one needs to select wallets and their\npermissions. The malicious extension requests all the available permissions for all accounts.\n\nFigure\n\n9. Selecting all accounts and permissions\nAfterward, one needs to insert one more authentication code and a form with the newly\ngenerated API keys is displayed. If successful, the background script then continues with\nextracting two API keys (API Key and API Secret) from the “API key details” form, saves\nthem to Chromium’s local storage for later use, and exfiltrates them to http://<C&C\n_server>/traffic/step. If API authentication is not successful, a “retryApi” message is sent to_\ncontent script.\n\nContent script analysis\n\nWe looked further into the content script to analyze the routine responsible for stealing the\n2FA passwords from the victims. The content script contains a list of messages in the\nfollowing languages:\n\nEnglish (en)\nGerman (de)\nSpanish (es)\nFrench (fr)\nJapanese (jp)\nIndonesia (id)\nItalian (it)\nPolish (pl)\nPortuguese (pt)\nRussian (ru)\nThai (th)\nTurkish (tr)\n\nEach message contains a title, description, and error message for both phone and\nauthenticator.\n\nFor “phone,” displayed messages in English appear as:\n\n\n-----\n\ntitle : Please enter the verification code from your phone.\n“description”: “Enter the two-step verification code provided by SMS to your phone.\n“message”: “That code was invalid. Please try again.”\n\nFor “authenticator,” displayed messages in English look like:\n\n“title”: “Please enter the verification code from your authenticator.”\n“description”: “Enter the 2-step verification code provided by your authentication app.”\n“message”: “That code was invalid. Please try again.”\n\nThe content script initially makes a request to /api/v3/brokerage/user_configuration to see if a\nuser is logged in or not. The script then sends a “homeStart” message to the background\n[script and starts listening using onMessage to listen for “method” attributes similar to the](https://developer.chrome.com/docs/extensions/reference/runtime/#event-onMessage)\nbackground script routine. If it receives a message with a method attribute equal to “okApi”, it\nhides the code loader and removes the modal window. If it receives a message with a\nmethod attribute equal to “errorApi” it then creates a modal window.\n\nFigure 10. Displayed\n\nmodal window asking for entering authentication code\n[The modal window has input boxes and listens for oninput events. If each of the input boxes](https://www.w3schools.com/jsref/event_oninput.asp)\ncontains one digit, they are concatenated into one “tfa” (2FA) variable and sent as a\nparameter of “createApi” message to the background script. The code loader is also shown.\n\nThe modal window has six input boxes for six digits, provided when using an authenticator. If\nthe victim uses an authentication via SMS, then the authentication code has seven digits,\nand the modal window will have one more input box. This logic is implemented in the modal\nwindow code. The received message with method attribute equal to “retryApi” deletes all\ninserted digits and displays an error message in red.\n\n\n-----\n\nFigure 11. After the authentication\n\ncode is entered, an error message appears\nConclusion\n\nThe cybercriminals behind CopperStealer are far from stopping anytime soon, and we\ncontinue monitoring their deployments as they find more ways to target unwitting victims.\nWhile analyzing this routine, we found multiple similarities between this extension and the\npreviously reported malware components, one of which is that the malicious extension and\nCopperStealer were distributed from the same dropper and by the same delivery vector that\nwe have documented previously.\n\nAnother striking similarity is the malicious extension’s command and control (C&C) domain\nhaving the same format as the Domain Generation Algorithm (DGA) domains tracked back\nas belonging to the previous versions of CopperStealer. The format is a string composed of\n16 hexadecimal characters. Moreover, both of their C&C servers were constructed with the\nPHP framework “CodeIgniter.” These attributes hint to us that the developers or operators\nbehind the malware and the extension could be associated.\n\nUsers and organizations are advised to download their software, applications, and updates\nfrom the official platforms to mitigate the risks and threats brought by malware like\nCopperStealer. Teams are advised to keep their security solutions patched to ensure that\ndetection and prevention solutions can protect systems from possible multiple attacks and\ninfections.\n\nIndicators of Compromise (IOCs)\n\n[You will find the list of the IOCs here.](https://www.trendmicro.com/content/dam/trendmicro/global/en/research/22/h/copperstealer-distributes-malicious-chromium-based-browser-extension-to-steal-cryptocurrencies/IOCs-CopperStealer-distributes-malicious-Chromium-browser-extension-steal-crypto.txt)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-11 - CopperStealer Distributes Malicious Chromium-based Browser Extension to Steal Cryptocurrencies.pdf"
    ],
    "report_names": [
        "2022-08-11 - CopperStealer Distributes Malicious Chromium-based Browser Extension to Steal Cryptocurrencies.pdf"
    ],
    "threat_actors": [
        {
            "id": "75455540-2f6e-467c-9225-8fe670e50c47",
            "created_at": "2022-10-25T16:07:23.740266Z",
            "updated_at": "2025-03-27T02:02:09.955585Z",
            "deleted_at": null,
            "main_name": "Iridium",
            "aliases": [],
            "source_name": "ETDA:Iridium",
            "tools": [
                "CHINACHOPPER",
                "China Chopper",
                "LazyCat",
                "Powerkatz",
                "SinoChopper",
                "reGeorg"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "0661a292-80f3-420b-9951-a50e03c831c0",
            "created_at": "2023-01-06T13:46:38.928796Z",
            "updated_at": "2025-03-27T02:00:02.953963Z",
            "deleted_at": null,
            "main_name": "IRIDIUM",
            "aliases": [],
            "source_name": "MISPGALAXY:IRIDIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7bd810cb-d674-4763-86eb-2cc182d24ea0",
            "created_at": "2022-10-25T16:07:24.1537Z",
            "updated_at": "2025-03-27T02:02:10.126127Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "APT 44",
                "ATK 14",
                "BE2",
                "Blue Echidna",
                "CTG-7263",
                "FROZENBARENTS",
                "IRIDIUM",
                "Iron Viking",
                "Quedagh",
                "Sandworm",
                "Sandworm Team",
                "Seashell Blizzard",
                "TEMP.Noble",
                "UAC-0082",
                "UAC-0113",
                "UAC-0125",
                "UAC-0133",
                "Voodoo Bear"
            ],
            "source_name": "ETDA:Sandworm Team",
            "tools": [
                "AWFULSHRED",
                "ArguePatch",
                "BIASBOAT",
                "Black Energy",
                "BlackEnergy",
                "CaddyWiper",
                "Colibri Loader",
                "Cyclops Blink",
                "CyclopsBlink",
                "DCRat",
                "DarkCrystal RAT",
                "Fobushell",
                "GOSSIPFLOW",
                "Gcat",
                "IcyWell",
                "Industroyer2",
                "JaguarBlade",
                "JuicyPotato",
                "Kapeka",
                "KillDisk.NCX",
                "LOADGRIP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "ORCSHRED",
                "P.A.S.",
                "PassKillDisk",
                "Pitvotnacci",
                "PsList",
                "QUEUESEED",
                "RansomBoggs",
                "RottenPotato",
                "SOLOSHRED",
                "SwiftSlicer",
                "VPNFilter",
                "Warzone",
                "Warzone RAT",
                "Weevly"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535674,
    "ts_updated_at": 1743041825,
    "ts_creation_date": 1660795317,
    "ts_modification_date": 1660795317,
    "files": {
        "pdf": "https://archive.orkl.eu/abd18754ed0d38c359d340d503c1154716bb048b.pdf",
        "text": "https://archive.orkl.eu/abd18754ed0d38c359d340d503c1154716bb048b.txt",
        "img": "https://archive.orkl.eu/abd18754ed0d38c359d340d503c1154716bb048b.jpg"
    }
}