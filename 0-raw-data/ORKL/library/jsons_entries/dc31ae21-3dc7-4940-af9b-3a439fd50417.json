{
    "id": "dc31ae21-3dc7-4940-af9b-3a439fd50417",
    "created_at": "2023-01-12T14:59:33.046678Z",
    "updated_at": "2025-03-27T02:08:41.073791Z",
    "deleted_at": null,
    "sha1_hash": "1bc1ac112578f0ae819d6f1a237fd1c303232c93",
    "title": "2022-05-04 - Tips for Automating IOC Extraction from GootLoader, a Changing JavaScript Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T19:09:41Z",
    "file_modification_date": "2022-05-28T19:09:41Z",
    "file_size": 415842,
    "plain_text": "# Recent Posts\n\n**[threatresearch.ext.hp.com/tips-for-automating-ioc-extraction-from-gootloader-a-changing-javascript-malware/](https://threatresearch.ext.hp.com/tips-for-automating-ioc-extraction-from-gootloader-a-changing-javascript-malware/)**\n\nMay 4, 2022\n\n[HP Threat Research Blog • Tips for Automating IOC Extraction from GootLoader, a Changing](https://threatresearch.ext.hp.com/blog/)\nJavaScript Malware\n\n## Tips for Automating IOC Extraction from GootLoader, a Changing JavaScript Malware\n\nThe threat actors behind GootLoader are always making adjustments to this family of\nJavaScript malware, which affects indicator of compromise (IOC) extraction using our\ndecoder script. Whenever the GootLoader decoder breaks we try to adapt it to the new\nversion of the malware to help the security community. In this post, we share the process of\ndebugging and fixing the script, showing the common steps we usually take.\n\nFirst, we look at all extracts from the regular expressions (regex) because this is usually the\nreason why the decoder breaks. To do so, we add print statements before and after each\nregex evaluation starting from the bottom of the script. The following image shows our first\ncheck.\n\n\n-----\n\nFigure 1 – Print statements around regular expression evaluations.\n\nBased on the output we try to figure out the position where the script fails to decode the new\nGootLoader version. In this case, we get an empty content output and therefore the script\nfailed earlier in the process. In Figure 2, above the regex evaluation, we you can see an\nadditional print statement to debug the script:\n\nFigure 2 – Printing the content and the longest match of the regex.\n\nRunning the script again leads to another empty output. So further debugging is required.\nAgain, we add two print statements around the next regex evaluation, which looks as follows:\n\nFigure 3 – Debug prints to check if the regex still works.\n\nAt this point we finally get an output from our debug print statements. This tells us that we\nfound the position where the script fails to decode the new version of the malware.\n\nFigure 4 – Printed script content of the new GootLoader version.\n\nTo understand why this specific regex does not work anymore, we compare our debug\noutputs to the outputs of an older GootLoader version where the decoder worked. Using the\noutput of the working one, we can see what it should look like (Figure 5).\n\n\n-----\n\nFigure 5 – Printed script content of an older GootLoader version.\n\nThe regex result for this evaluation should lead to a list of variables concatenated with plus\nsigns. This list is used by GootLoader to rearrange the code into the right order and then\nlater on execute it using the eval function. To decode the script and extract the domains and\nURLs we need to do the same and bring the code into the correct order. With this version\nadjustment, GootLoader no longer uses just one statement to rearrange the code, but\nseveral interdependent ones. To fix the script we need to make two edits. First, we need to\nadjust the regex pattern so that it matches the new statements. Second, we need to add\nlogic to merge the code. With the help of regex101.com we can adjust and fix the regex\npattern.\n\nFigure 6 – Extracting the statements using regex.\n\nThe idea is to extract all the statements used for the code arrangement.\n\nFigure 7 – Definition of regex pattern to extract the statements.\n\nEach statement can be split into the variable and the expression. To keep track of the\nvariables we create a dictionary which uses the variables as keys and the expressions as\nvalues. The last statement is the main statement used to join the code. For this statement we\n\n\n-----\n\nsubstitute the expression based on the values in our dictionary and get the final expression\nconsisting of variables that refer to code fragments. The adjusted code sequence looks like\nthis:\n\nFigure 8 – Modified code sequence to decode the new GootLoader version.\n\nTo keep the script still compatible for older GootLoader versions, we add an If statement. If\nwe do not get regex matches for the simple statement, we use the code which evaluates\ncompound statements. Finally, we remove the print statements which we inserted for\ndebugging and run the repaired script to get the following output:\n\nFigure 9 – GootLoader decoding script output.\n\nThis is the typical process we go through to adapt the decoding script to new GootLoader\nversions. As the threat actors behind GootLoader have been making version changes more\nfrequently lately, we have had to make changes to our script more frequently as well. We\nhope that this explanation is helpful for analyzing GootLoader and making adjustments of our\ndecoder script.\n\n\n-----\n\n## Tools\n\nYou can download the latest GootLoader decoder script here:\n[https://github.com/hpthreatresearch/tools/blob/main/gootloader/decode.py](https://github.com/hpthreatresearch/tools/blob/main/gootloader/decode.py)\n\n## IOCs\n\nNew GootLoader version:\n\n0a7c07fc84fd9f5b91bde6822b865f9647ca4ece67e8a4a646ce8d405187dc8b\n\nhxxps://lakeside-fishandchips[.]com/test.php?sgjngbizjfwgs=\n\nhxxps://learn.openschool[.]ua/test.php?sgjngbizjfwgs=\n\nhxxps://kristinee[.]com/test.php?sgjngbizjfwgs=\n\nOlder GootLoader version:\n\n765fbca3b6b1a922b442bc7304454e752e8bf231e2abe5060ace55db72c78d68\n\nhxxps://kristinee[.]com/test.php?zemyrwgzcsnjur=\n\nhxxps://kepw[.]org/test.php?zemyrwgzcsnjur=\n\nhxxps://korsakovmusic[.]com/test.php?zemyrwgzcsnjur=\n\nTags\n\n[automate](https://threatresearch.ext.hp.com/blog/?post-tag=automate) [gootloader](https://threatresearch.ext.hp.com/blog/?post-tag=gootloader) [ioc](https://threatresearch.ext.hp.com/blog/?post-tag=ioc)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-05-04 - Tips for Automating IOC Extraction from GootLoader, a Changing JavaScript Malware.pdf"
    ],
    "report_names": [
        "2022-05-04 - Tips for Automating IOC Extraction from GootLoader, a Changing JavaScript Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535573,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1653764981,
    "ts_modification_date": 1653764981,
    "files": {
        "pdf": "https://archive.orkl.eu/1bc1ac112578f0ae819d6f1a237fd1c303232c93.pdf",
        "text": "https://archive.orkl.eu/1bc1ac112578f0ae819d6f1a237fd1c303232c93.txt",
        "img": "https://archive.orkl.eu/1bc1ac112578f0ae819d6f1a237fd1c303232c93.jpg"
    }
}