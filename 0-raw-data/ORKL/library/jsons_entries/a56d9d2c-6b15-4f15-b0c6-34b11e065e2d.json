{
    "id": "a56d9d2c-6b15-4f15-b0c6-34b11e065e2d",
    "created_at": "2023-01-12T15:09:37.617763Z",
    "updated_at": "2025-03-27T02:05:48.673989Z",
    "deleted_at": null,
    "sha1_hash": "d4398f15a1d295011d57607527a5f9c9b457a119",
    "title": "2021-07-27 - Diamondfox Technical Analysis Report",
    "authors": "",
    "file_creation_date": "2021-07-31T17:04:49Z",
    "file_modification_date": "2021-07-31T17:04:49Z",
    "file_size": 2286886,
    "plain_text": "## DİAMONDFOX\n\n#### Technical Analysis Report\n\n\n-----\n\n###### Contents\nIntroduction ............................................................................................................................................ 3\n\nHashes ..................................................................................................................................................... 3\n\nPreview ................................................................................................................................................... 5\n\nRuntime ................................................................................................................................................... 7\n\nLanguage Check ...................................................................................................................................... 7\n\nCountry Check ........................................................................................................................................ 8\n\nsetup_installer.exe .................................................................................................................................. 8\n\nFile Paths It Dropped ............................................................................................................................... 9\n\nDropped Files ........................................................................................................................................ 10\n\nAdware and Linked Sites ....................................................................................................................... 11\n\nCompact_Layer ..................................................................................................................................... 13\n\ncurl_easy_setopt ................................................................................................................................... 13\n\npthread_cond_broadcast...................................................................................................................... 14\n\nInno Setup ............................................................................................................................................. 14\n\nCookie Steal........................................................................................................................................... 15\n\ncsrss.exe ................................................................................................................................................ 15\n\nee.exe / zz.exe ....................................................................................................................................... 16\n\ngetdiskspace.exe ................................................................................................................................... 16\n\nsmbscanlocal10906.exe ........................................................................................................................ 17\n\nDisable Error Reporting from Registry .................................................................................................. 17\n\nİOCs ....................................................................................................................................................... 17\n\nScheduled Task...................................................................................................................................... 18\n\nChrome Secretly Steals Information In The Background ...................................................................... 18\n\nJava ........................................................................................................................................................ 19\n\nSolution proposals ................................................................................................................................ 20\n\nYara Rules .............................................................................................................................................. 21\n\n\n-----\n\n###### Introduction\n\nx86_64setup.exe, a recently released, uninformed and blended example, shows the features of\nmany malware families such as Redline, Smokeloader, Asyncrat, Vidar, which can also be seen in the\nimage, although it is from the diamondfox family.\n\nIt covers everything from keylogging and browser password stealing to various Distributed Denials.\n\nIt has many functions such as adware, cookie stealing, UAC bypass (running with administrator\nrights), botnet creation.\n\nDiamondFox includes an embedded configuration section that contains the values used to\ndetermine the workflow. To store malware, decrypt keys, and perform other tasks, the keys in the\nconfiguration section are used throughout the entire malware execution process, and the\nfunctionality of the malware is determined by their value. The configuration partition is stored in a\nspecific PE partition named L!NK. At the initial stage, this PE portion is copied into a newly allocated\nbuffer consisting of key-values.\n\n###### Hashes\n\nIt is packed with Sfx and the hashes of the exes in it are as follows.\n\nX86_64setup.exe\n\nMD5: 9e285901af26b01bafe9afb312620887\n\nSHA256: b035ee9ead48cdfdfa1d7110cc84204df3571d6843aedc4c44edc73f59b013c0\n\nSHA1: b86337160b7a3fcc8056ccc9bc7c71cdb45ddc21\n\nsetup_installer.exe\n\nsetup_install.exe\n\nMD5: bf796dca0c45920e180ac8b9298f8a01\n\nMD5: 8ed9fc32d350c4b26eb9064fd43cf06a\n\nSHA256:\n\nSHA256:\n\ncd7e1ca8ac8578f93a2b3311e24c7745c1d892e7\n\n1b8366b1c4efed339f281887b1e5443f8925ef895df02e6101\n\n\n-----\n\nSonia_1.exe\n\nMD5: 6e487aa1b2d2b9ef05073c11572925f2\n\nSHA256: 77eec57eba8ad26c2fd97cc4240a13732f301c775e751ee72079f656296d9597\n\nSonia_2.exe\n\nMD5: 5463ae9cd89ba5a886073f03c1ec6b1e\n\nSHA256: 5d61ca2da46db876036960b7389c301519a38c59f72fa2b1dcbb1095f6a76c72\n\nSonia_3.exe\n\nMD5: a2d08ecb52301e2a0c90527443431e13\n\nSHA256: e6c638f913e9137efc3b2b126d32dc7ea9bd03561df0213d1da137c4128636e9\n\nSonia_4.exe\n\nSHA1: dd78b03428b99368906fe62fc46aaaf1db07a8b9\n\nSHA256: d417bd4de6a5227f5ea5cff3567e74fe2b2a25c0a80123b7b37b27db89adc384\n\nSonia_5.exe\n\nMD5: 8c4df9d37195987ede03bf8adb495686\n\nSHA256: 5207c76c2e29a2f9951dc4697199a89fdd9516a324f4df7fa04184c3942cc185\n\nSonia_6.exe\n\nMD5: f00d26715ea4204e39ac326f5fe7d02f\n\nSHA256: 2eaa130a8eb6598a51f8a98ef4603773414771664082b93a7489432c663d9de3\n\nSonia_7.exe\n\nMD5: a73c42ca8cdc50ffefdd313e2ba4d423\n\nSHA256: c7dcc52d680abbfa5fa776d2b9ffa1a8360247617d6bef553a29da8356590f0b\n\nSonia_8.exe\n\nMD5: dd0b8a5769181fe9fd4c57098b9b62bd\n\nSHA256: ab36391daabc3ed858fcd9c98873673a1f69a6c9030fc38d42937bdeb46b2fc5\n\n\n-----\n\nSonia_9.exe\n\nMD5: 3e2c8ab8ed50cf8e9a4fe433965e8f60\n\nSHA256: b67af6174c3599f9c825a6ea72b6102586b26600a3b81324ce71b9905c9c3ec6\n\nSonia_10.exe\n\nMD5: 881241cb894d3b6c528302edc4f41fa4\n\nSHA256: 3e70e230daee66f33db3fdba03d3b7a9832088fe88b0b4435d719e185ae8a330\n\n###### Preview\n\nThe moment he runs the x86_64setup.exe file he downloaded to install Ligthening media player, he\ndrops more than 100 exe's with the program he wants and installs many applications.\n\nWhen we open archives sequentially, we see that the exeler, folder and dlls appear in the following\norder.\n\nSetup_installer.exe is a setup file configured as 7z setup sfx, as we can see here, and this file contains\nthe files that need to be run directly in it.\n\nWhen we open the archive, we see 5 dll 1 exe 10 txt files.\n\nTxt files have MZ extension and are converted to exe instantly at runtime\n\n\n-----\n\nThese files were written with Microsoft Visual Studio .NET, Microsoft Visual C++ 8 and Borland\nDelphi 4.0. In addition to these, there are also Aspack v2.12 and UPX packaged exes.\n\nAfter dropping the necessary processes and setup_installer.exe to temp, it runs it with the runas\ncommand.\n\nRunas , It is the command that makes the program run via cmd.\n\nSetup_installer.exe is sfx and sfx configuration file should be like below\n\nsetup_installer.exe is configured with the configuration shown in the picture.\n\n\n-----\n\n###### Runtime\n\nRuns Sonia series with the help of cmd and Along with the ones they drop, some run it under itself,\nsome run it separately but all run with admin privileges.\n\n###### Language Check\n\nAs seen in the picture, it receives information about the language of the computer. 1055 is the\nhexadecimal code of Turkish.\n\n\n-----\n\n###### Country Check\n\nGets the country code.\n\n###### setup_installer.exe\n\nThe setup_installer.exe, which is the sfx file, creates the 7zS84ecfcd2 file temporarily in temp and\nextracts itself to that folder. Runs the setup_install.exe file in the 7zS84ecfcd2 folder and makes the\nextension of the txts to exe and runs it with cmd and the processes begin. It also downloads utf-8.\n\n\n-----\n\nThe executefile parameter is used to open a document from the .7z archive\n\n###### File Paths It Dropped\n\nC:\\Users\\%username%\\AppData\\Local\\Temp\n\nC:\\Users\\%username%\\AppData\\Local\\Temp\\csrss\n\nC:\\Users\\%username%\\AppData\\Local\\Temp\\csrss\\wup\n\nC:\\Users\\%username%\\AppData\\Local\\Temp\\csrss\\injector\n\nC:\\Users\\%username%\\AppData\\Local\\Temp\\2e08cba24e\n\nC:\\Users\\%username%\\AppData\\Local\\Temp\\7zS84ecfcd2\n\nC:\\Users\\%username%\\AppData\\Roaming\n\nC:\\Users\\%username%\\Documents\n\nC:\\Windows\\System32\n\nC:\\Users\\%username%\\AppData\\Local\\Microsoft\\Windows\\Temporary Internet Files\n\n\n-----\n\n###### Dropped Files\n\nSonia_1.exe osloader.exe libcurl.dll libgcc_s_dw2-1.dll libwinpthread-1.dll\n\nSonia_2.exe ntkrnlmp.exe libcurlpp.dll libstdc++-6.dll setup_install.exe\n\nSonia_3.exe Sonia_4.exe Sonia_5.exe Sonia_6.exe setup_installer.exe\nSonia_7.exe Sonia_8.exe Sonia_9.exe Sonia_10.exe ee.exe      zz.exe\n\n2.exe 2-42AT~1.EXE download.error ntkrnlmp.pdb 1587087885.exe\n\n1763683596.exe axhub.dll CC4F.tmp dbghelp.dll symsrv.dll\n\napi-ms-win-core-namedpipe-l1-1-0.dll tmp26A9.tmp owegj.exe   6ido0sjUdET8jRftOSc3hmIV.exe\n\napi-ms-win-core-string-l1-1-0.dll 6Tnz3PeIVSgDBk5lIzA16244.exe\n\n8H6ZWCCbqKQZqr1ZDzSBxK6x.exe 8TJ9VtKLB52kA6SeboPhDGTF.exe\n\naXl2zAftEqK3NhbWkMC9tlu9.exe b7v49ezmfyjY8yPUl728VzS6.exe\n\nDVRrv75N3d0cq9kr9v1nybhD.exe jdw6amdvloiFhGwIbHrF9bId.exe\n\njXKnQe3TxYFteWy6j3yegXVO.exe ksn2FwIHkR6rBdWC4wPt3JNr.exe\n\nMWfsWcm042byzXi5l9sNEvpV.exe pVewZJtyml5fXqzzLBi4BYUA.exe\n\nQiLxAKnbZiFVrIaHVYrVaCor.exe tXlH2r9moz62hZPcvIryh0o3.exe\n\nvqd7AT7ae6Trme1GYn3mYmhh.exe xvakguFf42t2cm80ddcmFdSW.exe\n\nYDQgBKZPYWCdWgcUNzdp3XSu.exe xmNWhWqAFpLCfekZ83BQg4bT.exe\n\n_O6dRJaKSVIsmYSHDNe2HP2J.exe _O6dRJaKSVIsmYSHDNe2HP2J.exe\n\n2M3NhGrvxSqWKxfUZaLIV6T3.exe 3EaucCSGZDQ6kBhOhGL6GzIs.exe\n\n4YuMZqpIHmQunPxfoSr8reVN.exe 5EZopq09PuytQxgh7s3mcjdM.exe\n\n7_6ykZv7EvdCcqo5NVamsE5Z.exe 9kEtX2IGRqLKvOoj8lHVD5nN.exe\n\na0b6FbwlMTk4Pu1B7S6kg54S.exe a2oOWdAaiKKhVMBVvYfzoevb.exe\n\nb9m753ZLMwrPudU1Z8oLgpRu.exe bk7ZfU2gLdOfP4WvGCutiJ9y.exe\n\npatch.exe narbux.exe injector.exe ww31.exe\n\nThese are just some of the dropped files, downloading some files and deleting them directly.\n\n\n-----\n\n2-42at file is actually install.bat file and it redirects to iplogger page.\n\n###### Adware and Linked Sites\n\nHumisnee.com ip-api.com facebook.com\n\nBinance.com 37.0.11.41/base/api/getData.php ipinfo.io\n\nBrowzar.com addthis.com cdn.discordapp.com\n\nBet365.com steamcomunity.com gql.twitch.com\n\nAvito.ru pastebin.com i.instagram.com\n\noauth.vk.com api.login.yahoo.com spolaect.info\n\nwalmart.com google.kz google.com\n\n\n-----\n\nres://c:\\program files (x86)\\browzar\\browzar.exe/dnserror.htm#http://www.browzar.com/start/?v=2000\n\nThe getfp.exe in the csrss folder goes to humisnee.com.\n\nIt connects to ip-api.com and gets various information.\n\n\n-----\n\n###### Compact_Layer\n\nIt uses compat_layer structure to run as administrator without asking for admin rights.\n\n###### curl_easy_setopt\n\nRegulates the behavior of libcurl.dll with curl_easy_setopt\n\nIt is used to tell libcurl how to behave. By setting the appropriate options, the application changes\nthe behavior of libcurl.\n\n\n-----\n\n###### pthread_cond_broadcast\n\nThe pthread_cond_broadcast() function is used to unblock all threads currently blocked by the\nspecified state variable.\n\n###### Inno Setup\n\nThe Inno Setup installer has two processes. The primary process is a latent process. Extracts and\nexecutes the actual sub-installer to a temporary folder (elevating to Administrator privileges if\nnecessary).\n\nCommand line: \"C:\\Users\\zorro\\AppData\\Local\\Temp\\is-4GL93.tmp\\sonia_5.tmp\"\n/SL5=\"$5B0346,506127,422400,C:\\Users\\zorro\\Desktop\\210703-\ng9ppb8b36j_pw_infected\\vürüs\\setup_installer\\sonia_5.exe\n\n\n-----\n\n###### Cookie Steal\n\n11111.exe directly accesses and steals chrome cookies.\n\nHe also used fug3g.gg.exe for Edge.\n\n###### csrss.exe\n\nAll files in C:\\Users\\%username%\\AppData\\Local\\Temp\\csrss run under csrss.exe.\n\n\n-----\n\n###### ee.exe / zz.exe\n\nExes running in csrss as ee.exe and zz.exe are actually gminer v2.54.\n\ngminer provides display of detailed information (temperature, power consumption, heatsink load,\nmemory frequency, processor frequency, energy efficiency) for each device.\n\n###### getdiskspace.exe\n\nProvides information about disk spaces\n\n\n-----\n\n###### smbscanlocal10906.exe\n\nHe scanned for possible vulnerabilities with smbscanlocal10906.exe that he dropped to csrss and\ncould not find any vulnerabilities.\n\n###### Disable Error Reporting from Registry\n\n İOCs\n\n185.215.113.62:51929 162.159.133.233 172.67.191.67 104.21.76.97\n\n136.144.41.201 185.20.227.194 185.183.96.53 52.219.156.38\n\n116.202.183.50 74.114.154.18 159.65.63.164 172.67.171.54\n\n148.92.218.88 172.67.201.250 144.202.76.47 212.86.115.78\n\n34.117.59.81:443 34.98.75.36 172.67.199.231 62.233.121.32\n\n2.56.59.245 143.204.98.78 103.155.92.96 111.90.146.149\n\n176.111.254:56328 172.67.186.35 45.139.184.124 95.216.46.125\n\n\n-----\n\n###### Scheduled Task\n\nIt creates scheduled tasks and runs owegj.exe from time to time, as well as adds csrss.exe and many\nexes to scheduled tasks.\n\n###### Chrome Secretly Steals Information In The Background\n\nChrome arka planda gizlice çalışırken bilgi almak için izin istemektedir.\n\n\n-----\n\n###### Java \n\nHere is the command info for base64 encoded java.\n\n\"C:\\Program Files\\Java\\jre1.8.0_281\\bin\\jp2launcher.exe\" -secure -javaws -jre \"C:\\Program Files\\Java\\jre1.8.0_281\" -vma\nLWNsYXNzcGF0aABDOlxQcm9ncmFtIEZpbGVzXEphdmFcanJlMS44LjBfMjgxXGxpYlxkZXBsb3kuamFyAC1EamF2YS5zZWN1c\nml0eS5wb2xpY3k9ZmlsZTpDOlxQcm9ncmFtIEZpbGVzXEphdmFcanJlMS44LjBfMjgxXGxpYlxzZWN1cml0eVxqYXZhd3MucG9s\naWN5AC1EdHJ1c3RQcm94eT10cnVlAC1YdmVyaWZ5OnJlbW90ZQAtRGpubHB4LmhvbWU9QzpcUHJvZ3JhbSBGaWxlc1xKYX\nZhXGpyZTEuOC4wXzI4MVxiaW4ALURqYXZhLnNlY3VyaXR5Lm1hbmFnZXIALURzdW4uYXd0Lndhcm11cD10cnVlAC1YYm9vdG\nNsYXNzcGF0aC9hOkM6XFByb2dyYW0gRmlsZXNcSmF2YVxqcmUxLjguMF8yODFcbGliXGphdmF3cy5qYXI7QzpcUHJvZ3JhbSB\nGaWxlc1xKYXZhXGpyZTEuOC4wXzI4MVxsaWJcZGVwbG95LmphcjtDOlxQcm9ncmFtIEZpbGVzXEphdmFcanJlMS44LjBfMjgxX\nGxpYlxwbHVnaW4uamFyAC1EamRrLmRpc2FibGVMYXN0VXNhZ2VUcmFja2luZz10cnVlAC1Eam5scHguanZtPUM6XFByb2dyY\nW0gRmlsZXNcSmF2YVxqcmUxLjguMF8yODFcYmluXGphdmF3LmV4ZQAtRGpubHB4LnZtYXJncz1MVVJxWkdzdVpHbHpZV0pz\nWlV4aGMzUlZjMkZuWlZSeVlXTnJhVzVuUFhSeWRXVUE= -ma LVNTVkJhc2VsaW5lVXBkYXRlAC1ub3RXZWJKYXZh\n\nDecoded version.\n\n\"C:\\Program Files\\Java\\jre1.8.0_281\\bin\\jp2launcher.exe\" -secure -javaws -jre \"C:\\Program Files\\Java\\jre1.8.0_281\" -vma -\nclasspathC:\\Program Files\\Java\\jre1.8.0_281\\lib\\deploy.jar-Djava.security.policy=file:C:\\Program\nFiles\\Java\\jre1.8.0_281\\lib\\security\\javaws.policy-DtrustProxy=true-Xverify:remote-Djnlpx.home=C:\\Program\nFiles\\Java\\jre1.8.0_281\\bin-Djava.security.manager-Dsun.awt.warmup=true-Xbootclasspath/a:C:\\Program\nFiles\\Java\\jre1.8.0_281\\lib\\javaws.jar;C:\\Program Files\\Java\\jre1.8.0_281\\lib\\deploy.jar;C:\\Program\nFiles\\Java\\jre1.8.0_281\\lib\\plugin.jar-Djdk.disableLastUsageTracking=true-Djnlpx.jvm=C:\\Program\nFiles\\Java\\jre1.8.0_281\\bin\\javaw.exe-Djnlpx.vmargs= -Djdk.disableLastUsageTracking=true -ma -SSVBaselineUpdate-\nnotWebJava\n\n\n-----\n\n###### Solution proposals\n\nThere should be at least 1 up-to-date and reliable antivirus software on the system.\n\nCare should be taken when reading e-mails from unknown addresses, if there is an attachment in the\ne-mail content, this attachment should be scanned for viruses before opening it.\n\nSpam emails should not be opened.\n\nIf it is a company computer, the EDR system must be present on the computer.\n\nHarmful connections and IP addresses on the network should be filtered and access to these IP\naddresses should be blocked.\n\nThe operating system should always be kept up to date.\n\n\n-----\n\n###### Yara Rules\n\nimport \"hash\"\n\nrule md5_hash_diamondfox\n\n{\n\nmeta:\n\nauthor = \" ABDULSAMET AKINCI - ZAYOTEM \"\n\ndescription = \"diamondfox\"\n\nfirst_date=\"03.07.2021\"\n\nreport_date=\"27.07.2021\"\n\nfile_name=\"x86_64setup.exe\"\n\nstrings:\n\n$b=\"bf796dca0c45920e180ac8b9298f8a01\"\n\n$c=\"8ed9fc32d350c4b26eb9064fd43cf06a\"\n\n$a=\"9e285901af26b01bafe9afb312620887\"\n\n$d=\"6e487aa1b2d2b9ef05073c11572925f2\"\n\n$e=\"5463ae9cd89ba5a886073f03c1ec6b1e\"\n\n$f=\"a2d08ecb52301e2a0c90527443431e13\"\n\n$g=\"dd78b03428b99368906fe62fc46aaaf1db07a8b9\"\n\n$h=\"8c4df9d37195987ede03bf8adb495686\"\n\n$j=\"f00d26715ea4204e39ac326f5fe7d02f\"\n\n$k=\"a73c42ca8cdc50ffefdd313e2ba4d423\"\n\n$l=\"dd0b8a5769181fe9fd4c57098b9b62bd\"\n\n$m=\"3e2c8ab8ed50cf8e9a4fe433965e8f60\"\n\n$n=\"881241cb894d3b6c528302edc4f41fa4\"\n\ncondition:\n\n$a or $b or $c or $d or $e or $f or $g or $h or $j or $k or $l or $m or $n\n\n}\n\n\n-----\n\nimport \"hash\"\n\nrule strings_diamondfox\n\n{\n\nmeta:\n\nauthor = \"ABDULSAMET AKINCI - ZAYOTEM\"\n\ndescription = \"diamondfox\"\n\nfirst_date=\"03.07.2021\"\n\nreport_date=\"27.07.2021\"\n\nfile_name=\"x86_64setup.exe\"\n\nstrings:\n\n$b=\"sonia\"\n\n$c=\"setup_installer\"\n\n$a=\"setup_install.exe\"\n\n$d=\"libcurlpp.dll\"\n\n$e=\"libcurl.dll\"\n\n$f=\"setopt\"\n\n$g=\"compact_layer\"\n\n$h=\"inno setup\"\n\n$j=\"pthread_cond_broadcast\"\n\ncondition:\n\n$a or $b or $c or $d or $e or $f or $h or $j or $g\n\n}\n\n\n-----\n\n# ABDULSAMET AKINCI\n\n### https://www.linkedin.com/in/samoceyn/\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-27 - Diamondfox Technical Analysis Report.PDF"
    ],
    "report_names": [
        "2021-07-27 - Diamondfox Technical Analysis Report.PDF"
    ],
    "threat_actors": [
        {
            "id": "bdbf873a-048d-4c5d-9d92-922327cc83a8",
            "created_at": "2023-01-06T13:46:39.387696Z",
            "updated_at": "2025-03-27T02:00:03.071819Z",
            "deleted_at": null,
            "main_name": "DEV-0586",
            "aliases": [
                "Ruinous Ursa",
                "Cadet Blizzard"
            ],
            "source_name": "MISPGALAXY:DEV-0586",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536177,
    "ts_updated_at": 1743041148,
    "ts_creation_date": 1627751089,
    "ts_modification_date": 1627751089,
    "files": {
        "pdf": "https://archive.orkl.eu/d4398f15a1d295011d57607527a5f9c9b457a119.pdf",
        "text": "https://archive.orkl.eu/d4398f15a1d295011d57607527a5f9c9b457a119.txt",
        "img": "https://archive.orkl.eu/d4398f15a1d295011d57607527a5f9c9b457a119.jpg"
    }
}