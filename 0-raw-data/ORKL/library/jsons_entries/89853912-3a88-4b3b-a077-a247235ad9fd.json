{
    "id": "89853912-3a88-4b3b-a077-a247235ad9fd",
    "created_at": "2023-01-12T15:03:58.90711Z",
    "updated_at": "2025-03-27T02:06:06.746945Z",
    "deleted_at": null,
    "sha1_hash": "84f5aedb8e559c8b97390f8f212f0eabf5310f49",
    "title": "2017-06-27 - Schroedinger’s Pet(ya)",
    "authors": "",
    "file_creation_date": "2022-05-28T02:02:33Z",
    "file_modification_date": "2022-05-28T02:02:33Z",
    "file_size": 1025338,
    "plain_text": "# Schroedinger’s Pet(ya)\n\n**securelist.com/schroedingers-petya/78870/**\n\nAuthors\n\nGReAT\n\n**UPDATE June 28th, 2017: After an analysis of the encryption routine of the malware used in the Petya/ExPetr attacks, we have thought that**\nthe threat actor cannot decrypt victims’ disk, even if a payment was made. It appears this malware campaign was designed as a wiper\n[pretending to be ransomware. Read more: ExPetr/Petya/NotPetya is a Wiper, Not Ransomware](https://securelist.com/expetrpetyanotpetya-is-a-wiper-not-ransomware/78902/)\n\nEarlier today (June 27th), we received reports about a new wave of ransomware attacks (referred in the media by several names, including\nPetya, Petrwrap, NotPetya and exPetr) spreading around the world, primarily targeting businesses in Ukraine, Russia and Western Europe. If\nyou were one of the unfortunate victims, this screen might look familiar:\n\nKaspersky Lab solutions successfully stop the attack through the System Watcher component. This technology protects against ransomware\nattacks by monitoring system changes and rolling back any potentially destructive actions.\n\nAt this time, our telemetry indicates more than 2,000 attacks:\n\n\n-----\n\nOur investigation is ongoing and our findings are far from final at this time. Despite rampant public speculation, the following is what we can\nconfirm from our independent analysis:\n\n## How does the ransomware spread?\n\nTo capture credentials for spreading, the ransomware uses custom tools, a la Mimikatz. These extract credentials from the lsass.exe process.\nAfter extraction, credentials are passed to PsExec tools or WMIC for distribution inside a network.\n\nOther observed infection vectors include:\n\nA modified EternalBlue exploit, also used by WannaCry.\nThe EternalRomance exploit – a remote code execution exploit targeting Windows XP to Windows 2008 systems over TCP port 445\n(Note: patched with MS17-010).\nAn attack against the update mechanism of a third-party Ukrainian software product called MeDoc.\n\n**IMPORTANT: A single infected system on the network possessing administrative credentials is capable of spreading this infection to**\n**all the other computers through WMI or PSEXEC.**\n\n## What does the ransomware do?\n\nThe malware waits for 10-60 minutes after the infection to reboot the system. Reboot is scheduled using system facilities with “at” or “schtasks”\nand “shutdown.exe” tools.\n\nOnce it reboots, it starts to encrypt the MFT table in NTFS partitions, overwriting the MBR with a customized loader with a ransom note. More\ndetails on the ransom note below.\n\n### Network survey\n\nThe malware enumerates all network adapters, all known server names via NetBIOS and also retrieves the list of current DHCP leases, if\navailable. Each and every IP on the local network and each server found is checked for open TCP ports 445 and 139. Those machines that\nhave these ports open are then attacked with one of the methods described above.\n\n### Password extraction\n\nResources 1 and 2 of malware binary contain two versions of a standalone tool (32-bit and 64-bit) that tries to extract logins and passwords of\nlogged on users. The tool is run by the main binary. All extracted data is transferred back to the main module via a named pipe with a random\nGUID-like name.\n\n### File Decryption\n\n\n-----\n\nAre there any hopes of decrypting files for victims already infected? Unfortunately, the ransomware uses a standard, solid encryption scheme\nso this appears unlikely unless a subtle implementation mistake has been made. The following specifics apply to the encryption mechanism:\n\nFor all files, one AES-128 key is generated.\nThis AES key is encrypted with threat actors’ public RSA-2048 key.\nEncrypted AES keys are saved to a README file.\nKeys are securely generated.\n\nThe criminals behind this attack are asking for $300 in Bitcoins to deliver the key that decrypts the ransomed data, payable to a unified Bitcoin\naccount. Unlike Wannacry, this technique would work because the attackers are asking the victims to send their wallet numbers by e-mail to\n“wowsmith123456@posteo.net”, thus confirming the transactions. We have seen reports this email account has already been shut down,\neffectively making the full chain decryption for existing victims impossible at this time.\n\nAt the time of writing, the Bitcoin wallet has accrued 24 transactions totalling 2.54 BTC or just under $6,000 USD.\n\n**Here’s our shortlist of recommendations on how to survive ransomware attacks:**\n\nRun a robust anti-malware suite with embedded anti-ransomware protection such as System Watcher from Kaspersky Internet Security.\nMake sure you update Microsoft Windows and all third party software. It’s crucial to apply the MS17-010 bulletin immediately.\nDo not run open attachments from untrusted sources.\nBackup sensitive data to external storage and keep it offline.\n\n**Kaspersky Lab corporate customers are also advised to:**\n\nCheck that all protection mechanisms are activated as recommended; and that KSN and System Watcher components (which are\nenabled by default) are not disabled.\n[As an additional measure for corporate customers is to use Application Privilege Control to](https://help.kaspersky.com/KESWin/10SP2/en-US/39265.htm) [deny any access (and thus possibility of](http://support.kaspersky.com/10905#block1)\ninteraction or execution) for all the groups of applications to the file with the name “perfc.dat” and PSexec utility (part of the Sysinternals\nSuite)\n[You can alternatively use Application Startup Control component of Kaspersky Endpoint Security to block the execution of the PSExec](https://help.kaspersky.com/KESWin/10SP2/en-US/129102.htm)\nutility (part of the Sysinternals Suite), but please use Application Privilege Control in order to block the “perfc.dat”.\nConfigure and enable the Default Deny mode of the Application Startup Control component of Kaspersky Endpoint Security to ensure\nand enforce the proactive defense against this, and other attacks.\n\n**For sysadmins, our products detect the samples used in the attack by these verdicts:**\n\nUDS:DangerousObject.Multi.Generic\nTrojan-Ransom.Win32.ExPetr.a\nHEUR:Trojan-Ransom.Win32.ExPetr.gen\n\n**Our behavior detection engine SystemWatcher detects the threat as:**\n\nPDM:Trojan.Win32.Generic\nPDM:Exploit.Win32.Generic\n\n## IOCs\n\n\n1\n\n2\n\n3\n\n4\n\n5\n\n\n0df7179693755b810403a972f4466afb\n\n42b2ff216d14c2c8387c8eabfb1ab7d0\n\n71b6a493388e7d0b40c83ce903bc6b04\n\ne285b6ce047015943e685e6638bd837e\n\ne595c02185d8e12be347915865270cca\n\n\n-----\n\n## Yara rules\n\n[Download Yara rule expetr.yara as a ZIP archive.](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2017/06/07173436/expetr_yara.zip)\n\nrule ransomware_exPetr {\nmeta:\n\ncopyright = “Kaspersky Lab”\ndescription = “Rule to detect PetrWrap ransomware samples”\nlast_modified = “2017-06-27”\nauthor = “Kaspersky Lab”\nhash = “71B6A493388E7D0B40C83CE903BC6B04”\nversion = “1.0”\n\nstrings:\n\n$a1 =\n“MIIBCgKCAQEAxP/VqKc0yLe9JhVqFMQGwUITO6WpXWnKSNQAYT0O65Cr8PjIQInTeHkXEjfO2n2JmURWV/uHB0ZrlQ/wcYJBwLhQ9EqJ3iDqm\nfullword wide\n$a2 =\n“.3ds.7z.accdb.ai.asp.aspx.avhd.back.bak.c.cfg.conf.cpp.cs.ctl.dbf.disk.djvu.doc.docx.dwg.eml.fdb.gz.h.hdd.kdbx.mail.mdb.msg.nrg.ora.ost.ova.ov\nfullword wide\n$a3 = “DESTROY ALL OF YOUR DATA! PLEASE ENSURE THAT YOUR POWER CABLE IS PLUGGED” fullword ascii\n$a4 = “1Mz7153HMuxXTuR2R1t78mGSdzaAtNbBWX” fullword ascii\n$a5 = “wowsmith123456@posteo.net.” fullword wide\n\ncondition:\n\n(uint16(0) == 0x5A4D) and\n(filesize<1000000) and\n(any of them)\n}\n\n[Data Encryption](https://securelist.com/tag/data-encryption/)\n[Financial malware](https://securelist.com/tag/financial-malware/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[MBR](https://securelist.com/tag/mbr/)\n[Petya](https://securelist.com/tag/petya/)\n[Ransomware](https://securelist.com/tag/ransomware/)\n[Vulnerabilities and exploits](https://securelist.com/tag/vulnerabilities-and-exploits/)\n\nAuthors\n\nGReAT\n\nSchroedinger’s Pet(ya)\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-06-27 - Schroedinger’s Pet(ya).pdf"
    ],
    "report_names": [
        "2017-06-27 - Schroedinger’s Pet(ya).pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535838,
    "ts_updated_at": 1743041166,
    "ts_creation_date": 1653703353,
    "ts_modification_date": 1653703353,
    "files": {
        "pdf": "https://archive.orkl.eu/84f5aedb8e559c8b97390f8f212f0eabf5310f49.pdf",
        "text": "https://archive.orkl.eu/84f5aedb8e559c8b97390f8f212f0eabf5310f49.txt",
        "img": "https://archive.orkl.eu/84f5aedb8e559c8b97390f8f212f0eabf5310f49.jpg"
    }
}