{
    "id": "77a3dc24-a665-4c28-a624-5cb0f10fab72",
    "created_at": "2023-01-12T15:04:48.395268Z",
    "updated_at": "2025-03-27T02:06:15.834123Z",
    "deleted_at": null,
    "sha1_hash": "5058bdd1ee6d23a53c825e7447271a6eb9617e4b",
    "title": "2022-08-04 - Ousaban- LATAM Banking Malware Abusing Cloud Services",
    "authors": "",
    "file_creation_date": "2022-08-18T03:53:09Z",
    "file_modification_date": "2022-08-18T03:53:09Z",
    "file_size": 1177907,
    "plain_text": "# Ousaban: LATAM Banking Malware Abusing Cloud Services\n\n**[netskope.com/blog/ousaban-latam-banking-malware-abusing-cloud-services](https://www.netskope.com/blog/ousaban-latam-banking-malware-abusing-cloud-services)**\n\nGustavo Palazolo August 4, 2022\n\n## Summary\n\n[Ousaban (a.k.a.](https://malpedia.caad.fkie.fraunhofer.de/details/win.ousaban) [Javali) is a banking malware that emerged between 2017 and 2018, with the](https://securelist.com/the-tetrade-brazilian-banking-malware/97779/)\nprimary goal of stealing sensitive data from financial institutions in Brazil. This malware is\n[developed in Delphi and it comes from a stream of LATAM banking trojans sourced from](https://www.botconf.eu/wp-content/uploads/2019/12/B2019-Soucek-Hornak-DemystifyingBankingTrojansFromLatinAmerica.pdf)\n[Brazil, sharing similarities with other families like Guildma,](https://malpedia.caad.fkie.fraunhofer.de/details/win.astaroth) [Casbaneiro, and](https://malpedia.caad.fkie.fraunhofer.de/details/win.metamorfo) [Grandoreiro.](https://malpedia.caad.fkie.fraunhofer.de/details/win.grandoreiro)\nFurthermore, the threat [often abuses cloud services, such as Amazon S3 to download](https://seguranca-informatica.pt/latin-american-javali-trojan-weaponizing-avira-antivirus-legitimate-injector-to-implant-malware/)\nsecond stage payloads, and Google Docs to retrieve the C2 configuration.\n\nNetskope Threat Labs came across recent Ousaban samples that are abusing multiple cloud\nservices throughout the attack flow, such as Amazon or Azure to download its payloads and\nlog the victim’s IP, and Pastebin to retrieve the C2 configuration. The malware is downloaded\nthrough MSI files either by a JavaScript or a Delphi DLL, and is targeting more than 50\nfinancial institutions in Brazil. Furthermore, we also found Telegram abuse in the malware\ncode, likely used for C2 communication via Webhooks.\n\n\n-----\n\nIn this blog post, we will analyze Ousaban, showing its delivery methods, obfuscation\ntechniques, and C2 communication.\n\n## Delivery methods\n\nOusaban is delivered through malicious MSI files spread in phishing emails. In this\ncampaign, we found that the MSI file downloads and executes the second stage either\nthrough JavaScript or a PE file.\n\n**Delivery by JavaScript**\n\n[In the first scenario, the JavaScript is executed via CustomAction.](https://docs.microsoft.com/en-us/windows/win32/msi/customaction-table)\n\n_MSI file executing JavaScript._\n\nThe JavaScript code is obfuscated, likely in an attempt to slow down analysis.\n\n\n-----\n\n_JavaScript code extracted from the MSI file_\nLooking at the deobfuscated code, these are the steps executed by the malware:\n\n1. Creates an empty file to be used as a flag in case the MSI is executed twice (similar\n\nconcept as Mutex usage);\n2. Downloads the second stage from the cloud, either from Amazon or Azure;\n3. Decompress the ZIP file downloaded from the cloud and renames the main executable;\n4. Sends a simple GET request to another URL (Azure or another attacker-controlled\n\nserver), alerting the attacker and logging the victim’s IP;\n[5. Executes the main file via WMIC.](https://lolbas-project.github.io/lolbas/Binaries/Wmic/)\n\n_Deobfuscated JavaScript extracted from the MSI file._\n\n\n-----\n\n**Delivery by File**\n\nWe also found Ousaban being delivered without JavaScript. In this case, we can see a file\n[named “avisoProtesto.exe” being executed via MSI CustomAction.](https://docs.microsoft.com/en-us/windows/win32/msi/customaction-table)\n\n_MSI executing a PE file._\n“avisoProtesto.exe” is a signed and non-malicious binary exploited to execute the malicious\nDLL via [DLL search order hijacking.](https://attack.mitre.org/techniques/T1574/001/)\n\n_Non-malicious binary used to load the malicious DLL._\n\n\n-----\n\nThis is possible because the non-malicious binary loads a DLL named crashreport.dll\nwithout specifying the real path of the library. Therefore, the attacker places a DLL with the\nsame name in the same folder of the executable, making it load the malicious DLL instead.\n\n_Binary vulnerable to DLL_\n\n_hijacking._\nIn this case, both next-stage and tracker URL are loaded from a text file, named “FileLinks”.\n\n_Malicious URLs loaded by the_\n\n_malware._\nAll the files we analyzed were downloading the next stage from the cloud, either Amazon or\nAzure. In some cases, the URL used to log the victim’s IP address was also from Azure. All\n[the URLs can be found in our GitHub repository.](https://github.com/netskopeoss/NetskopeThreatLabsIOCs/tree/main/Ousaban)\n\n## Loading the second stage\n\nThe binary downloaded from the cloud is a ZIP file containing the next stage payload, which\nis a Delphi DLL executed by a non-malicious binary.\n\n\n-----\n\n_Files downloaded from the cloud._\nThe file executed by the malware is a non-malicious executable with a valid signature\n(“Securityo6Z3.exe”).\n\n_Certificate found in the file executed_\n\n_by the malware._\n\n\n-----\n\nThe malicious DLL is then loaded by the non-malicious binary through a DLL search order\nhijacking vulnerability, the same technique that is used by some of the downloaders.\n\n_Non-_\n\n_malicious binary loading the next stage DLL._\n\n## Second stage\n\nThe second stage is a Delphi malware responsible for decrypting and loading Ousaban’s\npayload in the following flow:\n\n1. Loads the encrypted bytes of Ousaban from disk;\n2. Decrypts Ousaban payload using a key stored in the “.data” section;\n3. Decrypts the code that runs Ousaban using the same key, stored in the “.data” section.\n\n_Decryption_\n\n_key and encrypted code stored in the “.data” section of the second stage._\nThe encrypted payload of Ousaban is located among the files downloaded from the cloud,\nnamed “ZapfDingbats.pdf”.\n\n\n-----\n\n_Third stage encrypted_\n\n_among files downloaded from the cloud._\nOnce running, the second stage loads Ousaban’s encrypted bytes, which will be decrypted\nusing the key stored in the PE “.data” section.\n\n_Encrypted Ousaban payload being loaded._\nAside from decrypting the payload, the second stage also decrypts the code that will execute\nOusaban in runtime, probably to slow down reverse engineering.\n\n\n-----\n\n_Second stage decrypting and loading Ousaban payload._\nWe created a Python script that can be used to statically decrypt Ousaban payloads, using\n[the same algorithm found in the malware. The code can be found in our GitHub repository.](https://github.com/netskopeoss/NetskopeThreatLabsIOCs/tree/main/Ousaban/script)\n\nImportant API calls used by this stage are also dynamically resolved, another common\ntechnique to slow down reverse engineering.\n\n_APIs dynamically loaded by the malware._\n\n\n-----\n\n## Ousaban payload\n\nOusaban is a Delphi banking trojan, mainly focused on stealing sensitive data from financial\ninstitutions in Brazil. As previously mentioned, Ousaban shares many similarities with other\nBrazilian banking malware, such as the algorithm to decrypt the strings and overlay\ncapabilities.\n\n[Ousaban commonly packs/protects its payloads with UPX or](https://upx.github.io/) [Enigma.](https://enigmaprotector.com/)\n\n_Ousaban payload packed with UPX._\nOne of the most characteristic aspects of Brazilian-sourced banking malware is the algorithm\nused to encrypt/decrypt important strings.\n\n\n-----\n\n_Ousaban encrypted_\n\n_strings._\nThe algorithm used as a base by these trojans was originally demonstrated in a Brazilian\n[magazine called “Mestres Da Espionagem Digital” in 2008. Simply put, it parses the](https://www.amazon.com.br/Mestres-Espionagem-Digital-Master-Zion/dp/856048079X)\nhexadecimal string and uses a chained XOR operation with the key and the previous byte of\nthe string.\n\n\n-----\n\n_Part of the algorithm to decrypt the strings, commonly found in Brazilian banking malware._\n[We created a Python script that can be used to decrypt strings from malware that uses this](https://github.com/netskopeoss/NetskopeThreatLabsIOCs/tree/main/Ousaban/script)\nalgorithm, such as Ousaban, Guildma, Grandoreiro, and others. The code can be used to\ndecrypt a single string:\n\n_Decrypting a single string from the malware._\nOr to decrypt multiple strings at once, saving the result in a JSON file and also providing the\noption to show in the console.\n\n\n-----\n\n_Decrypting multiple strings from the malware._\nLike other Brazilian-sourced malware, Ousaban monitors the title text from the active window\nand compares it with a list of strings, to verify if the victim is accessing the website or an\napplication of one of its targets.\n\n_Malware monitoring windows titles._\nIn the files we analyzed, we found Ousaban targeting over 50 different financial institutions. If\nthe window title matches one of the targets, Ousaban starts the communication with the C2\naddress, providing the option to the attacker to access the machine remotely.\n\n## C2 communication\n\nOusaban stores the C2 address remotely. In this case, the malware is using Pastebin to fetch\n[the data. In 2021, this malware was also spotted using Google Docs to fetch this information.](https://seguranca-informatica.pt/latin-american-javali-trojan-weaponizing-avira-antivirus-legitimate-injector-to-implant-malware/#.YuP-zuzML0o)\n\n\n-----\n\nWithin the files downloaded from the cloud by the first stage, there s a file named Host,\nwhich stores the external location of the C2 configuration. The information is encrypted with\nthe same algorithm used in the strings.\n\n_C2 configuration stored on Pastebin._\nThe data is stored in a dictionary, where the C2 host is also encrypted with the same\nalgorithm used in the strings.\n\n_Retrieving and decrypting the C2 server address._\nOusaban only starts the communication once a targeted company is identified.\n\n_Ousaban C2 communication._\n\nLastly, the Ousaban samples we analyzed contain a routine to communicate via Telegram\nusing Webhooks, likely to be used as a secondary channel.\n\n\n-----\n\n_Part of Ousaban code to communicate via Telegram._\n\n## Conclusion\n\nOusaban is a malware designed to steal sensitive information from several financial\ninstitutions, mainly based in Brazil. Ousaban shares many similarities with other Brazilianbased banking trojans, such as Guildma and Grandoreiro. Also, as we demonstrated in this\nanalysis, the attackers behind this threat are abusing multiple cloud services throughout the\nattack chain. We believe that the use of the cloud will continue to grow among attackers\nespecially due to cost and ease.\n\n## Protection\n\nNetskope Threat Labs is actively monitoring this campaign and has ensured coverage for all\nknown threat indicators and payloads.\n\n**Netskope Threat Protection**\n\nWin32.Malware.Heuristic\nWin32.Infostealer.Heuristic\n**Netskope Advanced Threat Protection provides proactive coverage against this**\nthreat.\n\nGen.Malware.Detect.By.StHeur indicates a sample that was detected using static\nanalysis\nGen.Malware.Detect.By.Sandbox indicates a sample that was detected by our\ncloud sandbox\n\n\n-----\n\n## IOCs\n\n[All the IOCs related to this campaign and scripts can be found in our GitHub repository.](https://github.com/netskopeoss/NetskopeThreatLabsIOCs/tree/main/Ousaban)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-04 - Ousaban- LATAM Banking Malware Abusing Cloud Services.pdf"
    ],
    "report_names": [
        "2022-08-04 - Ousaban- LATAM Banking Malware Abusing Cloud Services.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535888,
    "ts_updated_at": 1743041175,
    "ts_creation_date": 1660794789,
    "ts_modification_date": 1660794789,
    "files": {
        "pdf": "https://archive.orkl.eu/5058bdd1ee6d23a53c825e7447271a6eb9617e4b.pdf",
        "text": "https://archive.orkl.eu/5058bdd1ee6d23a53c825e7447271a6eb9617e4b.txt",
        "img": "https://archive.orkl.eu/5058bdd1ee6d23a53c825e7447271a6eb9617e4b.jpg"
    }
}