{
    "id": "f6fd71b7-c26e-4b7c-b0fa-3b837b7931b6",
    "created_at": "2023-01-12T15:06:45.746344Z",
    "updated_at": "2025-03-27T02:05:19.680283Z",
    "deleted_at": null,
    "sha1_hash": "9e19feecdde7274a4a9d42b565642a454edd98b1",
    "title": "2016-08-19 - New Hancitor Malware- Pimp my Downloaded",
    "authors": "",
    "file_creation_date": "2022-05-28T21:52:54Z",
    "file_modification_date": "2022-05-28T21:52:54Z",
    "file_size": 2588883,
    "plain_text": "# New Hancitor Malware: Pimp my Downloaded\n\n**[blog.minerva-labs.com/new-hancitor-pimp-my-downloader](https://blog.minerva-labs.com/new-hancitor-pimp-my-downloader)**\n\n[Tweet](https://twitter.com/share)\n\nHancitor (AKA Chanitor and TorDal) is a downloader-type malware – out there for almost two\nyears now. Downloaders contact the C2 servers after establishing an initial foothold on the\nvictim's machine – downloading and installing Trojans, bots and other kinds of malware.\n\n\n-----\n\n[Last May malware researchers at Proofpoint revealed that they observed the re-emergence](https://www.proofpoint.com/us/threat-insight/post/hancitor-ruckguv-reappear)\nof Hancitor.\n\nThis specific downloader has three core capabilities:\n\nDownloading and executing an exe file from a URL\nDownloading a DLL from a URL and executing it without writing it to the disk, but by\nwriting it directly to the memory space of the downloader\nDeleting itself\n\nAny of those commands may be received by the downloader after transmitting a \"beacon\"\nHTTP post request to the C2 server. This request includes basic fingerprinting info unique to\neach endpoint and enables the attacker to easily manage the machines of many victims\nconcurrently while possibly infecting different endpoints with different types of malware in\nlater infection stages.\n\n## The Augmented Hancitor\n\nLast week we were contacted by one of our clients after he received a notification from one\nof Minerva's agents.\n\nA short forensic analysis enabled us to trace a phishing email containing a malicious\nattachment titledCompanyPublicMailServer.com_contract. We assumed that this is a wide\nDridex-style spam based infection campaign and indeed a simple search in a publicly\navailable sandbox proved that this was a pattern as we were able to find over 20 different\nmalicious documents similar to the one sent to our clients:\n\n\n-----\n\nDocuments infected with Hancitor\nThe malicious Microsoft Word .doc attachment had an embedded VBA macro script with a\nshort message aimed at luring the victim to enable the execution of the script.\n\nAfter enable editing is clicked - malware will execute\nUnlike the document used to drop Hancitor in Proofpoint's investigations our sample had\nsome extra features:\n\n**Handling x86/x64 architectures seamlessly – including adaptation of pointers and**\nimported functions:\n\n\n-----\n\nChanging the flow according to the OS version\nThese characteristics greatly increase the chances of successfully infecting the victim's\nmachine, saving noisy crashes of the macro as a bonus.\n\n**Using CallWindowProcA Windows API to execute a code written to the heap –**\nAs [explained in](https://waleedassar.blogspot.co.il/2012/03/visual-basic-malware-part-1.html) [Waleed Assar's blog – it allows the malware to avoid suspicious API](https://twitter.com/waleedassar)\ncalls as ShellExecute and CreateProcess and the need to write this intermediate\nshellcode-like dropper stage to the disk. It is uncommon to see this technique\nimplemented in VBA script, however – it is used by .exe files in the wild at\nleast [since Citadel.](https://blog.malwarebytes.com/threat-analysis/2014/02/how-to-unpack-a-self-injecting-citadel-trojan/)\n\nHancitor dropped and executed by the malicious macro\n\n\n-----\n\nNow, Hancitor is finally running. On its initial execution it is running under a random looking\nhard coded name (we observed bg618.exe and lj016.exe) from the %TEMP% folder. It then\ncreates another instance of itself and uses process hollowing to unpack itself to its new\ninstance. The unpacked executable copies Hancitor to either the system or temporary folder\nunder the name WinHost32.exeHancitor then executes the binary under its new name and\ndeletes the old one. It is also taking care of achieving persistency by creating a registry value\nunder HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run. From now on, each time\nit will be executed under the new name the following mechanism will kick in:\n\nThis is a simple test that determines if the file is executed for the first time and will gain\npersistency, or if it is already installed and should initiate its core functionality as a\ndownloader - Hancitor now connects back to its C2 servers in order to download and execute\nmalware. The communication with the C2 server was similar to the pattern described in\nProofpoint's report. A \"beacon\" signal was sent with unique identifiers of the victim:\n\n\n-----\n\nHanictor checks if the C2 has new tasks for it\nJust as we saw in the \"old\" Hancitor, our new version is able to receive commands to\ndownload and execute malware. We compared the binaries, trying to figure out if there are\nany changes between Proofpoint's Hancitor and ours and we found one key\ndifference: Support for a new command-type was added – \"b\".\n\n\n-----\n\nC2 commands switch table\nReverse engineering the function that handles it led us to the conclusion that it is used to\nexecute code downloaded from a URL. However, instead of simply executing it or writing it to\nHancitor's memory space it injects it to a svchost.exe process\n\nHancitor creates svchost.exe instance to host malicious code\n\n\n-----\n\nProofpoint s researchers predicted that downloaders will get more complex, absorbing\nfunctionality of later stages in the infection process – our findings certainly support their\nassertions.\n\n## Payloads – More of the Same\n\nAfter allowing the Hancitor sample to run in a controlled environment we were able to\nintercept it and downloaded a couple of modules. Both modules were downloaded from\nWordPress and Joomla! sites, possibly exploited to store the malicious content.\n\n[The first payload we observed was a Pony info-stealer Trojan (VT):](https://www.virustotal.com/en/file/8d60356e89c0f4d735e665bbc10c8a36589413f55efa17659c7c253d2449d54f/analysis/)\n\nCommand to download the Pony malware\nAfter downloading it directly to Hancitor's memory it was executed in a new thread and\nstarted to monitor a vast range of collectible data:\n\nEmail passwords (SMTP, POP3, IMAP)\nOther web protocols passwords (HTTP, FTP, NNTP)\n\n\n-----\n\nEnumerating keys\nin HKEY_CURRENT_USER\\Software\\Microsoft\\Office\\1x.0\\Outlook\\Profiles leading to\nthe users PST files\nMore registry keys related to outlook accounts.\n\nComparing this sample to older Pony from April to early July resulted in little to no difference.\nEven though some of the C2 URLs were changed, we discovered that they resolve to the\nsame IP addresses used in previous campaign. This is our sample,\nresolving bettitotuld[.]com:\n\nPony resolves its C2 to 46[.]4[.]173[.]214\n\n\n-----\n\nGoing through Passive Total s [data showed that at least four extra URLs linking this IP to](https://www.passivetotal.org/passive/46.4.173.214)\nprevious Pony campaigns:\n\nSame IP, different C2 URLs\nIn both the old and the new Pony samples the path to the gate was always the same,\naccessing it in the /zapoy/gate.php path. Curious what Zapoy means we opened our Russian\ndictionary and found two possible explanations: The first one translates [zapoy as the](https://en.wikipedia.org/wiki/Zapoy)\nRussian term for a state of continuous drunkenness. The other meaning is slang for \"start to\nsing\".\n\nAfter this short lesson in Russian slang we went back to check how Hancitor is doing and\nfound that our sample downloaded and executed another component:\n\n\n-----\n\nDownloading secondary payload\nThis file, 45.exe, is a spam bot which was executed after being written to the disk (unlike\nPony's DLL).\n\nAfter a short \"chat\" over UDP with its C2 server the bot started to resolve the addresses of\nSMTP servers and connect to them over port 25:\n\n\n-----\n\nThe bot searches SMTP servers\nIt is also worth mentioning that this bot has a separate persistency mechanism than\nHancitor's, installing itself as a service under the name \"s3svc\".\n\n## A Short Summary and Conclusions\n\nThe new version of Hancitor is just another phase on the evolution of downloaders from a\nsimple “check-updates-download-execute” loop to a complex and more advanced malware.\nIn this example we had the chance to observe the full chain from a phishing email to a\nTrojan:\n\n\n-----\n\nThis complex mechanism is a result of the current security products landscape – each\nevasive maneuver is tweaked to avoid a specific class of products. Minerva Anti-Evasion\nPlatform, preventing any damage by this and other malware attack by exploiting malware\nevasive nature against it self.\n\n## IOCs\n\n### URL Addresses\n\n**Hancitor**\n\nhxxp://callereb[.]com/ls/gate[.]php\n\n\n-----\n\nhxxp://supketwron[.]ru/ls/gate[.]php\n\nhxxp://witjono[.]ru/ls/gate[.]php\n\n**Pony**\n\nhxxp://eventtorshendint[.]ru/zapoy/gate[.]php\n\nhxxp://tefaverrol[.]ru/zapoy/gate[.]php\n\nhxxp://bettitotuld[.]com/zapoy/gate[.]php\n\nhxxp://tonslacsotont[.]ru/zapoy/gate[.]php\n\nhxxp://hinhenharre[.]ru/zapoy/gate[.]php\n\nhxxp://helahatun[.]com/zapoy/gate[.]php\n\nhxxp://idmuchatbut[.]ru/zapoy/gate[.]php\n\nhxxp://dafiutrat[.]ru/zapoy/gate[.]php\n\nhxxp://onketorsco[.]com/zapoy/gate[.]php\n\nhxxp://eventtorshendint[.]ru/zapoy/gate[.]php\n\n### IP Addresses\n\n62[.]141[.]54[.]153\n\n151[.]80[.]220[.]47\n\n185[.]31[.]160[.]190\n\n185[.]46[.]8[.]214\n\n46[.]4[.]173[.]214\n\n91[.]220[.]131[.]45\n\n### Hashes (SHA-256)\n\n**Infected Word Documents**\n\n8d37d622baf17eaa7a0b04ab1956263abcc4cd6d85fd28945aacf0dac87b47c4\n\nfcc24a15f2b7ed06403ec192b3ed2a5258e2691b6d61b2334160fd76bbfba151\n\n9463dc78dc7df3e751ee8c10a3fa32e315f58924eb0305f5f9eeaeae2865f9dd\n\n\n-----\n\n21efc8907d1c4f320330da3f6a87030f1c389ac8d4fc7363d170ce9444ec81cd\n\n554ff7c6f98afd3c6d9aaef232748481c8024feef415dcf4e153cdbed1a3994e\n\n7edd4f271ae83b5c13b9d1927b9a64160d5ffa2eab88e9a860e50009385638a7\n\n4b99b55479698ee6d1f6b69999c994e153672706af477c84cee6858240569783\n\ncc07a2baf22c94959623b1a89ed88a317dbd7a131d4cdc3eadb048f32b3a2e7b\n\n29f99f50e0aecd0e3c41c7dc1ecdfbc52fb53f734d0de99b5ff722dd07149173\n\n926a34fbae94ab7ed7fe9a596f0507031e19044c06cbbca245efb30d926ea1e5\n\nd59bceef11d49f47ec956b7bc9d3497ffc5259905cd6797ff9f5384f0ee55521\n\naf3d08fb9f2e2ba73496aebb53d36dae1d812622abd598eba27c5d483129632d\n\nac7a5bfc346193a43e6e22663c1037ca45d89a92c8bb3cefb165c359abb402c4\n\nc1ab4f0d1184df1be78d202e1a204fe187eb1649b1e912b48c6eef46af89c430\n\n37a4084541df61d1380370a59694ba6c59abebf0c8183e10abe60d17bdeacedd\n\n1b6e050c9f5fdcb04b247ef9db8fa2a6322118ed7b71c1545d39cb25a1e16131\n\n**Hancitor**\n\nfcc24a15f2b7ed06403ec192b3ed2a5258e2691b6d61b2334160fd76bbfba151\n\n9463dc78dc7df3e751ee8c10a3fa32e315f58924eb0305f5f9eeaeae2865f9dd\n\n21efc8907d1c4f320330da3f6a87030f1c389ac8d4fc7363d170ce9444ec81cd\n\n554ff7c6f98afd3c6d9aaef232748481c8024feef415dcf4e153cdbed1a3994e\n\n7edd4f271ae83b5c13b9d1927b9a64160d5ffa2eab88e9a860e50009385638a7\n\n4b99b55479698ee6d1f6b69999c994e153672706af477c84cee6858240569783\n\ncc07a2baf22c94959623b1a89ed88a317dbd7a131d4cdc3eadb048f32b3a2e7b\n\n29f99f50e0aecd0e3c41c7dc1ecdfbc52fb53f734d0de99b5ff722dd07149173\n\n926a34fbae94ab7ed7fe9a596f0507031e19044c06cbbca245efb30d926ea1e5\n\nd59bceef11d49f47ec956b7bc9d3497ffc5259905cd6797ff9f5384f0ee55521\n\naf3d08fb9f2e2ba73496aebb53d36dae1d812622abd598eba27c5d483129632d\n\n\n-----\n\nac7a5bfc346193a43e6e22663c1037ca45d89a92c8bb3cefb165c359abb402c4\n\nc1ab4f0d1184df1be78d202e1a204fe187eb1649b1e912b48c6eef46af89c430\n\n37a4084541df61d1380370a59694ba6c59abebf0c8183e10abe60d17bdeacedd\n\n1b6e050c9f5fdcb04b247ef9db8fa2a6322118ed7b71c1545d39cb25a1e16131\n\n**Pony**\n\n8d60356e89c0f4d735e665bbc10c8a36589413f55efa17659c7c253d2449d54f\n\n**Spam Bot**\n\nb4e5f56345757fbea0dee5480267551c08e9d91d58960463be4928f69c89313c\n\n99824a0be3c3922c564419e5d42dbbc0ccfbbe5f4226e74afb2ec0cada18a152t\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-08-19 - New Hancitor Malware- Pimp my Downloaded.pdf"
    ],
    "report_names": [
        "2016-08-19 - New Hancitor Malware- Pimp my Downloaded.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536005,
    "ts_updated_at": 1743041119,
    "ts_creation_date": 1653774774,
    "ts_modification_date": 1653774774,
    "files": {
        "pdf": "https://archive.orkl.eu/9e19feecdde7274a4a9d42b565642a454edd98b1.pdf",
        "text": "https://archive.orkl.eu/9e19feecdde7274a4a9d42b565642a454edd98b1.txt",
        "img": "https://archive.orkl.eu/9e19feecdde7274a4a9d42b565642a454edd98b1.jpg"
    }
}