{
    "id": "67b83bcd-9ed2-4713-92fd-c91bdc98b3ec",
    "created_at": "2023-01-12T15:05:04.374243Z",
    "updated_at": "2025-03-27T02:09:39.33629Z",
    "deleted_at": null,
    "sha1_hash": "41bbe74ca0b30d2210c1b23adc3d74f53f433beb",
    "title": "2016-05-10 - Setting Sights On Retail- AbaddonPOS Now Targeting Specific POS Software",
    "authors": "",
    "file_creation_date": "2022-05-28T15:58:24Z",
    "file_modification_date": "2022-05-28T15:58:24Z",
    "file_size": 562843,
    "plain_text": "# Setting Sights On Retail: AbaddonPOS Now Targeting Specific POS Software\n\n**[proofpoint.com/us/threat-insight/post/abaddonpos-now-targeting-specific-pos-software](https://www.proofpoint.com/us/threat-insight/post/abaddonpos-now-targeting-specific-pos-software)**\n\nMay 10, 2016\n\n\n-----\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\nSetting Sights On Retail: AbaddonPOS Now Targeting Specific POS Software\n\n\n-----\n\nMay 10, 2016 Matthew Mesa, Darien Huss\n\nMuch attention has been focused recently on ransomware and other threats that go after consumers\nand businesses directly for monetary payouts. Still, point-of-sale (POS) malware continues to be an\nimportant source of stolen credit card data and associated revenue for cyber criminals.\n\nThe ongoing rollout of chip-and-pin credit cards and tighter standards following the retail megabreaches\nof 2014 have put further pressure on the POS malware black market. But as we have seen with the\nAbaddonPOS malware described here, POS malware is not just alive and well—it’s being actively\ndeveloped.\n\nOn May 5, a financially motivated actor whom Proofpoint has been tracking as TA530 (also featured in\nour previous blog post \"Phish Scales\" [1]) sent out a highly-personalized email campaign targeting\nprimarily retail companies and attempting to install TinyLoader and AbaddonPOS point-of-sale malware.\nThe retail vertical was likely chosen due to the higher likelihood of infecting a POS system. We first\nobserved AbaddonPOS when it was delivered by Vawtrak [2] in October of 2015. We have also found\nthat TinyLoader and AbaddonPOS have since been updated in several ways.\n\n**Delivery Details**\n\nThe messages we observed used subjects such as “Group Booking at [company name]” and the\npersonalized attachment names such as:\n\n[company name].doc\n\n[company name]_booking.doc\n\n[company name]_reservation.doc\n\nThe example message shown in Figure 1 uses the recipient's name in the email body and the\ncompany’s name in the email body and the attachment name. The attachment, shown in Figure 2, uses\nan interesting lure. It depicts an image of a spinner one would expect to see when content is loading\nand asks the user to enable content.\n\nClicking the “Enable Content” button enables the malicious macro, which then begins the infection by\ndownloading TinyLoader, which in turn downloads AbaddonPOS.\n\nMost of the messages we saw were delivered to retail companies (Figure 3).\n\n\n-----\n\n_Figure 1: Example email delivering TinyLoader_\n\n\n-----\n\n_Figure 2: Example document delivering TinyLoader_\n\n\n-----\n\n_Figure 3: Top targeted verticals by message volume_\n\n**Payload Analysis**\n\n**TinyLoader**\n\nThe variant of TinyLoader used in this campaign is similar to the one we previously had analyzed in\nconnection with AbaddonPOS. One significant change includes the addition of a basic 4-byte XOR layer\nof obfuscation over the shellcode that is received from the command-and-control (C&C) server (Figure\n4).\n\n\n-----\n\n_Figure 4: TinyLoader decoding and executing shellcode received from C&C_\n\nThe XOR key is dynamically generated by the C&C and is different in every session. Once the\nshellcode is decoded, execution is immediately passed to the decoded shellcode. Although the\ncontrollers of TinyLoader could theoretically perform any action through custom shellcode, we are still\nobserving this family of malware being used as a downloader. Figure 5 shows a TinyLoader response\ncontaining encoded shellcode to build a fake HTTP request used to download a payload.\n\n\n-----\n\n_Figure 5: Encoded response received from TinyLoader C&C_\n\nOnce the shellcode is decoded, the strings used to craft an HTTP request can be seen (Figure 6). After\nthis code is loaded, the TinyLoader C&C operator(s) is free to provide a target IP and URI to instruct an\ninfected bot to retrieve a payload.\n\n_Figure 6: Decoded TinyLoader shellcode used to build HTTP request_\n\nIn this campaign, we observed the initial TinyLoader payload retrieve another TinyLoader payload that\nconnected to a different C&C. This new TinyLoader infection then received another instruction to\ndownload a different payload (Figures 7 and 8), which was a new variant of AbaddonPOS.\n\n\n-----\n\n_Figure 7: TinyLoader receiving instructions to download AbaddonPOS_\n\n_Figure 8: TinyLoader HTTP request to download AbaddonPOS_\n\n**AbaddonPOS**\n\nThe AbaddonPOS downloaded in this campaign functions much like the original samples we\ndiscovered. It does, however, include a few significant changes:\n\nOptimized code for checking blacklisted processes (processes that will not be checked for credit\ncard data)\nWhitelisted process list of potential point-of-sale (POS) related process names (these are the only\nprocesses that will be scanned for POS data)\nThe exfiltration XOR key has been changed\n\nAbaddonPOS whitelisted process name checking now uses a single string of partial process names (6bytes each) concatenated together. Both the common process name blacklist and POS process name\nlist (see Process List section) are stored in allocated memory at static offsets (Fig. 8), 0x1A8 for the\nblacklist and 0x5B4 for the POS process list.\n\n_Figure 9: AbaddonPOS storing process lists for later use_\n\nAbaddonPOS utilizes both lists separately from each other. That means the common process name list\nhas no effect on the POS name list. Both lists are also checked using the exact same code. However,\ndifferent results occur based on whether execution is currently in the main thread or a spawned thread.\nThe authors use a hardcoded 0x0C0C0C0C value (Fig 10) to implement this tracking capability.\n\n\n-----\n\n_Figure 10: AbaddonPOS saving main thread identifier_\n\nBefore checking the process name against either of the lists, the running process name will first be\nconverted to lowercase (Fig. 11). Whether the current execution exists inside the main thread or a\nspawned thread is checked next. If 0x0C0C0C0C is found, then AbaddonPOS knows it is in the main\nthread and so will prepare to check process names against the common process name blacklist (Fig.\n12). If 0x0C0C0C0C is not found, then the POS process name list will be used.\n\n_Figure 11: Change uppercase letters to lowercase_\n\n_Figure 12: Utilizing process list depending on whether execution is in main or spawned thread_\n\nSimilar to older AbaddonPOS variants, the first 4-bytes of the process name will be checked first (Fig.\n13, A). If they are equal, then the next 2-bytes are checked (Fig. 13, B). If the second check was\nsuccessful then thread context will be checked again (Fig. 13, C). If the current execution is in the main\nthread then the current process will be skipped (Fig. 13, D), while in a spawned thread context the\nprocess would be opened and searched for POS data (Fig. 13, E).\n\nDepending on which context is being executed, different behavior will occur when the process name\nbeing checked does not match anything in the hard coded lists. If in the main execution context and no\nmatches were found, then the process will be opened and checked for POS data (Fig. 13, F), while if in\na spawned thread context, the process would not be opened and checked (Fig. 13, G).\n\nThis peculiar implementation effectively nullifies the POS process name list because the main thread\nwould eventually search for POS data in all processes not matching the common process name\nblacklist, including all of the POS processes.\n\nThis implementation could result from a mistake on the part of the malware author, but it seems more\nlikely that the author is testing various blacklist/whitelist implementations in this sample. Dedicating a\nthread to only processes with known POS-related names ensures a thread is always scanning those\nprocesses more often vs. the main thread used to scan all non-system related processes. Also, it would\nnot be surprising to eventually see AbaddonPOS variants that contain only the common process name\nmethod or POS process name method rather than both.\n\n\n-----\n\nFigure 13. Process name comparison code\n\nSome minor changes were also made to the way stolen credit card data is exfiltrated. First, the IP\naddress is no longer stored as an ASCII string (Fig. 14). That also means the inet_addr API is no longer\nneeded. Finally, the hardcoded XOR key was changed to 0x4C5D6E7F (Fig. 15).\n\nFigure 14: Hardcoded C&C IP address and port\n\nFigure 15: New exfiltration XOR key\n\n\n-----\n\nAlthough the second XOR key was changed, the overall method of encoding and exfiltration of the data\nhas stayed almost identical (Fig. 16, 17) when compared to our previous analysis.\n\nFigure 16: Encoded exfiltrated credit card data\n\nFigure 17: Decoded exfiltrated credit card data\n\n**Conclusion**\n\nWe continue to see TA530 periodically send email-borne threats to target point-of-sale systems using\npersonal details to increase the chances of infection.\n\nTinyLoader and AbaddonPOS are under active development. We expect both to continue to appear in\nemail attacks as cybercriminals target point-of-sale systems to harvest credit card data. Despite\nchanges in the credit-card landscape and more stringent PCI DSS compliance requirements, credit\ncard-related cybercrime remains profitable for threat actors when it can be conducted at scale.\nComprehensive email, network, and endpoint protection—along with user education—remain the best\nways to protect systems and customer data.\n\n**References**\n\n[1] [https://www.proofpoint.com/us/threat-insight/post/phish-scales-malicious-actor-target-execs](https://www.proofpoint.com/us/threat-insight/post/phish-scales-malicious-actor-target-execs)\n\n[2] https://www.proofpoint.com/us/threat-insight/post/AbaddonPOS-A-New-Point-Of-Sale-Threat-LinkedTo-Vawtrak\n\n**AbaddonPOS Process Lists**\n\n**Common process name blacklist**\n\n_cmd.ex_\n\n_conhos_\n\n_dllhos_\n\n_excel._\n\n_explor_\n\n_lsass._\n\n_mmc.ex_\n\n\n-----\n\n_dwm.ex_\n\n_csrs.e_\n\n_winlog_\n\n_clamsc_\n\n_regsvr_\n\n_mobsyn_\n\n_rundll_\n\n_runonc_\n\n_spools_\n\n_svchos_\n\n_taskho_\n\n_winwor_\n\n_system_\n\n_winini_\n\n_smss.e_\n\n_lsm.ex_\n\n_csrss._\n\n_search_\n\n_notepa_\n\n**POS process name list**\n\n_active_\n\n_mercur_\n\n_ocius4_\n\n_rs232m_\n\n_sdpdvk_\n\n_sihot._\n\n_unilec_\n\n_focus8_\n\n\n-----\n\n_ehubem_\n\n_fdfdo._\n\n_cashbo_\n\n_cps.po_\n\n_powerp_\n\n_saleso_\n\n_finedi_\n\n_pointo_\n\n_infigm_\n\n_adrm.e_\n\n_afr38._\n\n_aldelo_\n\n_araavl_\n\n_aracs._\n\n_bestpo_\n\n_bosrv._\n\n_cardau_\n\n_cashcl_\n\n_checki_\n\n_cre200_\n\n_cross._\n\n_crosss_\n\n_cxsret_\n\n_ddcdsr_\n\n_dovepo_\n\n_dsihea_\n\n_eagles_\n\n_electr_\n\n\n-----\n\n_fincha_\n\n_invent_\n\n_isspos_\n\n_issret_\n\n_magtek_\n\n_nails1_\n\n_omnipo_\n\n_paymen_\n\n_paymen_\n\n_pixela_\n\n_pos24f_\n\n_posini_\n\n_prm.cl_\n\n_ptserv_\n\n_qbdbmg_\n\n_qbpos._\n\n_qbposs_\n\n_retail_\n\n_rmposl_\n\n_roomke_\n\n_rpro8._\n\n_rwpos._\n\n_sales3_\n\n_soposu_\n\n_spaint_\n\n_telefl_\n\n_transa_\n\n_utg2sv_\n\n\n-----\n\n_visual_\n\n_wickr._\n\n_xcharg_\n\n**Indicators of Compromise (IOC)**\n\n**_Table 1: Indicators of Compromise_**\n\n**IOC** **IOC**\n**Type**\n\n7dc57aef76a1ddb5eef7bfd1a1350e1e951b5f216bfc805f51796545d04d80a0 SHA56\nHash\n\ne5fbfd61b19561a4c35d1f7aa385f4ca73a65adb2610504398e4ca47c109bace SHA56\nHash\n\nb30ee5185c7f649da42efabe9512d79adcaa53f3f3647e0025b7c68bf7cc8734 SHA56\nHash\n\n24e39756c5b6bdbdc397dabde3ece587cdb987af9704d5e5329e00b5b2aaa312 SHA56\nHash\n\n\n**Description**\n\nExample\nmacro\ndocument\n\nInitial\nTinyLoader\ndownload\n\nTinyLoader\nupdate\n\nAbaddonPOS\n\n\n\n[hxxp://dolcheriva[.]com/img/del/a/cg-bn/word.exe] URL Example\nTinyLoader\ndownload\n\n[hxxp://50.7.124[.]178/file.e] URL Example\nTinyLoader\nupdate\ndownload\n\n[hxxp://85.93.5[.]136/ZRH4J2/P_KYJ3gxEhTpasmJxz.d] URL Example\nAbaddonPOS\ndownload\n\n50.7.124[.]178:30010 IP TinyLoader\nC2\n\n85.93.5[.]136:50010 IP TinyLoader\nC2\n\n85.93.5[.]136:50011 IP AbaddonPOS\nC2\n\nCHAMEL1ON Mutex TinyLoader\nmutex\n\n_Select ET Signatures that would fire on such traffic:_\n\n2022658 || ET CURRENT_EVENTS Possible Malicious Macro DL EXE Feb 2016 (WinHTTPRequest)\n\n2812523 || ETPRO TROJAN TinyLoader C CnC Beacon x86\n\n\n-----\n\n2812524 || ETPRO TROJAN TinyLoader.C CnC Beacon x64\n\n2814778 || ETPRO TROJAN TinyLoader.D CnC Beacon x86\n\n2814779 || ETPRO TROJAN TinyLoader.D CnC Beacon x64\n\n2814803 || ETPRO TROJAN Win64.TinyLoader CnC Beacon\n\n2814810 || ETPRO TROJAN TinyDownloader Retrieving PE\n\n2816697 || ETPRO TROJAN AbaddonPOS Exfiltrating CC Numbers 5\n\n2816698 || ETPRO TROJAN AbaddonPOS Exfiltrating CC Numbers 6\n\n2816699 || ETPRO TROJAN AbaddonPOS Exfiltrating CC Numbers 7\n\n2816700 || ETPRO TROJAN AbaddonPOS Exfiltrating CC Numbers 8\n\nSubscribe to the Proofpoint Blog\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-05-10 - Setting Sights On Retail- AbaddonPOS Now Targeting Specific POS Software.pdf"
    ],
    "report_names": [
        "2016-05-10 - Setting Sights On Retail- AbaddonPOS Now Targeting Specific POS Software.pdf"
    ],
    "threat_actors": [
        {
            "id": "f8fd6c94-f1bf-43b8-8613-edc46ca097ee",
            "created_at": "2022-10-25T16:07:24.285532Z",
            "updated_at": "2025-03-27T02:02:10.160396Z",
            "deleted_at": null,
            "main_name": "TA530",
            "aliases": [],
            "source_name": "ETDA:TA530",
            "tools": [
                "AbaddonPOS",
                "August Stealer",
                "Bugat v5",
                "CryptoWall",
                "Dofoil",
                "Dridex",
                "Gozi ISFB",
                "H1N1",
                "H1N1 Loader",
                "ISFB",
                "Nymaim",
                "Pandemyia",
                "Sharik",
                "Smoke Loader",
                "SmokeLoader",
                "SpY-Agent",
                "TVRAT",
                "TVSpy",
                "TeamSpy",
                "TeamViewerENT",
                "TinyLoader",
                "nymain"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "af77521e-c35f-4030-a95d-bcd1eaeeaac1",
            "created_at": "2023-01-06T13:46:38.476089Z",
            "updated_at": "2025-03-27T02:00:02.843358Z",
            "deleted_at": null,
            "main_name": "TA530",
            "aliases": [],
            "source_name": "MISPGALAXY:TA530",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535904,
    "ts_updated_at": 1743041379,
    "ts_creation_date": 1653753504,
    "ts_modification_date": 1653753504,
    "files": {
        "pdf": "https://archive.orkl.eu/41bbe74ca0b30d2210c1b23adc3d74f53f433beb.pdf",
        "text": "https://archive.orkl.eu/41bbe74ca0b30d2210c1b23adc3d74f53f433beb.txt",
        "img": "https://archive.orkl.eu/41bbe74ca0b30d2210c1b23adc3d74f53f433beb.jpg"
    }
}