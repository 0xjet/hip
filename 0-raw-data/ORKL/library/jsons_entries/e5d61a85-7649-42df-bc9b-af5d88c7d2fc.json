{
    "id": "e5d61a85-7649-42df-bc9b-af5d88c7d2fc",
    "created_at": "2022-10-25T16:48:11.897403Z",
    "updated_at": "2025-03-27T02:05:30.53221Z",
    "deleted_at": null,
    "sha1_hash": "6e20a79dbcbfb4449a38878bc5652538b6ac6c7f",
    "title": "",
    "authors": "",
    "file_creation_date": "2017-10-27T03:04:43Z",
    "file_modification_date": "2017-10-27T03:04:43Z",
    "file_size": 1274883,
    "plain_text": "**June 14, 2017**\n\n### Phantom of the Opaera: New KASPERAGENT Malware Campaign\n\n\nIn **[Blog,](https://www.threatconnect.com/category/blog/)** **[Featured Article,](https://www.threatconnect.com/category/featured-article/)** **[Threat Research](https://www.threatconnect.com/category/threat-research-team/)**\n\n\n## KASPERAGENT Malware Campaign resurfaces in the run up to May Palestinian Authority Elections\n\n###### ThreatConnect has identi�ed a KASPERAGENT malware campaign\n\n leveraging decoy Palestinian Authority documents. The samples date\n\n from April - May 2017, coinciding with the run up to the May 2017\n\n Palestinian Authority elections. Although we do not know who is behind\n\n the campaign, the decoy documents’ content focuses on timely political\n\n issues in Gaza and the IP address hosting the campaign’s command and\n\n control node hosts several other domains with Gaza registrants.\n\n In this blog post we will detail our analysis of the malware and\n\n associated indicators, look closely at the decoy �les, and leverage\n\n available information to make an educated guess on the possible\n\n intended target. Associated indicators and screenshots of the decoy\n\n documents are all available here\n\n\n-----\n\n###### campaign=4219181] in the ThreatConnect platform.\n\n Some of the indicators in the following post were published on\n\n AlienVault OTX on 6/13.\n\n#### Background on KASPERAGENT\n\n###### KASPERAGENT is Microsoft Windows malware used in e�orts targeting\n\n users in the United States, Israel, Palestinian Territories, and Egypt since\n\n July 2015. The malware was discovered by Palo Alto Networks Unit 42\n\n and ClearSky Cyber Security, and publicized in April 2017 in the Targeted\n\n Attacks in the Middle East Using KASPERAGENT and MICROPSIA\n\n [https://researchcenter.paloaltonetworks.com/2017/04/unit42-targeted\n attacks-middle-east-using-kasperagent-micropsia/] blog. It is called\n\n KASPERAGENT based on PDB strings identi�ed in the malware such as\n\n “c:\\Users\\USA\\Documents\\Visual Studio 2008\\Projects\\New folder\n\n (2)\\kasper\\Release\\kasper.pdb.”\n\n The threat actors used shortened URLs in spear phishing messages and\n\n fake news websites to direct targets to download KASPERAGENT. Upon\n\n execution, KASPERAGENT drops the payload and a decoy document that\n\n displays Arabic names and ID numbers. The malware establishes\n\n persistence and sends HTTP requests to the command and control\n\n domain mailsinfo[.]net. Of note, the callbacks were to PHP scripts that\n\n included /dad5/ in the URLs. Most samples of the malware reportedly\n\n function as a basic reconnaissance tool and downloader. However,\n\n some of the recently identi�ed �les display “extended\n capability” including the functionality to steal passwords, take\n\n screenshots, log keystrokes, and steal �les. These “extended-capability”\n\n samples called out to an additional command and control domain,\n\n stikerscloud[.]com. Additionally, early variants of KASPERAGENT used\n\n “Chrome” as the user agent, while more recent samples use “OPAERA” \n\n-----\n\n###### Technical Blogs and Reports source here\n\n [https://app.threatconnect.com/auth/incident/incident.xhtml?\n\n incident=4003314] .\n\n The samples we identi�ed leverage the same user agent string “OPAERA\n\n [https://app.threatconnect.com/auth/indicators/details/customIndicator.xhtml\n\n id=29927402&owner=Common+Community] ”, included the kasper PDB\n\n string reported by Unit 42, and used similar POST and GET requests. The\n\n command and control domains were di�erent, and these samples used\n\n unique decoy documents to target their victims.\n\n#### Identifying another KASPERAGENT campaign\n\n###### We didn’t start out looking for KASPERAGENT, but a �le hit on one of our\n\n YARA rules for an executable designed to display a fake XLS icon - one\n\n way adversaries attempt to trick targets into thinking a malicious �le is\n\n innocuous. The �rst malicious sample we identi�ed\n\n (6843AE9EAC03F69DF301D024BFDEFC88\n\n [https://app.threatconnect.com/auth/indicators/details/�le.xhtml?\n\n �le=6843AE9EAC03F69DF301D024BFDEFC88] ) had the �le name\n\n “testproj.exe” and was identi�ed within an archive �le\n\n (4FE7561F63A71CA73C26CB95B28EAEE8\n\n [https://app.threatconnect.com/auth/indicators/details/�le.xhtml?\n\n �le=4FE7561F63A71CA73C26CB95B28EAEE8] ) with the name “ﺍﻟﺗﻔﺎﺻﻳﻝ\n\n ﻓﻘﻬﺎء ﻷﻏﺗﻳﺎﻝ ﺍﻟﻛﺎﻣﻠﺔ.r24”. This translates to “The Complete Details of Fuqaha's\n\n Assassination”, a reference to Hamas military leader Mazen Fuqaha who\n\n was assassinated\n\n [https://www.nytimes.com/2017/03/27/world/middleeast/mazen\n fuqaha-hamas-killing-israel.html] on March 24, 2017.\n\n We detonated the �le in VxStream’s automated malware analysis\n\n\n-----\n\n###### and found testproj.exe dropped a benign Microsoft Word document\n\n that pulls a jpg �le from treestower[.]com\n\n [https://app.threatconnect.com/auth/indicators/details/host.xhtml?\n\n host=www.treestower.com&owner=Common+Community] . Malwr.com\n\n observed this site in association with another sample that called out\n\n to mailsinfo[.]net - a host identi�ed in the Targeted Attacks in the Middle\n\n East Using KASPERAGENT and MICROPSIA\n\n [http://researchcenter.paloaltonetworks.com/2017/04/unit42-targeted\n attacks-middle-east-using-kasperagent-micropsia/] blog. That was our\n\n �rst hint that we were looking at KASPERAGENT.\n\n The jpg pulled from treestower[.]com displays a graphic picture of a\n\n dead man, which also appeared on a Palestinian news website\n\n discussing the death of Hamas military leader Mazen Fuqaha. A\n\n separate malicious executable \n 2DE25306A58D8A5B6CBE8D5E2FC5F3C5 [https://www.hybrid\n analysis.com/sample/5d329690a606857871f007b990b78f876c57a571b38cafd5\n\n environmentId=100] (vlc.exe) - runs when the photograph is displayed,\n\n using the YouTube icon and calling out to several URLs on\n\n windowsnewupdates[.]com\n\n [https://app.threatconnect.com/auth/indicators/details/host.xhtml?\n\n host=windowsnewupdates.com&owner=Common+Community] . This\n\n host was registered in late March and appears to be unique to this\n\n campaign.\n\n With our interest piqued, we pivoted on the import hashes (also known\n\n as an imphash), which captures the import table of a given �le. Shared\n\n import hashes across multiple �les would likely identify �les that are\n\n part of the same malware family. We found nine additional samples\n\n sharing the imphash values for the two executables,\n\n C66F88D2D76D79210D568D7AD7896B45\n\n [https://app.threatconnect.com/auth/browse/index.xhtml?\n\n �lters=typeName%20in%20(%22Address%22%2C%20%22EmailAddress%22%2\n\n\n-----\n\n###### [https://app.threatconnect.com/auth/browse/index.xhtml?\n\n �lters=typeName%20in%20(%22Address%22%2C%20%22EmailAddress%22%2\n\n .\n\n Import Hash Results c66f88d2d76d79210d568d7ad7896b45\n\n Import Hash Results dcf3aa484253068d8833c7c5b019b07a\n\n Analysis of those �les uncovered two more imphashes,\n\n 0B4E44256788783634A2B1DADF4F9784\n\n [https://app.threatconnect.com/auth/browse/index.xhtml?\n\n �lters=typeName%20in%20(%22Address%22%2C%20%22EmailAddress%22%2\n\n\n-----\n\n###### [https://app.threatconnect.com/auth/browse/index.xhtml?\n\n �lters=typeName%20in%20(%22Address%22%2C%20%22EmailAddress%22%2\n\n, for a total of 20 malicious �les. These additional samples behaved\n\n similarly to the initial �les; testproj.exe dropped benign decoy �les and\n\n started malicious executables. The malicious executables all called out\n\n to the same URLs on windowsnewupdates[.]com.\n\n These malware samples leverage the user agent string “OPAERA,” the\n\n same one identi�ed in the Targeted Attacks in the Middle East Using\n\n KASPERAGENT and MICROPSIA\n\n [http://researchcenter.paloaltonetworks.com/2017/04/unit42-targeted\n attacks-middle-east-using-kasperagent-micropsia/] blog. Although the\n\n command and control domain was di�erent from those in the report,\n\n the POST and GET requests were similar and included /dad5/ in the URL\n\n string. In addition, the malware samples included the kasper PDB string\n\n reported by Unit 42, prompting us to conclude that we were likely\n\n looking at new variants of KASPERAGENT.\n\n#### The Decoy Files\n\n###### Several of the decoy �les appeared to be o�cial documents associated\n\n with the Palestinian Authority - the body that governs the Palestinian\n\n Territories in the Middle East. We do not know whether the �les are\n\n legitimate Palestinian Authority documents, but they are designed to\n\n look o�cial. Additionally, most of the decoy �les are publicly available\n\n on news websites or social media.\n\n The �rst document - dated April 10, 2017 - is marked “Very Secret” and\n\n addressed to Yahya Al-Sinwar, who Hamas elected as its leader in Gaza\n\n in February 2017. Like the photo displayed in the �rst decoy �le we\n\n found, this document references the death of Mazen Fuqaha. The\n\n Arabic-language text and English translation of the document are\n\n\n-----\n\n###### document=4219292] . A screenshot of the �le is depicted below.\n\n The second legible �le, dated April 23, has the same letterhead and also\n\n is addressed to Yahya al-Sinwar. This �le discusses the supposed\n\n announcement banning the rival Fatah\n\n [https://en.wikipedia.org/wiki/Fatah] political party, which controls the\n\n West Bank, from Gaza. It mentions closing the Fatah headquarters and\n\n houses that were identi�ed as meeting places as well as the arrest of\n\n some members of the party\n\n\n-----\n\n#### Looking at the Infrastructure\n\n###### We don’t know for sure who is responsible for this campaign, but\n\n digging into the passive DNS results led us to some breadcrumbs.\n\n Starting with 195.154.110[.]237\n\n [https://app.threatconnect.com/auth/indicators/details/address.xhtml?\n\n address=195.154.110.237&owner=Common+Community], the IP\n\n address which is hosting the command and control domain\n\n\n-----\n\n###### server.\n\n ThreatConnect DomainTools Integration Results\n\n Using our Farsight DNSDB integration, we identi�ed other domains\n\n currently and previously hosted on the same IP.\n\n\n-----\n\n###### Two of the four domains that have been hosted at this IP since 2016 -\n up�le2box[.]com and 7aga[.]net -- were registered by a freelance web\n\n developer in Gaza, Palestine. This IP has been used to host a small\n\n number of domains, some of which were registered by the same actor,\n\n suggesting the IP is dedicated for a single individual or group’s use.\n\n While not conclusive, it is intriguing that the same IP was observed\n\n hosting a domain ostensibly registered in Gaza AND the command and\n\n control domain associated with a series of targeted attacks leveraging\n\n Palestinian Authority-themed decoy documents referencing Gaza.\n\n#### Targeting Focus?\n\n###### Just like we can’t make a de�nitive determination as to who conducted\n\n this campaign, we do not know for sure who it was intended to target.\n\n What we do know is that several of the malicious �les were submitted to\n\n a public malware analysis site from the Palestinian Territories. This tells\n\n us that it is possible either the threat actors or at least one of the targets\n\n is located in that area. Additionally, as previously mentioned, the decoy\n\n document subject matter would likely be of interest to a few di�erent\n\n potential targets in the Palestinian Territories. Potential targets such as\n\n Hamas who controls the Gaza strip and counts Mazen Fuqaha and\n\n Yahya al-Sinwar as members, Israel which is accused of involvement in\n\n the assassination of Mazen Fuqaha\n\n [https://www.nytimes.com/2017/03/27/world/middleeast/mazen\n fuqaha-hamas-killing-israel.html], and the Fatah party of which the\n\n Prime Minister and President of the Palestinian Authority are members.\n\n The campaign corresponds with a period of heightened tension in Gaza.\n\n Hamas, who has historically maintained control over the strip, elected\n\n Yahya al-Sinwar - a hardliner from its military wing - as its leader in\n\n February. A Humanitarian Bulletin\n\n\n-----\n\n###### Humanitarian A�airs indicates in March 2017 (just before the �rst\n\n malware samples associated with this campaign were identi�ed in early\n\n April) Hamas created “a parallel institution to run local ministries in\n\n Gaza,” further straining the relationship between Hamas and the\n\n Palestinian Authority who governs the West Bank. After this\n\n announcement, the Palestinian Authority cut salaries for its employees\n\n in Gaza by 30 percent and informed Israel that it would no longer pay\n\n for electricity provided to Gaza\n\n [https://www.nytimes.com/2017/04/27/world/middleeast/palestinian\n authority-hamas-gaza-electricity.html] causing blackouts throughout the\n\n area and escalating tensions between the rival groups. Then, in early\n\n May (two days after the last malware sample was submitted) the\n\n Palestinian Authority held local elections\n\n [http://abcnews.go.com/International/wireStory/palestinian-west-bank\n local-elections-test-fatah-party-47389952] in the West Bank which were\n\n reportedly seen as a test for the Fatah party. Elections were not held in\n\n Gaza.\n\n All of that is to say, the decoy documents leveraged in this campaign\n\n would likely be relevant and of interest to a variety of targets in Israel\n\n and Palestine, consistent with previously identi�ed KASPERAGENT\n\n targeting patterns. Additionally, the use of what appear to be carefully\n\n crafted documents at the very least designed to look like o�cial\n\n government correspondence suggests the malware may have been\n\n intended for a government employee or contractor who would be\n\n interested in the documents’ subject matter. More associated indicators,\n\n screenshots of many of the decoy documents, and descriptions of the\n\n activity are available via the March - May 2017 Kasperagent Malware\n\n Leveraging WindowsNewUpdates[.]com Campaign\n\n [https://app.threatconnect.com/auth/campaign/campaign.xhtml?\n\n campaign=4219181] in ThreatConnect.\n\n\n-----\n\n##### ABOUT THE AUTHOR\n\nThe ThreatConnect Research Team: is an elite group of globally\nacknowledged cybersecurity experts, dedicated to tracking down\n\nexisting and emerging cyber threats. We scrutinize trends,\n\ntechnology and socio-political motivators to develop comprehensive\n\nknowledge of the cyber landscape. Then, we share what we’ve\n\nlearned so that you can protect your organization, and your team\n\ncan take precise action against threats.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2017/2017.06.14.KASPERAGENT/KASPERAGENT.pdf"
    ],
    "report_names": [
        "KASPERAGENT"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716491,
    "ts_updated_at": 1743041130,
    "ts_creation_date": 1509073483,
    "ts_modification_date": 1509073483,
    "files": {
        "pdf": "https://archive.orkl.eu/6e20a79dbcbfb4449a38878bc5652538b6ac6c7f.pdf",
        "text": "https://archive.orkl.eu/6e20a79dbcbfb4449a38878bc5652538b6ac6c7f.txt",
        "img": "https://archive.orkl.eu/6e20a79dbcbfb4449a38878bc5652538b6ac6c7f.jpg"
    }
}