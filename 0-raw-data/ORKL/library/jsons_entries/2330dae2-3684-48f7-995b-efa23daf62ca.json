{
    "id": "2330dae2-3684-48f7-995b-efa23daf62ca",
    "created_at": "2023-01-12T15:06:07.462951Z",
    "updated_at": "2025-03-27T02:16:59.179814Z",
    "deleted_at": null,
    "sha1_hash": "e50829265c38dc596e20b1894f5591aeb63c60ea",
    "title": "2020-07-06 - The Gafgyt variant vbot seen in its 31 campaigns",
    "authors": "",
    "file_creation_date": "2022-05-28T15:17:27Z",
    "file_modification_date": "2022-05-28T15:17:27Z",
    "file_size": 553201,
    "plain_text": "# The Gafgyt variant vbot seen in its 31 campaigns\n\n**[blog.netlab.360.com/the-gafgyt-variant-vbot-and-its-31-campaigns/](https://blog.netlab.360.com/the-gafgyt-variant-vbot-and-its-31-campaigns/)**\n\nLIU Ya July 6, 2020\n\n6 July 2020\n\n## Overview\n\nGafgyt botnets have a long history of infecting Linux devices to launch DDoS attacks. While\ndozens of variants have been detected, new variants are constantly emerging with changes\nin terms of register message, exploits, and attacking methods. On the other hand, their new\nbotnets are usually short lived, with most of the C2s watched keeping active for only a few\ndays. In this blog, I will introduce such a sort of variant. The key findings are as follow:\n\n1. This variant was active from mid-April to mid-June. In total 31 campaigns for this\n\nvariant were detected, from which 572 samples were captured. They were spread to\nbuild 19 botnets.\n2. This variant evolved through 2 versions. Both have a characteristic register message\n\ntemplate “ver:%f:%s:%d” that includes a rarely seen format specifier “%f”.\n3. Mirai code was heavily used in both versions, which makes it possible analyze them\n\nwith the extracted Mirai configurations.\n4. The same infrastructures, e.g., download servers, and filenames were observed being\n\nused in other families of botnet campaigns.\n\nThis variant was named as vbot because vbot is found being used in an unstripped\nsample by the author. Accordingly the 2 versions are named as vbot1 and vbot2 in this\nblog.\n\n## vbot1\n\nOnly 1 vbot1 campaign was seen, with 26 samples captured, as shown by the following\nhoneypot records.\n\n\n-----\n\nAll samples share the same C2 `185.225.19.200:2017 . Since in Gafgyt it’s common that`\nthe same source code will be compiled into binaries for different processor architectures, for\nsimplicity, the following analysis is based on the unstripped ARM sample of\n```\nf696375452d08eecbde14d64c74acdde . Compared with previous variants, vbot1 has a\n\n```\nmore concise main() function because most of its code was moved into 2 new functions\nnamed init_vbot() and main_c2_handler().\n\nThe function name init_vbot indicates that the author code named their botnet as vbot. It's\nresponsible for initializing things including watchdog, configurations, and scanner. C2\ncommunications are done in main_c2_handler(), where a loop of connection, registration and\nreceiving command can be found, as shown below.\n\n\n-----\n\nThe characteristic register message template `“ver:%f:%s:%d” is used in the registration`\nblock that tightly follows the connection block. From the unstripped symbols we can show\nthat the 3 specifiers separately represent version, bot type and arch. The analyzed sample\nhas version of 4.1.\n\nActually it’s just the rarely seen specifier `“%f” that caused my attention to this variant`\nbecause as far as I knew “%f” was not supported by Gafgyt. The original authors borrowed\nthe design of C library functions `printf and` `sprintf, and implemented a new function`\nnamed `sockprintf which can generate message according to the assigned string format`\nand send it to the C2. A custom yet simple format controls is done inside sockprintf with “%f”\nnot implemented. That function has been kept by most Gafgyt variants. When firstly\nencountering vbot’s register template, I imagined a new version of sockprintf. However, that’s\nobviously not true. To reuse sockprintf but avoid complex programming, vbot author turned to\nsprintf to generate the expected message then passed it to sockprintf with the supported\nspecifier `“%s” .`\n\nSimilar to many Gafgyt variants, Mirai code can be found in vbot1. Due to its tight connection\nwith the encrypted configurations, the borrowed code can be well analyzed with the extracted\n[configurations. If you don’t know how to extract, please go to our VB2018 paper. The](https://www.virusbulletin.com/uploads/pdf/magazine/2018/VB2018-Liu-Wang.pdf)\nextracted configurations are shown below, with items annotated with its owner modules.\n\n\n-----\n\n-----\n\nThe commands are hidden in configurations. Except for attacking methods, vbot1 also\nsupports remote update with the command `UPDATE . Another worth mentioning feature is`\npersistence mechanism, which is done by modifying crontab.\n\nIt’s strange that vbot1 was spread only once. After its campaign was firstly detected, 35\nhours, or 1.5 days, later the first vbot2 campaign was seen from the same download server.\nObviously the operators wanted to replace vbot1 with vbot2. The reason might be its buggy\nregistration which always sends a 191-byte register message back to its C2 but only 18\nbytes there are really useful, as shown by the following figure.\n\n## vbot2\n\nIn total 30 vbot2 campaigns were seen from April 16 to June 12, 2020, with 546 samples\ncaptured from 12 download servers. From those samples 13 C2 servers were checked.\nDetailed analysis shows except the registration code, vbot2 actually differs a lot from vbot1 in\nterms of code structure, attacking methods and Mirai configuration. The following analysis is\nbased on the x86 sample `f5b0ebebc924e69e34a4ddd145916594 . It’s stripped but key`\nfunction names have been manually restored.\n\nDifferent from vbot1 but similar to many other variants, vbot2's C2 communications are done\nin main(), as shown below.\n\n\n-----\n\nNearly the same registration block as vbot1 can be found, with the 3 specifiers holding the\nsame semantics. The analyzed sample has version of 1.5. The loop composed of\n“loc_804B80B -> REGISTRATION -> loc_804B863” is very similar to previous Gafgyt\nvariants in terms of CFG node number and semantics. The blocks are separately responsible\nfor establishing connection, registration, and receiving commands.\n\n5 attacking methods were checked. All of them have been seen in other variants.\n\n\n-----\n\nSome vbot2 samples, e.g., `e36d96a74236038a348cfd667ca83528, have slightly different`\nattacking method names, as shown below.\n\n2 Mirai configurations were found. The only difference lies in the 0x28 item, as shown by the\nfollowing 2 figures.\n\nFrom the annotations we can see the Mirai code was mainly used in modules of watchdog,\nkiller, scanner and rand alpha string generation. Since the 0x28 item corresponds to a\nmessage to be written to the STDOUT, and the second unprintable 0x28 item is probably\n\n\n-----\n\ncaused by a typo from the author.\nWith the extracted configurations the differences from vbot1 are obvious. They are:\n\n1. vbot2 has different attacking methods from vbot1.\n2. While vbot1 hides commands in its configuration, vbot2 directly uses them.\n3. No remote update and persistence mechanism were found in vbot2.\n\nAlthough those great differences suggest that vbot1 and vbot2 were actually derived from\ndifferent code bases, I still think they were written by the same author(s) because:\n\n1. The shared register message template and registration implementation are unique\n\nenough.\n2. The first vbot2 campaign shared the same download and C2 server as vbot1 within a\n\nrelatively short period of time (1.5 days).\n\n## vbot and the RHOMBUS malware\n\nWhile the filename RHOMBUS was seen 4 times in vbot campaigns, its use in Gafgyt\n[campaigns was much earlier[1], with the variant called RHOMBUS analysed in [2][3]. Here I](https://twitter.com/_odisseus/status/1232957932121313281)\nmake a simple comparison. In the blogged RHOMBUS malware dropper mechanism was\nfound, with the dropper having the persistence ability across restart by modifying crontab.\nThe dropped binaries, e.g., `269029c1554b13c3eccfaacf0196ff72 and`\n```\nba42665872ea41e3d2edd8978bc38c24, actually belong to another Gafgyt variant that also\n\n```\nheavily borrowed code from Mirai, as shown by the below figure.\n\n\n-----\n\nFrom the above configuration we can see that obvious similarities exist between the\nRHOMBUS dropped binaries and vbot1. I think the most possibility is that vbot1 evolved from\nRHOMBUS malware with the following modifications:\n\n1. The dropper’s persistence mechanism was grafted to its payload. That’s why\n\npersistence items could be found in vbot1 configuration but not in the above figure.\n2. The register template was updated.\n3. c2 communications were moved to the so called main_c2_handler() function.\n\nOther key points about RHOMBUS malware include:\n\n1. The register message template is \"jm:_:%d\" or jm:%s:%d.\n2 Similar to many Gafgyt variants C2 communications were done in main()\n\n\n-----\n\n3. The Gafgyt characteristic function initConnection() was removed with its code broken\n\ndown into snippets that can be found in main().\n\n## Conclusion\n\nI have introduced a short lived Gafgyt variant vbot. During its 2 month life, 31 campaigns\nwere seen to build 19 botnets. From vbot we can learn that it’s easy for Linux IoT botnet\nauthors to quickly write new variants, which might be due to the fact that dozens of Gafgyt\nand Mirai source has been leaked online. Once a new variant is written, the behind operators\nusually will spread it over and over with different campaigns to build multiple botnets. Such\npatterns have also been observed in other variants and families, e.g., Mirai. To fight such sort\nof fast emerging while short living botnets, automatic IoC extraction would play an import role\n[for quick blocking or tracking. In VB2020 conference to be held in October, I will give a talk](https://www.virusbulletin.com/conference/vb2020/abstracts/lightweight-emulation-based-ioc-extraction-gafgyt-botnets)\non that topic. I hope it will help you fight against Gafgyt botnets better.\n\n## IoC\n\n### download servers\n```\n104.244.75.12\n142.11.194.209\n185.172.110.248\n185.172.110.249\n185.225.19.200\n192.119.66.66\n192.129.188.98\n205.185.123.101\n23.254.164.76\n45.84.196.148\n50.115.173.131\n85.92.108.211\n\n vbot1 MD5\n\n```\n\n-----\n\n```\n2a141cd2930536f74f51fb57adbb0236\n8717baf17660d8e96813ccd99f32c0be\ncc559b487e1ec18727f37006bd3395e0\nf666c3398601cd1b017f8d4556cabbbc\n6fb6aaa253c165636ee63a4fdcdb1b9e\nf422707ac869240bfeea648b6f9b90ad\n36997fd129a5ff09311da94c3814379c\n790ae71c097662bf6efba92d2d633076\ne420df68941cc7ce2d8dd4ba92fd360e\n3e36440871a6e39ee87e6d7d1a42155a\nae50829a02e5265c590f2fff35e64c52\n09ab7435c76df627a813fb75db15ce5d\n43ee98318945a475b555045aed4f0e01\ne4db8addb5123021e358576157e5e1c0\n4147fb0fe442173558f86fe37728ecae\n846d6ad9ea86e331f2e071eac6a269de\n40b1bf1e415ae508f8a5b831c2f4e994\nf696375452d08eecbde14d64c74acdde\n98b07b087b98b8d679c9938b16ae4df3\naea960687f0e43b465198be7ffafcf82\n3d596d37fe6536a2c759923d920f3e08\n52c462f3b22646774219f91bfb44ae66\nd2c273e758fd4ac2759ca1d63aafcf6c\nbbee73ed05730ad95df7a77241207ea5\n0f492673eb249fa1209512575040f62d\n0e59d4a40bba390314ffa0713b18441c\n\n### vbot1 C2\n185.225.19.200 -port 2017\n\n vbot2 MD5\nefabd7e734490b9ad12812982347f237\n614581bba324c3550a18268a8cb9c221\n86310b514c55d31db288a2bb2c1e6114\n76d9c69036f1eaac8f7a90eba3a36bfc\ne36d96a74236038a348cfd667ca83528\nd45da804fd35cf502bf942ebfeb64064\n90a633f30bdbb2b80642bb229d1605d1\nc4391301645cc9df4da3657f4c88f7dc\n8bef47e420d0cdf8d0ee69a5d1f5b74c\n4c8cdcbaf16f39a461b0bf7052fe1ec3\nd936a9226fbbe97993bbe604c8cd5458\n125b99cc79808679a7461f1841fd80a5\n3b7da3d39db6ec08373c1e4af79aff85\n23f764f5f918746b9ffff952dd25cc21\n6f24268273573fd5f07cacb00031f1a0\necae928b4e4093489bd221986da39aba\nd883d5a2bedf0c3a3da79358c06fa429\n3e26626d4563f3199fde498d0ff9fe32\n11c1d777b18ffc0f23d2435fdb4645dc\n...\n\n```\n\n-----\n\n### vbot2 C2\n```\n104.244.75.12_666\n142.11.194.209_1337\n142.11.194.209_17911\n142.11.194.209_34\n142.11.194.209_44\n184.172.110.248_666\n184.172.110.249_666\n185.172.110.248_323\n185.172.110.248_666\n185.225.19.200_666\n192.119.66.66_7331\n192.129.188.98_323\n205.185.123.101_666\n23.254.164.76_107\n23.254.164.76_33\n23.254.164.76_89\n45.84.196.148_1227\n50.115.173.131_111\n85.92.108.211_1447\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-07-06 - The Gafgyt variant vbot seen in its 31 campaigns.pdf"
    ],
    "report_names": [
        "2020-07-06 - The Gafgyt variant vbot seen in its 31 campaigns.pdf"
    ],
    "threat_actors": [
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535967,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1653751047,
    "ts_modification_date": 1653751047,
    "files": {
        "pdf": "https://archive.orkl.eu/e50829265c38dc596e20b1894f5591aeb63c60ea.pdf",
        "text": "https://archive.orkl.eu/e50829265c38dc596e20b1894f5591aeb63c60ea.txt",
        "img": "https://archive.orkl.eu/e50829265c38dc596e20b1894f5591aeb63c60ea.jpg"
    }
}