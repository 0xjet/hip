{
    "id": "11e763a5-afea-4f34-a276-f1a23551280f",
    "created_at": "2023-01-12T15:08:02.158071Z",
    "updated_at": "2025-03-27T02:15:35.668916Z",
    "deleted_at": null,
    "sha1_hash": "4247cc7107bcdb2be4891e889bbd619f9543f1d1",
    "title": "2022-03-16 - CryptBot - Too good to be true",
    "authors": "",
    "file_creation_date": "2022-05-28T02:39:58Z",
    "file_modification_date": "2022-05-28T02:39:58Z",
    "file_size": 3655751,
    "plain_text": "# CryptBot - Too good to be true\n\n**fr3d.hk/blog/cryptbot-too-good-to-be-true**\n\nCryptBot is an information stealer distributed by fake cracked software, it is an advanced and mature\noperation providing many of the underground shops with its stolen credentials.\n\nWhen observing an actor that isn't quite skilled in the art of malware distribution it is likely that you may\ncome across them distributing their malware under the guise of free cracked software. This technique is\ncommon but not effective in luring what would be considered a \"good\" or profitable infection. CryptBot\nignores this and takes the scale up a few notches. CryptBot is distributed by the InstallUSD PPI and\nreceives thousands of infections daily.\n\nFigure 0: Example of download site\n\nOnce downloaded the file will usually be an archive with a password. After being unzipped the produced\nfile will be an installer that is incredibly inflated ranging from 300-700mb, this is to avoid AV scans of the\nfile. Upon running the installer CryptBot will be dropped to the system and run.\n\n## Anti-Analysis & Preparations\n\nLike other malware, before CryptBot carries out any of its main functionality it'll check the system it's\nrunning on. CryptBot attempts to avoid systems that it believes may be being used for analysis or\nemulation. If these checks fail CryptBot will exit and remove itself from the system. The first check is to\ncheck the registry for the systems' Windows product name and processor name. After these have been\nqueried it will proceed to call GetUserNameW to get the name of the current user.\n\n\n-----\n\nFigure 1: System information queries\n\nCryptBot uses a folder within %AppData% to determine whether or not it has been ran on the infected\nsystem before. This folder is named \"kashga\". Before proceeding further it will check the permissions of\nthis folder and if it exists then the malware will exit. To avoid being run in an environment with anti-virus,\nCryptBot will check if any are installed. To accomplish this it will check two installation paths of popular anti\nvirus products and see if they exist. The paths are:\n\n%ProgramData%\\\\AVG\n%ProgramData%\\\\AVAST Software\n\nIf these paths exist then the malware will sleep then exit. If the paths do not exist then it'll proceed to call\nGetSystemInfo. The system infos number of processor cores is then compared to 1, if the count of cores is\nequal to 1 the malware will exit. GetSystemMetrics is called with parameter 0 to get the resolution width of\nthe screen, if the size is below 1033 the malware will exit. CryptBot calls GlobalMemoryStatusEx and\nchecks the size of the system's memory and checks that it is above 2gb. Lastly CryptBot will query the\nProcessorNameString from the registry key\n\"HKEY_LOCAL_MACHINE\\HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\0\" and check that the\nstring does not contain Xeon which is a brand of Intel CPUs commonly found in servers. If the string does\ncontain \"xeon\" the check fails.\n\n\n-----\n\nFigure 2: Anti analysis checks\n\nAfter all checks have passed, CryptBot creates the exfil folder and the subfolders within it, they are the\nfollowing:\n\n\\\\_Files\n\\\\_Files\\\\_Files\n\\\\_Files\\\\_Wallet\n\\\\_Files\\\\_Chrome\n\\\\_Files\\\\_Opera\n\\\\_Files\\\\_Brave\n\\\\_Files\\\\_Firefox\n\n## Browser Stealer\n\nCryptBot, unlike other malware, does not target many different browsers. Instead it only targets the most\ncommonly used browsers: Chrome, Opera, Brave and Firefox. Beginning its theft, CryptBot steals from\nFirefox. It expands the %AppData% location and determines the profiles.ini file which is the storage of\nFirefox. CryptBot then locates and copies the following files into the CryptBot exfiltration folder.\n\ncookies.sqlite\nformhistory.sqlite\nlogins.json\nsignons.sqlite\nkey4.db\nkey3.db\n\n\n-----\n\nThese files can then be decrypted by the operators of CryptBot to retrieve credentials of the victim. Like\nthe theft from Firefox, CryptBot uses the same technique to steal the following files from Brave, Opera and\nChrome. Its theft from these browsers is done with one function as the browsers all use Chromium. The\nfunction finds the local storage of the browsers and copies the following files:\n\ndefault_logins\ndefault_cookies\ndefault_webdata\ndefault_key\n\nThe files are copied into their respective exfil directory.\n\n## Grab System Information\n\nSo that the operators of CryptBot can get an idea of the system that they have infected, the malware will\ncollect information about the system. It begins by creating a file in the exfil directory named\n\"_Information.txt\". It then calls GetModuleFileNameW to get the path of itself and writes this to the file.\nNext the malware queries \"HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Windows\nNT\\\\CurrentVersion\" from the registry and grabs the following keys:\n\nProductName\nCurrentBuildNumber\nReleaseId\n\nTo determine if the infected system is a 64bit OS the malware will use ExpandEnvironmentStringsW for the\npath string \"%WINDIR%\\\\SysWOW64\" and then check if the file exists. If the file exists then the infected\nsystem is 64bit and if not it is 32bit. This result is written to the system information file. The results of the\nqueried keys are also written to the system information file.\n\nFigure 3: Get and write OS details\n\n\n-----\n\nTo determine the OS language CryptBot calls GetUserDefaultLocaleName and writes it to the file. Then it\ncalls GetKeyboardLayoutList and writes the results as the keyboard languages. Next it writes the local time\nand queries the UserName and ComputerName which are also written into the information file. CryptBot\nqueries the registry for \"\"HARDWARE\\\\DESCRIPTION\\\\System\\\\CentralProcessor\\\\0\" and grabs\ninformation about the CPU, then using other system calls it gets information about the system's RAM, GPU\nand display size. Lastly it queries:\n\nHKEY_CURRENT_USER\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall\nHKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall\nHKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall\n\nThis is to get the installed software on the system and write these to the information document.\n\n## Wallet & File Grabber\n\nCryptBot goes after all text files on the Desktop. It does this by expanding the\n\"%USERPROFILE%\\\\Desktop\\\\*.txt\" path string and then copying all the files matching this into the exfil\ndirectory path. After this the malware copies the files from the following wallets into the exfil directory.\n\nFigure 4: Get crypto wallet files\n\n## Extensions Stealer\n\nA modern development in information stealers is to steal from browser extensions. These extensions are\ncommonly used to control cryptocurrency and are now targeted more commonly than system based\nwallets. CryptBot targets Chrome, Brave and Opera for these extensions. Like the malwares' theft from\nbrowsers, CryptBot makes use of a do all function that takes the arguments of the browsers storage and\nthe profile to be used. The locations are:\n\n%LocalAppData%\\\\Google\\\\Chrome\\\\User Data\n%LocalAppData%\\\\BraveSoftware\\\\Brave-Browser\\\\User Data\n%AppData%\\\\Opera Software\n\nCryptBot reuses its technique from browser theft here where it'll simply locate the extension it wants to\nsteal from and then copy the contents into the exfil directory if the extension is installed. These are the\nextensions it steals from and their ID.\n\n\n-----\n\nMetaMask, nkbihfbeogaeaoehlefnkodbefgpgknn\nAxie Infinity, fnjhmkhhmkbjkkabndcnnogag\nYoroi, ffnbelfdoeiohenkjibnmadjiehjhajb\nTron Link, ibnejdfjmmkpcnlpebklmnkoeoihofec\nNifty Wallet, jbdaocneiiinmjbjlgalhcelgbejmnid\nMath Wallet, afbcbjpbpfadlkmhmclhkeeodmamcflc\nCoinBase Wallet, hnfanknocfeofbddgcijnmhnfnkdnaad\nBinance Wallet, fhbohimaelbohpjbbldcngcnapndodjp\nUnknown, mnojpmjdmbbfmejpflffifhffcmidifd\nGuarda, hpglfhgfnhbgpjdenjgmdgoeiappafln\nEQUA Wallet, blnieiiffboillknjnepogjhkgnoapac\nJaxx Liberty, cjelfplplebdjjenllpjcblmjkfcffne\nBitApp Wallet, fihkakfobkmkjojpchpfgcmhfjnmnfpi\niWallet, kncchdigobghenbbaddojjnnaogfppfj\nWombat, amkmjjmmflddogmhpjloimipbofnfjih\nOxygen, fhilaheimglignddkjgofkcbgekhenbh\nMew CX, nlbmnnijcnlegkjjpcfjclmcfggfefdm\nGuildWallet, nanjmdknhkinifnkgdcggcfnhdaammmj\nSaturn Wallet, nkddgncdjgjfcddamfgcmfnlhccnimig\nTerra Station, aiifbnbfobpmeekipheeijimdpnlpgpp\nHarmony, fnnegphlobjdpkhecapkijjdkgcjhkib\nCoin98, aeachknmefphepccionboohckonoeemg\nEver Wallet, cgeeodpfagjceefieflmdfphplkenlfk\nKardiaChain Wallet, pdadjkfkgcafgbceimcpbkalnfnepbnk\n\n## Exfiltration to C2 & Exiting\n\nTo send the stolen information to the actor, the malware will make use of HTTP POST requests to a C2.\nThese C2s are usually short domains on the .top TLD. The malware will begin by creating a zip of the exfil\ndirectory with a random filename in the %temp% directory. These zips have a password of\n\"ZtuLN8Gg5KCmc6oB6MeEzQ\".\n\n\n-----\n\nFigure 5: Sending zip to the C2\n\nOnce the malware has created the zip, it will then call the function to exfil to the C2. Within this function it\nbegins by manually creating a form POST body with the zip within it. Once the body of the POST has been\ncreated the malware will set the headers of the request which are used by the C2 to verify that an\nincoming POST was made by the malware. The C2 domain is kept in the binary in cleartext. Now that the\nmajority of the request has been created the malware will call HttpOpenRequestW to the C2 with a path of\n\"index.php\" and then send the request. If the request was successful then the malware will return, if not\nthen the malware will call the exfil function again.\n\nNow that the stolen information has been sent to the C2 the malware will clean up by deleting itself from\nthe disk. To accomplish this it will create the following command.\n\n/c rd /s /q %Temp%\\\\exfil_directory & timeout 4 & del /f /q \\malware_directory\n\nThe malware calls ShellExecuteW to execute the above command with cmd. This command will delete the\nexfil directory and its contents then sleep for 4 seconds which is used for the malware to exit. After the\nsleep is done it will delete the malware.\n\n## Conclusion\n\n\n-----\n\nCryptBot is a capable but simple piece of malware that gets the job done. I hope that this blog post has\nshone a light on the malware, as well as how it functions. The C2s used in the malware are constantly\nupdated. I believe that they are proxies to the real malware C2 which is hosted on a FastFlux network to\n[hide the real location of itself. A huge thank you to Steved3 for editing this post. Thank you for reading and](https://twitter.com/steved3)\nsee you in the next blog post!\n\nIOCS:\n\n24336a3c69f863981df13cc9c2cc8fe002d642962fc1d12c87062a8e5d273889\nbridmz52.top\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-16 - CryptBot - Too good to be true.pdf"
    ],
    "report_names": [
        "2022-03-16 - CryptBot - Too good to be true.pdf"
    ],
    "threat_actors": [
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536082,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1653705598,
    "ts_modification_date": 1653705598,
    "files": {
        "pdf": "https://archive.orkl.eu/4247cc7107bcdb2be4891e889bbd619f9543f1d1.pdf",
        "text": "https://archive.orkl.eu/4247cc7107bcdb2be4891e889bbd619f9543f1d1.txt",
        "img": "https://archive.orkl.eu/4247cc7107bcdb2be4891e889bbd619f9543f1d1.jpg"
    }
}