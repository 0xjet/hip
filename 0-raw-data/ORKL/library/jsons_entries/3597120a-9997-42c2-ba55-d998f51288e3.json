{
    "id": "3597120a-9997-42c2-ba55-d998f51288e3",
    "created_at": "2022-11-02T02:08:29.39031Z",
    "updated_at": "2025-03-27T02:17:25.657332Z",
    "deleted_at": null,
    "sha1_hash": "678b6a1820753ba476409b596830e9a878310ba7",
    "title": "Tracking the entire iceberg – long‑term APT malware C2 protocol emulation and scanning",
    "authors": "",
    "file_creation_date": "2022-09-19T19:00:00Z",
    "file_modification_date": "2022-09-24T15:02:09Z",
    "file_size": 4542980,
    "plain_text": "**28 - 30 September, 2022 / Prague, Czech Republic**\n\n# EMULATION AND SCANNING\n\n## Takahiro Haruyama\n\n### VMware, Japan\n\n#### tharuyama@vmware.com\n\n\n# TRACKING THE ENTIRE ICEBERG –\n\n\n# LONG-TERM APT MALWARE C2 PROTOCOL\n\n\n**www virusbulletin com**\n\n\n-----\n\n**ABSTRACT**\n\nMalware analysts normally obtain the IP addresses of malware’s command-and-control (C2) servers by analysing samples.\nThis approach works in commoditized attacks or campaigns. However, with targeted attacks using APT malware, it’s\ndifficult to acquire a sufficient number of samples for organizations other than anti-virus companies. As a result, malware\nC2 IOCs collected by a single organization are just the tip of the iceberg.\n\nFor years, I have reversed the C2 protocols of high-profile APT malware families then, by emulating the protocols,\ndiscovered the active C2 servers on the Internet. In this presentation I will explain how to emulate the protocols of two\nlong-term pieces of malware used by PRC-linked cyber espionage threat actors: Winnti 4.0 and ShadowPad.\n\nBoth pieces of malware support multiple C2 protocols, such as TCP / TLS / HTTP / HTTPS / UDP. It’s also common to\nhave different data formats and encoding algorithms for each protocol in the same piece of malware. I’ll cover the protocol\ndetails while referring to unique functions such as server mode in Winnti 4.0 and multiple protocol listening at a single port\nin ShadowPad. Additionally, I’ll share the findings for the Internet-wide C2 scanning.\n\nAfter the presentation, I will publish over 120 C2 IOCs with the date ranges in which they were discovered. These dates are\nmore helpful than IP address information alone since the C2s are typically found on hosted servers, meaning that the C2\ncould sometimes exist on a specific IP only for a very limited time. 65% of these IOCs have 0 detection on VirusTotal at the\ntime of writing this paper.\n\n**INTRODUCTION**\n\nSecurity practitioners often rely on the reputation of IP addresses to determine if traffic to and from that indicator of\ncompromise (IOC) is malicious. However, reputation is not effective for catching new malware C2 servers, especially when the\nAPT actors limit their malware deployments to specific targets. In the example shown in Figure 1, anti-virus (AV) engines\ndetected an IP address as harmless (0/90) on VirusTotal in June 2022, but I was able to identify it as a Winnti 4.0 C2 server.\n\n_Figure 1: VirusTotal result against one IP address._\n\nI looked at the TLS protocol, which I had reversed, and saw the protocols of high-profile malware families were emulated,\nin particular those used for cyber espionage to discover real-time C2 instances on the Internet. The following section\ndescribes how I created this intelligence for two pieces of long-term APT malware: Winnti 4.0 and ShadowPad.\n\n**SELECTION OF LONG-TERM APT MALWARE**\n\nBoth Winnti 4.0 and ShadowPad are utilized by PRC-linked cyber espionage threat actors. Table 1 shows a summary of\neach malware as the target of C2 scanning research.\n\n**Winnti 4.0** **ShadowPad**\n\nPrevalence Low High\n\nFirst-observed year 2016 (start-up sequence), 2018 (new C2 protocol) 2015\n\nScanning start year 2019 2021\n\nSupported protocols TCP / TLS / HTTP(S) / UDP TCP / SSL / HTTP(S) / UDP / DNS\n\nUnique feature Server mode Multiple protocol listening at a single port\n\n_Table 1: Summmary of scanning targets._\n\n|Col1|Winnti 4.0|ShadowPad|\n|---|---|---|\n|Prevalence|Low|High|\n|First-observed year|2016 (start-up sequence), 2018 (new C2 protocol)|2015|\n|Scanning start year|2019|2021|\n|Supported protocols|TCP / TLS / HTTP(S) / UDP|TCP / SSL / HTTP(S) / UDP / DNS|\n|Unique feature|Server mode|Multiple protocol listening at a single port|\n\n\n-----\n\nThere has been minimal reporting on Winnti 4.0 so far, while ShadowPad threat analysis information has been published by\nmany organizations. Multiple C2 protocols are supported by both. I will detail the C2 protocols (especially focusing on the\ninitial handshake), scanner implementations, and the scanning results.\n\n**Winnti 4.0**\n\nWinnti is a family of malware that has been seen in many large-scale attacks and has been attributed to, at least, the APT41\nChinese threat actor [1]. The malware was reported by Kaspersky for the first time in 2013 (version 1.0-2.0) [2]. Novetta\nanalysed the start-up sequence and C2 protocol of version 3.0 in detail [3].\n\nI observed that the version 3.0 implementation (in particular the start-up sequence) has changed since 2016, which has\nguided this research into categorizing Winnti as multiple variants. Macnica Networks first described the new\nimplementation at JSAC 2018 [4]. Here we refer to the new variants as version 4.0 to differentiate from previous versions.\nThe differences from version 3.0 are shown in Table 2.\n\n**Version 3.0** **Version 4.0**\n\nInitial component Dropper Loader and DAT file\n\nInitial encryption algorithm DES AES\n\nInitial encryption key cracking Easy Hard\n\nWorker encryption 1-byte XOR and nibble swap DPAPI or AES with host-specific key\n\n_Table 2: Difference between Winnti versions 3.0 and 4.0._\n\nWinnti 3.0 was composed of multiple components: Dropper, Service and Worker. The Dropper component initially decrypts\nand saves both the Service component and the Worker component then sets the persistence for Service. After that, the Service\ncomponent runs the main payload, called Worker. Version 4.0 is more carefully implemented to make code acquisition for the\nWorker component harder. As a result, there has been limited information publicly available about this variant since it was first\nobserved. If the reader is interested in the version 4.0 installation behaviour, check the blog post at [5].\n\nIn the process of analysing the Winnti 4.0 samples, I identified the new Worker component from 2018 whose code has less\nthan 50% similarity with the existing version 3.0. The Worker configuration block structure is detailed below:\n\nstruct __unaligned __declspec(align(2)) struc_work_config\n{\nchar campaignID[64];\nchar MAC_addr[6];\nint c2_proto;\nchar c2_host_port[128];\nchar c2_active_table[672];\nstruc_proxy proxy;\nstruc_server_ports server_ports;\nint httpapi_mode_imm4;\nint httpapi_proto;\nint httpapi_port;\nint field_56A;\nint field_56E;\nint field_572;\nint field_576;\nint field_57A;\nint field_57E;\nwchar_t httpapi_url[256];\nchar field_782[16];\nint server_cert_size;\nint server_privkey_size;\nchar server_cert_der[655]; // flexible according to the size\nchar server_privkey_der[609]; // flexible according to the size\nchar padding[2832];\n};\n\nstruct struc_proxy\n{\nint proxy_proto;\nchar proxy_host[256];\n\n|Col1|Version 3.0|Version 4.0|\n|---|---|---|\n|Initial component|Dropper|Loader and DAT file|\n|Initial encryption algorithm|DES|AES|\n|Initial encryption key cracking|Easy|Hard|\n|Worker encryption|1-byte XOR and nibble swap|DPAPI or AES with host-specific key|\n\n\n-----\n\nchar proxy_user[64];\nchar proxy_pass[32];\nchar proxy_realm[128];\n};\n\nstruct struc_server_ports\n{\n__int16 tcp;\n__int16 udp;\n__int16 unk;\n__int16 unk_0;\n__int16 unk_1;\n__int16 http;\n__int16 https;\n__int16 tls;\n};\n\nenum enum_proto // specified by c2_proto and proxy_proto values\n{\nnone = 0x0,\nTCP = 0x1,\nHTTP = 0x2,\nHTTPS = 0x3,\nTLS = 0x4,\nUDP = 0x5,\n};\n\nThe C2 protocol of the sample is completely different from the existing understanding of the 3.0 protocol. It will be\ndetailed in the sections that follow.\n\n**_C2 protocol_**\n\nAs the configuration structure shows, the Worker component supports five C2 protocols: TCP, HTTP, HTTPS, TLS and\nUDP. While the same customized packet is included in every protocol (e.g. as a raw payload in TCP, as POST data in\nHTTP, and so on), there are minor differences between the protocols. The following analysis will detail the customized\npacket format and then the differences between the protocols.\n\nWinnti 4.0 also supports the server-mode function, which accepts incoming packets such as a C2 server for lateral\nmovement. The function was helpful to verify the correctness of the protocol format and encryption handled by the\nimplemented scanner.\n\n**_Packet format and encryption_**\n\nThe customized packet is separated into the header and payload.\n\nstruct struc_custom_header\n{\n__int16 temp_key_seed;\n__int16 unk_word; // initial value is 2\n__int16 signature; // 0x45DB\nint payload_len;\n};\n\nThe protocol encrypts both the header and payload, except for a temp_key_seed value that is provided in the header. The\nsignature value is validated after the decryption on the receiver side.\n\nstruct struc_custom_payload_init\n{\nint payload_type; // request:0xEE775BAA/0x4563CEFA/0x5633CBAD, response:0xFACEB007/0x5633CBAD\nint unk_dword; // request:0, response:0xC350/0xC352\nGUID guid;\nchar null_bytes[14];\n__int16 seq_num; // starting from 1\n__int16 null_word;\n};\n\n\n-----\n\nThe initial packet payload contains a payload type, random GUID value, and packet sequence number. The payload type\nshould be one of the following values:\n\n  - 0xEE775BAA\n\n  - 0x5633CBAD\n\n  - 0x4563CEFA\n\n  - 0xFACEB007\n\nTypically, the request payload type will be 0xEE775BAA and the response will be 0xFACEB007.\n\nThe encryption algorithm is unknown at this time, but it appears to be a stream cipher with no constant values that requires\ntwo kinds of keys:\n\n - A dynamically generated key from the temp_key_seed value in the header.\n\n - A portion of the SHA1 value of the hard-coded string ‘host_key’.\n\nThe generation algorithm is implemented in Python:\n\n_Figure 2: Key generation from a temp_key_seed value._\n\nThe unknown encryption/decryption routine can be emulated by IDA Appcall [6]. (The routine will be detailed in the\n‘Scanner implementation’ section later in this paper.)\n\n**_HTTP protocol_**\n\nThe customized packet data itself is the only information transmitted in the TCP/UDP protocols. In the HTTP protocol, this\ncustomized packet is sent through a POST request with several HTTP headers, which are depicted in Figure 3.\n\n_Figure 3: HTTP POST request including the customized packet._\n\nIt should be noted that the number ‘333959650’ after the ‘POST /’ is randomly generated. The cookie value is made up\nof five DWORD hex values, which contain information about the customized packet size. The size information is\nembedded as the XOR key. A Python script was written to parse this data. Figure 4 shows the relevant code from the\nPython script, which validates the cookie value.\n\n\n-----\n\n_Figure 4: Cookie value validation code._\n\nThe following shows the output of the Python script, and that the customized packet size is 0x34:\n\n$ python validate_cookie.py 640ABEFB16D2CE36E7E83E1B8BEF31B2500ABEFB\ndw0=0xfbbe0a64, dw1=0x36ced216, dw2=0x1b3ee8e7, dw3=0xb231ef8b, dw4=0xfbbe0a50\nThe cookie value validated. dword key = 0x34\n\nPrior to the POST request an initial GET request will be made between the client and server. An example of this is shown\nin Figure 5.\n\n_Figure 5: HTTP GET request._\n\nThe GET request and response do not contain the customized packet, and subsequently upon decoding the cookie value the\nsize will be shown as zero. The output below shows the decoded cookie value from Figure 5:\n\n$ python validate_cookie.py 420F0DABD80FC8F34050B58A5AB00FCE420F0DAB\ndw0=0xab0d0f42, dw1=0xf3c80fd8, dw2=0x8ab55040, dw3=0xce0fb05a, dw4=0xab0d0f42\nThe cookie value validated. dword key = 0x0\n$ python validate_cookie.py D66EEE1927424A0C7A30387777FC6B9ED66EEE19\ndw0=0x19ee6ed6, dw1=0xc4a4227, dw2=0x7738307a, dw3=0x9e6bfc77, dw4=0x19ee6ed6\nThe cookie value validated. dword key = 0x0\n\n\n-----\n\nThe purpose of the GET request is unknown – it seems redundant, but it could be in place as an initial handshake without\nrevealing the custom packets.\n\nAdditionally, it was determined from the configuration that the server-mode code provides two kinds of HTTP server\nfunctions:\n\n - A normal HTTP server replying to any request.\n\n - A ‘Reuse’ HTTP server only replying to requests with correct URLs.\n\nThe latter HTTP server is implemented by Windows HTTP Server APIs and appears to be the same as the passive HTTP\nlistening function of PortReuse reported upon by ESET [7]. However, in this implementation the URL is not fixed but\nrather specified in the configuration block.\n\n_Figure 6: Reuse HTTP server code._\n\n**_Additional SSL encryption_**\n\nThe customized packet is also encrypted with SSL when the protocol is HTTPS or TLS. Aside from the added layer of\nencryption they are identical to HTTP and TCP.\n\n**_Behaviour after the initial handshake_**\n\nAfter the initial handshake, the packet payload contains the command ID and dispatcher ID in a nested structure to control\nthe infected host.\n\nstruct __declspec(align(4)) struc_custom_payload_next\n{\n__int16 messageID;\n__unaligned __declspec(align(1)) int sessionID_src;\n__int16 messageID_0;\nint sessionID_dst; // copied from data sent by C2\n__int16 field_C;\n__int16 field_E;\n__int16 field_10;\n__unaligned __declspec(align(1)) int field_12;\n__unaligned __declspec(align(1)) int field_16;\n__unaligned __declspec(align(1)) int sessionID_dst_0;\n__unaligned __declspec(align(1)) int sessionID_src_0;\nchar imm0;\nchar unk_byte_from_C2;\n__int16 field_24;\n__unaligned __declspec(align(1)) int field_26;\n__int16 field_2A;\n__int16 field_2C;\n__int16 signature; // 0x45db\nint nested_payload_len;\nstruc_nested_payload nested_payload;\n};\n\nstruct __unaligned __declspec(align(1)) struc_nested_payload // at least 0x14 bytes\n{\n\n\n-----\n\n// e.g., cmd_ID=5 & dispatch_ID=1 order to send victim info\n__int16 cmd_ID;\n__int16 dispatch_ID;\n__int16 field_4;\nchar field_6;\nchar field_7;\nchar field_8;\nchar field_9;\nchar field_A;\nchar field_B;\nint ret_value; // -1 or 0 or 1 or 2\nint additional_data_len;\nstruc_data_cmd1 additional_data; // flexible size\n};\n\nHowever, the Worker component looks to have few built-in remote access trojan (RAT) functionalities other than collecting\nthe host information and executing a PE module plug-in downloaded from the C2. Therefore, I hypothesize either that\nWinnti 4.0 with the new Worker component must load a plug-in for each desired function like Winnti 3.0, or that the\nacquired sample was in an early development stage. I haven’t acquired any plug-in samples for the Worker yet.\n\n**_Scanner implementation_**\n\nI initially had to decide which ports the scanner should focus on. I only had one Winnti 4.0 sample with the new C2\nprotocol. Therefore, I targeted the following ports based not only on the sample but also on other Winnti malware\ninformation reported by ESET [7] and Trend Micro [8], though neither of these referred to the 4.0 protocols.\n\n - TCP/443\n\n - TCP/80\n\n - UDP/443\n\n - UDP/53\n\nThe rough scanning workflow is shown in Figure 7.\n\n_Figure 7: Discovery workflow._\n\nIn both TCP-based and UDP protocols, ZMap [9] is first utilized to discover open or respondent IP addresses on the\nInternet. HTTP/HTTPS GET requests are sent to the hosts with open TCP ports 80/443, then an additional TCP/TLS\ncustom packet transmission with fixed data will be completed for port 443. The TCP/TLS results will be validated by IDA\nAppcall, based on the decrypted header values (payload size and signature) of the responses. The UDP protocol case can be\nhandled in the same way while the result from ZMap will be filtered out to reduce the noise.\n\nTwo scripts were implemented for this discovery. One is a stand-alone Python script validating the HTTP/HTTPS\nSet-Cookie header values of responses and identifying suspicious respondents to the TCP/TLS customized packets. The\n\n\n-----\n\nother is an IDAPython script with the Appcall functions encrypting and decrypting the TCP/TLS/UDP packets. Both scripts\nwere tested against the sample where I modified configuration values to enable arbitrary server-mode functions.\n\nThe stand-alone script detects not only active hosts returning correct Set-Cookie header values, but also suspicious ones\nhandling different protocols (potential TCP/TLS servers), as below:\n\n$ python internet_c2_scan.py -l test.txt -p 80 -d winnti http\n\n[DEBUG] target is \"http://172.16.24.127:80\"\n\n[DEBUG] validating the Set-Cookie value: 26A3F6E045EC98AD6732D27EFC1C9CCE26A3F6E0\n\n[+] 172.16.24.127,active\n\n[*] 1 scanned in 0:00:00.454756\n\n[*] 1 active servers found\n\n$ python internet_c2_scan.py -l test.txt -p 443 -d winnti tcp\n\n[DEBUG] target is \"tcp://172.16.24.127:443\"\n\n[+] 172.16.24.127,suspicious,bbef1f956f778eabd17d26b6eb0893658bc896c91a0cdd3fda32c70ba3e6\nd9ab3ef9fecee0673537e1e53e6b2e747dce20630e67\n\n[*] 1 scanned in 0:00:00.231333\n\n[*] 1 active servers found\n\nThe second of the above execution examples should be passed to the IDAPython script as the stand-alone script only\nchecks that the response size is the same and the content is different from the data sent to the IP address.\n\nThe IDAPython script validates values in the respondent’s packet such as header signature and payload size after the\ndecryption.\n\n[*] start\n\n[*] selected: protocol = TCP, port = 443\n\n[DEBUG] created GUID: 0b8212dc-e364-4c18-ac0b-26382beb1387\n\n[DEBUG] client header: unknown word = 0x2, header signature = 0x45db, payload length = 0x2a\n\n[*] client payload: payload type = 0xee775baa, unknown dword = 0x0, GUID = 0b8212dc-e364-4c18ac0b-26382beb1387, sequence number = 1\n\n[DEBUG] a request packet sent (52 bytes)\n\n[DEBUG] a response packet received (52 bytes)\n\n[DEBUG] server header: unknown word = 0x2, header signature = 0x45db, payload length = 0x2a\n\n[*] server payload: payload type = 0xfaceb007, unknown dword = 0xc352, GUID = 0b8212dc-e364-4c18ac0b-26382beb1387, sequence number = 2\n\n[+] 172.16.24.127: server is active (custom packet validated)\n\n[+] 1 active servers found\n\n[*] done\n\nAdditionally, we can differentiate between C2s and victim hosts infected with server-mode variants by checking the GUID\nand sequence number values. As displayed above, the server-mode variants respond with the same GUID (0b8212dce364-4c18-ac0b-26382beb1387) as the client while incrementing the sequence number. On the other hand, the C2\nservers respond with the null GUID and reset the sequence number to 1.\n\n[*] start\n\n[*] selected: protocol = TCP, port = 443\n\n[DEBUG] created GUID: 346dfd36-a776-4a2e-9765-a0bcc2524fc9\n\n[DEBUG] client header: unknown word = 0x2, header signature = 0x45db, payload length = 0x2a\n\n[*] client payload: payload type = 0xee775baa, unknown dword = 0x0, GUID = 346dfd36-a776-4a2e9765-a0bcc2524fc9, sequence number = 1\n\n[DEBUG] a request packet sent (52 bytes)\n\n[DEBUG] a response packet received (52 bytes)\n\n[DEBUG] server header: unknown word = 0x2, header signature = 0x45db, payload length = 0x2a\n\n[*] server payload: payload type = 0xfaceb007, unknown dword = 0x0, GUID = 00000000-0000-00000000-000000000000, sequence number = 1\n\n[+] 185.161.211.97: server is active (custom packet validated)\n\n[DEBUG] a request packet sent (52 bytes)\n\n[DEBUG] a response packet received (52 bytes)\n\n[DEBUG] server header: unknown word = 0x2, header signature = 0x45db, payload length = 0x2a\n\n[*] server payload: payload type = 0xfaceb007, unknown dword = 0x0, GUID = 00000000-0000-00000000-000000000000, sequence number = 1\n\n[+] 80.82.67.6: server is active (custom packet validated)\n\n[+] 2 active servers found\n\n[*] done\n\n\n-----\n\nThe difference in the values can be observed in other protocols like TLS and UDP.\n\n**_Result_**\n\nBetween December 2019 and May 2022 I discovered 51 Winnti 4.0 C2 servers (39 unique IPs) on the Internet. The\npercentage of each protocol is shown in Figure 8.\n\n_Figure 8: Winnti 4.0 population by protocol._\n\nBased on the GUID and packet sequence number values that I mentioned in the previous section, I conclude that all TLS/\nTCP/UDP servers were C2s, not infected hosts with the server-mode variants. Unlike these protocols, the HTTP/HTTPS\nscanners just decode and validate the cookie value. There is no difference in the value between C2s and server-mode\ninfections. However, these were also likely C2s because all servers were hosted by VPS providers and most of the providers\noverlapped with those hosting TLS/TCP/UDP C2s.\n\nThe change in the number of active Winnti 4.0 C2s is shown in Figure 9.\n\n_Figure 9: Change in number of active Winnti 4.0 C2s._\n\nI disclosed the discovered Winnti 4.0 C2 information twice (in February 2020 [10] and November 2021 [11]). I suspect that’s\nwhy the number in November 2021 dropped sharply. However, the new C2 servers are still observed as of the time of writing\nthis paper. To the best of my knowledge, there have been only two public reports – by Trellix [12] and Recorded Future [13]\n– on this threat. In order to alert the cybersecurity community, I will continue to track the C2 servers in the future.\n\n**ShadowPad**\n\nShadowPad is a modular malware platform privately shared with multiple PRC-linked threat actors since 2015. According\nto SentinelOne [14], ShadowPad is highly likely the successor to PlugX. Due to its prevalence in the cyber espionage field,\nI was motivated to analyse the C2 protocol to create a scanner.\n\n\n-----\n\n**_C2 protocol_**\n\nShadowPad supports six C2 protocols: TCP, SSL, HTTP, HTTPS, UDP and DNS. In this research, I focus on TCP/\nHTTP(S)/UDP protocols, as others like SSL and DNS are not likely utilized by the recent ShadowPad samples.\n\nThe format and encoding algorithm are different between TCP and HTTP(S)/UDP.\n\n**TCP** **HTTP(S)/UDP**\n\nKey size 4 2\n\nHeader size 0x14 8\n\nPayload size in the initial handshake Up to 0x3F HTTP(S): Up to 0x1F, UDP: 0x10\npacket\n\n_Table 3: Difference in packet format._\n\nThe key for the encoding is included in the header. Every integer value in the header is big endian. Randomly sized data\nwill be appended as the payload to the initial handshake packet in both cases.\n\nThe immediate values used by the encoding algorithms are different per variant (probably per ShadowPad builder version).\nI analysed three ShadowPad variants, which I was able to collect in August 2021, as displayed in Table 4. (The SHA256\nhash values are included in the Indicators of Compromise section.)\n\n**Variant name** **C2 protocol** **Config size** **Attribution** **Source**\n\nVariant1 (aka TCP/UDP 0x896 APT41 _Positive_\nScatterBee [15]) _Technologies [16]_\n\nVariant2 HTTP(S) 0x85C Tonto Team _ESET [17]_\n\nVariant3 HTTP(S) 0x85C unknown _VirusTotal [18]_\n\n_Table 4: Analysed ShadowPad variants._\n\nThe C2 protocol is further detailed below.\n\n**_TCP protocol_**\n\nThe TCP protocol header format is displayed as follows:\n\nstruct struc_common_header\n{\nint session_key;\nint plugin_and_cmd_id; // plugin_id (0x68) << 16 + cmd_id (0x51)\nint module_code; // 0\nint payload_size_compressed;\nint payload_size_original;\n};\n\nThe header format has been the same since 2015. The session_key is randomly generated then used for encoding both\nthe header and the payload. The plugin_id and cmd_id values included in the plugin_and_cmd_id field have been\nupdated by variants, some of which are covered in this paper. The values in the initial packet created by Variant1 should be\n0x68 (Online plug-in) and 0x51 (check-in). The module_code of the initial packet generated by the sender is always 0.\n\nIf any payload data exists, it will be compressed with the QuickLZ [19] algorithm. QuickLZ is an older, publicly available\ncompression routine that is not commonly seen. The client generates randomly sized null bytes (up to 0x3F bytes) for the\ninitial packet payload.\n\nVariant1’s encoding algorithm for the TCP packet in Python is shown in Figure 10. Based on the protocol analysis experience\nof Variants 2 and 3, another variant may use a different immediate value from 0x22F4B1BA for the TCP packet encoding.\n\n_Figure 10: TCP packet encoding by Variant1._\n\nAfter the initial handshake, Variant1 executes the commands of the plug-ins specified by the C2 server. For more details,\nreview the Dr.Web white paper [20] explaining the individual command IDs and payload formats. The variant analysed in\nthe paper is older than Variant1 but the formats should be similar.\n\n|Col1|TCP|HTTP(S)/UDP|\n|---|---|---|\n|Key size|4|2|\n|Header size|0x14|8|\n|Payload size in the initial handshake packet|Up to 0x3F|HTTP(S): Up to 0x1F, UDP: 0x10|\n\n|Variant name|C2 protocol|Config size|Attribution|Source|\n|---|---|---|---|---|\n|Variant1 (aka ScatterBee [15])|TCP/UDP|0x896|APT41|Positive Technologies [16]|\n|Variant2|HTTP(S)|0x85C|Tonto Team|ESET [17]|\n|Variant3|HTTP(S)|0x85C|unknown|VirusTotal [18]|\n\n\n-----\n\n**_HTTP(S) and UDP protocols_**\n\nThe header format for the HTTP(S) and UDP protocols is listed below. In HTTP(S), the data is sent through the POST\nmethod.\n\nstruct struc_proto_header\n{\n__int16 session_key;\n__int16 type; // 0 in HTTP, req=0x1001/res=(0x2002|0x5005) in UDP\n__int16 session_src_id; // random 2 bytes, generated by both client/server\n__int16 session_dst_id; // req=0, res=client’s session_src_id\n};\n\nThe session_key has the same role as the TCP session_key, though the key size is different. The second field type is\nalways 0 (zero) in the HTTP initial packet, while UDP client and server send 0x1001/0x2002/0x5005. The session_src_\nid field is randomly generated by both client and server. The value sent by the client will be set in the session_dst_id\nfield on the server side.\n\nThe initial packet payload data are randomly generated based on QueryPerformanceCounter and other APIs. The HTTP\npayload size is also random with a length of up to 31 (0x1F) bytes, while the UDP one is fixed at 16 (0x10) bytes.\n\nFigures 11-13 show each variant’s encoding algorithm in Python. The immediate values in the code are different, but the\nalgorithm itself is identical.\n\n_Figure 11: UDP packet encoding by Variant1._\n\n_Figure 12: HTTP(S) packet encoding by Variant2._\n\n_Figure 13: HTTP(S) packet encoding by Variant3._\n\nAfter the initial handshake, the payload will contain the same data structure as the TCP packet (struc_common_header and\nits QuickLZ-compressed payload) explained in the previous section, while the type field in struc_proto_header will be\nincremented.\n\n**_Scanner implementation_**\n\nI decided the following target protocols/ports based on the configurations extracted from recent ShadowPad samples. As\nexplained earlier, the scanner per variant had to be implemented due to the difference in immediate values used in the\nencoding.\n\n**Scanning start period** **Target protocol/port/variant**\n\nSeptember 2021 HTTP/443 (Variant2 & Variant3)\n\nOctober 2021 TCP/443 & UDP/53 (Variant1)\n\nJune 2022 UDP/443 (Variant1), HTTP/80 (Variant3)\n\nThe flow chart in Figure 14 shows how the ShadowPad C2 servers are detected by the scanners.\n\nLike Winnti 4.0 C2 scanning, first the list of hosts open at targeted ports is created by ZMap. Then the scanner sends the\nShadowPad-formatted packets to all IP addresses on the list. Next, the scanner checks that the response packet size is at\nleast greater than the header size and the session_key is different from the sending one to exclude honeypots. If the size\n\n|Scanning start period|Target protocol/port/variant|\n|---|---|\n|September 2021|HTTP/443 (Variant2 & Variant3)|\n|October 2021|TCP/443 & UDP/53 (Variant1)|\n|June 2022|UDP/443 (Variant1), HTTP/80 (Variant3)|\n\n\n-----\n\n_Figure 14: ShadowPad C2 detection flow._\n\nand key look to be valid, the scanner decodes the response packet. In TCP protocol, the scanner validates the payload size\nfields (payload_size_compressed and payload_size_original). In HTTP(S) and UDP protocols, the code verifies\nif the type field value is correct and the response’s session_dst_id is matched with the session_src_id created by\nthe scanner.\n\nThe following output log shows that eight Variant1 TCP servers were discovered by scanning the list of TCP/443 open\nhosts generated by ZMap. The command_id 0x53 from the C2s is a request to send system information of the infected\nhost.\n\n2022/06/xx xx:00:02,log file opened: scan_results/sp_scan_auto_202206xx_xxxxxx.csv\n2022/06/xx xx:00:05,malware options: family = ShadowPad; targeted protocol = tcp (version =\nVariant1)\n2022/06/xx xx:00:09,ShadowPad specific options: version = Variant1; key size = 4; key endian =\nbig; header size = 0x14; Online plugin ID = 0x68; CMD ID = 0x51; module code = 0x0\n2022/06/xx xx:00:16,51576779 open hosts read from corpus/2022-xx-xx_zmap22000ppsVPN_tcp_443.saddr\n2022/06/xx xx:43:46,45.137.10.3,active,compressed payload size matched (plugin_id=0x68, command_\nid=0x53, payload=None)\n2022/06/xx xx:40:28,45.32.248.92,active,compressed payload size matched (plugin_id=0x68, command_\nid=0x53, payload=None)\n\n\n-----\n\n..[SKIPPED]..\n2022/06/xx xx:01:05,43.129.188.223,active,compressed payload size matched (plugin_id=0x68,\ncommand_id=0x53, payload=None)\n2022/06/xx xx:48:35,51576779 scanned in 1 day, 17:48:32.497550\n2022/06/xx xx:48:35,8 suspicious/active servers found (DB new=4 update=4)\n\nIn order to detect the Variant2/Variant3 C2 servers I just use the HTTP protocol scanner, not the HTTPS one, because the\nShadowPad C2s can accept multiple protocol requests at a single port. I noticed the unique feature by extracting the C2 server\nconfigurations from the sample (SHA256: d011130defd8b988ab78043b30a9f7e0cada5751064b3975a19f4de92d2c0025).\n\n[*] config size = 0x85c\n..\n\n[+] C2 Entry 0 (offset 0xbc): 'HTTPS://wwa1we.wbew.amazon-corp.wikaba.com:443'\n\n[+] C2 Entry 1 (offset 0xed): 'HTTP://wwa1we.wbew.amazon-corp.wikaba.com:443'\n..\n\nThe hostnames and ports in the entries matched exactly but the protocols were different. In fact, I was able to verify that\nanother active ShadowPad C2 can accept both protocols at the same port.\n\n$ ./c2fs.py -d -l corpus/query.txt -p 443 -f sp http Variant2\n..\n\n[*] malware options: family = ShadowPad; targeted protocol = http (version = Variant2)\n\n[*] ShadowPad specific options: version = Variant2; key size = 2; key endian = big; header size =\n0x8; header type = 0x0; client session ID = 53978\n\n[D] POST: http://137.220.185.203:443/ (proxy={}, stream=True, timeout=30)\n\n[+] 137.220.185.203,active,client session ID matched (type=0x0)\n..\n\n$ ./c2fs.py -d -l corpus/query.txt -p 443 -f sp https Variant2\n..\n\n[*] malware options: family = ShadowPad; targeted protocol = https (version = Variant2)\n\n[*] ShadowPad specific options: version = Variant2; key size = 2; key endian = big; header size =\n0x8; header type = 0x0; client session ID = 52256\n\n[D] POST: https://137.220.185.203:443/ (proxy={}, stream=True, timeout=30)\n\n[+] 137.220.185.203,active,client session ID matched (type=0x0)\n..\n\nThe same behaviour may be seen in other protocol combinations such as TCP/SSL and UDP/DNS. However, it’s\nimpossible to test because I have not yet obtained any samples of the variants with multiple C2 protocol plug-ins.\n\n**_Result_**\n\nBetween September 2021 and June 2022 I identified 72 ShadowPad C2 servers (67 unique IPs) on the Internet. The\npercentage of each variant is shown in Figure 15. Through the tracking period, Variant1 had become more active.\n\n_Figure 15: ShadowPad population by variant._\n\nThe change in the number of active ShadowPad C2s is shown in Figure 16.\n\n\n-----\n\n_Figure 16: Change in number of active ShadowPad C2s._\n\nCompared with 2021, the active C2s in 2022 have been on a declining trend, though the sharp drop in February 2022 was\ndue to a system issue. The scanner may have missed a new variant lately as ShadowPad changes the immediate values used\nin the packet encoding per variant. I will continue to improve the scanner as I obtain new variant samples.\n\nAs ShadowPad is more prevalent than Winnti 4.0, I was able to identify three samples communicating with the C2 IP\naddresses on VirusTotal. The sample information is listed in Table 5.\n\n**Sample malware** **C2 IP address** **C2 protocol/port** **Sample** **C2 first-seen** **C2 last-seen date**\n**family** **used by sample** **submission date** **date by scanner** **by scanner**\n\nSpyder [21] 156.240.104.149 TLS/443 2021/10/26 2021/10/16 2021/10/16\n\nReverseWindow 43.129.188.223 TCP/10333 2022/02/27 2021/10/17 2022/06/14\n\n[22]\n\nShadowPad 213.59.118.124 UDP/443 2022/03/20 2022/03/06 2022/06/13\n\n_Table 5: Samples communicating with the ShadowPad C2 IPs._\n\nSpyder and ReverseWindow are APT malware utilized by PRC-linked cyber espionage threat actors (respectively APT41\nand LuoYu). All C2s were discovered by the TCP/443 Variant1 scanner, but the samples communicated with a different\nprotocol or port. With the exception of the Spyder sample case, the C2s had accepted multiple protocols/ports at that time.\nThe scanning system caught the C2s prior to the sample submissions.\n\nAdditionally, last year the discovery of the use of a discovered C2 IP (107.155.50.198) triggered an incident response. The\nadvanced and sophisticated attack had bypassed many methods of detection but was ultimately alerted upon simply because\nof the pre-identified C2 IP.\n\n_Figure 17: Alert based on the ShadowPad C2._\n\n**NOTES FOR INTERNET-WIDE C2 SCANNING**\n\n**How to get input data**\n\nAs explained in the ‘Scanner Implementation’ sections, the scanner system needs lists of the IP addresses open at targeted\nports (in short, port scan data) as the input because it is not realistic to scan full ranges of IPs on the Internet with the\n\n|Sample malware family|C2 IP address|C2 protocol/port used by sample|Sample submission date|C2 first-seen date by scanner|C2 last-seen date by scanner|\n|---|---|---|---|---|---|\n|Spyder [21]|156.240.104.149|TLS/443|2021/10/26|2021/10/16|2021/10/16|\n|ReverseWindow [22]|43.129.188.223|TCP/10333|2022/02/27|2021/10/17|2022/06/14|\n|ShadowPad|213.59.118.124|UDP/443|2022/03/20|2022/03/06|2022/06/13|\n\n\n-----\n\nPython-based system. The lists can be obtained by purchasing from commercial services such as Shodan [23] and CenSys\n\n[24], but I generate them myself using ZMap for the following reasons:\n\n - For UDP-based protocols, we must scan hosts with the customized protocol formats. For instance, ShadowPad C2s\nbinding to UDP/53 will not answer to the DNS query packets. Commercial services normally don’t provide an option\nto scan with a customized packet.\n\n - As shown in Table 6, commercial services don’t scan minor ports actively. For example, Shodan has published the\nscanning target ports [25] on its website. If threat actors avoid using these ports, we will not be able to get the effective\ninput data from Shodan.\n\n**ZMap** **Shodan** **CenSys**\n\nTCP/10333 4,940,037 4 1,306\n\nTCP/55555 3,199,856 86 486,497\n\n_Table 6: The number of IPs open at minor ports (November 2021)._\n\n**Anonymization**\n\nToday, a lot of organizations – not only criminals but also companies/institutes – scan the Internet for various purposes.\nEven if the purpose is legitimate, the scanning operations are sometimes forcibly terminated by ISPs and VPS providers\ndue to abuse reports by external network administrators. In order to sustain the C2 scanning research, the source address\nshould be anonymized.\n\nThere are two methods for the anonymization: using Tor or commercial VPN services. A comparison between the two\nmethods is shown in Table 7.\n\n**Tor** **Commercial VPN service**\n\nSupported protocols TCP TCP/UDP\n\nCost Free Non-free\n\nRisk of being blocked High Low\n\n_Table 7: Comparison between anonymization methods._\n\nTor is free and open-source software to enable anonymous communication in TCP-based protocols. Tor has a cost\nadvantage, but it also has a risk of being blocked easily because the Tor exit relay list is published [26]. On the other hand,\ncommercial VPN services like Mullvad [27] have a cost attached, but support UDP-based protocols. Additionally, it’s hard\nfor threat actors to block all commercial VPN servers. Therefore, I utilize one of the commercial VPN services for the\nanonymization.\n\nWe must use the ‘-X’ option in ZMap for non-Ethernet interfaces like VPN. However, ZMap contains a bug causing a\nsegmentation fault when using this option. I have reported this bug and provided a patch within a ZMap issue [28]. While the\nbug has not yet been patched, I highly recommend performing your own patch by using the code explained on that issue page.\n\n**CONCLUSION**\n\nBy emulating the Winnti 4.0 and ShadowPad C2 protocols then scanning the C2 servers on the Internet, I’ve discovered\nover 120 C2 servers. The IOCs have been published on GitHub [29] with discovered date ranges which are more helpful\nthan just IP address information since the C2s are typically found on hosted servers.\n\n65% of these IOCs have zero detections on VirusTotal. Approximately 10 C2s have always been active in both malware\nfamilies. I see little possibility of false positives because the C2 protocol formats and encoding algorithms are fairly unique.\nIn fact, I’ve never received false positive feedback regarding the malware families since the IOCs came into use for\nendpoint detection while I could identify both internal and external infection cases.\n\nScanning APT malware C2s on the Internet is sometimes as hard as finding a needle in a haystack. However, once the C2\nscanning works, it can become a game changer as one of the most proactive threat detection approaches.\n\n**ACKNOWLEDGEMENT**\n\nI appreciate Tadashi Kobayashi’s insight and advice. Kobayashi provided tactics for the scalable scanner implementation\nand troubleshooting.\n\nI also appreciate Leon Chang’s expertise and advice regarding ShadowPad. Chang shared his knowledge to get a smart, big\npicture of the variants.\n\n|Col1|ZMap|Shodan|CenSys|\n|---|---|---|---|\n|TCP/10333|4,940,037|4|1,306|\n|TCP/55555|3,199,856|86|486,497|\n\n|Col1|Tor|Commercial VPN service|\n|---|---|---|\n|Supported protocols|TCP|TCP/UDP|\n|Cost|Free|Non-free|\n|Risk of being blocked|High|Low|\n\n\n-----\n\n**INDICATORS OF COMPROMISE (IOC)**\n\n**Indicator** **Type** **Context**\n\n0a3279bb86ff0de24c2a4b646f24ffa196ee639cc23c64a044e20f50b93bda21 SHA256 Winnti 4.0 dat file\n\n03b7b511716c074e9f6ef37318638337fd7449897be999505d4a3219572829b4 SHA256 ShadowPad Variant1\n\naef610b66b9efd1fa916a38f8ffea8b988c20c5deebf4db83b6be63f7ada2cc0 SHA256 ShadowPad Variant2\n\nd011130defd8b988ab78043b30a9f7e0cada5751064b3975a19f4de92d2c0025 SHA256 ShadowPad Variant3\n\n1ded9878f8680e1d91354cbb5ad8a6960efd6ddca2da157eb4c1ef0f0430fd5f SHA256 Spyder communicating with\nthe ShadowPad C2\n(156.240.104.149)\n\n536def339fefa0c259cf34f809393322cdece06fc4f2b37f06136375b073dff3 SHA256 ReverseWindow\ncommunicating with the\nShadowPad C2\n(43.129.188.223)\n\n9447b75af497e5a7f99f1ded1c1d87c53b5b59fce224a325932ad55eef9e0e4a SHA256 ShadowPad Variant1\ncommunicating with the\nShadowPad C2\n(213.59.118.124)\n\n**REFERENCES**\n\n[1] [FireEye. Double Dragon: APT41, a dual espionage and cyber crime operation. https://content.fireeye.com/apt-41/](https://content.fireeye.com/apt-41/rpt-apt41/)\nrpt-apt41/.\n\n[2] Kaspersky Lab Global Research and Analysis Team. “Winnti” More than just a game. April 2013.\n[https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/20134508/winnti-more-than-just-a-](https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/20134508/winnti-more-than-just-a-game-130410.pdf)\ngame-130410.pdf.\n\n[3] [Novetta. WINNTI ANALYSIS. https://www.novetta.com/wp-content/uploads/2015/04/novetta_winntianalysis.pdf.](https://www.novetta.com/wp-content/uploads/2015/04/novetta_winntianalysis.pdf)\n\n[4] [Macnica Networks. APTマルウェアに見る不易流行. Japan Security Analyst Conference 2018.](https://www.jpcert.or.jp/present/2018/JSAC2018_09_yanagishita-takeuchi.pdf)\nhttps://www.jpcert.or.jp/present/2018/JSAC2018_09_yanagishita-takeuchi.pdf.\n\n[5] Threat Analysis Unit. CB TAU Threat Intelligence Notification: Winnti Malware 4.0. VMware Security Blog.\n[September 2019. https://blogs.vmware.com/security/2019/09/cb-tau-threat-intelligence-notification-winnti-](https://blogs.vmware.com/security/2019/09/cb-tau-threat-intelligence-notification-winnti-malware-4-0.html)\nmalware-4-0.html.\n\n[6] [Hex-Rays. IDA Pro 5.6 Appcall user guide. 2010. https://www.hex-rays.com/wp-content/uploads/2019/12/](https://www.hex-rays.com/wp-content/uploads/2019/12/debugging_appcall.pdf)\ndebugging_appcall.pdf.\n\n[7] M.Léveillé, M.-E.; Tartare, M. Connecting the dots: Exposing the arsenal and methods of the Winnti Group. We\n[Live Security. October 2019. https://www.welivesecurity.com/2019/10/14/connecting-dots-exposing-arsenal-](https://www.welivesecurity.com/2019/10/14/connecting-dots-exposing-arsenal-methods-winnti/)\nmethods-winnti/.\n\n[8] [Trend Micro. Winnti Abuses GitHub for C&C Communications. March 2017. https://www.trendmicro.com/en_us/](https://www.trendmicro.com/en_us/research/17/c/winnti-abuses-github.html)\nresearch/17/c/winnti-abuses-github.html.\n\n[9] [Zmap. https://github.com/zmap/zmap.](https://github.com/zmap/zmap)\n\n[10] Threat Analysis Unit. Threat Analysis: Active C2 Discovery Using Protocol Emulation Part2 (Winnti 4.0). VMware\n[Security Blog. February 2020. https://blogs.vmware.com/security/2020/02/threat-analysis-active-c2-discovery-](https://blogs.vmware.com/security/2020/02/threat-analysis-active-c2-discovery-using-protocol-emulation-part2-winnti-4-0.html)\nusing-protocol-emulation-part2-winnti-4-0.html.\n\n[11] [Haruyama, T. Monitoring Winnti 4.0 C2 Servers for Two Years. VMware Security Blog. November 2021.](https://blogs.vmware.com/security/2021/11/monitoring-winnti-4-0-c2-servers-for-two-years.html)\nhttps://blogs.vmware.com/security/2021/11/monitoring-winnti-4-0-c2-servers-for-two-years.html.\n\n[12] Beek, C. Operation ‘Harvest’: A Deep Dive into a Long-term Campaign. Trellix. September 2021.\n[https://www.trellix.com/en-us/about/newsroom/stories/threat-labs/operation-harvest-a-deep-dive-into-a-long-term-](https://www.trellix.com/en-us/about/newsroom/stories/threat-labs/operation-harvest-a-deep-dive-into-a-long-term-campaign.html)\ncampaign.html.\n\n[13] Insikt Group. China-Linked Group TAG-28 Targets India’s “The Times Group” and UIDAI (Aadhaar) Government\n[Agency With Winnti Malware. Recorded Future. September 2021. https://go.recordedfuture.com/hubfs/reports/](https://go.recordedfuture.com/hubfs/reports/cta-2021-0921.pdf)\ncta-2021-0921.pdf.\n\n[14] Hsieh, Y-J. ShadowPad | A Masterpiece of Privately Sold Malware in Chinese Espionage. SentinelOne. August\n[2021. https://www.sentinelone.com/labs/shadowpad-a-masterpiece-of-privately-sold-malware-in-chinese-](https://www.sentinelone.com/labs/shadowpad-a-masterpiece-of-privately-sold-malware-in-chinese-espionage/)\nespionage/.\n\n|INDICATORS OF COMPROMISE (IOC)|Col2|Col3|\n|---|---|---|\n|Indicator|Type|Context|\n|0a3279bb86ff0de24c2a4b646f24ffa196ee639cc23c64a044e20f50b93bda21|SHA256|Winnti 4.0 dat file|\n|03b7b511716c074e9f6ef37318638337fd7449897be999505d4a3219572829b4|SHA256|ShadowPad Variant1|\n|aef610b66b9efd1fa916a38f8ffea8b988c20c5deebf4db83b6be63f7ada2cc0|SHA256|ShadowPad Variant2|\n|d011130defd8b988ab78043b30a9f7e0cada5751064b3975a19f4de92d2c0025|SHA256|ShadowPad Variant3|\n|1ded9878f8680e1d91354cbb5ad8a6960efd6ddca2da157eb4c1ef0f0430fd5f|SHA256|Spyder communicating with the ShadowPad C2 (156.240.104.149)|\n|536def339fefa0c259cf34f809393322cdece06fc4f2b37f06136375b073dff3|SHA256|ReverseWindow communicating with the ShadowPad C2 (43.129.188.223)|\n|9447b75af497e5a7f99f1ded1c1d87c53b5b59fce224a325932ad55eef9e0e4a|SHA256|ShadowPad Variant1 communicating with the ShadowPad C2 (213.59.118.124)|\n\n\n-----\n\n[15] [Prescott, A. Chasing Shadows: A deep dive into the latest obfuscation methods being used by ShadowPad. PwC.](https://www.pwc.co.uk/issues/cyber-security-services/research/chasing-shadows.html)\nDecember 2021. https://www.pwc.co.uk/issues/cyber-security-services/research/chasing-shadows.html.\n\n[16] Positive Technologies. Higaisa or Winnti? APT41 backdoors, old and new. January 2021.\n[https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-](https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-and-new/)\nand-new/.\n\n[17] [Faou, M.; Tartare, M.; Dupuy, T. Exchange servers under siege from at least 10 APT groups. We Live Security.](https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/)\nMarch 2021. https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/.\n\n[18] [VirusTotal. https://www.virustotal.com/gui/file/](https://www.virustotal.com/gui/file/d011130defd8b988ab78043b30a9f7e0cada5751064b3975a19f4de92d2c0025)\nd011130defd8b988ab78043b30a9f7e0cada5751064b3975a19f4de92d2c0025.\n\n[19] [QuickLZ. http://www.quicklz.com/.](http://www.quicklz.com/)\n\n[20] Dr.Web. Study of the ShadowPad APT backdoor and its relation to PlugX. October 2020. https://st.drweb.com/\n[static/new-www/news/2020/october/Study_of_the_ShadowPad_APT_backdoor_and_its_relation_to_PlugX_en.](https://st.drweb.com/static/new-www/news/2020/october/Study_of_the_ShadowPad_APT_backdoor_and_its_relation_to_PlugX_en.pdf)\npdf.\n\n[21] Dr.Web. Study of the Spyder modular backdoor for targeted attacks. March 2021. https://st.drweb.com/static/\nnew-www/news/2021/march/BackDoor.Spyder.1_en.pdf.\n\n[22] [Leon; Shui. “LuoYu” The eavesdropper sneaking in multiple platforms. TeamT5. https://jsac.jpcert.or.jp/](https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_301_shui-leon_en.pdf)\narchive/2021/pdf/JSAC2021_301_shui-leon_en.pdf.\n\n[23] [Shodan. https://www.shodan.io/.](https://www.shodan.io/)\n\n[24] [CenSys. https://censys.io/.](https://censys.io/)\n\n[25] [https://api.shodan.io/shodan/ports.](https://api.shodan.io/shodan/ports)\n\n[26] [Tor. I want to ban the Tor network from my service. https://support.torproject.org/abuse/i-want-to-ban-tor/.](https://support.torproject.org/abuse/i-want-to-ban-tor/)\n\n[27] [Mullvad. https://mullvad.net/en/.](https://mullvad.net/en/)\n\n[28] [Haruyama, T. Segmentation fault when sending IP layer packets #580. https://github.com/zmap/zmap/issues/580.](https://github.com/zmap/zmap/issues/580)\n\n[29] [https://github.com/carbonblack/active_c2_ioc_public.](https://github.com/carbonblack/active_c2_ioc_public)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "4e039bf8-7239-4999-8ec0-eb202d1465af",
            "created_at": "2022-12-04T11:19:36.52593Z",
            "updated_at": "2022-12-04T11:19:36.52593Z",
            "deleted_at": null,
            "name": "ORKL",
            "url": "https://github.com/ORKL/library",
            "description": "ORKL Community Contributed Content",
            "reports": null
        }
    ],
    "references": [
        "https://www.virusbulletin.com/uploads/pdf/conference/vb2022/papers/VB2022-Tracking-the-entire-iceberg-long-term-APT-malware-C2-protocol-emulation-and-scanning.pdf"
    ],
    "report_names": [
        "VB2022-Tracking-the-entire-iceberg-long-term-APT-malware-C2-protocol-emulation-and-scanning.pdf"
    ],
    "threat_actors": [
        {
            "id": "46b409af-b2ea-43b8-9223-e01d982e00ce",
            "created_at": "2022-10-25T16:07:23.966265Z",
            "updated_at": "2025-03-27T02:02:10.052693Z",
            "deleted_at": null,
            "main_name": "Operation Harvest",
            "aliases": [],
            "source_name": "ETDA:Operation Harvest",
            "tools": [
                "Agent.dhwf",
                "BadPotato",
                "BleDoor",
                "Destroy RAT",
                "DestroyRAT",
                "Impacket",
                "Kaba",
                "Korplug",
                "Mimikatz",
                "NBTscan",
                "PlugX",
                "ProcDump",
                "PsExec",
                "RbDoor",
                "RedDelta",
                "RibDoor",
                "RottenPotato",
                "SMBExec",
                "Sogu",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "WinRAR",
                "Winnti",
                "Xamtrav",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "acd409e4-7c55-4110-a441-f3ecf6d20354",
            "created_at": "2024-01-23T13:22:35.073924Z",
            "updated_at": "2025-03-27T02:00:03.284281Z",
            "deleted_at": null,
            "main_name": "TAG-28",
            "aliases": [],
            "source_name": "MISPGALAXY:TAG-28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5bbced13-72f7-40dc-8c41-dcce75bf885e",
            "created_at": "2022-10-25T15:50:23.695735Z",
            "updated_at": "2025-03-27T02:00:55.525839Z",
            "deleted_at": null,
            "main_name": "Winnti Group",
            "aliases": [
                "Winnti Group"
            ],
            "source_name": "MITRE:Winnti Group",
            "tools": [
                "PipeMon",
                "Winnti for Windows",
                "PlugX"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "873919c0-bc6a-4c19-b18d-c107e4aa3d20",
            "created_at": "2023-01-06T13:46:39.138138Z",
            "updated_at": "2025-03-27T02:00:03.005534Z",
            "deleted_at": null,
            "main_name": "Higaisa",
            "aliases": [],
            "source_name": "MISPGALAXY:Higaisa",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "58db0213-4872-41fe-8a76-a7014d816c73",
            "created_at": "2023-01-06T13:46:38.61757Z",
            "updated_at": "2025-03-27T02:00:02.874484Z",
            "deleted_at": null,
            "main_name": "Tonto Team",
            "aliases": [
                "BRONZE HUNTLEY",
                "Red Beifang",
                "G0131",
                "PLA Unit 65017",
                "Earth Akhlut",
                "TAG-74",
                "CactusPete",
                "KARMA PANDA"
            ],
            "source_name": "MISPGALAXY:Tonto Team",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "945a572f-ebe3-4e2f-a288-512fe751cfa8",
            "created_at": "2022-10-25T16:07:24.413971Z",
            "updated_at": "2025-03-27T02:02:10.212853Z",
            "deleted_at": null,
            "main_name": "Winnti Group",
            "aliases": [
                "Wicked Panda",
                "Winnti Group"
            ],
            "source_name": "ETDA:Winnti Group",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "FunnySwitch",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "da483338-e479-4d74-a6dd-1fb09343fd07",
            "created_at": "2022-10-25T15:50:23.698197Z",
            "updated_at": "2025-03-27T02:00:55.526588Z",
            "deleted_at": null,
            "main_name": "Tonto Team",
            "aliases": [
                "Tonto Team",
                "Earth Akhlut",
                "BRONZE HUNTLEY",
                "CactusPete",
                "Karma Panda"
            ],
            "source_name": "MITRE:Tonto Team",
            "tools": [
                "Mimikatz",
                "Bisonal",
                "ShadowPad",
                "LaZagne",
                "NBTscan",
                "gsecdump"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "6cf5f006-5ed7-4a00-8103-1781bad5a5e1",
            "created_at": "2022-10-25T16:07:24.294829Z",
            "updated_at": "2025-03-27T02:02:10.162788Z",
            "deleted_at": null,
            "main_name": "TAG-28",
            "aliases": [],
            "source_name": "ETDA:TAG-28",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "30c9c492-afc6-4aa1-8fe6-cecffed946e0",
            "created_at": "2022-10-25T15:50:23.400822Z",
            "updated_at": "2025-03-27T02:00:55.461334Z",
            "deleted_at": null,
            "main_name": "Higaisa",
            "aliases": [
                "Higaisa"
            ],
            "source_name": "MITRE:Higaisa",
            "tools": [
                "PlugX",
                "certutil",
                "gh0st RAT"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c0cedde3-5a9b-430f-9b77-e6568307205e",
            "created_at": "2022-10-25T16:07:23.528994Z",
            "updated_at": "2025-03-27T02:02:09.847683Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "APT-C-06",
                "ATK 52",
                "CTG-1948",
                "Dubnium",
                "Fallout Team",
                "Higaisa",
                "Luder",
                "Operation DarkHotel",
                "Operation Daybreak",
                "Operation Inexsmar",
                "Operation PowerFall",
                "Operation The Gh0st Remains the Same",
                "SIG25",
                "Shadow Crane",
                "T-APT-02",
                "Tungsten Bridge",
                "Zigzag Hail"
            ],
            "source_name": "ETDA:DarkHotel",
            "tools": [
                "Asruex",
                "DarkHotel",
                "DmaUp3.exe",
                "GreezeBackdoor",
                "Karba",
                "Nemain",
                "Nemim",
                "Ramsay",
                "Retro",
                "Tapaoux",
                "Trojan.Win32.Karba.e",
                "Virus.Win32.Pioneer.dx",
                "igfxext.exe",
                "msieckc.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "c7d9878a-e691-4c6f-81ae-84fb115a1345",
            "created_at": "2022-10-25T16:07:23.359506Z",
            "updated_at": "2025-03-27T02:02:09.752427Z",
            "deleted_at": null,
            "main_name": "APT 41",
            "aliases": [
                "BrazenBamboo",
                "Bronze Atlas",
                "Double Dragon",
                "Earth Baku",
                "Grayfly",
                "Operation ColunmTK",
                "Operation CuckooBees",
                "Operation ShadowHammer",
                "Red Kelpie",
                "SparklingGoblin",
                "TA415",
                "TG-2633"
            ],
            "source_name": "ETDA:APT 41",
            "tools": [
                "9002 RAT",
                "ADORE.XSEC",
                "ASPXSpy",
                "ASPXTool",
                "AceHash",
                "Agent.dhwf",
                "Agentemis",
                "AndroidControl",
                "AngryRebel",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BLUEBEAM",
                "Barlaiy",
                "BlackCoffee",
                "Bladabindi",
                "BleDoor",
                "CCleaner Backdoor",
                "CHINACHOPPER",
                "COLDJAVA",
                "China Chopper",
                "ChyNode",
                "Cobalt Strike",
                "CobaltStrike",
                "Crackshot",
                "CrossWalk",
                "CurveLast",
                "CurveLoad",
                "DAYJOB",
                "DBoxAgent",
                "DEADEYE",
                "DEADEYE.APPEND",
                "DEADEYE.EMBED",
                "DEPLOYLOG",
                "DIRTCLEANER",
                "DUSTTRAP",
                "Derusbi",
                "Destroy RAT",
                "DestroyRAT",
                "DodgeBox",
                "DragonEgg",
                "ELFSHELF",
                "EasyNight",
                "Farfli",
                "FunnySwitch",
                "Gh0st RAT",
                "Ghost RAT",
                "HDD Rootkit",
                "HDRoot",
                "HKDOOR",
                "HOMEUNIX",
                "HUI Loader",
                "HidraQ",
                "HighNoon",
                "HighNote",
                "Homux",
                "Hydraq",
                "Jorik",
                "Jumpall",
                "KEYPLUG",
                "Kaba",
                "Korplug",
                "LATELUNCH",
                "LOLBAS",
                "LOLBins",
                "LightSpy",
                "Living off the Land",
                "Lowkey",
                "McRAT",
                "MdmBot",
                "MessageTap",
                "Meterpreter",
                "Mimikatz",
                "MoonBounce",
                "MoonWalk",
                "Motnug",
                "Moudour",
                "Mydoor",
                "NTDSDump",
                "PACMAN",
                "PCRat",
                "PINEGROVE",
                "PNGRAT",
                "POISONPLUG",
                "POISONPLUG.SHADOW",
                "POTROAST",
                "PRIVATELOG",
                "PipeMon",
                "PlugX",
                "PortReuse",
                "ProxIP",
                "ROCKBOOT",
                "RbDoor",
                "RedDelta",
                "RedXOR",
                "RibDoor",
                "Roarur",
                "RouterGod",
                "SAGEHIRE",
                "SPARKLOG",
                "SQLULDR2",
                "STASHLOG",
                "SWEETCANDLE",
                "ScrambleCross",
                "Sensocode",
                "SerialVlogger",
                "ShadowHammer",
                "ShadowPad Winnti",
                "SinoChopper",
                "Skip-2.0",
                "SneakCross",
                "Sogu",
                "Speculoos",
                "Spyder",
                "StealthReacher",
                "StealthVector",
                "TERA",
                "TIDYELF",
                "TIGERPLUG",
                "TOMMYGUN",
                "TVT",
                "Thoper",
                "Voldemort",
                "WIDETONE",
                "WINNKIT",
                "WINTERLOVE",
                "Winnti",
                "WyrmSpy",
                "X-Door",
                "XDOOR",
                "XMRig",
                "XShellGhost",
                "Xamtrav",
                "ZXShell",
                "ZoxPNG",
                "certutil",
                "certutil.exe",
                "cobeacon",
                "gresim",
                "njRAT",
                "pwdump",
                "xDll"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4d5f939b-aea9-4a0e-8bff-003079a261ea",
            "created_at": "2023-01-06T13:46:39.04841Z",
            "updated_at": "2025-03-27T02:00:02.985296Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "G0096",
                "Grayfly",
                "BARIUM",
                "BRONZE ATLAS",
                "BRONZE EXPORT",
                "Red Kelpie",
                "HOODOO",
                "Brass Typhoon",
                "TA415",
                "WICKED SPIDER",
                "WICKED PANDA",
                "G0044",
                "Earth Baku"
            ],
            "source_name": "MISPGALAXY:APT41",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e698860d-57e8-4780-b7c3-41e5a8314ec0",
            "created_at": "2022-10-25T15:50:23.287929Z",
            "updated_at": "2025-03-27T02:00:55.43005Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "APT41",
                "Wicked Panda",
                "Brass Typhoon",
                "BARIUM"
            ],
            "source_name": "MITRE:APT41",
            "tools": [
                "ASPXSpy",
                "BITSAdmin",
                "PlugX",
                "Impacket",
                "gh0st RAT",
                "netstat",
                "PowerSploit",
                "ZxShell",
                "KEYPLUG",
                "ipconfig",
                "sqlmap",
                "China Chopper",
                "ShadowPad",
                "MESSAGETAP",
                "Mimikatz",
                "certutil",
                "njRAT",
                "Cobalt Strike",
                "pwdump",
                "BLACKCOFFEE",
                "ROCKBOOT",
                "dsquery",
                "Winnti for Linux",
                "DUSTTRAP",
                "Derusbi",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "b72c2616-cc7c-4c47-a83d-6b7866b94746",
            "created_at": "2023-01-06T13:46:39.425297Z",
            "updated_at": "2025-03-27T02:00:03.08718Z",
            "deleted_at": null,
            "main_name": "Red Nue",
            "aliases": [
                "LuoYu"
            ],
            "source_name": "MISPGALAXY:Red Nue",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c39b0fe6-5642-4717-9a05-9e94265e3e3a",
            "created_at": "2022-10-25T16:07:24.332084Z",
            "updated_at": "2025-03-27T02:02:10.175452Z",
            "deleted_at": null,
            "main_name": "Tonto Team",
            "aliases": [
                "Bronze Huntley",
                "CactusPete",
                "Earth Akhlut",
                "HartBeat",
                "Karma Panda",
                "LoneRanger",
                "Operation Bitter Biscuit",
                "TAG-74",
                "Tonto Team"
            ],
            "source_name": "ETDA:Tonto Team",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Bioazih",
                "Bisonal",
                "CONIME",
                "Dexbia",
                "Korlia",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "POISONPLUG.SHADOW",
                "RoyalRoad",
                "ShadowPad Winnti",
                "XShellGhost"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1667354909,
    "ts_updated_at": 1743041845,
    "ts_creation_date": 1663614000,
    "ts_modification_date": 1664031729,
    "files": {
        "pdf": "https://archive.orkl.eu/678b6a1820753ba476409b596830e9a878310ba7.pdf",
        "text": "https://archive.orkl.eu/678b6a1820753ba476409b596830e9a878310ba7.txt",
        "img": "https://archive.orkl.eu/678b6a1820753ba476409b596830e9a878310ba7.jpg"
    }
}