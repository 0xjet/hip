{
    "id": "e81afcf4-4654-434c-9b99-ac3fe05994b8",
    "created_at": "2023-01-12T15:02:27.232191Z",
    "updated_at": "2025-03-27T02:06:14.30561Z",
    "deleted_at": null,
    "sha1_hash": "b7d88298fb16f3d9136b34406f0c1565228d9947",
    "title": "2020-02-18 - Nearly a quarter of malware now communicates using TLS",
    "authors": "",
    "file_creation_date": "2022-05-28T16:49:51Z",
    "file_modification_date": "2022-05-28T16:49:51Z",
    "file_size": 2245522,
    "plain_text": "# Nearly a quarter of malware now communicates using TLS\n\n**[news.sophos.com/en-us/2020/02/18/nearly-a-quarter-of-malware-now-communicates-using-tls/](https://news.sophos.com/en-us/2020/02/18/nearly-a-quarter-of-malware-now-communicates-using-tls/)**\n\nLuca Nagy February 18, 2020\n\nEncryption is one of the strongest weapons malware authors can leverage: They can use it\nto obfuscate their code, to prevent users (in the case of ransomware) from being able to\naccess their files, and for securing their malicious network communication.\n\nAs websites and apps more widely adopt TLS (Transport Layer Security) and communicate\nover HTTPS connections, unencrypted traffic may draw even more attention, since it’s easier\nfor analysts and security tools to identify malicious communication patterns in those plain\nHTTP sessions. Malware authors know this, and they’ve made it a priority to adopt TLS and\nthereby obfuscate the contents of malicious communication.\n\nOne of the reasons why it’s easier to find signs of malicious activity in unencrypted traffic is\nthat recent releases of malware tends to phone home more frequently than it used to, and\nwhen it does, sends increasingly larger volumes of profiling information about the target\nmachine and network back to its operators. After it identifies the victim, malware increasingly\ncommunicates with its operator(s) in order to perform network reconnaissance, and to send\nthe collected information to its command and control server.\n\nThis kind of information theft can be a precursor to a subsequent targeted attack, or can be\nused for blackmail, or sold to other criminals who may abuse it in a variety of ways. Without\nthe protective layer of TLS encryption obfuscating the contents of this communication, a\n\n\n-----\n\nsharp-eyed analyst or data loss prevention tool might easily catch this type of theft in the act,\nbefore the malware may cause harm.\n\nWe’ve also observed that, increasingly, more malicious functions are being orchestrated from\nthe command-and-control (C2) server, rather than implemented in the malware binary, and\nthe C2s make decisions about what the malware should do next based on the exfiltrated\ndata, which increases the volume of network traffic. Malware authors also want to empower\ntheir binaries with newer features and refresh them more often, which also increases the\nneed for secure network communication, to prevent network-level protection tools from\ndiscovering an active infection inside the network every time it downloads an updated\nversion of itself.\n\n## SSL/TLS usage by recent malware campaigns\n\nMalware that does a poor job of hiding its C2 communication can be more easily detected.\nSo, increasingly, cybercriminals have tended to adopt transport-layer encryption.\n\nTo see what the current state of the art is, we reviewed a representative sampling of malware\nanalyses we’ve made over the past six months. The analyses included details about whether\nthe malware connected to one or more machines on the internet; For simplicity’s sake, we\nconsider that sample to be a “TLS user” for the purposes of this research when the sample\ncommunicated over port 443/TCP (the standard port used for TLS-encrypted HTTPS\ncommunications) during the analysis.\n\n\n-----\n\nOut of all the malware that made some kind of network connection during their infection\nprocess, about 23% communicated over HTTPS, either to send or receive data from the C2,\nor during installation when they may use HTTPS to conceal the fact that they are retrieving\nmalicious payloads or components.\n\nNetwork traffic encryption is more important for Trojans, especially information stealers. An\ninformation stealer’s main goal is to collect as much data about the victim as possible,\nincluding sensitive financial information, and remain undetected while doing so. Among our\nsample set, information stealers made up 16% of the total number of samples tested during\nthe time period.\n\nInformation stealers relied more heavily on HTTPS to communicate than any other type of\nmalware. Even though they make up only a little more than an eighth of the total samples\nthat made any kind of internet connection during their infection process in our analyses,\nabout 44% of the information stealers communicate using TLS over the standard HTTPS\nports.\n\n\n-----\n\nUsing SSL/TLS gives malware the ability to conceal commands sent to the client, hide data\nexfiltration, or prevent the detection of downloads of additional modules or payloads. In this\nanalysis, we consider any of those activities a use of TLS.\n\n## Stacking on more encryption\n\nBut malware creators do not rely on TLS alone to conceal the true nature of their activities.\nMany add another layer of security, such as an additional, symmetric cipher to encrypt their\ndata, for concealment within TLS.\n\nMalware authors usually employ higher level APIs for network communication, like\nWinInet.dll or URLmon.dll. With lower level APIs, the developers can craft sockets manually,\nso they can use custom protocols, which may be more difficult to identify.\n\nPerhaps unsurprisingly, the adoption rate of TLS by ransomware, specifically, is much lower\nthan the average across all malware families, because ransomware is less reliant on stealthy\ncommunication, or on stealth in general, once it has done the damage.\n\n## Legitimate services for malicious content\n\nFrom the malware author’s point of view, using a legitimate service to store and host\nmalicious content has several benefits. One is that the legit services, in nearly all cases, use\nTLS by default, and as a side benefit, the malicious content can stay hidden and the malware\ndistributor doesn’t need to obtain their own TLS certificate for their website.\n\n\n-----\n\nThe malicious use of legitimate services like Pastebin, Dropbox, or other cloud storage\nservices has also tended to grow. In the last six months, 0.8% of the samples we surveyed\ncommunicated directly with Pastebin, including Trojans, RATs, and infostealers.\n\nSome of the uses of these Pastebin mal-pastes include 2nd stage downloaders, VBA or\nPowerShell scripts, malicious PE files, or lists of URLs where other content may be obtained.\nIn most cases we observed, the content of these mal-pastes were also encoded with simple\nXOR, RC4, or Base64 to further obfuscate their true nature.\n\n## Recent widespread families using SSL/TLS\n\n### TrickBot\n\nTrickBot’s main goal is to steal information from the victim machine. It collects information\nabout the system, user, their browsers, the network on which the computer is running, the\nemail accounts that belong to the victim, and particularly, bank or financial account\npasswords or other credentials.\n\nSSL/TLS handshake of TrickBot\nThis family distributes itself with its own malspam payload, and may also be delivered by\nother malware, such as Emotet. Emotet’s effective spam campaigns have proven to make a\nsuccessful combination with TrickBot.\n\nTrickBot applies several techniques to evade detections, including process hollowing, or\ndisabling some security tools. It has a modular structure, having several modules for\nstealing, moving laterally for propagation, or to provide remote access for the attackers.\nTrickBot usually downloads its modules using https, then injects the modules into an instance\nof the legitimate Windows component svchost.exe. After that, TrickBot exfiltrates any\ninformation the malware can collect with an https POST method. Besides using the standard\nTLS port 443, in some cases it uses unusual and distinctively-nonstandard ports such as\n449/TCP, to communicate over TLS.\n\nThe TrickBot binary uses the WinHttpOpenRequest, WinHttpSendRequest in WINHTTP.dll,\nwith both the GET and POST methods, to download modules or send sensitive information\nto the server. The data sent to the C2 includes the group ID and client ID of the specific\nmalware distribution, and one or more commands. It uses CryptoAPI to further encrypt the\nexfiltrated data.\n\n## IcedID\n\n\n-----\n\nIcedID is a banking Trojan that performs web injection attacks against browsers in order to\nsteal information. It injects itself into svchost.exe and can spread laterally through the\nnetwork to infect other machines.\n\nIcedID traffic filtered on its SSL/TLS Client Hello messages\nIt uses WINHTTP.DLL to perform its network communication, just as TrickBot does. SSL/TLS\nis used in communication to and from the C2 server. It also downloads its configuration files\nover TLS, and the body of the responses are also encrypted using the RC4 cipher. Besides\nTLS, it can use unencrypted HTTP GET requests to transmit stolen information (as can be\nseen on the following screenshot of a packet capture). The requests include the Bot ID, and\nthe malware’s internal version number.\n\n## Dridex\n\nDridex is a banking Trojan, delivered by phishing campaigns and as a payload of the Emotet\nbotnet. It was first spotted in 2011, and it is still under constant development. The recent\nsamples use several types of code injection techniques, like Atom Bombing or Process\nHollowing, against legitimate Windows executables.\n\nDridex has a modular framework; the loader module downloads the main module, which can\nperform several core functions beside downloading additional modules. It has the capability\nto steal credentials, cookies, certificates, keystrokes, and even take screenshots. Dridex\nfrequently uses https on port 443 to download payload modules or send the collected data.\nThe exfiltrated data can additionally be encrypted using RC4, if the attacker desires.\n\nA Dridex sample communicated with the following ports and IP addresses with POST\nmethod using WinInet.dll with the usual HttpOpenRequestW, HttpSendRequestW functions\n\nDridex C2s\n\n## TLS is here to stay\n\n\n-----\n\nAs we have seen, TLS doesn t provide malware with 100% security, as there are network\ninspection tools that are able to peek inside the encrypted tunnel and identify and block the\nmalicious traffic. The proportion of malware implementing TLS to protect its communication\nhas been and will likely continue to increase. This raises strong concerns about the ability to\ndetect and defend against the adoption of transport layer security by malicious actors. The\nabove-mentioned malware families include the most widespread and dangerous threats in\nrecent years, and they are not likely to go away in the foreseeable future.\n\nIn order to protect yourself, it’s important to inspect network traffic and check the TLS\ncertificate details of https communications. You should pay significant attention to unusual or\nunexpected volumes of https traffic to unknown domains or using invalid or forged TLS\ncertificates, in particular during financial transactions and when entering personal or sensitive\ninformation into browsers. Invest in a network security product that can perform these kinds\nof TLS communication inspections, and, ideally, can communicate and coordinate with your\nanti-virus product, VPN, firewalls, and/or your IDS/IPS to halt suspicious or known malicious\nnetwork communications.\n\n## IoCs\n\nThe following samples were used to generate network traffic used as examples in this post.\n\n### Trickbot:\n\n2baf66b83d6cd0b52e3dae66c42a0a3a3c279319c68b77e02141a2c355698409\ne17149663a7d2f9ec19d28102d8379b764c5dd83c1ec8c7278300c58893e7600\n\n### IcedID:\n\nda7d9687c5776eecc90f7d11dbe32623f9aa1f44fc2eff5088e0540014adcb0e\nf09fe918108769ef3200e7978d983722b407b26cc2d3fe07d3804e8e331a0986\n\n### Dridex:\n\n585e245b0ba761e2ec27bf33e02dec44b888469b868dddd65d2511bfd5155917\n8be38d81426e338c5daa60e35776000f5d199f562c74a57a55356861ba21703d\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-02-18 - Nearly a quarter of malware now communicates using TLS.pdf"
    ],
    "report_names": [
        "2020-02-18 - Nearly a quarter of malware now communicates using TLS.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535747,
    "ts_updated_at": 1743041174,
    "ts_creation_date": 1653756591,
    "ts_modification_date": 1653756591,
    "files": {
        "pdf": "https://archive.orkl.eu/b7d88298fb16f3d9136b34406f0c1565228d9947.pdf",
        "text": "https://archive.orkl.eu/b7d88298fb16f3d9136b34406f0c1565228d9947.txt",
        "img": "https://archive.orkl.eu/b7d88298fb16f3d9136b34406f0c1565228d9947.jpg"
    }
}