{
    "id": "c574030a-904f-49da-b91a-640bf3bf8300",
    "created_at": "2022-10-25T16:48:15.260595Z",
    "updated_at": "2025-03-27T02:15:45.323175Z",
    "deleted_at": null,
    "sha1_hash": "6c2a04c303f73b5babacb999ff10008584eaf254",
    "title": "LuckyMouse hits national data center to organize country-level waterholing campaign",
    "authors": "Kaspersky",
    "file_creation_date": "2019-11-20T16:54:02Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 184025,
    "plain_text": "# LuckyMouse hits national data center to organize country- level waterholing campaign\n\n**[securelist.com/luckymouse-hits-national-data-center/86083](https://securelist.com/luckymouse-hits-national-data-center/86083/)**\n\nBy Denis Legezo\n\n## What happened?\n\nIn March 2018 we detected an ongoing campaign targeting a national data center in the\nCentral Asia that we believe has been active since autumn 2017. The choice of target made\nthis campaign especially significant – it meant the attackers gained access to a wide range of\ngovernment resources at one fell swoop. We believe this access was abused, for example,\nby inserting malicious scripts in the country’s official websites in order to conduct watering\nhole attacks.\n\nThe operators used the HyperBro Trojan as their last-stage in-memory remote\nadministration tool (RAT). The timestamps for these modules are from December 2017 until\nJanuary 2018. The anti-detection launcher and decompressor make extensive use of\nMetasploit’s shikata_ga_nai encoder as well as LZNT1 compression.\n\nKaspersky Lab products detect the different artifacts used in this campaign with the\nfollowing verdicts: Trojan.Win32.Generic, Trojan-Downloader.Win32.Upatre and\nBackdoor.Win32.HyperBro. A full technical report, IoCs and YARA rules are available from\nour intelligence reporting service (contact us intelligence@kaspersky.com).\n\n## Who’s behind it?\n\nDue to tools and tactics in use we attribute the campaign to LuckyMouse Chinese-speaking\nactor (also known as EmissaryPanda and APT27). Also the C2 domain\nupdate.iaacstudio[.]com was previously used in their campaigns. The tools found in this\ncampaign, such as the HyperBro Trojan, are regularly used by a variety of Chinese-speaking\nactors. Regarding Metasploit’s shikata_ga_nai encoder – although it’s available for everyone\nand couldn’t be the basis for attribution, we know this encoder has been used by\nLuckyMouse previously.\n\nGovernment entities, including the Central Asian ones also were a target for this actor\nbefore. Due to LuckyMouse’s ongoing waterholing of government websites and the\ncorresponding dates, we suspect that one of the aims of this campaign is to access web\npages via the data center and inject JavaScripts into them.\n\n## How did the malware spread?\n\n\n-----\n\nThe initial infection vector used in the attack against the data center is unclear. Even when\nwe observed LuckyMouse using weaponized documents with CVE-2017-11882 (Microsoft\nOffice Equation Editor, widely used by Chinese-speaking actors since December 2017), we\ncan´t prove they were related to this particular attack. It’s possible the actor used a\nwaterhole to infect data center employees.\n\nThe main C2 used in this campaign is bbs.sonypsps[.]com, which resolved to IP-address,\nthat belongs to the Ukrainian ISP network, held by a Mikrotik router using firmware version\n6.34.4 (from March 2016) with SMBv1 on board. We suspect this router was hacked as part\nof the campaign in order to process the malware’s HTTP requests. The Sonypsps[.]com\ndomain was last updated using GoDaddy on 2017-05-05 until 2019-03-13.\n\n\n_FMikrotik router with two-year-old firmware and SMBv1 on board used in this campaign_\n\n\nIn March 2017, Wikileaks published details about an exploit affecting Mikrotik called\nChimayRed. According to the documentation, however, it doesn’t work for firmware\nversions higher than 6.30. This router uses version 6.34.\n\nThere were traces of HyperBro in the infected data center from mid-November 2017. Shortly\nafter that different users in the country started being redirected to the malicious domain\nupdate.iaacstudio[.]com as a result of the waterholing of government websites. These\nevents suggest that the data center infected with HyperBro and the waterholing campaign\nare connected.\n\n## What did the malware do in the data center?\n\n\n-----\n\n_Anti-detection stages. Different colors show the three dropped modules: legit app (blue), launcher (green), and_\n\n_decompressor with the Trojan embedded (red)_\n\n\nThe initial module drops three files that are typical for Chinese-speaking actors: a legit\nSymantec pcAnywhere (IntgStat.exe) for DLL side loading, a .dll launcher\n(pcalocalresloader.dll) and the last-stage decompressor (thumb.db). As a result of all these\nsteps, the last-stage Trojan is injected into svchost.exe’s process memory.\n\nThe launcher module, obfuscated with the notorious Metasploit’s shikata_ga_nai encoder, is\nthe same for all the droppers. The resulting deobfuscated code performs typical side\nloading: it patches pcAnywhere’s image in memory at its entry point. The patched code\njumps back to the decryptor’s second shikata_ga_nai iteration, but this time as part of the\nwhitelisted application.\n\nThis Metasploit’s encoder obfuscates the last part of the launcher’s code, which in turn\nresolves the necessary API and maps thumb.db into the same process’s (pcAnywhere)\nmemory. The first instructions in the mapped thumb.db are for a new shikata_ga_nai\niteration. The decrypted code resolves the necessary API functions, decompresses the\nembedded PE file with RtlCompressBuffer() using LZNT1 and maps it into memory.\n\n## What does the resulting watering hole look like?\n\n\n-----\n\nThe websites were compromised to redirect visitors to instances of both ScanBox and BEeF.\nThese redirects were implemented by adding two malicious scripts obfuscated by a tool\nsimilar to the Dean Edwards packer.\n\n\n_Resulting script on the compromised government websites_\n\n\nUsers were redirected to https://google-updata[.]tk:443/hook.js, a BEeF instance, and\nhttps://windows-updata[.]tk:443/scanv1.8/i/?1, an empty ScanBox instance that answered a\nsmall piece of JavaScript code.\n\n## Conclusions\n\nLuckyMouse appears to have been very active recently. The TTPs for this campaign are quite\ncommon for Chinese-speaking actors, where they typically provide new solid wrappers\n(launcher and decompressor protected with shikata_ga_nai in this case) around their RATs\n(HyperBro).\n\nThe most unusual and interesting point here is the target. A national data center is a\nvaluable source of data that can also be abused to compromise official websites. Another\ninteresting point is the Mikrotik router, which we believe was hacked specifically for the\ncampaign. The reasons for this are not very clear: typically, Chinese-speaking actors don’t\nbother disguising their campaigns. Maybe these are the first steps in a new stealthier\napproach.\n\n## Some indicators of compromise\n\n**Droppers**\n\n\n-----\n\n22CBE2B0F1EF3F2B18B4C5AED6D7BB79\n0D0320878946A73749111E6C94BF1525\n\n**Launcher**\nac337bd5f6f18b8fe009e45d65a2b09b\n\n**HyperBro in-memory Trojan**\n04dece2662f648f619d9c0377a7ba7c0\n\n**Domains and IPs**\nbbs.sonypsps[.]com\nupdate.iaacstudio[.]com\nwh0am1.itbaydns[.]com\ngoogle-updata[.]tk\nwindows-updata[.]tk\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/325jld1s8ymwd8a56jcao39i6cbc1m8g"
    ],
    "report_names": [
        "Kaspersky_LuckyMouse-datacenter-waterholing-campaign(06-13-2018)"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e3492534-85a6-4c87-a754-5ae4a56d7c8c",
            "created_at": "2022-10-25T15:50:23.819113Z",
            "updated_at": "2025-03-27T02:00:55.552554Z",
            "deleted_at": null,
            "main_name": "Threat Group-3390",
            "aliases": [
                "Threat Group-3390",
                "Earth Smilodon",
                "TG-3390",
                "Emissary Panda",
                "BRONZE UNION",
                "APT27",
                "Iron Tiger",
                "LuckyMouse"
            ],
            "source_name": "MITRE:Threat Group-3390",
            "tools": [
                "Systeminfo",
                "gsecdump",
                "PlugX",
                "ASPXSpy",
                "Cobalt Strike",
                "Mimikatz",
                "Impacket",
                "gh0st RAT",
                "certutil",
                "China Chopper",
                "HTTPBrowser",
                "Tasklist",
                "netstat",
                "SysUpdate",
                "HyperBro",
                "ZxShell",
                "RCSession",
                "ipconfig",
                "Clambling",
                "pwdump",
                "NBTscan",
                "Pandora",
                "Windows Credential Editor"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2c980ea7-04c4-4193-8535-52f87e66a96e",
            "created_at": "2024-05-01T02:03:07.994126Z",
            "updated_at": "2025-03-27T02:05:17.293799Z",
            "deleted_at": null,
            "main_name": "BRONZE UNION",
            "aliases": [
                "Budworm ",
                "Emissary Panda ",
                "Iron Tiger ",
                "Lucky Mouse ",
                "TG-3390 ",
                "Temp.Hippo ",
                "APT27 "
            ],
            "source_name": "Secureworks:BRONZE UNION",
            "tools": [
                " ASPXSpy",
                " China Chopper",
                " Enfal",
                " Gh0st RAT",
                " HttpBrowser",
                " Hunter",
                " HyperBro",
                " OwaAuth",
                " PlugX",
                " PoisonIvy",
                " Sysupdate",
                " ZxShell",
                "9002"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "c63ab035-f9f2-4723-959b-97a7b98b5942",
            "created_at": "2023-01-06T13:46:38.298354Z",
            "updated_at": "2025-03-27T02:00:02.798255Z",
            "deleted_at": null,
            "main_name": "APT27",
            "aliases": [
                "TG-3390",
                "EMISSARY PANDA",
                "TEMP.Hippo",
                "Budworm",
                "Group 35",
                "BRONZE UNION",
                "Lucky Mouse",
                "Iron Taurus",
                "GreedyTaotie",
                "Red Phoenix",
                "ZipToken",
                "Iron Tiger",
                "G0027",
                "Earth Smilodon"
            ],
            "source_name": "MISPGALAXY:APT27",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5c13338b-eaed-429a-9437-f5015aa98276",
            "created_at": "2022-10-25T16:07:23.582715Z",
            "updated_at": "2025-03-27T02:02:09.875151Z",
            "deleted_at": null,
            "main_name": "Emissary Panda",
            "aliases": [
                "APT 27",
                "ATK 15",
                "Bronze Union",
                "Budworm",
                "Earth Smilodon",
                "Emissary Panda",
                "Group 35",
                "Iron Taurus",
                "Iron Tiger",
                "LuckyMouse",
                "Operation DRBControl",
                "Operation Iron Tiger",
                "Operation PZChao",
                "Operation SpoiledLegacy",
                "Operation StealthyTrident",
                "Red Phoenix",
                "TEMP.Hippo",
                "TG-3390",
                "ZipToken"
            ],
            "source_name": "ETDA:Emissary Panda",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "Agent.dhwf",
                "AngryRebel",
                "Antak",
                "CHINACHOPPER",
                "China Chopper",
                "Destroy RAT",
                "DestroyRAT",
                "FOCUSFJORD",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HTTPBrowser",
                "HTran",
                "HUC Packet Transmit Tool",
                "HighShell",
                "HttpBrowser RAT",
                "HttpDump",
                "HyperBro",
                "HyperSSL",
                "HyperShell",
                "Kaba",
                "Korplug",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Mimikatz",
                "Moudour",
                "Mydoor",
                "Nishang",
                "OwaAuth",
                "PCRat",
                "PlugX",
                "ProcDump",
                "PsExec",
                "RedDelta",
                "SEASHARPEE",
                "Sensocode",
                "SinoChopper",
                "Sogu",
                "SysUpdate",
                "TIGERPLUG",
                "TVT",
                "Thoper",
                "Token Control",
                "TokenControl",
                "TwoFace",
                "WCE",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Xamtrav",
                "ZXShell",
                "gsecdump",
                "luckyowa"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716495,
    "ts_updated_at": 1743041745,
    "ts_creation_date": 1574268842,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/6c2a04c303f73b5babacb999ff10008584eaf254.pdf",
        "text": "https://archive.orkl.eu/6c2a04c303f73b5babacb999ff10008584eaf254.txt",
        "img": "https://archive.orkl.eu/6c2a04c303f73b5babacb999ff10008584eaf254.jpg"
    }
}