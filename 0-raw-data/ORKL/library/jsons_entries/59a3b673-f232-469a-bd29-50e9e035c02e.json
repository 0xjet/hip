{
    "id": "59a3b673-f232-469a-bd29-50e9e035c02e",
    "created_at": "2023-04-05T02:08:20.410165Z",
    "updated_at": "2025-03-27T02:17:00.454651Z",
    "deleted_at": null,
    "sha1_hash": "b00633e5b6935bd14f51647f67f12038fababa09",
    "title": "2023-03-04 - Bumblebee DocuSign Campaign",
    "authors": "",
    "file_creation_date": "2023-04-03T08:22:37Z",
    "file_modification_date": "2023-04-03T08:22:37Z",
    "file_size": 973349,
    "plain_text": "# Bumblebee DocuSign Campaign\n\n**[0xtoxin-labs.gitbook.io/malware-analysis/malware-analysis/bumblebee-docusign-campaign](https://0xtoxin-labs.gitbook.io/malware-analysis/malware-analysis/bumblebee-docusign-campaign)**\n\nIn this blog post I will be going through a recent bumblebee campaign that impersonates DocuSign, I will be going through the execution chain,\nthe powershell loader and some IOC extractions\n\n## The Phish\n\nThe email delivered to the user simply tells the user that an invoice is waiting to be paid and that a \"unique HTML code\" was created for him to\ndownload and view the invoice on the user's computer. Additionally a password was provided: RD4432\n\n\n-----\n\nPhishing Mail\n\nHovering over the the \"See The Document\" can help us to see what is the click on action URL:\n\n\n-----\n\nO e e bedded U\n\nThe URL is:\n\nhttps://onedrive.live[.com/download?cid=0F6CD861E2193F6E&resid=F6CD861E2193F6E%21118&authkey=ALbZV_c_Tn7O-OA\n\nso instead of going to the actual DocuSign site, the file will be hosted on onedrive which once clicked will trigger an auto download of an\narchive file.\n\n## Execution Chain\n\nBelow you can see a diagram of the execution chain from the moment the phishing mail was opened:\n\nExecution Flow\n\nLets go quickly through this chains:\n\n1. 1.\n\nDownloaded archive is being opened by the user, in order to extract the IMG file the user will have to enter the given password: RD4432\n\nPassword Protected Archive\n\n\n-----\n\nOnce the IMG file is opened the user will see only the LNK file requested information (because the .ps1 is hidden)\n\nHidden Powershell Script\n\n3. 3.\n\nThe LNK file will execute the hidden .ps1 script\n\nLNK Target Command\n\n## Bumblebee Ps1 Loader\n\nI will be focusing now on what is going on in the script and what I've done to extract the payload out of it. So I know that there are about 42\nbase64 encoded strings (that are actually archives) each one of them stored in variable with the name elem{X}, for example:\n\nBroken B64 Variables\n\nThe script then removes the first char in the encoded string and replace it with H to match the .gz magic bytes: 1f 8b.\n\nFirst Char Swap\n\nThis script will extract each string variable, decode it and save in the selected folder\n\nfrom base64 import b64decode\n\nimport re\n\nimport os\n\n\n-----\n\nPS1_FILE_PATH = '/Users/igal/malwares/bumblebee/21-02-2023/documents.ps1'\n\nOUTPUT_FOLDER = '/Users/igal/malwares/bumblebee/21-02-2023/archives/'\n\n​\n\nREG_PATTERN = '^\\$elem.*\\=\\\"(.*)\\\"$'\n\n​\n\narchiveIndex = 0\n\n​\n\nif not os.path.exists(OUTPUT_FOLDER):\n\nos.makedirs(OUTPUT_FOLDER)\n\n​\n\nps1File = open(PS1_FILE_PATH, 'rb').readlines()\n\nfor line in ps1File:\n\nregMatch = re.findall(REG_PATTERN, line.replace(b'\\x00',b'').decode('iso-8859-1'))\n\nif regMatch:\n\nvarData = b64decode('H' + regMatch[0][1:])\n\nopen(f'{OUTPUT_FOLDER}/archive{archiveIndex}.gz', 'wb').write(varData)\n\nprint(f'[+] gz archive was created in:{OUTPUT_FOLDER}/archive{archiveIndex}.gz')\n\narchiveIndex += 1\n\n​\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive0.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive1.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive2.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive3.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive4.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive5.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive6.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive7.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive8.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive9.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive10.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive11.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive12.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive13.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive14.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive15.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive16.gz\n\n\n-----\n\n[ ] g a c e as c eated /Use s/ ga / a a es/bu b ebee/ 0 0 3/a c es//a c e g\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive18.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive19.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive20.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive21.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive22.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive23.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive24.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive25.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive26.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive27.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive28.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive29.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive30.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive31.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive32.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive33.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive34.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive35.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive36.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive37.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive38.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive39.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive40.gz\n\n[+] gz archive was created in:/Users/igal/malwares/bumblebee/21-02-2023/archives//archive41.gz\n\nEach archive contains code parts of a bigger powershell script, I will extract the content of those archives and concatenate them to one big\npowershell script.\n\nimport gzip\n\n​\n\n​\n\nARCHIVES_FOLDER = '/Users/igal/malwares/bumblebee/21-02-2023/archives'\n\nOUTPUT_FILE = '/Users/igal/malwares/bumblebee/21-02-2023/powershellCommand.txt'\n\n​\n\ncountArchives = sum(1 for file in os.scandir(ARCHIVES_FOLDER))\n\n​\n\nfinalString = ''\n\n​\n\n\n-----\n\no a ge(0,cou t c es)\n\nwith gzip.open(f'{ARCHIVES_FOLDER}/archive{x}.gz', 'rb') as f:\n\nfinalString += f.read().decode('utf-8')\n\n​\n\nopen(OUTPUT_FILE, 'w').write(finalString)\n\n2074441\n\nOnce again the script contains a huge amount of b64 encoded strings that once concatenated they create an executable.\n\nBroken B64 Strings\n\nps1FileContent = open(OUTPUT_FILE, 'r').readlines()\n\nREG_PATTERN = '^\\$mbVar.*FromBase64String\\(\\\"(.*)\\\"\\)$'\n\nOUTPUT_PAYLOAD = '/Users/igal/malwares/bumblebee/21-02-2023/payload.bin'\n\nfinalPayload = b''\n\nfor line in ps1FileContent:\n\nregMatch = re.findall(REG_PATTERN, line)\n\nif regMatch:\n\nfinalPayload += b64decode(regMatch[0])\n\n​\n\nopen(OUTPUT_PAYLOAD, 'wb').write(b'\\x4d' + finalPayload[1:])\n\nprint(f'[+] Payload was extracted to the path:{OUTPUT_PAYLOAD}')\n\n[+] Payload was extracted to the path:/Users/igal/malwares/bumblebee/21-02-2023/payload.bin\n\nInvestigating the extracted binary, I found out it's 64bit DLL, I've opened the DLL in IDA to see what is being executed from DLLMain:\n\nDllMain\n\n\n-----\n\na e ecute t e u ct o `sub_ 8000 050` c co ta s te est g a ay a ab e, c as t s st a ue a po te to b ob a d\nin the second value what seems like the size of the blob:\n\nMZ Blob\n\nI took the starting offset of the blob (0x180007320) and added the possible length (0x169400) (wrote it in the IDA output window)\n\nprint(hex(0x180007320 + 0x169400))\n\nAnd by double-clicking on the printed value it jumped to the offset which was the actual end of the blob data:\n\nEnd Of Blob\n\n[I've opened the binary in x64Dbg and set a breakpoint at the array assign of the blob and dumped the embedded binary:](https://x64dbg.com/)\n\n\n-----\n\nPayload Dumping\n\nNow we can investigate the embedded binary.\n\n## BumbleBee Payload\n\nIn this part I will going over a quick triage process of extracting encrypted configs located in the BumbleBee payload.\n\n[First of all by simply uploading the payload to Tria.ge we get a static incrimination that the payload is indeed BumbleBee payload:](https://tria.ge/dashboard)\n\nTria.ge Incrimination\n\nAdditionally Tria.ge shows us the botnet ID which is: 202lg.\n\nGoing through what possibly can be the main function of the loader I saw pretty at the beginning of the function a call to a function which pass\nas an argument an hardcoded strange looking string:\n\nRc4 Key\n\nThe function contains inside of it RC4 encryptions routines that will use the hardcoded passed argument as a key and will pass alongside with\nit encrypted blob of data and the length of the data\n\n\n-----\n\nConfig Decryption Function\n\nSo now that we know what the data is let's implement a quick decryption script:\n\nfrom Crypto.Cipher import ARC4\n\nimport binascii\n\n​\n\nKEY = \"XNgHUGLrCD\"\n\nBLOB_CONFIG_PORT =\n\"0b002425baa537efd52cf61f683f8116bc994d01c892b9c140f4a29c3f8a0b823f5a65b8dc08bb73c1e7ec5f5cb40ca4a45ea741c5367ad2368ea826d\n\nBLOB_CONFIG_BOTNET =\n\"0d042549dda537efd52cf61f683f8116bc994d01c892b9c140f4a29c3f8a0b823f5a65b8dc08bb73c1e7ec5f5cb40ca4a45ea741c5367ad2368ea826d\n\nBLOB_CONFIG_C2 =\n\"0e00260b8b9306c1e418c531590cb72c8eae7f2dfaa38def77c38ca50ca439b30a60578eef248a43f5c9dd69649a3d9193709574f60c4ee605a2991f\n\n​\n\ndef toRaw(hexVal):\n\nreturn binascii.unhexlify(hexVal.encode())\n\n​\n\ndef initCipher():\n\nreturn ARC4.new(KEY.encode())\n\n​\n\ncipher = initCipher()\n\nplainPort = cipher.decrypt(toRaw(BLOB_CONFIG_PORT)).split(b'\\x00\\x00\\x00\\x00')[0].decode()\n\ncipher = initCipher()\n\nplainBotnet = cipher.decrypt(toRaw(BLOB_CONFIG_BOTNET)).split(b'\\x00\\x00\\x00\\x00')[0].decode()\n\ncipher = initCipher()\n\nplainC2List = cipher.decrypt(toRaw(BLOB_CONFIG_C2)).split(b'\\x00\\x00\\x00\\x00')[0].decode().split(',')\n\n​\n\nprint(f'[+] Botnet:{plainBotnet}')\n\nprint(f'[+] Port:{plainPort}')\n\n\n-----\n\np t( [ ] C st )\n\nfor c2 in plainC2List:\n\nprint(f'\\t[*] {c2}')\n\n​\n\n[+] Botnet:202lg\n\n[+] Port:443\n\n[+] C2 List:\n\n[*] 141.161.143.136:272\n\n[*] 214.77.93.215:263\n\n[*] 104.168.157.253:443\n\n[*] 196.224.200.10:482\n\n[*] 254.65.104.229:127\n\n[*] 209.141.40.19:443\n\n[*] 107.189.5.17:443\n\n[*] 44.184.236.94:128\n\n[*] 60.231.88.20:422\n\n[*] 210.38.79.54:319\n\n[*] 23.254.167.63:443\n\n[*] 91.206.178.234:443\n\n[*] 72.204.201.249:374\n\n[*] 146.19.173.86:443\n\n[*] 103.175.16.104:443\n\n[*] 138.133.49.46:211\n\n[*] 150.18.156.130:256\n\n[*] 93.216.14.249:213\n\n[*] 73.73.80.51:127\n\n[*] 216.73.114.69:379\n\n[*] 58.249.161.153:350\n\n[*] 140.157.121.40:433\n\n[*] 194.135.33.85:443\n\n[*] 6.66.255.6:433\n\n[*] 173.234.155.246:443\n\n[*] 179.55.218.145:322\n\n[*] 241.163.228.200:362\n\n[*] 38.174.252.233:131\n\n[*] 146.29.236.141:457\n\n[*] 32.234.39.72:191\n\n\n-----\n\n[ ] 8 8 60 5 9\n\n[*] 114.70.235.72:357\n\n[*] 51.68.144.43:443\n\n[*] 172.86.120.111:443\n\n[*] 160.20.147.242:443\n\n[*] 207.12.58.212:419\n\n[*] 51.75.62.204:443\n\n[*] 174.72.94.173:309\n\n[*] 205.185.113.34:443\n\n[*] 194.135.33.184:443\n\n[*] 246.6.106.79:340\n\n[*] 23.82.140.155:443\n\n[*] 185.173.34.35:443\n\n[*] 255.115.3.251:370\n\n[*] 177.232.32.155:257\n\n[*] 122.125.104.16:475\n\n[*] 24.64.127.190:229\n\n[The retrieved botnet ID is: 202lg which is fairly correlated with a recent tweet coming from k3dg3 regarding BumbleBee activity utilized by](https://twitter.com/k3dg3)\nTA579:\n\nK3dg3 Tweet\n\n## Summary\n\nIn this blogpost we went over a recent BumbleBee campaign that uses multi layered powershell script in order to load the BumbleBee loader.\n\nI've mainly focused on breaking down the powershell script part rather then focusing on the loader capabilities, if you want to learn more about\nthe BumbleBee Loader, check this [blog written by](https://elis531989.medium.com/the-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056) [Eli Salem​](https://twitter.com/elisalem9)\n\n## Update 1\n\n[During my writing i found yet another campaign with the botnet ID of lg0203 I've run my scripts on the hidden powershell script and managed](https://tria.ge/230303-kvklvsgc4x/behavioral2)\nto extract the DLL without any problem :)\n\n## IOC's\n\n**Samples:**\n\n[requested_documents_714407544541.zip - d4a358c875ab55c811368eabe8fa33d09fe67f2d3beafa97b9504bf800a7a02d​](https://bazaar.abuse.ch/sample/d4a358c875ab55c811368eabe8fa33d09fe67f2d3beafa97b9504bf800a7a02d/)\n[8702268950347.img - a55979165779c3c4fc1bc80b066837df206d9621b0162685ed1a6f6a5203d8af​](https://bazaar.abuse.ch/sample/a55979165779c3c4fc1bc80b066837df206d9621b0162685ed1a6f6a5203d8af/)\n[requested information.lnk - 6fb690fbeb572f4f8f0810dd4d79cff1ca9dbd2caa051611e98d0047f3f2aa56​](https://bazaar.abuse.ch/sample/6fb690fbeb572f4f8f0810dd4d79cff1ca9dbd2caa051611e98d0047f3f2aa56/)\ndocuments.ps1 - [b6d05d8f7f1f946806cd70f18f8b6af1b033900cfaa4ab7b7361b19696be9259​](https://bazaar.abuse.ch/sample/b6d05d8f7f1f946806cd70f18f8b6af1b033900cfaa4ab7b7361b19696be9259/)\n[LoaderDLL.bin - 2d5c9b33ed298f5fb67ce869c74b2f2ec9179a924780da65fcbc1a0e0463c5d0​](https://bazaar.abuse.ch/sample/2d5c9b33ed298f5fb67ce869c74b2f2ec9179a924780da65fcbc1a0e0463c5d0/)\nBumbleBeeLoader.bin - [4a5d5e6537044cdbf8de9960d79c85b15997784ba1b74659dbfcb248ccc94f59​](https://bazaar.abuse.ch/sample/4a5d5e6537044cdbf8de9960d79c85b15997784ba1b74659dbfcb248ccc94f59/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2023/2023-03-04 - Bumblebee DocuSign Campaign.pdf"
    ],
    "report_names": [
        "2023-03-04 - Bumblebee DocuSign Campaign.pdf"
    ],
    "threat_actors": [
        {
            "id": "1f87ac52-682a-4bc7-b7ce-fac8d79815fa",
            "created_at": "2023-01-06T13:46:39.373008Z",
            "updated_at": "2025-03-27T02:00:03.066186Z",
            "deleted_at": null,
            "main_name": "TA579",
            "aliases": [],
            "source_name": "MISPGALAXY:TA579",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1680660500,
    "ts_updated_at": 1743041820,
    "ts_creation_date": 1680510157,
    "ts_modification_date": 1680510157,
    "files": {
        "pdf": "https://archive.orkl.eu/b00633e5b6935bd14f51647f67f12038fababa09.pdf",
        "text": "https://archive.orkl.eu/b00633e5b6935bd14f51647f67f12038fababa09.txt",
        "img": "https://archive.orkl.eu/b00633e5b6935bd14f51647f67f12038fababa09.jpg"
    }
}