{
    "id": "6b88d0ed-5f58-42a1-bfa6-85b6e0594c3f",
    "created_at": "2023-01-12T15:05:14.639912Z",
    "updated_at": "2025-03-27T02:05:30.856569Z",
    "deleted_at": null,
    "sha1_hash": "065a87737b5e5dc522b698017ef3397f56e37d9b",
    "title": "2020-12-14 - Using Splunk to Detect Sunburst Backdoor",
    "authors": "",
    "file_creation_date": "2022-05-28T04:05:28Z",
    "file_modification_date": "2022-05-28T04:05:28Z",
    "file_size": 260538,
    "plain_text": "# Using Splunk to Detect Sunburst Backdoor\n\n**[splunk.com/en_us/blog/security/sunburst-backdoor-detections-in-splunk.html](https://www.splunk.com/en_us/blog/security/sunburst-backdoor-detections-in-splunk.html)**\n\nDecember 14, 2020\n\nBy [Ryan Kovar December 14, 2020](https://www.splunk.com/en_us/blog/author/rkovar.html)\n\n[TL;DR: This blog contains some immediate guidance on using Splunk Core and](https://www.splunk.com/en_us/software/splunk-enterprise.html) Splunk Enterprise\nSecurity to protect (and detect activity on) your network from the Sunburst Backdoor malware\ndelivered via SolarWinds Orion software. Splunk’s threat research team will release more guidance in\nthe coming week. Also please note that you may see some malicious network activity but it may not\nmean your network is compromised. As always review carefully.\n\n\n-----\n\n## Introduction to Sunburst Backdoor\n\nOn Sunday afternoon, FireEye released a report on what they are calling the “Sunburst Backdoor.” I\n[highly recommend you read their phenomenal whitepaper for an in-depth analysis, but here are the](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html)\nbasics: an advanced adversary trojanized a legitimate dll of the SolarWinds Orion software and fed\nthat into the Solarwinds' customers’ update cycle. Once infected, this trojanized backdoor allows the\nadversary to move laterally in a victim’s network and steal their critical data.\n\nAt this time, FireEye has detected global activity going back at least to the spring of 2020 with many\n[different verticals targeted. Combined with the recent CISA Emergency Directive 21-01, we felt it was](https://cyber.dhs.gov/ed/21-01/)\nessential to provide a quick response with high-level guidance to our customers to help them detect\nand protect their networks. Splunk’s research team will provide much more bespoke and customized\ndetections as they work the scenario through our labs in the coming days.\n\n## What You Need to Know\n\nThe FireEye report reveals that this attack was perpetrated by an advanced adversary who carefully\nselected targets and changed their attacking infrastructure to match geographical location and even\nnamed attacking hosts to match their victims to disguise their traffic better. By using a trusted software\npartner like Solarwinds Orion, they could utilize Solarwinds' position in the network to spread laterally\nacross on-prem and cloud infrastructures to capture and exfiltrate data.\n\nWhile Sunburst Backdoor is a sophisticated attack vector, it is still just a trojan on a network with lateral\nmovement. Many of your typical network defense techniques and incident response techniques can be\nutilized immediately. If you happen to know which hosts on your network are running SolarWinds\nOrion, start your hunting with those hosts as this is where the adversary gains a foothold. The\nSunburst Backdoor should only be effective on those hosts. Still, the added threat here is any lateral\nmovement out from the Orion hosts, using common techniques or credentials harvested from Orion.\n\n\n-----\n\n## Detection in Splunk Enterprise Security\n\nAn event like Sunburst is a great time to revisit our blog, “How Do I Add COVID (or Any) Threat\nIntelligence From the Internet to Splunk Enterprise Security?” on adding threat intelligence quickly to\n[Splunk Enterprise Security (ES). You can simply swap out the “COVID” threat lists with “SUNBURST”](https://www.splunk.com/en_us/software/enterprise-security.html)\nthreat lists. This blog will help you update your Splunk SIEM with the IOCs currently released from\nFireEye and give you detection results if any hosts become infected in the future.\n\n[My colleague Shannon Davis has already whipped together several local threat intel files for you to](https://www.splunk.com/en_us/blog/author/shannond.html)\ningest into ES using the techniques above!\n\n\n-----\n\n### IOCs: DNS, Hashes, and IPs\n\n[First, let’s review the IOCs that FireEye kindly released in their GitHub repo. You could go through and](https://github.com/fireeye/sunburst_countermeasures)\nmake many “OR” statements and look through your DNS, but I have created some quick lookup files\nthat you could use, especially as those IOCs start getting more and more verbose. Take the guidance\n[from my previous blog posts “Lookup Before You Go-Go...Hunting” and “Hunting COVID Themed](https://www.splunk.com/en_us/blog/security/lookup-before-you-go-go-hunting.html)\n[Attacks with IOCS.” I’ve also started throwing some lookup files into a GitHub repo, which you can](https://github.com/rkovar/sunburstlookups)\nexplore independently. Please note, this is based on what has been released by FireEye or other\nvendors, but it should get you started.\n\nFor example, create lookup tables as I indicated in the blogs above or from my Github repository.\nThen, run a search like below, and you can find hosts that have communicated to the domains so far\ndetected.\n```\nindex=main sourcetype=stream:*\n| lookup sunburstDOMAIN_lookup Domain AS query\n| search isBad=TRUE\n| stats VALUES(query) AS \"Sunburst\" by src_ip\n\n```\n\n-----\n\nJust change the search query and lookup file to match what type of IOC you are looking for (domains,\nIPs, or hashes).\n\n[If you detect traffic to these IPs or domains, take a good look at the Snort alerts released by FireEye. If](https://github.com/fireeye/sunburst_countermeasures/blob/main/all-snort.rules)\nyou are collecting any firewall or proxy traffic logs, you might be able to have a better idea of your\ncompromised hosts looking for traffic with these strings in the URL:\n```\n/swip/upd/SolarWinds.CortexPlugin.Components.xml\nswip/Upload.ashx\n/swip/upd/\n\n### Lateral Movement\n\n```\nOnce the adversary has access to the network via the trojanized dll, they can be detected moving\nlaterally to find and exfiltrate information. Although we have not seen the logs, we can safely assume\nthey are still obeying the laws of network traffic. Using the ever handy-dandy Splunk Security\n[Essentials (SSE) tool, I exported several searches into this PDF. You can use these searches either as](https://github.com/rkovar/sunburstlookups/blob/main/Lateral_Movement_SPL.pdf)\nis or as inspiration for your own. I highly recommend that you start by looking at any suspicious traffic\nemanating to or from SolarWinds machines in your network.\n\n\n-----\n\n### Sysmon and Named Pipe\n\nOne interesting tidbit released in the FireEye report was also the existence of a named pipe. If you are\nusing Sysmon and Splunk please take a look at Event Codes 17 and 18 and the named pipe\n“583da945-62af-10e8-4902-a8f205c72b2e”. We’ve provided an example search below:\n```\nindex=windows sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" \n(EventCode=17 OR EventCode=18) PipeName=583da945-62af-10e8-4902-a8f205c72b2e\n\n```\nWe are also seeing some great work done by the community for Sysmon and Splunk queries but have\nbeen unable to test them at this time. Take a quick google and your may find some gold!\n\n### Azure Active Directory\n\n[Microsoft has also determined that adversaries utilizing the Sunburst Backdoor targeted the Azure AD](https://msrc-blog.microsoft.com/2020/12/13/customer-guidance-on-recent-nation-state-cyber-attacks/)\nof victims as part of their lateral movement. This was either done via captured administrative\n[passwords or forged SAML tokens. Luckily, Splunk (via the dapper Ryan Lait) has you covered! If you](https://www.splunk.com/en_us/blog/author/rlait.html)\nbrought your Azure data into Splunk, you can get some great insight into the activity that the adversary\nmay have taken.\n\n\n-----\n\n[The Azure Active Directory Audit data collected by the Microsoft Azure Add-on for Splunk can help](https://splunkbase.splunk.com/app/3757/)\nhunt some of the techniques leveraged by this actor. These audit logs capture every interaction\nbetween users and resources inside Azure. Here are some example searches to detect:\n\n**Monitoring For Changes to App Registrations and Service Principals:**\nNew Service Principals:\n```\nsourcetype=\"azure:aad:audit\" activityDisplayName=\"Add service principal\" \n| stats values(activityDisplayName) AS Action, values(initiatedBy.user.userPrincipalName) \nAS UPN, values(targetResources{}.displayName) AS Target,\nvalues(targetResources{}.modifiedProperties{}.displayName) AS \"Modified Resources\",\nvalues(targetResources{}.modifiedProperties{}.oldValue) AS \"Old Values\",\nvalues(targetResources{}.modifiedProperties{}.newValue) AS \"New Values\" by correlationId \n| fields - correlationId\n\n```\nCredentials and certificates added to Apps or Service Principals:\n```\nsourcetype=\"azure:aad:audit\" activityDisplayName=\"Add service principal credentials\"\n\n```\n\n-----\n\nPermissions and role assignments added to Apps or Service Principals:\n```\nsourcetype=\"azure:aad:audit\" activityDisplayName=\"Add app role assignment to service\nprincipal\" OR \nactivityDisplayName=\"Add delegated permission grant\" OR activityDisplayName=\"Add application\" \n| stats values(initiatedBy.user.userPrincipalName) AS UPN,\nvalues(targetResources{}.displayName) \nAS Target, values(targetResources{}.modifiedProperties{}.displayName) AS \"Modified Resources\",\nvalues(targetResources{}.modifiedProperties{}.oldValue) AS \"Old Values\", \nvalues(targetResources{}.modifiedProperties{}.newValue) \nAS \"New Values\" by correlationId activityDisplayName\n| fields - correlationId\n\n```\n\n-----\n\nUse this search to investigate users adding sensitive permissions to app registrations.\n#ReadMailInAllMailboxes\n\nApps modified to allow multi-tenant access:\n```\nsourcetype=\"azure:aad:audit\" activityDisplayName=\"Update application\" operationType=Update \nresult=success targetResources{}.modifiedProperties{}.displayName=AvailableToOtherTenants \n| table activityDateTime initiatedBy.user.userPrincipalName, \ntargetResources{}.displayName additionalDetails{}.value\n\n```\n\n-----\n\nChanges to Azure AD Custom Domains:\n```\nsourcetype=\"azure:aad:audit\" activityDisplayName=\"Add unverified domain\" OR \nactivityDisplayName=*domain* | stats values(activityDisplayName) AS \nAction, values(initiatedBy.user.userPrincipalName) AS UPN,\nvalues(targetResources{}.displayName) \nAS Target, values(targetResources{}.modifiedProperties{}.displayName) \nAS \"Modified Resources\", values(targetResources{}.modifiedProperties{}.oldValue) \nAS \"Old Values\", values(targetResources{}.modifiedProperties{}.newValue) \nAS \"New Values\" by correlationId \n| fields - correlationId\n\n```\n\n-----\n\n[Make sure to check out the Microsoft Azure App for Splunk for additional searches and pre-built](https://splunkbase.splunk.com/app/4882/)\nsecurity content for Azure data.\n\n\n-----\n\n-----\n\n### VPS Hosts\n\nAt this time, it is believed that adversaries have utilized geographically relevant (meaning IP addresses\nwill be local to the country of the victim) Virtual Private Servers (VPS) hosts to access victim networks.\nAlthough there is no definitive list of these IPs, we recommend that customers review external to\ninternal network traffic to determine if unknown IP addresses have accessed their systems (especially\nSolarWinds devices) since spring 2020.\n\n### TSTAT Searches (Updated!)\n\nAs Splunkers around the world have been working to find/detect the Sunburst activity, many of our\n[customers have found that our quick searches above were not scalable and turned to TSTATS to help](https://docs.splunk.com/Documentation/SplunkCloud/8.1.2009/SearchReference/Tstats)\nthem cope with the volume in their data models. My colleague Don Slife went ahead and whipped up\n\n\n-----\n\nsome queries that you might find useful AND scalable. Please note, you must have CIM compliant\ndata in data models to run these searches.\n\n**To find malicious domains in network resolution datamodel**\nThis search will look across DNS data in the Network Resolution data model using the\nsunburstDOMAIN_loopup file above. If you would prefer, remove the subsearch and just look for the\navsvmcloud[.]com domain in order to detect the primary IOC.\n```\n| tstats summariesonly=true earliest(_time) as earliest latest(_time) as latest count as\ntotal_conn values(DNS.query) as query from datamodel=Network_Resolution where\n  [| inputlookup sunburstDOMAIN_lookup\n  | rename Domain as DNS.query\n  | table DNS.query] OR DNS.query=*avsvmcloud.com by DNS.src DNS.vendor_product\nDNS.record_type DNS.message_type\n| sort earliest\n| eval earliest=strftime(earliest, \"%c\"), latest=strftime(latest, \"%c\")\n\n```\n**To find malicious IP addresses in network traffic datamodel**\nThis search will look across the network traffic datamodel using the sunburstIP_lookup files we\nreferenced above.\n```\n| tstats summariesonly=true earliest(_time) as earliest latest(_time) as latest count as\ntotal_conn values(All_Traffic.dest) as dest from datamodel=Network_Traffic where\n  [| inputlookup sunburstIP_lookup\n  | rename IP as All_Traffic.dest\n  | table All_Traffic.dest] by All_Traffic.src All_Traffic.vendor_product\n| sort earliest\n| eval earliest=strftime(earliest, \"%c\"), latest=strftime(latest, \"%c\")\n\n## MITRE ATT&CK\n\n```\nThe folks at FireEye were kind enough to map their findings to MITRE ATT&CK. Like the lateral\n[movement work above, I went through Splunk Security Essentials and pulled any content we might](https://github.com/rkovar/sunburstlookups/blob/main/SUNBURST_ATT%26CK_SPL.pdf.zip)\n[have associated with the observed tactics and techniques. The PDF ended up being pretty big, but we](https://github.com/rkovar/sunburstlookups/blob/main/SUNBURST_ATT%26CK_SPL.pdf.zip)\nhope it’s useful. If you would rather just pivot in your own SSE instance, here are the 1-1 searches that\n[you should review (I did add anything I thought useful in the PDF, so you might take a peek at it if you](https://github.com/rkovar/sunburstlookups/blob/main/SUNBURST_ATT%26CK_SPL.pdf.zip)\nhave a chance):\n\n[Malicious Powershell Process - Encoded Command](https://github.com/splunk/security-content/blob/develop/detections/endpoint/malicious_powershell_process___encoded_command.yml)\nAnomalous Audit Trail Activity Detected\n[Tor Traffic](https://github.com/splunk/security-content/blob/develop/detections/network/tor_traffic.yml)\nConcentration of Attacker Tools by Filename\nConcentration of Attacker Tools by SHA1 Hash\n[Sc Exe Manipulating Windows Services](https://github.com/splunk/security-content/blob/develop/detections/endpoint/sc_exe_manipulating_windows_services.yml)\n\n\n-----\n\nProhibited Service Detected\nProhibited Process Detected\nAnomalous New Service\nAbnormally High Number of Endpoint Changes By User\n[First Time Seen Running Windows Service](https://github.com/splunk/security-content/blob/develop/detections/endpoint/first_time_seen_running_windows_service.yml)\nProcesses with Lookalike (typo) Filenames\nSMB Traffic Allowed\nAnomalous New Process\nHigh Process Count\nProhibited Service Detected\n\n## Conclusion\n\nWe have tried to keep this blog short, sweet and concise. The information above is pulled from our\nexisting products like SSE, ESCU, previous research, and some off the cuff SPL’ing by great\n[Splunkers like Shannon Davis and](https://www.splunk.com/en_us/blog/author/shannond.html) [Ryan Lait. Much (if not all) of the analysis and IOCs above were](https://www.splunk.com/en_us/blog/author/rlait.html)\nderived from FireEye and Microsoft blogs on the subject. However, as mentioned above, our threat\nresearch team will be releasing more up-to-date information and additional detections as details (and\ndata) become more available.\n\nPosted by\n\n**[Ryan Kovar](https://www.splunk.com/en_us/blog/author/rkovar.html)**\n\nNY. AZ. Navy. SOCA. KBMG. DARPA. Splunk.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-14 - Using Splunk to Detect Sunburst Backdoor.pdf"
    ],
    "report_names": [
        "2020-12-14 - Using Splunk to Detect Sunburst Backdoor.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535914,
    "ts_updated_at": 1743041130,
    "ts_creation_date": 1653710728,
    "ts_modification_date": 1653710728,
    "files": {
        "pdf": "https://archive.orkl.eu/065a87737b5e5dc522b698017ef3397f56e37d9b.pdf",
        "text": "https://archive.orkl.eu/065a87737b5e5dc522b698017ef3397f56e37d9b.txt",
        "img": "https://archive.orkl.eu/065a87737b5e5dc522b698017ef3397f56e37d9b.jpg"
    }
}