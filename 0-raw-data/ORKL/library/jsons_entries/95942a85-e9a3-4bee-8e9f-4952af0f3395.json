{
    "id": "95942a85-e9a3-4bee-8e9f-4952af0f3395",
    "created_at": "2023-01-12T15:04:34.162962Z",
    "updated_at": "2025-03-27T02:14:38.626934Z",
    "deleted_at": null,
    "sha1_hash": "a7694bc4451dabb8d42b60d2b23a7edc6aeccfde",
    "title": "2022-04-14 - Zloader 2- The Silent Night",
    "authors": "",
    "file_creation_date": "2022-05-28T15:44:39Z",
    "file_modification_date": "2022-05-28T15:44:39Z",
    "file_size": 2472592,
    "plain_text": "# Zloader 2: The Silent Night\n\n**[decoded.avast.io/vladimirmartyanov/zloader-the-silent-night/](https://decoded.avast.io/vladimirmartyanov/zloader-the-silent-night/)**\n\nby [Vladimir MartyanovApril 14, 202213 min read](https://decoded.avast.io/author/vladimirmartyanov/)\n\n\nApril 14, 2022\n\n\nIn this study we are considering one of Zeus successors – Zloader 2. We’ll show how it\nworks and its code peculiarities. We’ll present the result of our deep dive into the botnets\nand campaigns and show some interesting connections between Zloader and other\nmalware families.\n\n## Introduction\n\n_Zloader 2 (also known as Silent Night) is a multifunctional modular banking malware, aimed_\nat providing unauthorized access to online banking systems, payment systems and other\nfinancial-related services. In addition to these functions it’s able to download and execute\narbitrary files, steal files, inject arbitrary code to visited HTML pages and so on.\n\n## History\n\nAccording to [ZeusMuseum, first versions of Zeus were observed in 2006-2008. Later, in](https://zeusmuseum.com/zeus%201/)\n[2011 its source code leaked. As a result, new versions and variants appeared. One of the](https://threatpost.com/zeus-source-code-leaked-051011/75217/)\n_Zeus successors named Zloader_ [appeared at the turn of 2016 and 2017. Finally, another](https://blog.malwarebytes.com/cybercrime/2017/01/zbot-with-legitimate-applications-on-board/)\nsuccessor named Silent Night [appeared in 2019. It was for sale on the underground market.](https://blog.malwarebytes.com/threat-analysis/2020/05/the-silent-night-zloader-zbot/)\n\nThe earliest version of this variant we found has a SHA256:\n\n```\n384f3719ba4fbcf355cc206e27f3bfca94e7bf14dd928de62ab5f74de90df34a\n\n```\n\nTimestamp 4 December 2019 and version number 1.0.2.0. In the middle of July 2021 the\nversion 2.0.0.0 was spotted.\n\n[Microsoft recently announced a joint investigation of multiple security companies and](https://blogs.microsoft.com/on-the-issues/2022/04/13/zloader-botnet-disrupted-malware-ukraine/)\ninformation sharing and analysis centers (ISACs) with the aim to take down the Zloader\nbotnet and took the whole case to court.\n\n\n-----\n\nAlthough the original name of the malware likely was Silent Night and the [ZeusMuseum](https://zeusmuseum.com/zloader%202/)\ncalls it Zloader 2 we are simply going to use the name Zloader.\n\n## Technical analysis\n\n### Modules and components\n\nZloader consists of different modules and components:\n\n**Downloader – initial infector**\n**Backdoor – main module, exists in x86 and x64 versions**\n**VNC module (x86 and x64)**\n**Web Injects – received from C&C**\nAdditional libraries (openssl, sqlite, zlib, Mozilla libraries)\n\nBackdoors, VNC modules and additional libraries have assigned module IDs that are used\nby other components to refer to them.\n\n### Distribution\n\n_Zloader was distributed using classic email spam. In 2021 the attackers abused Google_\n_AdWords to advertise sites with fake Zoom communication tool which actually installed_\n_Zloader. Another campaign in 2021 used fake pornsites, where users needed to download_\nadditional software to watch video. Downloaders are distributed in a packed form\nsometimes signed with a valid digital signature.\n\nMap showing the distribution of infected systems:\n\n\n-----\n\n### Code peculiarities\n\nZloader code is very recognizable. First of all, it is diluted with functions which will never be\ncalled. Downloader module may contain functions from the Backdoor module and vice\nversa. In total, about a half of the code will never be called.\n\nSecond, simple x86 instructions like CMP, ADD and XOR are replaced with special\nfunctions. These functions contain a lot of useless code to complicate the analysis and they\ncan call other “replacement” functions. To add more insult to the injury multiple\n“replacement” functions exist for a particular instruction. Also some constants are calculated\nin runtime using aforementioned “replacement” functions.\n\nStrings are encrypted with a simple XOR algorithm.\n\nSamples have very little imported functions. APIs are resolved in runtime by the hashes of\ntheir names.\n\nAs a result, more than a half of the file size is useless and serves as an obfuscation of\nsimple operations.\n\n\n-----\n\n### Configuration\n\nBoth Downloader and Backdoor modules have built in configuration encrypted with RC4.\nThe decryption key is stored in a plaintext and looks like `vcvslrpvwwfanquofupxt . The`\nstructure of earlier versions (1.0.x, for example) differs from later versions (1.6.x and 1.8.x).\nModern versions store the following information in config:\n\nBotnet name ( divader on the picture below)\nCampaign name ( xls_s_2010 )\nList of hardcoded C&Cs\nRC4 key ( 03d5ae30a0bd934a23b6a7f0756aa504 )\n\n\n-----\n\n### BinStorage\n\n\n-----\n\nWe have to briefly cover the BinStorage – the data format used by Zloader to communicate\nwith C&Cs and to store various data: web injects, system information, stolen data and logs.\n_BinStorages consists of the header and records (also called fields). Main header stores_\ninformation about the number of records, data size (in bytes) and their MD5. Records have\ntheir own small headers, containing `FieldID - DWORD describing the meaning of the`\ndata.\n\nSome FieldIDs are hardcoded. For example, in `FieldID=0x4E20 the last working C&C is`\nstored. Other FieldIDs are derived from file paths (used to store stolen files).\n\n### Registry usage\n\nZloader modules (at least Downloaders and Backdoors) use a registry to store various data\nnecessary for their work. The ROOT_KEY for this data is\n\n```\nHKEY_CURRENT_USER\\Software\\Microsoft\\\n\n```\n\nThe most important and interesting data structure, stored by the Zloader in the registry is\ncalled `MAIN_STRUCT . It’s subkey in the` `ROOT_KEY and the value name is derived from the`\nRC4 key found in the configuration. We suppose that bots from one actor use the same\nRC4 key, so they can easily find and read the `MAIN_STRUCT .`\n```\nMAIN_STRUCT is encrypted using RC4 with the key from the configuration. It stores:\n\n```\nRegistry paths to other storages, used by Zloader\nFiles and directories path, used by Zloader\nEncryption key(s) to decrypt those storages\n\n### Files usage\n\nRoot path is `%APPDATA% . Zloader creates directories with random names inside it to store`\nmodules, stolen data and logs. These paths are stored into the `MAIN_STRUCT .`\n\n### Networking\n\nAs was mentioned before, communication between the bot and C&C is done using\nBinStorages. Depending on the actual type of the message, field list may be changed, but\nthere are 5 constant fields sent to C&C:\n\nSome DWORD from the Configuration\nBotnet name from the Configuration\nBotID, derived from the system information\nDebug flag from the Configuration\n16 random bytes\n\nRequests are encrypted using the RC4 key from the Configuration. C&C responses are\nsigned with RSA\n\n\n-----\n\n**PING request**\n\nThis request is used to check if C&C is alive. Response contains only random bytes sent by\na bot.\n\n**DOWNLOAD MODULE request**\n\nThis request is used to download modules by their ID from the C&C. The response is not in\na BinStorage form!\n\n**GET CONFIG request**\n\nUsed to receive configuration updates: new C&Cs, WebInjects, tasks for downloading etc.\n\n**C&Cs and DGA**\n\nAs was shown before, built in configuration has a list of hardcoded C&Cs. Actually, these\nlists have not changed for years. To bypass blocking of these hardcoded C&Cs, Zloader\nuses DGA – Domain Generation Algorithm. In the Zloader, DGA produces 32 domains,\nbased on the current date and RC4 key from the configuration.\n\nThere is a 3rd type of C&Cs – received in the response from the server. They’re stored into\nthe Registry.\n\n### Downloader module\n\nAnalysis based on version 1.6.28.0,\n\n```\n44ede6e1b9be1c013f13d82645f7a9cff7d92b267778f19b46aa5c1f7fa3c10b\n\n```\n\nFunction of Downloader is to download, install and run the next module – the Backdoor.\n\n**Main function**\n\nJust after the start of the Downloader module, junk code is started. It consists of many junk\nfunctions, which forms a kind of a “network”. In the image below there is a call graph from\njust a single junk function. These functions also trying to read, write and delete some\n```\n*.txt files %TEMP% . The purpose of this is to delay the execution of the payload and, We\n\n```\nsuppose, to complicate the emulation, debugging and analysis.\n\nThe second and the last task of the Main function is to start `msiexec.exe and perform the`\nPE injection of the code into it. Injected data consists of two buffers: the big one, where the\nDownloader is stored in the encrypted form and the small one (0x42 bytes) with decryption\ncode. Just after the injection Downloader terminates himself.\n\n**Injected code**\n\nControl flow passed to the small buffer, which decrypts the Downloader in the address\nspace of msiexec.exe After the decryption, Downloader begins to execute its main task.\n\n\n-----\n\nFirst of all, the injected code tries to read `MAIN_STRUCT from the registry. If this fails, it`\nthinks it was not installed on this system and the installation process begins: `MAIN_STRUCT`\nis created, Downloader module is copied into `%APPDATA% and added to the autorun key`\n```\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run with random value name.\n\n```\nIn any case, the Backdoor module is requested from the disk or from the network and\nexecuted.\n\n### Backdoor module\n\nAnalysis based on version 1.6.28.0,\n\n```\nc7441a27727069ce11f8d54676f8397e85301b4d65d4d722c6b239a495fd0282\n\n```\n\nThere are actually two Backdoor modules: for 32-bit systems (moduleID `0x3EE ) and for`\n64-bit systems (moduleID `0x3E9 ). Downloader always requests a 32-bit Backdoor.`\n\nBackdoors are much more complicated than Downloaders. If we compare the size of our\nsamples (after unpacking), Backdoor will be twice bigger.\n\nKey Backdoor abilities:\n\nStarting VNC module\nInjecting WebInjects into the pages visited using browsers\nDownloading and execute arbitrary file\nKeylogging\nMaking screenshots\nStealing files and sending to C&C\n\n**Stealing files**\n\nThe largest group of software from which Zloader steal files is crypto wallets:\n\nElectrum\nEthereum\nExodus cryptowallet\nZcash\nBitcoin-Qt\nEtc.\n\nIt also steals data from browsers: cookies from Chrome, Firefox and IE; saved logins from\nChrome. And, finally, it is able to steal accounts information from Microsoft Outlook.\n\n**Hooking**\n\nTo achieve his goals, Zloader performs WinAPI hooking. In order to perform it, Backdoor\nmodule enumerates processes and injects itself into the following ones:\n\n\n-----\n\nexplorer.exe\nmsiexec.exe\niexplore.exe\nfirefox.exe\nchrome.exe\nmsedge.exe\n\n64-bit version of Backdoor is injected into 64-bit processes, 32-bit version – into 32-bit\nprocesses.\n\nInjected code hooks the following WinAPI functions:\n\nNtCreateUserProcess\nNtCreateThread\nZwDeviceIoControlFile\nTranslateMessage\nCertGetCertificateChain\nCertVerifyCertificateChainPolicy\n\nHooks might be divided in 3 groups, depending on the purpose:\n\n1. `NtCreateUserProcess and` `NtCreateThread are hooked to inject a Backdoor`\n\nmodule to newly created threads and processes.\n2. `ZwDeviceIoControlFile,` `CertGetCertificateChain and`\n```\n   CertVerifyCertificateChainPolicy are hooked to support WebInjection\n\n```\nmechanism\n3. `TranslateMessage is hooked to log the keys pressed and to create screenshots`\n\n**Web Injecting**\n\nFirst of all, browsers must have a Backdoor module injected. At this moment, there are\nmultiple instances of Backdoor Modules running in the system: one, started by Downloader\nwhich is “Main Instance” and others, running in browsers. Main Instance starts Man-in-thebrowser proxy, other modules hooks `ZwDeviceIoControlFile and cert-related WinAPIs`\n(see above). Proxy port number is stored in the BinStorage structure into the Registry, so it\nis synchronized between Backdoor instances.\n\nHooked ZwDeviceIoControlFile function is waiting for `IOCTL_AFD_CONNECT or`\n```\nIOCTL_AFD_SUPER_CONNECT and routing connections to the proxy. Hooked cert-related\n\n```\nfunctions inform browsers what everything is good with certificates.\n\n## Botnets, Campaigns and their activity\n\n\n-----\n\nMost active botnets and campaigns use RC4 key `03d5ae30a0bd934a23b6a7f0756aa504`\nand we’ll focus on them in our analysis. Samples with the aforementioned key have\nversions 1.x, usually 1.6.28, but some have even 1.0.x.\n\n### Botnet and Campaign names\n\nAmong botnet names it is worth mentioning the following groups:\n\n1. `DLLobnova,` `AktualizacjaDLL,` `googleaktualizacija,`\n```\n   googleaktualizacija1, obnovlenie19, vasja, ivan\n\n```\n2. `9092zi,` `9092ti,` `9092ca,` `9092us,` `909222,` `9092ge`\n\nThe first one contains transliterated Slavic words and names ( vasja, `ivan ), maybe with`\nerrors. It sheds light on the origins of bad guys – they are definitely Slavs.\n\nSamples with botnet names from the second group were first observed in November 2021\nand we found 6 botnet names from this group in the next two months. Letters after\nnumbers, like `ca and` `us might be country codes.`\n\nWe see the same picture with campaign names: quite a big amount of Slavic words and the\nsame `9092* group.`\n\n### WebInjects\n\nWe analyzed webinjects and can confirm that they are targeting financial companies:\nbanks, brokerage firms, insurance companies, payment services, cryptocurrency-related\nservices etc.\n\nInjected code is usually small: from dozens of bytes up to 20 kb. To perform its tasks, it\nloads JavaScript code from external domains, controlled by bad guys. Analysis of these\ndomains allowed us to find connections between Zloader operators and other cybercrime\ngangs.\n\n### Download tasks\n\nZloader is able to download and execute arbitrary files by the commands from his C&Cs,\nbut for a long time we haven’t seen these commands at all. Things changed on 24\nNovember 2021, when botnet `9092ca received a command to download and execute the`\nfile from `teamworks455[.]com . This domain was mentioned in [6].`\n\nAnother two download tasks contained `braves[.]fun and` `endoftheendi[.]com`\n\n## Connections\n\nDuring our tracking we have noticed links to other malware families we originally thought\nwere unrelated.\n\n\n-----\n\n### Raccoon Stealer\n\nTwo out of three download tasks contained links to Raccoon Stealer. Downloaded samples\nhave the following sha256 hashes:\n```\n   5da3db74eee74412c1290393a0a0487c63b2c022e57aebcd632f0c3caf23d8bc\n   5b731854c58c2c1316633e570c9ec82474347e64b07ace48017d0be2b6331eed\n\n```\nBoth of them have the same Raccoon configuration with Telegram channel `kumchakl1 .`\n\nMoreover, Raccoon was mentioned in [6] before we received commands from C&Cs with\nlinks to Raccoon. We are lost in conjecture why Zloader operators used Raccoon Stealer?\n[You can read our dive into Racoon stealer here.](https://decoded.avast.io/vladimirmartyanov/raccoon-stealer-trash-panda-abuses-telegram/)\n\n### Ursnif\n\nUrsnif, also known as Gozi and ISFB is another banking malware family with similar\nfunctions.\n\n**Digital Signatures**\n\nIt was quite a big surprise when we found Zloader samples and Ursnif samples signed with\nthe same digital signature!\n\nAs an example, consider a signature:\n\nIssuer `BABJNCXZHQCJUVWAJJ`\n\nThumbprint `46C79BD6482E287647B1D6700176A5F6F5AC6D57 .`\n\nZloader sample signed with it has a SHA256 hash:\n```\n2a9ff0a0e962d28c488af9767770d48b9128b19ee43e8df392efb2f1c5a696f .\n\n```\nSigned Ursnif sample has a SHA256 hash:\n\n```\n54e6e6b23dec0432da2b36713a206169468f4f9d7691ccf449d7d946617eca45\n\n```\n\nIt is not the only digital signature, shared among Ursnif and Zloader samples.\n\n**Infrastructure**\n\nAs we mentioned before, the first observed download command contained a link to\n```\nteamworks455[.]com . We checked the TLS certificate for this site and realized that it was\n\n```\nfor another site – `dotxvcnjlvdajkwerwoh[.]com . We saw this hostname on 11`\nNovember 2021 in Ursnif webinjects, it was used to receive stolen data.\n\nAnother example – `aerulonoured[.]su – host used by Zloader to receive stolen data at`\nleast from August 2021. It also appeared in Ursnif webinjects in November 2021.\n\n\n-----\n\nThird example – `qyfurihpsbhbuvitilgw[.]com which was found in Zeus configuration`\nupdate, received from C&C on 20 October 2021. It must be added to a C&C list and then\nused by Zloader bots. The same domain was found in Ursnif webinjects on 1 November\n2021\n\nAnd, finally, 4th example – `etjmejjcxjtwweitluuw[.]com This domain was generated`\nusing DGA from key `03d5ae30a0bd934a23b6a7f0756aa504 and date – 22 September`\n2021. We have very strong evidence that it was active on that date as a Zloader C&C. The\nsame host was found in Ursnif WebInjects on 1 November 2021\n\n## Conclusion\n\nWe are proud we could be part of the investigation as we continue our mission to make the\nworld a safer place for everybody. We hope for a successful takedown of the Zloader botnet\nand prosecution of people who created and operated it.\n\n[Tagged asanalysis,](https://decoded.avast.io/tag/analysis/) [botnet,](https://decoded.avast.io/tag/botnet/) [malware,](https://decoded.avast.io/tag/malware/) [reversing,](https://decoded.avast.io/tag/reversing/) [takedown](https://decoded.avast.io/tag/takedown/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-14 - Zloader 2- The Silent Night.pdf"
    ],
    "report_names": [
        "2022-04-14 - Zloader 2- The Silent Night.pdf"
    ],
    "threat_actors": [
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535874,
    "ts_updated_at": 1743041678,
    "ts_creation_date": 1653752679,
    "ts_modification_date": 1653752679,
    "files": {
        "pdf": "https://archive.orkl.eu/a7694bc4451dabb8d42b60d2b23a7edc6aeccfde.pdf",
        "text": "https://archive.orkl.eu/a7694bc4451dabb8d42b60d2b23a7edc6aeccfde.txt",
        "img": "https://archive.orkl.eu/a7694bc4451dabb8d42b60d2b23a7edc6aeccfde.jpg"
    }
}