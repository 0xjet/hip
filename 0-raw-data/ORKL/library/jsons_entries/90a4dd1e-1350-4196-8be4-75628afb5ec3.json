{
    "id": "90a4dd1e-1350-4196-8be4-75628afb5ec3",
    "created_at": "2023-01-12T15:10:13.67586Z",
    "updated_at": "2025-03-27T02:09:18.44195Z",
    "deleted_at": null,
    "sha1_hash": "2a0f787c8185a9e3577ad3de65aa96c3cd10d453",
    "title": "2021-05-11 - A defender’s view inside a DarkSide ransomware attack",
    "authors": "",
    "file_creation_date": "2022-05-28T01:22:35Z",
    "file_modification_date": "2022-05-28T01:22:35Z",
    "file_size": 1420670,
    "plain_text": "# A defender’s view inside a DarkSide ransomware attack\n\n**[news.sophos.com/en-us/2021/05/11/a-defenders-view-inside-a-darkside-ransomware-attack/](https://news.sophos.com/en-us/2021/05/11/a-defenders-view-inside-a-darkside-ransomware-attack/)**\n\nMay 11, 2021\n\n[The recent ransomware intrusion of a major US gasoline pipeline operator was the work of](https://www.bloomberg.com/news/articles/2021-05-08/u-s-s-biggest-gasoline-and-pipeline-halted-after-cyberattack)\nan affiliate of DarkSide, a ransomware-as-a-service ring that has been responsible for at\nleast 60 known cases of double-extortion so far this year. DarkSide has struck several high[profile victims recently, including companies listed on the NASDAQ stock exchange. But the](https://therecord.media/ransomware-gang-wants-to-short-the-stock-price-of-their-victims/)\ndisruption of Colonial Pipeline’s network led to the company shutting down its operational\ntechnology (OT) network as well—effectively cutting off a majority of the gasoline supply to\nthe eastern United States.\n\nColonial Pipeline’s shutdown is not the first critical infrastructure issue triggered by a\n[ransomware attack. Last February, a US-based natural gas facility was shut down for two](https://arstechnica.com/information-technology/2020/02/ransomware-infection-shuts-down-us-natural-gas-operator-for-2-days/)\ndays by a ransomware intrusion that spread to its OT network. And DarkSide has not\navoided these types of companies, either, [hitting a Brazilian energy company earlier this](https://www.bleepingcomputer.com/news/security/eletrobras-copel-energy-companies-hit-by-ransomware-attacks/)\nyear. But the Colonial incident has potentially greater real-world impact—and has apparently\nmade DarkSide’s operators [more notorious than they’re comfortable with.](https://www.nasdaq.com/articles/u.s.-pipeline-hackers-say-their-aim-is-cash-not-chaos-2021-05-10)\n\nThe Sophos Rapid Response team has been called in for incident response or to intervene\nduring an attack involving DarkSide on at least five different instances in the past year.\n\n\n-----\n\n## Coming over to DarkSide\n\nDarkSide emerged last summer, gaining notice with its purported “honor among thieves”\napproach: the gang claimed to have a code of conduct that forbid targeting industries and\nnon-profit organizations connected to the public interest.\n\nThe ring has struggled to keep its “honorable” reputation, using their leak site as a platform\nto counter bad news. When ransomware recovery company Coveware warned that\n[DarkSide’s use of Iranian hosting posed potential peril of sanctions violations if companies](https://www.bleepingcomputer.com/news/security/darkside-ransomwares-iranian-hosting-raises-us-sanction-concerns/)\npaid them, DarkSide’s operators posted a “press release” denying they used any Iranian IT\nservices. The Colonial Pipeline attack again has the DarkSide gang backpedaling, pleading\nin a post on their web page that they are “apolitical” and that their goal is “to make money,\nand not creating problems for society.”\n\n\n-----\n\nThe ransomware threat actors claim their actions are ‘apolitical’\nThe gang previously promised to spare healthcare organizations, as well as others involved\nin vaccine distribution, because of the negative attention such attacks could potentially bring\nfrom within the gang’s home country. Because of the way DarkSide operates, it’s not clear\nhow much control the keepers of the DarkSide brand have over the affiliates who do the\nactual work of breaking into networks and launching their ransomware.\n\nDarkSide’s affiliate ad: “Who are we looking for? A limited number of stable and adequate\npartners who understand why it is necessary to upload data, what is backups and how to\ndelete them, Russian-speaking, with payouts from 500k.”\nDarkSide follows in the footsteps of double-extortion ransomware operators such as REvil,\nMaze, and LockBit—exfiltrating business data before encrypting it, and threatening public\nrelease if the victims don’t pay for a decryption key. Like those other targeted operations,\nDarkSide makes hefty ransom demands. In one case Sophos Rapid Response worked on\nlast year, the ring demanded $4 million (which went unpaid).\n\nBeyond the business model, DarkSide follows generally the same tactics, techniques, and\nprocedures of many other targeted ransomware campaigns — a mix of native Windows\n[features, commodity malware (including SystemBC), and off-the-shelf system and exploit](https://news.sophos.com/en-us/2020/12/16/systembc/)\ntools (including Cobalt Strike). This is in part because of DarkSide’s affiliate model.\n\nThe creators of DarkSide outsource the initial compromise of targets and deployment of\nDarkSide’s cryptographic ransomware to network penetration specialists, who hand off\nransom victim “customer service” to DarkSide’s core operators. Those affiliates likely have\n\n\n-----\n\nprior experience playing the same role for other ransomware syndicates.\n\nIn Sophos’ experience in data forensics and incident response to DarkSide attacks, the initial\naccess to the target’s network came primarily as a result of phished credentials. This is not\nthe only way ransomware attackers can gain a foothold but it seems to be prevalent in cases\ninvolving this type of ransomware, possibly as a result of the affiliates’ preferences.\n\nUnlike some other ransomware players, DarkSide is capable of encrypting Linux computers\nas well as those running Windows, which makes it a more desirable tool for threat actors\nwho want to target large enterprises.\n\nWhile some recent targeted ransomware operations from other gangs have sprung quickly,\nlaunching their attack within days, the actors behind DarkSide campaigns may spend weeksto-months poking around inside an organization’s network before activating their\nransomware payload.\n\n## Dwell Time\n\n**Metric** **Dwell Time (Days)**\n\nMinimum 44\n\nMedian 45\n\nMaximum 88\n\nOver the course of that dwell time, the intruders exfiltrate as much data as possible.\nDarkside’s ransom notes claim the theft of large amounts of data, often from several\ndepartments within an organization, such as Accounting and R&D. Using PSExec, Remote\nDesktop connections, and (in the case of Linux servers) SSH to move laterally within the\nnetwork, the DarkSide actors uploaded archives of stolen files to the cloud storage providers\nMega or pCloud in cases we’ve investigated.\n\n## File system activity\n\nThe DarkSide ransomware performs specific steps to encrypt a document, first appending a\nunique file extension to the name of every targeted document type before encrypting the file.\n\nThe malware checks whether the Windows 10 user account under which it is running has\nadministrative privileges; If it does not, the malware attempts to elevate its privileges using\nthe CMSTPLUA technique.\n\nDarkSide retrieves the target computer’s network adapter MAC address, and then computes\nCRC32 five times on the first six bytes of the adapters’ MAC address, where the initial seed\nis 0xDEADBEEF. Because the first six bytes of a MAC address are registered to\n\n\n-----\n\nmanufacturers, many of the affected corporate machines would end up with the same file\nextension appended to documents simply as a result of the machines being part of a bulk\npurchase.\n\nThe attackers (likely the same affiliates involved in the initial access) also make an effort to\nterminate software that, if it was running, might otherwise interfere with the encryption\nprocess. We’ve observed them terminate the services relating to enterprise backup software\nfrom Commvault and Veeam, shut down the mail server software MailEnable, and kill SQL\nserver database services, so they can encrypt any database they find. They also attempt to\nuninstall or tamper with Sophos services if they’re present on the machine. Like other\nransomware, DarkSide also deletes Volume Shadow Copies, which could help recover some\nof the encrypted data if left unmolested.\n\nEncrypting every document file type on a hard drive takes time, and if the process gets\ninterrupted mid-way through, some of the unencrypted files could be recovered easily.\nRenaming the file with a new extension before encrypting it gives an attacker the ability to\nmake it appear as though everything has been encrypted, as the file extension change cuts\nthe ties between the document file type and its associated application.\n\nThe encryption process for DarkSide always has followed these steps:\n\nStep Operation Purpose\n\n\n1 CreateFile (Generic\nRead/Write)\n\n\nOpen original document for reading and writing.\n\n\n2 ReadFile Read last 144 bytes of original document (look for\ndecryption blob).\n\n3 CloseFile Close original document (no changes made).\n\n\n4 CreateFile (Read\nAttributes)\n\n\nOpen original document.\n\n\n5 SetRenameInformationFile Rename document by adding a specific file type\nextension, for example .c0d2f38a\n\n6 CloseFile Close now renamed document.\n\n\n7 CreateFile (Generic\nRead/Write)\n\n\nOpen renamed original document.\n\n\n8 ReadFile Read renamed original document.\n\n9 WriteFile Write encrypted document in renamed original\ndocument.\n\n10 WriteFile Add decryption blob, 144 bytes, to end of file.\n\n\n-----\n\n11 CloseFile Close renamed, now encrypted, document.\n\n## Solving the ugly icon problem\n\nThere are several benefits to the threat actors when ransomware appends a new or unusual\nfile extension to the files it encrypts. Of course, it decouples the encrypted documents from\ntheir normally associated applications, which means the user can’t interact with them in the\nusual way (by double-clicking). The unusual file suffixes represent both a signal to the\nransomware that a file has already been encrypted (so the ransomware engine doesn’t reencrypt or double-encrypt the same files), and carry a side benefit: it prevents other\nransomware (at least, the families that target the documents they will attack using hardcoded\nlists of file suffixes—a lot of them) from encrypting those same files.\n\nOne downside to switching the file suffix is that, when it loses its association with its\napplication, the document no longer uses the icon tied to that association. So an encrypted\nWord document, for instance, just has a blank icon rather than a pretty picture of a document\nwith a W on it.\n\nDarkSide appears to be very concerned with this problem of the poor appearance of\nencrypted hard drives, so they have worked out a solution.\n\nEncrypted documents typically\n\nreceive a new file extension and are consequently no longer associated with the document’s\nproductivity application\nDarkSide drops an image file — an icon — into the %APPDATA%\\Local directory, named\nafter the same eight character extension the ransomware has used to rename every targeted\nfile. In this example, that extension is .c0d2f38a. It then writes out a Windows Registry key in\n**HKEY_CLASSES_ROOT that associates files with the unique and peculiar file extension it**\nhas generated to that icon file, so that encrypted files suddenly have a unique icon of their\nvery own.\n\n\n-----\n\nRegistering the ransomware file type extension …\n\nand referencing it to the icon file\nDarkSide’s .ico file is so thorough that it contains several icon sizes, so your computer will\ndisplay the appropriately sized icon according to your preferences. It comes in 64×64,\n32×32, 24×24, and 16×16 pixels, and it looks like a black padlock.\n\nSo what happens is that a folder full of documents goes from looking like this:\n\nPictures not yet attacked by DarkSide ransomware.\n\n\n…\n\n\n-----\n\n…to looking like a folder full of locked files, like this:\n\nPictures encrypted by DarkSide with the lock icon.\n\n## After the encryption is complete\n\nAfter the ransomware has concluded the file encryption, it drops this ransom note in each\nfolder that contains the newly scrambled files:\n\n\n-----\n\nThe ransom note, redacted.\nThe link takes the victim to the payment page, hosted on the dark web:\n\nThe ransom demand gives the target a handy conversion of the ransom demand into both\nBitcoin and Monero (Dogecoin not currently accepted for payment), a countdown lock to\nwhen the ransom demand doubles, and a link to the page that hosts examples of “Your data\nstealed.”\n\n\n-----\n\n## Attacking Linux, encrypting VMDK files\n\nThe DarkSide ransomware adversary not only attacks Windows machines, but also deploys\nELF binaries (Executable and Link Format) to attack data on Linux machines. The Linux\nversion of the DarkSide ransomware specifically targets VMDK files, which are virtual hard\ndisk drives to be used in virtual machines like VMware and VirtualBox.\n\nConsole output of the Linux version reveals this ransomware is specifically searching for file\nextensions associated with virtual hard disk drives on Linux, including on hypervisor\noperating systems like VMWare’s ESX, where the virtual hard drives for virtual machines are\nstored under the /vmfs/volumes/ file path:\n\n## Turning away from the DarkSide\n\nSophos defends against DarkSide in multiple ways. There are behavioral and dynamic\nprotections, which include the CryptoGuard feature in Intercept X, and both conventional\nendpoint detections for Windows (Troj/Ransom-GAZ, Troj/PShl-E, VBS/Agent-BGYV) and\nLinux (Linux/Ransm-J) malicious executables, and next-gen detections for in-memory\nfunctions (Mem/DarkSide-A, HPmal/DarkS-A) and behaviors (AMSI/Inject-H,\n**AMSI/PSRans-A, ML/PE-A) on Windows.**\n\n**Acknowledgments**\n\nSophosLabs would like to acknowledge Yusuf Arslan Polat, Gabor Szappanos, Suriya\nNatarajan, Szabolcs Lévai, and Ferenc László Nagy for their contributions to this post.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-11 - A defender’s view inside a DarkSide ransomware attack.pdf"
    ],
    "report_names": [
        "2021-05-11 - A defender’s view inside a DarkSide ransomware attack.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536213,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653700955,
    "ts_modification_date": 1653700955,
    "files": {
        "pdf": "https://archive.orkl.eu/2a0f787c8185a9e3577ad3de65aa96c3cd10d453.pdf",
        "text": "https://archive.orkl.eu/2a0f787c8185a9e3577ad3de65aa96c3cd10d453.txt",
        "img": "https://archive.orkl.eu/2a0f787c8185a9e3577ad3de65aa96c3cd10d453.jpg"
    }
}