{
    "id": "ee9c1f8f-5d1c-4d07-897c-b3ef6114f012",
    "created_at": "2023-01-12T15:06:25.164322Z",
    "updated_at": "2025-03-27T02:14:34.077933Z",
    "deleted_at": null,
    "sha1_hash": "189f7c1fbdca228c52bce1402a88ada3419e4960",
    "title": "2021-12-16 - Global outbreak of Log4Shell",
    "authors": "",
    "file_creation_date": "2022-05-27T22:59:18Z",
    "file_modification_date": "2022-05-27T22:59:18Z",
    "file_size": 488931,
    "plain_text": "# Global outbreak of Log4Shell\n\n**[cybersecurity.att.com/blogs/labs-research/global-outbreak-of-log4shell](https://cybersecurity.att.com/blogs/labs-research/global-outbreak-of-log4shell)**\n\n[1. AT&T Cybersecurity](https://cybersecurity.att.com/)\n[2. Blog](https://cybersecurity.att.com/blogs)\n\n[December 16, 2021 | Santiago Cortes](https://cybersecurity.att.com/blogs/author/santiago-cortes)\n\n## Executive summary\n\nLog4Shell is a high severity vulnerability (CVE-2021-44228) impacting Apache Log4j\nversions 2.0 to 2.14.1. It was discovered by Chen Zhaojun of Alibaba Cloud Security Team\nand disclosed via the project´s GitHub repository on December 9, 2021.\n\n### Key takeaways:\n\nPrevalent utility Log4j across the industry allows unauthenticated remote code\nexecution.\nThe publicly available proof-of-concept and vulnerability’s easy exploitability make this\nvulnerability particularly dangerous.\nDifferent opportunistic campaigns are taking advantage of the vulnerability to spread\nmalware like botnets and miners.\n\n## Background\n\n\n-----\n\nLog4j is an open-source Java logging utility developed by the Apache Foundation. It is widely\nused as a prevalent dependency in many applications and services. If exploited, the\nvulnerability allows for unauthenticated remote code execution, leaving services particularly\nexposed .\n\nAn attacker that can forge log messages or their parameters may manage to execute\narbitrary code loaded from malicious LDAP servers if message lookup substitution is\nenabled. (LDAP, or lightweight directory access protocol, is a protocol that makes it possible\nfor applications to query user information rapidly.) Log4j disabled this feature in version\n2.15.0 in early December 2021.\n\n## Analysis\n\nLog4j includes a lookup mechanism to retrieve information like “${java:runtime}” and\n“${java:os}” from the system, but also to make requests using Java Naming and Directory\nInterface (JNDI). The key issue is that many services may log user provided information\nwithout proper input validation. For example, URLs requested or any of its headers, such as\nthe User-Agent used in a HTTP request, are commonly logged.\n\nJNDI can use different service provider interfaces (SPIs) like LDAP to find and invoke\nobjects, and as the logging information can be forged by an unauthenticated user, a\nvulnerable service may reach an arbitrary LDAP server under control of the attacker to\ninvoke a malicious payload.\n\nWe can observe the growth of JNDI related scans cross the internet:\n\nFigure 1. JNDI related scans across honeypots.\n\n[According to a Netlab blog on December 13, 2021, Netlab identified 10 different implants](https://blog.netlab.360.com/yi-jing-you-xxxge-jia-zu-de-botnetli-yong-log4shelllou-dong-chuan-bo-wei-da-bu-ding-de-gan-jin-liao/)\nusing the vulnerability to spread:\n\nMuhstik, DDoS+backdoor\nMirai\nDDoS family Elknot\nMining family m8220\nSitesLoader\n\n\n-----\n\nxmrig.pe / xmrig.ELF\nMeterpreter variants\n\nAccording to [Crowdstrike, their research team has identified campaigns leveraging the](https://twitter.com/Adam_Cyber/status/1470152554310950917)\nvulnerability consistent with advanced attackers, such as deploying web shells and\nconducting lateral movement.\n\nAT&T Alien Labs has identified prevalent obfuscation techniques to avoid potential detection\nand protection mechanisms, like using the lookup keywords upper and lower and by using\nlookup arguments like “${::-j}” or, even with an extra tweak, the following lookup would be\ntranslated as a j: “${env:ENV_NAME:-j}”.\n\nFor example, a lookup like:\n\nFigure 3. Exploitation example.\n\nCould be obfuscated as:\n\nFigure 4. Obfuscation example\n\nWe have also seen references of obfuscation using base64 by invoking\n“/Basic/Command/Base64/” in the destination, for example in the event:\n\nFigure 5. Base64 obfuscation example.\n\nThe base64 deobfuscates to:\n\nFigure 6. Deobfuscated payload.\n\nIn addition to being leveraged for obfuscation, environmental variables are being used in\nother ways. [Sophos has reported on campaigns that are stealing AWS secrets by requesting](https://news.sophos.com/en-us/2021/12/12/log4shell-hell-anatomy-of-an-exploit-outbreak/)\nenvironment variables in the lookup:\n\n\n-----\n\nFigure 7. Retrieving secrets from environment variables.\n\nTo make sure the string is evaluated, attackers are injecting the lookups in every available\nfield inside a HTTP request. For example:\n\nFigure 8. Exploitation attempt leveraging all available fields.\n\n## Recommended actions\n\n1. Identify if any of your servers use Log4j and patch or update Log4j to the latest version.\n2. If you are unable of updating or patching, there are some workarounds recommended\n\nby Apache:\n\n1. Disable lookups when executing Java by adding the option:\n\n_-Dlog4j2.formatMsgNoLookups=true_\n2. Disable lookups by setting an environment variable:\n\n_set LOG4J_FORMAT_MSG_NO_LOOKUPS=true_\n3. Repackage your log4j-core-*.jar file by deleting the JNDI component:\n\n_zip -q -d log4j-core-*.jar org/apache/logging/log4j/core/lookup/JndiLookup.class_\n3. Review your application logs for jndi lookups with the command:\n\n_sudo egrep -i -r '\\$\\{jndi:(ldap[s]?|rmi|dns):/[^\\n]+' /var/log_\n4. Review detections of suspicious child processes spawned by Java\n\n## Conclusion\n\n\n-----\n\nLog4Shell can potentially have a very large impact at the end of 2021, based on the number\nof exposed and vulnerable devices and the facility of its exploitation. In fact, it will likely be\nremarked as one of the most significant vulnerabilities of 2021.\n\n[AT&T Alien Labs will keep monitoring the situation and will update an OTX Pulse to keep our](https://otx.alienvault.com/pulse/61bb5295973e2f639b157c6b)\ncustomers protected.\n\nFor the full report, including detection methods in use by AT&T Alien Labs for the Unified\nSecurity Management (USM) platform, click [here.](https://cdn-cybersecurity.att.com/docs/industry-reports/global-outbreak-of-log4shell.pdf)\n\n### Share this with others\n\nTags: [malware,](https://cybersecurity.att.com/blogs/tag/malware) [log4shell](https://cybersecurity.att.com/blogs/tag/log4shell)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-12-16 - Global outbreak of Log4Shell.pdf"
    ],
    "report_names": [
        "2021-12-16 - Global outbreak of Log4Shell.pdf"
    ],
    "threat_actors": [
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535985,
    "ts_updated_at": 1743041674,
    "ts_creation_date": 1653692358,
    "ts_modification_date": 1653692358,
    "files": {
        "pdf": "https://archive.orkl.eu/189f7c1fbdca228c52bce1402a88ada3419e4960.pdf",
        "text": "https://archive.orkl.eu/189f7c1fbdca228c52bce1402a88ada3419e4960.txt",
        "img": "https://archive.orkl.eu/189f7c1fbdca228c52bce1402a88ada3419e4960.jpg"
    }
}