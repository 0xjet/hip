{
    "id": "acb71fd6-b0a1-47b4-8002-cbd6e945fd50",
    "created_at": "2023-01-12T15:02:30.722696Z",
    "updated_at": "2025-03-27T02:13:01.865967Z",
    "deleted_at": null,
    "sha1_hash": "2fc22e5b8fa91a1a11dace554bdab39f287b2cf1",
    "title": "2022-08-16 - AsyncRAT C2 Framework- Overview, Technical Analysis & Detection",
    "authors": "",
    "file_creation_date": "2022-09-01T10:07:51Z",
    "file_modification_date": "2022-09-01T10:07:51Z",
    "file_size": 1715670,
    "plain_text": "# AsyncRAT C2 Framework: Overview, Technical Analysis & Detection\n\n**blog.qualys.com/vulnerabilities-threat-research/2022/08/16/asyncrat-c2-framework-overview-technical-analysis-and-**\ndetection\n\nPawan Kumar N August 16, 2022\n\n\n-----\n\n_In this blog we describe the AsyncRAT C2 (command & control) Framework, which allows_\n_attackers to remotely monitor and control other computers over a secure encrypted link. We_\n_provide an overview of this threat, a technical analysis, and a method of detecting the_\n_malware using Qualys Multi-Vector EDR._\n\n\n-----\n\n## What is AsyncRAT C2 Framework?\n\n[AsyncRAT C2 Framework is a Remote Access Trojan (RAT) designed to remotely monitor](https://github.com/NYAN-x-CAT/AsyncRAT-C-Sharp)\nand control other computers through a secure encrypted connection. Features include\nkeylogging, audio/video recording, info-stealing, remote desktop control, password recovery,\nlaunching remote shell, webcam, injecting payloads, among other functions.\n\nAsyncRAT has been used by various malware campaigns and threat actors in recent\nexploits. For example, as part of the [Operation Layover campaign that targeted the Aviation](https://blog.talosintelligence.com/2021/09/operation-layover-how-we-tracked-attack.html)\nindustry, [TA2541 used infected Word documents with themes related to aviation,](https://www.proofpoint.com/us/blog/threat-insight/charting-ta2541s-flight)\ntransportation, and travel to enable downloading the AsyncRAT payload. More recently, a\n[campaign using social engineering techniques targeted Thailand pass customers. Finally, the](https://www.zscaler.com/blogs/security-research/targeted-attack-thailand-pass-customers-delivers-asyncrat)\n[Follina Outbreak in Australia delivered AsyncRAT as a malicious payload.](https://decoded.avast.io/threatintel/outbreak-of-follina-in-australia/)\n\n[AsyncRAT can be detected and removed using Qualys Multi-Vector EDR, which is a service](https://www.qualys.com/apps/endpoint-detection-response/)\nof the Qualys Cloud Platform.\n\n## Threat Overview of AsyncRAT C2 Framework\n\n**Aliases: Async RAT**\n\n**Target Industry Verticals: Aviation, Travel, Hospitality, among others**\n\n**Regions: Asia, Latin America, North America, South America, Central America**\n\n**Infection Vectors: Spam/phishing email and spear-phishing**\n\n**Objective of Malware: Keylogging, data exfiltration, info-stealing, remote shell, remote code**\nexecution\n\n\n-----\n\nFigure 1: Timeline of major AsyncRAT\n\nincidents\n\n## Technical Analysis of AsyncRAT C2 Framework\n\n\n-----\n\nAsyncRAT s main function enables modules, settings, and flow of code execution. The delay\nfunction defines the sleep duration before execution, which can be modified in each variant\n(e.g. 3 seconds, 5 seconds, 10 seconds, etc.) while building the payload (see Figure 2).\n\nFigure 2: Main functions of AsyncRAT\n\n### Initialize Settings Function\n\n\n-----\n\nThe Initialize Settings function enables all hardcoded configurations and settings that are\npredefined while building the payload (Fig. 3).\n\nFigure 3: Initialization of configuration settings\nFigure 4 shows the Initialize Settings function, which also enables decryption of all\nconfiguration settings from the AES256 algorithm.\n\nFigure 4: Decryption of configuration settings\n\n### Configuration Settings\n\n\n-----\n\nPorts 8080\n\nHosts malware[.] com\n\nVersion 1.5\n\nInstall False\n\nMTX (Mutex) AsyncMutex_6SI8OkPnk\n\nPastebin null\n\nAnti False\n\nBDOS False\n\n### Verify Hash Function\n\nThe Verify Hash function reveals if the configurations are valid or not using the server\ncertificate and server signature (Fig. 5).\n\nFigure 5: Verify hash function reveals validity of configurations\n\n### Client Algorithm\n\nThe client algorithm is a decryption routine for all the hardcoded configurations & settings.\nThe [Rfc2898DeriveBytes API uses the PBKDF2 algorithm. Figure 6 shows the execution of](https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.rfc2898derivebytes?view=net-6.0)\nthis algorithm.\n\nFigure 6: Client algorithm for decrypting hardcoded configurations and settings\n\n\n-----\n\nOnce all configuration settings are decrypted, AsyncRAT creates a mutex instance, which\ncreates the mutex value of “AsyncMutex_6SI8OkPnk” by default. This value can be modified\nwhile building new payloads (Fig. 7).\n\nFigure 7: Decryption routine\n\n### Client Connection\n\nUsing the “WebClient.DownloadString” API, AsyncRAT can download additional resources\nand other payloads from pastebin or other domains. Figure 8 shows the code used for\nconnecting to a domain via the specified port.\n\n\n-----\n\nFigure 8: Enabling a C2 connection\n\n### Client Helper\n\n**Anti-Analysis**\n\nAsyncRAT’s Client Helper includes an anti-analysis tool with multiple subfunctions such as:\n\nDetect Manufacturer\nDetect Sandbox\nIsSmallDisk\nIsXP\nAnti-Virus Check\n\nFigure 9: Anti-analysis tool enabled in AsyncRAT\n\n**Detect Debugger**\n\nClient Helper provides a Detect Debugger tool that uses the\n[“CheckRemoteDebuggerPresent” API to check if a process is being debugged (Fig. 10).](https://docs.microsoft.com/en-us/windows/win32/api/debugapi/nf-debugapi-checkremotedebuggerpresent)\n\n\n-----\n\nFigure 10: Detect debugger tool in Client Helper\n\n**Detect Manufacturer**\n\nClient Helper’s Detect Manufacturer tool enables anti-virtual machine (VM) techniques by\nusing WMI queries and checks for keywords like “Microsoft Corporation”, “VIRTUAL”,\n“VMware”, or “VirtualBox” to detect VM environments.\n\nFor example, Figure 11 shows a query: “Select * from Win32 ComputerSystem”:\n\nFigure 11: Detect VM query in Client Helper\n\n**Detect Sandbox**\n\n[The Detect Sandbox feature in AsyncRAT’s Client Helper uses the “GetModuleHandle” API](https://docs.microsoft.com/en-us/previous-versions/ms908443(v=msdn.10))\nto load the “SbieDll.dll” module to detect a sandbox (Fig. 12).\n\n\n-----\n\nFigure 12: Detect sandbox feature in Client Helper\n\n**IsSmallDisk**\n\n[Another Client Helper tool called IsSmallDisk uses the “Path.GetPathRoot” API to check for](https://docs.microsoft.com/en-us/dotnet/api/system.io.path.getpathroot?view=net-6.0)\ndisk size, since most VMs would have a smaller disk size than that used in physical disk\ndrives. Figure 13 shows how IsSmallDisk is enabled.\n\nFigure 13: Detect disk size\n\n**IsXP**\n\nAnother tool, IsXP, checks whether the operating system used is Windows XP or not. Figure\n14 shows how this tool is enabled.\n\n\n-----\n\nFigure 14: Detect Windows XP\n\n**Antivirus Check**\n\nThe Antivirus Check tool in Client Helper uses WMI checks for which antivirus product is\ninstalled in the system. Figure 15 shows this being done with the following command:\n```\n“\\\\root\\SecurityCenter2”\n, “Select * AntiVirusProduct”\n.\n\n```\nFigure 15: Anti-virus check\nOnce AsyncRAT performs all the checks and collects desired information, it sends the data\nto its C2 server (Fig. 16).\n\n\n-----\n\nFigure 16: Data exfiltration to C2 server\n\n### Client Install\n\nAsyncRAT’s Client Install feature maintains persistence checks as to whether the process\nhas admin privileges. This occurs by creating a scheduled persistence check every time a\nuser logs on. For example:\n\n```\nCommand: “/c schtasks /create /f /sc onlogon /rl highest /tn”\n\n```\n\nIf the process reveals there are no admin privileges, a run registry entry is created in reverse\norder: `“Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run”;\nit then copies itself`\ninto a `“%temp%”\nfolder with a different name and executes from the temp folder via a bat`\nscript (Fig. 17).\n\n\n-----\n\nFigure 17: Enabling persistence checks for admin privileges\nFigure 18 shows the bat script being dropped into `“%temp%”\nfolder. It self-deletes after`\nexecution.\n\nFigure 18: Bat script\nThe Client Install tool then creates a run registry entry with the binary name and its full path\n(Fig. 19):\n\nFigure 19: Run key entry by Client Install tool\n\n### Keylogger\n\n\n-----\n\n[AsyncRAT s Keylogger feature uses the code of opensource project LimeLogger, which uses](https://github.com/NYAN-x-CAT/LimeLogger/blob/master/LimeLogger/LimeLogger.cs)\nAPI’s like “GetKeyState” and “GetKeyboardLayout” to capture the keystrokes on the victim\nmachine (Fig. 20).\n\nFigure 20: LimeLogger enabling keylogger feature\nThe keylogger takes a snapshot of the keystrokes captured on victim machine, which can be\nsaved to text file. Figure 21 shows a few examples.\n\n\n-----\n\nFigure 21:\n\nCaptured keystrokes on victim machine\n\n### Native API Methods\n\n[RtlSetProcessIsCritical: Used to prevent the termination of a malware process; if it is](https://www.geoffchappell.com/studies/windows/win32/ntdll/api/rtl/peb/setprocessiscritical.htm)\nterminated, the system will crash with a blue screen error\n\n[Get Active Window: It uses the “GetForegroundWindow” API to identify the window in](https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getforegroundwindow)\nwhich the user is currently working\n\n[Prevent Sleep: Use of the “SetThreadExecutionState” API prevents the system from](https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-setthreadexecutionstate)\nentering sleep mode\n\n### Server-Side Features\n\nAsyncRAT’s server interface provides a client tab with details about the victim machine.\nFigure 22 shows this display.\n\n1. IP Address of the victim machine\n2. HWID: hardware ID of victim machine\n3. Username\n4. Operating system\n5. Privileges: user / admin\n6. AV software installed on the system\n7. Active Window: window that a user is currently using\n\n\n-----\n\nFigure 22: Victim machine information\nThe AsyncRAT server interface also provides the logs tab, which shows a list of all\ncommands executed and actions performed on victim machine (Fig. 23).\n\nFigure 23: Logs of executed commands\nOnce the connection is established, AsyncRAT provides the option of dropping additional\npayload files into the memory or disk of the victim machine (Fig. 24).\n\nMemory: Uses reflective code loading and the RunPE method to load a file into\nmemory\nDisk: Just drops an existing file into a particular folder path; if any file is dropped on a\nvictim’s machine, or if any other commands are sent from the server, those actions are\ncaptured under the Tasks tab\n\n\n-----\n\nFig 24: Drop files in Memory / Disk\n\n### Monitoring Features\n\nRemote Desktop\nKeylogger\nFile manager\nProcess manager\nWebcam\n\n### Miscellaneous Features & Plugins\n\nDOS attack\n.NET code execution\nBot-killer\nRemote shell\nUSB Spread\nMiner\nFile Search\nChat\nSend Message Box\nVisit website\nGet admin privileges\nBlank screen\nDisable defender\nSet wallpaper\n\n## Detection of AsyncRAT using Qualys Multi-Vector EDR\n\n\n-----\n\n[Qualys Multi-Vector Endpoint Detection and Response (EDR) is a dynamic detection and](https://www.qualys.com/apps/endpoint-detection-response/)\nresponse service powered by the Qualys Cloud Platform. Qualys Multi-Vector EDR detects\nmalware like AsyncRAT C2 Framework by unifying multiple context vectors to spot its\ninsertion into a network endpoint. Qualys Cloud Platform provides asset management,\nvulnerability detection, policy compliance, patch management, and file integrity monitoring\ncapabilities – all delivered with a single agent and cloud-based delivery for a lower total cost\nof ownership.\n\nQualys Multi-Vector EDR provides real-time insights as an attacker attempts to breach an\norganization’s cybersecurity controls. For example, Figure 25 shows a process tree for how\nAsyncRAT is creating a copy of itself into a `“%temp%”\nfolder.`\n\nFigure 25: Qualys EDR process tree for AsyncRAT attack\nFigure 26 shows the command line arguments of cmd.exe executing a bat script dropped\ninto the `“%temp%”\nfolder.`\n\n\n-----\n\nFigure 26:\n\nCommand line arguments of cmd.exe\nFigures 27 and 28 show other insights from Qualys Multi-Vector EDR as it detects the\nAsyncRAT with a threat score of 9/10.\n\nFigure 27: Process creation with Qualys Multi-Vector EDR\n\nFigure 28: Detection of run registry entry with Qualys Multi-Vector EDR\n\n\n-----\n\n## MITRE ATT&CK® Mapping\n\n[For security organizations who have adopted the MITRE ATT&CK® framework, Qualys](https://attack.mitre.org/)\nMulti-Vector EDR maps directly to its knowledge base of adversary tactics and techniques\nbased on real-world observations. The MITRE ATT&CK [knowledge base is used as a](https://attack.mitre.org/matrices/enterprise/)\nfoundation for the development of specific threat models and methodologies in the private\nsector, government, and Cybersecurity vendor community.\n\nHere is a list of MITRE ATT&CK TTPS that an unmodified version of AsyncRAT implements:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-16 - AsyncRAT C2 Framework- Overview, Technical Analysis & Detection.pdf"
    ],
    "report_names": [
        "2022-08-16 - AsyncRAT C2 Framework- Overview, Technical Analysis & Detection.pdf"
    ],
    "threat_actors": [
        {
            "id": "4f5da0b4-5d47-4ae4-87cb-dfcb3c3524ae",
            "created_at": "2022-10-25T16:07:23.96921Z",
            "updated_at": "2025-03-27T02:02:10.054899Z",
            "deleted_at": null,
            "main_name": "Operation Layover",
            "aliases": [],
            "source_name": "ETDA:Operation Layover",
            "tools": [
                "AsyncRAT",
                "Bladabindi",
                "CyberGate",
                "CyberGate RAT",
                "Jorik",
                "Rebhip",
                "njRAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "99468ac6-ccfd-4cd8-b726-791600e61431",
            "created_at": "2023-11-01T02:01:06.647272Z",
            "updated_at": "2025-03-27T02:00:55.456016Z",
            "deleted_at": null,
            "main_name": "TA2541",
            "aliases": [
                "TA2541"
            ],
            "source_name": "MITRE:TA2541",
            "tools": [
                "Snip3",
                "Revenge RAT",
                "jRAT",
                "WarzoneRAT",
                "Imminent Monitor",
                "AsyncRAT",
                "NETWIRE",
                "Agent Tesla",
                "njRAT"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "97dc332f-2241-4755-ae33-54e5eff3990a",
            "created_at": "2023-01-06T13:46:39.307201Z",
            "updated_at": "2025-03-27T02:00:03.046734Z",
            "deleted_at": null,
            "main_name": "TA2541",
            "aliases": [],
            "source_name": "MISPGALAXY:TA2541",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "878ce40c-9fbc-4cff-a5c4-771086979fa7",
            "created_at": "2022-10-25T16:07:24.264056Z",
            "updated_at": "2025-03-27T02:02:10.154595Z",
            "deleted_at": null,
            "main_name": "TA2541",
            "aliases": [],
            "source_name": "ETDA:TA2541",
            "tools": [
                "AVE_MARIA",
                "AgenTesla",
                "Agent Tesla",
                "AgentTesla",
                "AsyncRAT",
                "Ave Maria",
                "AveMariaRAT",
                "DarkRAT",
                "H-Worm",
                "H-Worm RAT",
                "Houdini",
                "Houdini RAT",
                "Hworm",
                "Imminent Monitor",
                "Imminent Monitor RAT",
                "Iniduoh",
                "Jenxcus",
                "Kognito",
                "Luminosity RAT",
                "LuminosityLink",
                "Negasteal",
                "NetWeird",
                "NetWire",
                "NetWire RAT",
                "NetWire RC",
                "NetWired RC",
                "Njw0rm",
                "Origin Logger",
                "Parallax",
                "Parallax RAT",
                "ParallaxRAT",
                "Recam",
                "Revenge RAT",
                "RevengeRAT",
                "Revetrat",
                "WSHRAT",
                "ZPAQ",
                "avemaria",
                "dinihou",
                "dunihi"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535750,
    "ts_updated_at": 1743041581,
    "ts_creation_date": 1662026871,
    "ts_modification_date": 1662026871,
    "files": {
        "pdf": "https://archive.orkl.eu/2fc22e5b8fa91a1a11dace554bdab39f287b2cf1.pdf",
        "text": "https://archive.orkl.eu/2fc22e5b8fa91a1a11dace554bdab39f287b2cf1.txt",
        "img": "https://archive.orkl.eu/2fc22e5b8fa91a1a11dace554bdab39f287b2cf1.jpg"
    }
}