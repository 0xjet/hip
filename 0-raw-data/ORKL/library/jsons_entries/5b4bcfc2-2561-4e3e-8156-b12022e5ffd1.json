{
    "id": "5b4bcfc2-2561-4e3e-8156-b12022e5ffd1",
    "created_at": "2022-10-25T16:48:13.866041Z",
    "updated_at": "2025-03-27T02:17:05.636818Z",
    "deleted_at": null,
    "sha1_hash": "efd7b3a3a2bf6e3976411347dc9101fea70c9405",
    "title": "BlackEnergy & Quedagh: The convergence of crimeware and APT attacks",
    "authors": "F-Secure",
    "file_creation_date": "2014-09-24T16:17:53Z",
    "file_modification_date": "2014-09-24T16:17:57Z",
    "file_size": 556583,
    "plain_text": "## BLACKENERGY & QUEDAGH\n\n### The convergence of crimeware  and APT attacks\n\n#### TLP: WHITE\n\n\n###### CONTENTS\n\nIntroduction\b 2\nAttack overview\b 2\nInfection vectors\b 3\nTarget details\b 4\n2008 cyberattacks on Georgia?\b 4\nUkraine-related proxies\b 4\nTimeline\b 6\nTechnical details\b 8\nUAC bypass during installation\b 8\nDriver signing policy bypass\b 8\nHijacking existing drivers\b 9\nDriver component\b 9\nMain DLL component\b 10\nBlackEnergy 3 \b 10\nInformation-stealing plugin\b 11\nNetwork traffic\b 12\nConclusions\b 13\nAppendix A | Samples\b 14\n\n\nBlackEnergy is a toolkit that has been used for years by various\ncriminal outfits. In the summer of 2014, we noted that certain\nsamples of BlackEnergy malware began targeting Ukranian\ngovernment organizations for information harvesting. These\nsamples were identified as being the work of one group,\nreferred to in this document as “Quedagh”, which has a history\nof targeting political organizations.\n\nThe Quedagh-related customizations to the BlackEnergy\nmalware include support for proxy servers and use of\ntechniques to bypass User Account Control and driver\nsigning features in 64-bit Windows systems. While monitoring\nBlackEnergy samples, we also uncovered a new variant used by\nthis group. We named this new variant BlackEnergy 3.\n\nThe use of BlackEnergy for a politically-oriented attack is an\nintriguing convergence of criminal activity and espionage. As\nthe kit is being used by multiple groups, it provides a greater\nmeasure of plausible deniability than is afforded by a custommade piece of code.\n\n###### F-SECURE LABS SECURITY RESPONSE Malware Analysis Whitepaper\n\n\n-----\n\n###### 2\n\n##### INTRODUCTION\n\nBlackEnergy is a popular crimeware (that is, malware\ndesigned to automate criminal activities) that is sold in the\nRussian cyber underground and dates back to as early as\n2007. Originally, it was designed as a toolkit for creating\nbotnets for use in conducting Distributed Denial of Service\n(DDoS) attacks. Over time, the malware has evolved to\nsupport different plugins, which are used to extend its\ncapabilities to provide necessary functions, depending on\nthe purpose of an attack.\n\nGiven the nature of its toolkit, BlackEnergy has\nunsurprisingly been used by different gangs for different\npurposes; some use it for sending spam, others for stealing\nbanking credentials. The most notorious use may be when\nit was used to conduct cyberattacks against Georgia during\nthe Russo-Georgian confrontation in 2008.\n\nIn the summer of 2014, BlackEnergy caught our attention\nwhen we noticed that samples of it were now tailored to\n\n\ntarget Ukrainian government institutions. Though it may\nbe unrelated, it is interesting to note that this change\nconveniently coincides with the on-going crisis in that\ncountry. Related or not, one thing is certain: the actor(s)\nusing these customized BlackEnergy malware are intent\non stealing information from the targets. The use of this\ncrimeware in what constitutes as an advance persistent\nthreat (APT) attack is interesting. In ‘black operations’\n(black ops), an important criteria is that the attack should\nnot be attributable - and what provides better plausible\ndeniability than crimeware known to be used by multiple\nparties?\n\nIn this paper we focus only on BlackEnergy samples\nknown to be used specifically by the actors we identify\nas Quedagh, who seem to have a particular interest in\npolitical targets. Special focus will be on the samples\nthat were used in targeted attacks against Ukrainian\ngovernment organizations earlier this year.\n\n\n##### ATTACK OVERVIEW\n\nAt the time of writing, we have little information on how\nexactly victims are receiving the BlackEnergy malware\nbeing pushed by the Quedagh gang. An educated guess\nis that they are receiving the malware via targeted emails\ncontaining malicious attachments. Meanwhile, the\nfollowing infection and technical details are based on\nsamples gathered after searching through F-Secure Labs’\ncollection of all BlackEnergy samples and identifying\nthose with Quedagh characteristics.\n\n\nThe BlackEnergy toolkit comes with a builder application\nwhich is used to generate the clients that the attacker(s)\nuse to infect victim machines. The toolkit also comes\nwith server-side scripts, which the attackers set up in\nthe command and control (C&C) server. The scripts also\nprovide an interface where an attacker can control his\nbots. The simplicity and convenience provided by the\ntoolkit means that anyone who has access to the kit can\nbuild his own botnet without any skills required.\n\n\nFigure 1: BlackEnergy Builder from 2007\n\n\n-----\n\nThe original BlackEnergy toolkit first emerged in 2007 and\nis referred to in this paper as BlackEnergy 1. A later variant\nof the toolkit (BlackEnergy 2) was released in 2010. We also\nencountered a previously unseen variant, which had been\nrewritten and uses a different format for its configuration.\nIt also no longer uses a driver component. We dubbed this\nnew variant BlackEnergy 3.\n\n###### INFECTION VECTORS\n\nMost of the recent BlackEnergy installers collected are\nnamed msiexec.exe. We believe they are either dropped\nby another executable that uses social engineering tricks\nto mislead the user into executing the installer, or by\ndocuments containing exploits that silently perform the\ninstallation.\n\nWe found at least 2 trojanized legitimate applications that\nexecute the installer (in addition to their legitimate tasks).\nTrojanization is an effective infection method, as most\nusers have no way of observing that a malicious component\nis being installed in tandem with a legitimate program.\n\n\n###### 3\n\nSome earlier installer variants, then named regedt32.\nexe, were distributed by documents exploiting software\nvulnerabilities, one of which was CVE-2010-3333. These\ndocuments drop and execute the installer, then open a\ndecoy document. It is reasonable to assume that a similar\napproach has been used to deliver the more recent\ninstaller variants.\n\nThe installer filename of BlackEnergy 3 is still msiexec.exe.\nHowever, it is delivered and executed by a dropper which\nopens a decoy document in the foreground. We also\nencountered a standalone, non-persistent sample that\npretends to be Adobe Flash Player Installer. It does not use\nany decoy document or application and does not run after\nreboot.\n\nThe overview below summarizes the various infection\nvectors used by the Quedagh gang to deliver BlackEnergy\ncrimeware to the designated targets.\n\n\n###### OVERVIEW OF INFECTION VECTORS USED AGAINST UKRAINIAN TARGETS\n\n\n###### APP\n\n\nTrojanized\napp\n\nExploit\ndocument\n\nDropper\nmalware\n\nFake\ninstaller\n\n\n**APP**\n\n\nmsiexec.exe\n\nINSTALLER\n\nClean\napp\n\n\nmsiexec.exe\n\nINSTALLER\n\nDecoy\ndocument\n\nmsiexec.exe\n\nINSTALLER\n\nDecoy\ndocument\n\n\nPERSISTENT\ncomponent\n\nPERSISTENT\ncomponent\n\nPERSISTENT\ncomponent\n\n\nNON-PERSISTENT\ncomponent\n\n\n-----\n\n###### 4\n\n TARGET DETAILS\n\nFrom the very earliest variants we were able to attribute\nto Quedagh, we have noticed that their targets have been\npolitical in nature. Apart from other indicators, we can\ndeduce the nature of the target based on the content of\nsocial engineering tactics used to distribute the installers.\nFor example, one decoy dropped from a sample dating to\n2012 (image 2) seems to be targeting European audiences\nand discusses a political/economic situation. Strings found\nin another sample from 2012 (image 3) again indicate\na political motivation behind the attack. Most decoys\nused content taken from news sites; we noted one decoy\ndropped by an exploit document was created using the\nRussian version of Office (image 4).\n\nThe latest variant of the dropper pretends to be a\ndocument file with a Ukrainian filename (image 5).\nThe choice of language for the filename again may tie\nin or reference the current political crisis in that country.\nThe filename itself means ‘password list’ in English.\n\n###### 2008 CYBERATTACKS ON GEORGIA?\n\nDuring our investigation, we found interesting details\nthat lead us to suspect that Quedagh might have been\ninvolved in the cyberattacks launched against Georgia\nduring the 2008 Russo-Georgian confrontation. While the\ndetails identified are suggestive, they are not conclusive;\nthey do however seem consistent with the group’s\ninvolvement in subsequent targeted attacks.\n\n###### UKRAINE-RELATED PROXIES\n\nWhile examining the samples collected during our\nBlackEnergy monitoring, we noticed that samples from\nthis year had been updated to support the use of proxy\nservers while connecting to their C&C servers. This\ncontrasts with earlier BlackEnergy 2 variants, which do\nnot support proxy servers. In some network setups, a\nproxy server is needed to allow internal users to access\nthe Internet [[1]]. BlackEnergy¹s use of a proxy server may\nindicate that the gang has prior knowledge of the target\norganization’s internal setup to note of this requirement.\n\nFor example, in one sample the configuration uses\nthe proxy server associated with the Ukrainian Railway\n(image 6). The configuration from another sample\nalso shows it using an internal proxy under the giknpc\ndomain (image 7). The domain giknpc.com.ua in turn\nhosts 3 domains (image 8), one of which is for the city\nof Dnipropetrovsk (image 9), the fourth-largest city in\nUkraine, located in the southeast. Based on the set proxy\nservers for the different samples, we concluded that the\n\n\nImage 2:\nDecoy document circa 2012\n\nImage 3:\nStrings from a sample circa 2012\n\n\n-----\n\n###### 5\n\n\nImage 4:\nDecoy document created using a Russian version of Office\n\nImage 5:\n2014 dropper sample disguised as a document. The filename means password list\n\nImage 6:\nConfiguration using Ukrainian Railway’s proxy\n\nImage 7:\nConfiguration using internal proxy under giknpc domain\n\nImage 8:\nDomains hosted on giknpc.com\n\n\n-----\n\n###### 6\n\n TIMELINE\n\nAlthough they may have started much earlier, the earliest\nBlackEnergy sample we could attribute to the Quedagh\ngang is from December 14, 2010.\n\nInitially, the group seemed to prefer to use the filename of\nthe Windows registry editor (regedt32.exe), presumably\nbecause the installer needs administrator rights to install\nits driver component and therefore would try to request\nfor the highest available rights (image 10), if possible. As\nthis triggers a notification message visible to the user, said\nuser is more likely to grant permission if it appears to be\nthe registry editor that is requesting for permission, since\nit is normal to run it with administrator rights. Experienced\nusers though are less likely to be taken in, thereby\ndecreasing the likelihood of a successful infection.\n\nStarting April 2013, modified installers appeared showing\nthat the Quedagh group found a way to bypass the default\nUser Account Control (UAC) settings. With this change,\nthe user’s permission is no longer need (image 11). At this\npoint, the gang also began to use the Windows installer\nprogram filename msiexec.exe.\n\n###### 64-bit support\n\nWithin a month of Windows 8.1’s release, the gang\nhad quickly added support for 64-bit systems, possibly\nanticipating that more of their target systems will be\nmigrated to 64-bit systems. They also employ a neat\ntrick to bypass the driver signing requirement on 64bit Windows systems. As a side note, this latest finding\nupdates and supercedes previously published research\nrelated to BlackEnergy’s driver signing behavior [[2]].\n\nHowever, this trick doesn’t work on Windows 8 and\nlater systems. The driver also crashes occassionally. This\ncould be the reason for the stand-alone non-persistent\nBlackEnergy variant.\n\n###### BlackEnergy 3\n\nWe identified the new BlackEnergy 3 variant first by the\nchange in its configuration, which differed from those\nof its two predecessors, 1 and 2 (images 12 to 14). It also\nno longer uses a driver component [[3]]. Further technical\ndetails are documented on page 10 to 11.\n\n\nImage 10:\nInstaller requesting highest available rights\n\nImage 11:\nInstaller execution privilege level amended\n\n\n-----\n\n###### TIMELINE OF BLACKENERGY & QUEDAGH HISTORY\n\n BLACKENERGY Development\n\nMay 12\n\n###### BlackEnergy BlackEnergy BlackEnergy 1 2 3\n\n\n**Quedagh APT campaign**\n\nCYBERATTACKS\nAGAINST\nGEORGIA\n\n\nSome time\nDec 14 Apr 9 Nov 14 after Dec 25\n\n###### First installer  New UAC- 64-bit Targets (regedt32.exe) bypassing support for Ukrainian installer  BlackEnergy entities (msiexec.exe) 2 driver\n\n POLITICAL CRISIS IN UKAINE\n\n\n###### 2007 2008 2009 2010 2011 2012 2013 2014\n\n\nImage 12: BlackEnergy 1 configuration\n\nImage 13: BlackEnergy 2 (aka BotnetKernel or bkernel [[4]] ) configuration\n\nImage 14: BlackEnergy 3 configuration\n\n\n-----\n\n###### 8\n\n##### TECHNICAL DETAILS\n\n###### UAC BYPASS DURING INSTALLATION\n\nThe malware will only attempt to infect a system if the\ncurrent user is a member of the local administrator group.\nIf not, it will re-launch itself as Administrator on Vista.\nThis in effect will trigger a UAC prompt. On Windows 7\nand later however, the malware will attempt to bypass the\ndefault UAC settings. It exploits a backward-compatibility\nfeature found in newer versions of Windows. BlackEnergy\ninstallers include a Shim Database, or a “fix”, instructing\nSndVol.exe to execute cmd.exe (image 15, below) instead\nin order to resolve the incompatibility.\n\nSndVol.exe is one of the Windows executables that will\nbe automatically elevated upon execution because it\nis thought to be safe. What harm can a volume control\ncause? With the malicious “fix” installed however,\nexecuting SndVol.exe will execute the not-so-safe file\ncmd.exe instead, which can then be used to install the\nmalware while in an elevated state.\n\n\n###### DRIVER SIGNING POLICY BYPASS\n\nThe role of the installer is to set up the malware’s\npersistent component, which is the driver component.\nOn 64-bit Windows systems, Microsoft has enforced a\npolicy that requires all drivers to be signed as a security\nprecaution. Signing provides a way to identify a driver to\nits author, effectively reducing the number of malware\ndevelopers willing to take the risk. To allow developers to\ntest their drivers during development, Microsoft provides\na TESTSIGNING boot configuration option; while in this\nmode, a watermark is displayed on the screen to make it\nobvious to users and to prevent malware from exploiting\nthis option.\n\nBlackEnergy enables the TESTSIGNING option to load its\ndriver component; to hide this change from the user, the\nmalware removes the watermark by removing the relevant\nstrings in the user32.dll.mui of the system. In Windows\n8 and up however, the strings are no longer stored in\nuser32.dll.mui, so the trick will not work. This may be one\nof the reasons for the existence of a standalone nonpersistent BlackEnergy variant. The malware does not\ninfect 64-bit Windows systems that are older than Vista.\n\n\nImage 15: Malicious fix to redirect SndVol.exe to cmd.exe. Inset: Test Mode watermark\n\n\n-----\n\n###### 9\n\n\n###### DIAGRAM 1: INSTALLATION FLOW DIAGRAM 2: ROLE OF DRIVER COMPONENT\n\n\nTemporary\ncomponent\n\nPersistent\ncomponent\n\n\nINSTALLER\n\nInstalls\n\nDRIVER\n\nInjects\n\nMAIN DLL\n\n\nAdditional steps\non 64-bit systems\n\n|Ena TESTSI|ble GNING|\n|---|---|\n\n|Remov Mode wa|e Test termark|\n|---|---|\n\n|Locate driv|inactive ers|\n|---|---|\n\n\nReplace with\ndriver component\n\n|Code|Function|\n|---|---|\n|6|Loads a driver into memory|\n|9|Does not do anything; just returns true. Previously contained an uninstall routine.|\n|10|Returns the registry path and driver file path|\n\n\n###### HIJACKING EXISTING DRIVERS\n\nThe installer will try to locate an existing driver service\nthat is inactive. The service found will usually be a\nlegitimate one that is disabled because it is no longer\nused or because it is set to start only on demand. The\ninstaller will drop the driver component using the\ncorresponding path of the service. It will overwrite the\nexisting driver if necessary. The hijacked service is then\nset to start automatically. This is how the malware is able\nto survive after a reboot. By doing this, the gang may be\nhoping that their malicious driver will be overlooked by\nadministrators or investigators who are so used to seeing\nthose legitimate services.\n\n\n###### TABLE 1: IOCTL BUFFER COMMAND CODES\n\n**Code** **Function**\n\n6 Loads a driver into memory\n\n9 Does not do anything; just returns true.\nPreviously contained an uninstall routine.\n\n10 Returns the registry path and driver file path\n\n###### DRIVER COMPONENT\n\nThe only component that will remain permanently on the\ninfected system will be the driver component. The driver\ncomponent used by the gang is a stripped down version\nof the BlackEnergy 2 driver.\n\nThe sole purpose of this driver component is to inject\nthe main DLL component into svchost.exe. Interestingly,\nit does not contain the rootkit functionalities for hiding\nprocesses, files and registry objects that is found in the\nusual BlackEnergy 2 drivers. The gang may have opted for\na ‘hide in plain sight’ approach to evade detections from\nrootkit scanners, such as GMER and RootkitRevealer, that\nchecks for system anomalies.\n\nThe driver component provides a IOCTL interface to\ncommunicate with the main DLL component. Table 1\n(above) summarizes the command codes that can be\npassed to the IOCTL buffer. The 32-bit version contains\nadditional, incomplete routines for hiding processes via\ndirect kernel object manipulation (DKOM) and managing\nBlackEnergy 2 rootkit rules in memory[ [2]].\n\n\n-----\n\n###### 10\n\n\n###### TABLE 2: TYPICAL BLACKENERGY DRIVER COMPONENT VERSUS QUEDAGH’S CUSTOM COMPONENT\n\n**Typical BlackEnergy 2** **Quedagh BlackEnergy 2**\n\nCreates a new service based on either Hijacks an existing legitimate service\na hardcoded or randomly generated\nname (depending on the installer)\n\nHides processes, files and registry Injects main DLL to svchost.exe\nobjects; Inject main DLL to svchost.exe\n\n32-bit driver component that contains 32-bit driver component with a lot of remnant routines in\ncomplete routines in its IOCTL its IOCTL interface, only a few of which make sense.\n\nAfter Nov 11, 2013, the 64-bit driver component is available\nand provides limited functionalities in IOCTL interface (only\nthose equivalent working routines found in the 32-bit versions)\n\n###### TABLE 3: COMMANDS SUPPORTED BY VARIANTS TARGETED AT UKRAINIAN ENTITIES\n\n|Col1|TABLE 2: TYPICAL BLACKE VERSUS QUEDAGH’S|ENERGY DRIVER COMPONENT S CUSTOM COMPONENT|\n|---|---|---|\n||Typical BlackEnergy 2|Quedagh BlackEnergy 2|\n|Launch Point|Creates a new service based on either a hardcoded or randomly generated name (depending on the installer)|Hijacks an existing legitimate service|\n|Role|Hides processes, files and registry objects; Inject main DLL to svchost.exe|Injects main DLL to svchost.exe|\n|Versions|32-bit driver component that contains complete routines in its IOCTL interface|32-bit driver component with a lot of remnant routines in its IOCTL interface, only a few of which make sense. After Nov 11, 2013, the 64-bit driver component is available and provides limited functionalities in IOCTL interface (only those equivalent working routines found in the 32-bit versions)|\n\n|Command|Description|\n|---|---|\n|rexec|Download and execute a binary|\n|lexec|Execute a shell command|\n|die|Uninstall|\n|getpl|Load a plugin|\n|turnoff|Quit (will start again after reboot)|\n|chprt|Add / remove / set active command and control server|\n\n\nBlackEnergy 2 was very well documented by Dell\nSecureWorks [[5]] in 2010. Table 2 (above) summarizes\nthe differences between the driver component used by\nQuedagh compared to the typical BlackEnergy 2.\n\n###### MAIN DLL COMPONENT\n\nThe core functionality of BlackEnergy 2 is found in the\nmain DLL component. This component is embedded inside\nthe driver component and is not found in the file system;\nthis is to reduce the infection footprint on the system.\n\nThe main DLL provides a robust framework for attackers\nto maintain a botnet that is not tied to any specific\nfunctionality. The malware is designed to be used by\nloading customized plugins depending on the purpose\nof the botmaster. It is mainly a framework for plugins\nto communicate with a central command and control.\nOtherwise, the main DLL only provides a minimal set of\ncommands. Table 3 (above) summarizes the commands\nsupported by the variants used in the attack against\nUkrainian government organizations.\n\n\nIn BlackEnergy 2, the main DLL component communicates\nwith its plugins via a defined set of API calls. It exports\na number of function calls, which can be used by the\nplugins. On the other hand, plugins are required to export\n2 functions to work. We highly recommend the research\nof Dell SecureWorks for those looking for more details\nregarding the BlackEnergy 2 plugin framework.\n\n###### BLACKENERGY 3\n\nIn contrast to previous variants, BlackEnergy 3 uses a\nsimpler installer component. It does not have a driver\ncomponent and the installer drops the main DLL\ncomponent directly to the local application data (nonroaming) folder. The installer then creates a LNK file in the\nstartup folder, using a filename generated based on the\nvolume serial number as a launch point. The LNK file is a\nshortcut to execute the main DLL using rundll32.exe.\n\n\n-----\n\n###### 11\n\n\n###### TABLE 4: X509_ASN FIELDS & EQUIVALENT TABLE 5: BLACKENERGY 3 BLACKENERGY 2 XML NODE COMMANDS\n\n|ID|BlackEnergy 2 Node|Description|\n|---|---|---|\n|1|servers|The command and control servers|\n|2|plugins|Plugins to be loaded|\n|3|cmds|Commands to be executed|\n|4|build id|Build ID|\n|5|sleepfreq|Phone home interval|\n\n|TAB|BLE 5: BLACKENERGY 3 COMMANDS|\n|---|---|\n|Command|Description|\n|delete|Uninstall|\n|ldplg|Load a plugin|\n|unlplg|Unload a plugin|\n|update|Update main DLL|\n|dexec|Download and execute an executable|\n|exec|Download and execute a binary|\n|updcfg|Update the configuration data|\n\n\nThis variant uses a new configuration format. The\nconfiguration data is a series of X509_ASN encoded values\nand are accessed by an ID number. Table 4 summarizes\nthe fields and their equivalent BlackEnergy 2 XML node,\nwhile table 5 lists the completely new set of commands\nused in this latest variant.\n\nBlackEnergy 3 also uses a different method of\ncommunication with its plugins, as it now communicates\nvia RPC over the named-pipe protocol (ncacn_np).\n\n###### INFORMATION-STEALING PLUGIN\n\nSince the main DLL component offers little clue as to what\nthe malware was used for, we need to look at the plugin to\ndetermine the objective of the gang.\n\nOne particular plugin that was used in the campaign was\ncalled “si”, perhaps to mean ‘steal information’. The latest\nsample we found will attempt to gather the following\ninformation and send them to the C&C server:\n\n  - System configuration information (gathered via\nsysteminfo.exe)\n\n - Operating system version\n\n  - Privileges\n\n - Current time\n\n - Up time\n\n - Idle Time\n\n - Proxy\n\n  - Installed apps (gathered from uninstall program\nregistry)\n\n  - Process list (gathered via tasklist.exe)\n\n  - IP configurations (gathered via ipconfig.exe)\n\n  - Network connections (gathered via netstat.exe)\n\n  - Routing tables (gathered via route.exe)\n\n  - Traceroute and Ping information to Google\n(gathered via tracert.exe and ping.exe)\n\n  - Registered mail, browser, and instant messaging\nli ( h d i li i )\n\n\n\n - Account and password information from The\nBat! email client (gathered from account.cfn and\naccount.cfg)\n\n  - Stored username and passwords in Mozilla\npassword manager of the following applications\n(gathered from signons*.txt and signons.sqlite)\n\n   - Thunderbird\n\n   - Firefox\n\n  - SeaMonkey\n\n  - IceDragon\n\n - Stored username and passwords in Google\nChrome password manager of the following\napplications (gathered from “Login Data”)\n\n  - Google Chrome\n\n  - Chromium\n\n  - Comodo Dragon\n\n  - Xpom\n\n  - Nichrome\n\n   - QIP Surf\n\n  - Torch\n\n   - YandexBrowser\n\n  - Opera\n\n   - Sleipnir\n\n - Account and password information from Outlook\nand Outlook Express\n\n  - Internet Explorer version and stored username\nand passwords\n\n - Stored username and passwords in Windows\nCredential Store\n\n   - Live\n\n  - Remote Desktop\n\n   - Other generic credentials (Microsoft_\nWinInet_*)\n\nThe nature of the information being gathered seems to\nbe generic rather than targeted. This may be because the\nmalware has roots from crimeware. The information is still\nuseful however as such data makes it easier for the gang\nto plan any further attacks on the same targets.\n\n\n-----\n\n###### 12\n\n\n###### DIAGRAM 3: CONFIGURATION DATA HANDLING\n\n\n###### 2 1 HTTP POST\n\nMAIN DLL\n\nConfig\n\nConfig\n\n\nC&C\nSERVER\n\n\nMain DLL process configuration data embedded\nin its body; will only process fields related to C&C\ncommunication. BlackEnergy 2 configuration may\nalso contain initial commands to execute.\n\nMain DLL reports to C&C.\n\nMain DLL processes the configuration data\nreturned by the C&C. This time, it processes\nfields related to plugins and commands.\n\n\n###### TABLE 6: MAIN DLL’S ADDITIONAL COMMANDS DURING DOWNLOAD OF ADDITIONAL FILES\n\n|HTTP POST Field|Description of Values|\n|---|---|\n|getp|The plugin name to be downloaded|\n|plv|Some variants specify the version of the plugin to be downloaded|\n|getpd|The binary name to be downloaded|\n\n\n###### NETWORK TRAFFIC\n\nBlackEnergy communicates with its C&C server via HTTP\nPOST requests. For the BlackEnergy 2 samples used by the\ngang, the request contains the following fields:\n\n###### id=[bot_id]&bid=[base64_encoded_build_ id]&dv=[x]&mv=[y]&dpv=[z]\n\nWhere:\n\n  - bot_id is equivalent to the infected host name\nand the volume serial number following the\nformat x[host_name]_[serial_no] (e.g. xJOEPC_484DA98A)\n\n  - build_id is the string found in the build_id field in\nthe sample’s configuration data\n\n  - x, y, z are hardcoded values which varies among\nsamples\n\nThe fields are almost the same for BlackEnergy 3 samples:\n\n###### id=[bot_id_sha1]&bid=[base64_encoded_build_ id]&nm=[x]&cn=[y]&num=[z]\n\nThe only major difference is that the id field contain just\nthe hash instead of the actual string. The actual bot_id\nstring in which the id hash is derived is also a bit different;\nit now uses the format [domain_sid]_[host_name]_\n\n[serial_no].\n\n\nThe response of the command and control server will\nbe encrypted using the id field in the POST request as\nthe key. After the response is decrypted, it will be in the\nform of the corresponding configuration data of the\nBlackEnergy sample; for example, BlackEnergy 2 samples\nexpect the decrypted response to be a XML document,\nwhile BlackEnergy 3 samples expect the decrypted\nresponse to be a series X509_ASN encoded values.\n\nThe decrypted response, which is equivalent to another\nconfiguration data, will be processed similar to the initial\nconfiguration data embedded in the main DLL; the only\ndifferences are the data fields that are processed. This\ncycle is illustrated in diagram 3 (above).\n\nThe main DLL also uses the fields listed in table 6 (above)\nwhen it needs to download additional files.\n\n\n-----\n\n###### 13\n\n\n##### CONCLUSIONS\n\nBlackEnergy is a toolkit that has been used for years\nby various criminal outfits. In the summer of 2014, we\nnoted that certain samples of BlackEnergy malware\nbegan targeting Ukranian government organizations for\ninformation harvesting. These samples were identified as\nbeing the work of one group, referred to in this document\nas “Quedagh”, which has a history of targeting political\norganizations. Though inconclusive, suggestive details\nindicate that BlackEnergy malware, possibly also from this\ngang, may also have been used in the Russo-Georgian\nconfrontation in 2008.\n\nThe Quedagh-customizations to the BlackEnergy malware\ninclude support for proxy servers (which, in the samples\nexamined are associated with Ukrainian entities) and\nuse of techniques to bypass User Account Control and\ndriver signing features in 64-bit Windows systems. While\nmonitoring BlackEnergy samples, we also encountered a\nnew variant, which we dub BlackEnergy 3, with a modified\nconfiguration, no driver component and a different\ninstallation procedure.\n\nThe use of BlackEnergy for a politically-oriented attack\nis an intriguing convergence of criminal activity and\nespionage. As the kit is being used by multiple groups, it\nprovides a greater measure of plausible deniability than is\nafforded by a custom-made piece of code.\n\n\n.REFERENCES\n1. Wikipedia; Proxy server; http://en.wikipedia.org/wiki/Proxy_server#Cross-domain_resources\n\n2. Broderick Aquilino; F-Secure Weblog; BlackEnergy Rootkit, Sort Of; 13 June 2014;\nhttp://www.f-secure.com/weblog/archives/00002715.html\n\n3. Broderick Aquilino; F-Secure Weblog; Beware BlackEnergy If Involved In Europe/Ukraine Diplomacy; 30 June 2014;\nhttp://www.f-secure.com/weblog/archives/00002721.html\n\n4. Kafeine; Malware don’t need Coffee; BotnetKernel (MS:Win32/Phdet.S) an evolution of BlackEnergy ; 21 June 2014;\nhttp://malware.dontneedcoffee.com/2014/06/botnetkernel.html\n\n5. Joe Stewart; DELL SecureWorks; BlackEnergy Version 2 Analysis; 3 March 2010;\nhttp://www.secureworks.com/cyber-threat-intelligence/threats/blackenergy2/\n\n\n-----\n\n###### 14\n\n\n##### APPENDIX A | SAMPLES\n\n|SHA1|Description|\n|---|---|\n|26b9816b3f9e2f350cc92ef4c30a097c6fec7798|Main reference for related BlackEnergy 2 32-bit driver and main DLL component analysis|\n|bf9937489cb268f974d3527e877575b4fbb07cb0|Main reference for related BlackEnergy 2 64-bit driver (signed on 2013-12-25) and installer analysis. Basis for the start of the Ukrainian target.|\n|78636f7bbd52ea80d79b4e2a7882403092bbb02d|Main reference for related BlackEnergy 3 analysis|\n|bf9172e87e9264d1cddfc36cbaa74402bb405708|Main reference for related si plugin analysis|\n|441cfbaba1dfd58ce03792ef74d183529e8e0104|Stand-alone non-persistent BlackEnergy 2 sample|\n|f7d4aa90b76646f4a011585eb43b9d13c60f48eb|Trojanized Juniper installer containing related BlackEnergy 2|\n|8ccd2962bce8985d0794daed6e0bf73e5557cfe8|Trojanized Adobe Bootstrapper containing related BlackEnergy 2. This means that it is highly probable that there is a trojanized Adobe package out there.|\n|d496f99f7e07d5cbbd177a9d43febe8fb87ebc3b|Related RTF document containing exploit|\n|cc71aa8f919911676fb5d775c81afc682e6e3dd3|Related BlackEnergy 2 binary containing strings that are political in nature|\n|abab02d663872bcdbe2e008441fcd7157c0eb52d|Oldest (compiled on 2010-12-14) related BlackEnergy 2 installer that was found|\n|e5c8c10b10ee288512d3a7c79ae1249b57857d23|Oldest (compiled on 2013-04-09) related BlackEnergy 2 installer that bypass UAC that was found|\n|8743c8994cc1e8219697394b5cb494efa7dad796|Oldest (signed on 2013-11-14) related BlackEnergy 2 64-bit driver that was found|\n|285b3252a878d1c633ea988153bbc23c148dd630|Oldest (compiled on 2014-05-12) related BlackEnergy 3 dropper that was found|\n\n\n-----\n\n###### 15\n\n\n###### PAGE INTENTIONALLY LEFT BLANK\n\n\n-----\n\n# SWITCH  ON  FREEDOM\n\nF-Secure is an online security and privacy company from Finland. We\n\n**F-Secure is an online security and privacy company from Finland. offer millions of people around the globe the power to surf invisibly**\n**We offer millions of people around the globe the power to surf and store and share stuff, safe from online threats.**\n**invisibly and store and share stuff, safe from online threats.**\n\nWe are here to fight for digital freedom.\n\n**We are here to fight for digital freedom.**\n\nJoin the movement and switch on freedom.\n\n**Join the movement and switch on freedom.**\n\nFounded in 1988, F-Secure is listed on NASDAQ OMX Helsinki Ltd.\n\n**Founded in 1988, F-Secure is listed on NASDAQ OMX Helsinki Ltd.**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        },
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        },
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://blog-assets.f-secure.com/wp-content/uploads/2019/10/15163408/BlackEnergy_Quedagh.pdf",
        "https://app.box.com/s/ccj81xcg1xunuyjmnb3kt3ug77r16z7q",
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2014/2014.09.26.BlackEnergy_Quedagh/blackenergy_whitepaper.pdf"
    ],
    "report_names": [
        "BlackEnergy_Quedagh.pdf",
        "blackenergy_whitepaper"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7bd810cb-d674-4763-86eb-2cc182d24ea0",
            "created_at": "2022-10-25T16:07:24.1537Z",
            "updated_at": "2025-03-27T02:02:10.126127Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "APT 44",
                "ATK 14",
                "BE2",
                "Blue Echidna",
                "CTG-7263",
                "FROZENBARENTS",
                "IRIDIUM",
                "Iron Viking",
                "Quedagh",
                "Sandworm",
                "Sandworm Team",
                "Seashell Blizzard",
                "TEMP.Noble",
                "UAC-0082",
                "UAC-0113",
                "UAC-0125",
                "UAC-0133",
                "Voodoo Bear"
            ],
            "source_name": "ETDA:Sandworm Team",
            "tools": [
                "AWFULSHRED",
                "ArguePatch",
                "BIASBOAT",
                "Black Energy",
                "BlackEnergy",
                "CaddyWiper",
                "Colibri Loader",
                "Cyclops Blink",
                "CyclopsBlink",
                "DCRat",
                "DarkCrystal RAT",
                "Fobushell",
                "GOSSIPFLOW",
                "Gcat",
                "IcyWell",
                "Industroyer2",
                "JaguarBlade",
                "JuicyPotato",
                "Kapeka",
                "KillDisk.NCX",
                "LOADGRIP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "ORCSHRED",
                "P.A.S.",
                "PassKillDisk",
                "Pitvotnacci",
                "PsList",
                "QUEUESEED",
                "RansomBoggs",
                "RottenPotato",
                "SOLOSHRED",
                "SwiftSlicer",
                "VPNFilter",
                "Warzone",
                "Warzone RAT",
                "Weevly"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716493,
    "ts_updated_at": 1743041825,
    "ts_creation_date": 1411575473,
    "ts_modification_date": 1411575477,
    "files": {
        "pdf": "https://archive.orkl.eu/efd7b3a3a2bf6e3976411347dc9101fea70c9405.pdf",
        "text": "https://archive.orkl.eu/efd7b3a3a2bf6e3976411347dc9101fea70c9405.txt",
        "img": "https://archive.orkl.eu/efd7b3a3a2bf6e3976411347dc9101fea70c9405.jpg"
    }
}