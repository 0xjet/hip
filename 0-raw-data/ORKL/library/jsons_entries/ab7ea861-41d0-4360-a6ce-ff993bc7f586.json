{
    "id": "ab7ea861-41d0-4360-a6ce-ff993bc7f586",
    "created_at": "2023-01-12T15:10:31.258737Z",
    "updated_at": "2025-03-27T02:05:35.004017Z",
    "deleted_at": null,
    "sha1_hash": "9ba593a5b1e31b2d8dced966233b68171c3646cf",
    "title": "2021-11-17 - BrazKing Android Malware Upgraded and Targeting Brazilian Banks",
    "authors": "",
    "file_creation_date": "2022-05-28T21:49:16Z",
    "file_modification_date": "2022-05-28T21:49:16Z",
    "file_size": 2305272,
    "plain_text": "# BrazKing Android Malware Upgraded and Targeting Brazilian Banks\n\n**[securityintelligence.com/posts/brazking-android-malware-upgraded-targeting-brazilian-banks/](https://securityintelligence.com/posts/brazking-android-malware-upgraded-targeting-brazilian-banks/)**\n\n[Application Security November 17, 2021](https://securityintelligence.com/category/topics/app-security/)\nBy [Shahar Tavor 12 min read](https://securityintelligence.com/author/shahar-tavor/)\n_Nethanella Messer and James Kilner contributed to the technical editing of this blog._\n\nIBM Trusteer researchers continually analyze financial fraud attacks in the online realms. In recent research into mobile\n[banking malware, we delved into the BrazKing malware’s inner workings following a sample found by MalwareHunterTeam.](https://twitter.com/malwrhunterteam/status/1377563398775447555)\nBrazKing is an Android banking Trojan from the RAT category. It mostly targets mobile banking users in Brazil and is likely\noperated by a local threat group.\n\n\n-----\n\nThis post provides our findings about BrazKing s new version with insights about its dynamic mechanisms and the features\nthat help cyber criminals use it in mobile banking fraud. As this post is written, we are seeing that BrazKing is an ongoing\ndevelopment and believe there will be more to come in the near future.\n\n## New BrazKing With Added Agility\n\n[With a new version in the wild, we set out to look at what changed for BrazKing since the last version. It turns out that its](http://10.10.0.46/ttps://research.checkpoint.com/2021/pixstealer-a-new-wave-of-android-banking-trojans-abusing-accessibility-services)\ndevelopers have been working on making the malware more agile than before, moving its core overlay mechanism to pull\nfake overlay screens from the command and control (C2) server in real time.\n\n[In the previous version, BrazKing abused the accessibility service to detect which app the user opened. When the malware](https://securityintelligence.com/news/new-android-malware-channels-malicious-activity-through-accessibility-services/)\ndetected the launch of a targeted banking app, it used to pull an overlay screen from a hardcoded URL and present it on top\nof the legitimate app. Now, it automates a call to the attacker’s server, requesting those matches on the fly. The detection of\nwhich app is being opened, is now done server side, and the malware regularly sends on-screen content to the C2.\nCredential grabbing is then activated from the C2 server, and not by an automatic command from the malware.\n\nThe agility that’s added here is that the attacker can choose the next action or avoid one according to information on the\nvictim’s IP (Brazilian/other), or whether the malware is being run on an emulator. They can modify what’s sent back. They can\nadjust the target list at all times without modifying the malware itself.\n\nThis is a tactic that we have seen when desktop banking Trojans started delivering their configurations and web injections in\nthe same manner. Android Trojans do that as well, and BrazKing’s developer has implemented that change in the version we\nanalyzed.\n\n_Figure 1: BrazKing targets have a matching overlay the C2 can send and display on over legitimate apps_\n\n## Same Overlay, but Different\n\nAnother point we observed in BrazKing is the way the same overlay concept from other malware is being implemented with a\ntwist.\n\nClassic overlay malware on Android devices overlays a fake screen on top of the original banking apps. To display that fake\noverlay on another running app, the malware must have the user approve a permission\n‘android.permission.SYSTEM_ALERT_WINDOW’. Malware can also approve that permission without user interaction by\n[abusing the Android accessibility service.](https://developer.android.com/reference/android/accessibilityservice/AccessibilityService)\n\nWe noted that while BrazKing now works without the SYSTEM_ALERT_WINDOW permission, which allows BrazKing to be\nmore elusive and arouse less suspicion, it remains in its manifest.\n\nWhen BrazKing displays its overlay screen it loads the fake screen’s URL from the C2 to a webview in a window. Android\nSystem webview allows users to open links within apps they are using without having to leave the app. BrazKing uses\n[TYPE_ACCESSIBILITY_OVERLAY as the type of window when adding the webview from within the accessibility service.](https://developer.android.com/reference/android/view/WindowManager.LayoutParams#TYPE_ACCESSIBILITY_OVERLAY)\nThis overlay window is then shown on screen—covering the original app and even screens like the ‘Settings’ menu window.\n\n\n-----\n\n_Figure 2: BrazKing overlay techniques keep it stealthier – 0x7F0 is hex code for TYPE_ACCESSIBLITY_OVERLAY flag_\n\nBehind the scenes, when displaying the overlay screen to the user, BrazKing can intercept the views in the background, tap\nbuttons and even enter text in Android textviews while the legitimate app is covered with a fake overlay.\n\n## No Permissions, No Problem\n\nAsking for very few permissions might make BrazKing look less harmful, and the small number of permissions that it does ask\nfor are not categorized as dangerous to approve. BrazKing manages to work with a rather limited list of permissions, but what\nit lacks in permissions, it makes up for in Accessibility Service abuse. It utilizes all the capabilities of the accessibility service.\n\nLet’s examine what it can do with only the accessibility service:\n\nDissect the screen programmatically instead of taking screenshots in picture format. This can be done programmatically\nbut on a non-rooted device that would require explicit approval of the user.\nKeylogger capabilities by reading the views on the screen.\nRAT capabilities—BrazKing can manipulate the target banking application by tapping buttons or keying text in.\nRead SMS without the ‘android.permission.READ_SMS’ permission by reading text messages that appear on screen.\nRead contact lists without ‘android.permission.READ_CONTACTS’ permission by reading the contacts on the\n“Contacts” screen.\n\nThere are also permissions that were dropped since the previous version. For example,\n‘android.permission.BIND_DEVICE_ADMIN’ is no longer used in the new version. That permission was previously used to\nallow the attacker to lock the device and hide malicious activity from the user. With the overlay covering the entire screen, this\nsuspicious permission is no longer required.\n\nDropping risky permissions is an advantage to the malware as it is less likely to be flagged by automated controls.\n\n## BrazKing’s Infection Routine\n\nThe following sections give a technical rundown of BrazKing’s infections routine per our analysis of the current version of this\nmalware.\n\n## Initial Download\n\nThe initial infection vector is a phishing message with a URL that leads to a website claiming the device is about to be\nblocked due to a supposed lack of security. It requires the user to ‘update’ the operating system by tapping a button on the\npage. The site uses HTTPS, making it appear more credible.\n\n\n-----\n\n_Figure 3: BrazKing starts off with a social engineering message_\n\nTapping the button launches the download of BrazKing. The app is downloaded via the browser, and then installed by the\npackage manager. To make that happen, the user does have to approve the download of apps from unknown sources. After\nthe initial download, the malware attempts to have the user approve permissions under the guise of a Google requirement.\n\n## Requesting Access to the Accessibility Service\n\nAccessibility Services are what allows malware like BrazKing to forego permissions. It requests access to this service in order\nto activate the ability to capture the screen and keystrokes that it will later send to the C2. It also uses it to detect running\nbanking apps that would be of interest to its operators.\n\nThe request for access takes place during the first run of BrazKing on a newly infected device. To trick the user to approve\nthe request, the malware impersonates a Google update, or a service as shown below.\n\n_Figure 4: BrazKing asking for Accessibility Service access_\n\n## First Run – New Bot Registration\n\nOnce the user accepts the accessibility service request, the malware starts running in the background. Most users would see\nthat as going back to normal In versions of Android 10 and below the malware’s app icon disappears from the screen\n\n\n-----\n\nBrazKing s activity commences as it sends a request to the C2 server, registering a new infected bot to the botnet. It sends\nover the following details:\n\nDevice data:\n\nBUILD version\nDevice name\nOS version\nDevice manufacturer\nAndroid ID. This ID is used as a bot identifier dubbed ‘hwid’. Android IDs are a 64-bit number (expressed as a\nhexadecimal string), unique to each combination of app-signing key, user and device.\nList of apps installed on the device (removed in some versions, added in others).\nDisplay properties: height, width.\n\n_Figure 5: BrazKing sends new bot info to C2 server_\n\nOnce the bot has been registered, BrazKing is ready and listening for commands from the C2 server.\n\nTrusteer researchers often encounter malware that tests whether it is running in a testing environment, such as an emulator,\nand if so, stops running. We have not observed such checks in BrazKing’s code, but we did notice that the list of device\ndetails it sends to the C2 will differ when it’s run in an emulator as compared to running on a physical device. We conclude\nthat blocking research devices might be possible via BrazKing’s server-side code.\n\n## Remove-Me-Not\n\nPersistence is a malware must-have, and BrazKing’s developers do not want to see it easily removed. To prevent deletion,\nthe malware takes over when the user attempts to remove it. With accessibility service monitoring, BrazKing is programmed\nto notice when the user is opening the uninstall screen. Should the user attempt to restore the device to manufactory settings,\nBrazKing would quickly tap the ‘Back’ and ‘Home’ buttons faster than a human could, preventing them from removing the\nmalware in that manner.\n\nThe same tactic is used when users attempt to interact with antivirus apps, returning them to the home screen if they attempt\nto launch an app to run a scan or quarantine malware.\n\n## BrazKing’s New Obfuscation Techniques\n\nBrazKing uses string obfuscation to keep its resources protected. It applies a XOR operation with a constant key that’s\nhardcoded into the malware binary. Then it also encodes with Base64. By using a constant key inside the sample, the\nobfuscation can be easily reversed.\n\n\n-----\n\n_Figure 6: BrazKing s obfuscated strings_\n\nAfter de-obfuscating the strings, we were able to see their content, which matches with device information BrazKing sends\nover to its operators.\n\n_Figure 7: BrazKing’s strings – De-obfuscated_\n\n## Ongoing C2 Communications\n\nTo communicate with the attacker’s server during its ongoing operations, BrazKing uses the WebSocket protocol. WebSocket\ndiffers from the more typical HTTP, which is often used by financial malware. Rather than looking at a series of requests and\nresponses, like HTTP requires, WebSocket works as a bidirectional messaging protocol. The WebSocket handshake uses\nthe HTTP upgrade header to switch from the HTTP protocol to the WebSocket protocol and BrazKing queues task threads.\nEach thread executes a different task sent from the C2.\n\n[We have seen the WebSocket protocol choice previously used by other malware operators in Brazil.](https://securitynews.sonicwall.com/xmlpost/android-brazilian-banker-with-spyware-phishing-and-ransomware-components/)\n\nBrazKing’s list of commands appears below:\n\nCommand name Description\n\nconnect Registers a new bot in the C2 server.\n\nalertaMsg Shows a message (‘Toast’) on screen with text that the C2 chooses.\n\nunflackjack In previous versions this command starts an application that the C2 chooses from apps installed on the\ndevice.\n\nSETA_STR Edits configuration information.\n\nconfirmau Opens the browser with a URL that the C2 chooses.\n\nabreofilho In the new version, this command starts an application that the C2 chooses from apps installed on the\ndevice.\n\nABRE_AP Adds audible feedback to the malware’s accessibility service.\n\nABRE_TRAVA Shows a webview with an overlay screen.\n\nFECHA_TRAVA Removes the overlay screen.\n\nND_HOME Clicks the Home button on the device.\n\nND_BACK Clicks the Back button on the device.\n\nND_RECENTES Clicks the Recent button on the device.\n\nquem_ta_on Sends the current configuration to the C2. (From shared preference)\n\npediu_img Sends the current screen dissection to the C2.\n\nND_GESTO Performs a gesture on the screen at the location that the C2 sends.\n\nND_TEXTO Enters text in the current textview (textbox) with text that the C2 sends.\n\n\n-----\n\nCommand name Description\n\nND_DESENHO Performs a gesture on the screen at the coordinates that the C2 sends.\n\n## BrazKing’s Fraud Enabling Features\n\nBrazKing’s goal is to help its operators initiate and complete fraudulent transactions from infected user devices. To do that, it\nleverages a few core capabilities:\n\nInput injection – allowing the fraudster to interact with running apps on the device.\nScreen dissection – providing the attacker with insights as to what the user sees on their screen.\nKeylogging – helping attackers grab credentials from the device.\nFake overlay screens – allowing BrazKing to trick users into sharing credentials, and also blocking them from interacting\nwith the legitimate app they intended to use.\n\nEach of these features is described in more detail below. We will follow the technical details with an explanation of BrazKing’s\nfraud modus operandi.\n\n## Input Injection\n\nAs its name suggests, this feature allows BrazKing to interact with apps as if they were the device’s owner. Abusing Android’s\nAccessibility Service, the malware can tap buttons, select options, enter text and perform other actions on behalf of the user.\nThis process is assisted by the attacker from the C2 server, enabling them to choose which views BrazKing will click on or\nwhat text it might tap, thereby controlling what information is sent through to the bank’s server during a transaction.\n\n_Figure 8: BrazKing’s text injection function_\n\n## Screen Dissection\n\nVia the C2, the attacker can send a command to the malware asking to see what the user is viewing at the time. In response,\nBrazKing will send the following details:\n\nBot ID\nView type: is it a text box? Are there buttons?\nIs there clickable content that’s visible to the user?\nWidth and height of the view?\nWhat’s the text shown on the view?\nThe package name of the application that’s currently running on screen.\n\nIn previous versions, this command was pushed manually. In the new version, the malware sends the details to the C2 on\nrepeat.\n\nUsing the information from BrazKing, the fraudster can understand what the victim is viewing on screen and use this insight to\nplan a fraudulent transaction.\n\n## Keylogging\n\nAbusing the Android Accessibility Service again, BrazKing is able to captures all user keystrokes.\n\n\n-----\n\nWhen text on a text box is modified/entered by the user, the event triggers the Accessibility Service, which in turn triggers\nBrazKing. This allows the malware to obtain the text in the textbox and send it to the C2. Examples of such text can be a URL\nin the web browser, a text message or a password field.\n\n_Figure 9: Looking for on-screen text and grabbing passwords_\n\nThe ‘Kly’ string indicates that the data sent to C2 was collected by the keylogger module.\n\nIf BrazKing detects that a password is being entered by the user, the malware captures each letter of the password\nseparately, since on a text field only the last entered character is visible to the user and all other characters are displayed as\nasterisks. The malware saves each letter and ignores the asterisk characters. All the keystrokes are sent to the C2 from the\nconfiguration file.\n\n\n-----\n\n_Figure 10: BrazKing saves passwords by character, then sends them to a C2 server alongside device data_\n\n## Fake Overlay Screens\n\nBrazKing uses two typical fake overlay images. One interacts with the infected user, asking for their payment card’s PIN\nnumber. The other image keeps them waiting, unable to continue to interact with the app they originally opened.\n\n_Figure 11: BrazKing’s social engineering overlays_\n\n## App List No Longer Required\n\n\n-----\n\nMost banking Trojans that target Android users ask to have the list of installed apps sent to their operators. BrazKing used to\nalso fetch that list by using the ‘getinstalledpackages’ API. This is a common malware request, but as of Android version 11\n(SKD 30) Google views the app list as sensitive information. They now require apps to query what they need from the overall\nlist, and the complete list is thus filtered.\n\n[To get the entire list, the malware would have to declare android.permission.QUERY_ALL_PACKAGES or ‘Query’ element in](https://developer.android.com/training/package-visibility/declaring)\nthe manifest.\n\nBrazKing avoids hoarding permissions, so it has removed this ask, and instead relies on the screen dissection feature to view\nwhat apps the user might be looking at.\n\n_Figure 12: BrazKing’s target list exposed in some of the versions we analyzed_\n\n## BrazKing’s Fraud Techniques\n\nBrazKing does not automate fraud on infected devices; that activity is controlled through the C2 server. The malware’s\noperators are likely tailoring the attack to each bank. Therefore, according to our analysis, there can be several attack\nscenarios that BrazKing operators can tailor according to security controls used by different banks. Those can be altered with\nrelative ease.\n\n## Opening the Banking App\n\n**Scenario A**\n\nThe C2 sends a command to the malware to show a message on screen and lure the user to open the banking application.\n\n**Scenario B**\n\nThe C2 sends a command to the malware to open the banking app.\n\n## Fraud M.O.\n\nAfter the banking app opens, the malware subsequently allows the attacker to log keystrokes, extract the password, take\nover, initiate a transaction, and grab other transaction authorization details to complete it.\n\n## Lock & Delay\n\nThe malware is capable of locking the phone’s screen and presenting the user with a delay screen.\n\n\n-----\n\n## Stealing 2FA Codes\n\n**Scenario A**\n\nWhen the user receives an SMS-based transaction authorization challenge from the bank, BrazKing can display a fake PIN\ncode on screen to the user, all while the attacker can use the stolen code to complete the fraudulent transaction.\n\n**Scenario B**\n\nBrazKing can use its keylogging feature to steal SMS-based two-factor authentication (2FA).\n\n## Mobile Banking Malware Prevalent in the Fraud Arena\n\nMajor desktop banking Trojans have long abandoned the consumer banking realms for bigger bounties in BEC fraud,\n[ransomware attacks and high-value individual heists. This, together with the ongoing trend of online banking transitioning to](https://www.forbes.com/sites/thomasbrewster/2021/10/14/huge-bank-fraud-uses-deep-fake-voice-tech-to-steal-millions/)\nmobile, caused a void in the underground cybercrime arena to be filled by mobile banking malware.\n\nThese one-stop-shop codes are simpler to operate, easier to obtain and can facilitate the complete fraud cycle by being\nresident on what was previously an out-of-band device — the smartphone. The access to 2FA codes at the same place\nwhere credentials are obtained is pivotal, and helps fraudsters continue to profit from mobile malware, mostly on Android\ndevices.\n\nIndicators of compromise from the BrazKing versions we analyzed appear below. If you would like to keep up to date on IBM\n[Trusteer research, please check out: securityintelligence.com/category/x-force. For more about IBM Trusteer and the ways](https://securityintelligence.com/category/x-force)\n[we help customers mitigate the risk and losses of fraud, please visit: www.ibm.com/security/fraud-protection/trusteer](https://www.ibm.com/security/fraud-protection/trusteer)\n\n## IOCs\n\n\nPackage name Application\nname\n\ncom.gkoiyz.prof Google\nService\n\n\nAPK Hash (SHA256)\n\nd5bd93943a5433a4da132a8eab5dd14c0b5c320a40b1209812bc2c957fe6d090\n\n\nbr.EMyO.ImBd GService 7774d7d0cb3635886f030cb55b51627fd02b25fcaf00c2d1d8d7c5533351f16a\n\nbr.WsLK.aXzD GService a00f8137fa6a89c5de8674a23e39bf2933fd76d8639f8ecef7948158bb61a907\n\ncom.netsonicsolutions.gservice GService 2683b19c5d0001b22bd7e455d96cb2b92eb4d5d6c9c2b89cc87be6365a75e0f7\n\ncom.cuteu.videochat GService 9cdffc731d56a20d44923e098423dc9a8a2add3a2a19833daae107a3e2ed2eda\n\n[Shahar Tavor](https://securityintelligence.com/author/shahar-tavor/)\nMobile Security Researcher, IBM\n\nMobile security researcher at IBM Security Trusteer group. Shahar is passionate about malware research, mobile security,\nreverse engineering and Android inte...\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-17 - BrazKing Android Malware Upgraded and Targeting Brazilian Banks.pdf"
    ],
    "report_names": [
        "2021-11-17 - BrazKing Android Malware Upgraded and Targeting Brazilian Banks.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536231,
    "ts_updated_at": 1743041135,
    "ts_creation_date": 1653774556,
    "ts_modification_date": 1653774556,
    "files": {
        "pdf": "https://archive.orkl.eu/9ba593a5b1e31b2d8dced966233b68171c3646cf.pdf",
        "text": "https://archive.orkl.eu/9ba593a5b1e31b2d8dced966233b68171c3646cf.txt",
        "img": "https://archive.orkl.eu/9ba593a5b1e31b2d8dced966233b68171c3646cf.jpg"
    }
}