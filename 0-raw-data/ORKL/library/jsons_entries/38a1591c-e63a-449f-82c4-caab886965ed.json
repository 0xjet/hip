{
    "id": "38a1591c-e63a-449f-82c4-caab886965ed",
    "created_at": "2023-01-12T15:07:49.198492Z",
    "updated_at": "2025-03-27T02:06:10.66288Z",
    "deleted_at": null,
    "sha1_hash": "9bbef3ee006dbce21bcc9275cff3b78a54c0cc62",
    "title": "2021-07-26 - Detecting XLoader - A macOS ‘Malware-as-a-Service’ Info Stealer and Keylogger",
    "authors": "",
    "file_creation_date": "2022-05-28T19:56:08Z",
    "file_modification_date": "2022-05-28T19:56:08Z",
    "file_size": 3252294,
    "plain_text": "# Detecting XLoader | A macOS ‘Malware-as-a-Service’ Info Stealer and Keylogger\n\n**[sentinelone.com/blog/detecting-xloader-a-macos-malware-as-a-service-info-stealer-and-keylogger/](https://www.sentinelone.com/blog/detecting-xloader-a-macos-malware-as-a-service-info-stealer-and-keylogger/)**\n\nJuly 26, 2021\n\nThreat actors have come to recognize the reality that today’s organizations operate fleets of\ndevices encompassing all the major OS vendors – Apple, Microsoft, Google and many\nflavors of Linux – and are adapting accordingly. Threats that can be compiled on one\nplatform but produce executables targeting many are a productivity boon to criminals, who\nnow operate in an increasingly competitive environment trying to sell their wares.\n\nThe latest such threat to come to attention is XLoader, a Malware-as-a-Service info stealer\n[and keylogger that researchers say was developed out of the ashes of FormBook. Unlike its](https://research.checkpoint.com/2021/top-prevalent-malware-with-a-thousand-campaigns-migrates-to-macos/)\nWindows-only predecessor, XLoader targets both Windows and macOS. In this post, we take\nan initial look at the macOS version of XLoader, describe its behavior and show how\nXLoader can be detected on Apple’s Mac platform.\n\n\n-----\n\n## XLoader for Mac – Java Runtime For the Steal\n\nThe macOS sample we analyzed comes as both a standalone binary and as a compiled\n```\n.jar file. The .jar file appears to be distributed as an attachment in a phishing lure,\n\n```\nsuch as in this document `Statement SKBMT 09818.jar .`\n\nXLoader is likely distributed by mail spam\nSuch files require the Java Runtime Environment, and for that reason the malicious `.jar`\nfile will not execute on a macOS install out of the box, since Apple stopped shipping JRE\nwith Macs over a decade ago.\n\nNonetheless, Java is still a common requirement in enterprise environments and is still in\nuse for some banking applications. As a result, many organizations will have users that\neither do or must install the Oracle version of Java to meet these needs. As a 3rd party\nplugin, the Oracle JRE is installed at `/Library/Internet Plug-`\n```\nIns/JavaAppletPlugin.plugin .\n\n```\n\n-----\n\nWhen the malware is executed as a `.jar file, the execution chain begins with the OS-`\nprovided JavaLauncher at `/System/Library/CoreServices/JavaLauncher.app .`\n\nXLoader’s execution chain begins with the JavaLauncher\nThe JavaLauncher is also populated in the Accessibility pane in System Preferences’\n**Privacy tab and a dialog is popped requesting the user to grant access for automation. As**\nwe shall see below, this is likely leveraged as part of the info stealer’s functionality.\n\nThe JavaLauncher requests access to control other applications\nThe `com.oracle.JavaInstaller will also populate the ‘Full Disk Access’ table in the`\nsame tab. This remains unchecked by default and, at least on our test, no dialog was\npresented to the user to request permissions.\n\n## XLoader Behavior on macOS\n\n\n-----\n\nOn execution the malware drops a 32×32 pixel Windows image file in the user s home\ndirectory called `NVFFY.ico .`\n\nA Windows icon file is dropped in the user’s home folder\nThe user’s default image viewer – typically the built-in Preview.app – will be launched to\ndisplay this image. At this point, one could imagine that even the most unsuspecting user\nopening the ‘Statement SKBT’ file is going to think that something is amiss.\n\nThe .ico file as presented to the victim\nIt’s unclear what the malware authors were thinking here: perhaps the sample is an early\ndevelopment or a test sample. Alternatively, this may be a reflection of the hazards of crossplatform malware, where the author’s assumptions on the Windows platform were not fully\n\n\n-----\n\ntested on a macOS device.\n\nIn any case, no interaction is required from the user and the malware continues to drop and\n[execute the rest of its components. This involves dropping and executing a Mach-O file in](https://go.sentinelone.com/rs/327-MNM-087/images/reverse_mw_final_9.pdf)\nthe user’s Home folder. This file, `kIbwf02l, writes a hidden application bundle, also`\nlocated in the victim’s Home folder, and containing a copy of itself. It then writes and loads a\nuser LaunchAgent with a program argument pointing to the copy in the hidden app bundle.\nFrom then on, the `kIbwF02l file appears to be redundant but is not cleaned up by the`\nmalware.\n\nExample of an XLoader LaunchAgent\nThe label for the LaunchAgent and the names of the hidden app and executable are all\nrandomized and vary from execution to execution. The binary is passed the argument\n```\nstart as a launch parameter.\n\n```\nThe hidden application is itself a barebones bundle containing only the Info.plist and the\nMach-O executable.\n\nXLoader’s hidden application bundle\nA copy of the same executable, sans bundle and with the filename `kIbwf02l, is also`\ndropped in the User’s home directory.\n\n\n-----\n\n## Analysis of the XLoader Mach-O\n\nThe compiled Mach-O executable pointed to by the persistence agent is heavily stripped and\nobfuscated. As the image below indicates, static analysis using tools like strings will show\nlittle, and dynamic analysis is complicated by a number of anti-debugging features.\n\nLeft: the hidden app’s Info.plist. Right: strings and symbols in the executables\n[For the purposes of quick triage, we extracted the stackstrings from the Mach-O using](https://www.sentinelone.com/blog/macos-security-updates-part-2-running-diffs-on-apples-mrt-app/) [otool](https://www.sentinelone.com/blog/how-to-reverse-macos-malware-part-two/)\nto get an initial idea of the info stealer’s functionality. With further processing either manually\nor with [radare2, we can match these strings to particular functions.](https://rada.re/n/)\n\n\n-----\n\nStack strings found in XLoader’s macOS version\nThe strings here show that XLoader attempts to steal credentials from Chrome and Firefox\nbrowsers. We also see an indication that the malware calls the `NSWorkspace API to identify`\nthe front window via the Accessibility API `AXTitleFocusedWindow and leverages`\n```\nNSPasteboard, likely to copy information from the window of the user’s currently active\n\n```\nprocess. Calling Accessibility APIs requires user consent as this functionality is controlled by\nTCC. As noted above, the JavaLauncher has such permissions.\n\nOther researchers have suggested that XLoader’s internet traffic is laden with decoys to\ndisguise the actual C2 used to transmit data. As we did not observe any credential stealing\ntraffic in our test, we cannot confirm that suspicion, but XLoader’s internet traffic is certainly\n‘noisy’. We observed the malware reaching out to a variety of known phishing and malware\nsites.\n\nSome of the IP addresses contacted by the XLoader malware\n\n\n-----\n\nOne of a number of malicious domains XLoader contacts (VirusTotal)\n\n## Detecting XLoader Infostealer on macOS\n\nAt the end of this post we provide a number of macOS-specific Indicators of Compromise to\nhelp organizations and users in general identify an XLoader infection. SentinelOne\ncustomers are protected against this malware automatically, regardless of whether it is\nexecuted via the Java Runtime Environment or by the standalone XLoader Mach-O.\n\nIn our test, we set the agent to ‘Detect-only’ policy in order to observe the malware’s\nbehaviour. Customers are advised to always use the ‘Protect’ policy which prevents\nexecution of malware entirely.\n\nIn ‘Detect-only’ mode, the target’s Mac device will immediately alert the user via Notifications:\n\nSecurity teams and IT administrators, meanwhile, would see something similar to the\nfollowing in the Management console.\n\n\n-----\n\nAfter remediation, the UI (version 21.7EA) on the device indicates that the threat has been\nsuccessfully killed and quarantined.\n\n## Conclusion\n\nXLoader is an interesting and somewhat unusual example in the macOS malware world. It’s\ndependency on Java and its functionality suggests it is primarily targeting organizations\nwhere the threat actors expect Java applications to be in use. Among other things, that\nincludes certain online banking applications, and the attractiveness from a criminal’s\nperspective of a keylogger and info stealer in that environment can certainly be understood.\nIt is also worth noting that the malware’s minimum system requirement is 10.6 Snow Leopard\n(over 10 years old), so the author’s are certainly casting their net wide. On the other hand,\nthe implementation on macOS is clumsy at best and is likely to raise suspicions. No doubt\nthe malware authors will be looking to improve on this in future iterations.\n\n\n-----\n\n## Indicators of Compromise\n\n**SHA1 Hashes**\n\nXLoader Mach-O Executable: KIbwf02l\n7edead477048b47d2ac3abdc4baef12579c3c348\n\nSuspected Phishing lure attachment: Statement SKBMT 09818.jar\nb8c0167341d3639eb1ed2636a56c272dc66546fa\n\nExample Persistence LaunchAgent: com.j85H64iPLnW.rXxHYP\ncb3e7ac4e2e83335421f8bbc0cf953cb820e2e27\n\n**Contacted IPs**\n128.65.195.232\n162.0.229.244\n184.168.131.241\n204.11.56.48\n216.239.38.21\n34.102.136.180\n63.250.34.223\n64.190.62.111\n64.32.8.70\n72.29.74.90\n\n**Interesting Strings**\n```\n.appMacOSContentsInfo.plist\n.exe.dll\n/logins.json\n10.:1.1OS X XLNG:\n200 OK\n80987dat=&=&un=&br=&os=1\nDB1ChromeURL:\nguidURL: Firefox\nNSStringstringWithCString:encoding:\nopen\npasstokenemailloginsigninaccountHost: &GETPUTPOSTOPTIONSGET\nr%s <</dev/null\nRecovery\nrm -rf\nrm unzip nss3.zip -d\nsaltysalt\nUTF8StringNSPasteboardstringForType:generalPasteboardpublic.utf8-plain-text\nUTF8StringNSWorkspacesharedWorkspaceprocessIdentifierfrontmostApplicationAXTitleAXFocu\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-26 - Detecting XLoader - A macOS ‘Malware-as-a-Service’ Info Stealer and Keylogger.pdf"
    ],
    "report_names": [
        "2021-07-26 - Detecting XLoader - A macOS ‘Malware-as-a-Service’ Info Stealer and Keylogger.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536069,
    "ts_updated_at": 1743041170,
    "ts_creation_date": 1653767768,
    "ts_modification_date": 1653767768,
    "files": {
        "pdf": "https://archive.orkl.eu/9bbef3ee006dbce21bcc9275cff3b78a54c0cc62.pdf",
        "text": "https://archive.orkl.eu/9bbef3ee006dbce21bcc9275cff3b78a54c0cc62.txt",
        "img": "https://archive.orkl.eu/9bbef3ee006dbce21bcc9275cff3b78a54c0cc62.jpg"
    }
}