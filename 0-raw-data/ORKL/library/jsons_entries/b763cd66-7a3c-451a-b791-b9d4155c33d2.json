{
    "id": "b763cd66-7a3c-451a-b791-b9d4155c33d2",
    "created_at": "2023-01-12T15:10:31.022786Z",
    "updated_at": "2025-03-27T02:16:57.886337Z",
    "deleted_at": null,
    "sha1_hash": "4372b717ece66dec4580740d1e43b840fe943e36",
    "title": "2019-03-20 - FIN7 Revisited- Inside Astra Panel and SQLRat Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T17:39:44Z",
    "file_modification_date": "2022-05-28T17:39:44Z",
    "file_size": 134215,
    "plain_text": "# FIN7 Revisited: Inside Astra Panel and SQLRat Malware\n\n**[flashpoint-intel.com/blog/fin7-revisited:-inside-astra-panel-and-sqlrat-malware/](https://www.flashpoint-intel.com/blog/fin7-revisited:-inside-astra-panel-and-sqlrat-malware/)**\n\nMarch 20, 2019\n\n[Blogs](https://www.flashpoint-intel.com/blog)\n\nBlog\n\n[Despite the arrests of three prominent members of the FIN7 cybercrime gang beginning in](https://flashpoint.io/?p=6784)\nJanuary 2018, attacks targeting businesses and customer payment card information did not\ncease.\n\n_By Joshua Platt and Jason Reaves_\n\n[Despite the arrests of three prominent members of the FIN7 cybercrime gang beginning in](https://flashpoint.io/?p=6784)\nJanuary 2018, attacks targeting businesses and customer payment card information did not\ncease.\n\nThe latest evidence involves the discovery of a new administrative panel and previously\nunseen malware samples that Flashpoint analysts are linking to this notorious group. Activity\nfrom this campaign dates from May to July 2018, but could go back farther to January 2018.\n\n\n-----\n\nFIN7 has been active since at least 2015, targeting more than 100 U.S.-based companies in\n47 states, as well as businesses in Europe and Australia. The U.S. companies affected\n[were operating primarily in the hospitality, restaurant, and gaming industries, according to a](https://www.justice.gov/opa/pr/three-members-notorious-international-cybercrime-group-fin7-custody-role-attacking-over-100)\nU.S. Department of Justice press release last Aug. 1 announcing the arrest of three\nUkrainian nationals alleged to be members of FIN7. Two were arrested in January in\nGermany and Poland, while the third—an alleged supervisor—was arrested in June in Spain.\n\n[FIN7, which has also used a backdoor linked to Carbanak—another prolific cybercrime outfit](https://flashpoint.io/?p=4964)\nresponsible for billions in losses in the financial services industry—has stolen more than 15\nmillion payment card records from American businesses. The group, which operated behind\na front company called Combi Security, has infiltrated more than 6,500 individual point-ofsale terminals at more than 3,600 business locations, according to the DoJ.\n\n## New Attack Panel and Malware Samples\n\nFlashpoint analysts recently uncovered a new attack panel used by this group in campaigns\nthey have called Astra. The panel, written in PHP, functions as a script-management system,\npushing attack scripts down to compromised computers.\n\nAnalysts discovered references to the FIN7 front company Combi Security in the Astra\npanel’s backend PHP code, connecting the group to these campaigns. According to the DoJ\nindictments, Combi Security purported itself as a penetration-testing and security services\ncompany based in Russia and Israel. The DoJ alleges FIN7 portrayed Combi Security as a\nlegitimate business in order to recruit other hackers to their operation.\n\nThe attackers gain an initial foothold on targeted machines via phishing emails containing\nmalicious attachments. The emails are often industry-specific and crafted to entice a victim to\nopen the message and execute the attached document.\n\nOne of the documents spreads what analysts are calling SQLRat, previously unseen\nmalware that drops files and executes SQL scripts on the host system. The use of SQL\nscripts is ingenious in that they don’t leave artifacts behind the way traditional malware does.\nOnce they are deleted by the attackers’ code, there is nothing left to be forensically\nrecovered. This technique has not been observed in previous campaigns associated with\nFIN7.\n\nThe second new malware sample discovered is a multiprotocol backdoor called DNSbot,\nwhich is used to exchange commands and push data to and from compromised machines.\nPrimarily, it operates over DNS traffic, but can also switch to encrypted channels such as\nHTTPS or SSL, Flashpoint analysts discovered.\n\nThe campaigns maintain persistence on machines by creating two daily scheduled task\nentries. The code, meanwhile, is still controlled by the FIN7 actors and may be leveraged in\nfuture attacks by the group.\n\n\n-----\n\n## SQLRat Technical Details\n\nSQLRat campaigns typically involved a lure document that included an image overlayed by a\nVB Form trigger. The documents contained a message asking the user to “Unlock Protected\nContents,” below, while showing a message box displaying “US SEC Unlock document\nservice.”\n\nImage 1: An image of a document used in a typical campaign.Image 1: An image of a\ndocument used in a typical campaign.\nOnce a user has double-clicked the embedded image, the form executes a VB setup script.\nThe script writes files to the path %appdata%\\Roaming\\Microsoft\\Templates\\, then creates\ntwo task entries triggered to run daily.\n\nImage 2: Executing scripts on disk.Image 2: Executing scripts on disk.\nThe scripts are responsible for deobfuscating and executing the main JavaScript file\nmspromo.dot. The file uses a character insertion obfuscation technique, making it appear to\ncontain Chinese characters.\n\nImage 3: Obfuscated mspromo file.Image 3: Obfuscated mspromo file.\nAfter deobfuscating the file, the main JavaScript is easily recognizable. It contains a number\nof functions designed to drop files and execute scripts on a host system.\n\nImage 4: Deobfuscated mspromo script.Image 4: Deobfuscated mspromo script.=\nThe SQLRat script is designed to make a direct SQL connection to a Microsoft database\ncontrolled by the attackers and execute the contents of various tables. The script retrieves an\nitem from the bindata table and writes the file to disk. This file appears to primarily be a\n[version of TinyMet—an open source Meterpreter stager—but the actors have the option to](https://github.com/rapid7/metasploit-framework/wiki/Meterpreter)\nstore and execute any binary loaded into the table.\n\nImage 5: Code responsible for downloading from the database.Image 5: Code responsible\nfor downloading from the database.\nFiles associated with the SQLRat campaigns were all SFX RAR files. The files were 32/64bit versions of a custom-built TinyMet along with a recon.js file. The 32-bit file contained an\nXOR embedded .exe file. The file was decoded out using the following:\n\nImage 6: Deobfuscate embedded “TiniMet,” a customized version of TinyMet.Image 6:\nDeobfuscate embedded “TiniMet,” a customized version of TinyMet.\nThe result is a customized version of TinyMet. This version has limited usage; it does reverse\nTCP, XOR decodes the data retrieved for execution of the stager, and looks for TrendMicro\nprocesses. This file calls itself TiniMet:\n\nImage 7: TiniMet looking for TrendMicro processes.Image 7: TiniMet looking for\nTrendMicro processes.\nAnalysts also uncovered a “TinyPS” stager:\n\n\n-----\n\nAfter decoding out the blob, analysts found a PowerShell script. This script was similar to\n[what was previously documented in the Trustwave report “Operation Grand Mars: Defending](https://www.trustwave.com/en-us/resources/library/documents/operation-grand-mars-defending-against-carbanak-cyber-attacks/)\nAgainst Carbanak Cyber Attacks.” The script contained the same XOR key but does not\nachieve persistence. It is only intended to create the Meterpreter session. The following is\nthe PowerShell version of TiniMet:\n\nImage 9: TinyPS PowerShell stager snippet.Image 9: TinyPS PowerShell stager snippet.\n\n## DNSbot Technical Details\n\nAnalysts also uncovered subsequent campaigns associated with this panel. These\ncampaigns were similar, but leveraged a document containing an embedded JavaScriptbased DNSbot. The document contained the same MsgBox display, but this time there was a\nsingle file and task. The task name is similar to “Microsoft update service,” but the\nobfuscated JS file is dropped in %localappdata%\\Storage:\n\nImage 10: DNSBot drop location.Image 10: DNSBot drop location.\nAdditionally, the same US SEC Unlock document service is displayed, though the Microsoft\nupdate service task is deleted and replaced with the DNSbot.\n\nImage 11: DNSbot task update.Image 11: DNSbot task update.\nThe JavaScript is heavily obfuscated. The first variable—a—is an array of obfuscated values.\nThe second line contains a function to deobfuscate the values, while the call to that function\nis the second variable, b:\n\nImage 12: DNSbot obfuscation.Image 12: DNSbot obfuscation.\nA deobfuscated version of the DNS script is:\n\nImage 13: DNSbot deobfuscated.Image 13: DNSbot deobfuscated.\nA second deobfuscated testing script also matched components of the JavaScript embedded\nin the ASTRA docs, demonstrating the script’s multiprotocol use. The domain stats25google[.]com was included in a report released by FireEye earlier in the year:\n\nImage 14: Script relation to other reporting.Image 14: Script relation to other reporting.\nThe ASTRA backend was installed on a Windows server with Microsoft SQL. The panel was\nwritten in PHP and managed the content in the tables. It functioned as a script management\nsystem.\n\n## Mitigations\n\nImage 15: ASTRA attack panel partially redacted.Image 15: ASTRA attack panel partially\nredacted. Image 16: FIN7 front company name.Image 16: FIN7 front company name.\n\n\n-----\n\nImage 17: The file types\nthat were inserted, along\nwith a table layout of the\ndatabase with partial\nredaction. Image 17: The file types that were inserted, along with a table\n\nlayout of the database with partial redaction.\nFlashpoint recommends watching for newly added Windows tasks, specifically those with a\nJScript switch. Also, monitor for attempts to delete the Microsoft update service.\n\nFlashpoint also recommends implementing host-based detections for new files in\n%appdata%\\Roaming\\Microsoft\\Templates\\ with a dot extension, as well as implementing\nhost-based detections for files in %appdata%\\local\\Storage\\.\n\n## Attachments and Downloads\n\nThe indicators of compromise (IOCs) for ASTRA panel, SQLRat, and DNSbot are available\n[for download here.](https://www.flashpoint-intel.com/wp-content/uploads/2019/03/iocs_astra_sqlrat_dnsbot_flashpoint_March2019.csv)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-03-20 - FIN7 Revisited- Inside Astra Panel and SQLRat Malware.pdf"
    ],
    "report_names": [
        "2019-03-20 - FIN7 Revisited- Inside Astra Panel and SQLRat Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "c9617bb6-45c8-495e-9759-2177e61a8e91",
            "created_at": "2022-10-25T15:50:23.405039Z",
            "updated_at": "2025-03-27T02:00:55.462193Z",
            "deleted_at": null,
            "main_name": "Carbanak",
            "aliases": [
                "Carbanak",
                "Anunak"
            ],
            "source_name": "MITRE:Carbanak",
            "tools": [
                "Carbanak",
                "Mimikatz",
                "PsExec",
                "netsh"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "bfded1cf-be73-44f9-a391-0751c9996f9a",
            "created_at": "2022-10-25T15:50:23.337107Z",
            "updated_at": "2025-03-27T02:00:55.445946Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "FIN7",
                "GOLD NIAGARA",
                "ITG14",
                "Carbon Spider",
                "ELBRUS",
                "Sangria Tempest"
            ],
            "source_name": "MITRE:FIN7",
            "tools": [
                "Mimikatz",
                "AdFind",
                "JSS Loader",
                "HALFBAKED",
                "REvil",
                "PowerSploit",
                "CrackMapExec",
                "Carbanak",
                "Pillowmint",
                "Cobalt Strike",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRat",
                "Lizar",
                "TEXTMATE",
                "BOOSTWRITE"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "bb8702c5-52ac-4359-8409-998a7cc3eeaf",
            "created_at": "2023-01-06T13:46:38.405479Z",
            "updated_at": "2025-03-27T02:00:02.82533Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "JokerStash",
                "ATK32",
                "G0046",
                "Coreid",
                "Carbanak",
                "Sangria Tempest",
                "CARBON SPIDER",
                "GOLD NIAGARA",
                "G0008",
                "ELBRUS",
                "Carbon Spider"
            ],
            "source_name": "MISPGALAXY:FIN7",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d85adfe3-e1c3-40b0-b8bb-d1bacadc4d82",
            "created_at": "2022-10-25T16:07:23.619566Z",
            "updated_at": "2025-03-27T02:02:09.890982Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "APT-C-11",
                "ATK 32",
                "Gold Niagara",
                "ITG14",
                "TAG-CR1"
            ],
            "source_name": "ETDA:FIN7",
            "tools": [
                "7Logger",
                "Agentemis",
                "Anunak",
                "Astra",
                "BIOLOAD",
                "BIRDWATCH",
                "Bateleur",
                "Boostwrite",
                "CROWVIEW",
                "Carbanak",
                "Cobalt Strike",
                "CobaltStrike",
                "DICELOADER",
                "DNSMessenger",
                "FOWLGAZE",
                "HALFBAKED",
                "JSSLoader",
                "KillACK",
                "LOADOUT",
                "Lizar",
                "Meterpreter",
                "Mimikatz",
                "POWERPLANT",
                "POWERSOURCE",
                "RDFSNIFFER",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "TEXTMATE",
                "Tirion",
                "VB Flash",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "ed3810b7-141a-4ed0-8a01-6a972b80458d",
            "created_at": "2022-10-25T16:07:23.443259Z",
            "updated_at": "2025-03-27T02:02:09.801771Z",
            "deleted_at": null,
            "main_name": "Carbanak",
            "aliases": [
                "Anunak",
                "Carbanak",
                "Carbon Spider",
                "ELBRUS",
                "Gold Waterfall",
                "Sangria Tempest"
            ],
            "source_name": "ETDA:Carbanak",
            "tools": [
                "AVE_MARIA",
                "Agentemis",
                "AmmyyRAT",
                "Antak",
                "Anunak",
                "Ave Maria",
                "AveMariaRAT",
                "BABYMETAL",
                "BIRDDOG",
                "Backdoor Batel",
                "Batel",
                "Bateleur",
                "BlackMatter",
                "Boostwrite",
                "Cain & Abel",
                "Carbanak",
                "Cl0p",
                "Cobalt Strike",
                "CobaltStrike",
                "DNSMessenger",
                "DNSRat",
                "DNSbot",
                "DRIFTPIN",
                "DarkSide",
                "FOXGRABBER",
                "FlawedAmmyy",
                "HALFBAKED",
                "JS Flash",
                "KLRD",
                "MBR Eraser",
                "Mimikatz",
                "Nadrac",
                "Odinaff",
                "POWERPIPE",
                "POWERSOURCE",
                "PsExec",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "SocksBot",
                "SoftPerfect Network Scanner",
                "Spy.Agent.ORM",
                "TEXTMATE",
                "TeamViewer",
                "TiniMet",
                "TinyMet",
                "Toshliph",
                "VB Flash",
                "WARPRISM",
                "avemaria",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536231,
    "ts_updated_at": 1743041817,
    "ts_creation_date": 1653759584,
    "ts_modification_date": 1653759584,
    "files": {
        "pdf": "https://archive.orkl.eu/4372b717ece66dec4580740d1e43b840fe943e36.pdf",
        "text": "https://archive.orkl.eu/4372b717ece66dec4580740d1e43b840fe943e36.txt",
        "img": "https://archive.orkl.eu/4372b717ece66dec4580740d1e43b840fe943e36.jpg"
    }
}