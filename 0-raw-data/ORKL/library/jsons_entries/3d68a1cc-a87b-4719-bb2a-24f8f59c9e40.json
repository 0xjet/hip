{
    "id": "3d68a1cc-a87b-4719-bb2a-24f8f59c9e40",
    "created_at": "2023-01-12T14:59:39.2545Z",
    "updated_at": "2025-03-27T02:12:03.978389Z",
    "deleted_at": null,
    "sha1_hash": "236a8218fbc45d21e81408f841de035ccff63ebe",
    "title": "2021-03-05 - Hafnium Exchange Vuln Detection - KQL",
    "authors": "",
    "file_creation_date": "2022-05-28T15:34:52Z",
    "file_modification_date": "2022-05-28T15:34:52Z",
    "file_size": 55723,
    "plain_text": "# Hafnium Exchange Vuln Detection - KQL\n\n**pastebin.com/J4L3r2RS**\n\n[MalwareQuinn](https://pastebin.com/u/MalwareQuinn)\nMar 5th, 2021\n\n4,976\n\nNever\n\n**Not a member of Pastebin yet?** **[Sign Up, it unlocks many cool features!](https://pastebin.com/signup)**\n[text 1.50 KB](https://pastebin.com/archive/text)\nCopied copy [raw](https://pastebin.com/raw/J4L3r2RS) [download](https://pastebin.com/dl/J4L3r2RS) [clone](https://pastebin.com/clone/J4L3r2RS) [embed](https://pastebin.com/embed/J4L3r2RS) [print](https://pastebin.com/print/J4L3r2RS) [report](https://pastebin.com/report/J4L3r2RS)\n\n1. let networkEvent = DeviceNetworkEvents\n\n2. | where ActionType == \"InboundConnectionAccepted\" and InitiatingProcessFileName\n\n=~ \"System\"\n\n3. | extend netTimestamp = Timestamp\n\n4. | project DeviceId, DeviceName, netTimestamp, RemoteIP, RemotePort; //Grab a table\n\nof all accepted inbound connections, projecting the Timestamp for further manipulation\n\n5. let shellWrite = DeviceFileEvents\n\n6. | where ActionType == \"FileCreated\" and FolderPath has \"inetpub\" and FileName\n\nhas_any (\".php\", \".jsp\", \".js\", \".aspx\", \".asmx\", \".asax\", \".cfm\", \".shtml\")\n\n7. | project DeviceName, DeviceId, Timestamp, FileName, FolderPath; //Grab a table of\n\nall created files in inetpub, with a file extension ending in \".php\", \".jsp\", \".js\", \".aspx\",\n\".asmx\", \".asax\", \".cfm\", \".shtml\". Projecting timestamp for further manipulation\n\n8. DeviceFileEvents\n\n\n-----\n\n9. | where (FileName =~ applicationHost.config or FileName =~ administration.config )\n\nand FolderPath contains \"inetpub\" //Grab all instances of updates to the IIS\napplicationHost.config or administration.config\n\n10. | join shellWrite on DeviceName, DeviceId\n\n11. | join networkEvent on DeviceId, DeviceName\n\n12. | extend time_diff = datetime_diff('second',Timestamp,Timestamp1) //create a time\n\ndifferential column for shellWrite and config update\n\n13. | extend netTimeDiff = datetime_diff('second',Timestamp1,netTimestamp) //create a\n\ntime differential column for networkEvent and the shellWrite\n\n14. | where (time_diff <= 60 and time_diff >= 0) and (netTimeDiff <= 10 and netTimeDiff >=\n\n0) //differential filtering for networkEvent and shellWrite\n\nRAW Paste Data Copied\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-05 - Hafnium Exchange Vuln Detection - KQL.pdf"
    ],
    "report_names": [
        "2021-03-05 - Hafnium Exchange Vuln Detection - KQL.pdf"
    ],
    "threat_actors": [
        {
            "id": "529c1ae9-4579-4245-86a6-20f4563a695d",
            "created_at": "2022-10-25T16:07:23.702006Z",
            "updated_at": "2025-03-27T02:02:09.93109Z",
            "deleted_at": null,
            "main_name": "Hafnium",
            "aliases": [
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "ETDA:Hafnium",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "7c969685-459b-4c93-a788-74108eab6f47",
            "created_at": "2023-01-06T13:46:39.189751Z",
            "updated_at": "2025-03-27T02:00:03.017103Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "ATK233",
                "G0125",
                "Operation Exchange Marauder",
                "Red Dev 13",
                "Silk Typhoon"
            ],
            "source_name": "MISPGALAXY:HAFNIUM",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "2704d770-43b4-4bc4-8a5a-05df87416848",
            "created_at": "2022-10-25T15:50:23.306305Z",
            "updated_at": "2025-03-27T02:00:55.43633Z",
            "deleted_at": null,
            "main_name": "HAFNIUM",
            "aliases": [
                "HAFNIUM",
                "Operation Exchange Marauder",
                "Silk Typhoon"
            ],
            "source_name": "MITRE:HAFNIUM",
            "tools": [
                "Tarrask",
                "ASPXSpy",
                "Impacket",
                "PsExec",
                "China Chopper"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535579,
    "ts_updated_at": 1743041523,
    "ts_creation_date": 1653752092,
    "ts_modification_date": 1653752092,
    "files": {
        "pdf": "https://archive.orkl.eu/236a8218fbc45d21e81408f841de035ccff63ebe.pdf",
        "text": "https://archive.orkl.eu/236a8218fbc45d21e81408f841de035ccff63ebe.txt",
        "img": "https://archive.orkl.eu/236a8218fbc45d21e81408f841de035ccff63ebe.jpg"
    }
}