{
    "id": "9b92d275-8701-446a-b77b-9b2ff512eca0",
    "created_at": "2023-01-12T15:07:45.798129Z",
    "updated_at": "2025-03-27T02:06:00.123113Z",
    "deleted_at": null,
    "sha1_hash": "f068752360606945ad134b4805ba8e9b78b8afa8",
    "title": "2021-11-27 - Halos Gate Evolves - Tartarus Gate",
    "authors": "",
    "file_creation_date": "2022-05-29T00:40:10Z",
    "file_modification_date": "2022-05-29T00:40:10Z",
    "file_size": 111766,
    "plain_text": "# Halo's Gate Evolves -> Tartarus' Gate\n\n**[trickster0.github.io/posts/Halo's-Gate-Evolves-to-Tartarus-Gate](https://trickster0.github.io/posts/Halo's-Gate-Evolves-to-Tartarus-Gate/)**\n\ntrickster0 on Nov 27\n\nUpdated Nov 27 3 min read\n\n\nNovember 27, 2021\n\n\nA while ago in my twitter, I have mentioned what a huge fan I am of Hell’s Gate and Halo’s\n[Gate. Hell’s Gate originally is a very creative way to fetch the syscall numbers by parsing the](https://github.com/am0nsec/HellsGate)\nInMemoryOrderModuleLIst from PEB structure. By finding the ntdll.dll address, which is\nusually the first entry in InMemoryOrderModuleLIst, it is possible to obtain the syscall\nnumbers by parsing its exports for the necessary functions we need.\n\nEven though this is an excellent technique to bypass most of the Antiviruses, unfortunately\ndue to the evolution of EDRs and unhooking, this technique cannot succeed.\n\nBelow we can see a normal syscall where Hell’s Gate would absolutely work.\n\nAs we have mentioned EDRs evolved and a new technique came to light by Reenz0h, called\nHalo’s Gate. Halo’s Gate is basically a modified version of Hell’s Gate to unhook the\nWINAPI calls.\n\nFor anyone not aware, unhooking is the process where you evade the hooked WINAPI\nfunctions by the AVs/EDRs in order for them to check the parameters and the flow of a\nprogram.\n\nHalo’s Gate basically check the first bytes of the called WINAPI and if they are as they\nshould “4c8bd1b8”, then the WINAPI is not hooked and everything proceeds normally, but\nwhen the first byte is “e9”, then a jmp assembly instructions redirects the execution of the\nprogram to the AV/EDR checking engine, hence it is hooked.\n\nIn the screenshot you can see what a hooked call looks like by certain EDRs.\n\n\n-----\n\nHalo’s Gate tackles this problem if the byte is “e9” by going up or down and check the syscall\nof the next or previous syscall, if it is not hooked then we grab the syscall and add +1 byte\nsince they are all in order.\n\nSince I am very fond of this technique and It was not working in different EDRs, I was\ncurious why and I had to dig more since it was not the detection/prevention of the security\nproduct but it was just failing. Soon I realized that not all EDRs hook the same way, so I had\nto bypass and extend it Halo’s Gate further into Tartarus’ Gate.\n\nRegarding the EDR, that I was against, I am sure it is easy to find out which one it is but\napparently it starts with the bytes “4c8bd1e9” as you can see below when the WINAPI call is\nhooked.\n\nBasically what I did was to modify the Halo’s Gate code by adding one more check, to check\nfor the 4th byte if it is “e9”, if it is, it will do the same as the explanation on Halo’s Gate to\nunhook it, so I ended up calling this Tartarus’ Gate.\n\nI am certain there are more EDRs that have their own hooking method so I can see how this\ncould evolve even further depending on the situation.\n\n[Source Code can be found here You will notice that the custom way to copy the shellcode to](https://github.com/trickster0/TartarusGate)\nthe allocated space is removed, for some reason it was not working very well against this\nEDR so I would avoid depending on the case. Also, this code might fail a few times\ndepending on the EDR, so if it will not work on the first try, try a few times. If you use a\ndifferent method that works better than CreateRemoteThread, it will work in a very stable\nmanner.\n\n[Resources: https://sektor7.net/#!res/2021/halosgate.md](https://sektor7.net/#!res/2021/halosgate.md)\n[https://github.com/am0nsec/HellsGate](https://github.com/am0nsec/HellsGate)\n\n\n-----\n\nCredits to : Reenz0h from Sektor7 for Halo s Gate and the authors of Hell s Gate - Paul\n[Laîné and smelly__vx](https://twitter.com/smelly__vx)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-11-27 - Halos Gate Evolves - Tartarus Gate.pdf"
    ],
    "report_names": [
        "2021-11-27 - Halos Gate Evolves - Tartarus Gate.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536065,
    "ts_updated_at": 1743041160,
    "ts_creation_date": 1653784810,
    "ts_modification_date": 1653784810,
    "files": {
        "pdf": "https://archive.orkl.eu/f068752360606945ad134b4805ba8e9b78b8afa8.pdf",
        "text": "https://archive.orkl.eu/f068752360606945ad134b4805ba8e9b78b8afa8.txt",
        "img": "https://archive.orkl.eu/f068752360606945ad134b4805ba8e9b78b8afa8.jpg"
    }
}