{
    "id": "8be3b1f2-e385-4846-9fc7-77480599ecd7",
    "created_at": "2024-11-01T02:05:17.483839Z",
    "updated_at": "2025-03-27T02:05:41.596316Z",
    "deleted_at": null,
    "sha1_hash": "f104b369e66f05330c135f0e3c4084a8008e771e",
    "title": "",
    "authors": "",
    "file_creation_date": "2004-03-03T17:41:07Z",
    "file_modification_date": "2004-03-03T17:46:38Z",
    "file_size": 132132,
    "plain_text": "# Capturing WindowsCapturing Windows\n Passwords using the NetworkPasswords using the Network\n Provider APIProvider API\n\n## A step-by-step guide to building your own password capture DLL\n\n###### Sergey Polak\n\n Senior Programmer\n\n Fish & Neave\n\n Spolak@fishneave.com\n\n\n-----\n\n# AgendaAgenda\n\n#####  Introduction\n\n#### – Password capturing in general – What is Network Provider API?\n\n#####  Details about the Network Provider API functions\n  Writing your own Network Provider\n\n#### – Minimum requirements – Differences between the versions of Windows (NPLogon\n vs. NPLogonNotify) – Installing your provider DLL\n\n#####  Demonstration\n  Conclusion\n\n#### – Q&A\n\n\n-----\n\n# IntroductionIntroduction\n\n#####  Password capturing in general\n#### – Capture Methods\n\n######  Keystroke logging software\n  Keystroke logging hardware\n  Social Engineering\n  Camera\n#### – Are there legitimate reasons for capturing user passwords on a corporate network?\n\n######  Administrative (or user) convenience\n  Password complexity enforcement\n  Surveillance\n\n\n-----\n\n# IntroductionIntroduction\n\n####  The Windows Network Provider API –\n## what is it and what is it good for?\n### – Logon network authentication – Network connections, device redirection and enumeration\n\n\n-----\n\n# Digging Deeper into theDigging Deeper into the\n Network Provider APINetwork Provider API\n\n####  Capabilities\n\n### – User Credential Management – Network Connections (Device Redirection) – Searching and Enumeration – “Administrative” Functions\n\n\n-----\n\n# Digging Deeper into theDigging Deeper into the\n Network Provider APINetwork Provider API\n\n####  Credential Management\n### a. Logon Notifications\n#### NPLogon and NPLogonNotify\n### b. Password Change Notifications\n\n#### NPPasswordChangeNotify\n### c. Current User Query\n#### NPGetUser\n\n\n-----\n\n# Digging Deeper into theDigging Deeper into the\n Network Provider APINetwork Provider API\n\n####  Network Connections (Device\n\n## Redirection)\n\n### – NPAddConnection and NPAddConnection3 – NPGetConnection – NPCancelConnection – NPGetConnectionPerformance\n\n\n-----\n\n# Digging Deeper into theDigging Deeper into the\n Network Provider APINetwork Provider API\n\n####  Searching and Enumeration\n\n### – NPOpenEnum, NPEnumResource and\n NPCloseEnum – NPSearchDialog\n\n\n-----\n\n# Digging Deeper into theDigging Deeper into the\n Network Provider APINetwork Provider API\n\n####  “Administrative” Functions\n\n### – NPGetDirectoryType – NPDirectoryNotify\n\n\n-----\n\n# Writing Your Own NetworkWriting Your Own Network\n ProviderProvider\n\n#####  Minimum Requirements\n\n#### DWORD NPGetCaps( DWORD nIndex );\n\n###### nIndex values and responses:\n – WNNC_SPEC_VERSION : WNNC_SPEC_VERSION51 – WNNC_NET_TYPE : value from predefined list – WNNC_USER – WNNC_CONNECTION – WNNC_DIALOG – WNNC_ADMIN – WNNC_ENUMERATION – WNNC_START    : time until started – WNNC_AUTHENTICATION : WNNC_AUTH_LOGON Export function by name and as ordinal 13\n\n\n-----\n\n# Writing Your Own NetworkWriting Your Own Network\n ProviderProvider\n\n#####  Differences between the versions of Windows\n\n#### – Windows 95, 98 and ME\n\n######  NPLogon (exported as ordinal 43)\n#### – Windows NT, 2000, XP and 2003 Server\n\n######  DWORD APIENTRY NPLogonNotify( PLUID lpLogon,\n LPCWSTR lpAuthentInfoType, LPVOID lpAuthentInfo, LPCWSTR lpPreviousAuthentInfoType, LPVOID lpPreviousAuthentInfo, LPWSTR lpStationName, LPVOID StationHandle, LPWSTR* lpLogonScript );\n\n#####  Password change notification\n\n###### – DWORD APIENTRY NPPasswordChangeNotify( LPCWSTR\n lpAuthentInfoType, LPVOID lpAuthentInfo, LPCWSTR lpPreviousAuthentInfoType, LPVOID lpPreviousAuthentInfo, LPWSTR lpStationName, LPVOID StationHandle, DWORD dwChangeInfo );\n\n\n-----\n\n# NPLogonNotify ParametersNPLogonNotify Parameters\n\n#####  lpLogon\n\n#### – Pointer to the session ID\n\n#####  lpAuthentInfoType\n\n#### – A string that identifies the type of login. The\n values are:\n\n######  MSV1_0:Interactive\n  Kerberos:Interactive\n\n#####  lpAuthentInfo\n\n#### – Depending on the value of lpAuthentInfoType,\n this is either a MSV1_0_INTERACTIVE_LOGON or a KERB_INTERACTIVE_LOGON structure\n\n\n-----\n\n# NPLogonNotify Parameters NPLogonNotify Parameters ––\n lpAuthentInfo detailslpAuthentInfo details\n\n#####  MSV1_0_INTERACTIVE_LOGON or\n\n### KERB_INTERACTIVE_LOGON structure members:\n\n#### – MessageType – LogonDomainName\n\n######  Type UNICODE_STRING\n#### – UserName\n\n######  Type UNICODE_STRING\n#### – Password\n\n######  Type UNICODE_STRING\n\n\n-----\n\n# NPLogonNotify ParametersNPLogonNotify Parameters\n\n######  lpPreviousAuthentInfoType\n – NULL unless user was forced to change authentication\n information (such as password)\n  lpPreviousAuthentInfo\n  lpStationName\n – WinSta_0 or WinSta0\n\n Interactive user logon\n###### – SvcCtl\n\n Service logon\n\n######  StationHandle\n – If interactive login, this is a handle to dialog box currently\n on screen\n  lpLogonScript\n – Return a pointer to a logon script to execute\n\n\n-----\n\n# Installing Your Provider DLLInstalling Your Provider DLL\n\n######  HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControl\n\n#### Set\\Control\\NetworkProvider\\Order\n\n###### – ProviderOrder\n  HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControl\n\n#### Set\\Services\n\n###### – Key with name of provider\n\n Group = “NetworkProvider”\n###### – NetworkProvider subkey\n\n Class = 2 (WN_CREDENTIAL_CLASS)\n\n ProviderPath\n\n Name\n\n Description (optional)\n\n NetNotLoading (optional)\n\n CallOrder (optional)\n\n NetID (optional)\n\n\n-----\n\n# DemonstrationDemonstration\n\n\n-----\n\n# ReferencesReferences\n\n#####  Microsoft Developer Network Library\n\n### (MSDN)\n\n#### – Network Provider API is under Security\\SDK\n Documentation\\Authentication\n\n\n-----\n\n# Q&A?Q&A?\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://www.blackhat.com/presentations/win-usa-04/bh-win-04-polak/bh-win-04-polak2.pdf"
    ],
    "report_names": [
        "bh-win-04-polak2.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1730426717,
    "ts_updated_at": 1743041141,
    "ts_creation_date": 1078335667,
    "ts_modification_date": 1078335998,
    "files": {
        "pdf": "https://archive.orkl.eu/f104b369e66f05330c135f0e3c4084a8008e771e.pdf",
        "text": "https://archive.orkl.eu/f104b369e66f05330c135f0e3c4084a8008e771e.txt",
        "img": "https://archive.orkl.eu/f104b369e66f05330c135f0e3c4084a8008e771e.jpg"
    }
}