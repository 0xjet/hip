{
    "id": "c3dc3097-3be9-41d0-b2a9-c9afbb93be32",
    "created_at": "2022-10-25T16:48:18.18585Z",
    "updated_at": "2025-03-27T02:06:12.954828Z",
    "deleted_at": null,
    "sha1_hash": "02a66278756c7c3a068d5eff9bc05f3ae9a836cd",
    "title": "New Malware with Ties to SunOrcal Discovered",
    "authors": "",
    "file_creation_date": "2017-11-15T16:39:49Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 503207,
    "plain_text": "### MENU\n\n\n**[Get Support | English [change]](https://live.paloaltonetworks.com/t5/custom/page/page-id/Support)**\n\n\n**[Blog Home > Unit 42 > New Malware with Ties to SunOrcal Discovered](https://researchcenter.paloaltonetworks.com/)**\n# New Malware with Ties to SunOrcal Discovered\n\n**[By Josh Grunzweig and Jen Miller-Osborn](https://researchcenter.paloaltonetworks.com/author/josh-grunzweig/)**\n**November 10, 2017 at 1:00 PM**\n**[Category: Unit 42](https://researchcenter.paloaltonetworks.com/unit42/)** **[Tags: Reaver, SunOrcal](https://researchcenter.paloaltonetworks.com/tag/reaver/)**\n\n**6,702** **(1)**\n\n## Summary\n\n**Unit 42 has discovered a new malware family we’ve named “Reaver” with ties to attackers**\n**[who use SunOrcal malware. SunOrcal activity has been documented to at least 2013, and](http://pwc.blogs.com/cyber_security_updates/2016/03/index.html)**\n**based on metadata surrounding some of the C2s, may have been active as early as 2010. The**\n**new family appears to have been in the wild since late 2016 and to date we have only**\n**identified 10 unique samples, indicating it may be sparingly used. Reaver is also somewhat�**\n**unique in the fact that its final payload is in the form of a Control panel item, or CPL file. To�**\n**date, only 0.006% of all malware seen by Palo Alto Networks employs this technique,**\n**indicating that it is in fact fairly rare.**\n\n**While we don’t have information on the intended targets in this case, previous reports on this**\n**activity have identified targeting primarily among the “Five Poisons” which are movements the�**\n**Chinese government perceives as dangerous. They are:**\n\n**Uyghurs, particularly those supporting East Turkestan independence**\n**Tibetans, particularly those supportive of Tibetan independence**\n**Falun Gong practitioners**\n**Supporters of Taiwan independence**\n**Supporters of Chinese democracy**\n\n**The attackers used both families concurrently from late last year through November 2017 and**\n**there is some C2 infrastructure overlap between the two families, as well as links to historical**\n**reporting. We explore those ties and provide an in-depth analysis of the new malware below.**\n\n## Reaver Malware Analysis\n\n**To date, Palo Alto Networks Unit 42 has identified 10 unique samples and three distinct�**\n**variants of a new malware family we have named “Reaver”. As such, we identify each variant**\n**as Reaver.v1, Reaver.v2, and Reaver.v3.**\n\n**Reaver.v1 has been observed delivering a payload that uses HTTP for network**\n**communication while versions 2 and 3 use a payload that uses raw TCP connections for this**\n\n\n-----\n\n**The flow for Reaver is as shown:�**\n\n**_Figure 1 Reaver execution flow diagram�_**\n## Reaver.v1\n\n**The earliest variant of Reaver begins by attempting to enable the SeDebugPrivilege privilege**\n**for the running process. In the event this is successful the malware will use the following path**\n**to store any dropped files:�**\n\n**%COMMONPROGRAMFILES%\\services\\**\n\n**In the event it is not successful, this alternative path will be used instead:**\n\n**%APPDATA%\\microsoft\\mmc\\**\n\n**It proceeds to load and decrypt and embedded bitmap resource file. This decrypted data is�**\n**written to the following location:**\n\n**%TEMP%\\WUpdate.~tmp**\n\n**This ‘WUpdate.~tmp’ file is then copied to a filename of ‘Applet.cpl’, which is placed in the�**\n**previously identified file path.�**\n\n**The malware proceeds to identify the file path of either the common startup folder, or the�**\n**user’s startup folder depending on if the SeDebugPrivilege privilege was obtained. In the**\n**event this privilege was obtained, the common startup folder is queried by reading the**\n\n\n-----\n\n**Startup**\n\n**Alternatively, if the privilege was unable to be obtained, Reaver.v2 will obtain the user’s**\n**startup folder by querying the following registry key:**\n\n**HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders\\Startup**\n\n**Reaver proceeds to write a shortcut file to ‘%TEMP%\\~WUpdate.lnk’. This file is then copied�**\n**to a filename of ‘Windows Update.lnk’, which is placed in the startup path previously�**\n**identified. This shortcut file points to the path of the previously written ‘Applet.cpl’ file. Finally,�**\n**Reaver.v1 will execute the ‘~WUpdate.lnk’ file in a new process, thus loading the recently�**\n**dropped malicious CPL file.�**\n\n## Reaver.v2\n\n**Reaver.v2 begins by attempting to enable the SeDebugPrivilege privilege for the running**\n**process. In the event this is successful, the malware will use the following path to store any**\n**dropped files:�**\n\n**%COMMONPROGRAMFILES%\\services\\**\n\n**In the event it is not successful, this alternative path will be used instead:**\n\n**%APPDATA%\\microsoft\\mmc\\**\n\n**Reaver.v2 proceeds to decrypt an embedded file using a simple XOR obfuscation routine.�**\n**This file is written to the following file path:�**\n\n**% TEMP%\\Update.~tmp**\n\n**After the file is written, it is then copied to a filename of ’winhelp.cpl’ in the directory that was�**\n**initially chosen. After this file is copied, the original ‘Update.~tmp’ file is deleted. At this stage�**\n**the malware will identify the correct startup path using the same technique witnessed in**\n**earlier variants.**\n\n**A shortcut file is generated in the following path:�**\n\n**%TEMP%\\~Update.lnk**\n\n**This ‘~Update.lnk’ file is then copied to a filename of ‘Windows help.lnk’, which is placed in�**\n**the startup path previously identified. This shortcut file points to the path of the previously�**\n**written ‘winhelp.cpl’ file. It will specifically load this CPL file via a call to the built-in Microsoft�**\n**Windows ‘control.exe’ utility. Finally, Reaver.v2 will execute the ‘~Update.lnk’ file in a new�**\n**process, thus loading the recently dropped malicious CPL file.�**\n\n## Reaver.v3\n\n**Like Reaver.v2, Reaver.v3 begins by attempting to enable the SeDebugPrivilege privilege for**\n**the running process. In the event this is successful, the malware will use the following path to**\n**store any dropped files:�**\n\n**%COMMONPROGRAMFILES%\\services\\**\n\n\n-----\n\n**Reaver.v3 proceeds to write an embedded Microsoft Cabinet (CAB) file to the following�**\n**location:**\n\n**%TEMP%\\winhelp.dat**\n\n**This cabinet file is then extracted to the previously identified file path. The contents of this�**\n**cabinet file consist of a Microsoft Control Panel item with a filename of ‘winhelp.cpl’.�**\n\n**Much like the previous version of Reaver, Reaver.v3 will query the necessary registry keys to**\n**determine the correct startup path to use. Again, a shortcut file is written to the %TEMP%�**\n**path with a name of ‘~Update.lnk’, which is in turn copied to the identified startup path with a�**\n**filename of ‘Windows help.lnk’. This shortcut file calls the built-in ‘control.exe’ utility to in turn�**\n**load the previously dropped malicious CPL file of ‘winhelp.cpl’.�**\n\n**Finally, the malware calls the ‘winhelp.cpl’ file in a new process via the following command:�**\n\n**control [path_previously_identified]\\winhelp.cpl�**\n\n## Reaver HTTP Payload\n\n**The malicious CPL payload of Reaver has the following two exported functions:**\n\n**CPlApplet**\n**DllEntryPoint**\n\n**When the CPlApplet function is loaded, Reaver will initially determine if the SeDebugPrivilege**\n**privilege is able to be obtained. The malware proceeds to decrypt and embedded**\n**configuration of 128 bytes using a simple XOR routine. The following example decrypted�**\n**configuration is as follows:�**\n\n**1** **00000000: 77** **77** **77** **2E** **74** **61** **73** **68** **64** **71** **64** **78** **70** **2E** **63** **6F** **www.tashdqdxp.co**\n**00000010: 6D** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **m...............**\n**00000020: 38** **30** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **80..............**\n**00000030: 33** **30** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **30..............**\n**00000040: 57** **69** **6E** **64** **6F** **77** **73** **20** **55** **70** **64** **61** **74** **65** **00** **00** **Windows Update..**\n**00000050: 00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **................**\n**00000060: 41** **70** **70** **6C** **65** **74** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **Applet..........**\n**00000070: 00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **00** **................**\n\n\n-----\n\n**2**\n\n\n-----\n\n**3**\n\n\n-----\n\n**4**\n\n\n-----\n\n**5**\n\n\n-----\n\n**6**\n\n\n**7**\n\n\n-----\n\n**8**\n\n\n-----\n\n**As we can see, the following information is present within this configuration:�**\n\n**Remote Command and Control (C2) server**\n**Remote port**\n**Sleep timer**\n\n**Reaver continues to collect various information from the victim machine, including the**\n**following:**\n\n**CPU speed**\n**Computer name**\n**Username**\n**IP Address**\n\n\n-----\n\n**The malware proceeds to communicate with the remote server via HTTP GET and POST**\n**requests. Data that is sent is compressed and then base64-encoded before being included in**\n**the requests.**\n\n**We have observed the following capabilities of this payload:**\n\n**Get drive information**\n**Read files�**\n**Write files�**\n**Delete files�**\n**Move files�**\n**Spawn processes**\n**Create directories**\n\n## Reaver TCP Payload\n\n**The malicious CPL payload of Reaver has the following three exported functions:**\n\n**ServiceMain**\n**CPlApplet**\n**DllEntryPoint**\n\n**When the malware is initially loaded, DllEntryPoint will be called, which in turn will call a**\n**function that is responsible for decompressing a blob of data. The decompressed data**\n**consists of various key/value pairings that represent important strings used by Reaver. An**\n**example of this decompressed data can be seen below:**\n\n\n**1**\n\n\n**RA@10001=ole32.dll**\n**RA@10002=CoCreateGuid**\n**RA@10003=Shlwapi.dll**\n**RA@10004=SHDeleteKeyA**\n**RA@10005=wininet.dll**\n**RA@10006=InternetOpenA**\n\n**[TRUNCATED]**\n**RA@10288=%s\\%s**\n**RA@10289=CMD.EXE**\n**RA@10290=%s=**\n**RA@10311=\\%sctr.dll**\n**RA@10312=\\uc.dat**\n**RA@10313=ChangeServiceConfig2A**\n**RA@10314=QueryServiceConfig2A**\n\n\n**2**\n\n\n-----\n\n**3**\n\n\n**4**\n\n\n**5**\n\n\n-----\n\n**7**\n\n\n**8**\n\n\n**9**\n\n\n**10**\n\n\n-----\n\n**11**\n\n\n**12**\n\n\n**13**\n\n\n-----\n\n**14**\n\n\n**When the malware wishes to retrieve one of these decoded strings, it will simply call a**\n**function with an integer argument that is responsible for providing it. For example, calling this**\n**function with an argument of ‘10001’ would retrieve a string of ‘ole32.dll’.**\n\n**The DllEntryPoint function proceeds to attempt to obtain the SeDebugPrivilege privilege, and**\n**also calls WSAStartup for future network activity.**\n\n**When the CPlApplet function is loaded, it will begin by decompressing an embedded**\n**configuration using the same compression algorithm used previously. An example of this�**\n**decompressed configuration may be seen below:�**\n\n\n-----\n\n**This configuration contains multiple pieces of information, including the following:�**\n\n**Network port**\n**Sleep timer between network requests**\n**Remote Command and Control (C2)**\n**Service Name**\n**Service Description**\n**Service Display Name**\n**Hardcoded String. This may be either a campaign identifier, or perhaps a malware�**\n**versioning string.**\n\n**The malware proceeds to check to see if the original dropped malware file exists. In the event�**\n**it does, Reaver will move this file to ‘%TEMP%\\~FJIOW.tmp’ and delete this new file. This�**\n**simply acts as cleanup to ensure original file artifacts no longer reside on the infected�**\n**machine. Reaver will then install itself as a service in the event it is running with**\n**SeDebugPrivilege privileges. The service is configured with a name, description, and display�**\n**name that is provided within the configuration.�**\n\n**Reaver continues to collect various information from the victim machine, including the**\n**following:**\n\n**Computer name**\n**Volume serial number**\n**Microsoft Windows version**\n**CPU speed**\n**ANSI code page**\n**OEM code page identifier for the operating system�**\n**Physical and virtual memory information**\n\n**Reaver encrypts this data using an incremental XOR key and uploads it to the configured�**\n**remote server on the port specified. The following example Python code shows how this�**\n**encryption takes place:**\n\n\n-----\n\n**2**\n\n**3**\n\n**4**\n\n**5**\n\n\n**for** **d** **in** **data:**\n**out += chr((ord(d) ^ ((c % 256) + 92)) & 0xFF)**\n**c += 1**\n\n\n**After this data is exfiltrated, the malware expects 8 bytes of data that contains two DWORDs.�**\n\n\n-----\n\n**Get drive information**\n**Modify files�**\n**Modify directories**\n**Modify registry**\n**Spawn process**\n**Terminate process**\n**Modify services**\n**Kill self**\n\n## Ties to SunOrcal\n\n**Reaver was used concurrently with SunOrcal over the past year, to include two Reaver**\n**samples dropped from zip files hosted on a domain also being used as a SunOrcal C2�**\n**(www.fyoutside[.]com), and there is also passive DNS overlap amongst the C2s. Specifically,�**\n**Reaver to date has used www.tashdqdxp[.]com for C2, which overlaps with**\n**www.weryhstui[.]com, another C2 used by SunOrcal samples during the same timeframe.**\n**Both domains have resolved to 98.126.156[.]210. Several of those same SunOrcal samples**\n**were also using www.fyoutside[.]com as an additional C2. This led to further C2 ties within**\n**SunOrcal samples, to include samples beaconing to www.olinaodi[.]com; all of this is shown**\n**[below in Figure 3. The latter has been previously reported in activity targeting Hong Kong](https://citizenlab.ca/2016/04/between-hong-kong-and-burma/)**\n**[democracy activists and that activity is in turn tied to a report targeting Tibetan, Hong Kong,](https://www.arbornetworks.com/blog/asert/wp-content/uploads/2016/04/ASERT-Threat-Intelligence-Report-2016-03-The-Four-Element-Sword-Engagement.pdf)**\n**[and Taiwanese activists, and another blog about targeting Taiwanese activists.](http://pwc.blogs.com/cyber_security_updates/2016/03/index.html)**\n\n**_Figure 3. Chart showing overlaps between Reaver and SunOrcal. All IOCs are in the appendix_**\n\n**_at the end of this blog._**\n## Conclusion\n\n**The attackers behind SunOrcal, whose activity dates to at least 2013 and possibly 2010,**\n\n\n-----\n\n**known samples, among which there are three variants. It is also unique in the fact that its final�**\n**payload is in a CPL file, a technique which Palo Alto Networks has seen with only 0.006% of�**\n**all malware samples we have analyzed. The attackers used both families concurrently from**\n**late last year through November 2017 and there is some C2 infrastructure overlap between**\n**the two families, as well as links to historical reporting. We will continue to monitor these**\n**attackers for new activity and report as appropriate.**\n\n**Palo Alto Networks customers are protected by the following:**\n\n**Wildfire and Traps identifies both malware families as malicious.�**\n**The C2 domains are blocked via Threat Prevention.**\n**AutoFocus customers can monitor activity using this malware with the following tags:**\n\n**[Reaver](https://autofocus.paloaltonetworks.com/#/tag/Unit42.Reaver)**\n**[SunOrcal](https://autofocus.paloaltonetworks.com/#/tag/Unit42.SunOrcal)**\n\n## Appendix\n\n**SHA2556 – Reaver.v1**\n\n**d560f44188fb56d3abb11d9508e1167329470de19b811163eb1167534722e666**\n\n**SHA2556 – Reaver.v2**\n\n**98eb5465c6330b9b49df2e7c9ad0b1164aa5b35423d9e80495a178eb510cdc1c**\n\n**05ddbd0506ec95fb460b3994e5b21cdb0418ba4aa406374ca1b91249349b7640**\n\n**SHA2556 – Reaver.v3**\n\n**18ac3b14300ecfeed4b64a844c16dccb06b0e3513d0954d6c6182f2ea14e4c92**\n\n**c0f8bb77284b96e07cab1c3fab8800b1bbd030720c74628c4ee5666694ef903d**\n\n**9213f70bce491991c4cbbbd7dc3e67d3a3d535b965d7064973b35c50f265e59b**\n\n**26c234c73e2c3448589c7d4a0cf17f615ad3666541a4e611e2d8b77637205bcf**\n\n**ae9f158e4886cfdbfb4f1b3b25707d05f6fd873d0be9d8e7334a2c28741228ee**\n\n**1fcda755e8fa23d27329e4bc0443a82e1c1e9a6c1691639db256a187365e4db1**\n\n**c906250e0a4c457663e37119ebe1efa1e4b97eef1d975f383ac3243f9f09908c**\n\n**1813f10bcf74beb582c824c64fff63cb150d178bef93af81d875ca84214307a1�**\n\n**SHA256 – SunOrcal**\n\n**799139b5278dc2ac24279cc6c3db44f4ef0ea78ee7b721b0ace38fd8018c51ac**\n\n**81d887fefdbb0219647991c2b7bddf45c2fede4dc6fc18408f1706e0279615b2**\n\n**58312fb742ce881e040e1b5b8555f00a402b8dd4fc886acaae2f862040b3bfc5**\n\n\n-----\n\n**cb7c0cf1750baaa11783e93369230ee666b9f3da7298e4d1bb9a07af6a439f2f**\n\n**C2 domains and IP addresses**\n\n**www.tashdqdxp[.]com**\n\n**www.weryhstui[.]com**\n\n**www.fyoutside[.]com**\n\n**www.olinaodi[.]com**\n\n**104.148.70[.]217**\n\n**98.126.156[.]210**\n\n#### Got something to say?\n\n\n**Leave a comment...**\n\n\n**Notify me of followup comments via e-**\n**mail**\n\n\n**Name (required)**\n\n\n**Email (required)**\n\n\n**Website**\n\n\n**SUBMIT**\n\n\n-----\n\n**SUBSCRIBE TO NEWSLETTERS**\n\n**Email**\n\n**COMPANY**\n\n**[Company](https://www.paloaltonetworks.com/company)**\n\n**[Careers](https://www.paloaltonetworks.com/company/careers)**\n\n**[Sitemap](https://www.paloaltonetworks.com/sitemap)**\n\n**[Report a Vulnerability](https://www.paloaltonetworks.com/security-disclosure)**\n\n**LEGAL NOTICES**\n\n**[Privacy Policy](https://www.paloaltonetworks.com/legal-notices/privacy)**\n\n**[Terms of Use](https://www.paloaltonetworks.com/legal-notices/terms-of-use)**\n\n**ACCOUNT**\n\n**[Manage Subscription](https://www.paloaltonetworks.com/company/subscriptions)**\n\n**© 2016 Palo Alto Networks, Inc. All rights reserved.**\n\n\n**Email**\n\n\n**[TAKE A TEST DRIVE](http://connect.paloaltonetworks.com/virtual-utd)**\n\n\n**SUBSCRIBE**\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2017/2017.11.10.New_Malware_with_Ties_to_SunOrcal_Discovered/unit42-new-malware-with-ties-to-sunorcal-discovered.pdf"
    ],
    "report_names": [
        "unit42-new-malware-with-ties-to-sunorcal-discovered"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716498,
    "ts_updated_at": 1743041172,
    "ts_creation_date": 1510763989,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/02a66278756c7c3a068d5eff9bc05f3ae9a836cd.pdf",
        "text": "https://archive.orkl.eu/02a66278756c7c3a068d5eff9bc05f3ae9a836cd.txt",
        "img": "https://archive.orkl.eu/02a66278756c7c3a068d5eff9bc05f3ae9a836cd.jpg"
    }
}