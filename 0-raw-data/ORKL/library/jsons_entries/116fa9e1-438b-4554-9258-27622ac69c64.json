{
    "id": "116fa9e1-438b-4554-9258-27622ac69c64",
    "created_at": "2023-01-12T15:00:15.313169Z",
    "updated_at": "2025-03-27T02:09:30.209902Z",
    "deleted_at": null,
    "sha1_hash": "65bc1cd0e0ba5189656c4e09cb69eb2839eb260b",
    "title": "2022-01-19 - One Source to Rule Them All- Chasing AVADDON Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T02:36:55Z",
    "file_modification_date": "2022-05-28T02:36:55Z",
    "file_size": 994036,
    "plain_text": "# One Source to Rule Them All: Chasing AVADDON Ransomware\n\n**mandiant.com/resources/chasing-avaddon-ransomware**\n\nBlog\n\nAdrian Sanchez Hernandez, Paul Tarter, Ervin James Ocampo\n\nJan 19, 2022\n\n19 mins read\n\nRansomware\n\nAnalysis\n\nThreat Research\n\nMalware\n\nManaged Defense\n\nThe ransomware-as-a-service (RaaS) model is lowering the barrier of entry into the cybercrime world, causing the number of\nransomware attacks we're seeing to spike higher than ever before.\n\nIn the last few years, ransomware has become one of the principal sources of income in the cybercrime ecosystem, with increased\nuse of extortion by shaming victims, threatening to release exfiltrated data, and in some cases hitting them with distributed denial-ofservice (DDoS) attacks.\n\nThis blog post explores activity, similarities and overlaps between multiple ransomware families related to AVADDON ransomware,\nserving as a case study to understand how ransomware operators think and continue to turn a profit in a constantly evolving\ncybercrime ecosystem.\n\nVarious RaaS services have prevailed in compromising critical targets, leading to major impacts on victim networks and to\nsizable ransom demands. AVADDON is one of these ransomware services.\n\nThe threat actor behind the AVADDON ransomware service started activity in June 2020 and continued operations until June 2021.\nThe service was apparently shut down rapidly—and private encryption keys released—as governments prioritized the fight against\nransomware operations with new legislation and increased law enforcement operations.\n\n\n-----\n\nMandiant has observed notable overlaps between AVADDON and other ransomware families, indicating the possibility of rebranding\nin order to reintroduce itself into the RaaS business. Based on the profitability of these operations, it is almost certain that numerous\nthreat actors will continue to conduct ransomware operations.\n\n## Victimology\n\nDestructive attacks leveraging AVADDON ransomware have affected a wide variety of industries. Based on publicly named victims on\nAVADDON’s own blog post and Mandiant’s incident response investigations, we have observed AVADDON impacting industry\nverticals primarily based in North America, including education, technology, healthcare, financial and government.\n\n[Based on open-source data, AVADDON released nearly 3,000 private encryption keys, indicating that targeting is almost certainly](https://threatpost.com/avaddon-ransomware-global-crackdowns/166968/)\nbroader than directly observed.\n\nFigure 1: Industries impacted by AVADDON\n\nransomware based on publicly named victims\n\nFigure 2: Heatmap of publicly named AVADDON victims by country\n\n\n-----\n\n## AVADDON Ransomware Service\n\n[In June 2020, Mandiant reported the Russian-speaking threat actor “Avaddon” advertising the AVADDON ransomware affiliate](https://advantage.mandiant.com/reports/21-00013731)\nprogram (RaaS) on the Russian-speaking forums exploit[.]in and xss[.]is. In March 2021, the threat actor Avaddon posted an update\nfor the AVADDON RaaS to announce the development of AVADDON V2 and later that same year incorporated a DDoS feature\ndesigned to pressure victims into paying the ransom.\n\nFigure 3: AVADDON affiliate panel\n\nThe AVADDON panel seen in Figure 3, was hosted on a TOR hidden service (.onion domain) and was provided to AVADDON\naffiliates in order to monitor victims and their payments, track builds, provide a support ticketing system, and view statistics and\nrelated news publications. As typical with RaaS operations, AVADDON profits are divided according to their Terms of Service\nspecified by the AVADDON operators, initially structured with 65% profit earned for the affiliate and 35% for the operators of the\nransomware service (this is subject of change by the RaaS service). However, this could vary depending on the number of victims per\naffiliate, meaning that the profit percentage for the affiliate could be higher if the number of intrusions increased considerably.\n\n## AVADDON Affiliates\n\nMandiant identified multiple AVADDON affiliates involved in targeted destructive attacks leveraging AVADDON ransomware.\n\nFigure 4: TTPs seen through AVADDON\n\nransomware incidents\nThese attacks employed various tactics, techniques, and procedures (TTPs), including:\n\nCompromised credentials from prior intrusions. In one instance, Mandiant observed evidence of an AVADDON affiliate working\nwith an initial access broker to gain initial foothold in a victim’s environment.\nCustom malware such as BLACKCROW and DARKRAVEN web shells to maintain access and interact with a compromised\nserver.\nPublicly available remote administration tool SYSTEMBC for interacting with compromised hosts.\nWindows Remote Desktop Protocol (RDP) for lateral movement.\nWDigest downgrade attack in conjunction with SHARPDUMP or MIMIKATZ to dump clear-text credentials from memory.\nOpen-source frameworks and scripts such as EMPIRE and POWERSPLOIT for post-exploitation activity.\n\n\n-----\n\nWindows Scheduled Task for persistence.\nPublicly available scanning tools such as SoftPerfect Network Scanner for internal reconnaissance.\nPublicly available rootkit removal tools such as GMER, PowerTool, and TDSSKiller to disable system protection software.\nProtonMail service to send and receive data initially at the early stages of the intrusion.\nPublicly available archiving tool 7Zip and cloud storage synchronization tool MEGAsync for data staging and exfiltration.\n\nFrom the TTPs, Mandiant has observed heavy reliance on open-source and publicly available tooling for different purposes across\nvarious stages of the intrusion.\n\n## Connecting the Dots\n\nMandiant continues to observe sophisticated TTPs and increased collaboration between different and specialized threat actors, each\nplaying a particular role within the intrusion operation and has observed previous cases of rebranding where a new ransomware\nservice aligns with another, suggesting collaboration between ransomware operators.\n\n[Mandiant has reported on multiple cases of potential rebranding and links between RaaS such as BLACKMATTER and](https://advantage.mandiant.com/reports/21-00016834) [SABBATH](https://advantage.mandiant.com/reports/21-00024635)\n[ransomware families and reported on the possibility of rebranding on AVADDON as the RaaS shut down.](https://advantage.mandiant.com/reports/21-00013280)\n\nThreat actors behind a RaaS may choose rebranding for a variety of reasons including fixing operational security flaws and the\nperception of reducing the risk of law enforcement disrupting their operations.\n\nMandiant has tracked AVADDON and analyzed its multiple versions along with potential ransomware families with which it shares\nsimilarities. In April 2021, Mandiant identified numerous ransomware services advertising in Russian-speaking underground forums,\nusing assorted brands, yet having certain degrees of relations with AVADDON as far back as 2019, as seen in Figure 5.\n\nFigure 5: RaaS activity timeline based on\n\nforum activity, reported victims and PE timestamps\nMandiant has observed previous RaaS services operating since 2019 to 2021 connected to AVADDON source code. The variations\namong these ransomware families show an increase in maturity as the final product is improved in terms of performance and\ncryptographic functionality.\n\nThe timeline of these services and the similarities in the code may be part of the rebuilding process, suggesting collaboration between\nthreat actors or access to a shared source code by multiple threat actors.\n\nMEDUSALOCKER is ransomware that was advertised on the Russian-speaking forum xss[.]is by the threat actor ‘Scourge’ and\nreported by [Mandiant in October 2019. During 2020, the service continued to be active and was updated with new versions of the](https://advantage.mandiant.com/reports/19-00017358)\nransomware. The last activity from the threat actor in the forum was in February 2021.\n\n[Ako, also known as MedusaReborn, is ransomware that was initially observed around January 2020. Ako operations](https://advantage.mandiant.com/news/20-00000507) continued to be\nactive during 2020 and their last publicly exposed victim was added to their shaming blog in July 2020. Mandiant determined that Ako\nransomware shares numerous similarities with MEDUSALOCKER and considers Ako to be a variant of MEDUSALOCKER.\n\n[ThunderX is a ransomware that started operating in August 2020 according to PE timestamps and public reports. However, in](https://www.bleepingcomputer.com/news/security/thunderx-ransomware-rebrands-as-ranzy-locker-adds-data-leak-site/)\n[September 2020, Tesorion released a free decryptor that appears to have interrupted ThunderX operations. Mandiant determined](https://www.bleepingcomputer.com/news/security/thunderx-ransomware-silenced-with-release-of-a-free-decryptor/)\nThunderX and RANZY to be a single malware family due to numerous similarities and code overlap.\n\nRANZY, also known as “Ranzy Locker”, is a ransomware that was advertised on the Russian-speaking forums xss[.]is and exploit[.]in\nby the threat actor “Ranzycorp” in October 2020. RANZY has impacted multiple victims since late 2020, however, Mandiant did not\nobserve publicly named victims on its shaming blog or activity in these forums in 2021.\n\n## AVADDON Ransomware Analysis\n\n\n-----\n\nAVADDON encrypts files stored locally and on mapped network shares. It stops targeted processes and services prior to encrypting\nfiles. Mandiant has observed three major release versions that can be seen in Figure 5, for further detail on differences in encryption\nmethodology, see the section AVADDON Encryption Evolution.\n\nThe ransomware contains host reconnaissance capabilities to retrieve the system’s Language Code Identifier (LCID) and keyboard\nlayout (Figure 6) and exits if the following languages are found: Russian, Ukrainian, Tatar (Russian) or Sakha (Russian). This is\nconsistent with one of the mandatory policies to which AVADDON affiliates must adhere: the total prohibition of ransomware\noperations within the Commonwealth of Independent States (CIS) territory.\n\nFigure 6: Checks against language and\n\nkeyboard layout passlist; AVADDON will exit if any of the languages are detected\nAVADDON operates similarly to other ransomware samples and contains an embedded configuration. AVADDON’s configuration is\nstored in the form of global stdstring variables that are initialized prior to main as a C++ global initializer. The strings are decoded as\nthey are needed during execution. All configuration encoding is performed using Base64 and multiple iterations of arithmetic\noperations utilizing a hardcoded single-byte key that varies per binary. Figure 7 is an example python script used for decoding\nconfiguration data found in sample hash (MD5:ae663fa3b803d8c23e98373fa3f66d21).\n\nFigure 7: AVADDON string decoding function\n\n```\nfrom base64 import b64decode\n\n```\n```\ndef decode_string(b64_string):\n\n```\n```\n  return ''.join([chr(((x-5)^0xb3)&0xff) for x in b64decode(b64_string)])\n\n```\n\nAVADDON’s execution flow begins by stopping and deleting services and processes that might interrupt its operation (Figure 8). Next,\nthe configuration runs multiple commands that prevent a user from restoring from backup (Table 1). Finally, the ransomware begins\nits encryption operation by recursively iterating local drives and network shares while avoiding directories (Figure 9) and files with\nspecific extensions (Figure 10).\n\nAVADDON searches the following strings related to virtual machines, backups and antivirus services to stop and delete them:\n\nFigure 8: Services to stop and delete\n\n\n-----\n\nccEvtMgr\n\nccSetMgr\n\nCulserver\n\ndbeng8\n\ndbsrv12\n\nDefWatch\n\nIntuit.QuickBooks.FCS\n\nmsmdsrv\n\nQBCFMonitorService\n\nQBIDPService\n\nRTVscan\n\nSavRoam\n\nsqladhlp\n\nSQLADHLP\n\nsqlagent\n\nsqlbrowser\n\nsqlservr\n\nsqlwriter\n\ntomcat6\n\nVMAuthdService\n\nVMnetDHCP\n\nVMUSBArbService\n\nvmware-usbarbitator64\n\nvmware-usbarbitator64\n\nVMwareHostd\n\nThe following processes are stopped. The ransomware stores a short-hand form of the full process name, but it does not appear to\nbe used during process identification or termination.\n\nTable 1: Processes to terminate\n\n**Process Name** **Short Form**\n\n360doctor.exe 0doct\n\n360se.exe 0se.e\n\naxlbridge.exe lbrid\n\nCulture.exe lture\n\nDefwatch.exe fwatc\n\nfdhost.exe host.\n\n\n-----\n\nfdlauncher.exe launc\n\nGDscan.exe scan.\n\nhttpd.exe tpd.e\n\nMsDtSrvr.exe DtSrv\n\nQBCFMonitorService CFMon\n\nQBDBMgr.exe DBMgr\n\nQBIDPService.exe IDPSe\n\nqbupdate.exe updat\n\nQBW32.exe W32.e\n\nRAgui.exe gui.e\n\nRTVscan.exe Vscan\n\nsqlbrowser.exe lbrow\n\nsqlmangr.exe lmang\n\nsqlservr.exe lserv\n\nsupervise.exe pervi\n\nwinword.exe nword\n\nwxServer.exe Serve\n\nwxServerView.exe Serve\n\ntomcat6.exe mcat6\n\njava.exe va.ex\n\nwdswfsafe.exe swfsa\n\nAVADDON deletes the Windows shadow volumes and empties the recycle bin to avoid file recovery. Next, it executes the antirecovery commands in Figure 9. Finally, to prevent the system from restarting, AVADDON leverages the Windows Restart Manager\nby adding files actively being encrypted to the Restart Manager registry.\n\nFigure 9: Anti-recovery commands\n\n\n-----\n\n```\nwmic.exe SHADOWCOPY /nointeractive\n\n```\n```\nwbadmin DELETE SYSTEMSTATEBACKUP\n\n```\n```\nwbadmin DELETE SYSTEMSTATEBACKUP -d\n\n```\n```\nbcdedit.exe /set {default} bootstatuspolicy ignoreallfailures\n\n```\n```\nvssadmin.exe Delete Shadows /All /Quiet\n\n```\n\nThe following directories are excluded from the encryption process and are consistent across different versions of AVADDON.\n\nFigure 10: Directories excluded from encryption\n\nC:\\Windows\n\nC:\\Program Files\n\nC:\\Users\\All Users\n\nC:\\Users\\Public\n\nC:\\Users\\user\\AppData\\Local\\Temp\n\nC:\\Program Files (x86)\n\nC:\\Users\\user\\AppData\n\nC:\\ProgramData\n\nC:\\Program Files\\Microsoft\\Exchange Server\n\nC:\\Program Files (x86)\\Microsoft\\Exchange Server\n\nC:\\Program Files\\Microsoft SQL Server\n\nC:\\Program Files (x86)\\Microsoft SQL Server\n\nAdditionally, directories containing the following keywords are excluded.\n\nFigure 11: Directories containing these keywords are also skipped\n\nSYSTEMDRIVE\n\nUSERPROFILE\n\nPROGRAMFILES(x86)\n\nProgramData\n\nProgram Files\n\nALLUSERSPROFILE\n\nAppData\n\nPUBLIC\n\nTMP\n\nTor Browser\n\nMSOCache\n\nEFI\n\nWhen encrypting the filesystem, the following extensions are excluded to ensure the system can be recovered after paying the\nransom with the provided decryptor.\n\nFigure 12: File extensions excluded\n\n\n-----\n\n.bin\n\n.sys\n\n.ini\n\n.dll\n\n.lnk\n\n.dat\n\n.exe\n\n.drv\n\n.rdp\n\n.prf\n\n.swp\n\n.mdf\n\n.mds\n\n.sql\n\n## Host Survey\n\nThe ransomware includes a host survey as part of the ransom note. The host survey is comprised of two parts that are separated by\na hyphen character and then Base64 encoded. The first part is a plaintext victim id, the second part is an RSA encrypted JSON\nstructure of data containing the fields in Figure 13.\n\n**Structure** **Description**\n\next Encrypted file extension\n\nrcid AES key and file extension encrypted with RSA key and stored in hex format\n\nhdd Detected and connected drives to the host\n\nhdd.name Drive letter A-Z\n\nhdd.size Drive size in GB\n\nhdd.type Drive type local/network\n\nlang Default locale language\n\nname Hostname\n\nThe following is an example JSON string containing the information gathered from the compromised system. This JSON string is not\nwritten to disk and is only stored in memory.\n\nFigure 14: JSON blob containing host, user and encryption details\n\n\n-----\n\n{\n\n\"ext\": \".eDDDbCADB\",\n\n\"rcid\": \"796249FF39A076F96C3261D0913FEEF832759C1D2CA83DA9AF38D582B8C3E638E71F73\n\n206D405BC60C0DFBC18DF9E0E8C404F8FE396D60BF7C478F0B74ACF678A163BC021AC53\n\n82F683088E871687EF1F5D70E137152B90C4F5FB025CFF70DBC679259B2DAEE3A76D2AB\n\nC5B6FD8CB1B7105DAD21D816A736239500BEB95BFA2538A5732A660B31571D36E22C55\n\nE7C1B86B94B31D1208C1D6D077A2D52F65FD12F8A1E18FD63557DA0FEAF2781694DECD\n\n7BA0080464401EBBED45E2213B15D868DF2384D0369D50BA075EDB852AFB8406D735B0\n\n0EBD56A73FEB304F18B9A92C63C333A1CB90E2AFBFFDD1F4B1666BF37F8B75A7DD3014\n\nA3A00F8C4FC09589B186F498C9ACC510EA05B7BA3C5BA44723DEE00CC905230AB6E4C9\n\n0C6DA3F703CD3AAE1003479DBF4707E2060BCC2E1316E4C05BFBAEB508C6A99107042D\n\n37C92B50E468D805C67690788AC6B6A1A1BDEE3C2F87236F74A2868AA76E48E010F8C4\n\nCDB998DEE1C47C946BAF596D315C1AB40D14A3E248072F5677D0CE5B1C3621F753E466\n\nAD438ABA7726CC46C85F697890BEC2F414D18B752180721D4E05B496790FFE45C505D9\n\n756ABE6368CFE6D89EE36013A6BB20D7B27613D275E7D7AD2B7EA1FED7D729526F5D7\n\nD5E58AF3A90F01A2F0C257842D8B9909EA32FC82ED8D2A6B8361E058CBA08BA43C633F\n\n1F9B37E96671DFBBB3F0B8F80A7CB0271FA66990F30\",\n\n\"hdd\": [{\n\n\"name\": \"C\",\n\n\"size\": 118,\n\n\"type\": \"local\"\n\n},\n\n{\n\n\"name\": \"D\",\n\n\"size\": 0,\n\n\"type\": \"local\"\n\n}\n\n],\n\n\"lang\": \"English\",\n\n\"name\": \"DESKTOP-AA1OUBT\"\n\n}\n\n[Earlier builds of AVADDON ransomware had a User Access Control (UAC) bypass module to abuse CMSTPLUA COM interface. This](https://gist.github.com/api0cradle/d4aaef39db0d845627d819b2b6b30512)\n[UAC bypass is common and has been used by multiple ransomwares such as DARKSIDE due to its easy implementation and the](https://www.mandiant.com/resources/shining-a-light-on-darkside-ransomware-operations)\navailability of public Proof of Concept (PoC) code. AVADDON added modifications over time and removed the UAC bypass.\n\n## AVADDON Encryption Evolution\n\nInitially, AVADDON generated a single AES-256 key residing in memory during the encryption process, this key would stay resident\nuntil the process exited and was used to encrypt every file. This allowed researchers to develop a decryptor tool released in February\n[2021 on GitHub, abusing this flaw and dumping the cryptographic materials from the suspended process. Developers of the](https://github.com/JavierYuste/AvaddonDecryptor)\nransomware fixed this issue by generating a single AES key per file being encrypted.\n\nAVADDON, when initially released, used a single AES key for encrypting all files. There are three ways to recover a file’s AES\nsession key:\n\nThe ransom note, as part of the victim ID, requires attackers’ private RSA key.\nEach file has a footer appended that contains the session key used to encrypt the file. The key can be extracted with the private\nRSA key.\nFind the session key resident in memory.\n\nAVADDON later moved to using a “one key per file” method which resolved the third item of finding a key resident in memory. The\nother two methods require a private key and are therefore protected. One interesting note: the AES key generated and stored in the\nransom note for later versions is never used, only the session keys stored in the file are correct, this is remnant of moving to a “one\n\n\n-----\n\nkey per file methodology vs a single key that could be stored once.\n\nAnalysis across AVADDON samples containing the file encryption fix showed the replacement of the used C++ structures for global\nvariables indicating a quick fix was made by the threat actors developing AVADDON.\n\nSamples observed later in 2021 with PE timestamps of April 2021 include improvements such as the addition of IOCompletionPort\nmultithreading and the replacement of these global variables again for structures just like the original release.\n\nThis indicates that the threat actor implemented a quick fix after the release of the PoC decryptor to continue with the operations\nwhile improved and more consistent versions of the software were under development.\n\nAdditionally, latest versions of AVADDON had a function to force the restart of the victim host in safemode prior to encrypting the\nfilesystem by providing the command line parameter “-safe” to the encryptor executable; mimicking other RaaS services that\nimplemented similar features in attempt to bypass Antivirus and EDR software.\n\n## Ransomware Similarities and Technical Comparison\n\nMandiant analyzed multiple samples of MEDUSALOCKER, Ako, ThunderX, AVADDON and RANZY, finding multiple similarities\nbetween these ransomwares including the programming language, code similarities and functionalities, many of these can be\nobserved in Figure 15.\n\nAdditionally, there’s a significant overlap in their infrastructure as Ako and RANZY used the same Tor onion address\n7rckgo66iydpvgpwve7b2el5q2zhjw4tv4lmyewufnpx4lhkekxkoqd[.]onion.\n\nThis Tor site was used for the purposes of shaming victims and coercing them to pay ransom demands, showing another degree of\nrelationship between them.\n\nSimilar PDB strings have been seen across multiple samples of MEDUSALOCKER, ThunderX (MD5:\nfedadfa6ce199900ca0a6a1f588f8beb), RANZY (MD5: d3774470f4a1b2451fb314d6c37a7763) and in a sample of AVADDON\ndecryptor (MD5: 01422fd3eec0d1a0ce238df01edf8a50) contributing to show potential links between them.\n\nNote that both ThunderX and RANZY share the same PDB string.\n\nExample PDB paths:\n\nC:\\Users\\Gh0St\\Desktop\\MedusaLockerInfo\\MedusaLockerProject\\MedusaLocker\\Release\\MedusaLocker.pdb\nC:\\Users\\Gh0St\\Desktop\\MedusaLockerInfo\\MedusaLockerProject\\MedusaLocker\\Debug\\MedusaLockerXP.pdb\nC:\\Users\\Gh0St\\Desktop\\MedusaLockerInfo\\MedusaLockerProject\\MedusaLocker\\Release\\MedusaLockerXP.pdb\nC:\\Users\\Gh0St\\Desktop\\MedusaLockerInfo\\MedusaLockerProject\\MedusaLocker\\Debug\\MedusaLocker.pdb\nC:\\Users\\Gh0St\\Desktop\\MedusaLockerInfo\\MedusaLockerProject_v2\\MedusaLocker\\Debug\\MedusaLocker.pdb\nC:\\Users\\Gh0St\\Desktop\\AvaddonProjectInfo\\AvaddonProject\\AvaddonLockerLite\\Release\\AvaddonUnlockerGlobalLiteXPStub.pdb\nC:\\Users\\Gh0St\\Desktop\\ThunderX\\Release\\LockerStub.pdb\n\n**Feature** **MEDUSALOCKER** **Ako*** **AVADDON** **ThunderX*** **RANZY**\n\n**Programming Language** C++ C++ C++ C++ C++\n\nAES-256 CBC AES-256 CBC AES-256 CBC Salsa20 Salsa20\n\n\n**Symmetric Encryption**\n\n\nRSA RSA RSA RSA RSA\n\n\n**Asymmetric Encryption**\n\n\n**Key Generation** Same key per\nexecution\n\n\nSame key per\nexecution\n\n\nDepends on version Unique key\nper file\n\n\nUnique key\nper file\n\n\n**Language check** No No Yes No No\n\n\n-----\n\n**UAC bypass** CMSTPLUA COM\ninterface\n\n\nNo CMSTPLUA COM interface,\ndepends on version\n\n\nNo No\n\n\n**Network discovery**\n**technique**\n\n\n**Process and service**\n**termination similarity**\n\n\nICMP ICMP ARP, depends on version ICMP ICMP\n\nYes No Yes Yes Yes\n\n\nFigure 15: Table showing similarities between ransomware\n\n*Ako (MEDUSALOCKER variant)\n\n*ThunderX (RANZY variant)\n\n### Encryption Operations\n\nCode reuse appeared very similar throughout initializing a cryptographic context for all of them. After analyzing each ransomware\nextensively, many functions had the same architecture and similar structure for storage and were found to always be evident and\neasy to pick out once reversing a sample.\n\nBetween the five ransomware, there are four modes of file encryption supported describing how much of the file to encrypt and in one\ncase wiping the contents of the file instead of encrypting. These modes are the same across each ransomware.\n\n### File Signature\n\nMEDUSALOCKER initially did not use file signature to append to the encrypted files, however Ako appends the hex value\n0xBEEFCACE.\n\nAVADDON appends the hex value 0x1030307 to the end of the file within a 24-byte structure.\n\nRANZY and ThunderX use the signature hex value 0xB0E0E0F0.\n\nThese signatures are part of a 24-byte structure that is very similar across all of them, prior to this footer is the file’s session key\nencrypted with the attacker’s public key.\n\n### Identifier Format\n\nAko, ThunderX and RANZY construct highly similar JSON blobs that are encoded and written to the ransom notes. These contain\nmultiple keywords that overlap between them.\n\nAko and AVADDON written identifiers contain similarities and overlap some keywords, however, AVADDON constructs a larger JSON\n(seen in Figure 14) and uses additional keywords not present in Ako.\n\n### Obfuscation\n\nMEDUSALOCKER and Ako contain plain text strings and only the RSA key blob is base64 encoded. AVADDON, ThunderX and\nRANZY have different implementations to obfuscate both the RSA key and the strings.\n\n### UAC Bypass\n\nMEDUSALOCKER and AVADDON use a similar UAC bypass functionality abusing the CMSTPLUA COM interface while ThunderX\nand RANZY don’t include a bypass.\n\n### Backup Deletion\n\nThe ransomware families delete backups by executing very similar command arguments to delete the Windows Shadow Copies\ninvoking wbadmin, bcedit.exe and vssadmin.exe and to empty the recycle bin.\n\n### Service and Process Enumeration\n\nThese pieces of ransomware use a remarkably similar list of process and services to scan and stop if found and following a similar\norder. However, AVADDON contains more processes and services related to VMWare, Antivirus, SQLServer and Tomcat services\nand processes.\n\n\n-----\n\nThunderX and RANZY have different process and services lists and only some overlap. Additionally, the list of services to stop is\nconsiderably shorter than the rest of the ransomware, while the list of processes is larger.\n\n### File and Directory Exclusions\n\nMEDUSALOCKER and AVADDON contain nearly identical file and directory exclusions, however, AVADDON contains additional\ndirectories that are skipped including TOR browser directories and a shorter list of file extensions skipped from the encryption\nprocess.\n\n### Network Scanning\n\nMEDUSALOCKER, Ako, ThunderX and RANZY contain similar code to scan the victim’s network by using IcmpSendEcho function.\n\nFirst builds identified for AVADDON rely on SendARP function, however, some of the AVADDON samples with PE timestamps from\nFebruary 2021 show a replacement in the network reconnaissance module to use the IcmpCreateFile and IcmpSendEcho functions.\n\n### Other Differences\n\nDifferent versions of AVADDON have added exclusion folders and it can receive a CLI argument.\nThunderX and RANZY can receive the CLI argument –nolan.\n\n## Conclusion\n\nThe similarities between these ransomware families and the timespan of activity suggest that the MEDUSALOCKER code base was\nlikely reused by different threat actors that started operating RaaS in 2020. The binary similarities and techniques used show a\ncertain degree of relationship between them. However, the technical skills of each threat actor involved in the development of these\nRaaS and the implementations vary per ransomware.\n\nAVADDON constitutes a considerable evolution compared to MEDUSALOCKER, however, it is unclear whether AVADDON was the\nsuccessor of MEDUSALOCKER due to technical differences and overlap in their activity. The AVADDON service was operational for\nabout a year and gained considerable popularity among threat actors to extort victims across multiple regions and industries until\nevents forced a fast exit followed by the shutdown of its operations and the release of the victim's private keys.\n\nGiven the similarities suggesting code overlap between these ransomware families, the different skillsets of the involved operators\nand the overlap in time, it is unclear whether the Law Enforcement disruption of ransomware operations at this time will be definitive\nfor the threat actors responsible for AVADDON.\n\nRebranding, code sharing, or the purchase of source code by different threat actors are practical possibilities to get back into\nextortion operations as seen in previous cases such as SODINOKIBI’s [connections with GANDCRAB ransomware, or the rebuild and](https://advantage.mandiant.com/news/19-00012140)\n[rebrand of a new ransomware using another’s code base such as BLACKMATTER.](https://advantage.mandiant.com/reports/21-00016834)\n\n## Appendix: ATT&CK Mapping\n\n**ATT&CK Tactic Category** **Techniques**\n\nResource Development Acquire Infrastructure (T1583)\n\n                -   Virtual Private Server (T1583.003)\n\nInitial Access External Remote Services(T1133)\n\n                -   Valid Accounts(T1078)\n\nExecution User Execution (T1204)\n\n                -   Malicious File (T1204.002)\n\nScheduled Task/Job (T1053)\n\n              - Scheduled Task (T1053.005)\n\n\n-----\n\nPersistence Valid Accounts (T1078)\n\nBoot or Logon Autostart Execution (T1547)\n\n               - Registry Run Keys / Startup Folder (T1547.001)\n\nPrivilege Escalation Valid Accounts (T1078)\n\nDefense Evasion Impair Defenses (T1562)\n\n                -   Disable or Modify Tools (T1562.001)\n\nObfuscated Files or Information (T1027)\n\n              - Software Packing (T1027.002)\n\nProcess Injection (T1055)\n\nIndicator Removal on Host (T1070)\n\n               - File Deletion (T1070.004)\n\nModify Registry (T1112)\n\nDeobfuscate/Decode Files or Information (T1140)\n\nVirtualization/Sandbox Evasion (T1497)\n\n              - System Checks (T1497.001)\n\nCredential Access OS Credential Dumping (T1003)\n\nDiscovery Account Discovery (T1078)\n\nDomain Trust Discovery (T1482)\n\nPermissions Groups Discovery (T1069)\n\nLateral Movement Remote Services (T1021)\n\n               -   Remote Desktop Protocol (T1012.001)\n\nCollection Archive Collected Data (T1560)\n\n                 -   Archive via Utility (T1560.001)\n\nCommand and Control Application Layer Protocol (T1071)\n\n               -   Web Protocols (T1071.001)\n\nEncrypted Channel (T1573)\n\nIngress Tool Transfer (T1105)\n\nExfiltration Exfiltration Over Web Service (T1567)\n\n                -   Exfiltration to Cloud Storage (T1567.002)\n\n## Mandiant Security Validation Action\n\nOrganizations can validate their security controls using the following actions with Mandiant Security Validation.\n\n**VID** **Name**\n\n\n-----\n\nA151-063 Command and Control - AVADDON, DNS Query, Live Host Check\n\nA151-064 Host CLI - AVADDON, bcdedit Commands\n\nA151-067 Malicious File Transfer - AVADDON, Download, Variant #1\n\nA151-069 Protected Theater - AVADDON, Execution\n\nA151-085 Protected Theater - AVADDON, Execution, Windows 10 Variant\n\nA151-086 Protected Theater - AVADDON, Execution, Windows 7 Variant\n\nA104-775 Protected Theater - WMIC Shadowcopy Delete, Variant #1\n\n## Appendix: Malware definitions\n\n### AVADDON\n\nAVADDON is ransomware written in C++ that encrypts files stored locally and on mapped network shares. AVADDON terminates\ntargeted processes and services prior to encrypting files. AVADDON uses the AES-256 encryption algorithm to encrypt files.\nAVADDON is a Windows ransomware written in C++. It is run as an affiliate program, RaaS. System files are encrypted using a single\nAES-256 key. The AES-256 key is generated at run-time and encrypted using an embedded RSA public key. The malware also has\nanti-analysis techniques and check that it is not running in a system with Russian language.\n\n### MEDUSALOCKER\n\nMEDUSALOCKER is ransomware written in C++ that encrypts files stored locally and on network shares with a randomly generated\nAES-256 key. MEDUSALOCKER can bypass User Account Control (UAC) and terminates targeted processes and services prior to\nencrypting files. Persistence is established using a scheduled task. MEDUSALOCKER empties the Recycle Bin and delete volume\nshadow copies.\n\n### RANZY\n\nRANZY is a ransomware written in C++ that encrypts files stored locally and on mapped network shares appending the extension \"\n\n[.]ranzy\" to them. RANZY uses Salsa20 stream cipher to encrypt files.\n\n### DARKRAVEN\n\nDARKRAVEN is an ASPX webshell written in C# that functions as a backdoor. The backdoor supports shell command execution and\nfile transfer. Supplied data is decrypted and decoded using 3DES and a custom Base64 decoding routine.\n\n### BLACKCROW\n\nBLACKCROW is an ASPX webshell written in VB[.]NET that functions as backdoor. BLACKCROW expects an attacker to upload a\n\n[.]NET DLL payload alongside additional arguments. These arguments are used to invoke a series of methods within the DLL. The\nresults of the final invocation are displayed to the attacker.\n\n### SYSTEMBC\n\nSYSTEMBC is a tunneler written in C that retrieves proxy-related commands from a C2 server using a custom binary protocol over\nTCP. A C2 server directs SYSTEMBC to act as a proxy between the C2 server and a remote system. SYSTEMBC is also capable of\nretrieving additional payloads via HTTP. Some variants may utilize the Tor network for this purpose. Downloaded payloads may be\nwritten to disk or mapped directly into memory prior to execution. SYSTEMBC is often utilized to hide network traffic associated with\nother malware families. Observed families include DANABOT, SMOKELOADER, and URSNIF.\n\n## Acknowledgements\n\nAdvanced Practices team, FLARE team, Threat Pursuit team and Yash Gupta\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-01-19 - One Source to Rule Them All- Chasing AVADDON Ransomware.pdf"
    ],
    "report_names": [
        "2022-01-19 - One Source to Rule Them All- Chasing AVADDON Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535615,
    "ts_updated_at": 1743041370,
    "ts_creation_date": 1653705415,
    "ts_modification_date": 1653705415,
    "files": {
        "pdf": "https://archive.orkl.eu/65bc1cd0e0ba5189656c4e09cb69eb2839eb260b.pdf",
        "text": "https://archive.orkl.eu/65bc1cd0e0ba5189656c4e09cb69eb2839eb260b.txt",
        "img": "https://archive.orkl.eu/65bc1cd0e0ba5189656c4e09cb69eb2839eb260b.jpg"
    }
}