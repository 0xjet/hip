{
    "id": "092d1b41-fead-4769-bd4e-1effdfd85dc1",
    "created_at": "2023-01-12T15:03:07.982513Z",
    "updated_at": "2025-03-27T02:05:37.2923Z",
    "deleted_at": null,
    "sha1_hash": "aff6effaee2d7069958c0439b0c00a274fdec427",
    "title": "2021-05-28 - A new ransomware enters the fray- Epsilon Red",
    "authors": "",
    "file_creation_date": "2022-05-27T21:51:47Z",
    "file_modification_date": "2022-05-27T21:51:47Z",
    "file_size": 2535587,
    "plain_text": "# A new ransomware enters the fray: Epsilon Red\n\n**news.sophos.com/en-us/2021/05/28/epsilonred/**\n\nAndrew Brandt May 28, 2021\n\nIn the past week, Sophos analysts uncovered a new ransomware written in the Go programming language that calls itself\n**Epsilon Red. The malware was delivered as the final executable payload in a hand-controlled attack against a US-based**\nbusiness in the hospitality industry in which every other early-stage component was a PowerShell script.\n\nBased on the cryptocurrency address provided by the attackers, it appears that at least one of their victims paid a ransom of\n4.29BTC on May 15th (valued at roughly $210,000 on that date).\n\nWhile the name and the tooling were unique to this attacker, the ransom note left behind on infected computers resembles\nthe note left behind by REvil ransomware, but adds a few minor grammatical corrections. There were no other obvious\nsimilarities between the Epsilon Red ransomware and REvil.\n\nIt appears that an enterprise Microsoft Exchange server was the initial point of entry by the attackers into the enterprise\nnetwork. It isn’t clear whether this was enabled by the ProxyLogon exploit or another vulnerability, but it seems likely that the\nroot cause was an unpatched server. From that machine, the attackers used WMI to install other software onto machines\ninside the network that they could reach from the Exchange server.\n\nThe name Epsilon Red, like many coined by ransomware threat actors, is a reference to pop culture. The character Epsilon\nRed was a relatively obscure adversary of some of the X-Men in the Marvel extended universe, a “super soldier” alleged to\nbe of Russian origin, sporting four mechanical tentacles and a bad attitude.\n\n## Laying the groundwork using PowerShell\n\nDuring the attack, the threat actors launched a series of PowerShell scripts, numbered 1.ps1 through 12.ps1 (as well as\nsome that just were named with a single letter from the alphabet), that prepared the attacked machines for the final\nransomware payload and, ultimately delivered and initiated it.\n\n\n-----\n\nThe PowerShell orchestration was, itself, created and triggered by a PowerShell script named RED.ps1 that was executed\non the target machines using WMI. The script retrieves and unpacks into the system32 folder a .7z archive file that contains\nthe rest of the PowerShell scripts, the ransomware executable, and another executable.\n\nIt also sets up Scheduled Tasks that run the scripts numbered 1 through 12 but skips 7 and 8, it also creates tasks for scripts\nnamed “S” and “C.”\n\nA typical Scheduled Task command looked like:\n```\nC:\\Windows\\system32\\schtasks.exe /create /tn Microsoft\\Windows\\TASK12 /tr \"powershell -file\nc:\\windows\\system32\\RED\\12.ps1\" /sc minute /mo 2 /ru SYSTEM /f\n\n```\nFor example, when attackers ran the 2.ps1 script on a machine, it executed a command that deleted the Volume Shadow\nCopies from the computer. This is an important precursor to the attack, as these files could be used to recover some or all of\nthe files encrypted by the attackers.\n\n[A PowerShell script named c.ps1 appears to be a clone of an open source tool called Copy-VSS, part of a suite of](https://github.com/samratashok/nishang/blob/master/Gather/Copy-VSS.ps1)\npenetration tester tools named Nishang. The Copy-VSS script permits an attacker to copy the SAM file, which an attacker\ncould use to retrieve and crack passwords saved on the computer.\n\n## Obscured…Just Enough\n\nThe PowerShell scripts also use a rudimentary form of obfuscation in which the threat actors appear to have added in some\nsquare brackets and braces at random into the script, breaking up the lines of PowerShell script code, and then use a\ncommand that strips out those brackets.\n\nWhile this technique doesn’t have much of an effect on our ability to analyze the files after the fact, it might be just good\nenough to evade the detection of an anti-malware tool that’s scanning the files on the hard drive for a few minutes, which is\nall the attackers really need.\n\n\n-----\n\n[We were able to use the same rules the attackers set up to craft a recipe using CyberChef that strips out the extraneous](http://bit.ly/epsilonred-cleanup)\ncharacters and renders the script human-readable.\n\n## Blocked firewall ports and cleaning up tracks\n\nThe red.ps1 script unpacks RED.7z into the %SYSTEM%\\RED directory, then creates scheduled tasks that run the\nunpacked scripts. But then it waits one hour, and executes commands that modify the Windows Firewall rules such that the\nfirewall blocks inbound connections on all TCP ports except the Remote Desktop Protocol’s 3389/tcp and the\n[communications port used by a commercial tool called Remote Utilities, 5650/tcp.](https://www.remoteutilities.com/)\n\nFirewall rules\n\nmodified by the RED.ps1 script\nOddly, it does this by first blocking inbound traffic to ports 80 and 443, then redundantly blocks entire large ranges of ports\nthat include 80 and 443, but also exclude the RDP and Remote Utilities ports: 1-3388, 3390-5649, and 5651-65352.\n\nEpsilon Red firewall\n\nrules appear in the Windows Firewall UI\nUpon closer inspection, one of the first things the attackers did after gaining access to the target’s network was to download\nand install a copy of Remote Utilities and the Tor Browser, so this seems like a way to reassure themselves they will have an\nalternate foothold if the initial access point gets locked down.\n\n## An unusual commercial remote access tool\n\nThe commercial Remote Utilities software, used by the criminals, has several features they might find helpful.\n\nFor one thing, they can use it for free. Anyone can submit an email address through the company’s website and receive a\nfree license key by email that allows them to use the full capability of the product on up to 10 machines, in perpetuity.\n\n\n-----\n\nThe company s Viewer software includes the ability for a licensed user to generate a digitally signed executable installer,\npre-configured with a password and other preferences embedded into the .exe. Users choose their options, which get\ntransmitted back to the company via the application to generate a unique “One-Click package” executable the program then\ndownloads. The threat actor can then deploy this installer, which runs unattended, and automatically synchronizes to their\nRemote Utilities Viewer console.\n\nThe console also serves as a Remote Desktop client utility, as a convenience.\n\nBoth rutserv.exe samples are\n\ndigitally signed with Remote Utilities’ certificate\nWe found that the attackers had generated at least two of these “One-Click installer” executables, which they downloaded to\nseveral machines on the target’s network and ran. The installer was named rutserv.exe and the attackers stored it in\ndifferent filesystem locations on different machines they downloaded it to.\n\n## Running down the orchestration scripts\n\nInitially, the malware runs the scripts numbered 9 and 12, this is followed by a 180 second delay, before then creating the\ntasks for 1 through 6, 10, 11, and S.ps1 and C.ps1. By default, the attackers extracted these les to a folder named RED\nunder the %SYSTEM% path. Each of these scripts accomplishes a specic task the threat actors use to prepare the system\nprior to launching the ransomware. Many of these tasks involve hindering security or backup tools, but also involve disabling\nor killing processes that, if they were running, might prevent a complete encryption of the valuable data on the hard drive.\n\n\n-----\n\nThe\n\nRED.ps1 script executes 12 of the 14 PowerShell scripts by adding them to the Task Scheduler\nIt isn’t clear whether the attackers were just being thorough or if they weren’t sure they could do what they set out to do, but\nin several cases the scripts issue redundant commands to accomplish the same goal using slightly different methods.\n\nFor instance, the 1.ps1 file looks for processes that contain any of the following strings in their process name, and attempts\nto kill them:\n```\n'sql','Sql','SQL','BASup','Titan','SBAM','sbam','vipre','Vipre','Cylance','cylance','Senti','senti','sql','backup',\n\n```\nThese strings indicate the attackers are not only trying to shut down security tools, but also database services, backup\nprograms, office applications, email clients, QuickBooks, and even Steam, the gaming platform.\n\n**2.ps1 deletes all the Volume Shadow Copies on the system by running a single command (vssadmin.exe delete shadows**\n/all /quiet), while 3.ps1 disables automatic repairs that Windows might try to run upon a reboot.\n\n**4.ps1 then attempts to delete the Volume Shadow Copies using a different method:**\n\nwmic shadowcopy delete /nointeractive\n\nGet-WmiObject Win32_ShadowCopy | % { $_.Delete() }\n\nGet-WmiObject Win32_ShadowCopy | Remove-WmiObject\n\nGet-WmiObject Win32_Shadowcopy | ForEach-Object { $_Delete(); }\n\nGet-CimInstance Win32_ShadowCopy | Remove-CimInstance\n\n**5.ps1 executes two commands that, between them, delete Windows Event Logs, which would hinder an investigation.**\n\nSimilarly to 1.ps1, 6.ps1 attempts to kill not processes but services, based on a list of strings that may appear in the\nservices’ names:\n\n‘sql’,’Sql’,’SQL’,’BASup’,’Titan’,’Cylance’,’cylance’,’Defend’,’NisSvc’,’Veeam’,’veeam’,’backup’,’Backup’,’rsa’,’wrsa’,’WRSA’,’RSA’\n\nIt also disables Windows defender by setting the following Windows Registry key:\n\nreg add “HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows Defender” /f /v DisableAntiSpyware /t REG_DWORD /d\n\n**9.ps1, which is executed rst, attempts to invoke the Uninstaller for security software from Sophos, Trend Micro, Cylance,**\nMalwareBytes, Sentinel One, Vipre, Webroot, and several cloud backup agents\n\n**10.ps1 then, redundantly, runs the dropped p.exe executable, which suspends the processes that contain the following**\nstrings, and clears their logs:\n```\n'MpCmd','MsMp','Senti','senti','sql','backup','veeam','outlook','word','excel','office','ocomm','dbsnmp','onenote',\n\n```\nAnd 11.ps1 adds yet another layer of redundancy, executing the following commands that delete Volume Shadow Copies\n(again, for the third time!) as well as changing recovery options and clearing event logs in yet another way.\n\n\n-----\n\nvssadmin.exe Delete Shadows /All /Quiet,\n‘bcdedit /set {default} recoveryenabled no’,\n‘wmic shadowcopy delete’,\n‘wbadmin delete backup’,\n‘wbadmin delete systemstatebackup -keepversions:0’,\n‘bcdedit /set {default} bootstatuspolicy ignoreallfailures’,\n‘bcdedit /set {default} recoveryenabled no’,\n‘wevtutil.exe clear-log Application’,\n‘wevtutil.exe clear-log Security’,\n‘wevtutil.exe clear-log System’,\n‘wbadmin delete systemstatebackup’,\n‘wbadmin delete catalog -quiet’,\n‘bootstatuspolicy ignoreallfailures’\n\nThis level of redundancy may be an indication that this threat actor is unsure of their own tools’ capabilities, but aren’t willing\nto take any chances.\n\n**12.ps1 grants the “Everyone” group access permissions to every drive letter that might exist on the machine to ensure as**\nmany les are encrypted as possible.\n\nScheduled Tasks set up by the RED.ps1 script\nThe red.ps1 script also deletes itself, the .7z archive, and the local copy of 7zip from the system when it runs, removing key\nevidence.\n\nIn addition to the ransomware executable itself, Labs recovered and analyzed another ancillary executable that the attackers\ndeployed on the target machines. The file, just called p.exe, appears to be a custom-compiled version of an open source\n[tool called EventCleaner, which was created to erase or manipulate the contents of Windows event logs. The attackers used](https://github.com/QAX-A-Team/EventCleaner)\nthe p.exe component to clean up evidence of what they had done.\n\nWe also mentioned that there were other PowerShell scripts delivered in the .7z archive the attackers dropped on targeted\nmachines. While we saw no evidence they were executed in the context of this attack, the scripts numbered 7, 8, and 9\nserve important purposes. 7.ps1 logs off practically all open sessions on the computer; 8.ps1 is a redundant copy of the\nsame firewall rules script included in RED.ps1.\n\n## Bare-bones ransomware\n\nThe ransomware itself, called RED.exe, is a 64-bit Windows executable programmed in the Go language, compiled using a\ntool called MinGW, and packed with a modified version of the runtime packer UPX.\n\n\n-----\n\n[The executable contains some code taken from an open source project called godirwalk, which gives it the ability to scan](https://github.com/karrick/godirwalk)\nthe hard drive on which it’s running for directory paths and compile them into a list. The ransomware then spawns a new\nchild process that encrypts each subfolder separately, which after a short amount of time results in a lot of copies of the\nransomware process running simultaneously.\n\nIn this root cause analysis\n\ndiagram, each instance of the red.exe ransomware encrypting a single folder appears as a unique process\nThe ransomware itself is quite small as it only really is used to perform the encryption of the files on the targeted system. It\nmakes no network connections, and because functions like killing processes or deleting the Volume Shadow Copies have\nbeen outsourced to the PowerShell scripts, it’s really quite a simple program.\n\nIn the sample we’ve seen, it doesn’t even contain a list of targeted file types or file extensions. In fact, it will encrypt\neverything inside the folders it decides to encrypt, including other executables and DLLs, which can render programs or the\nentire system nonfunctional, if the ransomware decides to encrypt the wrong folder path. After it encrypts each file, it\nappends a file suffix of “.epsilonred” to the files, and drops a ransom note in each folder.\n\nStrangely enough, the ransom note closely resembles the note used by REvil, a much more widely used ransomware. But\nwhere the REvil note is typically riddled with spelling and grammatical errors, the note delivered by Epsilon Red has gone\nthrough a few edits to make its text more readable to an audience of native English speakers.\n\n\n-----\n\nThe Epsilon Red ransom note\n\nVictims are encouraged to visit a special URL on a website operated on the normal web (epsilons[.]red) to engage with the\nattackers.\n\n## Detections\n\nSophos endpoint products, such as Intercept X, will behaviorally detect several of the actions taken by the PowerShell\nscripts or the ransomware payload. The act of attempting to encrypt files is blocked by the CryptoGuard feature. As the\ningress point for this attack appears to have been an Exchange server vulnerable to the ProxyLogon exploit chain,\ncustomers are urged to patch internet-facing Exchange servers as quickly as possible. Sophos endpoint products can\nprotect Exchange servers as well as Domain Controllers or workstations.\n\n[Indicators of compromise for this threat can be found on the SophosLabs Github.](https://github.com/sophoslabs/IoCs/blob/master/Ransomware-EpsilonRed.csv)\n\n## Acknowledgments\n\nSophosLabs acknowledges the work of Anand Ajjan, Richard Cohen, Fraser Howard, Elida Leite, Mark **Loman, Andrew**\n**Ludgate, Peter Mackenzie, Nirav Parekh, and Gabor Szappanos in producing a comprehensive analysis of the threat,**\nand improving our ability to detect and block malware like Epsilon Red in the future.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-05-28 - A new ransomware enters the fray- Epsilon Red.pdf"
    ],
    "report_names": [
        "2021-05-28 - A new ransomware enters the fray- Epsilon Red.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535787,
    "ts_updated_at": 1743041137,
    "ts_creation_date": 1653688307,
    "ts_modification_date": 1653688307,
    "files": {
        "pdf": "https://archive.orkl.eu/aff6effaee2d7069958c0439b0c00a274fdec427.pdf",
        "text": "https://archive.orkl.eu/aff6effaee2d7069958c0439b0c00a274fdec427.txt",
        "img": "https://archive.orkl.eu/aff6effaee2d7069958c0439b0c00a274fdec427.jpg"
    }
}