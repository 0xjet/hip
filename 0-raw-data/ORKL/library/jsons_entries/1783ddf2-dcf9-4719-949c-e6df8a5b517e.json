{
    "id": "1783ddf2-dcf9-4719-949c-e6df8a5b517e",
    "created_at": "2023-01-12T15:01:19.439217Z",
    "updated_at": "2025-03-27T02:05:32.246192Z",
    "deleted_at": null,
    "sha1_hash": "d9675f10027efcab379900af561225665bfdc4df",
    "title": "2021-03-01 - Newly Identified Dependency Confusion Packages Target Amazon, Zillow, and Slack; Go Beyond Just Bug Bounties",
    "authors": "",
    "file_creation_date": "2022-05-28T19:27:45Z",
    "file_modification_date": "2022-05-28T19:27:45Z",
    "file_size": 1347829,
    "plain_text": "# Newly Identified Dependency Confusion Packages Target Amazon, Zillow, and Slack; Go Beyond Just Bug Bounties\n\n**[blog.sonatype.com/malicious-dependency-confusion-copycats-exfiltrate-bash-history-and-etc-shadow-files](https://blog.sonatype.com/malicious-dependency-confusion-copycats-exfiltrate-bash-history-and-etc-shadow-files)**\n\n\n-----\n\nSonatype has identified new “dependency confusion” packages published to the npm\necosystem that are malicious in nature.\n\nThese squatted packages are named after repositories, namespaces or components used by\npopular companies such as Amazon, Zillow, Lyft, and Slack.\n\nThe malicious packages include:\n\namzn\nzg-rentals\nlyft-dataset-sdk\nserverless-slack-app\n\n[As previously reported by Sonatype, Alex Birsan’s dependency confusion research](https://blog.sonatype.com/dependency-hijacking-software-supply-chain-attack-hits-more-than-35-organizations)\n[disclosure led to copycat researchers publishing 275+ identical packages to the npm repo](https://blog.sonatype.com/sonatype-spots-150-malicious-npm-packages-copying-recent-software-supply-chain-attacks)\nwithin 48 hours, in hopes of scoring bug bounties. The number then jumped to over 550\nwithin the next few days.\n\nAs of today, Sonatype’s automated malware detection systems, part of Nexus\nIntelligence, has since identified well over 700 npm copycat packages based on Birsan’s\nproof-of-concept packages.\n\n\n-----\n\nAlthough ethical hacking for bug bounties and spreading security awareness has its place\nand is even welcomed by the community as it keeps us all more secure, the copycat\npackages recently identified by Sonatype unfortunately crosses the line of what is deemed\n_ethical._\n\n## What’s inside your /etc/shadow?\n\nMost of the copycat packages spotted by Sonatype that exploited the “dependency or\nnamespace confusion” issue across various open source ecosystems, did so by exfiltrating\n**minimal information - just enough to get a proof to present to a bug bounty program.**\n\nFor example, this would typically involve the researcher making a DNS request from the\nsuccessfully breached machine to their own server, and collecting information such as the\ncomputer’s hostname and IP address.\n\nThe new packages discovered by Sonatype however go a step further.\n\nFirst of all, many of these have no disclaimers or code comments in place indicating these\nare linked to any kind of ethical bug bounty program, or created for security research\npurposes. While having such a disclaimer in place is no guarantee that a package’s author is\nworking in good faith, lack thereof can surely raise alarm bells especially when combined\nwith malicious code.\n\nSecondly, as soon as these packages are installed automatically because they share a name\nwith an internal dependency (thereby exploiting “dependency confusion”), they exfiltrate the\nuser’s .bash_history file and /etc/shadow, and in some cases spawn a reverse shell.\n\nFor example, let’s take a look at the `amzn` package. The npm webpage for `amzn` has no\nindication or disclaimer that it could be linked to an ethical research effort, neither does the\ncode inside.\n\n\n-----\n\n**npm webpage for the `amzn` package**\n\nThe package has two identical versions (1.0.0 and 2.0.0) each of which contain just two files:\na manifest, package.json and the functional run.js file.\n\n**The manifest file of amzn malicious package**\n\nOf note here is the fact that the “author” listed within the package.json is “zappos,” even\n[though the package has been published by a pseudonymous author osama775on npm.](https://www.npmjs.com/~osama775)\n\n\n-----\n\n[Zappos is an Amazon subsidiary and naturally has systems that interact with Amazon s [1,](https://en.wikipedia.org/wiki/Zappos#Amazon_subsidiary)\n[2]. Amazon’s](https://www.zappos.com/c/prime-link) [GitHub repository and](https://github.com/amzn) [some of its packages use the shorthand “amzn” notation](https://github.com/amzn/amzn-drivers)\nmaking it not too hard to see why an adversary would want to squat the “amzn” name on an\nopen-source repository like npm.\n\nInside “run.js” is where we see the contents of the /etc/shadow file being accessed (on line\n7), and ultimately exfiltrated to the package’s author to domain the comevil[.]fun.\n\nThe code above also has the author opening a reverse shell to their server which would\nspawn as soon as the `amzn` package infiltrates the vulnerable build.\n\n\n-----\n\nThe [/etc/shadow file is a successor to the /etc/passwd Linux file that maintains hashed](https://en.wikipedia.org/wiki/Passwd#Shadow_file)\npassword data of user accounts on a system. Although the file is typically restricted to “super\nuser” accounts, there remains a slight chance of a malicious actor, in this case, being able to\nobtain the file should the infected machine be running npm with elevated privileges.\n\n[The package “zg-rentals” also posted by the author osama775 is identical in structure and](https://www.npmjs.com/~osama775)\nfunctionality. The term “zg-rentals” is associated with the real estate company Zillow\n**[Group[1,](https://vimeo.com/zillowgrouprentals)** [2]. Packages with names including the “zg-rentals” keyword were previously used](https://twitter.com/ZGRentals)\nby Alex Birsan as well.\n\n[Sonatype security researcher Juan Aguirre who spent time analyzing more identical copycat](https://www.linkedin.com/in/juan-aguirre-039b12113/)\npackages that engage in exfiltrating the user’s /etc/shadow said:\n\n“I was starting to wonder when we were going to see a malicious actor take advantage of the\ncurrent situation. Finally, we've spotted one.”\n\n“There is no scenario I can imagine where I'm going to submit a PoC for a bug bounty\nprogram that actually harms the organization. Taking their /etc/shadow file is definitely\nharmful.”\n\n## Can I sneak peek at your .bash_history?\n\nAnother set of packages identified by Sonatype exfiltrate the user’s .bash_history file, along\nwith the fingerprinting information such as IP address, hostname, and current directory.\n\nThe .bash_history file contains a list of commands previously executed by a Unix-based OS\nuser at the terminal. Unless periodically cleared, this file can contain the usernames,\npasswords, and other sensitive bits of data that nobody other than the user themself should\nhave access to.\n\nAs an example, the malicious “serverless-slack-app” package published today is named\nafter [a legitimate package made by an Atlassian developer. It has both preinstall and](https://github.com/johnagan/serverless-slack-app)\n_postinstall scripts launched by the manifest file._\n\n**Manifest file package.json of serverless-slack-app**\n\nWhile the index.js script spun up at the preinstall stage is an identical replica of that in\nBirsan’s PoC research packages, the postinstall script is particularly interesting.\n\n\n-----\n\n[At the postinstall stage, another script hosted on GitHub is run that sends the user s](https://gist.github.com/dimax0220/52da30e74adb24f2190ee7967444c864#file-index-js-L19)\n“.bash_history” file to the author behind serverless-slack-app.\n\n**.bash_history being accessed by the script**\n\nThese activities would take place as soon as a dependency confusion attack succeeds and\nwould need no action from the victim, given the nature of the dependency/namespace\nhijacking issue.\n\nAgain, the npm webpage for “serverless-slack-app” has no clear cut sign that this package is\nlinked to an ethical research or a bug bounty program. Although few packages published by\nits [author do have “security research purposes only” disclaimer, the pattern does not seem](https://www.npmjs.com/~d1m4x)\nconsistent.\n\n\n-----\n\nLikewise, the lyft-dataset-sdk dependency by the same author shares name with a Python[based package used by Lyft [1,](https://pypi.org/project/lyft-dataset-sdk/) [2]. Perhaps, the author is taking a guess here that an internal](https://github.com/lyft/nuscenes-devkit)\nnpm dependency by the same name exists too.\n\n“It's interesting to look at all the malicious npm copycat packages released recently. You can\nsee their evolution.”\n\n“They start out with pretty much the same code base as the PoC released by researcher\nAlex Birsan and they gradually start getting creative.”\n\n“These packages stood out because they reflect the behavior of actual malware, a first stage\npayload to grab a binary which further grabs your bash history,” says Aguirre.\n\n## More dependency hijacking packages to surface, what to do?\n\nThe list of 4 malicious packages above is not exhaustive.\n\n[In the week following the original report of Alex Birsan’s supply chain attack that infiltrated](https://www.bleepingcomputer.com/news/security/researcher-hacks-over-35-tech-firms-in-novel-supply-chain-attack/)\nover 35 tech firms including Microsoft, Apple, and Netflix, we saw a 7000% increase in\ndependency confusion copycats published to npm.\n\nAnd given the daily volume of suspicious npm packages being picked up by Sonatype’s\nautomated malware detection systems, we only expect this trend to increase, with\nadversaries abusing dependency confusion to conduct even more sinister activities.\n\nFortunately, based on the visibility Sonatype has, none of our customers have been detected\nrunning these malicious copycats.\n\n\n-----\n\nSonatype s customers with the **[Advance Development Packbenefit from the additional](https://www.sonatype.com/nexus/advanced-development-pack)**\nprotection offered by our automated malware detection systems and world-class security\nresearch data.\n\nFurthermore, **[Nexus Firewall instances will automatically quarantine any suspicious](https://www.sonatype.com/nexus/firewall)**\ncomponents detected by our automated malware detection systems while a manual review\nby a researcher is in the works, thereby keeping your software supply chain protected from\nthe start.\n\nUsers of Nexus Repository Manager can additionally download Sonatype’s\n[“dependency/namespace confusion checker” script from GitHub to check if they have](https://github.com/sonatype-nexus-community/repo-diff)\nartifacts with the same name between repositories, and to determine if they have been\nimpacted by a dependency confusion attack in the past.\n\nSonatype’s [2020 State of the Software Supply Chain states that next-generation upstream](https://www.sonatype.com/2020ssc)\nsoftware supply chain attacks are far more sinister because bad actors are no longer waiting\nfor public vulnerability disclosures. Instead, they are taking the initiative to contribute code to\nopen source projects and then - unbeknownst to the other OSS project maintainers injecting malicious code. Those code changes then make their way into open source\nprojects that feed the software supply chains of developers around the world. is happening at\na rapidly increased rate.\n\nAnd this is happening at a rapidly increased rate. In fact, there was a 430% increase in\nupstream software supply chain attacks over the past year. Keeping this in mind, it is virtually\nimpossible to manually chase and keep track of such components.\n\nSonatype’s world-class security research data, combined with our automated malware\ndetection technology safeguards your developers, customers, and software supply chain\nfrom infections.\n\nTags: [vulnerabilities,](https://blog.sonatype.com/topic/vulnerabilities) [featured,](https://blog.sonatype.com/topic/featured) [Nexus Intelligence Insights](https://blog.sonatype.com/topic/nexus-intelligence-insights)\n\n\n-----\n\n### Written by Ax Sharma\n\nAx is a Security Researcher at Sonatype and Engineer who holds a passion for perpetual\nlearning. His works and expert analyses have frequently been featured by leading media\noutlets. Ax's expertise lies in security vulnerability research, reverse engineering, and\nsoftware development. In his spare time, he loves exploiting vulnerabilities ethically and\neducating a wide range of audiences.\n\nFollow me on:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-03-01 - Newly Identified Dependency Confusion Packages Target Amazon, Zillow, and Slack; Go Beyond Just Bug Bounties.pdf"
    ],
    "report_names": [
        "2021-03-01 - Newly Identified Dependency Confusion Packages Target Amazon, Zillow, and Slack; Go Beyond Just Bug Bounties.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535679,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1653766065,
    "ts_modification_date": 1653766065,
    "files": {
        "pdf": "https://archive.orkl.eu/d9675f10027efcab379900af561225665bfdc4df.pdf",
        "text": "https://archive.orkl.eu/d9675f10027efcab379900af561225665bfdc4df.txt",
        "img": "https://archive.orkl.eu/d9675f10027efcab379900af561225665bfdc4df.jpg"
    }
}