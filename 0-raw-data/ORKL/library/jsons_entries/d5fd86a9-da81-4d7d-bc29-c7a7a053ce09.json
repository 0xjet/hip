{
    "id": "d5fd86a9-da81-4d7d-bc29-c7a7a053ce09",
    "created_at": "2023-01-12T15:07:04.21593Z",
    "updated_at": "2025-03-27T02:16:20.802601Z",
    "deleted_at": null,
    "sha1_hash": "64e87a121a9b9110d0bdbb40391a851aef9e7116",
    "title": "2014-03-12 - Agent.btz- a Source of Inspiration-",
    "authors": "",
    "file_creation_date": "2022-05-28T01:58:23Z",
    "file_modification_date": "2022-05-28T01:58:23Z",
    "file_size": 346906,
    "plain_text": "# Agent.btz: a Source of Inspiration?\n\n**[securelist.com/blog/virus-watch/58551/agent-btz-a-source-of-inspiration/](https://securelist.com/blog/virus-watch/58551/agent-btz-a-source-of-inspiration/)**\n\nAuthors\n\n[Alexander Gostev](https://securelist.com/author/alexander/)\n\n[The past few days has seen an extensive discussion within the IT security industry about a](https://www.reuters.com/article/us-russia-cyberespionage-insight-idUSBREA260YI20140307)\ncyberespionage campaign called Turla, aka Snake and Uroburos, which, according to GDATA experts, may have been created by Russian special services.\n\nOne of the main conclusions also pointed out by research from BAE SYSTEMS, is a\nconnection between the authors of Turla and those of another malicious program, known as\nAgent.BTZ, which infected the local networks of US military operations in the Middle East in\n2008.\n\nWe first became aware of this targeted campaign in March 2013. This became apparent\nwhen we investigated an incident which involved a highly sophisticated rootkit. We called it\nthe ‘Sun rootkit’, based on a filename used as a virtual file system: sunstore.dmp, also\naccessible as \\.Sundrive1 and \\.Sundrive2. The ‘Sun rootkit’ and Uroburos are the same.\n\nWe are still actively investigating Turla, and we believe it is far more complex and versatile\nthan the already published materials suggest.\n\n\n-----\n\nAt this point, I would like to discuss the connection between Turla and Agent.btz in a little\nmore detail.\n\n## Agent.btz: a global epidemic or a targeted attack?\n\nThe story of Agent.btz began back in 2007 and was extensively covered by the mass media\n[in late 2008 when it was used to infect US military networks.](https://www.latimes.com/archives/la-xpm-2008-nov-28-na-cyberattack28-story.html)\n\nHere is what [Wikipedia has to say about it: “The 2008 cyberattack on the United States was](https://en.wikipedia.org/wiki/2008_cyberattack_on_United_States)\nthe ‘worst breach of U.S. military computers in history’. The defense against the attack was\nnamed ‘Operation Buckshot Yankee’. It led to the creation of the United States Cyber\nCommand.\n\nIt started when a USB flash drive infected by a foreign intelligence agency was left in the\nparking lot of a Department of Defense facility at a base in the Middle East. It contained\n[malicious code and was put into a USB port from a laptop computer that was attached to](https://en.wikipedia.org/wiki/Laptop_computer)\nUnited States Central Command.\n\nThe Pentagon spent nearly 14 months cleaning the worm, named Agent.btz, from military\nnetworks. Agent.btz, a variant of the SillyFDC worm, has the ability ‘to scan computers for\ndata, open backdoors, and send through those backdoors to a remote command and control\nserver’.”\n\nWe do not know how accurate is the story with the USB flash drive left in the parking lot. We\nhave also heard a number of other versions of this story, which may, or may not be right.\nHowever, the important fact here is that Agent.btz was a self replicating computer worm, not\njust a Trojan. Another important fact is that the malware has dozens of different variants.\n\nWe believe that the initial variants of the worm were created back in 2007. By 2011 a large\nnumber of its modifications had been detected. Today, most variants are detected by\n[Kaspersky products as Worm.Win32.Orbina.](https://threats.kaspersky.com/en/threat/Worm.Win32.Orbina.a)\n\nCuriously, in accordance with the naming convention used by PC Tools, the worm is also\nnamed Voronezh.1600 (http://www.threatexpert.com/report.aspx?\nmd5=02eda1effde92bdf8462abcf40c4f776) – possibly a reference to the mythical Voronezh\nschool of hackers, in Russia.\n\nIn any event, it is quite obvious that the US military were not the only victims of the worm.\nCopying itself from one USB flash drive to another, it rapidly spread globally. Although no\nnew variants of the malware have been created for several years and the vulnerability\nenabling the worm to launch from USB flash drives using “autorun.inf” have long since been\nclosed in newer versions of Windows, according to our data Agent.btz was detected 13,832\ntimes in 107 countries across the globe in 2013 alone!\n\n\n-----\n\nThe dynamics of the worm s epidemic are also worth noting. Over three years – from 2011 to\n2013 – the number of infections caused by Agent.btz steadily declined; however, the top 10\naffected countries changed very little.\n\nAgent.BTZ detections (unique users) 2011\n\n1 Russian Federation 24111\n\n2 Spain 9423\n\n3 Italy 5560\n\n4 Kazakhstan 4412\n\n5 Germany 3186\n\n6 Poland 3068\n\n7 Latvia 2805\n\n8 Lithuania 2016\n\n9 United Kingdom 761\n\n10 Ukraine 629\n\nTotal countries 147\n\nTotal users 63021\n\nAgent.BTZ detections (unique users) 2012\n\n1 Russian Federation 11211\n\n2 Spain 5195\n\n3 Italy 3052\n\n4 Germany 2185\n\n5 Kazakhstan 1929\n\n6 Poland 1664\n\n7 Latvia 1282\n\n8 Lithuania 861\n\n9 United Kingdom 335\n\n10 Ukraine 263\n\n\n-----\n\nTotal countries 130\n\nTotal users 30923\n\nAgent.BTZ detections (unique users) 2013\n\n1 Russian Federation 4566\n\n2 Spain 2687\n\n3 Germany 1261\n\n4 Italy 1067\n\n5 Kazakhstan 868\n\n6 Poland 752\n\n7 Latvia 562\n\n8 Lithuania 458\n\n9 Portugal 157\n\n10 United Kingdom 123\n\nTotal countries 107\n\nTotal users 13832\n\n_The statistics presented above are based on the following Kaspersky Anti-Virus verdicts:_\n_Worm.Win32.Autorun.j, Worm.Win32.Autorun.bsu, Worm.Win32.Autorun.bve, Trojan-_\n_Downloader.Win32.Agent.sxi, Worm.Win32.AutoRun.lqb, Trojan.Win32.Agent.bve,_\n_Worm.Win32.Orbina_\n\nTo summarize the above, the Agent.btz worm has clearly spread all over the world, with\nRussia leading in terms of the number of infections for several years.\n\n\n-----\n\n_Map of infections caused by different modifications of “Agent.btz” in 2011-2013_\n\nFor detailed information on the modus operandi of Agent.btz, I recommend reading an\n[excellent report prepared by Sergey Shevchenko from ThreatExpert, back in November](http://blog.threatexpert.com/2008/11/agentbtz-threat-that-hit-pentagon.html)\n2008.\n\nOn infected systems, the worm creates a file named ‘thumb.dd’ on all USB flash drives\nconnected to the computer, using it to store a CAB file containing the following files:\n“winview.ocx”, “wmcache.nld” and “mswmpdat.tlb”. These files contain information about the\ninfected system and the worm’s activity logs for that system. Essentially, “thumb.dd” is a\ncontainer for data which is saved on the flash drive, unless it can be sent directly over the\nInternet to the C&C server.\n\nIf such a flash drive is inserted into another computer infected with Orbina, the file\n“thumb.dd” will be copied to the computer under the name “mssysmgr.ocx”.\n\nGiven this functionality and the global scale of the epidemic caused by the worm, we believe\nthat there are tens of thousands of USB flash drives in the world containing files named\n“thumb.dd” created by Agent.btz at some point in time and containing information about\nsystems infected by the worm.\n\n\n-----\n\n## Red October: a data collector?\n\nOver one year ago, we analyzed dozens of modules used by Red October, an extremely\nsophisticated cyber espionage operation. While performing the analysis, we noticed that the\nlist of files that a module named “USB Stealer” searches for on USB flash drives connected\nto infected computers included the names of files created by Agent.btz “mssysmgr.ocx” and\n“thumb.dd”.\n\nThis means that Red October developers were actively looking for data collected several\nyears previously by Agent.btz. All the USB Stealer modules known to us were created in\n2010-2011.\n\nBoth Red October and Agent.btz were, in all probability, created by Russian-speaking\nmalware writers. One program “knew” about the files created by the other and tried to make\nuse of them. Are these facts sufficient to conclude that there was a direct connection\nbetween the developers of the two malicious programs?\n\nI believe they are not.\n\nFirst and foremost, it should be noted that the fact that the file “thumb.dd” contains data from\nAgent.btz-infected systems was publicly known. It is not impossible that the developers of\nRed October, who must have been aware of the large number of infections caused by\nAgent.btz and of the fact that the worm had infected US military networks, simply tried to\ntake advantage of other people’s work to collect additional data. It should also be\nremembered that Red October was a tool for highly targeted pinpoint attacks, whereas\nAgent.btz was a worm, by definition designed to spread uncontrollably and “collect” any data\nit could access.\n\n\n-----\n\nBasically, any malware writer could add scanning of USB flash drives for thumb.dd files and\nthe theft of those files to their Trojan functionality. Why not steal additional data without too\nmuch additional effort? However, decrypting the data stolen requires one other thing – the\nencryption key.\n\n## Agent.btz and Turla/Uroburos\n\nThe connection between Turla and Agent.btz is more direct, although not sufficiently so to\nconclude that the two programs have the same origin.\n\nTurla uses the same file names as Agent.btz – “mswmpdat.tlb”, “winview.ocx” and\n“wmcache.nld” for its log files stored on infected systems.\n\nAll the overlapping file names are presented in the table below:\n\nAgent.btz Red October Turla\n\nLog files thumb.dd thumb.dd\n\nwinview.ocx winview.ocx\n\nmssysmgr.ocx mssysmgr.ocx\n\nwmcache.nld wmcache.nld\n\nmswmpdat.tlb mswmpdat.tlb\n\nfa.tmp fa.tmp\n\nIn addition, Agent.btz and Turla use the same XOR key to encrypt their log files:\n\n1dM3uu4j7Fw4sjnbcwlDqet4F7JyuUi4m5Imnxl1pzxI6\n\nas80cbLnmz54cs5Ldn4ri3do5L6gs923HL34x2f5cvd0fk6c1a0s\n\nThe key is not a secret, either: it was discovered and published back in 2008 and anybody\nwho had an interest in the Agent.btz story knew about the key. Is it possible that the\ndevelopers of Turla decided to use somebody else’s key to encrypt their logs? We are as yet\nunable to determine at what point in time this particular key was adopted for Turla. It is\npresent in the latest samples (dated 2013-2014), but according to some data the\ndevelopment of Turla began back in 2006 – before the earliest known variant of Agent.btz\nwas created.\n\n## Red October and Turla\n\n\n-----\n\nNow we have determined that Red October knew about the file names used by Agent.btz\nand searched for them. We have also determined that Turla used the same file names and\nencryption key as Agent.btz.\n\nSo what about a possible connection between Red October and Turla? Is there one? Having\nanalyzed all the data at our disposal, we do not see any overlapping between the two\nprojects. They do not “know” about each other, they do not communicate between\nthemselves in any way, they are different in terms of their architecture and the technologies\nused.\n\nThe only thing they really have in common is that the developers of both Rocra and Turla\nappear to have Russian as their native language.<?\n\n## What about Flame?\n\nBack in 2012, while analyzing Flame and its cousins Gauss and MiniFlame, we noticed some\nsimilarities between them and Agent.btz (Orbina). The first thing we noticed was the\nanalogous naming convention applied, with a predominance of use of files with the .ocx\nextension. Let’s take as an example the name of the main module of Flame –\n“mssecmgr.ocx”. In Agent.btz a very similar name was used for the log-file container on the\ninfected system – “mssysmgr.ocx”. And in [Gauss all modules were in the form of files with](https://securelist.com/gauss-abnormal-distribution/36620/)\nnames *.ocx.\n\n**Feature** **Flame** **Gauss**\n\nEncryption methods XOR XOR\n\nUsing USB as storage Yes (hub001.dat) Yes (.thumbs.db)\n\nThe Kurt/Godel module in Gauss contains the following functionality: when a drive contains a\n‘.thumbs.db’ file, its contents are read and checked for the magic number 0xEB397F2B. If\nfound, the module creates %commonprogramfiles%systemwabdat.dat and writes the data to\nthis file, and then deletes the ‘.thumbs.db’ file.\n\nThis is a container for data stolen by the ‘dskapi’ payload.\n\nBesides, MiniFlame (module icsvnt32) also ‘knew’ about the ‘.thumbs.db’ file, and conducted\na search for it on USB sticks.\n\nIf we recall how our data indicate that the development of both Flame and Gauss started\nback in 2008, it can’t be ruled out that the developers of these programs were well\nacquainted with the analysis of Agent.btz and possibly used some ideas taken from it in their\ndevelopment activities.\n\n## All together now\n\n\n-----\n\nThe data can be presented in the form of a diagram showing the interrelations among all the\nanalyzed malicious programs:\n\nAs can be seen in the diagram, the developers of all three (even four, if we include Gauss)\nspy programs knew about Agent.btz, i.e., about how it works and what filenames it uses, and\nused that information either to directly adopt the functionality, ideas and even filename, or\nattempted to use the results of the work of Agent.btz.\n\nSummarizing all the above, it is possible to regard Agent.btz as a certain starting point in the\nchain of creation of several different cyber-espionage projects. The well-publicized story of\nhow US military networks were infected could have served as the model for new espionage\nprograms having similar objectives, while its technologies were clearly studied in great detail\nby all interested parties. Were the people behind all these programs all the same? It’s\npossible, but the facts can’t prove it.\n\n[APT](https://securelist.com/tag/apt/)\n[Botnets](https://securelist.com/tag/botnets/)\n[Cyber espionage](https://securelist.com/tag/cyber-espionage/)\n[Targeted attacks](https://securelist.com/tag/targeted-attacks/)\n\nAuthors\n\n\n-----\n\n[Alexander Gostev](https://securelist.com/author/alexander/)\n\nAgent.btz: a Source of Inspiration?\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2014/2014-03-12 - Agent.btz- a Source of Inspiration-.pdf"
    ],
    "report_names": [
        "2014-03-12 - Agent.btz- a Source of Inspiration-.pdf"
    ],
    "threat_actors": [
        {
            "id": "a97cf06d-c2e2-4771-99a2-c9dee0d6a0ac",
            "created_at": "2022-10-25T16:07:24.349252Z",
            "updated_at": "2025-03-27T02:02:10.184406Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "ATK 13",
                "Belugasturgeon",
                "Blue Python",
                "CTG-8875",
                "Group 88",
                "ITG12",
                "Iron Hunter",
                "Krypton",
                "Makersmark",
                "Operation Epic Turla",
                "Operation Moonlight Maze",
                "Operation Penguin Turla",
                "Operation Satellite Turla",
                "Operation Skipper Turla",
                "Operation Turla Mosquito",
                "Operation WITCHCOVEN",
                "Pacifier APT",
                "Pensive Ursa",
                "Popeye",
                "SIG15",
                "SIG2",
                "SIG23",
                "Secret Blizzard",
                "TAG-0530",
                "Turla",
                "UNC4210",
                "Venomous Bear",
                "Waterbug"
            ],
            "source_name": "ETDA:Turla",
            "tools": [
                "ASPXSpy",
                "ASPXTool",
                "ATI-Agent",
                "AdobeARM",
                "Agent.BTZ",
                "Agent.DNE",
                "BigBoss",
                "COMpfun",
                "Chinch",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobra Carbon System",
                "ComRAT",
                "DoublePulsar",
                "EmPyre",
                "EmpireProject",
                "Epic Turla",
                "EternalBlue",
                "EternalRomance",
                "GoldenSky",
                "Group Policy Results Tool",
                "HTML5 Encoding",
                "HyperStack",
                "IcedCoffee",
                "IronNetInjector",
                "KSL0T",
                "Kapushka",
                "Kazuar",
                "KopiLuwak",
                "Kotel",
                "LOLBAS",
                "LOLBins",
                "LightNeuron",
                "Living off the Land",
                "Maintools.js",
                "Metasploit",
                "Meterpreter",
                "MiamiBeach",
                "Mimikatz",
                "MiniDionis",
                "Minit",
                "NBTscan",
                "NETTRANS",
                "NETVulture",
                "Neptun",
                "NetFlash",
                "NewPass",
                "Outlook Backdoor",
                "Penquin Turla",
                "Pfinet",
                "PowerShell Empire",
                "PowerShellRunner",
                "PowerShellRunner-based RPC backdoor",
                "PowerStallion",
                "PsExec",
                "PyFlash",
                "QUIETCANARY",
                "Reductor RAT",
                "RocketMan",
                "SMBTouch",
                "SScan",
                "Satellite Turla",
                "SilentMoon",
                "Sun rootkit",
                "TTNG",
                "TadjMakhal",
                "Tavdig",
                "TinyTurla",
                "TinyTurla Next Generation",
                "TinyTurla-NG",
                "Topinambour",
                "Tunnus",
                "Turla",
                "Turla SilentMoon",
                "TurlaChopper",
                "Uroburos",
                "Urouros",
                "WCE",
                "WITCHCOVEN",
                "WhiteAtlas",
                "WhiteBear",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "Wipbot",
                "WorldCupSec",
                "XTRANS",
                "certutil",
                "certutil.exe",
                "gpresult",
                "nbtscan",
                "nbtstat",
                "pwdump"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8aaa5515-92dd-448d-bb20-3a253f4f8854",
            "created_at": "2024-06-19T02:03:08.147099Z",
            "updated_at": "2025-03-27T02:05:17.408118Z",
            "deleted_at": null,
            "main_name": "IRON HUNTER",
            "aliases": [
                "Belugasturgeon ",
                "Blue Python ",
                "CTG-8875 ",
                "ITG12 ",
                "KRYPTON ",
                "MAKERSMARK ",
                "Pensive Ursa ",
                "Secret Blizzard ",
                "Turla",
                "UAC-0003 ",
                "UAC-0024 ",
                "UNC4210 ",
                "Venomous Bear ",
                "Waterbug ",
                "ATK13 "
            ],
            "source_name": "Secureworks:IRON HUNTER",
            "tools": [
                " ComRAT",
                " Kazuar",
                " KopiLuwak",
                " LightNeuron",
                " Mosquito",
                " Nautilus",
                " Neuron",
                " Penquin",
                " PoisonFrog",
                " PyFlash",
                " Skipper",
                " Snake",
                " Tavdig",
                " TinyTurla",
                " Tunnus",
                "Carbon-DLL"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a97fee0d-af4b-4661-ae17-858925438fc4",
            "created_at": "2023-01-06T13:46:38.396415Z",
            "updated_at": "2025-03-27T02:00:02.823045Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Uroburos",
                "Hippo Team",
                "Pacifier APT",
                "MAKERSMARK",
                "ATK13",
                "UAC-0003",
                "IRON HUNTER",
                "Waterbug",
                "TAG_0530",
                "KRYPTON",
                "Popeye",
                "SIG23",
                "UAC-0144",
                "G0010",
                "Blue Python",
                "VENOMOUS Bear",
                "Group 88",
                "Pfinet",
                "ITG12",
                "UNC4210",
                "Secret Blizzard",
                "UAC-0024"
            ],
            "source_name": "MISPGALAXY:Turla",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d11c89bb-1640-45fa-8322-6f4e4053d7f3",
            "created_at": "2022-10-25T15:50:23.509601Z",
            "updated_at": "2025-03-27T02:00:55.487991Z",
            "deleted_at": null,
            "main_name": "Turla",
            "aliases": [
                "Turla",
                "IRON HUNTER",
                "Group 88",
                "Waterbug",
                "WhiteBear",
                "Krypton",
                "Venomous Bear",
                "Secret Blizzard",
                "BELUGASTURGEON"
            ],
            "source_name": "MITRE:Turla",
            "tools": [
                "PsExec",
                "nbtstat",
                "ComRAT",
                "netstat",
                "certutil",
                "KOPILUWAK",
                "IronNetInjector",
                "LunarWeb",
                "Arp",
                "Uroburos",
                "PowerStallion",
                "Kazuar",
                "Systeminfo",
                "LightNeuron",
                "Mimikatz",
                "Tasklist",
                "LunarMail",
                "HyperStack",
                "NBTscan",
                "TinyTurla",
                "Penquin",
                "LunarLoader"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536024,
    "ts_updated_at": 1743041780,
    "ts_creation_date": 1653703103,
    "ts_modification_date": 1653703103,
    "files": {
        "pdf": "https://archive.orkl.eu/64e87a121a9b9110d0bdbb40391a851aef9e7116.pdf",
        "text": "https://archive.orkl.eu/64e87a121a9b9110d0bdbb40391a851aef9e7116.txt",
        "img": "https://archive.orkl.eu/64e87a121a9b9110d0bdbb40391a851aef9e7116.jpg"
    }
}