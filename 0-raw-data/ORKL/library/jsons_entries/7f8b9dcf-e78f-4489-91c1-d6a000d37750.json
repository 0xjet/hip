{
    "id": "7f8b9dcf-e78f-4489-91c1-d6a000d37750",
    "created_at": "2023-01-12T15:10:02.147927Z",
    "updated_at": "2025-03-27T02:16:34.749588Z",
    "deleted_at": null,
    "sha1_hash": "77f6cc70056cef15888c83daf9cea74b3ecc16c8",
    "title": "2021-01-19 - Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452",
    "authors": "",
    "file_creation_date": "2022-05-27T22:05:33Z",
    "file_modification_date": "2022-05-27T22:05:33Z",
    "file_size": 100481,
    "plain_text": "# Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452\n\n**fireeye.com/blog/threat-research/2021/01/remediation-and-hardening-strategies-for-microsoft-365-to-defend-against-**\nunc2452.html\n\n## Breadcrumb\n\nThreat Research\n\nMike Burns, Matthew McWhirt, Douglas Bienstock, Nick Bennett, Juraj Sucik\n\nJan 19, 2021\n\n5 mins read\n\nTTPs\n\nUncategorized Groups (UNC Groups)\n\n\n-----\n\nThreat Research\n\n_[UPDATE (May 2022): We have merged UNC2452 with APT29. The UNC2452 activity](https://www.mandiant.com/resources/unc2452-merged-into-apt29)_\n_described in this post and report is now attributed to APT29._\n\n_UPDATE (Oct. 28, 2021): Mandiant has recently observed targeted threat actors using EWS_\n_impersonation (via the ApplicationImpersonation role) to maintain persistent access to_\n_mailboxes in victim environments. Once the threat actor has access to this role, its abuse is_\n_hard to detect and provides the threat actor control over every mailbox in a victim_\n_tenant. Mandiant has also observed targeted threat actors abusing the trust relationship_\n_between Cloud Service Provider (CSP) organizations and their customers to laterally move_\n_from service providers to their downstream customers and gain administrator privileges in_\n_the target tenants. The blog post, white paper, and Azure AD Investigator tool have been_\n_updated to reflect these findings._\n\n_UPDATE (Mar. 18): Mandiant recently observed targeted threat actors modifying mailbox_\n_folder permissions of user mailboxes to maintain persistent access to the targeted users'_\n_email messages. This stealthy technique is not usually monitored by defenders and provides_\n_threat actors a way to access the desired email messages using any compromised_\n_credentials. The white paper, blog post and Azure AD Investigator tool have been updated to_\n_reflect these findings. Mandiant would like to thank the members of Microsoft’s Detection and_\n_Response Team (DART) for their collaboration on this research._\n\nIn December 2020, FireEye uncovered and publicly disclosed a widespread attacker\n[campaign that is being tracked as UNC2452. In some, but not all, of the intrusions](https://www.fireeye.com/resources/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor)\nassociated with this campaign where Mandiant has visibility, the attacker used their access to\non-premises networks to gain unauthorized access to the victim’s Microsoft 365 environment.\n\n**Goals and Objectives**\n\nMethodologies that UNC2452 and other threat actors have used to move laterally from onpremises networks to the Microsoft 365 cloud have been detailed in our white paper,\n_[Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452. The](https://www.mandiant.com/media/13006/download)_\npaper also discusses how organizations can proactively harden their environments and\nremediate environments where similar techniques have been observed.\n\n[Mandiant is releasing an auditing script, Azure AD Investigator, through its GitHub repository](https://github.com/mandiant/Mandiant-Azure-AD-Investigator)\nthat organizations can use to check their Microsoft 365 tenants for indicators of some of the\ntechniques used by UNC2452. The script will alert administrators and security practitioners\nto artifacts that may require further review to determine if they are truly malicious or part of\nlegitimate activity. Many of the attacker techniques detailed in the white paper are dual-use in\nnature—they can be used by threat actors but also by legitimate tools. Therefore, a detailed\nreview for specific configuration parameters may be warranted, including correlating and\nverifying that configurations are aligned with authorized and expected activities.\n\n\n-----\n\n**Attacker Tactics, Techniques and Procedures (TTPs)**\n\nMandiant has observed UNC2452 and other threat actors moving laterally to the Microsoft\n365 cloud using a combination of five primary techniques:\n\n1. Steal the Active Directory Federation Services (AD FS) token-signing certificate and\n\n[use it to forge tokens for arbitrary users (sometimes described as Golden SAML). This](https://www.cyberark.com/resources/threat-research-blog/golden-saml-newly-discovered-attack-technique-forges-authentication-to-cloud-apps)\nwould allow the attacker to authenticate into a federated resource provider (such as\nMicrosoft 365) as any user, without the need for that user’s password or their\ncorresponding multi-factor authentication (MFA) mechanism.\n2. Modify or add trusted domains in Azure AD to add a new federated Identity Provider\n\n(IdP) that the attacker controls. This would allow the attacker to forge tokens for\n[arbitrary users and has been described as an Azure AD](https://o365blog.com/post/aadbackdoor/) [backdoor.](https://www.fireeye.com/resources/detecting-microsoft-365-azure-active-directory-backdoors)\n3. Compromise the credentials of on-premises user accounts that are synchronized to\n\nMicrosoft 365 that have high privileged directory roles, such as Global Administrator or\nApplication Administrator.\n[4. Backdoor an existing Microsoft 365 application by adding a new application or service](https://dirkjanm.io/azure-ad-privilege-escalation-application-admin/)\n\nprincipal credential in order to use the legitimate permissions assigned to the\napplication, such as the ability to read email, send email as an arbitrary user, access\nuser calendars, etc.\n5. Modify the permissions of folders in a victim mailbox (such as the inbox) to make its\n\ncontents readable by any other user in the victim’s Microsoft 365 environment.\n6. Use EWS Impersonation to impersonate any mailbox owner in the Microsoft 365 tenant\n\nand bulk collect mail items.\n7. Target and compromise Cloud Service Providers (CSPs) that have permissions to\n\nadminister customer tenants of organizations that UNC2452 is targeting, and abuse the\naccess granted to the CSP to perform post-compromise activities against the target\norganization.\n\nRead the [white paper for a detailed overview of each technique, including practical](https://www.mandiant.com/media/13006/download)\nremediation and hardening strategies, and check out our auditing script, Azure AD\nInvestigator.\n\n**Detections**\n\n\n**FireEye Helix Detection** **MITRE**\n**Technique**\n\n\n**Detection Logic**\n\n\nMICROSOFT AZURE ACTIVE\nDIRECTORY [Risky Sign-In]\n\n\n[T1078.004](https://attack.mitre.org/techniques/T1078/004/) Alert on suspicious logon activity as\ndetected by Azure Identity Protection\n\n\n-----\n\nOFFICE 365 [Federated Domain\nSet]\n\nOFFICE 365 [Modified Domain\nFederation Settings]\n\nOFFICE 365 [User Added\nCredentials to Service Principal]\n\nOFFICE 365 ANALYTICS\n\n[Abnormal Logon]\n\nWINDOWS METHODOLOGY\n\n[ADFS Dump]\n\nOFFICE 365 [Mailbox Folder\nPermission Change – Inbox and\nTop Of Information Store]\n\n\n[T1550](https://attack.mitre.org/techniques/T1550/) Alert on new domain federation in\nOffice 365\n\n[T1550](https://attack.mitre.org/techniques/T1550/) Alert of modification to domain\nfederations settings in Office 365\n\n[T1098.011](https://attack.mitre.org/techniques/T1098/001/) Alert on addition of certificates or\npasswords added to Service Principals\n\n[T1078.004](https://attack.mitre.org/techniques/T1078/004/) Alert on suspicious login activity based\non heuristics\n\n\n[T1098.002](https://attack.mitre.org/techniques/T1098/002/) Alert on suspicious modifications of\nmailbox folder permissions for the\ninbox or top of information store.\n\n\n[TA0006](https://attack.mitre.org/tactics/TA0006/)\n\n[T1552](https://attack.mitre.org/techniques/T1552/)\n\n[T1552.004](https://attack.mitre.org/techniques/T1552/004/)\n\n[T1199](https://attack.mitre.org/techniques/T1199/)\n\n\nAlert on activity access requests for the\nAD FS Distributed Key Manager (DKM)\ncontainer in Active Directory\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-01-19 - Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452.pdf"
    ],
    "report_names": [
        "2021-01-19 - Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452.pdf"
    ],
    "threat_actors": [
        {
            "id": "b43e5ea9-d8c8-4efa-b5bf-f1efb37174ba",
            "created_at": "2022-10-25T16:07:24.36191Z",
            "updated_at": "2025-03-27T02:02:10.1909Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "Dark Halo",
                "Nobelium",
                "SolarStorm",
                "StellarParticle",
                "UNC2452"
            ],
            "source_name": "ETDA:UNC2452",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "70872c3a-e788-4b55-a7d6-b2df52001ad0",
            "created_at": "2023-01-06T13:46:39.18401Z",
            "updated_at": "2025-03-27T02:00:03.01553Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "DarkHalo",
                "StellarParticle",
                "NOBELIUM",
                "Solar Phoenix",
                "Midnight Blizzard"
            ],
            "source_name": "MISPGALAXY:UNC2452",
            "tools": [
                "SNOWYAMBER",
                "HALFRIG",
                "QUARTERRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1d3f9dec-b033-48a5-8b1e-f67a29429e89",
            "created_at": "2022-10-25T15:50:23.739197Z",
            "updated_at": "2025-03-27T02:00:55.536417Z",
            "deleted_at": null,
            "main_name": "UNC2452",
            "aliases": [
                "UNC2452",
                "NOBELIUM",
                "StellarParticle",
                "Dark Halo"
            ],
            "source_name": "MITRE:UNC2452",
            "tools": [
                "Sibot",
                "Mimikatz",
                "Cobalt Strike",
                "AdFind",
                "GoldMax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "5b748f86-ac32-4715-be9f-6cf25ae48a4e",
            "created_at": "2024-06-04T02:03:07.956135Z",
            "updated_at": "2025-03-27T02:05:17.407352Z",
            "deleted_at": null,
            "main_name": "IRON HEMLOCK",
            "aliases": [
                "ATK7 ",
                "Blue Kitsune ",
                "Cozy Bear ",
                "The Dukes",
                "UNC2452 ",
                "YTTRIUM ",
                "APT29 "
            ],
            "source_name": "Secureworks:IRON HEMLOCK",
            "tools": [
                " CozyCar",
                " CozyDuke",
                " DiefenDuke",
                " FatDuke",
                " HAMMERTOSS",
                " LiteDuke",
                " MiniDuke",
                " OnionDuke",
                " PolyglotDuke",
                " RegDuke",
                " RegDuke Loader",
                " SeaDuke",
                " Sliver",
                "CosmicDuke"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a241a1ca-2bc9-450b-a07b-aae747ee2710",
            "created_at": "2024-06-19T02:03:08.150052Z",
            "updated_at": "2025-03-27T02:05:17.409596Z",
            "deleted_at": null,
            "main_name": "IRON RITUAL",
            "aliases": [
                "Blue Dev 5 ",
                "BlueBravo ",
                "Cloaked Ursa ",
                "CozyLarch ",
                "Dark Halo ",
                "Midnight Blizzard ",
                "NOBELIUM ",
                "StellarParticle ",
                "UNC2452 ",
                "APT29"
            ],
            "source_name": "Secureworks:IRON RITUAL",
            "tools": [
                " Cobalt Strike",
                " EnvyScout",
                " GoldFinder",
                " GoldMax",
                " NativeZone",
                " RAINDROP",
                " SUNBURST",
                " Sibot",
                " TEARDROP",
                " VaporRage",
                "Brute Ratel C4"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "20d3a08a-3b97-4b2f-90b8-92a89089a57a",
            "created_at": "2022-10-25T15:50:23.548494Z",
            "updated_at": "2025-03-27T02:00:55.49688Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "APT29",
                "IRON RITUAL",
                "IRON HEMLOCK",
                "NobleBaron",
                "Dark Halo",
                "NOBELIUM",
                "UNC2452",
                "YTTRIUM",
                "The Dukes",
                "Cozy Bear",
                "CozyDuke",
                "SolarStorm",
                "Blue Kitsune",
                "UNC3524",
                "Midnight Blizzard"
            ],
            "source_name": "MITRE:APT29",
            "tools": [
                "PinchDuke",
                "ROADTools",
                "WellMail",
                "CozyCar",
                "Mimikatz",
                "Tasklist",
                "OnionDuke",
                "FatDuke",
                "POSHSPY",
                "EnvyScout",
                "SoreFang",
                "GeminiDuke",
                "GoldMax",
                "FoggyWeb",
                "SDelete",
                "PolyglotDuke",
                "AADInternals",
                "MiniDuke",
                "SeaDuke",
                "Sibot",
                "RegDuke",
                "CloudDuke",
                "GoldFinder",
                "AdFind",
                "PsExec",
                "NativeZone",
                "Systeminfo",
                "ipconfig",
                "Impacket",
                "Cobalt Strike",
                "PowerDuke",
                "QUIETEXIT",
                "HAMMERTOSS",
                "BoomBox",
                "CosmicDuke",
                "WellMess",
                "VaporRage",
                "LiteDuke"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "46b3c0fc-fa0c-4d63-a38a-b33a524561fb",
            "created_at": "2023-01-06T13:46:38.393409Z",
            "updated_at": "2025-03-27T02:00:02.822155Z",
            "deleted_at": null,
            "main_name": "APT29",
            "aliases": [
                "The Dukes",
                "Minidionis",
                "Grizzly Steppe",
                "G0016",
                "Blue Kitsune",
                "BlueBravo",
                "SeaDuke",
                "Cloaked Ursa",
                "YTTRIUM",
                "ATK7",
                "Nobelium",
                "UAC-0029",
                "Group 100",
                "COZY BEAR",
                "IRON HEMLOCK",
                "TA421",
                "ITG11"
            ],
            "source_name": "MISPGALAXY:APT29",
            "tools": [
                "QUARTERRIG",
                "SNOWYAMBER",
                "HALFRIG"
            ],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f27790ff-4ee0-40a5-9c84-2b523a9d3270",
            "created_at": "2022-10-25T16:07:23.341684Z",
            "updated_at": "2025-03-27T02:02:09.74554Z",
            "deleted_at": null,
            "main_name": "APT 29",
            "aliases": [
                "APT 29",
                "ATK 7",
                "Blue Dev 5",
                "BlueBravo",
                "Cloaked Ursa",
                "CloudLook",
                "Cozy Bear",
                "Dark Halo",
                "Earth Koshchei",
                "Grizzly Steppe",
                "Group 100",
                "ITG11",
                "Iron Hemlock",
                "Iron Ritual",
                "Midnight Blizzard",
                "Minidionis",
                "Nobelium",
                "NobleBaron",
                "Operation Ghost",
                "Operation Office monkeys",
                "Operation StellarParticle",
                "SilverFish",
                "Solar Phoenix",
                "SolarStorm",
                "StellarParticle",
                "TEMP.Monkeys",
                "The Dukes",
                "UNC2452",
                "UNC3524",
                "Yttrium"
            ],
            "source_name": "ETDA:APT 29",
            "tools": [
                "7-Zip",
                "ATI-Agent",
                "AdFind",
                "Agentemis",
                "AtNow",
                "BEATDROP",
                "BotgenStudios",
                "CEELOADER",
                "Cloud Duke",
                "CloudDuke",
                "CloudLook",
                "Cobalt Strike",
                "CobaltStrike",
                "CosmicDuke",
                "Cozer",
                "CozyBear",
                "CozyCar",
                "CozyDuke",
                "Danfuan",
                "EnvyScout",
                "EuroAPT",
                "FatDuke",
                "FoggyWeb",
                "GeminiDuke",
                "Geppei",
                "GoldFinder",
                "GoldMax",
                "GraphDrop",
                "GraphicalNeutrino",
                "GraphicalProton",
                "HAMMERTOSS",
                "HammerDuke",
                "LOLBAS",
                "LOLBins",
                "LiteDuke",
                "Living off the Land",
                "MagicWeb",
                "Mimikatz",
                "MiniDionis",
                "MiniDuke",
                "NemesisGemina",
                "NetDuke",
                "OnionDuke",
                "POSHSPY",
                "PinchDuke",
                "PolyglotDuke",
                "PowerDuke",
                "QUIETEXIT",
                "ROOTSAW",
                "RegDuke",
                "Rubeus",
                "SNOWYAMBER",
                "SPICYBEAT",
                "SUNSHUTTLE",
                "SeaDaddy",
                "SeaDask",
                "SeaDesk",
                "SeaDuke",
                "Sharp-SMBExec",
                "SharpView",
                "Sibot",
                "Solorigate",
                "SoreFang",
                "TinyBaron",
                "WINELOADER",
                "WellMail",
                "WellMess",
                "cobeacon",
                "elf.wellmess",
                "reGeorg",
                "tDiscoverer"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536202,
    "ts_updated_at": 1743041794,
    "ts_creation_date": 1653689133,
    "ts_modification_date": 1653689133,
    "files": {
        "pdf": "https://archive.orkl.eu/77f6cc70056cef15888c83daf9cea74b3ecc16c8.pdf",
        "text": "https://archive.orkl.eu/77f6cc70056cef15888c83daf9cea74b3ecc16c8.txt",
        "img": "https://archive.orkl.eu/77f6cc70056cef15888c83daf9cea74b3ecc16c8.jpg"
    }
}