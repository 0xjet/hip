{
    "id": "4cde6099-bb7e-48e1-8403-fc895d5c9118",
    "created_at": "2023-01-12T15:06:47.822251Z",
    "updated_at": "2025-03-27T02:15:37.935331Z",
    "deleted_at": null,
    "sha1_hash": "90070c3a750ad956594da5e8497d7183bc90dce7",
    "title": "2019-11-24 - TA505 Get2 Analysis",
    "authors": "",
    "file_creation_date": "2022-05-28T17:37:35Z",
    "file_modification_date": "2022-05-28T17:37:35Z",
    "file_size": 1103335,
    "plain_text": "# TA505 Get2 Analysis\n\n**goggleheadedhacker.com/blog/post/13**\n\nJacob Pimental November 24, 2019\n\n### 24 November 2019\n\nThe TA505 group debuted Get2 and SDBot last month in a new phishing campaign. While\nthere have been some great analyses on the SDBot RAT that is dropped, there have not\nbeen many on the Get2 downloader. I wanted to take this opportunity to do my own analysis\non it. I will not be going over the macro-enabled word document itself, just the DLL that is\ndropped. There are also two versions of the dll, x86 and x64. This analysis will focus on the\n[x86 version. If you want to follow along you can get the sample from Hybrid Analysis here.](https://www.hybrid-analysis.com/sample/e14aadd73dca1a5f9bc2fe5fa29d9eca68ade6ff348f3ad0ae7a041273ca9592?environmentId=100)\n\n## Obfuscation\n\nThe Get2 DLL that comes from the malicious word document is pretty heavily obfuscated\nand packed using a custom packing mechanism. The code contains multiple loops in\nunnecessary places in order to distract reverse engineers from the actual functionality. It also\ncontains calls to multiple bogus functions that don’t return anything of importance. These\nbogus functions tend to contain multiple loops and calls to more bogus functions. It is very\neasy to go down a rabbit hole while analyzing this binary.\n\n\n-----\n\nOn top of having fake instructions, the DLL also contains self-modifying code. The DLL calls\nVirtualAlloc to allocate 3060 bytes of memory. It then dumps data into the newly created\nspace using memcpy.\n\nIt will then decrypt this data by taking every dword, xoring it by 0x6949, rotating the bits left\nby 4 and adding 0x77777778. I have created a small python script to emulate this\nfunctionality using r2pipe, radare2’s API. You can find that [here. After the decryption occurs,](https://github.com/JacobPimental/TA505/blob/master/extract_shellcode.py)\nwe can see new code formed in memory that is executed. This code appears to be importing\nfunctions such as VirtualAlloc, GetProcAddress, VirtualProtect, LoadLibraryA, and\nVirtualFree. Which leads us to believe that more unpacking is necessary.\n\n\n-----\n\n## Unpacking\n\n\n-----\n\nWe can see that earlier there was data moved into the memory space at `[ebp – 78],`\n```\n[ebp – 74], and [ebp – 70] which is referenced in this new set of code based on the\n\n```\noffset of the argument, `[ebp + 8] . The data moved into` `[ebp – 78] contains a list of`\nbytes that will be decrypted. `[ebp – 74] contains 0x3c870 which is the length of the data`\nto be decrypted, and `[ebp – 70] contains 0x4178, the decryption key. This round of`\ndecryption is slightly different from the first. The first thing that the malware does is loop\nthrough each index of the encrypted data and if the index is divisible by two then it will skip\ntwo bytes and move the data at that index into a buffer. For clarity, this follows the pattern [2,\n3, 6, 7, 10, 11, 14…] and can be represented as the following python code:\n```\ncompressed_data = b''\nx = 0\nwhile x < len(data):\n  if x % 2 == 0:\n    x += 2\n  compressed_data += bytes([data[x]])\n  x += 1\n\n```\n\n-----\n\nOnce the data is moved into the new buffer the malware will follow the normal decryption\nprocess we saw earlier by xoring each dword and rotating the bits left by 4, this time using\nthe key 0x4178.\n\n\n-----\n\nThe resulting data looks a like a mangled PE header, which leads us to believe that there is\nmore deobfuscation necessary. The final stage of this process is quite complicated. It\ninvolves multiple ways of moving bytes from our newly decrypted data to an empty buffer, but\nno actual decryption occurs The paths that the deobfuscation algorithm could take are:\n\n\n-----\n\nTo simply copy one byte from the current index of the decrypted data into the empty\nbuffer\nTo copy previous data that was inserted into the empty buffer into the current index of\nthe buffer\nTo move the byte 00 into the current index of the buffer x number of times\n\nThese paths were all dependent on a “check” function that would take into account the\ncurrent index of the encrypted data, and two global variables. The check function works as\nfollows:\n\nCheck if global_1 is 0\nIf So:\n\nMove the current byte of the encrypted data into global_2\nIncrement the current index of the encrypted data by 1\nMove 7 into global_1\nElse:\n\nglobal_1 = global_1 – 1\nMove the product of a bitwise shift right of global_2 by 7, anded by 1 ((gloabl_2 » 7) &\n1) into the return register\nglobal_2 = global_2 shifted left by 1\nreturn\n\nI have made a python script that mimics the unpacking functionality and writes out the final\n[payload to a file. You can find that here.](https://github.com/JacobPimental/TA505/blob/master/unpack_sample.py)\n\n\n-----\n\nHere is a tinygraph view of the final deobfuscation function which shows just how\ncomplicated the algorithm is:\n\n\n-----\n\n## Extracted Payload\n\nThe extracted binary is UPX packed. We can simply unpack it using the command `upx -d`\n```\n<packed_binary> . Looking at the exports of the newly unpacked binary we can see the\n\n```\nfunction getandgodll_Win32.dll_IKAJSL. This is most likely where execution will continue.\n\nThis exported function seems to call one function then exit. It is safe to assume that the\ncalled function will be the main function for this binary. This main function will grab the\nUserName of the user the malware is running as, the name of the PC, the version of\nWindows the malware is running on, and a list of the currently running processes. It then\nconcatenates this data into the string:\n\n```\n“&D=<ComputerName>&U=<UserName>&OS=<WindowsVersion>&PR=<Process list>”\n\n```\n\nIt will then send a POST request with these parameters to the C2 using the WinHttp library,\nwith the useragent:\n```\nMozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko)\nChrome/41.0.2228.0 Safari/537.36\n\n```\n\n-----\n\nThe response will send back a list of URLs that contain the final payload (normally SDBot).\nThe Get2 downloader will download these payloads and run them on the victim’s machine.\n\n## Conclusions\n\nOverall this was a very interesting and fun sample to analyze. The code was complicated\nand seemed sophisticated, which is what you would expect from this threat actor. I am\nhoping this article helps others with analyzing this particular downloader. I am always open to\n[feedback, so feel free to send me messages on my Twitter or](https://twitter.com/jacob_pimental) [LinkedIn letting me know what](https://www.linkedin.com/in/jacobpimental/)\nI can improve on in these articles.\n\nThanks for reading and happy reversing!\n\n**Radare2, Malware Analysis, Malware Windows, Scripting, Automation, r2pipe,**\n**unpacking**\n\n## More Content Like This:\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-11-24 - TA505 Get2 Analysis.pdf"
    ],
    "report_names": [
        "2019-11-24 - TA505 Get2 Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "5e6b31a6-80e3-4e7d-8b0a-d94897ce9b59",
            "created_at": "2024-06-19T02:03:08.128175Z",
            "updated_at": "2025-03-27T02:05:17.400394Z",
            "deleted_at": null,
            "main_name": "GOLD TAHOE",
            "aliases": [
                "SectorJ04 ",
                "Spandex Tempest ",
                "TA505 ",
                "FIN11 "
            ],
            "source_name": "Secureworks:GOLD TAHOE",
            "tools": [
                " Cobalt Strike",
                " FlawedAmmy",
                " Get2",
                " GraceWire",
                " Malichus",
                " SDBbot",
                " ServHelper",
                " TrueBot",
                "Clop"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536007,
    "ts_updated_at": 1743041737,
    "ts_creation_date": 1653759455,
    "ts_modification_date": 1653759455,
    "files": {
        "pdf": "https://archive.orkl.eu/90070c3a750ad956594da5e8497d7183bc90dce7.pdf",
        "text": "https://archive.orkl.eu/90070c3a750ad956594da5e8497d7183bc90dce7.txt",
        "img": "https://archive.orkl.eu/90070c3a750ad956594da5e8497d7183bc90dce7.jpg"
    }
}