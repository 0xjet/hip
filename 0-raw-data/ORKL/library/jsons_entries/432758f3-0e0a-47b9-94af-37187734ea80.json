{
    "id": "432758f3-0e0a-47b9-94af-37187734ea80",
    "created_at": "2023-01-12T14:59:26.227462Z",
    "updated_at": "2025-03-27T02:16:47.142097Z",
    "deleted_at": null,
    "sha1_hash": "4df7cdcd195e483420d7444fe502063585495128",
    "title": "2020-03-02 - Pulling the PKPLUG- the adversary playbook for the long-standing espionage activity of a Chinese nation-state adversary",
    "authors": "",
    "file_creation_date": "2022-05-28T02:38:34Z",
    "file_modification_date": "2022-05-28T02:38:34Z",
    "file_size": 2258315,
    "plain_text": "# VB2019 paper: Pulling the PKPLUG: the adversary playbook for the long- standing espionage activity of a Chinese nation-state adversary\n\n**[virusbulletin.com/virusbulletin/2020/03/vb2019-paper-pulling-pkplug-adversary-playbook-long-standing-espionage-activity-chinese-nation-state-adversary/](https://www.virusbulletin.com/virusbulletin/2020/03/vb2019-paper-pulling-pkplug-adversary-playbook-long-standing-espionage-activity-chinese-nation-state-adversary/)**\n\n### Alex Hinchliffe\n\n_Unit 42, Palo Alto Networks, UK_\n\nTable of contents\n\nAbstract\n\nIntroduction\n\nPKPLUG\n\nTargeting\n\nXiaomi\n\nAdversary playbooks\n\nMalware used by the PKPLUG adversary\n\nHenBox for Android\n\nDelivery via third-party app store\n\nThe right app at the right time\n\nHenBox capabilities\n\nExecution flow\n\nBehaviour\n\nInfrastructure and related overlaps\n\nTies to previous activity\n\nFarseer for Windows\n\nTies to HenBox\n\nC2 server structure\n\nMalware execution flow\n\nTargeting\n\nConstructing an adversary playbook\n\nATT&CK\n\nSTIX\n\nAttack lifecycle\n\nPlaybook Viewer\n\nDefence analysis\n\nPKPLUG adversary playbook\n\nHenBox\n\nFarseer\n\nConclusions\n\nReferences\n\n## Abstract\n\nThe discovery of two malware families – HenBox for Android and, recently, Farseer for Windows – with significant,\nmostly infrastructure-based overlaps with previously seen malware, such as 9002, PlugX, Poison Ivy and FHAPPI, has\nled us towards what appears to be an undocumented nation-state group, or groups, in China that we refer to as\nPKPLUG. The malware families, infrastructure, and campaign delivery used by PKPLUG highlights broad targeting of\nmultiple sectors and victims in and around the Southeast Asia region and beyond. This research will detail some of the\nPKPLUG campaigns, describing the tooling used and, with MITRE’s ATT&CK framework and other models that underpin\n_Unit 42’s adversary playbooks, highlight PKPLUG’s behaviour with some overlapping TTPs._\n\n\n-----\n\n## Introduction\n\n### PKPLUG\n\n_Unit 42 uses the moniker ‘PKPLUG’ in reference to a threat actor group, or groups, that we have been tracking for a few_\nyears. The name comes from the adversary’s use of PlugX malware, which we noted in their early campaigns, and from\nthe use of ZIP archive files to deliver the malware; the ZIP file format contains the ASCII magic bytes ‘PK’.\n\nOver the years, Unit 42 has investigated PKPLUG and has discovered further malware families being used, including\nother custom malware for Android and Windows that will be described later in this report. Other malware families that\nhave been seen relating to PKPLUG include ‘usual suspects’ Poison Ivy, Zupdax and 9002.\n\nBased on targeting, the content in some of the malware, and ties to infrastructure documented publicly as being linked to\nChinese nation-state adversaries, Unit 42 believes with high confidence that PKPLUG has similar origins.\n\n**Targeting**\n\nBased on our observations of PKPLUG’s campaigns and what we’ve learned from sharing with industry, we believe that\nits victims lie mainly in and around the Southeast Asia region. This report will provide further details, but to be more\nspecific, considering the methods used for malware delivery, the social engineering topics of decoy applications and\ndocuments used, and the command‑and-control (C2) infrastructure themes, target countries include (with higher\nconfidence): Xinjiang, Mongolia, Myanmar and Taiwan; and (with lower confidence): Tibet, Vietnam and Indonesia.\n\nThree of these countries are ASEAN members [1], contributing towards intergovernmental cooperation, and another\nthree are autonomous regions (AR) [2] of China that tend to be classified by China’s ethnic minorities, granted the ability\nto govern themselves but ultimately answering to the People’s Republic of China (PRC). Of the five autonomous regions,\nTibet and Xinjiang are the only ones in which the ethnic group maintains a majority over other populations.\n\nMost, if not all seven target countries are involved in some way with Beijing’s Belt and Road Initiative (BRI) [3], designed\nto connect 71 countries across Southeast Asia to Eastern Europe and Africa. The path through Xinjiang is especially\nimportant [4] to the BRI’s success but is more often heard about due to conflicts [5] between the Government and the\nethnic Uyghur population [6]. News of the BRI is peppered with stories of success and failure; of countries opposed to it,\nor buying into or pulling out of BRI projects.\n\nFurther tensions in the region are attributed to disputes over ownership of the South China Sea, including disputes over\nfishing quotas and the yet unproven oil and gas reserves [7]. At least three of the target countries mentioned above have\nlaid claim to parts of these waters, and some use the area for the vast majority of their trade; foreign militaries are also\ninvolved, attempting to keep the area open.\n\nTaiwan (a.k.a. Republic of China), which isn’t an AR, and which doesn’t appear to be actively involved with the BRI, has\nits own long-standing history with the PRC; a recent $2BN+ arms sale with the US [8] may exacerbate matters.\n\nThe ultimate objective of PKPLUG is not entirely clear, but the backdoors and espionage malware used indicate that\ntracking victims and gathering information is key.\n\n### Xiaomi\n\nHenBox malware, described later in this report, references Xiaomi, hence this section.\n\n_Xiaomi is a firm that designs, develops and sells smartphones, mobile apps, laptops and related consumer electronics._\nThe firm released its first smartphone in August 2011 and rapidly gained market share in China where it became the\nlargest smartphone company in 2014. In 2017, Xiaomi became the world’s fifth largest smartphone company and\novertook Samsung to become the number one smartphone brand in India. Now in fourth place in worldwide smartphone\nmanufacturers behind Apple, Huawei and Samsung, the firm has yet to enter the US smartphone market space.\n\nFigure 1 shows Xiaomi’s performance against other manufacturers. According to the International Data Comparison\n(IDC), Asia Pacific (excluding Japan) remains Xiaomi’s most important region, with China, India and Indonesia\naccounting for the majority volume [9].\n\n\n-----\n\nFigure\n\n1: Xiaomi's performance against other manufacturers.\n\nOver the years Xiaomi has also expanded into the smart home and IoT device ecosystem, producing many devices for\nthe smart home, managed by the MiHome app for smartphones.\n\n### Adversary playbooks\n\n_Unit 42_ [10] is the threat intelligence team at Palo Alto Networks that analyses available data to identify adversaries, their\nmotivations, resources and tactics in order to better understand the threats our customers face. Adversary playbooks\nprovide a threat intelligence package in STIX 2.0 for ingestion by machines for research or protection purposes. These\npackages also include structured details about attack campaigns and adversary behaviours – their tools, techniques,\nand procedures (TTPs) – as well as the expected indicators of compromise (IOCs). Unit 42 aims to release adversary\nplaybooks alongside research published.\n\nThe concept of adversary playbooks is straightforward: just as sports teams create offensive and defensive playbooks to\nwin matches, adversaries also have offensive playbooks they employ during cyber attacks in an attempt to compromise\norganizations.\n\nNetwork defenders, threat researchers and others can create adversary playbooks through observation of live or past\nattacks; by sharing data; and through intelligence analysis. Those playbooks can then be used to better defend networks\nand describe threat actor groups. Combining multiple playbooks, and thus others’ visibility and data sets for the same\nattack or adversary, will ultimately provide a much better picture of the opposition we face.\n\nIn order to be successful and useful for many different use-cases, adversary playbooks must use a structured format that\ncan be shared. We decided not to develop a proprietary format that would potentially make it exclusive to Palo Alto\n_Networks, and instead we make use of Mitre ATT&CK [11], Attack Lifecycle or Cyber Kill Chain(™) [12] and STIX [13]._\n\n## Malware used by the PKPLUG adversary\n\nWe know that the attacks carried out by the PKPLUG actor used multiple malware families, all of which provide\nbackdoor, remote access and spying capabilities. The following sections describe only the newly discovered malware –\nHenBox and Farseer – in more detail.\n\n### HenBox for Android\n\n\n-----\n\nIn early 2018, Unit 42 discovered [14, 15] a new Android malware family that we named HenBox based on metadata,\nsuch as app package names and developer signer information, found in most of the malicious apps analysed. At the\ntime of writing, Unit 42 is tracking over 400 HenBox samples dating back as far as late 2015, and continuing to the\npresent day.\n\nHenBox often masquerades as legitimate Android apps, such as virtual private network (VPN) apps, Android system\napps and so on. Occasionally, HenBox will install legitimate versions of these apps as well as itself, tricking users into\nthinking they have installed the desired app. Whilst some of the legitimate apps HenBox uses for such decoys can be\nfound on the official Google Play app store, HenBox apps themselves have only been found on third-party (non-Google\n_Play) app stores._\n\nHenBox appears primarily to target the Uyghurs – a minority Turkic ethnic group that is primarily Muslim and lives mainly\nin the Xinjiang Uyghur autonomous region in Northwest China. It also targets devices made by Chinese manufacturer\n_Xiaomi and those running MIUI, an operating system based on Google Android made by Xiaomi. Smartphones are the_\ndominant form of Internet access in the region [16], and Xinjiang was recently found to have a higher number of Internet\nusers than the national average in China [17]. The result is a large online population that has been the subject of\nnumerous cyber-attacks in the past [18, 19, 20, 21].\n\nOnce installed, HenBox steals information from the device from a myriad of sources, including many mainstream chat,\ncommunication and social media apps. The stolen information includes personal and device information. Of note, in\naddition to tracking the location of the compromised device, HenBox also harvests all outgoing phone numbers with a\n‘+86’ prefix, which is the country code for the People’s Republic of China (PRC). It can also access the phone’s\nmicrophone and cameras.\n\n**Delivery via third-party app store**\n\nOf the 400+ samples Unit 42 has seen, the vast majority, if used in attacks, have no associated delivery method. It is\nbelieved that such apps, as with many other malicious Android apps, would be delivered to victims via websites or filesharing forums, possibly from links shared in phishing emails or SMS messages. Social media platforms and messaging\n– which support the larger file sizes often needed for Android package (APK) files – could also be used. The large file\nsize is the reason phishing emails with HenBox attachments are unlikely to be the delivery mechanism.\n\nIn May 2016, a HenBox app – an APK file – was downloaded from the uyghurapps[.]net website. The domain name,\nlanguage of the site and app content hosted on the site suggest that this is a third-party app store for which the intended\nusers are the Uyghurs. Third-party app stores are so called because they are not officially supported by Android, and\nthey are not provided by Google, unlike the Play Store. Third-party app stores are ubiquitous in China for a number of\nreasons, including increasingly powerful Chinese original equipment manufacturers (OEMs), a lack of an official Chinese\n_Google Play app store, and a growing smartphone market._\n\nAt the time of analysis, the uyghurapps[.]net website hosted a number of secure communication, VPN and social media\napps. Given what we know from the media about the region, it’s clear that such apps are critical for the population to\nprotect themselves and communicate with others.\n\nThe HenBox app downloaded from uyghurapps[.]net was masquerading as an another app, DroidVPN. At the time of\nanalysis, the content served on uyghurapps[.]net at the URL from which HenBox was downloaded was a legitimate\nversion of DroidVPN. The app page, where users can download the app and learn more about it, is shown in Figure 2.\nIt’s highly likely that the page looked the same during the time HenBox was available, and that the APK file for DroidVPN\nwas simply replaced with a copy of HenBox.\n\n\n-----\n\nFigure 2: The uyghurapps[.]net app\n\nstore showing the current DroidVPN app.\n\nVPNs allow connections to remote private networks, increasing the security and privacy of the user’s communications.\nAccording to the DroidVPN app description, it ‘helps bypass regional Internet restrictions, web filtering and firewalls, by\ntunnelling traffic over ICMP’. Some features may require devices to be rooted in order to function and, according to some\nthird-party app stores, unconditional rooting is required, which has additional security implications for the target device.\n\n_Unit 42 has not been able to ascertain how the malicious HenBox app, referenced in Table 1, got onto the app store._\nHowever, some open-source intelligence indicates that the server was running an outdated version of Apache Web\n_Server on a Windows 32-bit operating system. In light of this, we believe an attack against unpatched vulnerabilities, or a_\nbrute-force login attack, are reasonable conjectures as to how the server was compromised, ultimately leading to the\n_DroidVPN APK file being overwritten with the malicious HenBox APK._\n\n**APK SHA256** **Size (bytes)** **First seen** **App package name** **App name**\n\n0589bed1e3b3d623 2,740,860 May 2016 com.android.henbox DroidVPN\n\n4c30061be3be1cc66\n\n85d786ab3a892a8d4\n\ndae8e2d7ed92f7\n\nTable 1: Details of the HenBox DroidVPN app on the uyghurapps[.]net app store.\n\nAs can be seen in Table 1 and Figure 3, despite the unique ‘com.android.henbox’ package name, the HenBox malware\ncopied the legitimate app’s name, ‘DroidVPN’, as well as its icon to further trick victims into believing they had installed\n_DroidVPN and not something totally different._\n\n|APK SHA256|Size (bytes)|First seen|App package name|App name|\n|---|---|---|---|---|\n|0589bed1e3b3d623 4c30061be3be1cc66 85d786ab3a892a8d4 dae8e2d7ed92f7|2,740,860|May 2016|com.android.henbox|DroidVPN|\n\n\n-----\n\nFigure 3: HenBox app installed, purporting to be DroidVPN.\n\nIn addition to the look and feel of DroidVPN, the HenBox variant also contained a copy of the original, legitimate\n_DroidVPN app as an asset within its APK package. Assets can be compared to resource items within a Windows_\nPortable Executable (PE) file. Once the HenBox app is installed and run, it executes code that causes the Android\noperating system (OS) to launch the install process for the embedded app. HenBox probably does this for two reasons.\nFirst, to act as a decoy to detract from other malicious behaviours occurring in the background, and secondly, to satisfy\nthe victim that they are installing the app they wanted. Whether or not the user is suspicious of the first app installation is\nunknown to us, but based on the names used in other HenBox variants, such as ‘Backup’ and ‘Settings’, it’s highly likely\nthat the app could be passed off in some instances as a benign activity to backup data pre-install, or to change settings\nprior to install.\n\nAt the time of our research, the version of DroidVPN available for download from uyghurapps[.]net matched that of the\nembedded DroidVPN app inside HenBox. It’s worth noting that newer versions of the DroidVPN app were available on\n_Google Play at the time, as well as in some other third-party app stores, which could indicate that uyghurapps[.]net is not_\nvery well maintained or up to date with the latest app versions available.\n\n**The right app at the right time**\n\nThe HenBox-with-embedded-DroidVPN app combination is one example of the attackers choosing to mimic a legitimate\napp in order to compromise their victims. Further combinations included apps that, in their standalone form, were\navailable on Google Play, as well as many third-party app stores. Table 2 lists just three further example apps together\nwith their and HenBox’s respective metadata.\n\n\n-----\n\n**#** **Parent APK SHA256** **First seen** **Package names**\n(HenBox parent APK)\n\n[embedded APK]\n\n\n**APK app names**\n(HenBox parent APK)\n\n[embedded APK]\n\n\n1 fa5a76e86abb26e48a\nf0b312f056d24000bc\n969835c40b3f98e5ca\n7e301b5bee\n\n2 1749df47cf37c09a92\nb6a56b64b136f15ec\n59c4f55ec835b1e569\nc88e1c6e684\n\n3 4d437d1ac29b1762c\nc47f8094a05ab73141\nd03f9ce0256d200fc6\n91c41d1b6e7\n\n\nApril 2016 (com.android.henbox)\n\n[com.ziipin.software]\n\nMay 2017 (cn.android.setting)\n\n[com.apps.amaq]\n\nJune 2017 (cn.android.setting)\n\n[com.example.ourplayer]\n\n\n(Uyghurche Kirguzguch)\n\n[Emojicon]\n\n\n(islamawazi)\n\n[islamawazi]\n\n\n(设置 (Backup))\n\n[Amaq Agency]\n\n\nTable 2: Three example apps with their and HenBox’s respective metadata.\n\nThe app icons that would be seen and used to launch the app on an Android device are shown in Table 3.\n\n**#** **Icon** **App description**\n\n1 First HenBox sample seen with a legitimate app embedded within. The app was a Uyghur language\nkeyboard app targeted at native speakers.\n\n2 Masquerades as Android’s Settings app, and has a similar package name. App used the green Bugdroid\nimage for its logo; app name 设置 (‘Backup’). Interestingly, the embedded app was ‘Amaq Agency’, which\nreports on ISIS-related news.\n\n3 The names for both the parent HenBox and the embedded (media player for news) app were identical Islamawazi. Islamawazi (a.k.a. Turkestan Islamic Party or ‘TIP’ [22]) is an organization formerly known as\nthe East Turkestan Islamic Party, purported to be an Islamic extremist separatist organization founded by\nUyghur jihadists.\n\nTable 3: The app icons that would be seen and used to launch the app on an Android device.\n\nThese examples, together with the HenBox app placed on a very specific third-party app store, point clearly to at least\nsome of the intended targets of these malicious apps being Uyghurs, specifically those with a potential interest in, or\nassociation with, terrorist groups. The threat actors behind HenBox appear to be choosing the right apps (those that\ncould be popular with locals in the region) at the right time (while tensions grow in this region of China) to ensure a high\nprobability of installing their malware.\n\n**HenBox capabilities**\n\nHenBox has certainly evolved over the past four years but the structure of the over 400 samples has largely stayed the\nsame. This structure includes multiple component files and native libraries used to achieve the goal of data collection\nand spying on the victim. Most components are obfuscated in some way, whether it be by simple XOR with a single-byte\nkey, compressing using ZIP or Zlib compression, or encryption using RC4. These components are responsible for a\nmyriad of functions and features including handling decryption, network communications, gaining super-user privileges,\nmonitoring system logs, loading additional Dalvik code files, tracking the device location and more.\n\nThe remainder of this section describes at a high level what HenBox is capable of, and how it operates. The description\nis based on analysis of the sample described in the table below, which was of interest given that its C2 domain,\nmefound[.]com, overlapped with the PlugX, Zupdax and Poison Ivy malware families discussed in more detail later.\n\n|#|Icon|App description|\n|---|---|---|\n|1||First HenBox sample seen with a legitimate app embedded within. The app was a Uyghur language keyboard app targeted at native speakers.|\n|2||Masquerades as Android’s Settings app, and has a similar package name. App used the green Bugdroid image for its logo; app name 设置 (‘Backup’). Interestingly, the embedded app was ‘Amaq Agency’, which reports on ISIS-related news.|\n|3||The names for both the parent HenBox and the embedded (media player for news) app were identical - Islamawazi. Islamawazi (a.k.a. Turkestan Islamic Party or ‘TIP’ [22]) is an organization formerly known as the East Turkestan Islamic Party, purported to be an Islamic extremist separatist organization founded by Uyghur jihadists.|\n\n|SHA256|Package name|App name|\n|---|---|---|\n\n\n-----\n\na6c7351b09a733a1b3ff8a0901c5bde\n\nfdc3b566bfcedcdf5a338c3a97c9f249b\n\n\ncom.android.henbox 备份 (Backup)\n\n\nTable 4: HenBox variant used in analysis.\n\nExecution flow\n\nOnce this variant of HenBox is installed on the victim’s device, the app can be executed in two different ways.\n\nThe first method, as depicted in Figure 4, is automatic based on the operating system generating one of a handful of\nevent broadcasts that HenBox registered its intent to process during the app installation process. Examples include\nevents like device reboots, when an app is newly installed, or when a network connection is changed.\n\nFigure 4: Automatic HenBox execution.\n\nAll the intents registered statically via this HenBox variant’s AndroidManifest.xml file are listed and described in Table 5;\nHenBox also registers further intents at runtime.\n\n|Receiver|Intent name|Description|\n|---|---|---|\n|BootReceiver|android.intent.action.BOOT_COMPLETED|System notification that the device has finished booting.|\n|android.intent.action.restart|A legacy intent used to indicate a system restart||\n|android.intent.action.SIM_STATE_CHANGED|System notification that the SIM card has changed or been removed.||\n|android.intent.action.PACKAGE_INSTALL|System notification that the download and eventual installation of an app package is happening (this is deprecated).||\n|android.intent.action.PACKAGE_ADDED|System notification that a new app package has been installed on the device, including the name of said package.||\n|com.xiaomi.smarthome.receive_alarm|Received notifications from Xiaomi’s smart home IoT devices.||\n|TimeReceiver|android.intent.action.ACTION_TIME_CHANGED|System notification that the time was set.|\n\n\n-----\n\nandroid.intent.action.CONNECTIVITY_CHANGE System notification that a change in network\nconnectivity has occurred (has either been lost or\nestablished). Since Android version 7 (Nougat) this\ninformation has been gathered using other means –\nperhaps suggesting that the devices used by\npotential victims run older versions of Android.\n\nTable 5: HenBox variant’s intents and receivers defined statically.\n\nMost of the intents listed in Table 5 and shown in Figure 4 are commonly found in malicious Android apps and are the\nequivalent of setting registry run keys in Windows to autostart applications at reboot. One intent stands out and is much\nless common: com.xiaomi.smarthome.receive_alarm.\n\nGiven the nature of connected devices in smart homes, it’s highly likely they will communicate via alerts and notifications\nwith controller apps, such as Xiaomi’s MiHome. Because HenBox registers the same intent, it too can process alerts\ndestined for MiHome and use them as a trigger to execute code. Essentially, this allows for external IoT devices to act as\na trigger to execute the malicious HenBox app’s code.\n\nTriggered intents result in execution of code that is present in either the BootReceiver class or the TimeReceiver class,\nboth of which ultimately lead to a new instance of the DaemonServer service being created and started (this service is\ndiscussed in more detail later). In addition, BootReceiver changes the device ringer mode to a value of 2, which results\nin ringtones being audible and the vibrate mode being switched on. This may have been done in an attempt to get\nnearby people to interact with the (now noisy) device such that the information stolen may be richer in content.\n\nThe alternative method for executing HenBox is for the user to launch the malicious app (named ‘Backup’ in this\ninstance) from the launcher view on their device, as shown in Figure 5.\n\n\n-----\n\nFigure 5: HenBox app installed and visible on Android’s launcher view.\n\nBehaviour\n\nUpon manual launch, the HenBox code executes and performs the steps highlighted in Figure 6.\n\nFigure 6: Manual HenBox execution.\n\n\n-----\n\nFirst, checks are made to determine whether the device manufacturer is Xiaomi, or whether the firmware is MIUI\n(Xiaomi’s fork of Android). The intention here seems to be one of targeting Xiaomi and exiting prematurely if the checks\nfail. However, poorly written code results in the code being executed in perhaps more environments than the adversary\nintended. Anti-emulation and anti-debug checks try to ascertain whether HenBox is being analysed. Interestingly, the\nadversaries concealed their code for these additional checks inside a class called AlarmService, which appears to be a\ndirect copy from online developer tutorials for creating alarm apps. If these checks pass, HenBox continues to execute\nby next loading the ELF library libloc4d.so.\n\nUsing Android’s shared preferences feature to persist XML key value pair data, HenBox checks whether this execution is\nits first. If it is, and if the app’s path does not contain ‘/system/app’ (i.e. HenBox is not running as a system app, which\nprovides elevated privileges), one of two embedded ‘su?’ ELF libraries is XOR-decoded. A Java Native Interface (JNI)\ncall is then issued to libloc4d.so to execute the ‘su?’ (henceforth sux) binary.\n\nThe two files, ‘suy’ and ‘sux’, are essentially the same: ‘sux’ is used if the Android version on the victim’s device is 4.1\n(a.k.a. ‘Jelly Bean’) or newer; ‘suy’ will be used for older versions.\n\nFinally, an instance of the DaemonServer service starts and, if a decoy app is embedded inside HenBox, as per the\n_DroidVPN example, the installation process for the decoy also starts._\n\nFigure 7 illustrates the typical behaviour of the DaemonServer service, starting with hiding the HenBox app from the\nlauncher view and from the app drawer/tray. This behaviour is common amongst Android malware and, while the app\nremains installed with its services running, it is harder for the victim to discover it.\n\nFigure 7: DaemonServer service behaviour.\n\nThe non-obfuscated ELF file ‘daemon’ is loaded next, to gather environmental information about the device by accessing\nsystem and radio log files, and by querying running processes.\n\nA Baidu library is loaded next, and used to gather device geo-location information.\n\nThe DaemonServer class then registers a runtime intent to intercept outgoing phone calls, allowing the checking of\nnumbers dialled. In particular, HenBox filters numbers based on prefixes matching ‘+86’ – the country code for the\nPeople’s Republic of China.\n\nFurther assets are then deployed and decoded, including a.zip and setting.txt – the config file for HenBox. Code is also\npresent in this variant to deploy additional assets named ‘plugin’ and ‘AppVoice’ – they are not present in this particular\nsample, but are a likely indication of evolving development and the use of yet further components.\n\nHenBox’s config file, setting.txt, is decoded using XOR with a single-byte key, 0x88; filenames and XOR keys differ\noccasionally between variants. The config file is shown in the Farseer section later.\n\nFinally, DaemonServer launches a worker thread to perform further execution tasks. One of the key components used is\nthe ELF file named b.dat, which in turn interacts with a.zip. The archive a.zip contains two further files: libkernel.so\n(another ELF file) and lib.dat, which is actually a Dalvik DEX file containing further Java code and malicious functionality\n\n\n-----\n\nbeyond the app s default (and mandatory) classes.dex file. Some of the key data harvesting behaviour of HenBox stems\nfrom these files – b.dat and the contents of a.zip, all four of which are RC4-encrypted, forming the most heavily\nobfuscated components within HenBox.\n\nOnce unpacked and available for use, the new DEX file is executed from within the DaemonServer class to enumerate\nall running applications and kill those that have the permission to receive SMS messages, before registering its own\nruntime intent to process them instead, thus intercepting the victim’s messages.\n\nThe method continues by loading the libkernel.so library file, also unpacked from the a.zip archive. This ELF file has\nnumerous capabilities, many of which come from BusyBox – a package containing various stripped-down Unix tools that\nare useful for system administration. This executable interacts with the aforementioned sux executable and, amongst\nother things, temporarily disables the noise made by the device when photos are taken. This behaviour is achieved by\nmoving the audio file ‘/system/media/audio/ui/camera_click.ogg’ elsewhere, then moving it back again once picturetaking is complete.\n\nThe variant of HenBox analysed and described in the previous section specifically checked the compromised device for\ntwo apps listed in Table 6 below. If the apps are present, HenBox harvests information from them about contacts,\nnumbers and conversations.\n\n**Package name** **App name**\n\ncom.rebelvox.voxer Voxer Walkie Talkie Messenger\n\ncom.tencent.mm Tencent’s WeChat\n\nTable 6: Targeted messaging apps in August 2017.\n\nThese types of apps tend to use databases to store their data, which for Voxer is located in\n‘/data/data/com.rebelvox.voxer/databases/rv.db’ on the device. HenBox runs SQL queries against the database to gather\ntheir stored information.\n\nA little over four months after this variant of HenBox was seen, newer versions were available with significant changes to\nthe number of targeted apps, as shown in Table 7.\n\n|Package name|App name|\n|---|---|\n|com.rebelvox.voxer|Voxer Walkie Talkie Messenger|\n|com.tencent.mm|Tencent’s WeChat|\n\n|Package name|App name|\n|---|---|\n|com.whatsapp|WhatsApp Messenger|\n|com.pugna.magiccall|n/a|\n|org.telegram.messenger|Telegram|\n|com.facebook.katana|Facebook|\n|com.twitter.android|Twitter|\n|jp.naver.line.android|LINE: Free Calls & Messages|\n|com.instanza.cocovoice|Coco|\n|com.beetalk|BeeTalk|\n|com.gtomato.talkbox|TalkBox Voice Messenger – PTT|\n|com.viber.voip|Viber Messenger|\n|com.immomo.momo|MOMO陌陌|\n|com.facebook.orca|Messenger – Text and Video Chat for Free|\n|com.skype.rover|Skype; 3rd party stores only|\n\n\n-----\n\nTable 7: Targeted messaging apps in January 2018.\n\nMost of these apps are well established and available on Google Play, however, com.skype.rover and\ncom.pugna.magiccall appear to be available only on third-party app stores.\n\nIt’s clear to see that the capabilities of HenBox are very comprehensive, not only in terms of a complex and pretty\nsophisticated Android app, but also as a very effective spying tool.\n\n**Infrastructure and related overlaps**\n\nWhile investigating HenBox, Unit 42 discovered infrastructure ties to other malware families associated with targeted\nattacks against Windows users, with notable overlaps including PlugX, Zupdax, 9002 and Poison Ivy. Figure 8 paints a\npicture of an adversary with at least five malware families in its toolbox, dating back to at least 2015.\n\nFigure 8: HenBox and related malware.\n\nThe overlap between the HenBox and 9002 malware families involves three shared C2s between several samples:\n\n47.90.81[.]23\n222.139.212[.]16\nlala513.gicp[.]net\n\nThe overlaps between the HenBox, PlugX, Zupdax and Poison Ivy malware families involves a web of shared C2s and\nIP resolutions centred around the following:\n\n59.188.196[.]172\ncdncool[.]com (and third levels of this domain)\nwww3.mefound[.]com\nwww5.zyns[.]com\nW3.changeip[.]org\n\nTies to previous activity\n\nThe registrant of cdncool[.]com also registered six other domains. To date, we have seen four of the seven (the first three\nin the list below, along with cdncool[.]com) used in malicious activity, and it is reasonable to assume that the remaining\nthree are, or were, intended to serve the same purpose.\n\ntcpdo[.]net\nadminsysteminfo[.]com\nmd5c[ ]net\n\n\n-----\n\nlinkdatax[.]com\ncsip6[.]biz\nadminloader[.]com\n\n_Unit 42 published a blog [23] in July 2016 about 9002 malware being delivered using a combination of shortened links_\nand a file hosted on Google Drive. The spear-phishing emails had Myanmar political-themed lures and, if the 9002 C2\nserver responded, the trojan sent system-specific information along with the string ‘jackhex’. ‘Jackhex’ has also been\npart of a C2 for what is probably related Poison Ivy activity (detailed below), along with additional infrastructure ties.\n\nThe C2 for the aforementioned 9002 sample was logitechwkgame[.]com, which resolved to the IP address\n222.239.91[.]30. At the same time, the domain admin.nslookupdns[.]com also resolved to the same IP address,\nsuggesting that these two domains are associated with the same threat actor. In addition, admin.nslookupdns[.]com was\na C2 for Poison Ivy samples associated with attacks on Myanmar and other Asian countries and discussed in a blog post\n\n[24] published by Arbor Networks in April 2016. Another tie between the activities is the C2 jackhex.md5c[.]net, which\nwas also used as a Poison Ivy C2 by the samples discussed in the Arbor Networks blog. Finally, since publishing the\n9002 blog, Unit 42 has also seen the aforementioned 9002 C2 being used as a Poison Ivy C2 with a Myanmar politicalthemed lure.\n\nIn our 9002 blog we noted some additional infrastructure used either as C2s for related Poison Ivy samples, or as\ndomain registrant overlap with those C2 domains. When we published that blog we hadn’t seen any of the three\nregistrants overlap domains used in malicious activity. Since then, we have seen Poison Ivy samples using third levels of\nquerlyurl[.]com, lending further credence to the idea that the remaining two domains, gooledriveservice[.]com and\nappupdatemoremagic[.]com, are, or were, intended for malicious use. While we do not have complete targeting\ninformation associated with these Poison Ivy samples, several of the decoy files were in Chinese and appear to be part\nof a 2016 campaign targeting organizations in Taiwan with political-themed lures.\n\n### Farseer for Windows\n\nThrough further investigations into infrastructure used by the HenBox malware, Unit 42 discovered [25] another,\npreviously unknown, malware family designed to run on Windows.\n\nFarseer – named due to a string found in the PDB path embedded within the executable files (see example below) – is a\nbackdoor trojan that we can trace back in our data to 2016 and that we continue to see in 2019, albeit in small numbers.\n```\ne:\\WorkSpace\\A1\\coding\\Farseer\\RemoteShellsRemote\\Release\\RemoteShellsRemote.pdb.\n\n```\n**Ties to HenBox**\n\nThe infrastructure used by the combination of malware families discussed so far is vast, with numerous overlaps,\nhowever the remainder of this report will focus only on some core ties between the Farseer and HenBox, PlugX, Zupdax,\n9002 and Poison Ivy malware families.\n\nFigure 9 shows a high-level representation of file hashes, IP addresses and domain names used by some of the\nmalware families mentioned, together with their overlaps highlighted by the green rectangle.\n\n\n-----\n\nFigure 9: Maltego chart\n\nshowing overlaps between Farseer and related threats.\n\nDespite the image indicating that Farseer has the largest number of malware samples (red dots), this is not the case\nwhen considering the entire set of malware samples and merely appears this way due to the focus of this section of the\nreport.\n\nOne of the most recent Farseer samples (SHA256:\n271e29fe8e23901184377ab5d0d12b40d485f8c404aef0bdcc4a4148ccbb1a1a) introduced a new C2 domain –\ntcpdo[.]net – into the Farseer set, as shown in Figure 10.\n\n\n-----\n\nFigure 10: Tcpdo[.]net ties between Farseer and Poison Ivy samples.\n\nThis sample communicates directly with tcpdo[.]net for its C2 whereas other Farseer samples communicate indirectly,\nthrough third-level domains and IP addresses. A handful of Poison Ivy samples have also used this domain as their C2,\nmost of them prior to this Farseer sample (as early as mid-2015) but also more recently, on 17 December 2018,\nindicating a fairly active domain.\n\nThe overlaps between Farseer and Poison Ivy don’t end with tcpdo[.]net. Much as with HenBox, other infrastructure ties\nexist: directly through sony36[.]com and md.son36[.]com; indirectly through third-level domains of tcpdo[.]net and IP\naddresses 45.32.251[.]7 and 45.32.53[.]250.\n\nFarseer also overlaps with HenBox and PlugX samples through multiple C2 domains and IP address resolutions:\n\nouthmail[.]com (and third levels of this domain)\ncdncool[.]com (and third levels of this domain)\nwww3.mefound[.]com\nw3.changeip[.]org\nwww5.zyns[.]com\n45.32.53[.]250\n45.32.44[.]52\n45.32.45[.]77\n59.188.196[.]162\n59.188.196[.]172\n\n**C2 server structure**\n\nAs previously mentioned, a common registrant registered seven known domains related to the malware discussed.\nInterestingly, all of the domains have at least one third-level domain in common, perhaps indicating a template being\nused for the infrastructure setup. Table 8 lists the commonalities, aside from other more common sub-domains such as\nwww, mail and dns.\n\n**Domain / third-level domain** **info.** **re.** **update.** **up.**\n\ntcpdo[.]net - - \n|Domain / third-level domain|info.|re.|update.|up.|\n|---|---|---|---|---|\n\n\n-----\n\n|adminsysteminfo[.]com|•|•|•|Col5|\n|---|---|---|---|---|\n|md5c[.]net|||||\n|linkdatax[.]com|•|•|•||\n|csip6[.]biz|•|•|•||\n|adminloader[.]com||•|•||\n|cdncool[.]com|•|•|•|•|\n|newfacebk[.]com|||•||\n\n\nTable 8: Common third-level domain names set up on C2 servers.\n\n**Malware execution flow**\n\nThis section aims to provide a description of the general behaviour of the Farseer malware. Figure 11 describes at a high\nlevel the post-installation execution flow of a typical sample.\n\nFigure 11: Execution flow of Farseer malware.\n\nFor persistence on the host, Farseer creates a registry entry named sys under:\n```\nHKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\n\n```\nThis runs the VBS script slmgr.vbs that contains:\n```\ncreateobject(\"wscript.shell\").run \"C:\\Users\\[username]\\AppData\\Roaming\\windows\\bscmake.exe\"\n\n```\nThis is step 1 (in Figure 11), which starts the Farseer execution when a user logs onto their PC.\n\nSteps 2 and 3 involve a DLL-sideloading technique using a signed Microsoft file, bscmake.exe, which is part of\n_VisualStudio. This executable in turn imports several DLL files, including mspdb80.dll, which in turn imports sys.dll – the_\nmalicious payload.\n\nThe payload, stub.bin, is encrypted and compressed on disk but is decrypted as it’s loaded into memory by sys.dll.\nFarseer’s config file, sys.dat, is also loaded during this fourth step in the flow. Much like the HenBox config file, sys.dat is\nobfuscated simply using ASCII encoding. Once decoded, the config is structured as per the example in the left column of\nTable 9.\n\n|Farseer config|HenBox config|\n|---|---|\n\n\n-----\n\np1=up.outhmail[.]com\n\np2=80\n\np4=test-04-11\n\np5=C:\\Users\\[username]\\AppData\\Local\\Temp\\main.exe\n\n\na1=wd.w3.ezua[.]com\n\na2=80\n\n[[email protected][.]com](https://www.virusbulletin.com/cdn-cgi/l/email-protection)\n\na4=smtp.21cn[.]com\n\na5=crash_report\n\n[[email protected][.]com](https://www.virusbulletin.com/cdn-cgi/l/email-protection)\n\na7=\n\na8=0914D1D428914B09A5372866B39524B9\n\na9=\n\nb1=0\n\nb2=0\n\nb3=1\n\nb4=http://www3.mefound[.]com/aa.txt\n\n\nTable 9: Similarities between the Farseer and HenBox config files.\n\nIn the Farseer config file:\n\np1 is the C2 FQDN\np2 is the TCP port used (many variants use non-standard ports)\np3 is missing\np4 is a version string sent in the C2, perhaps a campaign identifier of some sort\np5 is the full file path from which the malware was launched.\n\nAt present, we do not know what all the HenBox options refer to.\n\nThe two malware config files have some similarities, which strengthens the idea of them being related to a common\nadversary. Both are text files, read and parsed at runtime; more often than not, the data is encoded simply. Perhaps the\nmost notable similarities in notation are as follows:\n\nKey value pairs are ‘=’ delimited\nEach line uses a single character followed by a single digit starting at 1\nBoth have the C2 host on line 1\nBoth have the TCP port on line 2.\n\n**Targeting**\n\nOne of the earliest Farseer samples we analysed also contained a decoy PDF document that was opened during\nexecution. The PDF content included a copy of an article from a Myanmar news website that reports on the Southeast\nAsia region. The PDF file properties indicate that it was created on a Chinese-language system, and the creation date\nwas eight days prior to the Farseer sample using said PDF.\n\nAfter publishing information on Farseer, an industry partner told us that their product telemetry showed a Farseer sample\nrunning on a Windows system located in, or communicating through an ISP in Ulaanbaatar, Mongolia. This additional\ncontext, along with the decoy document used, helps to confirm our suspected target countries.\n\n## Constructing an adversary playbook\n\nThis section introduces the public frameworks and tools underpinning adversary playbooks, and describes the PKPLUG\nedition.\n\n### ATT&CK\n\nMITRE’s Adversarial Tactics, Techniques and Common Knowledge (ATT&CK™) is a curated knowledgebase and model\nfor cyber adversary behaviour, reflecting the various phases of an adversary’s lifecycle and the platforms they are known\nto target.\n\n### STIX\n\n\n-----\n\nStructured Threat Information Expression (STIX ) is a language and serialization format used to exchange cyber threat\nintelligence (CTI).\n\nSpecifically, the latest iteration of the STIX format, version 2.0, simplifies the creation of documents and uses JSON,\nrather than XML. This version also provides a list of objects to represent types of information typically generated for CTI.\nFor instance, STIX includes objects for intrusion sets, malware and indicators, amongst others. The information and\nattributes stored within STIX objects, and the relationship between the various object types, adhere to standards, which\nallows this intelligence to be shared and consumed without the need for complex parsing tools.\n\n### Attack lifecycle\n\nAn adversary must complete a linear, phase-based process to successfully execute an attack. Humans can better\ncomprehend an attack by breaking it down into smaller, phased-based pieces, and work to break the lifecycle at various\npoints in order to prevent successful attacks.\n\nThe attack lifecycle is a customized Cyber Kill Chain(™) from Lockheed Martin, and is described in Figure 12.\n\nTo meld these three frameworks together, we looked at how ATT&CK data mapped to STIX 2.0 and then chose\nappropriate objects for additional adversary playbook components, as Table 10 describes.\n\nFigure 12: Attack lifecycle.\n\n**STIX 2.0 object** **Adversary playbook component**\n\nIntrusion Set Adversary\n\nReport Playbook\n\nReport Play\n\nCampaign Campaign\n\nKill-Chain-Phase ATT&CK Tactic\n\nAttack-Pattern ATT&CK Techniqu\n\nIndicator Indicator\n\nMalware Adversary Malware\n\nTool Adversary Tool\n\nTable 10: STIX 2.0 to adversary playbook object mapping.\n\nWith these definitions complete, we began mapping the activities of particular adversaries to the ATT&CK framework,\nand stored the respective data and related IOCs as STIX in JSON format.\n\n### Playbook Viewer\n\n|STIX 2.0 object|Adversary playbook component|\n|---|---|\n|Intrusion Set|Adversary|\n|Report|Playbook|\n|Report|Play|\n|Campaign|Campaign|\n|Kill-Chain-Phase|ATT&CK Tactic|\n|Attack-Pattern|ATT&CK Techniqu|\n|Indicator|Indicator|\n|Malware|Adversary Malware|\n|Tool|Adversary Tool|\n\n\n-----\n\nAs previously mentioned, adversary playbooks are JSON formatted STIX CTI packages describing threat actors, their\ncampaigns (each one an instance of the attack lifecycle), their behaviours (using ATT&CK) and, finally, the IOCs for each\ncampaign. Consumers can ingest the STIX as they always have done, however, many systems (at the time of launch)\ndid not handle STIX 2.0 content, and certainly none existed that would display an entire adversary playbook for humans\nto better understand and visualize the information.\n\n_Unit 42 released a simple tool to enable the playbook to be viewed through a web interface. A screenshot of the_\nPlaybook Viewer [26] is shown in Figure 13; a live version can be accessed at GitHub.\n\nFigure 13: Example Rancor adversary playbook viewed through Playbook Viewer.\n\nPlaybook Viewer allows a user to choose an adversary from the list shown. This provides a description and another list\nof their campaigns (at least the ones we know about, and those we’ve converted to STIX). Selecting a campaign shows\nlists of the adversary’s TTPs (using ATT&CK notation) laid out in columns as per the attack lifecycle phases. Of course,\nthe level of detail described in each playbook is limited to the visibility one has of a given campaign, thus the sharing,\nmerging and enriching of these is critical to build a more holistic view of a given adversary.\n\n### Defence analysis\n\nBeyond ingesting IOCs and visualizing adversary playbooks, another use-case exists around improving defences.\nUnderstanding the common TTPs used by malware and adversaries that persistently attack your organization should\nhelp to prioritize defence efforts. These don’t just have to be deploying security solutions but also designing policies and\nprocesses to reduce the risk for the organization and enforcing them, wherever possible, using technology.\n\n## PKPLUG adversary playbook\n\nSome of the malware families used by the PKPLUG adversary have been described in detail in this report. It is those\n(HenBox and Farseer) that are described here, in playbook form.\n\n### HenBox\n\nTable 11 describes the single ‘play’ (a.k.a. campaign) related to the variant of HenBox discovered on the Uyghur app\nstore. Other plays, each an instance of an attack lifecycle, exist for many more samples and may have some TTPs that\ndiffer. A full list of plays, together with all the IOCs, is available on the Playbook Viewer.\n\n\n-----\n\n|Phase|TTP|Description / STIX & IOCs|\n|---|---|---|\n|Reconnaissance|T1249: Conduct social engineering|Creation of decoy documents; spoofing legitimate mobile apps; setting up domains with copycat names using relevant and interesting themes.|\n|T1264: Identify technology usage patterns|Targeting of Xiaomi devices, Android users and Uyghur app store infers understanding of the victims’ MO.||\n|T1265: Identify supply chains|Using the Uyghur app store to deliver HenBox would first require identification of the delivery mechanism.||\n|T1295: Analyse social and business relationships, interests, and affiliations|Knowledge of the Uyghur ethnicity and religious beliefs to use in social engineering lures (e.g. Islam- related apps); knowledge, or suspected use, of various social network, secure messaging and communications apps by the victims.||\n|Weaponization|T1307: Acquire and/or use third- party infrastructure services|Use of Uyghur app store to deliver HenBox.|\n|T1312: Compromise third-party infrastructure to support delivery|How the app store is compromised but an app was overwritten with HenBox.||\n|T1345: Create custom payloads|HenBox and Farseer are custom malware; others used, such as PlugX, were custom when discovered but are now believed to be used by many groups.||\n|Delivery|T1474: Supply chain compromise (mobile)|Third-party app store APK URL: [url:value = ’uyghurapps[.]net/mobile/downAction.action?appId=40’] Hash of HenBox APK purporting to be DroidVPN app on third-party app store: [file.hashes.’SHA-256’ = ‘0589bed1e3b3d6234c30061be3be1cc6685d786ab3a892a8d4dae8e2d7ed92f7’]|\n\n\n-----\n\nT1476: Deliver\nmalicious app\nvia other means\n(mobile)\n\n\nDelivery of\nHenBox through\ncompromised\nthird-party app\nstore; other\nmethods assumed\nincluding\nphishing/smishing,\nfile-sharing\nwebsites, forums,\netc. These are\ncommon with\n_Android malware_\ndelivery.\n\n|Col1|websites, forums, etc. These are common with Android malware delivery.|Col3|\n|---|---|---|\n|Exploitation|-|No exploits against vulnerabilities used, to our knowledge; requires user interaction.|\n|Installation|T1027: Obfuscated files or information|Mixture of compression, obfuscation and encryption used for components of HenBox malware, including config files and further payloads.|\n|T1406: Obfuscated files or information (mobile)|HenBox requires installation by victim, through social engineering. HenBox monitors for system event broadcasts and executes accordingly. This includes device reboots, SIM card and network changes, new apps installed, and so on. HenBox monitors installed apps to steal information from target apps.||\n|T1204: User execution|HenBox requires installation by victim, through social engineering.||\n|T1402: App auto-start at device boot (Mobile)|HenBox monitors for system event broadcasts and executes accordingly. This includes device reboots, SIM card and network changes, new apps installed, and so on.||\n|T1418: Application discovery (mobile)|HenBox monitors installed apps to steal information from target apps.||\n|Command & control|T1065: Uncommonly used port|This variant of HenBox used TCP port 888.|\n|T1071: Standard application layer protocol|HenBox used HTTP to communicate with the C2.||\n|Actions on objectives|T1412: Capture SMS messages (mobile)|Intercepts SMS messages.|\n\n\n-----\n\n|T1413: Access sensitive data in device logs (mobile)|Gathers system and device logs.|\n|---|---|\n|T1416: Android intent hijacking (mobile)|HenBox registered for Xiaomi events likely to originate from IoT devices.|\n|T1418: Application discovery (mobile)|Enumeration of existing and monitoring of newly installed apps.|\n|T1421: System network connections discovery (mobile)|Enumerates cellular and Wi-Fi networks; monitors for network changes (e.g. switching from one to another).|\n|T1422: System network configuration discovery (mobile)|HenBox gathers IMEI and similar device and system identifiers.|\n|T1426: System information discovery (mobile)|Gathers system version information.|\n|T1429: Microphone or camera recordings (mobile)|Records information using device sensors.|\n|T1430: Location tracking (mobile)|Tracks device location.|\n|T1432: Access contact list (mobile)|Gathers information from device contacts database, as well as contacts stored on certain target messaging apps.|\n|T1433: Access call log (mobile)|Gathers call log information and sets a filter for calls to +86 country code (China) to steal the phone numbers involved.|\n\n\nTable 11: The single ‘play’ (a.k.a. campaign) related to the variant of HenBox discovered on the Uyghur app store.\n\n### Farseer\n\n\n-----\n\nTable 12 describes the single ‘play’ (a.k.a. campaign) related to some of the latest variants of Farseer.\n\n**Phase** **TTP** **Description / STIX & IOCs**\n\nPre-ATT&CK:\n\nAdversary T1319 Obfuscate or Mixture of compression, obfuscation and encryption used for\nopsec encrypt code components of Farseer malware, including config files and further\n\npayloads.\n\nEstablish & T1328 Buy domain Buying and registering domains for command & control use.\nmaintain name\ninfrastructure\n\nATT&CK:\n\nPersistence T1060 Registry run keys Sets a registry run key to launch.\n/ startup folder\n\nDefence T1140 Deobfuscate / Mixture of compression, obfuscation and encryption used for\nevasion decode files or components of Farseer malware, including config files and further\n\ninformation payloads.\n\nT1045 Software\npacking\n\nT1073 DLL sideloading\n\nCommand & T1071 Standard Farseer used HTTP to communicate with the C2\ncontrol application layer\n\nprotocol\n\nT1065 Farseer has used TCP\nUncommonly ports 158, 993 and\nused port others\n\nT1043 Farseer has also used\nCommonly used TCP port 80\nport\n\nTable 12: The single ‘play’ (a.k.a. campaign) related to some of the latest variants of Farseer.\n\n## Conclusions\n\nPKPLUG is a fairly long-standing, active and formidable adversary operating against targets in the Southeast Asia region\nfor what could be various reasons, but clearly interested in information‑gathering, tracking and espionage.\n\nSharing threat intelligence data is very important if others are to learn about targeted cyber attacks and data breaches.\nFurthermore, sharing not only the IOCs of a given attack but also the TTPs of how the adversary breached and moved\nthroughout the network to fulfil its goals is critical. Sharing TTPs is more difficult, but the use of adversary playbooks –\nbuilding on solid foundational frameworks – is a great start in providing the necessary structure to do so.\n\n_Unit 42 continues to track PKPLUG and the tools used by this adversary; updates to research, IOCs and the PKPLUG_\nadversary playbook will be released periodically.\n\n## References\n\n[1] ASEAN Member States. [https://asean.org/asean/asean-member-states/.](https://asean.org/asean/asean-member-states/)\n\n[2] What Are the Autonomous Regions of China? https://www.sporcle.com/blog/2019/04/what-are-the-autonomousregions-of-china/.\n\n|Phase|TTP|Description / STIX & IOCs|\n|---|---|---|\n|Pre-ATT&CK:|||\n|Adversary opsec|T1319 Obfuscate or encrypt code|Mixture of compression, obfuscation and encryption used for components of Farseer malware, including config files and further payloads.|\n|Establish & maintain infrastructure|T1328 Buy domain name|Buying and registering domains for command & control use.|\n|ATT&CK:|||\n|Persistence|T1060 Registry run keys / startup folder|Sets a registry run key to launch.|\n|Defence evasion|T1140 Deobfuscate / decode files or information|Mixture of compression, obfuscation and encryption used for components of Farseer malware, including config files and further payloads.|\n|T1045 Software packing|||\n|T1073 DLL side- loading|||\n|Command & control|T1071 Standard application layer protocol|Farseer used HTTP to communicate with the C2|\n|T1065 Uncommonly used port|Farseer has used TCP ports 158, 993 and others||\n|T1043 Commonly used port|Farseer has also used TCP port 80||\n\n\n-----\n\n[3] What is China s Belt and Road Initiative? https://www.theguardian.com/cities/ng interactive/2018/jul/30/what china\nbelt-road-initiative-silk-road-explainer.\n\n[[4] China and Xinjiang: The Fate of BRI. https://thegeopolitics.com/china-and-xinjiang-the-fate-of-bri/.](https://thegeopolitics.com/china-and-xinjiang-the-fate-of-bri/)\n\n[[5] China’s Crackdown on Uighurs in Xinjiang. https://www.cfr.org/backgrounder/chinas-crackdown-uighurs-xinjiang.](https://www.cfr.org/backgrounder/chinas-crackdown-uighurs-xinjiang)\n\n[6] This map shows a trillion-dollar reason why China is oppressing more than a million Muslims.\n[https://www.businessinsider.com/map-explains-china-crackdown-on-uighur-muslims-in-xinjiang-2019-2.](https://www.businessinsider.com/map-explains-china-crackdown-on-uighur-muslims-in-xinjiang-2019-2)\n\n[[7] The Battle for the South China Sea. https://edition.cnn.com/interactive/2018/08/asia/south-china-sea/.](https://edition.cnn.com/interactive/2018/08/asia/south-china-sea/)\n\n[8] China Demands US Cancel Arms Sale to Taiwan. https://www.military.com/daily-news/2019/07/10/china-demands-uscancel-arms-sale-taiwan.html.\n\n[9] Smartphone Shipments Experience Deeper Decline in Q1 2019 with a Clear Shakeup Among the Market Leaders,\n[According to IDC. https://www.idc.com/getdoc.jsp?containerId=prUS45042319.](https://www.idc.com/getdoc.jsp?containerId=prUS45042319)\n\n[10] Unit 42. [https://unit42.paloaltonetworks.com/.](https://unit42.paloaltonetworks.com/)\n\n[11] Mitre ATT&CK. [https://attack.mitre.org/.](https://attack.mitre.org/)\n\n[[12] The Cyber Kill Chain(™). https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html.](https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html)\n\n[[13] Structured Threat Information Expression (STIX™). https://oasis-open.github.io/cti-documentation/stix/intro.](https://oasis-open.github.io/cti-documentation/stix/intro)\n\n[14] HenBox: The Chickens Come Home to Roost. https://unit42.paloaltonetworks.com/unit42-henbox-chickens-comehome-roost/.\n\n[[15] HenBox: Inside the Coop. https://unit42.paloaltonetworks.com/unit42-henbox-inside-coop/.](https://unit42.paloaltonetworks.com/unit42-henbox-inside-coop/)\n\n[16] Welcome to the Uighur Web. [https://foreignpolicy.com/2014/04/21/welcome-to-the-uighur-web/.](https://foreignpolicy.com/2014/04/21/welcome-to-the-uighur-web/)\n\n[17] Internet popularity in Xinjiang higher than China’s national average.\n[http://www.chinadaily.com.cn/business/tech/2017-07/08/content_30041010.htm.](http://www.chinadaily.com.cn/business/tech/2017-07/08/content_30041010.htm)\n\n[[18] Hackers Target Uyghur Groups. https://www.rfa.org/english/news/uyghur/hackers-09062012153043.html.](https://www.rfa.org/english/news/uyghur/hackers-09062012153043.html)\n\n[19] Study Finds Unrelenting Cyber Attacks Against China’s Uyghurs. https://securityledger.com/2014/08/study-findsunrelenting-cyber-attacks-against-chinas-uyghurs/.\n\n[20] Cyber Attacks Against Uyghur Mac OS X Users Intensify. https://securelist.com/cyber-attacks-against-uyghur-macos-x-users-intensify/64259/.\n\n[21] Scarlet Mimic: Years-Long Espionage Campaign Targets Minority Activists.\n[https://unit42.paloaltonetworks.com/scarlet-mimic-years-long-espionage-targets-minority-activists/.](https://unit42.paloaltonetworks.com/scarlet-mimic-years-long-espionage-targets-minority-activists/)\n\n[22] Turkistan Islamic Party. [https://en.wikipedia.org/wiki/Turkistan_Islamic_Party.](https://en.wikipedia.org/wiki/Turkistan_Islamic_Party)\n\n[23] Attack Delivers ‘9002’ Trojan Through Google Drive. https://unit42.paloaltonetworks.com/unit-42-attack-delivers9002-trojan-through-google-drive/.\n\n[24] New Poison Ivy Activity Targeting Myanmar, Asian Countries.\n[https://web.archive.org/web/20160618095613/https://www.arbornetworks.com/blog/asert/recent-poison-iv/.](https://web.archive.org/web/20160618095613/https://www.arbornetworks.com/blog/asert/recent-poison-iv/)\n\n[25] Farseer: Previously Unknown Malware Family bolsters the Chinese armoury.\n[https://unit42.paloaltonetworks.com/farseer-previously-unknown-malware-family-bolsters-the-chinese-armoury/.](https://unit42.paloaltonetworks.com/farseer-previously-unknown-malware-family-bolsters-the-chinese-armoury/)\n\n[26] Unit 42 Adversary Playbook Viewer. [https://pan-unit42.github.io/playbook_viewer/.](https://pan-unit42.github.io/playbook_viewer/)\n\n\n-----\n\n## Latest articles:\n\n### Cryptojacking on the fly: TeamTNT using NVIDIA drivers to mine cryptocurrency\n\nTeamTNT is known for attacking insecure and vulnerable Kubernetes deployments in order to infiltrate organizations’\ndedicated environments and transform them into attack launchpads. In this article Aditya Sood presents a new module\nintroduced by…\n\n### Collector-stealer: a Russian origin credential and information extractor\n\nCollector-stealer, a piece of malware of Russian origin, is heavily used on the Internet to exfiltrate sensitive data from\nend-user systems and store it in its C&C panels. In this article, researchers Aditya K Sood and Rohit Chaturvedi present\na 360…\n\n### Fighting Fire with Fire\n\nIn 1989, Joe Wells encountered his first virus: Jerusalem. He disassembled the virus, and from that moment onward,\nwas intrigued by the properties of these small pieces of self-replicating code. Joe Wells was an expert on computer\nviruses, was partly…\n\n### Run your malicious VBA macros anywhere!\n\nKurt Natvig wanted to understand whether it’s possible to recompile VBA macros to another language, which could then\neasily be ‘run’ on any gateway, thus revealing a sample’s true nature in a safe manner. In this article he explains how he\nrecompiled…\n\n### Dissecting the design and vulnerabilities in AZORult C&C panels\n\nAditya K Sood looks at the command-and-control (C&C) design of the AZORult malware, discussing his team's findings\nrelated to the C&C design and some security issues they identified during the research.\n\n[Bulletin Archive](https://www.virusbulletin.com/virusbulletin/archive)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-03-02 - Pulling the PKPLUG- the adversary playbook for the long-standing espionage activity of a Chinese nation-state adversary.pdf"
    ],
    "report_names": [
        "2020-03-02 - Pulling the PKPLUG- the adversary playbook for the long-standing espionage activity of a Chinese nation-state adversary.pdf"
    ],
    "threat_actors": [
        {
            "id": "8c5c318c-0e71-4184-92bb-d1c28f68a411",
            "created_at": "2022-10-25T15:50:23.692481Z",
            "updated_at": "2025-03-27T02:00:55.525121Z",
            "deleted_at": null,
            "main_name": "Scarlet Mimic",
            "aliases": [
                "Scarlet Mimic"
            ],
            "source_name": "MITRE:Scarlet Mimic",
            "tools": [
                "Psylo",
                "MobileOrder",
                "CallMe",
                "FakeM"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "9fc2aed1-c838-41e9-b469-922e7bab6f94",
            "created_at": "2022-10-25T16:07:24.162936Z",
            "updated_at": "2025-03-27T02:02:10.128098Z",
            "deleted_at": null,
            "main_name": "Scarlet Mimic",
            "aliases": [
                "Golfing Taurus"
            ],
            "source_name": "ETDA:Scarlet Mimic",
            "tools": [
                "BrutishCommand",
                "CallMe",
                "CrypticConvo",
                "Elirks",
                "FakeFish",
                "FakeHighFive",
                "FakeM",
                "FakeM RAT",
                "FullThrottle",
                "HTran",
                "HUC Packet Transmit Tool",
                "MobileOrder",
                "Psylo",
                "RaidBase",
                "SkiBoot",
                "SubtractThis",
                "Terminator RAT"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "93542ae8-73cb-482b-90a3-445a20663f15",
            "created_at": "2022-10-25T16:07:24.058412Z",
            "updated_at": "2025-03-27T02:02:10.093621Z",
            "deleted_at": null,
            "main_name": "PKPLUG",
            "aliases": [
                "Stately Taurus"
            ],
            "source_name": "ETDA:PKPLUG",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f809bfcb-b200-4988-80a8-be78ef6a52ef",
            "created_at": "2023-01-06T13:46:39.186988Z",
            "updated_at": "2025-03-27T02:00:03.016358Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "Adept Libra"
            ],
            "source_name": "MISPGALAXY:TeamTNT",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "416f8374-2b06-47e4-ba91-929b3f85d9bf",
            "created_at": "2022-10-25T16:07:24.093951Z",
            "updated_at": "2025-03-27T02:02:10.105752Z",
            "deleted_at": null,
            "main_name": "Rancor",
            "aliases": [
                "Rancor Group",
                "Rancor Taurus"
            ],
            "source_name": "ETDA:Rancor",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "DDKONG",
                "Derusbi",
                "Dudell",
                "ExDudell",
                "KHRAT",
                "PLAINTEE",
                "RoyalRoad",
                "certutil",
                "certutil.exe",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "cac03bbf-0c42-470d-951e-0e92656be6cb",
            "created_at": "2023-01-06T13:46:38.463275Z",
            "updated_at": "2025-03-27T02:00:02.840123Z",
            "deleted_at": null,
            "main_name": "Scarlet Mimic",
            "aliases": [
                "G0029",
                "Golfing Taurus"
            ],
            "source_name": "MISPGALAXY:Scarlet Mimic",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c3ca592f-0669-49bd-ab5c-310007ab2fb4",
            "created_at": "2022-10-25T15:50:23.334495Z",
            "updated_at": "2025-03-27T02:00:55.445098Z",
            "deleted_at": null,
            "main_name": "TeamTNT",
            "aliases": [
                "TeamTNT"
            ],
            "source_name": "MITRE:TeamTNT",
            "tools": [
                "Peirates",
                "MimiPenguin",
                "LaZagne",
                "Hildegard"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "e8aee970-e31e-489f-81c2-c23cd52e255c",
            "created_at": "2023-01-06T13:46:38.763687Z",
            "updated_at": "2025-03-27T02:00:02.91243Z",
            "deleted_at": null,
            "main_name": "RANCOR",
            "aliases": [
                "Rancor",
                "Rancor Group",
                "G0075",
                "Rancor Taurus",
                "Rancor group"
            ],
            "source_name": "MISPGALAXY:RANCOR",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "926dcfeb-19dd-4786-b601-3c0c4c477b43",
            "created_at": "2023-01-06T13:46:38.787762Z",
            "updated_at": "2025-03-27T02:00:02.919004Z",
            "deleted_at": null,
            "main_name": "HenBox",
            "aliases": [],
            "source_name": "MISPGALAXY:HenBox",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6d11e45c-4e31-4997-88f5-295b2564cfc6",
            "created_at": "2022-10-25T15:50:23.794721Z",
            "updated_at": "2025-03-27T02:00:55.548806Z",
            "deleted_at": null,
            "main_name": "Rancor",
            "aliases": [
                "Rancor"
            ],
            "source_name": "MITRE:Rancor",
            "tools": [
                "DDKONG",
                "PLAINTEE",
                "certutil"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "2ee03999-5432-4a65-a850-c543b4fefc3d",
            "created_at": "2022-10-25T16:07:23.882813Z",
            "updated_at": "2025-03-27T02:02:10.0116Z",
            "deleted_at": null,
            "main_name": "Mustang Panda",
            "aliases": [
                "Bronze President",
                "Camaro Dragon",
                "Earth Preta",
                "HoneyMyte",
                "Mustang Panda",
                "Operation SMUGX",
                "Operation SmugX",
                "PKPLUG",
                "Red Lich",
                "Stately Taurus",
                "TEMP.Hex"
            ],
            "source_name": "ETDA:Mustang Panda",
            "tools": [
                "9002 RAT",
                "AdFind",
                "Agent.dhwf",
                "Agentemis",
                "CHINACHOPPER",
                "China Chopper",
                "Chymine",
                "ClaimLoader",
                "Cobalt Strike",
                "CobaltStrike",
                "DCSync",
                "DOPLUGS",
                "Darkmoon",
                "Destroy RAT",
                "DestroyRAT",
                "Farseer",
                "Gen:Trojan.Heur.PT",
                "HOMEUNIX",
                "Hdump",
                "HenBox",
                "HidraQ",
                "Hodur",
                "Homux",
                "HopperTick",
                "Hydraq",
                "Impacket",
                "Kaba",
                "Korplug",
                "LadonGo",
                "MQsTTang",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "NBTscan",
                "NetSess",
                "Netview",
                "Orat",
                "POISONPLUG.SHADOW",
                "PUBLOAD",
                "PVE Find AD Users",
                "PlugX",
                "Poison Ivy",
                "PowerView",
                "QMAGENT",
                "RCSession",
                "RedDelta",
                "Roarur",
                "SPIVY",
                "ShadowPad Winnti",
                "SinoChopper",
                "Sogu",
                "TIGERPLUG",
                "TONEINS",
                "TONESHELL",
                "TVT",
                "TeamViewer",
                "Thoper",
                "TinyNote",
                "WispRider",
                "WmiExec",
                "XShellGhost",
                "Xamtrav",
                "Zupdax",
                "cobeacon",
                "nbtscan",
                "nmap",
                "pivy",
                "poisonivy"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535566,
    "ts_updated_at": 1743041807,
    "ts_creation_date": 1653705514,
    "ts_modification_date": 1653705514,
    "files": {
        "pdf": "https://archive.orkl.eu/4df7cdcd195e483420d7444fe502063585495128.pdf",
        "text": "https://archive.orkl.eu/4df7cdcd195e483420d7444fe502063585495128.txt",
        "img": "https://archive.orkl.eu/4df7cdcd195e483420d7444fe502063585495128.jpg"
    }
}