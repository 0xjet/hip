{
    "id": "f12148aa-f474-44d9-9af3-561d0b1cad02",
    "created_at": "2023-01-12T14:59:31.846522Z",
    "updated_at": "2025-03-27T02:14:43.600368Z",
    "deleted_at": null,
    "sha1_hash": "d586159b779cb2e6233fb5272440d13008d4195e",
    "title": "2016-01-18 - Updated Blackmoon banking Trojan stays focused on South Korean banking customers",
    "authors": "",
    "file_creation_date": "2022-05-28T19:49:50Z",
    "file_modification_date": "2022-05-28T19:49:50Z",
    "file_size": 169387,
    "plain_text": "# Updated Blackmoon banking Trojan stays focused on South Korean banking customers\n\n**[proofpoint.com/us/threat-insight/post/Updated-Blackmoon-Banking-Trojan](https://www.proofpoint.com/us/threat-insight/post/Updated-Blackmoon-Banking-Trojan)**\n\nJanuary 18, 2016\n\n\n-----\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\nUpdated Blackmoon banking Trojan stays focused on South Korean banking customers\n\n\n-----\n\nJanuary 19, 2016 Proofpoint Staff\n\nFirst analyzed in early 2014 [1] [2], the Blackmoon banking Trojan targets a user’s online\nbanking credentials using a type of pharming that involves modifying or replacing the local\nHosts file with one that redirects online banking domain lookups to an IP address controlled\nby the attacker. Blackmoon has been observed targeting primarily customers of South\nKorean online banking sites and services, and is usually distributed via drive-by download.\n\nLike other banking Trojans targeting online banking users in other countries, Blackmoon\ncontinues to evolve both their distribution and delivery technique. Proofpoint threat\nresearchers recently observed a sample of the Blackmoon Korean banking Trojan\n(7e67216628d9a171be0ce18c51fda8ce) retrieving encoded configuration information from\nthe “lofter[.]com” blogging platform.\n\n_Figure 1: Encoded configuration block found on the lofter[.]com blogging platform_\n\n**Executable Process**\n\nThe malware arrives on the system as an executable. (The original delivery method of this\nsample is unknown, but previous analyses have found it spreading via download from an\ninfected site.)\n\n_Figure 2: Information from PEStudio for 7e67216628d9a171be0ce18c51fda8ce_\n\nOnce executed, the dropper extracts a DLL from itself and launches the DLL via\nrundll32.exe, calling the dropper filename as a parameter that deletes the original dropper\nfrom disk. The DLL and the folder it resides in are named using 6 random alphabetical\ncharacters.\n\n\n-----\n\n_Figure 3: BlackMoon DLL (84E2D574085C77F47E801F5326E83D73) launching via_\n_rundll32.exe_\n\n_Figure 4: Blackmoon strings present in 84E2D574085C77F47E801F5326E83D73_\n\nThe malware sets persistence by running the command\n\n_Figure 5: Blackmoon DLL persistence setting in registry key_\n\nThe malware calls out to a hardcoded website address to retrieve the encoded configuration\nblock. It parses the page looking for “###” and extracts the data until a subsequent “###”: this\nis the encoded configuration block (Fig. 6).\n\n_Figure 6: The encoded Blackmoon configuration block._\n\nThe malware makes use of JavaScript to handle the encoding and decoding of strings. The\ndecoding can be described as case-swapped base64 with a substituted padding character of\n‘@‘. (A python script for decoding is included at end of this post.).\n\n_Figure 7: Calling decoding routine in malicious JavaScript_\n\n_Figure 8: Decoded Configuration Block_\n\nThe malware also utilizes this encoding to register the infected host.\n\n_Figure 9: Blackmoon infected client check-in_\n\n_Figure 10: Decoded SID parameter for infected client_\n\nThe malware clears the DNS resolver cache by running the command ipconfig.exe /flushdns,\nand then sets the values found in the [Dns] section of the config block to the infected client’s\nDNS server settings. In this case it is 127.0.0.1 with the Google primary public DNS server of\n8.8.8.8 as a backup.\n\nWith the primary DNS set to the loopback address, the malware rewrites the infected client’s\nHosts file with search engine and banking sites that will resolve to the attacker's server. The\nlist of domains to redirect is hardcoded in the malware. The value in the [Host] field of the\nconfiguration block replaces “IP#“ when it is written to the Hosts file.\n\n\n-----\n\n_Figure 11: The Modified HOSTS file before (right) and after (left) the IP from the_\n_Configuration Block is replaced._\n\nThe malware also searches for a folder “\\NPKI\\” containing .cer or .der files on the infected\nclient. If found, the malware extracts a command line RAR executable from itself and saves it\nto “\\Documents and Settings\\Administrator\\Local Settings\\Temp” as “zip.tmp”. Then the\nmalware archives the NPKI folder with the following command:\n\nzip.tmp a -hp@#@2016999# \"D:\\NPKI.z\" \"D:\\NPKI\"\n\nThe malware will then send the password protected archive to the value of the [Upload] field\nin the configuration block via HTTP POST. It is likely that the content of the NPKI folder are\nused to impersonate an end-user in order to access their online banking information and\naccounts. [3] [4]\n\n_Figure 12: The Blackmoon DLL sending NPKI RAR archive_\n\nThe configuration block also includes a [Time] value that indicates how often the malware\nchecks for a new configuration block.\n\nOnce the infected client’s Hosts file has been updated with the redirected domains, a user\nvisiting any of the search engine sites with the infected client will often see the following\nmessage:\n\n_Figure 13: Message displayed when user of infected client visits a domain listed in modified_\n_Hosts file_\n\nThis message roughly translates to:\n\n_Financial Supervisory Service is conducting an authentication process did you install the_\n_security certificate for this PC?_\n\n※ Certificate must verify the security and privacy of information leakage incidents in the\n_auction using Internet banking Guests prevent financial fraud, please see below._\n\n※ You cannot access the Internet Banking more safely receive the security certification\n_process._\n\n※ Please click the bank name that you use to proceed to the secure authentication\n_procedures._\n\nA user who clicks on one of these online banking site names in order to login would be\npresented with the following sequence pages:\n\n\n-----\n\n_Figure 14: Fake online banking web site using stolen branding_\n\nWhile this page appears legitimate, clicking on any element on the page brings up an alert.\n\n_Figure 15: Fraudulent security notification to end user_\n\nThis roughly translates to:\n\n_Safer internet 03.24.2014 (Will) for banking using internet banking, smart Banking, Phone_\n_Banking To The use of all services (private. Company) can then use additional_\n_authentication._\n\nClicking the OK button brings up a brief loading message:\n\n_Figure 16: Loading message displayed when user accepts warning_\n\nWhich is then followed by a two-stage credential theft phish.\n\n_Figure 17: First page of credential theft phishing, with stolen branding_\n\n_Figure 18: Second page of credential theft phishing, with stolen branding_\n\nThe phishing pages include user input validation capabilities that surpass those typically\nfound in phishing pages, such as validating that the user has entered their name using the\nproper character set, as well as numerous checks to ensure that a valid “Social Security\n[number” (officially called a Resident Registration Number in South Korea) has been entered.](https://en.wikipedia.org/wiki/Resident_registration_number)\n\n_Figure 19: Phishing page form input validation for character set_\n\n_Figure 20: Phishing page form input validation for South Korean equivalent of Social Security_\n_Number_\n\nThis infection chain is consistent with examples documented in early 2014, with two\nnoteworthy updates to distribution and delivery technique:\n\nDistribution via the lofter[.]com blogging platform, with frequent changes to the backend\nweb servers.\nAddition of encoding for C2 information in payload download.\n\nThese changes are consistent with updates Proofpoint researchers have recently observed\nin other malware, from highly targeted malware such as the Operation Arid Viper payload [5]\nto broad-based campaigns such as those distributing Dridex [6]. Organizations can expect to\n\n\n-----\n\nsee continued variation in obfuscation techniques and distribution as attackers attempt to\nstay ahead of evolving defenses.\n\n**References**\n\n[1] http://training.nshc.net/ENG/Document/virus/20140305_Internet_Bank_Pharming__BlackMoon_Ver_1.0_External_ENG.pdf\n\n[2] https://zairon.wordpress.com/2014/04/15/trojan-banking47d18761d46d8e7c4ad49cc575b0acc2bb3f49bb56a3d29fb1ec600447cb89a4/\n\n[3] [http://www.hikorea.go.kr/pt/PublicCertificate_en.pt](http://www.hikorea.go.kr/pt/PublicCertificate_en.pt)\n\n[4] [http://grrrltraveler.com/countries/asia/korea/expat-life/online-banking-korea/](http://grrrltraveler.com/countries/asia/korea/expat-life/online-banking-korea/)\n\n[5] http://www.proofpoint.com/us/threat-insight/post/Operation-Arid-Viper-Slithers-Back-IntoView\n\n[6] [http://www.proofpoint.com/us/threat-insight/post/Not-Yet-Dead](http://www.proofpoint.com/us/threat-insight/post/Not-Yet-Dead)\n\n**Blackmoon DLLs**\n\nName: yQkUz.dll\n\nMD5: 84e2d574085c77f47e801f5326e83d73\n\nSHA256: ad062b7cba8f149a585018938b45f65698dde3a049a6f50fd4e355e68b562fc3\n\nCompile Time: 2016-01-07 18:08:45\n\nName: pkNQy.dll\n\nMD5: 9be8a5edc5f0a57d09b733c18a3740c7\n\nSHA256: 4e94d38c1939ca7c6928da062b01e381e7a925ae4c66945f598f090c8d79a6a0\n\nCompile Time: 2016-01-10 05:09:38\n\nName: OUikm.dll\n\nMD5: 255fd48dd681058d9cb84e4c6dbd92f6\n\nSHA256: 8fbacfa948ba95cbe7e6f44a7974f621259a0c23c43a4a4c3d8e3e163604388a\n\nCompile Time: 2016-01-09 09:43:13\n\nName: uyonu.dll\n\n\n-----\n\nMD5: 949482b0aa3ecc019d63d10a46539302\n\nSHA256: df821948e3362a5accdefc444b4bdf8e370f77af65fabbbd371cd95d1c181347\n\nCompile Time: 2016-01-07 18:08:45\n\n**Blackmoon EXE Droppers**\n\nName: sa.exe (Analyzed)\n\nMD5: 7e67216628d9a171be0ce18c51fda8ce\n\nSHA256: f0dd2eeaaeb85ab98f0d2d04151b7a56fa3d0c427e9356049cbc4f41bcfabf72\n\nCompile Time: 2016-01-07 18:25:05\n\nName: smss.exe\n\nMD5: 86a16809fe21cc389740866dfc73abe3\n\nSHA256: 6f250727e69716776f3bb594715a7e10bea65e35556f1dc3a922b63f40611b39\n\nCompile Time: 2016-01-11 06:09:40\n\nName: smss.exe\n\nMD5: 091bb8f755f7eda753e53b0b6501dcb2\n\nSHA256: af777fe3a147a48185c65ecd750be0863caa6fbcc51a75a4fb944a651c875006\n\nCompile Time: 2016-01-11 06:09:40\n\nName: smss.exe\n\nMD5: b67e98a8c3f2b46207e9b9d4785bbe4cSHA256:\n\nSHA256: fa2ddd90683ddcc968d5349edfd85d81dd0035daf7f0d2d7556c8c609fb78554\n\nCompile Time: 2016-01-11 06:09:40\n\nName: smss.exe\n\nMD5: 80abc3ad344c4999f33948c8a241223c\n\nSHA256: c52c5dde2071754b54414fe0035d28145e212aa116917f8d2794169b5def2966\n\nCompile Time: 2016-01-11 06:09:40\n\nName:\n\n\n-----\n\nMD5: 3fe1d163b22c619d8e9dd865d83d9b05\n\nSHA256: 8189b3e021be392d4a731d68c5c73d2bafb8168b70351be7475806b8978304aa\n\nCompile Time: 2016-01-11 06:09:40\n\nName: smss.exe\n\nMD5: c973ac06f36f1b52a08c51faf79fade2\n\nSHA256: e3ccb1c511a18b0b95f51ca54b2bde109eb689b9ef23ad9325ab7c58fd3bd857\n\nCompile Time: 2016-01-11 06:09:40\n\nName: smss.exe\n\nMD5: 34f4257bba25546aaf486132c27c40d5\n\nSHA256: 5881f66242ceb03f85731dafbab272e88545609bb2542a4328a2060c4ecedc85\n\nCompile Time: 2016-01-11 06:09:40\n\nName: smss.exe\n\nMD5: 79fee38ebc1c6db755f3da38287349f9\n\nSHA256: c5d95003eb571199ddb6f5c181ab6fc326115c55ff2637673657d946bf314f87\n\nCompile Time: 2016-01-11 06:09:40\n\nName:\n\nMD5: 7d091ae970c41b85e9a281308fab6985\n\nSHA256: 8b36c161d720926a91e1d2324fe075b740b782100833d01c7905e4ccef5befc6\n\nCompile Time: 2016-01-11 06:09:40\n\nName:\n\nMD5: 4f21078383c7fff2ad3dbe8b77de7f3d\n\nSHA256: 43bac8196a8410b09e0ab1a2926ad9419b32ea7caa8371585db26748f09418b0\n\nCompile Time: 2016-01-09 09:26:10\n\nName:\n\nMD5: dd01534e1a78913f440d30bf03d99462\n\n\n-----\n\nSHA256: f07d0ceb105b5454d8037283667f4103e19413b3297885d38db94031cc14c258\n\nCompile Time: 2016-01-09 09:26:10\n\nName:\n\nMD5: fe0fca87d2a1ef1b7d0c57414dee32be\n\nSHA256: b6340b9f2433bd20246719e92870e3f1ec01d42a0e22606f27ee53b7fe0adafe\n\nCompile Time: 2016-01-09 09:26:10\n\nName:\n\nMD5: 371b63fb512513c066e541a13f3ed79a\n\nSHA256: e4b8adcf2974abbe236813b02b507280bca61f8a0795e3901c8718999c661cd5\n\nCompile Time: 2016-01-09 09:26:10\n\nName: dll.exe\n\nMD5: a4a2d0a47aa3c1bc4382997a197e3aeb\n\nSHA256: 437c8a5639149fd97943f01ee88aa96f131b9755172c77a42a57c014d0158fbe\n\nCompile Time: 2016-01-09 09:26:10\n\nName: ser.exe\n\nMD5: 4c8f4bd321ebde0698576c4b1a788773\n\nSHA256: f8aa625dd544f3e49412f9a2acea411c8cb4b6f346e04800ff711c9cd9a45d92\n\nCompile Time: 2016-01-09 09:26:10\n\nName: dll.exe\n\nMD5: 59596e9c4c94ebd7d5a692a782623560\n\nSHA256: 16e922193fb53d58c44e8cb012fe1d19bfba391807db964fe2c6cde06a436aa1\n\nCompile Time: 2016-01-09 09:26:10\n\nName: sa.exe\n\nMD5: 255e5a9dfc352e9abdfe67e00e6d34ef\n\nSHA256: 8d6b2be9180972274d8111a47e0a15d5158bfd352cd5738a665d14c71a8406e9\n\n\n-----\n\nCompile Time: 2016-01-07 18:25:05\n\nName: sa.exe\n\nMD5: 5fac43273dc8a7bed3a005220d32da1d\n\nSHA256: ada60b73629c135592fef0f7257cd1dac8e0cb4a448141b2b2e3e1bba02c5eab\n\nCompile Time: 2016-01-07 18:25:05\n\nName: sa.exe\n\nMD5: 35732507edc006ce63066f59cee041b8\n\nSHA256: 0fc932e2dae7219cc5a14a224e76385ba7e15e15fa0fb4054206efbf983cea00\n\nCompile Time: 2016-01-07 18:25:05\n\nName:\n\nMD5: ab9278dbc583d4829524e68f101c0de1\n\nSHA256: 46e572338ea5c1c691ab60984abfc38007c7cfd7b6e77adf26a6bbaa22451d73\n\nCompile Time: 2016-01-07 18:25:05\n\nName:\n\nMD5: 25e02fe76649535abed4c3f1340ba88c\n\nSHA256: abe2f051bc9339d2e0c29ee75027879d465d644de8a3159ada1db72412a551b8\n\nCompile Time: 2016-01-07 18:25:05\n\nName: sa.exe\n\nMD5: c967d619404bd371a75ba4c5ca2a650a\n\nSHA256: eb6e0e39bc2c379e18076cae7da2dbfb23233294ebd24b40a01180dc768e092e\n\nCompile Time: 2016-01-07 18:25:05\n\n**IP Addresses**\n\n100.43.129[.]107\n\n98.126.19[.]178\n\n174.139.200[.]164\n\n\n-----\n\n174.139.200[.]165\n\n174.139.203[.]180\n\n**Emerging Threats Coverage**\n\n2815665 - ETPRO TROJAN W32.Blackmoon Checkin 1\n\n2815676 - ETPRO TROJAN W32.Blackmoon Checkin 2\n\n2815733 - ETPRO TROJAN W32.Blackmoon Bank Phishing Page - Compromised Host M1\n\n2815734 - ETPRO TROJAN W32.Blackmoon Bank Phishing Page - Compromised Host M2\n\n2815735 - ETPRO TROJAN W32.Blackmoon Bank Phishing Page - Compromised Host M3\n\n2815736 - ETPRO TROJAN W32.Blackmoon Bank Phishing Page - Compromised Host M4\n\n2815737 - ETPRO TROJAN W32.Blackmoon Bank Phishing Page - Compromised Host M5\n\n2815738 - ETPRO TROJAN W32.Blackmoon Bank Phishing Page - Compromised Host M6\n\n2815769 - ETPRO TROJAN W32.Blackmoon Uploading Stolen Certificates\n\n**Yara Rule**\n\n_rule BLACKMOON_BANKER {_\n\n_meta:_\n\n_author = \"Proofpoint Staff\"_\n\n_info = \"blackmoon update\"_\n\n_strings:_\n\n_$s1 = \"BlackMoon RunTime Error:\" nocase wide ascii_\n\n_$s2 = \"\\\\system32\\\\rundll32.exe\" wide ascii_\n\n_$s3 = \"cmd.exe /c ipconfig /flushdns\" wide ascii_\n\n_$s4 = \"\\\\system32\\\\drivers\\\\etc\\\\hosts.ics\" wide ascii_\n\n_condition:_\n\n_all of them_\n\n_}_\n\n\n-----\n\n**Python Script to Decode**\n\n_#!/usr/bin/env python2_\n\n_from base64 import b64decode_\n\n_from binascii import unhexlify_\n\n_import sys_\n\n_def main():_\n\n_if len(sys.argv) < 2:_\n\n_print 'Usage: ' + sys.argv[0] + ' [data_to_decode]'_\n\n_exit(-1)_\n\n_data = sys.argv[1].strip('#')_\n\n_data = data.replace('@','=')_\n\n_data = data.swapcase()_\n\n_data = b64decode(data)_\n\n_try:_\n\n_int(data, 16)_\n\n_print \"\\n\" + unhexlify(data)_\n\n_except ValueError:_\n\n_print \"\\n\" + data + \"\\n\"_\n\n_if __name__ == '__main__':_\n\n_main()_\n\nSubscribe to the Proofpoint Blog\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2016/2016-01-18 - Updated Blackmoon banking Trojan stays focused on South Korean banking customers.pdf"
    ],
    "report_names": [
        "2016-01-18 - Updated Blackmoon banking Trojan stays focused on South Korean banking customers.pdf"
    ],
    "threat_actors": [
        {
            "id": "9ff60d4d-153b-4ed5-a2f7-18a21d2fa05d",
            "created_at": "2022-10-25T16:07:23.539852Z",
            "updated_at": "2025-03-27T02:02:09.853285Z",
            "deleted_at": null,
            "main_name": "Desert Falcons",
            "aliases": [
                "APT-C-23",
                "ATK 66",
                "Arid Viper",
                "Operation Arid Viper",
                "Operation Bearded Barbie",
                "Operation Rebound",
                "TAG-63",
                "TAG-CT1",
                "Two-tailed Scorpion"
            ],
            "source_name": "ETDA:Desert Falcons",
            "tools": [
                "AridSpy",
                "Barb(ie) Downloader",
                "BarbWire",
                "Desert Scorpion",
                "FrozenCell",
                "GlanceLove",
                "GnatSpy",
                "KasperAgent",
                "Micropsia",
                "PyMICROPSIA",
                "SpyC23",
                "Viper RAT",
                "ViperRAT",
                "VolatileVenom",
                "WinkChat",
                "android.micropsia"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "b1979c55-037a-415f-b0a3-cab7933f5cd4",
            "created_at": "2024-04-24T02:00:49.561432Z",
            "updated_at": "2025-03-27T02:00:55.493381Z",
            "deleted_at": null,
            "main_name": "APT-C-23",
            "aliases": [
                "APT-C-23",
                "Arid Viper",
                "Desert Falcon",
                "TAG-63",
                "Grey Karkadann",
                "Big Bang APT",
                "Two-tailed Scorpion"
            ],
            "source_name": "MITRE:APT-C-23",
            "tools": [
                "Micropsia"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "77c08a4a-b3f9-43ee-9d84-04ba572b7564",
            "created_at": "2024-05-01T02:03:07.927023Z",
            "updated_at": "2025-03-27T02:05:17.248836Z",
            "deleted_at": null,
            "main_name": "ALUMINUM SHADYSIDE",
            "aliases": [
                "Arid Viper ",
                "Desert Falcon ",
                "APT-C-23 "
            ],
            "source_name": "Secureworks:ALUMINUM SHADYSIDE",
            "tools": [
                " SpyC23",
                "Micropsia"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "efe6ff9a-822d-41a6-90c3-45265cac696b",
            "created_at": "2024-05-01T02:03:07.920302Z",
            "updated_at": "2025-03-27T02:05:17.246342Z",
            "deleted_at": null,
            "main_name": "ALUMINUM SARATOGA",
            "aliases": [
                "Arid Viper",
                "Desert Falcon",
                "Extreme Jackal ",
                "Gaza CyberGang",
                "Gaza CyberGang",
                "Molerats ",
                "Operation DustySky ",
                "TA402",
                "APT-C-23"
            ],
            "source_name": "Secureworks:ALUMINUM SARATOGA",
            "tools": [
                " BrittleBush",
                " DarkComet",
                " LastConn",
                " Micropsia",
                " NimbleMamba",
                " PoisonIvy",
                " QuasarRAT",
                " XtremeRat",
                "BlackShades"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "929d794b-0e1d-4d10-93a6-29408a527cc2",
            "created_at": "2023-01-06T13:46:38.70844Z",
            "updated_at": "2025-03-27T02:00:02.897573Z",
            "deleted_at": null,
            "main_name": "AridViper",
            "aliases": [
                "Arid Viper",
                "APT-C-23",
                "Bearded Barbie",
                "Desert Falcon"
            ],
            "source_name": "MISPGALAXY:AridViper",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535571,
    "ts_updated_at": 1743041683,
    "ts_creation_date": 1653767390,
    "ts_modification_date": 1653767390,
    "files": {
        "pdf": "https://archive.orkl.eu/d586159b779cb2e6233fb5272440d13008d4195e.pdf",
        "text": "https://archive.orkl.eu/d586159b779cb2e6233fb5272440d13008d4195e.txt",
        "img": "https://archive.orkl.eu/d586159b779cb2e6233fb5272440d13008d4195e.jpg"
    }
}