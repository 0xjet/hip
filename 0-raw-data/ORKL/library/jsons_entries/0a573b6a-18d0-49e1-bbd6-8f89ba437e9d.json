{
    "id": "0a573b6a-18d0-49e1-bbd6-8f89ba437e9d",
    "created_at": "2023-01-12T15:06:06.644845Z",
    "updated_at": "2025-03-27T02:05:27.220337Z",
    "deleted_at": null,
    "sha1_hash": "d8bf5c97776aa9f661dbe4035cb7607721e8c78f",
    "title": "2018-07-17 - The return of Fantomas, or how we deciphered Cryakl",
    "authors": "",
    "file_creation_date": "2022-05-28T03:44:47Z",
    "file_modification_date": "2022-05-28T03:44:47Z",
    "file_size": 1583859,
    "plain_text": "# The return of Fantomas, or how we deciphered Cryakl\n\n**[securelist.com/the-return-of-fantomas-or-how-we-deciphered-cryakl/86511/](https://securelist.com/the-return-of-fantomas-or-how-we-deciphered-cryakl/86511/)**\n\nAuthors\n\nKaspersky\n\nIn early February this year, Belgian police seized the C&C servers of the infamous Cryakl\ncryptor. Soon afterwards, they [handed over the private keys to our experts, who used them](https://www.kaspersky.com/about/press-releases/2018_no-more-ransom-update)\n[to update the free RakhniDecryptor tool for recovering files encrypted by the malware. The](https://support.kaspersky.com/10556)\nransomware, which for years had raged across Russia (and elsewhere through partners),\nwas finally stopped.\n\n[For Kaspersky Lab, this victory was the culmination of more than three years of monitoring](https://securelist.ru/shifrovalshhik-cryakl-ili-fantomas-razbushevalsya/24070/)\nCryakl and studying its various modifications — a major effort that eventually defeated the\ncybercriminals. This story clearly illustrates how cooperation can, in the end, get the better of\nany crooked scheme.\n\nThis spring marked the fourth anniversary of the malware’s first attacks. Against the\n[backdrop of a general decline in ransomware activity (see our report), we decided to return](https://securelist.com/ransomware-and-malicious-crypto-miners-in-2016-2018/86238/)\nto the topic of Cryakl and tell in detail about how one of the most eye-catching members of\nthis endangered species evolved.\n\n\n-----\n\n## Propagation methods\n\nWe first encountered Cryakl (without knowing what it was exactly) in the spring of 2014. The\nmalware had just begun to spread actively, mainly through spam mailings. Initially,\nattachments with the malware were found in emails allegedly from the Supreme Arbitration\nCourt of the Russian Federation in connection with various offenses. But it wasn’t long\nbefore messages started arriving from other organizations too, in particular homeowner\nassociations.\n\nA typical malicious email contained an attachment of one of the following types:\n\nOffice document with a malicious macro\nJS script loading a Trojan\nPDF document with a link to an executable\n\nIt was around this time that the malware acquired its nickname: after encrypting files on the\nuser’s hard drive, one of the Cryakl variants (Trojan-Ransom.Win32.Cryakl.bo) changed the\ndesktop wallpaper to a picture of Fantomas, the villain from the 1964 French film of the same\nname.\n\nLater, in 2016, we discovered an interesting modification of the ransomware with a rather\ncunning mode of distribution. Today, an attack using specialized third-party software would\nraise few eyebrows, but it was not par for the course in 2016, when Fantomas was\ndistributed as a script for a popular Russian accounting program and a business process\n\n\n-----\n\nmanagement tool. The approach was indeed sneaky: employees were sent a message with\na request to “update the bank classifier,” whereupon they opened the attached executable\nfile.\n\nNeither was the attack vector surprising, since Cryakl mainly targeted users in Russia and\nmost of the ransom demands were written in Russian. However, further research showed\nthat the cybercriminals who distributed Fantomas did not limit themselves to the Russian\nmarket.\n\nIn 2016, we observed the growing complexity and variety of ransomware cryptors, including\nthe emergence of ready-made solutions such as Ransomware-as-a-Service (RaaS) for those\nlacking skills, resources, or time to create their own. Such services were circulated through\n[an expanding and increasingly influential underground ecosystem.](https://securelist.com/a-look-into-the-russian-speaking-ransomware-ecosystem/77544/)\n\nThis was the business model chosen by Cryakl’s creators: “partners” were invited to\npurchase the build of the malware to attack users in other regions, allowing its authors to\nmonetize the product for a second time.\n\n## Statistics\n\nIn expanding its infrastructure, Cryakl also widened its attack geography. From the first\ninfection until today, more than 50,000 people in Russia—plus thousands more in Japan,\nItaly, and Germany — suffered at the evil hands of Fantomas.\n\n\n-----\n\n_Geographic distribution of users attacked by Cryakl_\n\nData on Cryakl activity over the years shows that the first signs of life appeared in 2014.\n\n\n-----\n\n_Number of unique users on whose computers Cryakl was detected, 2014-2018_\n\nAt around the time when the RaaS distribution model was deployed, Fantomas was on the\nrampage, increasing its attacks more than sixfold.\n\n## Distinguishing features\n\nDespite the number and variety of modifications, the use of “partners,” and its long history,\nthe malware cannot be said to have undergone any significant changes — the differences\nbetween the various versions was slight. This makes it possible to identify the main features\nof Fantomas.\n\nCryakl is written in Delphi, but very amateurishly. This immediately jumped out when we took\na look at one of the first versions. The file operations were extremely ineffective, and the\nencryption algorithm was elementary and not secure We even thought we were dealing with\n\n\n-----\n\na test build (especially since the internal version was designated 0.0.0.0). The overall\nimpression was that Cryakl’s authors were not the most experienced virus writers. Recall that\nit [all started with mailings about military conscription.](https://securelist.ru/shifrovalshhik-cryakl-ili-fantomas-razbushevalsya/24070/)\n\nThe first detected version of the malware did not change the names of the encrypted files,\nbut placed a text structure at the end of each file with the MD5 of the header, the MD5 of the\nfile itself, its original size, offsets, and the sizes of a few encrypted snippets. It ended with the\ntag {CRYPTENDBLACKDC}, required to distinguish encrypted files from unencrypted ones.\n\nThrough continued observations over the following months, we regularly discovered ever\nnewer versions of Cryakl: 1.0.0.0, 2.x.0.0, 3.x.0.0, …, 8.0.0.0. Different versions increasingly\nmodified the encryption algorithm as well as the file naming scheme (extensions started to\nappear of the type: id-{….08.2014 16@02@275587800}-email-mserbinov@aol.com-ver4.0.0.0.cbf). The text structure at the end of the file changed multiple times, and new\nencryption and decryption data as well as various service information were added to it.\n\nAfter that, we found the Cryakl version CL 0.0.0.0 (not to be confused with 0.0.0.0), which\nhad notable changes from previous modifications: besides encrypting parts of the file with a\n“homebrew” symmetric algorithm, for unknown reasons the Trojan now encrypted other parts\nwith the RSA algorithm. Another marked change was the sending of key data used in the\nencryption to the attackers’ C&C servers. The structure at the end of the encrypted file was\nframed with new tags ({ENCRYPTSTART}, {ENCRYPTENDED}), required to determine the\nencrypted files.\n\n_Image from one of the Cryakl CL 0.0.1.0 modifications_\n\n\n-----\n\nIn version CL 1.0.0.0, the Trojan stopped sending keys via the Internet. Instead, data\nrequired for decryption was now encrypted with RSA and placed in the structure at the end of\nthe file.\n\nNothing changed fundamentally in the subsequent versions CL 1.1.0.0 – CL 1.2.0.0, only the\nsize of the RSA keys increased. This enhanced the overall level of encryption, but did not\nchange the situation radically.\n\n_Image from one of the Cryakl CL 1.2.0.0 modifications_\n\nStarting with version CL 1.3.0.0, the Trojan (again for unknown reasons) stopped encrypting\nfile regions with RSA. The algorithm was used only to encrypt keys, while file contents were\nprocessed by the slightly modified “homebrew” symmetric algorithm.\n\n\n-----\n\n_Image from one of the Cryakl CL 1.2.0.0 modifications_\n\nIn all versions of the malware, the cybercriminals left various email addresses for\ncommunication purposes. These addresses are contained in the names of encrypted files\n(for example, email-eugene_danilov@yahoo.com.ver-CL 1.3.1.0.id-….randomnameFFIMEFJCNGATTMVPFKEXCVPICLUDXG.JGZ.lfl) and in the image set by the Trojan as\nthe desktop wallpaper. Victims received reply emails containing a ransom sum in Bitcoin and\na cryptocurrency wallet address to make the payment.\n\nOn receiving the funds, the cybercriminals sent the victim a decryptor tool and a key file.\n\nThe terms of payment varied: for example, the above-mentioned TrojanRansom.Win32.Cryakl.bo set a deadline of 48 hours. Moreover, the cybercriminals did not\nimmediately say how much they wanted in return for their “help,” specifying the cost of the\ndecryptor only in their reply emails. It’s not ruled out that the sum depended on the number\n[and quality of encrypted files. For example, in one case of infection, the cybercriminals](http://virusinfo.info/showthread.php?t=166787)\ndemanded $1000. Before doing so, according to victims, they connected to the infected\ncomputer and deleted all backup copies on it.\n\n## Fantomas is slain\n\nThe problem with Cryakl was that its newest versions employed asymmetric RSA encryption.\nThe malware body contained public keys used to encrypt user data. Without knowledge of\nthe corresponding private keys, we could not develop a decryption tool. The keys seized and\nhanded over by the Belgian police enabled us to decipher several versions of the\nransomware\n\n\n-----\n\n_Fragment of the private RSA keys_\n\nThe keys made it possible to reengineer the RakhniDecryptor tool to decrypt files encrypted\nwith the following versions of Cryakl:\n\nTrojan version Cybercriminals’ email\n\nCL 1.0.0.0 cryptolocker@aol.com\n\niizomer@aol.com\n\nseven_Legion2@aol.com\n\noduvansh@aol.com\n\nivanivanov34@aol.com\n\ntrojanencoder@aol.com\n\nload180@aol.com\n\nmoshiax@aol.com\n\nvpupkin3@aol.com\n\nwatnik91@aol.com\n\nCL 1.0.0.0.u cryptolocker@aol.com_graf1\n\ncryptolocker@aol.com_mod\n\nbyaki_buki@aol.com_mod2\n\nCL 1.2.0.0 oduvansh@aol.com\n\ncryptolocker@aol.com\n\nCL 1.3.0.0 cryptolocker@aol.com\n\nCL 1.3.1.0 byaki_buki@aol.com\n\nbyaki_buki@aol.com_grafdrkula@gmail.com\n\nvpupkin3@aol.com\n\n[Encryption](https://securelist.com/tag/encryption/)\n[Law Enforcement](https://securelist.com/tag/law-enforcement/)\n[Malware Descriptions](https://securelist.com/tag/malware-descriptions/)\n[Malware Statistics](https://securelist.com/tag/malware-statistics/)\n[RaaS](https://securelist.com/tag/raas/)\n[Ransomware](https://securelist.com/tag/ransomware/)\n\nAuthors\n\n\n-----\n\nKaspersky\n\nThe return of Fantomas, or how we deciphered Cryakl\n\nYour email address will not be published. Required fields are marked *\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-07-17 - The return of Fantomas, or how we deciphered Cryakl.pdf"
    ],
    "report_names": [
        "2018-07-17 - The return of Fantomas, or how we deciphered Cryakl.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535966,
    "ts_updated_at": 1743041127,
    "ts_creation_date": 1653709487,
    "ts_modification_date": 1653709487,
    "files": {
        "pdf": "https://archive.orkl.eu/d8bf5c97776aa9f661dbe4035cb7607721e8c78f.pdf",
        "text": "https://archive.orkl.eu/d8bf5c97776aa9f661dbe4035cb7607721e8c78f.txt",
        "img": "https://archive.orkl.eu/d8bf5c97776aa9f661dbe4035cb7607721e8c78f.jpg"
    }
}