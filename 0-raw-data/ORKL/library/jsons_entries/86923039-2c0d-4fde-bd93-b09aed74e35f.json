{
    "id": "86923039-2c0d-4fde-bd93-b09aed74e35f",
    "created_at": "2023-01-12T15:09:41.870059Z",
    "updated_at": "2025-03-27T02:13:12.243267Z",
    "deleted_at": null,
    "sha1_hash": "a601b130e57a7ba5cab0adaaf941b263f4c6046c",
    "title": "2022-06-09 - TA570 Qakbot (Qbot) tries CVE-2022-30190 (Follina) exploit (ms-msdt)",
    "authors": "",
    "file_creation_date": "2022-06-13T04:01:00Z",
    "file_modification_date": "2022-06-13T04:01:00Z",
    "file_size": 4631947,
    "plain_text": "# SANS ISC: InfoSec Handlers Diary Blog - SANS Internet Storm Center SANS Site Network Current Site SANS Internet Storm Center Other SANS Sites Help Graduate Degree Programs Security Training Security Certification Security Awareness Training Penetration Testing Industrial Control Systems Cyber Defense Foundations DFIR Software Security Government OnSite Training InfoSec Handlers Diary Blog\n\n**isc.sans.edu/diary/rss/28728**\n\n## TA570 Qakbot (Qbot) tries CVE-2022-30190 (Follina) exploit (ms- msdt)\n\n**Published: 2022-06-09**\n\n**Last Updated: 2022-06-09 05:50:03 UTC**\n\n**by** [Brad Duncan (Version: 1)](https://isc.sans.edu/handler_list.html#brad-duncan)\n\n[0 comment(s)](https://isc.sans.edu/forums/diary/TA570+Qakbot+Qbot+tries+CVE202230190+Follina+exploit+msmsdt/28728/#comments)\n**_Introduction_**\n\n[A threat actor designated by Proofpoint as TA570 routinely pushes Qakbot (Qbot) malware.](https://www.proofpoint.com/us/blog/threat-insight/first-step-initial-access-leads-ransomware)\nMalicious DLL files used for Qakbot infections contain a tag indicating their specific\ndistribution channel. Qakbot DLL samples tagged \"obama\" like \"obama186\" or \"obama187\"\nindicate a distribution channel from TA570 that uses thread-hijacked emails. On Tuesday\n[2022-06-07, Proofpoint and various researchers like @pr0xylife and](https://twitter.com/threatinsight/status/1534227444915482625) [@k3dg3 reported TA570](https://twitter.com/k3dg3/status/1534174271467134977)\nQakbot distribution included Word documents using the CVE-2022-30190 (Follina) exploit\n(ms-msdt).\n\n\n-----\n\n_Shown above: Flow chart for Qakbot infections from TA570 on Tuesday 2022-06-07._\n\nThis wave of malicious spam ultimately provided two separate methods of Qakbot infection.\nThe first method is one also used by other threat actors, where a disk image contains a\nWindows shortcut that runs a malicious hidden DLL. The second method is a Word docx file\nusing a CVE-2022-30190 (Follina) exploit. On Tuesday 2022-06-07, disk images from\nTA570 pushing obama186-tagged Qakbot used both methods.\n\nI tried running the malicious docx file in my lab environment and different on-line sandboxes;\nhowever, I was unable to get a successful infection.\n\nThe next day on Wednesday 2022-06-08, obama187-tagged Qakbot from TA570 stopped\nusing the docx file and relied on the Windows shortcut and hidden DLL file.\n\n_Shown above: Flow chart for Qakbot infections from TA570 on Wednesday 2022-06-08_\n\n\n-----\n\nIn addition to other sources, the Internet Storm Center has previously posted diaries about\nthis new attack vector:\n\nToday's diary examines the Microsoft Word docx file used by TA570 in the Tuesday 2022-0607 wave of malspam for obama186-tagged Qakbot.\n\n**_Infection Chain Details_**\n\nBelow is a TA570 thread-hijacked email pushing obama186 Qakbot from Tuesday 2022-0607. The email contains an HTML attachment. The HTML file is approximately 911 kB, and it\ncontains code to convert a base64 sting to a zip archive and present the zip archive as a\ndownload.\n\n_Shown above: Screenshot of Thunderbird showing a TA570 email pushing obama186_\n_Qakbot on Tuesday 2022-06-07._\n\n\n-----\n\n_Shown above: Opening the attached HTML file._\n\n_Shown above: Running the HTML file immediately presents a zip download._\n\nThe zip archive contains a disk image as shown below. Double-clicking the disk image in\nMicrosoft Windows will mount the file as a drive. This disk image contains a Windows\nshortcut, a hidden DLL file for Qakbot, and the docx file with the Follina exploit.\n\n\n-----\n\n_Shown above: Downloaded zip archive contains a disk image._\n\n_Shown above: Disk image mounted as a DVD drive in Windows 10._\n\n\n-----\n\n_Shown above: Shortcut target uses rundll32.exe to run the hidden DLL file for Qakbot._\n\n\n-----\n\n_Shown above: More interesting is the .docx file._\n\n_Shown above: A quick check confirms this is, indeed, a .docx file._\n\n\n-----\n\nBecause this is a .docx file, we can re-name it as a zip archive, extract the contents, and\nexamine them.\n\n_Shown above: Contents of the .docx file after renaming it as a .zip archive._\n\n**_Examining the .docx File_**\n\nBased on text found within an XML file found within the .docx archive, this exploit appears to\nretrieve an HTML file as shown below.\n\n\n-----\n\n_Shown above: URL found in text of XML file in .docx archive ending in 123.RES._\n\n_Shown above: If the 123.RES file is viewed in Microsoft Edge, it opens the Diagnostics_\n_Troubleshooting Wizard._\n\n\n-----\n\n_Shown above: The diagnostics tool asks for a passkey, which I do not have._\n\n\n-----\n\n_Shown above: Script near the bottom of 123.RES with base64-encoded text._\n\n_Shown above: Base64 script translated to ASCII text reveals URLs for Qakbot DLL files._\n\n**_Indicators of Compromise (IOCs)_**\n\nNames of 11 attachments from TA570 emails on 2022-06-07:\n\n03792072_874241.html\n20755103_822431.html\n23891652_978954.html\n55088410_803346.html\n55448947_903195.html\n58218799_257561.html\n65058266_101487.html\n68101181_048154.html\n\n\n-----\n\n69849517_238275.html\n71875983_866759.html\n85873035_409355.html\n\nSHA256 hashes for the above HTML files:\n\n568cd2d4b6c33d00d00da0255fd27c351ae0a1eba72a926f3f81021a3ee0ce7b\n1513769188ac6bf68f87b33ed00555126bc68976c4d4022e040547a8814435dc\n07df19bfec85932ecac6649c8d49f98bdd3236368bbf2b73d924dbbf5ce7be32\n208bf25c7b5d16b6ba2f1cb029f55aed14e3f2df75e171d6c25f21ae99fbac92\n6b46db5ba757066c7872e6ada49ff23016a87cc3b24e22111809c56ad66d5b17\n8c5bea919f8c4abd0ba6d228a817ae3b7af9e6f13fafba69a1d2b6aac56dabcf\ne7b7b01ae0964dc285f480feae85e157d796bf7263f7bc1018d1030647cb28ac\n2ce0921bcec42ab238140c9e811db564b0d93c11ffae4eb2e03ce5e45a885637\nb8679b5c38bca0b2de5e238f29c4ad293c6051435d54711eba2197c42a6e0c80\n3ffb696484d28acbda12a73dde1ec3a68d75657b22af667f5104d83690a74de9\nc912048a25a7dd2f85fac3169fff008f6ebd9894b2fb6b98267b170c078b618c\n\nNames of 11 zip archives generated by the above HTML files:\n\n03792072_874241.zip\n20755103_822431.zip\n23891652_978954.zip\n55088410_803346.zip\n55448947_903195.zip\n58218799_257561.zip\n65058266_101487.zip\n68101181_048154.zip\n69849517_238275.zip\n71875983_866759.zip\n85873035_409355.zip\n\nSHA256 hashes for the above zip archives:\n\ne24ce87a20c17bafe9da942722492e2a81328dd9dc3b6af574c1dad4112daff1\n7a42a6182fc3b96b3de4aace5cc97c7c28017d9cfa154c410829caac3ca612c4\n994caa143ec7cedccf52a1e446fe2255e862924575c6c5b89a6af269bf3f3b71\n4a9f728b44c1827ed42a28d9b63bd3a5edf37ad0df34ad291ce8911329bf25c1\n2c0dae888de793f55b3c04d3cc9218e52b8e7a265776e231f62c14893e6bf2e5\n6e210c37f08f0723549af3e0a766bfef0703f4b35e6f60ca2f5d4ba1ca876bb1\n6bac41ebf365ee7a9f97ea84ed8e5f87e0799cbe2e38158b48d78f7d4746b821\naa114cb2d5b8043d72b8869f7c63cbc95078298233e37d258bcf04d37ded68e5\n95baf71d1ffc7a2677f77f824913d6c9f63dc8128ae9145930594831bfdabc45\n7de0f9f25bc8a3edb631ff42573719ccb0ad1ed2eeca54ad3dea63fb7f04d3be\n\n\n-----\n\n49bc1574020858f2277da948ecc44acc830e3cf1fd09f04d10f70462e3ed0d99\n\nNames of 11 disk image files extracted from the above zip archives:\n\n03792072_874241.img\n20755103_822431.img\n23891652_978954.img\n55088410_803346.img\n55448947_903195.img\n58218799_257561.img\n65058266_101487.img\n68101181_048154.img\n69849517_238275.img\n71875983_866759.img\n85873035_409355.img\n\nSHA256 hashes for the above disk image files:\n\n7e0a345fba5c7ad1d8196139a1ec8a66cf8ee7bee85627b9b9ccaa856d723ed5\n85b4504543ed58861a85899b4c1cd315fbc9bd31540ce74e7730495a9384eef2\n859bb10ac5b012f2af49dd9c6fe3463c60937e4054b395e5e5f2e2206a6fa6e7\nd9a19da9543b921c03e089a0c78a35ef1cc5bc378e2e457b5cea97b70f4490a7\n85591984196580620887922be65f053a7220ec455737a845d1f8da0665983524\nd9ac855c390cab8ab44970b838cb6b27a12f7771e3cfef064ff84a98555e0ba4\n33dff4aa9b4cc2f078638966b7d0787d4bd5b75b24b266e354b005fbb515e2d3\nc77c63b0ad713ca97776305af4b22cd934271fec00f3c8029bdbbfcf8cd1ed98\n090f652b176dfb8bb7ceaca8863ebf2041e250bb21b208fecdfa4d917aed5637\n997c4a9c2507695477552a98f89ebe64aea1685ac3309f42e7713d13ee3056f1\n9ad904b6ec926b0f03d856c3d57feb009c811f31e5676884db95f7d7652fd73d\n\nNames of 11 Windows shortcut files contained in the above disk images:\n\n03792072_874241.lnk\n20755103_822431.lnk\n23891652_978954.lnk\n55088410_803346.lnk\n55448947_903195.lnk\n58218799_257561.lnk\n65058266_101487.lnk\n68101181_048154.lnk\n69849517_238275.lnk\n71875983_866759.lnk\n85873035_409355.lnk\n\n\n-----\n\nSHA256 hash for all of the above Windows shortcut files\n\n03160be7cb698e1684f47071cb441ff181ff299cb38429636d11542ba8d306ae\n\nCommand generated from the Windows shortcut:\n\nC:\\Windows\\System32\\rundll32.exe 019338921.dll,DllInstall\n\nName for the obama186 Qakbot 32-bit DLL files hidden in the 11 disk images:\n\n19338921.dll\n\nSHA256 hashes for 10 obama186 Qakbot DLL files hidden in the 11 disk images:\n\n17af3b12512b3430d59ca594bc16171c66ec49db4458cb2de887b83e9f37860b\n31de1b6c455784d6524cc3db4b37360782f260ddedf414d60dd4c96913512f48\n41623849299f5f6d5551f9e58476a5df527cef441f65076d2526ea8a1437b3ed\n5577643e4028eb610c688d5ab703cd6c80c60aa99048414f1803e7264183c366\n68aee52f4bee3cf4d50f33110f439249dbe450f65f3ba09a0d833882ad8ded11\n71c9229eb849ed2ff17ef435b385ba98aeaae931849ff226621b39fd31e00976\n765844ed4f11fb1a050994f5d0a589fff04b2e6342acab17f373626f7583e10a\naf8232f3a789672602db9937217882f6d52f4640a258403ed3531172afca7220\ncef129dbfb9dc93e9937a60f2c31d292db8e3591a349f101923be8d05886920d\ne13fca7c957ae5064cdba0a1cea672031d7b8a56ee876bfa0c1a0505dc8ef24f\n\nNames of 11 .docx files contained in the 11 disk images:\n\ndoc106.docx\ndoc276.docx\ndoc310.docx\ndoc632.docx\ndoc672.docx\ndoc708.docx\ndoc879.docx\ndoc1454.docx\ndoc1750.docx\ndoc1792.docx\ndoc1848.docx\n\nSHA256 hash for the above .docx files:\n\nd20120cc046cef3c3f0292c6cbc406fcf2a714aa8e048c9188f1184e4bb16c93\n\nURL contained in XML file from the above .docx archive:\n\nhxxp://185.234.247[.]119/123.RES\n\n\n-----\n\nSHA256 hash of the above 123.RES file:\n\ne3ba1c45f9dd1f432138654b5f19cf89c55e07219b88aa7628334d38bb036433\n\nExamples of URLs contained in script from 123.RES that returned obama186 Qakbot DLL\nfiles:\n\nhxxp://104.36.229[.]139/75257103.dat\nhxxp://85.239.55[.]228/75257103.dat\nhxxp://185.234.247[.]119/75257103.dat\n\nExample of User-Agent string in HTTP request header for the above URLs:\n\nUser-Agent: Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US)\nWindowsPowerShell/5.1.16299.431\n\nExamples of obama186 Qakbot DLL files retrieved from the above URLs:\n\n6a16d1ec263eeacd6d5b2eb1855337a0aeeacd8020df840a0d883f973b3111b7\n767e1d12493cb7de999a85323da06190706324397d26af020b9bc833c6d5b7f6\n62acb357d94bebb8ee25761e5b7b0188f44e5c69156bbcb884884d1fe6b2838a\n\n**_Final Words_**\n\nAs mentioned earlier, I was unable to get the Follina exploit to work in my lab environment.\nAnd the next day (Wednesday 2022-06-08), TA570 did not include a .docx file in disk images\nassociated with obama187 Qakbot. The disk image --> Windows shortcut --> hidden DLL\nmethod of Qakbot infection worked in my lab environment, though.\n\nI've posted the associated emails, malware, and a pcap of infection traffic from a TA570\n[obama186 Qakbot infection from Tuesday 2022-06-07 here.](https://www.malware-traffic-analysis.net/2022/06/07/index2.html)\n\n--Brad Duncan\nbrad [at] malware-traffic-analysis.net\n\n[Keywords: CVE202230190](https://isc.sans.edu/tag.html?tag=CVE202230190) [Follina](https://isc.sans.edu/tag.html?tag=Follina) [Qakbot](https://isc.sans.edu/tag.html?tag=Qakbot) [Qbot](https://isc.sans.edu/tag.html?tag=Qbot) [TA570](https://isc.sans.edu/tag.html?tag=TA570)\n[0 comment(s)](https://isc.sans.edu/forums/diary/TA570+Qakbot+Qbot+tries+CVE202230190+Follina+exploit+msmsdt/28728/)\n\nJoin us at SANS! Attend [with Brad Duncan in starting](https://isc.sans.edu/diary/rss/28728)\n\nTop of page\n√ó\n\n[Diary Archives](https://isc.sans.edu/diaryarchive.html)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-06-09 - TA570 Qakbot (Qbot) tries CVE-2022-30190 (Follina) exploit (ms-msdt).pdf"
    ],
    "report_names": [
        "2022-06-09 - TA570 Qakbot (Qbot) tries CVE-2022-30190 (Follina) exploit (ms-msdt).pdf"
    ],
    "threat_actors": [
        {
            "id": "96d5b301-0872-444c-ba32-eecf7a9241c0",
            "created_at": "2023-02-15T02:01:49.560566Z",
            "updated_at": "2025-03-27T02:00:03.112349Z",
            "deleted_at": null,
            "main_name": "TA570",
            "aliases": [
                "DEV-0450"
            ],
            "source_name": "MISPGALAXY:TA570",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536181,
    "ts_updated_at": 1743041592,
    "ts_creation_date": 1655092860,
    "ts_modification_date": 1655092860,
    "files": {
        "pdf": "https://archive.orkl.eu/a601b130e57a7ba5cab0adaaf941b263f4c6046c.pdf",
        "text": "https://archive.orkl.eu/a601b130e57a7ba5cab0adaaf941b263f4c6046c.txt",
        "img": "https://archive.orkl.eu/a601b130e57a7ba5cab0adaaf941b263f4c6046c.jpg"
    }
}