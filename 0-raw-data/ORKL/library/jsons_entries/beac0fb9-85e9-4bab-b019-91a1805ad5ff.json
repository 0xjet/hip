{
    "id": "beac0fb9-85e9-4bab-b019-91a1805ad5ff",
    "created_at": "2023-01-12T15:08:04.307653Z",
    "updated_at": "2025-03-27T02:16:11.664729Z",
    "deleted_at": null,
    "sha1_hash": "0ebe7a14088cf1e570b79b48981f188b6b3fd714",
    "title": "2022-03-09 - Exploitation of VMware Horizon Servers by TunnelVision Threat Actor",
    "authors": "",
    "file_creation_date": "2022-05-29T00:53:21Z",
    "file_modification_date": "2022-05-29T00:53:21Z",
    "file_size": 376297,
    "plain_text": "# Exploitation of VMware Horizon Servers by TunnelVision Threat Actor\n\n**[esentire.com/blog/exploitation-of-vmware-horizon-servers-by-tunnelvision-threat-actor](https://www.esentire.com/blog/exploitation-of-vmware-horizon-servers-by-tunnelvision-threat-actor)**\n\n[Adversaries don’t work 9-5 and neither do we. At eSentire, our 24/7 SOCs are staffed with](https://www.esentire.com/what-we-do/security-operations-center)\nElite Threat Hunters and Cyber Analysts who hunt, investigate, contain and respond to\nthreats within minutes.\n\nWe have discovered some of the most dangerous threats and nation state attacks in our\nspace – including the Kaseya MSP breach and the more_eggs malware.\n\nOur Security Operations Centers are supported with Threat Intelligence, Tactical Threat\nResponse and Advanced Threat Analytics driven by our Threat Response Unit – the TRU\nteam.\n\nIn TRU Positives, eSentire’s Threat Response Unit (TRU) provides a summary of a recent\nthreat investigation. We outline how we responded to the confirmed threat and what\nrecommendations we have going forward.\n\n**Here’s the latest from our TRU Team…**\n\n## What did we find?\n\n\n-----\n\nIn early February 2022, we identified suspicious account creation and credential\nharvesting attempts on a customer’s endpoint. The activity was escalated and traced to\na VMware Horizon server.\nThis server was operating an out-of-date version known to be vulnerable to Log4Shell\n(CVE-2021-44228). The server itself was not publicly accessible but believed to be\nexposed to untrusted input routed from an Internet-facing system.\nAnalysis by our Threat Intelligence team indicates a strong link to TunnelVision, an\nactivity cluster operated by an Iranian-aligned threat actor(s).\nAttribution to the TunnelVision activity cluster is supported by the following artifacts and\nobserved Tactics, Techniques and Procedures (TTPs):\n\nCommon use of tunnel server 142.44.135[.]86\nObserved C2 domain activate-microsoft[.]cf utilizes a similar naming\nconvention to known TunnelVision server microsoft-updateserver[.]cf and\nshares similar registration characteristics.\nTTPs (summarized below) observed in this case align with known TunnelVision\nbehavior.\nThe summary of intrusion activity for TunnelVision is as follows:\n\nThe initial pivot from compromised Horizon server occurred using NTLM\nauthentication for a generic administrator account.\nA backdoor account “DomainAdmin” is created on secondary systems using net\ncommand and then added to local administrators' group.\nThe adversary then performs lateral movement using PSexec and RDP.\nCredentials are then harvested using Procdump.\nMalware is written to C:\\Users\\DomainAdmin\\Desktop\\Drokbk.exe which creates\nservice name, “SessionManagerService”.\nThe malware written to c:\\programdata\\SoftwareDistribution\\SessionService.exe\ncommunicates with activate-microsoft[.]cf and GitHub.\nSysinternals and SSH tools are downloaded by the backdoor account using a\nweb browser on compromised systems.\n[Lastly, RDP tunneling is done using Ngrok to IP 142.44.135[.]86.](https://ngrok.com/)\n\n## How did we find it?\n\nWe used eSentire MDR for Endpoint to identify post-exploitation TTPs.\n\n## What did we do?\n\nOur 24/7 SOC alerted the customer and responded to isolate the host on the client's\nbehalf. We automatically blocked certain actions such as credential harvesting.\nOur Incident Handler team was engaged for further identification and containment\nactions.\n\n## What can you learn from this TRU positive?\n\n\n-----\n\n[In a recent blog post, SentinelOne researchers linked TunnelVision’s activity to the](https://www.sentinelone.com/labs/log4j2-in-the-wild-iranian-aligned-threat-actor-tunnelvision-actively-exploiting-vmware-horizon/)\n[deployment of ransomware using n-day vulnerabilities including Log4Shell to access](https://www.darkreading.com/vulnerabilities-threats/the-overlooked-problem-of-n-day-vulnerabilities)\nand compromise targets\nWhile overall exploitation of Log4Shell has diminished since peaking in December\n2021 (see figure 1), opportunistic exploitation of VMware Horizon servers continues.\nWe responded to several cases of Horizon Log4Shell exploitation throughout January\nand February 2022 (including this one).\nNetwork visibility determines the level of response effort required with regards to the\nexploitation of Horizon servers. It means the difference between identifying direct\nexploitation vs. just the ripple effects of a threat actor with a network foothold.\n\nWhere we had network and endpoint telemetry on Horizon servers, we were able\nto react and contain successful exploitation prior to lateral spread.\nWhere visibility was adjacent to these servers, we identified post-exploitation\nactivity such as lateral movement using compromised credentials.\nIn certain cases, vulnerable Horizon servers were not Internet-facing, but ultimately had\nexploit requests routed to them from external gateways.\n\n_Figure 1 Log4J exploit events observed by MDR for Network, December 2021 to January_\n_2022_\n\n## Recommendations from our Threat Response Unit (TRU) Team:\n\nLoader malware attempts to install other malware, so the priority should be to identify and\ninvestigate the presence of follow-on malware on systems. In addition, we recommend:\n\n\n-----\n\nEnsure any system which is directly exposed to the Internet or that handles untrusted\ndata routed from Internet-facing systems is patched for Log4Shell (CVE-2021-44228).\nEnsure your security tools are monitoring critical servers such as VMware Horizon.\n\nThis should include network, endpoint, and log visibility to aid with detection,\nresponse, and containment activities.\n\n## Ask Yourself…\n\nAre you monitoring for compromise of critical systems and follow-on actions?\nAre patches in place for actively exploited vulnerabilities?\n\nIf you’re not currently engaged with a Managed Detection and Response provider, we highly\nrecommend you partner with us for security services in order to disrupt threats before they\nimpact your business.\n\n[Want to learn more? Connect with an eSentire Security Specialist.](https://www.esentire.com/get-started)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-09 - Exploitation of VMware Horizon Servers by TunnelVision Threat Actor.pdf"
    ],
    "report_names": [
        "2022-03-09 - Exploitation of VMware Horizon Servers by TunnelVision Threat Actor.pdf"
    ],
    "threat_actors": [
        {
            "id": "d8af157e-741b-4933-bb4a-b78490951d97",
            "created_at": "2023-01-06T13:46:38.748929Z",
            "updated_at": "2025-03-27T02:00:02.908256Z",
            "deleted_at": null,
            "main_name": "APT35",
            "aliases": [
                "Newscaster Team",
                "Magic Hound",
                "G0059",
                "Phosphorus",
                "Mint Sandstorm",
                "TunnelVision",
                "COBALT MIRAGE"
            ],
            "source_name": "MISPGALAXY:APT35",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "04888f75-158b-47f9-8ad9-4ff83f618ece",
            "created_at": "2024-05-01T02:03:08.03763Z",
            "updated_at": "2025-03-27T02:05:17.319276Z",
            "deleted_at": null,
            "main_name": "COBALT MIRAGE",
            "aliases": [
                "Nemesis Kitten ",
                "PHOSPHORUS ",
                "TunnelVision ",
                "UNC2448 ",
                "DEV-0270 "
            ],
            "source_name": "Secureworks:COBALT MIRAGE",
            "tools": [
                " Custom powershell scripts",
                " DiskCryptor",
                " Drokbk",
                " FRPC",
                " Fast Reverse Proxy (FRP)",
                " Impacket wmiexec",
                " Ngrok",
                " Plink",
                " PowerLessCLR",
                " TunnelFish",
                "BitLocker"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "1699fb41-b83f-42ff-a6ec-984ae4a1031f",
            "created_at": "2022-10-25T16:07:23.83826Z",
            "updated_at": "2025-03-27T02:02:09.995863Z",
            "deleted_at": null,
            "main_name": "Magic Hound",
            "aliases": [
                "APT 35",
                "Ballistic Bobcat",
                "Charming Kitten",
                "CharmingCypress",
                "Cobalt Illusion",
                "Cobalt Mirage",
                "Educated Manticore",
                "Magic Hound",
                "Mint Sandstorm",
                "Operation BadBlood",
                "Operation Sponsoring Access",
                "Operation SpoofedScholars",
                "Operation Thamar Reservoir",
                "Phosphorus",
                "TA453",
                "TEMP.Beanie",
                "Tarh Andishan",
                "Timberworm",
                "TunnelVision",
                "UNC788",
                "Yellow Garuda"
            ],
            "source_name": "ETDA:Magic Hound",
            "tools": [
                "7-Zip",
                "AnvilEcho",
                "BASICSTAR",
                "CORRUPT KITTEN",
                "CWoolger",
                "CharmPower",
                "ChromeHistoryView",
                "CommandCam",
                "DistTrack",
                "DownPaper",
                "FRP",
                "Fast Reverse Proxy",
                "FireMalv",
                "Ghambar",
                "GoProxy",
                "GorjolEcho",
                "HYPERSCRAPE",
                "Havij",
                "MPK",
                "MPKBot",
                "Matryoshka",
                "Matryoshka RAT",
                "MediaPl",
                "Mimikatz",
                "MischiefTut",
                "NETWoolger",
                "NOKNOK",
                "PINEFLOWER",
                "POWERSTAR",
                "PowerLess Backdoor",
                "PsList",
                "Pupy",
                "PupyRAT",
                "SNAILPROXY",
                "Shamoon",
                "TDTESS",
                "WinRAR",
                "WoolenLogger",
                "Woolger",
                "pupy",
                "sqlmap"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536084,
    "ts_updated_at": 1743041771,
    "ts_creation_date": 1653785601,
    "ts_modification_date": 1653785601,
    "files": {
        "pdf": "https://archive.orkl.eu/0ebe7a14088cf1e570b79b48981f188b6b3fd714.pdf",
        "text": "https://archive.orkl.eu/0ebe7a14088cf1e570b79b48981f188b6b3fd714.txt",
        "img": "https://archive.orkl.eu/0ebe7a14088cf1e570b79b48981f188b6b3fd714.jpg"
    }
}