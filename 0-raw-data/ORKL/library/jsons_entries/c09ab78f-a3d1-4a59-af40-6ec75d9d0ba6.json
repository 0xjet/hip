{
    "id": "c09ab78f-a3d1-4a59-af40-6ec75d9d0ba6",
    "created_at": "2023-01-12T15:10:00.271903Z",
    "updated_at": "2025-03-27T02:16:39.945725Z",
    "deleted_at": null,
    "sha1_hash": "3f3cf1955409ce6485c4f4b82cd2c22124691e69",
    "title": "2011-01-30 - GpCode Ransomware 2010 Simple Analysis",
    "authors": "",
    "file_creation_date": "2022-05-28T03:40:05Z",
    "file_modification_date": "2022-05-28T03:40:05Z",
    "file_size": 2019864,
    "plain_text": "# GpCode Ransomware 2010 Simple Analysis\n\n**xylibox.com/2011/01/gpcode-ransomware-2010-simple-analysis.html**\n\n[PDF available here](http://xylitol.free.fr/gpcode2010.pdf)\n\nHi, firstly: sorry for my bad English. It's not my native language (I'M FRENCH)\n\nWell, I’ve wanted to make a post about that a long time ago but I was really bored to have a look at it.\n\nFinally I did it because no one seem done it before (or no one have the sample to work at it?)\n\nSo let's start directly, if you want to know more about GpCode story, have a look at this post:\n\n[http://www.securelist.com/en/blog/333/GpCode_like_Ransomware_Is_Back](http://www.securelist.com/en/blog/333/GpCode_like_Ransomware_Is_Back)\n\nSome technical informations about the file:\n\n**CRC32: CCDFBD05**\n\n**MD5: b14c45c1792038fd69b5c75e604242a3**\n\n**SHA1: 54ab323053f1138e5ccaa8f8afaa38cabca9491f**\n\n**Packer: UPX 0.89.6 - 1.02 / 1.05 - 2.90 -> Markus & Laszlo**\n\n**Compiler: MASM/TASM**\n\n**File size: 10,5 Kb (10 752 bytes)**\n\n**OEP: 00011790**\n\n**Also known as: Trojan.Gpcoder.G (Symantec), GPcoder.j (McAfee), Trojan:Win32/Ransom.BQ (Microsoft), TROJ_RANSOM.EWQ**\n(TrendMicro), Troj/Ransom-U (Sophos)\n\n**\"Main place\" in Ollydbg:**\n\nOEP: 0x401990 (When unpacked)\n\nText version:\n\n00401990 >/$ E8 48FCFFFF  CALL 004015DD           ; 1.004015DD\n\n00401995 |. 85C0     TEST EAX,EAX\n\n00401997 |. 0F84 80000000 JE 00401A1D            ; 1.00401A1D\n\n0040199D |. 68 2E304000  PUSH 40302E            ; /MutexName = \"ilold\"\n\n004019A2 |. 6A 00     PUSH 0               ; |Inheritable = FALSE\n\n004019A4 |. 68 01001F00  PUSH 1F0001            ; |Access = 1F0001\n\n004019A9 |. E8 12010000  CALL 00401AC0           ; \\OpenMutexA\n\n004019AE |. 85C0     TEST EAX,EAX\n004019B0 |. 75 6B     JNZ SHORT 00401A1D         ; 1.00401A1D\n\n004019B2 |. 68 2E304000  PUSH 40302E            ; /MutexName = \"ilold\"\n\n004019B7 |. 6A 00     PUSH 0               ; |InitialOwner = FALSE\n\n\n-----\n\n00 0 9 9 | 6 00 US 0 ; |pSecu ty U\n004019BB |. E8 9A000000  CALL 00401A5A           ; \\CreateMutexA\n004019C0 |. E8 3BF6FFFF  CALL 00401000           ; 1.00401000\n004019C5 |. 85C0     TEST EAX,EAX\n004019C7 |. 74 54     JE SHORT 00401A1D         ; 1.00401A1D\n004019C9 |. E8 A3F8FFFF  CALL 00401271           ; 1.00401271\n004019CE |. 33C0     XOR EAX,EAX\n004019D0 |. 50      PUSH EAX              ; /pThreadId => NULL\n004019D1 |. 50      PUSH EAX              ; |CreationFlags => 0\n004019D2 |. 50      PUSH EAX              ; |pThreadParm => NULL\n004019D3 |. 68 35134000  PUSH 401335            ; |ThreadFunction = 1.00401335\n004019D8 |. 50      PUSH EAX              ; |StackSize => 0\n004019D9 |. 50      PUSH EAX              ; |pSecurity => NULL\n004019DA |. E8 81000000  CALL 00401A60           ; \\CreateThread\n004019DF |. 6A 01     PUSH 1               ; /ErrorMode = SEM_FAILCRITICALERRORS\n004019E1 |. E8 EC000000  CALL 00401AD2           ; \\SetErrorMode\n004019E6 |. E8 A5000000  CALL 00401A90           ; [GetLogicalDrives\n004019EB |. B9 19000000  MOV ECX,19\n004019F0 |> BB 01000000  /MOV EBX,1\n004019F5 |. D3E3     |SHL EBX,CL\n004019F7 |. 23D8     |AND EBX,EAX\n004019F9 |. 74 1F     |JE SHORT 00401A1A         ; 1.00401A1A\n004019FB |. 80C1 41    |ADD CL,41\n004019FE |. 880D 70304000 |MOV BYTE PTR DS:[403070],CL\n00401A04 |. 80E9 41    |SUB CL,41\n00401A07 |. C705 71304000>|MOV DWORD PTR DS:[403071],2A5C3A\n00401A11 |. 50      |PUSH EAX\n00401A12 |. 51      |PUSH ECX\n00401A13 |. E8 EEFDFFFF  |CALL 00401806           ; 1.00401806\n00401A18 |. 59      |POP ECX\n00401A19 |. 58      |POP EAX\n00401A1A |> 49      |DEC ECX\n00401A1B |.^ 7D D3     \\JGE SHORT 004019F0        ; 1.004019F0\n00401A1D |> 68 F4010000  PUSH 1F4              ; /Timeout = 500. ms\n00401A22 |. E8 BD000000  CALL 00401AE4           ; \\Sleep\n00401A27 |. 833D 34304000>CMP DWORD PTR DS:[403034],1\n00401A2E |.^ 75 ED     JNZ SHORT 00401A1D         ; 1.00401A1D\n00401A30 |. E8 90F6FFFF  CALL 004010C5           ; 1.004010C5\n00401A35 |. E8 33FDFFFF  CALL 0040176D           ; 1.0040176D\n00401A3A |. 6A 00     PUSH 0               ; /ExitCode = 0\n00401A3C \\. E8 25000000  CALL 00401A66           ; \\ExitProcess\n\nIn the first call, GpCode will load, and lock a resource.\n\n004015F4 |. 6A 0A     PUSH 0A              ; /ResourceType = RT_RCDATA\n004015F6 | 68 65304000 PUSH 403065 ; |ResourceName = \"cfg\"\n\n\n-----\n\n00 0 5 | 6 00 US 0 ; | odu e U\n004015FD |. E8 7C040000  CALL 00401A7E           ; \\FindResourceA\n\nScreenshot of grabbed data:\n\nAccording to the first bytes this is not a valid PE file (So, why moving this?).\nWell:\n0040160D |. 50      PUSH EAX              ; /hResource\n0040160E |. 6A 00     PUSH 0               ; |hModule = NULL\n00401610 |. E8 C9040000  CALL 00401ADE           ; \\SizeofResource\n00401615 |. 0BC0     OR EAX,EAX\n00401617 |. 75 04     JNZ SHORT 0040161D         ; GpCode.0040161D\n00401619 |. 33C0     XOR EAX,EAX\n0040161B |. C9      LEAVE\n0040161C |. C3      RETN\n\nHere it grabs the size of the resource, eax will contain 0000055D (1373)\nNote: The screenshot of resource hacker also indicate the size.\n\nWhen it's done, it gets free memory by GlobalAlloc (at eax: 00175158)\nWith the specified size: 55D\n\n00401646 |. FF75 F0    PUSH DWORD PTR SS:[EBP-10]     ; /MemSize\n00401649 |. 6A 40     PUSH 40               ; |Flags = GPTR\n0040164B |. E8 52040000  CALL 00401AA2            ; \\GlobalAlloc\n00401650 |. 0BC0     OR EAX,EAX\n\nThen, it does a copy to the following memory (00175158)\n0040165D |. FF75 F0    PUSH DWORD PTR SS:[EBP-10]     ; /Length = 55D (1373.)\n00401660 |. FF75 FC    PUSH DWORD PTR SS:[EBP-4]      ; |Source = GpCode.0040F474\n00401663 |. FF75 EC    PUSH DWORD PTR SS:[EBP-14]     ; |Destination = 00175158\n00401666 |. E8 61040000  CALL 00401ACC            ; \\RtlMoveMemory\n0040166B |. FF75 F8    PUSH DWORD PTR SS:[EBP-8]      ; /hResource = 0040F474\n0040166E |. E8 11040000  CALL 00401A84            ; \\FreeResource\n00401673 |. 8B5D EC    MOV EBX,DWORD PTR SS:[EBP-14]\n00401676 |. 6A 10     PUSH 10               ; /Length = 10 (16.)\n00401678 |. 53      PUSH EBX              ; |Source = 00175158\n00401679 |. 68 70444000  PUSH 404470             ; |Destination = GpCode.00404470\n0040167E |. E8 49040000  CALL 00401ACC            ; \\RtlMoveMemory\n\n\n-----\n\nJust after doing this, it goes to another call\n\nIn this call it will decrypt the data contained at 00175158 (seems interesting now)\n\nAt the end of loop:\n\nWe got a clear text with also a list of extensions which will be encrypted:\n\n- .jpg\n\n- .jpeg\n\n- .psd\n\n- .cdr\n\n- .dwg\n\n- .max\n\n- .mov\n\n- .m2v\n\n- .3gp\n\n- .doc\n\n- .docx\n\n- .xls\n\n- .xlsx\n\n- .ppt\n\n- .pptx\n\n- .rar\n\n- .zip\n\n- .mdb\n\n- .mp3\n\n- .cer\n\n- .p12\n\n- .pfx\n\n- .kwm\n\n- .pwm\n\n\n-----\n\nt t\n\n- .pdf\n\n- .avi\n\n- .flv\n\n- .lnk\n\n- .bmp\n\n- .1cd\n\n- .md\n\n- .mdf\n\n- .dbf\n\n- .mdb\n\n- .odt\n\n- .vob\n\n- .ifo\n\n- .mpeg\n\n- .mpg\n\n- .doc\n\n- .docx\n\n- .xls\n\n- .xlsx\n\n.bat .sys .exe .ini files will not be attacked because the system uses all of them.\nAnd the goal of GpCode is not to crash the system.\n\nSo, he returns to the call and move again the memory to another place.\nWith selecting this time a block of bytes (398) and move it to 00175BB8\n\n004016CD |. 57      PUSH EDI              ; /Length = 398 (920.)\n004016CE |. 53      PUSH EBX              ; |Source = 00175172\n004016CF |. FF35 88444000 PUSH DWORD PTR DS:[404488]     ; |Destination = 00175BB8\n004016D5 |. E8 F2030000  CALL 00401ACC            ; \\RtlMoveMemory\n\nBlock of 398 bytes:\n00175BA8            Attention!!!  ..All your personal files (\n00175BE8 photo, documents, texts, databases, certificates, kwm-files, vid\n00175C28 eo) have been encrypted by a very strong cypher RSA-1024. The or\n00175C68 iginal files are deleted. You can check this by yourself - just\n00175CA8  look for files in all folders... There is no possibility to dec\n00175CE8 rypt these files without a special decrypt program! Nobody can h\n00175D28 elp you - even don't try to find another method or tell anybody.\n00175D68  Also after n days all encrypted files will be completely delete\n00175DA8 d and you will have no chance to get it back. .. We can help to\n00175DE8 solve this task for 120$ via wire transfer (bank transfer SWIFT/\n00175E28 IBAN). And remember: any harmful or bad words to our side will b\n00175E68 e a reason for ingoring your message and nothing will be done...\n00175EA8 For details you have to send your request on this e-mail (attach\n00175EE8  to message a full serial key shown below in this 'how to..' fil\n00175F28 e on desktop):  datafinder@fastmail.fm\n\nAfter, another block is moved (271 bytes)\n0040170A |. FF35 80444000 PUSH DWORD PTR DS:[404480]     ; /Length = 10F (271.)\n00401710 |. 53      PUSH EBX              ; |Source = 00175512\n00401711 |. FF35 8C444000 PUSH DWORD PTR DS:[40448C]     ; |Destination = 001756C0\n00401717 |. E8 B0030000  CALL 00401ACC            ; \\RtlMoveMemory\n\nThe block of bytes moved, you guessed it?:\n001756C0 *.jpg.*.jpeg.*.psd.*.cdr.*.dwg.*.max.*.mov.*.m2v.*.3gp.*.doc.*.d\n00175700 ocx.*.xls.*.xlsx.*.ppt.*.pptx.*.rar.*.zip.*.mdb.*.mp3.*.cer.*.p1\n00175740 2.*.pfx.*.kwm.*.pwm.*.txt.*.pdf.*.avi.*.flv.*.lnk.*.bmp.*.1cd.*.\n00175780 md.*.mdf.*.dbf.*.mdb.*.odt.*.vob.*.ifo,.*.mpeg.*.mpg.*.doc.*.doc\n001757C0 x.*.xls.*.xlsx\n\nAfter that he returns to the \"Main place\" (screenshot 1)\nAnd Create the mutex \"ilold\"\n\n\n-----\n\n00 0 9 | 68 30 000 US 030 ; / ute a e o d\n004019B7 |. 6A 00     PUSH 0               ; |InitialOwner = FALSE\n004019B9 |. 6A 00     PUSH 0               ; |pSecurity = NULL\n004019BB |. E8 9A000000  CALL 00401A5A            ; \\CreateMutexA\n\nThen it goes to a call.. a crypto procedure\n004019C0 |. E8 3BF6FFFF  CALL 00401000            ; GpCode.00401000\n\nWell I'm not very good to explain crypto stuff\nSo I will make it simple: it generate a key then it store it and use GlobalAlloc to set a free memory place.\nI will give you some screenshot if you have a better level than me you will surely understand\n00401050 |. E8 DD0A0000  CALL 00401B32            ; <JMP.&advapi32.CryptExportKey>\n00401055 |. FF35 A2444000 PUSH DWORD PTR DS:[4044A2]     ; /MemSize = 2C (44.)\n0040105B |. 6A 40     PUSH 40               ; |Flags = GPTR\n0040105D |. E8 400A0000  CALL 00401AA2            ; \\GlobalAlloc\n\nHex dump of address 4044A2:\n\nThen it also gets free memory at 0017CD30:\n004010A0 |. E8 A50A0000  CALL 00401B4A            ; <JMP.&advapi32.CryptSetKeyParam>\n004010A5 |. 68 00000100  PUSH 10000             ; /MemSize = 10000 (65536.)\n004010AA |. 6A 40     PUSH 40               ; |Flags = GPTR\n004010AC |. E8 F1090000  CALL 00401AA2            ; \\GlobalAlloc\n004010B1 |. 0BC0     OR EAX,EAX\n\nTake 44 from 0017B928 and move it 008F0020\n004012D2 |. FF35 A2444000 PUSH DWORD PTR DS:[4044A2]     ; /Length = 2C (44.)\n004012D8 |. FF35 A6444000 PUSH DWORD PTR DS:[4044A6]     ; |Source = 0017B928\n004012DE |. FF35 C8444000 PUSH DWORD PTR DS:[4044C8]     ; |Destination = 008F0020\n004012E4 |. E8 E3070000  CALL 00401ACC            ; \\RtlMoveMemory\n\nAnd what we see in the source?\n\nCall CryptEncrypt, used for RSA:\n0040130C |. E8 1B080000  CALL 00401B2C            ; <JMP.&advapi32.CryptEncrypt>\n\nAfter it creates a thread and retrieves a bitmask representing the currently available disk drives.\nThen we enter in a loop.\n\nThe return value from GetLogicalDrives is a bitmask representing the currently available disk drives.\n\n\n-----\n\nt pos t o 0 (t e east s g ca t b t) s d e, b t pos t o s d e, b t pos t o s d e C, a d so o\nOn the loop, we will start from 25 (Drive Z) and when a number is found for example 'D' (who have the position 3)\nYou will not take the \"jump if equal\", enter in a call *do something* and then return in the loop for continue, next letters position 2: \"C\"\n\nI name this place \"Core\" because all will be decided inside this procedure for data.\nLet's see what he is doing to 'D'\n00401806 /$ 55      PUSH EBP\n00401807 |. 8BEC     MOV EBP,ESP\n00401809 |. 81EC 44010000 SUB ESP,144\n0040180F |. 8D85 BCFEFFFF LEA EAX,DWORD PTR SS:[EBP-144]\n00401815 |. 50      PUSH EAX              ; /pFindFileData\n00401816 |. 68 70304000  PUSH 403070             ; |FileName = \"D:\\*\"\n0040181B |. E8 52020000  CALL 00401A72            ; \\FindFirstFileA\n00401820 |. 40      INC EAX\n00401821 |. 0F84 67010000 JE 0040198E             ; 1.0040198E\n\nHe does... NOTHiNG.\n'D' was my CD drive and there is no CD inside (FindFirstFileA is an explicit API right?) so eax return FFFFFFFF\nHe take the jump which leave the procedure.\n0040198E |> \\C9      LEAVE\n0040198F \\. C3      RETN\n\nBut what's about my local disk 'C' who is the next ?\n\nThere is a blacklisted file \"HOW TO DECRYPT FILES.txt\"\nIf the ransomware found this file, he will quit the routine:\n004018CF |. 53      |PUSH EBX              ; /String2\n004018D0 |. 68 38304000  |PUSH 403038            ; |String1 = \"HOW TO DECRYPT FILES.txt\"\n004018D5 |. E8 22020000  |CALL 00401AFC           ; \\lstrcmpiA\n004018DA |. 85C0     |TEST EAX,EAX\n004018DC |. 0F84 8D000000 |JE 0040196F            ; 1.0040196F\n\nIt does another check after, but we dont know wich file for the moment.\n004018CF |. 53      |PUSH EBX              ; /String2\n004018D0 |. 68 38304000  |PUSH 403038            ; |String1 = \"HOW TO DECRYPT FILES.txt\"\n004018D5 |. E8 22020000  |CALL 00401AFC           ; \\lstrcmpiA\n004018DA |. 85C0     |TEST EAX,EAX\n\n\n-----\n\n00 0 8 C | 0 8 8 000000 |J 00 0 96 ; 00 0 96\n004018E8 |. 53      |PUSH EBX              ; /String2\n004018E9 |. 68 644F4000  |PUSH 404F64            ; |String1 = \"\"\n004018EE |. E8 09020000  |CALL 00401AFC           ; \\lstrcmpiA\n\nThat will be bad if the ransomware encode it's own stuff -.^ (to be continued)\nAfter this check, the ransomware 'create' a path to the file\n004018FD |. 50      |PUSH EAX              ; /StringToAdd = \"AUTOEXEC.BAT\"\n004018FE |. 68 70354000  |PUSH 403570            ; |ConcatString = \"C:\\AUTOEXEC.BAT\"\n00401903 |. E8 E8010000  |CALL 00401AF0           ; \\lstrcatA\n\nAnd then it check the extention of the file:\n00401914 |> /51      |/PUSH ECX\n00401915 |. |53      ||PUSH EBX             ; /Wildcard\n00401916 |. |68 70354000  ||PUSH 403570            ; |Path = \"C:\\AUTOEXEC.BAT\"\n0040191B |. |E8 36020000  ||CALL 00401B56           ; \\PathMatchSpecA\n00401920 |. |83F8 01    ||CMP EAX,1\n00401923 |. |75 03     ||JNZ SHORT 00401928        ; 1.00401928\n00401925 |. |59      ||POP ECX\n00401926 |. |EB 10     ||JMP SHORT 00401938        ; 1.00401938\n00401928 |> |53      ||PUSH EBX             ; /String\n00401929 |. |E8 E0010000  ||CALL 00401B0E           ; \\lstrlenA\n0040192E |. |03D8     ||ADD EBX,EAX\n00401930 |. |83C3 01    ||ADD EBX,1\n00401933 |. |59      ||POP ECX\n00401934 |.^\\E2 DE     |\\LOOPD SHORT 00401914       ; 1.00401914\n\nThe \".bat\" extension is not in the 'list' of extension to crypt so he simply leave with this line.\n00401936 |. /EB 37     |JMP SHORT 0040196F         ; 1.0040196F\n\nAnd proceed to the next file:\n00401975 |. 50      |PUSH EAX              ; /pFindFileData\n00401976 |. FF75 FA    |PUSH DWORD PTR SS:[EBP-6]     ; |hFile\n00401979 |. E8 FA000000  |CALL 00401A78           ; \\FindNextFileA\n0040197E |. 85C0     |TEST EAX,EAX\n00401980 |.^ 0F85 A5FEFFFF \\JNZ 0040182B            ; 1.0040182B\n0040197E |. 85C0     |TEST EAX,EAX\n00401986 |. FF75 FA    PUSH DWORD PTR SS:[EBP-6]      ; /hSearch\n00401989 |. E8 DE000000  CALL 00401A6C            ; \\FindClose\n0040198E |> C9      LEAVE\n0040198F \\. C3      RETN\n\nTo test the procedure i've made a txt file called \"AUTOEXEC.txt\"\n\n\n-----\n\nThis time it detects the extension .txt and dont take the conditional jump:\n00401923 |. /75 03     ||JNZ SHORT 00401928        ; 1.00401928\n00401925 |. |59      ||POP ECX\n00401926 |. |EB 10     ||JMP SHORT 00401938        ; 1.00401938\n\nit jump here:\n00401938 |> \\68 70354000  |PUSH 403570            ; /Arg1 = 00403570 ASCII \"C:\\AUTOEXEC.txt\"\n0040193D |. E8 9CF7FFFF  |CALL 004010DE           ; \\1.004010DE\n00401942 |. 68 70354000  |PUSH 403570            ; /String2 = \"C:\\AUTOEXEC.txt\"\n00401947 |. 68 703A4000  |PUSH 403A70            ; |String1 = 1.00403A70\n0040194C |. E8 B1010000  |CALL 00401B02           ; \\lstrcpyA\n00401951 |. 68 00304000  |PUSH 403000            ; /StringToAdd = \".ENCODED\"\n00401956 |. 68 703A4000  |PUSH 403A70            ; |ConcatString = \"\"\n0040195B |. E8 90010000  |CALL 00401AF0           ; \\lstrcatA\n00401960 |. 68 703A4000  |PUSH 403A70            ; /NewName = \"\"\n00401965 |. 68 70354000  |PUSH 403570            ; |ExistingName = \"C:\\AUTOEXEC.txt\"\n0040196A |. E8 4B010000  |CALL 00401ABA           ; \\MoveFileA\n\nWhat do we see ?\nHe takes the full patch to the file, then it enters to a procedure and do something\nAfter the return, it renames the file with the extension \".ENCODED\"\nAnd continue to check for other files.\nLet's enter inside the call now.\n\n00401109 |. 6A 00     PUSH 0               ; /pFileSizeHigh = NULL\n0040110B |. FF75 FC    PUSH DWORD PTR SS:[EBP-4]      ; |hFile\n0040110E |. E8 77090000  CALL 00401A8A            ; \\GetFileSize\n00401113 |. 8945 F8    MOV DWORD PTR SS:[EBP-8],EAX\n00401116 |. 83F8 10    CMP EAX,10\n00401119 |. 0F8C 41010000 JL 00401260             ; 1.00401260\n\nInteresting thing is this size check, files under 11 bytes are not crypted\n\n\n-----\n\ne y U O C t t c a e bytes test\nHe takes the conditional jump and we are here:\n00401260 |> \\FF75 FC    PUSH DWORD PTR SS:[EBP-4]      ; /hObject = 00000054\n00401263 |. E8 E6070000  CALL 00401A4E            ; \\CloseHandle\n00401268 |. B8 01000000  MOV EAX,1\n0040126D |. C9      LEAVE\n0040126E \\. C2 0400    RETN 4\n\nIt closes the handle and returns to the \"core\" nothing was encoded inside the txt\nI think it doesn't crypt files under 10 bytes for win time, 10 bytes files are useless.\nAnd it needs to crypt datas as fast as possible.\nIt adds anyway to the files under 10 bytes the extension .ENCODED [iS THAT A BUG????]\n(A basic victim will think all is crypted right?)\nSo it will continue to proceed next files and finally after some attempt the 2nd thread start\n\n00401335 /$ FF35 92444000 PUSH DWORD PTR DS:[404492]     ; /Time = 0,\n0040133B |. E8 A4070000  CALL <JMP.&KERNEL32.Sleep>     ; \\KERNEL32.Sleep\n00401340 |. E8 0B000000  CALL 00401350\n00401345 |. C705 34304000 MOV DWORD PTR DS:[403034],1\n0040134F \\. C3      RETN\n00401350 /$ 55      PUSH EBP\n\nGpCode will create a TXT file on your desktop\nUsing SHGetSpecialFolderPathA api to find the desktop path.\n\nIt create and write inside a file called “HOW TO DECRYPT FILES.txt”\nThen it goes to a loop for the RSA key, and write it at the end of file (HOW TO DECRYPT FILES.txt)\n\n\n-----\n\nExample of file maked:\n\nAttention!!!\n\nAll your personal files (photo, documents, texts, databases, certificates, kwm-files, video) have been encrypted by a very strong cypher RSA1024. The original files are deleted. You can check this by yourself - just look for files in all folders.\n\nThere is no possibility to decrypt these files without a special decrypt program! Nobody can help you - even don't try to find another method or\ntell anybody. Also after n days all encrypted files will be completely deleted and you will have no chance to get it back.\n\nWe can help to solve this task for 120$ via wire transfer (bank transfer SWIFT/IBAN). And remember: any harmful or bad words to our side\nwill be a reason for ingoring your message and nothing will be done.\n\nFor details you have to send your request on this e-mail (attach to message a full serial key shown below in this 'how to..' file on desktop):\ndatafinder@fastmail.fm\n\n2334CC172CF6F6CCEA5F1090E2B2990FA2A933CD099B9295B0E3750A9CA26D89E18B2143E1899B761AE81C44DD164F6B36C81340A894\n\n6CE8BE3590ED19C04969F7C4FE074D0C3976788135781AE889A72FA349A8FF0AE749E26E77FC065D251C389115C4AA98D4C4554CA2FFE\n\nAfter it changes your wallpaper\n\nResource hacker:\n\nSearching the bitmap resource and drop it in %temp% folder with a random name.\nThen it calls an API to set it as wallpaper, with stretch option to fill your entire screen.\n\n\n-----\n\nDesktop:\n\nThen it continue to search for other files to crypt\nAnd now we know the dropped bitmap is the second blacklisted file.\n\nLet's follow this \"brndlog.txt\" located in:\nC:\\Documents and Settings\\Administrateur\\Application Data\\Microsoft\\Internet Explorer\nIt create a handle to the file with GENERIC_READ and use GetFileSize to check if we should encrypt it or not.\nAfter the size check, it use SetFilePointer Function to stores the file pointer in two LONG values\nThen it reads the file and store data in a buffer, then it calls CryptEncrypt on the data stored.\n\nAfter it writes the file (brndlog.txt) with new data.\n\n\n-----\n\nNow it returns to the core, to add the extention .ENCODED and proceed to the next file.\n\nOnce all drives are “crypted”, it quit the \"core\" and return to the \"main place\"\nIt will enter in two procedures and call an API to close the program\n\nThe first procedure:\n\nIt destroys the key and releases the handle of CSP\nSecond procedure:\n\n\n-----\n\nIt creates a file called \"ntfs_system.bat\" (in the same folder as the ransomware)\nwhich contains:\ndel \"C:\\Documents and Settings\\Administrateur\\Bureau\\1.exe\"\ndel %0\n\nAnd execute it, then it Calls the ExitPocess API to close the program\n\nAnd \"ntfs_system.bat\" will delete GpCode from our system\n\nAll your data are crypted with an executable of 25Kb and there is no possibility to recover them until paying the ransom...\nThe malware author claim on the txt file:\n\"after n days all encrypted files will be completely deleted and you will have no chance to get it back.\"\nLike we have see, there is absolutely nothing inside the code for do such action.\nIt says that just to scare users, pushing them into buying the 'special decrypt program'\nAlso, people who are not should be aware of the problem and should recognize GpCode from the first and second when the “warnings”\nappears on your screen.\nPushing Reset/Power button of your PC can save a significant amount of your valuable data\nAnd GpCode dont create a startup key so you can boot safe after an infection.\n\n**Conclusion: Backup your data from time to time in a safe place, and dont forget to unplug the storage device which contains these saved**\ndata.\n\nBonus, a tiny app useless who read the cfg file from gpcode :)\n\n.486\n.modelflat,stdcall\noptioncasemap:none; case sensitive\n\n\n-----\n\ninclude windows.inc\n\nuselib MACRO  libname\ninclude   libname.inc\nincludelib libname.lib\nENDM\n\nuselib user32\nuselib kernel32\n\nDlgProc   PROTO:DWORD,:DWORD,:DWORD,:DWORD\n\nIDC_OK     equ 1003\nIDC_IDCANCEL  equ 1004\ncfg       equ 1\n\n.data?\nhInstance    dd   ?  ;dd can be written as dword\nbuffer1 db9999dup(?)\nbuffer2 db9999dup(?)\nbuffer3 db256dup(?)\nbuffer4 db256dup(?)\nnSize dd   ?\npM dd   ?\n\n.code\nstart:\ninvoke GetModuleHandle, NULL\nmov hInstance,eax\ninvoke DialogBoxParam, hInstance,101,0,ADDR DlgProc,0\ninvoke ExitProcess,eax\n\nDlgProc proc  hWin  :DWORD,\nuMsg  :DWORD,\nwParam :DWORD,\nlParam :DWORD\n\n.if uMsg == WM_COMMAND\n.if wParam == IDC_OK\nINVOKE FindResource,0, cfg, RT_RCDATA\npush eax\nINVOKE SizeofResource,0, eax\nmov nSize, eax\npop eax\nINVOKE LoadResource,0, eax\nINVOKE LockResource, eax\nmov esi, eax\nmov eax, nSize\nadd eax, SIZEOF nSize\nINVOKE GlobalAlloc, GPTR, eax\nmov pM, eax\nmov ecx, nSize\nmov dword ptr [eax], ecx\nadd eax, SIZEOF nSize\nmov edi, eax\nrep movsb\nPUSH 55Dh\nPUSH eax\nPUSH offset buffer1\nCALL RtlMoveMemory\n\ninvoke FreeResource eax\n\n\n-----\n\no eb,o set bu e\nPUSH 10h\nPUSH ebx\nPUSH offset buffer2\nCALL RtlMoveMemory\nADD EBX,010h\nMOV EAX,nSize\nSUB EAX,010h\nPUSH EAX\nPUSH EBX\nCALL decrypt\nMOV AL,BYTE PTR DS:[EBX]\nMOV BYTE PTR DS:[buffer3],AL\nADD EBX,1\nMOV AL,BYTE PTR DS:[EBX]\nMOV BYTE PTR DS:[buffer3+1],AL\nADD EBX,1\nMOV EAX,DWORD PTR DS:[EBX]\nMOV DWORD PTR DS:[buffer3+2],EAX\nADD EBX,8\nMOV ECX,DWORD PTR DS:[EBX]\ninvoke SetDlgItemText,hWin,1002,ebx\npop esi\n.elseif wParam == IDC_IDCANCEL\ninvoke EndDialog,hWin,0\n.endif\n.elseif uMsg == WM_CLOSE\ninvoke EndDialog,hWin,0\n.endif\nxor eax,eax\nret\nDlgProc endp\ndecrypt proc\nPUSHAD\nMOV ESI,EBX\nMOV EDI,ESI\nXOR EDX,EDX\nMOV ECX,EAX\n@gpcode_00401755:\nCMP EDX,010h\nJNZ @gpcode_0040175C\nXOR EDX,EDX\n@gpcode_0040175C:\nLODS BYTE PTR DS:[ESI]\nXOR AL,BYTE PTR DS:[EDX+buffer2]\nSTOS BYTE PTR ES:[EDI]\nINC EDX\nDEC ECX\nJNZ @gpcode_00401755\nPOPAD\nRET\ndecrypt endp\nend start\n\nResource file:\n\n;This Resource Script was generated by WinAsm Studio.\n\n#define IDC_OK 1003\n#define IDC_CANCEL 1004\n\n1 RCDATA DISCARDABLE \"gpcode.data\";this is your cfg file ripped from GpCode\n\n101 DIALOGEX 0,0,294,170\nCAPTION \"GpCode...\"\n\n\n-----\n\nO 8, a o a\nSTYLE 0x80c80880\nEXSTYLE 0x00000000\nBEGIN\nCONTROL \"Read RC_DATA > cfg\",IDC_OK,\"Button\",0x10000001,3,135,287,14,0x00000000\nCONTROL \"Quit\",IDC_CANCEL,\"Button\",0x10000000,3,154,287,14,0x00000000\nCONTROL \"\",1002,\"Edit\",0x10200044,3,3,287,130,0x00000200\nEND\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2011/2011-01-30 - GpCode Ransomware 2010 Simple Analysis.pdf"
    ],
    "report_names": [
        "2011-01-30 - GpCode Ransomware 2010 Simple Analysis.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "2864e40a-f233-4618-ac61-b03760a41cbb",
            "created_at": "2023-12-01T02:02:34.272108Z",
            "updated_at": "2025-03-27T02:02:10.209072Z",
            "deleted_at": null,
            "main_name": "WildCard",
            "aliases": [],
            "source_name": "ETDA:WildCard",
            "tools": [
                "RustDown",
                "SysJoker"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e3767160-695d-4360-8b2e-d5274db3f7cd",
            "created_at": "2022-10-25T16:47:55.914348Z",
            "updated_at": "2025-03-27T02:05:17.411172Z",
            "deleted_at": null,
            "main_name": "IRON TWILIGHT",
            "aliases": [
                "ATK5 ",
                "Blue Athena ",
                "BlueDelta ",
                "FROZENLAKE ",
                "Fancy Bear ",
                "Fighting Ursa ",
                "Forest Blizzard ",
                "GRAPHITE ",
                "Group 74 ",
                "PawnStorm ",
                "STRONTIUM ",
                "Sednit ",
                "Snakemackerel ",
                "Sofacy ",
                "TG-4127 ",
                "Tsar Team ",
                "APT28 "
            ],
            "source_name": "Secureworks:IRON TWILIGHT",
            "tools": [
                " Downdelph",
                " Drovorub",
                " EVILTOSS",
                " HIDEDRV",
                " Headlace",
                " LoJack",
                " Powershell Empire",
                " SCONATO",
                " SEDUPLOADER",
                " SHARPFRONT",
                " Scaramouche",
                " Sedkit Exploit Kit",
                " Sofacy downloader",
                " X-Agent",
                " X-Tunnel",
                " Zebrocy",
                " reGeorg",
                "DEALERSCHOICE"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "730dfa6e-572d-473c-9267-ea1597d1a42b",
            "created_at": "2023-01-06T13:46:38.389985Z",
            "updated_at": "2025-03-27T02:00:02.821388Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "FROZENLAKE",
                "BlueDelta",
                "SNAKEMACKEREL",
                "TG-4127",
                "ITG05",
                "TA422",
                "Fancy Bear",
                "FANCY BEAR",
                "Sednit",
                "IRON TWILIGHT",
                "G0007",
                "Sofacy",
                "Forest Blizzard",
                "GruesomeLarch",
                "Pawn Storm",
                "Tsar Team",
                "STRONTIUM",
                "ATK5",
                "Blue Athena",
                "APT-C-20",
                "Group 74",
                "SIG40",
                "Grizzly Steppe",
                "Fighting Ursa",
                "T-APT-12",
                "UAC-0028"
            ],
            "source_name": "MISPGALAXY:APT28",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "ae320ed7-9a63-42ed-944b-44ada7313495",
            "created_at": "2022-10-25T15:50:23.671663Z",
            "updated_at": "2025-03-27T02:00:55.518748Z",
            "deleted_at": null,
            "main_name": "APT28",
            "aliases": [
                "APT28",
                "IRON TWILIGHT",
                "SNAKEMACKEREL",
                "Group 74",
                "Sednit",
                "Sofacy",
                "Pawn Storm",
                "Fancy Bear",
                "STRONTIUM",
                "Tsar Team",
                "Threat Group-4127",
                "TG-4127",
                "Forest Blizzard",
                "FROZENLAKE"
            ],
            "source_name": "MITRE:APT28",
            "tools": [
                "Wevtutil",
                "certutil",
                "Forfiles",
                "DealersChoice",
                "Mimikatz",
                "ADVSTORESHELL",
                "Komplex",
                "HIDEDRV",
                "JHUHUGIT",
                "Koadic",
                "Winexe",
                "XTunnel",
                "Drovorub",
                "CORESHELL",
                "OLDBAIT",
                "Downdelph",
                "XAgentOSX",
                "USBStealer",
                "Zebrocy",
                "Fysbis",
                "LoJax"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "256a6a2d-e8a2-4497-b399-628a7fad4b3e",
            "created_at": "2023-11-30T02:00:07.299845Z",
            "updated_at": "2025-03-27T02:00:03.257794Z",
            "deleted_at": null,
            "main_name": "WildCard",
            "aliases": [],
            "source_name": "MISPGALAXY:WildCard",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536200,
    "ts_updated_at": 1743041799,
    "ts_creation_date": 1653709205,
    "ts_modification_date": 1653709205,
    "files": {
        "pdf": "https://archive.orkl.eu/3f3cf1955409ce6485c4f4b82cd2c22124691e69.pdf",
        "text": "https://archive.orkl.eu/3f3cf1955409ce6485c4f4b82cd2c22124691e69.txt",
        "img": "https://archive.orkl.eu/3f3cf1955409ce6485c4f4b82cd2c22124691e69.jpg"
    }
}