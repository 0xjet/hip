{
    "id": "5421267b-08f5-48fc-85ef-33f016a3c4cf",
    "created_at": "2023-01-12T15:08:20.235957Z",
    "updated_at": "2025-03-27T02:05:23.478881Z",
    "deleted_at": null,
    "sha1_hash": "37532f3a1d423480d497201ee3dd526bfff58a90",
    "title": "2021-06-01 - Detecting Initial Access- HTML Smuggling and ISO Images — Part 2",
    "authors": "",
    "file_creation_date": "2022-05-28T00:27:56Z",
    "file_modification_date": "2022-05-28T00:27:56Z",
    "file_size": 267443,
    "plain_text": "# Detecting Initial Access: HTML Smuggling and ISO Images — Part 2\n\n**[mergene.medium.com/detecting-initial-access-html-smuggling-and-iso-images-part-2-f8dd600430e2](https://mergene.medium.com/detecting-initial-access-html-smuggling-and-iso-images-part-2-f8dd600430e2)**\n\nMehmet Ergene June 1, 2021\n\nIn the previous blog in this series, we extracted behavioral TTPs, prepared the attack\nemulation, and executed it.\n\n## Detecting Initial Access: HTML Smuggling and ISO Images — Part 1\n\n### This blog is a two-part series focusing on TTP extraction, Attack Emulation(Purple Teaming), Log Analysis, Threat…\n\nmergene.medium.com\n\nPhoto by on\n\n\n-----\n\nIt s time for analyzing the logs, validating/modifying the hypotheses that we generated after\nreading the report(or generating new ones), generating detection strategies, and developing\ndetections.\n\n## Analyzing the Logs\n\nI analyzed the Microsoft Defender for Endpoint logs, but you can check Sysmon or your EDR\nlogs. Although there can be other events generated during the attack, below are the most\nimportant ones for me to generate or validate hypotheses:\n\n## 1. Mounting an ISO image generates the below Registry event:\n\n 2. Opening the mounted image generates a file creation event:\n\nI mounted the ISO twice.\n\n## 3. Double-clicking the shortcut file generates the below process execution events:\n\n 4. Execution of the payload(BOOM.exe) generates a network connection event:\n\n\n-----\n\n## Validating/Modifying the Hypotheses\n\nI already generated some hypotheses after reading the report. Alternatively, you can\ngenerate your hypotheses after the emulation and analysis of the logs.\n\nI intentionally skipped some hypotheses as they were fragile. For example:\n\nOutlook creating an HTML file (can be bypassed with a .zip)\nrundll32 execution (can be replaced by another technique)\n\nTo me, generating as few hypotheses as possible with enough coverage to detect the attack\nis important(less is more + Pareto). If I can cover almost all possibilities with a few\nhypotheses, it will make my life easy.\n\nGoing back to the attack, since we have the folder name, we can use it for finalizing our\nhypotheses.\n\n## Final hypotheses\n\n1. ISO file creation is highly suspicious on non-IT users’ computers\n2. Process execution under a mounted drive can be highly suspicious\n3. Network connection from a process that runs under a mounted drive can be highly\n\nsuspicious\n\nWe need to check if these hypotheses generate hide fidelity results. To check the 2. and 3.\nhypotheses, we need to correlate the Registry event with process creation and network\nconnection events. This is possible if you can query logs and generate new fields.\n\nAfter analyzing the logs historically, I saw all three hypotheses were valid and would\ngenerate high fidelity results.\n\n## Creating Detections\n\n[I’ve created 3 queries for Microsoft Defender for Endpoint,](https://github.com/Cyb3r-Monk/Threat-Hunting-and-Detection/blob/main/Initial%20Access/Spearphishing%20Attachment%20-%20ISO%20Images(Microsoft%20Defender).md) 3 queries for Azure Sentinel\n(Sysmon) and published them in my GitHub repo. You can use the same logic on your own\ntool.\n\n## Cyb3r-Monk/Threat-Hunting-and-Detection\n\n### Repository for threat hunting and detection queries, tools, etc. - Cyb3r- Monk/Threat-Hunting-and-Detection\n\ngithub.com\n\n## Conclusion\n\n\n-----\n\nIn this post, I used a different approach for TTP extraction without fully using the MITRE\nATT&CK framework and wanted to show alternative ways of detecting attacks. I also wanted\nto show detecting Initial Access is still possible. I hope you stop assuming the breach and\nstart hunting/detecting initial access as an additional effort in your threat management\nprogram.\n\nI’ll keep posting blogs about initial access detection. Stay tuned…\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-06-01 - Detecting Initial Access- HTML Smuggling and ISO Images — Part 2.pdf"
    ],
    "report_names": [
        "2021-06-01 - Detecting Initial Access- HTML Smuggling and ISO Images — Part 2.pdf"
    ],
    "threat_actors": [
        {
            "id": "b72c2616-cc7c-4c47-a83d-6b7866b94746",
            "created_at": "2023-01-06T13:46:39.425297Z",
            "updated_at": "2025-03-27T02:00:03.08718Z",
            "deleted_at": null,
            "main_name": "Red Nue",
            "aliases": [
                "LuoYu"
            ],
            "source_name": "MISPGALAXY:Red Nue",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536100,
    "ts_updated_at": 1743041123,
    "ts_creation_date": 1653697676,
    "ts_modification_date": 1653697676,
    "files": {
        "pdf": "https://archive.orkl.eu/37532f3a1d423480d497201ee3dd526bfff58a90.pdf",
        "text": "https://archive.orkl.eu/37532f3a1d423480d497201ee3dd526bfff58a90.txt",
        "img": "https://archive.orkl.eu/37532f3a1d423480d497201ee3dd526bfff58a90.jpg"
    }
}