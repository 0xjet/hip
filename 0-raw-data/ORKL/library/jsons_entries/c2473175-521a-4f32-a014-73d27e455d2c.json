{
    "id": "c2473175-521a-4f32-a014-73d27e455d2c",
    "created_at": "2023-01-12T15:06:27.786522Z",
    "updated_at": "2025-03-27T02:16:17.27424Z",
    "deleted_at": null,
    "sha1_hash": "2fd9ee741a8d14da54206cb501e5c219031f5248",
    "title": "2022-04-04 - Elephant Framework Delivered in Phishing Attacks Against Ukrainian Organizations",
    "authors": "",
    "file_creation_date": "2022-05-28T03:49:49Z",
    "file_modification_date": "2022-05-28T03:49:49Z",
    "file_size": 1212245,
    "plain_text": "# Elephant Framework Delivered in Phishing Attacks Against Ukrainian Organizations\n\n**[intezer.com/blog/research/elephant-malware-targeting-ukrainian-orgs/](https://www.intezer.com/blog/research/elephant-malware-targeting-ukrainian-orgs/)**\n\nWritten by [Joakim Kennedy and](https://www.intezer.com/author/jkennedy/) [Nicole Fishbein - 4 April 2022](https://www.intezer.com/author/nicolefishbein/)\n\n### Get Free Account\n\nJoin Now\n\n\nApril 4, 2022\n\n\nA recently developed malware framework called Elephant is being delivered in targeted\nspear phishing campaigns using spoofed Ukrainian governmental email addresses. The\nfour malware components delivered are used for stealing credentials, documents, and to\nprovide remote access to the infected machine.\n\nTwo of these components were first reported on by the Computer Emergency Response\nTeam for Ukraine (CERT-UA) in March 2022. They named the two components GraphSteel\nand GrimPlant. When investigating these events, we have identified that Elephant has also\nbeen delivered via phishing emails from spoofed Ukrainian email addresses. Elephant is a\nmalware framework written in Go. The activity has been attributed to UAC-0056 (TA471,\nSaintBear, UNC2589) by CERT-UA.\n\n## Background\n\n\n-----\n\nOn March 12, the CERT-UA [published an alert on a threat about phishing emails sent on](https://cert.gov.ua/article/37704)\nbehalf of state bodies of Ukraine that urged the recievers to update the system by using a\nlink provided in the email. Once the user opens the link two files are downloaded, one is\nCobalt Strike Beacon the other is a dropper that will download and execute two additional\nfiles. These additional files are base64 encoded, the files saved as: “microsoft**cortana.exe” (classified as GraphSteel) and “oracle-java.exe” (GrimPlant backdoor). The**\nattack used Discord as a hosting server for the additional payload that was downloaded.\n\n[On March 15, SentinelOne found two more samples of the GraphSteel and GrimPlant](https://www.sentinelone.com/blog/threat-actor-uac-0056-targeting-ukraine-with-fake-translation-software/)\nmalware families. These samples written in Go were dropped by an executable that was\ndisguised as a translation application. The new samples are similar to those published by\nthe CERT-UA, both in the naming and the functionality.\n\n[On March 28, CERT-UA published another alert about phishing emails with an attached](https://cert.gov.ua/article/38374)\n“xls” file. The subject of the email and the file name are both “Wage arrear”. The attached\nfile had macros that, once executed, created a file called Base-Update.exe – a malware that\ndownloads and executes two other files classified as GraphSteel and GrimPlant by the\nCERT.\n\n## Phishing Email\n\nThe subject of the email: Заборгованість по зарплаті (arrears in wages).\nThe email was sent from zam@mdfi.gov.ua to ilenko@gng.com.ua.\nThe sender domain “mdfi.gov.ua” belongs to the Mykolayiv Regional Phytosanitary\nLaboratory.\nThe [receiver is the Head of Department of Technical Supply in OKKO Group, one of](https://uhmi.org.ua/eng/conf/entln/list_of_participants/#:~:text=ilenko%40gng.com.ua%20ilenko%40gng.com.ua%2028.%20vyacheslav%20petrovych%20tretyak%2C%20head%20of%20department%20of%20technical%20supply)\nthe largest filling stations in Ukraine, this person is in charge of the gas stations chain.\nBased on the headers of the email: the email was sent from 87.249.139.161 (hosting\nweb server located in Turkey).\n\n\n-----\n\n```\nReturn Path: <zam@mdfi.gov.ua>\nReceived: from hosting30.ukrnames.com (hosting30.ukrnames.com [217.182.197.11])\n  by mx-fm0.gng.com.ua with ESMTP id 22RJjl16017368-22RJjl18017368\n  (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=NO)\n  for <ilenko@gng.com.ua>; Sun, 27 Mar 2022 22:45:47 +0300\nReceived: from [87.249.139.161] (port=15731 helo=WIN3ISR1T95E6Qwwwtendawificom)\n  by hosting30.ukrnames.com with esmtpsa (TLS1.2) tls\nTLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\n  (Exim 4.95)\n  (envelope-from <zam@mdfi.gov.ua>)\n  id 1nYYot-00AQaf-Gj\n  for ilenko@gng.com.ua;\n  Sun, 27 Mar 2022 22:45:47 +0300\nMIME-Version: 1.0\nFrom: \"zam@mdfi.gov.ua\" <zam@mdfi.gov.ua>\nReply-To: zam@mdfi.gov.ua\nTo: ilenko@gng.com.ua\n...\nX-Mailer: Smart_Send_4_4_2\nDate: Sun, 27 Mar 2022 12:44:30 -0700\nMessage-ID: <127804766552081718123841@WIN-3ISR1T95E6Q>\nX-AntiAbuse: This header was added to track abuse, please include it with any abuse\nreport\nX-AntiAbuse: Primary Hostname - hosting30.ukrnames.com\nX-AntiAbuse: Original Domain - gng.com.ua\nX-AntiAbuse: Originator/Caller UID/GID - [47 12] / [47 12]\nX-AntiAbuse: Sender Address Domain - mdfi.gov.ua\nX-Get-Message-Sender-Via: hosting30.ukrnames.com: authenticated_id: zam@mdfi.gov.ua\nX-Authenticated-Sender: hosting30.ukrnames.com: zam@mdfi.gov.ua\nX-Source:\nX-Source-Args:\nX-Source-Dir:\nX-FE-Attachment-Name: =?UTF-8?B?x+Dh7vDj7uLg7bPx8vwg7+4g5+Dw7+vg8rMueGxz?=\nX-FEAS-SBL: 87.249.139.161 score 1\nX-FE-Policy-ID: 2:1:4:gng.com.ua\nX-FE-Orig-Env-Rcpt: ilenko@gng.com.ua\nX-FE-Orig-Env-From: zam@mdfi.gov.ua\nX-FEAS-Client-IP: 217.182.197.11\n\n```\nWhile reviewing the email’s transport path, we noticed that the domain “mdfi.gov.ua” did not\nhave a configured SPF record to prevent email spoofing. An SPF record is used to restrict\nwhich IP addresses are allowed to send emails for a specific domain. If this record is not\nset, any IP address is technically allowed to send emails using that domain name. Some\nemail providers do warn when they receive an email from an address that doesn’t have an\nSPF record. The screenshot below shows the warning message displayed in GMail when\nreading such email.\n\n\n-----\n\nOur theory is that the threat actor exploited this vulnerability to send spoofed phishing\nemails to their targets. We reported the issue to CERT-UA.\n\nWe [followed the sender IP address and found three other emails: two emails submitted on](https://www.virustotal.com/gui/ip-address/87.249.139.161/relations)\nMarch 29 from Ukraine targeting ICTV, a Ukrainian TV channel and the third email was\nsubmitted in February from Romania. The emails that target UA have the same subject and\nuse the same attached xls file that delivers the first malicious payload.\n\n## The Elephant Framework\n\nThe malware that is dropped by the phishing lure is the dropper component of what we call\nthe “Elephant Framework.” The framework consists of four components that work in\nunison. The code snippet below shows a reconstruction of the source code tree, bold\nindicating folders, showing how the different components have been organized. The\nlocation of the implant’s entrypoint is unknown and has been guessed to be in the root\nfolder. As there are also server components to the framework, we hypothesize that there\nare more folders for the two servers used by the framework.\n\n\n-----\n\n## Dropper Component\n\nWhile called the dropper in the framework, this component does not have an embedded\npayload. Instead it is technically a downloader that fetches the next stage called the\n“downloader.” The next stage is downloaded from the URL “hxxp://194.31.98.124:443/i”\nand saved to the user’s home directory (%HOME%/.java-sdk/java-sdk.exe). The next\nstage is executed with the command line flag “-a 0CyCcrhI/6B5wKE8XLOd+w==”, base64\nand AES encrypted information about the C2 server.\n\n## Downloader Component\n\n\n-----\n\nThe downloader acts as an orchestrator for the other components. In addition to\ndownloading the “client” and the “implant” components, it also sets up persistence and can\nperform updates. Like all the other components, before any malicious activity is taken it\nperforms some evasion techniques. The difference between this component and the others\n[is that this one is using code from the ColdFire project on GitHub. The screenshot below](https://github.com/redcode-labs/Coldfire)\nshows the malware using the “Wait” function to sleep for 10 seconds before allocating 200\nmb of garbage data.\n\nPersistence is established by adding a new key entry with the name “Java-3DK” to the\nregistry key “Software\\Microsoft\\Windows\\CurrentVersion\\Run”. After this, the malware\nchecks if a new binary exists by comparing its MD5 hash with a hash from the server. If no\nupdate is needed, it downloads the other two components.\n\nThe downloader has some 3rd party libraries, whose metadata are listed in the binary, that\nare not used. All the 3rd party libraries are listed in the code snippet below. In the list for\nexample “port-scanner”, “gopacket”, and “gateway” packages are not being used. These\nare all libraries to facilitate lateral movement. It is not clear if these are left-overs from an\nolder version of the malware or hints of future functionality.\n\n\n-----\n\n```\ngithub.com/anvie/port scanner  v0.0.0 20180225151059 8159197d3770\ngithub.com/dustin/go-humanize  v1.0.0\ngithub.com/fatih/color     v1.10.0\ngithub.com/google/gopacket   v1.1.19\ngithub.com/google/gopacket/layers v1.1.19\ngithub.com/google/gopacket/pcap v1.1.19\ngithub.com/jackpal/gateway   v1.0.7\ngithub.com/jcmturner/aescts   v2.0.0+incompatible\ngithub.com/mattn/go-colorable  v0.1.8\ngithub.com/mattn/go-isatty   v0.0.12\ngithub.com/minio/minio/pkg/disk v0.0.0-20210213070509-a94a9c37faf5\ngithub.com/mitchellh/go-ps   v1.0.0\ngithub.com/redcode-labs/ColdFire  v0.0.0-20210118141151-d4d62410b029\ngithub.com/savaki/jq      v0.0.0-20161209013833-0e6baecebbf8\ngithub.com/savaki/jq/scanner  v0.0.0-20161209013833-0e6baecebbf8\ngolang.org/x/sys/windows    v0.0.0-20210119212857-b64e53b001e4\ngolang.org/x/sys/windows/registry v0.0.0-20210119212857-b64e53b001e4\n\n```\n[Analysis of the Elephant downloader](https://analyze.intezer.com/files/8ffe7f2eeb0cbfbe158b77bbff3e0055d2ef7138f481b4fac8ade6bfb9b2b0a1)\n\n## Implant Component (GrimPlant)\n\nGrimPlant is a backdoor that allows the operator to execute arbitrary PowerShell scripts on\nthe infected machine. The backdoor has a relatively small set of functionality, for example it\ndoesn’t have any persistence functionality on its own. When the malware first is executed, it\nallocates 200 mb and sleeps for 10 seconds, the function shown in the screenshot below.\nThis is an anti-emulation technique that has been found in other malware written in Go.\n\n\n-----\n\nThe Command and Control (C2) address is not included in the binary. Instead it is passed in\nto the malware via the command line flag “-addr”. The address is not provided as a plain\nstring. Instead it has been encrypted with AES in Cipher-Block Chaining (CBC) mode. The\nmalware decrypts the string with the embedded key\n(f1d21960d8eb2fddf2538d29a5fd50b5f64a3f9bf06f2a3c4c950438c9a7f78e) and a null\nIV. The port used by the C2 server is hardcoded to port 80.\n\nGrimPlant communicates with the C2 server over gRPC. The communication is encrypted\nwith TLS. The malware has an embedded root certificate that it uses to verify that it talks to\na trusted server. The code snippet shows parts of the root certificate information. The\ncertificate used by the C2 server has been signed by this root certificate which allows the\nthreat actor to rotate the certificate without redeploying a new malware.\n\n\n-----\n\n```\nVersion: 3 (0x2)\n     Serial Number:\n          6d:56:93:aa:f3:9d:b1:f7:15:4e:39:64:77:9c:7e:d0:d4:cf:f6:3e\n     Signature Algorithm: sha256WithRSAEncryption\n     Issuer: C = FR, ST = Occitanie, L = Toulouse, O = O, OU = E, CN = *.a.com,\nemailAddress = a@mail.com\n     Validity\n          Not Before: Mar 20 15:21:06 2022 GMT\n          Not After : Mar 20 15:21:06 2023 GMT\n     Subject: C = FR, ST = Occitanie, L = Toulouse, O = O, OU = E, CN = *.a.com,\nemailAddress = a@mail.com\nSHA1 Fingerprint=DC:A9:5B:DC:F0:53:55:73:7A:A6:79:85:43:F6:3E:7C:23:07:36:33\n\n```\nThere are only a handful of gRPC “methods” supported by the malware. A reconstructed\nprotobuf specification is shown in the code snippet below. To identify which instance of the\nmalware is sending the request to the C2 server, the malware uses its machine ID as an\nunique identifier in the messages. When the malware first connects to the C2 server, it\nauthenticates itself with the password “sdrunlygvhwbcaeiuklgunvre”.\n\nAfter a successful authentication, it sends a heartbeat message every 10 seconds. This\nmessage includes information about the infected machine: public IP address, hostname,\nusername, etc. In addition to the heartbeat message, the malware starts the “command”\nloop that checks for new commands to execute every 3 seconds. If a command is received\nit executes it by spawning a PowerShell instance by executing\n“%windir%\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell.exe” and returns the\nresult to the C2 server.\n\n\n-----\n\n```\nservice Implant {\n     rpc FetchCommand(FetchCmdRequest) returns FetchCmdResponse {}\n     rpc Heartbeat(stream HeartbeatRequest) returns (stream Empty) {}\n     rpc Login(ImplantLoginRequest) returns ImplantLoginResponse {}\n     rpc SendCmdOutput(SendCmdRequest) returns SendCmdResponse {}\n}\nmessage FetchCmdRequest {\n     string id = 1;\n}\nmessage FetchCmdResponse {\n     string adminId = 1;\n     bytes cmdText = 2;\n}\nmessage HeartbeatRequest {\n     string id = 1;\n     bytes sysInfo = 2;\n}\nmessage ImplantLoginRequest {\n     string id = 1;\n     bytes sysInfo = 2;\n     string password = 3;\n}\nmessage ImplantLoginResponse {\n     string token = 1;\n}\nmessage SendCmdRequest {\n     string adminId = 1;\n     bytes output = 2;\n     bytes error = 3;\n}\nmessage SendCmdResponse {}\nmessage Empty {}\n\n## Client Component (GraphSteel)\n\n```\nThe “client” component is a credential and file stealer. It communicates with the C2 server\nover WebSockets to a GraphQL endpoint. All the messages are encrypted with AES. The\nkey is received from the C2 server. The malware author has written their own RSA\nimplementation for the key exchange that is used to receive the shared secret. All\nmessages prior to the key exchange, including the key exchange itself, are encrypted with\nAES using a hardcoded key.\n\n\n-----\n\n[The credentials on the machine are stolen using code lifted from goLazagne. In addition to](https://github.com/kerbyj/goLazagne)\nstealing credentials, the malware will look in the user’s “Documents”, “Downloads”,\n“Pictures”, and “Desktop” folder for files with the file-extensions listed in the snippet below.\n```\n.key, .crt, .json, .csv, .7z, .rar, .zip, .ssh, .ovpn, .pptx, .xlsx, .docx, .ppt,\n.xls, \n.doc, .txt\n\n```\nIf it finds a file with a matching file extension, it generates the MD5 hash for the file and\nchecks with the C2 server if the file has already been uploaded. If it hasn’t, the file is\nuploaded to the C2 server.\n\n## Infrastructure\n\nUsing the embedded CA certificate in the malware, we uncovered older service certificates\nand IP addresses. The oldest certificate we discovered had a validity date of “not before”\nDecember 9th, 2021. The IP address of the server where this certificate was served from is\nowned by the Russian hosting provider Zservers and still returned Elephant components as\nof April 2022. The components retrieved from the server are very similar to the samples\nused at the end of March. The other hosting providers used by the threat actor are PQ\n**Hosting and Serverion.**\n\nThe threat actor has chosen to sprinkle some French connections within their infrastructure.\nThe certificates use French location information and the domain name forkscenter[.]fr. We\n[don’t know if the decision to name it Elephant is a nod to Babar, an espionage software](https://www.gdatasoftware.com/blog/2015/02/24270-babar-espionage-software-finally-found-and-put-under-the-microscope)\nattributed to a French intelligence agency, or intended as a “false flag.”\n\n## Conclusion\n\nUAC-0056 (TA471, SaintBear, UNC2589) started using a new malware framework called\nElephant back in December 2021. The malware has been delivered in targeted spear\nphishing campaigns using spoofed Ukrainian governmental email addresses. The malware\nconsists of at least four different components that are used for stealing credentials,\ndocuments, and to provide remote access to the infected machine. The threat actor has\nopted to use multiple protocols for C2 communication, gRPC and GraphQL over\nwebsockets. This is an interesting choice as it complicates the development of the\nframework with more code to maintain.\n\n## Indicators of Compromise\n\n\n-----\n\n```\n194.31.98.124 C2 address used by the malware \n87.249.139.161 - IP address that was used for sending the emails\nIP addresses used in previous campaigns.\n91.242.229.35\n45.84.0.116\n80.66.76.187\nOriginal Email 3c2022fea48b52326f9eec4c1c84f10b\nxls  da305627acf63792acb02afaf83d94d1\nBase-update.exe 06124da5b4d6ef31dbfd7a6094fc52a6\nJava-sdk 36ff9ec87c458d6d76b2afbd5120dfae\noracle-java 4a5de4784a6005aa8a19fb0889f1947a\nMicrosoft-cortana 6b413beb61e46241481f556bb5cdb69c\nSamples from oldest server found\n8e0eb1742b47745ff73389673996e964\ncbc0e802b7134e1d02df1f2eb1b1d1e2\n628f41776ae3b2e8343eeb9cdcd019f2\nMore Emails linked to the same sender IP\nC7051e88ae43c1bd4b869cf18280ec5e\n40b42005e9cfc5ea2a7cfc1ced975cbb\nFbe3cb4dfce740c3728c459b853e4249 (email submitted and target Romania)\nPaths\n%HOME%\\AppData\\Local\\Temp\\Base-Update.exe\n%HOME%\\.java-sdk\n\n```\n**Joakim Kennedy**\nDr. Joakim Kennedy is a Security Researcher analyzing malware and tracking threat actors\non a daily basis. For the last few years, Joakim has been researching malware written in\nGo. To make the analysis easier he has written the Go Reverse Engineering Toolkit\n(github.com/goretk), an open-source toolkit for analysis of Go binaries.\n\n**Nicole Fishbein**\nNicole is a malware analyst and reverse engineer. Prior to Intezer she was an embedded\nresearcher in the Israel Defense Forces (IDF) Intelligence Corps.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-04 - Elephant Framework Delivered in Phishing Attacks Against Ukrainian Organizations.pdf"
    ],
    "report_names": [
        "2022-04-04 - Elephant Framework Delivered in Phishing Attacks Against Ukrainian Organizations.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "c28760b2-5ec6-42ad-852f-be00372a7ce4",
            "created_at": "2022-10-27T08:27:13.172734Z",
            "updated_at": "2025-03-27T02:00:55.511386Z",
            "deleted_at": null,
            "main_name": "Ember Bear",
            "aliases": [
                "Ember Bear",
                "UNC2589",
                "Bleeding Bear",
                "DEV-0586",
                "Cadet Blizzard",
                "Frozenvista",
                "UAC-0056"
            ],
            "source_name": "MITRE:Ember Bear",
            "tools": [
                "P.A.S. Webshell",
                "CrackMapExec",
                "ngrok",
                "WhisperGate",
                "Saint Bot",
                "PsExec",
                "Rclone",
                "Impacket",
                "OutSteel"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "083d63b2-3eee-42a8-b1bd-54e657a229e8",
            "created_at": "2022-10-25T16:07:24.143338Z",
            "updated_at": "2025-03-27T02:02:10.12138Z",
            "deleted_at": null,
            "main_name": "SaintBear",
            "aliases": [
                "Ember Bear",
                "FROZENVISTA",
                "Lorec53",
                "Nascent Ursa",
                "Nodaria",
                "SaintBear",
                "Storm-0587",
                "TA471",
                "UAC-0056",
                "UNC2589"
            ],
            "source_name": "ETDA:SaintBear",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "Elephant Client",
                "Elephant Implant",
                "GraphSteel",
                "Graphiron",
                "GrimPlant",
                "OutSteel",
                "Saint Bot",
                "SaintBot",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "eecf54a2-2deb-41e5-9857-fed94a53f858",
            "created_at": "2023-01-06T13:46:39.349959Z",
            "updated_at": "2025-03-27T02:00:03.057647Z",
            "deleted_at": null,
            "main_name": "SaintBear",
            "aliases": [
                "UAC-0056",
                "Nascent Ursa",
                "Nodaria",
                "FROZENVISTA",
                "Storm-0587",
                "Lorec53",
                "Lorec Bear",
                "UNC2589",
                "TA471",
                "DEV-0587",
                "Saint Bear",
                "EMBER BEAR",
                "Bleeding Bear"
            ],
            "source_name": "MISPGALAXY:SaintBear",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "03a6f362-cbab-4ce9-925d-306b8c937bf1",
            "created_at": "2024-11-01T02:00:52.635907Z",
            "updated_at": "2025-03-27T02:00:55.474243Z",
            "deleted_at": null,
            "main_name": "Saint Bear",
            "aliases": [
                "Saint Bear",
                "Storm-0587",
                "TA471",
                "UAC-0056",
                "Lorec53"
            ],
            "source_name": "MITRE:Saint Bear",
            "tools": [
                "OutSteel",
                "Saint Bot"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535987,
    "ts_updated_at": 1743041777,
    "ts_creation_date": 1653709789,
    "ts_modification_date": 1653709789,
    "files": {
        "pdf": "https://archive.orkl.eu/2fd9ee741a8d14da54206cb501e5c219031f5248.pdf",
        "text": "https://archive.orkl.eu/2fd9ee741a8d14da54206cb501e5c219031f5248.txt",
        "img": "https://archive.orkl.eu/2fd9ee741a8d14da54206cb501e5c219031f5248.jpg"
    }
}