{
    "id": "053ff9ca-7fb0-4fe0-b983-f4fdf356c451",
    "created_at": "2023-01-12T15:04:59.137178Z",
    "updated_at": "2025-03-27T02:06:05.363439Z",
    "deleted_at": null,
    "sha1_hash": "bd72a486091171af1853ffa501b94946003859f3",
    "title": "2021-10-27 - THREAT ALERT- Malicious Code Implant in the UAParser.js Library",
    "authors": "",
    "file_creation_date": "2022-05-28T18:27:16Z",
    "file_modification_date": "2022-05-28T18:27:16Z",
    "file_size": 1087041,
    "plain_text": "# THREAT ALERT: Malicious Code Implant in the UAParser.js Library\n\n**[cybereason.com/blog/threat-alert-malicious-code-implant-in-the-uaparser.js-library](https://www.cybereason.com/blog/threat-alert-malicious-code-implant-in-the-uaparser.js-library)**\n\nWritten By\nCybereason Global SOC Team\n\nOctober 27, 2021 | 3 minute read\n\n\n-----\n\nThe Cybereason Global Security Operations Center (SOC) issues Cybereason Threat Alerts\nto inform customers of emerging impacting threats. The Alerts summarize these threats and\nprovide practical recommendations for protecting against them.\n\n## Whatâ€™s Happening?\n\nThe [Cybereason GSOC Managed Detection and Response (MDR) Team is investigating a](https://www.cybereason.com/blog/authors/cybereason-global-soc-team)\nseries of recent infections that use a code that a malicious actor has implanted in\n[UAParser.js, a JavaScript library that parses User-Agent data. Users can install](https://github.com/faisalman/ua-parser-js)\n**UAParser.js on systems as an npm** [package using the npm JavaScript package manager.](https://www.npmjs.com/package/ua-parser-js)\nThe implanted malicious code deploys cryptocurrency-mining and information-stealing\nmalware on compromised systems.\n\n## Key Observations:\n\nA malicious actor has implanted code in the source code of the UAParser.js\nlibrary that is distributed as an npm software package. The malicious code\ndeploys cryptocurrency-mining and information-stealing malware on\ncompromised systems.\nThe number of systems compromised by users installing the malicious\n**UAParser.js** **npm package is not known at this time. The UAParser.js library is**\nvery popular, with over 7 million downloads per week.\nAll versions of the UAParser.js **npm package later than 0.7.28 at the time of the**\ndiscovery of the issue are affected. The latest version of the UAParser.js npm\npackage at the time of writing, 1.0.1, does not contain the implanted malicious\ncode.\n\n## Analysis\n\n[A malicious actor has compromised the npm account of a UAParser.js developer and has](https://github.com/faisalman/ua-parser-js/issues/536#issuecomment-949742904)\nimplanted malicious code in the source code of UAParser.js, which is distributed as an npm\nsoftware package. This means that users who install the compromised UAParser.js npm\npackage execute the implanted malicious code.\n\nThe implanted malicious code in the compromised UAParser.js npm package runs a script\nnamed preinstall.js:\n\n\n-----\n\n_The malicious code runs the preinstall.js script_\n\nThe preinstall.js script first determines the type of the operating system on which the script\nruns. The preinstall.js script runs a Windows Batch script named preinstall.bat on\nWindows systems, and runs a Linux Shell script named preinstall.sh on Linux systems:\n\n_preinstall.js runs preinstall.bat or preinstall.sh_\n\n\n-----\n\nThe preinstall.bat and preinstall.sh scripts download and execute malicious executables\nnamed jsextension.exe and jsextension, respectively, from an attacker-controlled endpoint\nwith an IP address of 159.148.186[.]228, located in Latvia. The jsextension(.exe)\nexecutables implement cryptocurrency-mining malware:\n\nOn Windows systems, the preinstall.bat script uses the curl, certutil or wget\nutility to download and execute jsextension.exe. The jsextension.exe\nexecutable is a Windows executable with a Secure Hash Algorithm (SHA)-256\nhash of\n[7f986cd3c946f274cdec73f80b84855a77bc2a3c765d68897fbc42835629a5d5.](https://www.virustotal.com/gui/file/7f986cd3c946f274cdec73f80b84855a77bc2a3c765d68897fbc42835629a5d5/details)\nOn Linux systems, the preinstall.sh script uses the curl or wget utility to\ndownload and execute jsextension. The jsextension executable is a Linux\nexecutable in Executable and Linkable Format (ELF), with a SHA-256 hash of\n[ea131cc5ccf6aa6544d6cb29cdb78130feed061d2097c6903215be1499464c2e.](https://www.virustotal.com/gui/file/ea131cc5ccf6aa6544d6cb29cdb78130feed061d2097c6903215be1499464c2e/details)\nNote that preinstall.sh downloads and executes jsextension only if the\ncompromised system is not located in Russia, Ukraine, Belarus, or Kazakhstan\n(country codes RU, UA, BY, and KZ, respectively):\n\n_preinstall.bat uses the curl, certutil or the wget utility to download jsextension.exe_\n\n### Windows Systems\n\nOn Windows systems, in addition to jsextension.exe, preinstall.bat downloads a malicious\nexecutable named create.dll from an attacker-controlled endpoint, citationsherbe[.]at,\nlocated in Russia. The create.dll executable is a Windows dynamic-link library (DLL) with a\nSHA-256 hash of\n**[bb8ccdcf17761f1e86d8ebbc1a12b123929c48c5eea4739b7619bd53728d412b. The](https://www.virustotal.com/gui/file/bb8ccdcf17761f1e86d8ebbc1a12b123929c48c5eea4739b7619bd53728d412b/details)**\n**create.dll file implements information-stealing malware.**\n\nAfter preinstall.bat downloads jsextension.exe and create.dll, it uses the tasklist\nWindows utility to determine whether jsextension.exe is already running on the\ncompromised system. If jsextension.exe is not running, preinstall.bat executes first\n**jsextension.exe and then create.dll by using the regsvr32.exe Windows utility:**\n\n\n-----\n\n_preinstall.bat executes jsextension.exe and create.dll_\n\n## Cybereason Recommendations\n\nCybereason recommends the following:\n\nDetermine whether users have installed a compromised UAParser.js npm\npackage on your systems. Update the UAParser.js library installed on your\nsystems to the latest version of the library.\nUse secure passwords, regularly rotate passwords, and use multi-factor\nauthentication where possible.\nThreat Hunting with Cybereason: The Cybereason MDR team provides its\ncustomers with custom hunting queries for detecting specific threats - to find out\n[more about threat hunting and Managed Detection and Response with the](https://www.cybereason.com/platform/managed-detection-response-mdr)\n[Cybereason Defense Platform, contact a Cybereason Defender here.](https://www.cybereason.com/services/managed-detection-response-mdr#form)\n\n[For Cybereason customers: More details available on the NEST including](https://nest.cybereason.com/knowledgebase/3501422)\ncustom threat hunting queries for detecting this threat.\n\n## About the Researchers:\n\n**Gal Romano, Senior Security Analyst, Cybereason Global SOC**\n\nGal Romano is a Senior Security Analyst with the Cybereason Global SOC (GSOC) team.\nHe is involved in malware analysis, mobile malware analysis, and threat hunting activities.\nGal was involved in several milestone projects in Cybereason, such as the SOC Extended\nDetection and Response (XDR) initiative.\n\n\n-----\n\n**Rotem Rostami, Security Analyst, Cybereason Global SOC**\n\nRotem Rostami is a Security Analyst with the Cybereason Global SOC (GSOC) team. She is\ninvolved in malware analysis activities and triages security incidents effectively and precisely.\nRotem has a deep understanding of the malicious operations prevalent in the current threat\nlandscape. Rotem has been working in the cybersecurity industry since 2018.\n\n**Aleksandar Milenkoski, Senior Threat and Malware Analyst,**\n\n**Cybereason Global SOC**\n\nAleksandar Milenkoski is a Senior Threat and Malware Analyst with the Cybereason Global\nSOC (GSOC) team. He is involved primarily in reverse engineering and threat research\nactivities. Aleksandar has a PhD in system security. Prior to Cybereason, his work focused\non research in intrusion detection and reverse engineering security mechanisms in the\nWindows 10 operating system.\n\n\n-----\n\nAbout the Author\n\n**Cybereason Global SOC Team**\n\nThe Cybereason Global SOC Team delivers 24/7 Managed Detection and Response\nservices to customers on every continent. Led by cybersecurity experts with experience\nworking for government, the military and multiple industry verticals, the Cybereason Global\nSOC Team continuously hunts for the most sophisticated and pervasive threats to support\nour mission to end cyberattacks on the endpoint, across the enterprise, and everywhere the\nbattle moves.\n\n[All Posts by Cybereason Global SOC Team](https://www.cybereason.com/blog/authors/cybereason-global-soc-team)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-10-27 - THREAT ALERT- Malicious Code Implant in the UAParser.js Library.pdf"
    ],
    "report_names": [
        "2021-10-27 - THREAT ALERT- Malicious Code Implant in the UAParser.js Library.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535899,
    "ts_updated_at": 1743041165,
    "ts_creation_date": 1653762436,
    "ts_modification_date": 1653762436,
    "files": {
        "pdf": "https://archive.orkl.eu/bd72a486091171af1853ffa501b94946003859f3.pdf",
        "text": "https://archive.orkl.eu/bd72a486091171af1853ffa501b94946003859f3.txt",
        "img": "https://archive.orkl.eu/bd72a486091171af1853ffa501b94946003859f3.jpg"
    }
}