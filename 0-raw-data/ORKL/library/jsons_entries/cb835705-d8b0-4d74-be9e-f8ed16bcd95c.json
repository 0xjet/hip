{
    "id": "cb835705-d8b0-4d74-be9e-f8ed16bcd95c",
    "created_at": "2022-10-25T16:48:15.104192Z",
    "updated_at": "2025-03-27T02:05:20.720555Z",
    "deleted_at": null,
    "sha1_hash": "a6c62ce04ae30424f380773023950d94455fc349",
    "title": "",
    "authors": "",
    "file_creation_date": "2017-11-03T09:32:37Z",
    "file_modification_date": "2017-11-03T09:32:37Z",
    "file_size": 255790,
    "plain_text": "### BadCyber\n\nMaking infosec journalism great again!\n\n## Technical analysis of recent attacks against Polish banks\n\n[badcyber](https://badcyber.com/author/badcyber/) / [February 16, 2017](https://badcyber.com/technical-analysis-of-recent-attacks-against-polish-banks/) / [Investigation, Malware](https://badcyber.com/category/investigation/) / [bank, malware,](https://badcyber.com/tag/bank/)\n\n[Poland](https://badcyber.com/tag/poland/)\n\n\n# 7\n**SHARES**\n\n\n Share  Tweet\n\n\nIt has been three weeks since �rst information about succesful attacks on Polish\n\nbanks has reached our ears. It’s time to put together the technical description of\n\nhow the attacks were performed.\n\n\n-----\n\nhacked by uknown attackers, the banks were super busy scanning internal\n\nnetworks and looking for intruders. Nobody bothered to write down the details\n\nof the infection process. Since then some companies tried to cover less or more\n\n[technical details of this attack. We’ve seen publications by Symantec, Booz Allen](https://www.symantec.com/connect/blogs/attackers-target-dozens-global-banks-new-malware-0)\n\nand [BAE Systems – we particulary recommend the latter, as in our opinion it](http://baesystemsai.blogspot.ru/2017/02/lazarus-watering-hole-attacks.html)\n\nincludes the most technically correct information con�rmed by multiple\n\nsources.\n\nIn this article we will try to cover the whole infection process – starting with a\n\nbank employee visiting the Polish Financial Supervision Authority website and\n\nending in his workstation being infected by a clever RAT. We will include only\n\none of the infection scenarios – we understand that there were others with less\n\nor more signi�cant di�erences.\n\n#### What happened in the browser\n\nTo start the infection process a bank employee had to visit the www.knf.gov.pl\n\nwebsite sometimes between October 5h, 2016 and February 2nd, 2017. Most\n\npages on this website included the following script:\n\n\nhttp://www.knf.gov.pl/DefaultDesign/Layouts/KNF2013/resources/accordiansrc.js?ver=11\n\n\nSomewhere next to the end of this �le an external script was included –\n\ndepending on the month it was either\n\n\nhttp://sap.misapor.ch/vishop/view.jsp?pagenum=1\n\n\nor\n\n\n-----\n\nAttackers’ controlled server performed some initial veri�cation of the visitor –\n\nmost probably based on IP whitelists including address classess deemeed\n\ninteresting by the attackers. Once the target was con�rmed as interesting, it\n\nreceived one of four exploits: cambio.xap �le attacking vulnerable Silverlight\n\nplugin:\n\n\n4cc10ab3f4ee6769e520694a10f611d5\n\n\nincluding a malicious DLL �le or cambio.swf �le attempting to exploit Flash\n\nplugin:\n\n\n6dffcfa68433f886b2e88fd984b4995a\n1f2cd85583a4a56b764ba6429c2155ec\n\n\nincluding three exploits: CVE-2015-8651, CVE-2016-1019 and CVE-2016-4117.\n\nExploits used in this attack were borrowed from commercial exploit packs. As far\n\nas we know at the moment of the attacks none of the exploited vulnerabilities\n\nwere considered a 0day.\n\nThe exploit call included a parameter pointing to a shellcode, which downloaded\n\n[a reconnaissance tool (described in the BAE article) from the same domain. The](http://baesystemsai.blogspot.ru/2017/02/lazarus-watering-hole-attacks.html)\n\ntools gathered some basic info about the machine and uploaded it back to its\n\nserver. If the analysis results were deemed interesting to the attackers, they\n\ncould manually trigger downloading another malicious component, served\n\nas perfmon.dat. It was an encrypted EXE �le, which was run on the target\n\nsystem after decryption.\n\n#### What happened in the workstation\n\nThere was an EXE\n\n\n-----\n\nbedceafa2109139c793cb158cec9fa48f980ff2b\n\n\nfound on one of the infected computers, which played the role of the installer\n\nfor the next malware stage. It is a simple commandline tool, with basic\n\ncapabilities, including\n\n\n-l : list of potential services which clould be used by malware\n-e [NAME] : unpacks DLL and CHM files under given NAME\n\n\nThe installer decrypts and saves two �les (depending on target architecture in\n\n32 or 64bit versions): a DLL �le protected with commercial Enigma packer and a\n\nCHM �le. The DLL �le can be named srservice.dll\n\n\ne29fe3c181ac9ddbb242688b151f3310\n\n\nand is installed as a service, while the CHM �le would be named srservice.chm\n\n\n9216b29114fb6713ef228370cbfe4045\n\n\nand saved in %WINDIR%\\Help folder. In reality the CHM �le is an encrypted\n\nDLL injected into the process. The service also decrypts the con�g\n\n�le srservice.hlp\n\n\n8e32fccd70cec634d13795bcb1da85ff\n\n\nFiles are encrypted using a [RC4 variant called Spritz.](https://www.schneier.com/blog/archives/2014/10/spritz_a_new_rc.html)\n\n\n-----\n\nlike C&C server – which they are not.\n\n\ntradeboard.mefound.com:443\nmovis-es.ignorelist.com:443\n\n\nIn an interesting plot twist the malware resolves those domains to their real IP\n\naddresses, but then performs a XOR operation on the original IPs to obtain\n\ntrue C&C IP addresses.\n\nThe service.chm �le is the �nal stage of this part of infection scenario – it’s a\n\nRAT connecting to the C&C and taking orders. Some of the 20-something\n\ncommands include:\n\nCMDL – execute command, write result to temporary �le, upload the �le to\n\nC&C and delete it\n\nDEL – remove �le\n\nDIE – turn o�\n\nDIR – search �les or folders\n\nDOWN – download and save �le\n\nDRIV – list logical drives\n\nGCFG – download current con�g\n\nPEEX – inject into explorer.exe\n\nPKIL – kill process\n\nPVEW – display information about running processes\n\nRUN – execute\n\nSCFG – get new con�g, encrypt it and save\n\nUPLD – upload �le to C&C\n\nWIPE – secure delete\n\nAnother piece of malware identi�ed during incident response was the fdsvc.exe\n\n�le\n\n\n9914075cc687bdc352ee136ac6579707\n\n\n-----\n\naccepts parameters pointing to a server it should connect to and the process it\n\nshould inject malicious code into. The injected �le was fdsvc.dll\n\n\n9cc6854bc5e217104734043c89dc4ff8\n\n\nwhich was also encrypted.\n\n#### Final thoughts\n\nOur anaysis is based on multiple sources, most of which come from foreign\n\ncompanies, as getting the information from Polish sources was a really hard\n\ntask. We would like to use this opportunity to thank all of our sources who were\n\nso kind to share their research results with us. We hope this publication will\n\nhelp to further the research into this incident.\n\n\n# 7\n**SHARES**\n\n\n Share  Tweet\n\n\n### 2 thoughts on “Technical analysis of recent attacks against Polish banks”\n\n**steve er**\n\nFebruary 17, 2017 at 4:54 pm\n\nDo you have the sample bedceafa2109139c793cb158cec9fa48f980�2b? if yes,\n\ncould you shared me?\n\n**steve er**\n\n\n-----\n\nThis sample 18a451d70f96a1335623b385f0993bcc have other C2, same campaign\n\n[Lazarus – Polish Malware]\n\nNetwork\n\n[http://120,113,173,207:8080/view.jsp?action=baseinfo&u=47335087295280](http://120%2C113%2C173%2C207:8080/view.jsp?action=baseinfo&u=47335087295280)\n\n[http://120,113,173,207:8080/view.jsp](http://120%2C113%2C173%2C207:8080/view.jsp)\n\nGathering information\n\ncmd.exe /c “hostname > %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “whoami >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “ver >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “ipcon�g -all >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “ping [http://www.google.com >> %TEMP%\\TMPE52E.tmp”](http://www.google.com/)\n\ncmd.exe /c “query user >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “net user >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “net view >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “net view /domain >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “reg query\n\n“HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings” >>\n\n%TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “tasklist /svc >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “netstat -ano | �nd “TCP” >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “wmic os get lastbootuptime >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “dir /od /a “%TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “dir /od /a “%TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “dir /od /a “%TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “dir /od /a “%PROGRAMFILES%\\ >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “dir /od /a “%PROGRAMFILES%\\ >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “dir /od /a “%s\\Desktop” >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “dir /od /a “%s\\Documents” >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe /c “dir /od /a “%s\\Favorites” >> %TEMP%\\TMPE52E.tmp”\n\ncmd.exe cmd /c “”%TEMP%\\tmp095j.bat”\n\n“C:\\18a451d70f96a1335623b385f0993bcc.exe”\n\n\n-----\n\n@echo o�\n\n:del1\n\ndel /a %1\n\nif exist %1 goto del1\n\ndel /a %0\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2017/2017.02.16.Technical_analysis_Polish_banks/Technical%20analysis%20of%20recent%20attacks%20against%20Polish%20banks%20%E2%80%93%20BadCyber.pdf"
    ],
    "report_names": [
        "Technical analysis of recent attacks against Polish banks – BadCyber"
    ],
    "threat_actors": [],
    "ts_created_at": 1666716495,
    "ts_updated_at": 1743041120,
    "ts_creation_date": 1509701557,
    "ts_modification_date": 1509701557,
    "files": {
        "pdf": "https://archive.orkl.eu/a6c62ce04ae30424f380773023950d94455fc349.pdf",
        "text": "https://archive.orkl.eu/a6c62ce04ae30424f380773023950d94455fc349.txt",
        "img": "https://archive.orkl.eu/a6c62ce04ae30424f380773023950d94455fc349.jpg"
    }
}