{
    "id": "06cee276-d2c2-4dda-9b07-e0934d6a0bae",
    "created_at": "2023-01-12T15:02:04.985202Z",
    "updated_at": "2025-03-27T02:13:57.22662Z",
    "deleted_at": null,
    "sha1_hash": "273fb82fb874953c949053226d0e63b37756d5c9",
    "title": "2022-03-13 - The hidden C2- Lampion trojan release 212 is on the rise and using a C2 server for two years",
    "authors": "",
    "file_creation_date": "2022-05-28T17:12:00Z",
    "file_modification_date": "2022-05-28T17:12:00Z",
    "file_size": 7081631,
    "plain_text": "# The hidden C2: Lampion trojan release 212 is on the rise and using a C2 server for two years\n\n**[securityaffairs.co/wordpress/128975/malware/hidden-c2-lampion-trojan-release-212.html](https://securityaffairs.co/wordpress/128975/malware/hidden-c2-lampion-trojan-release-212.html)**\n\nMarch 13, 2022\n\nMarch 13, 2022 By [Pierluigi Paganini](https://securityaffairs.co/wordpress/author/paganinip)\n\n## The hidden C2: Lampion trojan release 212 is on the rise and using a C2 server for two years.\n\nLampion trojan is one of the most active banking trojans impacting Portuguese Internet end\nusers since 2019. This piece of malware is known for the usage of the Portuguese Government\nFinance & Tax (Autoridade Tributária e Aduaneira) email templates to lure victims to install the\nmalicious loader (a VBS file). However, fake templates of banking organizations in Portugal\nhave been used by criminals to disseminate the threat in the wild, as observed in Figure 1\nbelow with a malicious PDF (151724540334 Pedidos.pdf).\n\n**_Figure 1: Emails templates are delivering malicious PDFs impersonating banking_**\n_organizations in Portugal to spread Lampion trojan._\n\n[The malware TTP and their capabilities remain the same observed in 2019, but the trojan](https://seguranca-informatica.pt/targeting-portugal-a-new-trojan-lampion-has-spread-using-template-emails-from-the-portuguese-government-finance-tax/#.YhpNzejP0Q8)\nloader – the VBS files – propagated along with the new campaign has significant differences.\nAlso, the C2 server is the same noticed on the past campaigns since 2020, suggesting, thus,\n\n\n-----\n\nthat criminals are using the same server geolocated in Russia for two years to orchestrate all\nthe malicious operations.\n\n**FUD capabilities of the Lampions’ VBS loader**\n\n**Filename: Comprovativo de pagamento_2866-XRNM_15-02-2022 06-43-54_28.vbs**\n**MD5: 2e295f9e683296d8d6b627a88ea34583**\n\nAs expected, the Lampions’ VBS loader has been changed in the last years, and its modus\n_[operandi is similar to other Brazilian trojans, such as Maxtrilha,](https://seguranca-informatica.pt/the-new-maxtrilha-trojan-is-being-disseminated-and-targeting-several-banks/#.YhpTNOjP0Q8)_ **[URSA,](https://seguranca-informatica.pt/threat-analysis-the-emergent-ursa-trojan-impacts-many-countries-using-a-sophisticated-loader/)** **[Grandoreiro, and so](https://seguranca-informatica.pt/the-updated-grandoreiro-malware-equipped-with-latenbot-c2-features-in-q2-2020-now-extended-to-portuguese-banks/#.YhpTU-jP0Q9)**\non. In detail, criminals are enlarging the file size around 56 MB of junk to bypass its detection in\ncontrast to the samples from 2019 with just 13.20 KB.\n\n**_Figure 2: Lampions’ VBS loader file enlarge technique to bypass its detection._**\n\nThe VBS file contains a lot of junk sequences, and after some rounds of code cleaning and\ndeobfuscation, 31.7 MB of useless lines of code were removed.\n\n\n-----\n\n-----\n\n-----\n\n**_Figure 3: Lampions’ VBS loader size before and after removing the junk sequences._**\n\nThe final file after the cleaning process has around 24.7 MB, and it is responsible for creating\nother files, including:\n\na 2nd VBS file with a random name (2nd_stage_vbs) that will download the Lampions’\nfinal stage – two DLLs from AWS S3 buckets\nother VBS file that will execute the previous file by using a scheduled task also created\nby the 1st VBS loader.\n\nThe next figure presents the structure of the Lampions’ VBS loader after the cleaning and\ndeobfuscation process.\n\n\n-----\n\n**_Figure 4: Lampion’s VBS loader after some rounds of deobfuscation._**\n\nAs mentioned, the 1st stage (Comprovativo de pagamento_2866-XRNM_15-02-2022 06-43**_54_28.vbs) creates a new VBS file (2nd_stage_vbs) inside_**\nthe %AppData%\\Local\\Temp folder with a random name (sznyetzkkg.vbs). Also, another\nVBS (jghfszcekwr.vbs) is created with code responsible for executing the previous VBS file\n(sznyetzkkg.vbs) via a scheduled task.\n\nA scheduled task is created with the service description and author Administrator user\nassociated. This scheduled task will execute the second VBS file jghfszcekwr.vbs that\ncontains instructions to finally run the sznyetzkkg.vbs file (the 2nd VBS stage).\n\n\n-----\n\n**_Figure 5: Creation of the 2nd VBS file and the auxiliary VBS file. Also, the scheduled task_**\n_responsible for creating the auxiliary VBS file is shown._\n\nAfter running the initial VBS file, the two additional VBS files are finally prepared to be\ntriggered. That task is then performed by the scheduled task as presented in Figure 6. The\nsource code of the jghfszcekwr.vbs file is quite simple and just executes the 2nd VBS file\n(sznyetzkkg.vbs). We believe this is just a procedure to make hard the malware analysis as\nwell as difficult its detection – something we confirmed during the analysis, as the AVs don’t\ndetect properly those files during the malware infection chain.\n\n\n-----\n\n**_Figure 6: Schedule task (1) responsible for executing an auxiliary VBS (2) file which in turn_**\n_runs the second VBS stage._\n\nAfter that, the VBS file dubbed sznyetzkkg.vbs is executed. All the steps highlighted in Figure\n7 are typically known from the last Lampions campaigns. This VBS file is quite similar to their\npredecessors, and it performs some tasks:\n\nDeletes all the files from the startup folder with the following extension: lnk, vbs, cmd,\n**_exe, bat and js._**\nDecrypts the URLs containing the final stage of Lampion trojan.\nCreates a .cmd file into the Windows startup folder to maintain persistence.\n\n\n-----\n\n**_Figure 7: Source-code of the 2nd VBS file and the encrypted URLs that will download the last_**\n_stage of the Lampion trojan banker._\n\nFrom this point, the modus operandi and TTP are the same observed since 2019. The clear\n[sign is the same algorithm used in 2019 to decrypt the hardcoded strings with the malicious](https://github.com/sirpedrotavares/SI-LAB-malware/blob/master/decryption-strings-lampion.vbs)\n[URLs was used. The script can be downloaded from GitHub here.](https://github.com/sirpedrotavares/SI-LAB-malware/blob/master/decryption-strings-lampion.vbs)\n\n\n-----\n\n**_Figure 8: Lampion trojan VBS decryptor._**\n\nAfter running the script, we obtained the malicious URLs that download the next stage of\nLampion trojan. Once again, the AWS S3 buckets were the criminals’ choice, as observed in\nthe last releases of this malware.\n\nThe first DLL (the trojan loader) is a point of interest in this analysis. This file was also enlarged\nwith lots of random BMP images inside – a well-known technique that is being used by Latin\n**American gangs in their malware. This is a clear sign of cooperation between the several**\ngroups.\n\nThe P-17-4 DLL is then renamed when downloaded and injected into the memory via the DLL\ninjection technique. The EAT function “mJ8Lf9v0GZnptOVNB2I” is triggered to start the DLL\nloader.C:\\Windows\\System32\\rundll32.dll\\”%AppData%\\Local\\Temp\\rand_folder\\random_name.dll”\nmJ8Lf9v0GZnptOVNB2I\n\n\n-----\n\n**_Figure 9: Lampion DLLs – release 212 (February 2022)._**\n\nThe main goal of the DLL loader is just to unzip the 2nd DLL called “soprateste.zip” which is\nprotected with a hardcoded password. All the process from this point is the same as the last\narticles we have published, namely:\n\n**Targeting Portugal: A new trojan ‘Lampion’ has spread using template emails from**\n**the Portuguese Government Finance & Tax – DECEMBER 2019**\n**[Lampion malware origin servers geolocated in Turkey, FEBRUARY 2020](https://seguranca-informatica.pt/lampion-malware-origin-servers-geolocated-in-turkey/#.YhqiBOjP0Q8)**\n**[Lampion malware v2 February 2020, FEBRUARY 2020](https://seguranca-informatica.pt/lampion-malware-v2-february-2020/#.YhqiB-jP0Q8)**\n**New release of Lampion trojan spreads in Portugal with some improvements on**\n**the VBS downloader, JULY 2020**\n**[Lampion trojan disseminated in Portugal using COVID-19 template, FEBRUARY](https://seguranca-informatica.pt/lampion-trojan-disseminated-in-portugal-using-covid-19-template/#.YhqhpOjP0Q8)**\n2021\n\n## Details of the Lampion release 212\n\nThe single task of the first DLL is just to unzip the 2nd one with a hardcoded password. As\nusual, the DLL inside soprateste.zip carries a message in Chinese for researchers:\n\n\n-----\n\n**_Figure 10: Message hardcoded inside the soprateste.zip DLL (the Lampion itself) and part of_**\n_the unzip process._\n\nAs usual, the trojan maintains intact its EAT since 2019. The call “DoThisBicht” is invoked\nfrom the DLL loader, and the malware starts its malicious activity. Figure 11 below shows the\ncomparison of the EAT between the different versions from 2019 to 2022, and no differences\nwere noticed.\n\n**_Figure 11: Export Address Table (EAT) from the DLL inside the soprateste.zip file (the_**\n_Lampion trojan itself)._\n\nThe target brands are the same observed in the past campaigns, with the focus on Brazilian\nand Portuguese banking organizations.\n\n\n-----\n\n```\n0x5106a0c (28): banco montepio\n0x5106a38 (16): montepio\n0x5106a6c (26): millenniumbcp\n0x5106aa8 (18): Santander\n0x5106ac8 (14): BPI Net\n0x5106ae4 (18): Banco BPI\n0x5106b18 (24): Caixadirecta\n0x5106b40 (42): Caixadirecta Empresas\n0x5106b8c (20): NOVO BANCO\n0x5106bc4 (14): EuroBic\n0x5106bfa (16): Credito Agricola\n0x5106c24 (20): Login Page\n0x5106c48 (22): CA Empresas\n0x5106c80 (18): Bankinter\n0x5106cb4 (20): ActivoBank\n0x5107118 (36): itauaplicativo.exe\n0x5109568 (14): TravaBB\n0x5109586 (32): Banco do Brasil\n0x51095b4 (16): Traazure\n0x51095d6 (32): Caixa Economica\n0x5109604 (20): Travsantos\n0x510962a (20): Santander\n0x510964c (14): Travsic\n0x510966a (14): Sicred\n0x5109688 (14): Travite\n0x51096c0 (18): Travdesco\n0x51096e2 (18): Bradesco\n0x5109704 (22): BANRITRAVAR\n0x510972a (18): Banrisul\n0x510974c (20): TravaBitco\n0x5109772 (32): Mercado Bitcoin\n0x51097a0 (14): Travcit\n0x51097be (18): Citibank\n0x51097e0 (18): Travorigs\n0x5109802 (30): Banco Original\n0x5109830 (18): SICTRAVAR\n0x5109852 (14): Sicoob\n\n```\nWhen started, the trojan collects information about the opened processes on the target\nmachine. If the title of the pages matches the hardcoded strings presented above, then it starts\nthe malicious overlay process that presents fake messages and windows impersonating the\ntarget bank to lure the victims.\n\n\n-----\n\n**_Figure 12:_** _[Lampion overlay screens (courtesy of MllenniumBCP – Portugal).](https://ind.millenniumbcp.pt/pt/Particulares/seguranca/Pages/avisos2019/aviso-2309.aspx)_\n\n\n-----\n\n**_Figure 13: Part of the hardcoded messages present on the Delphi forms that are exhibited_**\n_during the trojan execution._\n\nAs mentioned, Lampion is using the same C2 server geolocated in Russia at least for two\nyears. Figure 14 compares the Lampion release 207 – from 2020 – and the new release 212 –\nFebruary 2022. As presented, the server “5.188.9.28” has been used at least since 2020 by the\ncriminals’ gang in order to orchestrate all the operations\n\n\n-----\n\n**_Figure 14: Lampion is using the same C2 server observed in 2020 and gelocated in Russia._**\n\nInterestingly, the C2 server – a Windows machine – has the Microsoft RPC Endpoint Mapper\nservice exposed, which allows mapping some of the services running on the machine,\nassociated pipes, hostname, etc.\n\nThrough this information, it was possible to obtain the hostname of the remote machine: \\WIN**344VU98D3RU.**\n\nAfter a quick search, the hostname seems to have already been associated with other\nmalicious groups operating different types of malware, such as the bazaar (see the article\n[here), and also LockBit 2.0 ransomware (take a look here).](https://www.lemagit.fr/actualites/252510802/Ransomware-comment-la-franchise-LockBit-20-gonfle-artificiellement-ses-chiffres)\n\n\n-----\n\n**_Figure 15: IoCs related to the hostname used by Lampions C2 server (\\WIN-344VU98D3RU)._**\n\nAlthough it is not possible to confirm whether this is a hostname associated with other Cloud\nmachines and used by legitimate systems, it was possible to identify that there are machines\nspread all over the world with the same hostname, and in some situations, only a few\nmachines available per country.\n\nIn total, 81.503 machines were identified, with around 45k in The Netherlands, 25k in Russia,\n2.5k Turkey, 2K Ukraine, 1.5k in US, etc.\n\n\n-----\n\nThe complete list of hosts can be found below.\n\n\n-----\n\n## Final Thoughts\n\nNowadays, we are facing a growing of Brazilian trojans at a very high speed. Each one of them\nwith its peculiarities, TTPs, etc. With this in mind, criminals achieve a FUD condition that allows\nthem to avoid detection and impact a large number of users around the world.\n\nIn this sense, monitoring these types of IoCs is a crucial point now, as it is expected that in the\ncoming weeks or months new infections or waves can emerge.\n\nMitre Att&ck Matrix and Indicators of Compromise (IOCs) are available in the original post\npublished by the cybersecurity researchers Pedro Tavares:\n\nhttps://seguranca-informatica.pt/the-hidden-c2-lampion-trojan-release-212-is-on-the-rise-andusing-a-c2-server-for-two-years/#.Yi32dnrMK5d\n\n**About the author** **[Pedro Tavares:](https://twitter.com/sirpedrotavares)**\n\nPedro Tavares is a professional in the field of information security working as an Ethical\nHacker, Malware Analyst and also a Security Evangelist. He is also a founding member\nand Pentester at CSIRT.UBI and founder of the security computer blog seguranca–\ninformatica.pt.\n\n\n-----\n\n**[Pierluigi Paganini](http://www.linkedin.com/pub/pierluigi-paganini/b/742/559)**\n\n**[(SecurityAffairs –](http://securityaffairs.co/wordpress/)** **hacking, Lampion trojan)**\n\nShare On\n\nYou might also like\n\n**[Experts believe that Russian Gamaredon APT could fuel a new round of DDoS attacks](https://securityaffairs.co/wordpress/131762/apt/gamaredon-apt-ddos-attacks.html)**\n\n\n-----\n\nMay 28, 2022 By [Pierluigi Paganini](https://securityaffairs.co/wordpress/author/paganinip)\n\n**[The strange link between Industrial Spy and the Cuba ransomware operation](https://securityaffairs.co/wordpress/131754/cyber-crime/industrial-spy-cuba-ransomware.html)**\n\nMay 28, 2022 By [Pierluigi Paganini](https://securityaffairs.co/wordpress/author/paganinip)\n\nCopyright 2021 Security Affairs by Pierluigi Paganini All Right Reserved.\nBack to top\n\n[Home](http://securityaffairs.co/wordpress/)\n[Cyber Crime](https://securityaffairs.co/wordpress/category/cyber-crime)\n[Cyber warfare](https://securityaffairs.co/wordpress/category/cyber-warfare-2)\n[APT](https://securityaffairs.co/wordpress/category/apt)\n[Data Breach](https://securityaffairs.co/wordpress/category/data-breach)\n[Deep Web](https://securityaffairs.co/wordpress/category/deep-web)\n[Digital ID](https://securityaffairs.co/wordpress/category/digital-id)\n[Hacking](https://securityaffairs.co/wordpress/category/hacking)\n[Hacktivism](https://securityaffairs.co/wordpress/category/hacktivism)\n[Intelligence](https://securityaffairs.co/wordpress/category/intelligence)\n[Internet of Things](https://securityaffairs.co/wordpress/category/iot)\n[Laws and regulations](https://securityaffairs.co/wordpress/category/laws-and-regulations)\n[Malware](https://securityaffairs.co/wordpress/category/malware)\n[Mobile](https://securityaffairs.co/wordpress/category/mobile-2)\n[Reports](https://securityaffairs.co/wordpress/category/reports)\n[Security](https://securityaffairs.co/wordpress/category/security)\n[Social Networks](https://securityaffairs.co/wordpress/category/social-networks)\n[Terrorism](https://securityaffairs.co/wordpress/category/terrorism)\n[ICS-SCADA](https://securityaffairs.co/wordpress/category/ics-scada)\n[EXTENDED COOKIE POLICY](https://securityaffairs.co/wordpress/extended-cookie-policy)\n[Contact me](https://securityaffairs.co/wordpress/contact)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-03-13 - The hidden C2- Lampion trojan release 212 is on the rise and using a C2 server for two years.pdf"
    ],
    "report_names": [
        "2022-03-13 - The hidden C2- Lampion trojan release 212 is on the rise and using a C2 server for two years.pdf"
    ],
    "threat_actors": [
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "236a8303-bf12-4787-b6d0-549b44271a19",
            "created_at": "2024-06-04T02:03:07.966137Z",
            "updated_at": "2025-03-27T02:05:17.410356Z",
            "deleted_at": null,
            "main_name": "IRON TILDEN",
            "aliases": [
                "Aqua Blizzard ",
                "Armageddon",
                "Blue Otso ",
                "BlueAlpha ",
                "Dancing Salome ",
                "Gamaredon",
                "Gamaredon Group",
                "Hive0051 ",
                "Primitive Bear ",
                "Shuckworm ",
                "Trident Ursa ",
                "UAC-0010 ",
                "UNC530 ",
                "WinterFlounder ",
                "ACTINIUM "
            ],
            "source_name": "Secureworks:IRON TILDEN",
            "tools": [
                "Pterodo"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535724,
    "ts_updated_at": 1743041637,
    "ts_creation_date": 1653757920,
    "ts_modification_date": 1653757920,
    "files": {
        "pdf": "https://archive.orkl.eu/273fb82fb874953c949053226d0e63b37756d5c9.pdf",
        "text": "https://archive.orkl.eu/273fb82fb874953c949053226d0e63b37756d5c9.txt",
        "img": "https://archive.orkl.eu/273fb82fb874953c949053226d0e63b37756d5c9.jpg"
    }
}