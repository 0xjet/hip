{
    "id": "e72b56b9-0e1a-418f-b6e1-d6b7f0517c9b",
    "created_at": "2023-01-12T15:10:34.039185Z",
    "updated_at": "2025-03-27T02:09:29.146043Z",
    "deleted_at": null,
    "sha1_hash": "38e3170b3e87e1befa39259d312bec327402120e",
    "title": "2019-12-09 - Snatch ransomware reboots PCs into Safe Mode to bypass protection",
    "authors": "",
    "file_creation_date": "2022-05-27T21:51:16Z",
    "file_modification_date": "2022-05-27T21:51:16Z",
    "file_size": 3883151,
    "plain_text": "# Snatch ransomware reboots PCs into Safe Mode to bypass protection\n\n**[news.sophos.com/en-us/2019/12/09/snatch-ransomware-reboots-pcs-into-safe-mode-to-bypass-protection/](https://news.sophos.com/en-us/2019/12/09/snatch-ransomware-reboots-pcs-into-safe-mode-to-bypass-protection/)**\n\nAndrew Brandt December 9, 2019\n\nThe Sophos Managed Threat Response (MTR) team and SophosLabs researchers have\nbeen investigating an ongoing series of ransomware attacks in which the ransomware\nexecutable forces the Windows machine to reboot into Safe Mode before beginning the\nencryption process. The attackers may be using this technique to circumvent endpoint\nprotection, which often won’t run in Safe Mode.\n\nIn mid-October, the Sophos MTR team worked with a targeted organization to investigate\nand remediate a ransomware outbreak within their network. The ransomware, which calls\nitself Snatch, sets itself up as a service that will run during a Safe Mode boot. It quickly\nreboots the computer into Safe Mode, and in the rarefied Safe Mode environment, where\nmost software (including security software) doesn’t run, Snatch encrypts the victims’ hard\ndrives.\n\nSnatch runs itself in an elevated permissions mode, sets registry keys that instructs Windows\nto run it following a Safe Mode reboot, then reboots the computer and starts encrypting the\ndisk while it’s running in Safe Mode\n\n\n-----\n\nSophos analysts first encountered the Snatch ransomware about a year ago. The threat\nactor identities behind the ransomware appear to have been active since the summer of\n2018. SophosLabs believes that the Safe Mode enhancement to this malware is a newly\nadded feature.\n\nSophosLabs feels that the severity of the risk posed by ransomware which runs in Safe\nMode cannot be overstated, and that we needed to publish this information as a warning to\nthe rest of the security industry, as well as to end users. As we continue to investigate new\nincidents, we will update this post, and may post a followup in the next few days.\n\nWhat we refer to as Snatch malware comprises a collection of tooling, which include a\nransomware component and a separate data stealer, both apparently built by the criminals\nwho operate the malware; a Cobalt Strike reverse-shell; and several publicly-available tools\nthat aren’t inherently malicious, but used more conventionally by penetration testers, system\nadministrators, or technicians.\n\nOne of a growing number of malware families we’ve encountered that have been\nprogrammed in Go, Snatch does not appear to be multiplatform. Created by Google, Go was\ndesigned to be able to produce programs that, in theory, could run under multiple operating\nsystems.\n\nHowever, the malware we’ve observed isn’t capable of running on platforms other than\nWindows. Snatch can run on most common versions of Windows, from 7 through 10, in 32and 64-bit versions. The samples we’ve seen are also packed with the open source packer\nUPX to obfuscate their contents.\n\n## Snatch’s threat actors job postings\n\nThe threat actors behind this malware (who refer to themselves on criminal message boards\nas “Snatch Team”) appear to have adopted the active automated attack model, in which they\nseek to penetrate enterprise networks via automated brute-force attacks against vulnerable,\nexposed services, and then leverage that foothold to spread internally within the targeted\norganization’s network through human-directed action.\n\nOnline posts from criminal boards by suspected members of Snatch Team appear to support\nthe assertion that this is the attacker’s modus operandi. A user (who goes by the online\nmoniker BulletToothTony) soliciting assistance in this type of attack method, writing in a\n(translated from the original Russian language) message board posting titled “Snatch\nransomware” that he is “Looking for affiliate partners with access to\nRDP\\VNC\\TeamViewer\\WebShell\\SQL inj [SQL injection] in corporate networks, stores and\nother companies.”\n\n\n-----\n\nLater in the same message thread, this user offers to (at no charge) train others in the use of\nthe malware, allow prospective criminal partners to use their infrastructure, provide “the best\nstudents” with a customized server running Metasploit, and then says “we are looking for\ncapable people to join our team.”\n\nRussian speakers only, apparently. Спасибо, ты такой заботливый.\n\n\n-----\n\nThe threat actors have also innovated their crime in another important way: One piece of\nmalware used in the Snatch attacks is capable of, and has been, stealing vast amounts of\ninformation from the target organizations.\n\n## Deciphering the Snatch attack\n\nIn one of the incidents, which targeted a large international company, the MTR team\nmanaged to obtain detailed logs from the targeted company that the ransomware had not\nbeen able to encrypt. The attackers initially accessed the company’s internal network by\nbrute-forcing the password to an administrator’s account on a Microsoft Azure server, and\nwere able to log in to the server using Remote Desktop (RDP).\n\nUsing the Azure server as a foothold, the attackers leveraged that administrator’s account to\nlog into a domain controller (DC) machine on the same network, and then performed\nsurveillance tasks on the target’s network over the course of several weeks.\n\nThe attackers query the list of users authorized to log in on the box, and write the results to a\nfile. We also observed them dump WMIC system & user data, process lists, and even the\nmemory contents of the Windows LSASS service, to a file…\n\nUser information stolen by Snatch\n\nSnatch dumps lsass\n\nfrom memory then uploads the dump\n\n\n-----\n\n…then upload them to their C2 server.\n\nWe’ve also observed that the attackers set up one-off Windows services to orchestrate\nspecific tasks. These services have long randomized filenames, such as this one, which\nqueries the list of running processes from the tasklist program, outputs it to a file in the temp\ndirectory, then runs a batch file (also located in the temp directory) that uploads the tasklist\nfile to the C2 server.\n\nIn fact, it uses this same method to upload a lot of information to the C2 server. For instance,\nit uses this command to send the extracted user account and other profile information (the\n.txt file) back to the C2, and then executes a batch file it has created in the Windows temp\ndirectory.\n\nThe attackers installed surveillance software on about 200 machines, or roughly 5% of the\ncomputers on this particular organization’s internal network. The attackers installed several\nmalware executables; The first group of files appears to be designed to give the attackers\nremote access to the machines without having to rely on the compromised Azure server.\n\nThe attackers also installed a free Windows utility called Advanced Port Scanner and used\nthat tool to discover additional machines on the network they could target. Following this\nincident response, we were contacted by another company targeted by this same malware,\nand the investigation found a copy of Advanced Port Scanner on machines in that network,\ntoo.\n\n\n-----\n\nThe Update_Collector.exe tool is involved in exfiltration of stolen data\nSophos analysts also found a tool we suspect was also created by the malware authors\nnamed Update_Collector.exe; The tool takes the data that had been collected using WMI to\nlearn more about other machines and user accounts on the network, dumps that information\nto a file, and then uploads it to the attackers’ command-and-control server. We came across\ncopies on some of the compromised machines.\n\nWe also found a range of otherwise legitimate tools that have been adopted by criminals\n[installed on machines within the target’s network, including Process Hacker,](https://processhacker.sourceforge.io/) IObit\nUninstaller, [PowerTool, and](https://www.microsoft.com/en-us/p/power-tool/9nblggh0cfd6?activetab=pivot:overviewtab) [PsExec. The attackers typically use them to try to disable AV](https://docs.microsoft.com/en-us/sysinternals/downloads/psexec)\nproducts.\n\nSubsequent hunts for related files revealed several other attacks in which precisely the same\ncollection of tools was used in what appear to be opportunistic attacks against organizations\nlocated around the world, including the United States, Canada, and several European\ncountries. All the organizations where these same files were found also were later\ndiscovered to have one or more computers with RDP exposed to the internet. Many of the\ncomponents were found in the Downloads folder for an admin account on the infected\nsystem.\n\nAt some point during the attack, which may be several days to weeks after the initial network\nbreach, the attacker downloads the ransomware component to the targeted machine(s). This\ncomponent arrives on the system with a filename that includes the unique-to-each-victim\nfive-character code and the word “_pack.exe” in the filename.\n\n\n-----\n\nAs viewed through Sophos Central, the system is manipulated into downloading the\nransomware file to disk, then executes it using PSEXEC\nBy the time the malware invokes the PSEXEC service to execute the ransomware, it has\nextracted itself into the Windows folder with the same five-character code followed by\n**_unpack.exe.**\n\nThe “unpack” version\n\nends up in the Windows directory\n\n\n-----\n\nThe ransomware installs itself as a Windows service called SuperBackupMan. The service\ndescription text, “This service make backup copy every day,” might help camouflage this\nentry in the Services list, but there’s no time to look. This registry key is set immediately\nbefore the machine starts rebooting itself.\n\nThe SuperBackupMan service has properties that prevent it from being stopped or paused\nby the user while it’s running.\n\nThe malware then adds this key to the Windows registry so it will start up during a Safe\nMode boot.\n```\nHKLM\\SYSTEM\\CurrentControlSet\\Control\\SafeBoot\\Minimal\\SuperBackupMan:Default:Service\n\n```\nUsing the BCDEDIT tool on Windows, it issues a command that sets up windows operating\nsystem to boot in Safe Mode, and then immediately forces a reboot of the infected computer.\n\n\n-----\n\n```\nbcdedit.exe /set {current} safeboot minimal\nshutdown /r /f /t 00\n\n```\nWhen the computer comes back up after the reboot, this time in Safe Mode, the malware\nuses the Windows component net.exe to halt the SuperBackupMan service, and then uses\nthe Windows component vssadmin.exe to delete all the Volume Shadow Copies on the\nsystem, which prevents forensic recovery of the files encrypted by the ransomware.\n```\nnet stop SuperBackupMan\nvssadmin delete shadows /all /quiet\n\n```\nThe ransomware then begins encrypting documents on the infected machine’s local hard\ndrive.\n\n## The impact of Snatch\n\nThe ransomware appends a pseudorandom string of five alphanumeric characters to the\nencrypted files. This string appears both in the filename of (and hardcoded into) the\nransomware executable, and in the ransom note, and appears to be unique to each targeted\norganization. For example, if the ransomware is named abcdex64.exe, the encrypted files\nwould have the file extension .abcde appended to the original filename, and the ransom note\nuses a naming paradigm like README_ABCDE_FILES.txt or DECRYPT_ABCDE_DATA.txt\n\nThe attackers were foiled in their attempts to infect machines protected by Sophos endpoint\nproducts with the ransomware payloads, or to kill the Sophos endpoint protection services\nand processes on machines that were attacked. But others were not so lucky. We reached\nout to [Coveware, a company that specializes in extortion negotiations between ransomware](https://www.coveware.com/)\nvictims and attackers. The company tells us they have negotiated with the Snatch criminals\non 12 occasions between July and October on behalf of their clients. Ransom demands (in\nBitcoin) ranged in value from $2,000 to $35,000, but trended up over that four month period.\n\nAs with many other ransomware, Snatch maintains a list of files and folder locations it won’t\nencrypt. Ransomware typically does this to maintain system stability while focusing its\nattention on work documents or personal files. The locations it skips include:\n\n\n-----\n\n_C:\\_\n\n_windows_\n_recovery_\n_$recycle.bin_\n_perflogs_\n\n_C:\\ ProgramData_\n\n_start menu_\n_microsoft_\n_templates_\n_favorites_\n\n_C:\\Program Files\\_\n\n_windows_\n_perflogs_\n_$recycle.bin_\n_system volume information_\n_common files_\n_dvd maker_\n_internet explorer_\n_microsoft_\n_mozilla firefox_\n_reference assemblies_\n_tap-windows_\n_windows defender_\n_windows journal_\n_windows mail_\n_windows media player_\n_windows nt_\n_windows photo viewer_\n\n\n-----\n\nThe threat actors\n\napparently actively monitor the systems running their agents, as we discovered while an\nanalyst was manually running one of the samples from an instrumented, testbed computer.\n\nWhen the analyst was logged out unexpectedly, the analyst suspected that the attackers\nidentified the machine as a security research platform, so he wrote a message to the\nattackers and left it on the testbed’s desktop. Moments later, the attackers responded by\nlogging the analyst out of the machine again and then blocking the IP address being used by\nthe analyst from reconnecting to the Snatch C2 server.\n\nWe also\n\ndiscovered that the ransomware is using OpenPGP. The ransomware binaries we’ve\ninspected appear to have PGP Public Key blocks hardcoded into the files. (We’ve put those\nkeys into [the IoCs page for Snatch on the SophosLabs Github.)](https://github.com/sophoslabs/IoCs/blob/master/Ransomware-Snatch)\n\nAnd the name “Snatch” doesn’t appear to be a coincidence. In earlier versions of the\nransomware, the ransom note included an email address of\n“imBoristheBlade@protonmail.com” seems to be a reference to the Guy Ritchie movie\nSnatch (2000), in which a Rasputin-esque former-KGB agent character named Boris the\nBlade is beaten, shot, and stabbed throughout, often with little to no effect on his ability to get\nup and carry on fighting. Bullet Tooth Tony, the handle used by the message board poster, is\nanother character that appears in the same movie.\n\n## What can you do to prevent and detect a Snatch attack\n\n### Prevention\n\n\n-----\n\nAs we ve been urging organizations to do for a while now, Sophos recommends that\norganizations of any size refrain from exposing the Remote Desktop interface to the\nunprotected internet. Organizations that wish to permit remote access to machines\nshould put them behind a VPN on their network, so they cannot be reached by anyone\nwho does not have VPN credentials.\nThe Snatch attackers also expressed interest in contracting with, or hiring, criminals\nwho are capable of breaching networks using other types of remote access tools, such\nas VNC and TeamViewer, as well as those with experience using Web shells or\nbreaking in to SQL servers using SQL injection techniques. It stands to reason that\nthese types of internet-facing services also pose significant risks if left unattended.\nLikewise, organizations should immediately implement multifactor authentication for\nusers with administrative privileges, to make it more difficult for attackers to brute force\nthose account credentials.\nFor Sophos customers, it is imperative that all users are running the most current\nendpoint protection, and enable the CryptoGuard feature within Intercept X.\n\n### Detection\n\nThe majority of initial access and footholds that we have observed are on unprotected\nand unmonitored devices. It’s extremely important for organizations of almost any size\nto perform regular and thorough inventory of devices, to ensure no gaps or “dark\ncorners” exist on your network.\nExecution of the Snatch ransomware occurred after threat actors had several days of\nundetected and uninhibited access to the network. A rigorous and mature threat\nhunting program would have greater potential to identify the threat actors prior to the\nexecution of the ransomware executable.\n\n**Detection details**\n\nSophos products detect various components of Snatch and the files used in this attack under\nthe following signatures:\n\nTroj/Snatch-H\n\nMal/Generic-R\n\nTroj/Agent-BCYI\n\nTroj/Agent-BCYN\n\nHPmal/GoRnSm-A\n\nHPmal/RansMaz-A\n\nPUA Detected: ‘PsExec’\n\nAdditional detection methods include anomalous behavior detection in MTR and Intercept X.\n\n[Indicators of compromise have been published on the SophosLabs Github and will be](https://github.com/sophoslabs/IoCs/blob/master/Ransomware-Snatch)\nupdated as new indicators are discovered.\n\n\n-----\n\n**Acknowledgments**\n\nThanks to the following Sophos research and MTR incident response staff, whose work\ncontributed to this report:\n\nAlbert Zsigovits\nAndrew Ludgate\nAndrew O’Donnell\nHajnalka Kope\nJordan Rodgers\nLuca Nagy\nPeter Mackenzie\nSavio Lau\nSimon Porter\nSuriya Natarajan\nVikas Singh\nXiaochuan Zhang\nYannick Formaggio\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-12-09 - Snatch ransomware reboots PCs into Safe Mode to bypass protection.pdf"
    ],
    "report_names": [
        "2019-12-09 - Snatch ransomware reboots PCs into Safe Mode to bypass protection.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673536234,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653688276,
    "ts_modification_date": 1653688276,
    "files": {
        "pdf": "https://archive.orkl.eu/38e3170b3e87e1befa39259d312bec327402120e.pdf",
        "text": "https://archive.orkl.eu/38e3170b3e87e1befa39259d312bec327402120e.txt",
        "img": "https://archive.orkl.eu/38e3170b3e87e1befa39259d312bec327402120e.jpg"
    }
}