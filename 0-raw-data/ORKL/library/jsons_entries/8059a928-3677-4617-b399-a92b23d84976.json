{
    "id": "8059a928-3677-4617-b399-a92b23d84976",
    "created_at": "2023-01-12T15:10:17.387588Z",
    "updated_at": "2025-03-27T02:16:59.240981Z",
    "deleted_at": null,
    "sha1_hash": "1434e04e2cc7d34e8715bcb3cc2c77ee54aeea7f",
    "title": "2021-09-13 - FORCEDENTRY NSO Group iMessage Zero-Click Exploit Captured in the Wild (CVE-2021-30860)",
    "authors": "",
    "file_creation_date": "2022-05-28T15:40:53Z",
    "file_modification_date": "2022-05-28T15:40:53Z",
    "file_size": 198899,
    "plain_text": "# FORCEDENTRY NSO Group iMessage Zero-Click Exploit Captured in the Wild\n\n**[citizenlab.ca/2021/09/forcedentry-nso-group-imessage-zero-click-exploit-captured-in-the-wild/](https://citizenlab.ca/2021/09/forcedentry-nso-group-imessage-zero-click-exploit-captured-in-the-wild/)**\n\nSeptember 13, 2021\n\n[Research](https://citizenlab.ca/category/research/)\n\n\n-----\n\n[Targeted Threats](https://citizenlab.ca/category/research/targeted-threats/)\nBy [Bill Marczak,](https://citizenlab.ca/author/bmarczak/) [John Scott-Railton,](https://citizenlab.ca/author/jsrailton/) [Bahr Abdul Razzak,](https://citizenlab.ca/author/bahrabdulrazzak/) [Noura Al-Jizawi,](https://citizenlab.ca/author/noura/) [Siena Anstis,](https://citizenlab.ca/author/siena-anstis/)\n[Kristin Berdan, and](https://citizenlab.ca/author/kristin-berdan/) [Ron Deibert](https://citizenlab.ca/author/profd/)\nSeptember 13, 2021\n\n## Summary\n\nWhile analyzing the phone of a Saudi activist infected with NSO Group’s Pegasus\nspyware, we discovered a zero-day zero-click exploit against iMessage. The exploit,\nwhich we call FORCEDENTRY, targets Apple’s image rendering library, and was\neffective against Apple iOS, MacOS and WatchOS devices.\nWe determined that the mercenary spyware company NSO Group used the\nvulnerability to remotely exploit and infect the latest Apple devices with the Pegasus\nspyware. We believe that FORCEDENTRY has been in use since at least February\n2021.\nThe Citizen Lab disclosed the vulnerability and code to Apple, which has assigned the\n**_FORCEDENTRY vulnerability CVE-2021-30860 and describes the vulnerability as_**\n“processing a maliciously crafted PDF may lead to arbitrary code execution.”\n[Today, September 13th, Apple is releasing an update that patches CVE-2021-30860.](https://support.apple.com/en-ca/HT212807)\nWe urge readers to immediately update all Apple devices.\n\n**Devices affected by CVE-2021-30860 per Apple:**\n\nAll iPhones with iOS versions prior to 14.8, All Mac computers with operating system\nversions prior to OSX Big Sur 11.6, Security Update 2021-005 Catalina, and all Apple\nWatches prior to watchOS 7.6.2.\n\n## Discovery\n\n\n-----\n\nIn March 2021, we examined the phone of a Saudi activist who has chosen to remain\nanonymous, and determined that they had been hacked with NSO Group’s Pegasus\nspyware. During the course of the analysis we obtained an iTunes backup of the device.\n\nFigure 1: The GIF files we found on the phone.\nRecent re-analysis of the backup yielded several files with the “.gif” extension in\n**Library/SMS/Attachments that we determined were sent to the phone immediately before it**\nwas hacked with NSO Group’s Pegasus spyware.\n\n## Payload\n\nThe files were:\n\n27 copies of an identical file with the “.gif” extension. Despite the extension, the file was\nactually a 748-byte Adobe PSD file. Each copy of this file caused an\nIMTranscoderAgent crash on the device. These files each had random-looking tencharacter filenames.\nFour different files with the “.gif” extension that were actually Adobe PDF files\ncontaining a JBIG2-encoded stream. Two of these files had 34-character names, and\ntwo had 97-character names.\nThe output of the pdfid tool on these four “.gif” files was (NB: the stream had varying\nlength):\n\n\n-----\n\n```\nPDF Comment '%PDF-1.3\\n\\n'\nobj 1 0\n Type: /XRef\n Referencing:\n Contains stream\n << /Type /XRef /Size 9 /W [1 3 1] /Length ... /Filter [/FlateDecode /FlateDecode\n/JBIG2Decode] /DecodeParms >>\ntrailer\n << /Size 2 >>\nstartxref 10\nPDF Comment '%%EOF\\n'\n\n## Discovery and Disclosure\n\n```\n[Because the format of the files matched two types of crashes we had observed on another](https://citizenlab.ca/2021/08/bahrain-hacks-activists-with-nso-group-zero-click-iphone-exploits/)\nphone when it was hacked with Pegasus, we suspected that the “.gif” files might contain\nparts of what we are calling the FORCEDENTRY exploit chain.\n\nCitizen Lab forwarded the artifacts to Apple on Tuesday, September 7. On Monday,\nSeptember 13, Apple confirmed that the files included a zero-day exploit against iOS and\nMacOS. They designated the FORCEDENTRY exploit CVE-2021-30860, and describe it as\n“processing a maliciously crafted PDF may lead to arbitrary code execution.”\n\nThe exploit works by exploiting an integer overflow vulnerability in Apple’s image rendering\nlibrary (CoreGraphics). We are publishing limited technical information about CVE-202130860 at this time.\n\n## Attribution to NSO Group\n\nWe observed multiple distinctive elements that allowed us to make a high-confidence\nattribution to NSO Group:\n\nThe spyware installed by the FORCEDENTRY exploit exhibited a forensic artifact\nthat we call CASCADEFAIL, which is a bug whereby evidence is incompletely\ndeleted from the phone’s DataUsage.sqlite file. In CASCADEFAIL, an entry from\nthe file’s ZPROCESS table is deleted, but not entries in the ZLIVEUSAGE table\nthat refer to the deleted ZPROCESS entry. We have only ever seen this type of\nincomplete deletion associated with NSO Group’s Pegasus spyware, and we\nbelieve that the bug is distinctive enough to point back to NSO. The specific\nCASCADEFAIL artifact can be detected by\n\n\n-----\n\n```\nSELECT CASCADEFAIL FROM ZLIVEUSAGE WHERE ZLIVEUSAGE.ZHASPROCESS NOT IN (SELECT Z_PK\nFROM ZPROCESS);\n\n```\nThe spyware installed by the FORCEDENTRY exploit used multiple process names,\nincluding the name “setframed”. That process name was used in an attack with NSO\nGroup’s Pegasus spyware on an Al Jazeera journalist in July 2020. Notably, we did not\npublish that detail at the time.\n\n## Previous NSO Zero-Click Exploits\n\n**_FORCEDENTRY is the latest in a string of zero-click exploits linked to NSO Group. In 2019,_**\n[WhatsApp fixed CVE-2019-3568, a zero-click vulnerability in WhatsApp calling that NSO](https://www.facebook.com/security/advisories/cve-2019-3568)\nGroup used [against more than 1400 phones in a two-week period during which it was](https://www.theregister.com/2019/10/29/whatsapp_sue_nso_group/)\n[observed, and in 2020, NSO Group employed the KISMET zero-click iMessage exploit.](https://citizenlab.ca/2020/12/the-great-ipwn-journalists-hacked-with-suspected-nso-group-imessage-zero-click-exploit/)\n\nTo our knowledge, the KISMET vulnerability was never publicly identified, though we suspect\nthat the underlying vulnerability (if it still exists) can no longer be exploited via iMessage due\nto Apple’s introduction of the BlastDoor mitigation in iOS14. We suspect that NSO Group\ndeveloped FORCEDENTRY, which circumvents BlastDoor, in response to this mitigation.\n\n## Conclusion\n\nDespite promising their customers the utmost secrecy and confidentiality, NSO Group’s\nbusiness model contains the seeds of their ongoing unmasking. Selling technology to\ngovernments that will use the technology recklessly in violation of international human rights\nlaw ultimately facilitates discovery of the spyware by investigatory watchdog organizations,\n[as we and others have shown on multiple](https://forbiddenstories.org/case/the-pegasus-project/) [prior](https://citizenlab.ca/2020/12/the-great-ipwn-journalists-hacked-with-suspected-nso-group-imessage-zero-click-exploit/) [occasions, and as was the case again here.](https://citizenlab.ca/2016/08/million-dollar-dissident-iphone-zero-day-nso-group-uae/)\n\n[In 2016, we titled our report on the discovery of an iOS and MacOS Apple zero-day the](https://citizenlab.ca/2016/08/million-dollar-dissident-iphone-zero-day-nso-group-uae/)\n“Million Dollar Dissident.” The title was chosen to reflect the huge sums that autocratic\ngovernments are willing to pay to hack their critics. Mercenary spyware companies devote\nsubstantial resources to identifying software vulnerabilities on widely used applications and\nthen package those exploits to eager government clients, creating a highly lucrative but\nwidely abused commercial surveillance marketplace.\n\nOur latest discovery of yet another Apple zero day employed as part of NSO Group’s arsenal\nfurther illustrates that companies like NSO Group are facilitating “despotism-as-a-service” for\nunaccountable government security agencies. Regulation of this growing, highly profitable,\nand harmful marketplace is desperately needed.\n\nOur finding also highlights the paramount importance of securing popular messaging apps.\nUbiquitous chat apps have become a major target for the most sophisticated threat actors,\nincluding nation state espionage operations and the mercenary spyware companies that\n\n\n-----\n\nservice them. As presently engineered, many chat apps have become an irresistible soft\ntarget. Without intense engineering focus, we believe that they will continue to be heavily\ntargeted, and successfully exploited.\n\n## Acknowledgements\n\nWe thank the targets of Pegasus spyware that have allowed us to analyze their devices, with\na special thanks to the individual that worked with us on this case. It is thanks to them, and\ntheir bravery, that we were able to make this discovery.\n\nSpecial thanks to all at Apple for quick and responsive action.\n\nThanks to our Citizen Lab colleagues for feedback and editing.\n\nThanks to TNG.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-13 - FORCEDENTRY NSO Group iMessage Zero-Click Exploit Captured in the Wild (CVE-2021-30860).pdf"
    ],
    "report_names": [
        "2021-09-13 - FORCEDENTRY NSO Group iMessage Zero-Click Exploit Captured in the Wild (CVE-2021-30860).pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f9806b99-e392-46f1-9c13-885e376b239f",
            "created_at": "2023-01-06T13:46:39.431871Z",
            "updated_at": "2025-03-27T02:00:03.08926Z",
            "deleted_at": null,
            "main_name": "Watchdog",
            "aliases": [
                "Thief Libra"
            ],
            "source_name": "MISPGALAXY:Watchdog",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536217,
    "ts_updated_at": 1743041819,
    "ts_creation_date": 1653752453,
    "ts_modification_date": 1653752453,
    "files": {
        "pdf": "https://archive.orkl.eu/1434e04e2cc7d34e8715bcb3cc2c77ee54aeea7f.pdf",
        "text": "https://archive.orkl.eu/1434e04e2cc7d34e8715bcb3cc2c77ee54aeea7f.txt",
        "img": "https://archive.orkl.eu/1434e04e2cc7d34e8715bcb3cc2c77ee54aeea7f.jpg"
    }
}