{
    "id": "4e1c29b1-e6d7-4612-a970-09c1d17db4b4",
    "created_at": "2023-01-12T15:07:59.987377Z",
    "updated_at": "2025-03-27T02:09:18.501704Z",
    "deleted_at": null,
    "sha1_hash": "f33bb6567cf4a017ca0c529330feebcc985cf733",
    "title": "2021-09-21 - Cring ransomware group exploits ancient ColdFusion server",
    "authors": "",
    "file_creation_date": "2022-05-27T21:51:56Z",
    "file_modification_date": "2022-05-27T21:51:56Z",
    "file_size": 1265058,
    "plain_text": "# Cring ransomware group exploits ancient ColdFusion server\n\n**[news.sophos.com/en-us/2021/09/21/cring-ransomware-group-exploits-ancient-coldfusion-server/](https://news.sophos.com/en-us/2021/09/21/cring-ransomware-group-exploits-ancient-coldfusion-server/?cmp=30728)**\n\nAndrew Brandt September 21, 2021\n\nIn an attack recently investigated by Sophos, an unknown threat actor exploited an ancientin-internet-years vulnerability in an 11-year-old installation of Adobe ColdFusion 9 to take\ncontrol of the ColdFusion server remotely, then to execute ransomware known as Cring on\nthe server, and against other machines on the target’s network.\n\nWhile several other machines were “bricked” by the ransomware, the server hosting\nColdFusion was partially recoverable, and Sophos was able to pull evidence in the form of\nlogs and files from the machine.\n\nThe server running ColdFusion was running the Windows Server 2008 operating system,\nwhich Microsoft end-of-lifed in January, 2020. Adobe declared end-of-life for ColdFusion 9 in\n2016. As a result, neither the operating system nor the ColdFusion software could be\npatched. The incident serves as a stark reminder that IT administrators cannot leave out-ofdate critical business systems facing the public internet.\n\nDespite the age of the software and the server, the attacker used fairly sophisticated\ntechniques to conceal their files, inject code into memory, and cover their tracks by deleting\nlogs and other artifacts that could be used in an investigation.\n\n## Rapid break-in\n\n\n-----\n\nThe attack began over the Web. Logs from the server indicate that an attacker, using an\ninternet address assigned to Ukrainian ISP Green Floid, began scanning the target’s website\njust before 10am local time, using an automated tool to try to browse to more than 9000\npaths on the target’s website in just 76 seconds. The scans revealed that the web server was\nhosting valid files and URI paths specific to ColdFusion installations, such as /admin.cfm,\n/login.cfm, and /CFIDE/Administrator/.\n\nScans by the threat actor revealed they found these web server pages used by ColdFusion\nThree minutes later, the attacker took advantage of CVE-2010-2861, a directory traversal\nvulnerability in ColdFusion that permits a remote user to retrieve files from web server\ndirectories that aren’t supposed to be available to the public. In this case, they retrieved a file\ncalled password.properties from the server.\n\nNext, the attacker appears to have exploited another vulnerability in ColdFusion, CVE-20093960, which permits a remote attacker to inject data through an abuse of ColdFusion’s XML\nhandling protocols. This permitted the attacker to upload a file to the ColdFusion server by\nperforming an HTTP POST to the /flex2gateway/amf path on the server.\n\n\n-----\n\nThat file may have been this web shell code, designed to pass parameters directly to the\nWindows command shell, which was recovered from the server inside of a Cascading\nStylesheet (CSS) file.\n\n\n-----\n\nThe attacker wrote out the web shell, encoded in base64, from c:\\windows\\temp\\csa.log to\nE:\\cf9_final\\cfusion\\wwwroot\\CFIDE\\cfa.css.\n\n\n-----\n\nThey then attempted to use the web shell to load a Cobalt Strike beacon executable onto the\nserver.\n\nUsing the beacon, they afterward overwrote the file that contained the web shell, deliberately\nwriting garbled data over the files to hinder any future investigation.\n\n## Wait a while, then come back\n\nRoughly 62 hours later, just before midnight on a Saturday night/Sunday morning, the\nattackers returned.\n\nUsing the beacon to upload files and execute commands on the now-compromised server,\nthe attackers dropped several files into C:\\ProgramData\\{58AB9DC8-D2E9-170E-542F894CCE6D0282}\\ and then created a Scheduled Task that used the Windows Script Host\nwscript.exe to execute the file while passing it a hexadecimal-encoded set of parameters:\n\nThe parameters, decoded into plain text, look like this:\n\n\n-----\n\nThe -IsErIK function takes the command and captures an additional script, decrypts it, and\nthen runs the newly-downloaded script in memory. The simplicity of the persistent loader, and\nthe persistence mechanism itself (running as a scheduled task) points to a sophisticated\nlevel of operational security.\n\nA few hours later, they placed a second web shell in the ColdFusion /CFIDE/ directory\nnamed cfiut.cfm, which they then used to export a number of Registry hives, which they\nwrote out to files with a .png extension, and placed into a publicly-accessible location in the\nColdFusion web server path.\n\nThe hives they exported – HKLM\\SAM, HKLM\\Security, and HKLM\\System can be used to\nharvest credentials at the attacker’s leisure. The attacker could then browse to the file\nlocation and download the not-.PNG files, which they immediately did, then deleted using the\nweb shell.\n\nRoughly five hours later, the attackers returned, and used WMIC to invoke PowerShell to\ndownload a file named 01.css and 02.css from an IP address that geolocates to Belarus. The\nattackers also created a user account named agent$ with a password of P@ssw0rd, and\ngave it admin permissions.\n\nAfter another four-hour break, the attackers began executing commands that profiled the\nsystem, gave themselves Domain Admin privileges, and then executing remote commands\non other servers using those Domain Admin credentials, including dropping the Cobalt Strike\nbeacon onto other machines.\n\nOnce these behaviors began to get blocked by our security technologies, the attackers\ntargeted our products. While the attempt to load the beacon was stopped by Sophos, the\nattacker then turned their attention to using the web shell to execute commands that disabled\nboth the Sophos endpoint protection (the Tamper Protection setting was not enabled on this\nmachine) and Windows Defender.\n\n\n-----\n\nAfter disabling the Sophos protection, the attackers determined that the server was hosting a\nhypervisor, and discovered several VM disk files on the machine. They executed a command\nto halt and shut down the VMs.\n```\nC:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe Get-VM | % {Stop-VM $_ TurnOff}\n\n```\nFinally, at about 79 hours after the initial breach of the ColdFusion server, the attacker\ndelivered a ransomware executable named msp.exe ran, encrypting the system and the\nfolders containing the virtual machine disk images. The attackers deleted the Volume\nShadow Copies, cleared the Event Logs afterward, re-enabled the Sophos security products\nthey had previously disabled.\n\nThe ransom note appears on the Windows login screen, as a “message of the day” rather\nthan just as a text file on the desktop.\n\n## Detection and guidance\n\nSophos endpoint products will detect the ransomware executable (unique to this target) as\n**Troj/Ransom-GKG, the Cobalt Strike beacons as AMSI/Cobalt-A, the web shell as**\n**Troj/BckDr-RXU, and the PowerShell commands used to load the beacons will be detected**\nas Troj/PS-IM. Behavioral detections such as Exec_27a (Mitre ATT&CK T1059.001) and\n**Dynamic Shellcode Protection (HeapHeapProtect) intercept the majority of the malicious**\nactivities. As many of the components of the attack were fileless or specific to this particular\nvictim, SophosLabs will not be publishing additional IOCs relating to this incident.\n\n## Acknowledgments\n\n\n-----\n\nSophosLabs wishes to acknowledge the work of Senior Rapid Response analyst Vikas\nSingh, and of Labs analysts Shefali Gupta, Krisztián Diriczi, and Chaitanya Ghorpade for\ntheir help with analysis of the attack components.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-09-21 - Cring ransomware group exploits ancient ColdFusion server.pdf"
    ],
    "report_names": [
        "2021-09-21 - Cring ransomware group exploits ancient ColdFusion server.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536079,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1653688316,
    "ts_modification_date": 1653688316,
    "files": {
        "pdf": "https://archive.orkl.eu/f33bb6567cf4a017ca0c529330feebcc985cf733.pdf",
        "text": "https://archive.orkl.eu/f33bb6567cf4a017ca0c529330feebcc985cf733.txt",
        "img": "https://archive.orkl.eu/f33bb6567cf4a017ca0c529330feebcc985cf733.jpg"
    }
}