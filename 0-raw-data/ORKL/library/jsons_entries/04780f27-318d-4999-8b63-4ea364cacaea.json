{
    "id": "04780f27-318d-4999-8b63-4ea364cacaea",
    "created_at": "2022-10-25T16:48:14.412682Z",
    "updated_at": "2025-03-27T02:09:29.811295Z",
    "deleted_at": null,
    "sha1_hash": "049f9194540a72a890d5263243f107f3d4e04b88",
    "title": "Peering into spam botnets.",
    "authors": "",
    "file_creation_date": "2017-08-08T19:01:38Z",
    "file_modification_date": "2017-08-08T19:01:38Z",
    "file_size": 863065,
    "plain_text": "# Peering into spam botnets.\n\n### Jaroslaw Jedynak Maciej Kotowicz\n\n## 1 Intro\n\n  - Emotet[1]\n\n## 2 Emotet\n\n1its spamming module to be precise, and its newest version\n\n\n-----\n\nvery long name with lots of dashes[2]\n\n### 2.1 spam operation\n\n2Dhl_Status_zu_Sendung_340839262847_____ID_S01_DHL__DEM06_MS02_06_2015___A23_21_15.exe\n\n\n-----\n\n## 3 Kelihos\n\n### 3.1 Peer handshake\n\n\n-----\n\n-----\n\n### 3.2 Peer list exchange\n```\n while (it != strc.list.tail)\n\n```\n\n-----\n\n```\nreturn crypt;\nif (++strc->offset >= strc->str->length) strc->offset = 0;\n\n```\n\n-----\n\n## 4 Necurs\n\n\n-----\n\n### 4.1 High-level overview\n\n  - First, a couple of domains or raw IP addresses are embedded in the program\n\n\n-----\n\n-----\n\n### 4.2 Binary resources\n```\ndef get_base(dump):\n  for i in range(len(dump) - 0x10):\n    if (a * 0x48F1398FECF + 12345678901253) & 0xFFFFFFFFFFFFFFFF == b:\n      return i\nstruct resourceList {\nstruct singleResource {\ndef next_key(k):\n  return k\ndef decrypt_resources(dump):\n  for i in range(8):\n\n```\n\n-----\n\n```\n  for i in range(base + 0x18, len(dump)):\n  if compressed_size != real_size:\nwhile True:\n  if not id:\n    break\n\n### 4.3 DGA and P2P\ndef dga_mix_and_hash(param):\n\n```\n\n-----\n\n```\n  for i in range((param & 0x7F) + 21):\n  return param\ndef dga_generate_one(year, month, day, seed, rnd_param):\n  for i in range((mix % 15) + 7):\n  return domain + \".\" + [\nstruct outer_layer{\ndef rolling_xor(outer_layer):\n  for c in msg:\n\n```\n\n-----\n\n```\n  assert outer_layer.checksum == check\n  return buff\nstruct inner_layer {\nstruct greeting{\nstruct response{\n\n### 4.4 C&C communication\ndef xor_encrypt(outer_layer):\n  for c in outer_layer.data:\n\n```\n\n-----\n\n```\n  assert res == outer_layer.checksum\n  return buf\nstruct cc_structure{\nstruct cc_resource{\n\n```\n\n-----\n\n```\nstruct cc_resource_type_0 {\nstruct cc_resource_type_1 {\nstruct cc_resource_type_2 {\nstruct cc_resource_type_3 {\nstruct cc_resource_type_4 {\nstruct cc_resource_type_5 {\n\n```\n\n-----\n\n```\nstruct subresource{\n\n### 4.5 Spam module - communication\nstruct spam_wrap{\ndef encrypt(msg, key):\n  for c in msg:\n\n```\n\n-----\n\n```\nreturn res\ndef send_message(json):\n  return requests.post(dom, data=payload, timeout=30)\n\n```\n\n-----\n\n### 4.6 Proxy/DDoS module - communication\n\n\n-----\n\n### 4.7 Tracking\n\n## 5 Send-Safe\n\n\n-----\n\n### 5.1 Communication\n\n**5.1.1** **Configuration**\n\n**5.1.2** **Communication - UDP**\n\n\n-----\n\n```\nstruct req_s {\n  struct version {\nint __cdecl COMM::xor(_BYTE *a1, int size)\n for ( i = 0; i < size; ++i )\n return result;\n\n```\n\n-----\n\n**5.1.3** **Communication - HTTPS**\n\n  - 100 - email details, including subject, message body and how to impersonate\n\n\n-----\n\n```\nclass SFile(M):\n  def elem(self):\n    if flag & 0x10000:\n    else:\n    return flag,data\n  def parse(self):\n    for i in range(cnt):\n      yield self.elem()\n\n### 5.2 Email templates\n\n 5.3 Curious spamming habits\n\n## 6 Tofsee\n\n```\n\n-----\n\n-----\n\n### 6.1 Technical analysis\n```\ndef decrypt(s, key, inc):\n  for c in s:\n  return result\n\n 6.2 Communication protocol\n  for c in data:\nreturn dec, prev\nstruct greeting {\n\n```\n\n-----\n\n-----\n\n```\ndef xor_crypt(data, key_data):\n  for c in data:\n  return res\nstruct header {\nstruct botdata {\n\n```\n\n-----\n\n```\nstruct resource {\n\n### 6.3 Resources\n\n```\n\n-----\n\n**6.3.1** **Type 5**\n\n**6.3.2** **Type 11**\n\n**6.3.3** **Type 8**\n\n\n-----\n\n**6.3.4** **Type 23-40**\n```\ndef parse_config(payload):\n  return dict(chunks(payload.split('\\x00'), 2)[:-1])\n\n### 6.4 Tracking\n\n```\n\n-----\n\n## 7 Closing Words\n\n### 7.1 Acknowledgment\n\n## 8 Hashes (sha256)\n```\n0eb2eb8c5c21cfd6b89c1e14b3b66f869148f06fa0611ad3e7aa06e285a7e9c6 \n```\n\n-----\n\n## 9 References\n\n\n-----\n\n## 10 Appendices\n\n### 10.1 Kelihos encryption algorithms\n\n**10.1.1** **bitcrypt1**\n```\ndef bitstuff_enc(b):\n  for i in range(8):\n    if lobit != prevbit:\n    if i:\n  if b & 1 == 0:\n  return out & 0xFF\ndef bit1_enc(string):\n  return map_string(string, bitstuff_enc)\n\n```\n**10.1.2** **bitcrypt2**\n```\ndef bitstuff2_enc(chr):\n  for i in range(8):\n    if curbit == prevbit:\n    if mask:\n  return result >> 1\n\n```\n\n-----\n\n```\ndef bit2_enc(string):\n  return map_string(string, bitstuff2_enc)\n\n```\n**10.1.3** `mathops crypt`\n\n**10.1.4** **Full encryption routine**\n```\ndef decrypt_raw_data(data):\n\n```\n\n-----\n\n### 10.2 Send-Safe Email Template\n\n\n-----\n\n### 10.3 Tofsee Type 11 Script\n\n\n-----\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        }
    ],
    "references": [
        "https://lokalhost.pl/txt/peering.into.spam.botnets.VirusBulletin2017.pdf"
    ],
    "report_names": [
        "peering.into.spam.botnets.VirusBulletin2017.pdf"
    ],
    "threat_actors": [
        {
            "id": "b740943a-da51-4133-855b-df29822531ea",
            "created_at": "2022-10-25T15:50:23.604126Z",
            "updated_at": "2025-03-27T02:00:55.505366Z",
            "deleted_at": null,
            "main_name": "Equation",
            "aliases": [
                "Equation"
            ],
            "source_name": "MITRE:Equation",
            "tools": null,
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "67bf0462-41a3-4da5-b876-187e9ef7c375",
            "created_at": "2022-10-25T16:07:23.44832Z",
            "updated_at": "2025-03-27T02:02:09.806007Z",
            "deleted_at": null,
            "main_name": "Careto",
            "aliases": [
                "Careto",
                "The Mask",
                "Ugly Face"
            ],
            "source_name": "ETDA:Careto",
            "tools": [
                "Careto"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "1f6ae238-765f-4495-9d54-6a7883d7a319",
            "created_at": "2022-10-25T16:07:24.573456Z",
            "updated_at": "2025-03-27T02:02:10.284644Z",
            "deleted_at": null,
            "main_name": "TA511",
            "aliases": [
                "MAN1",
                "Moskalvzapoe"
            ],
            "source_name": "ETDA:TA511",
            "tools": [
                "Agentemis",
                "Chanitor",
                "Cobalt Strike",
                "CobaltStrike",
                "Ficker Stealer",
                "Hancitor",
                "NetSupport",
                "NetSupport Manager",
                "NetSupport Manager RAT",
                "NetSupport RAT",
                "NetSupportManager RAT",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "542cf9d0-9c68-428c-aff8-81b6f59dc985",
            "created_at": "2023-02-15T02:01:49.554105Z",
            "updated_at": "2025-03-27T02:00:03.110991Z",
            "deleted_at": null,
            "main_name": "Moskalvzapoe",
            "aliases": [
                "MAN1",
                "TA511"
            ],
            "source_name": "MISPGALAXY:Moskalvzapoe",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1666716494,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1502218898,
    "ts_modification_date": 1502218898,
    "files": {
        "pdf": "https://archive.orkl.eu/049f9194540a72a890d5263243f107f3d4e04b88.pdf",
        "text": "https://archive.orkl.eu/049f9194540a72a890d5263243f107f3d4e04b88.txt",
        "img": "https://archive.orkl.eu/049f9194540a72a890d5263243f107f3d4e04b88.jpg"
    }
}