{
    "id": "828adc13-d1f8-48ea-b673-d4a78b2f81ba",
    "created_at": "2023-01-12T15:08:23.817925Z",
    "updated_at": "2025-03-27T02:06:12.661421Z",
    "deleted_at": null,
    "sha1_hash": "aa377e6b5d128d7a06572fea2105e0ad5d579455",
    "title": "2018-06-29 - BackSwap Defrauds Online Banking Customers Using Hidden Input Fields",
    "authors": "",
    "file_creation_date": "2022-05-27T22:54:58Z",
    "file_modification_date": "2022-05-27T22:54:58Z",
    "file_size": 915689,
    "plain_text": "# BackSwap Defrauds Online Banking Customers Using Hidden Input Fields\n\n**[f5.com/labs/articles/threat-intelligence/backswap-defrauds-online-banking-customers-using-hidden-input-fi](https://www.f5.com/labs/articles/threat-intelligence/backswap-defrauds-online-banking-customers-using-hidden-input-fi)**\n\nbyline June 29, 2018\n\nBackSwap is new banking malware recently discovered by Eset1 and later analyzed by\nCERT Polska. 2 Unlike previous banking trojans, which typically either intercept requests and\nredirect users to fake banking websites or inject malicious code from command and control\n(C&C) servers to manipulate browser processes, BackSwap keeps its campaign locally. The\nJavaScript is hardcoded and pulled from the portable executable (PE) file resource section.\nBackSwap manipulates the document object model (DOM) elements by duplicating the\noriginal input fields during an unsuspecting user’s legitimate interaction with a banking\nwebsite.\n\n\nDuring our daily analysis of malware samples, we’ve noticed BackSwap has started to\nupdate its JavaScript core injection sample using various methods. Since the latest reports\non this malware, BackSwap has changed the names of resource sections, which are used to\nrepresent targeted bank names, and it has changed its handing of the International Bank\nAccount Number (IBAN).\n\n## Injected JavaScript Analysis\n\nIn the following analysis, we explain BackSwap’s actual fraud action and the user experience\nduring a transaction session.\n\n\n-----\n\nThe main purpose of the approximately 300 lines of JavaScript code is to create fake input\nfields that are visible to the victim and are identical to the original fields. Although users think\nthey’re filling in the real fields, these fake input fields aren’t sent in the final submission.\nInstead, the original fields, which are hidden from display to the user (using “display:none”),\nare filled with the fraudster’s account information. Unfortunately, it is this information that is\nsubmitted.\n\nFigure 1: Fake input fields hidden from users\n\n**_Figure 1: Fake input fields hidden from users_**\n\nFigures 2 and 3 illustrate how legitimate elements are hidden from the user by with malicious\ncontent.\n\nFigure 2: BackSwap hiding legitimate elements with malicious content\n\n_Figure 2: BackSwap hiding legitimate elements with malicious content_\n\n\n-----\n\nFigure 3. BackSwap revealing hidden input fields\n\n_Figure 3. BackSwap revealing hidden input fields_\n\nAs shown in Figure 4, the code is injected in the format of IIFE, “Immediately Invoked\nFunction Expression.” This has the advantage of staying out of global scope, hence making it\nharder to find its variables and functions after its invocation.\n\nFigure 4. BackSwap JavaScript injection in the format of IIFE\n\n_Figure 4. BackSwap JavaScript injection in the format of IIFE_\n\n\n-----\n\nThe mainStart function is in charge of hiding the original 26-character IBAN with the\naccount owner’s name. It’s executed every 50 seconds with a setInterval.\n\nThe process of duplicating legitimate inputs begins with the method “cloneNode” that copies\nthe nodes to be cloned with the entire element hierarchy. This process happens twice; the\nfirst time for the IBAN of the consignee, and the second time for the full name and address of\nthe consignee.\n\nFigure 5. BackSwap mainStart function\n\n_Figure 5. BackSwap mainStart function_\n\nAn important and crucial part of creating the fake DOM elements involves removing some\neminent attributes, such as names, from the visible cloned fake elements. Those elements’\nIDs are modified to a random string (some samples we examined had hardcoded strings).\n\nEventually, all these DOM modifications guarantee that the original data intended to be sent\nby the victim is not sent.\n\nFigure 6. BackSwap fake elements modifications\n\n_Figure 6. BackSwap fake elements modifications_\n\nFor safety reasons, the clipboard in modern browsers isn’t accessible to client JavaScript\nwithout user interaction. BackSwap reaches the clipboard via a click event on the window.\nThen, it self-executes “cut” or “copy” events with document.execCommand() (IE9+ supports\nclipboard interaction).\n\n\n-----\n\nFigure 7. “Cut” or “copy” events with document.execCommand\n\n_Figure 7. “Cut” or “copy” events with document.execCommand_\n\nAfter the execution mention above, via a listener of “cut” and “copy”, BackSwap has access\nto ClipboardEvent.clipboardData property via this original programmatic technique.\n\nFigure 8. BackSwap clipboard manipulation and example of what the user sees\n\n_Figure 8. BackSwap clipboard manipulation and example of what the user sees_\n\nWhile accessing this property, BackSwap’s authors change the tab’s title with information\ngathered from this malicious transaction. The format is a type of key-value that is typically a\nshort string and most often, just one letter. The key and value are separated by a colon. It\nincludes the amount (“_kwota”), the real username (\"nav-user__region-name\"), and the mule\nowner’s name (“myname”).\n\nFigure 9. BackSwap Tab Title change\n\n\n-----\n\n_Figure 9. BackSwap Tab Title change_\n\n## Resource and Script Changes\n\nBackSwap maintains its fraud actions in the PE resource section. We gathered several old\nand new samples of the malware and noticed interesting cosmetic changes between them.\nFor example, the target names have been changed. We assume this might be because of\nthe immediate validation of a target list by researchers. Figures 7 and 8 show the resource\nsection with visible target lists.\n\nFigure 10. Older version of BackSwap showing resource section with visible target list\n\n_Figure 10. Older version of BackSwap showing resource section with visible target list_\n\nThe newer version of the malware contains the JavaScript in the resource section. The\nactual target list is the same, but the represented names have changed.\n\n\n-----\n\nFigure 11. BackSwap resource section with un-meaningful target list names\n\n_Figure 11. BackSwap resource section with un-meaningful target list names_\n\nIn addition, fraudster-related IBAN information is handled differently. In the older samples,\nthe IBAN was found in plain text in the injected script.\n\nFigure 12. IBAN handling in BackSwap old version: IBAN is shown in clear text\n\n_Figure 12. IBAN handling in BackSwap old version: IBAN is shown in clear text_\n\nIn newer versions, the IBAN is passed through a switch case function.\n\nFigure 13. IBAN handling in BackSwap new version: IBAN is hidden\n\n_Figure 13. IBAN handling in BackSwap new version: IBAN is hidden_\n\nFraudster IBAN handling is passed through a function named ‘dede(str)’. In return, the dede\nfunction utilizes a For loop, which passes the string content into chars, dealing with them\nseparately on a switch case to create the fraudster-related IBAN.\n\n\n-----\n\nFigure 14. BackSwap switch case function\n\n_Figure 14. BackSwap switch case function_\n\n## Conclusion\n\n\n-----\n\nBackSwap s manipulation of the DOM elements by duplicating the original input fields during\na legitimate user interaction with a banking website is an original fraud method. Not many\nmalware authors choose this path of originality. In addition, the authors appear to be\ncontinually modifying the malware in response to researchers’ investigations of the malware.\nIn almost every sample we tested, we noticed new, small changes. We expect future\nchanges in the malware, either in its behavior or its target list.\n\nTo avoid being infected by this malware, users should simply not open suspicious links or\nfiles received by an active spam campaign. BackSwap hides as a legitimate running\napplication such as 7zip or OllyDbg, which are applications not commonly run by typical\nusers.\n\nMD5 Tested:\n\nfdc8e751535a4ce457f87e6c747217b8\n9265720139aa08e688d438d0d8e48c9e\nacbcc3e7342e86c0cca31a3a967d56d9\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-06-29 - BackSwap Defrauds Online Banking Customers Using Hidden Input Fields.pdf"
    ],
    "report_names": [
        "2018-06-29 - BackSwap Defrauds Online Banking Customers Using Hidden Input Fields.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536103,
    "ts_updated_at": 1743041172,
    "ts_creation_date": 1653692098,
    "ts_modification_date": 1653692098,
    "files": {
        "pdf": "https://archive.orkl.eu/aa377e6b5d128d7a06572fea2105e0ad5d579455.pdf",
        "text": "https://archive.orkl.eu/aa377e6b5d128d7a06572fea2105e0ad5d579455.txt",
        "img": "https://archive.orkl.eu/aa377e6b5d128d7a06572fea2105e0ad5d579455.jpg"
    }
}