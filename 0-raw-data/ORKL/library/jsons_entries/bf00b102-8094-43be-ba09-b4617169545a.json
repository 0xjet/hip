{
    "id": "bf00b102-8094-43be-ba09-b4617169545a",
    "created_at": "2022-10-25T16:48:16.365412Z",
    "updated_at": "2025-03-27T02:09:18.358797Z",
    "deleted_at": null,
    "sha1_hash": "e8b6ae99c81a397bbf6988b1d9d577cc00b61ca0",
    "title": "",
    "authors": "",
    "file_creation_date": "2021-02-10T19:44:22Z",
    "file_modification_date": "2021-02-10T19:44:41Z",
    "file_size": 4991638,
    "plain_text": "# OF THE EGREGOR RANSOMWARE\n\n\n## THREAT PROFILE\n\n# AN ANALYSIS OF THE\n\n\n## THREAT PROFILE\n\n# AN ANALYSIS\n\n\n# OF THE\n\n\n# OF THE\n\n\n## THREAT PROFILE\n\n\n## THREAT PROFILE\n\n\n-----\n\n### INTRODUCTION .............................................................................3\n\n#### TECHNICAL INTRODUCTION........................................................................4\n\n INITIAL ACCESS .............................................................................................6\n\n PERSISTENCE & BACKDOORS......................................................................7\n\n DOWNLOADED TOOLS ................................................................................8\n\n EXFILTRATION................................................................................................9\n\n RANSOMWARE ...........................................................................................11\n\n CONCLUSIONS AND RECOMMENDATIONS.............................................14\n\n IOCs..............................................................................................................14\n\n About MORPHISEC......................................................................................16\n\n\n-----\n\n### INTRODUCTION\n\n###### Egregor is considered to be one of the most prolific ransomware threat groups. Yet it gained this reputation in a very short time due to its uncompromising double extortion methodology.\n\n In this report, we will provide a detailed and anonymized coverage of Egregor’s tactics, techniques, and procedures (TTPs) following an incident response activity that was conducted at the end of November 2020. \n\n The goal of this report is to shed light on some very different techniques for initial access, persistence, and exfiltration than what is typically reported on with respect to the Egregor group. In this report, you will not find any indication of Qbot or Cobalt Strike beacons.\n\n Though we are not going to provide an exact attribution, you will find evidence in the report that may indicate a connection to the Revil group. We will provide evidence such as upload accounts, download links, and services that can result in additional community wide research which hopefully can lead to further conclusions.\n\n We invite the research community to share additional insights that may correlate with the published IOCs.\n\n\n-----\n\n### TECHNICAL INTRODUCTION\n\nAny incident response involving business compromise usually starts with the end - the impact. When the impact\nis ransomware, incident investigation is particularly difficult as it is done in parallel to containment activities.\n\nThis investigation wasn’t different from most that involve ransomware;\n\n- The AD is compromised and the ransomware is deployed directly from the AD.\n\n- A search and mapping of suspicious connections to the AD are correlated to legitimate activities and\nconnections of privileged users. RDP, pass the hash, and other techniques are taken into account.\n\n- Compromised credentials or/and a lateral movement chain is established and patient zero is identified.\nObviously, if logs exist, SIEM, event viewers, VPN, AV, and other logs are considered.\n\n- In the case of ransomware, the customer would usually like to know what was exfiltrated to be able to\ncalculate business continuity risks.\n\n- In the last stage, victims like to have a recommendation report for corrective actions that can be applied to\nthe network.\n\nOur incident investigation revealed that the Egregor threat group most probably exploited a VPN vulnerability\nto access the internal network from a Tor exit node. The attackers then scanned the network while looking for\na vulnerable server. They quickly identified and exploited a second vulnerability on an old 2003 application\nserver. This application server became our patient zero. The attackers then moved laterally between file\nshare, application, virtualization, update, and secondary AD servers until they infiltrated to the AD. Next,\nthey exfiltrated data through known services such as MegaUpload directly from the AD. As a final step, they\nencrypted the network.\n\n\n-----\n\n**Figure 1: The Egregor attack chain**\n\nA number of interesting and unique details will be mentioned in this report:\n\n- The upload account credentials and the additional file share services\n\n- Persistence through known legitimate remote control services\n\n- Download multiple versions of the ransomware while bypassing enterprise AV solution\n\n- The use of AES.ONE for ransomware download\n\n- Connection to Revil through Lalartu\n\n\n-----\n\n### INITIAL ACCESS\n\nThe current assumption is that the adversaries successfully exploited a non-patched VPN as no SSL login event\nwas registered while the attackers had been assigned with a local IP. The local IP was assigned to a Tor exit\nnode; 162.247.74.74 which belongs to a Calyx Institute. Immediately following an assignment of the local IP, the\nadversaries initiated a standard network scan as part of a discovery process. Though different users, passwords,\nand domains were used, we successfully identified the attacker machine VM:\n\n_Device name: MAVERIK-PC, Client OS version: Microsoft Windows 7 Ultimate Edition Service Pack 1, 64-bit_\n\nAs soon as the adversaries identified an older unpatched server (2003), they exploited a second vulnerability\nwhich allowed them to log in as a new user ”Lalartu”. Lalartu immediately triggered our suspicion of a possible\n[connection to the Revil and GandCrab groups. At first the attackers tried to exploit other servers in the network](https://underthebreach.medium.com/tracking-down-revils-lalartu-by-utilizing-multiple-osint-methods-2bf3a6c65a80)\nusing the same username.\n\nThe vulnerable application server became\nour patient zero, and our goal was to\nidentify as much as possible by correlating\nindicators from within and outside the\nserver. This became extra difficult as the\nattackers wiped the logs from the server.\n\n**Figure 2: The vulnerable application server.**\n\nNevertheless, we succeeded to rebuild the timeline and\nidentify most of the artifacts that were used by the attackers.\nWe assume that at least 3 attackers were working on this\nenvironment in parallel.\n\n**Figure 3: Lalartu is used.**\n\n\n-----\n\n### PERSISTENCE & BACKDOORS\n\nAs with most similar attack chains, the adversaries needed to maintain access to the servers in case they\nwould lose the connection. They surely needed to avoid the re-exploitation of the network. Due to an opened\noutbound connection to the internet, they were able to install legitimate remote connection software:\n\n**•** **AnyDesk - was dropped on the first login on almost every server that has been compromised**\n\n**Figure 4: Anydesk dropped**\n\n**•** **SupRemo (supremocontrol.com) - was installed in parallel to AnyDesk and was used as a backup.**\n\n**Figure 5: SupRemo installed**\n\nIn addition to having a remote control using the mentioned applications, the attacker logged in through VPN\nusing legitimate domain administrator credentials as soon as they were gathered from the servers.\n\n\n-----\n\n### DOWNLOADED TOOLS\n\nAs most communication has been outgoing from within the target business, attackers needed a way to\ndownload the ransomware and the tools they would use for discovery and lateral movement without leaving\nany trace of the C2 IP.\n\nJust after installing Chrome, they downloaded a 7zip installer and a net scanner from known sources:\n\n   - [https://www.7-zip.org/download.html](https://www.7-zip.org/download.html )\n\n   - [https://www.softperfect.com/download/files/netscan_portable.zip](https://www.softperfect.com/download/files/netscan_portable.zip )\n(have been also downloaded under different names such as old.exe)\n\nIn other cases, the attackers downloaded Mimikatz and PowerTool executables:\n\n**•** **Mimikatz used for credential collection was downloaded only on the “patient” zero server (2003).**\n\n   - [PowerTool was downloaded on a small number of servers under different names with slight executable](https://about.me/ithurricanept)\nmodifications (e.g. 777.exe and kaav32.exe). This was to identify and tamper with already installed and\nrunning security solutions.\n\n##### File.io\n\nMost of the tools have been downloaded using the file.io file share service with a one time download link.\n\nE.g. hxxps://file[.]io/WmCH77xcKmbJ\n\n7zip archive was downloaded through file.io, the archive included:\n\n   - PsExec (SysInternals)\n\n   - Sdelete.exe (SysInternals)\n\n   - BAT file to execute the ransomware (described later in the report)\n\n   - BAT file to deploy / distribute the ransomware (described later in the report)\n\n**Figure 6: The downloaded tools.**\n\n\n-----\n\n##### AES.ONE\n\nAttackers also used an intriguing backup option for file sharing. Once the first variant of the ransomware was\ndetected by an installed leading AV solution, attackers turned to a less popular and highly questionable AES.\nONE file sharing solution. They specifically used it to download only the ransomware component with the other\ndescribed tools in a previous bullet.\n\nhxxps://aes[.]one/files/d/p43/r1jv9967jd1i3kik9knctlok5/35f35ecea4d8a142/ hxxps://aes[.]one/files/d/\npc3/2iopi0o8coob22n8s60pn6b7ps/b6bbf78b901c1fdf/\n\n**Figure 7: The downloaded ransomware component.**\n\nAES.ONE was previously associated with Russian\ncampaigns within the US and conveniently vanished\nand was replaced by fghj.su on December 3\n**through December 7 (10 days after the massive**\nattacks). Some fghj.su links still point back to aes.\none.\n\n**Figure 8: fghj.su and AES.ONE**\n\n### EXFILTRATION\n\nAs the attackers had access to multiple servers including file share servers and ADs we have established a\npartial timeline for exfiltration of memory dumps and files. We identified exfiltration attempts mainly from the\nprimary AD following a successful share of folders from the file share servers with the AD.\n\n###### File share services - lsass dump\n\nAs soon as the attackers compromised the primary AD, they installed Chrome and decided to generate lsass\nmemory dump using PowerShell and exfiltrate it through known sharing services;\n\n   - [https://wetransfer.com/](https://wetransfer.com/ )\n\n   - [https://www.sendspace.com/](https://www.sendspace.com/)\n\nFurther evidence that this group could be associated with other Russian based attacks is the misspelling of the\nword “space” in Google a search that one of the attackers made, typing “sendspase.”\n\nUnfortunately for the attacker, the network was extremely slow and the upload broke the existing connection to\nthe AD.\n\nDuring the next couple of hours, attackers tried\nto reconnect to the AD using all available domain\nadministrator’s credentials both through RDP and\nthrough PSEXEC service which eventually worked.\n\n**Figure 9: Attackers tried to reconnect.**\n\nThis led the attacker to execute a speed test while trying to identify the issue and then to install a MegaUpload\nservice on the AD.\n\n\n-----\n\n##### MegaUpload\n\nThe decision to install a MegaUpload service required the attackers to\nregister a new user for this service (MEGAsyncSetup64.exe).\n\nLuckily we were able to recover the user “Tacok” and his temp email by\ntjuln.com. “Tjuln” mail is handled by mail.mailerhost.net, a known shared\nservice that is hosted on AWS. This is why the IP can not be blacklisted.\nThis is also likely the reason the attackers used the email.\n\n**Figure 10: The Tacok user and email.**\n\nAdditional investigation of the email domain revealed a high abuse rate on the same date of the attack. This could\nindicate that the attackers executed the same attack on multiple targets at the same time.\n\n**Figure 11: A high abuse rate of Tjuln email domain from** [StopForumSpam.](https://www.stopforumspam.com/domain/tjuln.com)\n\n\n-----\n\n### RANSOMWARE\n\nFollowing a successful exfiltration, ransomware was deployed from an AD shared folder. We succeeded in identifying\nmany of the scripts, but not all as many of the artifacts have been either overwritten by sdelete or re-encrypted by\nthe ransomware itself.\n\n**Figure 12: The ransomware scripts.**\n\nThe attackers deployed the ransomware in 3 ways depending on the endpoint environment - the differentiator\nis usually the deployment BAT file (nur.bat, nur2.bat, nur3.bat):\n\n- Nur3.bat - direct execution of local BAT file that executes the ransomware locally (on a set of selected\ntargets such as file shares)\n\n- Nur.bat - Task scheduler with remote execution of the ransomware (most servers)\n\n**Figure 13: Deployment of the ransomware.**\n\n- Nur2.bat - most endpoints - direct remote psexec with remote BAT execution from remote (AD) share (will\nbe described below)\n\n\n-----\n\n###### wc.bat\n\nThe Egregor deployment script is a .bat file that remotely executes Egregor in chunks using psexec (about 20\nlocal IPs per execution line). Every command is executed with a connection timeout of 10 seconds.\n\n**Figure 14: The Egregor deployment script.**\n\n###### wc_1.txt\n\nAs mentioned above, every execution line has a unique input\nfile that contains about 20 unique local IP addresses that were\npreviously identified through the netscan tool.\n\n**Figure 15: Unique local IP addresses**\n\n###### Nur2.bat\n\nThe command that is executed on a remote machine, Salsa.dll, is the Egregor ransomware that requires a\ndecoding password for its successful execution. As mentioned above (the Downloaded Tools section) we have\nidentified more than a single version of the ransomware dropped on the servers due to a previous detection of\nthe first variant.\n\n**Figure 16: The Salsa.dll file.**\n\n###### s.bat\n\nTo remove the attacker traces, sdelete was used to overwrite the trace files (32 overwrites).\n\n**Figure 17: Sdelete**\n\nAs we already know, the Egregor group threatens to leak sensitive data as part of their double extortion\nattempts where they actually release chunks of exfiltrated information to the public. Their demands are also\nextremely high and can lead to more than $40 million.\n\n\n-----\n\n**Figure 18: An Egregor ransom note.**\n\n\n-----\n\n### CONCLUSIONS AND RECOMMENDATIONS\n\nAs can be seen from the latest waves of ransomware campaigns; extortion, human-operated propagation,\nexploitation of VPN applications, and meteoric encryption are a landmark change in the current attack\nlandscape.\n\nEnterprises must adhere to the zero trust principles in order to minimize the risk of exposure to a ransomware\nattack, basic recommendations would be:\n\n- Deny network communication to all and from all, allow only on demand (minimize the risk for backdoors).\n\n- Apply MFA to minimize lateral movement risk.\n\n- Deploy runtime zero trust preventive technology such as Morphisec to keep your runtime applications safe.\n\n- Minimize administrator privileges.\n\n- Implement basic attack surface reduction rules such as script prevention and psexec prevention.\n\n- Isolate your backups and test those regularly.\n\n### IOCS\n\nSalsa.dll (Egregor) D0AB713F502D01DDF73694276F0199DB -plocklist11\n\nSalsa.dll (Egregor) D20CD3F8F0ECC34FA400EDF72687B215\n\n32x.exe (mimikatz)\n\n777.exe 3FADBE9038C51C12014818F172E43A7D PowerTool v2 x64\n\nkaav32.exe PowerTool x86\n\n**Tools used:**\n\n|IOCS|Col2|Col3|\n|---|---|---|\n||||\n|Salsa.dll (Egregor)|D0AB713F502D01DDF73694276F0199DB|-plocklist11|\n|Salsa.dll (Egregor)|D20CD3F8F0ECC34FA400EDF72687B215||\n|32x.exe|(mimikatz)||\n|777.exe|3FADBE9038C51C12014818F172E43A7D|PowerTool v2 x64|\n|kaav32.exe||PowerTool x86|\n\n|Col1|Col2|Col3|\n|---|---|---|\n|AnyDesk.exe|365AA18CADC5B80A9B5CA5950690C7F8||\n|Supremo.exe|00283740140DBE5C227BD15733D7A3B6||\n|MEGAsyncSetup64. exe|B04F9B4FEAC14CFF959718B69B7BBEAF||\n|Netscan.exe (old.exe)||https://www.softperfect.com/ download/files/netscan_portable. zip|\n\n\n-----\n\n|Col1|Col2|Col3|\n|---|---|---|\n|Chromesetup.exe|7AF4A442683662B020FD391E26666958||\n|7z1900.exe|FABE184F6721E640474E1497C69FFC98|https://www.7-zip.org/download. html|\n|PsExec.exe|27304B246C7D5B4E149124D5F93C5B01|Sysinternals|\n|sdelete.exe|F41A1AFC4CFB95F35CD92DA98D90C27B|Sysinternals|\n\n\n**Emails and URLs:**\n\n\n-----\n\n### ABOUT MORPHISEC\n\n###### Morphisec delivers an entirely new level of innovation to customers with its patented\n\n Moving Target Defense technology – placing defenders in a prevent-first posture against\n\n the most advanced threats to the enterprise, including APTs, zero-days, ransomware,\n\n evasive fileless attacks and web-borne exploits. Morphisec provides a crucial, small\n\n footprint zero trust memory-defense layer that easily deploys into a company’s existing\n\n security infrastructure to form a simple, highly effective, cost-efficient prevention stack\n\n that is truly disruptive to today’s existing cybersecurity model.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "bf5be533-fa31-4590-ae37-5761c97ffa34",
            "created_at": "2022-10-25T16:13:58.389257Z",
            "updated_at": "2022-10-25T16:13:58.389257Z",
            "deleted_at": null,
            "name": "Malpedia",
            "url": "https://malpedia.caad.fkie.fraunhofer.de",
            "description": "Malpedia is a free service offered by Fraunhofer FKIE",
            "reports": null
        },
        {
            "id": "5910e58f-4bc9-4e4e-9dbb-887804094a01",
            "created_at": "2022-10-25T16:32:58.457399Z",
            "updated_at": "2022-10-25T16:32:58.457399Z",
            "deleted_at": null,
            "name": "OTX",
            "url": "https://otx.alienvault.com",
            "description": "Alienvault Open Threat Exchange (OTX)",
            "reports": null
        }
    ],
    "references": [
        "https://www.morphisec.com/hubfs/eBooks_and_Whitepapers/EGREGOR%20REPORT%20WEB%20FINAL.pdf"
    ],
    "report_names": [
        "EGREGOR%20REPORT%20WEB%20FINAL.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716496,
    "ts_updated_at": 1743041358,
    "ts_creation_date": 1612986262,
    "ts_modification_date": 1612986281,
    "files": {
        "pdf": "https://archive.orkl.eu/e8b6ae99c81a397bbf6988b1d9d577cc00b61ca0.pdf",
        "text": "https://archive.orkl.eu/e8b6ae99c81a397bbf6988b1d9d577cc00b61ca0.txt",
        "img": "https://archive.orkl.eu/e8b6ae99c81a397bbf6988b1d9d577cc00b61ca0.jpg"
    }
}