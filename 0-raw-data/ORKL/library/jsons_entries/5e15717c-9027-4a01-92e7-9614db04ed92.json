{
    "id": "5e15717c-9027-4a01-92e7-9614db04ed92",
    "created_at": "2023-01-12T15:05:59.798597Z",
    "updated_at": "2025-03-27T02:05:32.49612Z",
    "deleted_at": null,
    "sha1_hash": "378dd92b866c0cc11a3ec6b5887b04b3440917ee",
    "title": "2022-10-27 - STRRAT- Malware Analysis of a JAR archive",
    "authors": "",
    "file_creation_date": "2022-11-28T19:00:35Z",
    "file_modification_date": "2022-11-28T19:00:35Z",
    "file_size": 479238,
    "plain_text": "# STRRAT: Malware Analysis of a JAR archive\n\n**[any.run/cybersecurity-blog/strrat-malware-analysis-of-a-jar-archive/](https://any.run/cybersecurity-blog/strrat-malware-analysis-of-a-jar-archive/)**\n\nANY.RUN October 27, 2022\n\n\nOrcus RAT Technical Malware Analysis and\nConfiguration Extraction from ANY.RUN\n\n\nThe majority of malware on Windows OS is compiled executable files. And their popularity\nhas led to a blockage at the delivery stage to the user. Fortunately, antivirus software on\nusers’ PCs is good at detecting and blocking the malicious payload contained in these files.\n\nBut malware developers use various tricks to overcome this issue: hackers develop a\nprogram using other (less popular) file formats. One of them is JAR.\n\nIn this article, we will talk about one of the Java malware representatives – STRRAT. Follow\nalong with our detailed behavior analysis, configuration extraction from the memory dump,\nand other information about a JAR sample.\n\n## What is a malicious Java archive?\n\nA JAR file, a Java archive, is a ZIP package with a program written in Java. If you have a\nJava Runtime Environment (JRE) on your computer, the .jar file starts as a regular program.\nBut some antivirus software may miss such malware, as it is not a popular format, but it can\n[be easily analyzed in an online malware sandbox.](https://any.run/?utm_source=anyrunblog&utm_medium=article&utm_campaign=strrat)\n\nLet’s look at STRRAT, a trojan-RAT written in Java. Here are typical STRRAT tasks:\n\n\n-----\n\ndata theft\nbackdoor creation\ncollecting credentials from browsers and email clients\nkeylogging\n\nThe initial vector of STRRAT infection is usually a malicious attachment disguised as a\ndocument or payment receipt. If the victim’s device has already had JRE installed, the file is\nlaunched as an application.\n\n\nA JAR archive: Shipment 08-24-2022.jar\n\n\n## How to analyze STRRAT’s Java archive\n\nSTRRAT usually has the following execution stages:\n\n1. The icacls launch to grant permissions\n2. Running a malware copy in the C:\\Users\\admin folder\n3 Persistence via schtasks\n\n\n-----\n\n4. Running a malware copy in the C:\\Users\\admin\\AppData\\Roaming folder\n5. Collecting and sending data to the server specified in the program\n\n[You can monitor this pattern of malware behavior in the STRRAT sample:](https://app.any.run/tasks/e7cc0fdf-73ba-45f7-b0f7-bbb01cd3f113?utm_source=anyrunblog&utm_medium=article&utm_campaign=strrat)\n\nSTRRAT process tree in ANY.RUN sandbox\n\n## A JAR file replication\n\nReplication is the first thing that catches your eye. We run the object from the desktop, then\nSTRRAT creates a copy of the file: first in the C:\\Users\\admin folder and then in\nC:\\Users\\admin\\AppData\\Roaming. After that, they run consistently.\n\n### A Java file gets file access\n\nThe next step is that the malware uses icacls to control file access. The command grants all\nusers access to the .oracle_jre_usage folder:\n\n_icacls C:\\ProgramData\\Oracle\\Java\\.oracle_jre_usage /grant “everyone”:(OI)(CI)M_\n\n### Application launch of STRRAT malware\n\nThen malware creates a task in the Scheduler using the command line:\n\n_schtasks /create /sc minute /mo 30 /tn Skype /tr “C:\\Users\\admin\\AppData\\Roaming\\str.jar_\n\nThe task is to use the Task Scheduler to run malware on behalf of the legal Skype program\nevery 30 minutes.\n\n\n-----\n\nA task creation via Scheduler\n\n\nNow let’s see the details of the 3504 process:\n\nMalware changes the autorun value\n\n\n-----\n\nit writes malware into the startup menu\n\nSo we can expect STRRAT to launch again after the OS reboot.\n\n### File creation of JAR malware\n\nSTRRAT’s process creates additional JAR files downloaded from public repositories.\n\nThe trojan downloaded and then created the library files from the Internet. If you run the\nmalware through CMD, you can see them yourself. And this scenario is quite unusual – we\ncan find the program execution logs if malware is run with CMD.\n\n\n-----\n\n### STRRAT network traffic analysis\n\n[ANY.RUN online malware sandbox provides detailed information about Network traffic in the](https://any.run/?utm_source=anyrunblog&utm_medium=article&utm_campaign=strrat)\nConnections tab.\n\nJAR malware network traffic\nGo to the files tab to see that the library files are loading, which is necessary for further\nmalware execution.\n\nJAR libraries\nSTRRAT downloads the following JAR libraries:\n\njne\nsqllite\nsystem-hook\n\nBesides data transferring, we can notice the constant attempts to connect with the\n91[.]193[.]75[.]134 IP address.\n\nConnection with the IP address\n\n## Malicious Java archive’s IOCs\n\nThe significant part of the analysis is that you can get IOCs very fast.\n\n\n-----\n\n## How to extract STRRAT malware configuration\n\nTo retrieve the malware configuration, we use PH and find all lines. Then filter them by the\naddress we already know in Connections.\n\nAs a result, we find only one interesting string.\n\nBrief string analysis shows that it contains separators in the form of “vertical dashes,”\ndifferent configuration parameters:\n\naddress\nport\nURL link\n\nAdditional options include:\n\n\n-----\n\n2 places where malware needs to install itself (Registry and StartconfigurationSkype\ntask\nproxy\nLID (license)\n\nThese data are included in the configuration we are looking for.\n\nThe line of interest is located in the heap area of memory. Let’s take a dump of it and write a\nsimple Python extractor. Try to extract it by yourself with the STRRAT malware configuration\nscript that we have shared with you. If you use the code, this is the output data you should\nget:\n\nAnd ANY.RUN’s version is already done for you. There is also a much faster way to get the\ndata you need – review malware configurations right in our service, which will unpack the\nsample from memory dumps and extract C2s for you:\n\nData output in ANY.RUN\n\n## To sum it up\n\nWe have carried out the analysis of the malware written in JAVA and triaged its behavior in\n[ANY.RUN online malware sandbox. We have written a simple extractor and derived the data.](https://any.run/?utm_source=anyrunblog&utm_medium=article&utm_campaign=strrat)\nCopy the script of STRRAT and try to extract C2 servers by yourselves and let us know\nabout your results!\n\nANY.RUN has already taken care of you, and this malware is detected automatically: it takes\nthe dump, pulls the configuration data, and presents results in an easy-to-read form.\n\nSTRRAT, [Raccoon Stealer, what’s next? ​​Please write in the comments below what other](https://any.run/cybersecurity-blog/raccoon-stealer-v2-malware-analysis/)\nmalware analysis you are interested in. We will be glad to add it to the series!\n\nCheck out other malware samples:\n\n[https://app.any.run/tasks/22ca1640-fcd8-4411-9757-8349af4d163f](https://app.any.run/tasks/22ca1640-fcd8-4411-9757-8349af4d163f)\n\n[https://app.any.run/tasks/56076b18-886b-46ca-aadb-e1d7d5de62cd](https://app.any.run/tasks/56076b18-886b-46ca-aadb-e1d7d5de62cd)\n\n[https://app.any.run/tasks/25cb57c8-a018-4ec1-bb98-74e5fe30e504](https://app.any.run/tasks/25cb57c8-a018-4ec1-bb98-74e5fe30e504)\n\n[https://app.any.run/tasks/4ed8f7b5-e173-4011-b7fd-08f1bdbf40e](https://app.any.run/tasks/4ed8f7b5-e173-4011-b7fd-08f1bdbf40e)\n\n[malware analysis](https://any.run/cybersecurity-blog/tag/malware-analysis/)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-10-27 - STRRAT- Malware Analysis of a JAR archive.pdf"
    ],
    "report_names": [
        "2022-10-27 - STRRAT- Malware Analysis of a JAR archive.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535959,
    "ts_updated_at": 1743041132,
    "ts_creation_date": 1669662035,
    "ts_modification_date": 1669662035,
    "files": {
        "pdf": "https://archive.orkl.eu/378dd92b866c0cc11a3ec6b5887b04b3440917ee.pdf",
        "text": "https://archive.orkl.eu/378dd92b866c0cc11a3ec6b5887b04b3440917ee.txt",
        "img": "https://archive.orkl.eu/378dd92b866c0cc11a3ec6b5887b04b3440917ee.jpg"
    }
}