{
    "id": "325f7135-4fe6-4a41-a80a-6adbd02f1a6c",
    "created_at": "2023-01-12T15:02:30.548069Z",
    "updated_at": "2025-03-27T02:08:23.159193Z",
    "deleted_at": null,
    "sha1_hash": "a9e9921fce2f6c152dd09c37be045b2044cf921d",
    "title": "2018-04-03 - Let's Learn- Trickbot Implements Network Collector Module Leveraging CMD, WMI & LDAP",
    "authors": "",
    "file_creation_date": "2022-05-28T04:12:37Z",
    "file_modification_date": "2022-05-28T04:12:37Z",
    "file_size": 280618,
    "plain_text": "# Let's Learn: Trickbot Implements Network Collector Module Leveraging CMD, WMI & LDAP\n\n**[vkremez.com/2018/04/lets-learn-trickbot-implements-network.html](http://www.vkremez.com/2018/04/lets-learn-trickbot-implements-network.html)**\n\n**Goal: Reverse and document the latest module \"network64/32Dll,\" leveraged by the**\nnotorious Trickbot banking malware gang.\n\n**Decoded module hash \"network64Dll\":** [aeb08b0651bc8a13dcf5e5f6c0d482f8](https://www.virustotal.com/#/file/0df586aa0334dcbe047d24ce859d00e537fdb5e0ca41886dab27479b6fc61ba6/details)\n\n**Decoded config in \"network64Dll_configs:**\n\n<dpost>\n<handler>http://85.143.209[.]180:8082</handler>\n<handler>http://212.92.98[.]229:8082</handler>\n</dpost>\n**Background:**\n\nA few extractions from today's trickbot 02/04/2018:gtag[tt0002https://t.co/PUQaOWa0CI - Confighttps://t.co/30Rep77aY3 -](https://t.co/PUQaOWa0CI)\n[Dposthttps://t.co/T77F5kQyaf - Mailconf@executemalware](https://t.co/T77F5kQyaf) [@Ring0x0](https://twitter.com/Ring0x0?ref_src=twsrc%5Etfw)\n[@James_inthe_box](https://twitter.com/James_inthe_box?ref_src=twsrc%5Etfw) [@JAMESWT_MHT](https://twitter.com/JAMESWT_MHT?ref_src=twsrc%5Etfw) [@VK_Intel](https://twitter.com/VK_Intel?ref_src=twsrc%5Etfw) [@clucianomartins](https://twitter.com/clucianomartins?ref_src=twsrc%5Etfw) [@MakFLwana](https://twitter.com/MakFLwana?ref_src=twsrc%5Etfw)\n[@CryptoInsane](https://twitter.com/CryptoInsane?ref_src=twsrc%5Etfw) [pic.twitter.com/Ugr8B8bbgW](https://t.co/Ugr8B8bbgW)\n[â€” V0id_Hunt3r (@v0id_hunter) April 2, 2018](https://twitter.com/v0id_hunter/status/980874272129286144?ref_src=twsrc%5Etfw)\n\n\n-----\n\n**Assessment**\n\nWhile reviewing Twitter posts related to Trickbot malware, I was alerted by a few researchers\n[@Ring0x0 and](https://twitter.com/Ring0x0) [@v0id_hunter to the new module dropped by the Trickbot gang](https://twitter.com/v0id_hunter)\n\"network64/32Dll.\" This specific module appears to be one single harvester of all possible\nnetwork victim information from running commands such as \"ipconfig /all\" and \"nltest\n/domain_trusts /all_trusts\" to WMI Query Language (WQL) queries such as \"SELECT *\nFROM Win32_OperatingSystem\" to lightweight directory access protocol (LDAP) queries.\nNotably, the gang leverages \"nltest\" commands to establish trust relationship\nbetween between a compromised workstation and its possible domain before quering LDAP.\nThis is not the first time this gang leverages LDAP; they also developer a DomainGrabber\n[module specifically to harvest sensitive domain controller information, as detailed earlier.](http://www.vkremez.com/2017/12/lets-learn-introducing-new-trickbot.html)\nThis tiny 24 KB module DLL, compiled on Friday March 30, 08:52:12 2018 UTC, is originally\ncalled \"dll[.]dll.\" The module itself consists of only 32 functions.\n\n**Possible Attack Methodology**\n\nThe module is likely used by the gang to expand their access to victim networks possibly\nidentifying high-value corporate domains that they can exploit further either via their \"tab\"\nmodule implementing its ETERNALROMANCE exploit implementation, paired with Mimikatz\nand/or establish deeper network persistence before they deploy additional malware.\nThe decoded Trickbot \"network64Dll\" module contains the usual Trickbot export functions:\n\nControl\nFreeBuffer\nRelease\nStart\n\nThe module framework is as follows:\nI.\n\nNetwork Collector Module\nII.\n\nNetwork Communication\nIII. Yara rule\n**I. Network Collector Module**\n\n**A. ***PROCESS LIST*****\nCollects all processes via CreatoolHelp32Snapshot iterating through running processes.\n**B. . ***SYSTEMINFO*****\nThe list of queried WMQ is based from this expression:\n\nSELECT * FROM Win32_OperatingSystem\n\n**C CMD-based calls**\n\n\n-----\n\nThe list of all simple command leveraged by the gang:\n\nipconfig /all\nnet config workstation\nnet view /all\nnet view /all /domain\nnltest /domain_trusts\nnltest /domain_trusts /all_trusts\n\n**D. LDAP network and domain queries**\n\nThe list of some of the grouped LDAP queries:\n**a. ***LOCAL MACHINE DATA*****\n\nUser name\nComputer name\nSite name\nDomain shortname\nDomain name\nForest name\nDomain controller\nForest trees\n\n**b. ***COMPUTERS IN FOREST*****\n\nName\nFull name\nDescription\nOperating System\nIP-addres\n\n**c. ***USERS IN FOREST*****\n\nE-mail\nComment\nDescription\nName\n\n\n-----\n\n**d.** **COMPUTERS IN DOMAIN**\n\nName\nFull name\nDescription\nOperating System\nIP-addres\n\n**e. ***USERS IN DOMAIN*****\n\nE-mail\nComment\nDescription\nName\n\n**II. Network Communication**\n\nPart of the export \"Control\" function, the module forms and communicates to the next-layer\nnetwork via the module network path ending in .../<GROUP ID>/<CLIENT ID>/90. The /90\nending is leveraged for POST requests with its content in the following three unique formats:\nA. Content-Disposition: form-data; name=\"proclist\"\nB. Content-Disposition: form-data; name=\"sysinfo\"\nC. Content-Type: multipart/form-data; boundary=Arasfjasu7\n\nThe unique value \"Arasfjasu7\" appears to be a marker/separator specifically for the LDAP\n[query collection upload to split the harvested information. Thanks to @Ring0x0 for the](https://twitter.com/Ring0x0)\nshare.\n**III. YARA RULE**\nrule crime_trickbot_network_module_in_memory {\nmeta:\ndescription = \"Detects Trickbot network module in memory\"\n\n\n-----\n\nauthor = @VK_Intel\nreference = \"Detects unpacked Trickbot network64Dll\"\ndate = \"2018-04-02\"\nhash = \"0df586aa0334dcbe047d24ce859d00e537fdb5e0ca41886dab27479b6fc61ba6\"\nstrings:\n$s0 = \"***PROCESS LIST***\" fullword wide\n$s1 = \"(&(objectCategory=computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))\"\nfullword wide\n$s2 = \"***USERS IN DOMAIN***\" fullword wide\n$s3 = \"Operating System: %ls\" fullword wide\n$s4 = \"<moduleconfig><autostart>yes</autostart><sys>yes</sys><needinfo name=\\\"id\\\"/>\n<needinfo name=\\\"ip\\\"/><autoconf><conf ctl=\\\"SetCon\" ascii\n$s5 = \"Content-Length: %lu\" fullword wide\n$s6 = \"Boot Device - %ls\" fullword wide\n$s7 = \"Serial Number - %ls\" fullword wide\n$s8 = \"Content-Disposition: form-data; name=\\\"proclist\\\"\" fullword ascii\n$s9 = \"Content-Disposition: form-data; name=\\\"sysinfo\\\"\" fullword ascii\n$s10 = \"Product Type - Server\" fullword wide\n$s11 = \"***SYSTEMINFO***\" fullword wide\n$s12 = \"OS Version - %ls\" fullword wide\n$s13 = \"(&(objectcategory=person)(samaccountname=*))\" fullword wide\n$s14 = \"Product Type - Domain Controller\" fullword wide\ncondition:\nuint16(0) == 0x5a4d and filesize < 70KB and 12 of ($s*)\n}\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-04-03 - Let's Learn- Trickbot Implements Network Collector Module Leveraging CMD, WMI & LDAP.pdf"
    ],
    "report_names": [
        "2018-04-03 - Let's Learn- Trickbot Implements Network Collector Module Leveraging CMD, WMI & LDAP.pdf"
    ],
    "threat_actors": [
        {
            "id": "81dde5cc-c29f-430d-8c6e-e5e92d5015e7",
            "created_at": "2022-10-25T16:07:23.704358Z",
            "updated_at": "2025-03-27T02:02:09.932453Z",
            "deleted_at": null,
            "main_name": "Harvester",
            "aliases": [],
            "source_name": "ETDA:Harvester",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "Graphon",
                "Metasploit",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535750,
    "ts_updated_at": 1743041303,
    "ts_creation_date": 1653711157,
    "ts_modification_date": 1653711157,
    "files": {
        "pdf": "https://archive.orkl.eu/a9e9921fce2f6c152dd09c37be045b2044cf921d.pdf",
        "text": "https://archive.orkl.eu/a9e9921fce2f6c152dd09c37be045b2044cf921d.txt",
        "img": "https://archive.orkl.eu/a9e9921fce2f6c152dd09c37be045b2044cf921d.jpg"
    }
}