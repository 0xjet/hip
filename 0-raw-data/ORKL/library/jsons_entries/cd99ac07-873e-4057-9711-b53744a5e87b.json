{
    "id": "cd99ac07-873e-4057-9711-b53744a5e87b",
    "created_at": "2023-01-12T15:00:26.489371Z",
    "updated_at": "2025-03-27T02:05:52.075353Z",
    "deleted_at": null,
    "sha1_hash": "fbdb8b191cdf7dd7679c79d18a9718d49fe96c3d",
    "title": "2021-07-22 - When coin miners evolve, Part 1- Exposing LemonDuck and LemonCat, modern mining malware infrastructure",
    "authors": "",
    "file_creation_date": "2022-05-28T23:14:03Z",
    "file_modification_date": "2022-05-28T23:14:03Z",
    "file_size": 405055,
    "plain_text": "# When coin miners evolve, Part 1: Exposing LemonDuck and LemonCat, modern mining malware infrastructure\n\n**microsoft.com/security/blog/2021/07/22/when-coin-miners-evolve-part-1-exposing-lemonduck-and-lemoncat-modern-**\nmining-malware-infrastructure/\n\nJuly 22, 2021\n\n_[Note: In this two-part blog series, we expose a modern malware infrastructure and provide_\n_guidance for protecting against the wide range of threats it enables. Part 1 covers the_\n_[evolution of the threat, how it spreads, and how it impacts organizations. Part 2 is a deep](https://www.microsoft.com/security/blog/2021/07/29/when-coin-miners-evolve-part-2-hunting-down-lemonduck-and-lemoncat-attacks/)_\n_dive on the attacker behavior and will provide investigation guidance.]_\n\nCombating and preventing today’s threats to enterprises require comprehensive protection\nfocused on addressing the full scope and impact of attacks. Anything that can gain access to\nmachines—even so-called commodity malware—can bring in more dangerous threats.\nWe’ve seen this in banking Trojans serving as entry point for ransomware and hands-onkeyboard attacks. LemonDuck, an actively updated and robust malware that’s primarily\nknown for its botnet and cryptocurrency mining objectives, followed the same trajectory when\nit adopted more sophisticated behavior and escalated its operations. Today, beyond using\nresources for its traditional bot and mining activities, LemonDuck steals credentials, removes\nsecurity controls, spreads via emails, moves laterally, and ultimately drops more tools for\nhuman-operated activity.\n\nLemonDuck’s threat to enterprises is also in the fact that it’s a cross-platform threat. It’s one\nof a few documented bot malware families that targets Linux systems as well as Windows\ndevices. It uses a wide range of spreading mechanisms—phishing emails, exploits, USB\ndevices, brute force, among others—and it has shown that it can quickly take advantage of\nnews, events, or the release of new exploits to run effective campaigns. For example, in\n2020, it was observed using COVID-19-themed lures in email attacks. In 2021, it exploited\n[newly patched Exchange Server vulnerabilities to gain access to outdated systems.](https://www.microsoft.com/security/blog/2021/03/25/analyzing-attacks-taking-advantage-of-the-exchange-server-vulnerabilities/)\n\nThis threat, however, does not just limit itself to new or popular vulnerabilities. It continues to\nuse older vulnerabilities, which benefit the attackers at times when focus shifts to patching a\npopular vulnerability rather than investigating compromise. Notably, LemonDuck removes\nother attackers from a compromised device by getting rid of competing malware and\npreventing any new infections by patching the same vulnerabilities it used to gain access.\n\nIn the early years, LemonDuck targeted China heavily, but its operations have since\nexpanded to include many other countries, focusing on the manufacturing and IoT sectors.\nToday, LemonDuck impacts a very large geographic range, with the United States, Russia,\nChina, Germany, the United Kingdom, India, Korea, Canada, France, and Vietnam seeing\nthe most encounters.\n\n\n-----\n\n_Figure 1. Global distribution of LemonDuck botnet activity_\n\nIn 2021, LemonDuck campaigns started using more diversified command and control (C2)\ninfrastructure and tools. This update supported the marked increase in hands-on-keyboard\nactions post-breach, which varied depending on the perceived value of compromised\ndevices to the attackers. Despite all these upgrades, however, LemonDuck still utilizes C2s,\nfunctions, script structures, and variable names for far longer than the average malware. This\nis likely due to its use of bulletproof hosting providers such as Epik Holdings, which are\nunlikely to take any part of the LemonDuck infrastructure offline even when reported for\nmalicious actions, allowing LemonDuck to persist and continue to be a threat.\n\nIn-depth research into malware infrastructures of various sizes and operations provides\ninvaluable insight into the breadth of threats that organizations face today. In the case of\nLemonDuck, the threat is cross-platform, persistent, and constantly evolving. Research like\nthis emphasizes the importance of having comprehensive visibility into the wide range of\nthreats, as well as the ability to correlate simple, disparate activity such as coin mining to\nmore dangerous adversarial attacks.\n\n## LemonDuck and LemonCat infrastructure\n\nThe earliest documentation of LemonDuck was from its cryptocurrency campaigns in May\n2019. These campaigns included PowerShell scripts that employed additional scripts kicked\noff by a scheduled task. The task was used to bring in the PCASTLE tool to achieve a couple\nof goals: abuse the EternalBlue SMB exploit, as well as use brute force or pass-the-hash to\nmove laterally and begin the operation again. Many of these behaviors are still observed in\nLemondDuck campaigns today.\n\n\n-----\n\nLemonDuck is named after the variable Lemon_Duck in one of the said PowerShell scripts.\nThe variable is often used as the user agent, in conjunction with assigned numbers, for\ninfected devices. The format used two sets of alphabetical characters separated by dashes,\nfor example: “User-Agent: Lemon-Duck-[A-Z]-[A-Z]”. The term still appears in PowerShell\nscripts, as well as in many of the execution scripts, specifically in a function called SIEX,\nwhich is used to assign a unique user-agent during botnet connection in attacks as recently\nas June 2021.\n\nLemonDuck frequently utilizes open-source material built off of resources also used by other\nbotnets, so there are many components of this threat that would seem familiar. Microsoft\nresearchers are aware of two distinct operating structures, which both use the LemonDuck\nmalware but are potentially operated by two different entities for separate goals.\n\nThe first, which we call the “Duck” infrastructure, uses historical infrastructures discussed in\nthis report. It is highly consistent in running campaigns and performs limited follow-on\nactivities. This infrastructure is seldom seen in conjunction with edge device compromise as\nan infection method, and is more likely to have random display names for its C2 sites, and is\nalways observed utilizing “Lemon_Duck” explicitly in script.\n\nThe second infrastructure, which we call “Cat” infrastructure—for primarily using two\ndomains with the word “cat” in them (sqlnetcat[.]com, netcatkit[.]com)—emerged in January\n2021. It was used in attacks exploiting vulnerabilities in Microsoft Exchange Server. Today,\nthe Cat infrastructure is used in attacks that typically result in backdoor installation, credential\nand data theft, and malware delivery. It is often seen delivering the malware Ramnit.\n\n**Sample Duck domains** **Sample Cat domains**\n\n\ncdnimages[.]xyz\nbb3u9[.]com\nzz3r0[.]com\npp6r1[.]com\namynx[.]com\nackng[.]com\nhwqloan[.]com\njs88[.]ag\nzer9g[.]com\nb69kq[.]com\n\n\nsqlnetcat[.]com\nnetcatkit[.]com\ndown[.]sqlnetcat[.]com\n\n\nThe Duck and Cat infrastructures use similar subdomains, and they use the same task\nnames, such as “blackball”. Both infrastructures also utilize the same packaged components\nhosted on similar or identical sites for their mining, lateral movement, and competitionremoval scripts, as well as many of the same function calls.\n\n\n-----\n\nThe fact that the Cat infrastructure is used for more dangerous campaigns does not\ndeprioritize malware infections from the Duck infrastructure. Instead, this intelligence adds\nimportant context for understanding this threat: the same set of tools, access, and methods\ncan be re-used at dynamic intervals, to greater impact. Despite common implications that\ncryptocurrency miners are less threatening than other malware, its core functionality mirrors\nnon-monetized software, making any botnet infection worthy of prioritization.\n\n_Figure 2. LemonDuck attack chain from the Duck and Cat infrastructures_\n\n## Initial access\n\nLemonDuck spreads in a variety of ways, but the two main methods are (1) compromises\nthat are either edge-initiated or facilitated by bot implants moving laterally within an\norganization, or (2) bot-initiated email campaigns.\n\nLemonDuck acts as a loader for many other follow-on activities, but one if its main functions\nis to spread by compromising other systems. Since its first appearance, the LemonDuck\noperators have leveraged scans against both Windows and Linux devices for open or weakly\nauthenticated SMB, Exchange, SQL, Hadoop, REDIS, RDP, or other edge devices that might\nbe vulnerable to password spray or application vulnerabilities like CVE-2017-0144\n(EternalBlue), CVE-2017-8464 (LNK RCE), CVE-2019-0708 (BlueKeep), CVE-2020-0796\n(SMBGhost), CVE-2021-26855 (ProxyLogon), CVE-2021-26857 (ProxyLogon), CVE-202126858 (ProxyLogon), and CVE-2021-27065 (ProxyLogon).\n\n\n-----\n\nOnce inside a system with an Outlook mailbox, as part of its normal exploitation behavior,\nLemonDuck attempts to run a script that utilizes the credentials present on the device. The\nscript instructs the mailbox to send copies of a phishing message with preset messages and\nattachments to all contacts.\n\nBecause of this method of contact messaging, security controls that rely on determining if an\nemail is sent from a suspicious sender don’t apply. This means that email security policies\nthat reduce scanning or coverage for internal mail need to be re-evaluated, as sending\nemails through contact scraping is very effective at bypassing email controls.\n\nFrom mid-2020 to March 2021, LemonDuck’s email subjects and body content have\nremained static, as have the attachment names and formats. These attachment names and\nformats have changed very little from similar campaigns that occurred in early 2020.\n\n**Sample email subjects** **Sample email body content**\n\n\nThe Truth of COVID19\nCOVID-19 nCov\nSpecial info WHO\nHALTH\nADVISORY:CORONA\nVIRUS\nWTF\nWhat the fcuk\ngood bye\nfarewell letter\nbroken file\nThis is your order?\n\n\nVirus actually comes from United States of America\nvery important infomation for Covid-19\nsee attached document for your action and discretion.\nthe outbreak of CORONA VIRUS is cause of concern\nespecially where forign personal have recently arrived\nor will be arriving at various intt in near future.\nwhat’s wrong with you?are you out of your mind!!!!!\nare you out of your mind!!!!!what ‘s wrong with you?\ngood bye, keep in touch\ncan you help me to fix the file,i can’t read it\nfile is brokened, i can’t open it\n\n\nThe attachment used for these lures is one of three types: .doc, .js, or a .zip containing a .js\nfile. Whatever the type, the file is named “readme”. Occasionally, all three types are present\nin the same email.\n\n\n-----\n\n_Figure 3. Sample email_\n\nWhile the JavaScript is detected by many security vendors, it might be classified with generic\ndetection names. It could be valuable for organizations to sanitize JavaScript or VBScript\nexecuting or calling prompts (such as PowerShell) directly from mail downloads through\n[solutions such as custom detection rules.](https://docs.microsoft.com/en-us/microsoft-365/security/defender/custom-detection-rules?view=o365-worldwide)\n\nSince LemonDuck began operating, the .zip to .js file execution method is the most common.\nThe JavaScript has replaced the scheduled task that LemonDuck previously used to kickstart\nthe PowerShell script. This PowerShell script has looked very similar throughout 2020 and\n2021, with minor changes depending on the version, indicating continued development.\nBelow is a comparison of changes from the most recent iterations of the email-delivered\ndownloads and those from April of 2020.\n\n\n-----\n\nAfter the emails are sent, the inbox is cleaned to remove traces of these mails. This method\nof self-spreading is attempted on any affected device that has a mailbox, regardless of\nwhether it is an Exchange server.\n\nOther common methods of infection include movement within the compromised environment,\nas well as through USB and connected drives. These processes are often kicked off\nautomatically and have occurred consistently throughout the entirety of LemonDuck’s\noperation.\n\nThese methods run as a series of C# scripts that gather available drives for infection. They\nalso create a running list of drives that are already infected based on whether it finds the\nthreat already installed. Once checked against the running list of infected drives, these\nscripts attempt to create a set of hidden files in the home directory, including a copy of\n_readme.js. Any device that has been affected by the LemonDuck implants at any time could_\nhave had any number of drives attached to it that are compromised in this manner. This\nmakes this behavior a possible entry vector for additional attacks.\n\n\n-----\n\n## Comprehensive protection against a wide-ranging malware operation\n\n[The cross-domain visibility and coordinated defense delivered by Microsoft 365 Defender is](https://www.microsoft.com/en-us/microsoft-365/security/microsoft-365-defender)\ndesigned for the wide range and increasing sophistication of threats that LemonDuck\nexemplifies. Microsoft 365 Defender has AI-powered industry-leading protections that can\nstop multi-component threats like LemonDuck across domains and across platforms.\nMicrosoft 365 Defender for Office 365 detects the malicious emails sent by the LemonDuck\nbotnet to deliver malware payloads as well as spread the bot loader. Microsoft Defender for\nEndpoint detects and blocks LemonDuck implants, payloads, and malicious activity on Linux\nand Windows.\n\nMore importantly, Microsoft 365 Defender provides rich investigation tools that can expose\ndetections of LemonDuck activity, including attempts to compromise and gain a foothold on\nthe network, so security operations teams can efficiently and confidently respond to and\nresolve these attacks. Microsoft 365 Defender correlates cross-platform, cross-domain\n\n\n-----\n\nsignals to paint the end-to-end attack chain, allowing organizations to see the full impact of\nan attack. We also published a threat analytics article on this threat. Microsoft 365 Defender\ncustomers can use this report to get important technical details, guidance for investigation,\nconsolidated incidents, and steps to mitigate this threat in particular and modern\ncyberattacks in general.\n\nIn Part 2 of this blog series, we share our in-depth technical analysis of the malicious actions\nthat follow a LemonDuck infection. These include general, automatic behavior as well as\nhuman-initialized behavior. We will also provide guidance for investigating LemonDuck\nattacks, as well as mitigation recommendations for strengthening defenses against these\nattacks. READ: When coin miners evolve, Part 2: Hunting down LemonDuck and\n**LemonCat attacks.**\n\n_Microsoft 365 Defender Threat Intelligence Team_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-07-22 - When coin miners evolve, Part 1- Exposing LemonDuck and LemonCat, modern mining malware infrastructure.pdf"
    ],
    "report_names": [
        "2021-07-22 - When coin miners evolve, Part 1- Exposing LemonDuck and LemonCat, modern mining malware infrastructure.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535626,
    "ts_updated_at": 1743041152,
    "ts_creation_date": 1653779643,
    "ts_modification_date": 1653779643,
    "files": {
        "pdf": "https://archive.orkl.eu/fbdb8b191cdf7dd7679c79d18a9718d49fe96c3d.pdf",
        "text": "https://archive.orkl.eu/fbdb8b191cdf7dd7679c79d18a9718d49fe96c3d.txt",
        "img": "https://archive.orkl.eu/fbdb8b191cdf7dd7679c79d18a9718d49fe96c3d.jpg"
    }
}