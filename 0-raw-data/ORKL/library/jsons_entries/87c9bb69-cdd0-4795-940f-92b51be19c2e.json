{
    "id": "87c9bb69-cdd0-4795-940f-92b51be19c2e",
    "created_at": "2023-01-12T15:02:59.602311Z",
    "updated_at": "2025-03-27T02:08:41.371515Z",
    "deleted_at": null,
    "sha1_hash": "e6f2e0e395618ab672dd35fe3d4f750436ae2e4c",
    "title": "2019-11-18 - Brushaloader gaining new layers like a pro",
    "authors": "",
    "file_creation_date": "2022-05-27T22:31:35Z",
    "file_modification_date": "2022-05-27T22:31:35Z",
    "file_size": 269167,
    "plain_text": "# Brushaloader gaining new layers like a pro\n\n**[cert.pl/en/news/single/brushaloader-gaining-new-layers-like-a-pro/](https://www.cert.pl/en/news/single/brushaloader-gaining-new-layers-like-a-pro/)**\n\nYo dawg, I heard you like droppers so I put a dropper in your dropper\n\nOn 2019-11-18 we received a report that some of Polish users have began receiving\nmalspam imitating DHL:\n\nIn this short article, we’ll take a look at the xls document that has been used as a (1st stage)\ndropper distributing another well-known (2nd stage) dropper – brushaloader.\n\n\n-----\n\nSamples analysed:\n\n6a101103486e67f1d8839edd18da773bd9b665ab3df650c9882245d0ee712b8e –\n25163275820.xls\n627294cf0495d2daf8d543aca74bf3cf684673c6a32b8ebf6649f882b362a11a –\nbrushaloader printhpp.vbe\nf25bee3bfe185c6df0ce25cf738f1cc9c72a9ea7f33f6f7545e73d2f3d79b5f8 –\nbrushaloader drop(isfb dll)\n\nWhile the embedded links did not lead to anything interesting, there was also an .xls file\nattached, let’s try opening it up:\n\n\n-----\n\nInteresting…\n\nPoking around, we have noticed that some cells have text in them, but their contents were\nhidden using specific style and formatting; the font size was set to 2 and color was set to\nwhite.\n\nLet’s fetch the macro contents to see what’s going on under the hood: ➜ ~olevba\n25163275820.xls\n\nThe above code is a complete source-code of the macros embedded in the spreadsheet.\nTaking a closer look we can identify several interesting snippets:\n\nThe print button does nothing, probably to encourage users to enable macros in the\ndocument.\n\nThe payload script will run only on application with language set to Polish (id=1045).\n\nThe program will fetch values from cells D5:D8, E5:E8 and J10 which match the fields with\nembedded data that we have observed earlier\n\n\n-----\n\nThe cells contents are decrypted and concatenated using a custom algorithm. The result is a\nPowerShell script:\n\nDecompressing the deflate blob can be easily achieved using the following Python script:\n\nRunning the script yields the following results:\n\nThe resulting script is somewhat obfuscated using strings formatting, we can clean it up with\nanother quick Python script:\n\nWhich gives us another PowerShell script with a large base64 blob that contains the next\nlayer:\n\nDecoding the base64 and cleaning up the binary again gives us a yet another PowerShell\nscript:\n\nAfter some manual formatting we eneded up with the below script:\n\nIn short, the script iterates over drive IDs and concatenates them creating a hex-encoded\nunique id.\n\nThat id is then submitted to the c2, which responds with an xor-encrypted payload, that is the\nfirst stage vbs of a normal brushaloader campaign.\n\nIt can be easilly fetched, decrypted and decoded using this nifty Python script with some help\n[from our malware-analysis library – malduck:](https://github.com/CERT-Polska/malduck)\n\n[Brushaloader has been described exensively in the past by Proofpoint and](https://www.proofpoint.com/us/threat-insight/post/brushaloader-still-sweeping-victims-one-year-later) [Talos, nothing](https://blog.talosintelligence.com/2019/02/combing-through-brushaloader.html)\nnew here.\n\nLet’s focus on the dropped binary instead, Brushaloader used to be used for distribution of\nDanabot botnet no. 3 in Poland, but some time ago we have observed a shift to ISFB v2.\n\nFor this particular sample the config is as follows:\n\nThe static config is used to download webinjects and redirects targeting Polish banking sites\nand email providers.\n\nIf you’re interested in receiving information about webinjects targeted at your domain, you\n[might want to check out our injects sharing website: injects.cert.pl](https://injects.cert.pl/)\n\nThat’s it, if you have any additional questions do not hestitate to reach out to us at\n[@CERT_Polska_en or](https://twitter.com/CERT_Polska_en) [[email protected]](https://www.cert.pl/cdn-cgi/l/email-protection)\n\nThanks to [Kafeine from Proofpoint for the ISFB sample.](https://twitter.com/kafeine)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-11-18 - Brushaloader gaining new layers like a pro.pdf"
    ],
    "report_names": [
        "2019-11-18 - Brushaloader gaining new layers like a pro.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535779,
    "ts_updated_at": 1743041321,
    "ts_creation_date": 1653690695,
    "ts_modification_date": 1653690695,
    "files": {
        "pdf": "https://archive.orkl.eu/e6f2e0e395618ab672dd35fe3d4f750436ae2e4c.pdf",
        "text": "https://archive.orkl.eu/e6f2e0e395618ab672dd35fe3d4f750436ae2e4c.txt",
        "img": "https://archive.orkl.eu/e6f2e0e395618ab672dd35fe3d4f750436ae2e4c.jpg"
    }
}