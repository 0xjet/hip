{
    "id": "46bc4627-5623-4c47-8422-37a4dc94bc27",
    "created_at": "2023-01-12T15:01:09.556337Z",
    "updated_at": "2025-03-27T02:05:39.426955Z",
    "deleted_at": null,
    "sha1_hash": "dd8abf02b102ead29d6c09259c1f2071bbdb3d55",
    "title": "2018-02-15 - TrickBot’s Cryptocurrency Hunger- Tricking the Bitcoin Out of Wallets",
    "authors": "",
    "file_creation_date": "2022-05-28T02:29:16Z",
    "file_modification_date": "2022-05-28T02:29:16Z",
    "file_size": 3634477,
    "plain_text": "# Targeting Exchange Users to Steal Coins\n\n**[securityintelligence.com/trickbots-cryptocurrency-hunger-tricking-the-bitcoin-out-of-wallets/](https://securityintelligence.com/trickbots-cryptocurrency-hunger-tricking-the-bitcoin-out-of-wallets/)**\n\n[Home&nbsp/](https://securityintelligence.com/) [Advanced Threats](https://securityintelligence.com/category/x-force/threats/)\nTrickBot’s Cryptocurrency Hunger: Tricking the Bitcoin Out of Wallets\n\n[Advanced Threats February 15, 2018](https://securityintelligence.com/category/x-force/threats/)\nBy [Ophir Harpaz co-authored by Magal Baz,](https://securityintelligence.com/author/ophir-harpaz/) [Limor Kessem 8 min read](https://securityintelligence.com/author/limor-kessem/)\n\n\nFebruary 15, 2018\n\n\n-----\n\n[The TrickBot Trojan has been a rising global threat in the cybercrime arena ever since its](https://securityintelligence.com/events/the-evolution-of-trickbot-son-of-dyre-into-the-next-global-banking-threat/)\n[emergence in late 2016. The organized cybergang that operates TrickBot has been widening](https://securityintelligence.com/an-aggressive-launch-trickbot-trojan-rises-with-redirection-attacks-in-the-uk/)\nits scope of activity to dozens of countries across the globe. It has been targeting financial\nentities, such as banks and credit providers, and focusing on business and private banking\nas it aims for hefty fraudulent transfer bounties.\n\nBut this is not where TrickBot’s diverse interests stop. As the value and popularity of\ncryptocurrency continues to rapidly rise, so does this cybergang’s interest in obtaining\ncryptocoins in the easiest way possible: theft. TrickBot configurations have featured popular\ncryptocurrency exchange URLs since about mid-2017, and we at IBM X-Force have been\nlooking at the malware’s most recent attack schemes to steal coins from infected users.\n\nThere are several types of cryptocurrency platforms, each offering a variety of services, such\nas trading one coin for another, transferring coins between different wallets and buying coins\nwith a credit card. According to our analysis, TrickBot is actively targeting one such service\nthat enables users to purchase bitcoin and bitcoin cash by credit card.\n\nThe attacks we have looked into are facilitated by TrickBot’s webinjections, getting in the\nmiddle of the flow of a legitimate payment card transaction. In the normal payment scenario,\na user looking to buy coins provides his or her public bitcoin wallet address and specifies the\namount of bitcoin to purchase. When submitting this initial form, the user is redirected from\nthe bitcoin exchange platform to a payment gateway on another domain, which is operated\nby a payment service provider. There, the user fills in his or her personal information, as well\nas credit card and billing details, and confirms the purchase of coins.\n\nThis is where TrickBot hijacks the coins. This particular attack targets both the bitcoin\nexchange website and that of the payment service to grab the coins and route them to an\nattacker-controlled wallet.\n\nWatch the on-demand webinar: The Evolution of TrickBot Into the Next Global Banking\nThreat\n\n## Webinjection Basics\n\nThe inner workings of TrickBot’s cryptocoin attack rely on an existing TrickBot attack tactic:\nwebinjections. This age-old favorite tool of many banking Trojans is a form of man-in-thebrowser attack that enables malware to modify webpages presented to the user. Malware\nauthors achieve this by placing hooks on key application programming interface (API)\nfunctions inside the browser. These hooks intercept information going from and back to the\nbrowser and alter it midway.\n\nThe code that dictates which webpages should be attacked is usually not part of the\nmalware’s executable code. Rather, it is in a configuration stored separately in the form of\nrules, each one defining which URL is to be modified and how. These rules usually contain\n\n\n-----\n\nlarge sections of malicious JavaScript code that is responsible for visually modifying the\npage, sending sensitive user information to the fraudulent server, etc.\n\nUnlike most financial malware, TrickBot does not expose the injected code in the\nconfiguration itself. Instead, a web URL of a remote command-and-control (C&C) server\ncorresponds with every targeted URL. This modus operandi is called serverside webinjection\nand has been used by TrickBot since its launch in 2016. Serverside webinjections allow\nTrickBot to modify the injected code on its server in real time without having to update the\nconfiguration on the infected machine.\n\n## The Target: Bitcoin\n\nTo see the attack rules TrickBot has in store for any targeted site, we must first access the\nconfiguration. TrickBot keeps its configuration encrypted on the infected machine. To read it\nand unveil the list of targeted entities, one can either decrypt the configuration file or inspect\nit in the browser’s memory after the malware has already decrypted it.\n\nThe relevant part of TrickBot’s configuration for this attack shows that the scheme involves\ntwo webpages that, together, make up the coin purchase process. The first is a page where\nthe user provides his or her bitcoin wallet address and the desired amount of bitcoin to\npurchase. The second is a page where the payment process is executed.\n\nIn the image below, we can see the exact set of rules in TrickBot’s configuration, each one\nmatching a targeted page with a URL on TrickBot’s server. This way, TrickBot fetches the\nappropriate webinjection to alter the legitimate transaction and do its bidding instead.\n\n_Figure 1: Attack rules in TrickBot’s configuration (source: X-Force Research)_\n\n\n-----\n\nTo enable it to control the infected machine s web browser, TrickBot s modules are injected\ninto the browser ahead of time and already have hooks in place to launch webinjections.\n\n_Figure 2: TrickBot dynamic link libraries (DLLs) loaded into the browser_\n\n_Figure 3: PR_Read and PR_Write functions with TrickBot’s hooks in place_\n\nTo view what was happening during the web session, we sniffed HTTP network traffic on the\ninfected machine when opening the targeted URL. This revealed the attack flow of the\nmalware’s dynamic injection method, which TrickBot refers to as “dinj.”\n\nFor every resource that TrickBot wishes to replace — an HTML page, a JavaScript or a CSS\n[file — an HTTP POST request is sent to the C&C server with the following attributes of that](https://securityintelligence.com/tricks-of-the-trade-a-deeper-look-into-trickbots-machinations/)\nresource:\n\n1. “sourcelink,” the complete URL of the resource to be replaced;\n2. “sourcequery,” the browser’s HTTP request for the resource (including all headers);\n\nand\n3. “sourcehtml,” the original code as would be returned by the legitimate host.\n\n## Injection No. 1: Gathering Victim Data\n\nOne of the resources TrickBot replaced is the HTML code of the bitcoin website. The code is\nbeing switched up to gather data on the victim’s cryptocoin wallet and the number of coins to\nbe purchased.\n\n\n-----\n\nUsing Wireshark, we can see that the page is sent to TrickBot s C&C and that a the attack\nserver returned a modified version.\n\n_Figure 4: HTTP Packets capture from the targeted site sent to C&C_\n\n_Figure 5: The injection request for the HTML page of the targeted site_\n\nTo point out the injected script, we performed a simple diff between the original page source\nand the one returned by TrickBot’s C&C.\n\n_Figure 6: Diff between original HTML page and one returned by TrickBot_\n\n### Flow of Events\n\n\n-----\n\nThe script first fetches an HTML element with ID btcAddress. This element is an input field\nin which the user fills in his or her wallet address. If this element is found on the page, the\nmalware performs the following actions to alter the interaction with the targeted webpage:\n\n1. Any existing logic attached to the enter key (key code 13) is eliminated, probably to\n\nlimit the form submission via keyboard and make sure the victim has to click a TrickBotgenerated submit button.\n2. The original submit button is cloned, the new copy is placed in the HTML document\n\nobject model (DOM) and the original button is hidden from the victim.\n3. A fraudulent form-submission process is registered to the new submit button with an\n\nevent listener. Upon clicking, the wallet address and the desired amount of bitcoin\nentered by the user are fetched and sent to the malware server using an AJAX request.\n\n_Figure 7: Part of the injected code TrickBot used to hijack cryptocoin purchase transactions_\n_(code comments added by X-Force research)_\n\nThe injection into the HTML page is used only to collect information. The attacker can use\nthis information — the legitimate user’s bitcoin wallet address and the bitcoin amount to\npurchase — to decide whether to proceed with a fraudulent operation.\n\n\n-----\n\nLater on, after being redirected to the payment process, TrickBot will gather more\ninformation. This is probably done to allow a future account takeover attack, which will\nenable the fraudsters to perform a purchase/coin transfer from a machine they control using\nthe legitimate user’s wallet credentials and payment card details.\n\n## Injection No. 2: Stealing the Coins\n\nThe second phase of the TrickBot attack facilitates the theft of the cryptocoins by preying on\nthe web logic defined by the payment provider for legitimate online transactions.\n\nThe actual bitcoin theft is once again facilitated by a webinjection that modifies another\nresource of the site, “bundle.js,” which contains most of the payment processing logic.\n\n_Figure 8: bundle.js is loaded by the original HTML page_\n\n_Figure 9: The dynamic injection request to bundle.js_\n\nBy checking the diff between the original version of bundle.js and the modified one, we\nnoticed that the function sendPaymentRequest had been changed. This function is\nresponsible for sending payment requests to the payment service provider, and it has been\nmodified to contain a hardcoded bitcoin address instead of the one inserted by the user.\n\n_Figure 10: sendPaymentRequest before and after modification by TrickBot_\n\nThe “walletaddress” attribute is the address of the bitcoin wallet to which the purchased coins\nwill be delivered after the deal is complete. This injection ensures that the bitcoin will not be\ndelivered to the original address provided by the victim, but to an address belonging to\nTrickBot’s operators.\n\n\n-----\n\nFrom this point on, the victim is led through several steps of identification in which he or she\nprovides a phone number, an email address, a selfie photo with the credit card he or she\nwants to use, and a photo of his or her national ID card.\n\nHowever, these steps only serve to verify the personal identity and not the ownership of the\nwallet address. By now, the wallet address has already been set and will not be shown to the\nvictim again. Thus, the victim’s credit card will be charged and he or she will believe the deal\nwas successful, expecting to see the new coins in his or her wallet. The bitcoin will never\nreach the designated wallet, however, but will instead be delivered to a wallet belonging to\none of TrickBot’s operators.\n\n## More to Come?\n\nHaving researched the attack tactics TrickBot applied to this cryptocurrency coin theft, we\ncan see that, while it relies on existing mechanisms, the scheme required extensive research\nof the targeted sites, their web logic and the security controls they use. It highlights what we\nalready know about this malware gang: It continues to study new targets and expand its\nreach.\n\nAs the theft of cryptocurrency becomes increasingly popular among financial malware\noperators, we expect to see a many more campaigns targeting platforms and service\nproviders in the cryptocurrency sector.\n\nTo mitigate the risk of financial malware, organizations can leverage the adaptive controls\n[provided by IBM Trusteer’s Pinpoint Detect.](https://www.ibm.com/us-en/marketplace/trusteer-pinpoint-malware-detection)\n\n## Indicators of Compromise\n\n[In this study, we used a TrickBot sample with MD5 039bc78ca0801006cc33485bc94f415c.](https://www.virustotal.com/#/file/333d64540ff170767cc346e6a747475bf883eb7b05e6baceb30d01fc5dd15082/detection)\n\nWatch the on-demand webinar: The Evolution of TrickBot Into the Next Global Banking\nThreat\n\n[Ophir Harpaz](https://securityintelligence.com/author/ophir-harpaz/)\nCybercrime Researcher\n\nOphir Harpaz is a contributor for SecurityIntelligence.\n\n\n-----\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-02-15 - TrickBot’s Cryptocurrency Hunger- Tricking the Bitcoin Out of Wallets.pdf"
    ],
    "report_names": [
        "2018-02-15 - TrickBot’s Cryptocurrency Hunger- Tricking the Bitcoin Out of Wallets.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673535669,
    "ts_updated_at": 1743041139,
    "ts_creation_date": 1653704956,
    "ts_modification_date": 1653704956,
    "files": {
        "pdf": "https://archive.orkl.eu/dd8abf02b102ead29d6c09259c1f2071bbdb3d55.pdf",
        "text": "https://archive.orkl.eu/dd8abf02b102ead29d6c09259c1f2071bbdb3d55.txt",
        "img": "https://archive.orkl.eu/dd8abf02b102ead29d6c09259c1f2071bbdb3d55.jpg"
    }
}