{
    "id": "a0e2c36b-4925-4adf-82d3-8c824b02fd72",
    "created_at": "2023-01-12T15:09:00.444733Z",
    "updated_at": "2025-03-27T02:05:18.307108Z",
    "deleted_at": null,
    "sha1_hash": "1743b0bbd200d8359344c8466396e9771b755452",
    "title": "2020-12-17 - Additional Analysis into the SUNBURST Backdoor",
    "authors": "",
    "file_creation_date": "2022-05-27T21:27:38Z",
    "file_modification_date": "2022-05-27T21:27:38Z",
    "file_size": 3125561,
    "plain_text": "# Additional Analysis into the SUNBURST Backdoor\n\n**[mcafee.com/blogs/other-blogs/mcafee-labs/additional-analysis-into-the-sunburst-backdoor/](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/additional-analysis-into-the-sunburst-backdoor/)**\n\nDecember 17, 2020\n\n## Executive Summary\n\nThere has been considerable focus on the recent disclosures associated with SolarWinds,\nand while existing analysis on the broader campaign has resulted in detection against\nspecific IoCs associated with the Sunburst trojan, the focus within the Advanced Threat\nResearch (ATR) team has been to determine the possibility of additional persistence\nmeasures. Our analysis into the backdoor reveals that the level of access lends itself to the\nassumption that additional persistence mechanisms could have been established and some\ninferences regarding the intent from adversaries;\n\nAn interesting observation was the check for the presence of SolarWinds’ Improvement\nClient executable and it’s version “3.0.0.382”. The ImprovementClient is a program that\ncan collect considerable information such as count of Orion user accounts by\nauthentication method and data about devices and applications monitored.\n\n\n-----\n\nObservation of the http routine was the search for certain keywords in the http-traffic\nthat might indicate the adversary was looking into details/access of Cloud and/or\nwireless networks of their victims.\nEven if a victim is using a Proxy-server with username and password, the backdoor is\ncapable of retrieving that information and using it to build up the connection towards\nthe C2.\n\n## Available Resources\n\nAlthough this analysis will focus on the premise that the backdoor supports the feasibility of\nestablishing additional persistence methods we recognize the importance of providing\nassurance regarding coverage against available indicators. To that end the following\nresources are available:\n\nKB93861: McAfee coverage for SolarWinds Sunburst Backdoor:\n\n[https://kc.mcafee.com/corporate/index?page=content&id=KB93861](https://kc.mcafee.com/corporate/index?page=content&id=KB93861)\nSUNBURST Malware and SolarWinds Supply Chain Compromise : Detailing the\nprotection summary, but also how to use MVISION EDR or MAR to search for\nSUNBURST: https://www.mcafee.com/blogs/other-blogs/mcafee-labs/sunburstmalware-and-solarwinds-supply-chain-compromise/\nMVISION Insights Campaign: SolarWinds Supply Chain Attack Affecting Multiple\nGlobal Victims With SUNBURST Backdoor. This resource provides up to date tracking\non the prevalence of available indicators based on geography and sector of potential\ntargets: [https://www.mcafee.com/enterprise/en-us/lp/insights-preview.html#](https://www.mcafee.com/enterprise/en-us/lp/insights-preview.html#)\n\nAdditional resources will become available as analysis both conducted by McAfee\nresearchers, and the wider community becomes available.\n\n## Backdoor Analysis\n\nThere exists excellent analysis from many of our industry peers into the SUNBURST trojan,\nand the intention here is not to duplicate findings but to provide analysis we have not seen\npreviously covered. The purpose is to enable potential victims to better understand the\ncapabilities of the campaign in an effort to consider the possibility that there are additional\npersistence mechanisms.\n\nFor the purposes of this analysis our focus centered upon the file\n“SolarWinds.Orion.Core.BusinessLayer.dll“, this particular file, as the name suggests, is\nassociated with the SolarWinds ORION software suite and was modified with a class added\ncontaining the backdoor “SunBurst”.\n\n\n-----\n\nFigure 1 Added module and dependencies\nA deeper dive into the backdoor reveals that the initial call is to the added class\n“OrionImprovementBusinessLayer” which has the following functions:\n\nFigure 2 Start of the\n\ninserted class\n\n\n-----\n\nThe class starts with a check to see if the module is running and, if not, it will start the service\nand thereafter initiate a period of dormancy.\n\nFigure 3 Sleep sequence of backdoor\nAs was detailed by FireEye, this period of sleep can range from minutes up to two weeks.\nThe actual time period of dormancy is dependent on the checks that must be passed from\nthe code, like hash of the Orion process, write-times of files, process running etc. A sleep\nperiod of this length of time is unusual and speaks to a very patient adversary.\n\nThe most important strings inside the backdoors are encoded with the DeflateStream Class\nof the .NET’s Compression library together with the base64 encoder. By examining the blocklist, we discover findings that warrant further inspection. First entries are the local-IP address\nranges and netmasks:\n\n10.0.0.0 255.0.0.0\n172.16.0.0 255.240.0.0\n192.168.0.0 255.255.0.0\n\nFollowed by the IPv6 local addresses equivalents:\n\nfc00::,fe00::, fec0::,ffc0::,ff00::,ff00::\n\nNext, there is a list of IP-addresses and their associated subnetmasks. We executed a whois\non those IP-addressees to get an idea of whom they might belong to. There is no indication\nas to the reason that the following IPs have been inserted into the blocklist, although the\nnetmasks implemented in certain entries are ‘quite’ specific, therefore we have to assume\nthe attackers were intentional in their desire to avoid certain targets.\n\n\n-----\n\nAssuming that the victim is not within the block list, the sample will then proceed to create\nthe named pipe 583da945-62af-10e8-4902-a8f205c72b2e. This is done to ensure that only\none instance of the backdoor is running. We were able to verify this through replication we\ncarried out within our own environment.\n\nFigure 4 Running of Backdoor\nWhen we ran the backdoor, we were able to confirm that this value is hardcoded in the code,\nand once the dormancy period passed the service is started and named pipe is created. At\nthis point, the backdoor will also create a unique UserID MD5 value for the system it is\ninstalled on as depicted within figure 5.\n\n\n-----\n\nFigure 5 Creation of User-ID\nThis particular routine will initially read the Device-info of the system but ignore the loopback\ninterfaces (part of the code of the ReadDeviceInfo routine that mentions “Select * From\nWin32_NetworkAdapterConfiguration where IPEnabled=true” ). The Device-info will then be\ncombined with the domain name, followed by a value from the registry key\n(HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography). This information is then\nused to create an MD5 value of that string.\n\nThe module will start the ‘update’ routine. This routine is a continuous loop designed for\nverification against, for example, unwanted services that could potentially be used against\ndetection of the backdoor as depicted in figure 6.\n\n\n-----\n\nFigure\n\n6 Update Loop\n\n## Information Gathering\n\nThe backdoor gathers information from the system. The following information is gathered by\na routine called “CollectSystemDescription”, some examples include;\n\nOS version, major /minor – is it 32 or 64 bits\nNetwork configs, info on IP, NetBIOS, IPV6 etc.\nHost, SID & Username & System directory. In particular the SID for the Administrator\naccount is searched for.\n\nThere exists other subroutines to collect additional data, for example enumerating the\ninformation from the network-adaptors, the backdoor uses the\nGetNetworkAdapterConfiguration routine. The routine is gathering the following information:\n\n\n-----\n\nFigure 7 Gathering network information\nIn order to check if certain ‘unwanted’ services are running, the backdoor enumerates the\nservices, creates a hashlist and compares them with a hard-coded set of these values. The\n‘update’ routine will exit once a ‘block-listed’ process id discovered. The backdoor will\nattempt to stop these services by entering a value in the registry for that service that will\ndisable that service. The update routine will check again and continue this process until all\nunwanted processes are disabled.\n\nAnother capability of the backdoor is to start/stop tasks:\n\n\n-----\n\nFigure 8 Kill/Run task routine\nOther functionalities we observed in the code are:\n\nSetTime\nCollectSystemDescription\nUploadSystemDescription\nGetProcessByDescription\nGetFileSystemEntries\nWriteFile\n\n\n-----\n\nFileExists\nDeleteFile\nGetFileHash\nReadRegistryValue\nSetRegistryValue\nDeleteRegistryValue\nGetRegistrySubKeyAndValueNames\nReboot\n\nAn interesting observation was the check for the presence of SolarWinds’ Improvement\nClient executable and it’s version “3.0.0.382”.\n\nFigure 9 Searching for ImprovementClient\nThe ImprovementClient is a program that can collect the following information (source\n[SolarWinds) :](https://support.solarwinds.com/SuccessCenter/s/article/Orion-Improvement-Program?language=en_US)\n\nThe SWID (SolarWinds ID) associated with any SolarWinds commercial licenses\ninstalled\nThe email address provided to the installer during installation\nUnique identifier of the downloaded installer\nVersions of all Orion products installed\nOperating system version\nCPU description and count\nPhysical memory installed and percent used\nTime zone\nDates when you logged in to the Orion website\nLicensing information of other SolarWinds Orion products locally installed\nRow counts for database tables\nCount of monitored nodes by polling protocol\nCount of Orion user accounts by authentication method\nNetwork discovery scheduling information (not results)\nData about devices and applications monitored:\n\nVendor\nModel\nOS/Firmware version\nCount\nAbstract configuration information, such as number of websites hosted\n\n\n-----\n\nData about the SolarWinds product:\n\nFeature usage statistics\nPerformance statistics\nHardware and OS platform description\n\nAnother observation of the http routine was the search for certain keywords in the http-traffic\nthat might indicate the adversary was looking into details/access of cloud and/or wireless\nnetworks of their victims by using the SolarWinds’ modules that are installed to\nmonitor/administer these kinds of instances. Managing the network using SolarWinds’ Orion\nis executed by using a browser and localhost that is hosting the webserver. Reading out the\ncertificate values and search for these keywords in the http-traffic would have gained this\ninformation.\n\nFigure 10 Search for keywords\n\n## Network / DGA\n\nAfter all checks and routines have passed, the backdoor will use a domain generating\nalgorithm (hereafter DGA) to generate a domain. Example of the part of the DGA code:\n\nFigure 11 DGA code example\n\n\n-----\n\nWhen the domain is successfully reached, the routine called Update contains a part that will\nact on this and start a new thread firing off the routine “HttpHelper.Initialize”. In the below\nscreenshot we can observe that flow:\n\nFigure 12 DGA, HttpHelper\nThe code shows that when the dnsrecord equals the domain and can be reached, the new\nthread will start in the background.\n\nThe ‘HttpHelper’ class/routine is responsible for all the C2 communications:\n\nFigure 13 HttpHelp\n\n\n-----\n\nEven if a victim is using a Proxy-server with username and password, the backdoor is\ncapable of retrieving that information and using it to build up the connection towards the C2.\nIt then uses a routine called “IWebProxy GetWebProxy” for that:\n\nFigure 14 Getting proxy username and pwd\nThe DGA-generated C2s are subdomains of: avsvmcloud[.]com.\n\nAn example of how these domains would look:\n\n02m6hcopd17p6h450gt3.appsync-api.us-west-2.avsvmcloud.com\n039n5tnndkhrfn5cun0y0sz02hij0b12.appsync-api.us-west-2.avsvmcloud.com\n043o9vacvthf0v95t81l.appsync-api.us-east-2.avsvmcloud.com\n04jrge684mgk4eq8m8adfg7.appsync-api.us-east-2.avsvmcloud.com\n04r0rndp6aom5fq5g6p1.appsync-api.us-west-2.avsvmcloud.com\n04spiistorug1jq5o6o0.appsync-api.us-west-2.avsvmcloud.com\n\nInspecting the CNAME’s from the DGA-generated C2’s we observed the following domainnames:\n\nfreescanonline[.]com\ndeftsecurity[.]com\nthedoccloud[.]com\nwebsitetheme[.]com\nhighdatabase[.]com\nincomeupdate[.]com\ndatabasegalore[.]com\npanhardware[.]com\nZupertech[.]com\nVirtualdataserver[.]com\ndigitalcollege[.]org\n\nIn the forementioned HTTP handler code, we discovered paths that might be installed on the\nC2’s for different functions:\n\nswip/upd/\nswip/Events\n\n\n-----\n\nswip/Upload.ashx\n\nOnce the backdoor is connected, depending on the objectives from the adversaries, multiple\nactions can be executed including the usage of multiple payloads that can be injected into\nmemory. At the time of writing, details regarding the ‘killswitch’ against the above domain will\nprevent this particular backdoor from being operational, however for the purpose of this\nanalysis it demonstrates the level of access afforded to attackers. While the efforts to\nsinkhole the domain are to be applauded, organisations that have been able to identify\nindicators of SUNBURST within their environment are strongly encouraged to carry out\nadditional measures to provide themselves assurances that further persistent mechanisms\nhave not been deployed.\n\n[Christiaan Beek Lead Scientist & Sr. Principal Engineer](https://www.mcafee.com/blogs/author/christiaan-beek/)\nChristiaan Beek is the Lead Scientist & Sr. Principal Engineer of the Enterprise Office of the\nCTO. He is leading the strategic threat intelligence research with a focus on inventing...\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-12-17 - Additional Analysis into the SUNBURST Backdoor.pdf"
    ],
    "report_names": [
        "2020-12-17 - Additional Analysis into the SUNBURST Backdoor.pdf"
    ],
    "threat_actors": [],
    "ts_created_at": 1673536140,
    "ts_updated_at": 1743041118,
    "ts_creation_date": 1653686858,
    "ts_modification_date": 1653686858,
    "files": {
        "pdf": "https://archive.orkl.eu/1743b0bbd200d8359344c8466396e9771b755452.pdf",
        "text": "https://archive.orkl.eu/1743b0bbd200d8359344c8466396e9771b755452.txt",
        "img": "https://archive.orkl.eu/1743b0bbd200d8359344c8466396e9771b755452.jpg"
    }
}