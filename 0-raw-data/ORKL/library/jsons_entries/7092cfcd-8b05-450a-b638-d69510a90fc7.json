{
    "id": "7092cfcd-8b05-450a-b638-d69510a90fc7",
    "created_at": "2023-01-12T15:10:30.800621Z",
    "updated_at": "2025-03-27T02:10:04.2973Z",
    "deleted_at": null,
    "sha1_hash": "00269fdd3e1a3d9c8f2f578ad968825aba577699",
    "title": "2020-05-28 - Valak- More than Meets the Eye",
    "authors": "",
    "file_creation_date": "2022-05-28T19:02:00Z",
    "file_modification_date": "2022-05-28T19:02:00Z",
    "file_size": 5685281,
    "plain_text": "# Valak: More than Meets the Eye\n\n**cybereason.com/blog/valak-more-than-meets-the-eye**\n\nWritten By\nCybereason Nocturnus\n\nMay 28, 2020 | 13 minute read\n\n**Research by: Eli Salem, Lior Rochberger and Assaf Dahan**\n\n_[Check out a condensed, high level version of this report on our threat alerts page.](https://www.cybereason.com/threat-alert-valak)_\n\n## Key Findings\n\n**The Valak Malware: The Valak Malware is a sophisticated malware previously classified as a malware loader. Though it was first**\nobserved in late 2019, the Cybereason Nocturnus team has investigated a series of dramatic changes, an evolution of over 30 different\nversions in less than six months. This research shows that Valak is more than just a loader for other malware, and can also be used\nindependently as an information stealer to target individuals and enterprises.\n**Targeting Enterprises: More recent versions of Valak target Microsoft Exchange servers to steal enterprise mailing information and**\npasswords along with the enterprise certificate. This has the potential to access critical enterprise accounts, causing damage to\norganizations, brand degradation, and ultimately a loss of consumer trust.\n**Targets US and Germany: This campaign is specifically targeting enterprises in the US and Germany.**\n**With a Rich Modular Architecture: Valak’s basic capabilities are extended with a number of plugin components for reconnaissance and**\ninformation stealing.\n**Using Fast Development Cycles: Valak has evolved from a loader to a sophisticated, multi-stage modular malware that collects plugins**\nfrom its C2 server to expand its capabilities. The Cybereason Nocturnus team has observed over 30 different versions in about 6 months.\n\n\n-----\n\n**es g ed o Stea t** a a s a stea t y a a e t at uses ad a ced e as e tec ques e S a d d g co po e ts t e\nregistry. In addition, over time the developers of Valak chose to abandon using PowerShell, which can be detected and prevented by\nmodern security products.\n\n## table of contents\n\n Introduction\n\n[When Valak was first discovered in late 2019, it was classified as a loader and used in multiple campaigns primarily targeting the US. It was](https://twitter.com/malware_traffic/status/1207824548021886977)\n[often paired with Ursnif (aka.](https://www.cybereason.com/blog/new-ursnif-variant-turns-to-cryptocurrency-as-banks-become-more-secure) [Gozi) and](https://malpedia.caad.fkie.fraunhofer.de/details/win.gozi) [IcedID. Upon investigation by Cybereason Nocturnus in April 2020, Valak was identified as being used](https://malpedia.caad.fkie.fraunhofer.de/details/win.icedid)\nin campaigns mainly targeting the US and Germany. The campaigns involved new versions, revealing that the malware authors have been\nworking on a better, improved version of the malware quickly. Over thirty different versions of the malware were found, revealing tremendous\nimprovements in a very short period of time. Valak’s key features include:\n\n**Fileless stage: Valak’s contains a fileless stage in which it uses the registry to store different components**\n**Reconnaissance: It collects user, machine, and network information from infected hosts**\n\n**Geolocation Aware: It checks the geo-location of the victim’s machine**\n\n**ScreenCapture: It takes screenshots of the infected machine**\n**Download Secondary Payloads: It downloads additional plugins and other malware**\n**Enterprise-aware: It targets administrators and enterprises networks**\n\n**Infiltrates the Exchange Server: It collects and steal sensitive information from the Microsoft Exchange mail system, including**\ncredentials and the domain certificate\n\nAmong it’s improvements, the most important and interesting addition to the newer versions of Valak is a component called “PluginHost”.\n_PluginHost provides communication with the C2 server and downloads additional plugins under the name “ManagedPlugin”. Among the_\nplugins observed are “Systeminfo” and “Exchgrabber”, both of which appear to specifically target enterprises.\n\nIn this research, we evaluate the differences between the old and new versions of Valak and elaborate on the malware capabilities, its\ninfrastructure, and its connection to other malware.\n\n## Threat Analysis\n\n**Initial infection**\n\nIn these campaigns, the most common infection vector is via Microsoft Word documents embedded with malicious macro code. The contents\nof the documents are in English and German depending on the target.\n\n_The content of the phishing_\n\n_documents._\n\nMalicious macro code is used to download a DLL file with .cab extension named “U.tmp” and saved into the temp folder.\n\nDLL file download address: “hxxp://v0rzpbu[.]com/we201o85/aio0i32p.php?l=hopo4.cab”\n\nAfter downloading the DLL, the code launches the malicious DLL using “regsvr32.exe”.\n\n_Initial infection as shown in the_\n\n_Cybereason Defense Platform._\n\n\n-----\n\ne e ecuted, t e d ops a d au c es us g a ec ca s stage o t e a a a a e uses a a c ous Ja aSc pt e t\na random name that changes per execution. In the example below the name of the JavaScript file is “sly4.0”.\n\n_The DLL dropping the_\n\n_JavaScript file._\n\n## Multi-stage Attack: Step-by-step Analysis of Valak\n\n**First Stage: Gaining Initial Foothold**\n\n_Attack flow for the first stage of_\n\n_Valak._\n\nThe downloaded JavaScript code, “sly4.0”, contains a variable called “PRIMARY_C2” that holds multiple fake and legitimate domains,\nincluding Google, Gmail, Avast, and Microsoft. The domain list varies between samples.\n\n\n-----\n\n_script sly4.0._\n\nValak creates connections to the different C2 servers in the list with two predefined URIs:\n\nOne URI is used to download an encoded file named “project.aspx” [saved as project[1].htm].\n\n*in version 30, the file was renamed to “rpx.aspx”.\n\nOne URI is used to download an encoded file named “a.aspx” [saved as a[1].htm].\n\n*in version 30, the file was renamed to “go.aspx”.\n\n\n_Malware configuration in the_\n\n_URI embedded in the script._\n\n_URI embedded in the script._\n\n\nBoth files are decoded by the malware using Base64 and an XOR cipher. The key is a combination of a predefined string and information\ncollected from memory during runtime.\n\n_Function “rot13_str” decodes a_\n\n_string using XOR._\n\n_The code for downloading the_\n\n_encoded file and decoding it with the first function (rot13_str) and Base64._\n\n_The “GetID” functions used to_\n\n_create the XOR key and collect information about the user._\n\nThe malware sets information like the C2 server, ID, the downloaded payload, and the decoded project.aspx in a registry key under\n“HKCU\\Software\\ApplicationContainer\\Appsw64”. These keys will be used in the second stage.\n\n\n-----\n\n_Files and registry keys_\n\n_written by Valak._\n\nAfter downloading the payloads and setting the registry keys and values, Valak sets it’s persistence via a scheduled task.\n\n_Creation of the_\n\n_scheduled task to establish persistence._\n\n[The scheduled task is set to launch wscript that executes JavaScript stored as an Alternative Data Stream named “Default2.ini” in the file](https://attack.mitre.org/techniques/T1096)\n“Classic2Application.bz”.\n\n_The execution of the scheduled task as shown in the Cybereason_\n\n_Defense Platform._\n\nThe script in the ADS (“Default2.ini”) executes the content of the registry key, “HKCU\\Software\\ApplicationContainer\\Appsw64\\ServerUrl”,\nwhich holds the contents of “project.aspx”, the second stage JavaScript file.\n\n_Registry modifications_\n\n_done by Valak._\n\n## Second Stage: Fetching and Executing Secondary Payloads\n\nIn the first stage, Valak laid the foundation for the attack. In the second stage, it downloads additional modules for reconnaissance activity and\nto steal sensitive information.\n\nThe two payloads (“project.aspx” and “a.aspx”) and the configuration in the registry keys are used in the second stage to perform malicious\nactivities.\n\n\n-----\n\n_Attackflow for the second_\n\n_stage._\n\n## Second Stage JS - Project.aspx\n\nThe “project.aspx”, or as we refer to it, the second stage JS, is a JavaScript file that looks very similar to the first stage JavaScript (“sly4.0”).\nHowever, on closer inspection it contains additional functions.\n\nThe script is executed by the scheduled task used to maintain persistence, with its main goal being:\n\nExecute Pluginhost.exe, the plugin management component.\nDownload and parse additional payloads from the C2.\n\nSave the payloads as Alternate Data Streams and set scheduled tasks to run them.\n\n_Configuration section_\n\n_of the second stage JS._\n\nIn the second stage, the configuration file has been altered to contain a unique “Client_ID” and a different file that it will try to download called\n“bounce.aspx”.\n\nStage 2 also contains three unique functions, “CreateExecJob”, “CreateOleExecJob” and “LaunchPlugin”.\n\nThese functions are called from the “ParseTask” function, and receive the parsed tasks from the C2.\n\n\n-----\n\n_The “ParseTask” function_\n\n_checks the payload._\n\nIf the malware downloads a payload that starts with the word “ODTASK”, it calls “CreateOleExecJob”, which writes the payload as an ADS of\nthe file “C:\\\\Users\\\\Public\\\\PowerManagerSpm.jar” and creates a scheduled task “PerfWatson_%taskname%” to run it.\n\n_The “CreateOleExecJob”_\n\n_function._\n\nIf the malware receives a content start with the word “PLUGIN”, it calls “LaunchPlugin”, which executes the PluginHost.exe file using WMI with\nthe content as an argument.\n\n_The “LaunchPlugin”_\n\n_function._\n\n\n-----\n\nt e a a e ece es a co te t sta t g t t e o d _S_, t ca s C eate _ecJob,_ c tes t e co te t as a S o t e e\n“C:\\\\Users\\\\Public\\\\PowerManagerSpm.jar” and creates a scheduled task “PowerUtility_%taskname%W” to run it.\n\n_The “CreateExecJob”_\n\n_function._\n\nOur analysis reveals that this time, the payload downloaded by Valak was IcedID. However, the payload can vary, as the attackers can\ndownload other payloads to the infected system.\n\n[In previous infections, Valak downloaded different remote administration tools like putty.exe and](https://en.wikipedia.org/wiki/PuTTY) [NetSupport Manager.](https://en.wikipedia.org/wiki/NetSupport_Manager)\n\n_The process tree to_\n\n_establish persistence as seen in the Cybereason Defense Platform._\n\n## PluginHost - a.aspx\n\nThe decoded “a.aspx” is saved in the temporary folder as %TEMP%\\<ID>.bin. This file, internally named “PluginHost.exe”, is an executable\nfile, and will be used to manage additional components.\n\nValak’s Modular Plugin Architecture\n\n## PluginHost - Plugin Management Component\n\nThe functionality of the executable “PluginHost.exe” is divided into four classes: Bot, HTTPClient, Program and Utils, which will allow it to\nperform its main goal of downloading and loading additional components of the malware.\n\n**The Bot Class:**\n\nThe bot class is responsible for reading from several registry entries set by the first stage.\n\nGetID() reads from the registry entry “SetupServiceKey”, which holds the ID.\nGetC2() reads from the registry entry “ShimV4”, which holds the C2 domain.\n\nBoth functions use the Utils class to read registry entries.\n\n\n-----\n\n_from the registry._\n\n_function in the Utils class._\n\n**The HTTPClient Class:**\n\nThe HTTPClient class contains two functions, post and GetPluginBytes.\n\n\n_GetID() andGetC2() reading_\n\n_The RegistryReadInfo()_\n\n\n**The GetPluginBytes() function gets the C2 domain using GetC2() and adds an embedded URI. The URL is used to download an additional**\nmodule for the plugin.\n\n_GetPluginBytes_\n\n_function used to download the plugin._\n\n**The Program Class:**\n\nThe Program class contains the main function of the file main(). This function executes the function GetPluginBytes() to download the module\ncomponents with type “ManagedPlugin”. These components will be loaded reflectively to the executable’s memory and expand the plugin\ncapabilities.\n\n_PluginHost’s main function_\n\n_downloads the ManagedPlugin module._\n\n**The Utils Class:**\n\nThe Utils class contains several maintenance functions used by the other classes.\n\n## ManagedPlugin - Plugins Suite for Enhanced Capabilities\n\nWhen referring to additional plugins, it is worth noting that in early versions of Valak the plugins were downloaded by the second stage JS via\nPowerShell. More recent versions of Valak abandoned the popular yet easily detectable PowerShell downloader approach and transitioned to\nPluginHost as a means of managing and downloading additional payloads. This transition indicates that the Valak authors are looking for\nstealthier approaches and ways to improve their evasion techniques.\n\nDuring this analysis, we discovered several different modules with the same internal name, “ManagedPlugin.dll”.\n\nThese modules are downloaded and loaded by “PluginHost.exe”.\n\n**Systeminfo: responsible for extensive reconnaissance; targets local and domain admins**\n**Exchgrabber: aims to steal Microsoft Exchange data and infiltrates the enterprises mail system**\n\n**IPGeo: verifies the geolocation of the target**\n\n\n-----\n\n**oc** **o co ects** o at o about t e ected ac e s u g p ocesses\n\n**Netrecon: performs network reconnaissance**\n\n**Screencap: captures screenshots from the infected machine**\n\nAmong these components, some focus on one single, specific activity to achieve their goal and are relatively less robust than others when it\ncomes to capability and potential impact. This includes ipgeo, procinfo, netrecon and screencap.\n\n_The Ipogeo module, which_\n\n_collects information using an IP discovery service._\n\n_The Procinfo_\n\n_module, which collects information about the running processes._\n\n_The Netrecon module, which_\n\n_collects network information._\n\n_The Screencap module,_\n\n_which takes screenshots of the infected machine._\n\nBelow is a deep dive of “systeminfo” and “exchgrabber”, which are more advanced and complex than the aforementioned plugin\ncomponents.\n\n**ManagedPlugin: Systeminfo, the Reconnaissance Module**\n\n“Systeminfo” shares many similarities to “PluginHost.exe” when it comes to class names. However, unlike “PluginHost”, it contains several\nreconnaissance functions that focus on gathering information about the user, the machine, and existing AV products.\n\n\n-----\n\n_The plugin components in Valak._\n\nThe module gathers information about the user and attempts to verify whether this is a local admin or a domain admin. This shows that after\ninfecting the machine, Valak chooses to target mainly administrators and domain admins. This indicates a propensity to target higher profile\naccounts such as enterprise admins.\n\n_The ManagedPlugin_\n\n_(SystemInfo), which determines if the user is a local or domain admin._\n\nThe module attempts to find whether the infected machine has any security products installed using the AntivirusSoftware() function. The\ninformation collected about installed AV programs is gathered using the WMI query “SELECT * FROM AntiVirusProduct”.\n\n_ManagedPlugin (SystemInfo)_\n\n_checks for antivirus products._\n\nThe module also collects the physical address (MAC) and the IP address of the infected machine.\n\n\n-----\n\n_The ManagedPlugin_\n\n_(SystemInfo) collects the machine’s physical address._\n\nAdditional reconnaissance activity occurs with several other functions, including:\n\n**NetUser - provides more information about the user**\n**SystemUpTime - records the amount of time the machine is running**\n\n**WindowsVersion - determines the Windows version**\n\n_ManagedPlugin (SystemInfo) reconnaissance functions._\n\nIn order to exfiltrate data, the plugin uses the function “post” in the HTTPClient class. “Post” gives the plugin the ability to upload content and\nexfiltrate data to the remote C2 whose domain is stored in the registry.\n\n\n-----\n\n_ManagedPlugin (SystemInfo)_\n\n_data exfiltration function post._\n\nSimilar to “PluginHost”, “SystemInfo” uses another function called GetQuery() that builds the URL to send the information to the remote C2.\nThe URL is encoded using Base64 and some char replacements.\n\n_Example of the final URL_\n\n_created by the GetQuery function._\n\nThe core functionality of the “ManagedPlugin” module is in the “ManagedPlugin” class. The function loops endlessly and continues to execute\nthe reconnaissance activity and send it to the attacker.\n\n_ManagedPlugin execution activity._\n\n\n-----\n\n**g** **g** **g** **g** **g** **p**\n\nExchgrabber, similar to systeminfo, shares some similarities with PluginHost when it comes to several function names like Bot, HTTPClient,\nand Utils; however, it has its own differentiated capabilities.\n\nAt first glance, the module appears to solely be used to steal credentials, which can be seen in several classes and data arguments with clear\nnames like “Credential” and “CredentialType”.\n\n_Exchgrabber classes._\n\nThe module handles its credential management in the class “Credential”, which includes several functions that handle the credential\nmanagement activity and data types that will hold these credentials.\n\nOne of the most interesting functions in this class is “Credential” which receives four arguments: username, password, target, and\nCredentialType. It inserts these credentials into the respective module variable.\n\nThe “target” variable is used in the core ManagedPlugin function to store strings related to Microsoft Office applications.\n\n_The ManagedPlugin_\n\n_(Exchgrabber) Credential function._\n\nAnother interesting argument in the “credential” function is “CredentialType”. The type of credentials is determined by another part of the enum\nvariable called “CredentialType”, which contains each of the credentials that the module will attempt to extract.\n\n**The credential types are sensitive information that can be extracted from the enterprise Microsoft Exchange server data, including**\n**Domain Password & Domain Certificate.**\n\nExtracting this sensitive data allows the attacker access to an inside domain user for the internal mail services of an enterprise along with\naccess to the domain certificate of an enterprise. With systeminfo, the attacker can identify which user is a domain administrator. This creates\na very dangerous combination of sensitive data leakage and potentially large scale cyber spying or infostealing. It also shows that the intended\ntarget of this malware is first and foremost enterprises.\n\n\n-----\n\n_ManagedPlugin (Exchgrabber) credential types._\n\nWhen inspecting the core logic behind the class MainPlugin, it’s clear how each class collaborates with others to extract data from Microsoft\nExchange and Outlook.\n\nThe module attempts to check if the extracted data is related to Microsoft Office or MS.Outlook. If so, it attempts to access the file\n_“Autodiscover.xml” using the function GetFiles. “Autodiscover.xml” is a dynamically generated file that contains the data Microsoft Outlook_\nneeds to access the mailbox entered in the configuration wizard. The primary purpose of the Exchange Autodiscover service is to establish\n[initial connections to Exchange user mailboxes. It then attempts to collect the AutoDiscover SMTP address of the dedicated exchange forest,](https://www.priasoft.com/using-a-dedicated-exchange-forest-resource-forest/)\nand eventually puts all the extracted data in a variable called “text” .\n\n_Microsoft exchange data extraction._\n\nAfter collecting the sensitive data, the module compresses it using Base64. This is a new feature of this specific module within the “Utils” class.\nThen, it sends the sensitive data to the attacker’s C2 with the POST function and an embedded URI.\n\n_ManagedPlugin_\n\n_(Exchgrabber) used for data exfiltration using a predefined URI._\n\n## Valak’s Evolution Over Time\n\nAs of writing this report we have seen Valak change tremendously It is currently on version number 24\n\n\n-----\n\ns sect o g g ts t e ajo d e e ces bet ee t e p e ous e s o s a d e e e s o s o a a by a a y g e s o 6, e s o 9,\nversion 23, and version 24.\n\n**Improvements to Payload Obfuscation**\n\nIn older versions, Valak downloads the second stage JS and uses only one obfuscation technique: Base64. The newer versions use XOR in\naddition to Base64.\n\n_Code from older versions_\n\n_of Valak that only uses Base64 decryption._\n\n_Code from a newer_\n\n_version of Valak that uses a more complex decryption function._\n\n**Plugin Management Component**\n\nThe newer versions of Valak download two payloads in the first stage. The first payload is Valak’s plugin management component\n(“pluginhost.exe”), and the second is the second stage JavaScript payload of Valak. In earlier versions, Valak did not include the “pluginhost”\npayload.\n\n**PowerShell Activity:**\n\nIn older versions of Valak, the second stage JS downloads additional content just like the newer versions, including“TASK” / ”ODTASK” /\n”PLUGIN”. In the newer versions, Valak also downloads “PluginHost” in stage one and executes it once receiving the task “PLUGIN” in stage\ntwo, which then downloads ManagedPlugin.dll. In the older versions, Valak uses the task “PLUGIN” in stage two to leverage PowerShell and\ndownload “ManagedPlugin.dll” as a Base64 binary.\n\nAs mentioned previously, later versions of Valak abandon the popular yet easily detectable PowerShell downloader approach and transition to\n“PluginHost” to manage and download additional payloads. This transition may indicate that Valak authors are looking to leverage stealthier\napproaches and improve their evasion techniques.\n\n_Raw data downloaded_\n\n_from the C2._\n\n_Decoded content of the_\n\n_“PLUGIN” task._\n\n\n-----\n\n## a a s ast uctu e\n\nAnalyzing the different samples reveals a repetitive pattern of URIs used to connect to a “bucket” of domains, all of which are embedded in the\ncode.\n\nFor example, the URI used to download the “PluginHost” (a.aspx) is always built off: “a.aspx?redir=1&clientUuid=91&r_ctplGuid=” +<the\n_encoded_ID>+ “&TS2=” +<random string>_\n\n_Creation of the URI in_\n\n_Valak’s source code._\n\nThis URI is not the only similarity across samples; Valak has several URIs that match this behavior across components.\n\n**Valak’s Observed URI Patterns:**\n\n**DLL Download: the DLL URI always includes “aio0i32p”**\n**Second Stage: the second stage (project.aspx) always includes “?cwdTelemetry=2&regclid=”**\n\n**Task Fetching: Tasks fetching from the C2 server always include “?dx11diag=”**\n\n**Additional Plugins Download: “PluginHost” downloads additional plugins that always include “db.aspx?llid=”**\n\n**Exchgrabber plugin data: the URI to exfiltrate data from the plugin includes “class4.aspx?internalService”**\n\nAnother interesting aspect of the Valak malware is that it has a shared infrastructure among almost all of it’s different versions. As the graph\nbelow shows, most of the known domains have a connection between them, whether it be the URIs similarities, downloaded files, or connected\nfiles.\n\n_VirusTotal graph showing the_\n\n_connection between the different Valak domains._\n\n## Valak’s Relationship With Other Malware\n\nValak infections were initially characterized as rather unilateral, where Valak mainly downloaded other known malware like Ursnif or IcedID.\nHowever, over the course of this investigation, it became clear that Valak’s relationship with other malware is actually multilateral.\n\n\n-----\n\no e a p e, t e o o g et o t a c eco d g p o ded by a [a e t a c a a ys s](https://www.malware-traffic-analysis.net/2019/12/19/index.html) ust ates a ect o c a t at s t ated by U s,\nwhich downloads IcedID and Valak, both from the same C2 server.\n\n_Traffic - Ursnif downloading_\n\n_IcedID and Valak._\n\nWhile the nature of the partnership between each of these specific malware is not fully understood, we suspect it is based on personal ties and\n[mutual trust from underground communities. Given the fact that both Ursnif and](https://www.sentinelone.com/blog/goznym-banking-malware-gang-busted/) [IcedID are considered to be part of the Russian-speaking E-](https://www.bankinfosecurity.com/repeat-trick-malware-wielding-criminals-collaborate-a-12219)\nCrime ecosystem, it is possible that the authors of Valak are also part of that Russian-speaking underground community. This community is\nknown to keep rather close ties based on trust and reputation.\n\nAnother clue that may tie the authors behind Valak to a Russian-speaking community are traces of both Russian and Arabic (Saudi Arabia)\nlanguage settings left in the phishing documents. These language traces appear in all the samples we analyzed, an example of which is shown\nbelow:\n\n_Russian and Arabic keyboard traces found in a Valak phishing document._\n\nIt is important to mention that the above mentioned language traces can be easily manipulated and put there on purpose by the threat actors,\nand therefore, it is not enough to determine with certainty the origin of the threat actors.\n\n## Valak’s Evolution as an Independent Malware\n\nAlthough initially downloaded as a payload of other malware, in more recent appearances of Valak, the malware appears to come as a\nstandalone unit in traditional phishing campaigns.\n\nRecent campaigns target two specific geographic locations, including the US and Germany, where the content and the name of the files were\nwritten in English and German with files masquerading as legitimate.\n\n_VirusTotal screenshot with the_\n\n_file names used in the recent campaigns._\n\n_Content of the document targeting Germany._\n\n\n-----\n\n_Content of the document targeting the US._\n\nEven though Valak appears to have evolved over time and has infostealer capabilities, it is clear that the threat actors behind Valak continue to\ncollaborate with other malware like IcedID and and Ursnif to maximize their revenue.\n\n## Conclusion\n\nIn this research, the Cybereason Nocturnus team analyzed the emerging malware Valak. Though Valak first made its appearance at the end of\n2019 and was classified as a malware loader by several security analysts, our investigation shows that Valak is more than a simple loader of\nmalware. It is a sophisticated modular malware packed with a myriad of reconnaissance and information stealing features.\n\nOver the course of roughly six months, Valak’s developers made tremendous progress and released more than 30 different versions. Each\nversion extended the malware’s capabilities and added evasive techniques to improve its stealth. Valak has at least six plugin components that\nenable attackers to obtain sensitive information from its victims.\n\nThe extended malware capabilities suggest that Valak can be used independently with or without teaming up with other malware. That being\nsaid, it seems as though the threat actor behind Valak is collaborating with other threat actors across the E-Crime ecosystem to create an even\nmore dangerous piece of malware.\n\nThese malware campaigns seem to focus on targets in the US and Germany. The Cybereason Nocturnus team will continue to monitor Valak’s\nprogress to determine whether Valak infections will spread to other regions as the malware continues to evolve and grow popular among\ncybercriminals.\n\n## Indicators of Compromise\n\n[Click here to download this campaign's IOCs (PDF)](https://www.cybereason.com/hubfs/Valak%20IOCs.pdf)\n\n[Click here to download the threat alert (PDF)](https://www.cybereason.com/hubfs/Valak%20Threat%20Alert.pdf)\n\n## MITRE ATT&CK BREAKDOWN\n\n\n**Initial Access** **Execution** **Persistence** **Privilege**\n**Escalation**\n\n\n**Credential**\n**Access**\n\n**Credentials**\n**in Files**\n\n**Account**\n**Manipulation**\n\n\n**Discovery** **Collection** **Exfiltration** **C**\n\n\n**Account**\n**Discovery**\n\n**File and**\n**[Directory](https://attack.mitre.org/techniques/T1083)**\n**Discovery**\n\n\n**Spearphishing**\n**Link**\n\n**Spearphishing**\n**Attachment**\n\n\n**Command-Line**\n**Interface**\n\n\n**[Regsvr32](https://attack.mitre.org/techniques/T1117/)** **Valid**\n**Accounts**\n\n\n**Scheduled**\n**Task**\n\n\n**Scheduled**\n**Task**\n\n\n**Defense**\n**Evasion**\n\n**NTFS File**\n**Attributes**\n\n**Modify**\n**Registry**\n\n\n**Data from**\n**[Information](https://attack.mitre.org/techniques/T1213)**\n**Repositories**\n\n**Data from**\n**[Local](https://attack.mitre.org/techniques/T1005)**\n**System**\n\n\n**Automated**\n**Exfiltration**\n\n**Data**\n**Compressed**\n\n\n**D**\n**O**\n\n\n**[Scheduled Task](https://attack.mitre.org/techniques/T1053/)** **[Regsvr32](https://attack.mitre.org/techniques/T1117)** **Permission**\n**[Groups](https://attack.mitre.org/techniques/T1069)**\n**Discovery**\n\n**[Scripting](https://attack.mitre.org/techniques/T1064)** **[Scripting](https://attack.mitre.org/techniques/T1064)** **Security**\n**[Software](https://attack.mitre.org/techniques/T1063)**\n**Discovery**\n\n\n**[Data Staged](https://attack.mitre.org/techniques/T1074)** **Data**\n**Encrypted**\n\n\n**Email**\n**Collection**\n\n\n**Exfiltration**\n**Over**\n**[Command](https://attack.mitre.org/techniques/T1041)**\n**and Control**\n**Channel**\n\n\n**Windows**\n**[Management](https://attack.mitre.org/techniques/T1047)**\n**Instrumentation**\n\n\n**System**\n**[Information](https://attack.mitre.org/techniques/T1082)**\n**Discovery**\n\n\n**[PowerShell](https://attack.mitre.org/techniques/T1086)** **System**\n**Network**\n**Configuration**\n**Discovery**\n\n\n-----\n\n**System Time**\n**Discovery**\n\nAbout the Author\n\n**Cybereason Nocturnus**\n\nThe Cybereason Nocturnus Team has brought the world’s brightest minds from the military, government intelligence, and enterprise security to\nuncover emerging threats across the globe. They specialize in analyzing new attack methodologies, reverse-engineering malware, and\nexposing unknown system vulnerabilities. The Cybereason Nocturnus Team was the first to release a vaccination for the 2017 NotPetya and\nBad Rabbit cyberattacks.\n\n[All Posts by Cybereason Nocturnus](https://www.cybereason.com/blog/authors/cybereason-nocturnus)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-05-28 - Valak- More than Meets the Eye.pdf"
    ],
    "report_names": [
        "2020-05-28 - Valak- More than Meets the Eye.pdf"
    ],
    "threat_actors": [
        {
            "id": "b753c6a8-a83d-47bc-829d-45e56136eb7d",
            "created_at": "2023-01-06T13:46:38.97802Z",
            "updated_at": "2025-03-27T02:00:02.967861Z",
            "deleted_at": null,
            "main_name": "GozNym",
            "aliases": [],
            "source_name": "MISPGALAXY:GozNym",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673536230,
    "ts_updated_at": 1743041404,
    "ts_creation_date": 1653764520,
    "ts_modification_date": 1653764520,
    "files": {
        "pdf": "https://archive.orkl.eu/00269fdd3e1a3d9c8f2f578ad968825aba577699.pdf",
        "text": "https://archive.orkl.eu/00269fdd3e1a3d9c8f2f578ad968825aba577699.txt",
        "img": "https://archive.orkl.eu/00269fdd3e1a3d9c8f2f578ad968825aba577699.jpg"
    }
}