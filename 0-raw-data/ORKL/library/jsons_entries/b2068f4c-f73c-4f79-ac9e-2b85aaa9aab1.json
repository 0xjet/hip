{
    "id": "b2068f4c-f73c-4f79-ac9e-2b85aaa9aab1",
    "created_at": "2023-01-12T15:04:39.560915Z",
    "updated_at": "2025-03-27T02:16:01.148496Z",
    "deleted_at": null,
    "sha1_hash": "48d88ec3c571ce6123b89004d6ad4df3979fbcd8",
    "title": "2017-10-18 - Magniber ransomware- exclusively for South Koreans",
    "authors": "",
    "file_creation_date": "2022-05-28T04:56:57Z",
    "file_modification_date": "2022-05-28T04:56:57Z",
    "file_size": 1099176,
    "plain_text": "# Magniber ransomware: exclusively for South Koreans\n\n**[blog.malwarebytes.com/threat-analysis/2017/10/magniber-ransomware-exclusively-for-south-koreans/](https://blog.malwarebytes.com/threat-analysis/2017/10/magniber-ransomware-exclusively-for-south-koreans/)**\n\nMalwarebytes Labs October 19, 2017\n\n[The Magnitude exploit kit has been pretty consistent over the last few months, dropping the](https://blog.malwarebytes.com/cybercrime/2017/08/enemy-at-the-gates-reviewing-the-magnitude-exploit-kit-redirection-chain/)\nsame payload—namely, the Cerber ransomware—and targeting a few select countries in\n[Asia. Strangely, Magnitude EK disappeared in late September, and for a while we wondered](https://blog.malwarebytes.com/wp-content/uploads/2017/10/Last_Cerber_Magnitude.png)\nwhether this was yet another casualty in the already deflated exploit kit scene.\n\nHowever, a few days ago Magnitude EK resurfaced, this time with a new payload. The\n[delivered malware is also a ransomware, but of a family that was not known before. It has](https://www.malwarebytes.com/ransomware)\n[been named Magniber.](https://id-ransomware.malwarehunterteam.com/identify.php?case=1387d7d927941907854790fc1801573de677270b)\n\nThis Magniber ransomware is highly targeted, as it checks at several levels (external IP, the\nlanguage installed, etc.) to ensure that the attacked system is only South Korean. Targeting a\nsingle country is unusual on its own, but performing multiple checks to be sure of the country\nand language of origin makes this a first for ransomware.\n\n## Analyzed samples\n\n**Older sample**\n\n## Distribution method\n\nSo far, we found this ransomware is dropped only by the Magnitude exploit kit:\n\n\n-----\n\nNo other distribution method is known at the moment.\n\n## Behavioral analysis\n\nIf the malware is executed on non-Korean systems, the only thing we can see is the\noperation of deleting itself, delayed by running the ping command:\n\nIt only starts its malicious operations on systems with Korean language detected. The\nexecutable is pretty noisy, because it implements various tasks just by command line.\nRunning it on the sandbox, we can see the following graph of calls:\n\nThe malware copies itself in %TEMP% and deploys itself with the help of task scheduler:\n\n\n-----\n\nIn the same folder, we can see also the ransom note and yet another file. Its name is the\nsame as the part of the domain that has been generated for the particular user, and its\nextension is the same as the extension of the encrypted files:\n\nTo each encrypted file is added an extension that is composed of small Latin characters and\nis constant for the particular sample of Magniber.\n\nThe same plain-text makes the same cipher-text. This means each and every file is\nencrypted using exactly the same key.\n\nBelow, we demonstrate a visualization of bytes of a sample BMP file before and after being\nencrypted by Magniber:\n\n\n-----\n\nAs you can see, there are no visible patterns in the encrypted version; it suggests that some\nstrong algorithm has been used, probably AES in CBC mode.\n\nAt the beginning of each encrypted file, we find a 16-character long identifier that is constant\nfor the particular sample of Magniber:\n\nAfter the encryption of all the found files is done, the ransomware runs notepad, displaying\nthe dropped ransom note:\n\n\n-----\n\nThe ransom note is in the TXT format and its structure is minimalistic. It gives four alternative\naddresses pointing to the page for the victim.\n\n## Page for the victims\n\nThe page for the victims is in English only. Its template is very similar to the one used by the\nCerber ransomware (this is the only similarity between those ransomware families—\ninternally they are quite different):\n\n\n-----\n\n## Network communication\n\nWe found Magniber connecting domains that are generated by the built-in algorithm. The\nsame domains that are used as CnC are later used for individual websites for the victim (only\nthey are called with a different parameter). Examples of the called URLs:\n```\nhttp://xat91h3evntk5zb66dr.bankme.date/new1\nhttp://xat91h3evntk5zb66dr.bankme.date/end1\n\n```\nCompare the URLs from the ransom note with the corresponding run:\n```\nhttp://xat91h3evntk5zb66dr.bankme.date/EP866p5M93wDS513\nhttp://xat91h3evntk5zb66dr.jobsnot.services/EP866p5M93wDS513\nhttp://xat91h3evntk5zb66dr.carefit.agency/EP866p5M93wDS513\nhttp://xat91h3evntk5zb66dr.hotdisk.world/EP866p5M93wDS513\n\n```\nAt the beginning of the execution, the ransomware sends a request to the URL ending\nwith new1 (or new0). At the end of the execution, it requests end1 (or end0). The meaning of\nthose URLs will be explained in detail in the next part of the article.\n\nWhat’s interesting is that the server gives a valid response if, and only if, the public IP of the\nvictim was Korean. Otherwise, the response is empty. Example of the captured initial request\nand response (the request was made from the Korean IP):\n\n\n-----\n\nIn the response, we get a 16-character long, random string: ce2KPIak3cl6JKm6. The new\nrandom URL can be requested only once. If we try to repeat the request, we will get an\nempty response.\n\nThe other request (the ending one) also gives a 16-character long, random string in\nresponse. But contrary to the first one, it responds on every request (a different random\nstring each time). Example of the ending request and response:\n\n## Inside the code\n\nAs always, to understand what is really going on here, we will have to take a deeper dive\ninside the code.\n\n[Magniber is delivered packed by various crypters, and the unpacking method will depend on](https://blog.malwarebytes.com/threat-analysis/2015/12/malware-crypters-the-deceptive-first-layer/)\nthe crypter’s features. You can see the process of unpacking the current sample in the video\nbelow.\n\n\n-----\n\nWatch Video At:\n\nhttps://youtu.be/VGOgZ1BXTRE\n\nAfter defeating the first layer, we obtain the second PE file: the malicious core. The core\ndoes not contain any advanced obfuscation. The authors made the strings just slightly\ndifficult to follow by loading them into memory character by character:\n\n**Execution flow**\n\nLooking inside the unpacked payload, we can clearly see why it doesn’t run on most\nsystems. At the beginning, there is a language check (using the API\n[function GetSystemDefaultUILanguage):](https://msdn.microsoft.com/en-us/library/windows/desktop/dd318123(v=vs.85).aspx)\n\n\n-----\n\n[The only accepted UI language is Korean (code 1042). In case of any other detected, the](https://technet.microsoft.com/en-us/library/cc287874(v=office.12).aspx)\nsample just deletes itself and causes no harm. This language check has been added in the\nrecent Magniber samples and was not found in the earlier versions, such as\n[aa8f077a5feeb9fa9dcffd3c69724c942d5ce173519c1c9df838804c9444bd30.](https://www.reverse.it/sample/aa8f077a5feeb9fa9dcffd3c69724c942d5ce173519c1c9df838804c9444bd30?environmentId=100)\n\nAfter the check is passed, Magniber follows with a typical ransomware functionality.\nOverview of the performed steps:\n\n1. Creates mutex\n2. Checks in the temp folder if the marker file has been dropped\n3. Drops the copy of itself in %TEMP% and adds the scheduled task\n4. Queries the generated subdomains to retrieve the AES key (if retrieving the key failed,\n\nloads the hardcoded one)\n5. Enumerates and encrypts files with the selected extensions\n6. Reports finishing the task to the CnC\n7. Executes the notepad displaying the ransom note\n8. Deletes itself\n\n**What is attacked?**\n\nThe list of extensions attacked by Magniber is really long. It includes documents, source\ncode files, and many others. The complete list is below:\n\n\n-----\n\n```\ndocx xls xlsx ppt pptx pst ost msg em vsd vsdx csv rtf 123 wks wk1 pdf dwg \nonetoc2 snt docb docm dot dotm dotx xlsm xlsb xlw xlt xlm xlc xltx xltm pptm \npot pps ppsm ppsx ppam potx potm edb hwp 602 sxi sti sldx sldm vdi vmx gpg \naes raw cgm nef psd ai svg djvu sh class jar java rb asp php jsp brd sch dch \ndip vb vbs ps1 js asm pas cpp cs suo sln ldf mdf ibd myi myd frm odb dbf db \nmdb accdb sq sqlitedb sqlite3 asc lay6 lay mm sxm otg odg uop std sxd otp \nodp wb2 slk dif stc sxc ots ods 3dm max 3ds uot stw sxw ott odt pem p12 csr \ncrt key pfx der 1cd cd arw jpe eq adp odm dbc frx db2 dbs pds pdt dt cf cfu \nmx epf kdbx erf vrp grs geo st pff mft efd rib ma lwo lws m3d mb obj x3d c4d \nfbx dgn 4db 4d 4mp abs adn a3d aft ahd alf ask awdb azz bdb bib bnd bok btr \ncdb ckp clkw cma crd dad daf db3 dbk dbt dbv dbx dcb dct dcx dd df1 dmo dnc \ndp1 dqy dsk dsn dta dtsx dx eco ecx emd fcd fic fid fi fm5 fo fp3 fp4 fp5 \nfp7 fpt fzb fzv gdb gwi hdb his ib idc ihx itdb itw jtx kdb lgc maq mdn mdt \nmrg mud mwb s3m ndf ns2 ns3 ns4 nsf nv2 nyf oce oqy ora orx owc owg oyx p96 \np97 pan pdb pdm phm pnz pth pwa qpx qry qvd rctd rdb rpd rsd sbf sdb sdf spq \nsqb stp str tcx tdt te tmd trm udb usr v12 vdb vpd wdb wmdb xdb xld xlgc zdb \nzdc cdr cdr3 abw act aim ans apt ase aty awp awt aww bad bbs bdp bdr bean \nbna boc btd cnm crw cyi dca dgs diz dne docz dsv dvi dx eio eit emlx epp err \netf etx euc faq fb2 fb fcf fdf fdr fds fdt fdx fdxt fes fft flr fodt gtp frt \nfwdn fxc gdoc gio gpn gsd gthr gv hbk hht hs htc hz idx ii ipf jis joe jp1 jrtf\nkes klg knt kon kwd lbt lis lit lnt lp2 lrc lst ltr ltx lue luf lwp lyt lyx man\nmap mbox me mel min mnt mwp nfo njx now nzb ocr odo of oft ort p7s pfs pjt prt \npsw pu pvj pvm pwi pwr qd rad rft ris rng rpt rst rt rtd rtx run rzk rzn saf \nsam scc scm sct scw sdm sdoc sdw sgm sig sla sls smf sms ssa sty sub sxg tab \ntdf tex text thp tlb tm tmv tmx tpc tvj u3d u3i unx uof upd utf8 utxt vct vnt \nvw wbk wcf wgz wn wp wp4 wp5 wp6 wp7 wpa wpd wp wps wpt wpw wri wsc wsd wsh wtx\nxd xlf xps xwp xy3 xyp xyw ybk ym zabw zw abm afx agif agp aic albm apd apm \napng aps apx art asw bay bm2 bmx brk brn brt bss bti c4 ca cals can cd5 cdc \ncdg cimg cin cit colz cpc cpd cpg cps cpx cr2 ct dc2 dcr dds dgt dib djv dm3 \ndmi vue dpx wire drz dt2 dtw dv ecw eip exr fa fax fpos fpx g3 gcdp gfb gfie \nggr gih gim spr scad gpd gro grob hdp hdr hpi i3d icn icon icpr iiq info ipx \nitc2 iwi j2c j2k jas jb2 jbig jbmp jbr jfif jia jng jp2 jpg2 jps jpx jtf jw \njxr kdc kdi kdk kic kpg lbm ljp mac mbm mef mnr mos mpf mpo mrxs my ncr nct \nnlm nrw oc3 oc4 oc5 oci omf oplc af2 af3 asy cdmm cdmt cdmz cdt cmx cnv csy \ncv5 cvg cvi cvs cvx cwt cxf dcs ded dhs dpp drw dxb dxf egc emf ep eps epsf \nfh10 fh11 fh3 fh4 fh5 fh6 fh7 fh8 fif fig fmv ft10 ft11 ft7 ft8 ft9 ftn fxg\n gem glox hpg hpg hp idea igt igx imd ink lmk mgcb mgmf mgmt mt9 mgmx mgtx \nmmat mat ovp ovr pcs pfv plt vrm pobj psid rd scv sk1 sk2 ssk stn svf svgz \ntlc tne ufr vbr vec vm vsdm vstm stm vstx wpg vsm xar ya orf ota oti ozb \nozj ozt pa pano pap pbm pc1 pc2 pc3 pcd pdd pe4 pef pfi pgf pgm pi1 pi2 pi3 \npic pict pix pjpg pm pmg pni pnm pntg pop pp4 pp5 ppm prw psdx pse psp ptg \nptx pvr px pxr pz3 pza pzp pzs z3d qmg ras rcu rgb rgf ric riff rix rle rli\n rpf rri rs rsb rsr rw2 rw s2mv sci sep sfc sfw skm sld sob spa spe sph spj \nspp sr2 srw wallet jpeg jpg vmdk arc paq bz2 tbk bak tar tgz gz 7z rar zip \nbackup iso vcd bmp png gif tif tiff m4u m3u mid wma flv 3g2 mkv 3gp mp4 mov\navi asf mpeg vob mpg wmv fla swf wav mp3 \n\n```\nThe list loads at the beginning of the file encrypting function:\n\n\n-----\n\nAs usual, some of the directories are exempted:\n```\n:\\documents and settings\\all users\\ \n:\\documents and settings\\default user\\ \n:\\documents and settings\\localservice\\ \n:\\documents and settings\\networkservice\\ \n\\appdata\\local\\ \n\\appdata\\locallow\\ \n\\appdata\\roaming\\ \n\\local settings\\ \n\\public\\music\\sample music\\ \n\\public\\pictures\\sample pictures\\ \n\\public\\videos\\sample videos\\ \n\\tor browser\\ \n\\$recycle.bin \n\\$windows.~bt \n\\$windows.~ws \n\\boot \n\\intel \n\\msocache \n\\perflogs \n\\program files (x86) \n\\program files \n\\programdata \n\\recovery \n\\recycled \n\\recycler \n\\system volume information \n\\windows.old \n\\windows10upgrade \n\\windows \n\\winnt\n\n```\n\n-----\n\n## How does the encryption work?\n\nMagniber encrypts files with AES 128 bit in CBC mode. It is implemented with the help of\nWindows Crypto API.\n\n**The DGA and the victim ID**\n\nIn the usual scenario, the malware tries to retrieve the AES key from the CnC by querying\npseudo-random subdomains:\n\nThe pseudo-random part is used to uniquely identify the victim. It is generated by the\nfollowing simple algorithm:\n\nEach character is based on the tick count, converted to the given charset:\n\nThe number 0 or 1 is appended to the URL depending if the sample is running in the\ncontrolled environment or not (detected using time check)\n\n\n-----\n\nFour domains are being queried for the key:\n\nIf any of them give a 16-byte long response, that means the valid key is copied to the buffer\nand used further. Otherwise, it falls back to the hardcoded key.\n\n**The default AES key and IV**\n\nThe interesting thing is that each sample comes with the AES key hardcoded. However, it is\nused only as a backup if downloading the key from the CnC was for some reason impossible\n(that occurs also in the case if the public IP was not from Korea). The key is unique per each\nsample. In the currently analyzed sample, it is S25943n9Gt099y4K:\n\nIf any of them gives 16 byte long response, that means the valid key, it is copied to the\nbuffer and used further. Otherwise, it falls back to the hardcoded key.\n\n\n-----\n\nSimilarly, the initialization vector is always hardcoded in the sample (but not downloaded).\nThe same 16-character long string was also saved at the file beginning. In the currently\nanalyzed sample it is EP866p5M93wDS513:\n\n**The algorithm**\n\nFirst, the crypto context is initialized. The malware imports the key and initialization vector\nwith the help of functions CryptImportKey, CryptSetKeyParam:\n\nEncrypting the file:\n\n\n-----\n\nThe first write stores the 16-byte long string at the beginning of the file. Then, the file is read\nchunk by chunk and encrypted using Windows Crypto API.\n\n## Conclusion\n\nMagniber ransomware is being distributed instead of Cerber from the same exploit kit,\napproaching the same targets. However, internally it has nothing in common with the Cerber\nand is much simpler. The only feature that makes it unique is being so picky about the\ntargeted country. For the first time, we are seeing country checks being performed at various\nlevels of execution.\n\nThis ransomware family appeared recently and probably is still under active development.\nWe will keep an eye on its evolution and keep you informed.\n\nThe users of [Malwarebytes for Windows (with real-time, anti-ransomware technology](http://www.malwarebytes.com/premium)\ndeployed) are protected against Magniber.\n\n## Appendix\n\n[https://www.checkmal.com/page/resource/video/?detail=read&idx=676&p=1&pc=20](https://www.checkmal.com/page/resource/video/?detail=read&idx=676&p=1&pc=20)\n\nhttps://www.bleepingcomputer.com/news/security/goodbye-cerber-hello-magniberransomware/\n\n[https://gist.github.com/evilsocket/b89df665e6d52446e3e353fc1cc44711](https://gist.github.com/evilsocket/b89df665e6d52446e3e353fc1cc44711)\n[(magniber_decryptor.exe) – decryptor by](https://drive.google.com/open?id=0Bzb5kQFOXkiSa1JTYlp0NG5KdkU) [@evilsocket (works only for the cases when the](https://twitter.com/evilsocket)\nAES key is known – i.e. the default one from the sample was used, or the random one can\nbe extracted from the captured traffic)\n\n_This was a guest post written by Hasherezade, an independent researcher and programmer_\n_with a strong interest in InfoSec. She loves going in details about malware and sharing threat_\n_[information with the community. Check her out on Twitter @hasherezade and her personal](https://twitter.com/hasherezade)_\n_[blog: https://hshrzd.wordpress.com.](https://hshrzd.wordpress.com/)_\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-10-18 - Magniber ransomware- exclusively for South Koreans.pdf"
    ],
    "report_names": [
        "2017-10-18 - Magniber ransomware- exclusively for South Koreans.pdf"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673535879,
    "ts_updated_at": 1743041761,
    "ts_creation_date": 1653713817,
    "ts_modification_date": 1653713817,
    "files": {
        "pdf": "https://archive.orkl.eu/48d88ec3c571ce6123b89004d6ad4df3979fbcd8.pdf",
        "text": "https://archive.orkl.eu/48d88ec3c571ce6123b89004d6ad4df3979fbcd8.txt",
        "img": "https://archive.orkl.eu/48d88ec3c571ce6123b89004d6ad4df3979fbcd8.jpg"
    }
}