{
    "id": "507ed0e0-63ed-4854-b270-04cc208cf591",
    "created_at": "2023-01-12T15:02:05.644185Z",
    "updated_at": "2025-03-27T02:06:01.43118Z",
    "deleted_at": null,
    "sha1_hash": "b4f07cf07e0dff8346965587b520dddd489d1305",
    "title": "2021-04-02 - The “Fair” Upgrade Variant of Phobos Ransomware",
    "authors": "",
    "file_creation_date": "2022-05-28T01:57:54Z",
    "file_modification_date": "2022-05-28T01:57:54Z",
    "file_size": 3230242,
    "plain_text": "# The “Fair” Upgrade Variant of Phobos Ransomware\n\n**[blog.morphisec.com/the-fair-upgrade-variant-of-phobos-ransomware](https://blog.morphisec.com/the-fair-upgrade-variant-of-phobos-ransomware)**\n\n[Tweet](https://twitter.com/share)\n\n\n-----\n\nThe developers of the Phobos ransomware have added new fileless and evasive techniques\nto their arsenal. Constantly keeping their attack up to date helps them bypass detection\ntechnologies through several distinct approaches, the latest of which we detail in this blog.\n\nThe following provides details on a new Fair variant of Phobos ransomware. The Morphisec\nIR team identified this variant during an incident response engagement in early March,\n[provided as part of Morphisec’s new IR services offering. The affected company enlisted our](https://www.morphisec.com/incident-response-services)\nservices, and as a result, we identified this newest Phobos variant (compiled in November\n2020) in their system. The technical details of the attack follow.\n\n## Technical Details\n\n\n-----\n\nIn this threat post, we will go into the details of the latest Fair / Phobos ransomware delivery\nand payload as has been identified as part of our routine incident response service\nprocedures. We will present the significant changes that make this ransomware much more\nrelevant than before.\n\nDuring the first week of March, the Morphisec IR team was enlisted to help with investigating\nan encrypted backup server. We quickly identified an execution of PowerShell scripts that\nwere delivering the ransomware within memory without a single executable on disk.\n\nWe observed the use of paste.ee (a Pastebin alternative) for the delivery of the loader and\nthe ransomware component.\n\nA deeper investigation revealed that the server was compromised for more than 8 months.\nWhile all indicators point to a probable brute force theft of the administrator password,\nbackdoor accounts were created to maintain persistent access. Miners and botnets were\nalso installed.\n\n\n-----\n\nWhen we dove deeper into the ransomware payload, we identified significant improvements\nto the process and removal of footprints.\n\n## PowerShell:\n\nThe original script was base64 encoded. The decoded script is slightly obfuscated using\nknown techniques. As can be seen, the script downloads and evaluates the first component\nfrom a paste[.]ee/r/OwAyf URL. This component is yet another PowerShell command. Next,\nthe script downloads the ransomware as a string from another paste.ee URL and follows a\nbasic string replacement process which leads to a final stage of hollowing a legitimate\nMSBuild.exe process.\n\n## Loader:\n\nAs was presented above, the first downloaded component is a PowerShell command.\n\n\n-----\n\nThe PowerShell command abuses a VisualBasic CallByName exported function to call the\nload of a .NET assembly directly in memory.\n\nThe loaded assembly is actually a loader obfuscated with an Agile.NET obfuscator. This\nloader is responsible for the hollowing of a Ransomware payload (the data parameter) into a\nlegitimate .NET assembly of choice.\n\n\n-----\n\nLooking through VirusTotal, we identified older versions of the similar loader obfuscated with\ndifferent obfuscators--such as Vapor--even though the functionality and the activation\nfunction were preserved.\n\n\n-----\n\n## Phobos Ransomware:\n\nPhobos ransomware is not considered one of the more sophisticated ransomware\nencryptors. Furthermore, it would have a relatively high static detection rate if landed on disk.\nNevertheless, it is immediately and constantly updated, and if executed from memory has\nhigh chances of success.\n\nThe latest FAIR version included some significant upgrades, which we will present here:\n\nOne of the more significant changes is a lower scope of encryption. Phobos’s developers\nremoved the UAC requirement to maintain Medium integrity. This means no encryption of\nprivileged folders, which leads to a lower footprint. While there are fewer files to encrypt,\n\n\n-----\n\nPhobos s developers did not want to compromise on files with open handles, which most\nprobably will have a significant impact on the victims.\n\n1. Files are now opened with FILE_SHARE_DELETE. If there are opened handles with\nsimilar access rights, then the file open will fail.\n\n2. Upon failure, the ransomware will query the currently opened handles.\n\n3. Next, it will identify the process that is responsible for the handle by duplicating the handle\ninto the ransomware process, then extracting the filePath it points to (only if file handle) and\ncomparing it to the target filename.\n\n4. Then the ransomware will iterate over the processes with the handles pointing to the file\nand will attempt to terminate them.\n\n\n-----\n\nPossibly some of the target files are pointed by the privileged process. In this case, if the\nsame processes have FILE_SHARE_DELETE access, the deletion will fail (though it may\nbecome pending).\n\nAn additional modification is to the list of important files and extensions representing\nprevious versions of Phobos’s encrypted files (the intent is to avoid re-encrypting encrypted\nfiles). This list also reinforces some previous assumptions about a correlation between\nLockBit and Phobos ransomware.\n\nWe also identified an improved object oriented code style and the removal of redundant\nparameters such as nVolumeNameSize, which is either way ignored. There was also the\nremoval of redundant functions such as GetFileSize as the information was already available\nthrough FindFirstFileW, which populates all the required data. The developers also reduced\ncode obfuscation and increased the use of WinAPI for secure decryption of strings.\n\nAn additional improvement to the coverage of files is the support of volumes that span\nmultiple physical drives. The implementation is no longer naive, and in fact, now adheres to\nthe best practices of Windows’ internal development. DeviceIoControl is used twice with\n_IOCTL_VOLUME_GET_VOLUME_DISK_EXTENTS to extract the size and then the extent_\nof the physical drive path.\n\n\n-----\n\nThe developers also minimized the interaction with OS native controls due to lower\nprivileges, removed the use of netsh for disabling the firewall, and removed the use of\nbcdedit. The current version still attempts to delete shadow volumes if enabled and delete\nbackup catalogs on servers (wbadmin will work only on servers).\n\n## Conclusions\n\nBased on the research presented here, we can safely conclude that the developers of\nPhobos are aiming to increase their foothold in the enterprise business. They are gradually\nmoving to fileless delivery and footprint reduction with immediate impact. There are also\nclear indications for specific emphasis on targeting servers as some of the commands are\nonly relevant to servers.\n\nObviously, businesses need to look at how to prevent the attack chains much earlier, during\nthe initial access or execution stages as described by MITRE.\n\n\n-----\n\nBusinesses also need to invest in attack surface reduction and zero trust prevention.\nMorphisec’s runtime zero-trust approach dramatically reduces the risk of initial access and\nexecution exposure.\n\n## IoCs\n\n\nPowerShell\nscript\n\nRansomware\n(fileless)\n\nRansomware\n(on disk)\n\nLoader\n(hollower)\n\n\n7f8f8c82fec8acbb0947a192dd5cbe8b95ffdba4e252b582eae127f1c062399b\n\n2cadd0ff146e1cdf1270894be4fb1523bfdcc7a31760e0ca5cfd9d8e6b525c21\n\nhxxps://paste[.]ee/r/1q1gD\n\nf6b60839de0ac933f0788bc1e12dee859950010f938a05544ad51c424954b9a6\n\n4ff1f8a052addbc5a0388dfa7f32cc493d7947c43dc7096baa070bfc4ae0a14e\n\nhxxps://paste[.]ee/r/OwAyf\n\n\n[Contact SalesInquire via Azure](http://10.10.0.46/mailto:sales@morphisec.com)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2021/2021-04-02 - The “Fair” Upgrade Variant of Phobos Ransomware.pdf"
    ],
    "report_names": [
        "2021-04-02 - The “Fair” Upgrade Variant of Phobos Ransomware.pdf"
    ],
    "threat_actors": [
        {
            "id": "8a33d3ac-14ba-441c-92c1-39975e9e1a73",
            "created_at": "2023-01-06T13:46:39.195689Z",
            "updated_at": "2025-03-27T02:00:03.01861Z",
            "deleted_at": null,
            "main_name": "Ghostwriter",
            "aliases": [
                "PUSHCHA",
                "Storm-0257",
                "DEV-0257",
                "UAC-0057",
                "UNC1151",
                "TA445"
            ],
            "source_name": "MISPGALAXY:Ghostwriter",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "119c8bea-816e-4799-942b-ff375026671e",
            "created_at": "2022-10-25T16:07:23.957309Z",
            "updated_at": "2025-03-27T02:02:10.048343Z",
            "deleted_at": null,
            "main_name": "Operation Ghostwriter",
            "aliases": [
                "DEV-0257",
                "Operation Asylum Ambuscade",
                "PUSHCHA",
                "Storm-0257",
                "TA445",
                "UAC-0051",
                "UAC-0057",
                "UNC1151"
            ],
            "source_name": "ETDA:Operation Ghostwriter",
            "tools": [
                "Agentemis",
                "Cobalt Strike",
                "CobaltStrike",
                "HALFSHELL",
                "Impacket",
                "RADIOSTAR",
                "VIDEOKILLER",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535725,
    "ts_updated_at": 1743041161,
    "ts_creation_date": 1653703074,
    "ts_modification_date": 1653703074,
    "files": {
        "pdf": "https://archive.orkl.eu/b4f07cf07e0dff8346965587b520dddd489d1305.pdf",
        "text": "https://archive.orkl.eu/b4f07cf07e0dff8346965587b520dddd489d1305.txt",
        "img": "https://archive.orkl.eu/b4f07cf07e0dff8346965587b520dddd489d1305.jpg"
    }
}