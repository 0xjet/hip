{
    "id": "d445ac15-9841-4fb8-8dae-b08df8d44773",
    "created_at": "2023-01-12T15:00:39.478218Z",
    "updated_at": "2025-03-27T02:15:35.587248Z",
    "deleted_at": null,
    "sha1_hash": "f4218e33580e90e0f3e33e6dd6f18cee3e6476bc",
    "title": "2022-04-25 - Full RedLine malware analysis - IoCs - Stealing information",
    "authors": "",
    "file_creation_date": "2022-05-27T18:58:25Z",
    "file_modification_date": "2022-05-27T18:58:25Z",
    "file_size": 1587343,
    "plain_text": "# Full RedLine malware analysis\n\n**muha2xmad.github.io/malware-analysis/fullredline/**\n\n### Muhammad Hasan Ali\n\nMalware Analysis learner\n\n5 minute read\n\n**As-salamu Alaykum**\n\n## Introduction\n\n\nApril 21, 2022\n\n\nRedline Stealer has been delivered through various channels. Redline Stealer is mostly\ndistributed through Phishing Emails or malicious software disguised as installation files such\nas Telegram, Discord, and cracked software. However, recently, Phishing Link that\ndownloads Chrome Extension containing Redline Stealer by abusing YouTube Video\nDescription and Google Ads is utilized, or Python Script that runs Redline Stealer through\nFTP is being distributed.\n\nI used tried to analysis three samples, but this is more harder\n```\nd81d3c919ed3b1aaa2dc8d5fbe9cf382 which the classes and arguments are obfuscated.\n\n```\nBut eventually the three samples are the same but different keys. Download the article\n[sample from vx-underground or](https://samples.vx-underground.org/samples/Families/RedLine/Samples/0adb0e2ac8aa969fb088ee95c4a91536.7z) [MalwareBazaar.](https://bazaar.abuse.ch/sample/b06a04969f5856d665a1e837f7aed8b1adfca9e44d06e7d5100b8c3adac4df79/)\n\n\n-----\n\n## Unpacking\n\nOur sample comes packed by `IntelliLock v.1.5.x packer. We will use upacme to`\nunpack the sample. Then we continue analysis with the sample\n```\ne90f6d0a7b7d0f23d0b105003fce91959c2083c23394b5cf43101c84ae8be4d2 .\n\n```\nFigure(1) Unpacked file\n\n## Configuration Extraction\n\nRedLine encodes its C2 server and the unaique ID using hard-coded key and uses the key\nto decrypt the C2 server and the ID. We enter `EntryPoint class to see encoded`\nConfiguration.\n\nFigure(2): Endcoded Configuration\n\nIn this sample, the decrption function is `Decrypt() . It will decrypt the C2 server and the`\nunique ID using the key `Pythonic . The decoding operation is FromBase64 then XOR`\n**[then FromBase64 using CyberChef. The C2 server address is](https://gchq.github.io/CyberChef/)** `46.8.19.196:53773 and`\nthe ID is `ytmaloy8 .`\n\n\n-----\n\nFigure(3): Decoding the C2 server and Botnet ID\n\n## C2 server Communication\n\nAfter decoding, the malware will send request using `RequestConnection() to`\n```\nnet.tcp://\" + C2 address + \"/\" . If there is a conncetion, the malware will try to get the\n\n```\nsettings `ScanningArgs which is a structure that stores configuration data and shows what`\nthe malware capabilities. The arguments have flags which will decide which information will\nbe collected, such as Hardware info, Browser credentials, FTP credentials, etc.\n\n\n-----\n\nFigure(4): boolean flags whether to steal or not\n\n## Collecting Information\n\nThe RedLine malware collects many information about the infected host and stores it into\n```\nScanResult which include the environment settings about the infected host such as\n\n```\nHardware info, ID, etc and `ScanDetails whcih stores the credential details information.`\nThen we enter `ResultFactory class to explore its actions and see what info will be stolen`\nas follows\n\n\n-----\n\nFigure(5): the collected info from the infected host\n\nThen we start explaining these actions and how the RedLine malware gets files and info in\ndetails. There are actions which are easy to figure out such as generate unique MD5 hash,\nget executed file path, get language, timeZone, resolution info, OSVersion, etc. And installed\nsoftwares by checking `Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall .`\nAnd running processes info such as `processID,` `Name,` `commandLine .`\n\n## Installed Browsers\n\nRedLine malware collectes the information about installed browsers such as\n```\nNameOfBrowser, Version, and PathOfFile from the BrowserVersion class.\n\n```\nFigure(6): the collected info of the installed browsers\n\n\n-----\n\nThen it search for Chrome based browsers such as `Chromium,` `Chrome,` `Opera . And`\ncollects `BrowserName,` `BrowserProfile,` `Logins,` `Autofills, and` `Cookies in`\n```\nScannedBrowser() class. RedLine malware collectes the information about installed\n\n```\nbrowsers such as `NameOfBrowser,` `Version, and` `PathOfFile from the`\n```\nBrowserVersion class.\n\n```\nFigure(7): the collected info of the installed chrome based browsers\n\nThen Gecko based browsers such as `Firefox,` `Waterfox . And collects` `BrowserName,`\n```\nBrowserProfile, Logins, Autofills, and Cookies in ScannedBrowser() class.\n\n```\nFigure(8): the collected info of the installed gecko based browsers\n\n## Message Clients\n\nThe malware gets info about message clients such as Telegram and uses\n```\nDesktopMessangerRule() to get the path of tdata folder which is used to store data of\n\n```\nthe Telegram application.\n\n\n-----\n\nFigure(9): the collected info of the message clients such as Telegram\n\nFigure(10): Search process by name to get telegram.exe path\n\n## FTP credentials\n\nThe malware tries to collect FTP (Transfer Protocol client) credentials through searching in\npaths such as `{0}\\\\FileZilla\\\\recentservers.xml,`\n```\n{0}\\\\FileZilla\\\\sitemanager.xml . Then uses ScanCredentials() class to extract\n\n```\n\n-----\n\nthe account credentials such as `Host,` `Port,` `User,` `Password from the XML file.`\n\nFigure(11): Get FTP credentials\n\n## Crypto wallets\n\nA crypto wallet is a program or a service which stores the public and/or private keys for\ncryptocurrency transactions. The malware tries to search for wallet extentions which is in\n```\nBrowserExtensionsRule() such as YoroiWallet, Coinbase, BinanceChain,\nBraveWallet, iWallet, and AtomicWallet .\n\n```\n\n-----\n\nFigure(12): crypto wallet credentials\n\n## VPN credentials\n\nThe malware tries to collect `NordVPN,` `OpenVPN, and` `ProtonVPN credentials. For`\nOpenVPN, `OpenVPNRule() class search for XML file which contains the credentials. And`\nso for ProtonVPN uses `ProtonVPNRule() class to search for protonVPN credentials`\n\nFigure(13): steal OpenVPN credentials\n\n## Checks if Blocked list\n\nHere the malware gets the `location,` `IP, and` `country and checks if it is located in the`\nblack list. If yes, malware does nothing and exit.\n\n\n-----\n\nFigure(14): Checks if blocked list\n\n## Remote execution\n\nThe malware can use the command line `CommandLineUpdate() and download some extra`\npayloads or malicious files after collecting the information about the infected host using\n```\nDownloadUpdate() and executes it using DownloadAndExecuteUpdate() and start the\n\n```\nprocess which used as a dropper.\n\nFigure(15): malware works as a dropper\n\n## IoC\n\n**No.** **Description** **Hash and URLs**\n\n1 The packed file (MD5 ) 0adb0e2ac8aa969fb088ee95c4a91536\n\n2 The unpacked file (MD5) 0C79BEE7D1787639A4772D6638159A35\n\n3 C2 server 46.8.19.196:53773\n\n\n-----\n\n## Yara Rule\n```\nrule redline_stealer\n{\n     meta:\n   description = \"Detecting unpacked RedLine\"\n   author = \"Muhammad Hasan Ali @muha2xmad\"\n     strings:\n   $mz = {4D 5A} //PE File\n   $s1 = \"Pythonic\"\n   $s2 = \"IRemoteEndpoint\"\n   $s3 = \"ITaskProcessor\"\n   $s4 = \"IEnumerable\"\n   $s5 = \"ScannedFile\"\n   $s6 = \"ScanningArgs\"\n   $s7 = \"ScanResult\"\n   $s8 = \"ScanDetails\"\n   $s9 = \"AllWalletsRule\"\n   $s10 = \"TryCompleteTask\"\n   $s11 = \"TryGetTasks\"\n   $s12 = \"TryInitBrowsers\"\n   $s13 = \"InstalledBrowsers\"\n   $s14 = \"TryInitInstalledBrowsers\"\n   $s15 = \"TryInitInstalledSoftwares\"\n   $s16 = \"TryGetConnection\"\n   $s17 = \"CommandLineUpdate\"\n   $s18 = \"DownloadFile\"\n   $s19 = \"DownloadAndExecuteUpdate\"\n   $s20 = \"OpenUpdate\"\n     condition:\n     ($mz at 0) and (10 of ($s*))\n}\n\n Article quote\n\n```\nاﻟﻤﺮء ﻻ ﯾﺼﻞ ﺑﺠﻬﺪه، أﻧﺖ ﺗﺒﺬل ﺟﻬﺪك ﺛﻢ ﯾﻔﺘﺢ اﷲ ﻋﻠﯿﻚ\n\n## REF\n\n\n-----\n\n[RedLine Infostealer from Cyber-Anubis](https://cyber-anubis.github.io/malware%20analysis/redline/)\n\n[Deep Analysis of Redline Stealer from S2W](https://medium.com/s2wblog/deep-analysis-of-redline-stealer-leaked-credential-with-wcf-7b31901da904)\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2022/2022-04-25 - Full RedLine malware analysis - IoCs - Stealing information.pdf"
    ],
    "report_names": [
        "2022-04-25 - Full RedLine malware analysis - IoCs - Stealing information.pdf"
    ],
    "threat_actors": [
        {
            "id": "5d2bd376-fcdc-4c6a-bc2c-17ebbb5b81a4",
            "created_at": "2022-10-25T16:07:23.667223Z",
            "updated_at": "2025-03-27T02:02:09.916086Z",
            "deleted_at": null,
            "main_name": "GCHQ",
            "aliases": [
                "Government Communications Headquarters",
                "Operation Socialist"
            ],
            "source_name": "ETDA:GCHQ",
            "tools": [
                "Prax",
                "Regin",
                "WarriorPride"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "9f101d9c-05ea-48b9-b6f1-168cd6d06d12",
            "created_at": "2023-01-06T13:46:39.396409Z",
            "updated_at": "2025-03-27T02:00:03.074969Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "CHROMIUM",
                "ControlX",
                "Red Dev 10",
                "RedHotel",
                "Red Scylla",
                "TAG-22",
                "BRONZE UNIVERSITY",
                "AQUATIC PANDA",
                "Charcoal Typhoon",
                "BountyGlad"
            ],
            "source_name": "MISPGALAXY:Earth Lusca",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "6abcc917-035c-4e9b-a53f-eaee636749c3",
            "created_at": "2022-10-25T16:07:23.565337Z",
            "updated_at": "2025-03-27T02:02:09.868522Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Bronze University",
                "Charcoal Typhoon",
                "Chromium",
                "Red Dev 10",
                "Red Scylla"
            ],
            "source_name": "ETDA:Earth Lusca",
            "tools": [
                "Agentemis",
                "AntSword",
                "BIOPASS",
                "BIOPASS RAT",
                "BadPotato",
                "Behinder",
                "BleDoor",
                "Cobalt Strike",
                "CobaltStrike",
                "Doraemon",
                "FRP",
                "Fast Reverse Proxy",
                "FunnySwitch",
                "HUC Port Banner Scanner",
                "KTLVdoor",
                "Mimikatz",
                "NBTscan",
                "POISONPLUG.SHADOW",
                "PipeMon",
                "RbDoor",
                "RibDoor",
                "RouterGod",
                "SAMRID",
                "ShadowPad Winnti",
                "SprySOCKS",
                "WinRAR",
                "Winnti",
                "XShellGhost",
                "cobeacon",
                "fscan",
                "lcx",
                "nbtscan"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "d53593c3-2819-4af3-bf16-0c39edc64920",
            "created_at": "2022-10-27T08:27:13.212301Z",
            "updated_at": "2025-03-27T02:00:55.529662Z",
            "deleted_at": null,
            "main_name": "Earth Lusca",
            "aliases": [
                "Earth Lusca",
                "TAG-22",
                "Charcoal Typhoon",
                "CHROMIUM",
                "ControlX"
            ],
            "source_name": "MITRE:Earth Lusca",
            "tools": [
                "Mimikatz",
                "PowerSploit",
                "Tasklist",
                "certutil",
                "Cobalt Strike",
                "Winnti for Linux",
                "Nltest",
                "NBTscan",
                "ShadowPad"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535639,
    "ts_updated_at": 1743041735,
    "ts_creation_date": 1653677905,
    "ts_modification_date": 1653677905,
    "files": {
        "pdf": "https://archive.orkl.eu/f4218e33580e90e0f3e33e6dd6f18cee3e6476bc.pdf",
        "text": "https://archive.orkl.eu/f4218e33580e90e0f3e33e6dd6f18cee3e6476bc.txt",
        "img": "https://archive.orkl.eu/f4218e33580e90e0f3e33e6dd6f18cee3e6476bc.jpg"
    }
}