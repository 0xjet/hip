{
    "id": "d4c48741-f1f6-45f9-8c95-7286aa36ef22",
    "created_at": "2023-01-12T15:04:31.522736Z",
    "updated_at": "2025-03-27T02:09:53.62855Z",
    "deleted_at": null,
    "sha1_hash": "523de5fad4e07cf25ff3a5d63d64ce2b725b6df3",
    "title": "2018-08-23 - New modular downloaders fingerprint systems - Part 2- AdvisorsBot",
    "authors": "",
    "file_creation_date": "2022-05-28T19:51:21Z",
    "file_modification_date": "2022-05-28T19:51:21Z",
    "file_size": 2791308,
    "plain_text": "# New modular downloaders fingerprint systems - Part 2: AdvisorsBot\n\n**[proofpoint.com/us/threat-insight/post/new-modular-downloaders-fingerprint-systems-part-2-advisorsbot](https://www.proofpoint.com/us/threat-insight/post/new-modular-downloaders-fingerprint-systems-part-2-advisorsbot)**\n\n\nAugust 23, 2018\n\n\n-----\n\n[Blog](https://www.proofpoint.com/us/blog)\n[Threat Insight](https://www.proofpoint.com/us/blog/threat-insight)\nNew modular downloaders fingerprint systems - Part 2: AdvisorsBot\n\n\n-----\n\nAugust 23, 2018 Proofpoint Staff\n\n**Overview**\n\nBeginning in May 2018, Proofpoint researchers observed a previously undocumented downloader\ndubbed AdvisorsBot appearing in malicious email campaigns. The campaigns appear to primarily target\nhotels, restaurants, and telecommunications, and are distributed by an actor we track as TA555. To\ndate, we have observed AdvisorsBot used as a first-stage payload, loading a fingerprinting module that,\nas with [Marap, is presumably used to identify targets of interest to further infect with additional modules](https://www.proofpoint.com/us/threat-insight/post/new-modular-downloaders-fingerprint-systems-prepare-more-part-1-marap)\nor payloads. AdvisorsBot is under active development and we have also observed another version of\nthe malware completely rewritten in PowerShell and .NET.\n\n**Campaign Analysis**\n\nWe first observed campaigns delivering AdvisorsBot in May 2018. Since then, the campaigns have used\nseveral themes in the email lures. The first is a “double charge” lure that appears to target hotels (Figure\n1). The second is a “food poisoning” lure for restaurant targeting (Figure 2). The third is a “catering\norder” lure also targeting restaurants (Figure 3). The fourth is a “resume” lure that targets\ntelecommunications organizations (Figure 4). While we did observe targeting leaning towards hotels,\nrestaurants, and telecommunications industries, we found that these campaigns were not as welltargeted as the lures might imply, with many messages going to targets unrelated to the contents of the\nlure.\n\nIn the May and June campaigns, the documents contained macros that executed a PowerShell\ncommand to download and execute AdvisorsBot. In the August 8 campaign, the actor shifted\ntechniques, using a macro to execute a PowerShell command that in turn downloaded another\nPowerShell script. This script executed embedded shellcode that ran AdvisorsBot without writing it to\ndisk. Finally, on August 15, the actor made another major change and the macro instead downloaded\nand executed a PowerShell version of AdvisorsBot that we called PoshAdvisor.\n\n\n-----\n\n_Figure 1: Message purporting to include information about a double charge delivering AdvisorsBot_\n\n_Figure 2: Message purporting to include information about a food poisoning incident and delivering_\n_PoshAdvisor_\n\n\n-----\n\n_Figure 3: Message purporting to include information about a catering order and delivering AdvisorsBot_\n\n_Figure 4: Message purporting to include a resume/CV delivering AdvisorsBot_\n\n\n-----\n\n_Figure 5: Example macro document lure_\n\n**Malware Analysis**\n\nThe name “AdvisorsBot” is based on early command and control (C&C) domains that all contained the\nword “advisors”. The malware is written in C, but the threat actor has recently created an interesting fork\nof the code that we discuss in the “PoshAdvisor” section.\n\nAnti-Analysis Features\n\nLike most modern malware, AdvisorsBot employs a number of anti-analysis features. One of the most\neffective is the use of junk code--such as extra instructions, conditional statements, and loops--to\nconsiderably slow down reverse engineering. For example, comparing the beginning of a function (part\nof the URI generation discussed in the “Command and Control” section) from the x86 version of the\nmalware (Figure 6) to the same function in the x64 version (Figure 7) which doesn’t seem to be as\naffected by the inclusion of the junk code as much.\n\n\n-----\n\n_Figure 6: The x86 version of the malware contains significantly more instances of junk code_\n\n\n-----\n\n_Figure 7: The x64 version contains far fewer instances of junk code_\n\nWe can also see two more anti-analysis features in the same screenshots:\n\n1. Most strings are stored as “stack strings” in which the characters of the string are manually pushed\n\nonto stack memory with individual instructions. This makes it more difficult to quickly see the\nstrings the malware uses.\n2. Windows API function hashing, which hinders identification of the malware’s functionality. A Python\n\nimplementation of the hashing algorithm is available on Github [1].\n\nTo detect various malware analysis tools, AdvisorsBot takes a CRC32 hash of the system’s volume\nserial number and each running process name and compares them to a list of hardcoded hash values. If\nit finds a match, the malware exits. To detect whether it is running on a virtual machine, the malware\ninspects the system’s firmware table (via a call to GetSystemFirmwareTable) for strings associated with\nvirtual machine vendors. Again, if it finds a match, the malware exits.\n\nIn the August 8 campaign, it became clear that the threat actor was paying close attention to the\ncharacteristics of victims connecting back to their C&C servers. The updated version of AdvisorsBot in\nthis campaign included an additional anti-analysis check that compared the system’s machine SID to a\nlist of 13 hardcoded values (Figure 8). We assume that they have profiled sandbox or malware\nresearcher systems in prior campaigns and blacklisted them.\n\n\n-----\n\n_Figure 8: Snippet of code showing AdvisorsBot comparing the victim machine’s SID to a blacklist_\n\nCommand and Control\n\nThe malware uses HTTPS to communicate with the C&C server. In the requests from the bot to the\nC&C, URIs contain encoded data that are used to identify a victim, for example:\n\n_/aa/rek5h/lnl5/s4zakljmo/4f/xbdju4a02tnxywx/etl2dni405a1khwxyg0r2.jpg_\n\nMore specifically, the data that is encoded in the URI contains the machine SID, CRC32 hash of the\ncomputer name, some unknown hardcoded values, and the Windows version:\n\n_Figure 9: Snippet of code showing the data structure used during formatting of the URI_\n\n\n-----\n\nThis data is encoded via the following steps:\n\nRandom 4-byte XOR key is generated\nData structure is XOR-encoded with the key and the key is prepended to the encrypted data\nThe key and encrypted data are converted from binary to lowercase letters and digits with a binary\nencoding similar to base32\nRandom slashes are added to make it look like a URI path\nA “.jpg” extension is added for GET requests and an “.asp” extension is added for POST requests\n\nCommands from the C&C server are polled via GET requests. A response that contains a command is\nstructured as shown below:\n\nOffset 0: Command\nOffset 4: Unknown, possibly module ID or command ID\nOffset 8: Length of encrypted data\nOffset 12: CRC32 hash of plaintext data\nOffset 16: XTEA IV\nOffset 24: XTEA key\nOffset 40: XTEA encrypted data using CBC mode\n\nAdvisorsBot currently can receive and act on only two commands:\n\nLoad a module (command ID 1)\nLoad shellcode in a thread (any other command ID)\n\nModules are DLLs that are manually loaded (allocate a buffer, copy the PE header and sections,\nrelocate, resolve the import table, and execute the entry point). A “communications” function is passed\nfrom the downloader to the module so that it can send back data to the C&C server. These requests\nhave the same style of URIs, but use POST data structured as shown below:\n\nOffset 0: Length of encrypted data\nOffset 4: CRC32 hash of plaintext data\nOffset 8: XTEA IV\nOffset 16: XTEA key\nOffset 32: XTEA encrypted data using CBC mode\n\nModules\n\nAt the time of publication we have only observed a system fingerprinting module being sent from a C&C\nserver. It performs the following activities and sends their output back to the C&C:\n\nTakes a screenshot and base64 encodes it\nExtracts Microsoft Outlook account details\n\n\n-----\n\nRuns the following system commands:\n\nsysteminfo\nipconfig /all\nnetstat -f\nnet view\ntasklist\nwhoami\nnet group \"domain admins\" /domain\ndir %USERPROFILE%\\Desktop\nwmic /namespace:\\\\root\\securitycenter2 path antivirusproduct GET\ndisplayName,pathToSignedProductExe\n\nPoshAdvisor\n\nOn August 15, we saw what initially looked like a second AdvisorsBot campaign for the month. However,\nafter closer analysis of the payload we were surprised to find that the threat actor had essentially\nrewritten AdvisorsBot using PowerShell and a .NET DLL embedded inside the PowerShell script. We\ntrack this variant as “PoshAdvisor” and, while it is not an exact duplicate of AdvisorsBot, it does contain\nthe same:\n\nURI generation and format (Figure 10)\nC&C response format and encryption\nModule download and execute functionality\nSystem fingerprinting functionality (Figure 11)\n\n\n-----\n\n_Figure 10: Snippet of code showing similarity of PoshAdvisor’s URI generation_\n\n_Figure 11: Snippet of code showing similarity of PoshAdvisor’s system fingerprinting_\n\nThis is noteworthy since it is fairly rare to see malware be rewritten in a completely different\nprogramming language.\n\n**Conclusion**\n\nWhile it remains to be seen whether this threat actor will continue to distribute AdvisorsBot,\nPoshAdvisor, or both in future campaigns, this pair of downloaders, with extensive anti-analysis features\nand increasingly sophisticated distribution techniques, warrant further investigation. AdvisorsBot, along\n\n\n-----\n\nwith another similar but unrelated malware that we detailed last week, point to a growing trend of small,\nversatile malware that give actors flexibility to launch future attacks and identify systems of interest that\nmay lend themselves to more significant compromise.\n\n**References**\n\n[1] https://github.com/EmergingThreats/threatresearch/blob/master/advisorsbot/func_hashes.py\n\n**Indicators of Compromise (IOCs)**\n\n\n**IOC** **IOC**\n**Type**\n\n\n**Description**\n\n\n6d73bea291bf6114af8333031187ac05fdfc8afe05025b272f510a6977b2153e SHA256 Example\nDocument\nAttachment\n(May)\n\nhxxp://chklink[.]us/upd.bin URL AdvisorsBot\ndownload\nURL (May)\n\n9dd12d3a32d2ba133bac8747f872f649b389a9cf3f4baaa9fad69a43d2e4f982 SHA256 AdvisorsBot\n(May)\n\ninvestments-advisors[.]bid Domain AdvisorsBot\nC&C (May)\n\ninteractive-investments[.]bid Domain AdvisorsBot\nC&C (May)\n\n1eb1ef64a9b41267e362597e071e181acb86b50e708ede4a9448689da7fb2425 SHA256 Example\nDocument\nAttachment\n(June)\n\nhxxp://finance-advisors-ca[.]bid/ldr.bin URL AdvisorsBot\ndownload\nURL (June)\n\nee32c4e0a4b345029d8b0f5c6534fa9fc41e795cc937d3f3fd743dcb0a1cea35 SHA256 AdvisorsBot\n(June)\n\nreal-estate-advisors[.]win Domain AdvisorsBot\nC&C (June)\n\n\n-----\n\nsecur-real-estate[.]bid Domain AdvisorsBot\nC&C (June)\n\n34a2fc4eb718a8b13a44cfb851ccac6cf63e54fe7e7ab145a5bdeb6def2d4620 SHA256 AdvisorsBot\nsystem\nfingerprinting\nmodule\n(June and\nAugust)\n\n956eae6395ed5e1b2d49ffa08ff85b42d1fc210531ab9c48c2d76e6ee38c9781 SHA256 Example\nDocument\nAttachment\n(August)\n\nhxxp://204.155.31[.]167/bootstrap.css URL AdvisorsBot\ndownload\nURL\n(August)\n\nc659b00a65a574a08fff64662581a8ecae7eafa38850a6c7c19b88c2085a1c03 SHA256 AdvisorsBot\n(August)\n\n185.180.198[.]56 IP AdvisorsBot\nC&C\n(August)\n\nfdf5072b904ba9148d8b98e4ba01987e644449e2b10f033ca4d2f967dc502a58 SHA256 Example\nDocument\nAttachment\n(August)\n\nhxxp://162.244.32[.]185/jquery.js URL PoshAdvisor\ndownload\nURL\n(August)\n\n2a27d7ad1f16c90767e1cf98c92905aa5a3030a268c8206462c5215a87d0e132 SHA256 PoshAdvisor\nPowerShell\nscript\n(August)\n\n335229e528c6348a3dc5941c434dc67acb031f297d9ac25e53a2a56d3df3e255 SHA256 PoshAdvisor\n.NET library\n(August)\n\n\n-----\n\n162.244.32[.]148 IP PoshAdvisor\nC&C\n(August)\n\n**ET and ETPRO Suricata/Snort Signatures**\n\n2832183 | ETPRO TROJAN PoshAdvisor SSL/TLS Certificate Observed\n\n2830733 || ETPRO TROJAN Observed AdvisorsBot CnC Domain Domain (investments-advisors .bid in\nTLS SNI)\n\n2830732 || ETPRO TROJAN Observed Malicious SSL Cert (AdvisorsBot CnC Domain)\n\nSubscribe to the Proofpoint Blog\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-08-23 - New modular downloaders fingerprint systems - Part 2- AdvisorsBot.pdf"
    ],
    "report_names": [
        "2018-08-23 - New modular downloaders fingerprint systems - Part 2- AdvisorsBot.pdf"
    ],
    "threat_actors": [
        {
            "id": "e9fcfe14-b91b-4f1d-a6f6-2de8a6dbca17",
            "created_at": "2022-10-25T16:07:24.287989Z",
            "updated_at": "2025-03-27T02:02:10.161205Z",
            "deleted_at": null,
            "main_name": "TA555",
            "aliases": [],
            "source_name": "ETDA:TA555",
            "tools": [
                "AdvisorsBot",
                "PoshAdvisor"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "47524f3c-731b-4af2-a9df-67c96c734392",
            "created_at": "2023-01-06T13:46:39.319424Z",
            "updated_at": "2025-03-27T02:00:03.049899Z",
            "deleted_at": null,
            "main_name": "TA555",
            "aliases": [],
            "source_name": "MISPGALAXY:TA555",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        }
    ],
    "ts_created_at": 1673535871,
    "ts_updated_at": 1743041393,
    "ts_creation_date": 1653767481,
    "ts_modification_date": 1653767481,
    "files": {
        "pdf": "https://archive.orkl.eu/523de5fad4e07cf25ff3a5d63d64ce2b725b6df3.pdf",
        "text": "https://archive.orkl.eu/523de5fad4e07cf25ff3a5d63d64ce2b725b6df3.txt",
        "img": "https://archive.orkl.eu/523de5fad4e07cf25ff3a5d63d64ce2b725b6df3.jpg"
    }
}