{
    "id": "f93d81cd-2899-4bcb-8117-67e11ad4a3e0",
    "created_at": "2023-01-12T15:08:56.581686Z",
    "updated_at": "2025-03-27T02:16:16.819921Z",
    "deleted_at": null,
    "sha1_hash": "d3f54b6b5a6c20e7e61066c02daa96a700c9ceae",
    "title": "2019-03-13 - The fourth horseman- CVE-2019-0797 vulnerability",
    "authors": "",
    "file_creation_date": "2022-05-27T21:29:16Z",
    "file_modification_date": "2022-05-27T21:29:16Z",
    "file_size": 866565,
    "plain_text": "# The fourth horseman: CVE-2019-0797 vulnerability\n\n**[securelist.com/cve-2019-0797-zero-day-vulnerability/89885/](https://securelist.com/cve-2019-0797-zero-day-vulnerability/89885/)**\n\n[Research](https://securelist.com/category/research/)\n\n[Research](https://securelist.com/category/research/)\n\n13 Mar 2019\n\nminute read\n\n\n-----\n\nAuthors\n\n[Vasily Berdnikov](https://securelist.com/author/vasilyberdnikov/)\n\nBoris Larin\n\n## The new zero-day in the Windows OS exploited in targeted attacks\n\nIn February 2019, our Automatic Exploit Prevention (AEP) systems detected an attempt to\nexploit a vulnerability in the Microsoft Windows operating system. Further analysis of this\nevent led to us discovering a zero-day vulnerability in win32k.sys. We reported it to Microsoft\non February 22, 2019. The company confirmed the vulnerability and assigned it CVE-20190797. Microsoft have just released a patch, crediting Kaspersky Lab researchers Vasiliy\n**Berdnikov and Boris Larin with the discovery:**\n\n\n-----\n\nThis is the fourth consecutive exploited Local Privilege Escalation vulnerability in Windows\n[we have discovered recently using our technologies. Just like with CVE-2018-8589, we](https://securelist.com/a-new-exploit-for-zero-day-vulnerability-cve-2018-8589/88845/)\nbelieve this exploit is used by several threat actors including, but possibly not limited to,\nFruityArmor and SandCat. While FruityArmor is known to have used zero-days before,\nSandCat is a new APT we discovered only recently. In addition to CVE-2019-0797 and\nCHAINSHOT, SandCat also uses the FinFisher/FinSpy framework.\n\nKaspersky Lab products detected this exploit proactively through the following technologies:\n\n1. Behavioral detection engine and Automatic Exploit Prevention for endpoint products;\n2. Advanced Sandboxing and Anti Malware engine for Kaspersky Anti Targeted Attack\n\nPlatform (KATA).\n\nKaspersky Lab verdicts for the artifacts used in this and related attacks are:\n\nHEUR:Exploit.Win32.Generic\nHEUR:Trojan.Win32.Generic\nPDM:Exploit.Win32.Generic\n\n## Brief technical details – CVE-2019-0797\n\nCVE-2019-0797 is a race condition that is present in the win32k driver due to a lack of\nproper synchronization between undocumented syscalls NtDCompositionDiscardFrame and\nNtDCompositionDestroyConnection. The vulnerable code can be observed below on\nscreenshots made on an up-to-date system during initial analysis:\n\n\n-----\n\nSnippet of NtDCompositionDiscardFrame syscall (Windows 8.1)\n\nOn this screenshot with the simplified logic of the NtDCompositionDiscardFrame syscall you\ncan see that this code acquires a lock that is related to frame operations in the structure\nDirectComposition::CConnection and tries to find a frame that corresponds to a given id and\nwill eventually call a free on it. The problem with this can be observed on the second\nscreenshot:\n\n\n-----\n\nSnippet of NtDCompositionDestroyConnection syscall inner function (Windows 8.1)\n\nOn this screenshot with the simplified logic of the function DiscardAllCompositionFrames that\nis called from within the NtDCompositionDestroyConnection syscall you can see that it does\nnot acquire the necessary lock and calls the function DiscardAllCompositionFrames that will\nrelease all allocated frames. The problem lies in the fact that when the syscalls\nNtDCompositionDiscardFrame and NtDCompositionDestroyConnection are executed\nsimultaneously, the function DiscardAllCompositionFrames may be executed at a time when\nthe NtDCompositionDiscardFrame syscall is already looking for a frame to release or has\nalready found it. This condition leads to a use-after-free scenario.\n\nInterestingly, this is the third race condition zero-day exploit used by the same group in\n[addition to CVE-2018-8589 and CVE-2018-8611.](https://securelist.com/zero-day-in-windows-kernel-transaction-manager-cve-2018-8611/89253/)\n\nStop execution if module file name contains substring “chrome.exe”\n\nThe exploit that was found in the wild was targeting 64-bit operating systems in the range\nfrom Windows 8 to Windows 10 build 15063. The exploitation process for all those operating\nsystems does not differ greatly and is performed using heap spraying palettes and\naccelerator tables with the use of GdiSharedHandleTable and gSharedInfo to leak their\nkernel addresses. In exploitation of Windows 10 build 14393 and higher windows are used\ninstead of palettes. Besides that, that exploit performs a check on whether it’s running from\nGoogle Chrome and stops execution if it is because vulnerability CVE-2019-0797 can’t be\nexploited within a sandbox.\n\n[Microsoft Windows](https://securelist.com/tag/microsoft-windows/)\n[Targeted attacks](https://securelist.com/tag/targeted-attacks/)\n\n\n-----\n\n[Vulnerabilities and exploits](https://securelist.com/tag/vulnerabilities-and-exploits/)\n[Zero-day vulnerabilities](https://securelist.com/tag/zero-day-vulnerabilities/)\n\nAuthors\n\n[Vasily Berdnikov](https://securelist.com/author/vasilyberdnikov/)\n\nBoris Larin\n\nThe fourth horseman: CVE-2019-0797 vulnerability\n\nYour email address will not be published. Required fields are marked *\n\nGReAT webinars\n\n13 May 2021, 1:00pm\n\n### GReAT Ideas. Balalaika Edition\n\n26 Feb 2021, 12:00pm\n17 Jun 2020, 1:00pm\n26 Aug 2020, 2:00pm\n22 Jul 2020, 2:00pm\nFrom the same authors\n\n\n-----\n\n### MysterySnail attacks with Windows zero-day\n\n Zero-day vulnerability in Desktop Window Manager (CVE-2021-28310) used in the wild\n\n\n-----\n\n### Operation PowerFall: CVE-2020-0986 and variants\n\n Internet Explorer and Windows zero-day exploits used in Operation PowerFall\n\n\n-----\n\n### GReAT thoughts: Awesome IDA Pro plugins\n\nSubscribe to our weekly e-mails\n\nThe hottest research right in your inbox\n\n\n-----\n\nReports\n\n### APT trends report Q1 2022\n\nThis is our latest summary of advanced persistent threat (APT) activity, focusing on events\nthat we observed during Q1 2022.\n\n### Lazarus Trojanized DeFi app for delivering malware\n\nWe recently discovered a Trojanized DeFi application that was compiled in November 2021.\nThis application contains a legitimate program called DeFi Wallet that saves and manages a\ncryptocurrency wallet, but also implants a full-featured backdoor.\n\n### MoonBounce: the dark side of UEFI firmware\n\nAt the end of 2021, we inspected UEFI firmware that was tampered with to embed a\nmalicious code we dub MoonBounce. In this report we describe how the MoonBounce\nimplant works and how it is connected to APT41.\n\n### The BlueNoroff cryptocurrency hunt is still on\n\n\n-----\n\nIt appears that BlueNoroff shifted focus from hitting banks and SWIFT-connected servers to\nsolely cryptocurrency businesses as the main source of the group’s illegal income.\n\nSubscribe to our weekly e-mails\n\nThe hottest research right in your inbox\n\n\n-----\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2019/2019-03-13 - The fourth horseman- CVE-2019-0797 vulnerability.pdf"
    ],
    "report_names": [
        "2019-03-13 - The fourth horseman- CVE-2019-0797 vulnerability.pdf"
    ],
    "threat_actors": [
        {
            "id": "1bdb91cf-f1a6-4bed-8cfa-c7ea1b635ebd",
            "created_at": "2022-10-25T16:07:23.766784Z",
            "updated_at": "2025-03-27T02:02:09.971636Z",
            "deleted_at": null,
            "main_name": "Bluenoroff",
            "aliases": [
                "APT 38",
                "ATK 117",
                "Alluring Pisces",
                "Black Alicanto",
                "Bluenoroff",
                "CTG-6459",
                "Copernicium",
                "Nickel Gladstone",
                "Sapphire Sleet",
                "Selective Pisces",
                "Stardust Chollima",
                "T-APT-15",
                "TA444",
                "TAG-71",
                "TEMP.Hermit"
            ],
            "source_name": "ETDA:Bluenoroff",
            "tools": [],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "0f47a6f3-a181-4e15-9261-50eef5f03a3a",
            "created_at": "2022-10-25T16:07:24.228663Z",
            "updated_at": "2025-03-27T02:02:10.145238Z",
            "deleted_at": null,
            "main_name": "Stealth Falcon",
            "aliases": [
                "FruityArmor",
                "Project Raven",
                "Stealth Falcon"
            ],
            "source_name": "ETDA:Stealth Falcon",
            "tools": [
                "Deadglyph",
                "StealthFalcon"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "67ac502c-8cf8-46cb-98e8-c249e0f0298d",
            "created_at": "2022-10-25T16:07:24.149987Z",
            "updated_at": "2025-03-27T02:02:10.124302Z",
            "deleted_at": null,
            "main_name": "SandCat",
            "aliases": [],
            "source_name": "ETDA:SandCat",
            "tools": [
                "CHAINSHOT",
                "FinFisher",
                "FinFisher RAT",
                "FinSpy"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "77aedfa3-e52b-4168-8269-55ccec0946f7",
            "created_at": "2023-01-06T13:46:38.453791Z",
            "updated_at": "2025-03-27T02:00:02.837384Z",
            "deleted_at": null,
            "main_name": "Stealth Falcon",
            "aliases": [
                "FruityArmor",
                "G0038"
            ],
            "source_name": "MISPGALAXY:Stealth Falcon",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "80cf66b8-27d2-4e87-b0d1-5bacacd9bb3d",
            "created_at": "2023-01-06T13:46:38.931567Z",
            "updated_at": "2025-03-27T02:00:02.954922Z",
            "deleted_at": null,
            "main_name": "SandCat",
            "aliases": [],
            "source_name": "MISPGALAXY:SandCat",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "99cb4e5b-8071-4f9e-aa1d-45bfbb6197e3",
            "created_at": "2023-01-06T13:46:38.860754Z",
            "updated_at": "2025-03-27T02:00:02.937438Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "SectorJ04 Group",
                "Dudear",
                "G0092",
                "ATK103",
                "Hive0065",
                "Spandex Tempest",
                "GRACEFUL SPIDER",
                "GOLD TAHOE",
                "CHIMBORAZO",
                "SectorJ04"
            ],
            "source_name": "MISPGALAXY:TA505",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "f426f0a0-faef-4c0e-bcf8-88974116c9d0",
            "created_at": "2022-10-25T15:50:23.240383Z",
            "updated_at": "2025-03-27T02:00:55.404232Z",
            "deleted_at": null,
            "main_name": "APT38",
            "aliases": [
                "APT38",
                "NICKEL GLADSTONE",
                "BeagleBoyz",
                "Bluenoroff",
                "Stardust Chollima",
                "Sapphire Sleet",
                "COPERNICIUM"
            ],
            "source_name": "MITRE:APT38",
            "tools": [
                "ECCENTRICBANDWAGON",
                "HOPLIGHT",
                "Mimikatz",
                "KillDisk",
                "DarkComet"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "8bc1a044-a23b-4904-903c-13f463605cb3",
            "created_at": "2024-05-01T02:03:08.136237Z",
            "updated_at": "2025-03-27T02:05:17.415795Z",
            "deleted_at": null,
            "main_name": "NICKEL GLADSTONE",
            "aliases": [
                "Bluenoroff ",
                "CTG-6459 ",
                "Citrine Sleet ",
                "HIDDEN COBRA ",
                "Lazarus Group",
                "Sapphire Sleet ",
                "Stardust Chollima ",
                "APT38 "
            ],
            "source_name": "Secureworks:NICKEL GLADSTONE",
            "tools": [
                " Bankshot",
                " CATCH22",
                " CCGC_Proxy",
                " Cur1Agent",
                " Ratankba",
                " Server_TrafficForwarder",
                " Wcry",
                "AlphaNC"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "a2b92056-9378-4749-926b-7e10c4500dac",
            "created_at": "2023-01-06T13:46:38.430595Z",
            "updated_at": "2025-03-27T02:00:02.831633Z",
            "deleted_at": null,
            "main_name": "Lazarus Group",
            "aliases": [
                "Operation DarkSeoul",
                "APT38",
                "ATK117",
                "DEV-1222",
                "G0032",
                "APT 38",
                "Stardust Chollima",
                "APT-C-26",
                "ATK3",
                "Diamond Sleet",
                "Hidden Cobra",
                "Unit 121",
                "Subgroup: Bluenoroff",
                "NICKEL GLADSTONE",
                "DEV-0139",
                "Andariel",
                "Operation Troy",
                "COVELLITE",
                "TA404",
                "Lazarus group",
                "Dark Seoul",
                "G0082",
                "NewRomanic Cyber Army Team",
                "Bluenoroff",
                "Appleworm",
                "Nickel Academy",
                "COPERNICIUM",
                "Hastati Group",
                "Bureau 121",
                "Operation AppleJeus",
                "Whois Hacking Team",
                "Citrine Sleet",
                "Sapphire Sleet",
                "Group 77",
                "Labyrinth Chollima",
                "Operation GhostSecret",
                "BeagleBoyz"
            ],
            "source_name": "MISPGALAXY:Lazarus Group",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "75d4d6a9-b5d1-4087-a7a0-e4a9587c45f4",
            "created_at": "2022-10-25T15:50:23.5188Z",
            "updated_at": "2025-03-27T02:00:55.489882Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "TA505",
                "Hive0065",
                "Spandex Tempest",
                "CHIMBORAZO"
            ],
            "source_name": "MITRE:TA505",
            "tools": [
                "AdFind",
                "Azorult",
                "FlawedAmmyy",
                "Mimikatz",
                "Dridex",
                "TrickBot",
                "Get2",
                "FlawedGrace",
                "Cobalt Strike",
                "ServHelper",
                "Amadey",
                "SDBbot",
                "PowerSploit"
            ],
            "source_id": "MITRE",
            "reports": null
        },
        {
            "id": "c0cedde3-5a9b-430f-9b77-e6568307205e",
            "created_at": "2022-10-25T16:07:23.528994Z",
            "updated_at": "2025-03-27T02:02:09.847683Z",
            "deleted_at": null,
            "main_name": "DarkHotel",
            "aliases": [
                "APT-C-06",
                "ATK 52",
                "CTG-1948",
                "Dubnium",
                "Fallout Team",
                "Higaisa",
                "Luder",
                "Operation DarkHotel",
                "Operation Daybreak",
                "Operation Inexsmar",
                "Operation PowerFall",
                "Operation The Gh0st Remains the Same",
                "SIG25",
                "Shadow Crane",
                "T-APT-02",
                "Tungsten Bridge",
                "Zigzag Hail"
            ],
            "source_name": "ETDA:DarkHotel",
            "tools": [
                "Asruex",
                "DarkHotel",
                "DmaUp3.exe",
                "GreezeBackdoor",
                "Karba",
                "Nemain",
                "Nemim",
                "Ramsay",
                "Retro",
                "Tapaoux",
                "Trojan.Win32.Karba.e",
                "Virus.Win32.Pioneer.dx",
                "igfxext.exe",
                "msieckc.exe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "e447d393-c259-46e2-9932-19be2ba67149",
            "created_at": "2022-10-25T16:07:24.28282Z",
            "updated_at": "2025-03-27T02:02:10.159466Z",
            "deleted_at": null,
            "main_name": "TA505",
            "aliases": [
                "ATK 103",
                "Chimborazo",
                "Gold Evergreen",
                "Gold Tahoe",
                "Graceful Spider",
                "Hive0065",
                "Operation Tovar",
                "Operation Trident Breach",
                "SectorJ04",
                "Spandex Tempest",
                "TA505",
                "TEMP.Warlock"
            ],
            "source_name": "ETDA:TA505",
            "tools": [
                "Amadey",
                "AmmyyRAT",
                "AndroMut",
                "Azer",
                "Bart",
                "Bugat v5",
                "CryptFile2",
                "CryptoLocker",
                "CryptoMix",
                "CryptoShield",
                "Dridex",
                "Dudear",
                "EmailStealer",
                "FRIENDSPEAK",
                "Fake Globe",
                "Fareit",
                "FlawedAmmyy",
                "FlawedGrace",
                "FlowerPippi",
                "GOZ",
                "GameOver Zeus",
                "GazGolder",
                "Gelup",
                "Get2",
                "GetandGo",
                "GlobeImposter",
                "Gorhax",
                "GraceWire",
                "Gussdoor",
                "Jaff",
                "Kasidet",
                "Kegotip",
                "Kneber",
                "LOLBAS",
                "LOLBins",
                "Living off the Land",
                "Locky",
                "MINEBRIDGE",
                "MINEBRIDGE RAT",
                "MirrorBlast",
                "Neutrino Bot",
                "Neutrino Exploit Kit",
                "P2P Zeus",
                "Peer-to-Peer Zeus",
                "Philadelphia",
                "Philadephia Ransom",
                "Pony Loader",
                "Rakhni",
                "ReflectiveGnome",
                "Remote Manipulator System",
                "RockLoader",
                "RuRAT",
                "SDBbot",
                "ServHelper",
                "Shifu",
                "Siplog",
                "TeslaGun",
                "TiniMet",
                "TinyMet",
                "Trojan.Zbot",
                "Wsnpoem",
                "Zbot",
                "Zeta",
                "ZeuS",
                "Zeus"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "4d5f939b-aea9-4a0e-8bff-003079a261ea",
            "created_at": "2023-01-06T13:46:39.04841Z",
            "updated_at": "2025-03-27T02:00:02.985296Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "G0096",
                "Grayfly",
                "BARIUM",
                "BRONZE ATLAS",
                "BRONZE EXPORT",
                "Red Kelpie",
                "HOODOO",
                "Brass Typhoon",
                "TA415",
                "WICKED SPIDER",
                "WICKED PANDA",
                "G0044",
                "Earth Baku"
            ],
            "source_name": "MISPGALAXY:APT41",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e698860d-57e8-4780-b7c3-41e5a8314ec0",
            "created_at": "2022-10-25T15:50:23.287929Z",
            "updated_at": "2025-03-27T02:00:55.43005Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "APT41",
                "Wicked Panda",
                "Brass Typhoon",
                "BARIUM"
            ],
            "source_name": "MITRE:APT41",
            "tools": [
                "ASPXSpy",
                "BITSAdmin",
                "PlugX",
                "Impacket",
                "gh0st RAT",
                "netstat",
                "PowerSploit",
                "ZxShell",
                "KEYPLUG",
                "ipconfig",
                "sqlmap",
                "China Chopper",
                "ShadowPad",
                "MESSAGETAP",
                "Mimikatz",
                "certutil",
                "njRAT",
                "Cobalt Strike",
                "pwdump",
                "BLACKCOFFEE",
                "ROCKBOOT",
                "dsquery",
                "Winnti for Linux",
                "DUSTTRAP",
                "Derusbi",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673536136,
    "ts_updated_at": 1743041776,
    "ts_creation_date": 1653686956,
    "ts_modification_date": 1653686956,
    "files": {
        "pdf": "https://archive.orkl.eu/d3f54b6b5a6c20e7e61066c02daa96a700c9ceae.pdf",
        "text": "https://archive.orkl.eu/d3f54b6b5a6c20e7e61066c02daa96a700c9ceae.txt",
        "img": "https://archive.orkl.eu/d3f54b6b5a6c20e7e61066c02daa96a700c9ceae.jpg"
    }
}